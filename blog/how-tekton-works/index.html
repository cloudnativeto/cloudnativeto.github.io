<!DOCTYPE html>

<html lang="zh-cn"><head>
  <meta charset="utf-8">
  <title>Tekton 的工作原理 | 云原生社区</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="结合源码和场景分析 Tekton 的工作原理。">
  
  <meta name="author" content=" 云原生社区">
  <meta name="generator" content="Hugo 0.65.3" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="/plugins/bootstrap/bootstrap.min.css">
  
  <link rel="stylesheet" href="/plugins/slick/slick.css">
  
  <link rel="stylesheet" href="/plugins/fontawesome/font-awesome.min.css">
  
  <link rel="stylesheet" href="/plugins/animate/animate.css">
  
  <link rel="stylesheet" href="/plugins/venobox/venobox.css">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="/scss/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="/images/favicon.png " type="image/x-icon">
  <meta property="og:image" content="https://cloudnative.to/images/favicon.png">
  <!--Algolia-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.css">
  <!--Twitter card-->
  <meta name="twitter:card" content="结合源码和场景分析 Tekton 的工作原理。" />
  <meta name="twitter:site" content="Cloud Native Community|云原生社区" />
  <meta name="twitter:creator" content="@CloudNativeCN" />
  <meta property="og:url" content="https://cloudnative.to/blog/how-tekton-works/" />
  <meta property="og:title" content="Tekton 的工作原理" />
  <meta property="og:description" content="结合源码和场景分析 Tekton 的工作原理。" />
  <meta property="og:image" content="https://cloudnative.to/images/favicon.png" />
</head>
<body>
<!-- header -->
<header>
  

  <!-- navigation -->
  <div class="navigation bg-white position-relative">
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-light bg-white">
        <a class="navbar-brand" href="/"><img class="img-fluid pb-lg-3" src="/images/logo.png" width="189px" alt="云原生社区"></a>
        <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="/"></a>
            </li>
            
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                社区
              </a>
              <div class="dropdown-menu" >
                
                <a class="dropdown-item" href="/team">管理委员会</a>
                
                <a class="dropdown-item" href="https://i.cloudnative.to/academy/">云原生学院</a>
                
                <a class="dropdown-item" href="/city">城市站</a>
                
                <a class="dropdown-item" href="https://i.cloudnative.to/community/">社区资料</a>
                
              </div>
            </li>
            
            
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                兴趣小组
              </a>
              <div class="dropdown-menu" >
                
                <a class="dropdown-item" href="https://i.cloudnative.to/kubernetes/">Kubernetes SIG</a>
                
                <a class="dropdown-item" href="https://i.cloudnative.to/istio/">Istio SIG</a>
                
                <a class="dropdown-item" href="https://i.cloudnative.to/envoy/">Envoy SIG</a>
                
                <a class="dropdown-item" href="https://i.cloudnative.to/dapr/">Dapr SIG</a>
                
                <a class="dropdown-item" href="https://i.cloudnative.to/oam/">OAM SIG</a>
                
              </div>
            </li>
            
            
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                博客
              </a>
              <div class="dropdown-menu" >
                
                <a class="dropdown-item" href="/categories/kubernetes">Kubernetes</a>
                
                <a class="dropdown-item" href="/categories/service-mesh">Service Mesh</a>
                
                <a class="dropdown-item" href="/categories/envoy">Envoy</a>
                
                <a class="dropdown-item" href="/categories/oam">OAM</a>
                
                <a class="dropdown-item" href="/categories/%E5%BC%80%E6%BA%90%E7%A4%BE%E5%8C%BA">开源社区</a>
                
                <a class="dropdown-item" href="/blog">所有</a>
                
              </div>
            </li>
            
            
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                资料
              </a>
              <div class="dropdown-menu" >
                
                <a class="dropdown-item" href="https://github.com/cloudnativeto/academy">云原生学院分享归档</a>
                
                <a class="dropdown-item" href="/kubebuilder">Kubebuilder 中文文档</a>
                
                <a class="dropdown-item" href="/envoy">Envoy 中文文档</a>
                
              </div>
            </li>
            
            
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                关于
              </a>
              <div class="dropdown-menu" >
                
                <a class="dropdown-item" href="/about">介绍</a>
                
                <a class="dropdown-item" href="/contact">联系</a>
                
              </div>
            </li>
            
            
            
            <li class="nav-item">
              <a class="nav-link" href="/contribute">投稿</a>
            </li>
            
            
            
            <li class="nav-item">
              <a class="nav-link" href="/job">招聘</a>
            </li>
            
            
          </ul>

          
          

          
          <!-- search -->
          <div class="search px-4">
            <button id="searchOpen" class="search-btn"><i class="fa fa-search text-dark"></i></button>
            <div class="search-wrapper">
              <form action="/search">
                <input class="search-box form-control" id="js-algolia-btn" name="s" type="search" placeholder="输入搜索词">
              </form>
              <button id="searchClose" class="search-close"><i class="fa fa-close text-dark"></i></button>
            </div>
          </div>
          
          
          <!-- get start btn -->
          <a href="/contact" class="btn btn-primary hover-ripple">加入我们</a>
          
        </div>
      </nav>
    </div>
  </div>
  <!-- /navigation -->
</header>
<!-- /header -->

	<!-- page title -->
<section class="section bg-cover overlay" style="background-image: url('/'),url('/'),url('/images/backgrounds/page-title.jpg');">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <h2 class="text-white mb-3">Tekton 的工作原理</h2>
        <!-- breadcrumb -->
        
        <p class="text-white">结合源码和场景分析 Tekton 的工作原理。</p>
      </div>
    </div>
  </div>
</section>
<!-- /page title -->

	

<!-- blog details -->
<section class="section">
  <div class="container blog">
    <div class="row">
      <div class="col-lg-8">
        <!-- post thumb -->
        <div class="position-relative mb-5">
          <img src="/"  onerror="this.src='https:\/\/gw.alipayobjects.com\/mdn\/rms_95b965\/afts\/img\/A*eUqkTKk66gkAAAAAAAAAAABkARQnAQ'" alt="post thumb" class="img-fluid w-100">
           <div class="card-type">Tekton</div>
        </div>
        <div class="card-meta mb-2">作者  <strong class="text-dark"><a href="https://atbug.com">张晓辉</a></strong>
          
            发表于 <strong class="text-dark">2020年5月23日</strong></div>
        <hr>
        <div class="content">
          <p><strong>这篇文章是基于 Tekton Pipeline 的最新版本<code>v0.12.1</code>版本。</strong></p>
<p>快速入门请参考：<a href="https://atbug.com/tekton-trigger-practice/">云原生 CICD: Tekton Pipeline 实战</a> ，实战是基于版本 v0.10.x。</p>
<h2 id="pipeline-crd-与核心资源的关系">Pipeline CRD 与核心资源的关系</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ k api-resources --api-group<span style="color:#f92672">=</span>tekton.dev
NAME                SHORTNAMES   APIGROUP     NAMESPACED   KIND
clustertasks                     tekton.dev   false        ClusterTask
conditions                       tekton.dev   true         Condition
pipelineresources                tekton.dev   true         PipelineResource
pipelineruns        pr,prs       tekton.dev   true         PipelineRun
pipelines                        tekton.dev   true         Pipeline
taskruns            tr,trs       tekton.dev   true         TaskRun
tasks                            tekton.dev   true         Task
</code></pre></div><p>Tekton Pipelines提供了上面的CRD，其中部分CRD与Kubernetes core中资源相对应</p>
<ul>
<li>Task =&gt; Pod</li>
<li>Task.Step =&gt; Container</li>
</ul>
<p><img src="https://atbug.oss-cn-hangzhou.aliyuncs.com/2020/05/23/15902164552270.jpg" alt=""></p>
<h2 id="工作原理">工作原理</h2>
<p><img src="https://atbug.oss-cn-hangzhou.aliyuncs.com/2020/05/23/15902280074872.jpg" alt="">
(图片来自tekton.dev)</p>
<p>Tekton Pipeline 是基于 Knative 的实现，pod <code>tekton-pipelines-controller</code> 中有两个 <a href="https://knative.dev/docs/eventing/samples/writing-receive-adapter-source/03-controller/">Knative Controller</a>的实现：PipelineRun 和 TaskRun。</p>
<p><img src="https://atbug.oss-cn-hangzhou.aliyuncs.com/2020/05/23/15902270934199.jpg" alt=""></p>
<h3 id="task的执行顺序">Task的执行顺序</h3>
<p>PipelineRun Controller 的 <code>#reconcile()</code>方法，监控到有<code>PipelineRun</code>被创建。然后从<code>PipelineSpec</code>的 tasks 列表，构建出一个图（<code>graph</code>），用于描述<code>Pipeline</code>中 Task 间的依赖关系。依赖关系是通过<code>runAfter</code>和<code>from</code>，进而控制<a href="#Task%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F">Task的执行顺序</a>。与此同时，准备<code>PipelineRun</code>中定义的<code>PipelineResources</code>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Node represents a Task in a pipeline.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Node</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#75715e">// Task represent the PipelineTask in Pipeline
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Task</span> <span style="color:#a6e22e">Task</span>
	<span style="color:#75715e">// Prev represent all the Previous task Nodes for the current Task
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Prev</span> []<span style="color:#f92672">*</span><span style="color:#a6e22e">Node</span>
	<span style="color:#75715e">// Next represent all the Next task Nodes for the current Task
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Next</span> []<span style="color:#f92672">*</span><span style="color:#a6e22e">Node</span>
}

<span style="color:#75715e">// Graph represents the Pipeline Graph
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Graph</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#75715e">//Nodes represent map of PipelineTask name to Node in Pipeline Graph
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Nodes</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#f92672">*</span><span style="color:#a6e22e">Node</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Build</span>(<span style="color:#a6e22e">tasks</span> <span style="color:#a6e22e">Tasks</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Graph</span>, <span style="color:#66d9ef">error</span>) {
    <span style="color:#f92672">...</span>
}
</code></pre></div><p><code>PipelineRun</code>中定义的参数（parameters）也会注入到<code>PipelineSpec</code>中：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">pipelineSpec</span> = <span style="color:#a6e22e">resources</span>.<span style="color:#a6e22e">ApplyParameters</span>(<span style="color:#a6e22e">pipelineSpec</span>, <span style="color:#a6e22e">pr</span>)
</code></pre></div><p>接下来就是调用<code>dag#GetSchedulable()</code>方法，获取未完成（通过Task状态判断）的 Task 列表；</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">GetSchedulable</span>(<span style="color:#a6e22e">g</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Graph</span>, <span style="color:#a6e22e">doneTasks</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">string</span>) (<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">struct</span>{}, <span style="color:#66d9ef">error</span>) {
    <span style="color:#f92672">...</span>
}
</code></pre></div><p>为 Task A 创建<code>TaskRun</code>，假如<code>Task</code>配置了<code>Condition</code>。会先为 condition创建一个<code>TaskRun</code>，只有在 condition 的<code>TaskRun</code>运行成功，才会运行 A 的<code>TaskRun</code>；否则就跳过。</p>
<h3 id="step的执行顺序">Step的执行顺序</h3>
<p>这一部分篇幅较长，之前的文章 <a href="https://atbug.com/control-process-order-of-pod-containers/">控制 Pod 内容器的启动顺序</a> 中提到过。</p>
<p>这里补充一下<a href="https://kubernetes.io/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/#the-downward-api">Kubernetes Downward API</a>的使用，Kubernetes Downward API的引入，控制着 <code>Task</code> 的第一个 <code>Step</code> 在何时执行。</p>
<p><code>TaskRun</code> Controller 在 reconciling 的过程中，在相应的 <code>Pod</code> 状态变为<code>Running</code>时，会将<code>tekton.dev/ready=READY</code>写入到 Pod 的 annotation 中，来通知第一个<code>Step</code>的执行。</p>
<p>Pod的部分内容：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">containers</span>:
    - <span style="color:#66d9ef">args</span>:
      - -wait_file
      - /tekton/downward/ready
      - -wait_file_content
      - -post_file
      - /tekton/tools/<span style="color:#ae81ff">0</span>
      - -termination_path
      - /tekton/termination
      - -entrypoint
      - /ko-app/git-init
      - -<span style="color:#e6db74">-
</span><span style="color:#e6db74">      - -url</span>
      - ssh://git@gitlab.nip.io:<span style="color:#ae81ff">8022</span>/addozhang/logan-pulse.git
      - -revision
      - develop
      - -path
      - /workspace/git-source
      <span style="color:#66d9ef">command</span>:
      - /tekton/tools/entrypoint
      <span style="color:#66d9ef">volumeMounts</span>:
      - <span style="color:#66d9ef">mountPath</span>: /tekton/downward
        <span style="color:#66d9ef">name</span>: tekton-internal-downward
      
  <span style="color:#66d9ef">volumes</span>:
    - <span style="color:#66d9ef">downwardAPI</span>:
        <span style="color:#66d9ef">defaultMode</span>: <span style="color:#ae81ff">420</span>
        <span style="color:#66d9ef">items</span>:
        - <span style="color:#66d9ef">fieldRef</span>:
            <span style="color:#66d9ef">apiVersion</span>: v1
            <span style="color:#66d9ef">fieldPath</span>: metadata.annotations[<span style="color:#e6db74">&#39;tekton.dev/ready&#39;</span>]
          <span style="color:#66d9ef">path</span>: ready
      <span style="color:#66d9ef">name</span>: tekton-internal-downward
</code></pre></div><p>对原生的排序step container进一步处理：启动命令使用<code>entrypoint</code>提供，并设置执行参数：</p>
<p><code>entrypoint.go</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">orderContainers</span>(<span style="color:#a6e22e">entrypointImage</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">steps</span> []<span style="color:#a6e22e">corev1</span>.<span style="color:#a6e22e">Container</span>, <span style="color:#a6e22e">results</span> []<span style="color:#a6e22e">v1alpha1</span>.<span style="color:#a6e22e">TaskResult</span>) (<span style="color:#a6e22e">corev1</span>.<span style="color:#a6e22e">Container</span>, []<span style="color:#a6e22e">corev1</span>.<span style="color:#a6e22e">Container</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">initContainer</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">corev1</span>.<span style="color:#a6e22e">Container</span>{
		<span style="color:#a6e22e">Name</span>:         <span style="color:#e6db74">&#34;place-tools&#34;</span>,
		<span style="color:#a6e22e">Image</span>:        <span style="color:#a6e22e">entrypointImage</span>,
		<span style="color:#a6e22e">Command</span>:      []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;cp&#34;</span>, <span style="color:#e6db74">&#34;/ko-app/entrypoint&#34;</span>, <span style="color:#a6e22e">entrypointBinary</span>},
		<span style="color:#a6e22e">VolumeMounts</span>: []<span style="color:#a6e22e">corev1</span>.<span style="color:#a6e22e">VolumeMount</span>{<span style="color:#a6e22e">toolsMount</span>},
	}

	<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">steps</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">corev1</span>.<span style="color:#a6e22e">Container</span>{}, <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;No steps specified&#34;</span>)
	}

	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">steps</span> {
		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">argsForEntrypoint</span> []<span style="color:#66d9ef">string</span>
		<span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">i</span> {
		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0</span>:
			<span style="color:#a6e22e">argsForEntrypoint</span> = []<span style="color:#66d9ef">string</span>{
				<span style="color:#75715e">// First step waits for the Downward volume file.
</span><span style="color:#75715e"></span>				<span style="color:#e6db74">&#34;-wait_file&#34;</span>, <span style="color:#a6e22e">filepath</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">downwardMountPoint</span>, <span style="color:#a6e22e">downwardMountReadyFile</span>),
				<span style="color:#e6db74">&#34;-wait_file_content&#34;</span>, <span style="color:#75715e">// Wait for file contents, not just an empty file.
</span><span style="color:#75715e"></span>				<span style="color:#75715e">// Start next step.
</span><span style="color:#75715e"></span>				<span style="color:#e6db74">&#34;-post_file&#34;</span>, <span style="color:#a6e22e">filepath</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">mountPoint</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%d&#34;</span>, <span style="color:#a6e22e">i</span>)),
				<span style="color:#e6db74">&#34;-termination_path&#34;</span>, <span style="color:#a6e22e">terminationPath</span>,
			}
		<span style="color:#66d9ef">default</span>:
			<span style="color:#75715e">// All other steps wait for previous file, write next file.
</span><span style="color:#75715e"></span>			<span style="color:#a6e22e">argsForEntrypoint</span> = []<span style="color:#66d9ef">string</span>{
				<span style="color:#e6db74">&#34;-wait_file&#34;</span>, <span style="color:#a6e22e">filepath</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">mountPoint</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%d&#34;</span>, <span style="color:#a6e22e">i</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)),
				<span style="color:#e6db74">&#34;-post_file&#34;</span>, <span style="color:#a6e22e">filepath</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">mountPoint</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%d&#34;</span>, <span style="color:#a6e22e">i</span>)),
				<span style="color:#e6db74">&#34;-termination_path&#34;</span>, <span style="color:#a6e22e">terminationPath</span>,
			}
		}
    <span style="color:#f92672">...</span>
}
</code></pre></div><h3 id="自动运行的容器">自动运行的容器</h3>
<p>这些自动运行的容器作为 pod 的<code>initContainer</code>会在 step 容器运行之前运行</p>
<h4 id="credential-initializer"><code>credential-initializer</code></h4>
<p>用于将 <code>ServiceAccount</code> 的相关secrets持久化到容器的文件系统中。比如 ssh 相关秘钥、config文件以及know_hosts文件；docker registry 相关的凭证则会被写入到 docker 的配置文件中。</p>
<h4 id="working-dir-initializer"><code>working-dir-initializer</code></h4>
<p>收集<code>Task</code>内的各个<code>Step</code>的<code>workingDir</code>配置，初始化目录结构</p>
<h4 id="place-scripts"><code>place-scripts</code></h4>
<p>假如<code>Step</code>使用的是<code>script</code>配置（与command+args相对），这个容器会将脚本代码（<code>script</code>字段的内容）持久化到<code>/tekton/scripts</code>目录中。</p>
<p>注：所有的脚本会自动加上<code>#!/bin/sh\nset -xe\n</code>，所以<code>script</code>字段里就不必写了。</p>
<h4 id="place-tools"><code>place-tools</code></h4>
<p>将<code>entrypoint</code>的二进制文件，复制到<code>/tekton/tools/entrypoint</code>.</p>
<h3 id="taskstep间的数据传递">Task/Step间的数据传递</h3>
<p>针对不同的数据，有多种不同的选择。比如<code>Workspace</code>、<code>Result</code>、<code>PipelineResource</code>。对于由于<code>Task</code>的执行是通过<code>Pod</code>来完成的，而<code>Pod</code>会调度到不同的节点上。因此<code>Task</code>间的数据传递，需要用到持久化的卷。</p>
<p>而<code>Step</code>作为<code>Pod</code>中的容器来运行，</p>
<h4 id="workspace">Workspace</h4>
<p>工作区，可以理解为一个挂在到容器上的卷，用于文件的传递。</p>
<h5 id="persistentvolumeclaim"><code>persistentVolumeClaim</code></h5>
<p>引用已存在<code>persistentVolumeClaim</code>卷（volume）。这种工作空间，可多次使用，需要先进行创建。比如 Java 项目的 <code>maven</code>，编译需要本地依赖库，这样可以节省每次编译都要下载依赖包的成本。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">workspaces</span>:
- <span style="color:#66d9ef">name</span>: m2
  <span style="color:#66d9ef">persistentVolumeClaim</span>:
    <span style="color:#66d9ef">claimName</span>: m2-pv-claim
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: v1
<span style="color:#66d9ef">kind</span>: PersistentVolume
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: m2-pv
  <span style="color:#66d9ef">labels</span>:
    <span style="color:#66d9ef">type</span>: local
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">storageClassName</span>: manual
  <span style="color:#66d9ef">capacity</span>:
    <span style="color:#66d9ef">storage</span>: 10Gi
  <span style="color:#66d9ef">accessModes</span>:
    - ReadWriteMany
  <span style="color:#66d9ef">hostPath</span>:
    <span style="color:#66d9ef">path</span>: <span style="color:#e6db74">&#34;/data/.m2&#34;</span>
---
<span style="color:#66d9ef">apiVersion</span>: v1
<span style="color:#66d9ef">kind</span>: PersistentVolumeClaim
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: m2-pv-claim
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">storageClassName</span>: manual
  <span style="color:#75715e"># volumeName: m2-pv</span>
  <span style="color:#66d9ef">accessModes</span>:
    - ReadWriteMany
  <span style="color:#66d9ef">resources</span>:
    <span style="color:#66d9ef">requests</span>:
      <span style="color:#66d9ef">storage</span>: 10Gi
</code></pre></div><h5 id="volumeclaimtemplate"><code>volumeClaimTemplate</code></h5>
<p>为每个<code>PipelineRun</code>或者<code>TaskRun</code>创建<code>PersistentVolumeClaim</code>卷（volume）的模板。比如一次构建需要从 git 仓库克隆代码，而针对不同的流水线代码仓库是不同的。这里就会用到<code>volumeClaimTemplate</code>，为每次构建创建一个<code>PersistentVolumeClaim</code>卷。（从0.12.0开始）</p>
<p>生命周期同<code>PipelineRun</code>或者<code>TaskRun</code>，运行之后释放。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">workspaces</span>:
- <span style="color:#66d9ef">name</span>: git-source
  <span style="color:#66d9ef">volumeClaimTemplate</span>:
    <span style="color:#66d9ef">spec</span>:
      <span style="color:#66d9ef">accessModes</span>:
      - ReadWriteMany
      <span style="color:#66d9ef">resources</span>:
        <span style="color:#66d9ef">requests</span>:
          <span style="color:#66d9ef">storage</span>: 1Gi
</code></pre></div><p>相较于<code>persistantVolumeClain</code>类型的workspace，<code>volumeClaimTemplate</code>不需要在每次在<code>PipelineRun</code>完成后清理工作区；并发情况下可能会出现问题。</p>
<h5 id="emptydir"><code>emptyDir</code></h5>
<p>引用<code>emptyDir</code>卷，跟随<code>Task</code>生命周期的临时目录。适合在<code>Task</code>的<code>Step</code>间共享数据，无法在多个<code>Task</code>间共享。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">workspaces</span>:
- <span style="color:#66d9ef">name</span>: temp
  <span style="color:#66d9ef">emptyDir</span>: {}
</code></pre></div><h5 id="configmap"><code>configMap</code></h5>
<p>引用一个<code>configMap</code>卷，将<code>configMap</code>卷作为工作区，有如下限制：</p>
<ul>
<li>挂载的卷是<code>只读</code>的</li>
<li>需要提前创建<code>configMap</code></li>
<li><code>configMap</code>的<a href="https://github.com/kubernetes/kubernetes/blob/f16bfb069a22241a5501f6fe530f5d4e2a82cf0e/pkg/apis/core/validation/validation.go#L5042">大小限制为1MB（Kubernetes的限制）</a></li>
</ul>
<p>使用场景，比如使用<code>maven</code>编译Java项目，配置文件<code>settings.xml</code>可以使用<code>configMap</code>作为工作区</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">workspaces</span>:
- <span style="color:#66d9ef">name</span>: maven-settings
  <span style="color:#66d9ef">configmap</span>:
    <span style="color:#66d9ef">name</span>: maven-settings
</code></pre></div><h5 id="secret"><code>secret</code></h5>
<p>用于引用<code>secret</code>卷，同<code>configMap</code>工作区一样，也有限制：</p>
<ul>
<li>挂载的卷是<code>只读</code>的</li>
<li>需要提前创建<code>secret</code></li>
<li><code>secret</code>的<a href="https://github.com/kubernetes/kubernetes/blob/f16bfb069a22241a5501f6fe530f5d4e2a82cf0e/pkg/apis/core/validation/validation.go#L5042">大小限制为1MB（Kubernetes的限制）</a></li>
</ul>
<h4 id="results"><code>results</code></h4>
<p><code>results</code>字段可以用来配置多个文件用来存储<code>Tasks</code>的执行结果，这些文件保存在<code>/tekton/results</code>目录中。</p>
<p>在<code>Pipeline</code>中，可以通过<code>tasks.[task-nanme].results.[result-name]</code>注入到其他<code>Task</code>的参数中。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: tekton.dev/v1beta1
<span style="color:#66d9ef">kind</span>: Task
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: print-date
  <span style="color:#66d9ef">annotations</span>:
    <span style="color:#66d9ef">description</span>: <span style="color:#e6db74">|
</span><span style="color:#e6db74">      A simple task that prints the date</span>
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">results</span>:
    - <span style="color:#66d9ef">name</span>: current-date-unix-timestamp
      <span style="color:#66d9ef">description</span>: The current date in unix timestamp format
    - <span style="color:#66d9ef">name</span>: current-date-human-readable
      <span style="color:#66d9ef">description</span>: The current date in human readable format
  <span style="color:#66d9ef">steps</span>:
    - <span style="color:#66d9ef">name</span>: print-date-unix-timestamp
      <span style="color:#66d9ef">image</span>: bash:latest
      <span style="color:#66d9ef">script</span>: <span style="color:#e6db74">|
</span><span style="color:#e6db74">        #!/usr/bin/env bash</span>
        date +%s | tee $(results.current-date-unix-timestamp.path)
    - <span style="color:#66d9ef">name</span>: print-date-humman-readable
      <span style="color:#66d9ef">image</span>: bash:latest
      <span style="color:#66d9ef">script</span>: <span style="color:#e6db74">|
</span><span style="color:#e6db74">        #!/usr/bin/env bash</span>
        date | tee $(results.current-date-human-readable.path)
---
<span style="color:#66d9ef">apiVersion</span>: tekton.dev/v1beta1
<span style="color:#66d9ef">kind</span>: PipelineRun
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: pass-date
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">pipelineSpec</span>:
    <span style="color:#66d9ef">tasks</span>:
      - <span style="color:#66d9ef">name</span>: print-date
        <span style="color:#66d9ef">taskRef</span>:
          <span style="color:#66d9ef">name</span>: print-date
      - <span style="color:#66d9ef">name</span>: read-date
        <span style="color:#66d9ef">runAfter</span>: <span style="color:#75715e">#配置执行顺序</span>
          - print-date
        <span style="color:#66d9ef">taskSpec</span>:
          <span style="color:#66d9ef">params</span>:
            - <span style="color:#66d9ef">name</span>: current-date-unix-timestamp
              <span style="color:#66d9ef">type</span>: string
            - <span style="color:#66d9ef">name</span>: current-date-human-readable
              <span style="color:#66d9ef">type</span>: string
          <span style="color:#66d9ef">steps</span>:
            - <span style="color:#66d9ef">name</span>: read
              <span style="color:#66d9ef">image</span>: busybox
              <span style="color:#66d9ef">script</span>: <span style="color:#e6db74">|
</span><span style="color:#e6db74">                echo $(params.current-date-unix-timestamp)</span>
                echo $(params.current-date-human-readable)
        <span style="color:#66d9ef">params</span>:
          - <span style="color:#66d9ef">name</span>: current-date-unix-timestamp
            <span style="color:#66d9ef">value</span>: $(tasks.print-date.results.current-date-unix-timestamp) <span style="color:#75715e"># 注入参数</span>
          - <span style="color:#66d9ef">name</span>: current-date-human-readable
            <span style="color:#66d9ef">value</span>: $(tasks.print-date.results.current-date-human-readable) <span style="color:#75715e"># 注入参数      </span>
</code></pre></div><p>执行结果：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">┌──────Logs<span style="color:#f92672">(</span>tekton-pipelines/pass-date-read-date-rhlf2-pod-9b2sk<span style="color:#f92672">)[</span>all<span style="color:#f92672">]</span> ──────────                                                                       │
│ place-scripts stream closed                                                                                                                                                                                                                                                             ││ step-read <span style="color:#ae81ff">1590242170</span>                                                                                                                                                                                                                                                                    │
│ step-read Sat May <span style="color:#ae81ff">23</span> 13:56:10 UTC <span style="color:#ae81ff">2020</span>                                                                                                                                                                                                                                                  ││ step-read + echo <span style="color:#ae81ff">1590242170</span>                                                                                                                                                                                                                                                             │
│ step-read + echo Sat May <span style="color:#ae81ff">23</span> 13:56:10 UTC <span style="color:#ae81ff">2020</span>                                                                                                                                                                                                                                           │
│ place-tools stream closed                                                                                                                                                                                                                                                               │
│ step-read stream closed                                                                                                                                                                                                                                                                 │
│
</code></pre></div><h4 id="pipelineresource">PipelineResource</h4>
<p><code>PipelineResource</code>在最后提，因为目前只是<code>alpha</code>版本，何时会进入<code>beta</code>或者弃用目前还是未知数。有兴趣的可以看下这里：<a href="https://tekton.dev/docs/pipelines/resources/#why-aren-t-pipelineresources-in-beta">Why Aren’t PipelineResources in Beta?</a></p>
<p>简单来说，<code>PipelineResource</code>可以通过其他的方式实现，而其本身也存在弊端：比如实现不透明，debug有难度；功能不够强；降低了Task的重用性等。</p>
<p>比如<code>git</code>类型的<code>PipelineResource</code>，可以通过<code>workspace</code>和<code>git-clone</code> Task来实现；存储类型的，也可以通过<code>workspace</code>来实现。</p>
<p>这也就是为什么<a href="#Workspace">上面介绍workspace的篇幅</a>比较大。个人也偏向于使用<code>workspace</code>，灵活度高；使用workspace的Task重用性强。</p>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://atbug.com/tekton-trigger-practice">云原生 CICD: Tekton Pipeline 实战</a></li>
<li><a href="https://atbug.com/control-process-order-of-pod-containers">控制 Pod 内容器的启动顺序</a></li>
<li><a href="https://knative.dev/docs/eventing/samples/writing-receive-adapter-source/03-controller">Knative Controller</a></li>
<li><a href="https://tekton.dev/docs/pipelines/resources/#why-aren-t-pipelineresources-in-beta">Why Aren’t PipelineResources in Beta?</a></li>
</ul>

        </div>
        <!-- tags -->
        <div class="mb-3">
          <h5 class="d-inline-block mr-3">Tags:</h5>
          <ul class="list-inline d-inline-block">
            <a>
            <li class="list-inline-item"><a class="text-color" href="/tags/tekton"> 
            Tekton</a>
            <a>
            <li class="list-inline-item"><a class="text-color" href="/tags/cicd"> , 
            CICD</a>
            
          </ul>
        </div>
        <!-- previous -->
        <div class="mb-3 link-article">
  <div class="pre-article">
    
    <div><i class="fa fa-arrow-left"></i> 上一篇</div>
    <a href="https://cloudnative.to/blog/k8s-certificate/">一文带你彻底厘清 Kubernetes 中的证书工作机制</a>
    
  </div>
  <div class="next-article">
    
    <div>下一篇 <i class="fa fa-arrow-right"></i></div>
    <a href="https://cloudnative.to/blog/istio-certificate/">一文带你彻底厘清 Isito 中的证书工作机制</a>
  
  </div>
</div>


        <!-- previous -->

        <!-- recommend -->
        


        <!-- comments -->

        
        <div id="gitalk-container"></div>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
        <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
        <script>
          window.onload = function() {
              const gitalk = new Gitalk({
              clientID: '0f001988910adcfadfb7',
              clientSecret: '14f7d06ee5e6575c295d18fc11616e8cb60fb84e',
              repo: 'cloudnativeto.github.io',
              owner: 'cloudnativeto',
              admin: ['rootsongjc'],
              id: hex_md5(hex_md5(window.location.pathname + window.location.hash)), 
              distractionFreeMode: false 
            });
            (function() {
              if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
                document.getElementById('gitalk-container').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.';
                return;
              }
              gitalk.render('gitalk-container');
            })();
          }
        </script>
        
      </div>
      <!-- sidebar -->
<aside class="col-lg-4 order-1 order-lg-2">
  <!-- tags -->
  <div class="bg-white px-4 py-5 box-shadow mb-5 word-cloud">
    <h4 class="mb-4">标签</h4>
    
      
      
      
      
      
      
      
      
      
      
      
      <div id="tag-cloud" style="padding: 5px 15px">
      
        
          
          
          
          <a href="/tags/arm" style="font-size:1rem">arm</a>
        
      
        
          
          
          &middot;
          <a href="/tags/bpf" style="font-size:1.1rem">bpf</a>
        
      
        
          
          
          &middot;
          <a href="/tags/cicd" style="font-size:1.1rem">cicd</a>
        
      
        
          
          
          &middot;
          <a href="/tags/client-go" style="font-size:1.2rem">client-go</a>
        
      
        
          
          
          &middot;
          <a href="/tags/cloud-native" style="font-size:1.1rem">cloud-native</a>
        
      
        
          
          
          &middot;
          <a href="/tags/crossplane" style="font-size:1rem">crossplane</a>
        
      
        
          
          
          &middot;
          <a href="/tags/devops" style="font-size:1rem">devops</a>
        
      
        
          
          
          &middot;
          <a href="/tags/docker" style="font-size:1rem">docker</a>
        
      
        
          
          
          &middot;
          <a href="/tags/envoy" style="font-size:1.5rem">envoy</a>
        
      
        
          
          
          &middot;
          <a href="/tags/etcd" style="font-size:1rem">etcd</a>
        
      
        
          
          
          &middot;
          <a href="/tags/flamegraph" style="font-size:1rem">flamegraph</a>
        
      
        
          
          
          &middot;
          <a href="/tags/gateway" style="font-size:1rem">gateway</a>
        
      
        
          
          
          &middot;
          <a href="/tags/helm" style="font-size:1rem">helm</a>
        
      
        
          
          
          &middot;
          <a href="/tags/informer" style="font-size:1.3rem">informer</a>
        
      
        
          
          
          &middot;
          <a href="/tags/iptables" style="font-size:1rem">iptables</a>
        
      
        
          
          
          &middot;
          <a href="/tags/ipvs" style="font-size:1rem">ipvs</a>
        
      
        
          
          
          &middot;
          <a href="/tags/istio" style="font-size:1.9rem">istio</a>
        
      
        
          
          
          &middot;
          <a href="/tags/kube-proxy" style="font-size:1rem">kube-proxy</a>
        
      
        
          
          
          &middot;
          <a href="/tags/kubebuilder" style="font-size:1rem">kubebuilder</a>
        
      
        
          
          
          &middot;
          <a href="/tags/kubernetes" style="font-size:1.5rem">kubernetes</a>
        
      
        
          
          
          &middot;
          <a href="/tags/kylin" style="font-size:1rem">kylin</a>
        
      
        
          
          
          &middot;
          <a href="/tags/linux%e5%86%85%e6%a0%b8" style="font-size:1rem">linux内核</a>
        
      
        
          
          
          &middot;
          <a href="/tags/microservices" style="font-size:1.1rem">microservices</a>
        
      
        
          
          
          &middot;
          <a href="/tags/mosn" style="font-size:1rem">mosn</a>
        
      
        
          
          
          &middot;
          <a href="/tags/netfilter" style="font-size:1rem">netfilter</a>
        
      
        
          
          
          &middot;
          <a href="/tags/oam" style="font-size:1.1rem">oam</a>
        
      
        
          
          
          &middot;
          <a href="/tags/operator" style="font-size:1rem">operator</a>
        
      
        
          
          
          &middot;
          <a href="/tags/profile" style="font-size:1rem">profile</a>
        
      
        
          
          
          &middot;
          <a href="/tags/redis" style="font-size:1rem">redis</a>
        
      
        
          
          
          &middot;
          <a href="/tags/security" style="font-size:1.1rem">security</a>
        
      
        
          
          
          &middot;
          <a href="/tags/service-mesh" style="font-size:1.9rem">service-mesh</a>
        
      
        
          
          
          &middot;
          <a href="/tags/spring-cloud" style="font-size:1rem">spring-cloud</a>
        
      
        
          
          
          &middot;
          <a href="/tags/tcpdump" style="font-size:1rem">tcpdump</a>
        
      
        
          
          
          &middot;
          <a href="/tags/tekton" style="font-size:1rem">tekton</a>
        
      
        
          
          
          &middot;
          <a href="/tags/vxlan" style="font-size:1.1rem">vxlan</a>
        
      
        
          
          
          &middot;
          <a href="/tags/wasm" style="font-size:1rem">wasm</a>
        
      
        
          
          
          &middot;
          <a href="/tags/wireshark" style="font-size:1rem">wireshark</a>
        
      
        
          
          
          &middot;
          <a href="/tags/zero-trust-cybersecurity" style="font-size:1rem">zero-trust-cybersecurity</a>
        
      
        
          
          
          &middot;
          <a href="/tags/zookeeper" style="font-size:1rem">zookeeper</a>
        
      
        
          
          
          &middot;
          <a href="/tags/%e4%ba%91%e5%8e%9f%e7%94%9f" style="font-size:1rem">云原生</a>
        
      
        
          
          
          &middot;
          <a href="/tags/%e4%ba%91%e5%8e%9f%e7%94%9f%e5%ad%a6%e9%99%a2" style="font-size:1.1rem">云原生学院</a>
        
      
        
          
          
          &middot;
          <a href="/tags/%e5%ad%a6%e4%b9%a0%e5%b0%8f%e7%bb%84" style="font-size:1rem">学习小组</a>
        
      
        
          
          
          &middot;
          <a href="/tags/%e5%bc%80%e6%ba%90" style="font-size:1rem">开源</a>
        
      
        
          
          
          &middot;
          <a href="/tags/%e5%bc%80%e6%ba%90%e7%a4%be%e5%8c%ba" style="font-size:1rem">开源社区</a>
        
      
        
          
          
          &middot;
          <a href="/tags/%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90" style="font-size:1rem">源码分析</a>
        
      
        
          
          
          &middot;
          <a href="/tags/%e6%ba%90%e7%a0%81%e7%90%86%e8%a7%a3" style="font-size:1.1rem">源码理解</a>
        
      
        
          
          
          &middot;
          <a href="/tags/%e7%a4%be%e5%8c%ba" style="font-size:1.1rem">社区</a>
        
      
        
          
          
          &middot;
          <a href="/tags/%e7%bf%bb%e8%af%91" style="font-size:1.2rem">翻译</a>
        
      
      </div>
    
  </div>

  <!-- profile -->
  <div class="bg-pink px-4 py-5 box-shadow mb-5 avatar-content">
    <div class="avatar">
      <p class="avatar-name">
        <strong class="text-dark "><a href="https://atbug.com">张晓辉</a></strong> 
      </p>
      <p>资深码农，12 年软件开发经验。曾在汇丰软件、唯品会、数人云等公司任职。目前就职小鹏汽车，在基础架构团队从事技术中台的研发。</p>
    </div>
  </div>
  <!-- toc -->
  
  <div class="bg-white px-4 py-5 box-shadow mb-5 sticky-top">
    <h4 class="mb-4">目录</h4>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#pipeline-crd-与核心资源的关系">Pipeline CRD 与核心资源的关系</a></li>
    <li><a href="#工作原理">工作原理</a>
      <ul>
        <li><a href="#task的执行顺序">Task的执行顺序</a></li>
        <li><a href="#step的执行顺序">Step的执行顺序</a></li>
        <li><a href="#自动运行的容器">自动运行的容器</a></li>
        <li><a href="#taskstep间的数据传递">Task/Step间的数据传递</a></li>
      </ul>
    </li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>
  </div>

</aside>
<!-- /sidebar -->

    </div>
  </div>
</section>
<!-- /blog details -->



<footer>
  
  <div class="section bg-secondary">
    <div class="container">
      <div class="row justify-content-between">
        
        <div class="col-lg-5 mb-5 mb-lg-0">
          
          <a class="mb-4 d-inline-block" href="/"><img class="img-fluid"
              src="/images/logo-alt.png" alt="云原生社区" width="60%"></a>
          <p class="text-light mb-5">云原生社区是一个中立的云原生终端用户社区，由 CNCF 大使、开源意见领袖共同发起成立于 2020 年 5 月 12 日，旨在推广云原生技术，构建开发者生态。</p>
          <h4 class="text-white mb-4">关注我们</h4>
          
          <ul class="list-inline social-icon-alt">
            
            <li class="list-inline-item">
              <a class="hover-ripple" href="https://twitter.com/cloudnativecn"><i class="fa fa-twitter"></i></a>
            </li>
            
            <li class="list-inline-item">
              <a class="hover-ripple" href="https://github.com/cloudnativeto"><i class="fa fa-github"></i></a>
            </li>
            
            <li class="list-inline-item">
              <a class="hover-ripple" href="/contact"><i class="fa fa-wechat"></i></a>
            </li>
            
            <li class="list-inline-item">
              <a class="hover-ripple" href="mailto:contact@cloudnative.to"><i class="fa fa-envelope"></i></a>
            </li>
            
            <li class="list-inline-item">
              <a class="hover-ripple" href="https://cloudnative.to/blog/index.xml"><i class="fa fa-rss"></i></a>
            </li>
            
          </ul>
        </div>
        <div class="col-lg-5 mb-5 mb-lg-0">
            
            
            
            
            
            <div class="mb-5 address">
              <h4 class="text-white mb-4">联系信息</h4>
              <p class="text-light mb-3"><a href="/city/beijing">北京</a>|<a href="/city/shanghai">上海</a>|<a href="https://github.com/cloudnativeto/community/issues/58">成都</a>|<a href="https://github.com/cloudnativeto/community/issues/60">深圳</a>|<a href="https://github.com/cloudnativeto/community/issues/53">杭州</a>|<a href="https://github.com/cloudnativeto/community/issues/59">广州</a>|<a href="https://github.com/cloudnativeto/community/issues/55">武汉</a>|<a href="/city/nanjing">南京</a>|<a href="https://github.com/cloudnativeto/community/issues/61">西安</a>|<a href="/city/dalian">大连</a>|<a href="https://github.com/cloudnativeto/community/issues/52">长沙</a>|<a href="https://github.com/cloudnativeto/community/issues/66">苏州</a>|<a href="https://github.com/cloudnativeto/community/issues/67">珠海</a>|<a href="https://github.com/cloudnativeto/community/issues/78">重庆</a>|<a href="https://github.com/cloudnativeto/community/issues/82">济南</a>|<a href="https://github.com/cloudnativeto/community/issues/83">厦门</a>|<a href="https://github.com/cloudnativeto/community/issues/86">无锡</a>|<a href="https://github.com/cloudnativeto/community/issues/91">青岛</a>|<a href="https://github.com/cloudnativeto/community/issues/103">郑州</a>|<a href="https://github.com/cloudnativeto/community/issues/107">合肥</a></p>
              <p class="text-light mb-3"></p>
              <p class="text-light mb-3">关注云原生社区微信公众号，加入社区并获取最新资讯。</p>
              <p class="text-light mb-3"><img src="/images/wechat-qrcode.png" width="128px"></p>
            </div>
            
            
        </div>
      </div>
    </div>
  </div>
  
  <div class="bg-secondary-darken py-4">
    <div class="container">
      <div class="row">
        <div class="col-md-6 text-center text-md-left mb-3 mb-md-0">
          <p class="mb-0 text-white">Copyright © 2020 云原生社区</p>
        </div>
        <div class="col-md-6 text-center text-md-right">
          <ul class="list-inline">
            
            <li class="list-inline-item mx-0"><a class="d-inline-block px-3 text-white" href="/code-of-conduct"
                class="text-white">声明与政策</a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>



<script>
  var indexURL = "/index.json"
</script>


<!-- JS Plugins -->

<script src="/plugins/jQuery/jquery.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/google-map/gmap.js"></script>

<script src="/plugins/venobox/venobox.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/search/search.js"></script>

<script src="/plugins/bigPicture/bigPicture.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>


<!-- Main Script -->

<script src="/js/script.min.js"></script>

<!-- Algolia -->
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.js"></script>
<script>
  docsearch({
    apiKey: '870a8addaf7a712ecc6e33ce9def93b1',
    indexName: 'DocSearch',
    appId: '2506Q6I4IV',
    inputSelector: '#js-algolia-btn',
    debug: false,
  });
</script>

<!-- google analitycs -->

<script>
  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
  ga('create', 'UA-93485976-4', 'auto');
  ga('send', 'pageview');
</script>

</body>

</html>
