<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
  

  

  
  
  
    
  
  <meta name="description" content="本文展示了如果通过 Backyards 创建熔断。" />

  
  <link rel="alternate" hreflang="zh" href="https://cloudnative.to/blog/istio-circuit-breaking/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.bc98885a539954f06689d89e2fa6d13e.css" />

  



  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f3dc895ea3bd6186cd835841d365c103";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu12a4295615259de83f102fd096a49a31_6281_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu12a4295615259de83f102fd096a49a31_6281_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://cloudnative.to/blog/istio-circuit-breaking/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@CloudNativeCN" />
    <meta property="twitter:creator" content="@CloudNativeCN" />
  
  <meta property="og:site_name" content="云原生社区（中国）" />
  <meta property="og:url" content="https://cloudnative.to/blog/istio-circuit-breaking/" />
  <meta property="og:title" content="Istio 熔断器解析 | 云原生社区（中国）" />
  <meta property="og:description" content="本文展示了如果通过 Backyards 创建熔断。" /><meta property="og:image" content="https://cloudnative.to/media/sharing.png" />
    <meta property="twitter:image" content="https://cloudnative.to/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
      <meta
        property="article:published_time"
        content="2019-09-24T18:00:00&#43;08:00"
      />
    
    <meta property="article:modified_time" content="2023-11-30T15:12:23&#43;08:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cloudnative.to/blog/istio-circuit-breaking/"
  },
  "headline": "Istio 熔断器解析",
  
  "datePublished": "2019-09-24T18:00:00+08:00",
  "dateModified": "2023-11-30T15:12:23+08:00",
  
  "author": {
    "@type": "Person",
    "name": "Laszlo Bence Nagy"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "云原生社区（中国）",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cloudnative.to/media/logo.svg"
    }
  },
  "description": "本文展示了如果通过 Backyards 创建熔断。"
}
</script>

  

  

  

  





  <title>Istio 熔断器解析 | 云原生社区（中国）</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="7bf28314b3d5d5ae1b42a769e7ac9ce9" >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.62d6f8dfe8493f1c68557dde65bec362.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="关闭"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="搜索..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="搜索...">
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生社区（中国）"
            
            ></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生社区（中国）"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/community"><span>社区</span></a>
          </li>

          
          

          

          
          
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link  active" href="/blog"><span>博客</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>资料</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/envoy/"><span>Envoy 中文文档</span></a>
              
                <a class="dropdown-item" href="/kubebuilder/"><span>Kubebuilder 中文文档</span></a>
              
                <a class="dropdown-item" href="https://lib.jimmysong.io/"><span>云原生资料库</span></a>
              
                <a class="dropdown-item" href="https://istio.io/latest/zh/"><span>Istio 中文文档</span></a>
              
            </div>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/event"><span>活动</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#feed"><span>更新</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#tags"><span>标签</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>关于</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        

        
        <li class="nav-item">
            <a class="nav-link" href="/community/join/" data-toggle="tooltip" data-placement="bottom" title="加入社区" aria-label="主站"><i class="fa-brands fa-weixin" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link js-search" href="#" data-toggle="tooltip" data-placement="bottom" title="搜索" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item d-none d-lg-inline-flex">
            <a class="nav-link" href="https://github.com/cloudnativeto/cloudnative.to" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="查看源码" aria-label="查看源码" aria-label="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item">
          <a href="#" class="nav-link set-theme">
            <i class="fa fa-sun" aria-hidden="true" id="theme-icon"></i>
          </a>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <div class="container-xl">
    <div class="post-container">
        












  

  
  
  
<div class="article-container pt-3">
  <h1>Istio 熔断器解析</h1>

  

  
    


<div class="article-metadata">

  <div>
  
  
  
  
    <i class="fa-solid fa-feather"></i>
    

  <span >
      <a href="/author/laszlo-bence-nagy/">Laszlo Bence Nagy</a></span>
    
    <span class="middot-divider"></span>
    
  
  
  
  
  
  
    <i class="fa fa-language"></i>
    

  <span >
      <a href="/translators/%E9%A9%AC%E8%8B%A5%E9%A3%9E/">马若飞</a></span>
    <span class="middot-divider"></span>
  
  
  
  
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/category/service-mesh/" class="text-capitalize">service mesh</a></span>
  
  </div>

  
  <span class="article-date">
    
    
      
          
          发布于
      
    
    2019-09-24
  </span>
  

  

  
  <span class="middot-divider"></span>
  字数 4742
  <span class="middot-divider"></span>
  <span class="article-reading-time">
      阅读时长 22 分钟
  </span>
  

  
  
  
  

</div>

    





  
</div>


    </div>
    <div class="border-bottom mb-2"></div>
    <div class="row flex-xl-nowrap">
        <div class="col-3 d-none d-xl-block docs-toc">
            <!-- toc -->
            
<div class="">
    <ul class="nav toc-top">
        <li>
            <a href="#" id="back_to_top" class="docs-toc-title">目录</a>
        </li>
    </ul>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#编者按">编者按</a></li>
    <li><a href="#前言">前言</a></li>
    <li><a href="#熔断失败是一个选项">熔断：失败是一个选项</a></li>
    <li><a href="#istiohttpsistioio中的熔断"><a href="https://istio.io/">Istio</a>中的熔断</a>
      <ul>
        <li><a href="#监控">监控</a></li>
      </ul>
    </li>
    <li><a href="#backyardshttpsbanzaicloudcomblogistio-the-easy-way的熔断更简单"><a href="https://banzaicloud.com/blog/istio-the-easy-way/">Backyards</a>的熔断更简单</a></li>
    <li><a href="#熔断实战">熔断实战</a>
      <ul>
        <li><a href="#创建一个集群">创建一个集群</a></li>
        <li><a href="#安装-backyards">安装 BACKYARDS</a></li>
        <li><a href="#使用-backyards-ui-创建熔断">使用 BACKYARDS UI 创建熔断</a></li>
        <li><a href="#使用backyards-clihttpsgithubcombanzaicloudbackyards-cli创建熔断">使用<a href="https://github.com/banzaicloud/backyards-cli">BACKYARDS-CLI</a>创建熔断</a></li>
        <li><a href="#使用-backyards-graphql-api-创建熔断">使用 BACKYARDS GRAPHQL API 创建熔断</a></li>
        <li><a href="#清理">清理</a></li>
      </ul>
    </li>
    <li><a href="#总结">总结</a></li>
  </ul>
</nav>
</div>

            <!-- /toc -->
            
            <div class="subscribe-module col-12 mt-1">
    <img src="/img/wechat.jpg" alt="image" title="云原生社区的微信公众号"/>
    <p class="text-center pt-1">关注「云原生社区动态」微信公众号，获取本站更新</p>
</div>

            
        </div>
        <main class="article-body col-9 container docs-content" role="main">
            <article class="article">
                <div class="article-style">
                    
                    <details class="toc-inpage d-print-none d-show-block mb-0">
  <summary class="font-weight-bold">点击查看目录</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#编者按">编者按</a></li>
    <li><a href="#前言">前言</a></li>
    <li><a href="#熔断失败是一个选项">熔断：失败是一个选项</a></li>
    <li><a href="#istiohttpsistioio中的熔断"><a href="https://istio.io/">Istio</a>中的熔断</a>
      <ul>
        <li><a href="#监控">监控</a></li>
      </ul>
    </li>
    <li><a href="#backyardshttpsbanzaicloudcomblogistio-the-easy-way的熔断更简单"><a href="https://banzaicloud.com/blog/istio-the-easy-way/">Backyards</a>的熔断更简单</a></li>
    <li><a href="#熔断实战">熔断实战</a>
      <ul>
        <li><a href="#创建一个集群">创建一个集群</a></li>
        <li><a href="#安装-backyards">安装 BACKYARDS</a></li>
        <li><a href="#使用-backyards-ui-创建熔断">使用 BACKYARDS UI 创建熔断</a></li>
        <li><a href="#使用backyards-clihttpsgithubcombanzaicloudbackyards-cli创建熔断">使用<a href="https://github.com/banzaicloud/backyards-cli">BACKYARDS-CLI</a>创建熔断</a></li>
        <li><a href="#使用-backyards-graphql-api-创建熔断">使用 BACKYARDS GRAPHQL API 创建熔断</a></li>
        <li><a href="#清理">清理</a></li>
      </ul>
    </li>
    <li><a href="#总结">总结</a></li>
  </ul>
</nav>
</details>

                    
                    <p>本文为翻译文章，<a href="https://banzaicloud.com/blog/istio-circuit-breaking/" target="_blank" rel="noopener">点击查看原文</a>。</p>
<h2 id="编者按">编者按</h2>
<p>作者简要介绍了熔断的概念，然后以实战演练的方式分别演示了如何通过 Backyards UI、CLI 等方式创建并设置熔断功能。注：Backyards 是 Banzai Cloud 开发的一款基于 Istio 的服务网格产品，本文是该产品功能介绍系列中的一篇。</p>
<h2 id="前言">前言</h2>
<p>Istio 因灵活的可观察性和安全的服务间通信受到了赞许。然而，其他更重要的功能才真正使得 Istio 成为了服务网格里的瑞士军刀，当遇到运行时长、延迟和错误率等 SLO 问题时，服务间的流量管理能力是至关重要的。</p>
<p>在今年早些时候发布 <a href="https://github.com/banzaicloud/istio-operator" target="_blank" rel="noopener">Istio operator</a> 时，我们的目标（除了管理 Istio 的安装和升级）是为这些出色的流量路由特性提供支持，同时使所有的功能都更加易用。最后，我们创建了一个简单且自动化的服务网格<a href="https://banzaicloud.com/blog/istio-the-easy-way/" target="_blank" rel="noopener">Backyards</a>，它在 Istio operator 之上提供了管理 UI、<a href="https://github.com/banzaicloud/backyards-cli" target="_blank" rel="noopener">CLI</a> 和 GraphQL API 的能力。Backyards 集成到了 Banzai Cloud 的容器管理平台 <a href="https://github.com/banzaicloud/pipeline" target="_blank" rel="noopener">Pipeline</a>中，也可以作为一个单一的产品独立工作。当然，将 Backyards 与 Pipeline 一起使用会为用户提供特别的好处（比如在<a href="https://banzaicloud.com/blog/istio-multicluster-the-easy-way/" target="_blank" rel="noopener">多云和混合云</a>环境中管理应用程序），Backyards 也可以被用于任何 Kubernetes 的安装环境。</p>
<blockquote>
<p>我们已经发布了一些 Backyards 相关特性的文章比如：</p>
<ul>
<li><a href="https://banzaicloud.com/blog/istio-canary/" target="_blank" rel="noopener">使用 Backyards 自动金丝雀部署</a></li>
<li><a href="https://banzaicloud.com/blog/istio-traffic-shifting/" target="_blank" rel="noopener">流量切换</a></li>
</ul>
</blockquote>
<h2 id="熔断失败是一个选项">熔断：失败是一个选项</h2>
<p>在微服务架构中，服务可能会用不同的语言实现并部署在多个节点或集群上，具有不同的响应时间或故障率。如果服务成功（并且及时地）响应了请求，那么它的性能就算是令人满意的。但现实情况并非如此，下游客户端应该在上游服务过于缓慢时受到保护。反之，上游服务也必须被保护，以免被积压的请求拖垮。在多客户端下情况会更加复杂，并可能导致整个基础设施出现一系列的连锁故障。这一问题的解决方案是采用经过时间检验的熔断器模式。</p>
<p>一个熔断器可以有三种状态：关闭、打开和半开，默认情况下处于关闭状态。在关闭状态下，无论请求成功或失败，到达预先设定的故障数量阈值前，都不会触发熔断。而当达到阈值时，熔断器就会打开。当调用处于打开状态的服务时，熔断器将断开请求，这意味着它会直接返回一个错误，而不去执行调用。通过在客户端断开下游请求的方式，可以在生产环境中防止级联故障的发生。在经过事先配置的超时时长后，熔断器进入半开状态，这种状态下故障服务有时间从其中断的行为中恢复。如果请求在这种状态下继续失败，则熔断器将再次打开并继续阻断请求。否则熔断器将关闭，服务将被允许再次处理请求。</p>
<p>















<figure  id="figure-circuit-breaking">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="Circuit Breaking" srcset="
               /blog/istio-circuit-breaking/circuit-breaking_hud803a977c077913bf059b32e6b921c73_70258_e53626c6f9e81880d1b331c435ca0b2f.webp 400w,
               /blog/istio-circuit-breaking/circuit-breaking_hud803a977c077913bf059b32e6b921c73_70258_8afd9155cdadaaed602963c3be3d2f1f.webp 760w,
               /blog/istio-circuit-breaking/circuit-breaking_hud803a977c077913bf059b32e6b921c73_70258_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/istio-circuit-breaking/circuit-breaking_hud803a977c077913bf059b32e6b921c73_70258_e53626c6f9e81880d1b331c435ca0b2f.webp"
               width="760"
               height="285"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Circuit Breaking
    </figcaption></figure>
</p>
<h2 id="istiohttpsistioio中的熔断"><a href="https://istio.io/" target="_blank" rel="noopener">Istio</a>中的熔断</h2>
<p>Istio 的 <a href="https://istio.io/docs/tasks/traffic-management/circuit-breaking/" target="_blank" rel="noopener">熔断</a> 可以在 <a href="https://istio.io/docs/reference/config/networking/v1alpha3/destination-rule/#TrafficPolicy" target="_blank" rel="noopener">流量策略</a> 中配置。Istio 的 <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/" target="_blank" rel="noopener">自定义资源</a><code>Destination Rule</code>里，<code>TrafficPolicy</code>字段下有两个和熔断相关的配置： <a href="https://istio.io/docs/reference/config/networking/v1alpha3/destination-rule/#ConnectionPoolSettings" target="_blank" rel="noopener">ConnectionPoolSettings</a> 和 <a href="https://istio.io/docs/reference/config/networking/v1alpha3/destination-rule/#OutlierDetection" target="_blank" rel="noopener">OutlierDetection</a>。</p>
<p><code>ConnectionPoolSettings</code>可以为服务配置连接的数量。<code>OutlierDetection</code>用来控制从负载均衡池中剔除不健康的实例。</p>
<p>例如，<code>ConnectionPoolSettings</code>控制请求的最大数量，挂起请求，重试或者超时；<code>OutlierDetection</code> 设置服务被从连接池剔除时发生错误的请求数，可以设置最小逐出时间和最大逐出百分比。有关完整的字段列表，请参考<a href="https://istio.io/docs/reference/config/networking/v1alpha3/destination-rule/#TrafficPolicy" target="_blank" rel="noopener">文档</a>.</p>
<blockquote>
<p>Istio 在底层使用了<a href="https://www.envoyproxy.io/learn/circuit-breaking" target="_blank" rel="noopener">Envoy 的熔断特性</a>。</p>
</blockquote>
<p>让我们来看看<code>Destination Rule</code>中有关熔断的配置：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.istio.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">DestinationRule</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">notifications</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">notifications</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">trafficPolicy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">connectionPool</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">tcp</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">maxConnections</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">http1MaxPendingRequests</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">maxRequestsPerConnection</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">outlierDetection</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">consecutiveErrors</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">1s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">baseEjectionTime</span><span class="p">:</span><span class="w"> </span><span class="l">3m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxEjectionPercent</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w">
</span></span></span></code></pre></div><p>使用<code>ConnectionPoolSettings</code>字段中的这些设置，在给定的时间内只能和<code>notifications</code> 服务建立一个连接：每个连接最多只能有一个挂起的请求。如果达到阈值，熔断器将开始阻断请求。</p>
<p><code>OutlierDetection</code>部分的设置用来检查每秒调用服务是否有错误发生。如果有，则将服务从负载均衡池中逐出至少三分钟（100% 最大弹出百分比表示，如果需要，所有的服务实例都可以同时被逐出）。</p>
<blockquote>
<p>在手动创建<code>Destination Rule</code>资源时有一件事需要特别注意，那就是是否为该服务启用了 mTLS。如果是的话，还需要在<code>Destination Rule</code>中设置如下字段，否则当调用<code>movies</code>服务时，调用方可能会收到 503 错误：</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">trafficPolicy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l">ISTIO_MUTUAL</span><span class="w">
</span></span></span></code></pre></div><blockquote>
<p>还可以为特定<a href="https://istio.io/docs/tasks/security/authn-policy/#namespace-wide-policy" target="_blank" rel="noopener">namespace</a> 或特定<a href="https://istio.io/docs/tasks/security/authn-policy/#service-specific-policy" target="_blank" rel="noopener">服务</a>启用<a href="https://istio.io/docs/tasks/security/authn-policy/#globally-enabling-istio-mutual-tls" target="_blank" rel="noopener">全局</a>的 mTLS。你应该了解这些设置以便确定是否把<code>trafficPolicy.tls.mode</code>设置为 <code>ISTIO_MUTUAL</code>。更重要的是，当你试图配置一个完全不同的功能（例如熔断）时，很容易忘记设置此字段。</p>
<p>提示：在创建<code>Destination Rule</code>前总是考虑 mTLS！</p>
</blockquote>
<p>为了触发熔断，让我们同时从两个连接来调用 <code>notifications</code>服务。<code>maxConnections</code>字段被设置为 1。这时应该会看到 503 与 200 的响应同时到达。</p>
<p>当一个服务从客户端接收到的负载大于它所能处理的负载（如熔断器中配置的那样），它会在调用之前返回 503 错误。这是防止错误级联的一种方法。</p>
<h3 id="监控">监控</h3>
<p>在生产环境中必须要监控你的服务，以便得到通知并能够在系统发生错误时进行检查。因此，如果你已经为你的服务配置了一个熔断器，你就会想知道它什么时候跳闸；熔断器拦截了百分之多少的请求；何时触发，来自哪个下游客户端？如果能够回答这些问题，你就可以确定熔断器是否工作正常，并根据需要微调配置，或者优化服务来处理额外的并发请求。</p>
<blockquote>
<p>提示：如果你继续阅读，可以在 Backyards UI 中看到和配置所有的这些设置。</p>
</blockquote>
<p>让我们看看怎样在 Istio 里确定熔断器跳闸：</p>
<p>熔断器跳闸时的响应码是 503，因此你无法仅根据该响应与其他的 503 错误区分开来。在 Envoy 中，有一个计数器叫<code>upstream_rq_pending_overflow</code>，它记录了熔断且失败的请求总数。如果为你的服务深入研究 Envoy 的统计数据就可以获得这些信息，但这并不容易。</p>
<p>除了响应代码，Envoy 还返回<a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log#config-access-log-format-response-flags" target="_blank" rel="noopener">响应标志</a> ，并且存在一个专用响应标志来表示熔断器跳闸：<strong>UO</strong>。如果这个标志只能通过 Envoy 的日志获得，这将不会特别有用。幸运的是，它在 Istio 中<a href="https://github.com/istio/istio/pull/9945" target="_blank" rel="noopener">实现</a>了，因此响应标志在 Istio 指标中是可用的并且能被 Prometheus 获取到。</p>
<p>熔断器的跳闸可以像这样查询到：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-basic" data-lang="basic"><span class="line"><span class="cl"><span class="vg">sum</span><span class="p">(</span><span class="vg">istio_requests_total</span><span class="p">{</span><span class="vg">response_code</span><span class="o">=</span><span class="s2">&#34;503&#34;</span><span class="p">,</span><span class="w"> </span><span class="vg">response_flags</span><span class="o">=</span><span class="s2">&#34;UO&#34;</span><span class="p">})</span><span class="w"> </span><span class="vg">by</span><span class="w"> </span><span class="p">(</span><span class="vg">source_workload</span><span class="p">,</span><span class="w"> </span><span class="vg">destination_workload</span><span class="p">,</span><span class="w"> </span><span class="vg">response_code</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="backyardshttpsbanzaicloudcomblogistio-the-easy-way的熔断更简单"><a href="https://banzaicloud.com/blog/istio-the-easy-way/" target="_blank" rel="noopener">Backyards</a>的熔断更简单</h2>
<p>使用 Backyards 时，你不需要手动编辑<code>Destination Rules</code>来设置熔断。可以通过一个方便的 UI 界面或者（如果你愿意的话）是<a href="https://github.com/banzaicloud/backyards-cli" target="_blank" rel="noopener">Backyards CLI</a> 命令行工具来达到相同的结果。</p>
<p>不必担心由于忘记把<code>trafficPolicy.tls.mode</code> 设置为 <code>ISTIO_MUTUAL</code>而配错了<code>Destination Rules</code>。Backyards 会为你解决这个问题；它会找到启用了 mTLS 的服务并相应地设置上述字段。</p>
<blockquote>
<p>上面只是 Backyards 验证特性的一个例子，这能避免你设置错误。后面还有更多的特性。</p>
</blockquote>
<p>在此之上，你可以看到服务和请求的可视化界面和活动仪表板，因此可以轻松地确定有多少请求被熔断器触发，以及它来自哪个调用者和何时触发。</p>
<h2 id="熔断实战">熔断实战</h2>
<h3 id="创建一个集群">创建一个集群</h3>
<p>首先，我们需要一个 Kubernetes 集群。</p>
<blockquote>
<p>我通过<a href="https://beta.banzaicloud.io/" target="_blank" rel="noopener">Pipeline platform</a>的免费开发版本在 GKE 上创建了一个 Kubernetes 集群。如果你也想这样做，可以在我们支持的五个云提供商或使用<a href="https://beta.banzaicloud.io/" target="_blank" rel="noopener">Pipeline</a>在本地创建集群。否则，你需要提供自己的 Kubernetes 集群。</p>
</blockquote>
<h3 id="安装-backyards">安装 BACKYARDS</h3>
<p>在一个新集群安装 Istio，Backyards 和 demo 应用的最简单的办法是使用<a href="https://github.com/banzaicloud/backyards-cli" target="_blank" rel="noopener">Backyards CLI</a>。</p>
<p>你只需要执行下面的命令（集群必须设置了<code>KUBECONFIG</code>）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ backyards install -a --run-demo
</span></span></code></pre></div><p>该命令首先使用我们开源的<a href="https://github.com/banzaicloud/istio-operator" target="_blank" rel="noopener">Istio operator</a>安装 Istio，然后安装 Backyards 和 demo 应用程序。安装完成后，Backyards UI 将自动打开并向 demo 应用发送一些流量。通过这个简单的命令，你可以看到 Backyards 在几分钟内启动了一个全新的 Istio 集群！试试吧！</p>
<blockquote>
<p>你也可以按顺序执行所有这些步骤。Backyards 需要一个 Istio 集群——如果没有，可以通过<code>$ backyards istio install</code>安装。一旦安装了 Istio，就可以使用<code>$ backyards install</code>安装 Backyards。最后，使用<code>$ backyards demoapp install</code>部署 demo 应用程序。</p>
<p>提示：Backyards 是<a href="https://github.com/banzaicloud/pipeline" target="_blank" rel="noopener">Pipeline</a>平台的核心组件——可以尝试<a href="https://beta.banzaicloud.io/" target="_blank" rel="noopener">开发者版本</a>（Service Mesh 标签页）。</p>
</blockquote>
<h3 id="使用-backyards-ui-创建熔断">使用 BACKYARDS UI 创建熔断</h3>
<h4 id="配置熔断器">配置熔断器</h4>
<p>你不需要手动创建或编辑<code>Destination Rule</code>，可以很容易的在 UI 界面中改变熔断的配置。让我们先创建一个 demo。</p>
<blockquote>
<p>正如你将看到的，Backyards（与 Kiali 相比）不仅是为可观察性构建的 web UI，而且是具有丰富功能的服务网格管理工具，支持单集群和多集群，并且具有强大的 CLI 和 GraphQL API。</p>
</blockquote>
<p>















<figure  id="figure-circuit-breaking-set">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="Circuit Breaking set" srcset="
               /blog/istio-circuit-breaking/circuit-breaking-set_hu91e94cff6e935b4d83275c30beaaeddf_115795_965ba6389137bf3d04bdb7b73261039c.webp 400w,
               /blog/istio-circuit-breaking/circuit-breaking-set_hu91e94cff6e935b4d83275c30beaaeddf_115795_495c76882788fb4f7160b76b7c583d94.webp 760w,
               /blog/istio-circuit-breaking/circuit-breaking-set_hu91e94cff6e935b4d83275c30beaaeddf_115795_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/istio-circuit-breaking/circuit-breaking-set_hu91e94cff6e935b4d83275c30beaaeddf_115795_965ba6389137bf3d04bdb7b73261039c.webp"
               width="760"
               height="475"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Circuit Breaking set
    </figcaption></figure>
</p>
<h4 id="查看熔断器设置">查看熔断器设置</h4>
<p>你不需要通过<code>Destination Rule</code>（例如通过 kubectl）来查看熔断器的配置，当你点击<code>notification</code> 服务图标并切换<code>SHOW CONFIGS</code>滑块时，可以在 Backyards UI 的右侧看到它们。</p>
<p>















<figure  id="figure-circuit-breaking-view">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="Circuit Breaking view" srcset="
               /blog/istio-circuit-breaking/circuit-breaking-view_hufe771b6633231f5b824753f3f9de1ae3_91571_579decf930601995b7c0d71674a91d19.webp 400w,
               /blog/istio-circuit-breaking/circuit-breaking-view_hufe771b6633231f5b824753f3f9de1ae3_91571_24e44ede71546cddf38d27885cfdd802.webp 760w,
               /blog/istio-circuit-breaking/circuit-breaking-view_hufe771b6633231f5b824753f3f9de1ae3_91571_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/istio-circuit-breaking/circuit-breaking-view_hufe771b6633231f5b824753f3f9de1ae3_91571_579decf930601995b7c0d71674a91d19.webp"
               width="760"
               height="475"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Circuit Breaking view
    </figcaption></figure>
</p>
<h4 id="监控熔断器">监控熔断器</h4>
<p>根据刚才的设置，当两个连接同时产生流量时，熔断器将发出跳闸请求。在 Backyards UI 中，你将看到图形的边缘出现了红色。如果单击该服务，你将了解有关错误的更多信息，并将看到两个专门用来显示熔断器跳闸的实时 Grafana 仪表板。</p>
<p>第一个仪表板展示了熔断器触发的总请求的百分比。当没有熔断器错误，而你的服务工作正常，这张图将显示<code>0%</code>。否则，你将能够立即看到有多少请求被熔断器触发。</p>
<p>第二个仪表板提供了由源熔断器引起的跳闸故障。如果没有发生跳闸，则此图中不会出现尖峰。否则，你将看到哪个服务导致了跳闸，何时跳闸，以及跳闸次数。可以通过此图来追踪恶意的客户端。</p>
<p>















<figure  id="figure-circuit-breaking-trip">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="Circuit Breaking trip" srcset="
               /blog/istio-circuit-breaking/circuit-breaking-trip_hub6485b4cdcd37f05e597bd446e62176d_100017_e8a46e7e394952ecaf17f72a3811e14e.webp 400w,
               /blog/istio-circuit-breaking/circuit-breaking-trip_hub6485b4cdcd37f05e597bd446e62176d_100017_4e90e4222b507208909eba7d8d0dfa6c.webp 760w,
               /blog/istio-circuit-breaking/circuit-breaking-trip_hub6485b4cdcd37f05e597bd446e62176d_100017_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/istio-circuit-breaking/circuit-breaking-trip_hub6485b4cdcd37f05e597bd446e62176d_100017_e8a46e7e394952ecaf17f72a3811e14e.webp"
               width="760"
               height="475"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Circuit Breaking trip
    </figcaption></figure>
</p>
<blockquote>
<p>这些是实时的 Grafana 仪表盘，用于显示熔断相关的信息。在默认情况下 Backyards 集成了 Grafana 和 Prometheus——还有更多的仪表板可以帮助你深入查看服务的指标。</p>
</blockquote>
<h4 id="移除熔断器配置">移除熔断器配置</h4>
<p>可以通过 <code>Remove</code> 按钮很容易的移除熔断配置。</p>
<h4 id="backyards-ui-的熔断实战">Backyards UI 的熔断实战</h4>
<p>这个<a href="https://www.youtube.com/embed/JH2xRv4a37M" target="_blank" rel="noopener">视频</a>总结了所有这些 UI 操作（译者注：视频来自 YouTube）</p>
<h3 id="使用backyards-clihttpsgithubcombanzaicloudbackyards-cli创建熔断">使用<a href="https://github.com/banzaicloud/backyards-cli" target="_blank" rel="noopener">BACKYARDS-CLI</a>创建熔断</h3>
<p>从经验来看，可以从 UI 界面做的事一定也可以通过 <a href="https://github.com/banzaicloud/backyards-cli" target="_blank" rel="noopener">Backyards CLI</a> 命令行工具完成。</p>
<h4 id="配置熔断">配置熔断</h4>
<p>让我们再做一次创建熔断的测试，这次通过 CLI 命令行。</p>
<p>可以以交互模式进行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ backyards r cb <span class="nb">set</span> backyards-demo/notifications
</span></span><span class="line"><span class="cl">? Maximum number of HTTP1/TCP connections <span class="m">1</span>
</span></span><span class="line"><span class="cl">? TCP connection timeout 3s
</span></span><span class="line"><span class="cl">? Maximum number of pending HTTP requests <span class="m">1</span>
</span></span><span class="line"><span class="cl">? Maximum number of requests <span class="m">1024</span>
</span></span><span class="line"><span class="cl">? Maximum number of requests per connection <span class="m">1</span>
</span></span><span class="line"><span class="cl">? Maximum number of retries <span class="m">1024</span>
</span></span><span class="line"><span class="cl">? Number of errors before a host is ejected <span class="m">1</span>
</span></span><span class="line"><span class="cl">? Time interval between ejection sweep analysis 1s
</span></span><span class="line"><span class="cl">? Minimum ejection duration 3m
</span></span><span class="line"><span class="cl">? Maximum ejection percentage <span class="m">100</span>
</span></span><span class="line"><span class="cl">INFO<span class="o">[</span>0043<span class="o">]</span> circuit breaker rules successfully applied to <span class="s1">&#39;backyards-demo/notifications&#39;</span>
</span></span><span class="line"><span class="cl">Connections  Timeout  Pending Requests  Requests  RPC  Retries  Errors  Interval  Ejection <span class="nb">time</span>  percentage
</span></span><span class="line"><span class="cl"><span class="m">1</span>            3s       <span class="m">1</span>                 <span class="m">1024</span>      <span class="m">1</span>    <span class="m">1024</span>     <span class="m">1</span>       1s        3m             <span class="m">100</span>
</span></span></code></pre></div><p>或者用非交互模式，指定要设置的值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ backyards r cb <span class="nb">set</span> backyards-demo/notifications --non-interactive --max-connections<span class="o">=</span><span class="m">1</span> --max-pending-requests<span class="o">=</span><span class="m">1</span> --max-requests-per-connection<span class="o">=</span><span class="m">1</span> --consecutiveErrors<span class="o">=</span><span class="m">1</span> --interval<span class="o">=</span>1s --baseEjectionTime<span class="o">=</span>3m --maxEjectionPercent<span class="o">=</span><span class="m">100</span>
</span></span><span class="line"><span class="cl">Connections  Timeout  Pending Requests  Requests  RPC  Retries  Errors  Interval  Ejection <span class="nb">time</span>  percentage
</span></span><span class="line"><span class="cl"><span class="m">1</span>            3s       <span class="m">1</span>                 <span class="m">1024</span>      <span class="m">1</span>    <span class="m">1024</span>     <span class="m">5</span>       1s        3m             <span class="m">100</span>
</span></span></code></pre></div><p>命令执行后，熔断配置会立刻获取到并显示出来。</p>
<h4 id="查看熔断设置">查看熔断设置</h4>
<p>你可以用下面的命令通过 namespace 来列出熔断的设置：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ backyards r cb get backyards-demo/notifications
</span></span><span class="line"><span class="cl">  Connections  Timeout  Pending Requests  Requests  RPC  Retries  Errors  Interval  Ejection <span class="nb">time</span>  percentage
</span></span><span class="line"><span class="cl">  <span class="m">1</span>            3s       <span class="m">1</span>                 <span class="m">1024</span>      <span class="m">1</span>    <span class="m">1024</span>     <span class="m">5</span>       1s        3m             <span class="m">100</span>
</span></span></code></pre></div><p>默认情况结果以表格的方式显示，也支持 JSON 或者 YMAL 格式：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ backyards r cb get backyards-demo/notifications -o json
</span></span><span class="line"><span class="cl">  <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;maxConnections&#34;</span>: 1,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;connectTimeout&#34;</span>: <span class="s2">&#34;3s&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;http1MaxPendingRequests&#34;</span>: 1,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;http2MaxRequests&#34;</span>: 1024,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;maxRequestsPerConnection&#34;</span>: 1,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;maxRetries&#34;</span>: 1024,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;consecutiveErrors&#34;</span>: 5,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;interval&#34;</span>: <span class="s2">&#34;1s&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;baseEjectionTime&#34;</span>: <span class="s2">&#34;3m&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;maxEjectionPercent&#34;</span>: <span class="m">100</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ backyards r cb get backyards-demo/notifications -o yaml
</span></span><span class="line"><span class="cl">  maxConnections: <span class="m">1</span>
</span></span><span class="line"><span class="cl">  connectTimeout: 3s
</span></span><span class="line"><span class="cl">  http1MaxPendingRequests: <span class="m">1</span>
</span></span><span class="line"><span class="cl">  http2MaxRequests: <span class="m">1024</span>
</span></span><span class="line"><span class="cl">  maxRequestsPerConnection: <span class="m">1</span>
</span></span><span class="line"><span class="cl">  maxRetries: <span class="m">1024</span>
</span></span><span class="line"><span class="cl">  consecutiveErrors: <span class="m">5</span>
</span></span><span class="line"><span class="cl">  interval: 1s
</span></span><span class="line"><span class="cl">  baseEjectionTime: 3m
</span></span><span class="line"><span class="cl">  maxEjectionPercent: <span class="m">100</span>
</span></span></code></pre></div><h4 id="监控熔断">监控熔断</h4>
<p>要从 CLI 中查看和前面 Grafana UI 界面类似的仪表板，可以通过从多个连接调用服务来触发跳闸，执行命令：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ backyards r cb graph backyards-demo/notifications
</span></span></code></pre></div><p>可以看到类似下面的结果：</p>
<p>















<figure  id="figure-circuit-breaking-trip-cli">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="Circuit Breaking trip cli" srcset="
               /blog/istio-circuit-breaking/circuit-breaking-trip-cli_hu829c4319b73f46f630f5e7756f8b9d4d_68340_20bbc38dd7e7303cab776319a604649e.webp 400w,
               /blog/istio-circuit-breaking/circuit-breaking-trip-cli_hu829c4319b73f46f630f5e7756f8b9d4d_68340_875d32211d7a72bc0197c268b0a22a85.webp 760w,
               /blog/istio-circuit-breaking/circuit-breaking-trip-cli_hu829c4319b73f46f630f5e7756f8b9d4d_68340_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/istio-circuit-breaking/circuit-breaking-trip-cli_hu829c4319b73f46f630f5e7756f8b9d4d_68340_20bbc38dd7e7303cab776319a604649e.webp"
               width="760"
               height="215"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Circuit Breaking trip cli
    </figcaption></figure>
</p>
<h4 id="移除熔断配置">移除熔断配置</h4>
<p>移除熔断执行下面的命令：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ backyards r cb delete backyards-demo/notifications
</span></span><span class="line"><span class="cl">INFO<span class="o">[</span>0000<span class="o">]</span> current settings
</span></span><span class="line"><span class="cl">Connections  Timeout  Pending Requests  Requests  RPC  Retries  Errors  Interval  Ejection <span class="nb">time</span>  percentage
</span></span><span class="line"><span class="cl"><span class="m">1</span>            3s       <span class="m">1</span>                 <span class="m">1024</span>      <span class="m">1</span>    <span class="m">1024</span>     <span class="m">5</span>       1s        3m             <span class="m">100</span>
</span></span><span class="line"><span class="cl">? Do you want to DELETE the circuit breaker rules? Yes
</span></span><span class="line"><span class="cl">INFO<span class="o">[</span>0008<span class="o">]</span> circuit breaker rules <span class="nb">set</span> to backyards-demo/notifications successfully deleted
</span></span></code></pre></div><p>使用下面的命令验证是否成功：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ backyards r cb get backyards-demo/notifications
</span></span><span class="line"><span class="cl">  INFO<span class="o">[</span>0001<span class="o">]</span> no circuit breaker rules <span class="nb">set</span> <span class="k">for</span> backyards-demo/notifications
</span></span></code></pre></div><h3 id="使用-backyards-graphql-api-创建熔断">使用 BACKYARDS GRAPHQL API 创建熔断</h3>
<p>Backyards 由多个组件组成，比如 Istio、Banzai Cloud 的<a href="https://github.com/banzaicloud/istio-operator" target="_blank" rel="noopener">Istio operator</a>，多集群<a href="https://banzaicloud.com/blog/istio-canary/" target="_blank" rel="noopener">Canary release operator</a>，以及多个后端基础设施。所有的这些都在<strong>Backyards’ GraphQL API</strong>的后面。</p>
<p>Backyards UI 和 CLI 都使用 Backyards 的 GraphQL API，它将在 9 月底与 GA 版本一起发布。用户将很快能够使用我们的工具来管理 Istio 和构建他们自己的客户端。</p>
<h3 id="清理">清理</h3>
<p>从你的集群移除 demo 应用、Backyards 和 Istio，执行下面的命令，它将按顺序卸载这些组件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ backyards uninstall -a
</span></span></code></pre></div><h2 id="总结">总结</h2>
<p>使用 Backyards，你可以通过 UI 或 CLI 命令行工具轻松的配置熔断器。然后通过嵌入的 Grafana 仪表板从 Backyards UI 实时的监控熔断器，来查看跳闸率和按源计算的跳闸次数。</p>
<p>下一次我们将介绍错误注入，请继续关注！</p>

                </div>
                

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/istio/">Istio</a>
  
</div>











  
  
    



  
  
  
  
  
  <div class="media author-card content-widget-hr mb-4">
    
      
      <a href="/author/laszlo-bence-nagy/"><img class="avatar mr-3 avatar-circle" src="/author/laszlo-bence-nagy/avatar_hue38add62c87b7486d80c9f3fda25dfc1_12220_270x270_fill_q75_lanczos_center.jpg" alt="Laszlo Bence Nagy"></a>
    

    <div class="media-body">
      <p class="card-title"><a href="/author/laszlo-bence-nagy/">Laszlo Bence Nagy</a></p>
      
      
      
    </div>
  </div>


  


  
  
    




  




<div class="article-widget">
  
<div class="container-xl row post-nav">
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1" href="/blog/k8s-autoscaling-all-you-need-to-know/" rel="next">
    <div class="meta-nav">下一页</div>
    <p>你必知的 Kubernetes 自动缩放</p></a>
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1"  href="/blog/custom-application-metrics-with-django-prometheus-and-kubernetes/" rel="prev">
    <div class="meta-nav">上一页</div>
    <p>使用 Django，Prometheus，和 Kubernetes 定制应用指标</p></a>
  
</div>

</div>










  

<p class="edit-page">
  <a href="https://github.com/cloudnativeto/cloudnative.to/edit/master/content/blog/istio-circuit-breaking/index.md">
    <i class="fas fa-pen pr-2"></i>编辑本页
  </a>
</p>




  
  
  <div class="article-widget content-widget-hr">
    <p class="related-title">相关推荐</p>
    <ul>
      
      <li><a href="/blog/istio-gateway-api-beta/">Istio 扩展对 Gateway API 的支持</a></li>
      
      <li><a href="/blog/istio-traffic-management-series-service-management-concept-theory/">浅析 Istio——服务治理之概念和原理</a></li>
      
      <li><a href="/blog/istio-traffic-management-series-route-management/">浅析 Istio——流量治理之路由管理</a></li>
      
      <li><a href="/blog/validating-a-request-payload-with-wasm/">使用 WebAssembly 验证请求负载</a></li>
      
      <li><a href="/blog/resiliency-app-aware-network/">利用服务网格和智能应用感知网络增强应用弹性</a></li>
      
    </ul>
  </div>
  





  
  
  

  

  
  <section id="comments" class="mb-3 pt-0">
    <script>
  let themeNumber = localStorage.getItem('wcTheme');
  var giscusTheme = "light";
  if (themeNumber == 1){
    giscusTheme = "dark";
  }
  let giscusAttributes = {
    "src": "https://giscus.app/client.js",
    "data-theme": giscusTheme,
    "data-repo":"cloudnativeto\/cloudnative.to",
    "data-repo-id":"MDEwOlJlcG9zaXRvcnkyMzc3NDUxOTA=",
    "data-category":"General",
    "data-category-id":"MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDU5MzUy",
    "data-mapping":"pathname",
    "data-reactions-enabled":"",
    "data-emit-metadata":"0",
    "data-input-position":"top",
    "data-theme":giscusTheme,
    "data-lang":"zh-CN",
    "data-loading":"lazy",
    "crossorigin":"annoymous",
    "origins":"https://cloudnative.to",
    "originsRegex":"http://localhost:[0-9]+",
    "async": "",
  };

  let giscusScript = document.createElement("script");
  Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
  document.querySelector('#comments').appendChild(giscusScript);
</script>

  </section>
  



            </article>
        </main>
    </div>
</div>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">© 2020-2023 云原生社区保留所有权利</p>
        </div>
    </div>
  </div>

</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.46271ef31da3f018e9cd1b59300aa265.js"></script>




  

  
  

  

  
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
    
    
  










  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <div class="article-metadata search-hit-type">{{relpermalink}}</div>
          <a href="{{relpermalink}}">{{title}}</a>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":false}</script>










  
  


<script src="/zh/js/wowchemy.min.24983018b0e5661cd5fe1822254286ea.js"></script>







<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
<script>
  anchors.add();
</script>



<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, '已复制')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>



<script>

function Collapse(e){
  var node = document.getElementById(e);
  if (node.className.indexOf('fa-angle-down') > -1){
    node.setAttribute("class", "fa-solid fa-angle-right");
    }else{
    node.setAttribute("class", "fa-solid fa-angle-down");
    }
}
</script>


</body>
</html>
