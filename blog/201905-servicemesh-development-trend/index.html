<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
  

  

  
  
  
    
  
  <meta name="description" content="介绍 Service Mesh 最新的产品动态，分析其发展趋势和未来走向；结合蚂蚁的上云实践，阐述在云原生背景下 Service Mesh 的核心价值，和对云原生落地的关键作用。" />

  
  <link rel="alternate" hreflang="zh" href="https://cloudnative.to/blog/201905-servicemesh-development-trend/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.008259417e6adf8980695ebbbb46553f.css" />

  



  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f3dc895ea3bd6186cd835841d365c103";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu0802e500a55b0406ddf0453824effa47_6997_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu0802e500a55b0406ddf0453824effa47_6997_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://cloudnative.to/blog/201905-servicemesh-development-trend/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@CloudNativeCN" />
    <meta property="twitter:creator" content="@CloudNativeCN" />
  
  <meta property="og:site_name" content="云原生社区（中国）" />
  <meta property="og:url" content="https://cloudnative.to/blog/201905-servicemesh-development-trend/" />
  <meta property="og:title" content="Service Mesh 发展趋势：云原生中流砥柱 | 云原生社区（中国）" />
  <meta property="og:description" content="介绍 Service Mesh 最新的产品动态，分析其发展趋势和未来走向；结合蚂蚁的上云实践，阐述在云原生背景下 Service Mesh 的核心价值，和对云原生落地的关键作用。" /><meta property="og:image" content="https://cloudnative.to/media/sharing.png" />
    <meta property="twitter:image" content="https://cloudnative.to/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
      <meta
        property="article:published_time"
        content="2019-05-28T07:15:43&#43;08:00"
      />
    
    <meta property="article:modified_time" content="2023-12-20T12:02:37&#43;08:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cloudnative.to/blog/201905-servicemesh-development-trend/"
  },
  "headline": "Service Mesh 发展趋势：云原生中流砥柱",
  
  "datePublished": "2019-05-28T07:15:43+08:00",
  "dateModified": "2023-12-20T12:02:37+08:00",
  
  "author": {
    "@type": "Person",
    "name": "敖小剑"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "云原生社区（中国）",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cloudnative.to/media/logo.svg"
    }
  },
  "description": "介绍 Service Mesh 最新的产品动态，分析其发展趋势和未来走向；结合蚂蚁的上云实践，阐述在云原生背景下 Service Mesh 的核心价值，和对云原生落地的关键作用。"
}
</script>

  

  

  

  





  <title>Service Mesh 发展趋势：云原生中流砥柱 | 云原生社区（中国）</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="104097f7dc4d1d835907a387b02e34eb" >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.62d6f8dfe8493f1c68557dde65bec362.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="关闭"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="搜索..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="搜索...">
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生社区（中国）"
            
            ></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生社区（中国）"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/community"><span>社区</span></a>
          </li>

          
          

          

          
          
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link  active" href="/blog"><span>博客</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>资料</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/envoy/"><span>Envoy 中文文档</span></a>
              
                <a class="dropdown-item" href="/kubebuilder/"><span>Kubebuilder 中文文档</span></a>
              
                <a class="dropdown-item" href="https://lib.jimmysong.io/"><span>云原生资料库</span></a>
              
                <a class="dropdown-item" href="https://istio.io/latest/zh/"><span>Istio 中文文档</span></a>
              
            </div>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/event"><span>活动</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#feed"><span>更新</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#tags"><span>标签</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>关于</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        

        
        <li class="nav-item">
            <a class="nav-link" href="/community/join/" data-toggle="tooltip" data-placement="bottom" title="加入社区" aria-label="主站"><i class="fa-brands fa-weixin" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link js-search" href="#" data-toggle="tooltip" data-placement="bottom" title="搜索" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item d-none d-lg-inline-flex">
            <a class="nav-link" href="https://github.com/cloudnativeto/cloudnative.to" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="查看源码" aria-label="查看源码" aria-label="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item">
          <a href="#" class="nav-link set-theme">
            <i class="fa fa-sun" aria-hidden="true" id="theme-icon"></i>
          </a>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <div class="container-xl">
    <div class="post-container">
        












  

  
  
  
<div class="article-container pt-3">
  <h1>Service Mesh 发展趋势：云原生中流砥柱</h1>

  

  
    


<div class="article-metadata">

  <div>
  
  
  
  
    <i class="fa-solid fa-feather"></i>
    

  <span >
      <a href="/author/%E6%95%96%E5%B0%8F%E5%89%91/">敖小剑</a></span>
    
    <span class="middot-divider"></span>
    
  
  
  
  
  
  
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/category/service-mesh/" class="text-capitalize">service mesh</a></span>
  
  </div>

  
  <span class="article-date">
    
    
      
          
          发布于
      
    
    2019-05-28
  </span>
  

  

  
  <span class="middot-divider"></span>
  字数 8096
  <span class="middot-divider"></span>
  <span class="article-reading-time">
      阅读时长 37 分钟
  </span>
  

  
  
  
  

</div>

    





  
</div>


    </div>
    <div class="border-bottom mb-2"></div>
    <div class="row flex-xl-nowrap">
        <div class="col-3 d-none d-xl-block docs-toc">
            <!-- toc -->
            
<div class="">
    <ul class="nav toc-top">
        <li>
            <a href="#" id="back_to_top" class="docs-toc-title">目录</a>
        </li>
    </ul>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#service-mesh-产品动态">Service Mesh 产品动态</a>
      <ul>
        <li><a href="#istio11-发布">Istio1.1 发布</a></li>
        <li><a href="#istio-11-架构变化">Istio 1.1 架构变化</a></li>
        <li><a href="#其他社区产品动态">其他社区产品动态</a></li>
        <li><a href="#云厂商的产品动态">云厂商的产品动态</a></li>
      </ul>
    </li>
    <li><a href="#service-mesh-发展趋势">Service Mesh 发展趋势</a>
      <ul>
        <li><a href="#趋势-1上云--托管">趋势 1：上云 + 托管</a></li>
        <li><a href="#趋势-2vm-和容器混用">趋势 2：VM 和容器混用</a></li>
        <li><a href="#趋势-3混合云和多云支持">趋势 3：混合云和多云支持</a></li>
        <li><a href="#趋势-4和-serverless-的结合">趋势 4：和 Serverless 的结合</a></li>
        <li><a href="#趋势-5mesh-模式延伸">趋势 5：Mesh 模式延伸</a></li>
        <li><a href="#趋势-6标准化不锁定">趋势 6：标准化，不锁定</a></li>
        <li><a href="#发展趋势分析">发展趋势分析</a></li>
      </ul>
    </li>
    <li><a href="#service-mesh-与云原生">Service Mesh 与云原生</a>
      <ul>
        <li><a href="#什么是云原生">什么是云原生？</a></li>
        <li><a href="#service-mesh-的核心价值">Service Mesh 的核心价值</a></li>
        <li><a href="#mesh-化是云原生落地的关键步骤">Mesh 化是云原生落地的关键步骤</a></li>
        <li><a href="#service-mesh-发展展望">Service Mesh 发展展望</a></li>
      </ul>
    </li>
  </ul>
</nav>
</div>

            <!-- /toc -->
            
            <div class="subscribe-module col-12 mt-1">
    <img src="/img/wechat.jpg" alt="image" title="云原生社区的微信公众号"/>
    <p class="text-center pt-1">关注「云原生社区动态」微信公众号，获取本站更新</p>
</div>

            
        </div>
        <main class="article-body col-9 container docs-content" role="main">
            <article class="article">
                <div class="article-style">
                    
                    <details class="toc-inpage d-print-none d-show-block mb-0">
  <summary class="font-weight-bold">点击查看目录</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#service-mesh-产品动态">Service Mesh 产品动态</a>
      <ul>
        <li><a href="#istio11-发布">Istio1.1 发布</a></li>
        <li><a href="#istio-11-架构变化">Istio 1.1 架构变化</a></li>
        <li><a href="#其他社区产品动态">其他社区产品动态</a></li>
        <li><a href="#云厂商的产品动态">云厂商的产品动态</a></li>
      </ul>
    </li>
    <li><a href="#service-mesh-发展趋势">Service Mesh 发展趋势</a>
      <ul>
        <li><a href="#趋势-1上云--托管">趋势 1：上云 + 托管</a></li>
        <li><a href="#趋势-2vm-和容器混用">趋势 2：VM 和容器混用</a></li>
        <li><a href="#趋势-3混合云和多云支持">趋势 3：混合云和多云支持</a></li>
        <li><a href="#趋势-4和-serverless-的结合">趋势 4：和 Serverless 的结合</a></li>
        <li><a href="#趋势-5mesh-模式延伸">趋势 5：Mesh 模式延伸</a></li>
        <li><a href="#趋势-6标准化不锁定">趋势 6：标准化，不锁定</a></li>
        <li><a href="#发展趋势分析">发展趋势分析</a></li>
      </ul>
    </li>
    <li><a href="#service-mesh-与云原生">Service Mesh 与云原生</a>
      <ul>
        <li><a href="#什么是云原生">什么是云原生？</a></li>
        <li><a href="#service-mesh-的核心价值">Service Mesh 的核心价值</a></li>
        <li><a href="#mesh-化是云原生落地的关键步骤">Mesh 化是云原生落地的关键步骤</a></li>
        <li><a href="#service-mesh-发展展望">Service Mesh 发展展望</a></li>
      </ul>
    </li>
  </ul>
</nav>
</details>

                    
                    <p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/logo_hu61e6be558a65ccd5d09f7f42427a57eb_29710_3be2f6c0a77613149bec19925d837515.webp 400w,
               /blog/201905-servicemesh-development-trend/logo_hu61e6be558a65ccd5d09f7f42427a57eb_29710_253441f6890d3646e5edb76e85fff31e.webp 760w,
               /blog/201905-servicemesh-development-trend/logo_hu61e6be558a65ccd5d09f7f42427a57eb_29710_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/logo_hu61e6be558a65ccd5d09f7f42427a57eb_29710_3be2f6c0a77613149bec19925d837515.webp"
               width="600"
               height="296"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h2 id="前言">前言</h2>
<p>本文内容整理自 5 月 25 日在 Kubernetes &amp; Cloud Native Meetup 上海站发表的主题演讲，主要介绍了 Service Mesh 最新的产品动态，分析其发展趋势和未来走向；结合蚂蚁的上云实践，阐述在云原生背景下 Service Mesh 的核心价值，以及对云原生落地的关键作用。</p>
<p>内容主要有三个部分：</p>
<ol>
<li>Service Mesh 产品动态：介绍最近半年 Service Mesh 的产品动态，包括开源项目和云厂商推出的云上服务</li>
<li>Service Mesh 发展趋势：根据最近的产品动态，总结 Service Mesh 的发展趋势，推断未来的走向</li>
<li>Service Mesh 与云原生：结合云原生，更好的理解 Service Mesh 的价值和作用</li>
</ol>
<h2 id="service-mesh-产品动态">Service Mesh 产品动态</h2>
<h3 id="istio11-发布">Istio1.1 发布</h3>
<p>Istio 是目前 Service Mesh 社区最引人注目的开源项目，在今年的 3 月份发布了期待已久的 Istio 1.1 版本，我们来看看 Istio 最近几个版本的发布情况：</p>
<ul>
<li>2018 年 6 月 1 日，Istio 发布了 0.8 版本，这是 Istio 历史上第一个 LTS 版本，也是 Istio 历史上变动最大的一个版本</li>
<li>2018 年 7 月 31 日，Istio 发布了 1.0 版本，号称 &ldquo;Product Ready&rdquo;</li>
<li>然后就是漫长的等待，Istio 1.0 系列以每个月一个小版本的方式一路发布了 1.0.1 到 1.0.6，然后才开始 1.1.0 snapshot 1 到 6，再 1.1.0-rc 1 到 6，终于在 2019 年 3 月 20 日发布了 1.1 版本，号称 &ldquo;Enterprise Ready&rdquo;。</li>
</ul>
<p>从 Istio 1.0 到 Istio 1.1，中间的时间跨度高达 9 个月！我们来看看经过这漫长的开发时间才发布的 Istio 1.1 版本带来了哪些新的东西：</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/istio1.1-new-feature_hu128022506d2f43c7672d933a4871a7da_150144_4451400168331b299e26744875a7a429.webp 400w,
               /blog/201905-servicemesh-development-trend/istio1.1-new-feature_hu128022506d2f43c7672d933a4871a7da_150144_496b9c47610ddc105ce5f9c3d183c49b.webp 760w,
               /blog/201905-servicemesh-development-trend/istio1.1-new-feature_hu128022506d2f43c7672d933a4871a7da_150144_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/istio1.1-new-feature_hu128022506d2f43c7672d933a4871a7da_150144_4451400168331b299e26744875a7a429.webp"
               width="760"
               height="261"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>图中标红的部分，涉及到 Istio 的架构调整，下面将详细介绍 Istio 1.1 版本中带来的架构变化。</p>
<h3 id="istio-11-架构变化">Istio 1.1 架构变化</h3>
<p>下图是 Istio 1.0 和 Istio 1.1 的架构图对比：</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/istio-constructure_hu3399c0b9473baf5af151cc3c93452748_105930_6953a358fc1f1874690c65a6c479e051.webp 400w,
               /blog/201905-servicemesh-development-trend/istio-constructure_hu3399c0b9473baf5af151cc3c93452748_105930_2f66355677a22417eac1a0cd11541966.webp 760w,
               /blog/201905-servicemesh-development-trend/istio-constructure_hu3399c0b9473baf5af151cc3c93452748_105930_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/istio-constructure_hu3399c0b9473baf5af151cc3c93452748_105930_6953a358fc1f1874690c65a6c479e051.webp"
               width="760"
               height="339"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Istio 1.1 的第一个架构变化来自 Galley：在 Istio 1.1 的架构图中增加了 Galley 组件。但是实际上在 Istio 1.0 版本中 Gallay 组件就已经存在，只是当时 Galley 的功能非常简单，只是做配置更新之后的验证（Validation），在 Istio 1.0 的架构图中都没有出现。而在 Istio 1.1 版本之后，Galley 的定位发生了巨大的变化：Galley 开始分担 Pilot/Mixer 的职责。</p>
<p>在 Istio 1.1 版本之前的设计中，Istio 的三大组件 Pilot/Mixer/Citadel 都需要访问 kubernetes 的 API Server，以获取服务注册信息和配置信息，包括 kubernetes 原生资源如 service/deployment/pod 等，还有 Istio 的自定义资源（数量多达 50 多个的 CRD） 。这个设计导致 Istio 的各个组件都不得不和 kubernetes 的 API Server 产生强绑定，不仅仅代码大量冗余，而且在测试中也因为需要和 kubernetes 的 API Server 交互导致 Pilot/Mixer 模块测试困难。</p>
<p>为了解决这个问题，在 Istio 1.1 之后，访问 kubernetes 的 API Server 的工作将逐渐交给 Galley 组件，而其他组件如 Pilot/Mixer 就会和  kubernetes 解耦。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/galley_hu1b668927db434a9e1254b722bd18cbb7_34358_b5da61f9d13d3ed64ac0b7886e690dac.webp 400w,
               /blog/201905-servicemesh-development-trend/galley_hu1b668927db434a9e1254b722bd18cbb7_34358_fd62afad013216889487c5cb51a5b24c.webp 760w,
               /blog/201905-servicemesh-development-trend/galley_hu1b668927db434a9e1254b722bd18cbb7_34358_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/galley_hu1b668927db434a9e1254b722bd18cbb7_34358_b5da61f9d13d3ed64ac0b7886e690dac.webp"
               width="400"
               height="457"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>这个工作还在进行中，目前 Istio 的 CRD 已经修改为由 Galley 读取，而 K8s 的原生资源（Service / Deployment / Pod 等），暂时还是由 Pilot 读取。</p>
<p>为了方便在各个组件中同步数据，Istio 引入了 MCP（Mesh Configuration Protocol）协议。在 Istio 1.1 版本中，Pilot 通过 MCP 协议从 Galley 同步数据。MCP 是受 xDS v2 协议（准确说是 aDS）的启发而制定的新协议，用于在 Istio 各模块之间同步数据。</p>
<p>Istio 1.1 的第二个架构变化来自于 Mixer，在 Istio 1.1 版本中，推荐使用 Out-of-Process Adapter，即进程外适配器。Istio 预计下一个版本将弃用 In-Proxy Adapter，目前所有的 Adapter 都将改为 Out-of-Process adapter。</p>
<p>什么是 In-Proxy Adapter？下图是 Mixer 的架构图，在 Istio 的设计中，Mixer 是一个独立进程，Proxy 通过远程调用来和 Mixer 交互。而 Mixer 的实现了 Adapter 模式，定义了 Adapter API，然后内建了数量非常多的各种 Adapter。这些 Adatper 的代码存放在 Mixer 代码中，运行时也在 Mixer 的进程内，因此称为 In-Process Adapter。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/in-process-adapter_hu491fe1352985fb21e275207ff2b82169_186944_e2961a11245ba16123c34dcfc987ea9d.webp 400w,
               /blog/201905-servicemesh-development-trend/in-process-adapter_hu491fe1352985fb21e275207ff2b82169_186944_a995a07575d91dee1469e08a82623957.webp 760w,
               /blog/201905-servicemesh-development-trend/in-process-adapter_hu491fe1352985fb21e275207ff2b82169_186944_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/in-process-adapter_hu491fe1352985fb21e275207ff2b82169_186944_e2961a11245ba16123c34dcfc987ea9d.webp"
               width="760"
               height="532"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>In-Process Adapter 的问题在于所有的 Adapter 的实现都和 Mixer 直接绑定，包括代码和运行时。因此当 Adapter 需要更新时就需要更新整个 Mixer，任意一个 Adapter 的实现出现问题也会影响整个 Mixer，而且数量众多的 Adapter 也带来了数量众多的 CRD。为此，Istio 1.1 版本中通过引入 Out-of-Process Adapter 来解决这个问题。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/out-of-process-adapter_hu7c40041840f9b18c30d38a2e2614aa07_106606_9150a4f11a3977fc76196b557d9a9cdb.webp 400w,
               /blog/201905-servicemesh-development-trend/out-of-process-adapter_hu7c40041840f9b18c30d38a2e2614aa07_106606_9ed6c0bac56cfe0b0c29b58d0bf14453.webp 760w,
               /blog/201905-servicemesh-development-trend/out-of-process-adapter_hu7c40041840f9b18c30d38a2e2614aa07_106606_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/out-of-process-adapter_hu7c40041840f9b18c30d38a2e2614aa07_106606_9150a4f11a3977fc76196b557d9a9cdb.webp"
               width="760"
               height="391"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Out-of-Process Adapter 以独立进程的方式运行在 Mixer 进程之外，因此 Out-of-Process Adapter 的开发/部署和配置都可以独立于 Mixer，从而将 Mixer 从 Adaper 的实现细节中解脱出来。</p>
<p>但是，Out-of-Process Adapter 的引入，会导致新的性能问题：原来 Mixer 和 In-Process Adapter 之间是方法调用，现在改成 Out-of-Process Adapter 之后就变成远程调用了。而 Mixer 一直以来都是 Istio 架构设计中最大的争议，之前 Proxy 和 Mixer 之间的远程调用，已经造成非常大的性能瓶颈，而引入 Out-of-Process Adapter 之后远程调用会从一次会变成多次（每个配置生效的 Out-of-Process Adapter 就意味着一次远程调用），这会让性能雪上加霜。</p>
<p>总结 Out-of-Process Adapter 的引入：<strong>架构更加的优雅</strong>，<strong>性能更加的糟糕</strong>。</p>
<p>在 Istio 1.1 为了架构而不顾性能的同时，Istio 内部也有其他的声音传出，如正在规划中的 Mixer v2。这个规划最重要的决策就是放弃 Mixer 独立进程的想法，改为将 Mixer 的功能合并到 Envoy 中，从而避免 Envoy 和 Mixer 之间远程调用的开销。关于 Mixer 的性能问题和 Mixer 合并的思路，蚂蚁金服在去年六月份开始 SOFAMesh 项目时就有清晰的认识和计划，时隔一年，终于欣喜的看到 Istio 开始正视 Mixer 的架构设计问题并回到正确的方向上。</p>
<p>对此有兴趣的朋友可以通过阅读下面的文章获取更详细的信息（发表于一年前，但是依然有效）：</p>
<ul>
<li><a href="https://skyao.io/talk/201806-service-mesh-explore/" target="_blank" rel="noopener">大规模微服务架构下的 Service Mesh 探索之路</a>: 第二节架构设计中的&quot;合并部分 Mixer 功能&quot;</li>
<li><a href="https://skyao.io/post/201804-servicemesh-architecture-introspection/" target="_blank" rel="noopener">Service Mesh 架构反思：数据平面和控制平面的界线该如何划定？</a></li>
<li><a href="https://skyao.io/post/201804-istio-achilles-heel/" target="_blank" rel="noopener">Mixer Cache: Istio 的阿克琉斯之踵？</a>：系列文章，有两篇</li>
<li><a href="https://skyao.io/post/201804-istio-mixer-cache-concepts/" target="_blank" rel="noopener">Istio Mixer Cache 工作原理与源码分析</a>: 系列文章，有四篇</li>
</ul>
<p>目前 Mixer v2 的规划还处于 Review 状态，实现方式尚未有明确决定。如果要合并 Mixer，考虑到目前 Mixer 是基于 Golang 编写，而 Envoy 是基于 c++ ，这意味着需要用 c++重写所有的 Adapter，工作量巨大，恐怕不是短期之内能够完成的。当然也有另外一个新颖（或者说脑洞大开）的思路：引入 Web Assembly（WASM）。目前 Envoy 在进行支持 Web Assembly 的尝试，如果成功，则通过 Web Assembly 的方式来支持 Mixer Adapter 不失为一个好选择。</p>
<h3 id="其他社区产品动态">其他社区产品动态</h3>
<p>最近，CNCF 在筹建 Universal Data Plane API（UDPA/通用数据平面 API）工作组，以制定数据平面的标准 API，为 L4/L7 数据平面配置提供事实上的标准。Universal Data Plane API 的创意来自 Envoy，实现为 xDS API。而目前 xDS v2 API 已经是数据平面 API 的事实标准，这次的 UDPA 会以 xDS v2 API 为基础。工作组的初始成员来自包括 Envoy 和 gRPC 项目的代表，蚂蚁金服也在积极参与 UDPA 工作组，目前还处于非常早期的筹备阶段。</p>
<p>Linkerd2 在 2019 年 4 月 17 日发布了最新的稳定版本 Linkerd 2.3 版本。Linkerd2 是目前开源产品中唯一正面对抗 Istio 的存在，不过在国内知名度不高，使用者也很少。比较有意思的是，开发 Linkerd2 的初创公司 Buoyant 最近的 B 轮融资来自 Google 的投资部门。</p>
<h3 id="云厂商的产品动态">云厂商的产品动态</h3>
<p>随着 Service Mesh 技术的发展，和各方对 Service Mesh 前景的看好，各大主流云提供商都开始在 Service Mesh 技术上发力。</p>
<p>首先看 AWS，在 2019 年 4 月，AWS 宣布 App Mesh GA。App Mesh 是 AWS 推出的 AWS 原生服务网格，与 AWS 完全集成，包括：</p>
<ul>
<li>网络（AWS cloud map）</li>
<li>计算（Amazon EC2 和 AWS Fargate）</li>
<li>编排工具（AWS EKS，Amazon ECS 和 EC2 上客户管理的 k8s）</li>
</ul>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/appmesh_huf180038b575803132be4c66309d1904b_111621_73cba99b1c6e4e80d56fe30f04b2c1ef.webp 400w,
               /blog/201905-servicemesh-development-trend/appmesh_huf180038b575803132be4c66309d1904b_111621_f863968cb3d513d9df4ee1bd2f508b16.webp 760w,
               /blog/201905-servicemesh-development-trend/appmesh_huf180038b575803132be4c66309d1904b_111621_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/appmesh_huf180038b575803132be4c66309d1904b_111621_73cba99b1c6e4e80d56fe30f04b2c1ef.webp"
               width="760"
               height="415"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>App Mesh 的数据平面采用 Envoy，产品非常有创意的同时支持 VM 和容器，支持多种产品形态，如上图所示。</p>
<blockquote>
<p>AWS App Mesh 的更多详细内容，请浏览文章 <a href="https://skyao.io/post/201904-aws-app-mesh/" target="_blank" rel="noopener">用 AWS App Mesh 重新定义应用通讯</a> 。</p>
</blockquote>
<p>Google 的打法则是围绕 Istio。首先是在 2018 年底推出了 Istio on GKE，即&quot;一键集成 Istio&quot;，并提供遥测、日志、负载均衡、路由和 mTLS 安全能力。接着 Google 又推出 Google Cloud Service Mesh，这是 Istio 的完全托管版本，不仅仅提供 Istio 开源版本的完整特性，还集成了 Google Cloud 上的重要产品 Stackdriver。</p>
<p>近期，Google 推出 Traffic Director 的 beta 测试版本，Traffic Director 是完全托管的服务网格流量控制平面，支持全局负载均衡，适用于虚拟机和容器，提供混合云和多云支持、集中式健康检查和流量控制，还有一个非常特别的特性：支持基于流量的自动伸缩。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/google-traffic-director_hub6d534bae9ecc02308c18576b39f6034_135752_35a7dcca708166a221abe75a08390217.webp 400w,
               /blog/201905-servicemesh-development-trend/google-traffic-director_hub6d534bae9ecc02308c18576b39f6034_135752_ef8691a6ec7dc4342b13e01ecf6f4151.webp 760w,
               /blog/201905-servicemesh-development-trend/google-traffic-director_hub6d534bae9ecc02308c18576b39f6034_135752_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/google-traffic-director_hub6d534bae9ecc02308c18576b39f6034_135752_35a7dcca708166a221abe75a08390217.webp"
               width="760"
               height="372"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<blockquote>
<p>Google Traffic Director 的详细介绍，请查看我之前的博客文章 <a href="https://skyao.io/post/201905-google-traffic-director-detail/" target="_blank" rel="noopener">Google Traffic Director 详细介绍</a></p>
</blockquote>
<p>微软则推出了 Service Fabric Mesh。Azure Service Fabric 是 Microsoft 的微服务框架，设计用于公共云，内部部署以及混合和多云架构。而 Service Fabric Mesh 是 Azure 完全托管的产品，在 2018 年 8 月推出预览版。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/service-fabric-mesh_huad8193e2a39d692e57b00d233f26b526_248826_52486e2166cf5c46750c74001395612e.webp 400w,
               /blog/201905-servicemesh-development-trend/service-fabric-mesh_huad8193e2a39d692e57b00d233f26b526_248826_b568349d7f9e80c52f387555c537cca2.webp 760w,
               /blog/201905-servicemesh-development-trend/service-fabric-mesh_huad8193e2a39d692e57b00d233f26b526_248826_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/service-fabric-mesh_huad8193e2a39d692e57b00d233f26b526_248826_52486e2166cf5c46750c74001395612e.webp"
               width="760"
               height="451"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>上周（5 月 21 号）最新消息，微软在 kubeconf 上推出 Service Mesh Interface。SMI 是在 Kubernetes 上运行服务网格的规范，定义了由各种供应商实现的通用标准，使得最终用户的标准化和服务网格供应商的创新可以两全其美，SMI 预期将为 Service Mesh 带来了灵活性和互通性。</p>
<p>SMI 是一个开放项目，由微软，Linkerd，HashiCorp，Solo，Kinvolk 和 Weaveworks 联合启动; 并得到了 Aspen Mesh，Canonical，Docker，Pivotal，Rancher，Red Hat 和 VMware 的支持。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/smi_hu59fe24474108f551c67d5b5338728d18_190863_ad9e5e033d5df8b877277ecb499bc09d.webp 400w,
               /blog/201905-servicemesh-development-trend/smi_hu59fe24474108f551c67d5b5338728d18_190863_73326601b0b112e737dafd8ec7e5b136.webp 760w,
               /blog/201905-servicemesh-development-trend/smi_hu59fe24474108f551c67d5b5338728d18_190863_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/smi_hu59fe24474108f551c67d5b5338728d18_190863_ad9e5e033d5df8b877277ecb499bc09d.webp"
               width="760"
               height="400"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h2 id="service-mesh-发展趋势">Service Mesh 发展趋势</h2>
<p>在分享完最近半年 Service Mesh 产品的动态之后，我们来分析探讨 Service Mesh 的发展趋势。</p>
<h3 id="趋势-1上云--托管">趋势 1：上云 + 托管</h3>
<p>在微服务/容器这些年的发展历程中，我们会发现一个很有意思（甚至有些哭笑不得）的现象：</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/trend1_hue8fcf37878587acc48bfb772e4562be1_73784_a12d229f5bc2144e5b28178683acef17.webp 400w,
               /blog/201905-servicemesh-development-trend/trend1_hue8fcf37878587acc48bfb772e4562be1_73784_7ff40df9666aa5ad407fc986961b2ee0.webp 760w,
               /blog/201905-servicemesh-development-trend/trend1_hue8fcf37878587acc48bfb772e4562be1_73784_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/trend1_hue8fcf37878587acc48bfb772e4562be1_73784_a12d229f5bc2144e5b28178683acef17.webp"
               width="760"
               height="308"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<ul>
<li>为了解决单体的复杂度问题，我们引入微服务架构</li>
<li>为了解决微服务架构下大量应用部署的问题，我们引入容器</li>
<li>为了解决容器的管理和调度问题，我们引入 kubernetes</li>
<li>为了解决微服务框架的侵入性问题，我们引入 Service Mesh</li>
<li>为了让 Service Mesh 有更好的底层支撑，我们又将 Service Mesh 运行在 k8s 上</li>
</ul>
<p>在这个过程中，从单个应用（或者微服务）的角度看，的确自身的复杂度降低，在有底层系统支撑的情况下部署/维护/管理/控制/监控等也都大为简化。但是站在整个系统的角度，整体复杂度并没有消失，只是从单体分解到微服务，从应用下沉到 Service Mesh，复杂度从总量上不但没有减少，反而大为增加。</p>
<p>解决这个问题最好的方式就是 <strong>上云</strong>，使用 <strong>托管</strong> 版本的 k8s 和 Service Mesh，从而将底层系统的复杂度交给云厂商，而客户只需要在云的基础上享受 Service Mesh 技术带来的使用便利和强大功能。</p>
<p>前面我们分享产品动态时，可以看到目前 Google / AWS / 微软 这三巨头都已经推出了各自的 Service Mesh 托管产品，而在国内，阿里云/华为云等也有类似的产品推出，我们蚂蚁金服也将在稍后在金融云上推出 SOFAMesh 的云上托管版本。在这里，我总结为一句话：</p>
<p><strong>几乎所有的主要公有云提供商都在提供（或者准备提供）Service Mesh 托管方案</strong></p>
<h3 id="趋势-2vm-和容器混用">趋势 2：VM 和容器混用</h3>
<p>第二个趋势就是 VM 和容器混用，即 Service Mesh 对服务的运行环境的支持，不仅支持容器（尤其指 k8s），也支持虚拟机，而且支持运行在这两个环境下的服务相互访问，甚至直接在产品层面上屏蔽两者的差异。</p>
<p>比如 Google 的 Traffic Director 产品：</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/google-traffic-director_hub6d534bae9ecc02308c18576b39f6034_135752_35a7dcca708166a221abe75a08390217.webp 400w,
               /blog/201905-servicemesh-development-trend/google-traffic-director_hub6d534bae9ecc02308c18576b39f6034_135752_ef8691a6ec7dc4342b13e01ecf6f4151.webp 760w,
               /blog/201905-servicemesh-development-trend/google-traffic-director_hub6d534bae9ecc02308c18576b39f6034_135752_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/google-traffic-director_hub6d534bae9ecc02308c18576b39f6034_135752_35a7dcca708166a221abe75a08390217.webp"
               width="760"
               height="372"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>AWS 的 App Mesh 产品：</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/appmesh_huf180038b575803132be4c66309d1904b_111621_73cba99b1c6e4e80d56fe30f04b2c1ef.webp 400w,
               /blog/201905-servicemesh-development-trend/appmesh_huf180038b575803132be4c66309d1904b_111621_f863968cb3d513d9df4ee1bd2f508b16.webp 760w,
               /blog/201905-servicemesh-development-trend/appmesh_huf180038b575803132be4c66309d1904b_111621_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/appmesh_huf180038b575803132be4c66309d1904b_111621_73cba99b1c6e4e80d56fe30f04b2c1ef.webp"
               width="760"
               height="415"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>都是在产品层面直接提供 VM 和容器混用的支持，不管应用是运行在 vm 上还是容器内都可以支持，而且可以方便的迁移。</p>
<h3 id="趋势-3混合云和多云支持">趋势 3：混合云和多云支持</h3>
<p>混合云和多云支持最近正成为一个新的技术热点和商业模式，甚至 Google Cloud 都喊出口号，要 &ldquo;All in Hybrid Cloud&rdquo;！</p>
<p>Google Traffic Director 旗帜鲜明的表达了 Google Cloud 对混合云的重视：</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/google-traffic-director-hybird_hu7e36769754f360c82c8083470cf6dddd_88497_3722202cc5fea21233deef1db7735a70.webp 400w,
               /blog/201905-servicemesh-development-trend/google-traffic-director-hybird_hu7e36769754f360c82c8083470cf6dddd_88497_3f4fbc3b9ab1e3bbdf6abd19b0faffa3.webp 760w,
               /blog/201905-servicemesh-development-trend/google-traffic-director-hybird_hu7e36769754f360c82c8083470cf6dddd_88497_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/google-traffic-director-hybird_hu7e36769754f360c82c8083470cf6dddd_88497_3722202cc5fea21233deef1db7735a70.webp"
               width="760"
               height="303"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>下图是 Google Traffic Director  给出的一个应用改造示例：从单体结构转为微服务架构，从私有云转为公有云加私有云的混合云模式。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/google-traffic-director-hybird2_hu15c4b143934f5f5bc2c33993b28e86d0_75029_525b06406887ce8062d3218349ec28d4.webp 400w,
               /blog/201905-servicemesh-development-trend/google-traffic-director-hybird2_hu15c4b143934f5f5bc2c33993b28e86d0_75029_2a70d9f46d48bf0d77aaab623cadbf79.webp 760w,
               /blog/201905-servicemesh-development-trend/google-traffic-director-hybird2_hu15c4b143934f5f5bc2c33993b28e86d0_75029_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/google-traffic-director-hybird2_hu15c4b143934f5f5bc2c33993b28e86d0_75029_525b06406887ce8062d3218349ec28d4.webp"
               width="760"
               height="352"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Service Mesh 毫无疑问是实现上述转型并提供混合云和多云支持的一个非常理想的解决方案。</p>
<h3 id="趋势-4和-serverless-的结合">趋势 4：和 Serverless 的结合</h3>
<p>Service Mesh 技术和 Serverless 技术是工作在不同纬度的两个技术：</p>
<ul>
<li>Service Mesh 技术的关注点在于<strong>服务间通讯</strong>，其目标是剥离客户端 SDK，为应用减负，提供的能力主要包括安全性、路由、策略执行、流量管理等。</li>
<li>Serverless 技术的关注点在于<strong>服务运维</strong>，目标是客户无需关注服务运维，提供服务实例的自动伸缩，以及按照实际使用付费。</li>
</ul>
<p>理论上 Service Mesh 技术和 Serverless 技术并没有冲突的地方，可以结合使用。事实上目前业界也开始出现这个趋势，而融合的方式有两种：</p>
<ol>
<li>在 Serverless 中引入 Servicemesh：典型如 knative 项目和 knative 的 Google Cloud 托管版本 Google Cloud Run，通过引入对容器的支持和使用 Istio，knative 将 Serverless 的支持扩展到 Function 之外，在极大的扩展 Serverless 适用范围的前提下，也将服务间通讯的能力引入到 Serverless。</li>
<li>在 Servicemesh 中引入 Serverless：典型如 Google Traffic Director 产品，在提供 Service Mesh 各种能力的同时，支持按照流量自动伸缩服务的实例数量，从而融入了部分 serverless 的特性。</li>
</ol>
<p>对于 Serverless 和 Servicemesh 的结合，我们来展望未来形态：未来应该会出现一种新型服务模式，Serverless 和 Servicemesh 合二为一。只要将服务部署上来，就自动可以得到 Servicemesh 的服务间通讯能力和 Serverless 的无服务器运维。在蚂蚁金服，我们将这理解成为是未来云原生应用的终态之一，正在积极的探索其落地的实际方式。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/servicemesh-serverless_huf23f3a540cecfc67f70c9af784f1f7ef_48823_fa0cfb63be932af70957077e728e771d.webp 400w,
               /blog/201905-servicemesh-development-trend/servicemesh-serverless_huf23f3a540cecfc67f70c9af784f1f7ef_48823_f9a1439ae972216dfe14442399e97908.webp 760w,
               /blog/201905-servicemesh-development-trend/servicemesh-serverless_huf23f3a540cecfc67f70c9af784f1f7ef_48823_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/servicemesh-serverless_huf23f3a540cecfc67f70c9af784f1f7ef_48823_fa0cfb63be932af70957077e728e771d.webp"
               width="400"
               height="300"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h3 id="趋势-5mesh-模式延伸">趋势 5：Mesh 模式延伸</h3>
<p>回顾一下 Service Mesh 模式的核心，其基本原理在于将客户端 SDK 剥离，以 Proxy 独立进程运行；目标是将原来存在于 SDK 中的各种能力下沉，为应用减负，以帮助应用云原生化。</p>
<p>遵循这个思路，将 Service Mesh 的应用场景泛化，不局限于服务间的同步通信，就可以推广到更多的场景：特征是有网络访问，而是通过客户端 SDK 来实现。</p>
<p>在蚂蚁金服的实践中，我们发现 Mesh 模式不仅仅适用于服务间同步通讯，也可以延伸到以下场景：</p>
<ul>
<li>Database Mesh: 数据库访问</li>
<li>Message Mesh：消息机制</li>
<li>Cache Mesh：缓存</li>
</ul>
<p>以上模式的产品蚂蚁金服都在探索中，相关的产品正在开发和尝试落地。社区也有一些相关的产品，比如 Database Mesh 方面张亮同学在力推的  <a href="https://shardingsphere.apache.org/" target="_blank" rel="noopener">Apache Shardingsphere</a> 项目。</p>
<p>通过更多的 Mesh 模式，我们可以覆盖更多的场景，从而实现让应用在各个方面都做到减负，而不仅仅是 Service Mesh 对应的服务间通讯，从而为后续的应用云原生化奠定基础。</p>
<h3 id="趋势-6标准化不锁定">趋势 6：标准化，不锁定</h3>
<p>云原生的一个重要主张，就是希望在云上为用户提供一致的用户体验，提倡标准化，避免供应商绑定（Not Lock-In）。</p>
<p>从前面分享的 Service Mesh 产品动态可以看出，目前 Service Mesh 市场上出现了众多的供应商和产品：开源的，闭源的，大公司出的，小公司出的，市场繁荣的同时也带来了市场碎片化的问题——所有围绕业务应用的外围工作，比如通过 Service Mesh 对流量进行控制，配置各种安全/监控/策略等行为，以及在这些需求上建立起来的工具和生态系统，却不得不牢牢的绑死在某个具体的 Service Mesh 实现上，所谓”供应商锁定”。其根本问题在于各家实现不同，又没有统一标准。因此，要想解决上述问题，就必须釜底抽薪：<strong>解决 Service Mesh 的标准化问题</strong>。</p>
<p>就在最近这一个月，Service Mesh 社区出现了两个推动标准化的大事件：</p>
<ol>
<li>CNCF 筹建 Universal Data Plane API（通用数据平面 API）工作组，计划以 xDS v2 API 为基础制定数据平面的标准 API，工作组的初始成员来自包括 Envoy 和 gRPC 项目的代表（可以理解为 Google 为首）</li>
<li>微软在 kubeconf 上推出 Service Mesh Interface，准备定义在 Kubernetes 上运行服务网格的规范，为 Service Mesh 带来了灵活性和互通性。SMI 由微软牵头，联合 Linkerd，HashiCorp，Solo，Kinvolk 和 Weaveworks。</li>
</ol>
<p>为了方便理解这两个标准，我为大家准备了一张图：</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/trend6_hu834b9409e5efcfeec3453bd0b86d086d_7459_b676cfb7016a3be78d2e54e3ce7ae524.webp 400w,
               /blog/201905-servicemesh-development-trend/trend6_hu834b9409e5efcfeec3453bd0b86d086d_7459_78f8d1bd2434da880513a27b94dace12.webp 760w,
               /blog/201905-servicemesh-development-trend/trend6_hu834b9409e5efcfeec3453bd0b86d086d_7459_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/trend6_hu834b9409e5efcfeec3453bd0b86d086d_7459_b676cfb7016a3be78d2e54e3ce7ae524.webp"
               width="600"
               height="546"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>其中，Universal Data Plane API 是数据平面的标准，控制平面通过这个 API 来控制数据平面的行为。而 Service Mesh Interface 是控制平面的标准，上层的应用/工具/生态体系通过 Service Mesh Interface 来实现跨不同的 Service Mesh 实现为最终用户提供一致性的体验。</p>
<p>当然这两个标准化 API 都刚刚起步，而且，标准化的工作通常不仅仅是技术问题，涉及到复杂的利益关系，具体未来走向现在难于推断，只能密切关注。</p>
<h3 id="发展趋势分析">发展趋势分析</h3>
<p>我们总结一下上面列出的 Service Mesh 最近的 6 个发展趋势：</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/trend-analysis_hu9811fb5133cd00cce7e14538cef6c4a9_80764_cc392ccccf4240b69622d3130a63452b.webp 400w,
               /blog/201905-servicemesh-development-trend/trend-analysis_hu9811fb5133cd00cce7e14538cef6c4a9_80764_27823a94fef8d781e6eda0850d54df5a.webp 760w,
               /blog/201905-servicemesh-development-trend/trend-analysis_hu9811fb5133cd00cce7e14538cef6c4a9_80764_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/trend-analysis_hu9811fb5133cd00cce7e14538cef6c4a9_80764_cc392ccccf4240b69622d3130a63452b.webp"
               width="760"
               height="373"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>这些趋势都和云有关，核心在于让云来提供能力，包括：</p>
<ul>
<li>让云承担更多职责</li>
<li>提供更高抽象</li>
<li>适用更多场景</li>
<li>减少应用负担：实现应用轻量化</li>
</ul>
<p>最终实现让业务应用<strong>专注业务</strong>的战略目标。</p>
<p>对于 Service Mesh 技术未来的走向，我的看法是：Service Mesh 技术必然不是孤立的自行发展，而是在云原生的大环境下，与云原生的其他技术、理念、最佳实践一起相互影响、相互促进、相互支撑、共同发展。云原生是一个庞大的技术体系，Service Mesh 需要在这个体系中获得各种支撑和配合，才能最大限度的发挥自身的优势。</p>
<h2 id="service-mesh-与云原生">Service Mesh 与云原生</h2>
<p>在最后一段，我们来谈谈 Service Mesh 技术和云原生的关系，也就是本次分享的标题所说的：云原生中流砥柱。</p>
<p>凭什么？</p>
<h3 id="什么是云原生">什么是云原生？</h3>
<p>在解释之前，首先问一个问题：什么是云原生？相信这个问题很多同学都问过，或者被问过，每个人心里可能都有自己的理解和表述。在今年年初，我也特意就这个问题问了自己，然后尝试着给出了一个我的答案：</p>
<p>云原生指 &ldquo;原生为云设计&rdquo;，具体说就是：<strong>应用原生被设计为在云上以最佳方式运行，充分发挥云的优势。</strong></p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/cloud-native_hued81811edfe029a78c9fb3c19c93643d_139130_4a404a1b08f3d80b79e21cf38bc5dcee.webp 400w,
               /blog/201905-servicemesh-development-trend/cloud-native_hued81811edfe029a78c9fb3c19c93643d_139130_7f6c3c938327633903e8714633510467.webp 760w,
               /blog/201905-servicemesh-development-trend/cloud-native_hued81811edfe029a78c9fb3c19c93643d_139130_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/cloud-native_hued81811edfe029a78c9fb3c19c93643d_139130_4a404a1b08f3d80b79e21cf38bc5dcee.webp"
               width="600"
               height="450"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>关于云原生的理解，以及对这句话的详细阐述，这里不详细展开，有兴趣的同学可以浏览我之前的演讲内容，讲的比较深入，厚颜自荐一下：</p>
<ul>
<li><a href="https://skyao.io/talk/201902-cloudnative-freely-talk/" target="_blank" rel="noopener">畅谈云原生（上）</a>: 如何理解云原生？云原生应用应该是什么样子？云原生下的中间件该如何发展？</li>
<li><a href="https://skyao.io/talk/201902-cloudnative-freely-talk2/" target="_blank" rel="noopener">畅谈云原生（下）</a>: 云和应用该如何衔接？如何让产品更符合云原生？</li>
</ul>
<h3 id="service-mesh-的核心价值">Service Mesh 的核心价值</h3>
<p>关于 Service Mesh 的核心价值，我个人的理解，不在于 Service Mesh 提供的玲琅满目的各种功能和特性，而是：</p>
<p><strong>实现业务逻辑和非业务逻辑的分离</strong></p>
<p>将非业务逻辑的功能实现，从客户端 SDK 中剥离出来，放到独立的 Proxy 进程中，这是 Service Mesh 在技术实现上走出的第一步，也是至关重要的第一步：因为这一步，实现了<strong>业务逻辑</strong>和<strong>非业务逻辑</strong>的分离，而且是最彻底的物理分离，哪怕需要为此付出一次远程调用的代价。</p>
<p>而这一步迈出之后，前面就是海阔天空：</p>
<ul>
<li>业务逻辑和非业务逻辑分离之后，我们就可以将这些非业务逻辑继续下沉</li>
<li>下沉到基础设施，基础设施可以是基于 VM 的，可以是基于容器和 k8s 的；也可以是 VM 和容器混合</li>
<li>基础设施也可以以云的形式提供，可以是公有云、私有云，也可以是混合云、多云；</li>
<li>可以选择云上托管，完全托管也好，部分托管也好，产品形态可以很灵活</li>
</ul>
<p>总结说，业务逻辑和非业务逻辑的分离：</p>
<ul>
<li>为下沉到基础设施提供可能</li>
<li>为上云提供可能</li>
<li>为应用轻量化提供可能</li>
</ul>
<blockquote>
<p>备注：这里说的上云，指的是上云原生 (Cloud Native) 的云，而不是上云就绪 (Cloud Ready) 的云。</p>
</blockquote>
<h3 id="mesh-化是云原生落地的关键步骤">Mesh 化是云原生落地的关键步骤</h3>
<p>在过去一年中，蚂蚁金服一直在努力探索云原生落地的方式，在这个过程中，我们有一些感悟，其中非常重要的一条就是：Mesh 化是云原生落地的关键步骤。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/cloud-native-important-step_hu0318a86734b083fb3184c30235724934_103373_ba26b3be7b3e145de18f8fefbf29b043.webp 400w,
               /blog/201905-servicemesh-development-trend/cloud-native-important-step_hu0318a86734b083fb3184c30235724934_103373_ab6f8a080428f662250d65073841afde.webp 760w,
               /blog/201905-servicemesh-development-trend/cloud-native-important-step_hu0318a86734b083fb3184c30235724934_103373_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/cloud-native-important-step_hu0318a86734b083fb3184c30235724934_103373_ba26b3be7b3e145de18f8fefbf29b043.webp"
               width="760"
               height="308"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>如上图所示：</p>
<ul>
<li>最下方是云，基于 k8s 和容器打造，提供各种基础能力，这些能力有一部分来自传统中间件的下沉</li>
<li>在云上是 Mesh 层，包含 Service Mesh 以及我们前面提到的各种扩展的 Mesh 模式，实现通信的标准化</li>
<li>在通过 Mesh 剥离非业务功能并下沉之后，应用实现了轻量化，传统的 App 和新兴的微服务都可以受益于此</li>
<li>更进一步，轻量化之后的业务应用，其工作负载在瘦身减负之后变得相当的干净，基本只剩业务逻辑，包括传统的 App，以 Container 形式运行的服务和新颖的 Function，这些负载在往 Serverless 形态转换时相对要轻松很多</li>
</ul>
<p>配合 Serverless 技术领域最新的技术潮流和产品发展（如以 knative 项目为代表，Serverless 不再仅仅是 Function 形式，也支持 BaaS 等偏传统的工作负载），Mesh 化为现有应用转型为 Serverless 模式提供助力。</p>
<p>在这里我们再分享一下蚂蚁金服对未来中间件产品发展的感悟，我们认为中间件的未来在于<strong>Mesh 化，并融入基础设施</strong>，如下图所示：</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/middleware-future_hu0b4f5e0fabc23bd6993a0f6dea00880a_127306_c086f1bc6901355777f94a891d06e42c.webp 400w,
               /blog/201905-servicemesh-development-trend/middleware-future_hu0b4f5e0fabc23bd6993a0f6dea00880a_127306_7478caa98c1fe6363a183f9c1ba95b88.webp 760w,
               /blog/201905-servicemesh-development-trend/middleware-future_hu0b4f5e0fabc23bd6993a0f6dea00880a_127306_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/middleware-future_hu0b4f5e0fabc23bd6993a0f6dea00880a_127306_c086f1bc6901355777f94a891d06e42c.webp"
               width="760"
               height="313"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>左边是传统的中间件形态，在云原生时代，我们希望将非业务功能从传统中间件的富客户端中剥离出来，然后将这些能力以及这些能力背后的中间件能力，下沉到基础设施，下沉到云。而中间件产品也会融入基础设施，如图中右边所示。未来的中间件将作为基础设施和云的一部分，而 Mesh 则成为连接应用和基础设施以及其他中间件产品的桥梁。</p>
<p>更重要的是：业务应用因此而实现轻量化，在剥离各种非业务功能之后，业务应用就实现了只关注业务逻辑的战略目标，从而实现从传统应用到云原生应用的转型。</p>
<p>总结：通过 Service Mesh 技术，我们实现了业务逻辑和非业务逻辑的分离，为应用的轻量化和云原生化提供可能；并通过将非业务逻辑的各种功能下沉到基础设施和云，极大的增强了基础设施和云的能力，为云原生的落地提供了极大助力。</p>
<p>因此，我们认为：Service Mesh 技术将在云原生落地中扮演了非常重要的作用，不可或缺。</p>
<h3 id="service-mesh-发展展望">Service Mesh 发展展望</h3>
<p>最后再次展望一下 Service Mesh 的未来发展。</p>
<p>左边是 Service Mesh 发展初期的最重要的两个原始动力：<strong>多语言支持</strong>和<strong>类库升级</strong>。关于这两点，最近这两年中介绍和推广 Service Mesh 理念和产品的同学基本都讲过，但是今天我想指出的是：这只是 Service Mesh 的<strong>起点</strong>，而远不是 Service Mesh 的终点。</p>
<p>Service Mesh 的未来，不会停留在仅仅满足多语言支持和类库升级，而是跟随云原生的大潮，解决各种实际需求，同时又尽量维持上层业务应用的简单直白。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/201905-servicemesh-development-trend/future-of-servicemesh_hu4456a5bcf6482e04c007f76fb2936cfb_118230_408fb12ebf0046213ee1b832d431ba0d.webp 400w,
               /blog/201905-servicemesh-development-trend/future-of-servicemesh_hu4456a5bcf6482e04c007f76fb2936cfb_118230_a5be3f0358b0a228bddb06f3144b9637.webp 760w,
               /blog/201905-servicemesh-development-trend/future-of-servicemesh_hu4456a5bcf6482e04c007f76fb2936cfb_118230_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/blog/201905-servicemesh-development-trend/future-of-servicemesh_hu4456a5bcf6482e04c007f76fb2936cfb_118230_408fb12ebf0046213ee1b832d431ba0d.webp"
               width="760"
               height="363"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>在这次分享的最后，我想给大家一个留一个课外作业，有心的同学可以尝试一下：如果您想更深入的理解 Service Mesh 的价值，想对 Service Mesh 未来的发展方向有更清晰的认识，尤其是希望能通过自身的思考和感悟来理解 Service Mesh 而不是简单的被灌输（包括被我灌输），那么请尝试独立的做如下思考：</p>
<ol>
<li>抛开左边的这两点，不要将思维局限在这个范围内</li>
<li>考虑云原生的大背景，结合您自身对云原生的理解，和对云的期望</li>
<li>针对右边的 Service Mesh 的六个趋势，忘记我前面讲述的内容，只考虑其背后的实际场景和客户需求，以及这个场景带来的业务价值，然后认真对比使用 Service Mesh 和不使用 Service Mesh 两种情况下的解决方案</li>
<li>请在上述思考的过程中，更多的从业务应用的角度来看待问题，假设你是那个云上的应用（还记得前面图上的小 baby 吗？），你会希望被如何对待</li>
</ol>
<p>希望这样的思考能让您有所收获。</p>

                </div>
                

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/istio/">Istio</a>
  
  <a class="badge badge-light" href="/tag/service-mesh/">service mesh</a>
  
</div>











  
  
    



  
  
  
  
  
  <div class="media author-card content-widget-hr mb-4">
    
      
      <a href="/author/%E6%95%96%E5%B0%8F%E5%89%91/"><img class="avatar mr-3 avatar-circle" src="/author/%E6%95%96%E5%B0%8F%E5%89%91/avatar_hue38add62c87b7486d80c9f3fda25dfc1_12220_270x270_fill_q75_lanczos_center.jpg" alt="敖小剑"></a>
    

    <div class="media-body">
      <p class="card-title"><a href="/author/%E6%95%96%E5%B0%8F%E5%89%91/">敖小剑</a></p>
      
      <p class="card-text">微软</p>
      
    </div>
  </div>


  





<div class="article-widget">
  
<div class="container-xl row post-nav">
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1" href="/blog/exploring-istio-telemetry-and-observability/" rel="next">
    <div class="meta-nav">下一页</div>
    <p>Istio 遥测和可观察性探索</p></a>
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1"  href="/blog/istio-observability-with-go-gprc-and-protocol-buffers-based-microservices/" rel="prev">
    <div class="meta-nav">上一页</div>
    <p>基于 Go、gRPC 和 Protobuf 的微服务的 Istio 可观察性</p></a>
  
</div>

</div>










  

<p class="edit-page">
  <a href="https://github.com/cloudnativeto/cloudnative.to/edit/master/content/blog/201905-servicemesh-development-trend/index.md">
    <i class="fas fa-pen pr-2"></i>编辑本页
  </a>
</p>




  
  
  <div class="article-widget content-widget-hr">
    <p class="related-title">相关推荐</p>
    <ul>
      
      <li><a href="/blog/resiliency-app-aware-network/">利用服务网格和智能应用感知网络增强应用弹性</a></li>
      
      <li><a href="/blog/ebpf-solve-service-mesh-sidecar/">告别 Sidecar——使用 eBPF 解锁内核级服务网格</a></li>
      
      <li><a href="/blog/jimmy-service-mesh-talk/">都 2021 年了，对于服务网格，社区到底在讨论什么？</a></li>
      
      <li><a href="/blog/istiocon-layer7-traffic/">使用 Aeraki 在 Isito 中支持 Dubbo、Thrift、Redis，以及任何七层协议</a></li>
      
      <li><a href="/blog/the-facts-of-using-istio/">在生产环境使用 Istio 前的若干考虑要素</a></li>
      
    </ul>
  </div>
  





  
  
  

  

  
  <section id="comments" class="mb-3 pt-0">
    <script>
  let themeNumber = localStorage.getItem('wcTheme');
  var giscusTheme = "light";
  if (themeNumber == 1){
    giscusTheme = "dark";
  }
  let giscusAttributes = {
    "src": "https://giscus.app/client.js",
    "data-theme": giscusTheme,
    "data-repo":"cloudnativeto\/cloudnative.to",
    "data-repo-id":"MDEwOlJlcG9zaXRvcnkyMzc3NDUxOTA=",
    "data-category":"General",
    "data-category-id":"MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDU5MzUy",
    "data-mapping":"pathname",
    "data-reactions-enabled":"",
    "data-emit-metadata":"0",
    "data-input-position":"top",
    "data-theme":giscusTheme,
    "data-lang":"zh-CN",
    "data-loading":"lazy",
    "crossorigin":"annoymous",
    "origins":"https://cloudnative.to",
    "originsRegex":"http://localhost:[0-9]+",
    "async": "",
  };

  let giscusScript = document.createElement("script");
  Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
  document.querySelector('#comments').appendChild(giscusScript);
</script>

  </section>
  



            </article>
        </main>
    </div>
</div>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">© 2020-2023 云原生社区保留所有权利</p>
        </div>
    </div>
  </div>

</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.46271ef31da3f018e9cd1b59300aa265.js"></script>




  

  
  

  

  
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
    
    
  










  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <div class="article-metadata search-hit-type">{{relpermalink}}</div>
          <a href="{{relpermalink}}">{{title}}</a>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":false}</script>










  
  


<script src="/zh/js/wowchemy.min.24983018b0e5661cd5fe1822254286ea.js"></script>







<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
<script>
  anchors.add();
</script>



<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, '已复制')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>



<script>

function Collapse(e){
  var node = document.getElementById(e);
  if (node.className.indexOf('fa-angle-down') > -1){
    node.setAttribute("class", "fa-solid fa-angle-right");
    }else{
    node.setAttribute("class", "fa-solid fa-angle-down");
    }
}
</script>


</body>
</html>
