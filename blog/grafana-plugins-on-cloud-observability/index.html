<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
  

  

  
  
  
    
  
  <meta name="description" content="分享可观测性场景下 Grafana Plugin 的开发细节和原理。" />

  
  <link rel="alternate" hreflang="zh" href="https://cloudnativecn.com/blog/grafana-plugins-on-cloud-observability/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.008259417e6adf8980695ebbbb46553f.css" />

  



  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f3dc895ea3bd6186cd835841d365c103";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu11854384586569594417.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu14437075198232143360.png" />

  <link rel="canonical" href="https://cloudnativecn.com/blog/grafana-plugins-on-cloud-observability/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@CloudNativeCN" />
    <meta property="twitter:creator" content="@CloudNativeCN" />
  
  <meta property="og:site_name" content="云原生社区（中国）" />
  <meta property="og:url" content="https://cloudnativecn.com/blog/grafana-plugins-on-cloud-observability/" />
  <meta property="og:title" content="可观测性场景下 Grafana Plugin 开发实战 | 云原生社区（中国）" />
  <meta property="og:description" content="分享可观测性场景下 Grafana Plugin 的开发细节和原理。" /><meta property="og:image" content="https://cloudnativecn.com/media/sharing.png" />
    <meta property="twitter:image" content="https://cloudnativecn.com/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
      <meta
        property="article:published_time"
        content="2022-12-28T12:00:00&#43;08:00"
      />
    
    <meta property="article:modified_time" content="2025-02-06T16:58:28&#43;08:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cloudnativecn.com/blog/grafana-plugins-on-cloud-observability/"
  },
  "headline": "可观测性场景下 Grafana Plugin 开发实战",
  
  "datePublished": "2022-12-28T12:00:00+08:00",
  "dateModified": "2025-02-06T16:58:28+08:00",
  
  "author": {
    "@type": "Person",
    "name": "周振宇"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "云原生社区（中国）",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cloudnativecn.com/media/logo.svg"
    }
  },
  "description": "分享可观测性场景下 Grafana Plugin 的开发细节和原理。"
}
</script>

  

  

  

  





  <title>可观测性场景下 Grafana Plugin 开发实战 | 云原生社区（中国）</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="4ba2c32db1104b2f28adb02293950124" >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.62d6f8dfe8493f1c68557dde65bec362.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="关闭"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="搜索..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="搜索...">
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生社区（中国）"
            
            ></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生社区（中国）"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/community"><span>社区</span></a>
          </li>

          
          

          

          
          
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link  active" href="/blog"><span>博客</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>小组</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/k8s-gateway-api"><span>Kubernetes Gateway API SIG</span></a>
              
            </div>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>资料</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/envoy/"><span>Envoy 中文文档</span></a>
              
                <a class="dropdown-item" href="/kubebuilder/"><span>Kubebuilder 中文文档</span></a>
              
                <a class="dropdown-item" href="https://istio.io/latest/zh/"><span>云原生资料库</span></a>
              
            </div>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/event"><span>活动</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#feed"><span>更新</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#tags"><span>标签</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>关于</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        

        
        <li class="nav-item">
            <a class="nav-link" href="/community/join/" data-toggle="tooltip" data-placement="bottom" title="加入社区" aria-label="主站"><i class="fa-brands fa-weixin" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link js-search" href="#" data-toggle="tooltip" data-placement="bottom" title="搜索" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item d-none d-lg-inline-flex">
            <a class="nav-link" href="https://github.com/cloudnativeto/cloudnative.to" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="查看源码" aria-label="查看源码" aria-label="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item">
          <a href="#" class="nav-link set-theme">
            <i class="fa fa-sun" aria-hidden="true" id="theme-icon"></i>
          </a>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <div class="container-xl">
    <div class="post-container">
        












  

  
  
  
<div class="article-container pt-3">
  <h1>可观测性场景下 Grafana Plugin 开发实战</h1>

  

  
    


<div class="article-metadata">

  <div>
  
  
  
  
    <i class="fa-solid fa-feather"></i>
    

  <span >
      <a href="/author/%E5%91%A8%E6%8C%AF%E5%AE%87/">周振宇</a></span>
    
    <span class="middot-divider"></span>
    
  
  
  
  
  
  
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/category/%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7/" class="text-capitalize">可观测性</a></span>
  
  </div>

  
  <span class="article-date">
    
    
      
          
          发布于
      
    
    2022-12-28
  </span>
  

  

  
  <span class="middot-divider"></span>
  字数 3809
  <span class="middot-divider"></span>
  <span class="article-reading-time">
      阅读时长 17 分钟
  </span>
  

  
  
  
  

</div>

    





  
</div>


    </div>
    <div class="border-bottom mb-2"></div>
    <div class="row flex-xl-nowrap">
        <div class="col-3 d-none d-xl-block docs-toc">
            <!-- toc -->
            
<div class="">
    <ul class="nav toc-top">
        <li>
            <a href="#" id="back_to_top" class="docs-toc-title">目录</a>
        </li>
    </ul>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#deepflow-插件简介">DeepFlow 插件简介</a></li>
    <li><a href="#data-source-plugin">Data source plugin</a></li>
    <li><a href="#deepflow-查询数据逻辑简介">DeepFlow 查询数据逻辑简介</a></li>
    <li><a href="#data-source-plugin-对数据的处理">Data source plugin 对数据的处理</a></li>
    <li><a href="#deepflow-topo-panel">DeepFlow Topo panel</a></li>
    <li><a href="#deepflow-apptracing-panel">DeepFlow AppTracing panel</a></li>
    <li><a href="#deepflow-vis">DeepFlow-Vis</a></li>
    <li><a href="#next">Next</a></li>
    <li><a href="#什么是-deepflow">什么是 DeepFlow</a></li>
  </ul>
</nav>
</div>

            <!-- /toc -->
            
            <div class="subscribe-module col-12 mt-1">
    <img src="/img/wechat.jpg" alt="image" title="云原生社区的微信公众号"/>
    <p class="text-center pt-1">关注「云原生社区动态」微信公众号，获取本站更新</p>
</div>

            
        </div>
        <main class="article-body col-9 container docs-content" role="main">
            <article class="article">
                <div class="article-style">
                    
                    <details class="toc-inpage d-print-none d-show-block mb-0">
  <summary class="font-weight-bold">点击查看目录</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#deepflow-插件简介">DeepFlow 插件简介</a></li>
    <li><a href="#data-source-plugin">Data source plugin</a></li>
    <li><a href="#deepflow-查询数据逻辑简介">DeepFlow 查询数据逻辑简介</a></li>
    <li><a href="#data-source-plugin-对数据的处理">Data source plugin 对数据的处理</a></li>
    <li><a href="#deepflow-topo-panel">DeepFlow Topo panel</a></li>
    <li><a href="#deepflow-apptracing-panel">DeepFlow AppTracing panel</a></li>
    <li><a href="#deepflow-vis">DeepFlow-Vis</a></li>
    <li><a href="#next">Next</a></li>
    <li><a href="#什么是-deepflow">什么是 DeepFlow</a></li>
  </ul>
</nav>
</details>

                    
                    <p>本文为云杉网络<code>原力释放 - 云原生可观测性分享会</code>第十三期直播实录。<a href="https://www.bilibili.com/video/BV1f44y1m7n8/?spm_id_from=333.788&amp;vd_source=37077a01afa812c311092cba5befac7c" target="_blank" rel="noopener">回看链接</a>，<a href="http://yunshan-guangzhou.oss-cn-beijing.aliyuncs.com/yunshan-ticket/pdf/95b33b06763f2d05b77c18327aa38c3c_20221213150423.pdf" target="_blank" rel="noopener">PPT 下载</a>。</p>
<p>Grafana 是目前最广泛使用的数据可视化软件之一，DeepFlow 中已有大量基于 Grafana Dashboard 解决的可观测性场景的实战分享。这些场景都是基于 DeepFlow Grafana 插件提供的查询能力来构建的。DeepFlow 社区致力于基于开源生态构建一个完整的可观测性平台，而终端呈现和数据的可视化呈现是其中的重要一环。本文对当前 DeepFlow 提供的 Grafana 插件做一个简单介绍，抛砖引玉，希望大家能了解并创造更多的 DeepFlow 可观测性生态应用，也希望能让大家掌握如何开发一套完整的 Grafana Plugin。</p>
<h2 id="deepflow-插件简介">DeepFlow 插件简介</h2>
<p>在最早的 DeepFlow 企业版中，我们提供了一些比较简单的 Grafana 插件。这些插件是基于 DeepFlow 企业版 API 来提供服务的，目的是为了能让用户无缝将 DeepFlow 页面中的视图在自己的 Grafana 环境中搭建起来，避免改变用户的使用习惯。在 DeepFlow 宣布开源以后，我们基于社区版重新设计了若干插件。包括：</p>
<ul>
<li>Data source plugin：DeepFlow Querier，用于为 Grafana 提供 DeepFlow 的数据</li>
<li>Panel plugin：DeepFlow AppTracing，用于展示分布式追踪火焰图</li>
<li>Panel plugin：DeepFlow Topo，用于展示服务之间的访问关系</li>
</ul>
<p>这些定制化插件，配合 Grafana 原本提供的一系列标准图表，可以构建出一组完整的 DeepFlow 可观测性视图。可以前往我们的<a href="https://ce-demo.deepflow.yunshan.net/d/pplication_DNS_Monitoring/application-dns-monitoring?orgId=1" target="_blank" rel="noopener">在线 Demo</a> 快速体验。</p>
<h2 id="data-source-plugin">Data source plugin</h2>
<p>Grafana 的 Data source 插件是用来将数据源接入 Grafana 体系中的核心插件。DeepFlow 架构中，提供了基于 SQL 查询语句的 Querier 接口，因此我们的 Data source 插件会基于这个查询语法，来提供用户完全自由的查询。</p>
<p>















<figure  id="figure-deepflow-架构">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./20221214639946e49a2f2.png" alt="DeepFlow 架构" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      DeepFlow 架构
    </figcaption></figure>
</p>
<p>从代码的文件结构，Data source 插件主要有如下部分：</p>
<ul>
<li>ConfigEditor 是在 Grafana 中加入数据源时配置编辑模块，一般用于配置数据源本身连接方式、账户密码等。只需要实现对应的 ConfigEditor 类即可实现对应的编辑界面。</li>
<li>QueryEditor 是构建数据源查询界面的主要模块，通过实现 QueryEditor 类即可实现编辑界面，其中可以自由引用 Grafana 自带 UI 库或者其他第三方库进行界面实现。</li>
<li>Grafana 在 dashboard 中还可以支持变量。通过实现 VariableQueryEditor 可以实现自定义的变量动态查询，方便 dashboard 中关联使用。</li>
<li>datasource.ts 是核心的逻辑模块，用于处理从界面接受的配置项，并从后端进行查询并对返回数据进行处理</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>zhenyu@dev202 deepflow-gui-grafana<span class="o">]</span>$ tree deepflow-querier-datasource/src/ -L <span class="m">1</span>
</span></span><span class="line"><span class="cl">deepflow-querier-datasource/src/
</span></span><span class="line"><span class="cl">├── components
</span></span><span class="line"><span class="cl">├── ConfigEditor.tsx
</span></span><span class="line"><span class="cl">├── consts.ts
</span></span><span class="line"><span class="cl">├── datasource.ts
</span></span><span class="line"><span class="cl">├── img
</span></span><span class="line"><span class="cl">├── index.d.ts
</span></span><span class="line"><span class="cl">├── module.ts
</span></span><span class="line"><span class="cl">├── plugin.json
</span></span><span class="line"><span class="cl">├── QueryEditor.css
</span></span><span class="line"><span class="cl">├── QueryEditor.tsx
</span></span><span class="line"><span class="cl">├── types.ts
</span></span><span class="line"><span class="cl">├── update-dashboards.js
</span></span><span class="line"><span class="cl">└── utils
</span></span></code></pre></div><p>模块之间的关系如下图：</p>
<p>















<figure  id="figure-插件代码结构">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./202212096392dfcb09cf3.png" alt="插件代码结构" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      插件代码结构
    </figcaption></figure>
</p>
<p>注意其中需要在插件的 plugin.json 中配置相关的 proxy 信息，这样能让 Grafana core 中的 backendsrv 知道该如何转发去往 querier 的请求。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;auth&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;{{ .JsonData.requestUrl }}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;headers&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Content-Type&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;content&#34;</span><span class="p">:</span> <span class="s2">&#34;application/x-www-form-urlencoded&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;authorization&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;content&#34;</span><span class="p">:</span> <span class="s2">&#34;Bearer {{ .JsonData.token }}&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="err">,</span>
</span></span></code></pre></div><p>从执行的数据流角度，Data source 插件中的数据流如下：</p>
<ul>
<li>将用户在 QueryEditor 中输入的查询内容，构造为一个标准 JSON 结构</li>
<li>将 JSON 化的查询条件通过 DeepFlow Querier SDK 生成一个有效的查询语句（SQL）</li>
<li>将语句封装为 API 请求</li>
<li>通过 plugin 的 plugin.json 中设置的 proxy 转发至 DeepFlow Querier</li>
<li>将 DeepFlow Querier 返回的数据转换为符合 Panel 需要的数据</li>
<li>在 Panel 中将数据可视化呈现</li>
</ul>
<p>















<figure  id="figure-数据流">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./202212096392dfec166f5.png" alt="数据流" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      数据流
    </figcaption></figure>
</p>
<p>其中，DeepFlow Querier SDK 是一个 DeepFlow 的内部转换库，可以将标准化的 JSON 结构转换为 SQL 或者 DeepFlow APP 所需要的参数格式。</p>
<p>上述数据流中最后一步，是将从 Querier 中获取查询到的数据，并可以将这些数据发送给 Panel 模块，用于可视化展示。</p>
<h2 id="deepflow-查询数据逻辑简介">DeepFlow 查询数据逻辑简介</h2>
<p>在如何将查询数据结果进行可视化展现之前，需要简单的介绍下 DeepFlow 的数据查询逻辑。</p>
<p>DeepFlow 中的数据表，一般会分为双端表和单端表两种：</p>
<ul>
<li>单端表是对单个服务或实例的统计数据，数据本身没有方向。例如某个 K8s 服务的 RED 指标数据，某个进程的网络性能指标等等。这种数据一般适合用常规的折线、柱图、表格等展示。</li>
<li>双端表是对 A 服务到 B 服务的访问路径的统计数据，有源、目的、方向等区分。例如，<code>A -&gt; B</code> 和 <code>B -&gt; A</code> 是两条不同的数据。这种数据一般适合用拓扑图等表征访问关系的视图进行展示。目前双端表有：
<ul>
<li>flow_metrics.vtap_app_edge_port：服务之间的应用访问关系和性能指标</li>
<li>flow_metrics.vtap_flow_edge_port：服务之间的网络访问关系和性能指标</li>
<li>flow_log.l7_flow_log：应用调用日志</li>
<li>flow_log.l4_flow_log：网络流日志</li>
</ul>
</li>
</ul>
<p>除此之外，DeepFlow 的存储数据和其他主流 TSDB/OLAP 也一样，所有的表都会有时间列、有 Tag 和 Metric 的区分，以及支持数据的分组聚合能力。</p>
<p>















<figure  id="figure-分组聚合">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./2022121463996a6ae21d4.png" alt="分组聚合" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      分组聚合
    </figcaption></figure>
</p>
<p>图中每个小圆点代表一行数据。查询到的原始数据，经过分组后，每组中有若干条数据，再对每组数据中进行聚合计算，每个分组得到一列数据。</p>
<p>这样的查询方式，可以很方便的查询出如下场景的数据：</p>
<ul>
<li>每分钟的平均请求数 <code>SELECT AVG(request) ... GROUP BY INTERVAL(time, 60)</code></li>
<li>每个 K8s Pod 在每分钟中的平均 TCP 重传比率 <code>SELECT AVG(retrans_ratio) ... GROUP BY INTERVAL(time, 60), pod</code></li>
</ul>
<p>从 QueryEditor UI 收集到的用户输入，会通过统一模块转换为 querier 认识的 SQL 语句，或者 API 约定的参数结构。我们提供了一个 SDK <code>deepflow-sdk-js</code>，可以按需将结构化的数据生成指定的文本输出。</p>
<p>这个 SDK 中，会首先对结构数据补充相关的信息，例如：</p>
<ul>
<li>实例分组转换为实例 ID 的分组，避免实例之间的重名</li>
<li>自动增加 <code>node_type</code>、<code>icon_id</code> 等算子，用于附加实例的类型和对应图标等信息</li>
<li>实现对枚举类型的自动翻译，例如 <code>protocol</code> 会自动附加 <code>Enum(protocol)</code></li>
<li>自动进行别名转换，以可读的方式展示每一列数据名称</li>
</ul>
<p>SDK 中还会通过指定函数或者操作符的序列化，按照定制方式生成 SQL 语句。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">OP</span><span class="p">.</span><span class="nx">EQ</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">a</span><span class="si">}</span><span class="sb">=</span><span class="si">${</span><span class="nx">escape</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">OP</span><span class="p">.</span><span class="nx">NEQ</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">a</span><span class="si">}</span><span class="sb">!=</span><span class="si">${</span><span class="nx">escape</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">OP</span><span class="p">.</span><span class="nx">LT</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">a</span><span class="si">}</span><span class="sb">&lt;</span><span class="si">${</span><span class="nx">escape</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">OP</span><span class="p">.</span><span class="nx">LTE</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">a</span><span class="si">}</span><span class="sb">&lt;=</span><span class="si">${</span><span class="nx">escape</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">OP</span><span class="p">.</span><span class="nx">GT</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">a</span><span class="si">}</span><span class="sb">&gt;</span><span class="si">${</span><span class="nx">escape</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">OP</span><span class="p">.</span><span class="nx">GTE</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">a</span><span class="si">}</span><span class="sb">&gt;=</span><span class="si">${</span><span class="nx">escape</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">OP</span><span class="p">.</span><span class="nx">IN</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">formatIn</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">OP</span><span class="p">.</span><span class="nx">NOT_IN</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">formatIn</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">OP</span><span class="p">.</span><span class="nx">REGEXP</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">a</span><span class="si">}</span><span class="sb"> REGEXP </span><span class="si">${</span><span class="nx">escape</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">OP</span><span class="p">.</span><span class="nx">NOT_REGEXP</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">a</span><span class="si">}</span><span class="sb"> NOT REGEXP </span><span class="si">${</span><span class="nx">escape</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">OP</span><span class="p">.</span><span class="nx">AS</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">a</span><span class="si">}</span><span class="sb"> AS \`</span><span class="si">${</span><span class="nx">b</span><span class="si">}</span><span class="sb">\``</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">OP</span><span class="p">.</span><span class="nx">SELF</span><span class="p">]</span><span class="o">:</span> <span class="nx">a</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">a</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">OP</span><span class="p">.</span><span class="nx">INTERVAL</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="sb">`time(</span><span class="si">${</span><span class="nx">a</span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="nx">b</span><span class="si">}</span><span class="sb">)`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">OP</span><span class="p">.</span><span class="nx">LIKE</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">formatLike</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">OP</span><span class="p">.</span><span class="nx">NOT_LIKE</span><span class="p">]</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">formatLike</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
</span></span></code></pre></div><p>其中还会对一些逻辑运算符进行自动的化简和合并。例如条件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">and</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">or</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">and</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">not</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">and</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="nx">eq</span><span class="p">(</span><span class="s2">&#34;vm_name&#34;</span><span class="p">,</span> <span class="s1">&#39;ab c&#34; bla&#34;&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="nx">eq</span><span class="p">(</span><span class="s2">&#34;ip&#34;</span><span class="p">,</span> <span class="s2">&#34;10.1.1.1&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="nx">eq</span><span class="p">(</span><span class="s2">&#34;subnet&#34;</span><span class="p">,</span> <span class="s2">&#34;subnet_1&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="nx">oneOf</span><span class="p">(</span><span class="s2">&#34;subnet&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;subnet_1&#34;</span><span class="p">,</span> <span class="s2">&#34;subnet_2&#34;</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">          <span class="nx">like</span><span class="p">(</span><span class="s2">&#34;host&#34;</span><span class="p">,</span> <span class="s2">&#34;host.*&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="nx">or</span><span class="p">(</span><span class="nx">and</span><span class="p">(</span><span class="nx">lt</span><span class="p">(</span><span class="s2">&#34;bps&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">lte</span><span class="p">(</span><span class="s2">&#34;rps&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">lt</span><span class="p">(</span><span class="s2">&#34;bps&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">and</span><span class="p">(</span><span class="nx">not</span><span class="p">(</span><span class="nx">or</span><span class="p">(</span><span class="nx">lt</span><span class="p">(</span><span class="s2">&#34;rps&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">and</span><span class="p">(</span><span class="nx">and</span><span class="p">(</span><span class="nx">lt</span><span class="p">(</span><span class="s2">&#34;bps&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">lte</span><span class="p">(</span><span class="s2">&#34;rps&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="nx">falseOp</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p>输出的条件结果为：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">(</span><span class="n">vm_name</span><span class="o">!=</span><span class="s1">&#39;ab c&#34; bla&#34;&#39;</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">ip</span><span class="o">!=</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">subnet</span><span class="o">!=</span><span class="s1">&#39;subnet_1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">OR</span><span class="w"> </span><span class="n">subnet</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;subnet_1&#39;</span><span class="p">,</span><span class="s1">&#39;subnet_2&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">host</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="n">REGEXP</span><span class="w"> </span><span class="s1">&#39;host.*&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">bps</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">rps</span><span class="o">&lt;=</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">OR</span><span class="w"> </span><span class="n">bps</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">rps</span><span class="o">&gt;=</span><span class="mi">3</span><span class="w">
</span></span></span></code></pre></div><h2 id="data-source-plugin-对数据的处理">Data source plugin 对数据的处理</h2>
<p>通过上面的 Data source 插件，我们已经成功从 Querier 中查询出一组数据。接下来需要将这些数据进行展示。很简单的，通过 Grafana 列表插件，我们可以得到这组数据的列表：</p>
<p>















<figure  id="figure-数据列表">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./20221206638f00ee8300d.png" alt="数据列表" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      数据列表
    </figcaption></figure>
</p>
<p>但如果我们进一步想要画出这个列表对应的折线图时，会遇到一个问题：如何将这些数据整理为折线图 Panel 所需要的数据结构呢？在折线图中，需要每条线有单独的 Series，而我们目前只有一个 <code>data: Record&lt;string, any&gt;[]</code> 结构的数据。当我们需要展示多条线时，是无法画出想要的图的。</p>
<p>因此我们在 Data source plugin 中提供了一个输出格式的转换选择，可以根据选择的 Panel 转换为不同的数据结构：</p>
<p>















<figure  id="figure-格式化数据">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./20221206638f02880686e.png" alt="格式化数据" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      格式化数据
    </figcaption></figure>
</p>
<p>当选择折线图时，会把数据转换为 <code>data: [{time: timestamp, 组1: number}, {time: timestamp, 组2: number}, ...}]</code> 的结构，这样折线图 Panel 会按组绘制出对应的折线。</p>
<p>在数据转换时，会根据分组的 Tag 中所有可能取值进行分组。例如当分组条件为 Pod 时，就能绘制出每个 Pod 的折线：</p>
<p>















<figure  id="figure-分组折线图">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./20221206638f05a84acfc.png" alt="分组折线图" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      分组折线图
    </figcaption></figure>
</p>
<p>其中<code>组X</code> 的名称，可以通过自定义的形式进行格式化：</p>
<p>















<figure  id="figure-格式化名称">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./20221206638f062cca546.png" alt="格式化名称" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      格式化名称
    </figcaption></figure>
</p>
<p>同样，在选择拓扑图时，也需要对返回的数据做二次处理，将数据处理为 Panel 识别的格式。</p>
<h2 id="deepflow-topo-panel">DeepFlow Topo panel</h2>
<p>DeepFlow 中大量数据都在描述微服务之间的访问关系，因此需要一个流量拓扑图来进行展示这些数据。我们基于 d3.js 来构建流量拓扑，主要的考虑点为：</p>
<ul>
<li>自由度更高</li>
<li>更能满足产品经理的各种要求</li>
</ul>
<p>绘制流量拓扑时，我们使用客户端优先的模式进行宽度优先搜索，将单纯的客户端节点作为第一层，然后遍历去构建出整个拓扑。</p>
<p>在普通拓扑的基础上，我们还提供了瀑布拓扑的展现形式，可以有序的呈现拓扑各节点的关系：</p>
<p>















<figure  id="figure-瀑布拓扑">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./20221214639943f4432ad.png" alt="瀑布拓扑" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      瀑布拓扑
    </figcaption></figure>
</p>
<p>瀑布拓扑会提供额外的分组能力，能够对拓扑做二次分组：</p>
<p>















<figure  id="figure-瀑布拓扑的二次分组能力">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./202212146399443d643ca.png" alt="瀑布拓扑的二次分组能力" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      瀑布拓扑的二次分组能力
    </figcaption></figure>
</p>
<p>瀑布拓扑使用普通拓扑嵌套的方式构建，可以实现在分组聚合情况下的拓扑展示。</p>
<h2 id="deepflow-apptracing-panel">DeepFlow AppTracing panel</h2>
<p>AppTracing panel 用来展现应用追踪数据。这些数据是从应用访问中通过 eBPF、cBPF、OpenTelemetry 等采集到的一组结构化日志数据，有起始时间，也有从属关系。通过时间先后关系和从属关联，构建出应用访问的火焰图。</p>
<p>















<figure  id="figure-分布式追踪">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./20221214639942c884286.png" alt="分布式追踪" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      分布式追踪
    </figcaption></figure>
</p>
<p>除了使用 DeepFlow AppTracing panel 来可视化应用追踪数据，我们也支持使用 Grafana Tempo 来显示 DeepFlow 的 Tracing 数据。</p>
<p>我们设计了一个完全模拟 Grafana Tempo backend 的模块，通过实现 Tempo 的 API，可以无缝将 DeepFlow 中的统计数据注入 Tempo UI 中显示，而且不需要额外部署 Tempo 后端：</p>
<p>DeepFlow 使用 Tempo Panel, 通过 <code>deepflow-server</code> 替代 tempo 的 backend：</p>
<p>















<figure  id="figure-deepflow-tempo">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./2022121363985b3136396.png" alt="DeepFlow-Tempo" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      DeepFlow-Tempo
    </figcaption></figure>
</p>
<p>其中需要实现的 API:</p>
<p>















<figure  id="figure-tempo-api">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./2022121363984b093583b.png" alt="Tempo-API" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Tempo-API
    </figcaption></figure>
</p>
<h2 id="deepflow-vis">DeepFlow-Vis</h2>
<p>上述的两个 Panel 插件，核心都是一组基于 d3.js 的可视化库。这些功能我们整合到一个独立的可视化库中，为 Panel 提供绘图能力。</p>
<p>















<figure  id="figure-deepflow-vis">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="./202212146399428a4e867.png" alt="DeepFlow-Vis" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      DeepFlow-Vis
    </figcaption></figure>
</p>
<p>DeepFlow-Vis 提供如下能力：</p>
<ul>
<li>元素的抽象，提供了应用层的抽象元素</li>
<li>几何计算，提供元素本身的几何运算，并提供一些简单的布局模型</li>
<li>提供属性和绘图元素的直接获取，调用层可以很方便的获取数据以及基础的 dom/svg 等对象，方便自行修改</li>
<li>提供了一个独立的渲染层，可以使用不同的方式进行渲染输出，如使用 canvas 替换 svg</li>
</ul>
<p>这些能力是以一个比较松散的结构组合在一起，因此在人力有限的情况下，可以更快的实现不同需求场景下的不同适配。</p>
<p>在此之上，提供了一些封装好的绘图，并实装在 AppTracing 和 Topo panel 中。</p>
<h2 id="next">Next</h2>
<p>我们计划在 DeepFlow 后续版本中，将对应的 Grafana 插件及相关库全部开源，并完成在 Grafana 官方的注册。也欢迎大家能够一起加入，丰富 DeepFlow 客观性的生态。</p>
<h2 id="什么是-deepflow">什么是 DeepFlow</h2>
<p><a href="https://github.com/deepflowys/deepflow" target="_blank" rel="noopener">DeepFlow</a> 是一款开源的高度自动化的可观测性平台，是为云原生应用开发者建设可观测性能力而量身打造的全栈、全链路、高性能数据引擎。DeepFlow 使用 eBPF、WASM、OpenTelemetry 等新技术，创新的实现了 AutoTracing、AutoMetrics、AutoTagging、SmartEncoding 等核心机制，帮助开发者提升埋点插码的自动化水平，降低可观测性平台的运维复杂度。利用 DeepFlow 的可编程能力和开放接口，开发者可以快速将其融入到自己的可观测性技术栈中。</p>
<p>GitHub 地址：https://github.com/deepflowys/deepflow</p>
<p>访问 <a href="https://deepflow.yunshan.net/docs/zh/install/overview/" target="_blank" rel="noopener">DeepFlow Demo</a>，体验高度自动化的可观测性新时代。</p>

                </div>
                

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7/">可观测性</a>
  
  <a class="badge badge-light" href="/tag/grafana-plugin/">Grafana Plugin</a>
  
  <a class="badge badge-light" href="/tag/deepflow/">DeepFlow</a>
  
</div>











  
  
    



  
  
  
  
  
  <div class="media author-card content-widget-hr mb-4">
    
      
      <a href="/author/%E5%91%A8%E6%8C%AF%E5%AE%87/"><img class="avatar mr-3 avatar-circle" src="/author/%E5%91%A8%E6%8C%AF%E5%AE%87/avatar_hu3801682002625739492.jpg" alt="周振宇"></a>
    

    <div class="media-body">
      <p class="card-title"><a href="/author/%E5%91%A8%E6%8C%AF%E5%AE%87/">周振宇</a></p>
      
      <p class="card-text">DeepFlow 前端技术专家</p>
      
    </div>
  </div>


  





<div class="article-widget">
  
<div class="container-xl row post-nav">
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1" href="/blog/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely/" rel="next">
    <div class="meta-nav">下一页</div>
    <p>如何将服务网格作为安全模型的一部分，以分层形式将微服务安全与传统安全结合起来</p></a>
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1"  href="/blog/egress-for-k8s/" rel="prev">
    <div class="meta-nav">上一页</div>
    <p>是时候思考 Kubernetes 出向流量安全了</p></a>
  
</div>

</div>










  

<p class="edit-page">
  <a href="https://github.com/cloudnativeto/cloudnative.to/edit/master/content/blog/grafana-plugins-on-cloud-observability/index.md">
    <i class="fas fa-pen pr-2"></i>编辑本页
  </a>
</p>




  
  
  <div class="article-widget content-widget-hr">
    <p class="related-title">相关推荐</p>
    <ul>
      
      <li><a href="/blog/service-map-observation-performance-test/">使用全景拓扑持续跟踪云原生应用的压测性能瓶颈</a></li>
      
      <li><a href="/blog/k8s-service-exception-troubleshooting/">Kubernetes 服务异常排障过程全解密</a></li>
      
      <li><a href="/blog/why-the-latest-advances-in-opentelemetry-are-significant/">OpenTelemetry 的最新进展及其对可观测性的影响</a></li>
      
      <li><a href="/blog/opentelemetry-and-observability-looking-forward/">OpenTelemetry 与可观测性：展望未来</a></li>
      
      <li><a href="/blog/opentelemetry-best-practices/">OpenTelemetry 最佳实践：用户入门指南</a></li>
      
    </ul>
  </div>
  





  
  
  

  

  
  <section id="comments" class="mb-3 pt-0">
    <script>
  let themeNumber = localStorage.getItem('wcTheme');
  var giscusTheme = "light";
  if (themeNumber == 1){
    giscusTheme = "dark";
  }
  let giscusAttributes = {
    "src": "https://giscus.app/client.js",
    "data-theme": giscusTheme,
    "data-repo":"cloudnativeto\/cloudnative.to",
    "data-repo-id":"MDEwOlJlcG9zaXRvcnkyMzc3NDUxOTA=",
    "data-category":"General",
    "data-category-id":"MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDU5MzUy",
    "data-mapping":"pathname",
    "data-reactions-enabled":"",
    "data-emit-metadata":"0",
    "data-input-position":"top",
    "data-theme":giscusTheme,
    "data-lang":"zh-CN",
    "data-loading":"lazy",
    "crossorigin":"annoymous",
    "origins":"https://cloudnativecn.com",
    "originsRegex":"http://localhost:[0-9]+",
    "async": "",
  };

  let giscusScript = document.createElement("script");
  Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
  document.querySelector('#comments').appendChild(giscusScript);
</script>

  </section>
  



            </article>
        </main>
    </div>
</div>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">© 2020-2024 云原生社区保留所有权利</p>
        </div>
    </div>
  </div>

</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.4684ca30d68fb8aed8d4debfcc18beed.js"></script>




  

  
  

  

  
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
    
    
  










  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <div class="article-metadata search-hit-type">{{relpermalink}}</div>
          <a href="{{relpermalink}}">{{title}}</a>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":false}</script>










  
  


<script src="/zh/js/wowchemy.min.85fc5fdbc5de9f11d741a1c4a48fe458.js"></script>







<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
<script>
  anchors.add();
</script>



<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, '已复制')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>



<script>

function Collapse(e){
  var node = document.getElementById(e);
  if (node.className.indexOf('fa-angle-down') > -1){
    node.setAttribute("class", "fa-solid fa-angle-right");
    }else{
    node.setAttribute("class", "fa-solid fa-angle-down");
    }
}
</script>


</body>
</html>
