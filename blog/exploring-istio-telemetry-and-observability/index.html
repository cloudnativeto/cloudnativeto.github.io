<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
  

  

  
  
  
    
  
  <meta name="description" content="文章介绍了 istio 环境下，如何结合 Prometheus 进行网络度量指标监测，给出了一些示例配置。最后，还推广了一下 Banzai Cloud 自家的 Pipeline，天然支持跨云、混合云情况下的网络度量监测，欢迎体验。" />

  
  <link rel="alternate" hreflang="zh" href="https://cloudnativecn.com/blog/exploring-istio-telemetry-and-observability/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.008259417e6adf8980695ebbbb46553f.css" />

  



  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f3dc895ea3bd6186cd835841d365c103";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu_5687ba431e9f3ad9.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu_e6256ffc27bfd989.png" />

  <link rel="canonical" href="https://cloudnativecn.com/blog/exploring-istio-telemetry-and-observability/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@CloudNativeCN" />
    <meta property="twitter:creator" content="@CloudNativeCN" />
  
  <meta property="og:site_name" content="云原生社区（中国）" />
  <meta property="og:url" content="https://cloudnativecn.com/blog/exploring-istio-telemetry-and-observability/" />
  <meta property="og:title" content="Istio 遥测和可观察性探索 | 云原生社区（中国）" />
  <meta property="og:description" content="文章介绍了 istio 环境下，如何结合 Prometheus 进行网络度量指标监测，给出了一些示例配置。最后，还推广了一下 Banzai Cloud 自家的 Pipeline，天然支持跨云、混合云情况下的网络度量监测，欢迎体验。" /><meta property="og:image" content="https://cloudnativecn.com/media/sharing.png" />
    <meta property="twitter:image" content="https://cloudnativecn.com/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
      <meta
        property="article:published_time"
        content="2019-05-29T17:20:42&#43;08:00"
      />
    
    <meta property="article:modified_time" content="2025-04-22T17:09:51&#43;08:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cloudnativecn.com/blog/exploring-istio-telemetry-and-observability/"
  },
  "headline": "Istio 遥测和可观察性探索",
  
  "datePublished": "2019-05-29T17:20:42+08:00",
  "dateModified": "2025-04-22T17:09:51+08:00",
  
  "author": {
    "@type": "Person",
    "name": "Marton Sereg"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "云原生社区（中国）",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cloudnativecn.com/media/logo.svg"
    }
  },
  "description": "文章介绍了 istio 环境下，如何结合 Prometheus 进行网络度量指标监测，给出了一些示例配置。最后，还推广了一下 Banzai Cloud 自家的 Pipeline，天然支持跨云、混合云情况下的网络度量监测，欢迎体验。"
}
</script>

  

  

  

  





  <title>Istio 遥测和可观察性探索 | 云原生社区（中国）</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="b03fc3046a577df0c43298e116fc0697" >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.62d6f8dfe8493f1c68557dde65bec362.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="关闭"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="搜索..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="搜索...">
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生社区（中国）"
            
            ></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生社区（中国）"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/community"><span>社区</span></a>
          </li>

          
          

          

          
          
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link  active" href="/blog"><span>博客</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>资料</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/envoy/"><span>Envoy 中文文档</span></a>
              
                <a class="dropdown-item" href="/kubebuilder/"><span>Kubebuilder 中文文档</span></a>
              
                <a class="dropdown-item" href="https://istio.io/latest/zh/"><span>云原生资料库</span></a>
              
            </div>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/event"><span>活动</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>关于</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        

        
        <li class="nav-item">
            <a class="nav-link" href="/community/join/" data-toggle="tooltip" data-placement="bottom" title="加入社区" aria-label="主站"><i class="fa-brands fa-weixin" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link js-search" href="#" data-toggle="tooltip" data-placement="bottom" title="搜索" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item d-none d-lg-inline-flex">
            <a class="nav-link" href="https://github.com/cloudnativeto/cloudnative.to" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="查看源码" aria-label="查看源码" aria-label="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item">
          <a href="#" class="nav-link set-theme">
            <i class="fa fa-sun" aria-hidden="true" id="theme-icon"></i>
          </a>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <div class="container-xl">
    <div class="post-container">
        












  

  
  
  
<div class="article-container pt-3">
  <h1>Istio 遥测和可观察性探索</h1>

  

  
    


<div class="article-metadata">

  <div>
  
  
  
  
    <i class="fa-solid fa-feather"></i>
    

  <span >
      <a href="/author/marton-sereg/">Marton Sereg</a></span>
    
    <span class="middot-divider"></span>
    
  
  
  
  
  
  
    <i class="fa fa-language"></i>
    

  <span >
      <a href="/translators/%E5%BC%A0%E6%88%90/">张成</a></span>
    <span class="middot-divider"></span>
  
  
  
  
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/category/service-mesh/" class="text-capitalize">Service Mesh</a></span>
  
  </div>

  
  <span class="article-date">
    
    
      
          
          发布于
      
    
    2019-05-29
  </span>
  

  

  
  <span class="middot-divider"></span>
  字数 4307
  <span class="middot-divider"></span>
  <span class="article-reading-time">
      阅读时长 20 分钟
  </span>
  

  
  
  
  

</div>

    





  
</div>


    </div>
    <div class="border-bottom mb-2"></div>
    <div class="row flex-xl-nowrap">
        <div class="col-3 d-none d-xl-block docs-toc">
            <!-- toc -->
            
<div class="">
    <ul class="nav toc-top">
        <li>
            <a href="#" id="back_to_top" class="docs-toc-title">目录</a>
        </li>
    </ul>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#mixer-与智能代理envoy">Mixer 与智能代理（Envoy）</a></li>
    <li><a href="#配置-prometheus-收集网格数据">配置 Prometheus 收集网格数据</a>
      <ul>
        <li><a href="#使用-prometheus-operator">使用 Prometheus Operator</a></li>
      </ul>
    </li>
    <li><a href="#默认度量指标">默认度量指标</a>
      <ul>
        <li><a href="#默认内部度量指标">默认内部度量指标</a></li>
      </ul>
    </li>
    <li><a href="#用于istio的多混合云监测和控制平面工具">用于ISTIO的多/混合云监测和控制平面工具</a></li>
    <li><a href="#关于pipeline">关于<a href="https://github.com/banzaicloud/pipeline">PIPELINE</a></a></li>
    <li><a href="#关于banzai-cloud">关于<a href="https://banzaicloud.com/">BANZAI CLOUD</a></a></li>
  </ul>
</nav>
</div>

            <!-- /toc -->
            
            <div class="subscribe-module col-12 mt-1">
    <img src="/img/wechat.jpg" alt="image" title="云原生社区的微信公众号"/>
    <p class="text-center pt-1">关注「云原生社区动态」微信公众号，获取本站更新</p>
</div>

            
        </div>
        <main class="article-body col-9 container docs-content" role="main">
            <article class="article">
                <div class="article-style">
                    
                    <details class="toc-inpage d-print-none d-show-block my-4">
  <summary class="font-weight-bold">点击查看目录</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#mixer-与智能代理envoy">Mixer 与智能代理（Envoy）</a></li>
    <li><a href="#配置-prometheus-收集网格数据">配置 Prometheus 收集网格数据</a>
      <ul>
        <li><a href="#使用-prometheus-operator">使用 Prometheus Operator</a></li>
      </ul>
    </li>
    <li><a href="#默认度量指标">默认度量指标</a>
      <ul>
        <li><a href="#默认内部度量指标">默认内部度量指标</a></li>
      </ul>
    </li>
    <li><a href="#用于istio的多混合云监测和控制平面工具">用于ISTIO的多/混合云监测和控制平面工具</a></li>
    <li><a href="#关于pipeline">关于<a href="https://github.com/banzaicloud/pipeline">PIPELINE</a></a></li>
    <li><a href="#关于banzai-cloud">关于<a href="https://banzaicloud.com/">BANZAI CLOUD</a></a></li>
  </ul>
</nav>
</details>

                    
                    <p>本文为翻译文章，<a href="https://banzaicloud.com/blog/istio-telemetry/" target="_blank" rel="noopener">点击查看原文</a>。</p>
<p><strong>编者按</strong></p>
<blockquote>
<p>作者是 Banzai Cloud 的工程师，文章介绍了 istio 环境下，如何结合 Prometheus 进行网络度量指标监测，给出了一些示例配置。最后，还推广了一下 Banzai Cloud 自家的 Pipeline，天然支持跨云、混合云情况下的网络度量监测，欢迎体验。</p></blockquote>
<p>Istio 的一个核心功能就是网络流量的可观察性。因为所有服务间的通信都通过 Envoy 代理，而且 Istio 的控制平面可以从这些代理收集日志和指标，服务网格能够让你深入了解你的网络状况。虽然 Istio 的基本安装就装好了收集遥测数据所需的全部组件，但是理解这些组件如何配合，并且使他们能够工作在生产环境中却不是一个容易的事情。如果服务网格扩展到跨越多个云服务提供商的多个群集时，或者在混合云情况下，甚至在边缘计算环境下，这个工作就更加困难。我们在这篇文章中，尽可能解释清楚 Istio 的遥测是怎么工作的，并且会完整浏览一些监控例子，包括如何配置 Prometheus 的目标和尝试不同可用的指标。看完这篇文章，你将会对 Banzai 云中新的<a href="https://github.com/banzaicloud/pipeline" target="_blank" rel="noopener">Pipeline</a>组件有一个提前了解 - 它是一个跨云和混合云管理平台，基于顶尖的<a href="https://github.com/banzaicloud/istio-operator" target="_blank" rel="noopener">Istio Operator</a>开发。</p>
<h2 id="mixer-与智能代理envoy">Mixer 与智能代理（Envoy）</h2>
<p>Istio 的控制平面由几个不同部分组成，其中一个是 Mixer。Mixer 自身在 Kubernetes 里面又有两个不同的独立部署。一个叫做<code>istio-policy</code>，另一个叫<code>istio-telemetry</code>。就像它们的名字，这些组件负责提供控制策略和遥测数据收集功能。</p>
<p>应用 pod 的 sidecar 在发起每一个请求前调用<code>istio-policy</code>来进行前置条件检查，并在请求结束后发送遥测数据。sidecar 本地缓存了一大批前置检查，使得大量的检查只需要通过缓存就能获得结果。此外，sidecar 还对输出的遥测数据进行了缓存，以减少调用 mixer 的频率。</p>
<p>在 Istio 的控制平面上运行 mixer 是可选的，如果你不需要集中式的策略检查和遥测，那么你可以把这些组件彻底关掉。这些组件具有非常高的扩展性，并且能够在自定义资源配置中进行完整配置。如果不想涉及 Istio 配置过深，或者不想使用自己的后端基础设施去收集日志和遥测数据，而想完全采用默认值（stdio logs，Prometheus 指标），你完全可以一点不操心这些。</p>
<p>如果你想用一个不同的<em>adapter</em> - 如<code>Stackdriver</code>- 你需要更新 mixer 的自定义资源配置。Istio 中有几个概念叫做<code>handlers</code>，<code>instances</code>以及<code>rules</code>。<code>Handlers</code>决定一系列后端基础设置适配器是怎么工作以及如何操作的，<code>instances</code>描述了如何把请求的属性映射到适配器的输入上，最后<code>rules</code>把<code>handlers</code>和<code>instances</code>拼接在一起。这些概念如果你想了解更多，你可以查看<a href="https://istio.io/docs/concepts/policies-and-telemetry/#configuration-model" target="_blank" rel="noopener">官方文档</a>，这篇文章最后也会演示一下一些默认的例子。</p>
<p>















<figure  id="figure-img">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="img" srcset="
               /blog/exploring-istio-telemetry-and-observability/istio-telemetry_hu_89e8b1dc1d6d0999.webp 400w,
               /blog/exploring-istio-telemetry-and-observability/istio-telemetry_hu_58e871a4e427ac07.webp 760w,
               /blog/exploring-istio-telemetry-and-observability/istio-telemetry_hu_c3eba0a405c79c8.webp 1200w"
               src="/blog/exploring-istio-telemetry-and-observability/istio-telemetry_hu_89e8b1dc1d6d0999.webp"
               width="760"
               height="540"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      img
    </figcaption></figure>
</p>
<h2 id="配置-prometheus-收集网格数据">配置 Prometheus 收集网格数据</h2>
<p>Istio 的文档列举了<a href="https://istio.io/docs/tasks/telemetry/metrics/collecting-metrics/" target="_blank" rel="noopener">收集自定义指标</a>，以及<a href="https://istio.io/docs/tasks/telemetry/metrics/querying-metrics/" target="_blank" rel="noopener">从 Prometheus 中查询指标</a>的例子，但缺少一个重要的内容：理解和配置 Prometheus 的收集目标。</p>
<p>如果你只是想试一试 Istio，多半你会部署了它的官方工具 Helm Chart（我们更推荐<a href="https://github.com/banzaicloud/istio-operator" target="_blank" rel="noopener">Istio operator</a>以获取更好的体验）。Helm Chart 默认包含了 Prometheus 部署并且也已经配置好。但是在生产环境下，你通常需要自定义设置 Prometheus 以及配置它的收集目标。这样情况下，你需要手工将 Istio 抓取目标也配置进去。</p>
<p>首先，我们来看看这些目标。如果你打开这里的配置，你会发现 Istio 给 Prometheus 添加了十多个 job。大部分是从 Istio 控制平面收集自定义指标的。你可以看到 Pilot 通过类似<code>pilot_xds_pushes</code>, <code>pilot_xds_push_timeout</code> 与 <code>pilot_total_xds_internal_errors</code>这些指标上报遥测数据，如<code>xDS</code>推送，超时或内部错误。这些 job 紧跟在组件名称后，并通过 Kubernetes 服务中<code>http-monitoring</code>对应的端口上报。下面列举了一个 pilot 的例子：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl">- <span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;pilot&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kubernetes_sd_configs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">endpoints</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespaces</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">names</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- {{<span class="w"> </span><span class="l">.Release.Namespace }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">relabel_configs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">__meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l">keep</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">regex</span><span class="p">:</span><span class="w"> </span><span class="l">istio-pilot;http-monitoring</span><span class="w">
</span></span></span></code></pre></div><p>最重要的两个目标是<code>istio-mesh</code>和<code>envoy-stats</code>。<code>prometheus.yml</code>里面第一项允许 Prometheus 抓取 Mixer，它也含在了以服务遥测数据为中心的，Envoy 代理间的所有网络流量数据中。另一方面来说，<code>envoy-stats</code>直接查询 Envoy 的代理，并收集网络内中央节点的遥测数据（可以查看类似<code>envoy_cluster_upstream_rq</code>这样的指标）。</p>
<p>Mixer 通过 Pilot 来加强 Kubernetes 中 Envoys 上报的采样数据，所以从 Mixer 来的数据包含更丰富的信息，包括服务、负载名称以及其它 Kubernetes 特定的内容。但也有一些<a href="https://medium.com/@michael_87395/benchmarking-istio-linkerd-cpu-at-scale-5f2cfc97c7fa" target="_blank" rel="noopener">博文</a>提到，从群集中的每一个 sidecar 代理收集遥测数据，有时候会引起性能问题，所以在一个大的群集里面，有时候完全关闭 Mixer，只通过<code>envoy-stats</code>中转也是值得的，即使这意味着会丢失部分功能。</p>
<p>下面是一个<code>istio-mesh</code>添加一个 job，查询<code>istio-telemetry</code>服务的<code>prometheus</code>端口的<code>yaml</code>配置，</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl">- <span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;istio-mesh&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kubernetes_sd_configs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">endpoints</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespaces</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">names</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- {{<span class="w"> </span><span class="l">.Release.Namespace }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">relabel_configs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">__meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l">keep</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">regex</span><span class="p">:</span><span class="w"> </span><span class="l">istio-telemetry;prometheus</span><span class="w">
</span></span></span></code></pre></div><p><code>envoy-stats</code>的<code>yaml</code>配置更加复杂，但也很重要。它选择 pod 的条件是端口名称为<code>*-envoy-prom</code>，指标为<code>/stats/prometheus</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl">- <span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;envoy-stats&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">metrics_path</span><span class="p">:</span><span class="w"> </span><span class="l">/stats/prometheus</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kubernetes_sd_configs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">relabel_configs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">__meta_kubernetes_pod_container_port_name]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l">keep</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">regex</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;.*-envoy-prom&#39;</span><span class="w">
</span></span></span></code></pre></div><p>使用<a href="https://github.com/helm/charts/tree/master/stable/prometheus" target="_blank" rel="noopener">Helm Chart</a>部署 Prometheus 到群集中，部署目的地添加到<code>values.yaml</code>文件，或者直接编辑包含<code>premetheus.yaml</code>的<code>configmap</code>，并把它挂载到 Prometheus 的服务端 pod 上。</p>
<h3 id="使用-prometheus-operator">使用 Prometheus Operator</h3>
<p>群集中部署 Prometheus 的一个更好的方法是用<a href="https://github.com/coreos/prometheus-operator/" target="_blank" rel="noopener">Prometheus Operator</a>。这种情况下，目标配置稍稍有点不同 - 不再直接用<code>prometheus.yml，</code>而是通过定义<code>ServiceMonitor</code>的自定义资源，来声明一些列用于监控的服务，并且这个 operator 在后台自动把这些配置转换为 Prometheus 的<code>yaml</code>配置。举个例子，一条收集<code>mixer</code>指标的<code>ServiceMonitor</code>记录定义如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">monitoring.coreos.com/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceMonitor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">istio-monitor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">monitoring</span><span class="p">:</span><span class="w"> </span><span class="l">services</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchExpressions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- {<span class="nt">key: istio, operator: In, values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">mixer]}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespaceSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchNames</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">istio-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">jobLabel</span><span class="p">:</span><span class="w"> </span><span class="l">istio-mesh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">endpoints</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l">prometheus</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">5s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l">http-monitoring</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">5s</span><span class="w">
</span></span></span></code></pre></div><p>它示范了通过匹配标签<code>istio=mixer</code>以及每 5 秒查询一次终结点端口<code>prometheus</code>和<code>http-monitoring</code>的配置。就像上面这个配置，Mixer 通过<code>http-monitoring</code>端口，提供了关于它自己操作的自定义度量指标，也通过<code>prometheus</code>端口提供了聚合的以网络流量服务为中心的一些度量指标。</p>
<h2 id="默认度量指标">默认度量指标</h2>
<p>Istio 文档中提到，度量指标的第一个任务就是<a href="https://istio.io/docs/tasks/telemetry/metrics/collecting-metrics/" target="_blank" rel="noopener">Collecting new metrics</a>。它很好地描述了 Istio 如何最大化的自定义资源去配置<code>instance</code>，<code>handlers</code>和<code>rules</code>，并演示了如何创建一个自定义的，Istio 生成并且自动收集的度量指标，当然这属于高级别的话题范畴。大部分普通场景里，默认的度量值就足够覆盖使用场景了，Istio 用户也不需要了解背后的概念。</p>
<p><a href="https://github.com/banzaicloud/istio-operator" target="_blank" rel="noopener">Istio operator</a>（Istio Helm 图表也一样）开箱就初始化了默认指标。如果 Istio 运行在群集中，并配置了 Prometheus 以从 Mixer 收集遥测数据，你将不需要做任何网格中服务间的网络流量遥测数据的配置。直到你开始使用 Envoy sidecar，你可以使用 Prometheus UI（或者用它的查询 API）来收集 Prometheus 收集的指标。</p>
<p>默认指标都是一些标准的信息，如<code>HTTP</code>，<code>gRPC</code>以及<code>TCP</code>请求和响应。每一个请求都是由<code>source</code>代理和<code>destination</code>代理上报的，用以提供流量的不同视角的结果。也许有的请求不是通过<code>destination</code>上报（如果这个请求根本没有经过 destination），但是一些标签（如<code>connection_security_policy</code>）只在<code>destination</code>上有效。下面列举一些重要的<em>HTTP</em>指标：</p>
<ul>
<li><code>istion_request_total</code>是一个<code>计数器（COUNTER）</code>，聚合 Kubernetes 负载中请求总数，并按照响应码、响应标志和安全策略分组。这在计算负载间的请求量（<code>RPS</code>）的时候很有用。这有一个<a href="https://istio.io/docs/examples/bookinfo" target="_blank" rel="noopener">Bookinfo</a>的例子。它计算<code>productpage</code>和<code>review</code>服务间，最近一小时的每秒请求数<code>request per second，</code>并且按照工作负载域和响应码分组。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">sum(rate(istio_requests_total{reporter=&#34;source&#34;,source_workload=&#34;productpage-v1&#34;,destination_service_name=&#34;reviews&#34;}[1m])) by (source_workload,source_version,destination_service_name,destination_workload,destination_version,request_protocol,response_code)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>{<span class="l">destination_service_name=&#34;reviews&#34;,destination_version=&#34;v2&#34;,destination_workload=&#34;reviews-v2&#34;,request_protocol=&#34;http&#34;,response_code=&#34;200&#34;,source_version=&#34;v1&#34;,source_workload=&#34;productpage-v1&#34;}    12.71</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>{<span class="l">destination_service_name=&#34;reviews&#34;,destination_version=&#34;v3&#34;,destination_workload=&#34;reviews-v3&#34;,request_protocol=&#34;http&#34;,response_code=&#34;200&#34;,source_version=&#34;v1&#34;,source_workload=&#34;productpage-v1&#34;}    12.72</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>{<span class="l">destination_service_name=&#34;reviews&#34;,destination_version=&#34;v1&#34;,destination_workload=&#34;reviews-v1&#34;,request_protocol=&#34;http&#34;,response_code=&#34;200&#34;,source_version=&#34;v1&#34;,source_workload=&#34;productpage-v1&#34;}    6.35</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>{<span class="l">destination_service_name=&#34;reviews&#34;,destination_version=&#34;v1&#34;,destination_workload=&#34;reviews-v1&#34;,request_protocol=&#34;http&#34;,response_code=&#34;503&#34;,source_version=&#34;v1&#34;,source_workload=&#34;productpage-v1&#34;}    6.37</span><span class="w">
</span></span></span></code></pre></div><ul>
<li><code>istio_request_duration_seconds</code> 是收集负载间延迟的直方图。以下示例计算<code>productpage</code>和<code>reviews</code>服务之间成功请求的第 95 百分位延迟，并按工作负载子集对结果进行分组。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">histogram_quantile(0.95, sum(rate(istio_request_duration_seconds_bucket{reporter=&#34;source&#34;,source_workload=&#34;productpage-v1&#34;,destination_service_name=&#34;reviews&#34;,response_code=&#34;200&#34;}[60m])) by (le,source_workload,source_version,destination_service_name,destination_workload,destination_version,request_protocol))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>{<span class="l">destination_service_name=&#34;reviews&#34;,destination_version=&#34;v2&#34;,destination_workload=&#34;reviews-v2&#34;,request_protocol=&#34;http&#34;,source_version=&#34;v1&#34;,source_workload=&#34;productpage-v1&#34;}    0.1201</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>{<span class="l">destination_service_name=&#34;reviews&#34;,destination_version=&#34;v3&#34;,destination_workload=&#34;reviews-v3&#34;,request_protocol=&#34;http&#34;,source_version=&#34;v1&#34;,source_workload=&#34;productpage-v1&#34;}    0.1345</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>{<span class="l">destination_service_name=&#34;reviews&#34;,destination_version=&#34;v1&#34;,destination_workload=&#34;reviews-v1&#34;,request_protocol=&#34;http&#34;,source_version=&#34;v1&#34;,source_workload=&#34;productpage-v1&#34;}    0.1234</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>剩下的两个 HTTP 度量指标是<code>istio_request_bytes</code>和<code>istio_response_bytes</code>。这些也是直方图，可以用与<code>istio_request_duration_seconds</code>类似的方式查询。</li>
</ul>
<h3 id="默认内部度量指标">默认内部度量指标</h3>
<p>如果您仍然对如何在 Mixer 中配置这些指标感兴趣，可以查看群集中相应的 Istio 自定义资源。如果从集群中获得<code>metric</code> CRs，它会列出八个不同的资源，这些资源将转换为 Prometheus 指标：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get metric -n istio-system
</span></span><span class="line"><span class="cl">NAME                   AGE
</span></span><span class="line"><span class="cl">requestcount           17h
</span></span><span class="line"><span class="cl">requestduration        17h
</span></span><span class="line"><span class="cl">requestsize            17h
</span></span><span class="line"><span class="cl">responsesize           17h
</span></span><span class="line"><span class="cl">tcpbytereceived        17h
</span></span><span class="line"><span class="cl">tcpbytesent            17h
</span></span><span class="line"><span class="cl">tcpconnectionsclosed   17h
</span></span><span class="line"><span class="cl">tcpconnectionsopened   17h
</span></span></code></pre></div><p><code>handler</code>配置描述了 Prometheus 度量指标，并引用了<code>instance_name</code>字段中的先前<code>metric</code>自定义资源。它还定义了以后可以在 Prometheus 查询中使用的名称（使用<code>istio</code>前缀），例如<code>requests_total</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">kubectl get handler -n istio-system prometheus -o yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">config.istio.io/v1alpha2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">handler</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">compiledAdapter</span><span class="p">:</span><span class="w"> </span><span class="l">prometheus</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">params</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metrics</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">instance_name</span><span class="p">:</span><span class="w"> </span><span class="l">requestcount.metric.istio-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">COUNTER</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">label_names</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">reporter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">source_app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">requests_total</span><span class="w">
</span></span></span></code></pre></div><p>最后一个构建块是<code>rule</code>自定义资源，它将度量指标绑定到处理程序：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">kubectl get rule -n istio-system  promhttp -o yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">config.istio.io/v1alpha2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">rule</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">actions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">handler</span><span class="p">:</span><span class="w"> </span><span class="l">prometheus</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">instances</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">requestcount.metric</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">requestduration.metric</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">requestsize.metric</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">responsesize.metric</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">match</span><span class="p">:</span><span class="w"> </span><span class="l">(context.protocol == &#34;http&#34; || context.protocol == &#34;grpc&#34;) &amp;&amp; (match((request.useragent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="l">| &#34;-&#34;), &#34;kube-probe*&#34;) == false)</span><span class="w">
</span></span></span></code></pre></div><p>如果您仍需要自定义一些有关网络流量的指标，你需要添加这些类型的自定义资源。为此，您可以参考<a href="https://istio.io/docs/tasks/telemetry/metrics/collecting-metrics/" target="_blank" rel="noopener">Istio 文档</a>。</p>
<h2 id="用于istio的多混合云监测和控制平面工具">用于ISTIO的多/混合云监测和控制平面工具</h2>
<p>Istio 及其遥测组件最初可能会令人生畏，特别是如果涉及多个集群。我们非常关注简化多集群环境中的服务网格使用，因为我们专注于在 Banzai Cloud 构建多云和混合云平台。我们的劳动成果即将发布在 KubeCon：一个用于监控和配置服务网格活动的可视化工具。我们考虑过使用其他工具，如 Kiali，但它缺乏多集群支持以及通过 UI 指定配置选项的能力。因此，我们最终编写了自己的 UI 和后端基础架构，以便与服务网格进行通信。这个新工具将很快在 KubeCon 上发布，并将作为<a href="https://github.com/banzaicloud/pipeline" target="_blank" rel="noopener">Pipeline</a>平台的一部分提供，敬请期待！</p>
<p>















<figure  id="figure-img">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="img" srcset="
               /blog/exploring-istio-telemetry-and-observability/uistio_hu_d26b2f08e72b91e4.webp 400w,
               /blog/exploring-istio-telemetry-and-observability/uistio_hu_f74483c29deb7ea6.webp 760w,
               /blog/exploring-istio-telemetry-and-observability/uistio_hu_31a95a99cf50c257.webp 1200w"
               src="/blog/exploring-istio-telemetry-and-observability/uistio_hu_d26b2f08e72b91e4.webp"
               width="760"
               height="594"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      img
    </figcaption></figure>
</p>
<h2 id="关于pipeline">关于<a href="https://github.com/banzaicloud/pipeline" target="_blank" rel="noopener">PIPELINE</a></h2>
<p>Banzai Cloud 的<a href="https://github.com/banzaicloud/pipeline" target="_blank" rel="noopener">Pipeline</a>提供了一个平台，允许企业开发，部署和扩展基于容器的应用程序。它利用最佳的云组件（如 Kubernetes）为开发人员和运维团队创建高效，灵活的环境。强大的安全措施 - 多身份验证后端，细粒度授权，动态密钥管理，使用 TLS 的组件之间的自动安全通信，漏洞扫描，静态代码分析，CI / CD 等等 -是<a href="https://github.com/banzaicloud/pipeline" target="_blank" rel="noopener">流水线平台</a>的<em>零级</em>特征，我们努力为所有企业赋能以实现自动化。</p>
<h2 id="关于banzai-cloud">关于<a href="https://banzaicloud.com/" target="_blank" rel="noopener">BANZAI CLOUD</a></h2>
<p><a href="https://banzaicloud.com/" target="_blank" rel="noopener">Banzai Cloud</a>改变私有云的构建方式，以简化复杂应用程序的开发，部署和扩展，将 Kubernetes 和 Cloud Native 技术的全部功能带给各地的开发人员和企业。
如果你对我们的技术或开源项目感兴趣，可以从<a href="https://github.com/banzaicloud/pipeline/" target="_blank" rel="noopener">GitHub</a>, <a href="https://www.linkedin.com/company/banzaicloud/" target="_blank" rel="noopener">LinkedIn</a> 或 <a href="https://twitter.com/BanzaiCloud?ref_src=twsrc%5Etfw/" target="_blank" rel="noopener">Twitter</a>来联系我们。</p>

                </div>
                

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/istio/">Istio</a>
  
</div>











  
  
    



  
  
  
  
  
  <div class="media author-card content-widget-hr mb-4">
    
      
      <a href="/author/marton-sereg/"><img class="avatar mr-3 avatar-circle" src="/author/marton-sereg/avatar_hu_993d1b6c8f0963be.jpg" alt="Marton Sereg"></a>
    

    <div class="media-body">
      <p class="card-title"><a href="/author/marton-sereg/">Marton Sereg</a></p>
      
      
      
    </div>
  </div>


  


  
  
    




  




<div class="article-widget">
  
<div class="container-xl row post-nav">
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1" href="/blog/containers-microservices-service-meshes/" rel="next">
    <div class="meta-nav">下一页</div>
    <p>容器、微服务和服务网格简史</p></a>
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1"  href="/blog/201905-servicemesh-development-trend/" rel="prev">
    <div class="meta-nav">上一页</div>
    <p>Service Mesh 发展趋势：云原生中流砥柱</p></a>
  
</div>

</div>










  

<p class="edit-page">
  <a href="https://github.com/cloudnativeto/cloudnative.to/edit/master/content/blog/exploring-istio-telemetry-and-observability/index.md">
    <i class="fas fa-pen pr-2"></i>编辑本页
  </a>
</p>




  
  
  <div class="article-widget content-widget-hr">
    <p class="related-title">相关推荐</p>
    <ul>
      
      <li><a href="/blog/istio-more-for-less/">使用 Istio 的环境模式 —— 用更少的资源做更多的事！</a></li>
      
      <li><a href="/blog/mtls-kubernetes/">在 Kubernetes 中实现 mTLS：选项与推荐</a></li>
      
      <li><a href="/blog/understanding-istio-and-open-policy-agent-opa/">Istio 中的外部授权过滤器：使用 OPA 实现灵活的授权策略</a></li>
      
      <li><a href="/blog/istio-gateway-api-beta/">Istio 扩展对 Gateway API 的支持</a></li>
      
      <li><a href="/blog/istio-traffic-management-series-service-management-concept-theory/">浅析 Istio——服务治理之概念和原理</a></li>
      
    </ul>
  </div>
  





  
  
  

  

  
  <section id="comments" class="mb-3 pt-0">
    <script>
  let themeNumber = localStorage.getItem('wcTheme');
  var giscusTheme = "light";
  if (themeNumber == 1){
    giscusTheme = "dark";
  }
  let giscusAttributes = {
    "src": "https://giscus.app/client.js",
    "data-theme": giscusTheme,
    "data-repo":"cloudnativeto\/cloudnative.to",
    "data-repo-id":"MDEwOlJlcG9zaXRvcnkyMzc3NDUxOTA=",
    "data-category":"General",
    "data-category-id":"MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDU5MzUy",
    "data-mapping":"pathname",
    "data-reactions-enabled":"",
    "data-emit-metadata":"0",
    "data-input-position":"top",
    "data-theme":giscusTheme,
    "data-lang":"zh-CN",
    "data-loading":"lazy",
    "crossorigin":"annoymous",
    "origins":"https://cloudnativecn.com",
    "originsRegex":"http://localhost:[0-9]+",
    "async": "",
  };

  let giscusScript = document.createElement("script");
  Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
  document.querySelector('#comments').appendChild(giscusScript);
</script>

  </section>
  



            </article>
        </main>
    </div>
</div>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">© 2020-2024 云原生社区保留所有权利</p>
        </div>
    </div>
  </div>

</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.0965c02a44d7bc3f6aebc3730ec59495.js"></script>




  

  
  

  

  
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
    
    
  










  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <div class="article-metadata search-hit-type">{{relpermalink}}</div>
          <a href="{{relpermalink}}">{{title}}</a>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":false}</script>










  
  


<script src="/zh/js/wowchemy.min.1f4bda0700ff78dcd04ab5307750c948.js"></script>







<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
<script>
  anchors.add();
</script>



<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, '已复制')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>



<script>

function Collapse(e){
  var node = document.getElementById(e);
  if (node.className.indexOf('fa-angle-down') > -1){
    node.setAttribute("class", "fa-solid fa-angle-right");
    }else{
    node.setAttribute("class", "fa-solid fa-angle-down");
    }
}
</script>


</body>
</html>
