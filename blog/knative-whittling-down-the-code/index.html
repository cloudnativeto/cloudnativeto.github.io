<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
  

  

  
  
  
    
  
  <meta name="description" content="本文介绍如何利用 Knative 提供的功能，减少自己需要编写的代码。" />

  
  <link rel="alternate" hreflang="zh" href="https://cloudnative.to/blog/knative-whittling-down-the-code/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.2f500d272ea4379dca952215a5d02351.css" />

  



  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f3dc895ea3bd6186cd835841d365c103";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu12a4295615259de83f102fd096a49a31_6281_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu12a4295615259de83f102fd096a49a31_6281_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://cloudnative.to/blog/knative-whittling-down-the-code/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@CloudNativeCN" />
    <meta property="twitter:creator" content="@CloudNativeCN" />
  
  <meta property="og:site_name" content="云原生社区（中国）" />
  <meta property="og:url" content="https://cloudnative.to/blog/knative-whittling-down-the-code/" />
  <meta property="og:title" content="Knative：精简代码之道 | 云原生社区（中国）" />
  <meta property="og:description" content="本文介绍如何利用 Knative 提供的功能，减少自己需要编写的代码。" /><meta property="og:image" content="https://cloudnative.to/media/sharing.png" />
    <meta property="twitter:image" content="https://cloudnative.to/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
      <meta
        property="article:published_time"
        content="2019-03-01T10:40:18&#43;08:00"
      />
    
    <meta property="article:modified_time" content="2023-11-08T20:45:44&#43;08:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cloudnative.to/blog/knative-whittling-down-the-code/"
  },
  "headline": "Knative：精简代码之道",
  
  "datePublished": "2019-03-01T10:40:18+08:00",
  "dateModified": "2023-11-08T20:45:44+08:00",
  
  "author": {
    "@type": "Person",
    "name": "Brian Mcclain"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "云原生社区（中国）",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cloudnative.to/media/logo.svg"
    }
  },
  "description": "本文介绍如何利用 Knative 提供的功能，减少自己需要编写的代码。"
}
</script>

  

  

  

  





  <title>Knative：精简代码之道 | 云原生社区（中国）</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="c121edd1cd548defe22a73e5289c1e36" >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.62d6f8dfe8493f1c68557dde65bec362.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="关闭"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="搜索..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="搜索...">
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生社区（中国）"
            
            ></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生社区（中国）"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/community"><span>社区</span></a>
          </li>

          
          

          

          
          
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link  active" href="/blog"><span>博客</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>资料</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/envoy/"><span>Envoy 中文文档</span></a>
              
                <a class="dropdown-item" href="/kubebuilder/"><span>Kubebuilder 中文文档</span></a>
              
                <a class="dropdown-item" href="https://lib.jimmysong.io/"><span>云原生资料库</span></a>
              
                <a class="dropdown-item" href="https://istio.io/latest/zh/"><span>Istio 中文文档</span></a>
              
            </div>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/event"><span>活动</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#feed"><span>更新</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#tags"><span>标签</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>关于</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        

        
        <li class="nav-item">
            <a class="nav-link" href="/community/join/" data-toggle="tooltip" data-placement="bottom" title="加入社区" aria-label="主站"><i class="fa-brands fa-weixin" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link js-search" href="#" data-toggle="tooltip" data-placement="bottom" title="搜索" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item d-none d-lg-inline-flex">
            <a class="nav-link" href="https://github.com/cloudnativeto/cloudnative.to" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="查看源码" aria-label="查看源码" aria-label="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item">
          <a href="#" class="nav-link set-theme">
            <i class="fa fa-sun" aria-hidden="true" id="theme-icon"></i>
          </a>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <div class="container-xl">
    <div class="post-container">
        












  

  
  
  
<div class="article-container pt-3">
  <h1>Knative：精简代码之道</h1>

  

  
    


<div class="article-metadata">

  <div>
  
  
  
  
    <i class="fa-solid fa-feather"></i>
    

  <span >
      <a href="/author/brian-mcclain/">Brian Mcclain</a></span>
    
    <span class="middot-divider"></span>
    
  
  
  
  
  
  
    <i class="fa fa-language"></i>
    

  <span >
      <a href="/translators/%E5%AD%99%E6%B5%B7%E6%B4%B2/">孙海洲</a></span>
    <span class="middot-divider"></span>
  
  
  
  
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/category/serverless/" class="text-capitalize">serverless</a></span>
  
  </div>

  
  <span class="article-date">
    
    
      
          
          发布于
      
    
    2019-03-01
  </span>
  

  

  
  <span class="middot-divider"></span>
  字数 4572
  <span class="middot-divider"></span>
  <span class="article-reading-time">
      阅读时长 21 分钟
  </span>
  

  
  
  
  

</div>

    





  
</div>


    </div>
    <div class="border-bottom mb-2"></div>
    <div class="row flex-xl-nowrap">
        <div class="col-3 d-none d-xl-block docs-toc">
            <!-- toc -->
            
<div class="">
    <ul class="nav toc-top">
        <li>
            <a href="#" id="back_to_top" class="docs-toc-title">目录</a>
        </li>
    </ul>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#预构建prebuilt的-docker-容器">预构建（Prebuilt）的 Docker 容器</a></li>
    <li><a href="#kaniko-容器构建器">Kaniko 容器构建器</a></li>
    <li><a href="#buildpack-build-template">Buildpack Build Template</a>
      <ul>
        <li><a href="#pivotal-function-service">Pivotal Function Service</a></li>
      </ul>
    </li>
    <li><a href="#接下来工作">接下来工作？</a></li>
  </ul>
</nav>
</div>

            <!-- /toc -->
            
            <div class="subscribe-module col-12 mt-1">
    <img src="/img/wechat.jpg" alt="image" title="云原生社区的微信公众号"/>
    <p class="text-center pt-1">关注「云原生社区动态」微信公众号，获取本站更新</p>
</div>

            
        </div>
        <main class="article-body col-9 container docs-content" role="main">
            <article class="article">
                <div class="article-style">
                    
                    <details class="toc-inpage d-print-none d-show-block mb-0">
  <summary class="font-weight-bold">点击查看目录</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#预构建prebuilt的-docker-容器">预构建（Prebuilt）的 Docker 容器</a></li>
    <li><a href="#kaniko-容器构建器">Kaniko 容器构建器</a></li>
    <li><a href="#buildpack-build-template">Buildpack Build Template</a>
      <ul>
        <li><a href="#pivotal-function-service">Pivotal Function Service</a></li>
      </ul>
    </li>
    <li><a href="#接下来工作">接下来工作？</a></li>
  </ul>
</nav>
</details>

                    
                    <p>本文为翻译文章，<a href="https://content.pivotal.io/blog/knative-whittling-down-the-code" target="_blank" rel="noopener">点击查看原文</a>。</p>
<p>[<strong>编者案</strong>]</p>
<blockquote>
<p>Knative 作为 Google 发起开源的 serverless 项目，给我们提供了一套简单易用的 serverless 开源解决方案。本文作者直观地向我们展示了如何使用 Knative 来一步一步逐渐精简我们的代码，来更加简单容易的开发云原生应用。作者使用实例来逐步向我们讲述如何使用 Knative 提供的 Build、Serving 和 Eventing 三大组件来发挥威力，逐渐精简代码。如果您对 Knative 有兴趣，本文对于你通过 Knative 实践 serverless 一定会有所启发，希望您能喜欢。</p>
</blockquote>
<p>对我来说，2018 年最好的开源项目是<strong>Knative</strong>，这是一个建立在 Kubernetes 之上的 serverless 平台。不仅是为了 serverless 平台本身，也是为了它所倡导的整个开发范式。事件驱动开发并不新鲜，但 Knative 为围绕事件构建生态系统奠定了基础。</p>
<p>如果您不熟悉 Knative，那么您读到的任何文档都将它分为三大组件：</p>
<ul>
<li>构建 (Build) —— 我如何构建代码和打包代码？</li>
<li>服务 (Serving) —— 我的代码如何为请求提供服务？它是如何伸缩的？</li>
<li>事件 (Eventing) —— 我的代码如何被各种事件触发？</li>
</ul>
<p>事实上这并不是一篇“Knative 入门”的文章 (在不久的将来会有更多关于这方面的<a href="https://twitter.com/BrianMMcClain/status/1086006073503481864?s=20" target="_blank" rel="noopener">内容</a>)，但是我最近一直在思考的是，随着开发人员越来越多地利用 Knative 提供的功能，他们如何减少自己需要编写的代码。这是最近 Twitter 上一个特别热门的话题，尤其是在 KubeCon 时代。我注意到的一个常见问题是，“如果您正在编写 Dockerfile，它真的是一个 serverless 的平台吗？”但是，其他人认为将代码打包为容器可能是最合理的解决方案，因为它是可移植的、全面的，并且具有所有依赖项。不乏强烈持有这种观点的人们，他们非常渴望争辩。</p>
<p>与其火上浇油，不如让我们看看 Knative 给开发人员提供了哪些选项来逐渐减少我们编写的代码量。我们将从最冗长的示例开始—我们自己构建的预构建容器（prebuilt container）。从这里开始，我们将逐渐减少基准代码量，减少构建自己的容器的需要，减少编写自己的 Dockerfile 的需要，最后减少编写自己的配置的需要。最重要的是，我们将看到 Pivotal Function Service (PFS) 的强大功能，以及它如何允许开发人员关注代码而不是配置。</p>
<p>我们将看到的所有代码都包含在两个 git repos 中：<a href="https://github.com/BrianMMcClain/knative-hello-world" target="_blank" rel="noopener">knative-hello-world</a>和<a href="https://github.com/BrianMMcClain/pfs-hello-world" target="_blank" rel="noopener">pfs-hello-world</a>。</p>
<h2 id="预构建prebuilt的-docker-容器">预构建（Prebuilt）的 Docker 容器</h2>
<p>我们将看到的第一个场景是为 Knative 提供一个预构建的容器镜像，该镜像已经上传到我们选择的容器镜像库。您将在 Knative 中看到的大多数<a href="https://github.com/knative/docs/tree/master/serving/samples/helloworld-nodejs" target="_blank" rel="noopener">Hello World</a>示例都采用直接构建和管理容器的方式。这是有意义的，因为它很容易理解，而且没有引入很多新概念，这是一个很好的起点。这个概念非常简单直接：传给 Knative 一个暴露端口的容器，它将处理剩余的所有事情。它不关心你的代码是用<a href="https://github.com/knative/docs/tree/master/serving/samples/helloworld-go" target="_blank" rel="noopener">Go</a>、<a href="https://github.com/knative/docs/tree/master/serving/samples/helloworld-ruby" target="_blank" rel="noopener">Ruby</a>还是<a href="https://github.com/knative/docs/tree/master/serving/samples/helloworld-java" target="_blank" rel="noopener">Java</a>写的;它会接收传入的请求并将它们发送到你的应用程序。</p>
<p>让我们从一个使用<a href="https://expressjs.com/" target="_blank" rel="noopener">Express web</a>框架基于 node.js 实现的 hello world 应用程序开始。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;express&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;body-parser&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">text</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;*/*&#34;</span><span class="p">}));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&#34;Hello, &#34;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span> <span class="o">+</span> <span class="s2">&#34;!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">8080</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Server started on port&#34;</span><span class="p">,</span> <span class="nx">port</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><p>是不是漂亮且简洁。这段代码将启动一个 web 服务器，监听端口 8080(除非端口已被占用)，并通过返回 Hello 来响应 HTTP POST 请求。当然，还需要 package.json 文件，它定义了一些东西 (如何启动应用程序，依赖关系等)，但这有点超出了我们所看到的范围。另一部分是 Dockerfile，它描述如何将所有内容打包到一个容器中。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> node:10.15.1-stretch-slim</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /usr/src/app</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> . .<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> npm install<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> PORT <span class="m">8080</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> $PORT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&#34;npm&#34;</span><span class="p">,</span> <span class="s2">&#34;start&#34;</span><span class="p">]</span><span class="err">
</span></span></span></code></pre></div><p>这里也没什么好惊讶的。我们将我们的镜像建立在官方 node.js 镜像的基础之上，将我们的代码复制到容器中并安装依赖项，然后告诉它如何运行我们的应用程序。剩下的就是将其上传到 Docker Hub。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker build . -t brianmmcclain/knative-hello-world:prebuilt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ docker push brianmmcclain/knative-hello-world:prebuilt
</span></span></code></pre></div><p>如果您曾经在类似于 Kubernetes 的应用程序上运行过，那么所有这些看起来应该非常熟悉。将代码放入容器中，让调度器处理以确保它处于正常状态。我们可以告诉 Knative 关于这个容器的信息，再加上一点 metadata，它会处理所有的东西。随着请求数量的增长，它将扩展实例的数量，缩减到 0，路由请求，连接事件——竭尽所能。我们真正需要告诉 Knative 的是调用我们的应用程序，运行它的名称空间，以及容器镜像的位置。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">serving.knative.dev/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">knative-hello-world-prebuilt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">runLatest</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">configuration</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">revisionTemplate</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="nt">container</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">docker.io/brianmmcclain/knative-hello-world:prebuilt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">$ kubectl apply -f 01-prebuilt.yaml</span><span class="w">
</span></span></span></code></pre></div><p>几分钟后，我们将看到一个新的 pod 运行起来，准备为请求服务，如果在一段时间内没有收到任何流量，Pod 数量将会缩减为 0。我们可以 POST 一些数据，看看我们收到的响应。首先，让我们获取 Kubernetes 集群的 Ingress IP，并将其分配给$SERVICE_IP 变量：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">SERVICE_IP</span><span class="o">=</span><span class="sb">`</span>kubectl get svc istio-ingressgateway -n istio-system -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&#34;{.status.loadBalancer.ingress[*].ip}&#34;</span><span class="sb">`</span>
</span></span></code></pre></div><p>然后使用 IP 向我们的服务发送请求，在我们的请求中设置 HOST header:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ curl -XPOST http://<span class="nv">$SERVICE_IP</span> -H <span class="s2">&#34;Host: knative-hello-world-prebuilt.default.example.com&#34;</span> -d <span class="s2">&#34;Prebuilt&#34;</span>
</span></span></code></pre></div><p>Hello, Prebuilt!</p>
<h2 id="kaniko-容器构建器">Kaniko 容器构建器</h2>
<p>上面介绍的一切可以很好的工作，但是我们甚至还没有开始接触 Knative 的“Build”部分。实际上，我们没有碰它，我们自己构建了这个容器。您可以在 Knative 文档中<a href="https://github.com/knative/docs/tree/master/build" target="_blank" rel="noopener">阅读所有关于构建</a>以及它们如何工作的信息。总的来说，knative 有一个名为<a href="https://github.com/knative/docs/blob/master/build/build-templates.md" target="_blank" rel="noopener">“Build Templates”</a>的概念，我喜欢这样描述他们：他们是关于如何从代码到容器的可共享逻辑。这些构建模板中的大多数模板都能够完成我们构建容器和上传镜像的需要。这些模板中最基本的可能是<a href="https://github.com/knative/build-templates/tree/master/kaniko" target="_blank" rel="noopener">Kaniko Build Templates</a>。</p>
<p>顾名思义，它基于谷歌的<a href="https://github.com/GoogleContainerTools/kaniko" target="_blank" rel="noopener">Kaniko</a>, Kaniko 是在容器中构建容器镜像的工具，不依赖于正在运行的 Docker 守护进程。向 Kaniko 容器镜像提供 Dockerfile 和一个上传结果的位置，它就可以据此构建镜像。我们无需拉取代码、在本地构建镜像、上传到 Docker Hub，然后从 Knative 拉取镜像，我们可以让 Knative 为我们做这些，只需要多做一点配置。</p>
<p>但是，在执行此操作之前，我们需要告诉 Knative 如何根据容器注册中心进行身份验证。为此，我们首先需要在 Kubernetes 中创建一个 Secret，这样我们就可以对 Docker Hub 进行身份验证，然后创建一个服务帐户来使用该 Secret 并运行构建。让我们从创造 Secret 开始：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dockerhub-account</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">build.knative.dev/docker-0</span><span class="p">:</span><span class="w"> </span><span class="l">https://index.docker.io/v1/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">kubernetes.io/basic-auth</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c"># &#39;echo -n &#34;username&#34; | base64&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">dXNlcm5hbWUK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c"># &#39;echo -n &#34;password&#34; | base64&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">cGFzc3dvcmQK</span><span class="w">
</span></span></span></code></pre></div><p>uesrname 和 password 作为 base64 编码的字符串发送给 Kubernetes。（对于有安全意识的读者来说，这是一种传输机制，而不是安全机制。有关 Kubernetes 如何存储 Secret 的更多信息，请在有空时查看关于<a href="https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/" target="_blank" rel="noopener">on encrypting secret data at rest</a>）。提交之后，我们将创建一个名为 build-bot 的服务帐户，并告诉它在推送到 Docker Hub 时使用这个 Secret：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">build-bot</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">secrets</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dockerhub-account</span><span class="w">
</span></span></span></code></pre></div><p>有关身份验证的更多信息，请确保查看 knative 文档中的<a href="https://github.com/knative/docs/blob/master/build/auth.md" target="_blank" rel="noopener">how-authentication-work -in- knative</a>文档。</p>
<p>构建模板 (Build Templates) 的好处是任何人都可以创建并与社区共享它们。我们可以告诉 Knative 通过传递一些 YAML 来安装这个构建模板：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ kubectl apply -f https://raw.githubusercontent.com/knative/build-templates/master/kaniko/kaniko.yaml
</span></span></code></pre></div><p>然后我们需要在我们的应用 YAML 中添加更多：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">serving.knative.dev/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">knative-hello-world-kaniko</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">runLatest</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">configuration</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">build</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l">build-bot</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">source</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="nt">git</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">https://github.com/BrianMMcClain/knative-hello-world.git</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">revision</span><span class="p">:</span><span class="w"> </span><span class="l">master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">kaniko</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="nt">arguments</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">IMAGE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">docker.io/brianmmcclain/knative-hello-world:kaniko</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">revisionTemplate</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="nt">container</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">docker.io/brianmmcclain/knative-hello-world:kaniko</span><span class="w">
</span></span></span></code></pre></div><p>虽然直接比较有点困难，但是我们实际上只向 YAML 中添加了一个部分—“Build”部分。我们添加的内容可能看起来很多，但如果你花时间逐条查看的话，它实际上并不坏：</p>
<ul>
<li>serviceAccountName：在 Knative auth 文档中，它遍历了设置服务帐户的过程。所有这些都是通过设置一个 Kubernetes Secret 来验证我们的容器镜像库，然后将其封装到一个服务帐户中。</li>
<li>source：代码所在的位置。例如，git repository。</li>
<li>template：要使用哪个 Build Template。在本例中，我们将使用 Kaniko Build Template。</li>
</ul>
<p>让我们向应用程序的新版本发送一个请求，以确保一切正常：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ curl -XPOST http://<span class="nv">$SERVICE_IP</span> -H <span class="s2">&#34;Host: knative-hello-world-kaniko.default.example.com&#34;</span> -d <span class="s2">&#34;Kaniko&#34;</span>
</span></span></code></pre></div><p>Hello, Kaniko!</p>
<p>尽管这可能是一种更预先的配置，但权衡的结果是，现在我们不必每次更新代码时都构建或推送我们自己的容器镜像。相反，Knative 将为我们处理这些步骤！</p>
<h2 id="buildpack-build-template">Buildpack Build Template</h2>
<p>所以，这个博客的重点是我们如何编写更少的代码。虽然我们已经使用 Kaniko Build Template 删除了部署的一个操作组件，但是我们仍然在代码之上维护一个 Dockerfile 和一个配置文件。但是如果我们可以抛弃 Dockerfile 呢？</p>
<p>如果您具有使用 PaaS 的习惯，那么您可能已经习惯了简单地向上推代码，然后发生了一些神奇的事情，然后您就有了一个正常工作的应用程序。你不在乎这是怎么做到的。我们所知道的是，您不必编写 Dockerfile 来将其放入容器中，而且它可以正常工作。在<a href="https://www.cloudfoundry.org/" target="_blank" rel="noopener">Cloud Foundry</a>，这是通过名为<a href="https://docs.cloudfoundry.org/buildpacks/" target="_blank" rel="noopener">buildpacks</a>的框架实现的，该框架为应用程序提供运行时和依赖项。</p>
<p>实际上给我们带来两大好处。不仅有一个使用 buildpacks 的 Build Template，还有一个用于 Node.js 的 buildpacks。就像 Kaniko Build Template 一样，我们将在 Knative 中安装 buildpack Build Template：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f https://raw.githubusercontent.com/knative/build-templates/master/buildpack/buildpack.yaml
</span></span></code></pre></div><p>现在，让我们看看使用 Buildpack Build Template 的 YAML 是什么样子的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">serving.knative.dev/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">knative-hello-world-buildpack</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">runLatest</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">configuration</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">build</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l">build-bot</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">source</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="nt">git</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">https://github.com/BrianMMcClain/knative-hello-world.git</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">revision</span><span class="p">:</span><span class="w"> </span><span class="l">master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">buildpack</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="nt">arguments</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">IMAGE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">docker.io/brianmmcclain/knative-hello-world:buildpack</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">revisionTemplate</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="nt">container</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">docker.io/brianmmcclain/knative-hello-world:buildpack</span><span class="w">
</span></span></span></code></pre></div><p>这与我们使用 Kaniko Build Template 时非常相似。实际上，我们来做个比较：</p>
<pre tabindex="0"><code class="language-code" data-lang="code">&lt;   name: knative-hello-world-kaniko
&gt;   name: knative-hello-world-buildpack
---
&lt;           name: kaniko
&gt;           name: buildpack
---
&lt;             value: docker.io/brianmmcclain/knative-hello-world:kaniko
&gt;             value: docker.io/brianmmcclain/knative-hello-world:buildpack
---
&lt;             image: docker.io/brianmmcclain/knative-hello-world:kaniko
&gt;             image: docker.io/brianmmcclain/knative-hello-world:buildpack
</code></pre><p>那么区别是什么呢？首先，我们可以完全抛弃 Dockerfile。Buildpack  Build Template 将分析我们的代码，确定它是一个 Node.js 应用程序，并通过下载 Node.js 运行时和依赖项为我们构建一个容器。虽然 Kaniko Build Template 将我们从 Docker 容器生命周期的管理工作中解放出来，但 Buildpack Build Template 更进一步，完全不需要管理 Dockerfile 了。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ kubectl apply -f 03-buildpack.yaml
</span></span><span class="line"><span class="cl">service.serving.knative.dev <span class="s2">&#34;knative-hello-world-buildpack&#34;</span> configured
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ curl -XPOST http://<span class="nv">$SERVICE_IP</span> -H <span class="s2">&#34;Host: knative-hello-world-buildpack.default.example.com&#34;</span> -d <span class="s2">&#34;Buildpacks&#34;</span>
</span></span><span class="line"><span class="cl">Hello, Buildpacks!
</span></span></code></pre></div><h3 id="pivotal-function-service">Pivotal Function Service</h3>
<p>让我们检查一下代码库的剩余部分。我们有响应 POST 请求的 Node.js 代码，使用 Express 框架设置 web 服务器。package.json 文件定义了我们的依赖项。虽然这不是真正的代码，但我们也在维护定义 Knative 服务的 YAML。不过，我们可以继续削减。</p>
<p>进入<a href="https://pivotal.io/platform/pivotal-function-service" target="_blank" rel="noopener">Pivotal Function Service</a> (PFS)，这是构建在 Knative 之上的 Pivotal 的商业 serverless 产品。PFS 旨在消除管理代码以外的任何东西的需要。这包括我们在代码库中管理自己的 web 服务器。使用 PFS，我们的代码如下：</p>
<pre tabindex="0"><code class="language-code" data-lang="code">module.exports = x =&gt; &#34;Hello, &#34; + x + &#34;!&#34;;
</code></pre><p>就是这样，没有 Dockerfile，没有 YAML。只要一行代码。当然，像所有优秀的节点开发人员一样，我们仍然需要有自己的 package.json 文件，尽管它不依赖于 Express。一旦部署完毕，riff 将使用这一行代码并将其封装在自己的托管容器镜像中。它将把它与调用<a href="https://github.com/projectriff/riff-buildpack" target="_blank" rel="noopener">代码所需的逻辑</a>打包在一起，并像运行在 Knative 上的任何其他函数一样提供服务。</p>
<p>PFS CLI 使得部署我们的函数变得非常容易。我们将给函数命名为 pfs-hello-world，为它提供到代码所在的 GitHub 存储库的链接，并告诉它将生成的容器映像上传到我们的私有容器镜像库中。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">pfs <span class="k">function</span> create pfs-hello-world --git-repo https://github.com/BrianMMcClain/pfs-hello-world.git --image <span class="nv">$REGISTRY</span>/<span class="nv">$REGISTRY_USER</span>/pfs-hello-world --verbose
</span></span></code></pre></div><p>几分钟后，我们将看到我们的函数进入运行状态，我们可以像任何其他 Knative 函数一样，向其发送请求：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ curl -XPOST http://<span class="nv">$SERVICE_IP</span> -H <span class="s2">&#34;Host: pfs-hello-world.default.example.com&#34;</span> -H <span class="s2">&#34;Content-Type: text/plain&#34;</span> -d <span class="s2">&#34;PFS&#34;</span>
</span></span></code></pre></div><p>Hello, PFS!</p>
<p>或者，更简单的是，使用 riff CLI 来调用我们的函数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ pfs service invoke pfs-hello-world --text -- -d <span class="s2">&#34;PFS CLI&#34;</span>
</span></span></code></pre></div><p>Hello, PFS CLI!</p>
<p>我们终于实现了目标！由 23 行 YAML、14 行代码和一个 10 行 Dockerfile 组成的简化代码行。</p>
<p>是不是一下子对 PFS 感兴趣了呢？要申请提前访问，只需填写这张<a href="https://pivotal.io/platform/pivotal-function-service" target="_blank" rel="noopener">快速表格</a>!</p>
<h2 id="接下来工作">接下来工作？</h2>
<p>越来越多的构建模板。这是 Knative 最令人兴奋的特性之一，因为它有很大的潜力为各种场景打开一个自定义构建模板的社区。现在，您可以为<a href="https://github.com/knative/build-templates/tree/master/jib" target="_blank" rel="noopener">Jib</a>和<a href="https://github.com/knative/build-templates/tree/master/buildkit" target="_blank" rel="noopener">BuildKit</a>等工具使用模板。已经有一个<a href="https://github.com/knative/build-templates/pull/67" target="_blank" rel="noopener">pull request</a>来更新 Buildpack 构建模板，以支持<a href="https://buildpacks.io/" target="_blank" rel="noopener">Cloud Native Buildpacks</a>。</p>
<p>2018 年是一个激动人心的开始，但是更让我兴奋的是看到 Knative 社区在 2019 年的增长。我们当然可以期望从社区获得更多的构建模板和更多的事件源。不仅如此，我们还可以期望与现有技术更好地集成，例如 Spring，<a href="https://www.youtube.com/watch?v=zCObFAhrhJM" target="_blank" rel="noopener">它已经对此功能提供了强大的支持</a>。</p>
<p>如果您希望开始使用 Knative 进行开发，那么 Bryan Friedman 和我将在 2 月 21 日主持一个很棒的网络研讨会，讨论<a href="https://content.pivotal.io/webinars/feb-21-developing-serverless-applications-on-kubernetes-with-knative-webinar" target="_blank" rel="noopener">developing serverless applications on Kubernetes with Knative</a>。我们将深入研究 Knative 的三个组件，它们是如何工作的，以及作为开发人员如何利用它们来编写更好的代码。</p>
<p>如果你 4 月 2-4 日在费城，请加入我们的<a href="https://www.cloudfoundry.org/event/nasummit2019/" target="_blank" rel="noopener">CF Summit</a>! Bryan 和我将讨论<a href="https://cfna19.sched.com/event/KJD9" target="_blank" rel="noopener">the way to build serverless on Knative</a>，或者如果您看到我们，就说声 hi!</p>

                </div>
                

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/knative/">Knative</a>
  
  <a class="badge badge-light" href="/tag/serverless/">Serverless</a>
  
</div>











  
  
    



  
  
  
  
  
  <div class="media author-card content-widget-hr mb-4">
    
      
      <a href="/author/brian-mcclain/"><img class="avatar mr-3 avatar-circle" src="/author/brian-mcclain/avatar_hue38add62c87b7486d80c9f3fda25dfc1_12220_270x270_fill_q75_lanczos_center.jpg" alt="Brian Mcclain"></a>
    

    <div class="media-body">
      <p class="card-title"><a href="/author/brian-mcclain/">Brian Mcclain</a></p>
      
      
      
    </div>
  </div>


  


  
  
    




  




<div class="article-widget">
  
<div class="container-xl row post-nav">
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1" href="/blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/" rel="next">
    <div class="meta-nav">下一页</div>
    <p>Envoy Proxy 构建控制平面指南</p></a>
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1"  href="/blog/back-to-microservices-with-istio-p1/" rel="prev">
    <div class="meta-nav">上一页</div>
    <p>使用 Istio 打造微服务（第 1 部分）</p></a>
  
</div>

</div>










  

<p class="edit-page">
  <a href="https://github.com/cloudnativeto/cloudnative.to/edit/master/content/blog/knative-whittling-down-the-code/index.md">
    <i class="fas fa-pen pr-2"></i>编辑本页
  </a>
</p>




  
  
  <div class="article-widget content-widget-hr">
    <p class="related-title">相关推荐</p>
    <ul>
      
      <li><a href="/blog/knative-1-0-ga/">Knative 1.0 发布了！</a></li>
      
      <li><a href="/blog/using-knative-as-api-aggregator-layer/">使用 Knative 作为 API 聚合层的实践</a></li>
      
      <li><a href="/blog/knative-serving/">Knative 入门系列 2：serving 介绍</a></li>
      
      <li><a href="/blog/knative-overview/">Knative 入门系列 1：knative 概述</a></li>
      
      <li><a href="/blog/knative-eventing-in-memory-channel-deep-dive/">Knative Eventing in-memory-channel 实现原理解析</a></li>
      
    </ul>
  </div>
  





  
  
  

  

  
  <section id="comments" class="mb-3 pt-0">
    <script>
  let themeNumber = localStorage.getItem('wcTheme');
  var giscusTheme = "light";
  if (themeNumber == 1){
    giscusTheme = "dark";
  }
  let giscusAttributes = {
    "src": "https://giscus.app/client.js",
    "data-theme": giscusTheme,
    "data-repo":"cloudnativeto\/cloudnative.to",
    "data-repo-id":"MDEwOlJlcG9zaXRvcnkyMzc3NDUxOTA=",
    "data-category":"General",
    "data-category-id":"MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDU5MzUy",
    "data-mapping":"pathname",
    "data-reactions-enabled":"",
    "data-emit-metadata":"0",
    "data-input-position":"top",
    "data-theme":giscusTheme,
    "data-lang":"zh-CN",
    "data-loading":"lazy",
    "crossorigin":"annoymous",
    "origins":"https://cloudnative.to",
    "originsRegex":"http://localhost:[0-9]+",
    "async": "",
  };

  let giscusScript = document.createElement("script");
  Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
  document.querySelector('#comments').appendChild(giscusScript);
</script>

  </section>
  



            </article>
        </main>
    </div>
</div>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">© 2020-2023 云原生社区保留所有权利</p>
        </div>
    </div>
  </div>

</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.46271ef31da3f018e9cd1b59300aa265.js"></script>




  

  
  

  

  
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
    
    
  










  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <div class="article-metadata search-hit-type">{{relpermalink}}</div>
          <a href="{{relpermalink}}">{{title}}</a>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":false}</script>










  
  


<script src="/zh/js/wowchemy.min.24983018b0e5661cd5fe1822254286ea.js"></script>







<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
<script>
  anchors.add();
</script>



<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, '已复制')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>



<script>

function Collapse(e){
  var node = document.getElementById(e);
  if (node.className.indexOf('fa-angle-down') > -1){
    node.setAttribute("class", "fa-solid fa-angle-right");
    }else{
    node.setAttribute("class", "fa-solid fa-angle-down");
    }
}
</script>


</body>
</html>
