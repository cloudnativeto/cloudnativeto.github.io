<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
  

  

  
  
  
    
  
  <meta name="description" content="本文是根据蚂蚁金服 Service Mesh 布道师敖小剑在 Service Mesher 社区进行的第一次 Meetup 上分享的《大规模微服务架构下的 Service Mesh 探索之路》现场演讲内容实录整理编辑而成，希望能给关注 Service Mesh 产品的朋友们带来帮助和了解。" />

  
  <link rel="alternate" hreflang="zh" href="https://cloudnative.to/blog/the-way-to-service-mesh-in-ant-financial/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.008259417e6adf8980695ebbbb46553f.css" />

  



  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f3dc895ea3bd6186cd835841d365c103";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu0802e500a55b0406ddf0453824effa47_6997_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu0802e500a55b0406ddf0453824effa47_6997_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://cloudnative.to/blog/the-way-to-service-mesh-in-ant-financial/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@CloudNativeCN" />
    <meta property="twitter:creator" content="@CloudNativeCN" />
  
  <meta property="og:site_name" content="云原生社区（中国）" />
  <meta property="og:url" content="https://cloudnative.to/blog/the-way-to-service-mesh-in-ant-financial/" />
  <meta property="og:title" content="蚂蚁金服大规模微服务架构下的 Service Mesh 探索之路 | 云原生社区（中国）" />
  <meta property="og:description" content="本文是根据蚂蚁金服 Service Mesh 布道师敖小剑在 Service Mesher 社区进行的第一次 Meetup 上分享的《大规模微服务架构下的 Service Mesh 探索之路》现场演讲内容实录整理编辑而成，希望能给关注 Service Mesh 产品的朋友们带来帮助和了解。" /><meta property="og:image" content="https://cloudnative.to/media/sharing.png" />
    <meta property="twitter:image" content="https://cloudnative.to/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
      <meta
        property="article:published_time"
        content="2018-07-04T19:56:20&#43;08:00"
      />
    
    <meta property="article:modified_time" content="2024-01-02T10:17:56&#43;08:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cloudnative.to/blog/the-way-to-service-mesh-in-ant-financial/"
  },
  "headline": "蚂蚁金服大规模微服务架构下的 Service Mesh 探索之路",
  
  "datePublished": "2018-07-04T19:56:20+08:00",
  "dateModified": "2024-01-02T10:17:56+08:00",
  
  "author": {
    "@type": "Person",
    "name": "敖小剑"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "云原生社区（中国）",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cloudnative.to/media/logo.svg"
    }
  },
  "description": "本文是根据蚂蚁金服 Service Mesh 布道师敖小剑在 Service Mesher 社区进行的第一次 Meetup 上分享的《大规模微服务架构下的 Service Mesh 探索之路》现场演讲内容实录整理编辑而成，希望能给关注 Service Mesh 产品的朋友们带来帮助和了解。"
}
</script>

  

  

  

  





  <title>蚂蚁金服大规模微服务架构下的 Service Mesh 探索之路 | 云原生社区（中国）</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="8a30b376ca7b2fb143e14a4d33224038" >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.62d6f8dfe8493f1c68557dde65bec362.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="关闭"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="搜索..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="搜索...">
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生社区（中国）"
            
            ></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生社区（中国）"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/community"><span>社区</span></a>
          </li>

          
          

          

          
          
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link  active" href="/blog"><span>博客</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>资料</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/envoy/"><span>Envoy 中文文档</span></a>
              
                <a class="dropdown-item" href="/kubebuilder/"><span>Kubebuilder 中文文档</span></a>
              
                <a class="dropdown-item" href="https://lib.jimmysong.io/"><span>云原生资料库</span></a>
              
                <a class="dropdown-item" href="https://istio.io/latest/zh/"><span>Istio 中文文档</span></a>
              
            </div>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/event"><span>活动</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#feed"><span>更新</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#tags"><span>标签</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>关于</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        

        
        <li class="nav-item">
            <a class="nav-link" href="/community/join/" data-toggle="tooltip" data-placement="bottom" title="加入社区" aria-label="主站"><i class="fa-brands fa-weixin" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link js-search" href="#" data-toggle="tooltip" data-placement="bottom" title="搜索" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item d-none d-lg-inline-flex">
            <a class="nav-link" href="https://github.com/cloudnativeto/cloudnative.to" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="查看源码" aria-label="查看源码" aria-label="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item">
          <a href="#" class="nav-link set-theme">
            <i class="fa fa-sun" aria-hidden="true" id="theme-icon"></i>
          </a>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <div class="container-xl">
    <div class="post-container">
        












  

  
  
  
<div class="article-container pt-3">
  <h1>蚂蚁金服大规模微服务架构下的 Service Mesh 探索之路</h1>

  

  
    


<div class="article-metadata">

  <div>
  
  
  
  
    <i class="fa-solid fa-feather"></i>
    

  <span >
      <a href="/author/%E6%95%96%E5%B0%8F%E5%89%91/">敖小剑</a></span>
    
    <span class="middot-divider"></span>
    
  
  
  
  
  
  
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/category/service-mesh/" class="text-capitalize">service mesh</a></span>
  
  </div>

  
  <span class="article-date">
    
    
      
          
          发布于
      
    
    2018-07-04
  </span>
  

  

  
  <span class="middot-divider"></span>
  字数 13518
  <span class="middot-divider"></span>
  <span class="article-reading-time">
      阅读时长 61 分钟
  </span>
  

  
  
  
  

</div>

    





  
</div>


    </div>
    <div class="border-bottom mb-2"></div>
    <div class="row flex-xl-nowrap">
        <div class="col-3 d-none d-xl-block docs-toc">
            <!-- toc -->
            
<div class="">
    <ul class="nav toc-top">
        <li>
            <a href="#" id="back_to_top" class="docs-toc-title">目录</a>
        </li>
    </ul>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#一技术选型">一、技术选型</a></li>
    <li><a href="#二架构设计">二、架构设计</a></li>
    <li><a href="#三开源策略">三、开源策略</a></li>
    <li><a href="#四官方社区网站">四、官方社区网站</a></li>
  </ul>
</nav>
</div>

            <!-- /toc -->
            
            <div class="subscribe-module col-12 mt-1">
    <img src="/img/wechat.jpg" alt="image" title="云原生社区的微信公众号"/>
    <p class="text-center pt-1">关注「云原生社区动态」微信公众号，获取本站更新</p>
</div>

            
        </div>
        <main class="article-body col-9 container docs-content" role="main">
            <article class="article">
                <div class="article-style">
                    
                    <details class="toc-inpage d-print-none d-show-block mb-0">
  <summary class="font-weight-bold">点击查看目录</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#一技术选型">一、技术选型</a></li>
    <li><a href="#二架构设计">二、架构设计</a></li>
    <li><a href="#三开源策略">三、开源策略</a></li>
    <li><a href="#四官方社区网站">四、官方社区网站</a></li>
  </ul>
</nav>
</details>

                    
                    <blockquote>
<p>本文是根据蚂蚁金服 Service Mesh 布道师敖小剑在 Service Mesher 社区进行的第一次 Meetup 上分享的《大规模微服务架构下的 Service Mesh 探索之路》现场演讲内容实录整理编辑而成，希望能给关注 Service Mesh 产品的朋友们带来帮助和了解。</p>
<p><strong>讲师 PPT 下载地址</strong>：</p>
<p><a href="https://github.com/servicemesher/meetup-slides" target="_blank" rel="noopener">https://github.com/servicemesher/meetup-slides</a></p>
</blockquote>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dc36ywj30qo0f0wfd_hu44e951f322d6e3275586c1324d739f9b_30178_f0e15d502b1ce743089b629699610be0.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dc36ywj30qo0f0wfd_hu44e951f322d6e3275586c1324d739f9b_30178_d4c9f25264cc8200be279eb269972601.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dc36ywj30qo0f0wfd_hu44e951f322d6e3275586c1324d739f9b_30178_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dc36ywj30qo0f0wfd_hu44e951f322d6e3275586c1324d739f9b_30178_f0e15d502b1ce743089b629699610be0.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>















<figure  id="figure-敖小剑-蚂蚁金服-service-mesh-杭州-meetup">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="敖小剑 蚂蚁金服 service mesh 杭州 meetup" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d1qg75j30u00k1tcu_hu56751345eb9704579eaee2b5ca108b6a_112436_157cb5c69ae3d7504a52537b7703c340.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d1qg75j30u00k1tcu_hu56751345eb9704579eaee2b5ca108b6a_112436_a649867d19ba60bb2a3db311f3924957.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d1qg75j30u00k1tcu_hu56751345eb9704579eaee2b5ca108b6a_112436_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d1qg75j30u00k1tcu_hu56751345eb9704579eaee2b5ca108b6a_112436_157cb5c69ae3d7504a52537b7703c340.webp"
               width="760"
               height="508"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      敖小剑 蚂蚁金服 service mesh 杭州 meetup
    </figcaption></figure>
</p>
<h2 id="前言">前言</h2>
<p>今天给大家带来的内容叫做 Service Mesh 探索之路，但是在前面加了一个定语：<strong>大规模微服务架构下</strong>。之所以加上这个词，是因为我们这个体系是在蚂蚁金服这样一个大的架构下进行的，蚂蚁金服的体量大家可以想象，所以这个探索会带有一个非常隆重的色彩：对性能/规模/高可用等方面的思考。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dewe11j30qo0f0jsq_hu152127ef9097f5ee701e023453509925_42524_aa488ad83e7a680e52d55a1d1664d52f.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dewe11j30qo0f0jsq_hu152127ef9097f5ee701e023453509925_42524_e8587029d1b1bdcfb25a4b7537f76c6b.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dewe11j30qo0f0jsq_hu152127ef9097f5ee701e023453509925_42524_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dewe11j30qo0f0jsq_hu152127ef9097f5ee701e023453509925_42524_aa488ad83e7a680e52d55a1d1664d52f.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>今年 6 月初，在深圳的 GIAC 大会，我们同事披露了这个正在开发中的 Service Mesh 产品，我们现在暂时命名为 SOFA Mesh。我们目前的产品都在 SOFA 品牌下，比如 SOFA RPC，SOFA Boot 等。今天我们详细介绍 SOFA Mesh 这个单独产品，上次大会只是简单披露，也就是给大家介绍说我们有这样一个产品，而我今天的内容是把这个产品详细展开。</p>
<p>主要是三个内容：一是 SOFA Mesh 的技术选型，二是它的架构设计，以及在最后跟大家聊一下，蚂蚁金服在 SOFA Mesh 上的开源策略。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d5yw0aj30qo0f0gm1_hu7b299c52ba88b67a2c679b3d7dee238e_17525_03e14722adca607760c1f83fead17efb.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d5yw0aj30qo0f0gm1_hu7b299c52ba88b67a2c679b3d7dee238e_17525_4f10e9b49ccca4ef43395dffe55cb87f.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d5yw0aj30qo0f0gm1_hu7b299c52ba88b67a2c679b3d7dee238e_17525_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d5yw0aj30qo0f0gm1_hu7b299c52ba88b67a2c679b3d7dee238e_17525_03e14722adca607760c1f83fead17efb.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h2 id="一技术选型">一、技术选型</h2>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2gpr6w3j30qo0f0tbh_hu36ecf0c95a38f7d14a1bb7943c8fdf6b_84447_e8cbab8a737cc0cc47ea5304fa8517ef.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2gpr6w3j30qo0f0tbh_hu36ecf0c95a38f7d14a1bb7943c8fdf6b_84447_fa137d9a285f5f5ee12cbed5c4189f87.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2gpr6w3j30qo0f0tbh_hu36ecf0c95a38f7d14a1bb7943c8fdf6b_84447_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2gpr6w3j30qo0f0tbh_hu36ecf0c95a38f7d14a1bb7943c8fdf6b_84447_e8cbab8a737cc0cc47ea5304fa8517ef.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>先上来一堆要求，刚才我们提到过的，因为是大规模，而蚂蚁金服的体量，大家可以想象到的。实际上在性能，稳定性上，我们的衡量标准，我们考虑的基石，都是以蚂蚁金服这样的一个规模来考虑的。</p>
<p>在这样一个规模下，我们会涉及到一些跟其他公司不太一样的地方，比如说：我们在<strong>性能</strong>的考量上会比较重一些。因为如果性能不高的话，可能没法支撑我们这样一个规模。在考虑性能的时候，就有另外一层考量：架构和性能之间的这个权衡和取舍是要非常谨慎的。性能要求不太高的情况下，架构可能的选择，和需要比较高性能的情况下，可能会有完全不一样的取舍。稳定性就不必说了。</p>
<p>部署方面的要求，首先是我们会用于多种场合：</p>
<ul>
<li>主站是指我们蚂蚁金服内部，比如大家用的最多的支付宝。</li>
<li>金融云，可能有一部分和我们有联系的同学会有所了解，这个是我们推出的针对金融行业的云。</li>
<li>然后还有我们的外部客户</li>
</ul>
<p>部署上会要求这三个场合都能使用。</p>
<p>部署环境也会有多种，刚才我们调查到，有部分同学相对比较前沿一些，现在就已经上 k8s 了。有部分同学还是停留在以前的虚拟机以及物理机这种状态，也有一部分自己上了容器，还有部分同学可能会使用不同的公有云和私有云。这几种不同的环境，我们都是需要满足的。</p>
<p>第三点可能要特殊一些，需要满足各种体系。刚才我们在调查的时候了解到，有部分同学是在做旧有系统改造，那在改造的时候就会遇到一个问题：除了 Service Mesh 之外，还需要跟原来的体系，比如说 SOFA，或者社区主流框架如 Dubbo，Spring Cloud，相互之间打通和过渡。怎么在技术转型期间平滑的让业务做变更，是我们在整个技术选型之前提出的实际要求。整个技术选型是在这样一个背景下进行的。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2da5k87j30qo0f0djw_hufc689b4f57e22bc8d2abc09e04f1ff95_121736_52e2b258d0af75a67fda25845f4d906d.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2da5k87j30qo0f0djw_hufc689b4f57e22bc8d2abc09e04f1ff95_121736_f3b9de519c102400d51562209995b0ec.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2da5k87j30qo0f0djw_hufc689b4f57e22bc8d2abc09e04f1ff95_121736_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2da5k87j30qo0f0djw_hufc689b4f57e22bc8d2abc09e04f1ff95_121736_52e2b258d0af75a67fda25845f4d906d.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>我们做技术选型的时候，有两大方向：</p>
<ul>
<li>
<p><strong>一个选择是在开源产品上做</strong></p>
<p>我们先看右边的路线，起点是找一个开源产品，fork 出来，做增强/扩展/定制，和内部集成。因为开源产品还在继续往前走，所以我们会持续做版本更新，也可以从社区拿到最新版本。相当于是从开源社区做<strong>获取</strong>，然后接下来做反馈，让我们的一些产品，我们做的东西反馈回去。</p>
<p>这条路线比较大的好处是从一开始就可以得到社区的支持，社区往前走的时候也跟着往前走。如果做的比较好，愿意让自己的产品反哺社区，那么社区也可以从中受益。</p>
<p>当然这里面有一个小问题，就是说可能我们自己这个产品路线和开源产品路线可能会有一些分歧，可能我们领先一步，也可能他们领先一步，或者一个事情可能有两个做法。这种情况下，如何让社区的接受我们的改动，会变成这条路线上比较头疼的一个问题。</p>
<p>这是两条路线上的第一条，选择以开源产品为起点。</p>
</li>
<li>
<p><strong>另外一种思路全新打造</strong></p>
<p>或者，如果手上已经有一套类库或者框架，可以在这个基础上做包装。</p>
<p>这条路线有一个好处，<strong>可控性</strong>比较强。因为整个体系是全新打造或者在原有体系上演进而来的，整套体系基本上都是自己的开发团队完全可控的。</p>
<p>这条路线会遇到一个问题，因为长期上看我们也是希望开源的，而开源就意味着不能将自己内部太多的定制化的东西直接做进去，所以在架构上需要考虑可扩展性，可以定制化。因为开源出去的应该是一个标准产品，这样的产品才可以得到社区和客户的认可。客户希望看到一个干净的东西，也需要做扩展，整个体系在设计上会有所不同。</p>
</li>
</ul>
<p>两条路线的终点，从图上看，我们有两个目标：</p>
<ol>
<li>
<p><strong>第一个目标是内部落地</strong></p>
<p>前面提到的，我们需要在蚂蚁金服主站这样的一个巨大规模的场景下落地，这是蚂蚁金服自身的需求。</p>
</li>
<li>
<p><strong>第二个目标是技术输出</strong></p>
<p>因为蚂蚁金服在公司策略上有科技输出的内容，不仅仅我们自己用，我们还需要给出去。</p>
</li>
</ol>
<p>现在我们来看这个问题：目标在这里，然后有左右两条路线，我们该怎么选择？在做的技术选型的时候，这是一个非常大的分歧点，到底是从左边走，还是从右边走？</p>
<p>在公布结果之前，我们先来看一下有什么可选方案。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2ded119j30qo0f0acl_hu4b26f7bbb9d1c8b071c307d6edf90a48_77774_ddd109ee7bd61df22377ff3eee989509.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2ded119j30qo0f0acl_hu4b26f7bbb9d1c8b071c307d6edf90a48_77774_24a4758168e26f90796fb0eae5afe476.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2ded119j30qo0f0acl_hu4b26f7bbb9d1c8b071c307d6edf90a48_77774_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2ded119j30qo0f0acl_hu4b26f7bbb9d1c8b071c307d6edf90a48_77774_ddd109ee7bd61df22377ff3eee989509.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>这是开源方案的选择，第一代的 Service Mesh。</p>
<p>左边的 Linkerd，这个基本上，目前看，大家都已经有点嫌弃了。因为它没有控制平面，用 Scala 写的，基于 JVM，资源消耗比较大。它的可扩展性比较有限的，相对于 Envoy 的扩展性。然后它里面有个 dtab，有接触到的同学就会有认识：dtab 的语法，非常的不人性，很难理解，使用不太方便。另外它的功能是远远不够的，对于蚂蚁金服来说。另外这个产品本身的发展前景已经很暗淡了，所以这个选项就被淘汰了。</p>
<p>Envoy 是非常不错的，做了一些令我们意外的事情：安心的去做好数据平面，没有往上面做很多的东西，而是创造性的提出了 XDS API。整个设计是非常优秀的，性能和稳定性也表现得非常好，甚至看到业界有一个趋势，有一部分的公司开始把他们的 nginx 替换了，不再用 nginx 了，而是用 envoy。也就是说，现在它的稳定性和性能达到和 nginx 一个级别，nginx 大家应该都有听说过，envoy 已经是这样一个工业成熟度。</p>
<p>我们当时选型时是比较头疼的，因为它是 c++写的，c++14。和我们技术栈的差异会比较大，因为蚂蚁的技术栈是以 Java 为主，长期的话，我们可能部分转到 Golang 上去。在这种情况下，C++的技术栈，会让我们比较尴尬，也不是说我们找不到会 c++的同学，而是说，长期上会和我们的方向不一致，我们要在 Java 和 Golang 的技术栈之外再加一个 c++，这就比较难受。</p>
<p>然后我们内部会有大量扩展和定制化的需求。因为我们内部有我们自己的产品，我们自己的需求，我们的通讯方案，我们内部的追踪，监控，日志方案，所以工作量非常大。</p>
<p>总结说，我们觉得 Envoy 很好，但是我们不能简单用。但是它在数据平面上的表现我们是非常认可的，Envoy 在这点做得非常好。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d6vxq4j30qo0f076f_hua06d94fc4b1643b56102879e3d944c26_66674_57ab316fccf7d2c6152cacfaf4ed767b.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d6vxq4j30qo0f076f_hua06d94fc4b1643b56102879e3d944c26_66674_f43820190a927a93d58d7acf99821ec2.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d6vxq4j30qo0f076f_hua06d94fc4b1643b56102879e3d944c26_66674_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d6vxq4j30qo0f076f_hua06d94fc4b1643b56102879e3d944c26_66674_57ab316fccf7d2c6152cacfaf4ed767b.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>开源方案里面的第二代，istio 是我们当时的第一选择，重点关注对象。Istio 现在最大的问题在于它迟迟不能发布生产可用版本，大家如果对 istio 有了解的话，会知道 istio 刚刚发布了 0.8 版本，第一个长期支持版本，但是这个版本也不是生产可用。不出意外的话，按照目前的进度，istio 应该会在 7 月份发布它的 1.0 版本，但是从我们目前的感受上看，1.0 估计可能还是不能工业级的使用。所以需要等，而我们没法等，但是 Istio 的理念和方向我们非常认可。大家看一看，我们这个技术选型有多纠结。</p>
<p>右边的 Conduit，现在 Conduit 的最大限制是它只支持 k8s。而现在蚂蚁金服还没有普及 k8s，我们现在还有很多系统是跑在非 k8s 上的。第二是它的数据平面是 Rust 编写的，这个语言更加小众了，在座的同学有没有人了解 Rust 这门语言？或者听过。（备注：现场大概十几个人举手）大概 10% 左右的同学听过。好，Rust 语言排名大概在 50 名左右。这个语言本身还是蛮认可的，我还很喜欢这个语言，它的一些特性还是非常有道理，如果掌握好还是可以写出非常好的产品，但是它的入门台阶会比较高一点。这个地方比较讨厌的事情是说，因为这个语言本身比较小众，所以基本上是没办法从社区借力的。这里可以举个例子，大家可以看一下 Conduit 的 committer 的人数，大概是 25 个左右，还包括像我这种只提交了几行代码的。Conduit 从 12 月份开源到现在已经有半年时间，半年时间只有这么多的 committer，其中真正有贡献大概 9 到 10 个人，基本上都是他自己的员工。也就说这个产品基本上没办法从社区借力，一个产品，如果大家一起来帮忙，其实很多的细节是可以完善的，但是 Conduit 就卡在 Rust 语言上。</p>
<p>然后还是同样有技术栈的问题，因为这个原因，基本上 Conduit 我们也没法用了。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2ddej49j30qo0f076w_hu7a94ac8f40932d8044b9827bf3cd022b_79694_0f20b0f22ef507de9142313e655adffa.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2ddej49j30qo0f076w_hu7a94ac8f40932d8044b9827bf3cd022b_79694_6b2b6b138b5aa918a922c5f2447219de.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2ddej49j30qo0f076w_hu7a94ac8f40932d8044b9827bf3cd022b_79694_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2ddej49j30qo0f076w_hu7a94ac8f40932d8044b9827bf3cd022b_79694_0f20b0f22ef507de9142313e655adffa.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>我们再看一下国内的在 Service Mesh 领域，其他的一些比较前卫的同学，他们的选择会是什么？</p>
<p>首先是华为，华为自己做了一套 Golang 版本，名字叫做 Mesher。这是由他们之前的一套类库演进而来。它走的路线是，先有类库和框架，然后加 proxy，proxy 打通了之后再慢慢的开始添加控制平面。这是一条非常非常标准的路线，我这边给一个词叫做<strong>老成持重</strong>，因为这条路是最安全的：每一步都是基于现有的产品，很快就可以到下一个里程碑，然后每个里程碑都可以解决一些实际问题，可以直接得到一些红利，这个方案是比较比较稳妥的。比如说第一步是把 proxy 做进去，有了这个切入口之后，就在第一时间获取跨语言的红利，还有技术栈下沉的好处。然后控制平面的创新，可以在这个基础上慢慢往前做。</p>
<p>在对接 Istio 这一条上，现在华为的策略，我们现在从公开途径了解到的是：部分对接 istio，也就是有一部分的 API 兼容 Istio。但是细节上还不太清楚，因为它的开源还没出来，目前得到的消息是，会在 7 月份开源。</p>
<p>第二个是新浪微博的 Motan Mesh，他们也是 Golang 的，但他不太一样，是全新实现。他们用 Go 语言重新写了一把，主要原因是因为它没有 golang 类库，Motan 是基于 Java 的。</p>
<p>刚才看到的这两个产品，他们的思路大体上是相同的，差异在哪里？就是启动的时候是用已有的类库还是重新写？这两个选择之间最大的麻烦在于编程语言，华为原来有 go 的类库，所以继续用 golang 包装一下就好了。但是新浪的类库用的是 Java，而 sidecar 选择的是 go 语言，所以只能重新做了。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dao36ej30qo0dm0u2_hu13c419ebffef72c8c87d6b0bd86e3caf_44337_d72215012ef56d4e8f38723c0cc64c54.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dao36ej30qo0dm0u2_hu13c419ebffef72c8c87d6b0bd86e3caf_44337_e2533616c1f3116e78e04a72a8c7805a.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dao36ej30qo0dm0u2_hu13c419ebffef72c8c87d6b0bd86e3caf_44337_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dao36ej30qo0dm0u2_hu13c419ebffef72c8c87d6b0bd86e3caf_44337_d72215012ef56d4e8f38723c0cc64c54.webp"
               width="760"
               height="388"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>我们再看腾讯，最近看到他们有类似的产品出来。我们看看他们的资料：在数据平台上继续选择 Envoy，因为它比较成熟。腾讯的话大家比较熟悉，尤其是腾讯有非常深厚的 c++背景，所以 Envoy 对他们来说，技术栈是非常 OK 的。而且之前内部其他领域 Envoy 也是在用的，所以底层非常自然的选择了 Envoy。然后控制平面上，据传是&quot;挣扎了一下&quot;。这个词是我抄过的，&ldquo;他们挣扎了一下&rdquo;，最后还是选了 Istio。然后自己做定制和扩展，然后注意到他们也解耦了 k8s。这也是其中一个关键的点：要不要绑定 k8s？</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d8l3mqj30qo0f0myg_hu37556f4d624980f464893f661c35ce73_42489_715c749cc7db8f5e1bc2dd0b262083c1.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d8l3mqj30qo0f0myg_hu37556f4d624980f464893f661c35ce73_42489_7478ae27f0774c388beecf70bd3bb407.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d8l3mqj30qo0f0myg_hu37556f4d624980f464893f661c35ce73_42489_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d8l3mqj30qo0f0myg_hu37556f4d624980f464893f661c35ce73_42489_715c749cc7db8f5e1bc2dd0b262083c1.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>这里还有 UCloud 的一个很有意思的做法，另辟蹊径啊。他的方案很有意思，是一个轻量级的实践：从 Istio 里面，将 Envoy 和 Pilot 单独剥离出来。就是说不用 Istio 整体，把 Mixer 和 Auth 的模块去掉，只要最重要的 Envoy，然后把 Pilot 剥离出来。然后这个 Pilot 还是个定制版，把其他的 adapter 干掉了。Pilot 主要是做服务发现，它底层用 ETCD，做了一个 ETCD 的 adapter，把其他的 adapter 从 Pilot 中去掉。做完这几个事情之后，整个体系就可以脱离 k8s 了，这是一个比较有意思的实践。</p>
<p>总结：在讲我们技术决策过程之前，我们过了一下目前市场上的主要产品，以及一部分实践者的做法。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dbkzxxj30qo0f0jto_huc4f9f0f8ee26a2b12cc3090024169aa1_71246_560c8b078de156be1a4e44fa757fea84.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dbkzxxj30qo0f0jto_huc4f9f0f8ee26a2b12cc3090024169aa1_71246_d03e756349d9a944fe29f55f322d369b.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dbkzxxj30qo0f0jto_huc4f9f0f8ee26a2b12cc3090024169aa1_71246_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dbkzxxj30qo0f0jto_huc4f9f0f8ee26a2b12cc3090024169aa1_71246_560c8b078de156be1a4e44fa757fea84.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>我们现在来详细讲一下，SOFA Mesh 在技术选型上的考虑。</p>
<p>首先第一个，数据平台上 Envoy 是最符合我们要求的，Envoy 确实好。第二个事情是 Envoy 提出的 XDS API 设计是非常令人称道的，我们现在对这个的评价是非常高的。它实际上是一套通用的 API，由于时间的缘故，我今天就不在现场展开 API 的细节。只能说 XDS API 基本上已经成为数据平面和控制平面之间的一个事实标准。</p>
<p>在这种情况下，我们其实是想用 Envoy 的，但是刚才提到我们有个技术栈选择的问题：我们不愿意将 c++纳入到我们主流的技术栈。然后我们本身有太多的扩展和定制，逼得我们不得不去改 Envoy，我们不能简单的拿过去用，我们需要做很多扩展的。</p>
<p>另外一个事情是，我们这个 proxy 不仅仅是用于 Mesh，我们有可能把它引入到 API Gateway 里头，以及后面会提到的名为 Edge Sidecar 的模块。因为这个原因，所以，怎么说呢，想用，但是不合适用。</p>
<p>第二就是在 Istio 上，控制平面这一块 Istio 可以说是做的最好的。基本上，到目前为止，在控制平面上，暂时我们还没有看到做的比 Istio 更好的产品，或者说思路。目前 Istio 整个设计理念，包括它的产品方向，也是我们非常认可的。</p>
<p>但是 Istio 的性能是目前最大的问题，而我们有一个重要的前提：大规模应用。要用在蚂蚁金服主站这样一个场景下，性能和稳定性对我们非常非常的重要。第二个问题是它对非 k8s 的支持不够理想，因为我们还涉及到一个 k8s 没有完全上线的问题。第三个是和侵入式框架互通的问题，我们内部用的是 SOFA，对外推出的时候我们的客户用的可能是 Dubbo 或者 Spring Cloud，Mesh 上去之后，两个系统现在走不通，这是大问题。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2gpc73yj30qo0f00ur_hu12e43533963f0f5f10e4d5810f72cd23_62174_fbee34662e863d1f486cd872e89c1fe8.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2gpc73yj30qo0f00ur_hu12e43533963f0f5f10e4d5810f72cd23_62174_160672e4c0a2e04cd5932abab5374bd3.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2gpc73yj30qo0f00ur_hu12e43533963f0f5f10e4d5810f72cd23_62174_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2gpc73yj30qo0f00ur_hu12e43533963f0f5f10e4d5810f72cd23_62174_fbee34662e863d1f486cd872e89c1fe8.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>最终我们的策略是这样的，这是我们 SOFA Mesh 的技术选型：左边是 Istio 现有的架构，Envoy/Pilot/Mixer/Auth，右边是我们 SOFA Mesh 的架构。</p>
<ul>
<li>最重要的第一点：我们用 Golang 开发的 Sidecar 替换 Envoy，用 Golang 重写整个数据平面。</li>
<li>第二点是我们会合并一部分的 Mixer 内容进到 Sidecar，也就是 Mixer 的一部分功能会直接做进 Sidecar。</li>
<li>第三点是我们的 Pilot 和 Auth 会做扩展和增强。</li>
</ul>
<p>这是我们整个的技术选型方案，实际上是 Istio 的一个增强和扩展版本，我们会在整个 Istio 的大框架下去做这个事情，但是会做一些调整。</p>
<h2 id="二架构设计">二、架构设计</h2>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dcxvr1j30qo0f0jru_hudb1f12e51d9aee64c7c13bcbbec83931_18413_e25dd29278214e137a251f422e4252bd.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dcxvr1j30qo0f0jru_hudb1f12e51d9aee64c7c13bcbbec83931_18413_fdf949b7b3ef077e12be6b2ddbab92c9.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dcxvr1j30qo0f0jru_hudb1f12e51d9aee64c7c13bcbbec83931_18413_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dcxvr1j30qo0f0jru_hudb1f12e51d9aee64c7c13bcbbec83931_18413_e25dd29278214e137a251f422e4252bd.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>然后我们来详细介绍一下在这个技术选型上我们怎么去做实现。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d34esij30qo0f075z_huccddac4675bb40e2a3871f542a671d1b_53966_e40977c0147fe6f3d10f78136ec14f8f.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d34esij30qo0f075z_huccddac4675bb40e2a3871f542a671d1b_53966_cb14f22a2bee4f60bd7eae38ce3721e2.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d34esij30qo0f075z_huccddac4675bb40e2a3871f542a671d1b_53966_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d34esij30qo0f075z_huccddac4675bb40e2a3871f542a671d1b_53966_e40977c0147fe6f3d10f78136ec14f8f.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>首先是 Golang 版本的 Sidecar，我们会参考 Envoy，非常明确的实现 XDS API。因为 XDS API 是目前的事实标准，所以我们选择遵循，然后我们会让它兼容 Istio。</p>
<p>在协议支持上，我们会支持标准的 HTTP/1.1 和 HTTP/2，也就是大家常见的 REST 和 gRPC 协议。然后我们会增加一些特殊的协议扩展，包括 SOFA 协议，Dubbo 协议，HSF 协议。我们现在正在做这几个协议的扩展，然后 XDS API 我们支持，mixer service 我们没有改动，遵循现有实现。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dg7rw3j30qo0f0gnm_hu901c1601c4daf6d1b8373dc57a90e877_62210_2c9f5f91efe1a345a53b3aae47ec6c83.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dg7rw3j30qo0f0gnm_hu901c1601c4daf6d1b8373dc57a90e877_62210_a4adb34d06c8fb31325240dd79530962.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dg7rw3j30qo0f0gnm_hu901c1601c4daf6d1b8373dc57a90e877_62210_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dg7rw3j30qo0f0gnm_hu901c1601c4daf6d1b8373dc57a90e877_62210_2c9f5f91efe1a345a53b3aae47ec6c83.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>最大的变化在 Mixer，其实刚才的 Sidecar 虽然是全新编写，但是说白了是做 Envoy 的替换，在架构上没有什么变化。但是第二步的变化就非常大，我们会合并一部分的 Mixer 功能。</p>
<p><strong>Mixer 的三大功能：</strong></p>
<ol>
<li>check。也叫 precondition，前置条件检查，比如说黑白名单，权限。</li>
<li>quota。比如说访问次数之类。</li>
<li>report。比如说日志，度量等。</li>
</ol>
<p>三大功能里面，注意到，前两个功能是同步阻塞的，就是一定要检查通过，或者是说 quota 验证 OK，才能往下走。如果结果没回来只能等，因为这是业务逻辑，必须要等。而 Report 是可以通过异步和批量的方式来做的。</p>
<p>在这里，我们现在的决策是：我们会将其中的两个部分 (check 和 quota) 合并进来，原有 report 部分我们会继续保留在 mixer 里面。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dgq9tzj30qo0f0q59_huc5a3f01e433318812d9db1bf49ec5912_72036_e44c3d6e70cfcc3f9f89e265652ea234.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dgq9tzj30qo0f0q59_huc5a3f01e433318812d9db1bf49ec5912_72036_4ca1002de652b632ad782e325d00e9d3.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dgq9tzj30qo0f0q59_huc5a3f01e433318812d9db1bf49ec5912_72036_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dgq9tzj30qo0f0q59_huc5a3f01e433318812d9db1bf49ec5912_72036_e44c3d6e70cfcc3f9f89e265652ea234.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>可能大家会问：为什么我们要选择用这个方案，而不是遵循 Istio 的标准做法？我们之前聊到，我们会尽量去和 Istio 做兼容，跟随 Istio 的设计理念和产品方向，但是我们在它的架构上做了一个重大的调整。为什么？</p>
<p>最大的问题就是<strong>对性能的影响</strong>。</p>
<p>给大家解释一下，看右边这个图，Envoy 在每次请求进来的时候，要去做两次调用：</p>
<ol>
<li>第一次在请求转发之前要做一次 check，这个 check 里面包含了 quota。Check 完成通过，才能把请求转发过去。</li>
<li>请求转发完成之后，再调用 report，报告一下响应时间，日志，度量等信息</li>
</ol>
<p>每次 traffic 都会有两次调用：一次 check，一次 report。而这是远程调用，因为这两个模块是两个进程，Mixer 是单独部署的。</p>
<p><strong>同步阻塞</strong>意味着必须要等，<strong>远程调用</strong>意味着有开销而且有延迟。这个事情是发生在<strong>每一次</strong>请求里面，意味着整个的性能一定会受影响。而考虑到我们蚂蚁金服这样一个体量，其实我们是很难承受。所以我们有自己的观点：我们不是太认可这样的一个方式，我们的想法是说我们要把它拆分出来想一想：</p>
<ul>
<li>
<p>如果是需要请求做同步阻塞的功能，比如说黑白名单的验证，可能要检查 IP 地址，可能检查 quota。这些逼请求一定要做同步阻塞等待结果的功能，就<strong>不应该放在 Mixer 中</strong>去完成去远程调用，而应该在 Sidecar 中完成。</p>
<p>这是我们的观点，原因就是远程调用带来的系统开销，这个代价实在是太高了！</p>
</li>
<li>
<p>然后其他的功能，比如说可以优化为异步的，或者可以以批量方式来提交的，最典型的就是 Report。Report 其实是可以异步提交，可以把十个请求打包到一个 report 同时提交，这些都是 OK 的。</p>
</li>
</ul>
<p>这是我们的基本想法。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d4iuw2j30qo0e5jtm_hu75cf6f0e19e5e2967da510eaca75c30e_70505_8d68d49d59ea53f74487f91643ed9918.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d4iuw2j30qo0e5jtm_hu75cf6f0e19e5e2967da510eaca75c30e_70505_9a600e535d931b4ed92eafbcb574e427.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d4iuw2j30qo0e5jtm_hu75cf6f0e19e5e2967da510eaca75c30e_70505_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d4iuw2j30qo0e5jtm_hu75cf6f0e19e5e2967da510eaca75c30e_70505_8d68d49d59ea53f74487f91643ed9918.webp"
               width="760"
               height="403"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>这个问题其实在 Istio 里面是给了一个解决方案的。最早的时候，Istio 0.1 版本中，一出来就发现这个问题。从去年 5 月份开始到现在，13 个月的时间里，他只给了一个解决方案，就是在 Mixer 上的这个位置加了一个 Cache。这个的 Cache 的想法是：把这些结果缓存在 Envoy 的内存里面，如果下次的检查参数是相同的，那我们可以根据这样一个缓冲的设计，拿到已经缓存的结果，就可以避免远程调用。这个方式是很理想的，对吧？只要缓存能够命中，那就可以避免这一次远程调用。</p>
<p>然后第二个优化是 report，现在的 report 是通过异步模式完成的，而且是批量。</p>
<p>理论上说，如果这两个事情做到足够理想，Mixer 应该就不是瓶颈。对吧？</p>
<p>问题在于：这个 Cache 真的搞得定吗？</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d5hscdj30qo0f00ul_hufad47c1888c051d8c1fcf72c1482e418_57406_e13f2378ab98b1c4675fe5f65bb26251.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d5hscdj30qo0f00ul_hufad47c1888c051d8c1fcf72c1482e418_57406_807e69e55ce8a7bfe6dfab40858e31b9.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d5hscdj30qo0f00ul_hufad47c1888c051d8c1fcf72c1482e418_57406_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d5hscdj30qo0f00ul_hufad47c1888c051d8c1fcf72c1482e418_57406_e13f2378ab98b1c4675fe5f65bb26251.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>我们给一个简单的例子，我现在假设 Mixer 有三个 adapter。然后它的输入值是不同的属性，属性是 istio 的概念，理解为若干个输入值。假设，需要三个 adapter 分别检查 A/B/C。如果这三个属性 A/B/C，他们只有 100 个取值范围，每个都是从 0 到 100，我们假设这种最简单的场景。</p>
<p>如果这三个 adapter 分别做缓存的话，需要多少个缓存项？很容易计算吧？100 个 a，100 个 b，100 个 c，非常容易计算，这种情况下，其实就是 a+b+c 等于 300 嘛。理解一下：有三个输入，每个输入只有一百个取值范围，我们要把他们缓存起来。这些缓存大小，就是允许的范围，然后加起来。只要有 300 个 key，就都可以缓存起来。</p>
<p>但是，这个方法中，缓存是做在 mixer 这边，每个 adapter 单独缓存。但是，在 Istio 中，缓存是做在 Envoy 这端的，因为做在 mixer 这端是没有用的，还是要远程调用过去。它做缓存的很重要的目标是要在客户端避免远程调用。所以，这种情况下，把缓存放到这里（备注，图中绿色方块）。</p>
<p>大家现在想一想，现在这里只有一个缓存，只有一个 key/value。现在还有刚才的这个场景，A/B/C 各自的取值范围都是一百。但是现在缓存放在这边的话，实际上的这个 key 要考虑三个值了，A/B/C 的组合。这种情况下，它的最大缓存个数是多少？</p>
<p>（备注：现场回答，a 乘 b 乘 c）</p>
<p>a * b * c？还能 a + b + c 吗？做不到了，对不对？现在是 a * b * c，从 300 变成这么大的数了。为什么？因为缓存是在这个地方做的，根本没有办法像这样分开做，所以这里就变成了一个笛卡尔乘积。</p>
<p>这个笛卡尔乘积有一个很大的麻烦，也就是说，如果 adapter 检查的某个属性，它的取值范围比较大，比如说要检查客户端的 IP 地址？你想想，这个 IP 地址有多少个取值范围？数以几十万几百万计，对吧？这种情况，哪怕在前面再乘以特别小的值，哪怕只是十，二十，如果是加 20 根本没所谓的，加 200，加 2000 都没所谓的，那乘个 200，乘个 2000 试一下？瞬间就被干掉。IP 地址可能只是百万级别，再在前面乘个 100，乘个 1000，瞬间就疯掉了。这个 key 值基本上已经是大到不能接受：要么就全放内存，内存爆掉；要不然限制缓存大小，就放 1 万个，缓存的命中率会非常低，整个缓存相当于失效了。</p>
<p>这个细节，因为时间原因，不在这里详细讲了。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d6h2fgj30qo0dzq50_huae73236e62d72be74319862558465a62_66107_865505fe243f8eb2ab764424e549e61b.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d6h2fgj30qo0dzq50_huae73236e62d72be74319862558465a62_66107_0e8f355d22124c0412a7760b35640c85.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d6h2fgj30qo0dzq50_huae73236e62d72be74319862558465a62_66107_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d6h2fgj30qo0dzq50_huae73236e62d72be74319862558465a62_66107_865505fe243f8eb2ab764424e549e61b.webp"
               width="760"
               height="398"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>这里讲第二点，我们的反省：隔离怎么做？</p>
<p>Mixer 有一个基本的设计目标，就是希望提供一个统一的抽象（就是这个 adapter 的概念），用它来隔离基础设施后端和 Istio 的其他部分。但是在这个点上我们的反思是：我们认可这样一个隔离。大家理解基础设施后端的概念吧？举个例子，日志处理如 prometheus，各种后端监控系统。这些系统和应用之间，我们认为这种情况下的确应该做隔离，没必要每个应用都去和基础设施后端产生直接的联系。这个观点是我们是赞许的。</p>
<p>但是我们现在的意见是，我们把这条线 (备注：连接应用和基础设施后端的标记有红叉的线) 从应用里面拿下来之后，我们把它下沉。下沉到 Sidecar，够不够？Istio 的做法是，它觉得这个地方应该再往前走一步，到 Mixer 里面。由 Mixer 去完成和基础设施后端的连接，走这根线（备注：图中连接 Mixer 和基础设施后端的线）。但是多了这样一个隔离之后的代价，就是在中间的这根红线上，会多一次远程调用。</p>
<p>现在只有两个选择：和基础设施怎么连？这条线（备注：最左边的）大家都认为没必要，这两条线（备注：中间和右边的线）之间选，两条线的差异，就是要付出一次远程调用的代价。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dcki7oj30qo0f0dim_hu00e85c1c4b04a0a9a714a1f21ceee751_84563_154ec1fea79850b5580468dec439496c.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dcki7oj30qo0f0dim_hu00e85c1c4b04a0a9a714a1f21ceee751_84563_cd0e30312f3c23a09fa15903e3cea7c1.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dcki7oj30qo0f0dim_hu00e85c1c4b04a0a9a714a1f21ceee751_84563_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dcki7oj30qo0f0dim_hu00e85c1c4b04a0a9a714a1f21ceee751_84563_154ec1fea79850b5580468dec439496c.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>继续反省：什么是基础设施后端？</p>
<p>这里我们做一个列表，整个 Istio 现有的 adapter，大家可以看到，大概是这些。前面这两个部分是实现 check 和 quota 的 adapter，后面这些 adapter 是实现 report 功能。</p>
<p>在这里，我们的反省是：这些功能，比如说黑白名单，比如说基于内存的 quota，或者基于外部 redis 的 quota。我们认为这些功能不太应该视为后端基础设施，因为这些功能更应该是说是体系内置的基本能力，应该直接把它们做成 Mesh 的内置产品，或者说可以做标准化，然后和外部系统集成。这些我认为应该是 Mesh 的最基础的功能，比如说我们 SOFA Mesh 可以提供基于 Redis 的 quota 方案，直接就把这个功能给出来了。我不认为应该再去跟外界的一个所谓的基础设施后端发生联系。</p>
<p>但是下面这些我们是觉得 OK 的。这些 adapter 大家有概念吧，prometheus 大家应该都接触过的。剩下的这些在国内可能用的不多，是各种日志和 metric 相关的功能。把这些视为基础设施后端，我们是非常理解的。包括我们内部，我们蚂蚁也有很多这样的系统，相信各位自家的监控方案也是不一样的。</p>
<p>这些视为基础设施，和系统隔离开，我们认为这是非常有必要，可以理解，可以接受。</p>
<p>这是我们在这一点（备注：何为基础设施后端）上和 istio 的差异。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d3qprxj30qo0f0juf_hu0409926fbd4d13bf273b6589fe909b26_88995_d0987bcaf4982d9c17389647d3829a38.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d3qprxj30qo0f0juf_hu0409926fbd4d13bf273b6589fe909b26_88995_c756d6b107fefad5678d5e92302874dd.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d3qprxj30qo0f0juf_hu0409926fbd4d13bf273b6589fe909b26_88995_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d3qprxj30qo0f0juf_hu0409926fbd4d13bf273b6589fe909b26_88995_d0987bcaf4982d9c17389647d3829a38.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>因为时间原因，我们就不再深入去讲，这里我给了一些我博客上的文章。前段时间，我们在做技术选型，在做前面整个架构设计时，在这一点上有些讨论。以及我们最重要的决策：为什么要把 Mixer 合并进去。细节都在这几篇文章里面，大家如果有兴趣，可以去详细了解。</p>
<p><strong>备注链接地址</strong>（请复制网址到浏览器打开）：</p>
<ul>
<li>
<p><a href="https://skyao.io/post/201804-servicemesh-architecture-introspection/" target="_blank" rel="noopener">Service Mesh 架构反思：数据平面和控制平面的界线该如何划定？</a></p>
</li>
<li>
<p><a href="https://skyao.io/post/201804-istio-achilles-heel/" target="_blank" rel="noopener">Mixer Cache: Istio 的阿克琉斯之踵</a></p>
</li>
<li>
<p><a href="https://skyao.io/post/201804-istio-mixer-cache-concepts/" target="_blank" rel="noopener">Istio Mixer Cache 工作原理与源码分析 (1)－基本概念</a></p>
</li>
<li>
<p><a href="https://skyao.io/post/201806-istio-mixer-cache-principle/" target="_blank" rel="noopener">Istio Mixer Cache 工作原理与源码分析 (2)－工作原理</a></p>
</li>
<li>
<p><a href="https://skyao.io/post/201806-istio-mixer-cache-main/" target="_blank" rel="noopener">Istio Mixer Cache 工作原理与源码分析 (3)－主流程</a></p>
</li>
<li>
<p><a href="https://skyao.io/post/201806-istio-mixer-cache-signature/" target="_blank" rel="noopener">Istio Mixer Cache 工作原理与源码分析 (4)－签名</a></p>
</li>
</ul>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d0rypsj30qo0f0mza_hub9618ed7c66f77cc03521dd2251103f0_64074_95602b03ba3b24513222304bc73738db.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d0rypsj30qo0f0mza_hub9618ed7c66f77cc03521dd2251103f0_64074_c1d74044f8a73d8e3be96c00693f92fd.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d0rypsj30qo0f0mza_hub9618ed7c66f77cc03521dd2251103f0_64074_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d0rypsj30qo0f0mza_hub9618ed7c66f77cc03521dd2251103f0_64074_95602b03ba3b24513222304bc73738db.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>我们还有一部分现在没有合并进来的 adapter 和 mixer，report 的这部分。但是这块不是说完全没有问题，我们现在有一个担心，report 这块可能会存在一个叫做<strong>网络集中</strong>的问题。比如说，大家会注意到，应用和 Sidecar 是一对一部署的，有一万个应用，就有一万个 Sidecar。基础设施后端也是多机部署的。</p>
<p>而现在的方式，流量会先打到 Mixer 来，Mixer 也是高可用的，也是会部署多台。但是这个数量肯定不是一万这个级别，跟这个肯定会有很大的差异。这样流量会先集中，通道会突然间收缩一下。总的流量没变，但是通道的口径要小很多。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d7f735j30qo0f00uz_hubb1c0b799e79c24029c0f5aba294ee61_69254_bc697f049e3b8cd62ff6626284b86956.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d7f735j30qo0f00uz_hubb1c0b799e79c24029c0f5aba294ee61_69254_d10386731f4e66b72286c855a5d3029c.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d7f735j30qo0f00uz_hubb1c0b799e79c24029c0f5aba294ee61_69254_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d7f735j30qo0f00uz_hubb1c0b799e79c24029c0f5aba294ee61_69254_bc697f049e3b8cd62ff6626284b86956.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>对网络吞吐量也会有影响。比如最简单的，如果应用直连，走交换机直接就过去了。</p>
<p>如果是 Sidecar 模式，是在这个位置上（备注：应用和 sidecar 之间的绿色连线）加一个远程调用，但是应用和 Sidecar 之间走的是 localhost，localhost 根本就不走网卡，直接环回地址就走了。对性能不会有什么影响，对网络流量的影响就为零了。所以这两个方案相比，吞吐量不会有变化。</p>
<p>但是，如果在 Sidecar 和 Backend 之间再加一个 Mixer，这意味着要走两次网络，这样的话会有一个流量翻倍的问题。</p>
<p>所以这个地方可能会带来一些问题，但暂时我们现在还没做决策，我们现在还不是很确定这个问题会不会导致质的影响。所以我们现在暂时还是把它放在这里，就是说我们后面会做验证，如果在我们的网络方案下，这个方式有问题的话，我们可能再合进去。但是如果没问题的话，我们认为分开之后架构确实会更理想一些，所以我们现在暂时先不合并。</p>
<p>给大家一些参考，目前 Conduit 最新版本已经把 report 的功能合并进来，然后 check 的功能，会在后续的计划中合并。我们在国内做一些技术交流，华为新浪微博他们现在通通都是选择在 Sidecar 里面实现功能，不走 mixer。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dh5nayj30qo0f00w1_hu30806f951934cf4eac1e4a4a78b1631b_97301_875fc61dd5ab9bf2306ac6411c86f491.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dh5nayj30qo0f00w1_hu30806f951934cf4eac1e4a4a78b1631b_97301_b6b0b8781a2d668317da714680ff0390.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dh5nayj30qo0f00w1_hu30806f951934cf4eac1e4a4a78b1631b_97301_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dh5nayj30qo0f00w1_hu30806f951934cf4eac1e4a4a78b1631b_97301_875fc61dd5ab9bf2306ac6411c86f491.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>这是我们称之为梦幻级别的服务注册和治理中心，我们对他的要求是比较多的：</p>
<ul>
<li>我们需要他支持跨集群，比如说我们现在有多个注册中心，多个注册中心之间可以相互同步信息，然后可以做跨注册中心的调用</li>
<li>还有支持异构，注册中心可能是不一样的东西。能理解吧，有些是 Service Mesh 的注册中心，比如 Istio 的，有些是 Spring Cloud 的注册中心，比如 Consul。</li>
<li>然后终极形态，我们希望在两种场景都可以支持。</li>
</ul>
<p>右边的这个图，是我们构想中的比较理想化的注册中心的架构，我们会有各种 adapter 实现，会有一个抽象的模型，把他们抽象起来，然后有一些接口。后来，在我们实现的时候发现，Istio 的路线跟我们有点像，Istio 本身也是做了跨平台的 Adapter，也做了一层抽象，然后它也提出了一些 API。所以我们最终的决策是：往 Pilot 靠。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d2nt63j30qo0f0mzb_hud03b3dd313d8465d346004ec76242a21_66261_07a997f236944cebe024240780f395fd.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d2nt63j30qo0f0mzb_hud03b3dd313d8465d346004ec76242a21_66261_e64c49401908d77ffadb4707757b9a59.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d2nt63j30qo0f0mzb_hud03b3dd313d8465d346004ec76242a21_66261_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d2nt63j30qo0f0mzb_hud03b3dd313d8465d346004ec76242a21_66261_07a997f236944cebe024240780f395fd.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>我们以 Istio 的 Pilot 模块为基础去做扩展和增强：</p>
<ul>
<li>增加 SOFA Registry 的 Adapter，SOFA Registry 是我们内部的服务注册中心，提供超大规模的服务注册和服务发现的解决方案。所谓超大规模，大家能理解吧？服务数以万计。</li>
<li>再加一个数据同步的模块，来实现多个服务注册中心之间的数据交换。</li>
<li>然后第三点就是希望加一个 Open Service Registry API，增加服务注册，因为现在 Istio 的方案只有服务发现，它的服务注册是走 k8s 的，用的是 k8s 的自动服务注册。如果想脱离 k8s 环境，就要提供服务注册的方案。在服务发现和服务模型已经标准化的情况下，我们希望服务注册的 API 也能标准化。</li>
</ul>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d97ijxj30qo0f00ve_hu99ed9b7c4196fe3540fb557d3c6bd49e_79792_87eb774b15208abd0b48fccb3ea277ed.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d97ijxj30qo0f00ve_hu99ed9b7c4196fe3540fb557d3c6bd49e_79792_b2ec7fed3c75a35a20762648c54b2fb8.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d97ijxj30qo0f00ve_hu99ed9b7c4196fe3540fb557d3c6bd49e_79792_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d97ijxj30qo0f00ve_hu99ed9b7c4196fe3540fb557d3c6bd49e_79792_87eb774b15208abd0b48fccb3ea277ed.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>这里还有一个比较特殊的产品，因为时间限制，给大家简单了解一下。</p>
<p>我们计划的 Edge Sidecar 这个产品，它是东西向服务间通讯的一个特殊桥梁。所谓东西向，大家能理解吧？东西向指服务间通讯，也就是 A 服务调用 B 服务。对应的还有南北向，南北向通常是指从外部网络进来调用服务，如走 API Gateway 调用服务。在东西向通讯中，我们有时会需要一个比较特殊的途径，比如说在这个图中，我们有两个集群，两个集群各有各自的服务注册中心。我们通过增强 Pilot 的方式打通两个注册中心，可以知道对方有什么服务。</p>
<p>当 A 服务发出一个请求去调用 B 服务的时候，由于两个集群是隔离的，网络无法相通，肯定直接调用不到的。这时 local sidecar 会发现，服务 B 不在本集群，而在右边这个集群里，Local Sidecar 就会将请求转发给 Edge Sidecar，然后由 Edge Sidecar 接力完成后续的工作。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2db3805j30qo0f0tas_hu3d17eea6ce222b761c52fa43679fd95d_65897_d11ef773e735d8fe917090d9e4497cb5.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2db3805j30qo0f0tas_hu3d17eea6ce222b761c52fa43679fd95d_65897_0889681d152aac8555ef88ec0132377f.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2db3805j30qo0f0tas_hu3d17eea6ce222b761c52fa43679fd95d_65897_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2db3805j30qo0f0tas_hu3d17eea6ce222b761c52fa43679fd95d_65897_d11ef773e735d8fe917090d9e4497cb5.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>这个模块的功能会比较特殊一点，因为时间限制，在今天的过程当中，Pilot 和 Edge Sidecar 就不再详细展开。</p>
<p>下个月在北京的 meetup 上，我们这边负责这一块工作的专家，俊雄同学，会给大家详细展开。</p>
<h2 id="三开源策略">三、开源策略</h2>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2ddv17cj30qo0f074r_hu1114778e765baf39b2cb197260c2ca5f_18955_0dc76721f64f06dba454d91561c10502.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2ddv17cj30qo0f074r_hu1114778e765baf39b2cb197260c2ca5f_18955_ae2a6de08e604f8b78e88d262d0660db.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2ddv17cj30qo0f074r_hu1114778e765baf39b2cb197260c2ca5f_18955_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2ddv17cj30qo0f074r_hu1114778e765baf39b2cb197260c2ca5f_18955_0dc76721f64f06dba454d91561c10502.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>SOFA Mesh 的开源策略，可能会和大家之前接触到的一些开源产品，有质的差异，非常的不一样。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d0glyij30qo0f077i_hub324c89f33ac063094308b7b7e04a48e_97618_9561e70b2e168c62f4f44bd93f131298.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d0glyij30qo0f077i_hub324c89f33ac063094308b7b7e04a48e_97618_749c05ab5b9a06e6569ce72ee149e0fe.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d0glyij30qo0f077i_hub324c89f33ac063094308b7b7e04a48e_97618_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d0glyij30qo0f077i_hub324c89f33ac063094308b7b7e04a48e_97618_9561e70b2e168c62f4f44bd93f131298.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>备注：这块就不整理了，直接看图中文字。</p>
<p>这是整个大的愿景。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dfat8jj30qo0f0n00_hu3f1c6cc7172e36716984afdc03fea05d_85952_5ef57d37986536688cb507f27b87a611.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dfat8jj30qo0f0n00_hu3f1c6cc7172e36716984afdc03fea05d_85952_80ed2516ca80461aa984291e73de5ff2.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dfat8jj30qo0f0n00_hu3f1c6cc7172e36716984afdc03fea05d_85952_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dfat8jj30qo0f0n00_hu3f1c6cc7172e36716984afdc03fea05d_85952_5ef57d37986536688cb507f27b87a611.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>SOFA Mesh 的开源态度，其实我写左边这些的时候是有很大压力的。用官方话语说，不针对任何人和任何项目，我们不影射任何人。</p>
<p>但是，大家如果经常用各种开源产品的话，会发现一些问题。比如说，开源的时机。大家接触的开源产品，尤其是国内的，不管是多大的公司，通常都是产品完成之后，甚至是使用好多年。好处是相对稳，缺点是什么？（备注：现场回答，老）对，技术可能已经很老了，十年前的！还有可能是它都已经放弃了，开源出来时自己不再使用。或者说是一个很新的产品，真的很新，他自己不用，说就是做出来给你用的。（备注：现场哄笑）自己不用的产品给你用，你的第一反应是什么？小白鼠是吗？你愿意做小白鼠吗？你敢把公司的这个产品放上面吗？</p>
<p>SOFA Mesh 这次比较特殊，非常非常特殊。我们这个产品，会在非常早的时间点上开源给大家。我甚至可以跟大家说，其实在这个点上，我们更重要的是摆明态度：我们要开源，我们要把这个产品开源给大家，甚至早到我们自己都不认为这是一个完整的产品。为什么？</p>
<p>有几个事情，这几点大家认可吧？业界最新的技术，Mesh 是最新技术大家都已经达成共识了吧？业界最好的架构，当然这个我们还在努力中，尽量做好。然后我们会给大家一个承诺，大家不用担心做小白鼠，你能拿到的产品，我们已经趟过一遍了。</p>
<p>开源动机，这个地方我们也不说大话，就是我们希望能吸引整个社区，谋求这样一个合作，走开源共建的方式。这是为什么我们会选择在现在这个时间点上开源出来。</p>
<p>整个产品的维护，什么样的产品会让你有信心，不用担心中间断掉？最重要的一点是我们自己在用。想想，如果支付宝在用，你担心这个项目死掉吗？对不对？如果这个产品本身是蚂蚁金服这样级别的公司，在它的线上将会使用的产品，而且是同样一个核心的版本。相信在这种情况下，大家就放心了吧？</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2gq7wlrj30qo0f076u_hu3d8c90d0ef830665db1fcb630181858d_75093_e87967c63056471ec28d598b53675653.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2gq7wlrj30qo0f076u_hu3d8c90d0ef830665db1fcb630181858d_75093_24b40e5e060a8fcd7abce49b382d0991.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2gq7wlrj30qo0f076u_hu3d8c90d0ef830665db1fcb630181858d_75093_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2gq7wlrj30qo0f076u_hu3d8c90d0ef830665db1fcb630181858d_75093_e87967c63056471ec28d598b53675653.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>SOFA Mesh 的合作模式，我称之为&quot;多层次全方位开放&quot;。</p>
<p>中间这幅图，最底下的是<strong>基础类库</strong>，实现各种功能。我们希望有这样一套基础类库，类比 Netflix 的 OSS 套件。因为 Golang 的类库做的不是很好，没有 Java 沉淀的那么好。目标是希望在这个产品做完之后，能给整个社区沉淀出一套 Golang 的微服务基础类库。最重要的一点，是希望最好能大家合力，在这个点上做出一套成熟稳定性能足够好的产品。这是在类库层面。</p>
<p>在类库之上，功能模块层面，比如说 Golang 版本的 Sidecar，我们希望它能替换 Envoy 的功能。在原来使用 Envoy 的情况下可以使用这个 Sidecar 来替代。体现在什么层次？就是说，如果想用 Envoy，也很喜欢它，但是可能又受限于 C++语言栈，更希望是 Golang 语言栈的时候，可以选择我们这一套。或者如果我们抱有同样的想法，比如想把 Mixer 合进来，可以在 Sidecar 这个层面上来重用我们的产品，跟我们做合作。或者我们刚才提到的这个产品，增强版本的 Pilot，大家有印象吧？我们会实现一个非常强大的，跨各种集群，各种异构的服务注册机制。然后是 Edge Sidecar，在两个不同的区域之间，比如两个不同的机房，IP 地址不通的情况下，帮你打通服务间调用。这些功能模块，会以单独的产品和项目出现，你可以在某一个产品上跟我们合作。</p>
<p>第三点就是完整的产品，如果你需要一个完整的 Service Mesh 的产品，把这些所有的功能都包括进来，没问题，SOFA Mesh 可以拿来用。</p>
<p>有些同学可能会需要更完整的解决方案，我们的金融云会提供 SOFA Mesh 的支持，这是我们的目标。你可以将你的系统，架构在金融云之上。</p>
<p>今天的几位讲师来自不同的公司，我们非常欢迎业界参与。如果大家有意在 Service Mesh 领域做一些事情，大家可以相互之间做技术的沟通，技术的交流，在社区合作上做一些事情。</p>
<p>有些同学说，我只是用一下，好像没法做什么贡献。其实，&ldquo;用&quot;是一个很重要的合作，你能够用，你就会遇到问题，有你的诉求，遇到什么样的 bug，有什么样需求没有满足。这些对我们来说，是非常重要的输入。在这一点上，欢迎和我们保持合作。 















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d18aozj30qo0f0406_hu77420399868ef2aabaf544000b947780_53257_7232dadb1b815cd01caa92b9402aa052.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d18aozj30qo0f0406_hu77420399868ef2aabaf544000b947780_53257_16a619ded59f7c825e200b2d15322e50.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d18aozj30qo0f0406_hu77420399868ef2aabaf544000b947780_53257_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d18aozj30qo0f0406_hu77420399868ef2aabaf544000b947780_53257_7232dadb1b815cd01caa92b9402aa052.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>SOFA Mesh 的开源宣言，写的比较狗血。但是在这一点上，我觉得这一次 SOFA Mesh 在开源上还是做的比较有诚意。</p>
<p>首先我们认可这个大方向，我们看好 Service Mesh 的前景。体现在什么上呢？我们现在规划，未来整个蚂蚁金服内部的大部分应用都会逐渐的往 Service Mesh 上落。这个内部已经达成一致了，会往这个方向走。</p>
<p>第二是说，&ldquo;勇敢探索&rdquo;，&ldquo;耐心填坑&rdquo;，有在 1.0 版本之前用过大型开源产品的同学，对这两个词都应该有深刻体验，对吧？包括前两年用 0.*版本和 1.1/1.2 版本的 k8s 的同学。任何一个新的技术，一个大的方案出来，前期的时候，这些事情是一定会遇到的。但是我们觉得还是要去趟这个事情。</p>
<p>我们要继续推进这样一个技术进步，包括 Service Mesh 技术社区的推广。大家如果有注意的话说，Service Mesh 技术社区已经重新启动了，我们在跟很多的公司，包括甚至我们一些竞争对手合作。从技术进步的角度说，我们欢迎大家在一个公平的基础上做技术交流。</p>
<p>然后我们是愿意做分享的，整个产品，我们接下来所有能开源的东西都会开源出来。除了一些内部定制化的东西，内部没有开源的产品的集成。基本上，你们能看到的东西，也就是我们内部用的东西。</p>
<p>我们寻求和大家的合作，包括刚才讲过的各个层面的合作，哪怕是简单的使用，发现问题给我们提交一些 bug，也是非常好的合作契机。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dfuqcij30qo0f0wg4_hu1d6b0aaf71a6a6c0d4415fbe1a086a8e_51152_075865a002988faad32b870609b76131.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dfuqcij30qo0f0wg4_hu1d6b0aaf71a6a6c0d4415fbe1a086a8e_51152_48e8801a82e80ab8c55b34789b3852a0.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dfuqcij30qo0f0wg4_hu1d6b0aaf71a6a6c0d4415fbe1a086a8e_51152_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2dfuqcij30qo0f0wg4_hu1d6b0aaf71a6a6c0d4415fbe1a086a8e_51152_075865a002988faad32b870609b76131.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>这里我喊一个口号，这个口号有点大，&ldquo;集结中国力量，共建开源精品&rdquo;。这里面有个词，比较大一点，我也斟酌了一下，中国这两个字敢不敢用。最后我觉得还是用吧，至少到目前为止，Service Mesh 这个技术领域，在全世界目前都还没有成熟的场景落地的情况下，我们目前在这方面的探索，已经是走在最前面的了。</p>
<p>在这一点上，我们是希望能联合国内在这个领域做探索的同学，我们一起来做这个事情。我们开源的一个重要目的，是说不管大家在商业上有什么样的竞争，至少在技术领域上，包括刚才说的可以在类库层面，产品层面，或者社区合作方面，开展合作。我们希望能够尽可能的联合国内的合作伙伴，包括竞争对手一起来营造整个技术氛围，把整个 Service Mesh 技术体系的基本水准提升上来。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d7u1q9j30qo0bwjru_hu7b5ce32717647938cdae59fc4253c259_18885_eb1574d69063094be5e1e485851a2acf.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d7u1q9j30qo0bwjru_hu7b5ce32717647938cdae59fc4253c259_18885_1c819c43c1a2009f1690d780a963ac80.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d7u1q9j30qo0bwjru_hu7b5ce32717647938cdae59fc4253c259_18885_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d7u1q9j30qo0bwjru_hu7b5ce32717647938cdae59fc4253c259_18885_eb1574d69063094be5e1e485851a2acf.webp"
               width="760"
               height="339"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>这一点应该是大家比较关注的，什么时候开源？我们只能告诉大家说，on the way，正在路上。</p>
<p>本来这一页的写法应该是贴个地址给大家的，但是因为进度的原因还没有实现，有可能会在一到两个星期之后，在 7 月份的时候开源给大家。</p>
<p>需要澄清的一点，大家的期望值不要太高，因为我们开源出来的第一个版本，主要是释放姿态，把我们的开源共建的姿态释放出来。我们的第一个版本，肯定不是一个完善的版本。（备注：现场有同学问，有在用吗？）内部有用一部分，Sidecar 内部已经在用了，但是第二部分的内容，比如说 XDS API 的集成，我们现在正在做。我们不希望等把产品做完善了，比如说两年之后非常成熟的情况下再来开源。我们希望尽可能早的开源。</p>
<p>（备注：现场提问，7 月份的版本，不一定是生产环境可用？）对，是的。有一部分功能是生产可用的，有一部分功能不是，因为我们是迭代上去的。</p>
<h2 id="四官方社区网站">四、官方社区网站</h2>
<p>这是我们刚刚开通的<a href="https://www.servicemesher.com" target="_blank" rel="noopener">Service Mesh 技术社区的官方网站</a>，欢迎访问。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d27g5jj30qo0f00ui_hu18b9f00a089651d9b9a7b74ac4036992_55833_a19bfe3ec589bd43ec6b3822d8159893.webp 400w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d27g5jj30qo0f00ui_hu18b9f00a089651d9b9a7b74ac4036992_55833_3f17e1762894892bcb0b3eb8af5fc506.webp 760w,
               /blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d27g5jj30qo0f00ui_hu18b9f00a089651d9b9a7b74ac4036992_55833_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/blog/the-way-to-service-mesh-in-ant-financial/006y8mN6ly1g8g2d27g5jj30qo0f00ui_hu18b9f00a089651d9b9a7b74ac4036992_55833_a19bfe3ec589bd43ec6b3822d8159893.webp"
               width="760"
               height="428"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>

                </div>
                

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/service-mesh/">service mesh</a>
  
  <a class="badge badge-light" href="/tag/sofamesh/">sofamesh</a>
  
</div>











  
  
    



  
  
  
  
  
  <div class="media author-card content-widget-hr mb-4">
    
      
      <a href="/author/%E6%95%96%E5%B0%8F%E5%89%91/"><img class="avatar mr-3 avatar-circle" src="/author/%E6%95%96%E5%B0%8F%E5%89%91/avatar_hue38add62c87b7486d80c9f3fda25dfc1_12220_270x270_fill_q75_lanczos_center.jpg" alt="敖小剑"></a>
    

    <div class="media-body">
      <p class="card-title"><a href="/author/%E6%95%96%E5%B0%8F%E5%89%91/">敖小剑</a></p>
      
      <p class="card-text">微软</p>
      
    </div>
  </div>


  





<div class="article-widget">
  
<div class="container-xl row post-nav">
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1" href="/blog/rip-conduit/" rel="next">
    <div class="meta-nav">下一页</div>
    <p>Conduit 0.5 发布—以及 R.I.P. Conduit</p></a>
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1"  href="/blog/istio-deepin-part3-mixer-workflow/" rel="prev">
    <div class="meta-nav">上一页</div>
    <p>Istio 源码解析系列 part3—Mixer 工作流程浅析</p></a>
  
</div>

</div>










  

<p class="edit-page">
  <a href="https://github.com/cloudnativeto/cloudnative.to/edit/master/content/blog/the-way-to-service-mesh-in-ant-financial/index.md">
    <i class="fas fa-pen pr-2"></i>编辑本页
  </a>
</p>




  
  
  <div class="article-widget content-widget-hr">
    <p class="related-title">相关推荐</p>
    <ul>
      
      <li><a href="/blog/microservice-with-service-mesh-at-ant-financial/">蚂蚁金服 Service Mesh 新型网络代理的思考与实践</a></li>
      
      <li><a href="/blog/introducing-sofamesh-a-solution-for-large-scale-service-mesh-by-ant-financial/">蚂蚁金服开源 SOFAMesh—一款基于 Istio 改进和扩展而来的 Service Mesh 大规模落地实践方案</a></li>
      
      <li><a href="/blog/migrating-from-classical-soa-to-service-mesh-in-ant-financial/">蚂蚁金服是如何实现经典服务化架构向 Service Mesh 方向演进的？</a></li>
      
      <li><a href="/blog/osm-deprecated/">OSM（Open Service Mesh）项目将停止更新，团队将协力 Istio 服务网格开发</a></li>
      
      <li><a href="/blog/resiliency-app-aware-network/">利用服务网格和智能应用感知网络增强应用弹性</a></li>
      
    </ul>
  </div>
  





  
  
  

  

  
  <section id="comments" class="mb-3 pt-0">
    <script>
  let themeNumber = localStorage.getItem('wcTheme');
  var giscusTheme = "light";
  if (themeNumber == 1){
    giscusTheme = "dark";
  }
  let giscusAttributes = {
    "src": "https://giscus.app/client.js",
    "data-theme": giscusTheme,
    "data-repo":"cloudnativeto\/cloudnative.to",
    "data-repo-id":"MDEwOlJlcG9zaXRvcnkyMzc3NDUxOTA=",
    "data-category":"General",
    "data-category-id":"MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDU5MzUy",
    "data-mapping":"pathname",
    "data-reactions-enabled":"",
    "data-emit-metadata":"0",
    "data-input-position":"top",
    "data-theme":giscusTheme,
    "data-lang":"zh-CN",
    "data-loading":"lazy",
    "crossorigin":"annoymous",
    "origins":"https://cloudnative.to",
    "originsRegex":"http://localhost:[0-9]+",
    "async": "",
  };

  let giscusScript = document.createElement("script");
  Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
  document.querySelector('#comments').appendChild(giscusScript);
</script>

  </section>
  



            </article>
        </main>
    </div>
</div>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">© 2020-2024 云原生社区保留所有权利</p>
        </div>
    </div>
  </div>

</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.46271ef31da3f018e9cd1b59300aa265.js"></script>




  

  
  

  

  
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
    
    
  










  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <div class="article-metadata search-hit-type">{{relpermalink}}</div>
          <a href="{{relpermalink}}">{{title}}</a>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":false}</script>










  
  


<script src="/zh/js/wowchemy.min.24983018b0e5661cd5fe1822254286ea.js"></script>







<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
<script>
  anchors.add();
</script>



<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, '已复制')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>



<script>

function Collapse(e){
  var node = document.getElementById(e);
  if (node.className.indexOf('fa-angle-down') > -1){
    node.setAttribute("class", "fa-solid fa-angle-right");
    }else{
    node.setAttribute("class", "fa-solid fa-angle-down");
    }
}
</script>


</body>
</html>
