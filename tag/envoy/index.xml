<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>envoy | äº‘åŸç”Ÿç¤¾åŒºï¼ˆä¸­å›½ï¼‰</title>
    <link>https://cloudnative.to/tag/envoy/</link>
      <atom:link href="https://cloudnative.to/tag/envoy/index.xml" rel="self" type="application/rss+xml" />
    <description>envoy</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><lastBuildDate>Tue, 24 Oct 2023 10:00:00 +0800</lastBuildDate>
    <image>
      <url>https://cloudnative.to/media/sharing.png</url>
      <title>envoy</title>
      <link>https://cloudnative.to/tag/envoy/</link>
    </image>
    
    <item>
      <title>åœ¨ UiPath Automation Suite ä¸­ä½¿ç”¨ Envoy å’Œ WASM ä¼˜åŒ–æµé‡è·¯ç”±</title>
      <link>https://cloudnative.to/blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/</link>
      <pubDate>Tue, 24 Oct 2023 10:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://www.uipath.com/inside-the-rocketship/tech-stories/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.uipath.com/inside-the-rocketship/tech-stories/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ UiPath Automation Suite çš„è·¯ç”±åŸºç¡€è®¾æ–½ï¼Œæ­ç¤ºå…³é”®è§è§£å’Œåˆ›æ–°æ–¹æ³•ä»¥æå‡æ€§èƒ½ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;uipath-automation-suite-å†…éƒ¨çš„æµé‡è·¯ç”±&#34;&gt;&lt;strong&gt;UiPath Automation Suite å†…éƒ¨çš„æµé‡è·¯ç”±&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://www.uipath.com/product/automation-suite&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;UiPath Automation Suite&lt;/a&gt;ä½¿æ‚¨èƒ½å¤Ÿåœ¨ Linux ä¸Šéƒ¨ç½²å®Œæ•´çš„&lt;a href=&#34;https://www.uipath.com/product&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;UiPath Business Automation Platform&lt;/a&gt;ï¼Œè¯¥å¹³å°ç”± 40 å¤šä¸ªå¾®æœåŠ¡ç»„æˆçš„ Kubernetes é›†ç¾¤ã€‚å®ƒæœ‰ä¸€ä¸ª API ç½‘å…³ä½äºæ‰€æœ‰å¾®æœåŠ¡ä¹‹å‰ï¼Œå…·æœ‰è‡ªå®šä¹‰çš„è·¯ç”±ä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚æœåŠ¡å‘ç°ã€è¯·æ±‚æ‹¦æˆªã€è¯·æ±‚æ“ä½œå’Œé”™è¯¯å¤„ç†ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/1_hu254ba456d1126507c39ec17036fb0c7b_822098_9d5b3295b99e5cfaeaa750c4603fb78d.webp 400w,
               /blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/1_hu254ba456d1126507c39ec17036fb0c7b_822098_933dcd9e29422007fdd4ef79be804879.webp 760w,
               /blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/1_hu254ba456d1126507c39ec17036fb0c7b_822098_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/1_hu254ba456d1126507c39ec17036fb0c7b_822098_9d5b3295b99e5cfaeaa750c4603fb78d.webp&#34;
               width=&#34;760&#34;
               height=&#34;553&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ Istio å’Œ Envoy è¿™ä¸ªæµè¡Œçš„ç»„åˆä½œä¸ºè·¯ç”±åŸºç¡€è®¾æ–½ï¼Œè·¯ç”±ä¸šåŠ¡é€»è¾‘é€šè¿‡ Envoy è¿‡æ»¤å™¨å†…çš„ Lua è„šæœ¬å®ç°ã€‚é™¤äº†ä»¥ä¸‹å‡ ä¸ªç—›ç‚¹å¤–ï¼Œæ­¤è§£å†³æ–¹æ¡ˆè¿ä½œè‰¯å¥½ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ— æ³•ç›´æ¥è¿æ¥ Redisï¼š&lt;/strong&gt; æˆ‘ä»¬çš„è·¯ç”±å±‚å¤§é‡ä½¿ç”¨ Redis æ¥ç¼“å­˜å®Œæˆè¯·æ±‚è·¯ç”±æ‰€éœ€çš„ä¸šåŠ¡æ•°æ®ï¼Œä¾‹å¦‚æœåŠ¡å…ƒæ•°æ®å’Œç§Ÿæˆ·åˆ°åç«¯çš„æ˜ å°„ç­‰ã€‚ç„¶è€Œï¼ŒEnvoy è¿‡æ»¤å™¨ä¸æ”¯æŒç›´æ¥è¿æ¥åˆ° Redisã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è®©è·¯ç”±å±‚é€šè¿‡ä¸€ä¸ªåç«¯æœåŠ¡ï¼ˆä¸Šå›¾ä¸­çš„ Routing Serviceï¼‰æ¥æ£€ç´¢æ‰€éœ€çš„æ•°æ®ï¼Œè¯¥æœåŠ¡ä¸ Redis è¿æ¥ã€‚é—®é¢˜åœ¨äºåœ¨è´Ÿè½½ä¸‹ï¼Œåç«¯ï¼ˆ&lt;a href=&#34;http://xn--3ds.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨.Net&lt;/a&gt; Core ä¸­ï¼‰ä¼šæ¶ˆè€—ä¸å¿…è¦çš„èµ„æºï¼Œå¹¶å¢åŠ ä¸å¿…è¦çš„å»¶è¿Ÿå¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éš¾ä»¥æ‰©å±•ã€æµ‹è¯•å’Œç»´æŠ¤ï¼š&lt;/strong&gt; ä½¿ç”¨ YAML æ–‡ä»¶å†…çš„ Lua è„šæœ¬å­˜åœ¨æ‰©å±•ã€ç»´æŠ¤å’Œæµ‹è¯•æ–¹é¢çš„æŒ‘æˆ˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;ç›®æ ‡&#34;&gt;&lt;strong&gt;ç›®æ ‡&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬çš„ä¸»è¦ç›®æ ‡æ˜¯æœ€å°åŒ–å®Œæ•´è·¯ç”±å±‚çš„èµ„æºæ¶ˆè€—ï¼Œä»è€Œæå‡æ€§èƒ½å¹¶å¢åŠ å¯æ‰©å±•æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è§£å†³æ–¹æ¡ˆ&#34;&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;å›¢é˜Ÿå·²ç»è¯„ä¼°äº†å„ç§è§£å†³æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œæ¯ä¸ªè§£å†³æ–¹æ¡ˆéƒ½å­˜åœ¨æ˜æ˜¾çš„ç¼ºç‚¹ï¼Œå› æ­¤æˆ‘ä»¬å†³å®šä¸ç»§ç»­è¿½æ±‚è¿™äº›é€‰é¡¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-è¡¨æ ¼æåˆ°äº†ææ¡ˆåŸå› å’Œç¼ºç‚¹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;è¡¨æ ¼ï¼šæåˆ°äº†ææ¡ˆã€åŸå› å’Œç¼ºç‚¹&#34; srcset=&#34;
               /blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/2_huc896e7a3dd948680a2a44bf4c2941c59_1548891_0bede507dd7b84ce4453ff6d3af3376e.webp 400w,
               /blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/2_huc896e7a3dd948680a2a44bf4c2941c59_1548891_550af16a42a2821a6411e349952732aa.webp 760w,
               /blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/2_huc896e7a3dd948680a2a44bf4c2941c59_1548891_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/2_huc896e7a3dd948680a2a44bf4c2941c59_1548891_0bede507dd7b84ce4453ff6d3af3376e.webp&#34;
               width=&#34;760&#34;
               height=&#34;444&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      è¡¨æ ¼ï¼šæåˆ°äº†ææ¡ˆã€åŸå› å’Œç¼ºç‚¹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆï¼Œæˆ‘ä»¬æ„æƒ³äº†åœ¨ Envoy ä¸­ä½¿ç”¨ WebAssemblyï¼ˆWASMï¼‰æ‰©å±•çš„æ¦‚å¿µï¼Œåˆ©ç”¨å…¶å…±äº«æ•°æ®åŠŸèƒ½æ¥å®ç°å†…å­˜ç¼“å­˜ç­–ç•¥ã€‚WASM çš„ä¼˜åŠ¿åœ¨äºä½¿æˆ‘ä»¬èƒ½å¤Ÿçµæ´»é€‰æ‹©ç¼–ç¨‹è¯­è¨€ï¼Œè¿™æœ‰åŠ©äºå¼€å‘å’Œæµ‹è¯•ï¼Œå¹¶ä¿æŒç±»ä¼¼äº Lua çš„æ€§èƒ½ç‰¹å¾ã€‚æ›´é‡è¦çš„æ˜¯ï¼ŒWASM åœ¨ Envoy ä¸­çš„ä½¿ç”¨ï¼ˆ&lt;a href=&#34;https://github.com/proxy-wasm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;proxy-wasm&lt;/a&gt;ï¼‰å¼•å…¥äº†å¯ä¾›æ¯ä¸ª HTTP æµè®¿é—®çš„å…±äº«æ•°æ®ï¼ˆé”®å€¼å­˜å‚¨ï¼‰ã€‚è¿™ç§èƒ½åŠ›å¯¹äºå†…å­˜ç¼“å­˜ç­–ç•¥è‡³å…³é‡è¦ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘åç«¯è·¯ç”±æœåŠ¡çš„ CPU ä½¿ç”¨ç‡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/3_hu3f5fe4fd1ddd84b80dbc484beb684edd_593771_9d3b4fb14c67aeed09f32471d3717df6.webp 400w,
               /blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/3_hu3f5fe4fd1ddd84b80dbc484beb684edd_593771_7c7c063e48692d200f571cc25e287298.webp 760w,
               /blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/3_hu3f5fe4fd1ddd84b80dbc484beb684edd_593771_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/3_hu3f5fe4fd1ddd84b80dbc484beb684edd_593771_9d3b4fb14c67aeed09f32471d3717df6.webp&#34;
               width=&#34;760&#34;
               height=&#34;586&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;å®æ–½ç»†èŠ‚&#34;&gt;&lt;strong&gt;å®æ–½ç»†èŠ‚&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;è·¯ç”±å±‚å†…éƒ¨æ²¡æœ‰è¿›è¡Œé‡å¤§çš„æ¶æ„ä¿®æ”¹ã€‚è½¬å˜ä¸»è¦æ¶‰åŠç”¨ WASM æ’ä»¶æ›¿æ¢åŸºäº Lua çš„ Envoy è¿‡æ»¤å™¨ã€‚è€ƒè™‘åˆ°ç¼“å­˜è·¯ç”±æ•°æ®çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬è®¤è¯†åˆ°è¿™äº›æ•°æ®å¾ˆå°‘å‘ç”Ÿæ›´æ”¹ï¼Œè¿‡æ—¶çš„æ•°æ®ä¸ä¼šå¯¹å®¢æˆ·çš„ä¸»è¦å·¥ä½œæµç¨‹äº§ç”Ÿé‡å¤§å½±å“ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨åŸºäºæ—¶é—´çš„ï¼ˆTTLï¼‰è¿‡æœŸæ¥ç®€åŒ–ç¼“å­˜å¤±æ•ˆç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/4_hud1a48e525deff2835be62c212317e490_826426_24abf789358125c7edf804ba066a770a.webp 400w,
               /blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/4_hud1a48e525deff2835be62c212317e490_826426_7322f6987a5452cc3a5c02b6c33ecba4.webp 760w,
               /blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/4_hud1a48e525deff2835be62c212317e490_826426_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/4_hud1a48e525deff2835be62c212317e490_826426_24abf789358125c7edf804ba066a770a.webp&#34;
               width=&#34;760&#34;
               height=&#34;453&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;WASM æ’ä»¶é¦–å…ˆä»å†…å­˜ç¼“å­˜ä¸­æŸ¥è¯¢è·¯ç”±æ•°æ®ã€‚å¦‚æœå‘ç”Ÿç¼“å­˜å‘½ä¸­ï¼Œåˆ™æ’ä»¶ä¼šç›¸åº”åœ°ä¿®æ”¹åŸå§‹è¯·æ±‚çš„è·¯å¾„å’Œæ ‡å¤´ï¼Œä»¥å°†å…¶è·¯ç”±åˆ°åç«¯æœåŠ¡ã€‚å¦‚æœå‘ç”Ÿç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™å®ƒä¼šä»è·¯ç”±æœåŠ¡ä¸­æŸ¥è¯¢è·¯ç”±æ•°æ®ï¼Œå°†è·¯ç”±æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œå¹¶æœ€ç»ˆä¿®æ”¹åŸå§‹è¯·æ±‚è¿›è¡Œè·¯ç”±ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç»“æœ&#34;&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;é€šè¿‡ä¸ proxy-WASM ç¤¾åŒºçš„åˆä½œåŠªåŠ›ï¼Œæˆ‘ä»¬å·²æˆåŠŸè§£å†³äº† TinyGo çš„åƒåœ¾å›æ”¶å¼•èµ·çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚è¿™äº›æ”¹è¿›å·²ç»çº³å…¥æœ€æ–°å‘å¸ƒç‰ˆä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;èµ„æºåˆ©ç”¨ç‡æ”¹å–„&#34;&gt;&lt;strong&gt;èµ„æºåˆ©ç”¨ç‡æ”¹å–„&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯æ¶µç›– 100K &lt;a href=&#34;https://www.uipath.com/product/robots&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;UiPath æœºå™¨äºº&lt;/a&gt;çš„ç¯å¢ƒä¸­çš„èµ„æºåˆ©ç”¨ç‡æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/5_hu6cad75802f3240dd00c8a4d45721ed49_374207_ad219b7f30ed479263106b4c6c65194e.webp 400w,
               /blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/5_hu6cad75802f3240dd00c8a4d45721ed49_374207_1806a1bbda3207712eea615d44b1efa5.webp 760w,
               /blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/5_hu6cad75802f3240dd00c8a4d45721ed49_374207_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/optimizing-traffic-routing-uipath-automation-suite-envoy-wasm/5_hu6cad75802f3240dd00c8a4d45721ed49_374207_ad219b7f30ed479263106b4c6c65194e.webp&#34;
               width=&#34;760&#34;
               height=&#34;139&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨è·¯ç”±æœåŠ¡ä¸­ï¼ŒCPU ä½¿ç”¨ç‡æ˜æ˜¾ä¸‹é™ï¼ŒIstio å…¥å£ç½‘å…³æ§åˆ¶å™¨çš„ CPU ä½¿ç”¨ç‡ç•¥å¾®é™ä½ã€‚è¿™ç§æƒè¡¡ä¼´éšç€ Istio å…¥å£ç½‘å…³æ§åˆ¶å™¨å†…å­˜æ¶ˆè€—çš„å¢åŠ ã€‚ç„¶è€Œï¼Œè¿™ç§ä¸Šå‡æ˜¯å¯ä»¥é¢„æ–™çš„ï¼Œå¹¶ä¸”åœ¨è€ƒè™‘ CPU èµ„æºçš„æƒ…å†µä¸‹ä»ç„¶å…·æœ‰æˆæœ¬æ•ˆç›Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯æµ‹è¯•æ€§æ”¹è¿›&#34;&gt;&lt;strong&gt;å¯æµ‹è¯•æ€§æ”¹è¿›&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;ä»¥å‰ï¼Œæˆ‘ä»¬çš„æµ‹è¯•è¦†ç›–èŒƒå›´ä»…é™äº Lua ä¸­çš„è¾…åŠ©å‡½æ•°ï¼Œå› ä¸ºåœ¨ Envoy è¿‡æ»¤å™¨çš„ YAML ä¸­æµ‹è¯• Lua è„šæœ¬æ˜¯ä¸å¯è¡Œçš„ã€‚ç„¶è€Œï¼Œç”±äº&lt;a href=&#34;https://github.com/tetratelabs/proxy-wasm-go-sdk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;proxy-wasm-go-sdk&lt;/a&gt;æä¾›çš„&lt;a href=&#34;https://github.com/tetratelabs/proxy-wasm-go-sdk/tree/main/proxywasm/proxytest&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;proxytest&lt;/a&gt;æ¡†æ¶ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ©ç”¨ Envoy ä¸»æœºæ¨¡æ‹Ÿå™¨å®ç°å…¨é¢çš„å•å…ƒæµ‹è¯•è¦†ç›–ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å»¶è¿Ÿ&#34;&gt;&lt;strong&gt;å»¶è¿Ÿ&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;åœ¨è¿›è¡Œæ€§èƒ½æµ‹è¯•åï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°æ¯ä¸ªè¯·æ±‚çš„å»¶è¿Ÿä¿æŒä¸€è‡´ä¸”ä¸å˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸‹ä¸€æ­¥è®¡åˆ’&#34;&gt;&lt;strong&gt;ä¸‹ä¸€æ­¥è®¡åˆ’&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;å±•æœ›æœªæ¥ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯é€šè¿‡ä½¿ç”¨ WASM åœ¨&lt;a href=&#34;https://www.uipath.com/product/automation-suite&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;UiPath Automation Suite&lt;/a&gt;å’Œ&lt;a href=&#34;https://www.uipath.com/product/automation-cloud&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;UiPath Automation Cloud&lt;/a&gt;ä¹‹é—´å»ºç«‹ç»Ÿä¸€çš„è·¯ç”±å±‚ã€‚è¿™ç§æˆ˜ç•¥æ–¹æ³•æ—¨åœ¨æå‡æ€§èƒ½ï¼Œå¹¶é€šè¿‡æ¶ˆé™¤ç»´æŠ¤ä¸¤å¥—ç‹¬ç«‹è§£å†³æ–¹æ¡ˆå’Œä»£ç çš„éœ€æ±‚ï¼Œå‡è½»å·¥ç¨‹å¸ˆçš„è´Ÿæ‹…ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ‰“ç®—å®æ–½ä¸»åŠ¨çš„ç¼“å­˜å¤±æ•ˆæœºåˆ¶ï¼Œä»¥è§£å†³ç‰¹å®šè¾¹ç¼˜æƒ…å†µä¸­çš„è„æ•°æ®æŒ‘æˆ˜ã€‚è¿™ç§ä¸»åŠ¨çš„æ–¹æ³•æ—¨åœ¨æå‡ç”¨æˆ·ä½“éªŒå¹¶æä¾›æ›´æµç•…çš„äº¤äº’ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>äº‘åŸç”Ÿç¤¾åŒº meetup ç¬¬ 12 æœŸæˆéƒ½ç«™</title>
      <link>https://cloudnative.to/event/cloud-native-meetup-chengdu-12/</link>
      <pubDate>Sat, 19 Aug 2023 13:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/event/cloud-native-meetup-chengdu-12/</guid>
      <description>&lt;p&gt;&lt;strong&gt;å˜‰å®¾åŠè®²å¸ˆä»‹ç»&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¼ æ™“è¾‰ï¼š&lt;/p&gt;
&lt;p&gt;CNCF ambassadorï¼Œäº‘åŸç”Ÿç¤¾åŒºç®¡å§”ä¼šæˆå‘˜&lt;/p&gt;
&lt;p&gt;ç‹é’ï¼š&lt;/p&gt;
&lt;p&gt;JFrog ä¸­å›½æŠ€æœ¯æ€»ç›‘ åäº”å¹´æ•æ·ç ”å‘ç®¡ç†ä¸è½¯ä»¶å·¥ç¨‹å®è·µç»éªŒï¼Œç›®å‰ä»» JFrog ä¸­å›½æŠ€æœ¯å›¢é˜Ÿè´Ÿè´£äºº é˜¿é‡Œäº‘ MVP&lt;/p&gt;
&lt;p&gt;å¶å¤©æ˜Ÿï¼š&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ª Rust åˆå­¦è€…å’Œ Rust å¼€æºçˆ±å¥½è€…&lt;/p&gt;
&lt;p&gt;ç‹ç’ï¼š&lt;/p&gt;
&lt;p&gt;è¾¾å¦ç§‘æŠ€ï¼ˆDatenLordï¼‰è”åˆåˆ›å§‹äººã€‚ç‹ç’åšå£«æ‹¥æœ‰å¤šå¹´äº‘è®¡ç®—é¢†åŸŸçš„ç»éªŒï¼Œæ“…é•¿åˆ†å¸ƒå¼è®¡ç®—ã€æµ·é‡æ•°æ®å¤„ç†ã€å¤§è§„æ¨¡æœºå™¨å­¦ä¹ ã€‚&lt;/p&gt;
&lt;p&gt;ç‹ç¥–ç†™ï¼š&lt;/p&gt;
&lt;p&gt;é“œé”é¡¹ç›®æ ¸å¿ƒæˆå‘˜ä¹‹ä¸€ï¼Œèš‚èšé›†å›¢æŠ€æœ¯ä¸“å®¶ï¼Œä¸“æ³¨äºå¯†ç å­¦ã€äº‘åŸç”Ÿã€é«˜æ€§èƒ½å’Œç½‘ç»œå®‰å…¨ç­‰é¢†åŸŸçš„ç ”å‘ã€‚&lt;/p&gt;
&lt;p&gt;å½­æŸ³ï¼š&lt;/p&gt;
&lt;p&gt;Flomesh æŠ€æœ¯ä¸“å®¶ï¼Œèµ„æ·±ç½‘å…³ç ”å‘ã€‚æœ‰å¤šå¹´çš„å¾®æœåŠ¡å’Œç½‘å…³å®è·µç»éªŒï¼Œä¸»è¦å·¥ä½œæ¶‰åŠå¾®æœåŠ¡ã€ç½‘å…³ã€å®¹å™¨ã€Kubernetes ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;è¯¦æƒ…è§&lt;a href=&#34;https://mp.weixin.qq.com/s/hL290d2om3kDGajKMJQPFQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ´»åŠ¨å›é¡¾&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Envoy Gateway 0.3 å‘å¸ƒâ€”â€”æ‰©å±• Kubernetes Gateway API</title>
      <link>https://cloudnative.to/blog/envoy-gateways-latest-v0-3-release-extends-the-kubernetes-gateway-api/</link>
      <pubDate>Tue, 28 Feb 2023 11:20:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-gateways-latest-v0-3-release-extends-the-kubernetes-gateway-api/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://github.com/envoyproxy/gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Gateway&lt;/a&gt; (EG)&lt;a href=&#34;https://tetrate.io/blog/gateway-to-the-future-the-new-gateway-api-and-envoy-gateway-0-2/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é¦–æ¬¡å…¬å¼€å‘å¸ƒ&lt;/a&gt; å››ä¸ªæœˆåï¼Œæˆ‘ä»¬å¾ˆé«˜å…´åœ°å®£å¸ƒå‘å¸ƒ &lt;a href=&#34;https://github.com/envoyproxy/gateway/releases/tag/v0.3.0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‰ˆæœ¬ 0.3&lt;/a&gt; èµ·ã€‚è¿™ä¸ªæœ€æ–°ç‰ˆæœ¬æ˜¯å‡ ä½ Tetrate åŒäº‹å’Œæ•´ä¸ªç¤¾åŒºå…¶ä»–äººè¾›å‹¤å·¥ä½œçš„ç»“æ™¶ã€‚Envoy Gateway ç°åœ¨æ”¯æŒæ•´ä¸ª &lt;a href=&#34;https://gateway-api.sigs.k8s.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Gateway API&lt;/a&gt;ï¼ŒåŒ…æ‹¬å®éªŒéƒ¨åˆ†â€”â€”æ·»åŠ äº†ä¸€äº›å¼ºå¤§çš„æ–°åŠŸèƒ½ï¼Œä½¿è¿™ä¸ªå…è´¹çš„å¼€æºè½¯ä»¶æ›´æ¥è¿‘äºåŠŸèƒ½é½å…¨çš„ API ç½‘å…³ã€‚&lt;/p&gt;
&lt;p&gt;EG çš„ä¸€å¤§ç‰¹ç‚¹æ˜¯å®ƒé…ç½®äº†æ–°çš„ç½‘å…³ APIï¼Œè€Œä¸æ˜¯æ—§çš„å’Œéå¸¸æœ‰é™çš„ &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress API&lt;/a&gt;ï¼Œæˆ–ä»»ä½•ä¸ºäº†å¼¥è¡¥ Ingress ç¼ºé™·çš„ä¸“æœ‰ APIã€‚è™½ç„¶ EG 0.2 å®ç°äº† Gateway API çš„æ ¸å¿ƒéƒ¨åˆ†ï¼ˆå®Œå…¨æ”¯æŒâ€œåŸºæœ¬â€HTTP è·¯ç”±ï¼‰ï¼Œä½† EG 0.3 åœ¨å…¶ Gateway API æ”¯æŒæ–¹é¢æ›´è¿›äº†ä¸€æ­¥ï¼Œè¿™å¯èƒ½æ˜¯äº†è§£å…¶æ–°åŠŸèƒ½çš„æœ€ä½³æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒæ›´å¤š HTTP åŠŸèƒ½ï¼Œä¾‹å¦‚&lt;a href=&#34;https://gateway.envoyproxy.io/v0.3.0/user/http-urlrewrite.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;URL Rewrite&lt;/a&gt;ã€&lt;a href=&#34;https://gateway.envoyproxy.io/v0.3.0/user/http-response-headers.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Response Header Operation&lt;/a&gt; å’Œæµé‡é•œåƒã€‚è¿™äº›æ¥è‡ª API è§„èŒƒä¸­çš„æ‰©å±•å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒè·¯ç”± &lt;a href=&#34;https://gateway.envoyproxy.io/v0.3.0/user/grpc-routing.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC&lt;/a&gt;ã€&lt;a href=&#34;https://gateway.envoyproxy.io/v0.3.0/user/udp-routing.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;UDP&lt;/a&gt; å’ŒåŸå§‹ &lt;a href=&#34;https://gateway.envoyproxy.io/v0.3.0/user/tcp-routing.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TCP&lt;/a&gt;ã€‚è¿™äº›æ¥è‡ª API çš„å®éªŒæ€§æ–°éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯·æ³¨æ„è¿™äº› API æ‰©å±•ï¼šæˆ‘ä»¬æ­£åœ¨åŠªåŠ›ä¸ºçœŸå®ç”¨æˆ·æä¾›æœ‰ç”¨çš„åŠŸèƒ½ã€‚ &lt;a href=&#34;https://github.com/kubernetes/community/tree/master/sig-network&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SIG-NETWORK COMMUNITY&lt;/a&gt; ä½œä¸ºè´Ÿè´£ç½‘å…³ API è§„èŒƒçš„äººå‘˜ï¼Œæœ‰è´Ÿè´£ä¿æŠ¤ APIï¼Œå› æ­¤ä»–ä»¬çš„å·¥ä½œéœ€è¦ä¸€äº›å®è·µã€‚ä½œä¸ºå®æ–½è€…ï¼Œæˆ‘ä»¬æœ‰æ›´å¤šçš„è‡ªç”±åœ¨å…·ä½“è§„èŒƒä¹‹å‰å¼€è¾Ÿä¸€æ¡é“è·¯â€”â€”ä½†æˆ‘ä»¬å·²ç»åœ¨ä¸Šæ¸¸å·¥ä½œä»¥æ ‡å‡†åŒ–è¿™äº›æ‰©å±•ã€‚è¿™ç§åœ¨å·¥ä½œå®æ–½ä¸­å¯¹æ–°åŠŸèƒ½è¿›è¡Œçš„å®éªŒæ˜¯è®©ä»»ä½•å›¢ä½“æ¥å—æè®®çš„æ–° API çš„é‡è¦ä¸€æ­¥â€”â€”å®ƒå¯¹æ¯ä¸ªäººéƒ½æœ‰å¥½å¤„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›ä»¤äººå…´å¥‹çš„æ–°åŠŸèƒ½ç¡®å®ä½¿ Envoy Gateway é¡¹ç›®è¶…è¶Šäº†äººä»¬çš„å¥½å¥‡å¿ƒï¼Œå¯ä»¥ä¸ºè®¸å¤šç°å®ä¸–ç•Œçš„ç”¨ä¾‹æä¾›æœåŠ¡ã€‚é‡è¦çš„æ˜¯ï¼Œå®ƒèƒ½å¤Ÿæä¾›æ‰€æœ‰è¿™äº›ï¼ŒåŒæ—¶åŸºäºå¼€æ”¾æ ‡å‡† API å¹¶ä¸”æ˜¯å…è´¹å’Œå¼€æºè½¯ä»¶ï¼Œæ²¡æœ‰ä»˜è´¹å±‚ã€‚&lt;/p&gt;
&lt;p&gt;è‡ªå·±è¯•ç”¨ Envoy Gateway 0.3 éå¸¸ç®€å•ï¼Œåªéœ€è½¬åˆ° &lt;a href=&#34;https://gateway.envoyproxy.io/v0.3.0/user/quickstart.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¿«é€Ÿå…¥é—¨æŒ‡å—&lt;/a&gt; å³å¯å¼€å§‹ï¼å¦‚æœæ‚¨æƒ³æ›´æ·±å…¥åœ°äº†è§£å¦‚ä½•ä½¿ç”¨ &lt;em&gt;minikube&lt;/em&gt; åœ¨æœ¬åœ°è¿›è¡Œå°è¯•ï¼Œå¤§å¤šæ•° &lt;a href=&#34;https://tetrate.io/blog/hands-on-with-the-gateway-api-using-envoy-gateway-0-2/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EG 0.2 åŠ¨æ‰‹æŒ‡å—&lt;/a&gt; ä»ç„¶æœ‰æ•ˆã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Envoy Gateway 0.2 ä½“éªŒæ–°çš„ Kubernetes Gateway API</title>
      <link>https://cloudnative.to/blog/hands-on-with-envoy-gateway/</link>
      <pubDate>Thu, 27 Oct 2022 16:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/hands-on-with-envoy-gateway/</guid>
      <description>&lt;p&gt;åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº²èº«ä½“éªŒ &lt;a href=&#34;https://github.com/envoyproxy/gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Gateway&lt;/a&gt; å’Œ &lt;a href=&#34;https://gateway-api.sigs.k8s.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway API&lt;/a&gt;ã€‚ä»¥ä¸‹æ˜¯é€æ­¥æŒ‡å¯¼ä½ å®‰è£… Envoy Gateway çš„è¯´æ˜ï¼Œä»¥åŠé€šè¿‡ Envoy ä»£ç†åœ¨é›†ç¾¤å¤–å…¬å¼€ HTTP åº”ç”¨ç¨‹åºçš„ç®€å•ç”¨ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ ä¸æ–¹ä¾¿è¿è¡Œï¼Œæˆ‘åœ¨æœ¬æ–‡ä¸­åŒ…å«äº†æ¯ä¸ªå‘½ä»¤çš„è¾“å‡ºï¼Œå³ä½¿ä½ æ²¡æœ‰ Kubernetes é›†ç¾¤ä¹Ÿå¯ä»¥çœ‹åˆ°å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ˜¯ GUI çš„ç²‰ä¸ï¼Œåœ¨æ–‡ç« çš„æœ€åæˆ‘ä¼šé™„ä¸Š Tetrate åŸºäº &lt;a href=&#34;https://backstage.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Backstage&lt;/a&gt; çš„æ¦‚å¿µéªŒè¯ &lt;a href=&#34;https://github.com/tetratelabs/eg-backstage-demo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Gateway GUI&lt;/a&gt; çš„å±å¹•æˆªå›¾å’Œè¯¦ç»†ä¿¡æ¯ï¼Œä»¥å±•ç¤ºé’ˆå¯¹ Gateway API æ„å»ºæ­¤ç±»ä¸œè¥¿æ˜¯å¤šä¹ˆå®¹æ˜“ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åˆ›å»º-kubernetes-é›†ç¾¤&#34;&gt;åˆ›å»º Kubernetes é›†ç¾¤&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆè¿è¡Œ Envoy Gateway å’Œ Kubernetes é›†ç¾¤ã€‚æœ€ç®€å•ã€æœ€å®‰å…¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨ &lt;a href=&#34;https://minikube.sigs.k8s.io/docs/start/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;minikube&lt;/a&gt; åœ¨æœ¬åœ°æœºå™¨ä¸Šå¯åŠ¨é›†ç¾¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ minikube start â€“driver&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;docker --cpus&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; --memory&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2g
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸ˜„  minikube v1.27.0 on Arch 22.0.0 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;x86_64&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	â–ª &lt;span class=&#34;nv&#34;&gt;KUBECONFIG&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â—  For more information, see: https://github.com/kubernetes/kubernetes/issues/112135
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸ“Œ  Using Docker Desktop driver with root privileges
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸ‘  Starting control plane node minikube in cluster minikube
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸšœ  Pulling base image ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸ”¥  Creating docker container &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;CPUs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2, &lt;span class=&#34;nv&#34;&gt;Memory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2048MB&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸ³  Preparing Kubernetes v1.25.2 on Docker 20.10.17 ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	â–ª Generating certificates and keys ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	â–ª Booting up control plane ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	â–ª Configuring RBAC rules ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸ”  Verifying Kubernetes components...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	â–ª Using image gcr.io/k8s-minikube/storage-provisioner:v5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸŒŸ  Enabled addons: storage-provisioner
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸ„  Done! kubectl is now configured to use &lt;span class=&#34;s2&#34;&gt;&amp;#34;minikube&amp;#34;&lt;/span&gt; cluster and &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt; namespace by default
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å®‰è£…-envoy-gateway&#34;&gt;å®‰è£… Envoy Gateway&lt;/h2&gt;
&lt;p&gt;å›æƒ³ä¸€ä¸‹ï¼ŒEnvoy Gateway æ˜¯ç”±æ–°çš„ Gateway API é…ç½®çš„ï¼Œè€Œä¸æ˜¯æ—§çš„ Ingress APIã€‚Gateway API å°šæœªåˆå¹¶åˆ°ä¸Šæ¸¸ Kubernetesï¼Œå› æ­¤æˆ‘ä»¬çš„é›†ç¾¤å°†æ— æ³•ä½¿ç”¨å®ƒã€‚æˆ‘ä»¬é€šè¿‡ä¸ºå…¶éƒ¨ç½² CRD æ¥å®‰è£…è¯¥ APIã€‚Envoy Gateway é¡¹ç›®æä¾›äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œç”¨äºå®‰è£… Gateway API å’Œéƒ¨ç½² Envoy Gatewayã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f https://github.com/envoyproxy/gateway/releases/download/v0.2.0/install.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¼šäº§ç”Ÿå¤§é‡èµ„æºï¼Œæˆ‘å°†åˆ†å‡ ä¸ªéƒ¨åˆ†ä¸­è®¨è®ºå®ƒä»¬ã€‚é¦–å…ˆæ˜¯ Gateway APIï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;customresourcedefinition.apiextensions.k8s.io/gatewayclasses.gateway.networking.k8s.io created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;customresourcedefinition.apiextensions.k8s.io/gateways.gateway.networking.k8s.io created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;customresourcedefinition.apiextensions.k8s.io/httproutes.gateway.networking.k8s.io created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;customresourcedefinition.apiextensions.k8s.io/referencegrants.gateway.networking.k8s.io created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;customresourcedefinition.apiextensions.k8s.io/referencepolicies.gateway.networking.k8s.io created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;customresourcedefinition.apiextensions.k8s.io/tcproutes.gateway.networking.k8s.io created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;customresourcedefinition.apiextensions.k8s.io/tlsroutes.gateway.networking.k8s.io created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;customresourcedefinition.apiextensions.k8s.io/udproutes.gateway.networking.k8s.io created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;namespace/gateway-system created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;validatingwebhookconfiguration.admissionregistration.k8s.io/gateway-api-admission created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/gateway-api-admission-server created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.apps/gateway-api-admission-server created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceaccount/gateway-api-admission created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;clusterrole.rbac.authorization.k8s.io/gateway-api-admission created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;clusterrolebinding.rbac.authorization.k8s.io/gateway-api-admission created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;role.rbac.authorization.k8s.io/gateway-api-admission created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rolebinding.rbac.authorization.k8s.io/gateway-api-admission created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;job.batch/gateway-api-admission created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;job.batch/gateway-api-admission-patch created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä½ æ‰€è§ï¼Œä¸»è¦æ˜¯ CRDã€‚ä½†è¯·æ³¨æ„ï¼Œå®‰è£… Gateway API è¿˜éƒ¨ç½²äº†ä¸€äº›å·¥ä½œè´Ÿè½½èµ„æºï¼ŒåŒ…æ‹¬ Deployment ç­‰ â€”â€”Gateway API å¸¦æœ‰ä¸€ä¸ª webhook å‡†å…¥æ§åˆ¶å™¨æ¥éªŒè¯æˆ‘ä»¬éƒ¨ç½²çš„èµ„æºï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods --namespace gateway-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                        	READY   STATUS  	RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gateway-api-admission-2dhk5                 	0/1 	Completed   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      	70s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gateway-api-admission-patch-dbdbc           	0/1 	Completed   &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;      	70s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gateway-api-admission-server-68485ffc97-gt8v4   1/1 	Running 	&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      	70s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ·»åŠ åˆ°é›†ç¾¤ API ä¸­çš„æ–° CRDï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl api-resources &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep gateway.networking
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gatewayclasses                	gc       	gateway.networking.k8s.io/v1beta1  	&lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;    	GatewayClass
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gateways                      	gtw      	gateway.networking.k8s.io/v1beta1  	&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;     	Gateway
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;httproutes                                 	gateway.networking.k8s.io/v1beta1  	&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;     	HTTPRoute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;referencegrants               	refgrant 	gateway.networking.k8s.io/v1alpha2 	&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;     	ReferenceGrant
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;referencepolicies             	refpol   	gateway.networking.k8s.io/v1alpha2 	&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;     	ReferencePolicy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcproutes                                  	gateway.networking.k8s.io/v1alpha2 	&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;     	TCPRoute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tlsroutes                                  	gateway.networking.k8s.io/v1alpha2 	&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;     	TLSRoute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;udproutes                                  	gateway.networking.k8s.io/v1alpha2 	&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;     	UDPRoute
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯ Envoy Gateway æœ¬èº«ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;namespace/envoy-gateway-system created
customresourcedefinition.apiextensions.k8s.io/envoyproxies.config.gateway.envoyproxy.io created
serviceaccount/envoy-gateway created
role.rbac.authorization.k8s.io/leader-election-role created
clusterrole.rbac.authorization.k8s.io/envoy-gateway-role created
clusterrole.rbac.authorization.k8s.io/metrics-reader created
clusterrole.rbac.authorization.k8s.io/proxy-role created
rolebinding.rbac.authorization.k8s.io/leader-election-rolebinding created
clusterrolebinding.rbac.authorization.k8s.io/envoy-gateway-rolebinding created
clusterrolebinding.rbac.authorization.k8s.io/proxy-rolebinding created
configmap/envoy-gateway-config created
service/envoy-gateway created
service/envoy-gateway-metrics-service created
deployment.apps/envoy-gateway created
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™äº›æ˜¯å·¥ä½œè´Ÿè½½èµ„æºä»¥åŠç›¸å…³çš„å®‰å…¨å’Œç½‘ç»œã€‚ç‰‡åˆ»ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ­£åœ¨è¿è¡Œçš„æ§åˆ¶å™¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods --namespace envoy-gateway-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                        	READY   STATUS	RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy-gateway-dc74c4d97-pntbj   2/2 	Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      	35s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å®‰è£…æµ‹è¯•åº”ç”¨&#34;&gt;å®‰è£…æµ‹è¯•åº”ç”¨&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›ä¸œè¥¿è®©ç½‘å…³çœŸæ­£å°†æµé‡è½¬å‘åˆ° â€”â€” å°±åƒæˆ‘ä»¬çš„ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸€æ ·çš„ä¸œè¥¿ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ httpbinï¼ŒEnvoy Gateway é¡¹ç›®æä¾›äº†æ–¹ä¾¿çš„æ¸…å•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f https://raw.githubusercontent.com/istio/istio/master/samples/httpbin/httpbin.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceaccount/httpbin created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/httpbin created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.apps/httpbin created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†åœ¨é»˜è®¤å‘½åç©ºé—´ä¸­è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods -n default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                    	READY   STATUS	RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;httpbin-9dbd644c7-fhtw5 	1/1 	Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      	4m16s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;é…ç½®-envoy-gateway&#34;&gt;é…ç½® Envoy Gateway&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å¯ä»¥ç»§ç»­é…ç½® Envoy Gateway ä»¥æ‰§è¡Œä¸€äº›è¯·æ±‚è·¯ç”±ã€‚æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯æ³¨å†Œæˆ‘ä»¬åˆšåˆšéƒ¨ç½²çš„ Envoy Gateway æ§åˆ¶å™¨ï¼Œä»¥ä¾¿å…¶ä»–èµ„æºå¯ä»¥å¼•ç”¨å®ƒæ¥è¯†åˆ«é…ç½®çš„ç½‘å…³ï¼Œä»¥é˜²ä½ åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­éƒ¨ç½²å¤šä¸ªç½‘å…³ã€‚ &lt;code&gt;controllerName&lt;/code&gt; å­—æ®µåŒ¹é…æ§åˆ¶å™¨å‘å…¶è¿è¡Œçš„ Kubernetes é›†ç¾¤æ³¨å†Œçš„å€¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f - &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: gateway.networking.k8s.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: GatewayClass
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: my-envoy-gateway
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  controllerName: gateway.envoyproxy.io/gatewayclass-controller
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gatewayclass.gateway.networking.k8s.io/eg created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…³äºè¿™ä¸ªæ–°å®ä¾‹çš„ä¸€äº›æœ‰é™ä¿¡æ¯ï¼Œå‡è®¾æˆ‘ä»¬çš„æè¿°æ˜¯æœ‰æ•ˆçš„ï¼Œæˆ‘ä»¬å°†çœ‹åˆ° &lt;code&gt;ACCEPTED: True&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get gatewayclass -o wide
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME   CONTROLLER                                  	ACCEPTED   AGE 	DESCRIPTION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;eg 	gateway.envoyproxy.io/gatewayclass-controller   True   	2m38s  
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬é…ç½®ä¸€ä¸ª Gateway å¯¹è±¡ â€”â€” è¿™å°†æ‰“å¼€æˆ‘ä»¬å¸Œæœ› Envoy ä»£ç†ç›‘å¬çš„ç½‘ç»œç«¯å£ã€‚å¯¹äºè¿™ä¸ªç®€å•çš„æ¼”ç¤ºï¼Œæˆ‘ä»¬å°†ç»‘å®šåˆ°ä¸€ä¸ªç«¯å£è€Œä¸ä½¿ç”¨ TLSï¼Œå› æ­¤æˆ‘å°†å…¶ç§°ä¸ºâ€œä¸å®‰å…¨ç«¯å£â€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f - &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: gateway.networking.k8s.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Gateway
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: insecure-port
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  gatewayClassName: my-envoy-gateway
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  listeners:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - name: http
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      protocol: HTTP
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      port: 8080
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“æˆ‘ä»¬æ£€æŸ¥å®ƒæ—¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°å®ƒå¹¶æ²¡æœ‰å°±ç»ªã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æœ¬åœ°å¼€å‘é›†ç¾¤æ— æ³•ä½¿è¿™ç§äº‘è´Ÿè½½å‡è¡¡å™¨æˆä¸ºâ€œçœŸæ­£çš„â€è´Ÿè½½å‡è¡¡å™¨ï¼ˆå› æ­¤åœ°å€å­—æ®µä¹Ÿæ˜¯ç©ºçš„ï¼‰ï¼Œå› æ­¤è¯¥æ‰¹å‡†è¢«æç½®ã€‚ä¸ç”¨æ‹…å¿ƒè¿™ä¸ªï¼Œå®ƒä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n default get gateway -o wide
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME        	CLASS             ADDRESS   READY   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;insecure-port   my-envoy-gateway                     2m54s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸€äº› HTTP æµé‡è®¾ç½®è·¯ç”±ã€‚åœ¨è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åŒ¹é…ä»»ä½•è·¯å¾„ä¸Šå¯¹ vhost &lt;code&gt;www.example.com&lt;/code&gt; çš„ä»»ä½•è¯·æ±‚ï¼Œå¹¶å°†å…¶å‘é€åˆ°æˆ‘ä»¬ä¹‹å‰éƒ¨ç½²çš„ httpbin å®ä¾‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f - &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: gateway.networking.k8s.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: HTTPRoute
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: httpbin
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  parentRefs: [ {name: insecure-port} ]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  hostnames: [&amp;#34;www.example.com&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  rules:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - matches:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        - path: {type: PathPrefix, value: /}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      backendRefs:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        - {group: &amp;#34;&amp;#34;, kind: Service, name: httpbin, port: 8000, weight: 1}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;httproute.gateway.networking.k8s.io/httpbin created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ£€æŸ¥è¿™ç§èµ„æºç›®å‰å¹¶æ²¡æœ‰å‘æˆ‘ä»¬å±•ç¤ºå¤ªå¤šä¸œè¥¿ï¼Œä½†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒè‡³å°‘å·²éƒ¨ç½²æˆåŠŸã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get httproute -n default -o wide
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME   	HOSTNAMES         	AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;httpbin	&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;www.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;   58s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åè¦æ³¨æ„çš„ä¸€ä»¶äº‹æ˜¯ï¼Œç›´åˆ°ç°åœ¨æ‰çœŸæ­£å¯åŠ¨äº† Envoy çš„å®ä¾‹ï¼ˆä¹‹å‰å®ƒåªæ˜¯æ§åˆ¶å™¨ï¼Œå®ƒæœ¬èº«å¹¶ä¸å¤„ç†æµé‡ï¼‰ã€‚è¿™æ˜¯ä»£è¡¨ Envoy Gateway çš„ä¼˜åŒ–ï¼šä»£ç†çš„æ‡’åˆ›å»ºã€‚æ£€æŸ¥ç³»ç»Ÿä¸Šçš„ &lt;code&gt;age&lt;/code&gt; å­—æ®µï¼Œçœ‹çœ‹å®ƒçš„åˆ›å»ºæ—¶é—´ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ kubectl get pods -n envoy-gateway-system
NAME                        	READY   STATUS	RESTARTS   AGE
envoy-default-insecure-port-5879556bd4-r5ggw   	1/1 	Running   0      	90s
envoy-gateway-dc74c4d97-pntbj   2/2 	Running   0      	13m
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å¯åŠ¨æµ‹è¯•æµé‡&#34;&gt;å¯åŠ¨æµ‹è¯•æµé‡&lt;/h2&gt;
&lt;p&gt;å°±åƒæˆ‘ä¹‹å‰è¯´çš„ï¼Œæˆ‘ä»¬æ— æ³•è·å¾—çœŸæ­£çš„äº‘è´Ÿè½½å‡è¡¡å™¨ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æœ¬åœ°å¼€å‘é›†ç¾¤ã€‚ä½†æ˜¯ minikube æœ‰ä¸€ä¸ªç®€æ´çš„ç‰¹æ€§ï¼Œå®ƒå°†é›†ç¾¤çš„æœåŠ¡æš´éœ²ç»™æˆ‘ä»¬çš„æœ¬åœ°æœºå™¨ â€”â€” åŒ…æ‹¬ Envoy Gateway å¯åŠ¨çš„ä»£ç†ã€‚æˆ‘ä»¬æ‰“å¼€çš„ 8080 ç«¯å£å°†åœ¨å›ç¯ä¸­å¯ç”¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ minikube tunnel
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥å‘½ä»¤ä¼šé˜»å¡ï¼Œå› æ­¤æ ¹æ®æˆ‘ä»¬éƒ¨ç½²çš„è§„åˆ™ï¼Œæ‰“å¼€ä¸€ä¸ªæ–°ç»ˆç«¯ä»¥å‘é€å°†è¢«è·¯ç”±åˆ° httpbin çš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl --header &lt;span class=&#34;s2&#34;&gt;&amp;#34;Host: www.example.com&amp;#34;&lt;/span&gt; 127.0.0.1:8080/headers
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Fri, &lt;span class=&#34;m&#34;&gt;07&lt;/span&gt; Oct &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt; 12:41:32 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: application/json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;175&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-origin: *
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-credentials: &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;14&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s2&#34;&gt;&amp;#34;headers&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    	&lt;span class=&#34;s2&#34;&gt;&amp;#34;Accept&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json, */*&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    	&lt;span class=&#34;s2&#34;&gt;&amp;#34;Host&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;www.example.com&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    	&lt;span class=&#34;s2&#34;&gt;&amp;#34;User-Agent&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;curl/7.79.1&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    	&lt;span class=&#34;s2&#34;&gt;&amp;#34;X-Envoy-Expected-Rq-Timeout-Ms&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;15000&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„æ¼”ç¤ºï¼Œä½†ä½ å¯ä»¥æ¢ç´¢ Gateway API çš„å…¶ä½™éƒ¨åˆ†å¹¶å¼€å§‹ä½¿ç”¨æ›´å¤šåŠŸèƒ½ â€”â€”Envoy Gateway çš„æ–‡æ¡£å°†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æŒ‡å—ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¤ºä¾‹-gui&#34;&gt;ç¤ºä¾‹ GUI&lt;/h2&gt;
&lt;p&gt;æˆ‘ç»™å‡ºçš„è¯´æ˜æ˜¯é’ˆå¯¹å‘½ä»¤è¡Œçš„ï¼Œä½†æ˜¯å¥½çš„ GUI æ˜¯ä¸ä»»ä½•ç³»ç»Ÿäº¤äº’çš„å¥½æ–¹æ³•ã€‚Envoy Gateway å¯¹æ ‡å‡† Gateway API çš„å®æ–½æä¾›äº†äº¤äº’æ“ä½œæ¥å£ç”Ÿæ€ç³»ç»Ÿã€‚Tetrate ä½¿ç”¨ &lt;a href=&#34;https://backstage.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Backstage&lt;/a&gt;ï¼ˆå¼€å‘è€…æ¥å£çš„æ–°å…´æ ‡å‡†ï¼‰ä¸º Envoy Gateway æ„å»ºäº†ä¸€ä¸ªæ¦‚å¿µéªŒè¯ UIã€‚ä¸‹é¢æˆ‘å°†å±•ç¤ºå‡ ä¸ªä»ä¸Šé¢æ£€æŸ¥æ¼”ç¤ºè®¾ç½®çš„å±å¹•æˆªå›¾ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æƒ³ç©è¿™ä¸ªï¼Œæˆ–è€… fork å®ƒï¼Œ&lt;a href=&#34;https://github.com/tetratelabs/eg-backstage-demo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘ä»¬å·²ç»å‘å¸ƒäº†ä»£ç &lt;/a&gt;â€”â€” ç›®å‰è¿˜æ˜¯ alpha ç‰ˆæœ¬ï¼Œå¹¶ä¸”åªæ˜¯ä¸€ä¸ªå¯ä»¥åœ¨ä¸€å‘¨å†…æ„å»ºçš„ç¤ºä¾‹ï¼å¦‚æœä½ åœ¨ KubeCon Detroitï¼Œè¯·åˆ°æˆ‘ä»¬çš„å±•ä½ï¼Œæˆ‘ä»¬å¯ä»¥äº²è‡ªå‘ä½ å±•ç¤ºï¼&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ui-for-envoy-gateway&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;UI for Envoy Gateway&#34; srcset=&#34;
               /blog/hands-on-with-envoy-gateway/008vxvgGgy1h7jx53ycsgj30wi0p5ab7_hu689b07b397da5e05e9f1b674f65414e1_51052_9a196803d3b23504cc8650ee9527f7c8.webp 400w,
               /blog/hands-on-with-envoy-gateway/008vxvgGgy1h7jx53ycsgj30wi0p5ab7_hu689b07b397da5e05e9f1b674f65414e1_51052_fd90718fd137327924214ed018002b27.webp 760w,
               /blog/hands-on-with-envoy-gateway/008vxvgGgy1h7jx53ycsgj30wi0p5ab7_hu689b07b397da5e05e9f1b674f65414e1_51052_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/hands-on-with-envoy-gateway/008vxvgGgy1h7jx53ycsgj30wi0p5ab7_hu689b07b397da5e05e9f1b674f65414e1_51052_9a196803d3b23504cc8650ee9527f7c8.webp&#34;
               width=&#34;760&#34;
               height=&#34;588&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      UI for Envoy Gateway
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-backstage-ç•Œé¢&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Backstage ç•Œé¢&#34; srcset=&#34;
               /blog/hands-on-with-envoy-gateway/008vxvgGgy1h7jx54gkz4j30wi0p5wg9_hueb9d88ccfd6f67d8609221003ea0eda6_71957_ab2cfc6e4ca0d867e96968f32f2c131a.webp 400w,
               /blog/hands-on-with-envoy-gateway/008vxvgGgy1h7jx54gkz4j30wi0p5wg9_hueb9d88ccfd6f67d8609221003ea0eda6_71957_8e698775b6b232c5f13516ae26a83f51.webp 760w,
               /blog/hands-on-with-envoy-gateway/008vxvgGgy1h7jx54gkz4j30wi0p5wg9_hueb9d88ccfd6f67d8609221003ea0eda6_71957_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/hands-on-with-envoy-gateway/008vxvgGgy1h7jx54gkz4j30wi0p5wg9_hueb9d88ccfd6f67d8609221003ea0eda6_71957_ab2cfc6e4ca0d867e96968f32f2c131a.webp&#34;
               width=&#34;760&#34;
               height=&#34;588&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Backstage ç•Œé¢
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ­£åœ¨å¼€å§‹ä½¿ç”¨ Istio å’Œ Envoyï¼Œè¯·&lt;a href=&#34;https://academy.tetrate.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŸ¥çœ‹ Tetrate å­¦é™¢&lt;/a&gt;ï¼Œä½ ä¼šå‘ç°å¤§é‡çš„å…è´¹è¯¾ç¨‹ã€ç ”è®¨ä¼šï¼Œä»¥åŠ Tetrate çš„ Istio ç®¡ç†å‘˜è®¤è¯è€ƒè¯•ã€‚&lt;/p&gt;
&lt;p&gt;è¦æƒ³ä»¥æœ€ç®€å•çš„æ–¹å¼å®‰è£…ã€ç®¡ç†å’Œå‡çº§ Istioï¼Œè¯·æŸ¥çœ‹&lt;a href=&#34;https://istio.tetratelabs.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘ä»¬çš„å¼€æº Tetrate Istio å‘è¡Œç‰ˆï¼ˆTIDï¼‰&lt;/a&gt;ã€‚TID æ˜¯ä¸€ä¸ªç»è¿‡å®¡æŸ¥çš„ Istio çš„ä¸Šæ¸¸å‘è¡Œç‰ˆ â€”â€”Istio çš„åŠ å›ºé•œåƒï¼Œå…·æœ‰æŒç»­çš„æ”¯æŒï¼Œæ›´å®¹æ˜“å®‰è£…ã€ç®¡ç†å’Œå‡çº§ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>é¢å‘æœªæ¥çš„ç½‘å…³ï¼šæ–°çš„ Kubernetes Gateway API å’Œ Envoy Gateway 0.2 ä»‹ç»</title>
      <link>https://cloudnative.to/blog/envoy-gateway-to-the-future/</link>
      <pubDate>Thu, 27 Oct 2022 10:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-gateway-to-the-future/</guid>
      <description>&lt;p&gt;æœ€è¿‘ &lt;a href=&#34;https://blog.envoyproxy.io/introducing-envoy-gateway-ad385cc59532&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Gateway 0.2&lt;/a&gt; å‘å¸ƒäº†ï¼ŒAPI ç½‘å…³çš„ç”Ÿæ€ç³»ç»Ÿè¿æ¥äº†æ–°çš„å˜åŒ–ã€‚è¿™ç¯‡æ–‡ç« å°†æƒ³ä½ ä»‹ç» Kubernetes API ç½‘å…³é¢†åŸŸçš„æœ€æ–°è¿›å±•ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•å°†å¤–éƒ¨çš„ç½‘ç»œè¯·æ±‚è·¯ç”±åˆ° Kubernetes é›†ç¾¤ï¼Ÿä½ å¯ä»¥ä½¿ç”¨å…¥å£æ§åˆ¶å™¨ï¼šä¸€ç»„ HTTP åå‘ä»£ç†ï¼Œå°†æµé‡è½¬æ¥åˆ°é›†ç¾¤ä¸­ï¼Œå¹¶ç”± operator æ¥ç®¡ç†ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ Ambassadorã€Contourã€Traefik æˆ– HAproxy è¿™ç±»è½¯ä»¶ã€‚è¿˜å¯ä»¥ä½¿ç”¨äº‘æä¾›å•†çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ–è€…åªæ˜¯ç”¨é»˜è®¤çš„çš„ Nginx Ingressã€‚æˆ–è€…ä½ å¯èƒ½ä½¿ç”¨ä¸€ä¸ªåŠŸèƒ½æ›´å…¨é¢çš„ API ç½‘å…³ï¼Œå¦‚ Tyk æˆ– Kongï¼Œæˆ–è€…åœ¨ Kubernetes Ingress å‰é¢çš„å¦ä¸€å±‚æœ‰ä¸€ä¸ªå•ç‹¬çš„ç½‘å…³ï¼Œå¦‚ AWS çš„ API ç½‘å…³ï¼Œæˆ–å†…éƒ¨çš„ F5ï¼Œå¯ä»¥é€‰æ‹©çš„å®åœ¨å¤ªå¤šã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„å…¥å£æ§åˆ¶å™¨&#34;&gt;ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„å…¥å£æ§åˆ¶å™¨&lt;/h2&gt;
&lt;p&gt;å› ä¸ºå¾ˆå¤šå…¥å£æ§åˆ¶å™¨éƒ½æœ‰ä¸åŒç¨‹åº¦çš„é™åˆ¶ï¼šæœ‰äº›æ˜¯åŸºäºæ—§çš„æŠ€æœ¯ï¼Œå¦‚ Nginxã€HAproxyï¼Œç”šè‡³æ˜¯åŸºäº Apache å»ºç«‹çš„ã€‚è¿™äº›æŠ€æœ¯çš„ç‰¹æ€§ä¸é€‚ç”¨äºäº‘åŸç”Ÿç¯å¢ƒï¼Œæ¯”å¦‚åœ¨é…ç½®æ”¹å˜æ—¶æ”¾å¼ƒå·²å»ºç«‹çš„è¿æ¥ï¼ˆå¦‚æœä½ æƒ³æ·±å…¥äº†è§£ï¼ŒAmbassador å‘è¡¨äº†ä¸€ç¯‡&lt;a href=&#34;https://blog.getambassador.io/envoy-vs-nginx-vs-haproxy-why-the-open-source-ambassador-api-gateway-chose-envoy-23826aed79ef&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ¯”è¾ƒ&lt;/a&gt;æ–‡ç« ï¼‰ã€‚äº‘ä¾›åº”å•†çš„äº§å“ç¡®å®å€¾å‘äºåŸºäºæ›´ç°ä»£çš„ä¸œè¥¿ï¼ˆæ¯”å¦‚ &lt;a href=&#34;https://www.usenix.org/system/files/conference/nsdi18/nsdi18-dalton.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SDN&lt;/a&gt;ï¼‰ï¼Œä½†æ˜¯è¿™å¯èƒ½äº§ç”Ÿå‚å•†é”å®šã€‚ç›®å‰ï¼Œä½ åªéœ€ç”¨ä¸€ä¸ª Kubernetes API æ¥æŒ‡å®šæ‰€æœ‰ä¸åŒé€‰é¡¹çš„é…ç½®ï¼šIngressã€‚è¿™ä¸ª API çš„å¯é…ç½®é¡¹å¾ˆå°‘ï¼Œå‡ ä¹ä»»ä½•ä½ æƒ³é…ç½®çš„è®¾ç½®éƒ½éœ€è¦é€šè¿‡ annotation æ¥å®ç°ï¼Œè€Œä¸æ˜¯ä½œä¸ºä¸€ç±»å­—æ®µã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-gatewayæœªæ¥-gateway-å‘å±•çš„åŸºç¡€&#34;&gt;Envoy Gatewayï¼šæœªæ¥ Gateway å‘å±•çš„åŸºç¡€&lt;/h2&gt;
&lt;p&gt;ç°åœ¨åˆæœ‰äº†æ–°çš„é€‰æ‹©ï¼šEnvoy Gatewayï¼Œç®€ç§° EGã€‚é¡¾åæ€ä¹‰ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº Envoy ä»£ç†çš„ç½‘å…³ï¼ˆå…¥å£æ§åˆ¶å™¨ï¼‰ã€‚å®ƒæ˜¯ä¸€ä¸ªæ‰˜ç®¡åœ¨ GitHub ä¸Šçš„ Envoy ç¤¾åŒºé¡¹ç›®ã€‚è¿™ä¸æ˜¯ç¬¬ä¸€ä¸ªåŸºäº Envoy çš„å…¥å£ï¼›å·²ç»æœ‰æµè¡Œçš„å»ºç«‹åœ¨ Envoy ä¹‹ä¸Šçš„ Contour å’Œ Ambassador ç­‰é¡¹ç›®ã€‚ä½†æ˜¯è¿™äº›é¡¹ç›®çš„å¼€å‘è€…å’Œæ›´å¤šçš„äººæ­£åœ¨ä¸€èµ·ä¸º EG åšå‡ºè´¡çŒ®ï¼ŒAmbassador å’Œ Contour éƒ½è¯´ä»–ä»¬ä¼šåœ¨é€‚å½“çš„æ—¶å€™&lt;a href=&#34;https://blog.envoyproxy.io/introducing-envoy-gateway-ad385cc59532&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ Envoy Gateway çš„ä»£ç ä¸Šé‡æ„&lt;/a&gt;ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ Tetrate å…¬å¸æ— å¯å¦è®¤åœ°ä¸ºæˆ‘ä»¬åœ¨è¿™ä¸ªé¡¹ç›®ä¸­çš„é¢†å¯¼ä½œç”¨æ„Ÿåˆ°è‡ªè±ªï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;Envoy æœ¬èº«æ˜¯ä¹…ç»è€ƒéªŒçš„å…¥å£ä»£ç†ã€sidecar ä»£ç†ï¼Œå¹¶ä¸”æ­£åœ¨å‡†å¤‡å–ä»£&lt;a href=&#34;https://cloud.google.com/docs/security/infrastructure/design#google_front_end_service&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è°·æ­Œçš„ GFE&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä»£ç æ¼”ç¤º&#34;&gt;ä»£ç æ¼”ç¤º&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ æƒ³åœ¨äº†è§£æ›´å¤šå…³äº Envoy Gateway çš„å†…å®¹ä¹‹å‰å…ˆæ¼”ç»ƒä¸€ç•ªï¼Œæˆ‘å·²ç»å†™äº†&lt;a href=&#34;https://tetr8.io/3MPT6KT&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€ç¯‡å§å¦¹ç¯‡&lt;/a&gt;ï¼Œå…¶ä¸­æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œå¯ä»¥è‡ªå·±è®¾ç½® Envoy Gatewayï¼Œå¦‚æœä½ æ²¡æœ‰ç¯å¢ƒï¼Œé‚£ç¯‡æ–‡ç« ä¸­ä¹ŸåŒ…æ‹¬äº†æˆ‘æœºå™¨ä¸Šæ‰€æœ‰çš„å‘½ä»¤è¾“å‡ºï¼Œè¿™æ ·ä½ å°±å¯ä»¥çœ‹åˆ°ä¼šå‘ç”Ÿä»€ä¹ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;é€šå¾€-api-çš„-gateway&#34;&gt;é€šå¾€ API çš„ Gateway&lt;/h2&gt;
&lt;p&gt;Envoy Gateway ä»¥å…¶æœ€ç®€å•çš„å½¢å¼ â€”â€” ä½ å¯èƒ½åˆšåˆšè®¾ç½®å¥½çš„ç³»ç»Ÿï¼Œå°†è¯·æ±‚è½¬å‘åˆ°å…¶é›†ç¾¤ä¸­ã€‚å®ƒæ ¹æ® HTTP host å’Œ path è¿›è¡Œè·¯ç”±ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å…¶ä»– header è¿›è¡Œè·¯ç”±ã€‚æ¯ä¸ªé›†ç¾¤éƒ½éœ€è¦è¿™æ ·åšï¼Œå¾ˆé«˜å…´çœ‹åˆ° Envoy Gateway åœ¨å¼€å‘çš„çŸ­çŸ­ 6 ä¸ªæœˆå†…å°±èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼ˆè¦äº†è§£æ›´å¤šå…³äº Envoy Gateway çš„ä¿¡æ¯ï¼Œè¯·çœ‹ &lt;a href=&#34;https://www.tetrate.io/envoy-gateway/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway to a New Frontier&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¶…è¶ŠåŸºæœ¬å…¥å£çš„é«˜çº§åŠŸèƒ½&#34;&gt;è¶…è¶ŠåŸºæœ¬å…¥å£çš„é«˜çº§åŠŸèƒ½&lt;/h3&gt;
&lt;p&gt;ç„¶è€Œï¼Œè®¸å¤šç»„ç»‡éœ€è¦æ¯”è¿™ä¸ªåŸºæœ¬çš„ 7 å±‚ç½‘ç»œè·¯ç”±æ›´å¤šçš„åŠŸèƒ½ã€‚å¦‚æœéœ€è¦åƒ WAFã€body çš„æ¨¡å¼éªŒè¯ã€bot æ‹¦æˆªç­‰ï¼Œè®¸å¤šäººå°±ä¼šä½¿ç”¨ API ç½‘å…³ã€‚æˆ‘ä»¬çœ‹åˆ°å¾ˆå¤šç»„ç»‡åœ¨ä»–ä»¬çš„å…¥å£æ§åˆ¶å™¨å‰é¢éƒ¨ç½²äº†ä¸€ä¸ªå•ç‹¬çš„ API ç½‘å…³ã€‚ç„¶è€Œï¼ŒAPI ç½‘å…³å¯ä»¥&lt;em&gt;å–ä»£&lt;/em&gt;å…¥å£æ§åˆ¶å™¨ï¼Œå› ä¸ºå®ƒä¹Ÿå¯ä»¥åšè·¯ç”±å’Œæµé‡è§‚å¯Ÿçš„åŸºæœ¬åŠŸèƒ½ã€‚å®ƒä»¬å¯ä»¥æä¾›è¿™äº›åŠŸèƒ½ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç”±ä¸å…¥å£æ§åˆ¶å™¨ç›¸åŒçš„ä»£ç†æ„å»ºçš„ï¼Œä¾‹å¦‚ï¼ŒKong æ˜¯åŸºäº nginx çš„ã€‚API ç½‘å…³äº§å“åœ¨å¸‚åœºä¸Šå¾ˆå—æ¬¢è¿ï¼Œä½†å¦‚æœä½ çœŸçš„æƒ³ä¸€æƒ³ API ç½‘å…³æ˜¯ä»€ä¹ˆï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª HTTP ä»£ç†ï¼Œæœ‰ä¸€ç³»åˆ—çš„é™„åŠ åŠŸèƒ½ï¼ˆæˆ‘ä¹‹å‰æåˆ°çš„ WAF ç­‰ï¼‰ã€‚è¿™å¹¶ä¸æ˜¯è¯´å®ƒä»¬ä¸å¢åŠ ä»»ä½•ä»·å€¼ â€”â€” å®ƒä»¬æä¾›çš„åŠŸèƒ½æ˜¯å¤šç§å¤šæ ·çš„ï¼Œè€Œä¸”å¾ˆå¼ºå¤§ï¼Œä½†æœ‰ä¸€ä¸ªå…±åŒçš„åŠŸèƒ½åŸºçº¿å’Œå®ç°ä»£ç ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-wasm-çš„åŠ¨æ€å¯æ‰©å±•æ€§&#34;&gt;ä½¿ç”¨ Wasm çš„åŠ¨æ€å¯æ‰©å±•æ€§&lt;/h3&gt;
&lt;p&gt;å› æ­¤ï¼ŒEnvoy Gateway å®Œå…¨æœ‰èƒ½åŠ›å‘å±•æˆä¸ºä¸€ä¸ªå…¨åŠŸèƒ½çš„ API ç½‘å…³ã€‚Envoy å®é™…ä¸Šå·²ç»å…·å¤‡äº†ä¸€äº›æ›´å…ˆè¿›çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ JWT éªŒè¯ã€OIDC è®¤è¯æµå’Œé€Ÿç‡é™åˆ¶ã€‚æ­¤å¤–ï¼ŒEnvoy æ˜¯åŠ¨æ€å¯æ‰©å±•çš„ï¼›å®ƒå¯ä»¥åœ¨ä¸é‡å¯çš„æƒ…å†µä¸‹åŠ è½½æ’ä»¶ï¼Œè¿™æ„å‘³ç€å¯ä»¥å¾ˆå®¹æ˜“åœ°æŒ‰éœ€æ·»åŠ æ›´å¤šçš„åŠŸèƒ½ã€‚è¿™äº›æ’ä»¶æ˜¯ä»¥ WASM å­—èŠ‚ç çš„å½¢å¼æä¾›çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥ç”¨ä»»ä½•å¯ä»¥ç¼–è¯‘æˆ WASM çš„è¯­è¨€ï¼ˆTiny Goã€Rust ç­‰ï¼‰ç¼–å†™ï¼Œè€Œä¸ä»…ä»…æ˜¯å…¶ä»–ä»£ç†æ”¯æŒçš„è„šæœ¬è¯­è¨€ã€‚ç¤¾åŒºæ­£åœ¨å¼€å§‹ç¼–å†™è¿™äº›æ’ä»¶ï¼šç¼“å­˜å¯èƒ½ä¼šé¦–å…ˆè½åœ°ï¼Œ&lt;a href=&#34;https://coraza.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Coraza&lt;/a&gt; é¡¹ç›®æ˜¯ä¸€ä¸ªç›¸å¯¹æˆç†Ÿçš„ &lt;code&gt;mod_security&lt;/code&gt; é£æ ¼çš„ WAFï¼Œç”¨ Go ç¼–å†™ï¼Œå¯ä»¥ç¼–è¯‘æˆ WASMï¼Œç°åœ¨å¯ä»¥ç”¨äº Envoy ä»£ç†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;gateway-api-é¼“åŠ±æ‰©å±•&#34;&gt;Gateway API é¼“åŠ±æ‰©å±•&lt;/h3&gt;
&lt;p&gt;åœ¨å…¥å£æ§åˆ¶å™¨å¸‚åœºä¸Šï¼Œæ‰©å±•å’Œç«äº‰çš„å¦ä¸€å¤§éšœç¢æ˜¯ APIã€‚éœ€è¦ç‰¹å®šäºä¾›åº”å•†çš„æ³¨è§£ï¼ˆæˆ–å…¨æ–°çš„ç‰¹å®šäºä¾›åº”å•†çš„ APIï¼‰ï¼Œè¿™äº›æ³¨è§£å¾ˆç¬¨é‡ï¼Œè€Œä¸”å¦¨ç¢äº†äº¤å‰å…¼å®¹ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒEnvoy Gateway æ˜¯ç”± Gateway API é…ç½®çš„ï¼Œè¿™æ˜¯ &lt;code&gt;gateway.networking.k8s.io &lt;/code&gt;API ç»„çš„ä¸€ç»„èµ„æºã€‚è¿™ä¸ª API å°†æœ€ç»ˆå–ä»£ Ingress èµ„æºã€‚å®ƒçš„æ ¸å¿ƒå·²ç»æ¯” Ingress æ›´åŠ çµæ´»å’Œå¯Œæœ‰è¡¨ç°åŠ›ï¼Œè€Œä¸”å®ƒè¢«è®¾è®¡æˆä»¥å¯ç®¡ç†çš„æ–¹å¼å¢é•¿å’Œæ‰©å±•ã€‚è¿™å°†å…è®¸å®ƒå‘å±•æˆä¸ºæ‰€æœ‰å—åŒ—æµé‡æ§åˆ¶çš„ä¸€æµæ¨¡å‹ï¼Œä»åŸºæœ¬çš„è·¯ç”±åˆ°å…ˆè¿›çš„ API ç®¡ç†åŠŸèƒ½ã€‚è¿™åè¿‡æ¥åˆä¼šå°† Envoy Gateway æ‹¥æœ‰çš„æ‰€æœ‰åŠŸèƒ½ï¼Œä»¥ä¸€ç§æ ‡å‡†çš„ã€ä¸ä¾›åº”å•†æ— å…³çš„æ–¹å¼æš´éœ²å‡ºæ¥ï¼Œè®©äººä»¬åœ¨ä½¿ç”¨è¿™äº›åŠŸèƒ½æ—¶æ— éœ€è·³è¿‡éšœç¢æˆ–æ‹…å¿ƒé”å®šé—®é¢˜ã€‚Envoy Gateway å°†åœ¨ 2023 å¹´ 3 æœˆçš„ 0.3 ç‰ˆæœ¬ä¸­æ”¯æŒ Gateway API çš„è¿™äº›æ–°éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºæœªæ¥çš„ç½‘å…³å‘å±•æä¾›ä¸€ä¸ªå…±åŒçš„æœ€ä½³çš„åŸºç¡€&#34;&gt;ä¸ºæœªæ¥çš„ç½‘å…³å‘å±•æä¾›ä¸€ä¸ªå…±åŒçš„ã€æœ€ä½³çš„åŸºç¡€&lt;/h3&gt;
&lt;p&gt;Envoy Gateway çš„åŠ¨åŠ›æ¥è‡ªäºå¯¹ API ç½‘å…³åŠŸèƒ½å †æ ˆçš„æ—¥ç›Šå…³æ³¨ã€‚åŸºæœ¬çš„å…¥å£æ­£åœ¨å˜å¾—å•†ä¸šåŒ–ï¼Œæ‰€ä»¥ç¤¾åŒºæ­£åœ¨æ±‡é›†å…¶èµ„æºå’Œä¸“ä¸šçŸ¥è¯†ï¼Œä¸ºæœªæ¥çš„ç½‘å…³å¼€å‘åˆ›é€ ä¸€ä¸ªå…±åŒçš„ã€æœ€å¥½çš„åŸºç¡€ã€‚åŒæ—¶æä¾›æ–°çš„ Gateway API ä¾›å…¶å®ç°æ˜¯éå¸¸æ–¹ä¾¿çš„ï¼ŒEnvoy Gateway çš„ 0.2 ç‰ˆæœ¬æ ‡å¿—ç€å¯¹ç›®å‰å®šä¹‰çš„ Gateway API æ ¸å¿ƒç±»å‹çš„å…¨é¢æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;æ‰©å±•åˆ°é«˜çº§ç”¨ä¾‹æ¨¡å‹çš„å·¥ä½œå·²ç»å¼€å§‹ï¼Œç°åœ¨æ­£åœ¨è®¾è®¡ &lt;a href=&#34;https://docs.google.com/document/d/1TlQjBy1utEwgrxE_HVT4-EHpVJ51hgnfMuAh0Q_uNoE/view&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;JWT auth é…ç½®&lt;/a&gt;ï¼Œå…¶ä»–çš„ä¹Ÿå°†é™†ç»­æ¨å‡ºã€‚æ’ä»¶æœ¬èº«çš„å·¥ä½œä¹Ÿå·²ç»å¼€å§‹ï¼ˆä¾‹å¦‚ï¼ŒCorazaï¼Œä¸€ä¸ªä»¿ç…§æ— å¤„ä¸åœ¨çš„ &lt;code&gt;mod_security&lt;/code&gt; çš„ Golang WAFï¼‰ã€‚è™½ç„¶è¿™äº›éƒ½æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼Œä½†æˆ‘ä¸ªäººéå¸¸æœŸå¾…çœ‹åˆ°è¿™ä¸€åˆ‡åœ¨æœªæ¥ä¸€ä¸¤å¹´çš„å‘å±•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é€šå¾€æœåŠ¡ç½‘æ ¼çš„-gateway&#34;&gt;é€šå¾€æœåŠ¡ç½‘æ ¼çš„ Gateway&lt;/h2&gt;
&lt;p&gt;ä½ å¯èƒ½åœ¨æƒ³ï¼Œå·²ç»æœ‰ä¸€ç±»äº§å“æ”¯æŒ OIDC è®¤è¯å’Œé€Ÿç‡é™åˆ¶ç­‰åŠŸèƒ½äº†ï¼šæœåŠ¡ç½‘æ ¼ã€‚è¿™æ˜¯çœŸçš„ï¼›æœ€çªå‡ºçš„ç½‘æ ¼ï¼ŒIstioï¼Œåœ¨å…¶é»˜è®¤é…ç½®ä¸­ä¸ºå…¥å£éƒ¨ç½²äº†ä¸€å¥—ä»£ç†æœåŠ¡å™¨ã€‚Istio ç°åœ¨æ”¯æŒ Gateway APIï¼ˆå°±åƒ Envoy Gateway ä¸€æ ·ï¼‰æ¥é…ç½®è¯¥å…¥å£ã€‚æˆ‘ä»¬åœ¨ Tetrate å¯¹è¿™ç§èåˆæ„Ÿåˆ°å…´å¥‹ï¼šä¼ä¸šç°åœ¨å¯ä»¥é‡‡ç”¨ Envoy Gateway æ¥ç®€å•è€Œå¿«é€Ÿåœ°å¼€å±•å·¥ä½œã€‚Envoy Gateway åœ¨ç®¡ç†è¿™ç§å—åŒ—æµé‡æ–¹é¢åšå¾—å¾ˆå¥½ï¼Œè¿è¡Œå®ƒå¯ä»¥è®©ä»–ä»¬äº†è§£ Envoy åœ¨ç”Ÿäº§ä¸­çš„æ€§èƒ½å’Œæ“ä½œç‰¹ç‚¹ã€‚å½“è¿™äº›ç»„ç»‡å‡†å¤‡å¥½æ§åˆ¶ä»–ä»¬çš„æœåŠ¡åˆ°æœåŠ¡ï¼Œä¹Ÿå°±æ˜¯ä¸œè¥¿å‘æµé‡æ—¶ï¼Œä»–ä»¬å¯ä»¥éƒ¨ç½² Istioï¼Œå› ä¸ºä»–ä»¬å·²ç»ç†Ÿæ‚‰äº†ä¸»è¦çš„åŸºç¡€ç»„ä»¶ï¼ˆEnvoyï¼‰ã€‚è™½ç„¶ä»–ä»¬å¯èƒ½ä¼šé€‰æ‹©ä½¿ç”¨ Istio çš„å…¥å£ç½‘å…³ï¼ˆä»¥ä¿æŒä»–ä»¬çš„æ§åˆ¶å¹³é¢æ•°é‡å‡å°‘åˆ° 1ï¼‰ï¼Œä½†ä»–ä»¬ç°æœ‰çš„ Gateway API èµ„æºå°†ç»§ç»­å·¥ä½œã€‚ç”±äºåŒæ ·åŸºäº Envoyï¼ŒIstio çš„ Ingress ä¹Ÿå¯ä»¥æ¥å—ä»»ä½•åŠ è½½åˆ° Envoy Gateway çš„ API Gateway é£æ ¼çš„æ’ä»¶ã€‚æ‰€æœ‰è¿™ä¸€åˆ‡éƒ½ä½¿å¾—åœ¨å¿…è¦æ—¶å¢åŠ æœåŠ¡ç½‘æ ¼çš„åŠ›é‡å˜å¾—éå¸¸å®¹æ˜“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç”¨äºå…¥å£å’ŒæœåŠ¡ç½‘æ ¼çš„ç»Ÿä¸€-gateway-api&#34;&gt;ç”¨äºå…¥å£å’ŒæœåŠ¡ç½‘æ ¼çš„ç»Ÿä¸€ Gateway API&lt;/h3&gt;
&lt;p&gt;æ›´é‡è¦çš„æ˜¯ï¼Œç°åœ¨å·²ç»æœ‰äº†ä¸€ä¸ªå·¥ä½œç»„æ¥åè°ƒç½‘å…³å’Œç½‘æ ¼ç½‘ç»œä¹‹é—´çš„é‡å éƒ¨åˆ†ï¼š&lt;a href=&#34;https://gateway-api.sigs.k8s.io/contributing/gamma/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GAMMA å€¡è®®&lt;/a&gt;ã€‚GAMMA æ˜¯ Gateway API for Mesh Management and Administration çš„ç¼©å†™ï¼Œè¿™æ˜¯å¯¹ Gateway API æœªæ¥å‘å±•æ–¹å‘çš„ä¸€ä¸ªå€¡è®®ï¼›è®¡åˆ’æ˜¯å¼€å§‹å¯¹æœåŠ¡ç½‘æ ¼çš„å…³æ³¨è¿›è¡Œå»ºæ¨¡ï¼Œå³ä¸œè¥¿å‘æµé‡ä¹Ÿæ˜¯å¦‚æ­¤ã€‚GAMMA å°†ç¡®ä¿ Envoy Gateway å’ŒæœåŠ¡ç½‘æ ¼çš„è‰¯å¥½åˆä½œï¼Œå¹¶å°†å…³æ³¨ Gateway API çš„ç»Ÿä¸€ï¼Œä»¥æ¶µç›–å…¥å£å’Œç½‘æ ¼ã€‚æˆ‘ä»¬å¾ˆé«˜å…´çœ‹åˆ°ï¼Œè¿™å°†ä¸ºè®¸å¤šç»„ç»‡è½»æ¾å’Œé€æ­¥åœ°é‡‡ç”¨æœåŠ¡ç½‘æ ¼ï¼ŒåŸºäºä¸€ä¸ªä¸äº§å“æ— å…³çš„ APIï¼Œè¿™å¯¹æ‰€æœ‰äººéƒ½æ˜¯å¥½äº‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“æŸè¯­&#34;&gt;ç»“æŸè¯­&lt;/h2&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« å¯¹æ–°çš„æ ‡å‡† APIã€Gateway API å’Œå‚è€ƒå®ç° Envoy Gateway ä½œäº†å¾ˆå¥½çš„ä»‹ç»ï¼Œå¸Œæœ›èƒ½å¯¹ä½ äº†è§£å½“å‰çš„å…¥å£ç½‘å…³ç”Ÿæ€æœ‰æ‰€å¸®åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æƒ³å…³æ³¨ EG çš„å‘å±•ï¼Œä½ å¯ä»¥åŠ å…¥ Envoy slack çš„ &lt;code&gt;#gateway&lt;/code&gt; é¢‘é“ï¼Œå¹¶åœ¨ &lt;a href=&#34;https://github.com/envoyproxy/gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/envoyproxy/gateway&lt;/a&gt; æŸ¥çœ‹æäº¤å’Œé—®é¢˜ã€‚è¯¥é¡¹ç›®æœ‰ä¸€ä¸ª &lt;a href=&#34;https://github.com/envoyproxy/gateway/blob/main/docs/design/ROADMAP.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœªæ¥å‡ ä¸ªç‰ˆæœ¬çš„è·¯çº¿å›¾&lt;/a&gt;ï¼Œ0.3.0 ç‰ˆæœ¬å‘å¸ƒé¢„æœŸæ˜¯åœ¨ 2023 å¹´ 3 æœˆã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æƒ³æµ‹è¯•ä¸€ä¸‹ Envoy Gatewayï¼Œæˆ‘å†™äº†ä¸€ä¸ªé…å¥—çš„æ•™ç¨‹ï¼Œå…¶ä¸­åŒ…å«äº†å¯åŠ¨å’Œè¿è¡Œçš„æ­¥éª¤è¯´æ˜ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ­£åœ¨å¼€å§‹ä½¿ç”¨ Istio å’Œ Envoyï¼Œè¯·&lt;a href=&#34;https://academy.tetrate.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŸ¥çœ‹ Tetrate å­¦é™¢&lt;/a&gt;ï¼Œä½ ä¼šå‘ç°å¤§é‡çš„å…è´¹è¯¾ç¨‹ã€ç ”è®¨ä¼šï¼Œä»¥åŠ Tetrate çš„ Istio ç®¡ç†å‘˜è®¤è¯è€ƒè¯•ã€‚&lt;/p&gt;
&lt;p&gt;è¦æƒ³ä»¥æœ€ç®€å•çš„æ–¹å¼å®‰è£…ã€ç®¡ç†å’Œå‡çº§ Istioï¼Œè¯·æŸ¥çœ‹&lt;a href=&#34;https://istio.tetratelabs.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘ä»¬çš„å¼€æº Tetrate Istio å‘è¡Œç‰ˆï¼ˆTIDï¼‰&lt;/a&gt;ã€‚TID æ˜¯ä¸€ä¸ªç»è¿‡å®¡æŸ¥çš„ Istio çš„ä¸Šæ¸¸å‘è¡Œç‰ˆ â€”â€”Istio çš„åŠ å›ºé•œåƒï¼Œå…·æœ‰æŒç»­çš„æ”¯æŒï¼Œæ›´å®¹æ˜“å®‰è£…ã€ç®¡ç†å’Œå‡çº§ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>äº‘åŸç”Ÿç¤¾åŒº meetup ç¬¬ä¹æœŸå¹¿å·ç«™</title>
      <link>https://cloudnative.to/event/cloud-native-meetup-guangzhou-09/</link>
      <pubDate>Sun, 25 Sep 2022 13:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/event/cloud-native-meetup-guangzhou-09/</guid>
      <description>&lt;h3 id=&#34;äº‘åŸç”Ÿåº”ç”¨å®‰å…¨åº”è¯¥ä»å“ªå‡ ä¸ªæ–¹å‘åˆ‡å…¥&#34;&gt;äº‘åŸç”Ÿåº”ç”¨å®‰å…¨åº”è¯¥ä»å“ªå‡ ä¸ªæ–¹å‘åˆ‡å…¥ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;è®²å¸ˆï¼šé©¬æ™¯è´º&lt;/p&gt;
&lt;p&gt;ä¸ªäººä»‹ç»ï¼š&lt;/p&gt;
&lt;p&gt;æç‹ (GitLab)DevOps æŠ€æœ¯å¸ƒé“å¸ˆï¼ŒLFAPAC å¼€æºå¸ƒé“å¸ˆï¼ŒCDF ambassadorã€‚å…³æ³¨åœ¨äº‘åŸç”Ÿå’Œ DevSecOps é¢†åŸŸã€‚&lt;/p&gt;
&lt;p&gt;è®®é¢˜å¤§çº²ï¼š&lt;/p&gt;
&lt;p&gt;äº‘åŸç”Ÿå‘å±•çš„è¿‡ç¨‹ä¸­ï¼Œå®‰å…¨ä¸åº”è¯¥æ˜¯æˆä¸ºè¢«å¿½è§†çš„ä¸€ç¯ã€‚äº‘åŸç”Ÿåº”ç”¨ç¨‹åºçš„å®‰å…¨é˜²æŠ¤ä½“ç³»å»ºç«‹åº”è¯¥æ˜¯å¤šæ–¹ä½çš„ï¼Œè¦æ»¡è¶³ä»é™æ€åˆ°åŠ¨æ€ï¼Œä»æºç åˆ°ä¸Šçº¿ï¼ŒåŒæ—¶è¿˜è¦æ³¨æ„é•œåƒä»¥åŠéƒ¨ç½²æ–‡ä»¶çš„å®‰å…¨ã€‚éœ€è¦å°†è¿™äº›æ‰‹æ®µç»“åˆèµ·æ¥ï¼Œä¸ç ”å‘æµç¨‹æ‰“é€šï¼Œæ„å»ºå®‰å…¨ç ”å‘é—­ç¯ï¼Œä»è€Œä¿è¯äº‘åŸç”Ÿåº”ç”¨ç¨‹åºçš„å®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;å¬ä¼—æ”¶ç›Šï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é•œåƒ &amp;amp; IaC å®‰å…¨æ‰«æ&lt;/li&gt;
&lt;li&gt;æºä»£ç å®‰å…¨å®¡è®¡ï¼ˆé˜²æ­¢æ³„æ¼ï¼‰&lt;/li&gt;
&lt;li&gt;å¸¸è§„çš„å®‰å…¨æ£€æµ‹æ‰‹æ®µï¼ˆSASTã€DASTã€Fuzzing Testing ç­‰ï¼‰&lt;/li&gt;
&lt;li&gt;æ¼æ´ç®¡ç† &amp;amp; å®‰å…¨çš„ç ”å‘é—­ç¯æ„å»º&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;åŸºäºç¡¬ä»¶å¸è½½çš„äº‘åŸç”Ÿç½‘å…³è¿æ¥å¹³è¡¡å®ç°&#34;&gt;åŸºäºç¡¬ä»¶å¸è½½çš„äº‘åŸç”Ÿç½‘å…³è¿æ¥å¹³è¡¡å®ç°&lt;/h3&gt;
&lt;p&gt;è®²å¸ˆï¼šæˆ´ç¿”&lt;/p&gt;
&lt;p&gt;ä¸ªäººä»‹ç»ï¼š&lt;/p&gt;
&lt;p&gt;Intel äº‘åŸç”Ÿå·¥ç¨‹å¸ˆï¼Œä»äº‹äº‘åŸç”Ÿè¡Œä¸šå¤šå¹´ï¼Œæ·±è€•å¼€æºï¼ŒDapr/Thanos/Golangci-lint Maintainerï¼Œç›®å‰ä¸“æ³¨äºæœåŠ¡ç½‘æ ¼é¢†åŸŸã€‚GH: daixiang0&lt;/p&gt;
&lt;p&gt;è®®é¢˜å¤§çº²ï¼š&lt;/p&gt;
&lt;p&gt;Envoy æ˜¯ä¸ºå•ä¸€æœåŠ¡å’Œåº”ç”¨ç¨‹åºè®¾è®¡çš„é«˜æ€§èƒ½ C++ åˆ†å¸ƒå¼ä»£ç†ï¼Œä¹Ÿæ˜¯ä¸ºå¤§å‹å¾®æœåŠ¡â€œæœåŠ¡ç½‘æ ¼â€æ¶æ„è®¾è®¡çš„é€šä¿¡æ€»çº¿å’Œâ€œé€šç”¨æ•°æ®å¹³é¢â€ã€‚åŸºäºå¯¹ NGINXã€HAProxyã€ç¡¬ä»¶è´Ÿè½½å‡è¡¡å™¨å’Œäº‘è´Ÿè½½å‡è¡¡å™¨ç­‰è§£å†³æ–¹æ¡ˆçš„å­¦ä¹ ï¼ŒEnvoy ä¸æ¯ä¸ªåº”ç”¨ç¨‹åºä¸€èµ·è¿è¡Œï¼Œå¹¶é€šè¿‡ä»¥ä¸å¹³å°æ— å…³çš„æ–¹å¼æä¾›é€šç”¨åŠŸèƒ½æ¥æŠ½è±¡ç½‘ç»œã€‚å½“åŸºç¡€è®¾æ–½ä¸­çš„æ‰€æœ‰æœåŠ¡æµé‡éƒ½é€šè¿‡ Envoy ç½‘æ ¼æµåŠ¨æ—¶ï¼Œé€šè¿‡ä¸€è‡´çš„å¯è§‚å¯Ÿæ€§æ¥å¯è§†åŒ–é—®é¢˜åŒºåŸŸã€è°ƒæ•´æ•´ä½“æ€§èƒ½å¹¶åœ¨ä¸€ä¸ªåœ°æ–¹æ·»åŠ åº•å±‚ç‰¹æ€§å˜å¾—å¾ˆå®¹æ˜“ã€‚åœ¨æœ¬æ¬¡æ¼”è®²ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç» Envoy ä¸­çš„çº¿ç¨‹æ¨¡å‹å’Œè¿æ¥å¹³è¡¡çŠ¶æ€ï¼Œå±•ç¤ºä½¿ç”¨ PCI ç¡¬ä»¶æ¥å¹³è¡¡æ¯ä¸ªçº¿ç¨‹çš„è¿æ¥ï¼Œä»¥åŠå®ƒè·å¾—çš„å‡ºè‰²æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å¬ä¼—æ”¶ç›Šï¼š&lt;/p&gt;
&lt;p&gt;äº†è§£å½“å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥äº§ç”Ÿå¤§æµé‡æ—¶ï¼ŒEnvoy ä¼šå› ä¸ºè¿æ¥å¹³è¡¡æ€§å·®è€Œè·å¾—è¾ƒå¤§çš„å°¾éƒ¨å»¶è¿Ÿã€‚å€ŸåŠ©æ ¸å¿ƒçº§åˆ«çš„è´Ÿè½½å‡è¡¡ï¼ŒEnvoy å°†å‡å°‘å°¾éƒ¨å»¶è¿Ÿï¼Œå ç”¨æ›´å°‘çš„èµ„æºæ¥å¤„ç†æ›´å¤šçš„è¯·æ±‚ï¼Œä»è€Œä¸ºç”¨æˆ·æä¾›é™æœ¬å¢æ•ˆçš„åŒé‡ä¿éšœã€‚è¿™å¯ä»¥å¸è½½åˆ°ç¡¬ä»¶è´Ÿè½½å¹³è¡¡å™¨ï¼Œæ˜¾ç¤ºç»“åˆè½¯ä»¶æ•ˆç‡å’Œç¡¬ä»¶çš„æ–¹å‘ã€‚&lt;/p&gt;
&lt;h3 id=&#34;dapr-åŠ©åŠ›å¼€å‘äº‘åŸç”Ÿåº”ç”¨&#34;&gt;Dapr åŠ©åŠ›å¼€å‘äº‘åŸç”Ÿåº”ç”¨&lt;/h3&gt;
&lt;p&gt;è®²å¸ˆï¼šå¼ å–„å‹&lt;/p&gt;
&lt;p&gt;ä¸ªäººä»‹ç»ï¼š&lt;/p&gt;
&lt;p&gt;ä»äº‹.NET æŠ€æœ¯å¼€å‘äºŒåä½™å¹´ï¼Œè®¤è¯ CKAD ä¸“å®¶ï¼Œæ›¾åœ¨è…¾è®¯å·¥ä½œ 12 å¹´ï¼Œ2018 å¹´åˆ›ç«‹æ·±åœ³å‹æµ©è¾¾ç§‘æŠ€ï¼Œä¸“æ³¨äºäº‘åŸç”Ÿæ–¹é¢çš„è§£å†³æ–¹æ¡ˆå’¨è¯¢ã€‚ç›®å‰åœ¨æ·±åœ³å¸‚å‹æµ©è¾¾ç§‘æŠ€æ‹…ä»»é¦–å¸­æ¶æ„å¸ˆï¼Œè¢«è¯„ä¸ºå¾®è½¯æœ€æœ‰ä»·å€¼ä¸“å®¶ MVPï¼Œåä¸ºäº‘ MVPï¼Œè…¾è®¯äº‘ TVP&lt;/p&gt;
&lt;p&gt;è®®é¢˜å¤§çº²ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;.NET äº‘åŸç”Ÿæ¡ˆä¾‹&lt;/li&gt;
&lt;li&gt;Dapr ä»‹ç»&lt;/li&gt;
&lt;li&gt;Dapr åŠ©åŠ›äº‘åŸç”Ÿåº”ç”¨å¼€å‘
&lt;ol&gt;
&lt;li&gt;æœåŠ¡æ²»ç†ï¼šæœåŠ¡è°ƒç”¨ã€å¼¹æ€§ã€API ç½‘å…³ å’Œ æœåŠ¡ç½‘æ ¼&lt;/li&gt;
&lt;li&gt;å‘å¸ƒè®¢é˜… æ”¹é€ å®æ—¶æœåŠ¡&lt;/li&gt;
&lt;li&gt;å¯è§‚æµ‹æ€§ æ—¥å¿—ã€åˆ†å¸ƒå¼è¿½è¸ªã€æŒ‡æ ‡é‡‡é›†&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¬ä¼—æ”¶ç›Šï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;äº†è§£ä¸€ç§æ–°å‹çš„å¤šè¿è¡Œæ—¶æ¶æ„ä»¥åŠå¼€æºé¡¹ç›® Dapr&lt;/li&gt;
&lt;li&gt;äº†è§£å¦‚ä½•ä¸€å¥—ä»£ç å¦‚ä½•åŒæ—¶é€‚é…è™šæ‹Ÿæœºå’Œå®¹å™¨ï¼Œé€‚é…ä¸åŒçš„äº‘ç¯å¢ƒ&lt;/li&gt;
&lt;li&gt;æ·±å…¥ Dapr åœ¨å®é™…é¡¹ç›®ä¸­çš„å·¥ç¨‹å®è·µ&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;å®¹å™¨äº‘è°ƒåº¦ä¼˜åŒ–åŠå®è·µ&#34;&gt;å®¹å™¨äº‘è°ƒåº¦ä¼˜åŒ–åŠå®è·µ&lt;/h3&gt;
&lt;p&gt;è®²å¸ˆï¼šç‹ç¼&lt;/p&gt;
&lt;p&gt;ä¸ªäººä»‹ç»ï¼š&lt;/p&gt;
&lt;p&gt;ç›®å‰å°±èŒäº YY ç›´æ’­ï¼Œæ‹…ä»»é«˜çº§ SRE è¿ç»´å·¥ç¨‹å¸ˆï¼Œè´Ÿè´£ YY ç›´æ’­å®¹å™¨äº‘ã€‚10 å¹´çš„å·¥ä½œç»éªŒï¼Œ6 å¹´ä»¥ä¸Šçš„å®¹å™¨ç›¸å…³å¹³å°ç»éªŒï¼Œåœ¨äº‘åŸç”Ÿé¢†åŸŸæŒç»­æ·±è€•ï¼Œæ›¾åœ¨å¤šå®¶å…¬å¸ä¸»å¯¼å¹¶è½åœ°äº‘åŸç”ŸæŠ€æœ¯å’Œä¼ä¸šå®¹å™¨åŒ–æ”¹é€ ï¼Œè‡´åŠ›äºæ‰“é€ ç¨³å®šé«˜æ•ˆçš„å®¹å™¨äº‘å¹³å°ï¼Œç›®å‰è´Ÿè´£ YY ç›´æ’­å®¹å™¨äº‘çš„è¿­ä»£æ›´æ–°ä»¥åŠæ–°æŠ€æœ¯è½åœ°&lt;/p&gt;
&lt;p&gt;è®®é¢˜å¤§çº²ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;YY ç›´æ’­å®¹å™¨äº‘ä»‹ç»&lt;/li&gt;
&lt;li&gt;ä¸šåŠ¡èµ„æºä½¿ç”¨ç”»åƒå®ç°&lt;/li&gt;
&lt;li&gt;åŸºäºèŠ‚ç‚¹å®é™…è´Ÿè½½è°ƒåº¦&lt;/li&gt;
&lt;li&gt;åŸºäºèŠ‚ç‚¹å®é™…è´Ÿè½½äºŒæ¬¡è°ƒåº¦&lt;/li&gt;
&lt;li&gt;é€šè¿‡ virtual kubelet å®ç°é›†ç¾¤å³°å€¼å¼¹æ€§èƒ½åŠ›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¬ä¼—æ”¶ç›Šï¼š&lt;/p&gt;
&lt;p&gt;å¤§è§„æ¨¡å®¹å™¨åŒ–è½åœ°é‡åˆ°çš„é—®é¢˜åŠæŒ‘æˆ˜å¦‚ä½•åº”å¯¹çªå‘æµé‡ï¼Œå®ç°é›†ç¾¤çš„å³°å€¼å¼¹æ€§èƒ½åŠ›å¦‚ä½•å¼•è¿›äº‘åŸç”ŸæŠ€æœ¯ï¼Œå¹¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è½åœ°åŠæ•´åˆ&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Envoy æœ‰çŠ¶æ€ä¼šè¯ä¿æŒæœºåˆ¶è®¾è®¡ä¸å®ç°</title>
      <link>https://cloudnative.to/blog/envoy-stateful-session-hold-mechanism-design-and-implementation/</link>
      <pubDate>Tue, 13 Sep 2022 16:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-stateful-session-hold-mechanism-design-and-implementation/</guid>
      <description>&lt;h2 id=&#34;1-é—®é¢˜èƒŒæ™¯&#34;&gt;1. é—®é¢˜èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;ä¼šè¯ä¿æŒæ˜¯ä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚å¯¹äºåŒä¸€ä¼šè¯çš„è¯·æ±‚æˆ–è€…è¿æ¥ï¼Œé€šè¿‡ä¼šè¯ä¿æŒæœºåˆ¶ï¼Œè´Ÿè½½å‡è¡¡è½¯ä»¶ä¼šå°†å…¶è·¯ç”±åˆ°åŒä¸€ä¸ªåç«¯ï¼Œä»¥åˆ©ç”¨å±€éƒ¨æ€§åŸç†æ¥æé«˜æœåŠ¡æ•´ä½“çš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¼ ç»Ÿçš„ LB äº§å“ä¹‹ä¸­ï¼Œä¼šè¯ä¿æŒèƒ½åŠ›å¯ä»¥è¯´æ˜¯é‡ä¸­ä¹‹é‡ï¼Œæ¯”å¦‚ F5 è½¯ä»¶å°±æä¾›äº†ä¸°å¯Œçš„ä¼šè¯ä¿æŒæœºåˆ¶ä¾›ç”¨æˆ·é€‰æ‹©ã€‚è€Œåœ¨äº‘åŸç”Ÿçš„åœºæ™¯å½“ä¸­ï¼Œç”±äºæ›´å¤šé¢å‘æ— çŠ¶æ€çš„æœåŠ¡ï¼ŒæœåŠ¡å®ä¾‹åŠ¨æ€å¯ç”¨å’Œé”€æ¯ï¼Œä¼šè¯ä¿æŒèƒ½åŠ›ç›¸å¯¹è€Œè¨€é‡è¦æ€§æœ‰æ‰€é™ä½ã€‚è€Œä½œä¸ºäº‘åŸç”Ÿè¾¹ç¼˜ç½‘ç»œä»£ç†ï¼ŒEnvoy åœ¨ä¼šè¯ä¿æŒæ–¹é¢è‡ªç„¶ä¹Ÿç›¸å¯¹è–„å¼±ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¼€æº Envoy å½“ä¸­ï¼Œåªæä¾›äº†åŸºäºä¸€è‡´æ€§å“ˆå¸Œçš„ä¼šè¯ä¿æŒæœºåˆ¶ã€‚å…·ä½“æ¥è¯´ï¼ŒEnvoy æä¾›äº†ä¸€ä¸ªä¸€è‡´æ€§å“ˆå¸Œè´Ÿè½½å‡è¡¡ç®—æ³•è¿›è¡Œæµé‡çš„è´Ÿè½½å‡è¡¡ã€‚å¯¹äºä¸€ç»„åç«¯æœåŠ¡å®ä¾‹ï¼ŒEnvoy ä¼šæ ¹æ®æœåŠ¡å®ä¾‹åç§°æˆ–è€…åœ°å€æ¥è®¡ç®—å‡ºä¸€ä¸ªå“ˆå¸Œç¯ã€‚ä¹‹åï¼Œå¯¹äºæ¯ä¸€ä¸ª HTTP è¯·æ±‚ï¼ŒEnvoy éƒ½ä¼šæ ¹æ®è¯·æ±‚çš„ç‰¹å¾è®¡ç®—ä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œç„¶åæ ¹æ®å“ˆå¸Œå€¼åœ¨åç«¯å“ˆå¸Œç¯ä¸­é€‰æ‹©ä¸€ä¸ªæœ€åˆé€‚çš„åç«¯å®ä¾‹ï¼ˆé€šè¿‡æŠ˜åŠæŸ¥æ‰¾ï¼‰ã€‚è¯¥ä¼šè¯ä¿æŒæœºåˆ¶ä¸éœ€è¦ä¿å­˜é¢å¤–çš„çŠ¶æ€ï¼Œæœ€ç»ˆç»“æœåªå’Œè®¡ç®—æ‰€å¾—çš„å“ˆå¸Œå€¼ä»¥åŠå“ˆå¸Œç¯æœ‰å…³ã€‚æ­¤å¤–ï¼Œå¤©ç„¶çš„ï¼Œè¯¥ä¼šè¯ä¿æŒæœºåˆ¶ä¹Ÿå¯ä»¥åšåˆ°è·¨å®ä¾‹ä¼šè¯ä¿æŒï¼Œä¹Ÿå³æ˜¯å½“æ‹¥æœ‰å¤šä¸ª Envoy å®ä¾‹æ—¶ï¼Œè¯·æ±‚æ— è®ºæ˜¯ç”± Envoy A å®ä¾‹è½¬å‘æˆ–è€…æ˜¯ Envoy B å®ä¾‹è½¬å‘ï¼Œæœ€ç»ˆè½¬å‘åˆ°çš„ç›®æ ‡æœåŠ¡å®ä¾‹éƒ½æ˜¯ä¸€è‡´çš„ã€‚&lt;/p&gt;
&lt;p&gt;Envoy æ”¯æŒé…ç½®ä»ä¸åŒçš„è¯·æ±‚ç‰¹å¾ä¸­è®¡ç®—å“ˆå¸Œå€¼ï¼Œæ¯”å¦‚ä½¿ç”¨ç‰¹å®šè¯·æ±‚å¤´ï¼Œä½¿ç”¨æºåœ°å€ IPï¼Œæˆ–è€…ä½¿ç”¨ cookie ç­‰ã€‚åªè¦åç«¯å®ä¾‹ä¿æŒç¨³å®šï¼Œè¿™ä¸€æœºåˆ¶å‡ ä¹æ˜¯å®Œç¾çš„ã€‚ä½†æ˜¯ï¼Œäº‹å®ä¸Šï¼Œåç«¯å®ä¾‹å¹¶ä¸æ€»èƒ½å¤Ÿä¿æŒç¨³å®šï¼Œè€Œä¸”æœ‰ä¸€äº›ç‰¹æ®Šçš„åœºæ™¯ï¼ŒåŸºäºä¸€è‡´æ€§å“ˆå¸Œçš„è´Ÿè½½å‡è¡¡æœºåˆ¶ä¹Ÿæ— æ³•å®ç°ã€‚&lt;strong&gt;å› ä¸ºåŸºäºä¸€è‡´æ€§å“ˆå¸Œçš„ä¼šè¯ä¿æŒæœºåˆ¶æœ¬è´¨ä¸Šæ˜¯æ— çŠ¶æ€ä¼šè¯ä¿æŒã€‚ä¼šè¯ä¿æŒä¾èµ–çš„ä¸æ˜¯æŸä¸ªæŒç»­çš„çŠ¶æ€å€¼ï¼Œè€Œæ˜¯ç®—æ³•å®æ—¶è®¡ç®—çš„ç»“æœã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è¿›ä¸€æ­¥çš„å®Œå–„ Envoy çš„ä¼šè¯ä¿æŒèƒ½åŠ›ï¼Œæ‹“å±• Envoy çš„ä½¿ç”¨åœºæ™¯ï¼Œæ¯”å¦‚åœ¨ä¼ ç»Ÿåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä½œä¸ºä¸ƒå±‚è½¯è´Ÿè½½å‡è¡¡ï¼Œè½»èˆŸå¾®æœåŠ¡å›¢é˜Ÿå¯¹ Envoy è´Ÿè½½å‡è¡¡å™¨åšäº†è¿›ä¸€æ­¥çš„å¢å¼ºï¼Œä»¥æ”¯æŒæœ‰çŠ¶æ€çš„ä¼šè¯ä¿æŒæœºåˆ¶ã€‚å…·ä½“æ¥è¯´ï¼Œæœ‰çŠ¶æ€ä¼šè¯ä¿æŒæ˜¯ä¸ºäº†è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿è¯å½“åç«¯èŠ‚ç‚¹é›†çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆèŠ‚ç‚¹è¢«æ ‡è®°ä¸º degrade æˆ–è€…ä¸å¥åº·ã€æ–°å¢èŠ‚ç‚¹æˆ–è€…ç§»é™¤èŠ‚ç‚¹ï¼‰ï¼Œå±äºå·²æœ‰ä¼šè¯çš„è¯·æ±‚ä»æ—§èƒ½å¤Ÿæ­£ç¡®çš„è·¯ç”±åˆ°ä¼šè¯å¯¹åº”çš„èŠ‚ç‚¹ã€‚ç°æœ‰çš„åŸºäºä¸€è‡´æ€§å“ˆå¸Œçš„ä¼šè¯ä¿æŒæœºåˆ¶ï¼Œå½“åç«¯èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±ä¼šé‡æ–°æ„é€ å“ˆå¸Œç¯ï¼Œå¯¼è‡´ä¼šè¯ä¿æŒçš„ç»“æœä¸ç¨³å®šã€‚&lt;/li&gt;
&lt;li&gt;ä½¿å¾—æœ€å°è¿æ¥æ•°ç­‰ç®—æ³•ä¹Ÿèƒ½å¤Ÿå…·å¤‡ä¼šè¯ä¿æŒèƒ½åŠ›ã€‚ç°æœ‰ä¼šè¯ä¿æŒæ˜¯æ„å»ºåœ¨ä¸€è‡´æ€§å“ˆå¸Œè´Ÿè½½å‡è¡¡ç®—æ³•çš„åŸºç¡€ä¹‹ä¸Šï¼Œä½†æ˜¯å¦‚æœ€å°è¿æ¥æ•°ï¼Œè½®è½¬ç­‰è´Ÿè½½å‡è¡¡ç®—æ³•ä¸å…·å¤‡ä¼šè¯ä¿æŒèƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;æé«˜ä¸€è‡´æ€§å“ˆå¸Œè´Ÿè½½å‡è¡¡ç­–ç•¥çš„æ€§èƒ½ã€‚ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•é€šè¿‡æŠ˜åŠæŸ¥æ‰¾çš„æ–¹æ³•æ¥æ‰¾åˆ°åˆé€‚çš„èŠ‚ç‚¹ã€‚å¦‚æœä½¿ç”¨æœ‰çŠ¶æ€ä¼šè¯ä¿æŒï¼Œå¯ä»¥æœ‰æ•ˆçš„å‡å°‘åœ¨å…·å¤‡å¤§é‡èŠ‚ç‚¹æ—¶çš„èŠ‚ç‚¹æœç´¢çš„å¼€é”€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç›®å‰ï¼Œå›¢é˜Ÿå·²ç»å°†æ•´ä¸ªæ–¹æ¡ˆçš„æ‰€æœ‰è®¾è®¡ä¸å®ç°å‡è´¡çŒ®ç»™äº†å¼€æº Envoy å¹¶ä¸”å®Œæˆäº†åˆå…¥ï¼Œæˆä¸ºäº†å¼€æº Envoy çš„ä¸€éƒ¨åˆ†ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;2-å®ä¾‹ç®¡ç†&#34;&gt;2. å®ä¾‹ç®¡ç†&lt;/h2&gt;
&lt;p&gt;è¦å®ç°å„ç§å„æ ·çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œè‡ªç„¶éœ€è¦å®ç°å¯¹åç«¯å®ä¾‹é›†åˆçš„ç®¡ç†ï¼Œåœ¨ Envoy ä¸­ï¼Œä¸ºäº†å®ç°åç«¯å®ä¾‹çš„ç®¡ç†ï¼Œä½¿ç”¨äº†ä¸€ä¸ª &lt;code&gt;PrioritySet&lt;/code&gt; çš„æ•°æ®ç±»å‹ã€‚å…¶ä¸»è¦çš„ç‰¹ç‚¹ä¸‰ä¸ªï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤šä¼˜å…ˆçº§ï¼šä¸€ä¸ª PrioritySet åŒ…å«å¤šä¸ªä¼˜å…ˆçº§çš„å¤šç»„åç«¯å®ä¾‹ï¼›&lt;/li&gt;
&lt;li&gt;æ•°ç»„ç»“æ„ï¼šåç«¯å®ä¾‹å¤šä»¥æ•°ç»„ç»“æ„ç»„ç»‡å’Œç®¡ç†ï¼›&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹éš”ç¦»ï¼šæ¯ä¸ªçº¿ç¨‹ä¸­éƒ½æœ‰ç‹¬ç«‹çš„ &lt;code&gt;PrioritySet&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è€Œè¦å®ç°æœ‰çŠ¶æ€ä¼šè¯ä¿æŒï¼Œé¦–å…ˆï¼Œå¿…é¡»è¦æä¾›å¿«é€Ÿçš„å®ä¾‹æœç´¢èƒ½åŠ›ï¼Œè¿™æ˜¯å¼€æº &lt;code&gt;PrioritySet&lt;/code&gt; å¹¶ä¸å…·å¤‡çš„ã€‚ä¸ºæ­¤ï¼Œæ•°æ®é¢æ‰©å±•å¢å¼ºäº† &lt;code&gt;PrioritySet&lt;/code&gt;ï¼Œåœ¨å…¶ä¸­å®ç°äº†ä¸€ä¸ªä»¥å®ä¾‹åœ°å€ä¸º Key çš„ HostMapï¼Œæ¥æä¾›è·¨ä¼˜å…ˆçº§çš„å¿«é€Ÿæœç´¢èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶ï¼Œä¸ºäº†å°½å¯èƒ½çš„å‡å°è¯¥é¡¹å¢å¼ºå¸¦æ¥çš„é¢å¤–å†…å­˜å¼€é”€ï¼ŒHostMap åœ¨å„ä¸ªçº¿ç¨‹çš„ &lt;code&gt;PrioritySet&lt;/code&gt; ä¸­å…±äº«ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„åˆ°ï¼ŒEnvoy ç‰¹è‰²åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯å¯ä»¥åŠ¨æ€æ›´æ–°åç«¯å®ä¾‹åˆ—è¡¨ï¼Œæ‰€ä»¥è¿™ä¸ª HostMap ä¹Ÿéœ€è¦æ›´æ–°ï¼ˆæ›´æ–°éƒ½åœ¨ä¸»çº¿ç¨‹ä¸­ï¼‰å¹¶ä¸”é¢ä¸´çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸€èˆ¬æ¥è¯´ï¼Œé¢å¯¹æ­¤ç±»ä¸€å†™å¤šè¯»çš„æ•°æ®æ›´æ–°ï¼Œä¸€ä¸ªè¯»å†™é”æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä½†æ˜¯åœ¨æœ‰çŠ¶æ€ä¼šè¯ä¿æŒä¸­ï¼ŒHostMap çš„æœç´¢æ˜¯é«˜é¢‘æ“ä½œï¼Œæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯è‡³å°‘æ“ä½œä¸€æ¬¡ã€‚è€Œå®ä¾‹è¡¨æ›´æ–°åˆ™æ˜¯ä¸€ä¸ªç›¸å¯¹æ¥è¯´éå¸¸ä½é¢‘çš„æ“ä½œã€‚ä¸ºäº†ä¸€ä¸ªä½é¢‘çš„å®ä¾‹æ›´æ–°ï¼Œè€Œåœ¨æ¯æ¬¡è¯·æ±‚ä¸­éƒ½å¼•å…¥ä¸€æ¬¡è¯»é”çš„å¼€é”€ï¼Œå¯¹äºé«˜æ€§èƒ½ç½‘ç»œä»£ç†æ¥è¯´ï¼Œæ˜¯å¾ˆéš¾è®©äººæ¥å—çš„ã€‚æ‰€ä»¥ä¸ºæ­¤éœ€è¦è®¾è®¡ä¸€å¥—æœºåˆ¶æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„å®ä¾‹æ›´æ–°çš„åŒæ—¶ï¼Œä¿è¯æœç´¢çš„æ— é”å’Œé«˜æ€§èƒ½ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-1&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1&#34;
           src=&#34;https://cloudnative.to/blog/envoy-stateful-session-hold-mechanism-design-and-implementation/p1.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¯¥æœºåˆ¶ç®€å•åŸç†å¦‚ä¸Šæ‰€ç¤ºï¼Œå½“éœ€è¦æ›´æ–°å®ä¾‹è¡¨æ—¶ï¼ŒEnvoy ä¼šä»å·²æœ‰çš„ HostMap ä¸­åˆ›å»ºä¸€ä»½æ‹·è´ï¼Œæ‰€æœ‰æ›´æ–°éƒ½åœ¨æ–°çš„æ‹·è´è¿›è¡Œï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹å·²æœ‰ HostMapï¼Œè¿™æ ·é¿å…äº†å·²æœ‰çš„ HostMap åœ¨å¤šçº¿ç¨‹ä¸Šè¯»å†™çš„å†²çªã€‚ï¼ˆå½“ç„¶ï¼Œè¿™å¹¶éæ¯«æ— ä»£ä»·ï¼Œæ¯æ¬¡æ›´æ–°éƒ½éœ€è¦æ‹·è´ä¸€æ¬¡ HostMapï¼Œä»¥ä¸»çº¿ç¨‹çš„æ‹·è´å¼€é”€æ¢å–å·¥ä½œç°åœºçš„æ— é”æ“ä½œï¼‰&lt;/p&gt;
&lt;p&gt;åœ¨æ›´æ–°å®Œæˆä¹‹åï¼Œéœ€è¦å°†æœ€ç»ˆæ›´æ–°å°±ç»ªçš„ HostMap åŒæ­¥åˆ°å·¥ä½œçº¿ç¨‹ä¸­å»æ—¶ï¼Œå† commit æ‹·è´å‡ºæ¥çš„ HostMapï¼Œå¹¶å‘å„ä¸ªå·¥ä½œçº¿ç¨‹æ¨é€ä¸€ä¸ªæ›´æ–°äº‹ä»¶ï¼Œæœ€ç»ˆå®Œæˆæ•´ä¸ªå®ä¾‹è¡¨ä»¥åŠ HostMap æ›´æ–°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;3-ä¼šè¯çŠ¶æ€&#34;&gt;3. ä¼šè¯çŠ¶æ€&lt;/h2&gt;
&lt;p&gt;åœ¨å®Œæˆç¬¬ 2 å°èŠ‚ä¸­çš„å®ä¾‹ç®¡ç†æœºåˆ¶å¢å¼ºä¹‹åï¼Œå°±ä¸ºæœ‰çŠ¶æ€ä¼šè¯ä¿æŒæä¾›äº†ä¸€ä¸ªåŸºç¡€ã€‚å¦ä¸€ä¸ªéœ€è¦è§£å†³çš„é—®é¢˜æ˜¯ä¼šè¯çŠ¶æ€çš„ä¿å­˜ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ç§å…¸å‹çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨ HTTP Cookie æ¥ä¿å­˜ä¼šè¯çŠ¶æ€ã€‚å…·ä½“æ¥è¯´ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šä¸€ä¸ªç‰¹æ®Šçš„ Cookie åç§°ã€‚å¯¹äºæ¯ä¸€ä¸ªè¯·æ±‚ï¼Œå¦‚æœåŒ…å«æŒ‡å®šçš„ Cookieï¼Œåˆ™ä» Cookie ä¸­è§£æå‡ºç›®æ ‡å®ä¾‹çš„åœ°å€ï¼Œå¹¶ä¸”æ ¹æ®åœ°å€æ£€ç´¢ç›®æ ‡å®ä¾‹ã€‚å¦‚æœä¸å­˜åœ¨å¯¹åº”çš„ Cookie æˆ–è€… Cookie ä¸­åœ°å€ä¸å­˜åœ¨å¯¹åº”ç›®æ ‡å®ä¾‹ï¼Œåˆ™æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©ä¸€ä¸ªåç«¯å®ä¾‹ï¼Œå¹¶ä¸”å°†è¯¥åç«¯å®ä¾‹çš„åœ°å€é€šè¿‡ Set-Cookie æ·»åŠ åˆ°å“åº”ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-2&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 2&#34;
           src=&#34;https://cloudnative.to/blog/envoy-stateful-session-hold-mechanism-design-and-implementation/p2.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 2
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¯¥æ–¹æ¡ˆç®€å•æœ‰æ•ˆï¼Œè€Œä¸”æœ€é‡çš„æ˜¯ Envoy å°†ä¼šè¯çŠ¶æ€ä¿å­˜çš„è´£ä»»è½¬å«ç»™äº†å®¢æˆ·ç«¯ï¼Œä¿æŒäº†è‡ªèº«çš„æ— çŠ¶æ€ã€‚è¿™æ ·åšä¸ä½†ä½¿å¾—å®ç°ä¸Šæ›´ä¸ºç®€å•ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œè¯¥æ–¹æ¡ˆå¤©ç„¶çš„æ”¯æŒè·¨å®ä¾‹çš„ä¼šè¯ä¿æŒã€‚ä¹Ÿå³æ˜¯è¯´ï¼Œå½“å­˜åœ¨å¤šä¸ª Envoy å®ä¾‹æ—¶ï¼Œè¯·æ±‚æ— è®ºåœ¨ Envoy A æˆ–è€… Envoy B ä¸Šè¢«å¤„ç†ï¼Œéƒ½ä¸å½±å“ä¼šè¯ä¿æŒçš„ç»“æœã€‚
ä¸è¿‡è¿™ä¸ªæ–¹æ¡ˆï¼Œä¹Ÿæœ‰å®ƒçš„ç¼ºé™·ã€‚å®ƒçš„çµæ´»æ€§ç›¸å¯¹è¾ƒå¼±ã€‚å¯¹äºæ¯ä¸ªæ²¡æœ‰æœ‰æ•ˆæŒ‡å®š Cookie çš„æ–°è¯·æ±‚ï¼ŒEnvoy éƒ½ä¼šä¸ºå®ƒæ·»åŠ å¯¹åº”çš„ Cookie å¹¶å°†ä¹‹ä½œä¸ºä¸€ä¸ªæ–°çš„ä¼šè¯å¤„ç†ã€‚å®ƒæ— æ³•æ›´åŠ çµæ´»çš„ä½¿ç”¨è¯·æ±‚æº IPã€è¯·æ±‚å¤´ç­‰ä¿¡æ¯æ¥ä½œä¸ºè¯†åˆ«ä¼šè¯çš„ç‰¹å¾ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºæ­¤ï¼Œæ•°æ®é¢æå‡ºäº†å¦ä¸€ç§åŸºäºå­˜å‚¨/ç¼“å­˜çš„æ–¹æ¡ˆä½œä¸ºä¸Šä¸€æ–¹æ¡ˆçš„è¡¥å……ã€‚è¯¥æ–¹æ¡ˆä¼šæ ¹æ®è¯·æ±‚æŒ‡å®šçš„ç‰¹å¾ï¼ˆå¦‚æº IPã€è¯·æ±‚å¤´ç­‰ï¼‰è®¡ç®—ç‰¹å¾å€¼ï¼Œå¹¶ä¸”ä¿å­˜ç‰¹å¾å€¼å’Œç›®æ ‡å®ä¾‹çš„æ˜ å°„ï¼ˆå†…å­˜ç¼“å­˜ + ä¸­å¿ƒç¼“å­˜ï¼‰ã€‚å¦‚æ­¤ï¼Œå°±å¯ä»¥å®ç°æ ¹æ®ä»»æ„çš„è¯·æ±‚ç‰¹å¾æ¥ä½œä¸ºä¼šè¯ä¿æŒçš„ä¾æ®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-3&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 3&#34;
           src=&#34;https://cloudnative.to/blog/envoy-stateful-session-hold-mechanism-design-and-implementation/p3.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 3
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸éš¾å‘ç°ç¬¬äºŒä¸ªæ–¹æ¡ˆå’Œç¬¬ä¸€ä¸ªæ–¹æ¡ˆåœ¨æµç¨‹å¤„ç†ä¸Šå‡ ä¹å®Œå…¨ä¸€è‡´ã€‚å”¯ä¸€çš„ä¸åŒåœ¨äºâ€œæœ‰çŠ¶æ€ä¼šè¯ä¿æŒâ€ä¸­çš„çŠ¶æ€ç”±è°æ¥ä¿å­˜çš„é—®é¢˜ã€‚åœ¨ç¬¬äºŒä¸ªæ–¹æ¡ˆä¸­ï¼Œå¸¦æ¥äº†æ›´å¥½çš„çµæ´»æ€§ï¼ŒçŠ¶æ€çš„ä¿æŒéœ€è¦ Envoy/æ•°æ®é¢è‡ªèº«æ¥å¤„ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;4-è´Ÿè½½äº¤äº’&#34;&gt;4. è´Ÿè½½äº¤äº’&lt;/h2&gt;
&lt;p&gt;åœ¨ç¬¬ 2 å°èŠ‚ä¸­ï¼Œæ¥å…¥äº†å¦‚ä½•è®¾è®¡ä¸€ä¸ªå®‰å…¨ã€é«˜æ•ˆçš„ HostMap æ¥ç®¡ç†åç«¯å®ä¾‹è¡¨å¹¶ä¸”å®ç°å®ä¾‹çš„å¿«é€Ÿæœç´¢ã€‚åœ¨ç¬¬ 3 å°èŠ‚ä¸­ï¼Œä»‹ç»äº†å¦‚æœç»´æŠ¤ä¼šè¯çŠ¶æ€ï¼Œå®ç°ä¼šè¯çŠ¶æ€çš„ä¿å­˜å’Œæå–ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å¦‚ä½•åœ¨è¯·æ±‚è·¯ç”±è½¬å‘çš„è¿‡ç¨‹ä¸­ï¼Œå°†ä¼šè¯çŠ¶æ€å’Œ Host æœç´¢é€‰æ‹©ç»“åˆåˆ°ä¸€èµ·ï¼Œåˆ™æ˜¯ç¬¬ä¸‰ä¸ªé—®é¢˜ã€‚åœ¨ Envoy å½“ä¸­ï¼Œç›¸æ¯”äºæç«¯çš„é«˜æ€§èƒ½ï¼Œæ›´åŠ çœ‹é‡æ¨¡å—åŒ–ã€æ˜“æµ‹è¯•ç­‰ç‰¹ç‚¹ã€‚åœ¨å…·ä½“çš„å®ç°å½“ä¸­ï¼Œä¼šè¯çŠ¶æ€çš„ä¿å­˜æ˜¯åœ¨ä»£ç†åè®®çš„ L4 Filter å†…éƒ¨å®ç°çš„ã€‚ä»¥ HTTP åè®®ä¸ºä¾‹ï¼Œä¼šè¯çŠ¶æ€éœ€è¦é  HTTP Connection Manager è¿™ä¸ª L4 Filter æ¥å®ç°ï¼ˆå…¶ä¸­å†…åµŒçš„ HTTP L7 Filter å½“ä½œæ•´ä¸ª L4 Filter çš„ä¸€éƒ¨åˆ†ï¼‰ã€‚è€Œåç«¯å®ä¾‹ã€è´Ÿè½½å‡è¡¡ã€HostMap ç­‰åˆ™æ˜¯ç”± Upstrem æ¨¡å—å®ç°å’Œç®¡ç†ã€‚ä¸¤è€…ä¹‹é—´ä»…ä»…é€šè¿‡ &lt;code&gt;LoadBalancerContext&lt;/code&gt; æ¥å£è¿›è¡Œäº¤äº’ã€‚
ä¸ºæ­¤ï¼Œéœ€è¦æ‹“å±•  &lt;code&gt;LoadBalancerContext&lt;/code&gt; æ¥å£ï¼Œå…è®¸ L4 Filter é€šè¿‡  &lt;code&gt;LoadBalancerContext&lt;/code&gt;  å‘ Upstream ä¼ é€’ä¼šè¯çŠ¶æ€ã€‚è€Œ Upstream åˆ™æ ¹æ®ä¼šè¯çŠ¶æ€ä¼˜å…ˆé€‰æ‹©ç›®æ ‡å®ä¾‹ã€‚å¦‚æœä¼šè¯çŠ¶æ€æ— æ•ˆï¼Œåˆ™æ­£å¸¸çš„æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©åç«¯å®ä¾‹ã€‚å…·ä½“çš„æ‰©å±•æ¥å£è®¾è®¡å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;LoadBalancerContext&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;using&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;OverrideHost&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;absl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;cm&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;   * Returns the host the load balancer should select directly. If the expected host exists and
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;   * the host can be selected directly, the load balancer can bypass the load balancing algorithm
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;   * and return the corresponding host directly.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;   */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;virtual&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;absl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;optional&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OverrideHost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;overrideHostToSelect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ­¤å¤–ï¼Œè½»èˆŸè¿˜å¯¹ HTTP Connection Manager æš´éœ²ç»™ L7 Filter çš„ API åšäº†å¢å¼ºï¼Œå…è®¸å¼€å‘é€šè¿‡ç¼–å†™ç®€å•çš„ HTTP Filter æ¥è®¾ç½® override hostï¼Œè®©å¼€å‘è€…å¯ä»¥æ ¹æ®è‡ªèº«çš„éœ€è¦å¯¹è´Ÿè½½å‡è¡¡ç»“æœåšæ›´çµæ´»çš„æ§åˆ¶ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;StreamDecoderFilterCallbacks&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;virtual&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StreamFilterCallbacks&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;cm&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;  * Set override host to be used by the upstream load balancing. If the target host
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;  * exists in the host list of the routed cluster, the host should be selected
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;  * first.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;  * @param host The override host address.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;  */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;virtual&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;setUpstreamOverrideHost&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;absl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;cm&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;  * @return absl::optional&amp;lt;absl::string_view&amp;gt; optional override host for the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;  * upstream load balancing.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;  */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;virtual&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;absl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;optional&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;absl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;upstreamOverrideHost&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;5-api-è®¾è®¡&#34;&gt;5. API è®¾è®¡&lt;/h2&gt;
&lt;p&gt;æœ€åä¸€éƒ¨åˆ†æ˜¯æ•°æ®é¢ Envoy å‘ä¸Šå±‚æ§åˆ¶é¢æš´éœ²çš„ APIï¼Œä½¿å¾—æ§åˆ¶é¢å¯ä»¥å¯¹æœ‰çŠ¶æ€ä¼šè¯ä¿æŒåŠŸèƒ½è¿›è¡Œæ§åˆ¶ã€‚å®ƒåŒ…æ‹¬ HTTP æ‰©å±•å’ŒæœåŠ¡çº§åˆ«è´Ÿè½½å‡è¡¡é…ç½®ä¸¤éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ HTTP æ‰©å±•ä¸­ï¼Œæ·»åŠ äº†ä¸€ä¸ªé¢å¤–çš„ HTTP Filterï¼Œæ¥æ ¹æ®å…·ä½“çš„æœ‰çŠ¶æ€ä¼šè¯ä¿æŒå®ç°æ¥æå–ç›®æ ‡å®ä¾‹ï¼Œæ¯”å¦‚ cookie å®ç°å°±ä¼šä»æŒ‡å®š cookie ä¸­è·å–ç›®æ ‡å®ä¾‹åœ°å€ï¼ˆå½“ç„¶ï¼Œå› ä¸º HTTP Connection Manager æœ¬èº«ä¹Ÿå·²ç»åšäº†å¢å¼ºï¼Œå®Œå…¨ä»å¤´å¼€å‘æ–°çš„ HTTP æ‰©å±•æƒ³æ¥ä¹Ÿæ˜¯è½»è€Œæ˜“ä¸¾ä¹‹äº‹ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-proto&#34; data-lang=&#34;proto&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;StatefulSession&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// Specific implementation of session state. This session state will be used to store and
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// get address of the upstream host to which the session is assigned.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// [#extension-category: envoy.http.stateful_session]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;config.core.v3.TypedExtensionConfig&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;session_state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;CookieBasedSessionState&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// The cookie configuration used to track session state.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;type.http.v3.Cookie&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cookie&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;validate.rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;required&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}];&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æœåŠ¡å‡è¡¡é…ç½®å½“ä¸­ï¼Œæä¾›äº†é¢å¤–çš„çŠ¶æ€é™åˆ¶ï¼Œç¡®ä¿åªæœ‰æŒ‡å®šçŠ¶æ€çš„ç¤ºä¾‹å¯ä»¥é€šè¿‡å‰è¿°çš„ override host é€‰æ‹©ï¼Œå‡è®¾ç›®æ ‡å®ä¾‹å»ºåº·çŠ¶æ€ç¬¦åˆé¢„æœŸï¼Œåˆ™è®¤ä¸ºè¯¥ä¼šè¯çŠ¶æ€ä¸ºæœ‰æ•ˆçŠ¶æ€ï¼Œå¦åˆ™æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•é‡æ–°é€‰æ‹©ç›®æ ‡å®ä¾‹å¹¶æ›´æ–°ä¼šè¯çŠ¶æ€ã€‚å¦‚æ­¤å°±å®Œæˆäº†æ•´ä¸ªæ–¹æ¡ˆçš„æœ€åä¸€ç¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-proto&#34; data-lang=&#34;proto&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// This controls what hosts are considered valid when using
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// :ref:`host overrides &amp;lt;arch_overview_load_balancing_override_host&amp;gt;`, which is used by some
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// filters to modify the load balancing decision.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// If this is unset then [UNKNOWN, HEALTHY, DEGRADED] will be applied by default. If this is
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// set with an empty set of statuses then host overrides will be ignored by the load balancing.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;core.v3.HealthStatusSet&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;override_host_status&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;6-å…¨æ–‡å°ç»“&#34;&gt;6. å…¨æ–‡å°ç»“&lt;/h2&gt;
&lt;p&gt;æ•´ä¸ªæœ‰çŠ¶æ€ä¼šè¯ä¿æŒæœºåˆ¶ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ï¼šåœ¨ Upstream æ¨¡å—ä¸­å®ç°çº¿ç¨‹å®‰å…¨çš„é«˜æ€§èƒ½ HostMap ä»¥ä¾¿äºå¿«é€Ÿçš„å®ä¾‹æœç´¢ä»¥åŠå®ä¾‹çŠ¶æ€é™åˆ¶ï¼›åœ¨ L4/L7 Filter ä¸­å®ç°ä¼šè¯çŠ¶æ€çš„è®°å½•ã€æå–ï¼Œä¸”æä¾›äº†éå¸¸è‰¯å¥½çš„æ‰©å±•æ€§ï¼Œä¸”æ”¯æŒå¤šç§æœ‰çŠ¶æ€ä¼šè¯å®ç°ï¼›æ‰©å±•  &lt;code&gt;LoadBalancerContext&lt;/code&gt;  ä»¥å®ç°ä¸¤ä¸ªæ¨¡å—äº¤äº’ä¸Šä¸‹æ¸¸æ¨¡å—äº¤äº’ï¼Œå…è®¸ Filter æŒ‡å®šç›®æ ‡å®ä¾‹è¦†ç›–è´Ÿè½½å‡è¡¡ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;Envoy æœ‰çŠ¶æ€ä¼šè¯ä¿æŒæœºåˆ¶å¼¥è¡¥äº† Envoy åœ¨ä¼šè¯ä¿æŒæœºåˆ¶æ–¹é¢ç›¸å¯¹è–„å¼±çš„ç¼ºé™·ã€‚è§£å†³äº†åœ¨éƒ¨åˆ†ä¼ ç»Ÿåœºæ™¯ä¸‹ Envoy çš„çŸ­æ¿ã€‚è€Œä¸”ï¼Œç›®å‰è½»èˆŸå¾®æœåŠ¡å›¢é˜Ÿå·²ç»å°†æ•´ä¸ªæœ‰çŠ¶æ€ä¼šè¯ä¿æŒæœºåˆ¶éƒ½è´¡çŒ®ç»™äº† Envoy å¼€æºç¤¾åŒºï¼Œå¹¶æŒç»­ç»´æŠ¤ã€‚æœ‰å…´è¶£æˆ–è€…æœ‰è¿™æ–¹é¢éœ€æ±‚çš„åŒå­¦å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå¦‚æœå…¶ä¸­æœ‰ä¸è¶³ä¹‹å¤„ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å‘ç¤¾åŒºåé¦ˆ :)ã€‚&lt;/p&gt;
&lt;p&gt;9 æœˆ 23 æ—¥ï¼Œ2022 ç½‘æ˜“æ•°å­— + å¤§ä¼šå°†åœ¨æ­å·åº·è±å¾·é…’åº—å¬å¼€ï¼Œå±Šæ—¶æˆ‘ä»¬å›¢é˜Ÿå’Œä¸­å›½ä¿¡é€šé™¢ã€ä¸­æ³°è¯åˆ¸ã€å‰åˆ©é›†å›¢ã€å®‰ä¿¡è¯åˆ¸çš„ç›¸å…³è´Ÿè´£äººä¼šåˆ†äº«æ›´å¤šäº‘åŸç”ŸæŠ€æœ¯ä¸å®è·µã€‚æ¬¢è¿æ„Ÿå…´è¶£çš„æœ‹å‹&lt;a href=&#34;https://yc.sf.163.com/?tag=ppzu_prpromote_mediacooperate_0908shuzi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æå‰å…³æ³¨&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>é€šè¿‡ä¸¤çº§ç½‘å…³è®¾è®¡æ¥è·¯ç”±æœåŠ¡ç½‘æ ¼æµé‡</title>
      <link>https://cloudnative.to/blog/designing-traffic-flow-via-tier1-and-tier2-ingress-gateways/</link>
      <pubDate>Wed, 29 Jun 2022 11:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/designing-traffic-flow-via-tier1-and-tier2-ingress-gateways/</guid>
      <description>&lt;h2 id=&#34;foreword&#34;&gt;ç¼–è€…çš„è¯&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡æ˜¯æ¥è‡ª &lt;a href=&#34;https://tetrate.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate&lt;/a&gt; å·¥ç¨‹å¸ˆçš„åˆ†äº«ï¼ŒTetrate çš„æ‹³å¤´äº§å“æ˜¯ &lt;a href=&#34;https://tetrate.io/tetrate-service-bridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt;ï¼ˆä¸‹æ–‡ç®€ç§° TSBï¼‰ï¼Œå®ƒæ˜¯åœ¨å¼€æºçš„ Istio å’Œ Envoy åŸºç¡€ä¸Šæ„å»ºçš„ï¼Œä½†ä¸ºå…¶å¢åŠ äº†ç®¡ç†å¹³é¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;intro&#34;&gt;ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;Tetrate çš„åº”ç”¨è¿æ¥å¹³å° Tetrate Service Bridgeï¼ˆTSBï¼‰æä¾›ä¸¤ç§ç½‘å…³ç±»å‹ï¼Œåˆ†åˆ«ä¸ºä¸€çº§ç½‘å…³ï¼ˆTier-1ï¼‰å’ŒäºŒçº§ç½‘å…³ï¼ˆTier-2ï¼‰ï¼Œå®ƒä»¬éƒ½åŸºäº Envoy æ„å»ºï¼Œä½†æ˜¯ç›®çš„æœ‰æ‰€ä¸åŒã€‚æœ¬æ–‡å°†æ¢è®¨è¿™ä¸¤ç§ç±»å‹ç½‘å…³çš„åŠŸèƒ½ï¼Œä»¥åŠä½•æ—¶é€‰ç”¨å“ªç§ç½‘å…³ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºä¸¤çº§ç½‘å…³çš„ç®€è¦ä»‹ç»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€çº§ç½‘å…³ï¼ˆä¸‹æ–‡ç®€ç§° T1ï¼‰ä½äºåº”ç”¨è¾¹ç¼˜ï¼Œç”¨äºå¤šé›†ç¾¤ç¯å¢ƒã€‚åŒä¸€åº”ç”¨ä¼šåŒæ—¶æ‰˜ç®¡åœ¨ä¸åŒçš„é›†ç¾¤ä¸Šï¼ŒT1 ç½‘å…³å°†å¯¹è¯¥åº”ç”¨çš„è¯·æ±‚æµé‡åœ¨è¿™äº›é›†ç¾¤ä¹‹é—´è·¯ç”±ã€‚&lt;/li&gt;
&lt;li&gt;äºŒçº§ç½‘å…³ï¼ˆä¸‹æ–‡ç®€ç§° T2ï¼‰ä½äºä¸€ä¸ªçš„é›†ç¾¤è¾¹ç¼˜ï¼Œç”¨äºå°†æµé‡è·¯ç”±åˆ°è¯¥é›†ç¾¤å†…ç”±æœåŠ¡ç½‘æ ¼ç®¡ç†çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;explain&#34;&gt;ä¸¤çº§ç½‘å…³é‡Šä¹‰&lt;/h2&gt;
&lt;p&gt;æ‰˜ç®¡åœ¨ TSB ç®¡ç†çš„é›†ç¾¤ä¸­çš„åº”ç”¨éƒ¨ç½²çš„è®¾è®¡ä¸å¼€æºçš„ Istio æ¨¡å‹éå¸¸ç›¸ä¼¼ã€‚å®ƒä»¬çš„ç»“æ„ç›¸åŒï¼Œä½¿ç”¨å…¥å£ç½‘å…³æ¥è·¯ç”±ä¼ å…¥çš„æµé‡ã€‚T2 ç½‘å…³ç›¸å½“äº Istio çš„å…¥å£ç½‘å…³ï¼ˆIngress Gatewayï¼‰ï¼Œåœ¨é€»è¾‘ä¸Šä¸ Istio å¼€æºæ¨¡å‹ç›¸åŒï¼Œå¦‚å›¾ 1 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-1istio-ç½‘å…³å¯¹æ¯”-tetrate-t2-ç½‘å…³&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1ï¼šIstio ç½‘å…³å¯¹æ¯” Tetrate T2 ç½‘å…³&#34;
           src=&#34;https://cloudnative.to/blog/designing-traffic-flow-via-tier1-and-tier2-ingress-gateways/tier2-gw-deployment.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1ï¼šIstio ç½‘å…³å¯¹æ¯” Tetrate T2 ç½‘å…³
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Tetrate Service Bridge ä½¿ç”¨ Istio å’Œ Envoy æ„å»ºçš„æœåŠ¡ç½‘æ ¼ç®¡ç†é›†ç¾¤çš„æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢ï¼Œå…¶æœ¬èº«ä¸å­˜åœ¨äºåº”ç”¨æ•°æ®è·¯å¾„ä¸­ã€‚æ¯”è¾ƒå¼€æº Istio ç®¡ç†çš„é›†ç¾¤å’Œ TSB ç®¡ç†çš„é›†ç¾¤ä¹‹é—´çš„æ•°æ®åŒ…è·¯å¾„ï¼Œä½ ä¼šå‘ç°ä¸¤è€…ä¹‹é—´æ²¡æœ‰åŒºåˆ«ã€‚TSB çš„é…ç½®æ¸…å•ï¼ˆmanifestï¼‰è¢« Istio æ¶ˆè´¹å’Œä½¿ç”¨ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒTSB çš„ä½œç”¨ç±»ä¼¼äº CI/CD è‡ªåŠ¨åŒ–é€»è¾‘ï¼Œå…¶ä¸­éƒ¨ç½²è¿‡ç¨‹ä¼šå½±å“åº”ç”¨ç¨‹åºçš„è¡Œä¸ºï¼Œä½†ä¸ä¼šå½±å“åº”ç”¨ç¨‹åºé€»è¾‘æœ¬èº«ã€‚&lt;/p&gt;
&lt;p&gt;TSB åœ¨å¼€æº Istio çš„å¢åŠ äº†ä¸€äº›ç»„ä»¶ï¼Œä»¥ç®¡ç†æ¯ç»„åº”ç”¨ç¨‹åºç½‘å…³èŒƒå›´çš„å®‰è£…å’Œé…ç½®ï¼Œä»¥åŠ å¿«å¼€å‘å’Œè¿ç»´äººå‘˜çš„å·¥ä½œè¿›åº¦ï¼Œå°†åŸºç¡€è®¾æ–½å’Œåº”ç”¨ç¨‹åºä¹‹é—´çš„èŒè´£åˆ†ç¦»ï¼Œå°†é”™è¯¯é…ç½®ç½‘å…³çš„å½±å“ä¸å…¶ä»–åº”ç”¨ç¨‹åº/ä¸šåŠ¡ç»„éš”ç¦»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;when-use-t1&#34;&gt;ä½•æ—¶ä½¿ç”¨ T1 ç½‘å…³ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å½“ä½ æœ‰ä¸¤ä¸ªæˆ–æ›´å¤šçš„ Kubernetes é›†ç¾¤ä¸ºåŒä¸€ä¸ªåº”ç”¨æœåŠ¡æ—¶ï¼Œä¸ºäº†å¢åŠ å®¹é‡ã€è“ç»¿éƒ¨ç½²ã€æ•…éšœè½¬ç§»ç­‰ï¼Œé—®é¢˜æ€»æ˜¯å‡ºç°ï¼šå…¥ç«™æµé‡å¦‚ä½•åœ¨è¿™äº›é›†ç¾¤ä¹‹é—´åˆ†é…ï¼Ÿåœ¨æ¯ä¸ªé›†ç¾¤è¾¹ç¼˜çš„ T2 ç½‘å…³å…è®¸ç›´æ¥è®¿é—®åº”ç”¨ç¨‹åº â€”â€” ä¾‹å¦‚ï¼Œé›†ç¾¤ A å°†ç›‘å¬ &lt;code&gt;service1A.example.com&lt;/code&gt;ï¼Œé›†ç¾¤ X å°†ç›‘å¬ &lt;code&gt;service1X.example.com&lt;/code&gt;ã€‚åè¿‡æ¥ï¼ŒT2 ç½‘å…³æä¾›è·¨é›†ç¾¤çš„å…¨å±€è´Ÿè½½å‡è¡¡ã€‚è·¨é›†ç¾¤çš„æµé‡è·¯ç”±åˆ†é…åŸºäº 1 åˆ° 100 ä¹‹é—´çš„æƒé‡å€¼ï¼ŒæŒ‡å®šå‘é€åˆ°ç‰¹å®šé›†ç¾¤çš„æµé‡çš„ç™¾åˆ†æ¯”ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ T1 ç½‘å…³é…ç½®çš„ä¾‹å­ã€‚è¿™ä¸ªä¾‹å­è¡¨ç¤ºäº†ä¸€ä¸ªå®Œæ•´çš„ T1 ç½‘å…³æ¸…å•ï¼Œä»¥è¯æ˜è¯¥è§£å†³æ–¹æ¡ˆçš„ç®€å•æ€§ã€‚å…³äºå…·ä½“è®¾ç½®çš„ç»†èŠ‚ï¼Œè¯·å‚è€ƒ&lt;a href=&#34;https://docs.tetrate.io/service-bridge/1.4.x/en-us/refs/tsb/gateway/v2/tier1_gateway#tier1gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt; Tetrate API æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway.tsb.tetrate.io/v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Tier1Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service1-tier1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;demo-gw-group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;organization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;demo-org&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tenant&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;demo-tenant&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workspace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;demo-ws&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service1-tier1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tsb-gateway-service1-tier1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;externalServers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostname&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service1.cx.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;site-1-gcp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;75&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;site-2-aws&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåˆ° &lt;code&gt;service1.cx.example.com&lt;/code&gt; çš„ 75% ç”¨æˆ·è¯·æ±‚è¢«è½¬å‘åˆ° GCP ä¸­çš„ &lt;code&gt;site-1&lt;/code&gt;ï¼Œå…¶ä½™çš„è½¬å‘åˆ° AWS ä¸­çš„ &lt;code&gt;site-2&lt;/code&gt;ã€‚è¿™ä¸ªä¾‹å­ä¸­çš„æµé‡åˆ°è¾¾æ˜æ–‡ç«¯å£ 80ï¼Œä¹‹å T1 ç½‘å…³å’Œåº”ç”¨é›†ç¾¤ä¹‹é—´çš„æ‰€æœ‰é€šä¿¡éƒ½ç»è¿‡ mTLS åŠ å¯†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-2t1-å’Œ-t2-ç½‘å…³ç½‘ç»œè·¯å¾„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 2ï¼šT1 å’Œ T2 ç½‘å…³ç½‘ç»œè·¯å¾„å›¾&#34;
           src=&#34;https://cloudnative.to/blog/designing-traffic-flow-via-tier1-and-tier2-ingress-gateways/tier1-gw-listening.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 2ï¼šT1 å’Œ T2 ç½‘å…³ç½‘ç»œè·¯å¾„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;consolidate&#34;&gt;äº‘ä¾›åº”ç½‘å…³æ•´åˆ&lt;/h2&gt;
&lt;p&gt;Istio ç”¨æˆ·é€šå¸¸æŒ‰åº”ç”¨æ¨¡å‹å®æ–½å…¥å£ç½‘å…³ã€‚è¿™ç§æ–¹æ³•ä¿è¯äº†å¯¹ä¸€ä¸ªåº”ç”¨ç¨‹åºåŠå…¶å·¥ä»¶çš„å®‰å…¨ã€ç‹¬ç«‹ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæ³¨æ„åˆ°çš„æœ€å¸¸è§çš„ç—›ç‚¹ â€”â€” æ¯ä¸ªåº”ç”¨éƒ½éœ€è¦ä½¿ç”¨äº‘ä¾›åº”å•†çš„è´Ÿè½½å‡è¡¡å™¨ã€‚è¿™æ ·åšä½¿å¾—ç”¨æˆ·éœ€è¦ç»´æŠ¤ä½äº Envoy å…¥å£ç½‘å…³ Pod å‰å¤§é‡çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œè¿™å¸¦æ¥èµ„é‡‘å¼€é”€å’Œç®¡ç†æˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;TSB å…è®¸é€šè¿‡ NodePort æœåŠ¡ç±»å‹è€Œä¸æ˜¯ LoadBalancer è¿›è¡ŒæœåŠ¡å‘ç°å’Œé€šä¿¡ï¼Œè¿™æ„å‘³ç€ä¸å†éœ€è¦äº‘ä¾›åº”å•†çš„è´Ÿè½½å‡è¡¡å™¨ï¼›&lt;strong&gt;TSB é›†ç¾¤å†…çš„æœåŠ¡å¯ä»¥é€šè¿‡ NodePort ç›´æ¥åˆ°è¾¾&lt;/strong&gt;ã€‚T1 ç½‘å…³å…è®¸æˆ‘ä»¬å°†äº‘ä¾›åº”å•†è´Ÿè½½å‡è¡¡å™¨çš„ä½¿ç”¨å‹ç¼©åˆ°ä¸€ä¸ªå•ä¸€çš„å…¥å£ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-3äº‘ä¾›åº”å•†ç½‘å…³æ•´åˆ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 3ï¼šäº‘ä¾›åº”å•†ç½‘å…³æ•´åˆ&#34;
           src=&#34;https://cloudnative.to/blog/designing-traffic-flow-via-tier1-and-tier2-ingress-gateways/cloud-vendor-setup.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 3ï¼šäº‘ä¾›åº”å•†ç½‘å…³æ•´åˆ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ 3 å±•ç¤ºäº†é€šè¿‡å°†é›†ç¾¤å†…çš„æœåŠ¡è¿æ¥è½¬ç§»åˆ° TSBï¼Œè€Œä¸ä½¿ç”¨äº‘ä¾›åº”å•†çš„è´Ÿè½½å‡è¡¡å™¨æ¥ç®€åŒ–äº‘è®¾ç½®ã€‚åœ¨æ²¡æœ‰ TSB çš„æƒ…å†µä¸‹ï¼Œè¦å®ç°ä¸Šè¿°è®¾ç½®ï¼Œéœ€è¦ä½¿ç”¨å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ã€‚TSB è¿˜ç»´æŠ¤ Kubernetes èŠ‚ç‚¹çš„åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;resource-requirement&#34;&gt;èµ„æºè¦æ±‚&lt;/h2&gt;
&lt;p&gt;å°± T2 ç½‘å…³æ‰€éœ€çš„èµ„æºè€Œè¨€ï¼Œå¼€æº Istio å’Œ TSB çš„è¦æ±‚æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚äº‹å®ä¸Šï¼Œå®ç°æ–¹å¼æ˜¯ä¸€æ ·çš„ â€”â€” Gateway å’Œ VirtualService æ¸…å•å¯ä»¥æ‰‹åŠ¨åˆ›å»ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¼€æºçš„è‡ªåŠ¨åŒ–å·¥å…·åˆ›å»ºã€‚åœ¨ Tetrate çš„ç”¨ä¾‹ä¸­ï¼ŒTSB ä¸º Istio åˆ›å»ºæ¸…å•ã€‚&lt;/p&gt;
&lt;p&gt;T1 ç½‘å…³ç¡®å®éœ€è¦ä¸€ä¸ªä¸“é—¨çš„æ§åˆ¶å¹³é¢ï¼Œè¿™æ„å‘³ç€ç½‘æ ¼ç®¡ç†çš„åº”ç”¨ç¨‹åºå’Œ T1 ç½‘å…³ä¸èƒ½åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸­è¿è¡Œï¼Œå°½ç®¡æ‰¿è½½ T1 ç½‘å…³çš„ Kubernetes é›†ç¾¤ä¹Ÿå¯ä»¥æ‰¿è½½æœåŠ¡ç½‘æ ¼ä»¥å¤–çš„åº”ç”¨ç¨‹åºã€‚ä¸è¿‡ï¼ŒTetrate çš„æœ‰äº›å®¢æˆ·å°† T1 ç½‘å…³æ”¾åœ¨ä¸ TSB ç®¡ç†å¹³é¢ç›¸åŒçš„é›†ç¾¤ä¸Šã€‚&lt;/p&gt;
&lt;h2 id=&#34;consideration&#34;&gt;æ¶æ„è€ƒè™‘å› ç´ &lt;/h2&gt;
&lt;p&gt;éšç€åº”ç”¨ç¯å¢ƒçš„å‘å±•å’Œæˆç†Ÿï¼Œå‡ºç°æ–°çš„éœ€æ±‚æ˜¯å¾ˆå¸¸è§çš„ã€‚T1 ç½‘å…³å¯ä»¥ä½œä¸ºåˆå§‹æœåŠ¡ç½‘æ ¼æ¶æ„å®æ–½çš„ä¸€éƒ¨åˆ†è¿›è¡Œè§„åˆ’å’Œå®æ–½ï¼Œä¹Ÿå¯ä»¥åœ¨ä»¥åæ·»åŠ ã€‚å¢åŠ ä¸€çº§ç½‘å…³åªå½±å“å…¥å£ç‚¹çš„å…¥ç«™æµé‡ï¼Œä½†ä¸éœ€è¦å¯¹ç°æœ‰é›†ç¾¤åšä»»ä½•æ”¹å˜ã€‚&lt;/p&gt;
&lt;p&gt;å›¾ 4 å±•ç¤ºäº†ä¸€ä¸ªæ²¡æœ‰ T1 ç½‘å…³çš„éƒ¨ç½²é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-4æ²¡æœ‰-t1-ç½‘å…³çš„éƒ¨ç½²é…ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 4ï¼šæ²¡æœ‰ T1 ç½‘å…³çš„éƒ¨ç½²é…ç½®&#34;
           src=&#34;https://cloudnative.to/blog/designing-traffic-flow-via-tier1-and-tier2-ingress-gateways/dns-server-points-website.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 4ï¼šæ²¡æœ‰ T1 ç½‘å…³çš„éƒ¨ç½²é…ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“å¼•å…¥ T1 ç½‘å…³æ—¶ï¼ˆå›¾ 5ï¼‰ï¼Œå¿…é¡»æ›´æ–° DNS è®°å½•ä»¥æŒ‡å‘ä¸€çº§ç½‘å…³ï¼Œè€Œä¸éœ€è¦å¯¹åº”ç”¨é›†ç¾¤çš„è®¾ç½®è¿›è¡Œä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-5å¸¦æœ‰ä¸€çº§ç½‘å…³çš„å¤šé›†ç¾¤éƒ¨ç½²å®ä¾‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 5ï¼šå¸¦æœ‰ä¸€çº§ç½‘å…³çš„å¤šé›†ç¾¤éƒ¨ç½²å®ä¾‹&#34;
           src=&#34;https://cloudnative.to/blog/designing-traffic-flow-via-tier1-and-tier2-ingress-gateways/application-clusters-config.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 5ï¼šå¸¦æœ‰ä¸€çº§ç½‘å…³çš„å¤šé›†ç¾¤éƒ¨ç½²å®ä¾‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;æ³¨æ„&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    TSB ä¸æ˜¯ DNS ç®¡ç†å·¥å…·ï¼ŒDNS è®°å½•çš„æ›´æ”¹æ˜¯åœ¨ TSB ä¹‹å¤–è¿›è¡Œçš„ï¼ˆæœ‰å¤šç§è‡ªåŠ¨åŒ–å·¥å…·å’ŒæŠ€æœ¯å¯ç”¨äºè¯¥æ“ä½œ)ã€‚
&lt;/div&gt;

&lt;p&gt;ç„¶è€Œï¼Œåœ¨æ·»åŠ  T2 ç½‘å…³æ—¶ï¼Œä»ä½¿ç”¨ LoadBalancer åˆ‡æ¢åˆ° NodePort æ¶æ„ï¼Œç¡®å®éœ€è¦å¯¹åº”ç”¨é›†ç¾¤è¿›è¡Œè½»å¾®çš„æ”¹å˜ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶ T1 ç½‘å…³ä½œä¸ºåº”ç”¨è¾¹ç¼˜ä¼ å…¥æµé‡çš„å‰ç«¯ï¼Œä½†å®ƒå¯ä»¥éƒ¨ç½²åœ¨ä¸€ä¸ªé«˜å¯ç”¨æ€§çš„é…ç½®ä¸­ï¼ˆå›¾ 6ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-6é«˜å¯ç”¨æ€§é…ç½®ä¸­çš„-t1-ç½‘å…³&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 6ï¼šé«˜å¯ç”¨æ€§é…ç½®ä¸­çš„ T1 ç½‘å…³&#34;
           src=&#34;https://cloudnative.to/blog/designing-traffic-flow-via-tier1-and-tier2-ingress-gateways/tier1-gateway-incoming-traffic.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 6ï¼šé«˜å¯ç”¨æ€§é…ç½®ä¸­çš„ T1 ç½‘å…³
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨é«˜å¯ç”¨æ€§æ–¹é¢ï¼Œå¯ä»¥ä½¿ç”¨ T1 ç½‘å…³çš„æ•°é‡æ²¡æœ‰é™åˆ¶ã€‚è¿™ç§çµæ´»çš„æ¶æ„å…è®¸ç”¨æˆ·å»ºç«‹å¼ºå¤§çš„è®¾è®¡ä»¥æ»¡è¶³å¹¿æ³›çš„è¦æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡æ¶µç›–äº†æœåŠ¡ç½‘æ ¼æ¶æ„å¸ˆåœ¨ä¼ä¸šç¯å¢ƒä¸­è®¾è®¡ TSB éƒ¨ç½²æ—¶æœ€å¸¸è§çš„æ¶æ„é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯æœ€é‡è¦çš„æ”¶è·ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;TSB T1 å’Œ T2 ç½‘å…³ä½¿ç”¨ Istio å…¥å£ç½‘å…³ Pod å’ŒæœåŠ¡ã€‚è¿™é‡Œæ²¡æœ‰å¼•å…¥é¢å¤–çš„ä¸“æœ‰ç»„ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;TSB æ”¯æŒå¼€æº Istio ä¸­çš„ç½‘å…³æ¨¡å¼ã€‚ä»…ä»…æ˜¯åç§°ä¸Šçš„æ”¹å˜ï¼Œå¦‚ TSB çš„å…¥å£ç½‘å…³è¢«ç§°ä¸º T2 ç½‘å…³ã€‚&lt;/li&gt;
&lt;li&gt;å•ä¸€çš„ç½‘å…³å¯ä»¥ç”¨äºæ‰€æœ‰çš„åº”ç”¨ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨æŒ‰åº”ç”¨åˆ’åˆ†çš„ç½‘å…³æ¨¡å¼ã€‚&lt;/li&gt;
&lt;li&gt;TSB å¯ä»¥é€šè¿‡åˆ©ç”¨ Kubernetes NodePort è€Œä¸æ˜¯ LoadBalancer è¿›è¡Œé›†ç¾¤å†…é€šä¿¡ï¼Œå‡å°‘ä½¿ç”¨çš„äº‘å‚å•†è´Ÿè½½å‡è¡¡å™¨çš„æ•°é‡ï¼Œä»è€Œé™ä½äº‘è®¡ç®—æˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;TSB T1 ç½‘å…³æä¾›è·¨é›†ç¾¤è´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºåœ¨å®æ–½çš„æ—©æœŸé˜¶æ®µå¯èƒ½ä¸éœ€è¦è·¨é›†ç¾¤è´Ÿè½½å‡è¡¡ï¼Œå› æ­¤ T1 ç½‘å…³ä¸éœ€è¦æˆä¸ºåˆå§‹éƒ¨ç½²çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥åœ¨ä»¥åæ·»åŠ ï¼Œå¯¹ç°æœ‰çš„åº”ç”¨ç¨‹åºæ²¡æœ‰é‡å¤§å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;å¤šä¸ª T1 ç½‘å…³å¯ä»¥éƒ¨ç½²åœ¨åŒä¸€ä¸ªåº”ç”¨ç¨‹åºå‰é¢ï¼Œä»¥å®ç°é«˜å¯ç”¨æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Envoy API Gatewayâ€”â€”æ¨åŠ¨ç½‘å…³çš„è¿›ä¸€æ­¥å‘å±•</title>
      <link>https://cloudnative.to/blog/the-gateway-to-a-new-frontier/</link>
      <pubDate>Tue, 17 May 2022 11:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/the-gateway-to-a-new-frontier/</guid>
      <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ä»Šå¤©ï¼ŒEnvoy ç¤¾åŒº&lt;a href=&#34;https://www.cncf.io/blog/2022/05/16/introducing-envoy-gateway/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®£å¸ƒäº†&lt;/a&gt;ä¸€ä¸ªä»¤äººå…´å¥‹çš„æ–°é¡¹ç›®ï¼š&lt;a href=&#34;https://github.com/envoyproxy/gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Gateway&lt;/a&gt;ã€‚è¯¥é¡¹ç›®å°†è¡Œä¸šé¢†å¯¼è€…è”åˆèµ·æ¥ï¼Œç²¾ç®€ç”± Envoy é©±åŠ¨çš„åº”ç”¨ç½‘å…³çš„å¥½å¤„ã€‚è¿™ç§æ–¹æ³•ä½¿ Envoy Gateway èƒ½å¤Ÿç«‹å³ä¸ºå¿«é€Ÿåˆ›æ–°æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚è¯¥é¡¹ç›®å°†æä¾›ä¸€å¥—æœåŠ¡æ¥ç®¡ç† Envoy ä»£ç†æœºç¾¤ï¼Œé€šè¿‡æ˜“ç”¨æ€§æ¥æ¨åŠ¨é‡‡ç”¨ï¼Œå¹¶é€šè¿‡å®šä¹‰æ˜ç¡®çš„æ‰©å±•æœºåˆ¶æ¥æ”¯æŒä¼—å¤šçš„ç”¨ä¾‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™æ ·åš&#34;&gt;æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Tetrate æ˜¯ Envoy Proxy çš„ç¬¬ä¸€è´¡çŒ®è€…ï¼ˆæŒ‰æäº¤é‡è®¡ç®—ï¼‰ï¼Œä¹Ÿæ˜¯ Envoy Gateway æŒ‡å¯¼å°ç»„çš„æˆå‘˜ï¼Œå…¶è´¡çŒ®è€…æ¶µç›–æŠ€æœ¯å’Œç®¡ç†é¢†åŸŸã€‚æˆ‘ä»¬ç›¸ä¿¡ï¼Œæˆ‘ä»¬å¼ºå¤§çš„ä¼™ä¼´å…³ç³»å’Œåœ¨å¼€æºè½¯ä»¶æ–¹é¢çš„æ·±åšç»éªŒå°†æœ‰åŠ©äºç¡®ä¿ Envoy Gateway çš„æˆåŠŸã€‚Tetrate æ¨åŠ¨äº† EG è®¡åˆ’ï¼Œå› ä¸ºæˆ‘ä»¬è‡´åŠ›äºä¸Šæ¸¸é¡¹ç›®ï¼Œå› ä¸ºæˆ‘ä»¬ç›¸ä¿¡è¿™å°†é™ä½ Envoy Proxy ç”¨æˆ·çš„è¿›å…¥é—¨æ§›ï¼Œä¹Ÿå› ä¸ºè¿™ä¸æˆ‘ä»¬å¼€å‘æœåŠ¡ç½‘æ ¼ä½œä¸ºé›¶ä¿¡ä»»æ¶æ„åŸºç¡€çš„ä½¿å‘½ç›¸ä¸€è‡´ã€‚Tetrate å°†å¤§åŠ›æŠ•èµ„å»ºè®¾ Envoy Gateway çš„å®‰å…¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ”¯æŒ OAuth2 å’Œ &lt;a href=&#34;https://letsencrypt.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Letâ€™s Encrypt&lt;/a&gt; é›†æˆç­‰ API åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯¹ä¸Šæ¸¸é¡¹ç›®çš„æ‰¿è¯º&#34;&gt;å¯¹ä¸Šæ¸¸é¡¹ç›®çš„æ‰¿è¯º&lt;/h3&gt;
&lt;p&gt;Tetrate ä»ç¬¬ä¸€å¤©èµ·å°±ç«™åœ¨æœåŠ¡ç½‘æ ¼çš„æœ€å‰æ²¿ï¼Œå§‹ç»ˆç›¸ä¿¡ä¸Šæ¸¸é¡¹ç›®å’Œå®ƒä»¬çš„ç¤¾åŒºã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä¸º Istio å’Œ Envoy çš„ä¸Šæ¸¸é¡¹ç›®æä¾›å¸®åŠ©å’Œæ”¯æŒã€‚æˆ‘ä»¬çœ‹åˆ°ä¸åŒçš„äººåœ¨ä½¿ç”¨ Envoyï¼Œå¹¶åˆ›å»ºä»–ä»¬è‡ªå·±çš„æ§åˆ¶å¹³é¢å’Œ API ç½‘å…³å®ç°ï¼Œå¯¼è‡´ç¢ç‰‡åŒ–ï¼Œåˆ›æ–°é€Ÿåº¦æ…¢ï¼ŒåŠŸèƒ½å·®è·å¤§ï¼Œä»¥åŠç¼ºä¹å¯¹ä¸€ä¸ªä»£ç åº“çš„æ”¯æŒã€‚ç”±äºæˆ‘ä»¬ä¸ Matt Klein å’Œ Envoy ç¤¾åŒºé•¿æœŸä»¥æ¥å…³ç³»å¯†åˆ‡ï¼Œå½“æˆ‘ä»¬æè®®å°†å…¶çº³å…¥ Envoy çš„æ ‡å‡†åŒ–å®ç°ï¼Œå¹¶å°†å…¶æ•´åˆåˆ°ä¸€ä¸ªå®˜æ–¹çš„ä¸Šæ¸¸å®ç°ä¸­æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°äº† Matt å’Œå…¶ä»– CNCF é¡¹ç›®çš„å¼ºçƒˆæ”¯æŒã€‚æˆ‘ä»¬ä¸€ç›´åœ¨å¹•åä¸å…¶ä»–æŒ‡å¯¼å§”å‘˜ä¼šæˆå‘˜ï¼ˆ&lt;a href=&#34;https://www.getambassador.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambassador Labs&lt;/a&gt;ã€&lt;a href=&#34;https://www.fidelity.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fidelity Investments&lt;/a&gt;ã€&lt;a href=&#34;https://projectcontour.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Project Contour&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.vmware.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VMware&lt;/a&gt; è¾›å‹¤å·¥ä½œï¼Œä»¥å®šä¹‰ Envoy Gatewayã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“ï¼Œè‰°è‹¦çš„å·¥ä½œæ‰åˆšåˆšå¼€å§‹ï¼Œæˆ‘ä»¬è‡´åŠ›äºè¿™ä¸ªé¡¹ç›®ä»¥åŠ CNCF å†…å…¶ä»–å‡ ä¸ªé¡¹ç›®çš„é•¿æœŸæˆåŠŸã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®ç°æ§åˆ¶å¹³é¢çš„æ ‡å‡†åŒ–&#34;&gt;å®ç°æ§åˆ¶å¹³é¢çš„æ ‡å‡†åŒ–&lt;/h3&gt;
&lt;p&gt;åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ï¼ŒEnvoy å·²ç»æˆä¸ºç°ä»£äº‘åŸç”Ÿåº”ç”¨çš„é¦–é€‰ç½‘ç»œå±‚ã€‚éšç€ Envoy è·å¾—å…³æ³¨ï¼Œå¤§é‡çš„ä¸Šæ¸¸é¡¹ç›®å¼€å§‹åˆ©ç”¨å®ƒæ¥å®ç°æœåŠ¡ç½‘æ ¼ã€å…¥å£ã€å‡ºå£å’Œ API ç½‘å…³åŠŸèƒ½ã€‚è¿™äº›é¡¹ç›®ä¸­æœ‰è®¸å¤šèƒ½åŠ›é‡å ã€åŠŸèƒ½å·®è·ã€ä¸“æœ‰ç‰¹æ€§ï¼Œæˆ–è€…ç¼ºä¹ç¤¾åŒºå¤šæ ·æ€§ã€‚è¿™ç§æ”¯ç¦»ç ´ç¢çš„çŠ¶æ€æ˜¯ç”±äº Envoy ç¤¾åŒºæ²¡æœ‰æä¾›æ§åˆ¶å¹³é¢çš„å®ç°è€Œäº§ç”Ÿçš„å‰¯ä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œåˆ›æ–°çš„é€Ÿåº¦é™ä½äº†ï¼Œä¼ä¸šè¢«è¦æ±‚è¾¨åˆ«åˆ©ç”¨ Envoy ä½œä¸ºå…¶åº”ç”¨ç½‘ç»œæ•°æ®å¹³é¢çš„æœ€ä½³æ–¹æ³•ã€‚ç°åœ¨ï¼Œç¤¾åŒºæ­£åœ¨æä¾› Envoy Gatewayï¼Œæ›´å¤šçš„ç”¨æˆ·å¯ä»¥äº«å— Envoy çš„å¥½å¤„ï¼Œè€Œæ— éœ€å†³å®šæ§åˆ¶å¹³é¢ã€‚Envoy Gateway çš„&lt;a href=&#34;https://github.com/envoyproxy/gateway/blob/main/GOALS.md#goals&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç›®æ ‡&lt;/a&gt;æ˜¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;ldquo;&amp;hellip;&amp;hellip; é€šè¿‡æ”¯æŒä¼—å¤šå…¥å£å’Œ L7/L4 æµé‡è·¯ç”±ä½¿ç”¨æ¡ˆä¾‹çš„è¡¨è¾¾å¼ã€å¯æ‰©å±•ã€é¢å‘è§’è‰²çš„ APIï¼Œé™ä½é‡‡ç”¨éšœç¢ï¼Œå¸å¼•æ›´å¤šç”¨æˆ·ä½¿ç”¨ Envoyï¼›å¹¶ä¸ºä¾›åº”å•†å»ºç«‹å¢å€¼äº§å“æä¾›å…±åŒåŸºç¡€ï¼Œè€Œæ— éœ€é‡æ–°è®¾è®¡åŸºæœ¬äº¤äº’ã€‚&amp;rdquo;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;æ˜“ç”¨æ€§å’Œè¿è¥æ•ˆç‡&#34;&gt;æ˜“ç”¨æ€§å’Œè¿è¥æ•ˆç‡&lt;/h3&gt;
&lt;p&gt;Envoy Proxy æ˜¯ç”± &lt;a href=&#34;https://github.com/cncf/xds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS API&lt;/a&gt; é©±åŠ¨çš„ï¼Œè¿™äº› APIs æš´éœ²äº†å¤§é‡çš„åŠŸèƒ½ï¼Œå¹¶è¢«æ§åˆ¶å¹³é¢å¹¿æ³›é‡‡ç”¨ã€‚è™½ç„¶è¿™äº› API åŠŸèƒ½ä¸°å¯Œï¼Œä½†å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œè¦å¿«é€Ÿå­¦ä¹ å¹¶å¼€å§‹åˆ©ç”¨ Envoy çš„åŠŸèƒ½æ˜¯éå¸¸å›°éš¾çš„ã€‚Envoy Gateway å°†ä¸ºç”¨æˆ·æŠ½è±¡å‡ºè¿™äº›å¤æ‚çš„åŠŸèƒ½ï¼ŒåŒæ—¶æ”¯æŒç°æœ‰çš„è¿è¥å’Œåº”ç”¨ç®¡ç†æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;Envoy Gateway å°†åˆ©ç”¨ &lt;a href=&#34;https://gateway-api.sigs.k8s.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway API&lt;/a&gt; æ¥å®ç°è¿™äº›ç›®æ ‡ï¼Œè€Œä¸æ˜¯å¼€å‘ä¸€ä¸ªæ–°çš„é¡¹ç›®ä¸“ç”¨ APIã€‚Gateway API æ˜¯ä¸€ä¸ªç”± &lt;a href=&#34;https://github.com/kubernetes/community/tree/master/sig-network&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes ç½‘ç»œç‰¹åˆ«å…´è¶£å°ç»„&lt;/a&gt;ç®¡ç†çš„é¡¹ç›®ï¼Œæ­£åœ¨è¿…é€Ÿæˆä¸ºæä¾›ç”¨æˆ·æ¥å£ä»¥ç®¡ç†åº”ç”¨ç½‘ç»œåŸºç¡€è®¾æ–½å’Œæµé‡è·¯ç”±çš„é¦–é€‰æ–¹æ³•ã€‚è¿™ä¸ªå¼€æºé¡¹ç›®æœ‰ä¸€ä¸ªä¸°å¯Œã€å¤šæ ·çš„ç¤¾åŒºï¼Œæœ‰å‡ ä¸ªçŸ¥åçš„å®æ–½æ–¹æ¡ˆã€‚æˆ‘ä»¬æœŸå¾…ç€ä½œä¸ºç¤¾åŒºçš„ä¸€éƒ¨åˆ†å¼€å±•å·¥ä½œï¼Œä½¿ Envoy Gateway æˆä¸ºä¸šç•Œé¦–é€‰çš„ç½‘å…³ API å®ç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆè¿™æ¯”ä¼ ç»Ÿçš„-api-ç½‘å…³æ›´å¥½&#34;&gt;ä¸ºä»€ä¹ˆè¿™æ¯”ä¼ ç»Ÿçš„ API ç½‘å…³æ›´å¥½ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¼ ç»Ÿçš„ä»£ç†ä¸æ˜¯è½»é‡çº§çš„ã€å¼€æ”¾çš„ï¼Œä¹Ÿä¸æ˜¯åŠ¨æ€å¯ç¼–ç¨‹çš„ã€ç±»ä¼¼ xDS çš„ APIï¼Œå› æ­¤ Envoy å¾ˆé€‚åˆæˆä¸ºå½“ä»ŠåŠ¨æ€åç«¯çš„ API ç½‘å…³ â€”â€” å°¤å…¶æ˜¯åœ¨å¢åŠ å®‰å…¨åŠŸèƒ½çš„æƒ…å†µä¸‹ã€‚æˆ‘ä»¬è®¾æƒ³å°† Envoy ç½‘å…³ä½œä¸ºä¸æ–­å‘å±•çš„ API ç®¡ç†é¢†åŸŸçš„ä¸€ä¸ªå…³é”®ç»„æˆéƒ¨åˆ†ã€‚API ç½‘å…³æ˜¯ API ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ï¼Œæä¾›é€æ˜åœ°ç­–ç•¥æ‰§è¡Œå’Œç”Ÿæˆè¯¦ç»†é¥æµ‹æ•°æ®çš„åŠŸèƒ½ã€‚è¿™ç§é¥æµ‹æŠ€æœ¯æä¾›äº†å¼ºå¤§çš„å¯è§‚æµ‹æ€§ï¼Œä¸ºä¼ä¸šæä¾›äº†æ›´å¥½çš„æ´å¯ŸåŠ›ï¼Œä»¥æ’é™¤æ•…éšœã€ç»´æŠ¤å’Œä¼˜åŒ–å…¶ APIã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çœ‹æ¥ï¼Œç”±äº Envoy çš„è®¾è®¡ã€åŠŸèƒ½è®¾ç½®ã€å®‰è£…åŸºç¡€å’Œç¤¾åŒºï¼Œå®ƒæ˜¯ä¸šå†…æœ€å¥½çš„ API ç½‘å…³ã€‚æœ‰äº† Envoy Gatewayï¼Œä¼ä¸šå¯ä»¥åœ¨å°† Envoy åµŒå…¥å…¶ API ç®¡ç†ç­–ç•¥æ–¹é¢å¢åŠ ä¿¡å¿ƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ— è¾¹ç•Œçš„é›¶ä¿¡ä»»&#34;&gt;æ— è¾¹ç•Œçš„é›¶ä¿¡ä»»&lt;/h3&gt;
&lt;p&gt;å½“ä½ çš„æ‰€æœ‰åº”ç”¨æœåŠ¡éƒ½åœ¨ä¸€ä¸ªæœåŠ¡ç½‘æ ¼ä¸­è¿è¡Œæ—¶ï¼Œå®ç°&lt;a href=&#34;https://www.tetrate.io/zero-trust/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›¶ä¿¡ä»»æ¶æ„&lt;/a&gt;å°±ä¸é‚£ä¹ˆéš¾äº†ã€‚ç„¶è€Œï¼Œç°å®ä¸­ä¸éƒ½æ˜¯æœåŠ¡ç½‘æ ¼ã€‚æœåŠ¡åœ¨è™šæ‹Ÿæœºä¸Šè¿è¡Œï¼Œåœ¨æ— ä»£ç†å®¹å™¨ä¸­è¿è¡Œï¼Œä½œä¸ºæ— æœåŠ¡å™¨å‡½æ•°è¿è¡Œï¼Œç­‰ç­‰ã€‚Envoy Gateway å°†çªç ´è¿™äº›è¿è¡Œæ—¶çš„ç•Œé™ï¼Œä¸ºè·¨å¼‚æ„ç¯å¢ƒçš„ç»Ÿä¸€ç­–ç•¥æ‰§è¡Œæä¾›åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸€åŸºç¡€çš„å…³é”®æ˜¯ Envoy Gateway çš„å¯æ‰©å±•æ€§ï¼Œå®ƒæä¾›äº†æš´éœ² Envoy å’Œé Envoy å®‰å…¨åŠŸèƒ½çš„çµæ´»æ€§ã€‚è¿™äº›æ‰©å±•ç‚¹å°†è¢«ç”¨æ¥æä¾›å®ç°é›¶ä¿¡ä»»æ¶æ„æ‰€éœ€çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç”¨æˆ·å’Œåº”ç”¨è®¤è¯ã€æˆæƒã€åŠ å¯†å’Œé€Ÿç‡é™åˆ¶ã€‚Envoy Gateway å°†å¾ˆå¿«æˆä¸ºå¯»æ±‚å®ç°é›¶ä¿¡ä»»æ¶æ„çš„ç»„ç»‡çš„ä¸€ä¸ªå…³é”®ç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ ·ï¼ŒTetrate è‡´åŠ›äºä¸Šæ¸¸é¡¹ç›®å’Œå®ƒä»¬çš„é•¿æœŸå¯è¡Œæ€§ã€‚è¿™ä¸€ä¸¾æªåˆä¸€æ¬¡è¯æ˜äº†è¿™ä¸€ç‚¹ï¼Œå¹¶è¡¨æ˜ä¸Šæ¸¸çš„ Envoy å’Œ Istio ç°åœ¨æ­£æˆä¸ºæ„å»ºæœåŠ¡ç½‘æ ¼çš„äº‹å®ä¸Šçš„æ”¯æŸ±ã€‚Envoy Gateway å°†ä½¿æœåŠ¡ç½‘æ ¼æˆä¸ºä¸»æµï¼Œæ¶æ„å¸ˆä»¬åº”è¯¥æŠŠç½‘æ ¼çœ‹ä½œæ˜¯ ZTA çš„åŸºç¡€ã€‚ä¸ºäº†å¸®åŠ©æ¶æ„å¸ˆè¿›è¡Œè®ºè¯ï¼Œæˆ‘ä»¬æœ€è¿‘å‡ºç‰ˆäº†ã€Š&lt;a href=&#34;https://www.tetrate.io/service-mesh-handbook/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼æ‰‹å†Œ&lt;/a&gt;ã€‹ã€‚æˆ‘ä»¬å¾ˆå¿«å°±ä¼šå‘å¸ƒä¸€ç§å¸¦æœ‰ä¸Šæ¸¸ Envoy Gateway å’Œ Istio çš„æ¶æ„æ–¹æ³•ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä½ çš„åº”ç”¨ç½‘ç»œçš„åŸºç¡€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¢ç´¢-envoy-gateway&#34;&gt;æ¢ç´¢ Envoy Gateway&lt;/h3&gt;
&lt;p&gt;åœ¨ Tetrateï¼Œæˆ‘ä»¬æ­£åœ¨é¢†å¯¼åŸºäº Envoy Gateway å’Œ Istio çš„é›¶ä¿¡ä»»æ¶æ„çš„å®šä¹‰ï¼Œå¹¶å°†åœ¨åç»­åšæ–‡ä¸­é˜è¿°è®¾æƒ³çš„æ¶æ„ã€‚å¦‚æœä½ æƒ³å’Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºæ¶æ„ï¼Œå¹¶äº†è§£æ›´å¤šå…³äºå¦‚ä½•ä¸ºä¼ ç»Ÿå’Œäº‘åŸç”Ÿåº”ç”¨ç¨‹åºè¿›è¡Œæ¶æ„ï¼Œè¯·åŠ å…¥ &lt;a href=&#34;http://tetrate-community.slack.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tetrate-community&lt;/a&gt; Slack é¢‘é“ã€‚&lt;/p&gt;
&lt;p&gt;è¦äº†è§£æ›´å¤šå…³äº Tetrate çš„ä¿¡æ¯ï¼Œè¯·è®¿é—® &lt;a href=&#34;https://www.tetrate.io/envoy-gateway/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tetrate.io&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å¼€æºé¡¹ç›® Envoy Gateway ç®€ä»‹</title>
      <link>https://cloudnative.to/blog/introducing-envoy-gateway/</link>
      <pubDate>Mon, 16 May 2022 13:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/introducing-envoy-gateway/</guid>
      <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ä»Šå¤©ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´åœ°å®£å¸ƒ &lt;a href=&#34;https://github.com/envoyproxy/gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Gateway&lt;/a&gt; æˆä¸º Envoy ä»£ç†å®¶æ—çš„æ–°æˆå‘˜ï¼Œè¯¥é¡¹ç›®æ—¨åœ¨å¤§å¹…é™ä½å°† Envoy ä½œä¸º API ç½‘å…³çš„ä½¿ç”¨é—¨æ§›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å†å²&#34;&gt;å†å²&lt;/h2&gt;
&lt;p&gt;Envoy &lt;a href=&#34;https://medium.com/lyft-engineering/announcing-envoy-c-l7-proxy-and-communication-bus-92520b6c8191&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ 2016 å¹´ç§‹å¤©å¼€æº&lt;/a&gt;ï¼Œä»¤æˆ‘ä»¬æƒŠè®¶çš„æ˜¯ï¼Œå®ƒå¾ˆå¿«å°±å¼•é¢†äº†æ•´ä¸ªè¡Œä¸šã€‚ç”¨æˆ·è¢«è¿™ä¸ªé¡¹ç›®çš„è®¸å¤šä¸åŒæ–¹é¢æ‰€å¸å¼•ï¼ŒåŒ…æ‹¬å®ƒçš„åŒ…å®¹æ€§ç¤¾åŒºã€å¯æ‰©å±•æ€§ã€API é©±åŠ¨çš„é…ç½®æ¨¡å‹ã€å¼ºå¤§çš„å¯è§‚æµ‹æ€§è¾“å‡ºå’Œè¶Šæ¥è¶Šå¹¿æ³›çš„åŠŸèƒ½é›†ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡åœ¨å…¶æ—©æœŸå†å²ä¸­ï¼ŒEnvoy æˆä¸ºäº†&lt;strong&gt;æœåŠ¡ç½‘æ ¼&lt;/strong&gt;çš„ä»£åè¯ï¼Œä½†å®ƒåœ¨ Lyft çš„é¦–æ¬¡ä½¿ç”¨å®é™…ä¸Šæ˜¯ä½œä¸º API ç½‘å…³ / è¾¹ç¼˜ä»£ç†ï¼Œæä¾›æ·±å…¥çš„å¯è§‚æµ‹æ€§è¾“å‡ºï¼Œå¸®åŠ© Lyft ä»å•ä½“æ¶æ„è¿ç§»åˆ°å¾®æœåŠ¡æ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿‡å»çš„ 5 å¹´å¤šæ—¶é—´é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ° Envoy è¢«å¤§é‡çš„ç»ˆç«¯ç”¨æˆ·é‡‡ç”¨ï¼Œæ—¢å¯ä»¥ä½œä¸º API ç½‘å…³ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæœåŠ¡ç½‘æ ¼ä¸­çš„ sidecar ä»£ç†ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°å›´ç»• Envoy å‡ºç°äº†ä¸€ä¸ªåºå¤§çš„ä¾›åº”å•†ç”Ÿæ€ç³»ç»Ÿï¼Œåœ¨å¼€æºå’Œä¸“æœ‰é¢†åŸŸæä¾›äº†å¤§é‡çš„è§£å†³æ–¹æ¡ˆã€‚Envoy çš„ä¾›åº”å•†ç”Ÿæ€ç³»ç»Ÿå¯¹é¡¹ç›®çš„æˆåŠŸè‡³å…³é‡è¦ï¼›å¦‚æœæ²¡æœ‰å¯¹æ‰€æœ‰åœ¨ Envoy ä¸Šå…¼èŒæˆ–å…¨èŒå·¥ä½œçš„å‘˜å·¥çš„èµ„åŠ©ï¼Œè¿™ä¸ªé¡¹ç›®è‚¯å®šä¸ä¼šæœ‰ä»Šå¤©çš„æˆå°±ã€‚&lt;/p&gt;
&lt;p&gt;Envoy ä½œä¸ºè®¸å¤šä¸åŒçš„æ¶æ„ç±»å‹å’Œä¾›åº”å•†è§£å†³æ–¹æ¡ˆçš„ç»„æˆéƒ¨åˆ†ï¼Œå…¶æˆåŠŸçš„å¦ä¸€é¢æ˜¯å®ƒæœ¬è´¨ä¸Šä½äºæ¶æ„åº•å±‚ï¼›Envoy å¹¶ä¸æ˜¯ä¸€ä¸ªå®¹æ˜“å­¦ä¹ çš„è½¯ä»¶ã€‚è™½ç„¶è¯¥é¡¹ç›®åœ¨ä¸–ç•Œå„åœ°çš„å¤§å‹å·¥ç¨‹ç»„ç»‡ä¸­å–å¾—äº†å·¨å¤§çš„æˆåŠŸï¼Œä½†åœ¨è¾ƒå°å’Œè¾ƒç®€å•çš„ç”¨ä¾‹ä¸­ï¼Œå®ƒåªè¢«è½»åº¦é‡‡ç”¨ï¼Œåœ¨è¿™äº›ç”¨ä¾‹ä¸­ï¼Œ&lt;a href=&#34;https://nginx.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;nginx&lt;/a&gt; å’Œ &lt;a href=&#34;http://www.haproxy.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HAProxy&lt;/a&gt; ä»å ä¸»å¯¼åœ°ä½ã€‚&lt;/p&gt;
&lt;p&gt;Envoy Gateway é¡¹ç›®çš„è¯ç”Ÿæ˜¯å‡ºäºè¿™æ ·çš„ä¿¡å¿µï¼šå°† Envoy ä½œä¸º API ç½‘å…³çš„è§’è‰²æ¨å‘å¤§ä¼—éœ€è¦ä¸¤ä¸ªä¸»è¦æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªç®€åŒ–çš„éƒ¨ç½²æ¨¡å‹å’Œ API å±‚ï¼Œæ—¨åœ¨æ»¡è¶³è½»é‡çº§ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;å°†ç°æœ‰çš„ &lt;a href=&#34;https://www.cncf.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNCF&lt;/a&gt; API ç½‘å…³é¡¹ç›®ï¼ˆ&lt;a href=&#34;https://projectcontour.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Contour&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/emissary-ingress/emissary&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Emissary&lt;/a&gt;ï¼‰åˆå¹¶ä¸ºä¸€ä¸ªå…±åŒçš„æ ¸ï¼Œå¯ä»¥æä¾›æœ€å¥½çš„ç”¨æˆ·ä½“éªŒï¼ŒåŒæ—¶ä»ç„¶å…è®¸ä¾›åº”å•†åœ¨ Envoy Proxy å’Œ Envoy Gateway çš„åŸºç¡€ä¸Šå»ºç«‹å¢å€¼è§£å†³æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬åšä¿¡ï¼Œå¦‚æœç¤¾åŒºæ±‡èšåœ¨å•ä¸€çš„ä»¥ Envoy ä¸ºæ ¸å¿ƒçš„ API ç½‘å…³å‘¨å›´ï¼Œå®ƒå°†ä¼šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘å›´ç»•å®‰å…¨ã€æ§åˆ¶å¹³é¢æŠ€æœ¯ç»†èŠ‚å’Œå…¶ä»–å…±åŒå…³åˆ‡çš„é‡å¤å·¥ä½œã€‚&lt;/li&gt;
&lt;li&gt;å…è®¸ä¾›åº”å•†ä¸“æ³¨äºåœ¨ Envoy Proxy å’Œ Envoy Gateway çš„åŸºç¡€ä¸Šä»¥æ‰©å±•ã€ç®¡ç†å¹³é¢ UI ç­‰å½¢å¼åˆ†å±‚æä¾›å¢å€¼åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ä¼—äººæ‹¾æŸ´ç«ç„°é«˜ï¼Œè®©å…¨ä¸–ç•Œæ›´å¤šçš„ç”¨æˆ·äº«å—åˆ° Envoy çš„å¥½å¤„ï¼Œæ— è®ºç»„ç»‡çš„å¤§å°ã€‚æ›´å¤šçš„ç”¨æˆ·ä¸ºæ›´å¤šçš„æ½œåœ¨å®¢æˆ·æä¾›äº†è‰¯æ€§å¾ªç¯ï¼Œä¸º Envoy çš„æ ¸å¿ƒé¡¹ç›®æä¾›äº†æ›´å¤šçš„æ”¯æŒï¼Œä¹Ÿä¸ºæ‰€æœ‰äººæä¾›äº†æ›´å¥½çš„æ•´ä½“ä½“éªŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é¡¹ç›®æ¦‚è¦&#34;&gt;é¡¹ç›®æ¦‚è¦&lt;/h2&gt;
&lt;p&gt;æ€»å¾—æ¥è¯´ï¼ŒEnvoy Gateway å¯ä»¥è¢«è®¤ä¸ºæ˜¯ Envoy Proxy æ ¸å¿ƒçš„ä¸€ä¸ªå°è£…å™¨ã€‚å®ƒä¸ä¼šä»¥ä»»ä½•æ–¹å¼æ”¹å˜æ ¸å¿ƒä»£ç†ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-docs/xds_protocol&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/envoyproxy/go-control-plane&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;go-control-plane&lt;/a&gt; ç­‰ï¼ˆé™¤äº†æ½œåœ¨çš„é©±åŠ¨åŠŸèƒ½ã€bug ä¿®å¤å’Œä¸€èˆ¬æ”¹è¿›ä»¥å¤–ï¼‰ã€‚å®ƒå°†æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºç½‘å…³ç”¨ä¾‹æä¾›ç®€åŒ–çš„ APIã€‚è¯¥ API å°†æ˜¯å¸¦æœ‰ä¸€äº› Envoy ç‰¹å®šæ‰©å±•çš„ &lt;a href=&#34;https://gateway-api.sigs.k8s.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Gateway API&lt;/a&gt;ã€‚ä¹‹æ‰€ä»¥é€‰æ‹©è¿™ä¸ª APIï¼Œæ˜¯å› ä¸ºåœ¨ Kubernetes ä¸Šä½œä¸º Ingress Controller éƒ¨ç½²æ˜¯è¯¥é¡¹ç›®æœ€åˆçš„é‡ç‚¹ï¼Œè€Œä¸”è¯¥ API å¾—åˆ°äº†ä¸šç•Œçš„å¹¿æ³›è®¤å¯ã€‚&lt;/li&gt;
&lt;li&gt;å¼€ç®±å³ç”¨ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿå°½å¯èƒ½å¿«åœ°å¯åŠ¨å’Œè¿è¡Œã€‚è¿™åŒ…æ‹¬æä¾›æ§åˆ¶å™¨èµ„æºã€æ§åˆ¶å¹³é¢èµ„æºã€ä»£ç†å®ä¾‹ç­‰çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;å¯æ‰©å±•çš„ API å¹³é¢ã€‚è™½ç„¶è¯¥é¡¹ç›®å°†è‡´åŠ›äºä½¿å¸¸è§çš„ API ç½‘å…³åŠŸèƒ½å¼€ç®±å³ç”¨ï¼ˆä¾‹å¦‚ï¼Œé€Ÿç‡é™åˆ¶ã€è®¤è¯ã€&lt;a href=&#34;https://letsencrypt.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Letâ€™s Encrypt&lt;/a&gt; é›†æˆç­‰ï¼‰ï¼Œä½†ä¾›åº”å•†å°†èƒ½å¤Ÿæä¾›æ‰€æœ‰ API çš„ SaaS ç‰ˆæœ¬ï¼Œæä¾›é¢å¤–çš„ API å’Œå¢å€¼åŠŸèƒ½ï¼Œå¦‚ WAFã€å¢å¼ºçš„å¯è§‚æµ‹æ€§ã€æ··ä¹±å·¥ç¨‹ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;é«˜è´¨é‡çš„æ–‡æ¡£å’Œå…¥é—¨æŒ‡å—ã€‚æˆ‘ä»¬å¯¹ Envoy Gateway çš„ä¸»è¦ç›®æ ‡æ˜¯ä½¿æœ€å¸¸è§çš„ç½‘å…³ç”¨ä¾‹å¯¹æ™®é€šç”¨æˆ·æ¥è¯´å¯ä»¥ä¿¡æ‰‹æ‹ˆæ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äº APIï¼Œæˆ‘ä»¬è®¤ä¸ºå¯¼è‡´æ··ä¹±çš„ä¸»è¦æ˜¯åœ¨é’ˆå¯¹é«˜çº§ç”¨ä¾‹æ—¶ï¼Œåœ¨å…¶ä»–é¡¹ç›®ä¸­æœ‰æ•ˆåœ°é‡æ–°å®ç° Envoy çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-docs/xds_protocol&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS&lt;/a&gt; APIã€‚è¿™ç§æ¨¡å¼å¯¼è‡´ç”¨æˆ·ä¸å¾—ä¸å­¦ä¹ å¤šä¸ªå¤æ‚çš„ APIï¼ˆæœ€ç»ˆè½¬åŒ–ä¸º xDSï¼‰ï¼Œæ‰èƒ½å®Œæˆå·¥ä½œã€‚å› æ­¤ï¼ŒEnvoy Gateway è‡´åŠ›äº &amp;ldquo;ç¡¬æ€§è§„å®š&amp;rdquo;ï¼Œå³ Kubernetes Gateway APIï¼ˆä»¥åŠè¯¥ API ä¸­ä»»ä½•å…è®¸çš„æ‰©å±•ï¼‰æ˜¯&lt;strong&gt;å”¯ä¸€&lt;/strong&gt;è¢«æ”¯æŒçš„é¢å¤– APIã€‚æ›´é«˜çº§çš„ç”¨ä¾‹å°†ç”± &amp;ldquo;xDS æ¨¡å¼&amp;rdquo; æä¾›æœåŠ¡ï¼Œå…¶ä¸­ç°æœ‰çš„ API èµ„æºå°†ä¸ºæœ€ç»ˆç”¨æˆ·è‡ªåŠ¨ç¿»è¯‘ï¼Œç„¶åä»–ä»¬å¯ä»¥åˆ‡æ¢åˆ°ç›´æ¥åˆ©ç”¨ xDS APIã€‚è¿™å°†å¯¼è‡´ä¸€ä¸ªæ›´æ¸…æ™°çš„ä¸» APIï¼ŒåŒæ—¶ä¸ºé‚£äº›å¯èƒ½è¶…è¶Šä¸» API çš„è¡¨è¾¾èƒ½åŠ›å¹¶å¸Œæœ›é€šè¿‡ xDS åˆ©ç”¨ Envoy çš„å…¨éƒ¨åŠŸèƒ½çš„ç»„ç»‡æä¾›äº†è·¯å¾„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äº-api-çš„æ ‡å‡†åŒ–&#34;&gt;å…³äº API çš„æ ‡å‡†åŒ–&lt;/h2&gt;
&lt;p&gt;è™½ç„¶ Envoy Gateway çš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªå‚è€ƒå®ç°ï¼Œä»¥ä¾¿åœ¨ Kubernetes ä¸­ä½œä¸º Ingress Controller è½»æ¾è¿è¡Œ Envoyï¼Œä½†è¿™é¡¹å·¥ä½œæœ€ä¸»è¦çš„ç›®çš„æ˜¯ &lt;strong&gt;API æ ‡å‡†åŒ–&lt;/strong&gt;ã€‚éšç€è¡Œä¸šåœ¨ç‰¹å®šçš„ Envoy Kubernetes Gateway API æ‰©å±•ä¸Šçš„è¶‹åŒï¼Œå®ƒå°†å…è®¸ä¾›åº”å•†è½»æ¾åœ°æä¾›æ›¿ä»£çš„ SaaS å®ç°ï¼Œå¦‚æœç”¨æˆ·è¶…è¶Šäº†å‚è€ƒå®ç°ï¼Œæƒ³è¦é¢å¤–çš„æ”¯æŒå’ŒåŠŸèƒ½ç­‰ï¼Œè¿™å¯èƒ½æ˜¯æœ€å¥½çš„ã€‚æ˜¾ç„¶ï¼Œå›´ç»•å®šä¹‰ API æ‰©å±•ï¼Œç¡®å®šå“ªäº› API æ˜¯å¿…éœ€çš„ï¼Œå“ªäº›æ˜¯å¯é€‰çš„ï¼Œç­‰ç­‰ï¼Œè¿˜æœ‰å¾ˆå¤šå·¥ä½œè¦åšã€‚è¿™æ˜¯æˆ‘ä»¬æ ‡å‡†åŒ–ä¹‹æ—…çš„å¼€å§‹ï¼Œæˆ‘ä»¬æ¸´æœ›ä¸æ‰€æœ‰æ„Ÿå…´è¶£çš„äººä¸€èµ·æ·±å…¥ç ”ç©¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¥ä¸‹æ¥çš„è®¡åˆ’&#34;&gt;æ¥ä¸‹æ¥çš„è®¡åˆ’&lt;/h2&gt;
&lt;p&gt;ä»Šå¤©ï¼Œæˆ‘ä»¬æ„Ÿè°¢ Envoy Gateway çš„æœ€åˆèµåŠ©å•†ï¼ˆ&lt;a href=&#34;https://www.getambassador.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambassador Labs&lt;/a&gt;ã€&lt;a href=&#34;https://www.fidelity.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fidelity&lt;/a&gt;ã€&lt;a href=&#34;https://www.tetrate.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.vmware.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VMware&lt;/a&gt;ï¼‰ï¼Œå¾ˆé«˜å…´èƒ½ä¸å¤§å®¶ä¸€èµ·å¼€å§‹è¿™ä¸ªæ–°çš„æ—…ç¨‹ã€‚è¯¥é¡¹ç›®æ˜¯éå¸¸æ—©æœŸçš„ï¼Œåˆ°ç›®å‰ä¸ºæ­¢çš„é‡ç‚¹æ˜¯å•†å®š &lt;a href=&#34;https://github.com/envoyproxy/gateway/blob/main/GOALS.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç›®æ ‡&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/envoyproxy/gateway/blob/main/docs/design/SYSTEM_DESIGN.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é«˜æ°´å¹³çš„è®¾è®¡&lt;/a&gt;ï¼Œæ‰€ä»¥ç°åœ¨æ˜¯å‚ä¸çš„å¥½æ—¶æœºï¼Œæ— è®ºæ˜¯ä½œä¸ºç»ˆç«¯ç”¨æˆ·è¿˜æ˜¯ä½œä¸ºç³»ç»Ÿé›†æˆå•†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜æƒ³éå¸¸æ¸…æ¥šåœ°è¯´æ˜ï¼ŒContour å’Œ Emissary çš„ç°æœ‰ç”¨æˆ·ä¸ä¼šè¢«æŠ›åœ¨åé¢ã€‚è¯¥é¡¹ç›®ï¼ˆä»¥åŠ &lt;a href=&#34;https://www.vmware.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VMware&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.getambassador.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambassador Labs&lt;/a&gt;ï¼‰å®Œå…¨è‡´åŠ›äºç¡®ä¿è¿™äº›é¡¹ç›®çš„ç”¨æˆ·æœ€ç»ˆèƒ½å¤Ÿé¡ºåˆ©åœ°è¿ç§»åˆ° Envoy Gatewayï¼Œæ— è®ºæ˜¯é€šè¿‡ç¿»è¯‘å’Œæ›¿æ¢ï¼Œè¿˜æ˜¯é€šè¿‡è¿™äº›é¡¹ç›®æˆä¸º Envoy Gateway æ ¸å¿ƒçš„åŒ…è£…ç‰©ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯¹é€šè¿‡ Envoy Gateway é¡¹ç›®å°† Envoy å¸¦ç»™æ›´å¤§çš„ç”¨æˆ·ç¾¤æ„Ÿåˆ°éå¸¸å…´å¥‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä½ èƒ½&lt;a href=&#34;https://github.com/envoyproxy/gateway#contact&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ å…¥æˆ‘ä»¬&lt;/a&gt;çš„æ—…ç¨‹ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ WebAssembly éªŒè¯è¯·æ±‚è´Ÿè½½</title>
      <link>https://cloudnative.to/blog/validating-a-request-payload-with-wasm/</link>
      <pubDate>Fri, 13 May 2022 13:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/validating-a-request-payload-with-wasm/</guid>
      <description>&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-wasm-æ’ä»¶&#34;&gt;ä»€ä¹ˆæ˜¯ Wasm æ’ä»¶ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ Wasm æ’ä»¶åœ¨æ•°æ®è·¯å¾„ä¸Šæ·»åŠ è‡ªå®šä¹‰ä»£ç ï¼Œè½»æ¾åœ°æ‰©å±•æœåŠ¡ç½‘æ ¼çš„åŠŸèƒ½ã€‚å¯ä»¥ç”¨ä½ é€‰æ‹©çš„è¯­è¨€ç¼–å†™æ’ä»¶ã€‚ç›®å‰ï¼Œæœ‰ AssemblyScriptï¼ˆTypeScript-ishï¼‰ã€C++ã€Rustã€Zig å’Œ Go è¯­è¨€çš„ Proxy-Wasm SDKã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬æè¿°äº†å¦‚ä½•ä½¿ç”¨ Wasm æ’ä»¶æ¥éªŒè¯ä¸€ä¸ªè¯·æ±‚çš„æœ‰æ•ˆè½½è·ã€‚è¿™æ˜¯ Wasm ä¸ Istio çš„ä¸€ä¸ªé‡è¦ç”¨ä¾‹ï¼Œä¹Ÿæ˜¯ä½ å¯ä»¥ä½¿ç”¨ Wasm æ‰©å±• Istio çš„è®¸å¤šæ–¹æ³•çš„ä¸€ä¸ªä¾‹å­ã€‚æ‚¨å¯èƒ½æœ‰å…´è¶£é˜…è¯»æˆ‘ä»¬å…³äº&lt;a href=&#34;https://www.tetrate.io/blog/category/wasm/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ Istio ä¸­ä½¿ç”¨ Wasm çš„åšæ–‡&lt;/a&gt;ï¼Œå¹¶è§‚çœ‹æˆ‘ä»¬å…³äºåœ¨ Istio å’Œ Envoy ä¸­ä½¿ç”¨ Wasm çš„å…è´¹ç ”è®¨ä¼šçš„å½•éŸ³ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½•æ—¶ä½¿ç”¨-wasm-æ’ä»¶&#34;&gt;ä½•æ—¶ä½¿ç”¨ Wasm æ’ä»¶ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å½“ä½ éœ€è¦æ·»åŠ  Envoy æˆ– Istio ä¸æ”¯æŒçš„è‡ªå®šä¹‰åŠŸèƒ½æ—¶ï¼Œä½ åº”è¯¥ä½¿ç”¨ Wasm æ’ä»¶ã€‚ä½¿ç”¨ Wasm æ’ä»¶æ¥æ·»åŠ è‡ªå®šä¹‰éªŒè¯ã€è®¤è¯ã€æ—¥å¿—æˆ–ç®¡ç†é…é¢ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºå’Œè¿è¡Œä¸€ä¸ª Wasm æ’ä»¶ï¼ŒéªŒè¯è¯·æ±‚ body æ˜¯ JSONï¼Œå¹¶åŒ…å«ä¸¤ä¸ªå¿…è¦çš„é”® â€”â€”&lt;code&gt;id&lt;/code&gt; å’Œ &lt;code&gt;token&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼–å†™-wasm-æ’ä»¶&#34;&gt;ç¼–å†™ Wasm æ’ä»¶&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªç¤ºä¾‹ä½¿ç”¨ &lt;a href=&#34;https://tinygo.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tinygo&lt;/a&gt; æ¥ç¼–è¯‘æˆ Wasmã€‚ç¡®ä¿ä½ å·²ç»å®‰è£…äº† &lt;a href=&#34;https://tinygo.org/getting-started/install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tinygo ç¼–è¯‘å™¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é…ç½®-wasm-ä¸Šä¸‹æ–‡&#34;&gt;é…ç½® Wasm ä¸Šä¸‹æ–‡&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆé…ç½® Wasm ä¸Šä¸‹æ–‡ï¼Œè¿™æ · tinygo æ–‡ä»¶æ‰èƒ½æ“ä½œ HTTP è¯·æ±‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/tetratelabs/proxy-wasm-go-sdk/proxywasm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/tetratelabs/proxy-wasm-go-sdk/proxywasm/types&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/tidwall/gjson&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// SetVMContext æ˜¯é…ç½®æ•´ä¸ª Wasm VM çš„å…¥å£ã€‚è¯·ç¡®ä¿è¯¥å…¥å£åœ¨ main å‡½æ•°ä¸­è°ƒç”¨ï¼Œå¦åˆ™ VM å°†å¯åŠ¨å¤±è´¥ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SetVMContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;vmContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// vmContext å®ç° proxy-wasm-go SDK çš„ types.VMContext æ¥å£ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;vmContext&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// åœ¨è¿™é‡ŒåµŒå…¥é»˜è®¤çš„è™šæ‹Ÿæœºç¯å¢ƒï¼Œæˆ‘ä»¬ä¸éœ€è¦å®ç°æ‰€æœ‰æ–¹æ³•ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DefaultVMContext&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å¤å†™ types.DefaultVMContext
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;vmContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewPluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;contextID&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PluginContext&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pluginContext å®ç° proxy-wasm-go SDK çš„ types.PluginContext æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// åœ¨è¿™é‡Œä¾µå…¥é»˜è®¤çš„æ’ä»¶ä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬ä¸éœ€è¦å®ç°æ‰€æœ‰æ–¹æ³•ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DefaultPluginContext&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å¤å†™ types.DefaultPluginContext
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewHttpContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;contextID&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HttpContext&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;payloadValidationContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// payloadValidationContext å®ç° proxy-wasm-go SDK çš„ types.HttpContext æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;payloadValidationContext&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// åœ¨è¿™é‡ŒåµŒå…¥é»˜è®¤çš„æ ¹ http ä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬ä¸éœ€è¦å®ç°æ‰€æœ‰æ–¹æ³•ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DefaultHttpContext&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;totalRequestBodySize&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éªŒè¯è´Ÿè½½&#34;&gt;éªŒè¯è´Ÿè½½&lt;/h3&gt;
&lt;p&gt;å†…å®¹ç±»å‹å¤´æ˜¯é€šè¿‡å®ç° &lt;code&gt;OnHttpRequestHeaders&lt;/code&gt; æ¥éªŒè¯çš„ï¼Œä¸€æ—¦ä»å®¢æˆ·ç«¯æ”¶åˆ°è¯·æ±‚å¤´ï¼Œå°±ä¼šè°ƒç”¨è¯¥å¤´ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;proxywasm.SendHttpResponse&lt;/code&gt; ç”¨äºå“åº” 403 forbidden çš„é”™è¯¯ä»£ç å’Œä¿¡æ¯ï¼Œå¦‚æœå†…å®¹ç±»å‹ä¸¢å¤±çš„è¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;payloadValidationContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;OnHttpRequestHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numHeaders&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;endOfStream&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Action&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;contentType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetHttpRequestHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;content-type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;contentType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// å¦‚æœ header æ²¡æœ‰æœŸæœ›çš„ content typeï¼Œè¿”å› 403 å“åº”
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SendHttpResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;403&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;content-type must be provided&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to send the 403 response: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// ç»ˆæ­¢ ActionPause å¯¹æµé‡çš„è¿›ä¸€æ­¥å¤„ç†
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionPause&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// ActionContinue è®©ä¸»æœºç»§ç»­å¤„ç† body
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionContinue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯·æ±‚ä¸»ä½“æ˜¯é€šè¿‡å®ç° &lt;code&gt;OnHttpRequestBody&lt;/code&gt; æ¥éªŒè¯çš„ï¼Œæ¯æ¬¡ä»å®¢æˆ·ç«¯æ¥æ”¶åˆ°è¯·æ±‚çš„ä¸€ä¸ªå—æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¯¥è¯·æ±‚ã€‚è¿™æ˜¯é€šè¿‡ç­‰å¾…ç›´åˆ° &lt;code&gt;endOfStream&lt;/code&gt; ä¸ºçœŸå¹¶è®°å½•æ‰€æœ‰æ”¶åˆ°çš„å—çš„æ€»å¤§å°æ¥å®Œæˆçš„ã€‚ä¸€æ—¦æ”¶åˆ°æ•´ä¸ªä¸»ä½“ï¼Œå°±ä¼šä½¿ç”¨ &lt;code&gt;proxywasm.GetHttpRequestBody&lt;/code&gt; è¯»å–ï¼Œç„¶åå¯ä»¥ä½¿ç”¨ golang è¿›è¡ŒéªŒè¯ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªä¾‹å­ä½¿ç”¨ &lt;code&gt;gjson&lt;/code&gt;ï¼Œå› ä¸º tinygo ä¸æ”¯æŒ golang çš„é»˜è®¤ JSON åº“ã€‚å®ƒæ£€æŸ¥æœ‰æ•ˆè½½è·æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ JSONï¼Œä»¥åŠé”® &lt;code&gt;id&lt;/code&gt; å’Œ &lt;code&gt;token&lt;/code&gt; æ˜¯å¦å­˜åœ¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;payloadValidationContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;OnHttpRequestBody&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bodySize&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;endOfStream&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Action&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;totalRequestBodySize&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bodySize&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endOfStream&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// OnHttpRequestBody ç­‰å¾…æ”¶åˆ°åˆ° body çš„å…¨éƒ¨æ‰å¼€å§‹å¤„ç†ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionPause&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetHttpRequestBody&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;totalRequestBodySize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to get request body: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionContinue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;validatePayload&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// å¦‚æœéªŒè¯å¤±è´¥ï¼Œå‘é€ 403 å“åº”ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SendHttpResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;403&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;invalid payload&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to send the 403 response: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// ç»ˆæ­¢æµé‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionPause&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionContinue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// validatePayload éªŒè¯ç»™å®šçš„ json è´Ÿè½½
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ³¨æ„è¯¥å‡½æ•°ä½¿ç”¨ gjson è§£æ jsonï¼Œå› ä¸º TinyGo ä¸æ”¯æŒ encoding/json
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;validatePayload&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;gjson&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValidBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;body is not a valid json: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gjson&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ParseBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// éªŒè¯ jsonã€‚æ£€æŸ¥ç¤ºä¾‹ä¸­æ˜¯å¦å­˜åœ¨å¿…é¡»çš„é”®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;token&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;required key (%v) is missing: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç¼–è¯‘æˆ-wasm&#34;&gt;ç¼–è¯‘æˆ Wasm&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ tinygo ç¼–è¯‘å™¨ç¼–è¯‘æˆ Wasmï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tinygo build -o main.wasm -scheduler&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;none -target&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;wasi main.go
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;éƒ¨ç½²-wasm-æ’ä»¶&#34;&gt;éƒ¨ç½² Wasm æ’ä»¶&lt;/h2&gt;
&lt;h3 id=&#34;æ‰“åŒ…åˆ°-docker-ä¸­éƒ¨ç½²åˆ°-envoy&#34;&gt;æ‰“åŒ…åˆ° Docker ä¸­éƒ¨ç½²åˆ° Envoy&lt;/h3&gt;
&lt;p&gt;å¯¹äºå¼€å‘ï¼Œè¿™ä¸ªæ’ä»¶å¯ä»¥åœ¨ Docker ä¸­éƒ¨ç½²åˆ° Envoyã€‚ä¸‹é¢çš„ Envoy é…ç½®æ–‡ä»¶å°†è®¾ç½® Envoy ç›‘å¬ &lt;code&gt;localhost:18000&lt;/code&gt;ï¼Œè¿è¡Œæ‰€æä¾›çš„ Wasm æ’ä»¶ï¼Œå¹¶åœ¨æˆåŠŸåå“åº” HTTP 200 å’Œæ–‡æœ¬ &lt;code&gt;hello from server&lt;/code&gt;ã€‚çªå‡ºæ˜¾ç¤ºçš„éƒ¨åˆ†æ˜¯é…ç½® Wasm æ’ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;static_resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.0.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;18000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.http_connection_manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress_http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;codec_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;auto&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;local_route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;local_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;web_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                 &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.filters.http.wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/udpa.type.v1.TypedStruct&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type_url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.wasm.runtime.v8&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;local&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;./main.wasm&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.filters.http.router&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;staticreply&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;127.0.0.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8099&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.http_connection_manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress_http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;codec_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;auto&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;local_route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;local_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;direct_response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;inline_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;hello from the server\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.filters.http.router&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;web_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;25s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;STATIC&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ROUND_ROBIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;load_assignment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mock_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;endpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;lb_endpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;127.0.0.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8099&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;admin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;access_log_path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/dev/null&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.0.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8001&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œ Docker å®¹å™¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker run --rm -p 18000:18000 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -v &lt;span class=&#34;nv&#34;&gt;$PWD&lt;/span&gt;/envoy.yaml:/envoy.yaml &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -v &lt;span class=&#34;nv&#34;&gt;$PWD&lt;/span&gt;/main.wasm:/main.wasm &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --entrypoint envoy containers.istio.tetratelabs.com/proxyv2:1.9.7-tetrate-v0 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -l debug &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -c /envoy.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡ curl æµ‹è¯•ã€‚é¦–å…ˆï¼Œæ²¡æœ‰è®¾ç½®å†…å®¹ç±»å‹ï¼Œå°†è¿”å› 403ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% curl -i -X POST localhost:18000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;403&lt;/span&gt; Forbidden
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;29&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: text/plain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Sun, &lt;span class=&#34;m&#34;&gt;13&lt;/span&gt; Mar &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt; 22:13:37 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type must be provided
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åï¼Œè¯·æ±‚ body ä¸æ˜¯ JSONï¼ŒåŒæ ·è¿”å› 403ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% curl -i -X POST localhost:18000 -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; --data &lt;span class=&#34;s1&#34;&gt;&amp;#39;not JSON&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;403&lt;/span&gt; Forbidden
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: text/plain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Sun, &lt;span class=&#34;m&#34;&gt;13&lt;/span&gt; Mar &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt; 22:15:53 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;invalid payload
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;JSON è´Ÿè½½ä¸­æ²¡æœ‰ &lt;code&gt;token&lt;/code&gt; å­—æ®µï¼Œè¿˜æ˜¯è¿”å› 403ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% curl -i -X POST localhost:18000 -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; --data &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;id&amp;#34;: &amp;#34;xxx&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;403&lt;/span&gt; Forbidden
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: text/plain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Sun, &lt;span class=&#34;m&#34;&gt;13&lt;/span&gt; Mar &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt; 22:17:18 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;invalid payload
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“ id å’Œ token å­—æ®µéƒ½è¢«æä¾›æ—¶ï¼Œå°†è¿”å›ä¸€ä¸ªæˆåŠŸçš„å“åº”ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% curl -i -X POST localhost:18000 -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; --data &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;id&amp;#34;: &amp;#34;xxx&amp;#34;, &amp;#34;token&amp;#34;: &amp;#34;xxx&amp;#34;, &amp;#34;anotherField&amp;#34;: &amp;#34;yyy&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;22&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: text/plain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Sun, &lt;span class=&#34;m&#34;&gt;13&lt;/span&gt; Mar &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt; 22:18:37 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hello from the server
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;éƒ¨ç½²åˆ°-istio&#34;&gt;éƒ¨ç½²åˆ° Istio&lt;/h2&gt;
&lt;h3 id=&#34;éƒ¨ç½²-istio-å’Œ-httpbin-ç¤ºä¾‹åº”ç”¨&#34;&gt;éƒ¨ç½² Istio å’Œ httpbin ç¤ºä¾‹åº”ç”¨&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ &lt;a href=&#34;https://kind.sigs.k8s.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kind&lt;/a&gt; æ¥åˆ›å»ºæµ‹è¯•é›†ç¾¤ï¼Œå¯¹äºå…¶ä»–æ–¹å¼åˆ›å»ºçš„ Kubernetes é›†ç¾¤åŒæ ·é€‚ç”¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind create cluster
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é›†ç¾¤åˆ›å»ºå®Œæ¯•åï¼Œå®‰è£… Istioï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Istio 1.12.3ï¼Œå®‰è£… &lt;a href=&#34;https://github.com/istio/istio/tree/master/samples/httpbin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio httpbin ç¤ºä¾‹åº”ç”¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl install --set &lt;span class=&#34;nv&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;demo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace default istio-injection&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;enabled
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.12/samples/httpbin/httpbin.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.12/samples/httpbin/httpbin-gateway.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­ï¼Œå°† Ingress ç½‘å…³çš„ 80 ç«¯å£è½¬å‘åˆ°ä½ æœ¬åœ°æœºå™¨çš„ 8080 ç«¯å£ä¸Šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl port-forward -n istio-system svc/istio-ingressgateway 8080:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‘é€ curl è¯·æ±‚ï¼Œæ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ï¼Œä½ åº”è¯¥åº”è¯¥çœ‹åˆ°æˆåŠŸçš„å“åº”ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -X POST -i http://localhost:8080/post
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰ä¸¤ç§æ–¹å¼åœ¨ Istio ä¸­å®‰è£… Wasm æ¨¡å—ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹äº Istio 1.12 å’Œæ›´æ–°ç‰ˆæœ¬çš„ Istioï¼Œæ”¯æŒ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/proxy_extensions/wasm-plugin/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WasmPlugin&lt;/a&gt; èµ„æº&lt;/li&gt;
&lt;li&gt;å¯¹äºè€ç‰ˆæœ¬çš„ Istioï¼Œå¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/envoy-filter/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EnvoyFilter&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;ä½¿ç”¨-wasmplugin-å®‰è£…&#34;&gt;ä½¿ç”¨ WasmPlugin å®‰è£…&lt;/h3&gt;
&lt;p&gt;WasmPlugin èµ„æºä»é•œåƒä»“åº“ä¸­æå– wasm æ¨¡å—ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬é¦–å…ˆä¸ºæˆ‘ä»¬çš„ wasm æ¨¡å—æ„å»ºå¹¶æ¨é€ä¸€ä¸ª Docker é•œåƒã€‚ä¸‹é¢çš„ Docker æ–‡ä»¶å…è®¸ä»ä½ çš„ wasm æ¨¡å—å»ºç«‹ä¸€ä¸ª Docker é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Docker&#34; data-lang=&#34;Docker&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; scratch&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; main.wasm ./&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ„å»ºé•œåƒï¼Œæ¨é€åˆ°é•œåƒä»“åº“ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;HUB&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;your_registry &lt;span class=&#34;c1&#34;&gt;# e.g. docker.io/tetrate&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker build . -t &lt;span class=&#34;nv&#34;&gt;$HUB&lt;/span&gt;/json-validation:v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker push &lt;span class=&#34;nv&#34;&gt;$HUB&lt;/span&gt;/json-validation:v1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬åˆ›å»º &lt;a href=&#34;https://istio.io/latest/docs/reference/config/proxy_extensions/wasm-plugin/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WasmPlugin&lt;/a&gt; èµ„æºã€‚è¿™å°†é€‚ç”¨äºæ‰€æœ‰é€šè¿‡ Istio Ingress ç½‘å…³æš´éœ²çš„è·¯ç”±ï¼Œå¹¶å¯¹å…¶åº”ç”¨æˆ‘ä»¬çš„éªŒè¯ã€‚ç¡®ä¿ä½ æŠŠ &lt;code&gt;{your_registry}&lt;/code&gt; æ›¿æ¢ä¸ºä½ ä¸Šä¼  wasm é•œåƒçš„é•œåƒä»“åº“ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;WasmPlugin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;json-validation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;oci://{your_registry}/json-validation:v3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;phase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AUTHN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä½¿ç”¨-envoyfilter-å®‰è£…&#34;&gt;ä½¿ç”¨ EnvoyFilter å®‰è£…&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†ä½¿ç”¨ EnvoyFilterï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…å«å·²ç¼–è¯‘çš„ Wasm æ’ä»¶çš„ ConfigMapï¼Œå°† ConfigMap æŒ‚è½½åˆ°ç½‘å…³ pod ä¸­ï¼Œç„¶åé€šè¿‡ EnvoyFilter é…ç½® Envoyï¼Œä»æœ¬åœ°æ–‡ä»¶åŠ è½½ Wasm æ’ä»¶ã€‚è¿™ç§æ–¹æ³•çš„é™åˆ¶æ˜¯ï¼Œæ›´å¤§å’Œæ›´å¤æ‚çš„ Wasm æ¨¡å—å¯èƒ½è¶…å‡º ConfigMap 1MB çš„å¤§å°é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«ç¼–è¯‘å¥½çš„ Wasm æ¨¡å—çš„ ConfigMapï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system create configmap wasm-plugins --from-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;main.wasm
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶ååœ¨ Istio Ingress ç½‘å…³éƒ¨ç½²ä¸­æ‰“è¡¥ä¸ï¼ŒæŒ‚è½½è¿™ä¸ª ConfigMapã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system patch deployment istio-ingressgateway --patch&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  template:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;    spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;      containers:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;        - name: istio-proxy
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;          volumeMounts:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;            - name: wasm-plugins
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;              mountPath: /var/local/lib/wasm-plugins
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;              readOnly: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;      volumes:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;        - name: wasm-plugins
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;          configMap:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;            name: wasm-plugins&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ Wasm æ¨¡å—å°±æŒ‚è½½åˆ°äº†ç½‘å…³ Pod ä¸­ï¼Œåº”ç”¨è¿™ä¸ª EnvoyFilterã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EnvoyFilter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;json-validation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configPatches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;applyTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP_FILTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;GATEWAY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;INSERT_BEFORE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;json-validation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#39;@type&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;local&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/var/local/lib/wasm-plugins/main.wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.wasm.runtime.v8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vm_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;json-validation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æµ‹è¯•-wasm-æ’ä»¶&#34;&gt;æµ‹è¯• Wasm æ’ä»¶&lt;/h3&gt;
&lt;p&gt;é‡å¤ä¹‹å‰çš„ curl è¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% curl -X POST -i http://localhost:8080/post
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;403&lt;/span&gt; Forbidden
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;29&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: text/plain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Tue, &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt; Mar &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt; 22:04:35 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: istio-envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type must be provided
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæä¾›äº†å†…å®¹ç±»å‹å’Œ json è´Ÿè½½çš„è¯ï¼Œè¯·æ±‚å°†ä¼šæˆåŠŸã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -i http://localhost:8080/post  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; --data &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;id&amp;#34;: &amp;#34;xxx&amp;#34;, &amp;#34;token&amp;#34;: &amp;#34;xxx&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;è®©å¿…å¡«å­—æ®µå¯é…ç½®&#34;&gt;è®©å¿…å¡«å­—æ®µå¯é…ç½®&lt;/h2&gt;
&lt;p&gt;ä¸å…¶åœ¨ç¼–è¯‘çš„ golang ä»£ç ä¸­ç¡¬ç¼–ç æ‰€éœ€çš„ JSON å­—æ®µï¼Œä¸å¦‚å…è®¸é€šè¿‡ Envoy é…ç½®æ¥é…ç½®è¿™äº›å­—æ®µã€‚&lt;/p&gt;
&lt;p&gt;å½“åœ¨ Docker ä¸­è¿è¡Œ Envoy æ—¶ï¼Œå¯ä»¥é€šè¿‡å‘ä¹‹å‰åˆ›å»ºçš„ Wasm &lt;code&gt;http_filter&lt;/code&gt; æ·»åŠ é…ç½®æ¥å®ç°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.filters.http.wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/udpa.type.v1.TypedStruct&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type_url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configuration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/google.protobuf.StringValue&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                                                            &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                                            &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;requiredKeys&amp;#34;: &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;token&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.wasm.runtime.v8&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;local&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;./main.wasm&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“ä½¿ç”¨ WasmPluginï¼Œåœ¨ &lt;code&gt;pluginConfig&lt;/code&gt; å­—æ®µä¸­é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;WasmPlugin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;json-validation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;oci://{your_registry}/json-validation:v3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;phase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AUTHN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;pluginConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requiredKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;token&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åï¼Œå½“ä½¿ç”¨ EnvoyFilter æ—¶ï¼Œå°†å®ƒæ·»åŠ åˆ° filter é…ç½®ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;json-validation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#39;@type&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configuration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/google.protobuf.StringValue&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                                &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;requiredKeys&amp;#34;: &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;token&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;local&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/var/local/lib/wasm-plugins/main.wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.wasm.runtime.v8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vm_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;json-validation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ä»£ç ä¸­ï¼Œå®ç° &lt;code&gt;OnPluginStart&lt;/code&gt;ï¼Œä½¿ç”¨ &lt;code&gt;proxywasm.GetPluginConfiguration&lt;/code&gt; åŠ è½½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pluginContext å®ç° proxy-wasm-go SDK ä¸­çš„ types.PluginContext æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// åœ¨è¿™é‡ŒåµŒå…¥é»˜è®¤çš„ plugin ä¸Šä¸‹æ–‡ï¼Œè¿™æ ·å°±ä¸ç”¨å®ç°æ‰€æœ‰æ–¹æ³•
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DefaultPluginContext&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;configuration&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginConfiguration&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pluginConfiguration ä»£è¡¨è¿™ä¸ª wasm æ’ä»¶ä¸­çš„ç¤ºä¾‹é…ç½®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pluginConfiguration&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// ç¤ºä¾‹é…ç½®å­—æ®µï¼Œæ’ä»¶å°†éªŒè¯ json è´Ÿè½½ä¸­æ˜¯å¦å­˜åœ¨è¿™äº›å­—æ®µã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;requiredKeys&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å¤å†™ types.DefaultPluginContext
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;OnPluginStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginConfigurationSize&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;OnPluginStartStatus&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetPluginConfiguration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogCriticalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;error reading plugin configuration: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;OnPluginStartStatusFailed&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;parsePluginConfiguration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogCriticalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;error parsing plugin configuration: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;OnPluginStartStatusFailed&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;configuration&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;OnPluginStartStatusOK&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// parsePluginConfiguration è§£æ json æ’ä»¶é…ç½®å¹¶è¿”å› pluginConfiguration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ³¨æ„ä½¿ç”¨ gjson è§£æ jsonï¼Œå› ä¸º TinyGo ä¸æ”¯æŒ encoding/json
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ https://github.com/mailru/easyjsonï¼Œæ”¯æŒè§£æä¸ºç»“æ„ä½“
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;parsePluginConfiguration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginConfiguration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginConfiguration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;gjson&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValidBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;the plugin configuration is not a valid json: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gjson&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ParseBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;requiredKeys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;requiredKeys&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requiredKeys&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;requiredKeys&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;requiredKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å®ƒä»¬è¢«åŒ…å«åœ¨ &lt;code&gt;pluginConfiguration&lt;/code&gt; ç»“æ„ä¸­ï¼Œå®ƒä»¬å¯ä»¥åƒå…¶ä»–å­—æ®µä¸€æ ·åœ¨éªŒè¯è¿‡ç¨‹ä¸­è¢«ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// validatePayload éªŒè¯ç»™å®šçš„ json è´Ÿè½½
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ³¨æ„è¯¥å‡½æ•°ä½¿ç”¨ gjson è§£æ jsonï¼Œå› ä¸º TinyGo ä¸æ”¯æŒ encoding/json
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;payloadValidationContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;validatePayload&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;gjson&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValidBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;body is not a valid json: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gjson&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ParseBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// éªŒè¯ jsonã€‚æ£€æŸ¥ç¤ºä¾‹ä¸­æ˜¯å¦åŒ…å«å¿…é¡»çš„é”®ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// å¿…é¡»çš„é”®é€šè¿‡æ’ä»¶é…ç½®ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;requiredKeys&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;required key (%v) is missing: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå¯ä»¥ä½¿ç”¨ä¸ä¹‹å‰ç›¸åŒçš„å‘½ä»¤å¯¹å…¶è¿›è¡Œç¼–è¯‘å’Œæµ‹è¯•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æ€»è€Œè¨€ä¹‹ï¼Œè¦åœ¨ Istio 1.12 å’Œæ›´æ–°çš„ç‰ˆæœ¬ä¸Šä½¿ç”¨ Wasm æ’ä»¶ï¼Œéœ€è¦ä¸‰ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ä½ é€‰æ‹©çš„è¯­è¨€ä¸­å®ç°æ’ä»¶çš„åŠŸèƒ½ã€‚æˆ‘åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨ Golangã€‚&lt;/li&gt;
&lt;li&gt;ç¼–è¯‘ Wasm æ’ä»¶å¹¶æ¨é€åˆ°é•œåƒä»“åº“ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½® Istio ä»¥åŠ è½½å’Œä½¿ç”¨é•œåƒä»“åº“ä¸­çš„æ’ä»¶ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¯¥æ•™ç¨‹è¿˜è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Docker åœ¨ Envoy å®¹å™¨ä¸­è¿è¡Œ Wasm æ’ä»¶ï¼Œä»¥åŠ å¿«å¼€å‘é€Ÿåº¦ï¼Œä»¥åŠå¦‚ä½•å°†å…¶éƒ¨ç½²åˆ°æ—§çš„ Istio ç‰ˆæœ¬ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Slack å°†æ•°ç™¾ä¸‡ä¸ªå¹¶å‘çš„ Websockets è¿ç§»åˆ° Envoy ä¸Šç»éªŒåˆ†äº«</title>
      <link>https://cloudnative.to/blog/migrating-millions-of-concurrent-websockets-to-envoy/</link>
      <pubDate>Fri, 08 Apr 2022 13:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/migrating-millions-of-concurrent-websockets-to-envoy/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ª &lt;a href=&#34;https://slack.engineering/migrating-millions-of-concurrent-websockets-to-envoy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Migrating Millions of Concurrent Websockets to Envoy&lt;/a&gt;ï¼ŒåŸæ–‡å‘å¸ƒäº 2021 å¹´ã€‚ä½œè€…æ˜¯ &lt;strong&gt;Ariane van der Steldt&lt;/strong&gt; Staff Software Engineer, Site Reliabilityï¼Œ&lt;strong&gt;Radha Kumari&lt;/strong&gt; Sr. Software Engineer, Site Reliabilityã€‚&lt;/p&gt;
&lt;p&gt;Slack æœ‰ä¸€ä¸ªå…¨çƒå®¢æˆ·ç¾¤ï¼Œåœ¨é«˜å³°æœŸæœ‰æ•°ç™¾ä¸‡åŒæ—¶è¿æ¥çš„ç”¨æˆ·ã€‚ç”¨æˆ·ä¹‹é—´çš„å¤§éƒ¨åˆ†é€šä¿¡æ¶‰åŠåˆ°å‘å¯¹æ–¹å‘é€å¤§é‡çš„å¾®å°ä¿¡æ¯ã€‚åœ¨ Slack çš„å¤§éƒ¨åˆ†å†å²ä¸­ï¼Œæˆ‘ä»¬ä¸€ç›´ä½¿ç”¨ &lt;a href=&#34;https://www.haproxy.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HAProxy&lt;/a&gt; ä½œä¸ºæ‰€æœ‰ä¼ å…¥æµé‡çš„è´Ÿè½½å‡è¡¡å™¨ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†è®¨è®ºæˆ‘ä»¬åœ¨ä½¿ç”¨ HAProxy æ—¶æ‰€é¢ä¸´çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¦‚ä½•ç”¨ &lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Proxy&lt;/a&gt; æ¥è§£å†³è¿™äº›é—®é¢˜ï¼Œè¿ç§»æ‰€æ¶‰åŠçš„æ­¥éª¤ï¼Œä»¥åŠç»“æœæ˜¯ä»€ä¹ˆã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼&lt;/p&gt;
&lt;h2 id=&#34;slack-çš„-websockets&#34;&gt;&lt;strong&gt;Slack çš„ Websockets&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†å³æ—¶ä¼ é€’ä¿¡æ¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;a href=&#34;https://tools.ietf.org/html/rfc6455&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;websocket è¿æ¥&lt;/a&gt;ï¼Œè¿™æ˜¯ä¸€ç§åŒå‘çš„é€šä¿¡é“¾æ¥ï¼Œè´Ÿè´£è®©ä½ çœ‹åˆ° &amp;ldquo;æœ‰å‡ ä¸ªäººåœ¨æ‰“å­—&amp;hellip;&amp;hellip;&amp;quot;ï¼Œç„¶åæ˜¯ä»–ä»¬æ‰“çš„ä¸œè¥¿ï¼Œé€Ÿåº¦å‡ ä¹æ˜¯å…‰é€Ÿçš„ã€‚websocket è¿æ¥è¢«æ‘„å–åˆ°ä¸€ä¸ªå«åš &amp;ldquo;wss&amp;rdquo;ï¼ˆWebSocket æœåŠ¡ï¼‰çš„ç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡ &lt;code&gt;wss-primary.slack.com&lt;/code&gt; å’Œ &lt;code&gt;wss-backup.slack.com&lt;/code&gt;ï¼ˆè¿™ä¸æ˜¯ç½‘ç«™ï¼Œå¦‚æœå»è®¿é—®ï¼Œåªä¼šå¾—åˆ°ä¸€ä¸ª HTTP 404ï¼‰ä»äº’è”ç½‘ä¸Šè®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ˜¾ç¤º-websockets-å·¥ä½œåŸç†çš„å›¾è¡¨&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ˜¾ç¤º websockets å·¥ä½œåŸç†çš„å›¾è¡¨&#34; srcset=&#34;
               /blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277posyqj20cg0b8dfz_hu3131183c4cc16cd249fae697662e0376_15792_f093b0f4f4191399f5a123a8adc424ef.webp 400w,
               /blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277posyqj20cg0b8dfz_hu3131183c4cc16cd249fae697662e0376_15792_bdfe742b2f490b07b8231ecce9d1438d.webp 760w,
               /blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277posyqj20cg0b8dfz_hu3131183c4cc16cd249fae697662e0376_15792_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277posyqj20cg0b8dfz_hu3131183c4cc16cd249fae697662e0376_15792_f093b0f4f4191399f5a123a8adc424ef.webp&#34;
               width=&#34;448&#34;
               height=&#34;404&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ˜¾ç¤º websockets å·¥ä½œåŸç†çš„å›¾è¡¨
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Websocket è¿æ¥ä¸€å¼€å§‹æ˜¯æ™®é€šçš„ HTTPS è¿æ¥ï¼Œç„¶åå®¢æˆ·ç«¯å‘å‡ºåè®®åˆ‡æ¢è¯·æ±‚ï¼Œå°†è¿æ¥å‡çº§ä¸º Websocketã€‚åœ¨ Slackï¼Œæˆ‘ä»¬æœ‰ä¸åŒçš„ websocket æœåŠ¡ï¼Œä¸“é—¨ç”¨äºæ¶ˆæ¯ã€åœ¨çº¿ï¼ˆåˆ—å‡ºå“ªäº›è”ç³»äººåœ¨çº¿ï¼‰å’Œå…¶ä»–æœåŠ¡ã€‚å…¶ä¸­ä¸€ä¸ª websocket ç«¯ç‚¹æ˜¯ä¸“é—¨ä¸ºéœ€è¦ä¸ Slack äº’åŠ¨çš„åº”ç”¨ç¨‹åºåˆ¶ä½œçš„ï¼ˆå› ä¸ºåº”ç”¨ç¨‹åºä¹Ÿæƒ³è¦å®æ—¶é€šä¿¡ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-è§£é‡Šæµé‡å¦‚ä½•è¢«è·¯ç”±åˆ°åç«¯æœåŠ¡çš„æµç¨‹å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;è§£é‡Šæµé‡å¦‚ä½•è¢«è·¯ç”±åˆ°åç«¯æœåŠ¡çš„æµç¨‹å›¾&#34; srcset=&#34;
               /blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277nk5l3j20hr0bbq3e_hu7b1a83a28e1fe9e92bd571ed175411fe_27425_a4254eb2127fbbd19b871345cf6d6ed5.webp 400w,
               /blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277nk5l3j20hr0bbq3e_hu7b1a83a28e1fe9e92bd571ed175411fe_27425_58d99808cc5861216ac92c71f93cebf3.webp 760w,
               /blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277nk5l3j20hr0bbq3e_hu7b1a83a28e1fe9e92bd571ed175411fe_27425_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277nk5l3j20hr0bbq3e_hu7b1a83a28e1fe9e92bd571ed175411fe_27425_a4254eb2127fbbd19b871345cf6d6ed5.webp&#34;
               width=&#34;639&#34;
               height=&#34;407&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      è§£é‡Šæµé‡å¦‚ä½•è¢«è·¯ç”±åˆ°åç«¯æœåŠ¡çš„æµç¨‹å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿‡å»ï¼Œæˆ‘ä»¬åœ¨å¤šä¸ª &lt;a href=&#34;https://aws.amazon.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS&lt;/a&gt; Region æœ‰ä¸€ç»„ä¸“é—¨ç”¨äº websockets çš„ HAProxy å®ä¾‹ï¼Œä»¥ç»ˆæ­¢é è¿‘ç”¨æˆ·çš„ websocket è¿æ¥ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘ç»™ç›¸åº”çš„åç«¯æœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿ç§»åˆ°-envoy-proxy-çš„åŠ¨æœº&#34;&gt;&lt;strong&gt;è¿ç§»åˆ° Envoy Proxy çš„åŠ¨æœº&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;è™½ç„¶æˆ‘ä»¬ä» Slack å¼€å§‹å°±ä¸€ç›´åœ¨ä½¿ç”¨ HAproxyï¼Œå¹¶ä¸”çŸ¥é“å¦‚ä½•å¤§è§„æ¨¡åœ°æ“ä½œå®ƒï¼Œä½†æœ‰ä¸€äº›æ“ä½œä¸Šçš„æŒ‘æˆ˜è®©æˆ‘ä»¬è€ƒè™‘æ›¿ä»£æ–¹æ¡ˆï¼Œæ¯”å¦‚ Envoy Proxyã€‚&lt;/p&gt;
&lt;h3 id=&#34;çƒ­é‡å¯&#34;&gt;&lt;strong&gt;çƒ­é‡å¯&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;åœ¨ Slackï¼Œåç«¯æœåŠ¡ç«¯ç‚¹åˆ—è¡¨çš„å˜åŒ–æ˜¯ä¸€ä¸ªå¸¸è§çš„äº‹ä»¶ï¼ˆç”±äºå®ä¾‹è¢«æ·»åŠ æˆ–åˆ é™¤ï¼‰ã€‚HAProxy æä¾›ä¸¤ç§æ–¹æ³•æ¥æ›´æ–°å…¶é…ç½®ï¼Œä»¥é€‚åº”ç«¯ç‚¹åˆ—è¡¨çš„å˜åŒ–ã€‚ä¸€ç§æ˜¯ä½¿ç”¨ HAProxy Runtime APIã€‚æˆ‘ä»¬åœ¨å…¶ä¸­ä¸€å¥— HAProxy å®ä¾‹ä¸­ä½¿ç”¨äº†è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬çš„ç»éªŒåœ¨å¦ä¸€ç¯‡åšæ–‡ä¸­æœ‰æ‰€æè¿° â€”â€” &lt;a href=&#34;https://slack.engineering/a-terrible-horrible-no-good-very-bad-day-at-slack/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ Slack çš„å¯æ€•çš„ã€ææ€–çš„ã€æ²¡æœ‰å¥½å¤„çš„ã€éå¸¸ç³Ÿç³•çš„ä¸€å¤©&lt;/a&gt;ã€‚å¦ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ç”¨äº websockets è´Ÿè½½å‡è¡¡å™¨ï¼ˆLBï¼‰ï¼Œæ˜¯å°†åç«¯æ¸²æŸ“åˆ° HAProxy é…ç½®æ–‡ä»¶ä¸­ï¼Œç„¶åé‡æ–°åŠ è½½ HAProxyã€‚&lt;/p&gt;
&lt;p&gt;æ¯æ¬¡ HAProxy é‡è½½æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ç»„æ–°çš„è¿›ç¨‹æ¥å¤„ç†æ–°è¿›å…¥çš„è¿æ¥ã€‚æˆ‘ä»¬ä¼šè®©æ—§çš„è¿›ç¨‹æŒç»­è¿è¡Œå¾ˆå¤šå°æ—¶ï¼Œä»¥ä¾¿è®©é•¿å¯¿çš„ websocket è¿æ¥è€—å°½ï¼Œé¿å…ç”¨æˆ·é¢‘ç¹æ–­å¼€è¿æ¥ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¸èƒ½æœ‰å¤ªå¤šçš„ HAProxy è¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½è¿è¡Œç€å®ƒè‡ªå·± &amp;ldquo;å½“æ—¶&amp;rdquo; çš„é…ç½®å‰¯æœ¬ â€”â€” æˆ‘ä»¬å¸Œæœ›å®ä¾‹èƒ½æ›´å¿«åœ°æ±‡èšåˆ°æ–°ç‰ˆæœ¬çš„é…ç½®ä¸Šã€‚æˆ‘ä»¬ä¸å¾—ä¸å®šæœŸæ”¶å‰²æ—§çš„ HAProxy è¿›ç¨‹ï¼Œå¹¶é™åˆ¶ HAProxy é‡æ–°åŠ è½½çš„é¢‘ç‡ï¼Œä»¥é˜²åº•å±‚åç«¯å‡ºç°æ··ä¹±ã€‚&lt;/p&gt;
&lt;p&gt;æ— è®ºæˆ‘ä»¬ä½¿ç”¨å“ªç§æ–¹æ³•ï¼Œéƒ½éœ€è¦ä¸€äº›é¢å¤–çš„åŸºç¡€è®¾æ–½æ¥ç®¡ç† HAProxy çš„é‡æ–°åŠ è½½ã€‚&lt;/p&gt;
&lt;p&gt;Envoy å…è®¸æˆ‘ä»¬ä½¿ç”¨&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/service_discovery#arch-overview-service-discovery-types-eds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ¨æ€é…ç½®çš„é›†ç¾¤å’Œç«¯ç‚¹&lt;/a&gt;ï¼Œè¿™æ„å‘³ç€å¦‚æœç«¯ç‚¹åˆ—è¡¨å‘ç”Ÿå˜åŒ–ï¼Œå®ƒä¸éœ€è¦é‡æ–°åŠ è½½ã€‚å¦‚æœä»£ç æˆ–é…ç½®ç¡®å®å‘ç”Ÿäº†å˜åŒ–ï¼ŒEnvoy æœ‰èƒ½åŠ›åœ¨ä¸æ”¾å¼ƒä»»ä½•è¿æ¥çš„æƒ…å†µä¸‹&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/hot_restart&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çƒ­é‡å¯&lt;/a&gt;è‡ªå·±ã€‚Envoy é€šè¿‡ &lt;a href=&#34;https://en.wikipedia.org/wiki/Inotify&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;inotify&lt;/a&gt; è§‚å¯Ÿæ–‡ä»¶ç³»ç»Ÿé…ç½®çš„æ›´æ–°ã€‚åœ¨çƒ­é‡å¯è¿‡ç¨‹ä¸­ï¼ŒEnvoy è¿˜å°†ç»Ÿè®¡æ•°æ®ä»çˆ¶è¿›ç¨‹å¤åˆ¶åˆ°å­è¿›ç¨‹ä¸­ï¼Œå› æ­¤ä»ªè¡¨å’Œè®¡æ•°å™¨ä¸ä¼šè¢«é‡ç½®ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸€åˆ‡éƒ½ä½¿ Envoy çš„è¿è¥å¼€é”€å¤§å¤§å‡å°‘ï¼Œè€Œä¸”ä¸éœ€è¦é¢å¤–çš„æœåŠ¡æ¥ç®¡ç†é…ç½®å˜åŒ–æˆ–é‡æ–°å¯åŠ¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è´Ÿè½½å‡è¡¡åŠŸèƒ½&#34;&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡åŠŸèƒ½&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;Envoy æä¾›äº†ä¸€äº›å…ˆè¿›çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œå¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†…ç½®æ”¯æŒåŒºåŸŸæ„ŸçŸ¥è·¯ç”±çš„åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;é€šè¿‡&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/outlier#arch-overview-outlier-detection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼‚å¸¸å€¼æ£€æµ‹&lt;/a&gt;è¿›è¡Œè¢«åŠ¨å¥åº·æ£€æŸ¥&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/panic_threshold&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ææ…Œè·¯ç”±&lt;/a&gt;ï¼šEnvoy é€šå¸¸åªå°†æµé‡è·¯ç”±åˆ°å¥åº·çš„åç«¯ï¼Œä½†æ˜¯å¦‚æœå¥åº·ä¸»æœºçš„ç™¾åˆ†æ¯”ä½äºæŸä¸ªé˜ˆå€¼ï¼Œå®ƒå¯ä»¥è¢«é…ç½®ä¸ºå°†æµé‡å‘é€åˆ°æ‰€æœ‰çš„åç«¯ï¼Œä¸ç®¡æ˜¯å¥åº·çš„è¿˜æ˜¯ä¸å¥åº·çš„ã€‚è¿™åœ¨æˆ‘ä»¬ &lt;a href=&#34;https://slack.engineering/slacks-outage-on-january-4th-2021/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2021 å¹´ 1 æœˆ 4 æ—¥çš„æ•…éšœ&lt;/a&gt;ä¸­éå¸¸æœ‰å¸®åŠ©ï¼Œè¿™æ¬¡æ•…éšœæ˜¯ç”±æˆ‘ä»¬åŸºç¡€è®¾æ–½ä¸­çš„ä¸€ä¸ªå¹¿æ³›çš„ç½‘ç»œé—®é¢˜å¼•èµ·çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±äºä¸Šè¿°åŸå› ï¼Œåœ¨ 2019 å¹´ï¼Œæˆ‘ä»¬å†³å®šå°†æˆ‘ä»¬çš„å…¥å£è´Ÿè½½å‡è¡¡å±‚ä» HAproxy è¿ç§»åˆ° Envoy Proxyï¼Œä» websockets å †æ ˆå¼€å§‹ã€‚è¿ç§»çš„ä¸»è¦ç›®æ ‡æ˜¯æé«˜å¯æ“ä½œæ€§ï¼Œè·å¾— Envoy æä¾›çš„æ–°åŠŸèƒ½ï¼Œä»¥åŠæ›´åŠ æ ‡å‡†åŒ–ã€‚é€šè¿‡åœ¨æ•´ä¸ª Slack ä¸­ä» HAProxy è¿ç§»åˆ° Envoyï¼Œæˆ‘ä»¬çš„å›¢é˜Ÿå°†ä¸å†éœ€è¦äº†è§£ä¸¤ä¸ªè½¯ä»¶çš„æ€ªå¼‚ä¹‹å¤„ï¼Œä¸å†éœ€è¦ç»´æŠ¤ä¸¤ç§ä¸åŒçš„é…ç½®ï¼Œä¸å†éœ€è¦ç®¡ç†ä¸¤ä¸ªæ„å»ºå’Œå‘å¸ƒç®¡é“ï¼Œè¯¸å¦‚æ­¤ç±»ã€‚é‚£æ—¶ï¼Œæˆ‘ä»¬å·²ç»åœ¨ä½¿ç”¨ Envoy Proxy ä½œä¸ºæˆ‘ä»¬æœåŠ¡ç½‘æ ¼ä¸­çš„&lt;a href=&#34;https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ•°æ®å¹³é¢&lt;/a&gt;ã€‚æˆ‘ä»¬å†…éƒ¨ä¹Ÿæœ‰ç»éªŒä¸°å¯Œçš„ Envoy å¼€å‘äººå‘˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥éšæ—¶è·å¾— Envoy çš„ä¸“ä¸šçŸ¥è¯†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç”Ÿæˆ-envoy-é…ç½®&#34;&gt;ç”Ÿæˆ Envoy é…ç½®&lt;/h2&gt;
&lt;p&gt;è¿™æ¬¡è¿ç§»çš„ç¬¬ä¸€æ­¥æ˜¯å®¡æŸ¥æˆ‘ä»¬ç°æœ‰çš„ websocket å±‚é…ç½®ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåŒç­‰çš„ Envoy é…ç½®ã€‚åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œç®¡ç† Envoy é…ç½®æ˜¯æˆ‘ä»¬æœ€å¤§çš„æŒ‘æˆ˜ä¹‹ä¸€ã€‚Envoy æœ‰ä¸°å¯Œçš„åŠŸèƒ½é›†ï¼Œå…¶é…ç½®ä¸ HAProxy çš„é…ç½®æœ‰å¾ˆå¤§çš„ä¸åŒã€‚Envoy é…ç½®æ¶‰åŠå››ä¸ªä¸»è¦æ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Listener&lt;/strong&gt;ï¼Œæ¥æ”¶è¯·æ±‚ï¼Œåˆç§° TCP å¥—æ¥å­—ã€SSL å¥—æ¥å­—æˆ– unix åŸŸå¥—æ¥å­—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Cluster&lt;/strong&gt;ï¼Œä»£è¡¨æˆ‘ä»¬å‘é€è¯·æ±‚çš„å†…éƒ¨æœåŠ¡ï¼Œå¦‚æ¶ˆæ¯æœåŠ¡å™¨å’Œå­˜åœ¨æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Route&lt;/strong&gt;ï¼Œå°† Listener å’Œ Cluster è¿æ¥åœ¨ä¸€èµ·&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Filter&lt;/strong&gt;ï¼Œå®ƒå¯¹è¯·æ±‚è¿›è¡Œæ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Slack çš„é…ç½®ç®¡ç†ä¸»è¦æ˜¯é€šè¿‡ &lt;a href=&#34;https://www.chef.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Chef&lt;/a&gt; å®Œæˆçš„ã€‚å½“æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ Envoy æ—¶ï¼Œæˆ‘ä»¬æŠŠ Envoy é…ç½®ä½œä¸º &lt;a href=&#34;https://docs.chef.io/resources/template/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chef æ¨¡æ¿æ–‡ä»¶&lt;/a&gt;æ¥éƒ¨ç½²ï¼Œä½†å®ƒçš„ç®¡ç†å˜å¾—å¾ˆéº»çƒ¦ï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å»ºç«‹äº† chef åº“å’Œ&lt;a href=&#34;https://docs.chef.io/custom_resources_notes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªå®šä¹‰èµ„æº&lt;/a&gt;æ¥ç”Ÿæˆ Envoy é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-chef-èµ„æºçš„ç»“æ„å’Œæµç¨‹å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Chef èµ„æºçš„ç»“æ„å’Œæµç¨‹å›¾&#34; srcset=&#34;
               /blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277ob5drj20hs07wq2z_hu4472a6bccc8adaf103d6ef276d70c8d8_12074_4deca491c2ed9926144f9c1313975cda.webp 400w,
               /blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277ob5drj20hs07wq2z_hu4472a6bccc8adaf103d6ef276d70c8d8_12074_da650a7a4c0602e8cfe4b2b2472d2f2e.webp 760w,
               /blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277ob5drj20hs07wq2z_hu4472a6bccc8adaf103d6ef276d70c8d8_12074_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277ob5drj20hs07wq2z_hu4472a6bccc8adaf103d6ef276d70c8d8_12074_4deca491c2ed9926144f9c1313975cda.webp&#34;
               width=&#34;640&#34;
               height=&#34;284&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Chef èµ„æºçš„ç»“æ„å’Œæµç¨‹å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ Chef å†…éƒ¨ï¼Œé…ç½®æ˜¯ä¸€ä¸ª&lt;a href=&#34;https://en.wikipedia.org/wiki/Singleton_pattern&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å•ä¾‹&lt;/a&gt;ï¼Œæ¨¡æ‹Ÿäº†æ¯ä¸ªä¸»æœºåªæœ‰ä¸€ä¸ª Envoy é…ç½®çš„æƒ…å†µã€‚æ‰€æœ‰çš„ Chef èµ„æºéƒ½åœ¨è¿™ä¸ªå•ä¾‹ä¸Šæ“ä½œï¼Œæ·»åŠ ç›‘å¬å™¨ã€è·¯ç”±æˆ–é›†ç¾¤ã€‚åœ¨ Chef è¿è¡Œçš„æœ€åï¼Œ&lt;code&gt;envoy.yaml&lt;/code&gt; è¢«ç”Ÿæˆã€éªŒè¯ï¼Œç„¶åå®‰è£… â€”â€” æˆ‘ä»¬ä»ä¸å†™ä¸­é—´é…ç½®ï¼Œå› ä¸ºè¿™äº›é…ç½®å¯èƒ½æ˜¯æ— æ•ˆçš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªä¾‹å­å±•ç¤ºäº†æˆ‘ä»¬å¦‚ä½•åˆ›å»ºä¸€ä¸ªæœ‰ä¸¤æ¡è·¯ç”±çš„ HTTP ç›‘å¬å™¨ï¼Œå°†æµé‡è·¯ç”±åˆ°ä¸¤ä¸ª&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/service_discovery#endpoint-discovery-service-eds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ¨æ€&lt;/a&gt;é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-è°ƒç”¨-chef-èµ„æºä»¥åˆ›å»ºå¸¦æœ‰é›†ç¾¤å’Œè·¯ç”±çš„ç›‘å¬å™¨çš„ä¾‹å­&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;è°ƒç”¨ Chef èµ„æºä»¥åˆ›å»ºå¸¦æœ‰é›†ç¾¤å’Œè·¯ç”±çš„ç›‘å¬å™¨çš„ä¾‹å­&#34; srcset=&#34;
               /blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277otk25j20hs0ao74o_hue9fcf15645fc2377063394764178a305_24864_0bc65fe4c3c9735287bd9a588f031b67.webp 400w,
               /blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277otk25j20hs0ao74o_hue9fcf15645fc2377063394764178a305_24864_4426040eb7395f32259e92d7116888ef.webp 760w,
               /blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277otk25j20hs0ao74o_hue9fcf15645fc2377063394764178a305_24864_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277otk25j20hs0ao74o_hue9fcf15645fc2377063394764178a305_24864_0bc65fe4c3c9735287bd9a588f031b67.webp&#34;
               width=&#34;640&#34;
               height=&#34;384&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      è°ƒç”¨ Chef èµ„æºä»¥åˆ›å»ºå¸¦æœ‰é›†ç¾¤å’Œè·¯ç”±çš„ç›‘å¬å™¨çš„ä¾‹å­
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¦åœ¨ Envoy ä¸­å¤åˆ¶æˆ‘ä»¬å¤æ‚çš„ HAProxy é…ç½®éœ€è¦ä¸€äº›åŠªåŠ›ã€‚å¤§éƒ¨åˆ†éœ€è¦çš„åŠŸèƒ½åœ¨ Envoy ä¸­å·²ç»æœ‰äº†ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨ chef åº“ä¸­åŠ å…¥å¯¹å®ƒçš„æ”¯æŒå°±å¯ä»¥äº†ã€‚æˆ‘ä»¬å®ç°äº†ä¸€äº›ç¼ºå¤±çš„ Envoy åŠŸèƒ½ï¼ˆæœ‰äº›æ˜¯&lt;a href=&#34;https://github.com/envoyproxy/envoy/pull/12206&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸Šæ¸¸&lt;/a&gt;è´¡çŒ®çš„ï¼Œæœ‰äº›æ˜¯å†…éƒ¨ç»´æŠ¤çš„æ‰©å±•ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯¹æˆ‘ä»¬çš„æ–°é…ç½®è¿›è¡Œæµ‹è¯•å’ŒéªŒè¯&#34;&gt;å¯¹æˆ‘ä»¬çš„æ–°é…ç½®è¿›è¡Œæµ‹è¯•å’ŒéªŒè¯&lt;/h2&gt;
&lt;p&gt;æµ‹è¯•æ–°çš„ Envoy websockets å±‚æ˜¯ä¸€ä¸ªè¿­ä»£çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬ç»å¸¸ç”¨æ‰‹å·¥ç¼–ç çš„ Envoy é…ç½®åšåŸå‹ï¼Œå¹¶åœ¨æœ¬åœ°çš„å¼€å‘æœºå™¨ä¸Šæµ‹è¯•ï¼Œæ¯ä¸ªç›‘å¬å™¨ã€è·¯ç”±å’Œé›†ç¾¤éƒ½æœ‰ä¸€ä¸ªã€‚æ‰‹å·¥ç¼–ç çš„ä¿®æ”¹ä¸€æ—¦æˆåŠŸï¼Œå°±ä¼šè¢«ç§»åˆ° chef åº“ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;HTTP è·¯ç”±æ˜¯ç”¨ &lt;a href=&#34;https://curl.se/docs/manpage.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;curl&lt;/a&gt; æµ‹è¯•çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸºäºå¤´å’Œ cookie çš„ç‰¹å®šè·¯ç”±åˆ°ç‰¹å®šåç«¯&lt;/li&gt;
&lt;li&gt;åŸºäºè·¯å¾„ã€å‰ç¼€å’ŒæŸ¥è¯¢å‚æ•°çš„è·¯ç”±åˆ°ç‰¹å®šåç«¯&lt;/li&gt;
&lt;li&gt;SSL è¯ä¹¦&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“äº‹æƒ…æ²¡æœ‰è¾¾åˆ°é¢„æœŸæ•ˆæœæ—¶ï¼Œæˆ‘ä»¬åœ¨æœºå™¨ä¸Šä½¿ç”¨ Envoy è°ƒè¯•æ—¥å¿—ã€‚è°ƒè¯•æ—¥å¿—æ¸…æ¥šåœ°è§£é‡Šäº†ä¸ºä»€ä¹ˆ Envoy é€‰æ‹©å°†ä¸€ä¸ªç‰¹å®šçš„è¯·æ±‚è·¯ç”±åˆ°ä¸€ä¸ªç‰¹å®šçš„é›†ç¾¤ã€‚Envoy çš„è°ƒè¯•æ—¥å¿—éå¸¸æœ‰ç”¨ï¼Œä½†ä¹Ÿå¾ˆå†—é•¿ï¼Œè€Œä¸”å¾ˆæ˜‚è´µï¼ˆä½ çœŸçš„ä¸æƒ³åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨è¿™ä¸ªåŠŸèƒ½ï¼‰ã€‚è°ƒè¯•æ—¥å¿—å¯ä»¥é€šè¿‡ Curl å¯ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -X POST http://localhost:&amp;lt;envoy_admin_port&amp;gt;/logging?level&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;debug
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Envoy ç®¡ç†æ¥å£åœ¨åˆå§‹è°ƒè¯•æ—¶ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯è¿™äº›ç«¯ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;clusters&lt;/strong&gt;ï¼šæ˜¾ç¤ºæ‰€æœ‰é…ç½®çš„é›†ç¾¤ï¼ŒåŒ…æ‹¬æ¯ä¸ªé›†ç¾¤ä¸­æ‰€æœ‰ä¸Šæ¸¸ä¸»æœºçš„ä¿¡æ¯ä»¥åŠæ¯ä¸ªä¸»æœºçš„ç»Ÿè®¡æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;/certs&lt;/strong&gt;ï¼šä»¥ JSON æ ¼å¼æ˜¾ç¤ºæ‰€æœ‰åŠ è½½çš„ TLS è¯ä¹¦ï¼ŒåŒ…æ‹¬æ–‡ä»¶åã€åºåˆ—å·ã€ä¸»ä½“æ›¿ä»£åç§°å’Œåˆ°æœŸå‰çš„å¤©æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;/listeners&lt;/strong&gt;ï¼šæ˜¾ç¤ºæ‰€æœ‰é…ç½®çš„ç›‘å¬å™¨åŠå…¶åç§°å’Œåœ°å€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬çš„ Chef åº“ä½¿ç”¨ &lt;code&gt;-mode validate&lt;/code&gt; å‘½ä»¤è¡Œé€‰é¡¹è¿è¡Œ Envoyï¼Œä½œä¸ºä¸€ä¸ªéªŒè¯æ­¥éª¤ï¼Œä»¥é˜²æ­¢å®‰è£…æ— æ•ˆçš„é…ç½®ã€‚è¿™ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®Œæˆã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo /path/to/envoy/binary -c &amp;lt;/path/to/envoy.yaml&amp;gt; --mode validate
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Envoy æä¾› JSON æ ¼å¼çš„ç›‘å¬å™¨æ—¥å¿—ã€‚æˆ‘ä»¬å°†è¿™äº›æ—¥å¿—å½•å…¥æˆ‘ä»¬çš„æ—¥å¿—ç®¡é“ï¼ˆå½“ç„¶æ˜¯åœ¨å¯¹æ—¥å¿—è¿›è¡Œ &lt;a href=&#34;https://en.wikipedia.org/wiki/Personal_data&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PII&lt;/a&gt; å¤„ç†åï¼‰ï¼Œè¿™å¯¹è°ƒè¯•å·¥ä½œç»å¸¸å¾ˆæœ‰å¸®åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦å¯¹å¼€å‘ç¯å¢ƒä¸­çš„é…ç½®æœ‰ä¿¡å¿ƒï¼Œæˆ‘ä»¬å°±å‡†å¤‡åšä¸€äº›æ›´å¤šçš„æµ‹è¯• &amp;ndash; åœ¨ç”Ÿäº§ä¸­ï¼&amp;quot;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿ç§»è‡³ç”Ÿäº§&#34;&gt;è¿ç§»è‡³ç”Ÿäº§&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†å°†è¿ç§»è¿‡ç¨‹ä¸­çš„é£é™©é™åˆ°æœ€ä½ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªæ–°çš„ Envoy websocket æ ˆï¼Œå…¶é…ç½®ä¸ç°æœ‰çš„ HAProxy å±‚ç›¸å½“ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€æ­¥ã€æœ‰æ§åˆ¶åœ°å°†æµé‡è½¬ç§»åˆ°æ–°çš„ Envoy å †æ ˆï¼Œå¹¶ä¸”åœ¨å¿…è¦æ—¶å¯ä»¥å¿«é€Ÿåˆ‡æ¢å› HAProxyã€‚ç¼ºç‚¹æ˜¯æˆ‘ä»¬çš„ AWS æˆæœ¬ â€”â€” æˆ‘ä»¬åœ¨è¿ç§»è¿‡ç¨‹ä¸­ä½¿ç”¨äº†åŒå€çš„èµ„æºï¼Œä½†æˆ‘ä»¬æ„¿æ„èŠ±è´¹æ—¶é—´å’Œèµ„æºä¸ºæˆ‘ä»¬çš„å®¢æˆ·é€æ˜åœ°è¿›è¡Œè¿ç§»ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬é€šè¿‡ &lt;a href=&#34;https://ns1.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NS1&lt;/a&gt; ç®¡ç†æˆ‘ä»¬çš„ DNS è®°å½• &lt;strong&gt;wss-primary.slack.com&lt;/strong&gt; å’Œ &lt;strong&gt;wss-backup.slack.com&lt;/strong&gt;ã€‚æˆ‘ä»¬ä½¿ç”¨åŠ æƒè·¯ç”±å°†æµé‡ä» &lt;strong&gt;haproxy-wss&lt;/strong&gt; è½¬ç§»åˆ° &lt;strong&gt;envoy-wss&lt;/strong&gt; &lt;a href=&#34;https://docs.aws.amazon.com/elasticloadbalancing/latest/network/introduction.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NLB&lt;/a&gt; DNS åç§°ã€‚ç¬¬ä¸€æ‰¹åŒºåŸŸæ˜¯ä»¥ 10%ã€25%ã€50%ã€75% å’Œ 100% çš„æ­¥éª¤å•ç‹¬ä¸Šçº¿çš„ã€‚ç”±äºæˆ‘ä»¬å¯¹æ–°çš„ Envoy å±‚å’Œä¸Šçº¿è¿‡ç¨‹æœ‰ä¿¡å¿ƒï¼Œæ‰€ä»¥æœ€åçš„åŒºåŸŸä¸Šçº¿é€Ÿåº¦æ›´å¿«ï¼ˆ25%ã€50%ã€75%ã€100% åªéœ€ä¸¤å¤©ï¼Œè€Œä¹‹å‰çš„ä¸€ä¸ªåŒºåŸŸéœ€è¦ä¸€å‘¨çš„æ—¶é—´ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡è¿ç§»å·¥ä½œå¾ˆé¡ºåˆ©ï¼Œæ²¡æœ‰å‡ºç°æ•…éšœï¼Œä½†è¿˜æ˜¯å‡ºç°äº†ä¸€äº›å°é—®é¢˜ï¼Œæ¯”å¦‚è¶…æ—¶å€¼å’Œ header çš„å·®å¼‚ã€‚åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¤šæ¬¡æ¢å¤ã€ä¿®å¤ï¼Œå¹¶å†æ¬¡ä¸Šçº¿ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æµç¨‹å›¾æ˜¾ç¤º-dns-è¿ç§»è¿‡ç¨‹ä¸­æ¶‰åŠçš„ç»„ä»¶å’Œæ­¥éª¤&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æµç¨‹å›¾æ˜¾ç¤º DNS è¿ç§»è¿‡ç¨‹ä¸­æ¶‰åŠçš„ç»„ä»¶å’Œæ­¥éª¤&#34; srcset=&#34;
               /blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277p8k19j20hs07c3yp_huf10eeba826a8a2b15c724be5d8e7976a_17621_19ca1d641947e13e901a4f10184209a0.webp 400w,
               /blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277p8k19j20hs07c3yp_huf10eeba826a8a2b15c724be5d8e7976a_17621_183b1f2c7a4043350146ae0e053cc66c.webp 760w,
               /blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277p8k19j20hs07c3yp_huf10eeba826a8a2b15c724be5d8e7976a_17621_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277p8k19j20hs07c3yp_huf10eeba826a8a2b15c724be5d8e7976a_17621_19ca1d641947e13e901a4f10184209a0.webp&#34;
               width=&#34;640&#34;
               height=&#34;264&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æµç¨‹å›¾æ˜¾ç¤º DNS è¿ç§»è¿‡ç¨‹ä¸­æ¶‰åŠçš„ç»„ä»¶å’Œæ­¥éª¤
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç»è¿‡æ¼«é•¿è€Œæ¿€åŠ¨äººå¿ƒçš„ 6 ä¸ªæœˆï¼Œè¿ç§»å®Œæˆäº†ï¼Œæ•´ä¸ª HAProxy websocket å †æ ˆåœ¨å…¨çƒèŒƒå›´å†…è¢« Envoy Proxy å–ä»£ï¼Œå¯¹å®¢æˆ·çš„&lt;strong&gt;å½±å“ä¸ºé›¶&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å“ªäº›è¿›å±•é¡ºåˆ©å“ªäº›ä¸é¡ºåˆ©&#34;&gt;å“ªäº›è¿›å±•é¡ºåˆ©ï¼Œå“ªäº›ä¸é¡ºåˆ©&lt;/h2&gt;
&lt;p&gt;è¿ç§»æœ¬èº«æ˜¯ç›¸å¯¹å¹³æ·¡å’Œæ— èŠçš„ã€‚&lt;strong&gt;æ¯ç‡¥æ˜¯ä¸€ä»¶å¥½äº‹&lt;/strong&gt;ï¼šåˆºæ¿€æ„å‘³ç€äº‹æƒ…çš„ä¸­æ–­ï¼Œæ¯ç‡¥æ„å‘³ç€ä¸€åˆ‡é¡ºåˆ©ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å‘ç°ï¼Œæ—§çš„ HAProxy é…ç½®éšç€æ—¶é—´çš„æ¨ç§»è€Œæœ‰æœºåœ°å¢é•¿ã€‚å®ƒåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç”± HAProxy ä½¿ç”¨çš„æ¨¡å‹å½¢æˆçš„ â€”â€” ä¸€ä¸ªåŒ…æ‹¬æ‰€æœ‰ç›‘å¬å™¨çš„å¤§å‹é…ç½®ã€‚Envoy çš„é…ç½®æ¨¡å‹æ¯” HAProxy çš„æ¨¡å‹ä½¿ç”¨æ›´å¤šçš„å®šä¹‰èŒƒå›´ã€‚ä¸€æ—¦ä¸€ä¸ªç›‘å¬å™¨è¢«è¾“å…¥ï¼Œåªæœ‰è¯¥ç›‘å¬å™¨å†…çš„è§„åˆ™é€‚ç”¨äºè¯·æ±‚ã€‚ä¸€æ—¦è¾“å…¥ä¸€ä¸ªè·¯ç”±ï¼Œåªæœ‰è¯¥è·¯ç”±ä¸Šçš„è§„åˆ™é€‚ç”¨ã€‚è¿™ä½¿å¾—å°†è§„åˆ™ä¸ç›¸å…³çš„è¯·æ±‚è”ç³»èµ·æ¥æ›´åŠ å®¹æ˜“ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬èŠ±äº†å¾ˆé•¿æ—¶é—´ä»æ—§çš„ HAProxy é…ç½®ä¸­æå–é‡è¦çš„ä¸œè¥¿ï¼Œè¿™å®é™…ä¸Šæ˜¯æŠ€æœ¯å€ºåŠ¡ã€‚é€šå¸¸å¾ˆéš¾å¼„æ¸…æ¥šä¸ºä»€ä¹ˆä¼šæœ‰æŸä¸ªè§„åˆ™ï¼Œå“ªäº›æ˜¯æœ‰æ„çš„ï¼Œå“ªäº›æ˜¯æ— æ„çš„ï¼Œä»¥åŠå…¶ä»–æœåŠ¡æ‰€ä¾èµ–çš„è¡Œä¸ºæ˜¯ä»€ä¹ˆã€‚ä¾‹å¦‚ï¼Œæœ‰äº›æœåŠ¡åº”è¯¥åªåœ¨ä¸¤ä¸ªè™šæ‹Ÿä¸»æœºï¼ˆvhostsï¼‰ä¸­çš„ä¸€ä¸ªä¸‹ï¼Œä½†å®é™…ä¸Šåœ¨ HAProxy çš„ä¸¤ä¸ª vhosts ä¸‹éƒ½å¯ç”¨ã€‚æˆ‘ä»¬ä¸å¾—ä¸å¤åˆ¶è¿™ä¸ªé”™è¯¯ï¼Œå› ä¸ºç°æœ‰çš„ä»£ç ä¾èµ–äºè¿™ç§è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨ HAProxy å †æ ˆä¸­é”™è¿‡äº†ä¸€äº›ç»†å¾®çš„ä¸œè¥¿ã€‚æœ‰æ—¶è¿™äº›æ˜¯å¾ˆé‡è¦çš„ â€”â€” æˆ‘ä»¬ç ´åäº† Slack çš„æ¯æ—¥æ´»è·ƒç”¨æˆ·ï¼ˆDAUï¼‰æŒ‡æ ‡ï¼ˆå“å‘€ï¼ï¼‰ã€‚ä¹Ÿæœ‰å¾ˆå¤šå°é—®é¢˜éœ€è¦è§£å†³ã€‚è´Ÿè½½å‡è¡¡å™¨çš„è¡Œä¸ºå¾ˆå¤æ‚ï¼Œé™¤äº†èŠ±æ—¶é—´è°ƒè¯•å¤–ï¼Œæ²¡æœ‰çœŸæ­£çš„åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¼€å§‹è¿ç§»æ—¶ï¼Œæ²¡æœ‰ä¸ºè´Ÿè½½å‡è¡¡å™¨çš„é…ç½®æä¾›æµ‹è¯•æ¡†æ¶ã€‚æˆ‘ä»¬æ²¡æœ‰è‡ªåŠ¨æµ‹è¯•æ¥éªŒè¯æµ‹è¯•çš„ URL è·¯ç”±åˆ°æ­£ç¡®çš„ç«¯ç‚¹ä»¥åŠä¸è¯·æ±‚å’Œå“åº”å¤´ç›¸å…³çš„è¡Œä¸ºï¼Œè€Œæ˜¯æœ‰&amp;hellip;&amp;hellip; ä¸€ä¸ª HAProxy é…ç½®ã€‚åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæµ‹è¯•æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥æä¾›å¾ˆå¤šå…³äºé¢„æœŸè¡Œä¸ºçš„åŸå› çš„èƒŒæ™¯ã€‚å› ä¸ºæˆ‘ä»¬ç¼ºä¹æµ‹è¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»å¸¸ä¸å¾—ä¸å‘æœåŠ¡æ‰€æœ‰è€…è¯¢é—®ï¼Œä»¥äº†è§£ä»–ä»¬æ‰€ä¾èµ–çš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å»ºç«‹çš„ Chef èµ„æºæœ‰æ„åªæ”¯æŒ Envoy åŠŸèƒ½çš„ä¸€ä¸ªå­é›†ã€‚è¿™ä½¿æˆ‘ä»¬çš„åº“æ›´ç®€å• â€”â€” æˆ‘ä»¬åªéœ€è¦è€ƒè™‘æˆ‘ä»¬å®é™…ä½¿ç”¨çš„åŠŸèƒ½ã€‚ç¼ºç‚¹æ˜¯ï¼Œæ¯æ¬¡æˆ‘ä»¬æƒ³ä½¿ç”¨æ–°çš„ Envoy åŠŸèƒ½æ—¶ï¼Œéƒ½å¿…é¡»åœ¨æˆ‘ä»¬çš„ Chef åº“ä¸­æ·»åŠ å¯¹è¿™äº›åŠŸèƒ½çš„æ”¯æŒã€‚ä¾‹å¦‚ï¼Œ&lt;a href=&#34;https://en.wikipedia.org/wiki/Server_Name_Indication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SNI&lt;/a&gt;ï¼ˆhttpsï¼‰ç›‘å¬å™¨æ˜¯åœ¨å¼€å‘è¿‡ç¨‹ä¸­ç¼–å†™çš„ï¼Œå½“æ—¶æˆ‘ä»¬è®¤ä¸ºè¿™æ¯”å‘ç°æœ‰çš„ç›‘å¬å™¨æ·»åŠ æ”¯æŒæ›´ç®€å•ã€‚ç„¶è€Œï¼Œå½“æ¶‰åŠåˆ° vhost æ”¯æŒæ—¶ï¼Œæˆ‘ä»¬å·²ç»å¼€å‘äº†å¾ˆå¤šä»£ç å¹¶åœ¨ä½¿ç”¨ä¸­ï¼Œé‡æ„æ•´ä¸ªå…¬å¸å…¶ä»–åœ°æ–¹æ­£åœ¨ä½¿ç”¨çš„èµ„æºå°†èŠ±è´¹å¾ˆé•¿æ—¶é—´ã€‚æˆ‘ä»¬çš„ Chef åº“ä¸­çš„ vhost æ”¯æŒæ˜¯ä¸€ä¸ª hackï¼ˆå¾ˆå¿«æœ‰ä¸€å¤©æˆ‘ä»¬ä¼šä¿®å¤å®ƒï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä½¿æ”¹å˜ Envoy èµ„æº Chef åº“æ›´åŠ å®‰å…¨ï¼Œæ¢å¥è¯è¯´ï¼Œç¡®ä¿æˆ‘ä»¬ä¸ä¼šç ´åå…¶ä»–ä½¿ç”¨æˆ‘ä»¬åº“çš„å›¢é˜Ÿï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€å¥—å…¨é¢çš„æµ‹è¯•ï¼Œç”Ÿæˆè¿™äº›å›¢é˜Ÿçš„æ•´ä¸ªé…ç½®ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°çŸ¥é“ï¼Œå½“æˆ‘ä»¬æ›´æ–° Envoy Chef èµ„æºæ—¶ï¼Œæˆ‘ä»¬ç”Ÿæˆçš„æ‰€æœ‰ Envoy é…ç½®ä¼šï¼ˆæˆ–ä¸ä¼šï¼‰å—åˆ°ä»€ä¹ˆå½±å“ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ¬¡è¿ç§»ï¼ˆå’Œå…¶ä»–è¿ç§»ä¸€æ ·ï¼‰çš„å…³é”®äº‹é¡¹ä¹‹ä¸€æ˜¯æ²Ÿé€šã€‚æˆ‘ä»¬åŠªåŠ›è®©æ¯ä¸ªäººéƒ½äº†è§£å¹¶é…åˆæˆ‘ä»¬æ­£åœ¨è¿›è¡Œçš„æ”¹å˜ã€‚æˆ‘ä»¬çš„å®¢æˆ·ä½“éªŒï¼ˆCEï¼‰å›¢é˜Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åˆä½œä¼™ä¼´ â€”â€” ä»–ä»¬èƒ½å¤Ÿç›‘æ§ä¼ å…¥çš„å·¥å•ï¼Œä»¥å‘ç°ä»»ä½•å¯èƒ½è¡¨æ˜ç”¨æˆ·å› è¿™æ¬¡è¿ç§»è€Œå—åˆ°å½±å“çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆ&#34;&gt;ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å°½ç®¡å¶å°”ä¼šé‡åˆ°ä¸€äº›å°æŒ«æŠ˜ï¼Œä½† envoy websocket çš„è¿ç§»è¿˜æ˜¯éå¸¸æˆåŠŸçš„ã€‚æˆ‘ä»¬å·²ç»è·Ÿè¿›ï¼Œå°†å¦ä¸€ä¸ªå…³é”®çš„ Slack æœåŠ¡ï¼Œå³æˆ‘ä»¬çš„è½¯ä»¶å®¢æˆ·ç«¯æŒ‡æ ‡æ‘„å–ç®¡é“ â€”â€” ä¸æˆ‘ä»¬çš„å…¶ä»–å…¥å£è´Ÿè½½å‡è¡¡å™¨éš”ç¦» â€”â€” è¿ç§»åˆ° Envoy Proxyã€‚æˆ‘ä»¬å‡ ä¹å·²ç»å®Œæˆäº†å°†æˆ‘ä»¬çš„ç½‘ç»œå’Œ API æµé‡çš„å†…éƒ¨è´Ÿè½½å‡è¡¡å™¨è¿ç§»åˆ° Envoyã€‚è¿™åœºå²è¯—èˆ¬çš„è¿ç§»çš„æœ€åä¸€éƒ¨åˆ†æ˜¯å°†æˆ‘ä»¬çš„ï¼ˆå¸¸è§„çš„ã€é websocket çš„ï¼‰HTTP å †æ ˆä» HAProxy è¿ç§»åˆ° Envoyï¼Œè¿™ä¹Ÿæ˜¯æ­£åœ¨è¿›è¡Œçš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡æ˜¯åœ¨å…¥å£è´Ÿè½½å‡è¡¡å™¨å’ŒæœåŠ¡ç½‘æ ¼æ•°æ®å¹³é¢ä¸Šå®ç° Envoy Proxy çš„æ ‡å‡†åŒ–ï¼Œè¿™å°†å¤§å¤§é™ä½å›¢é˜Ÿçš„è®¤çŸ¥è´Ÿè·å’Œæ“ä½œå¤æ‚æ€§ï¼Œå¹¶ä½¿ Envoy çš„å…ˆè¿›åŠŸèƒ½åœ¨æˆ‘ä»¬çš„è´Ÿè½½å‡è¡¡åŸºç¡€è®¾æ–½ä¸­å¾—åˆ°åº”ç”¨ã€‚è‡ªä»è¿ç§»åˆ° Envoy åï¼Œæˆ‘ä»¬å·²ç»å¤§å¤§è¶…è¿‡äº†ä»¥å‰çš„å³°å€¼è´Ÿè½½ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ç½‘æ˜“å¼€æº Envoy ä¼ä¸šçº§è‡ªå®šä¹‰æ‰©å±•æ¡†æ¶ Hango Rider ç®€ä»‹</title>
      <link>https://cloudnative.to/blog/hango-rider/</link>
      <pubDate>Thu, 10 Feb 2022 09:24:17 +0800</pubDate>
      <guid>https://cloudnative.to/blog/hango-rider/</guid>
      <description>&lt;p&gt;&lt;strong&gt;ä½œè€…ç®€ä»‹&lt;/strong&gt;ï¼šç‹å‡¯ï¼Œç½‘æ˜“æ•°å¸†é«˜çº§å·¥ç¨‹å¸ˆï¼Œä¸»è¦è´Ÿè´£è½»èˆŸå¾®æœåŠ¡ã€è½»èˆŸ API ç½‘å…³ç­‰ç›¸å…³äº§å“æ•°æ®é¢ç ”å‘ã€æ‰©å±•å¢å¼ºç­‰å·¥ä½œã€‚å¯¹äºæ•°æ®é¢ Envoy æ‰©å±•å¢å¼ºã€å®è·µè½åœ°å…·å¤‡ä¸°å¯Œçš„ç»éªŒã€‚&lt;/p&gt;
&lt;p&gt;å¯æ‰©å±•æ€§æ˜¯ç½‘ç»œä»£ç†è½¯ä»¶æœ€ä¸ºå…³é”®çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œçµæ´»å¼ºå¤§çš„å¯æ‰©å±•æ€§å¯ä»¥å¤§å¤§æ‹“å±•ç½‘ç»œä»£ç†è½¯ä»¶çš„èƒ½åŠ›è¾¹ç•Œã€‚ä½œä¸ºæ–°å…´çš„å¼€æºé«˜æ€§èƒ½ç½‘ç»œä»£ç†è½¯ä»¶ï¼ŒEnvoy æœ¬èº«æä¾›äº†ç›¸å¯¹ä¸°å¯Œçš„å¯æ‰©å±•èƒ½åŠ›ï¼Œå¦‚åŸºäº C++ çš„åŸç”Ÿæ‰©å±•ï¼ŒåŸºäº WASM/Lua çš„åŠ¨æ€æ‰©å±•ã€‚ä½†æ˜¯ Envoy ç°æœ‰å¯æ‰©å±•èƒ½åŠ›éƒ½å„è‡ªå­˜åœ¨å…¶å±€é™æ€§ã€‚åœ¨å¤§è§„æ¨¡è½åœ°å®è·µ Envoy ç½‘å…³/ç½‘æ ¼è¿‡ç¨‹ä¸­ï¼Œç½‘æ˜“æ•°å¸†ä¸º Envoy å®ç°äº†ä¸€å¥—åŸºäº Lua çš„ä¼ä¸šçº§è‡ªå®šä¹‰æ‰©å±•æ¡†æ¶-Riderï¼Œåº”ç”¨äºè½»èˆŸå¾®æœåŠ¡å¹³å°ï¼Œæ»¡è¶³ä¸šåŠ¡æ–¹æ‰€éœ€è¦çš„æ˜“å¼€å‘ã€é«˜æ€§èƒ½ã€åŠŸèƒ½ä¸°å¯Œç­‰å„é¡¹è¦æ±‚ã€‚
ç›®å‰ï¼Œ&lt;a href=&#34;https://github.com/hango-io/rider&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Rider&lt;/a&gt; æ‰©å±•æ¡†æ¶å·²ç»å…¨é¢å¼€æºï¼Œå¹¶ä¸”è¢«é›†æˆäºå¼€æº API ç½‘å…³ &lt;a href=&#34;https://github.com/hango-io/hango-gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Hango&lt;/a&gt; å½“ä¸­ï¼Œä¸º Hango ç½‘å…³æä¾›äº†çµæ´»ã€å¼ºå¤§ã€æ˜“ç”¨çš„è‡ªå®šä¹‰æ‰©å±•èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/hango-rider/000_hud068544e2ecba73232901d83c215d324_29890_41c9acce0e6ca9c274005931422ab137.webp 400w,
               /blog/hango-rider/000_hud068544e2ecba73232901d83c215d324_29890_9fcbc950c44748b3cf41fdaa91501c39.webp 760w,
               /blog/hango-rider/000_hud068544e2ecba73232901d83c215d324_29890_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/hango-rider/000_hud068544e2ecba73232901d83c215d324_29890_41c9acce0e6ca9c274005931422ab137.webp&#34;
               width=&#34;708&#34;
               height=&#34;285&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;1-envoy-çš„å¯æ‰©å±•æ€§ç°çŠ¶&#34;&gt;1. Envoy çš„å¯æ‰©å±•æ€§ç°çŠ¶&lt;/h2&gt;
&lt;p&gt;åœ¨äº’è”ç½‘ä½“ç³»ä¸‹ï¼Œå‡¡æ˜¯éœ€è¦å¯¹å¤–æš´éœ²çš„ç³»ç»Ÿå‡ ä¹éƒ½éœ€è¦ç½‘ç»œä»£ç†ï¼šè¾ƒæ—©å‡ºç°çš„ HAProxyã€Nginx è‡³ä»Šä»åœ¨æµè¡Œï¼›è¿›å…¥å¾®æœåŠ¡æ—¶ä»£åï¼ŒåŠŸèƒ½æ›´ä¸°å¯Œã€ç®¡æ§èƒ½åŠ›æ›´å¼ºçš„ API ç½‘å…³åˆæˆä¸ºæµé‡å…¥å£å¿…å¤‡ç»„ä»¶ã€‚Envoy å› ä¸ºå…¶ä¼˜å¼‚çš„æ€§èƒ½ã€å¯æ‰©å±•æ€§ã€å¯è§‚å¯Ÿæ€§ç­‰ä¼˜åŠ¿ï¼Œæˆä¸ºå¤§é‡ API ç½‘å…³çš„æ•°æ®é¢é€‰å‹ï¼Œå¹¶ä¸”é™¤äº†æµé‡ä»£ç†æ‰€éœ€çš„åŸºæœ¬åŠŸèƒ½å¤–ï¼ŒEnvoy åŸç”Ÿå·²ç»å®ç°äº†å¾ˆå¤šä»£ç†æ‰€éœ€é«˜çº§åŠŸèƒ½ï¼Œå¦‚é«˜çº§è´Ÿè½½å‡è¡¡ã€ç†”æ–­ã€é™æµç­‰ã€‚å› æ­¤ï¼ŒåŸºäº Envoy æ„å»ºçš„ API ç½‘å…³æœ¬èº«å·²ç»å…·å¤‡è¾ƒä¸ºä¸°å¯Œçš„åŠŸèƒ½ï¼Œèƒ½æ»¡è¶³å¤§éƒ¨åˆ†åº”ç”¨ä»£ç†çš„éœ€æ±‚ã€‚ä½†æ˜¯åœ¨ API ç½‘å…³çš„å®é™…ä½¿ç”¨åœºæ™¯ä¸­ï¼ŒæŸäº›åº”ç”¨æˆ–è€…ä¸šåŠ¡ä¼šæ ¹æ®è‡ªå·±çš„éœ€æ±‚æ‰©å±•å‡ºæ–°çš„åŠŸèƒ½ï¼Œå¯èƒ½æ˜¯å¯¹ HTTP çš„æŸäº› Header åšäº›ç®€å•çš„å¤„ç†ï¼Œä¹Ÿå¯èƒ½æ˜¯å¯¹æ¥è‡ªå·±çš„ APM ç­‰ï¼Œå› æ­¤ API ç½‘å…³å¿…é¡»å…·å¤‡å¯æ‰©å±•çš„èƒ½åŠ›ä»¥æ”¯æ’‘åº”ç”¨æˆ–è€…ä¸šåŠ¡æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ‰©å±•ç›¸åº”çš„åŠŸèƒ½ï¼Œè€Œè¿™ä¸ªèƒ½åŠ› Envoy ä¾ç„¶å¯ä»¥èƒœä»»ï¼Œå¯ä»¥è¯´åŸºäº Envoy å®ç°çš„ API ç½‘å…³çš„å¯æ‰©å±•æ€§å¼ºä¾èµ–äº Envoy æä¾›çš„å¯æ‰©å±•èƒ½åŠ›ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹ä¸€ä¸‹ç›®å‰ Envoy æä¾›çš„æ‰©å±•æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;11-åŸç”Ÿ-c-æ‰©å±•&#34;&gt;1.1 åŸç”Ÿ C++ æ‰©å±•&lt;/h3&gt;
&lt;p&gt;Envoy é€šè¿‡å¯æ’æ‹”çš„è¿‡æ»¤å™¨æœºåˆ¶å®ç°äº†åŸç”Ÿ C++ æ’ä»¶æ‰©å±•çš„èƒ½åŠ›ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒL4 è¿‡æ»¤å™¨è´Ÿè´£æ‰©å±•åè®®ä»£ç†èƒ½åŠ›åŠ L4 æµé‡æ²»ç†èƒ½åŠ›ï¼ŒL7 è¿‡æ»¤å™¨å®ç°å¯¹æµé‡çš„ä¸°å¯Œæ²»ç†åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/hango-rider/001_huda6021e5a7d2ae4f48956bc652f702e7_31403_a8889f51b4e5708b7319b7040580828d.webp 400w,
               /blog/hango-rider/001_huda6021e5a7d2ae4f48956bc652f702e7_31403_cd522ee7744cd01892d58df3327fd427.webp 760w,
               /blog/hango-rider/001_huda6021e5a7d2ae4f48956bc652f702e7_31403_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/hango-rider/001_huda6021e5a7d2ae4f48956bc652f702e7_31403_a8889f51b4e5708b7319b7040580828d.webp&#34;
               width=&#34;760&#34;
               height=&#34;272&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™ç§æ‰©å±•æ–¹å¼ç”±äºæ˜¯ Envoy åŸç”Ÿæä¾›çš„èƒ½åŠ›ï¼Œå› æ­¤æ€§èƒ½è‡ªç„¶æ˜¯æœ€ä½³çš„ï¼Œä½†åŒæ—¶é¢ä¸´ä¸¤ä¸ªä¸»è¦çš„é—®é¢˜ï¼Œä¸€ä¸ªæ˜¯æ’ä»¶å¼€å‘è€…éœ€è¦å…·æœ‰ C++ è¯­è¨€çš„å¼€å‘èƒ½åŠ›ï¼Œå¦å¤–æ˜¯æ’ä»¶å¼€å‘å®Œåéœ€è¦é‡æ–°ç¼–è¯‘ Envoy äºŒè¿›åˆ¶æ–‡ä»¶å†å‡çº§éƒ¨ç½²ï¼Œæ— æ³•åšåˆ°æ’ä»¶åŠŸèƒ½çš„åŠ¨æ€åŠ è½½ã€‚ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼ŒEnvoy ç¤¾åŒºé™†ç»­å®ç°äº†åŸºäº Lua å’Œ WASM çš„æ‰©å±•æœºåˆ¶ï¼Œæˆ‘ä»¬å…ˆçœ‹ç¤¾åŒº Lua æ‰©å±•çš„åŸç†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;12-ç¤¾åŒº-lua-æ‰©å±•&#34;&gt;1.2 ç¤¾åŒº Lua æ‰©å±•&lt;/h3&gt;
&lt;p&gt;è¦æƒ³ä½¿ç”¨ Lua è¯­è¨€å¼€å‘åŸæœ¬ä½¿ç”¨ C++ è¯­è¨€å®ç°çš„ Envoy æ’ä»¶ï¼Œç›´è§‚æ¥çœ‹éœ€è¦è€ƒè™‘ä»¥ä¸‹ä¸¤ç‚¹ï¼šä¸€ä¸ªæ˜¯ Lua è„šæœ¬å¦‚ä½•åœ¨ Envoy è¿›ç¨‹ä¸­æ‰§è¡Œï¼›å¦ä¸€ä¸ªæ˜¯ Lua è„šæœ¬å¦‚ä½•è·å¾— Envoy çš„å†…éƒ¨æ•°æ®å’ŒåŠŸèƒ½ï¼Œæ¯”å¦‚ Headerã€Body çš„è·å–ã€‚ä»è¿™ä¸¤ä¸ªè§’åº¦å‡ºå‘å¯ä»¥æ¯”è¾ƒæ¸…æ™°çš„çœ‹ä¸€ä¸‹ Envoy ç¤¾åŒº Lua æ‰©å±•çš„å®ç°ï¼ˆå…¶å® WASM å’Œ Rider ä¹Ÿæ˜¯ä»è¿™ä¸¤ä¸ªè§’åº¦å‡ºå‘ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹å›¾ï¼Œå’Œä¸Šé¢ä»‹ç»çš„åŸç”Ÿ C++ æ‰©å±•æ–¹æ¡ˆä¸åŒçš„æ˜¯åœ¨ Envoy çš„ä¸ƒå±‚æ’ä»¶ä¸­å¤šäº†ä¸ª Lua æ’ä»¶ï¼Œè€Œè¿™ä¸ªç”¨ C++ å¼€å‘çš„ Lua æ’ä»¶å°±æ˜¯å›ç­”ä¸Šé¢ä¸¤ä¸ªé—®é¢˜çš„å…³é”®ã€‚é¦–å…ˆ Lua è„šæœ¬å¦‚ä½•åœ¨ Envoy è¿›ç¨‹ä¸­æ‰§è¡Œï¼Œç­”æ¡ˆæ˜¯é€šè¿‡ Lua æ’ä»¶ï¼ŒEnvoy çš„ Lua æ’ä»¶æœ¬èº«ä¾ç„¶æ˜¯ç”¨ C++ å¼€å‘çš„ï¼Œå› æ­¤å¯ä»¥åœ¨ Lua æ’ä»¶ä¸­åŠ è½½å¹¶è¿è¡Œ Lua è„šæœ¬ï¼›å…¶æ¬¡æ˜¯ Lua è„šæœ¬å¦‚ä½•è·å¾— Envoy çš„å†…éƒ¨æ•°æ®å’ŒåŠŸèƒ½ï¼Œç­”æ¡ˆæ˜¯ Lua æ’ä»¶ä¼šé€šè¿‡ Lua CAPI çš„å½¢å¼æä¾› Envoy å†…éƒ¨æ•°æ®å’ŒåŠŸèƒ½ç»™ Lua è„šæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/hango-rider/002_hua1fac75071c8379a6a80e88e85895623_30201_b8e1fad6b21b547c94f748a2e6524358.webp 400w,
               /blog/hango-rider/002_hua1fac75071c8379a6a80e88e85895623_30201_5d08ee321a6a7ebc048de3603985c21e.webp 760w,
               /blog/hango-rider/002_hua1fac75071c8379a6a80e88e85895623_30201_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/hango-rider/002_hua1fac75071c8379a6a80e88e85895623_30201_b8e1fad6b21b547c94f748a2e6524358.webp&#34;
               width=&#34;760&#34;
               height=&#34;245&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç¤¾åŒº Lua æ‰©å±•ä¸€æ–¹é¢æä¾›ç»™äº†ç”¨æˆ·åŸºäº Lua è¯­è¨€å¼€å‘æ’ä»¶çš„èƒ½åŠ›ï¼Œç›¸æ¯” C++ è¦ç®€å•å¾ˆå¤šï¼Œå¦ä¸€æ–¹é¢æ”¯æŒ Envoy åŠ¨æ€åŠ è½½ Lua è„šæœ¬ï¼Œæ— éœ€é‡æ–°ç¼–è¯‘å‡çº§ã€‚ä½†åŒæ—¶ç”±äº C++ å’Œ Lua è™šæ‹Ÿæœºäº¤äº’å¸¦æ¥çš„å¼€é”€ï¼ŒLua æ‰©å±•çš„æ€§èƒ½è‡ªç„¶ä¼šæ¯”åŸç”Ÿ C++ æ‰©å±•å·®ï¼Œè€Œä¸” Envoy ç¤¾åŒºå½“å‰çš„ Lua CAPI äº¤äº’æ–¹å¼ä¼šè¿›ä¸€æ­¥åŠ å‰§æ€§èƒ½é—®é¢˜ã€‚é™¤äº†æ€§èƒ½é—®é¢˜ï¼Œç¤¾åŒºçš„ Lua æ‰©å±•è¿˜æœ‰ä¸ªæ›´å¤§çš„ç¼ºé™· â€”â€” ä¸æ”¯æŒæ’ä»¶é…ç½®ï¼Œç›´æ¥å¯¼è‡´ç¤¾åŒº Lua æ‰©å±•çš„å®ç”¨æ€§å¤§å¤§ä¸‹é™ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒWASM å’Œ Rider å®ç°äº†æ’ä»¶çš„å¯é…ç½®åŒ–ï¼Œå¹¶ä¸” Rider é’ˆå¯¹ Lua æ‰©å±•çš„æ€§èƒ½åšäº†ä¸€å®šçš„ä¼˜åŒ–ï¼Œä½¿å¾— Rider çš„ Lua æ‰©å±•åœ¨æ€§èƒ½å’ŒåŠŸèƒ½æ–¹é¢éƒ½èƒ½æ»¡è¶³ä¼ä¸šçº§æ‰©å±•çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;13-ç¤¾åŒº-wasm-æ‰©å±•&#34;&gt;1.3 ç¤¾åŒº WASM æ‰©å±•&lt;/h3&gt;
&lt;p&gt;WASM æ˜¯æºè‡ªå‰ç«¯çš„æŠ€æœ¯ï¼Œæ˜¯ä¸ºäº†è§£å†³æ—¥ç›Šå¤æ‚çš„å‰ç«¯ Web åº”ç”¨ä»¥åŠæœ‰é™çš„ JS è„šæœ¬è§£é‡Šæ€§èƒ½è€Œè¯ç”Ÿçš„æŠ€æœ¯ã€‚WASM å¹¶ä¸æ˜¯ä¸€ç§è¯­è¨€ï¼Œè€Œæ˜¯å­—èŠ‚ç æ ‡å‡†ã€‚ç†è®ºä¸Šä»»ä½•ä¸€ç§è¯­è¨€ï¼Œéƒ½å¯ä»¥è¢«ç¼–è¯‘æˆ WASM å­—èŠ‚ç ï¼Œç„¶ååœ¨ WASM è™šæ‹Ÿæœºä¸­æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;WASM æ‰©å±•çš„å®ç°åŸç†å’Œ Lua æ‰©å±•æœ¬è´¨ä¸Šå·®ä¸å¤šï¼Œåœ¨ Envoy è‡ªèº«çš„å››å±‚æˆ–è€…ä¸ƒå±‚æ’ä»¶ä¸­ä¼šå®ç°ä¸€ä¸ª WASM æ’ä»¶ï¼Œè¯¥æ’ä»¶ä¼šåµŒå…¥ WASM è™šæ‹Ÿæœºç”¨äºåŠ¨æ€åŠ è½½å’Œè¿è¡Œå¯æ‹”æ’çš„æ‰©å±•ä»£ç ï¼ˆè¢«ç¼–è¯‘ä¸º WASM å­—èŠ‚ç ï¼‰ï¼Œå¹¶ä¸”ä¹Ÿä¼šé€šè¿‡ WASM è™šæ‹Ÿæœºæš´éœ²è·å– Envoy å†…éƒ¨æ•°æ®å’ŒåŠŸèƒ½çš„æ¥å£ã€‚å…¶åŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/hango-rider/003_hu4cef6522171451d36f81dfcb97a2193c_63279_272302fefc414aacaccdf22ff8ebd632.webp 400w,
               /blog/hango-rider/003_hu4cef6522171451d36f81dfcb97a2193c_63279_761caf0d6871cf996b9995750005cc41.webp 760w,
               /blog/hango-rider/003_hu4cef6522171451d36f81dfcb97a2193c_63279_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/hango-rider/003_hu4cef6522171451d36f81dfcb97a2193c_63279_272302fefc414aacaccdf22ff8ebd632.webp&#34;
               width=&#34;760&#34;
               height=&#34;224&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;WASM çœ‹ä¸Šå»ä¼¼ä¹å®Œç¾è§£å†³äº† Envoy å¯æ‰©å±•æ€§é‡åˆ°çš„å„ç§é—®é¢˜ï¼Œå®ƒæ”¯æŒå¤šè¯­è¨€ï¼Œæ”¯æŒæ’ä»¶åŠ¨æ€åŠ è½½ï¼ŒåŒæ—¶æ”¯æŒæ’ä»¶é…ç½®ï¼Œä½†æ˜¯ç»è¿‡æˆ‘ä»¬çš„æµ‹è¯•ï¼ŒWASM å€’åœ¨äº†æ€§èƒ½çš„è¡€æ³Šä¸­ï¼Œå®ƒåŸºäº C++ æ‰©å±•çš„æ’ä»¶æ€§èƒ½ç”šè‡³éƒ½è¦æ¯” Lua æ‰©å±•å·®ï¼Œæ›´ä¸ç”¨è¯´åŸºäºå…¶ä»–è¯­è¨€å®ç°çš„æ’ä»¶ï¼ˆå…·ä½“çš„æ€§èƒ½å¯¹æ¯”ç»“æœä¼šåœ¨ç¬¬ä¸‰éƒ¨åˆ†ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;14-æ€»ç»“&#34;&gt;1.4 æ€»ç»“&lt;/h3&gt;
&lt;p&gt;å¦‚ä¸‹è¡¨ï¼Œæˆ‘ä»¬æ€»ç»“äº†å½“å‰å„ç§æ‰©å±•æ€§æ–¹æ¡ˆçš„ç‰¹æ€§ï¼šåŸç”Ÿ C++ æ‰©å±•è™½ç„¶æ€§èƒ½æœ€ä¼˜ï¼Œä½†æ˜¯ä¸æ”¯æŒæ’ä»¶çš„åŠ¨æ€åŠ è½½ï¼›ç¤¾åŒº Lua æ‰©å±•æ”¯æŒäº†æ’ä»¶çš„åŠ¨æ€åŠ è½½ï¼Œä½†æ˜¯å´ä¸æ”¯æŒæ’ä»¶é…ç½®ï¼Œå‡ ä¹ä¸å¯ä½¿ç”¨ï¼›ç¤¾åŒº WASM æ‰©å±•æ—¢æ”¯æŒæ’ä»¶çš„åŠ¨æ€åŠ è½½ï¼Œåˆæ”¯æŒæ’ä»¶é…ç½®ï¼Œä½†æ˜¯æ€§èƒ½å¾ˆå·®ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ‰©å±•æ–¹æ¡ˆ&lt;/th&gt;
&lt;th&gt;æ˜¯å¦æ”¯æŒæ’ä»¶é…ç½®&lt;/th&gt;
&lt;th&gt;æ˜¯å¦æ”¯æŒåŠ¨æ€æ‰©å±•&lt;/th&gt;
&lt;th&gt;æ€§èƒ½&lt;/th&gt;
&lt;th&gt;æ”¯æŒè¯­è¨€&lt;/th&gt;
&lt;th&gt;å¼€å‘å¤æ‚åº¦&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;åŸç”Ÿ C++&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;æœ€ä¼˜&lt;/td&gt;
&lt;td&gt;C++&lt;/td&gt;
&lt;td&gt;å¤æ‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç¤¾åŒº Lua&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;è¾ƒå·®&lt;/td&gt;
&lt;td&gt;Lua&lt;/td&gt;
&lt;td&gt;ç®€å•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç¤¾åŒº WASM&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;å·®&lt;/td&gt;
&lt;td&gt;C++/Rust/Go ç­‰&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ ¹æ®ä¸Šè¿°å„ç§æ‰©å±•æ€§æ–¹æ¡ˆçš„ä¼˜åŠ£åŠ¿ï¼Œç½‘æ˜“è½»èˆŸå¾®æœåŠ¡è®¾è®¡å¹¶å®ç°äº†è‡ªå·±çš„å¯æ‰©å±•æ¡†æ¶ Riderï¼Œä¸»è¦çš„è®¾è®¡ç›®æ ‡å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒ Lua è¯­è¨€æ‰©å±•&lt;/li&gt;
&lt;li&gt;æ”¯æŒ Envoy åŠ¨æ€åŠ è½½ã€æ›´æ–°ã€ç§»é™¤ Lua æ’ä»¶&lt;/li&gt;
&lt;li&gt;æ”¯æŒå®šä¹‰ Lua æ’ä»¶é…ç½®&lt;/li&gt;
&lt;li&gt;æ”¯æŒè‡ªå®šä¹‰ Lua æ’ä»¶ç”Ÿæ•ˆèŒƒå›´ï¼Œç½‘å…³çº§/é¡¹ç›®çº§/è·¯ç”±çº§&lt;/li&gt;
&lt;li&gt;æ€§èƒ½ä¼˜äº Envoy ç¤¾åŒº Lua æ‰©å±•å’Œ WASM æ‰©å±•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥ä¸‹æ¥å…·ä½“çœ‹ä¸€ä¸‹ Rider å¯æ‰©å±•æ¡†æ¶çš„è®¾è®¡ã€ä¼˜åŒ–åŠå®è·µã€‚&lt;/p&gt;
&lt;h2 id=&#34;2-rider-å¯æ‰©å±•æ¡†æ¶çš„è®¾è®¡ä¼˜åŒ–åŠå®è·µ&#34;&gt;2. Rider å¯æ‰©å±•æ¡†æ¶çš„è®¾è®¡ã€ä¼˜åŒ–åŠå®è·µ&lt;/h2&gt;
&lt;h3 id=&#34;21-æ—©æœŸæ¢ç´¢&#34;&gt;2.1 æ—©æœŸæ¢ç´¢&lt;/h3&gt;
&lt;p&gt;é’ˆå¯¹ç¤¾åŒº Lua æ‰©å±•å­˜åœ¨çš„æ€§èƒ½å·®ã€ä¸æ”¯æŒæ’ä»¶é…ç½®çš„é—®é¢˜ï¼ŒRider æ—©æœŸæ¶æ„è®¾è®¡å¹¶å®ç°äº†ä¸¤ä¸ªæ¨¡å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Rider Filterï¼šRider Filter æ˜¯ Envoy çš„ä¸ƒå±‚æ’ä»¶ï¼Œç”¨äºåˆå§‹åŒ–å’Œè°ƒç”¨ Lua ä»£ç ï¼Œå¹¶ä¸”å°† Envoy å†…éƒ¨çš„æ•°æ®å’ŒåŠŸèƒ½é€šè¿‡ Lua CAPI æˆ– FFI æ¥å£çš„å½¢å¼æä¾›ç»™ Lua SDK è°ƒç”¨ã€‚æ³¨æ„è¿™é‡Œ Rider åˆ©ç”¨ FFI å®ç°äº†å¤§éƒ¨åˆ†æ¥å£ï¼Œç†è®ºä¸Šæ€§èƒ½ä¼˜äºåŸºäº CAPI å®ç°çš„ç¤¾åŒº Lua æ‰©å±•ï¼›&lt;/li&gt;
&lt;li&gt;Lua SDKï¼šLua SDK æ˜¯ä¸€ä¸ª Lua æ’ä»¶ä»£ç æ¡†æ¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è°ƒç”¨ Lua SDK æä¾›çš„ API å®ç°è¯·æ±‚å¤„ç†ã€‚æ³¨æ„ Lua SDK æä¾›äº†è·å–å…¨å±€ä»¥åŠè·¯ç”±çº§æ’ä»¶é…ç½®çš„ APIï¼Œä½¿å¾— Rider çš„ Lua æ‰©å±•æ”¯æŒæ’ä»¶é…ç½®çš„è·å–ï¼Œè§£å†³äº†ç¤¾åŒº Lua æ‰©å±•çš„å¤§éš¾é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹å›¾æ˜¯æ•´ä½“çš„æ¶æ„å›¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/hango-rider/004_hubc5f5af8f9dbb225d7b49183134b4b4b_109708_c1a248771ef97fdfc69874894eafb335.webp 400w,
               /blog/hango-rider/004_hubc5f5af8f9dbb225d7b49183134b4b4b_109708_3814c427d420be230291646244d7ee24.webp 760w,
               /blog/hango-rider/004_hubc5f5af8f9dbb225d7b49183134b4b4b_109708_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/hango-rider/004_hubc5f5af8f9dbb225d7b49183134b4b4b_109708_c1a248771ef97fdfc69874894eafb335.webp&#34;
               width=&#34;760&#34;
               height=&#34;597&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å°½ç®¡æˆ‘ä»¬çš„æ—©æœŸæ¶æ„åŸºæœ¬æ»¡è¶³äº† Envoy å¯æ‰©å±•æ€§çš„éœ€æ±‚ï¼šæ”¯æŒå¤šè¯­è¨€ Luaã€æ”¯æŒ Lua æ’ä»¶åŠ¨æ€åŠ è½½ã€æ”¯æŒ Lua æ’ä»¶é…ç½®ç­‰ã€‚ä½†æ˜¯ä»ç„¶å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Rider Filter ä»ç„¶å­˜åœ¨éƒ¨åˆ†æ¥å£æ²¡æœ‰ä½¿ç”¨ FFIï¼Œæ€§èƒ½å¯èƒ½ç•¥æœ‰ä¸è¶³ï¼›&lt;/li&gt;
&lt;li&gt;Lua SDK éœ€è¦è¿›ä¸€æ­¥å®Œå–„ä»¥æ”¯æŒæ›´å¤šçš„æ’ä»¶åŠŸèƒ½å¼€å‘ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜è¿‡ç¨‹ä¸­å‘ç°çš„ Rider å·¨å¤§æ€§èƒ½é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é’ˆå¯¹è¿™å‡ ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥ç»†åŒ–äº† Rider çš„æ¶æ„ï¼Œè¯¦ç»†åˆ†æäº† Rider çš„æ€§èƒ½ï¼Œå¹¶è¡ç”Ÿå‡ºäº†æ–°çš„æ¶æ„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;22-å®è·µä¼˜åŒ–&#34;&gt;2.2 å®è·µä¼˜åŒ–&lt;/h3&gt;
&lt;p&gt;Rider æ–°æ¶æ„è¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯è¯•å›¾å°† FFI è¿›è¡Œåˆ°åº•ï¼Œæ ¹æ®ä¹‹å‰çš„è°ƒç ”ï¼ŒLua è°ƒç”¨ C æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡åŸç”Ÿçš„ CAPIï¼Œæ¯æ¬¡è°ƒç”¨æ—¶éƒ½ä¼šåˆ†é…ä¸€ä¸ªæ ˆç©ºé—´ (å’Œ Stack Frame ä¸åŒï¼Œæ˜¯å‘ Heap ç”³è¯·çš„ä¸€å—è¿ç»­å†…å­˜)ï¼Œé€šè¿‡æ ˆç©ºé—´ä¼ é€’å‚æ•°å’Œè¿”å›å€¼ã€‚å¦ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡ Luajit æä¾›çš„ FFI è°ƒç”¨ã€‚FFI çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥ç›´æ¥åœ¨ Lua ä¸­è°ƒç”¨ C å‡½æ•°ï¼Œä½¿ç”¨ C æ•°æ®ç»“æ„ï¼Œä»£ç å¯ä»¥è·å¾— Jit ä¼˜åŒ–çš„ Buffï¼Œæ€§èƒ½è¾ƒåŸç”Ÿçš„ Lua æœ‰æ¯”è¾ƒå¤§çš„æå‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æƒ³æŠŠ Rider ä¸­ä½¿ç”¨ CAPI å®ç°çš„æ¥å£æ”¹é€ æˆ FFIã€‚&lt;/p&gt;
&lt;p&gt;æ”¹é€ çš„ç¬¬ä¸€æ­¥ä¾¿é‡åˆ°äº†é—®é¢˜ï¼Œæ—©æœŸçš„ Rider æ¶æ„è²Œä¼¼æ— æ³•ä½¿ç”¨ FFI å®ç° Envoy Body ç›¸å…³æ¥å£çš„æš´éœ²ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æ—©æœŸ Rider ä¸å¾—ä¸ä½¿ç”¨åŸç”Ÿçš„ CAPI æš´éœ² Envoy Body ç›¸å…³æ¥å£çš„åŸå› ã€‚æ—©æœŸ Rider çš„æ¶æ„å›¾ä¸­ Lua Code æœ‰ä¸¤ä¸ªä¸»è¦çš„å‡½æ•°ï¼šon_request å’Œ on_responseï¼Œè¿™ä¸¤ä¸ªå‡½æ•°æ˜¯ Rider æ¶æ„è§„å®šçš„ Lua ä»£ç ä¸­éœ€è¦å®ç°çš„å‡½æ•°ï¼Œå› ä¸º Rider Filter åœ¨æ‰§è¡Œ Lua Code æ—¶ï¼ŒRider Filter åªä¼šå°è¯•ä» Lua è™šæ‹Ÿæœºä¸­è·å–è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œç„¶ååˆ†åˆ«åœ¨ decodeHeaders é˜¶æ®µå’Œ encodeHeaders é˜¶æ®µæ‰§è¡Œï¼Œé‚£ä¹ˆå¦‚æœåœ¨ on_request æˆ–è€… on_response å‡½æ•°ä¸­æœ‰ Body ç›¸å…³çš„æ¥å£è°ƒç”¨ï¼Œæ­¤æ—¶ Rider Filter è¿˜æ²¡æ‰§è¡Œåˆ° decodeData æˆ–è€… encodeData é˜¶æ®µï¼ŒBody çš„æ•°æ®è¿˜è·å–ä¸åˆ°ï¼Œåªèƒ½å°† Lua åç¨‹å…ˆæŒ‚èµ·ï¼Œç­‰åˆ° Rider Filter æ‰§è¡Œåˆ° decodeData æˆ–è€… encodeData é˜¶æ®µæ—¶å† Resumeï¼Œè€Œè¿™ç§æ–¹å¼ FFI å®ç°ä¸äº†ï¼Œåªèƒ½é€šè¿‡å’Œ Lua è™šæ‹Ÿæœºäº¤äº’çš„æ–¹å¼å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/hango-rider/005_hu3726cd9308e2b4b8c39fd3a97f66f6f5_74059_14f43dbbfbff4ed131a81f8552a1d79b.webp 400w,
               /blog/hango-rider/005_hu3726cd9308e2b4b8c39fd3a97f66f6f5_74059_c9cdfdb44f601612c343272b6843fd05.webp 760w,
               /blog/hango-rider/005_hu3726cd9308e2b4b8c39fd3a97f66f6f5_74059_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/hango-rider/005_hu3726cd9308e2b4b8c39fd3a97f66f6f5_74059_14f43dbbfbff4ed131a81f8552a1d79b.webp&#34;
               width=&#34;760&#34;
               height=&#34;681&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åŸºäºä¸Šè¿°é—®é¢˜ï¼ŒRider æ–°æ¶æ„åœ¨æ—©æœŸæ¶æ„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€äº›ç»†åŒ–ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•´ä½“æ¶æ„çš„æ¨¡å—æ²¡æœ‰æ”¹å˜ï¼Œæ”¹å˜çš„æ˜¯ Rider æ¡†æ¶è§„å®šçš„ Lua æ’ä»¶ä¸­éœ€è¦å®ç°çš„å‡½æ•°ä»¥åŠè¿™äº›å‡½æ•°åœ¨ Rider Filter ä¸­çš„æ‰§è¡Œæ—¶æœºã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå°†åŸæ¥ on_request å’Œ on_response å‡½æ•°è¿›ä¸€æ­¥æ‹†åˆ†æˆ Header å’Œ Body çš„é˜¶æ®µå‡½æ•°ï¼Œå¹¶ä¸”åœ¨ Rider Filter å¤„ç† Header å’Œ Body é˜¶æ®µåˆ†åˆ«å»è°ƒç”¨ï¼Œè¿™æ ·å¯ä»¥é¿å… Body çš„å¤„ç†éœ€è¦æŒ‚èµ· Lua åç¨‹ï¼ˆåæ¥å‘ç° WASM çš„å®ç°ä¹Ÿæ˜¯ç±»ä¼¼çš„ç»†åˆ†ï¼‰ã€‚å› æ­¤æ–°æ¶æ„çš„è¯·æ±‚å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Rider æ’ä»¶é…ç½® (å…¶ä¸­åŒ…å« Lua æ’ä»¶é…ç½®) ä½œä¸º LDS å’Œ RDS çš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡ Pilot ä¸‹å‘ï¼›&lt;/li&gt;
&lt;li&gt;Envoy å¯¹æ¯ä¸ª HTTP è¯·æ±‚æ„é€ ä¸€æ¡ä¸ƒå±‚ Filter Chain, å…¶ä¸­åŒ…å« Rider Filterã€‚Rider Filter åˆå§‹åŒ–æ—¶ï¼Œä¼šå°† Lua SDK æ¨¡å—å’Œç›¸åº”çš„æ’ä»¶ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½åˆ° Lua VM ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨è¯·æ±‚å¤„ç†é˜¶æ®µï¼ŒRider Filter ä¼šåœ¨ Decode å’Œ Encode é˜¶æ®µåˆ†åˆ«è°ƒç”¨ Lua ä»£ç çš„ on_request_headerã€on_request_body å’Œ on_response_headerã€on_response_body æ–¹æ³•ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ç”¨æˆ· Lua ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ Lua SDK è°ƒç”¨ Rider Filter å°è£…çš„ç›¸åº”æ¥å£ï¼Œå¦‚è·å–ï¼Œä¿®æ”¹è¯·æ±‚ã€å“åº”ä¿¡æ¯ï¼Œè°ƒç”¨å¤–éƒ¨æœåŠ¡ç­‰ï¼Œæ‰“å°æ—¥å¿—ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;221-æ€§èƒ½ä¼˜åŒ–&#34;&gt;2.2.1 æ€§èƒ½ä¼˜åŒ–&lt;/h4&gt;
&lt;p&gt;æ–°æ¶æ„è®¾è®¡çš„åˆè¡·æ˜¯æ€§èƒ½çš„æå‡ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ–°æ¶æ„å¼€å‘å®Œç¬¬ä¸€æ—¶é—´ä¾¿è¿›è¡Œäº†æ€§èƒ½æµ‹è¯•ï¼Œæµ‹è¯•åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¯å¢ƒï¼šæœ¬åœ°å®¹å™¨ç¯å¢ƒ&lt;/li&gt;
&lt;li&gt;åç«¯ï¼šNginx 4 æ ¸&lt;/li&gt;
&lt;li&gt;Envoyï¼š4 æ ¸&lt;/li&gt;
&lt;li&gt;Clientï¼šWrk 4t 32c&lt;/li&gt;
&lt;li&gt;Lua æ’ä»¶ï¼šè°ƒç”¨ 100 æ¬¡ get_body æ¥å£&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹æ¯”å®ç°æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CAPIï¼šRider çš„ CAPI å®ç°ï¼ŒåŸå§‹çš„ Lua å’Œ C çš„äº¤äº’æ–¹å¼ï¼Œé€šè¿‡æ ˆç©ºé—´ä¼ é€’å‚æ•°å’Œè¿”å›å€¼ï¼›&lt;/li&gt;
&lt;li&gt;FFIOldï¼šRider çš„æ—©æœŸ FFI å®ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æµ‹è¯•ç»“æœå¦‚ä¸‹å›¾ï¼Œç»å…¸è´Ÿä¼˜åŒ–ï¼Œè€Œä¸”è´Ÿçš„å¾ˆå¤šï¼ˆå½“ç„¶ä¹Ÿæ˜¯å› ä¸ºè°ƒç”¨äº† 100 æ¬¡çš„åŸå› ï¼‰ï¼ŒFFIOld ç›¸æ¯” CAPI QPS ä¸‹é™äº† 30%ã€‚ç¬¬ä¸€æƒ³æ³•æ˜¯ä¸æ˜¯ä»£ç å†™çš„æœ‰é—®é¢˜ï¼Œæ–°æ¶æ„å¼•å…¥äº†å¾ˆå¤šå¼€é”€ï¼Ÿæ‰€ä»¥åˆæµ‹è¯•äº†ä¸€ä¸‹ Rider ä¹‹å‰åŸºäº FFIOld å®ç°çš„ Header APIï¼Œæ€§èƒ½å’ŒåŸºäº FFIOld å®ç°çš„ Body API å·®ä¸å¤šï¼Œé‚£è¯´æ˜ FFIOld å‡ºé—®é¢˜äº†ï¼Œæ—©æœŸçš„ Rider FFI å®ç°çš„ API å¯èƒ½æ€§èƒ½éƒ½è¿˜ä¸å¦‚ CAPIï¼&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/hango-rider/006_hu34c5620f4f05ba05876b80b347eebd11_195966_4cfef43a51e2e0eb46d392728337b388.webp 400w,
               /blog/hango-rider/006_hu34c5620f4f05ba05876b80b347eebd11_195966_41f30e0510e78c101bc3ec3cbeffe587.webp 760w,
               /blog/hango-rider/006_hu34c5620f4f05ba05876b80b347eebd11_195966_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/hango-rider/006_hu34c5620f4f05ba05876b80b347eebd11_195966_4cfef43a51e2e0eb46d392728337b388.webp&#34;
               width=&#34;760&#34;
               height=&#34;427&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;äºæ˜¯å»äº†è§£äº†ä¸€ä¸‹ FFI çš„åŸºæœ¬åŸç†ï¼ŒFFI æ˜¯ Luajit æä¾›çš„ç‰¹æ€§ï¼ŒLuajit æ˜¯è¿è¡Œ Lua çš„è™šæ‹Ÿæœºï¼Œå’Œ Java è™šæ‹Ÿæœºä¸€æ ·ï¼ŒLuajit æœ‰ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼šç¼–è¯‘æ¨¡å¼å’Œè§£é‡Šæ¨¡å¼ï¼ˆç¼–è¯‘æ¨¡å¼çš„æ€§èƒ½æ¯”è§£é‡Šæ¨¡å¼å¥½ï¼ŒåŸå› æ„Ÿå…´è¶£å¯è‡ªè¡ŒæŸ¥æ‰¾ï¼‰ã€‚Luajit é»˜è®¤è¿è¡Œåœ¨è§£é‡Šæ¨¡å¼ä¸‹ï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šè®°å½•å¯ä»¥ç¼–è¯‘çš„çƒ­ç‚¹ä»£ç ï¼Œåœ¨ä¹‹åçš„è¿è¡Œä¸­ä¼šå°è¯•æŠŠçƒ­ç‚¹ä»£ç ç›´æ¥ç¿»è¯‘æˆæœºå™¨ç æ‰§è¡Œï¼Œæ€§èƒ½ä¼šå¾—åˆ°æå‡ã€‚&lt;/p&gt;
&lt;p&gt;å›åˆ° Rider ä¸­æ¥ï¼ŒRider çš„ Lua æ’ä»¶ä¹Ÿæ˜¯è¿è¡Œåœ¨ Luajit è™šæ‹Ÿæœºä¸­ï¼Œå¹¶ä¸”å‡ ä¸‡çš„ QPS è¯·æ±‚ä¸€å®šä¼šä½¿ Lua æ’ä»¶ä»£ç æˆä¸ºçƒ­ç‚¹ä»£ç ï¼Œé‚£ä¹ˆ Luajit ä¼šå°è¯•æŠŠ Lua æ’ä»¶ç¿»è¯‘æˆæœºå™¨ç ï¼ŒåŒæ—¶ FFI å®šä¹‰çš„ C å‡½æ•°ä¹Ÿä¼šè¢«ç¿»è¯‘æˆæœºå™¨ç è¢«æ‰§è¡Œï¼Œè¿™ä¹ˆçœ‹èµ·æ¥æ€§èƒ½ç¡®å®ä¼šæå‡ï¼Œä½†å®é™…ä¸ç¬¦åˆé¢„æœŸï¼ŒåŸå› åœ¨äº Luajit ä¼š &lt;strong&gt;å°è¯•&lt;/strong&gt; æŠŠçƒ­ç‚¹ä»£ç ç¿»è¯‘æˆæœºå™¨ç ï¼Œå°è¯•å°±å¯èƒ½ä¸æˆåŠŸï¼Œä¸æˆåŠŸå°±ä¼šé€€åŒ–æˆè§£é‡Šæ¨¡å¼ï¼Œé‚£ä¹ˆæ€§èƒ½ä¼šå¤§æ‰“æŠ˜æ‰£ã€‚Luajit æä¾›äº†ç¡®è®¤ç¨‹åºæ˜¯å¦è¿è¡Œåœ¨ç¼–è¯‘æ¨¡å¼ä¸‹çš„æ–¹æ³•ï¼Œåœ¨ Lua ä»£ç çš„å‰é¢åŠ ä¸Šå¦‚ä¸‹ä»£ç ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;local verbo = require(&amp;#34;jit.v&amp;#34;)
verbo.start()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç„¶åç»§ç»­å‹æµ‹ï¼Œå‘ç° Luajit è¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/hango-rider/007_hu53a3af6b1dfd514bca4cf5b50ebbd19d_196291_1decf1fda3d3d78bf9bebd311b338356.webp 400w,
               /blog/hango-rider/007_hu53a3af6b1dfd514bca4cf5b50ebbd19d_196291_7a7cb59e56f223587ba2489686a7c941.webp 760w,
               /blog/hango-rider/007_hu53a3af6b1dfd514bca4cf5b50ebbd19d_196291_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/hango-rider/007_hu53a3af6b1dfd514bca4cf5b50ebbd19d_196291_1decf1fda3d3d78bf9bebd311b338356.webp&#34;
               width=&#34;760&#34;
               height=&#34;131&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™å¼ å›¾å¯ä»¥çœ‹å‡ºä¸¤ä¸ªå…³é”®ä¿¡æ¯ï¼Œä¸€ä¸ªæ˜¯å¦‚æœ TRACE è¾“å‡º &amp;mdash; ï¼Œé‚£ä¹ˆè¯´æ˜ Luajit é€€å‡ºäº†ç¼–è¯‘æ¨¡å¼ï¼›å¦ä¸€ä¸ªæ˜¯é€€å‡ºç¼–è¯‘æ¨¡å¼çš„åŸå› æ˜¯ FFI å®šä¹‰çš„ C å‡½æ•°ä¸­çš„æŸä¸ªå½¢å‚ç±»å‹è½¬æ¢ä¸æ”¯æŒã€‚æ¥ç€å¾€ä¸‹å®šä½åˆ°è¿™ä¸ªå‚æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;local&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_header_map_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;local&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_context_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;no context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;~=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;string&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;header name must be a string&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;local&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ffi_new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;envoy_lua_ffi_str_t[1]&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;local&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;envoy_http_lua_ffi_get_header_map_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;~=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FFI_OK&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ffi_str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;C.envoy_http_lua_ffi_get_header_map_value(ctx, source, key, #key, buffer) ä¸­ä¼ å…¥çš„ ctx æ˜¯ Lua çš„ light userdata ç±»å‹ï¼Œè€Œ envoy_http_lua_ffi_get_header_map_value å‡½æ•°å£°æ˜çš„æ—¶å€™æ˜¯æŸä¸ªç±»çš„æŒ‡é’ˆç±»å‹ï¼ŒLuajit åœ¨ç¿»è¯‘çš„æ—¶å€™æ— æ³•å®Œæˆè½¬æ¢å› æ­¤é€€å‡ºäº†ç¼–è¯‘æ¨¡å¼ã€‚çœŸç›¸å¤§ç™½ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…·ä½“çš„è®¾è®¡è¿‡äºç»†èŠ‚ä¸åœ¨è¿™é‡Œé˜è¿°ï¼Œæ„Ÿå…´è¶£å¯ä»¥ç§»æ­¥æˆ‘ä»¬çš„å¼€æºç¤¾åŒºã€‚æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ä¼˜åŒ–åçš„æ•ˆæœã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆè¿˜æ˜¯æ¥ç€ä¸Šé¢çš„ get_body æ€§èƒ½æµ‹è¯•ï¼Œå¤šåŠ äº†ä¸€ç»„ FFINewï¼ˆä¼˜åŒ–åçš„ FFI å®ç°æ–¹å¼ï¼‰çš„æ•°æ®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒFFINew çš„æ€§èƒ½æ¯” FFIOld çš„æ€§èƒ½æå‡äº† &lt;strong&gt;66%&lt;/strong&gt; ï¼Œç›¸æ¯” CAPI çš„æ€§èƒ½æå‡äº† &lt;strong&gt;16%&lt;/strong&gt; ï¼ŒFFI çš„ä¼˜åŠ¿æ€»ç®—ä½“ç°äº†å‡ºæ¥ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/hango-rider/008_hud321333e57eea104a124e7791369c814_213764_a9d4624c988b021c40b811ec366fbbc8.webp 400w,
               /blog/hango-rider/008_hud321333e57eea104a124e7791369c814_213764_ada29b8f9bbdcedee2091868a64e37bb.webp 760w,
               /blog/hango-rider/008_hud321333e57eea104a124e7791369c814_213764_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/hango-rider/008_hud321333e57eea104a124e7791369c814_213764_a9d4624c988b021c40b811ec366fbbc8.webp&#34;
               width=&#34;760&#34;
               height=&#34;427&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šé¢çš„æ€§èƒ½æå‡å¯èƒ½åªèƒ½ä½œä¸ºå‚è€ƒï¼Œæ¯•ç«Ÿæ˜¯è°ƒç”¨äº† 100 æ¬¡ get_body æ¥å£ï¼Œå› æ­¤æˆ‘ä»¬é’ˆå¯¹ä¸åŒå¤æ‚åº¦çš„æ’ä»¶åˆ†åˆ«è¿›è¡Œäº†ç®€å•çš„æ€§èƒ½æµ‹è¯•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;simple filterï¼šè°ƒç”¨ 10 æ¬¡ get_headerï¼›&lt;/li&gt;
&lt;li&gt;normal filterï¼šè°ƒç”¨ 20 æ¬¡ set_headerï¼Œè°ƒç”¨ 10 æ¬¡ get_headerï¼Œæœ€åå† remove æ‰è¿™ 20 ä¸ª headerï¼›&lt;/li&gt;
&lt;li&gt;complex filterï¼šnormal filter + è°ƒç”¨ 30 æ¬¡ get_bodyï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒFFINew çš„æ€§èƒ½éƒ½ä¼˜äº FFIOld çš„æ€§èƒ½ï¼Œåˆ†åˆ«æœ‰ 15% ï¼Œ22% ï¼Œ29% çš„æ€§èƒ½æå‡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/hango-rider/009_hu9f1ba0cd6098408e8e39a82191257a26_224663_1600fa91ab4e31f37ba1716936454c54.webp 400w,
               /blog/hango-rider/009_hu9f1ba0cd6098408e8e39a82191257a26_224663_0c8768dd09912bc5e3eca7210c9f8e3f.webp 760w,
               /blog/hango-rider/009_hu9f1ba0cd6098408e8e39a82191257a26_224663_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/hango-rider/009_hu9f1ba0cd6098408e8e39a82191257a26_224663_1600fa91ab4e31f37ba1716936454c54.webp&#34;
               width=&#34;760&#34;
               height=&#34;425&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ€åæˆ‘ä»¬è¿›ä¸€æ­¥å°† Rider å’Œç¤¾åŒº WASM å’Œ Lua çš„æ€§èƒ½è¿›è¡Œäº†å¯¹æ¯”ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RiderOldï¼šRider æ—©æœŸæ¶æ„çš„å®ç°ï¼›&lt;/li&gt;
&lt;li&gt;RiderNewï¼šå½“å‰ Rider çš„å®ç°ï¼›&lt;/li&gt;
&lt;li&gt;WASMC++ï¼šç¤¾åŒº 1.17 ç‰ˆæœ¬çš„ WASM å®ç°ï¼›&lt;/li&gt;
&lt;li&gt;RawLuaï¼šç¤¾åŒº 1.17 ç‰ˆæœ¬çš„ Lua æ‰©å±•å®ç°ï¼›&lt;/li&gt;
&lt;li&gt;RawC++ï¼šEnvoy åŸç”Ÿ C++ æ‰©å±•å®ç°ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/hango-rider/010_hucf3779113ecee7d037937dc405a605e5_262678_3067f19e4060c490e0010bb8247d26c4.webp 400w,
               /blog/hango-rider/010_hucf3779113ecee7d037937dc405a605e5_262678_066aa7287c28050057e07dc4754f03ff.webp 760w,
               /blog/hango-rider/010_hucf3779113ecee7d037937dc405a605e5_262678_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/hango-rider/010_hucf3779113ecee7d037937dc405a605e5_262678_3067f19e4060c490e0010bb8247d26c4.webp&#34;
               width=&#34;760&#34;
               height=&#34;426&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒRider çš„æ€§èƒ½ä¼˜äºç¤¾åŒºçš„ WASM å’Œ Luaï¼Œå¤§æ¦‚æœ‰ 10% å·¦å³çš„æ€§èƒ½æå‡ï¼Œä¸”ç›¸æ¯”äº Envoy åŸç”Ÿ C++ æ’ä»¶æ€§èƒ½ä¹Ÿåªæœ‰ 10% å·¦å³çš„ä¸‹é™ã€‚è¿™é‡Œ WASM çš„æ’ä»¶æ˜¯ç”¨ C++ SDK å®ç°çš„ï¼Œè€Œæ ¹æ®æˆ‘ä»¬çš„å†…éƒ¨æµ‹è¯•ï¼ŒWASM å…¶ä»–è¯­è¨€ SDK å®ç°çš„æ’ä»¶æ€§èƒ½ä¼šæ›´å·®ã€‚å¦å¤–ï¼ŒRider æ€§èƒ½åªæ¯”ç¤¾åŒº Lua æå‡äº†ä¸åˆ° 10%ï¼Œä¸ªäººæ„Ÿè§‰æ˜¯å› ä¸ºæ€§èƒ½æµ‹è¯•çš„æ’ä»¶åœ¨ Lua å’Œ C++ ä¹‹é—´çš„æ•°æ®äº¤äº’æ¯”è¾ƒç®€å•ï¼ŒåŸºæœ¬éƒ½æ˜¯ç®€å•å­—ç¬¦ä¸²çš„ä¼ é€’ï¼Œä½“ç°ä¸å‡º FFI çš„ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;h4 id=&#34;222-åŠŸèƒ½å¢å¼º&#34;&gt;2.2.2 åŠŸèƒ½å¢å¼º&lt;/h4&gt;
&lt;p&gt;æ€§èƒ½é—®é¢˜è§£å†³åï¼Œæ¥ä¸‹æ¥å°±æ˜¯åŠŸèƒ½çš„å¢å¼ºï¼Œä¹Ÿå°±æ˜¯ Lua SDK çš„ä¸°å¯Œï¼Œè¿™é‡Œæ€»ç»“äº†å½“å‰ Rider æ”¯æŒçš„æ‰€æœ‰ Lua SDKï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;envoy.req.get_header(name)&lt;/li&gt;
&lt;li&gt;envoy.req.get_header_size(name)&lt;/li&gt;
&lt;li&gt;envoy.req.get_header_index(name, index)&lt;/li&gt;
&lt;li&gt;envoy.req.get_headers()&lt;/li&gt;
&lt;li&gt;envoy.req.get_body()&lt;/li&gt;
&lt;li&gt;envoy.req.get_metadata(key, filter_name)&lt;/li&gt;
&lt;li&gt;envoy.req.get_dynamic_metadata(key, filter_name)&lt;/li&gt;
&lt;li&gt;envoy.req.get_query_parameters(max_args)&lt;/li&gt;
&lt;li&gt;envoy.req.set_header(name, value)&lt;/li&gt;
&lt;li&gt;envoy.req.set_headers(headers)&lt;/li&gt;
&lt;li&gt;envoy.req.clear_header(name)&lt;/li&gt;
&lt;li&gt;envoy.resp.get_header(name)&lt;/li&gt;
&lt;li&gt;envoy.resp.get_header_size(name)&lt;/li&gt;
&lt;li&gt;envoy.resp.get_header_index(name, index)&lt;/li&gt;
&lt;li&gt;envoy.resp.get_headers()&lt;/li&gt;
&lt;li&gt;envoy.resp.get_body()&lt;/li&gt;
&lt;li&gt;envoy.resp.set_header(name, value)&lt;/li&gt;
&lt;li&gt;envoy.resp.set_headers(headers)&lt;/li&gt;
&lt;li&gt;envoy.resp.clear_header(name)&lt;/li&gt;
&lt;li&gt;envoy.streaminfo.start_time()&lt;/li&gt;
&lt;li&gt;envoy.streaminfo.current_time_milliseconds()&lt;/li&gt;
&lt;li&gt;envoy.streaminfo.downstream_local_address()&lt;/li&gt;
&lt;li&gt;envoy.streaminfo.downstream_remote_address()&lt;/li&gt;
&lt;li&gt;envoy.streaminfo.upstream_cluster()&lt;/li&gt;
&lt;li&gt;envoy.streaminfo.upstream_host()&lt;/li&gt;
&lt;li&gt;envoy.logTrace(message)&lt;/li&gt;
&lt;li&gt;envoy.logDebug(message)&lt;/li&gt;
&lt;li&gt;envoy.logInfo(message)&lt;/li&gt;
&lt;li&gt;envoy.logWarn(message)&lt;/li&gt;
&lt;li&gt;envoy.logErr(message)&lt;/li&gt;
&lt;li&gt;envoy.filelog(msg)&lt;/li&gt;
&lt;li&gt;envoy.get_base_config()&lt;/li&gt;
&lt;li&gt;envoy.get_route_config()&lt;/li&gt;
&lt;li&gt;envoy.httpCall(cluster, headers, body, timeout)&lt;/li&gt;
&lt;li&gt;envoy.respond(headers, body)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;23-rider-çš„å®è·µ&#34;&gt;2.3 Rider çš„å®è·µ&lt;/h3&gt;
&lt;p&gt;ç½‘æ˜“å†…éƒ¨ä¼ åª’ä¸šåŠ¡å·²åŸºäº Rider å¼€å‘å¹¶ä¸Šçº¿ä½¿ç”¨å¤šä¸ª Lua æ’ä»¶ï¼Œå…¶ä¸­ç”¨äºæ‰“å°å…¨é“¾è·¯è¿½è¸ªæ—¥å¿—çš„ Trace æ’ä»¶ 2020 Q1 ä¸Šçº¿ï¼Œç›®å‰å·²æ¥å…¥å…¨éƒ¨ç½‘å…³ï¼Œå¤„ç†æ•°åä¸‡ QPSï¼Œè¿è¡Œç¨³å®šã€‚&lt;/p&gt;
&lt;h2 id=&#34;3-rider-å¯æ‰©å±•æ¡†æ¶çš„æœªæ¥è§„åˆ’&#34;&gt;3. Rider å¯æ‰©å±•æ¡†æ¶çš„æœªæ¥è§„åˆ’&lt;/h2&gt;
&lt;p&gt;æœªæ¥æˆ‘ä»¬ä¼šåœ¨ç¨³å®šæ€§ã€æ€§èƒ½ã€åŠŸèƒ½ç­‰æ–¹é¢æŒç»­è¿›è¡Œ Rider çš„ç»´æŠ¤å’Œä¼˜åŒ–ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¨³å®šæ€§ï¼šç›®å‰ Rider å·²ç»åœ¨ç½‘æ˜“å†…å¤–éƒ¨å¤šä¸ªä¸šåŠ¡æ–¹å¤§è§„æ¨¡è½åœ°ï¼Œåç»­æˆ‘ä»¬ä¹Ÿä¼šè¿›ä¸€æ­¥æå‡å¹¶ä¿éšœ Rider ç¨³å®šæ€§ï¼›&lt;/li&gt;
&lt;li&gt;æ€§èƒ½ï¼šå°½ç®¡ Rider çš„æ€§èƒ½å·²ç»ä¼˜äºç¤¾åŒº Lua å’Œ WASMï¼Œä½†åç»­æˆ‘ä»¬ä¼šæŒç»­è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œè¿›ä¸€æ­¥ç¼©å°å’ŒåŸç”Ÿ C++ æ‰©å±•çš„æ€§èƒ½å·®è·ï¼›&lt;/li&gt;
&lt;li&gt;åŠŸèƒ½ï¼šåœ¨ Rider API æ–¹é¢å’Œç¤¾åŒº Lua ä»¥åŠ WASM å¯¹é½ï¼Œæä¾›æœ€å…¨é¢çš„ API èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ›´å¤š&#34;&gt;æ›´å¤š&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Hango Rider é¡¹ç›®åœ°å€ï¼š&lt;a href=&#34;https://github.com/hango-io/rider&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/hango-io/rider&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Hango ç½‘å…³é¡¹ç›®åœ°å€ï¼š&lt;a href=&#34;https://github.com/hango-io/hango-gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/hango-io/hango-gateway&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Istio å®‰å…¨æºç åˆ†æâ€”â€”è®¤è¯ä½“ç³»ä¸é€šä¿¡å®‰å…¨</title>
      <link>https://cloudnative.to/blog/istio-zero-trust-source-code-reading/</link>
      <pubDate>Wed, 27 Oct 2021 03:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/istio-zero-trust-source-code-reading/</guid>
      <description>&lt;p&gt;æœ¬æ–‡åˆ†æ Istio å®‰å…¨è®¤è¯ä½“ç³»ä¸åŠ å¯†é€šä¿¡çš„æºç ï¼Œä»‹ç» Istio æ˜¯å¦‚ä½•æ„å»ºé›†ç¾¤å†…éƒ¨ PKI è¯ä¹¦åŸºç¡€è®¾æ–½å’Œå®æ–½å®‰å…¨é€šä¿¡çš„ã€‚&lt;/p&gt;
&lt;p&gt;åˆ†æè¿‡ç¨‹çš„ä»£ç æ³¨é‡Šåœ¨æˆ‘çš„ Github ä»“åº“ &lt;a href=&#34;https://github.com/mayocream/istio/tree/citadel-review&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mayocream/istio&lt;/a&gt; çš„ citadel-review åˆ†æ”¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;1-èº«ä»½æ¨¡å‹&#34;&gt;1. èº«ä»½æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;é›¶ä¿¡ä»»æ¶æ„ä¸‹ï¼Œéœ€è¦ä¸¥æ ¼åŒºåˆ†å·¥ä½œè´Ÿè½½çš„è¯†åˆ«å’Œä¿¡ä»»ï¼Œè€Œç­¾å‘ X.509 è¯ä¹¦æ˜¯æ¨èçš„ä¸€ç§è®¤è¯æ–¹å¼&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;ã€‚åœ¨ Kubernetes é›†ç¾¤ä¸­ï¼ŒæœåŠ¡é—´æ˜¯é€šè¿‡ DNS åç§°äº’ç›¸è®¿é—®çš„ï¼Œè€Œç½‘ç»œæµé‡å¯èƒ½è¢« DNS æ¬ºéª—ã€BGP/è·¯ç”±åŠ«æŒã€ARP æ¬ºéª—ç­‰æ‰‹æ®µåŠ«æŒï¼Œä¸ºäº†å°†æœåŠ¡åç§°ï¼ˆDNS åç§°ï¼‰ä¸æœåŠ¡èº«ä»½å¼ºå…³è”èµ·æ¥ï¼ŒIstio ä½¿ç”¨ç½®äº X.509 è¯ä¹¦ä¸­çš„å®‰å…¨å‘½åï¼ˆSecure namingï¼‰æœºåˆ¶&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;p&gt;SPIFFE æ˜¯ Istio æ‰€é‡‡ç”¨çš„å®‰å…¨å‘½åçš„è§„èŒƒï¼Œå®ƒä¹Ÿæ˜¯äº‘åŸç”Ÿå®šä¹‰çš„ä¸€ç§æ ‡å‡†åŒ–çš„ã€å¯ç§»æ¤çš„å·¥ä½œè´Ÿè½½èº«ä»½è§„èŒƒã€‚&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;h3 id=&#34;11-ä»‹ç»&#34;&gt;1.1. ä»‹ç»&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://spiffe.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Secure Production Identity Framework For Everyone (SPIFFE)&lt;/a&gt; æ˜¯ä¸€å¥—æœåŠ¡ä¹‹é—´ç›¸äº’è¿›è¡Œèº«ä»½è¯†åˆ«çš„æ ‡å‡†ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SPIFFE ID æ ‡å‡†ï¼ŒSPIFFE ID æ˜¯æœåŠ¡çš„å”¯ä¸€æ ‡è¯†ï¼Œå…·ä½“å®ç°ä½¿ç”¨ URI èµ„æºæ ‡è¯†ç¬¦ã€‚&lt;/li&gt;
&lt;li&gt;SPIFFE Verifiable Identity Document (SVID) æ ‡å‡†ï¼Œå°† SPIFFE ID ç¼–ç åˆ°ä¸€ä¸ªåŠ å¯†çš„å¯éªŒè¯çš„æ•°æ®æ ¼å¼ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;é¢å‘ä¸æ’¤é”€ SVID çš„ API æ ‡å‡†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;SPIFFE ID è§„å®šäº†å½¢å¦‚ &lt;code&gt;spiffe://&amp;lt;trust domain&amp;gt;/&amp;lt;workload identifier&amp;gt;&lt;/code&gt; çš„ URI æ ¼å¼ï¼Œä½œä¸ºå·¥ä½œè´Ÿè½½ï¼ˆWorkloadï¼‰çš„å”¯ä¸€æ ‡è¯†ã€‚SVID æ˜¯ SPIFFE ID çš„è¯†åˆ«å‡­è¯ï¼Œæœ‰ X.509 å’Œ JWT ä¸¤ç§æ ¼å¼ã€‚&lt;/p&gt;
&lt;p&gt;SPIFFE è§„èŒƒçš„å®ç°æœ‰ spiffe å®˜æ–¹çš„ &lt;a href=&#34;https://github.com/spiffe/spire&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Spire&lt;/a&gt; é¡¹ç›®ï¼Œè€Œ Istio åœ¨è‡ªèº«çš„ç”Ÿæ€ä¸­åªä½¿ç”¨åˆ°äº† SPIFFE ID ä½œä¸ºå®‰å…¨å‘½åï¼Œå…¶æ•°æ®æ ¼å¼ç”±è‡ªå·±å®ç°ï¼Œé€šä¿¡æ ¼å¼é‡‡ç”¨ CNCF æ”¯æŒçš„ &lt;a href=&#34;https://github.com/cncf/xds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS&lt;/a&gt; åè®®è§„èŒƒï¼ˆè¯ä¹¦è®¤è¯é€šä¿¡æ›´å…·ä½“æ¥è¯´æ˜¯ xDS çš„ SDSï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;Istio ä½¿ç”¨å½¢å¦‚ &lt;code&gt;spiffe://&amp;lt;trust_domain&amp;gt;/ns/&amp;lt;namespace&amp;gt;/sa/&amp;lt;service_account&amp;gt;&lt;/code&gt; æ ¼å¼çš„ SPIFFE ID ä½œä¸ºå®‰å…¨å‘½åï¼Œæ³¨å…¥åˆ° X.509 è¯ä¹¦çš„ subjectAltName æ‰©å±•ä¸­ã€‚å…¶ä¸­â€œtrust domainâ€å‚æ•°é€šè¿‡ Istiod ç¯å¢ƒå˜é‡ &lt;code&gt;TRUST_DOMAIN&lt;/code&gt; æ³¨å…¥ï¼Œç”¨äºåœ¨å¤šé›†ç¾¤ç¯å¢ƒä¸­äº¤äº’ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-å®‰å…¨æ¶æ„&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio å®‰å…¨æ¶æ„&#34;
           src=&#34;https://cloudnative.to/blog/istio-zero-trust-source-code-reading/istio-security-arch-sec.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio å®‰å…¨æ¶æ„
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;12-ä»£ç å®ç°&#34;&gt;1.2. ä»£ç å®ç°&lt;/h3&gt;
&lt;p&gt;SPIFFE å®˜æ–¹æä¾›äº† Go SDK &lt;a href=&#34;https://github.com/spiffe/go-spiffe&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;go-spiffe&lt;/a&gt;ï¼Œæä¾›ä¸€ç§æ ‡å‡†çš„ SPIFFE åè®®çš„å®¢æˆ·ç«¯å®ç°ã€‚
ç”±äº Istio ä»…ä»…ä½¿ç”¨äº† SPIFFE IDï¼Œæ²¡æœ‰å¿…è¦å¼•å…¥è¿™ä¸ª SDKï¼Œè¿˜å€¼å¾—ä¸€æçš„æ˜¯è¯¥ SDK å¼•å…¥äº† grpc åŒ…ï¼Œå¦‚æœä½ å’Œæˆ‘ä¸€æ ·è¸©è¿‡ grpc åŒ…å¼•ç”¨ç‰ˆæœ¬å†²çªçš„é—®é¢˜ï¼Œè¿˜èŠ±è´¹äº†ä¸€ä¸‹åˆçš„æ—¶é—´æ¥è§£å†³ï¼Œè¿™æ¬¡ä¸€å®šè¦ä¿æŒè­¦æƒ•ã€‚&lt;/p&gt;
&lt;p&gt;Istio å°†è‡ªå·±å®ç°çš„ SPIFFE ç›¸å…³çš„ä»£ç å­˜æ”¾åœ¨ pkg ç›®å½•ä¸‹çš„ spiffe ç›®å½•ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ•°æ®ç»“æ„&#34;&gt;æ•°æ®ç»“æ„&lt;/h4&gt;
&lt;p&gt;è¿™é‡Œå†æä¸€æ¬¡æ•°æ®æ ¼å¼æ˜¯å½¢å¦‚ &lt;code&gt;spiffe://&amp;lt;trust_domain&amp;gt;/ns/&amp;lt;namespace&amp;gt;/sa/&amp;lt;service_account&amp;gt;&lt;/code&gt; çš„ URI å­—ç¬¦ä¸²ã€‚è¿™ç±»èº«ä»½æ ‡è¯†å› ç³»ç»Ÿè®¾è®¡ä¸åŒï¼Œå®šä¹‰çš„æ ¼å¼ä¹Ÿå„ä¸ç›¸åŒï¼Œä¾‹å¦‚èš‚èšå†…éƒ¨ä½¿ç”¨çš„èº«ä»½æ ‡è¯†æ ¼å¼æ˜¯ &lt;code&gt;spiffe://&amp;lt;domain&amp;gt;/cluster/&amp;lt;cluster&amp;gt;/&amp;lt;required_attr_1_name&amp;gt;/&amp;lt;required_attr_1_value&amp;gt;/&amp;lt;required_attr_2_name&amp;gt;/&amp;lt;required_attr_2_value&amp;gt;&lt;/code&gt;&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å®šä¹‰ SPIFFE çš„æ•°æ®ç»“æ„åŠå…¶è§£ææ–¹å¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Identity&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;TrustDomain&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Namespace&lt;/span&gt;      &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ServiceAccount&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ParseIdentity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Identity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HasPrefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;URIPrefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Identity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;identity is not a spiffe format: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;split&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URIPrefixLen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Identity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;TrustDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;ServiceAccount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Identity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;URIPrefix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TrustDomain&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/ns/&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Namespace&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/sa/&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ServiceAccount&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¿¡ä»»åŸŸï¼ˆTrust Domainï¼‰æ˜¯ç”± Istiod ä¸»ç¨‹åºå¯åŠ¨æ—¶è°ƒç”¨ &lt;code&gt;spiffe.SetTrustDomain(s.environment.Mesh().GetTrustDomain())&lt;/code&gt; å‡½æ•°æ–¹æ³•è®¾ç½®çš„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;tls-éªŒè¯&#34;&gt;TLS éªŒè¯&lt;/h4&gt;
&lt;p&gt;Go å®˜æ–¹çš„ tls åŒ…æä¾›äº† &lt;em&gt;VerifyPeerCertificate&lt;/em&gt; æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é€šå¸¸ä¼šåœ¨æ ‡å‡†è¯ä¹¦æ ¡éªŒåï¼ˆéªŒè¯æœåŠ¡ç«¯ IP æˆ– DNS åç§°ä»¥åŠè¯ä¹¦é“¾æ ¡éªŒï¼‰è¢«è°ƒç”¨ï¼Œæä¾›é¢å¤–çš„è‡ªå®šä¹‰ Peer è¯ä¹¦éªŒè¯åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äº SPIFFE ID å±äºè¯ä¹¦æ‰©å±•å†…å®¹ï¼Œç¨‹åºéœ€è¦é¢å¤–æ ¡éªŒ SPIFFE èº«ä»½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pkg/spiffe/spiffe.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PeerCertVerifier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;VerifyPeerCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rawCerts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[][]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[][]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;x509&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Certificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ä¸‹æ¸¸æœåŠ¡è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;peerCert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;x509&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Certificate&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// CA è¯ä¹¦é“¾
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;intCertPool&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;x509&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewCertPool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rawCert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rawCerts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;cert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;x509&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ParseCertificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rawCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// ç¬¬ä¸€ä¸ªè¯ä¹¦ä¸º Workload è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;peerCert&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cert&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;intCertPool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ERROR: SAN URIs æ²¡æœ‰ SPIFFE ID
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;peerCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URIs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;peer certificate does not contain 1 URI type SAN, detected %d&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;peerCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URIs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;trustDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;GetTrustDomainFromURISAN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;peerCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URIs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æ ¹è¯ä¹¦æ± 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;rootCertPool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;certPools&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;trustDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;no cert pool found for trust domain %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;trustDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// éªŒè¯è¯ä¹¦æœ‰æ•ˆæ€§
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;peerCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Verify&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;x509&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VerifyOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Roots&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;         &lt;span class=&#34;nx&#34;&gt;rootCertPool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Intermediates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;intCertPool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ ¡éªŒè¿‡ç¨‹ä¼šæ£€æŸ¥ SPIFFE ID å­—æ®µæ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠ CA è¯ä¹¦çš„ä¿¡ä»»åŸŸæ˜¯å¦ä¸å·¥ä½œè´Ÿè½½çš„è¯ä¹¦å¤„äºåŒä¸€æœ‰æ•ˆçš„ä¿¡ä»»åŸŸã€‚è‹¥æ ¡éªŒå¤±è´¥ï¼ŒTLS æ¡æ‰‹ä¼šä»¥å¤±è´¥å‘Šç»ˆã€‚&lt;/p&gt;
&lt;p&gt;Istiod åœ¨ä¸»ç¨‹åºå¯åŠ¨æ—¶è°ƒç”¨ &lt;em&gt;setPeerCertVerifier&lt;/em&gt; æ–¹æ³•ï¼Œè®¾ç½®é¢å¤–çš„ mTLS æ ¡éªŒæ–¹å¼ï¼Œä»¥åŠæ·»åŠ  CA è¯ä¹¦åˆ° Cert Pool é‡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// setPeerCertVerifier è®¾ç½® Istiod çš„ SPIFFE æ ¡éªŒæ–¹å¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;setPeerCertVerifier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tlsOptions&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TLSOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨ä¸Šè¿°çš„ spiffe åŒ…
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;peerCertVerifier&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;spiffe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewPeerCertVerifier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootCertBytes&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// CA è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tlsOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CaCertFile&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// ä¼ å…¥ CA è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// åŠ å…¥ CA æ ¹è¯ä¹¦åˆ° SPIFFIE çš„ä¿¡ä»»è¯ä¹¦é‡Œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootCertBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;peerCertVerifier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddMappingFromPEM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;spiffe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetTrustDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootCertBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;å¤–éƒ¨-ca&#34;&gt;å¤–éƒ¨ CA&lt;/h4&gt;
&lt;p&gt;Istio å®ç°äº† &lt;a href=&#34;https://github.com/spiffe/spiffe/blob/master/standards/SPIFFE_Trust_Domain_and_Bundle.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIFFE Bundle&lt;/a&gt; åè®®ï¼Œè¯¥åè®®å…è®¸è®¿é—®å¤–éƒ¨ URI é€šè¿‡è§„å®šçš„ &lt;a href=&#34;https://datatracker.ietf.org/doc/html/rfc7517&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;JWKï¼ˆJSON Web Keyï¼‰&lt;/a&gt;æ•°æ®æ ¼å¼ï¼Œè·å–ä¿¡ä»»åŸŸå¯¹åº”çš„æ ¹è¯ä¹¦ï¼Œè€Œæ— éœ€å°†æ ¹è¯ä¹¦ç½®äºç¨‹åºå†…éƒ¨ã€‚&lt;/p&gt;
&lt;p&gt;Istio å®šä¹‰çš„æ•°æ®æ ¼å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;&amp;lt;trustdomain, endpoint&amp;gt;&lt;/em&gt; å…ƒç»„ä»¥ || åˆ†å‰²&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªå…ƒç»„å†…ä½¿ç”¨ | åˆ†å‰² trustdomain å’Œ endpoint&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼š&lt;code&gt;foo|https://url/for/foo||bar|https://url/for/bar&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹è¿°æ–¹å¼ç”¨äºè·å–ä¿¡ä»»åŸŸå¯¹åº”çš„ X.509 CA è¯ä¹¦é“¾ï¼ˆå¯ä»¥æœ‰å¤šå±‚çº§ï¼‰ã€‚è¯¥æ–¹æ³•æ¥æ”¶ &lt;code&gt;foo|URL1||bar|URL2&lt;/code&gt; æ ¼å¼çš„å‚æ•°ï¼Œç”¨ &lt;code&gt;||&lt;/code&gt; åˆ†éš”åˆ‡ç‰‡ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º trust domainï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º CA æœåŠ¡å™¨ URLã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// RetrieveSpiffeBundleRootCertsFromStringInput ä» SPIFFE bundle ä¸­æ£€ç´¢å¯ä¿¡çš„ CA è¯ä¹¦ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å®ƒå¯ä»¥ä½¿ç”¨ç³»ç»Ÿè¯ä¹¦å’Œæä¾›çš„è¯ä¹¦æ¥è¿›è¡ŒéªŒè¯ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ ¼å¼å¦‚ä¸‹ï¼š
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// &amp;#34;foo|URL1||bar|URL2||baz|URL3...&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;RetrieveSpiffeBundleRootCertsFromStringInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputString&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;extraTrustedCerts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;x509&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Certificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;x509&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Certificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;spiffeLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Processing SPIFFE bundle configuration: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;tuples&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;||&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tuple&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tuples&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tuple&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;|&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;config is invalid: %v. Expected &amp;lt;trustdomain&amp;gt;|&amp;lt;url&amp;gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tuple&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;trustDomain&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;endpoint&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;trustDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;endpoint&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨ CA æœåŠ¡å™¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;RetrieveSpiffeBundleRootCerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;extraTrustedCerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¤–éƒ¨æœåŠ¡å™¨è¿”å› JWK æ ¼å¼çš„æ•°æ®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pkg/spiffe/spiffe.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// è¿”å›çš„ JSON ç»“æ„
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bundleDoc&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;jose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;JSONWebKeySet&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Sequence&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;spiffe_sequence,omitempty&amp;#34;`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;RefreshHint&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;    &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;spiffe_refresh_hint,omitempty&amp;#34;`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// JSONWebKey represents a public or private key in JWK format.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;JSONWebKey&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Cryptographic key, can be a symmetric or asymmetric key.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;Key&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Key identifier, parsed from `kid` header.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;KeyID&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Key algorithm, parsed from `alg` header.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;Algorithm&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Key use, parsed from `use` header.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;Use&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// X.509 certificate chain, parsed from `x5c` header.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;Certificates&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;x509&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Certificate&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// X.509 certificate URL, parsed from `x5u` header.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;CertificatesURL&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URL&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// X.509 certificate thumbprint (SHA-1), parsed from `x5t` header.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;CertificateThumbprintSHA1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// X.509 certificate thumbprint (SHA-256), parsed from `x5t#S256` header.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;CertificateThumbprintSHA256&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®é™…çš„æ•°æ®ç¤ºä¾‹å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;spiffe_sequence&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;spiffe_refresh_hint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;450000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;keys&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s&#34;&gt;&amp;#34;kty&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;RSA&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s&#34;&gt;&amp;#34;use&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;x509-svid&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s&#34;&gt;&amp;#34;n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;lt;è¯ä¹¦ç­¾å&amp;gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s&#34;&gt;&amp;#34;e&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;AQAB&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s&#34;&gt;&amp;#34;x5c&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;lt;X.509 è¯ä¹¦&amp;gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;2-ç§æœ‰-pki&#34;&gt;2. ç§æœ‰ PKI&lt;/h2&gt;
&lt;p&gt;Istio å†…éƒ¨æœ‰ä¸€å¥—å†…ç½®çš„ PKI è¯ä¹¦åŸºç¡€è®¾æ–½ã€‚é›¶ä¿¡ä»»æ¶æ„ä¸­ï¼ŒPKI æ˜¯é›¶ä¿¡ä»»æ¨¡å‹èº«ä»½è®¤è¯çš„åŸºçŸ³ï¼Œå¤§å¤šæ•°é›¶ä¿¡ä»»ç½‘ç»œéƒ½é‡‡ç”¨ PKI æ¥è¯æ˜èº«ä»½çš„çœŸå®æ€§ã€‚é›¶ä¿¡ä»»ç½‘ç»œé¢å‘çš„è¯ä¹¦æ•°é‡å¯èƒ½ä¼šå¾ˆå¤šï¼Œå› æ­¤éå¸¸æœ‰å¿…è¦å¯¹è¯ä¹¦è¿›è¡Œè‡ªåŠ¨åŒ–ç®¡ç†ã€‚&lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;h3 id=&#34;21-istiod-é…ç½®&#34;&gt;2.1. Istiod é…ç½®&lt;/h3&gt;
&lt;p&gt;Istiod é»˜è®¤å¯ç”¨å†…ç½®çš„ CA æœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pilot/pkg/features/pilot.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;EnableCAServer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterBoolVar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ENABLE_CA_SERVER&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s&#34;&gt;&amp;#34;If this is set to false, will not create CA server in istiod.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯ä¹¦ç­¾åçš„é»˜è®¤é…ç½®é¡¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pilot/pkg/bootstrap/istio_ca.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å…¼å®¹æŒ‚è½½åä¸º cacerts çš„ secret
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ä½†å·²ç»ä¸ä½¿ç”¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ä½¿ç”¨ &amp;#34;istio-ca-secret&amp;#34; æ¥åˆ›å»ºè¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å…¼å®¹æ—§ç‰ˆæœ¬
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æŒ‚è½½åä¸º cacerts çš„ secret çš„ç›®å½•ï¼ŒRead-only
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;LocalCertDir&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterStringVar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ROOT_CA_DIR&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;./etc/cacerts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s&#34;&gt;&amp;#34;Location of a local or mounted CA root&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤æœåŠ¡è¯ä¹¦ TTL
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;workloadCertTTL&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterDurationVar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;DEFAULT_WORKLOAD_CERT_TTL&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;cmd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DefaultWorkloadCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s&#34;&gt;&amp;#34;The default TTL of issued workload certificates. Applied when the client sets a &amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s&#34;&gt;&amp;#34;non-positive TTL in the CSR.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;maxWorkloadCertTTL&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterDurationVar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;MAX_WORKLOAD_CERT_TTL&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;cmd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DefaultMaxWorkloadCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s&#34;&gt;&amp;#34;The max TTL of issued workload certificates.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// è‡ªç­¾å CA è¯ä¹¦ TTL
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;SelfSignedCACertTTL&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterDurationVar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;CITADEL_SELF_SIGNED_CA_CERT_TTL&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;cmd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DefaultSelfSignedCACertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s&#34;&gt;&amp;#34;The TTL of self-signed CA root certificate.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Istio ä¸»ç¨‹åºä¼šæŒ‚è½½ä¸¤ä¸ª Secertï¼Œä¸€ä¸ªæ˜¯ &lt;em&gt;cacerts&lt;/em&gt; Secretï¼Œç”¨äºæŒ‡å®š Istio å¯åŠ¨æ—¶ç”¨æˆ·å®šä¹‰çš„ CA è¯ä¹¦ï¼Œå¦ä¸€ä¸ªæ˜¯ &lt;em&gt;istio-ca-secret&lt;/em&gt; Secretï¼Œç”¨äºå‚¨å­˜ Istio Pilot Discovery ç¨‹åºè‡ªç­¾åçš„ CA è¯ä¹¦åŠå…¶ç§é’¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// CA è¯ä¹¦ä¸åº”è¯¥åœ¨ Workload è¯ä¹¦å¤±æ•ˆä¹‹å‰å°±å¤±æ•ˆ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// æ‰€ä»¥æ­¤å¤„è®¾ç½®è¯ä¹¦çš„ç”Ÿå‘½å‘¨æœŸä¸ºè¯ä¹¦é“¾ä¸­çš„æœ€çŸ­çš„æ—¶æ•ˆæœŸ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;defaultCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;minTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DefaultCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to get default cert TTL %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;defaultCertTTL&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;defaultCertTTL&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;CA è¯ä¹¦ä¸åº”è¯¥åœ¨ Workload è¯ä¹¦å¤±æ•ˆä¹‹å‰å°±å¤±æ•ˆï¼Œæ‰€ä»¥æ­¤å¤„è®¾ç½® Workload è¯ä¹¦çš„ç”Ÿå‘½å‘¨æœŸä¸º CA è¯ä¹¦é“¾ä¸­çš„æœ€çŸ­çš„æ—¶æ•ˆæœŸã€‚&lt;/p&gt;
&lt;p&gt;Istio CA å®é™…æŒ‚è½½çš„ &lt;em&gt;istio-ca-secret&lt;/em&gt; Secret æ•°æ®ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ca-secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ca-cert.pem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvRENDQWVTZ0F3SUJBZ0lRQWVMc3E2ZDVFN0ZheVY2U...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ca-key.pem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;gt;-LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBd2JpOWtucHVPS1d6SUxkM...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cert-chain.pem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;key.pem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;root-cert.pem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio.io/ca-root&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;22-åˆå§‹åŒ–&#34;&gt;2.2. åˆå§‹åŒ–&lt;/h3&gt;
&lt;h4 id=&#34;221-å…¥å£æµç¨‹&#34;&gt;2.2.1. å…¥å£æµç¨‹&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pilot/pkg/bootstrap/server.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// maybeCreateCA creates and initializes CA Key if needed.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;maybeCreateCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤å¯ç”¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;EnableCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;creating CA and initializing public key&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;corev1&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CoreV1Interface&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kubeClient&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;corev1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kubeClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CoreV1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// ä»è¿œç¨‹ K8S é›†ç¾¤è·å–è¯ä¹¦ï¼Œé»˜è®¤ä¸å¯ç”¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;useRemoteCerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;loadRemoteCACerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LocalCertDir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to load remote CA certs: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// TODO: Issue #27606 If External CA is configured, use that to sign DNS Certs as well. IstioCA need not be initialized
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;createIstioCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;corev1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to create CA: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;initPublicKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;error initializing public key: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;s.createIstioCA&lt;/code&gt; é‡Œé¢è¯¦ç»†è¿›è¡Œ CA åˆå§‹åŒ–çš„æ“ä½œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pilot/pkg/bootstrap/istio_ca.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// createIstioCA initializes the Istio CA signing functionality.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createIstioCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;corev1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CoreV1Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IstioCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IstioCAOptions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// In pods, this is the optional &amp;#39;cacerts&amp;#39; Secret.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// TODO: also check for key.pem ( for interop )
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;signingKeyFile&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LocalCertDir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;ca-key.pem&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// If not found, will default to ca-cert.pem. May contain multiple roots.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;rootCertFile&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LocalCertDir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;root-cert.pem&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Stat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootCertFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// å…¼å®¹ Istio è·å– Root cert è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// In Citadel, normal self-signed doesn&amp;#39;t use a root-cert.pem file for additional roots.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// In Istiod, it is possible to provide one via &amp;#34;cacerts&amp;#34; secret in both cases, for consistency.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;rootCertFile&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Stat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;signingKeyFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// åœ¨ K8S é›†ç¾¤ä¸­åˆ›å»ºè‡ªç­¾åè¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// The user-provided certs are missing - create a self-signed cert.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Use self-signed certificate as the CA certificate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Abort after 20 minutes.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cancel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Background&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Minute&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// è·å–è¯ä¹¦æ“ä½œç¬¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// rootCertFile will be added to &amp;#34;ca-cert.pem&amp;#34;.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// readSigningCertOnly set to false - it doesn&amp;#39;t seem to be used in Citadel, nor do we have a way
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// to set it only for one job.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewSelfSignedIstioCAOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;selfSignedRootCertGracePeriodPercentile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;SelfSignedCACertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;selfSignedRootCertCheckInterval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;workloadCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;maxWorkloadCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TrustDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootCertFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;enableJitterForRootCertRotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caRSAKeySize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to create a self-signed istiod CA: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;istioCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewIstioCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to create an istiod CA: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;istioCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootCertRotatorChan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;istioCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ•°æ®æ“ä½œæµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;é¦–å…ˆè¯»å– Kubernetes ä¸­â€œcacertsâ€çš„ secret æŒ‚è½½çš„æœ¬åœ°ç›®å½•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è‹¥ä¸å­˜åœ¨åˆ™é€šè¿‡ go-client è·å– K8S ä¸­ &amp;ldquo;istio-ca-cert&amp;rdquo; çš„ secretï¼Œè¯¥ secret åŒ…å« CA çš„ç§é’¥åŠè¯ä¹¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;K8s ä¸­æ²¡æœ‰ CA è¯ä¹¦ï¼Œåˆ™å¼€å§‹è‡ªç­¾åè¯ä¹¦æµç¨‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;222-è‡ªç­¾å-ca-è¯ä¹¦&#34;&gt;2.2.2. è‡ªç­¾å CA è¯ä¹¦&lt;/h4&gt;
&lt;p&gt;ç­¾å‘ä¸è·å–è¯ä¹¦ç›¸å…³å‚æ•°é…ç½®å¯¹ç…§è¡¨å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‚æ•°&lt;/th&gt;
&lt;th&gt;é»˜è®¤å€¼&lt;/th&gt;
&lt;th&gt;å¤‡æ³¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;DefaultSelfSignedCACertTTL&lt;/td&gt;
&lt;td&gt;3650 * 24 * time.Hour&lt;/td&gt;
&lt;td&gt;è‡ªç­¾å Root è¯ä¹¦é»˜è®¤çš„ TTL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DefaultSelfSignedRootCertCheckInterval&lt;/td&gt;
&lt;td&gt;1 * time.Hour&lt;/td&gt;
&lt;td&gt;è‡ªç­¾åè¯ä¹¦å®šæœŸæ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸæˆ–è¿›è¡Œè¯ä¹¦è½®æ¢æ£€æŸ¥çš„é»˜è®¤é—´éš”æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DefaultRootCertGracePeriodPercentile&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;æ ¹è¯ä¹¦å¹³æ»‘è½®æ¢è¯ä¹¦çš„æœ‰æ•ˆæ—¶é•¿ç™¾åˆ†æ¯”ï¼Œç›¸å¯¹äºè¯ä¹¦çš„æœ‰æ•ˆå‘¨æœŸï¼ˆTTLï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ReadSigningCertRetryInterval&lt;/td&gt;
&lt;td&gt;time.Second * 5&lt;/td&gt;
&lt;td&gt;è¯»å–è¯ä¹¦ä¸ç§é’¥å¤±è´¥çš„é‡è¯•é—´éš”æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ReadSigningCertRetryMax&lt;/td&gt;
&lt;td&gt;time.Second * 30&lt;/td&gt;
&lt;td&gt;è¯»å–è¯ä¹¦ä¸ç§é’¥å¤±è´¥çš„æœ€å¤§é‡è¯•æ¬¡æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DefaultMaxWorkloadCertTTL&lt;/td&gt;
&lt;td&gt;90 * 24 * time.Hour&lt;/td&gt;
&lt;td&gt;ç­¾å‘å·¥ä½œè´Ÿè½½è¯ä¹¦çš„é»˜è®¤æœ€é•¿çš„ TTL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DefaultWorkloadCertTTL&lt;/td&gt;
&lt;td&gt;24 * time.Hour&lt;/td&gt;
&lt;td&gt;ç­¾å‘å·¥ä½œè´Ÿè½½è¯ä¹¦çš„é»˜è®¤çš„ TTL&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Istio æ˜¯å…·ä½“æ˜¯å¦‚ä½•ä½¿ç”¨ Go å®˜æ–¹åŒ…è‡ªç­¾åä¸€ä¸ª CA è¯ä¹¦çš„ï¼Ÿ
ä¸»è¦æµç¨‹ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»º RSA ç§é’¥ï¼ˆIstio è¿˜ä¸æ”¯æŒ ECDSA ç§é’¥ï¼‰&lt;/li&gt;
&lt;li&gt;æ„å»º CSRï¼ˆCertificate signing requestï¼‰æ¨¡æ¿&lt;/li&gt;
&lt;li&gt;å¡«å…… SPIFFE ID åˆ° CSR çš„æ‰©å±•å­—æ®µï¼ˆASN.1ï¼‰&lt;/li&gt;
&lt;li&gt;è‡ªç­¾å CSR ç”Ÿæˆè¯ä¹¦&lt;/li&gt;
&lt;li&gt;åˆ›å»º Kubernetes Secret èµ„æºå‚¨å­˜ CA è¯ä¹¦å’Œç§é’¥&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// security/pkg/pki/ca/ca.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// K8S é›†ç¾¤å†…è‡ªç­¾åè¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewSelfSignedIstioCAOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;rootCertGracePeriodPercentile&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootCertCheckInverval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;defaultCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;maxCertTTL&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;org&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dualUse&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;readCertRetryInterval&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;corev1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CoreV1Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;rootCertFile&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;enableJitter&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caRSAKeySize&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IstioCAOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœè¯ä¹¦ä¸å­˜åœ¨åˆ™åˆ›å»ºè¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// åç»­è¯»å– secret è·å–
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// è·å– K8S istio-ca-secret secret èµ„æº
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;caSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scrtErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Secrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TODO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CASecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GetOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// è·å– secret å¤±è´¥ï¼Œå°è¯•å¤šæ¬¡é‡æ–°è·å–
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// è‹¥è¶…æ—¶ä»ç„¶è·å–ä¸åˆ°ï¼Œåˆ™åˆ›å»ºè‡ªç­¾åè¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scrtErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;readCertRetryInterval&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;pkiCaLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Citadel in signing key/cert read only mode. Wait until secret %s:%s can be loaded...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CASecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;ticker&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewTicker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readCertRetryInterval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scrtErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ticker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scrtErr&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Secrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TODO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CASecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GetOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{});&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scrtErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nx&#34;&gt;pkiCaLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Citadel successfully loaded the secret.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IstioCAOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;CAType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;         &lt;span class=&#34;nx&#34;&gt;selfSignedCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 1 è‡ªç­¾åè¯ä¹¦ 2 ç”¨æˆ·è‡ªå®šä¹‰è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;DefaultCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;defaultCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;MaxCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;maxCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// CA è½®è½¬æ£€æŸ¥
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;RotatorConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SelfSignedCARootCertRotatorConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;CheckInterval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;rootCertCheckInverval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;caCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;          &lt;span class=&#34;nx&#34;&gt;caCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;retryInterval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;cmd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ReadSigningCertRetryInterval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤ 5 ç§’
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;retryMax&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;           &lt;span class=&#34;nx&#34;&gt;cmd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ReadSigningCertRetryMax&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤ 30 ç§’
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;certInspector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;certutil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewCertUtil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootCertGracePeriodPercentile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;caStorageNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;dualUse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;dualUse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤ true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;                &lt;span class=&#34;nx&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;rootCertFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;rootCertFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;enableJitter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;enableJitter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;             &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// è·å–ä¸åˆ° secretï¼Œè‡ªç­¾ååˆ›å»º
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scrtErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;pkiCaLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to get secret (error: %s), will create one&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scrtErr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CertOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;TTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;          &lt;span class=&#34;nx&#34;&gt;caCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;Org&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;          &lt;span class=&#34;nx&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;IsCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;         &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¯ä¹¦æ ‡è¯†ä¸º CA
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;IsSelfSigned&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;RSAKeySize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;caRSAKeySize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// Whether this certificate is for dual-use clients (SAN+CN).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;IsDualUse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;dualUse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¿™ä¸ªé€‰é¡¹å…¶å®æ²¡æœ‰ç”¨åˆ°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;pemCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pemKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ckErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GenCertKeyFromOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ckErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;unable to generate CA cert and key for self-signed CA (%v)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ckErr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// è·å– RootCertFile åŠ å…¥æ ¹è¯ä¹¦é“¾
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;rootCerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AppendRootCerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pemCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootCertFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to append root certificates (%v)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// æ„å»ºå‚¨å­˜è¯ä¹¦é“¾çš„å¹¶å‘å®‰å…¨çš„æ•°æ®ç»“æ„ä½“
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;KeyCertBundle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewVerifiedKeyCertBundleFromPem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pemCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pemKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootCerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to create CA KeyCertBundle (%v)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// åœ¨ K8S ä¸­åˆ›å»º secret å‚¨å­˜è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// Write the key/cert back to secret so they will be persistent when CA restarts.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;secret&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;k8ssecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;BuildSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CASecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pemCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pemKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;istioCASecretType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Secrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TODO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CreateOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{});&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// ä»æœ¬åœ°è¯»å– CA è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// è¿”å›è¯ä¹¦æ“ä½œç¬¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é»˜è®¤ä½¿ç”¨ RSA 2048 size ç”Ÿæˆç§é’¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// security/pkg/pki/util/generate_cert.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// GenCertKeyFromOptions generates a X.509 certificate and a private key with the given options.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;GenCertKeyFromOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CertOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pemCert&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pemKey&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤å¿½ç•¥ï¼Œä½¿ç”¨ RSA ç®—æ³•
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ECSigAlg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ç”Ÿæˆ RSA å¯†é’¥
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;rsaPriv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rsa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GenerateKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RSAKeySize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ç”Ÿæˆè¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;genCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rsaPriv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rsaPriv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PublicKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ›å»ºä¸€ä¸ªè¯ä¹¦æ¨¡æ¿ï¼Œéšåä¼šä»æ¨¡æ¿åˆ›å»º CSRï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// security/pkg/pki/util/generate_cert.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// genCertTemplateFromoptions generates a certificate template with the given options.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;genCertTemplateFromOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CertOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;x509&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Certificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;keyUsage&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;x509&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;KeyUsage&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IsCA&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// If the cert is a CA cert, the private key is allowed to sign other certificates.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;keyUsage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;x509&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;KeyUsageCertSign&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Otherwise the private key is allowed for digital signature and key encipherment.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;keyUsage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;x509&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;KeyUsageDigitalSignature&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;x509&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;KeyUsageKeyEncipherment&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;subject&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pkix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Organization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Org&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å¡«å……æ‰©å±•å­—æ®µ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;exts&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pkix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Extension&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// ç”Ÿæˆ SAN
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;BuildSubjectAltNameExtension&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IsDualUse&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// è·å– common name
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;cn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;DualUseCommonName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CommonName&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cn&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;exts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pkix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Extension&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;x509&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Certificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;SerialNumber&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;          &lt;span class=&#34;nx&#34;&gt;serialNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Subject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;NotBefore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;             &lt;span class=&#34;nx&#34;&gt;notBefore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;NotAfter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;              &lt;span class=&#34;nx&#34;&gt;notBefore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;KeyUsage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;              &lt;span class=&#34;nx&#34;&gt;keyUsage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;ExtKeyUsage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;           &lt;span class=&#34;nx&#34;&gt;extKeyUsages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;IsCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;                  &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IsCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;BasicConstraintsValid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;ExtraExtensions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;exts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨å…¥ SPIFFE å·¥ä½œè´Ÿè½½èº«ä»½æ ‡è¯†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// security/pkg/pki/util/san.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// BuildSubjectAltNameExtension builds the SAN extension for the certificate.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;BuildSubjectAltNameExtension&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hosts&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pkix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Extension&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Identity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;host&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;,&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ParseIP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// Use the 4-byte representation of the IP address when possible.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;eip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;To4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;eip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;ip&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;eip&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Identity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TypeIP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HasPrefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;spiffe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URIPrefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Identity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TypeURI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Identity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TypeDNS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;san&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;BuildSANExtension&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;SAN extension building failure (%v)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;san&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// BuildSANExtension builds a `pkix.Extension` of type &amp;#34;Subject
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Alternative Name&amp;#34; based on the given identities.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;BuildSANExtension&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;identites&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Identity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pkix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Extension&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœ subject çš„ä¿¡æ¯ä»…å­˜åœ¨äº subjectAltName æ‰©å±•ä¸­ (ä»…äº Email åœ°å€æˆ– URI ç›¸å…³)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// åˆ™ subject name å¿…é¡»ä¸ºéç©ºç»“æ„ä¸” subjectAltName æ‰©å±•å¿…é¡»ä¸º criticalã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// SAN is Critical because the subject is empty. This is compliant with X.509 and SPIFFE standards.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pkix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Extension&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oidSubjectAlternativeName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Critical&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;SPIFFE ID å‚¨å­˜åœ¨ X.509 è¯ä¹¦çš„ SAN URI å­—æ®µä¸­ã€‚&lt;/p&gt;
&lt;h4 id=&#34;223-å‚¨å­˜è¯ä¹¦&#34;&gt;2.2.3. å‚¨å­˜è¯ä¹¦&lt;/h4&gt;
&lt;p&gt;Istiod çš„ CA è¯ä¹¦åŒæ—¶ä¹Ÿä¼šå‚¨å­˜åˆ°æœ¬åœ°ä¸€ä»½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Save the root public key file and initialize the path the the file, to be used by other components.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;initPublicKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Setup the root cert chain and caBundlePath - before calling initDNSListener.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;features&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PilotCertProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;IstiodCAProvider&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;signingKeyFile&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LocalCertDir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;ca-key.pem&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Stat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;signingKeyFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// When Citadel is configured to use self-signed certs, keep a local copy so other
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// components can load it via file (e.g. webhook config controller).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;MkdirAll&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dnsCertDir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mo&#34;&gt;0700&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// We have direct access to the self-signed
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;internalSelfSignedRootPath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dnsCertDir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;self-signed-root.pem&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;rootCert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetCAKeyCertBundle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetRootCertPem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ioutil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WriteFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;internalSelfSignedRootPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mo&#34;&gt;0600&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caBundlePath&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;internalSelfSignedRootPath&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‚¨å­˜åˆ°æœ¬åœ°ç›®çš„æ˜¯ä¸ºäº†è®©å„ä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼ˆè™½ç„¶åˆå¹¶åˆ° Istiod ç¨‹åºä¸­ï¼‰éƒ½è¯»å–åˆ° CA è¯ä¹¦ã€‚
åŒæ—¶è¿˜ä¼šç›‘å¬æ–‡ä»¶ç³»ç»Ÿçš„å˜åŒ–ï¼ŒåŠæ—¶æ›¿æ¢è¯ä¹¦ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// initCertificateWatches sets up  watches for the certs.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;initCertificateWatches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tlsOptions&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TLSOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// load the cert/key and setup a persistent watch for updates.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;23-ca-è¯ä¹¦è½®æ¢&#34;&gt;2.3. CA è¯ä¹¦è½®æ¢&lt;/h3&gt;
&lt;p&gt;CA è¯ä¹¦è½®æ¢çš„ä»£ç ä½äº &lt;code&gt;security/pkg/pki/ca/selfsignedcarootcertrotator.go&lt;/code&gt; æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æ¨¡å—å®šæœŸæ£€æŸ¥ CA è¯ä¹¦æœ‰æ•ˆæ€§ï¼Œæ¯”å¯¹ Kubernetes çš„ Secret èµ„æºä¸­çš„ CA è¯ä¹¦ä¸å†…å­˜ä¸­å‚¨å­˜çš„ CA è¯ä¹¦æ˜¯å¦ä¸€è‡´ã€‚
è‹¥è¯ä¹¦å³å°†è¿‡æœŸï¼Œåˆ™ä½¿ç”¨ç§é’¥é‡æ–°ç­¾åï¼Œä»¥é¢å‘æ–°çš„å¯ç”¨çš„ CA è¯ä¹¦ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// NewSelfSignedCARootCertRotator returns a new root cert rotator instance that
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// rotates self-signed root cert periodically.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewSelfSignedCARootCertRotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SelfSignedCARootCertRotatorConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IstioCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SelfSignedCARootCertRotator&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SelfSignedCARootCertRotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;caSecretController&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewCaSecretController&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;             &lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;                 &lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥è¯ä¹¦è½®æ¢å™¨å¸¦æœ‰æŒ‡æ•°é€€é¿ç®—æ³•ï¼Œä»¥æ›´ä¼˜é›…åœ°å®šæœŸé”™è¯¯é‡è¯•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Run refreshes root certs and updates config map accordingly.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SelfSignedCARootCertRotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ticker&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewTicker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CheckInterval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ticker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;rootCertRotatorLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Check and rotate root cert.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;checkAndRotateRootCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;checkAndRotateRootCert&lt;/code&gt; å‡½æ•°å®šæ—¶è¢«æ‰§è¡Œï¼Œä»¥ç¡®è®¤è¯ä¹¦çš„æœ‰æ•ˆæ€§æŒ‡æ ‡ã€‚
&lt;em&gt;Citadel&lt;/em&gt; æ˜¯ Istio ä¸­ä¸“é—¨è´Ÿè´£è®¤è¯ç›¸å…³çš„ç»„ä»¶ï¼Œè™½ç„¶åˆå¹¶åˆ° Istiod ä¸­ï¼Œ
åœ¨ä»£ç ä¸­å®ƒè¿˜æ˜¯è¢«å•ç‹¬å½’ç±»ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// checkAndRotateRootCert decides whether root cert should be refreshed, and rotates
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// root cert for self-signed Citadel.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SelfSignedCARootCertRotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;checkAndRotateRootCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å¸¦å¤±è´¥é‡è¯•è·å– CA è¯ä¹¦çš„ K8s secret
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;caSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scrtErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caSecretController&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LoadCASecretWithRetry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CASecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caStorageNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;retryInterval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;retryMax&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scrtErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;checkAndRotateRootCertForSigningCertCitadel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// checkAndRotateRootCertForSigningCertCitadel checks root cert secret and rotates
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// root cert if the current one is about to expire. The rotation uses existing
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// root private key to generate a new root cert, and updates root cert secret.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SelfSignedCARootCertRotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;checkAndRotateRootCertForSigningCertCitadel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;caSecret&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Check root certificate expiration time in CA secret
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;waitTime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;certInspector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetWaitTime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caCertID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;waitTime&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;rootCertRotatorLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Root cert is not about to expire, skipping root cert rotation.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;caCertInMem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetCAKeyCertBundle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetAllPem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// æ¯”è¾ƒå†…å­˜ä¸­çš„è¯ä¹¦ä¸ K8S ä¸­çš„è¯ä¹¦æ˜¯å¦ä¸€è‡´
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// If CA certificate is different from the CA certificate in local key
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// cert bundle, it implies that other Citadels have updated istio-ca-secret.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// Reload root certificate into key cert bundle.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Equal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caCertInMem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caCertID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// æ ¡éªŒè¯ä¹¦å¹¶å°†è¯ä¹¦åŠ è½½åˆ°å†…å­˜ä¸­ç¼“å­˜
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetCAKeyCertBundle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;VerifyAndSetAll&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caCertID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;caSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caPrivateKeyID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootCerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;rootCertRotatorLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to reload root cert into KeyCertBundle (%v)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;rootCertRotatorLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Successfully reloaded root cert into KeyCertBundle.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;rootCertRotatorLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Refresh root certificate, root cert is about to expire: %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CertOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;TTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;           &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;SignerPrivPem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caPrivateKeyID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Org&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;           &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;IsCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;          &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;IsSelfSigned&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;RSAKeySize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caRSAKeySize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;IsDualUse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dualUse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// options should be consistent with the one used in NewSelfSignedIstioCAOptions().
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// This is to make sure when rotate the root cert, we don&amp;#39;t make unnecessary changes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// to the certificate or add extra fields to the certificate.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;MergeCertOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldCertOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// é‡æ–°ç­¾å‘è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;pemCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pemKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ckErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GenRootCertFromExistingKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ckErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;rootCertRotatorLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;unable to generate CA cert and key for self-signed CA: %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ckErr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// åœ¨ K8S åŠå†…å­˜ä¸­æ›´æ–°è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rollback&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;updateRootCertificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pemCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pemKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pemRootCerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// caSecret is out-of-date. Need to load the latest istio-ca-secret to roll back root certificate.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;updateRootCertificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldCaCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldCaPrivateKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldRootCerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;rootCertRotatorLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to roll backward root certificate (error: %s).&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;rootCertRotatorLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Root certificate rotation is completed successfully.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŒæ—¶è¯ä¹¦æ›´æ–°æ›¿æ¢æ—¶ä¹Ÿæœ‰å¤±è´¥å›æ»šæœºåˆ¶ï¼ŒCA è¯ä¹¦è½®æ¢å Istio ä¼šæ›´æ–° Kubernetes ä¸­ Secret èµ„æºï¼Œä»¥åŠå†…å­˜ä¸­ç¼“å­˜çš„è¯ä¹¦èµ„æºã€‚
è¿™ç±»è¯ä¹¦è½®æ¢å‡½æ•°ï¼Œè¿è¡Œåœ¨ç‹¬ç«‹çš„åç¨‹ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IstioCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopChan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootCertRotator&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Start root cert rotator in a separate goroutine.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootCertRotator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopChan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;24-ç­¾å‘-workload-è¯ä¹¦&#34;&gt;2.4. ç­¾å‘ Workload è¯ä¹¦&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸Šéƒ¨åˆ†æ˜¯ Istio å¦‚ä½•ç­¾å‘ CA ä¸è½®æ¢ CA è¯ä¹¦ï¼Œå› ä¸ºè¯ä¹¦éƒ½æ˜¯åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ç­¾å‘ä¸æ›¿æ¢ï¼Œä¸æ¶‰åŠé¢å¤–çš„ç½‘ç»œæ“ä½œï¼Œ
ç›¸å¯¹æµç¨‹æ¯”è¾ƒæ¸…æ™°ã€‚Workload è¯ä¹¦ç­¾å‘æ˜¯ç”±ç‹¬ç«‹è¿è¡Œçš„å·¥ä½œè´Ÿè½½çš„ Pod ä¸­çš„ Agent è¿›ç¨‹å‘ Kubernetes è¿›è¡Œè®¤è¯åï¼Œ
å‘é€ CSR è¯·æ±‚ç»™ Istio CA æœåŠ¡å™¨è¿›è¡Œç­¾åçš„ã€‚å®ƒè¿˜æ‹¥æœ‰ä¸€å¥—ç‰¹æ®Šçš„é€šä¿¡åè®®ã€‚&lt;/p&gt;
&lt;h4 id=&#34;241-å¯åŠ¨-ca-æœåŠ¡å™¨&#34;&gt;2.4.1. å¯åŠ¨ CA æœåŠ¡å™¨&lt;/h4&gt;
&lt;p&gt;Istiod å¯åŠ¨ CA æœåŠ¡å™¨ï¼Œå“åº”å·¥ä½œè´Ÿè½½ç­¾å‘ç¬¦åˆè‡ªèº«æƒé™èº«ä»½çš„ CSR è¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// StartCA starts the CA or RA server if configured.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;startCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;addStartFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stop&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;grpcServer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;secureGrpcServer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;secureGrpcServer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nx&#34;&gt;grpcServer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpcServer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// Start the RA server if configured, else start the CA server
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RA&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CA&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Starting IstioD CA&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RunCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpcServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;CA æœåŠ¡å™¨çš„æ¥å£æ³¨å†Œåœ¨ grpc æœåŠ¡å™¨ä¸Šï¼Œæ³¨æ„è¿™é‡Œå¼€å¯äº† TLSï¼Œé€šä¿¡åè®®æ˜¯ grpcsã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// åœ¨ GRPCS æœåŠ¡å™¨ä¸Šå¼€å¯ CA
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// RunCA will start the cert signing GRPC service on an existing server.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Protected by installer options: the CA will be started only if the JWT token in /var/run/secrets
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// is mounted. If it is missing - for example old versions of K8S that don&amp;#39;t support such tokens -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// we will not start the cert-signing server, since pods will have no way to authenticate.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;RunCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caserver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CertificateAuthority&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;iss&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;trustedIssuer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤ä¸ºç©º
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;aud&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;audience&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤ä¸ºç©º
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å¡«å…… iss å’Œ aud
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤è·å– K8S SA Token
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// &amp;#34;/var/run/secrets/kubernetes.io/serviceaccount/token&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ioutil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReadFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;jwtPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// è·å– JWT Payload
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;tok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;detectAuthEnv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Starting with invalid K8S JWT token&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;iss&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;iss&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Iss&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Aud&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;aud&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;aud&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Aud&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// The CA API uses cert with the max workload cert TTL.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// &amp;#39;hostlist&amp;#39; must be non-empty - but is not used since a grpc server is passed.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// Adds client cert auth and kube (sds enabled)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºç»™ Workload é¢å‘è¯ä¹¦çš„ CA
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;caServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;startErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caserver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;maxWorkloadCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authenticators&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;startErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to create istio ca server: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;startErr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æ³¨å†Œ GRPC PB
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;caServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Register&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Istiod CA has started&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Kubernetes Serivce Account Token åŒ…å«çš„ Payload æ•°æ®ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;iss&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;kubernetes/serviceaccount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;kubernetes.io/serviceaccount/namespace&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio-system&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;kubernetes.io/serviceaccount/secret.name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio-reader-service-account-token-zmks5&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;kubernetes.io/serviceaccount/service-account.name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio-reader-service-account&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;kubernetes.io/serviceaccount/service-account.uid&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;9a544d83-ed88-474f-967c-27473357ee95&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;sub&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;system:serviceaccount:istio-system:istio-reader-service-account&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é»˜è®¤é…ç½®ä¸­ï¼Œç­¾å‘ç»™ Workload çš„è¯ä¹¦çš„æœ‰æ•ˆæœŸæ˜¯ 90 å¤©ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// security/pkg/server/ca/server.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Register registers a GRPC server on the specified port.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Register&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpcServer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;pb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterIstioCertificateServiceServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpcServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// istio.io\api@v0.0.0-20201125194658-3cee6a1d3ab4\security\v1alpha1\ca.pb.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// IstioCertificateServiceServer is the server API for IstioCertificateService service.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;IstioCertificateServiceServer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Using provided CSR, returns a signed certificate.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;CreateCertificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IstioCertificateRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IstioCertificateResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;CA æœåŠ¡å™¨çš„ grpc æ¥å£åªæœ‰ä¸€ä¸ª &lt;code&gt;CreateCertificate&lt;/code&gt; æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•å¤„ç† CSR è¯·æ±‚ã€‚&lt;/p&gt;
&lt;h4 id=&#34;242-ç­¾å‘è¯ä¹¦&#34;&gt;2.4.2. ç­¾å‘è¯ä¹¦&lt;/h4&gt;
&lt;p&gt;é€šè¿‡ grpcs åè®®æ¥æ”¶åˆ° CSR è¯·æ±‚æ—¶ï¼Œé¦–å…ˆä¼šè¿›è¡Œè®¤è¯ï¼š&lt;/p&gt;
&lt;p&gt;Istio æ”¯æŒå¤šç§æ–¹å¼è¿›è¡Œè®¤è¯ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯è¯ä¹¦ã€K8s JWTã€ID Token ç­‰ï¼ŒIstio è®¤è¯æ–¹æ³•ä¸­ä¼šå°è¯•ä»å¤šä¸ªè®¤è¯æºè¿›è¡Œè®¤è¯ï¼Œ
é€‰æ‹©å‡ºèƒ½å¤ŸéªŒè¯å®¢æˆ·ç«¯èº«ä»½çš„ä¸€ç§æ–¹å¼ï¼Œå½“ç„¶è®¤è¯å¤±è´¥å°±å¤±è´¥äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// authenticate goes through a list of authenticators (provided client cert, k8s jwt, and ID token)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// and authenticates if one of them is valid.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;authenticate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;authenticate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Caller&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// TODO: apply different authenticators in specific order / according to configuration.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;errMsg&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;authn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authenticators&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;authn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Authenticate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;serverCaLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warnf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Authentication failed for %v: %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getConnectionAddress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;errMsg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…·ä½“å¤„ç† CSR åˆ›å»ºè¯ä¹¦çš„æ¥å£é€»è¾‘ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// CreateCertificate handles an incoming certificate signing request (CSR). It does
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// authentication and authorization. Upon validated, signs a certificate that:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// the SAN is the identity of the caller in authentication result.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// the subject public key is the public key in the CSR.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// the validity duration is the ValidityDuration in request, or default value if the given duration is invalid.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// it is signed by the CA signing key.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;CreateCertificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;request&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IstioCertificateRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IstioCertificateResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// metrics
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;monitoring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CSR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Increment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ä» GRPC CTX è·å– TLS Info é‡Œé¢çš„ SPIFFE ID
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;caller&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;authenticate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caller&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// ç¼ºå°‘ TLS Info çš„å®¢æˆ·ç«¯è¯ä¹¦çš„ SAN URI å­—æ®µ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;monitoring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AuthnError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Increment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;codes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Unauthenticated&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;request authenticate failure&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// TODO: Call authorizer.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;certChainBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootCertBytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetCAKeyCertBundle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetAll&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ç­¾å‘è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;cert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;signErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sign&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Csr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Identities&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ValidityDuration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;respCertChain&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;certChainBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// åŠ å…¥è¯ä¹¦é“¾
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;respCertChain&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;respCertChain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;certChainBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;respCertChain&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;respCertChain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootCertBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IstioCertificateResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;CertChain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;respCertChain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;monitoring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Success&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Increment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;serverCaLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Debug&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;CSR successfully signed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;25-raæ³¨å†Œæœºæ„&#34;&gt;2.5. RAï¼ˆæ³¨å†Œæœºæ„ï¼‰&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Istio å¸¦æœ‰ç°æˆçš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ï¼Œä½†ä¸å°‘ç”¨æˆ·ä¹Ÿå¸Œæœ›èƒ½å¤Ÿæ¥å…¥ç°æœ‰ CAã€‚
åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæ‚¨éœ€è¦å®ç° Istio CSR  API å¹¶è‡ªè¡Œç¼–å†™ç¬¬ä¸‰æ–¹é›†æˆã€‚
åœ¨ Istio 1.8 ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ç§ä½¿ç”¨ Kubernetes CSR  API çš„æ–°æ–¹æ³•ï¼Œæ­¤æ–¹æ³•å¯ä¸ä»»ä½•èƒ½å¤Ÿä½¿ç”¨æ­¤ API çš„å·¥å…·ç›¸é›†æˆã€‚
Istiod å°†å……å½“æ³¨å†Œæœºæ„ï¼ˆRAï¼‰è§’è‰²ï¼Œè´Ÿè´£å¯¹å·¥ä½œè´Ÿè½½è¿›è¡Œèº«ä»½éªŒè¯åŠæˆæƒï¼Œè€Œååˆ›å»ºã€æ‰¹å‡†å¹¶ç›‘æ§ CSR èµ„æºçš„æ›´æ–°ã€‚
æ¥ä¸‹æ¥ï¼Œç¬¬ä¸‰æ–¹å·¥å…·ï¼ˆä¾‹å¦‚ cert-managerï¼‰å³å¯ä½¿ç”¨æ­£ç¡®çš„ç­¾åç¨‹åºåˆ›å»ºå…·æœ‰é€‚å½“åç«¯ CA çš„ç­¾åè¯ä¹¦ã€‚
æ­¤åŠŸèƒ½ç›®å‰å°šå¤„äºè¯•éªŒé˜¶æ®µã€‚&lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pilot/pkg/bootstrap/server.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;maybeCreateCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;EnableCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ExternalCAType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;createIstioRA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kubeClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to create RA: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœé…ç½®äº†è‡ªå®šä¹‰ CAï¼Œåˆ™å¯ç”¨ RA åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pilot/pkg/bootstrap/istio_ca.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// createIstioRA initializes the Istio RA signing functionality.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// the caOptions defines the external provider
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createIstioRA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubelib&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ra&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RegistrationAuthority&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nx&#34;&gt;caCertFile&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ra&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DefaultExtCACertDir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;constants&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CACertNamespaceConfigMapDataName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Stat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;caCertFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;caCertFile&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;defaultCACertPath&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nx&#34;&gt;raOpts&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ra&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IstioRAOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;ExternalCAType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ExternalCAType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;DefaultCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;workloadCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;MaxCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;maxWorkloadCertTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;CaSigner&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ExternalCASigner&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;CaCertFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;caCertFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;VerifyAppendCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;K8sClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CertificatesV1beta1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ra&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewIstioRA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;raOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// security/pkg/pki/ra/common.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// NewIstioRA is a factory method that returns an RA that implements the RegistrationAuthority functionality.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// the caOptions defines the external provider
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewIstioRA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IstioRAOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RegistrationAuthority&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ExternalCAType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExtCAK8s&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;istioRA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewKubernetesRA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to create an K8s CA: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;istioRA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;invalid CA Name %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ExternalCAType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çœ‹ä¸Šå» RA ç±»å‹ç°åœ¨åªæ”¯æŒ Kubernetes ä¸€ç§ã€‚&lt;/p&gt;
&lt;p&gt;RA é»˜è®¤ä¸å¯ç”¨ï¼ŒåŒæ—¶å¤„äºè¯•éªŒé˜¶æ®µï¼Œè¿™é‡Œä¸åŠ ä»¥åˆ†æã€‚&lt;/p&gt;
&lt;h2 id=&#34;3-é€šä¿¡å®‰å…¨&#34;&gt;3. é€šä¿¡å®‰å…¨&lt;/h2&gt;
&lt;p&gt;åŠ å¯†å’Œè®¤è¯é€šå¸¸æ˜¯ç´§å¯†ç›¸å…³çš„ï¼Œåœ¨é›¶ä¿¡ä»»æµé‡å®‰å…¨ä¸­ï¼Œ
å¯¹äºå®¢æˆ·ç«¯/æœåŠ¡å™¨çš„äº¤äº’ï¼Œä½¿ç”¨åŒå‘è®¤è¯çš„ TLS åè®®æ˜¯ä¸€ç§çš„åˆç†çš„ç½‘ç»œå®‰å…¨æ–¹æ¡ˆï¼Œ
è¿™ç§æ–¹æ¡ˆé€šå¸¸åŒ…æ‹¬é…ç½®å®¢æˆ·ç«¯å¹¶å°†å®¢æˆ·ç«¯è¯ä¹¦æä¾›ç»™æœåŠ¡å™¨ç«¯è®¿é—®ä»£ç†ï¼Œä»¥ç¡®ä¿è¿æ¥ç»è¿‡è®¤è¯å’Œæˆæƒ&lt;sup id=&#34;fnref:7&#34;&gt;&lt;a href=&#34;#fn:7&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;7&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;31-åŠ å¯†ä¸è®¤è¯&#34;&gt;3.1. åŠ å¯†ä¸è®¤è¯&lt;/h3&gt;
&lt;h4 id=&#34;311-tls-éªŒè¯&#34;&gt;3.1.1. TLS éªŒè¯&lt;/h4&gt;
&lt;p&gt;åˆå§‹åŒ–æœåŠ¡ç«¯çš„ TLS çš„æ ¡éªŒæ–¹å¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pilot/pkg/bootstrap/server.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;cfg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;GetCertificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;getIstiodCertificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;ClientAuth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VerifyClientCertIfGiven&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;ClientCAs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;peerCertVerifier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetGeneralCertPool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;VerifyPeerCertificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rawCerts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[][]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;verifiedChains&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[][]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;x509&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Certificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// ä½¿ç”¨ SPIFFE åŒ…æ ¡éªŒ TLS è¯ä¹¦æœ‰æ•ˆæ€§
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;peerCertVerifier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;VerifyPeerCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rawCerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;verifiedChains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Could not verify certificate: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ClientAuth æœ‰äº”ç§ç±»å‹ï¼Œå„è‡ªçš„å«ä¹‰æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;NoClientCertï¼šå¿½ç•¥ä»»ä½•å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå³å®¢æˆ·ç«¯å¯ä»¥ä¸æä¾›è¯ä¹¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;RequestClientCerï¼šè¦æ±‚å®¢æˆ·ç«¯æä¾›è¯ä¹¦ï¼Œä½†æ˜¯å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰æä¾›è¯ä¹¦ï¼ŒæœåŠ¡ç«¯è¿˜æ˜¯ä¼šç»§ç»­å¤„ç†è¯·æ±‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;RequireAnyClientCertï¼šéœ€è¦å®¢æˆ·ç«¯æä¾›è¯ä¹¦ï¼Œä½†ä¸ç”¨ ClientCA æ¥éªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;VerifyClientCertIfGivenï¼šå¦‚æœå®¢æˆ·ç«¯æä¾›äº†è¯ä¹¦ï¼Œåˆ™ç”¨ ClientCA æ¥éªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ã€‚å¦‚æœå®¢æˆ·ç«¯æ²¡æä¾›ï¼Œåˆ™ä¼šç»§ç»­å¤„ç†è¯·æ±‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;RequireAndVerifyClientCertï¼šéœ€è¦å®¢æˆ·ç«¯æä¾›è¯ä¹¦ï¼Œä¸”ä¼šç”¨ ClientCA æ¥éªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ tlsConfig ä¸­å¦‚æœä¸æ˜¾å¼çš„æŒ‡å®š ClientAuthï¼Œåˆ™é»˜è®¤å€¼æ˜¯ NoClientCertã€‚å³ä½¿ Server ç«¯é…ç½®äº† CAï¼Œä¹Ÿä¸ä¼šæ ¡éªŒå®¢æˆ·ç«¯è¯ä¹¦ã€‚&lt;/p&gt;
&lt;h4 id=&#34;312-èº«ä»½è®¤è¯&#34;&gt;3.1.2. èº«ä»½è®¤è¯&lt;/h4&gt;
&lt;p&gt;é…ç½®æœåŠ¡ç«¯å¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½è®¤è¯çš„æ–¹å¼ï¼Œé»˜è®¤å¯ç”¨å®¢æˆ·ç«¯è¯ä¹¦ï¼Œä»¥åŠ K8s JWTã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;c1&#34;&gt;// pilot/pkg/bootstrap/server.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;c1&#34;&gt;// Notice that the order of authenticators matters, since at runtime
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// authenticators are activated sequentially and the first successful attempt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// is used as the authentication result.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// The JWT authenticator requires the multicluster registry to be initialized, so we build this later
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;authenticators&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;authenticate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authenticator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;authenticate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ClientCertAuthenticator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nx&#34;&gt;kubeauth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewKubeJWTAuthenticator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kubeClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clusterID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;multicluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GetRemoteKubeClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;spiffe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetTrustDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;features&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;JwtPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤å¯ç”¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;caOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authenticators&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;authenticators&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;features&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;XDSAuth&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;XDSServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authenticators&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;authenticators&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ— è®ºæ˜¯ grpcsï¼Œè¿˜æ˜¯ grpc åè®®éƒ½ä¼šå¯ç”¨å¼ºè®¤è¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// security/pkg/server/ca/authenticate/model.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Caller carries the identity and authentication source of a caller.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Caller&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;AuthSource&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;AuthSource&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Identities&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Authenticator&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;Authenticate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Caller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;AuthenticatorType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®ç°äº† Authenticator æ¥å£çš„è®¤è¯å™¨è°ƒç”¨ Authenticate æ–¹æ³•ä» grpc è¯·æ±‚çš„ä¸Šä¸‹æ–‡ Metadata å­—æ®µä¸­è·å– Caller ä¿¡æ¯ï¼Œæ ¡éªŒå¤±è´¥åˆ™è¿”å›é”™è¯¯ã€‚&lt;/p&gt;
&lt;h5 id=&#34;å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯&#34;&gt;å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// security/pkg/server/ca/authenticate/cert_authenticator.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ClientCertAuthenticator extracts identities from client certificate.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ClientCertAuthenticator&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Authenticator&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ClientCertAuthenticator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cca&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ClientCertAuthenticator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;AuthenticatorType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ClientCertAuthenticatorType&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Authenticate extracts identities from presented client certificates. This
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// method assumes that certificate chain has been properly validated before
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// this method is called. In other words, this method does not do certificate
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// chain validation itself.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cca&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ClientCertAuthenticator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Authenticate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Caller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ä» GRPC è¿æ¥è·å– peer ä¿¡æ¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;peer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;peer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;FromContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;peer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AuthInfo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;no client certificate is presented&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// è¿æ¥å¿…é¡»ä¸º TLS
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;authType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;peer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AuthInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AuthType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;authType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;tls&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;unsupported auth type: %q&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;authType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;tlsInfo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;peer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AuthInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;credentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TLSInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;chains&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tlsInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;State&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VerifiedChains&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;no verified chain is found&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ExtractIDs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Extensions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Caller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;AuthSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;AuthSourceClientCertificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Identities&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// id åº”è¯¥å°±æ˜¯ SPIFFE ID
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;grpc TLS åŒ…ä¼šåœ¨ TLS æ¡æ‰‹é˜¶æ®µè·å– SPIFFIE IDï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// grpc@v1.33.1\credentials\tls.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// TLSInfo contains the auth information for a TLS authenticated connection.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// It implements the AuthInfo interface.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TLSInfo&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;State&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ConnectionState&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;CommonAuthInfo&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// This API is experimental.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;SPIFFEID&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URL&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tlsCreds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ServerHandshake&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rawConn&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;AuthInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rawConn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Handshake&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;tlsInfo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TLSInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;State&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ConnectionState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;CommonAuthInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CommonAuthInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;SecurityLevel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrivacyAndIntegrity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;credinternal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SPIFFEIDFromState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ConnectionState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;tlsInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SPIFFEID&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;credinternal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WrapSyscallConn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rawConn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tlsInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// grpc@v1.33.1\internal\credentials\spiffe.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// SPIFFEIDFromState parses the SPIFFE ID from State. If the SPIFFE ID format
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// is invalid, return nil with warning.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;SPIFFEIDFromState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ConnectionState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URL&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PeerCertificates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PeerCertificates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URIs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;spiffeID&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URL&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;uri&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PeerCertificates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URIs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;uri&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Scheme&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;spiffe&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Opaque&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;User&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;User&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// From this point, we assume the uri is intended for a SPIFFE ID.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2048&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;logger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warning&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;invalid SPIFFE ID: total ID length larger than 2048 bytes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RawPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;logger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warning&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;invalid SPIFFE ID: domain or workload ID is empty&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;logger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warning&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;invalid SPIFFE ID: domain length larger than 255 characters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// A valid SPIFFE certificate can only have exactly one URI SAN field.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PeerCertificates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URIs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;logger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warning&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;invalid SPIFFE ID: multiple URI SANs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;spiffeID&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;uri&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;spiffeID&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;k8s-jwt-è®¤è¯&#34;&gt;K8s JWT è®¤è¯&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// security/pkg/server/ca/authenticate/kubeauth/kube_jwt.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// KubeJWTAuthenticator authenticates K8s JWTs.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;KubeJWTAuthenticator&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;trustDomain&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;jwtPolicy&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Primary cluster kube client
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;kubeClient&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Interface&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Primary cluster ID
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;clusterID&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// remote cluster kubeClient getter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;remoteKubeClientGetter&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;RemoteKubeClientGetter&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;authenticate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authenticator&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;KubeJWTAuthenticator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Authenticate authenticates the call using the K8s JWT from the context.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// The returned Caller.Identities is in SPIFFE format.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;KubeJWTAuthenticator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Authenticate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;authenticate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Caller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ä» HTTP Authenticate å­—æ®µè·å– JWT Token
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;targetJWT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;authenticate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ExtractBearerToken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;clusterID&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;extractClusterID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;kubeClient&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetKubeClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clusterID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokenreview&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValidateK8sJwt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kubeClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;targetJWT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;aud&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;callerNamespace&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;callerServiceAccount&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;authenticate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Caller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;AuthSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;authenticate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AuthSourceIDToken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Identities&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;authenticate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IdentityTemplate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;trustDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;callerNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;callerServiceAccount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä» grpc é€šä¿¡ Metadata ä¸­è·å– JWT Tokenï¼Œä¸ K8s API Server é€šä¿¡è®¤è¯ Tokenï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ValidateK8sJwt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kubeClient&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;targetToken&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;aud&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;tokenReview&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k8sauth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TokenReview&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;k8sauth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TokenReviewSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;Token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;targetToken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;reviewRes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubeClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AuthenticationV1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TokenReviews&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TODO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokenReview&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CreateOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getTokenReviewResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reviewRes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»ä»£ç æ³¨é‡Šä¸­å¯ä»¥çœ‹åˆ°è¯·æ±‚å’Œè¿”å›çš„ç¤ºä¾‹æ•°æ®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// An example SA token:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// {&amp;#34;alg&amp;#34;:&amp;#34;RS256&amp;#34;,&amp;#34;typ&amp;#34;:&amp;#34;JWT&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// {&amp;#34;iss&amp;#34;:&amp;#34;kubernetes/serviceaccount&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;//  &amp;#34;kubernetes.io/serviceaccount/namespace&amp;#34;:&amp;#34;default&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;//  &amp;#34;kubernetes.io/serviceaccount/secret.name&amp;#34;:&amp;#34;example-pod-sa-token-h4jqx&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;//  &amp;#34;kubernetes.io/serviceaccount/service-account.name&amp;#34;:&amp;#34;example-pod-sa&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;//  &amp;#34;kubernetes.io/serviceaccount/service-account.uid&amp;#34;:&amp;#34;ff578a9e-65d3-11e8-aad2-42010a8a001d&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;//  &amp;#34;sub&amp;#34;:&amp;#34;system:serviceaccount:default:example-pod-sa&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;//  }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// An example token review status
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// &amp;#34;status&amp;#34;:{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;//   &amp;#34;authenticated&amp;#34;:true,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;//   &amp;#34;user&amp;#34;:{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;//     &amp;#34;username&amp;#34;:&amp;#34;system:serviceaccount:default:example-pod-sa&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;//     &amp;#34;uid&amp;#34;:&amp;#34;ff578a9e-65d3-11e8-aad2-42010a8a001d&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;//     &amp;#34;groups&amp;#34;:[&amp;#34;system:serviceaccounts&amp;#34;,&amp;#34;system:serviceaccounts:default&amp;#34;,&amp;#34;system:authenticated&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;//    }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;32-xds-é€šä¿¡åè®®&#34;&gt;3.2. xDS é€šä¿¡åè®®&lt;/h3&gt;
&lt;p&gt;SDS åè®®æ˜¯ xDS åè®®çš„ä¸€ç±»ï¼Œåœ¨ Istio ä¸­ï¼ŒSDS ç”¨äºä¼ è¾“è¯ä¹¦æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-zero-trust-source-code-reading/graph-xds_hu88e5646ef8ebe82d5c7b61ad0e03dd11_21885_1617d13722994d0f6c01360201b7301d.webp 400w,
               /blog/istio-zero-trust-source-code-reading/graph-xds_hu88e5646ef8ebe82d5c7b61ad0e03dd11_21885_b60daa126448eed111c9f4d4e884cabc.webp 760w,
               /blog/istio-zero-trust-source-code-reading/graph-xds_hu88e5646ef8ebe82d5c7b61ad0e03dd11_21885_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istio-zero-trust-source-code-reading/graph-xds_hu88e5646ef8ebe82d5c7b61ad0e03dd11_21885_1617d13722994d0f6c01360201b7301d.webp&#34;
               width=&#34;760&#34;
               height=&#34;176&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;em&gt;pilot-agent&lt;/em&gt; åŸæœ¬å« Node Agentï¼Œè´Ÿè´£è½¬å‘ Envoy çš„ SDS è¯·æ±‚ï¼Œä»¥åŠè´Ÿè´£ç”Ÿæˆ CSR è¯·æ±‚åˆ° discoveryã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é¿å…æ··æ·†ï¼Œæ³¨æ˜é•œåƒåï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pilot-agent: &lt;code&gt;istio/proxyv2:1.8.0&lt;/code&gt; ä¸­çš„ &lt;code&gt;pilot-agent proxy sidecar&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;discovery: &lt;code&gt;istio/pilot:1.8.0&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;321-server&#34;&gt;3.2.1. Server&lt;/h4&gt;
&lt;h5 id=&#34;äº‹ä»¶å¹¿æ’­&#34;&gt;äº‹ä»¶å¹¿æ’­&lt;/h5&gt;
&lt;p&gt;Discovery åˆå§‹åŒ– SDS æœåŠ¡å™¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// initSDSServer starts the SDS server
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;initSDSServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PilotArgs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kubeClient&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;features&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EnableXDSIdentityCheck&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// Make sure we have security
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warnf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;skipping Kubernetes credential reader; PILOT_ENABLE_XDS_IDENTITY_CHECK must be set to true for this feature.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// å¯ç”¨ XDS Namespace è®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤æ˜¯ istio-system Namespace
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// ç›‘å¬ K8S Secrets å˜åŒ–
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubesecrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewMulticluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kubeClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clusterID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RegistryOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ClusterRegistriesNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddEventHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;XDSServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ConfigUpdate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PushRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nx&#34;&gt;Full&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nx&#34;&gt;ConfigsUpdated&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ConfigKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nx&#34;&gt;Kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;gvk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nx&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;p&#34;&gt;}:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nx&#34;&gt;Reason&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TriggerReason&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SecretTrigger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// XDS Generator
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;XDSServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Generators&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SecretType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;xds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewSecretGen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;XDSServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;SecretController&lt;/code&gt; ä¼šç›‘è§† K8s é›†ç¾¤ä¸­ç‰¹æ®Šç±»å‹ï¼ˆIstio å¤šé›†ç¾¤ï¼‰çš„ Secret èµ„æºå˜åŒ–ï¼Œå¹¶é€šè¿‡ xDS å¹¿æ’­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pkg/kube/secretcontroller/secretcontroller.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;secretsInformer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewSharedIndexInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ListWatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;ListFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;meta_v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ListOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;c1&#34;&gt;// é™å®š Label ä¸º &amp;#34;istio/multiCluster=true&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                &lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LabelSelector&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MultiClusterSecretLabel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;=true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubeclientset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CoreV1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Secrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TODO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;WatchFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;meta_v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ListOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LabelSelector&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MultiClusterSecretLabel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;=true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubeclientset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CoreV1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Secrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TODO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;corev1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Indexers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;gateway-è¯ä¹¦&#34;&gt;Gateway è¯ä¹¦&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;Generate&lt;/code&gt; æ–¹æ³•ä»…ä»…åœ¨ pilot-agent ç±»å‹ä¸º routerï¼ˆå³ Gatewayï¼‰çš„æ—¶å€™ç”Ÿæˆ Envoy ä½¿ç”¨çš„è¯ä¹¦è¿”å›ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pilot/pkg/xds/sds.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ä¸ Node Agent ä¹Ÿå°±æ˜¯ Istio Proxy è¿›è¡Œé€šä¿¡è¿”å›çš„æ–¹æ³•
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SecretGen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Generate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;proxy&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Proxy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PushContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WatchedResource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PushRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Resources&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨ K8S API Server ç¡®è®¤èº«ä»½ SA æ˜¯å¦æœ‰æƒé™è®¿é—® secrets
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;secrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Authorize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;proxy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VerifiedIdentity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ServiceAccount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VerifiedIdentity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;adsLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warnf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;proxy %v is not authorized to receive secrets: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;c1&#34;&gt;// å¦‚æœä¸æ˜¯ gateway åˆ™è¿”å› nil
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;needsUpdate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;proxy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ConfigsUpdated&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;updatedSecrets&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ConfigKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Full&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;updatedSecrets&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ConfigsOfKind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ConfigsUpdated&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gvk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nx&#34;&gt;results&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resource&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceNames&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;isCAOnlySecret&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HasSuffix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;GatewaySdsCaSuffix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isCAOnlySecret&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nx&#34;&gt;secret&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;secrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetCaCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;secret&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;toEnvoyCaSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;results&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;results&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;adsLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warnf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to fetch ca certificate for %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;c1&#34;&gt;// ç”Ÿæˆå¯†é’¥å’Œè¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;         &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;secrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetKeyAndCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;toEnvoyKeyCertSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;results&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;results&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;adsLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warnf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to fetch key and certificate for %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;results&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;322-client&#34;&gt;3.2.2. Client&lt;/h4&gt;
&lt;h5 id=&#34;åˆå§‹åŒ–-sds&#34;&gt;åˆå§‹åŒ– SDS&lt;/h5&gt;
&lt;p&gt;é…ç½®é¡¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pilot-agent æ›´æ–°è¯ä¹¦å‘¨æœŸæ˜¯ 24 å°æ—¶
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;secretTTLEnv&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterDurationVar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;SECRET_TTL&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;24&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Hour&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s&#34;&gt;&amp;#34;The cert lifetime requested by istio agent&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pkg/istio-agent/agent.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Agent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;isSidecar&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podNamespace&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æœ¬åœ°è¿›ç¨‹è¯ä¹¦ç¼“å­˜
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// TODO: remove the caching, workload has a single cert
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WorkloadSecrets&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WorkloadSecrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;newWorkloadSecretCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;secOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WorkloadSecrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Start the local XDS generator.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;localXDSGenerator&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;startXDSGenerator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;proxyConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WorkloadSecrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to start local xds generator: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;initLocalDNSServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;isSidecar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to start local DNS server: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cfg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ProxyXDSViaAgent&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;xdsProxy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;initXdsProxy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to start xds proxy: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤éƒ¨åˆ†æœ‰å¼‚å¸¸å¤šæ—§ä»£ç ä»¥åŠ TODOï¼Œæ¨æµ‹æ˜¯åŸæ¥æ¶æ„æœ‰ DaemonSet éƒ¨ç½²çš„ Node Agentï¼Œç›®å‰æ¶æ„ä¸­å»é™¤äº†ï¼ŒNode Agent çš„å·¥ä½œç”± pilot-agent å®Œæˆï¼Œåªå¤„ç†è‡ªèº«å®¹å™¨å†… Envoy çš„è¯·æ±‚ï¼Œè‡ªç„¶ä¸éœ€è¦å¤šå¤æ‚çš„ç¼“å­˜æœºåˆ¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// security/pkg/nodeagent/sds/server.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// NewServer creates and starts the Grpc server for SDS.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ca2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;workloadSecretCache&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ca2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SecretManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;workloadSds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newSDSService&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;workloadSecretCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;FileMountedCerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EnableWorkloadSDS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;initWorkloadSdsService&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;sdsServiceLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to initialize secret discovery service for workload proxies: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;initWorkloadSdsService&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ca2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//nolint: unparam
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GrpcServer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpcWorkloadServer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GrpcServer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;workloadSds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;register&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpcWorkloadServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpcWorkloadServer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;grpcServerOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;workloadSds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;register&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpcWorkloadServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Unix Domain Socket SDS é€šä¿¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpcWorkloadListener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;uds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewListener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WorkloadUDSPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;sdsServiceLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to set up UDS path: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;sdsServiceLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Start SDS grpc server&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ¬åœ°ç›‘å¬ UDSï¼Œä¸ Envoy é€šä¿¡ã€‚&lt;/p&gt;
&lt;h5 id=&#34;æ„å»º-csr&#34;&gt;æ„å»º CSR&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pkg/istio-agent/agent.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// è·å– Istio CA çš„è¯ä¹¦ï¼ŒæŒ‚è½½çš„ Configmap
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;caCertFile&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;FindRootCAForCA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;c1&#34;&gt;// ä¸ Istio CA å»ºç«‹è¿æ¥
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;caClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;citadel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewCitadelClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;secOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CAEndpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;secOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ClusterID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// security/pkg/nodeagent/cache/secretcache.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// GenerateSecret generates new secret and cache the secret, this function is called by SDS.StreamSecrets
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// and SDS.FetchSecret. Since credential passing from client may change, regenerate secret every time
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// instead of reading from cache.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SecretCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;GenerateSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;connectionID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;token&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;security&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SecretItem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;c1&#34;&gt;// First try to generate secret from file.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;sdsFromFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ns&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;generateFileSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;connKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ns&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SecretCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;generateSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;token&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;connKey&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ConnKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;security&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SecretItem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æ„å»º SPIFFE SAN å­—æ®µ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;csrHostName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;spiffe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Identity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;TrustDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;configOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TrustDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;configOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WorkloadNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;ServiceAccount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;configOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ServiceAccount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æ„å»º CSR å‚æ•°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pkiutil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CertOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;csrHostName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;RSAKeySize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;keySize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;PKCS8Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;configOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pkcs8Keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;ECSigAlg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;pkiutil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SupportedECSignatureAlgorithms&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;configOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ECCSigAlg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Generate the cert/key, send CSR to CA.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;csrPEM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;keyPEM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pkiutil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GenCSR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨ Istio CA å‘é€ CSR è¯·æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;certChainPEM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;sendRetriableRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;csrPEM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exchangedToken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;connKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ£€æŸ¥/åˆ›å»ºç§é’¥&lt;/li&gt;
&lt;li&gt;æ„å»º CSRï¼ˆCSR çš„ Host æ˜¯ SAN URIï¼Œå³ SPIFFE IDï¼‰&lt;/li&gt;
&lt;li&gt;è¯·æ±‚ Istio CA&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;è¯ä¹¦è½®æ¢&#34;&gt;è¯ä¹¦è½®æ¢&lt;/h5&gt;
&lt;p&gt;ä¸¤ç§æƒ…å†µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Workload è¯ä¹¦å®šæœŸæ›´æ–°&lt;/li&gt;
&lt;li&gt;CA è¯ä¹¦æ”¹å˜&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// security/pkg/nodeagent/cache/secretcache.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SecretCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;shouldRotate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;secret&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;security&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SecretItem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// secret should be rotated before it expired.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;secretLifeTime&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ExpireTime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sub&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CreatedTime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;gracePeriod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;configOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SecretRotationGracePeriodRatio&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;float64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;secretLifeTime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;rotate&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;After&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ExpireTime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;gracePeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;cacheLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Debugf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Secret %s: lifetime: %v, graceperiod: %v, expiration: %v, should rotate: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;secretLifeTime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gracePeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ExpireTime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rotate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rotate&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é»˜è®¤ Workload è¯ä¹¦ 24 å°æ—¶è½®æ¢ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// security/pkg/nodeagent/cache/secretcache.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SecretCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;addFileWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;file&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;token&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;connKey&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ConnKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;certWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;timerC&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Time&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;timerC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;timerC&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;c1&#34;&gt;// TODO(ramaraochavali): Remove the watchers for unused keys and certs.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;certMutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;connKeys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileCerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;npath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;certMutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RUnlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;c1&#34;&gt;// Update all connections that use this file.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ckey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;connKeys&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;secrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ckey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;c1&#34;&gt;// Regenerate the Secret and trigger the callback that pushes the secrets to proxy.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                        &lt;span class=&#34;c1&#34;&gt;// é‡æ–°ç”Ÿæˆè¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                        &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;generateFileSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ckey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç›‘å¬æ ¹è¯ä¹¦æ–‡ä»¶çš„å˜åŒ–ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// security/pkg/nodeagent/cache/secretcache.go        
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sitem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;generateRootCertFromExistingFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;existingRootCertFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;connKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;addFileWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;existingRootCertFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;connKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é™„ Istio è¯ä¹¦ä½“ç³»ç›¸å…³æµç¨‹å›¾&lt;sup id=&#34;fnref:8&#34;&gt;&lt;a href=&#34;#fn:8&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;8&lt;/a&gt;&lt;/sup&gt;ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-zero-trust-source-code-reading/cert-flow_hueae1bafce3c0534beb8513448b9bf183_142710_0fbc17cb19c432d01c2bae93c915c6dd.webp 400w,
               /blog/istio-zero-trust-source-code-reading/cert-flow_hueae1bafce3c0534beb8513448b9bf183_142710_b3e0112563dc4f093b733a8a87d3d331.webp 760w,
               /blog/istio-zero-trust-source-code-reading/cert-flow_hueae1bafce3c0534beb8513448b9bf183_142710_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istio-zero-trust-source-code-reading/cert-flow_hueae1bafce3c0534beb8513448b9bf183_142710_0fbc17cb19c432d01c2bae93c915c6dd.webp&#34;
               width=&#34;735&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;æ‘˜è‡ªã€Šé›¶ä¿¡ä»»ç½‘ç»œ : åœ¨ä¸å¯ä¿¡ç½‘ç»œä¸­æ„å»ºå®‰å…¨ç³»ç»Ÿã€‹ç¬¬ 6 ç« â€”å»ºç«‹ç”¨æˆ·ä¿¡ä»»&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/latest/docs/concepts/security/#secure-naming&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio / Security - Secure naming&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/spiffe/spiffe/blob/main/standards/SPIFFE.md#1-introduction&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Secure Production Identity Framework for Everyone (SPIFFE) - 1. Introduction&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.aliyun.com/article/740195&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes ä¸‹é›¶ä¿¡ä»»å®‰å…¨æ¶æ„åˆ†æ - èš‚èšé›¶ä¿¡ä»»æ¶æ„ä½“ç³»è½åœ°æœ€ä½³å®è·µ&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:5&#34;&gt;
&lt;p&gt;æ‘˜è‡ªã€Šé›¶ä¿¡ä»»ç½‘ç»œ : åœ¨ä¸å¯ä¿¡ç½‘ç»œä¸­æ„å»ºå®‰å…¨ç³»ç»Ÿã€‹ç¬¬ 2 ç« â€”ä¿¡ä»»ç®¡ç†&amp;#160;&lt;a href=&#34;#fnref:5&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:6&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/latest/news/releases/1.8.x/announcing-1.8/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Announcing Istio 1.8&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:6&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:7&#34;&gt;
&lt;p&gt;æ‘˜è‡ªã€Šé›¶ä¿¡ä»»ç½‘ç»œ : åœ¨ä¸å¯ä¿¡ç½‘ç»œä¸­æ„å»ºå®‰å…¨ç³»ç»Ÿã€‹ç¬¬ 8 ç« â€”å»ºç«‹æµé‡ä¿¡ä»»&amp;#160;&lt;a href=&#34;#fnref:7&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:8&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/yevvzi/article/details/107863433&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio è¯ä¹¦ç­¾å‘æµç¨‹&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:8&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>äº‘åŸç”Ÿç¤¾åŒº meetup ç¬¬ä¸ƒæœŸæ·±åœ³ç«™</title>
      <link>https://cloudnative.to/event/cloud-native-meetup-shenzhen-07/</link>
      <pubDate>Sat, 25 Sep 2021 13:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/event/cloud-native-meetup-shenzhen-07/</guid>
      <description>&lt;h2 id=&#34;è®²å¸ˆåˆ†äº«&#34;&gt;è®²å¸ˆåˆ†äº«&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV19h411p7jn&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿç¤¾åŒº meetup ç¬¬ä¸ƒæœŸæ·±åœ³ç«™å¼€åœºè‡´è¾ - å®‹å‡€è¶…&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1WQ4y1z7zQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ IAST æ„å»ºé«˜æ•ˆçš„ DevSecOps æµç¨‹ - è‘£å¿—å‹‡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1hf4y1E7KJ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿåœºæ™¯ä¸‹çš„å¼€å‘å’Œè°ƒè¯• - æ±ªæ™Ÿæ°ï¼Œé»„é‡‘æµ©&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1LL411476c&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy åœ¨è…¾è®¯æ¸¸æˆäº‘åŸç”Ÿå¹³å°åº”ç”¨ - ç”°ç”œ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1TQ4y1C7xx&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ KubeVela æ„å»ºæ··åˆäº‘åº”ç”¨ç®¡ç†å¹³å° - é‚“æ´ªè¶…&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>ç½‘ç»œä»£ç† Envoy å¼€æºäº”å‘¨å¹´ï¼Œåˆ›å§‹äºº Matt Klein äº²è¿°å¼€æºå¿ƒè·¯å†ç¨‹åŠç»éªŒæ•™è®­</title>
      <link>https://cloudnative.to/blog/envoy-oss-5-year/</link>
      <pubDate>Wed, 15 Sep 2021 10:41:54 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-oss-5-year/</guid>
      <description>&lt;p&gt;è¯‘è€…æ³¨ï¼šæœ¬æ–‡è¯‘è‡ª Envoy ä»£ç†çš„åˆ›å§‹äºº Matt Klein äºæ˜¨æ™šåœ¨ä¸ªäººåšå®¢ä¸Šå‘å¸ƒçš„æ–‡ç«  &lt;a href=&#34;https://mattklein123.dev/2021/09/14/5-years-envoy-oss/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;5 year of Envoy OSS&lt;/a&gt;ã€‚ä»–åœ¨ Twitter å› ä¸ºè‡ªå·±çš„ç¨‹åº bug é€ æˆé‡å¤§äº‹æ•…è€Œç¦»èŒï¼ŒååŠ å…¥ Lyftï¼Œåœ¨å¼€æº Envoy ä¹‹å‰å‡ ä¹æ²¡æœ‰è´¡çŒ®å’Œç®¡ç†å¼€æºé¡¹ç›®çš„ç»éªŒï¼Œè¿™ç¯‡æ–‡ç« åˆ†äº«äº†ä»–ä¸ªäººåŠ Envoy å¼€æºçš„å¿ƒè·¯å†ç¨‹ï¼Œåœ¨æŠ•èº«å¼€æº Envoy è¿˜æ˜¯ä¸ºé›‡ä¸» Lyft æ•ˆå‘½ï¼Œè¯¥å¦‚ä½•æŠ‰æ‹©ï¼Ÿçœ‹å®Œæœ¬æ–‡ï¼Œç›¸ä¿¡å¯¹äºå¼€æºé¡¹ç›®çš„ç»´æŠ¤è€…ã€åˆ›ä¸šè€…åŠæŠ•èµ„äººéƒ½ä¼šå¤§æœ‰æ”¶è·ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ä»Šå¤©æ˜¯ &lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Proxy å¼€æº&lt;/a&gt;çš„ &lt;a href=&#34;https://eng.lyft.com/announcing-envoy-c-l7-proxy-and-communication-bus-92520b6c8191&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;5 å‘¨å¹´&lt;/a&gt;ã€‚æ¯«ä¸å¤¸å¼ åœ°è¯´ï¼Œåœ¨ä¸“ä¸šæ–¹é¢ï¼Œè¿‡å»çš„ 5 å¹´æ˜¯ä¸€ä¸ªå²è¯—èˆ¬çš„è¿‡å±±è½¦ï¼Œæˆ‘çš„æƒ…ç»ªä»‹äºå…´å¥‹ã€è‡ªè±ªã€ç„¦è™‘ã€å°´å°¬ã€æ— èŠã€å€¦æ€ ä¹‹é—´ã€‚æˆ‘æƒ³åˆ†äº«ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®çš„å‰ä¼ å’Œå†å²ï¼Œä»¥åŠæˆ‘åœ¨å‘å±•å¤§å‹å¼€æºè½¯ä»¶é¡¹ç›®çš„è¿‡ç¨‹ä¸­æ‰€å­¦åˆ°çš„ä¸€äº›ç»éªŒæ•™è®­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‰ä¼ å’Œå†å²&#34;&gt;å‰ä¼ å’Œå†å²&lt;/h2&gt;
&lt;h3 id=&#34;å‰ä¼ &#34;&gt;å‰ä¼ &lt;/h3&gt;
&lt;p&gt;é™¤äº†ä¸€äº›å°çš„å¼¯è·¯ï¼Œæˆ‘åœ¨æŠ€æœ¯è¡Œä¸šäºŒåå¹´çš„èŒä¸šç”Ÿæ¶¯ä¸€ç›´ä¸“æ³¨äºåº•å±‚ç³»ç»Ÿï¼šåµŒå…¥å¼ç³»ç»Ÿï¼Œæ“ä½œç³»ç»Ÿï¼Œè™šæ‹ŸåŒ–ï¼Œæ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åŠæœ€è¿‘çš„åˆ†å¸ƒå¼ç³»ç»Ÿç½‘ç»œã€‚æˆ‘çš„åˆ†å¸ƒå¼ç³»ç»Ÿç½‘ç»œä¹‹æ—…å§‹äº 2010 å¹´åˆåœ¨äºšé©¬é€Šï¼Œæˆ‘æœ‰å¹¸å¸®åŠ©å¼€å‘äº†ç¬¬ä¸€æ‰¹é«˜æ€§èƒ½è®¡ç®—ï¼ˆHPCï¼‰EC2 å®ä¾‹ç±»å‹ã€‚æˆ‘å­¦åˆ°äº†å¤§é‡çš„åº•å±‚é«˜æ€§èƒ½è®¡ç®—æœºç½‘ç»œçŸ¥è¯†ï¼Œå°½ç®¡æˆ‘å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¦‚å¿µæ¥è§¦æœ‰é™ã€‚&lt;/p&gt;
&lt;p&gt;2012 å¹´ï¼Œæˆ‘åŠ å…¥äº† Twitterï¼Œåœ¨ç»å†äº†å‡ æ¬¡é”™è¯¯çš„å¼€å§‹åï¼Œæˆ‘æœ€ç»ˆåŠ å…¥äº†è¾¹ç¼˜ç½‘ç»œå›¢é˜Ÿã€‚è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡çœŸæ­£æ¥è§¦åˆ°åˆ†å¸ƒå¼ç³»ç»Ÿåº”ç”¨ç½‘ç»œæ¦‚å¿µã€‚æˆ‘é¢†å¯¼äº†ä¸€ä¸ªæ–°çš„ HTTP è¾¹ç¼˜ä»£ç†çš„å¼€å‘ï¼Œç§°ä¸º Twitter æµå¼èšåˆå™¨ï¼ˆTSAï¼‰ï¼Œå®ƒåœ¨ 2013 å¹´é¦–æ¬¡æ¨å‡ºï¼Œä»¥æ‰©å¤§ Twitter çš„â€œfirehoseâ€APIï¼ˆæµå¼æ‰€æœ‰æ¨æ–‡ï¼‰çš„äº¤ä»˜ã€‚åœ¨ 2014 å¹´ä¸–ç•Œæ¯å‰å¤•ï¼Œæˆ‘ä»¬å†³å®šå°† TSA ä½œä¸ºä¸€ä¸ªé€šç”¨çš„ HTTP/HTTP2/TLS è¾¹ç¼˜ä»£ç†ï¼Œåœ¨é è¿‘å·´è¥¿èµ›äº‹çš„å­˜åœ¨ç‚¹ï¼ˆPOPsï¼‰æ¨å‡ºã€‚è¿™æ ·åšçš„ä¸»è¦åŸå› æ˜¯ä¸å¯èƒ½åœ¨ POP çš„å°‘é‡ä¸»æœºæ‰˜ç®¡æœºæ¶ä¸Šéƒ¨ç½²ç°æœ‰çš„åŸºäº JVM çš„èµ„æºåŒ®ä¹çš„è¾¹ç¼˜ä»£ç†ã€‚é¡¹ç›®å‘¨æœŸç‰¹åˆ«ç´§å¼ ï¼Œæˆ‘çš„å›¢é˜ŸæˆåŠŸåœ°å®Œæˆäº†ä¸€å±Šæ²¡æœ‰äº‹æ•…çš„ä¸–ç•Œæ¯ã€‚ï¼ˆæˆ‘è¿˜æ¸…æ¥šåœ°è®°å¾—æœ‰ä¸€æ®µæ—¶é—´ï¼Œå½“è½¯ä»¶å´©æºƒæ—¶ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Œæˆ‘éƒ½ä¼šç»™è‡ªå·±æ‰“ä¸Šä¸€é¡µï¼Œä¿®å¤é”™è¯¯ï¼Œç„¶åé‡æ–°è¿›è¡Œé‡‘ä¸é›€éƒ¨ç½²ï¼Œç»§ç»­æµ‹è¯•ï¼‰ã€‚åœ¨ Twitter å·¥ä½œæœŸé—´ï¼Œæˆ‘è¿˜æ¥è§¦åˆ°äº†è¯¥å…¬å¸é€šè¿‡ Finagle åº“è¿›è¡ŒæœåŠ¡é—´ç½‘ç»œé€šä¿¡çš„æ–¹å¼ï¼Œå¹¶å–å¾—äº†å·¨å¤§æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;2015 å¹´å…ƒæ—¦å‰åï¼Œæˆ‘åœ¨ Twitter çš„æ—¥å­é‡Œï¼Œå› ä¸ºæˆ‘å†™çš„ä¸€ä¸ª bugï¼ŒTSA ç³»ç»Ÿæ•…éšœå¯¼è‡´æ•°ç™¾ä¸‡ Twitter çš„å®‰å“ç”¨æˆ·è¢«ä¸‹çº¿ï¼Œè¿™å°†æ˜¯æˆ‘åœ¨ Twitter å·¥ä½œçš„å°¾å£°ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-oss-5-year/008i3skNly1guh3vblu9xj60tu0eu76p02_hu805c037e1b6939963fb91f37e122645a_96250_f29a6d54939b9235e6bd4df65a4606f4.webp 400w,
               /blog/envoy-oss-5-year/008i3skNly1guh3vblu9xj60tu0eu76p02_hu805c037e1b6939963fb91f37e122645a_96250_66bff83128deb2fd68397cf943ca68f1.webp 760w,
               /blog/envoy-oss-5-year/008i3skNly1guh3vblu9xj60tu0eu76p02_hu805c037e1b6939963fb91f37e122645a_96250_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-oss-5-year/008i3skNly1guh3vblu9xj60tu0eu76p02_hu805c037e1b6939963fb91f37e122645a_96250_f29a6d54939b9235e6bd4df65a4606f4.webp&#34;
               width=&#34;760&#34;
               height=&#34;378&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;åŠ å…¥-lyft-å’Œåˆ›å»ºlyft-ä»£ç†&#34;&gt;åŠ å…¥ Lyft å’Œåˆ›å»ºâ€œLyft ä»£ç†â€&lt;/h3&gt;
&lt;p&gt;æˆ‘åœ¨ 2015 å¹´æ˜¥å¤©ç¦»å¼€äº† Twitterï¼Œéƒ¨åˆ†åŸå› æ˜¯ä¸‹çº¿äº‹ä»¶çš„å½±å“ï¼Œéƒ¨åˆ†åŸå› æ˜¯å¯¹æ²¡æœ‰å¾—åˆ°æ™‹å‡çš„æŒ«è´¥æ„Ÿï¼Œéƒ¨åˆ†åŸå› æ˜¯æƒ³å°è¯•æ–°çš„ä¸œè¥¿ã€‚æˆ‘è·Ÿç€æˆ‘çš„è€æ¿ä» Twitter åˆ°äº† Lyftï¼Œè¿˜æœ‰æˆ‘åœ¨ Twitter çš„å…¶ä»–åŒäº‹ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘åŠ å…¥ Lyft æ—¶ï¼Œå…¬å¸è§„æ¨¡ç›¸å¯¹è¾ƒå°ï¼ˆå°‘äº 100 åå·¥ç¨‹å¸ˆï¼‰ï¼Œå¹¶ä¸”æ­£åœ¨åŠªåŠ›ä»å•ä½“æ¶æ„è¿ç§»åˆ°å¾®æœåŠ¡æ¶æ„ã€‚æˆ‘å·²ç»&lt;a href=&#34;https://mattklein123.dev/appearances/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤šæ¬¡&lt;/a&gt;è°ˆåˆ°äº† Envoy çš„è¿™éƒ¨åˆ†å†ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šå†é‡è¿°ï¼Œåœ¨æ­¤ç®€çŸ­çš„æ€»ç»“ä¸‹ï¼ŒLyft é‡åˆ°äº†æ‰€æœ‰å…¸å‹çš„å¾®æœåŠ¡è¿ç§»é—®é¢˜ï¼Œä¸»è¦æ˜¯æºäºç½‘ç»œå’Œå¯è§‚å¯Ÿæ€§ã€‚æ­¤å¤–ï¼ŒLyft å·²ç»æ˜¯â€œå¤šé¢æ‰‹â€ï¼ˆä½¿ç”¨å¤šç§è¯­è¨€å’Œæ¡†æ¶ï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨åŸºäºåº“çš„è§£å†³æ–¹æ¡ˆæ¥è§£å†³è¿™äº›é—®é¢˜ä¼¼ä¹ä¸åˆ‡å®é™…ã€‚å› æ­¤ï¼Œæ ¹æ®æˆ‘ä»¥å‰å»ºç«‹ TSA çš„ç»éªŒå’Œè§‚å¯ŸæœåŠ¡é—´é€šä¿¡åœ¨ Twitter çš„å·¥ä½œæ–¹å¼ï¼Œç”±äºå¾—åˆ°åœ¨ Lyft çš„å‰ Twitter åŒäº‹ä»¬çš„ä¿¡ä»»ï¼Œæˆ‘æè®®å»ºç«‹ä¸€ä¸ªæ–°çš„åº”ç”¨ç½‘ç»œç³»ç»Ÿï¼Œç§°ä¸ºâ€œLyft ä»£ç†â€ã€‚&lt;/p&gt;
&lt;p&gt;ç»è¿‡ä¸€äº›æ¿€çƒˆçš„è®¨è®ºï¼ŒåŒ…æ‹¬æ–°çš„ä»£ç†æ˜¯å¦åº”è¯¥ç”¨ Python æ„å»ºï¼ˆæ˜¯çš„ï¼ŒçœŸçš„ï¼‰ï¼Œæˆ‘ä»¬å°±é¡¹ç›®çš„å¤§è‡´è½®å»“è¾¾æˆä¸€è‡´ï¼Œå¹¶å†³å®šä½¿ç”¨ C++ ä½œä¸ºå®ç°è¯­è¨€ã€‚åœ¨å½“æ—¶ï¼ŒC++ ä¼¼ä¹æ˜¯å”¯ä¸€åˆç†çš„é€‰æ‹©ã€‚ä»Šå¤©æˆ‘è¿˜ä¼šé€‰æ‹© C++ å—ï¼Ÿç„¶è€Œï¼Œå¦‚ä»Šå·²ç»ä¸æ˜¯ 2015 å¹´åˆäº†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸è¯´â€œEnvoy&amp;quot; è¿™ä¸ªåå­—çš„ç”±æ¥ï¼Œè¿™éƒ¨åˆ†çš„å†å²å°±ä¸å®Œæ•´äº†ã€‚æˆ‘ä»¬æ­£åœ¨ä¸ºè¿™ä¸ªé¡¹ç›®å»ºç«‹æœ€åˆçš„å¼€å‘è„šæ‰‹æ¶çš„æ—¶å€™ï¼Œä¸€ä¸ªæœ‰è¿œè§çš„åŒäº‹ï¼ˆRyan Laneï¼‰è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½æŠŠè¿™ä¸ªæ–°é¡¹ç›®å«åšâ€œLyft ä»£ç†â€ï¼Œæˆ‘ä»¬å¿…é¡»é€‰æ‹©ä¸€ä¸ªæ›´å¥½çš„åå­—ã€‚æˆ‘æ€»æ˜¯å¾ˆå®é™…ï¼Œå°±å»æ‰¾è¾å…¸ï¼ŒæŸ¥äº†ä¸€ä¸‹â€œä»£ç†â€ï¼Œç„¶åå†³å®šç”¨ Envoy ä½œä¸ºæ–°åå­—ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åœ¨-lyft-ä¸Šçº¿&#34;&gt;åœ¨ Lyft ä¸Šçº¿&lt;/h3&gt;
&lt;p&gt;ç›´åˆ° 2015 å¹´å¤å¤©ï¼Œæˆ‘æ‰å¼€å§‹è®¤çœŸåœ°ç ”ç©¶ Envoy çš„æºä»£ç ã€‚é‚£å‡ ä¸ªæœˆæ˜¯æˆ‘èŒä¸šç”Ÿæ¶¯ä¸­æœ€æœ‰è¶£çš„å‡ ä¸ªæœˆã€‚æˆ‘ä»¬åº”è¯¥çæƒœè¿™æ®µåˆåˆ›æ—¶æœŸï¼Œå› ä¸ºå®ƒä¸ä¼šæŒç»­å¾ˆä¹…ã€‚æˆ‘èŠ±äº†å¾ˆé•¿æ—¶é—´ï¼Œäº‰å–åœ¨åˆç†çš„æ—¶é—´å†…ï¼ˆæ ¹æ®æˆ‘çš„å®šä¹‰ï¼Œè¿™ç§ç±»å‹çš„é¡¹ç›®éœ€è¦ 3-4 ä¸ªæœˆçš„æ—¶é—´ï¼‰åšå‡ºèƒ½ç»™ Lyft å¸¦æ¥ä»·å€¼çš„ä¸œè¥¿ã€‚ä¿—è¯è¯´ï¼ŒLyft ç»™äº†æˆ‘å¤§é‡çš„ç»³å­æ¥åŠæ­»è‡ªå·±ï¼Œè€Œæˆ‘è‡´åŠ›äºç¡®ä¿è¿™ç§åŠæ­»ä¸ä¼šå‘ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œæˆ‘çš„æ•ˆç‡ä¸»è¦å½’åŠŸäºåˆšä»å‹ç¼©çš„å¼€å‘æ—¶é—´è¡¨å’Œè®¸å¤šé”™è¯¯ï¼ˆä¸»è¦æ˜¯æˆ‘è‡ªå·±çš„ï¼‰ä¸­èµ°å‡ºæ¥ï¼Œåœ¨ Twitter çš„ TSAã€‚æˆ‘çŸ¥é“å“ªäº›é”™è¯¯æ˜¯ä¸èƒ½çŠ¯çš„ï¼Œå“ªäº›æŠ½è±¡æ˜¯éœ€è¦çš„ï¼Œå“ªäº›æµ‹è¯•æœ‰æ•ˆï¼Œå“ªäº›æ— æ•ˆï¼Œç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;2015 å¹´ç§‹å¤©å‡†å¤‡æŠ•å…¥ç”Ÿäº§çš„ Envoy çš„æœ€åˆç‰ˆæœ¬åªåŒ…å«äº†è¯¥é¡¹ç›®ä»Šå¤©æ‰€åŒ…å«çš„åŠŸèƒ½å’Œå¤æ‚æ€§çš„ä¸€å°éƒ¨åˆ†ã€‚å®ƒä¸æ”¯æŒ TLSï¼Œåªæ”¯æŒ HTTP/1ï¼Œå¹¶ä¸”æœ‰æå…¶ç®€å•çš„è·¯ç”±å’Œå¼¹æ€§åŠŸèƒ½ã€‚å®ƒæ‰€æ‹¥æœ‰çš„æ˜¯ä½ ä»Šå¤©æ‰€çœ‹åˆ°çš„ä¸œè¥¿çš„éª¨æ¶ã€‚åœ¨è¿™ä¸ªé¡¹ç›®çš„å†å²ä¸Šï¼Œå¾ˆå°‘æœ‰é‡å¤§çš„é‡æ„ï¼Œä¸»è¦æ˜¯å› ä¸ºï¼Œæ­£å¦‚æˆ‘ä¹‹å‰æ‰€è¯´çš„ï¼Œæˆ‘çŸ¥é“å°†è¦å‘ç”Ÿä»€ä¹ˆï¼Œä»¥åŠä¸ºäº†æ”¯æŒè¿™äº›åŠŸèƒ½ï¼Œéœ€è¦æœ‰å“ªäº›æŠ½è±¡ã€‚Envoy ä»ä¸€å¼€å§‹å°±æ‹¥æœ‰ä¸€æµçš„å¯è§‚å¯Ÿæ€§è¾“å‡ºï¼Œä»¥æŒ‡æ ‡å’Œæ—¥å¿—çš„å½¢å¼ã€‚åœ¨ 2021 å¹´ï¼Œè¿™ç§ç±»å‹çš„ç½‘ç»œå¯è§‚å¯Ÿæ€§æ˜¯æ¡Œé¢ä¸Šçš„èµŒæ³¨ï¼ˆè¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šè¦å½’åŠŸäº Envoy çš„æˆåŠŸï¼‰ï¼Œä½†åœ¨å½“æ—¶å´ä¸æ˜¯è¿™æ ·ã€‚&lt;/p&gt;
&lt;p&gt;Envoy æœ€åˆæ˜¯ä½œä¸ºè¾¹ç¼˜ä»£ç†åœ¨ Lyft ä¸Šçº¿çš„ï¼Œä½äºæä¾› TLS ç»ˆæ­¢çš„ AWS ELB åé¢ã€‚åˆ° 2015 å¹´ç§‹æœ«ï¼ŒEnvoy ä¸º Lyft çš„ 100% æµé‡æä¾›æœåŠ¡ï¼Œè¯¥ç³»ç»Ÿäº§ç”Ÿçš„è¾¹ç¼˜ä»ªè¡¨ç›˜ç«‹å³å¾—åˆ°äº†å›æŠ¥ï¼ˆä¾‹å¦‚ï¼Œæä¾› API è°ƒç”¨ç™¾åˆ†ç‚¹å»¶è¿Ÿç›´æ–¹å›¾ï¼Œæ¯ä¸ªç»ˆç«¯çš„æˆåŠŸç‡å’Œè¯·æ±‚ç‡ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ€åˆæ¨å‡ºåä¸ä¹…ï¼Œå¦ä¸€ä½ Twitter åŒäº‹ï¼ˆBill Gallagherï¼‰åŠ å…¥äº†æˆ‘çš„é¡¹ç›®ï¼Œæˆ‘ä»¬è¿…é€Ÿå¢åŠ äº†ä¸€äº›åŠŸèƒ½ï¼Œå¦‚ TLS ç»ˆæ­¢ã€HTTP/2 æ”¯æŒã€æ›´å¤šè·¯ç”±å’Œè´Ÿè½½å¹³è¡¡åŠŸèƒ½ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸æ­¤åŒæ—¶ï¼ŒLyft åŸºäº Envoy çš„â€œæœåŠ¡ç½‘æ ¼ &amp;quot; ä¹Ÿå¼€å§‹æˆå½¢äº†ã€‚é¦–å…ˆï¼ŒEnvoy è¢«éƒ¨ç½²åœ¨ PHP å•ç‰‡æœºæ—è¾¹ï¼Œä»¥å–ä»£ HAProxy åŠå…¶ä¸€äº›å›ºæœ‰çš„è¿ç»´é—®é¢˜ï¼ˆä¾‹å¦‚ï¼Œå½“æ—¶ HAProxy ä»ç„¶æ˜¯å•çº¿ç¨‹çš„ï¼‰ï¼Œä»¥å¸®åŠ© MongoDB çš„ä»£ç†ã€‚å¯ä»¥æ¯«ä¸å¤¸å¼ åœ°è¯´ï¼ŒEnvoy çš„æ—©æœŸå¼€å‘æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯é’ˆå¯¹ MongoDB çš„ç¨³å®šæ€§ï¼ˆè´Ÿè½½å‡è¡¡ã€é€Ÿç‡é™åˆ¶ã€å¯è§‚å¯Ÿæ€§ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäº Envoy çš„è¾¹ç¼˜æœºç¾¤å’Œå•ä½“ä¹‹é—´çš„ç›´æ¥è§‚å¯Ÿèƒ½åŠ›çš„å¥½å¤„æ˜¯éå¸¸æ˜æ˜¾çš„ã€‚ä¸ä¹…ä¹‹åï¼Œæˆ‘ä»¬åœ¨ä¸€äº›é«˜ RPS åˆ†è§£çš„å¾®æœåŠ¡æ—è¾¹éƒ¨ç½²äº† Envoyï¼Œä»¥å¸®åŠ©æ’é™¤ç½‘ç»œé—®é¢˜ã€‚è¿™æ–¹é¢çš„ä»·å€¼ä¹Ÿå¾—åˆ°äº†è¯æ˜ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬è¶…è¶Šäº†å¯¹å¯è§‚å¯Ÿæ€§çš„å…³æ³¨ï¼Œå¢åŠ äº†å¸®åŠ©ç³»ç»Ÿå¯é æ€§çš„åŠŸèƒ½ï¼Œå¦‚ç›´æ¥è¿æ¥å’ŒæœåŠ¡å‘ç°ï¼ˆè·³è¿‡å†…éƒ¨ ELBï¼‰ã€å¼‚å¸¸å€¼æ£€æµ‹ã€å¥åº·æ£€æŸ¥ã€é‡è¯•ã€æ–­è·¯ç­‰ã€‚Lyft çš„åŸºäºè´Ÿè½½çš„é‡å¤§äº‹ä»¶çš„æ•°é‡ä»æ¯ 1-2 å‘¨ä¸€æ¬¡æ…¢æ…¢å‡å°‘ã€‚å½“ç„¶ï¼ŒEnvoy ä¸èƒ½å°†æ‰€æœ‰æ­¤ç±»äº‹ä»¶çš„å‡å°‘å½’åŠŸäºæ­¤ï¼Œä½†å®ƒæä¾›çš„ç½‘ç»œæŠ½è±¡ç¡®å®æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;2016 å¹´åˆï¼Œæˆ‘ä»¬å†³å®šæ¨åŠ¨ä¸€ä¸ª 100% è¦†ç›–çš„æœåŠ¡ç½‘æ ¼ã€‚æœ€åˆï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™å°†æ˜¯ä¸€ä¸ªè‰°éš¾çš„è¿‡ç¨‹ï¼Œéœ€è¦è‡ªä¸Šè€Œä¸‹çš„æˆæƒã€‚åœ¨å®è·µä¸­ï¼Œ&lt;strong&gt;å›¢é˜ŸæŠ¥åå‚åŠ äº†è¿ç§»ï¼Œå› ä¸ºä»–ä»¬å°†å¾—åˆ°çš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„&lt;/strong&gt;ã€‚â€œèƒ¡èåœ &amp;ldquo;å¼çš„è¿ç§»å‡ ä¹æ€»æ˜¯æˆåŠŸçš„ã€‚è€Œâ€œå¤§æ£’&amp;rdquo; å¼çš„è¿ç§»åˆ™å¾ˆå°‘æˆåŠŸï¼Œæˆ–è€…å³ä½¿æˆåŠŸäº†ï¼Œä¹Ÿä¼šåœ¨ç»„ç»‡å†…ç•™ä¸‹çœ¼æ³ªå’Œæ„¤æ€’ã€‚&lt;/p&gt;
&lt;p&gt;åˆ° 2016 å¹´ä¸­æœŸï¼ŒEnvoy è¢«ç”¨äº Lyft çš„æ‰€æœ‰ç½‘ç»œé€šä¿¡ï¼ŒåŒ…æ‹¬è¾¹ç¼˜æœåŠ¡ã€æœåŠ¡é—´é€šä¿¡ã€æ•°æ®åº“ã€å¤–éƒ¨åˆä½œä¼™ä¼´ç­‰ã€‚æ— è®ºä»å“ªä¸ªè§’åº¦æ¥çœ‹ï¼Œè¯¥é¡¹ç›®éƒ½å–å¾—äº†å·¨å¤§çš„æˆåŠŸï¼Œå¸®åŠ© Lyft å®Œæˆäº†å¾®æœåŠ¡çš„è¿ç§»ï¼Œæé«˜äº†æ•´ä½“çš„å¯é æ€§ï¼Œå¹¶å¯¹ç½‘ç»œè¿›è¡Œäº†æŠ½è±¡ï¼Œä½¿å¤§å¤šæ•°å·¥ç¨‹å¸ˆä¸éœ€è¦äº†è§£çœŸå®çš„ç³»ç»Ÿæ‹“æ‰‘ç»“æ„ã€‚æ­¤åï¼ŒBill ç¦»å¼€äº†è¿™ä¸ªé¡¹ç›®ï¼Œåœ¨ Lyft ä»äº‹å…¶ä»–å·¥ä½œï¼Œæ¥æ›¿ä»–çš„æ˜¯ Roman Dzhabarov å’Œ Constance Caramanolis åŠ å…¥æˆ‘çš„å›¢é˜Ÿã€‚æˆ‘ä»¬çš„å°å›¢é˜Ÿä¸ºæ•´ä¸ª Lyft å¼€å‘å’Œè¿ç»´ Envoyã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¼€æ”¾æºç &#34;&gt;å¼€æ”¾æºç &lt;/h3&gt;
&lt;p&gt;åˆ° 2016 å¹´å¤å¤©ï¼Œæˆ‘ä»¬å¼€å§‹è®¤çœŸè®¨è®ºå¼€æº Envoy çš„é—®é¢˜ã€‚æ—©æœŸçš„ Lyft å‘˜å·¥å¯¹å¼€æºå’Œå®ƒä¸ºå…¬å¸æ‰€åšçš„äº‹æƒ…å¾ˆæ¬£èµã€‚å¾ˆæ˜æ˜¾ï¼ŒEnvoy å¹¶ä¸æ˜¯ Lyft çš„ä¸»è¦ä¸šåŠ¡ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸æŠŠå®ƒæ”¾åœ¨é‚£é‡Œå¹¶ç»™äºˆå›æŠ¥å‘¢ï¼Ÿæˆ‘å¯ä»¥å¦ç‡åœ°è¯´ï¼Œæˆ‘ä»¬éƒ½å¸¦ç€ä¸åŒçš„ç›®æ ‡å’ŒæœŸæœ›æ¥å¯¹å¾…å¼€æ”¾æºä»£ç çš„è¿‡ç¨‹ï¼Œä»¥åŠå¯¹é¡¹ç›®è·å¾—å·¨å¤§æˆåŠŸåä¼šå‘ç”Ÿä»€ä¹ˆæ„Ÿåˆ°éå¸¸å¤©çœŸã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åŠ å…¥ Envoy ä¹‹å‰ï¼Œæˆ‘å·²ç»ä½¿ç”¨äº†ç›¸å½“å¤šçš„å¼€æºè½¯ä»¶ï¼Œä½†æˆ‘å‡ ä¹æ²¡æœ‰å¼€æºè´¡çŒ®çš„ç»éªŒï¼Œä¹Ÿæ²¡æœ‰ç»´æŠ¤è€…çš„ç»éªŒã€‚ï¼ˆè™½ç„¶æˆ‘åœ¨ Linux å†…æ ¸ä¸­æœ‰è¿‡&lt;a href=&#34;https://github.com/torvalds/linux/commit/00370b8f8dd6e3171b8202f9c5187a5f73e99497&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€æ¬¡æäº¤&lt;/a&gt;ï¼ï¼‰å¼€æº Envoy ä¼¼ä¹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æœºä¼šï¼Œå¯ä»¥æ‰©å±•æˆ‘çš„æŠ€èƒ½ç»„åˆï¼Œå­¦ä¹ æ–°çš„ä¸œè¥¿ï¼Œå¯èƒ½ä¼šä¿ƒè¿›æˆ‘çš„èŒä¸šç”Ÿæ¶¯ï¼Œå¦ç‡åœ°è¯´ï¼Œæˆ‘ä¸å¸Œæœ›æœ‰ä¸€ä¸ª TSA v3 åœ¨ç¬¬ä¸‰å®¶å…¬å¸å‡ºç°ã€‚å¯¹äº Lyft æ¥è¯´ï¼ŒEnvoy æ˜¯ä¸€ä¸ªé‡è¦çš„å·¥ç¨‹é¡¹ç›®ï¼Œé¢†å¯¼å±‚è®¤ä¸ºï¼Œå¼€æ”¾æºä»£ç å°†ä½¿ Lyft ä½œä¸ºä¸€ä¸ªå·¥ç¨‹ç»„ç»‡å…·æœ‰å¯ä¿¡åº¦ï¼Œå¹¶æœ‰åŠ©äºæ‹›è˜å·¥ä½œã€‚æ­£å¦‚æˆ‘ä¹‹å‰æ‰€è¯´ï¼Œæˆ‘ä»¬æ‰€æœ‰äººéƒ½å¯¹åˆ›å»ºæˆåŠŸçš„å¼€æºï¼Œæ›´é‡è¦çš„æ˜¯åœ¨å®ƒè·å¾—æˆåŠŸçš„æƒ…å†µä¸‹åŸ¹è‚²å®ƒæ‰€éœ€è¦çš„ä¸œè¥¿æ„Ÿåˆ°å¤©çœŸã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œæˆ‘ä»¬å†³å®šç»™å®ƒä¸€ä¸ªæœºä¼šã€‚æˆ‘ä»¬åœ¨ 2016 å¹´å¤å¤©èŠ±äº†å¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´æ¥ç¼–å†™æ–‡æ¡£ï¼ˆJose Nino åœ¨è¿™ä¸ªæ—¶å€™åŠ å…¥äº†å›¢é˜Ÿï¼Œä»–çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å°±æ˜¯é˜…è¯»å¹¶å¸®åŠ©æ”¹è¿›æ‰€æœ‰çš„æ–‡æ¡£ï¼‰ï¼Œæ¸…ç†å­˜å‚¨åº“ï¼Œä½¿å…¶ &amp;quot; ä¸é‚£ä¹ˆå°´å°¬â€ï¼Œåˆ¶ä½œç½‘ç«™ï¼Œå‘å¸ƒåšæ–‡ç­‰ç­‰ã€‚æˆ‘çœŸçš„å¾ˆæ„Ÿè°¢è¿™æ®µæ—¶é—´é‡Œæˆ‘åœ¨ Lyft çš„åŒäº‹ï¼Œä»–ä»¬ä¸ä»…æ”¯æŒæˆ‘ä»¬ï¼Œè¿˜å¸®åŠ©æˆ‘ä»¬å®Œæˆäº†æ— æ•°çš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬ç½‘ç«™è®¾è®¡ã€logo ç­‰ç­‰ã€‚å³ä½¿åœ¨è¿™ä¸ªæ—©æœŸé˜¶æ®µï¼Œæˆ‘ä»¬ä¹Ÿè§‰å¾—ç¬¬ä¸€å°è±¡å¾ˆé‡è¦ï¼Œå¦‚æœæˆ‘ä»¬è¦åœ¨å¼€æºé¢†åŸŸæœ‰æ‰€ä½œä¸ºï¼Œå°±å¿…é¡»é€šè¿‡é«˜è´¨é‡çš„æ–‡æ¡£ã€ç½‘ç«™ç­‰ç»™äººç•™ä¸‹è‰¯å¥½çš„ç¬¬ä¸€å°è±¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤æœŸé—´ï¼Œæˆ‘ä»¬è¿˜åˆ©ç”¨æˆ‘ä»¬çš„è¡Œä¸šå…³ç³»ï¼Œä¸ Lyft çš„ä¸€äº›â€œåŒè¡Œå…¬å¸â€ï¼ˆæ¹¾åŒºçš„â€œç‹¬è§’å…½ &amp;quot; äº’è”ç½‘åˆ›ä¸šå…¬å¸ï¼‰ä¼šé¢ï¼Œå‘ä»–ä»¬å±•ç¤ºæˆ‘ä»¬åœ¨ Envoy æ–¹é¢æ‰€åšçš„å·¥ä½œï¼Œå¹¶è·å¾—ä»–ä»¬çš„åé¦ˆï¼Œæˆ‘ä»¬è®¤ä¸ºå¦‚æœæˆ‘ä»¬åœ¨æ­£å¼å¼€æºå‰æˆåŠŸè·å¾—ä¸€ä¸ªå¯åŠ¨åˆä½œä¼™ä¼´ï¼Œè¿™å°†æ˜¯å¯¹é¡¹ç›®çš„ä¸€ä¸ªé‡å¤§å¸®åŠ©ã€‚æ‰€æœ‰è¿™äº›ä¼šè®®éƒ½éå¸¸å‹å¥½ï¼Œæ€»çš„æ¥è¯´ï¼Œæ‰€æœ‰ä¸æˆ‘ä»¬ä¼šé¢çš„å…¬å¸éƒ½å¯¹æˆ‘ä»¬æ‰€å–å¾—çš„æˆå°±å°è±¡æ·±åˆ»ã€‚ä½†æ˜¯ï¼Œäº‹åçœ‹æ¥ï¼Œä»–ä»¬éƒ½è¡¨ç¤ºï¼Œä»¥ä»–ä»¬çš„å°å‹åŸºç¡€è®¾æ–½å›¢é˜Ÿï¼Œä¸å¯èƒ½é©¬ä¸Šé‡‡ç”¨ Envoyã€‚ä»–ä»¬ç¥æ„¿æˆ‘ä»¬åœ¨å¼€æ”¾æºä»£ç æ–¹é¢å–å¾—æœ€å¥½çš„æˆç»©ï¼Œå¹¶è¯´ä»–ä»¬ä»¥åä¼šå›æ¥çœ‹çœ‹ã€‚æˆ‘ä»¬ä¸ç¦å¯¹è¿™äº›ä¼šè®®çš„ç»“æœæ„Ÿåˆ°æ²®ä¸§ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯å‘å‰æ¨è¿›äº†ã€‚&lt;/p&gt;
&lt;p&gt;2015 å¹´ 8 æœˆï¼Œæˆ‘ä¸è°·æ­Œè¿›è¡Œäº†ç¬¬ä¸€æ¬¡å‹å¥½çš„ä¼šé¢ã€‚ä¸€ä¸ª Lyft çš„åŒäº‹ï¼ˆChris Burnettï¼‰åœ¨ä¸€ä¸ª gRPC èšä¼šä¸Šå‘è¨€ï¼Œæåˆ°äº† Envoyï¼Œå› ä¸ºå®ƒä¸ Envoy çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_protocols/grpc#grpc-bridging&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC æ¡¥æ¥&lt;/a&gt;æ”¯æŒæœ‰å…³ã€‚æˆ‘ä¸çŸ¥é“çš„æ˜¯ï¼Œè°·æ­Œåœ¨å‘ç° Envoy çš„æ—¶å€™ï¼Œæ­£å‡†å¤‡åœ¨ NGINX çš„åŸºç¡€ä¸Šæ¨å‡º Istioã€‚ä¸€æ¬¡ä¼šè®®å¼•å‡ºäº†å¦ä¸€æ¬¡ä¼šè®®ï¼Œç„¶åæ˜¯æ›´å¤šçš„ä¼šè®®ï¼Œåœ¨ Envoy å¼€æºä¹‹å‰ï¼Œå¤§é‡çš„è°·æ­Œå‘˜å·¥å·²ç»çœ‹åˆ°äº†æºä»£ç å’Œæ–‡æ¡£ã€‚(ç¨åä¼šæœ‰æ›´å¤šå…³äºè¿™æ–¹é¢çš„å†…å®¹ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åˆ° 9 æœˆåˆï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†ï¼Œå¹¶å°†å¼€æºæ—¥å®šä¸º 9 æœˆ 14 æ—¥ã€‚æ€»çš„æ¥è¯´ï¼Œæˆ‘æ˜¯ä¸€ä¸ªï¼ˆè¿‡åº¦ï¼Ÿï¼‰è‡ªä¿¡çš„äººï¼Œä½†åœ¨æˆ‘çš„ç”Ÿæ´»ä¸­ï¼Œæœ‰å‡ æ¬¡æˆ‘å¯¹è‡ªå·±æˆåŠŸçš„èƒ½åŠ›æœ‰å¾ˆå¤§çš„ç„¦è™‘ã€‚æˆ‘ç«‹å³æƒ³åˆ°çš„æ˜¯ï¼šå¼€å§‹ä¸Šé«˜ä¸­ï¼Œå¼€å§‹ä¸Šå¤§å­¦ï¼Œä»¥åŠå¤§å­¦æ¯•ä¸šååœ¨å¾®è½¯å·¥ä½œã€‚è€Œå¼€æºçš„ Envoy å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚æˆ‘è®°å¾—æˆ‘è¢«å…¬ä¼—çš„ååº”å“åäº†ã€‚äººä»¬ä¼šæ€ä¹ˆè¯´ï¼Ÿåé¦ˆä¼šæ˜¯ç§¯æçš„è¿˜æ˜¯æ¶æ¯’çš„ï¼Ÿè™½ç„¶æˆ‘ä»¬åœ¨å¼€æºæ—¶æ˜¯ä¸€ä¸ªå°å›¢é˜Ÿï¼Œä½†æˆ‘ä»ç„¶å†™äº† 90% æˆ–æ›´å¤šçš„ä»£ç ï¼Œå¹¶ä¸”è§‰å¾—æŠŠå®ƒæ”¾åˆ°å…¬å…±é¢†åŸŸæ˜¯å¯¹æˆ‘è‡ªå·±å’Œæˆ‘çš„èƒ½åŠ›çš„ä¸€ç§åæ˜ ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœŸè€Œè‡³ï¼Œ&lt;a href=&#34;https://eng.lyft.com/announcing-envoy-c-l7-proxy-and-communication-bus-92520b6c8191&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt; åœ¨ 2016 å¹´ 9 æœˆ 14 æ—¥ &lt;a href=&#34;https://eng.lyft.com/announcing-envoy-c-l7-proxy-and-communication-bus-92520b6c8191&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆä¸ºå¼€æºäº§å“&lt;/a&gt;ã€‚æˆ‘è®°å¾—æˆ‘å’Œå¦»å­ä¸€èµ·åº†ç¥ï¼Œå¹¶è¯´äº†ä¸€äº›è¯ã€‚â€œå¦‚æœæˆ‘ä»¬èƒ½è®©å…¶ä»–å…¬å¸åƒ Lyft ä¸€æ ·ä½¿ç”¨ Envoyï¼Œæˆ‘å°±ä¼šå¾ˆé«˜å…´ã€‚â€&lt;/p&gt;
&lt;p&gt;å¯¹å¼€æ”¾æºç å‘å¸ƒçš„ååº”å‡ ä¹æ˜¯æ™®éçš„ç§¯æã€‚ä»¤æˆ‘ä»¬æƒŠè®¶çš„æ˜¯ï¼Œå‡ ä¹æ˜¯ç«‹åˆ»ï¼Œæˆ‘ä»¬å¼€å§‹å¬åˆ°å¤§å…¬å¸çš„å£°éŸ³ï¼Œè€Œä¸æ˜¯å°å…¬å¸ã€‚åœ¨å‡ å‘¨å†…ï¼Œæˆ‘ä»¬ä¸è‹¹æœã€å¾®è½¯è¿›è¡Œäº†äº¤è°ˆï¼Œä¸è°·æ­Œçš„å¯¹è¯ä¹Ÿä¸æ–­åŠ å¿«ã€‚å¤§å…¬å¸åœ¨ç°æœ‰çš„è§£å†³æ–¹æ¡ˆä¸­å­˜åœ¨é—®é¢˜ï¼Œå¹¶ä¸”æœ‰å¤§é‡çš„å›¢é˜Ÿå‡†å¤‡æŠ•å…¥åˆ°è§£å†³è¿™äº›é—®é¢˜çš„å·¥ä½œä¸­ã€‚å…·æœ‰è®½åˆºæ„å‘³çš„æ˜¯ï¼ˆè‡³å°‘åœ¨ Twitter çš„è§‚ç‚¹ä¸­ï¼‰ï¼ŒC++ åœ¨è¿™é‡Œæ˜¯ä¸€ç§å¸®åŠ©ï¼Œè€Œä¸æ˜¯ä¸€ç§é˜»ç¢ã€‚è¿™äº›å¤§å…¬å¸éƒ½å·²ç»æ‹¥æœ‰å……è¶³çš„ C/C++ å¼€å‘èµ„æºï¼Œä»¥åŠä»–ä»¬æƒ³è¦æ•´åˆçš„ç°æœ‰åº“ï¼Œç­‰ç­‰ã€‚å¯¹ä»–ä»¬æ¥è¯´ï¼ŒC++ æ˜¯ä¸€ä¸ªå–ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œæ¯«ä¸å¥‡æ€ªï¼Œæˆ‘ä»¬ä¸è°·æ­Œçš„äººæœ‰æœ€å¤šçš„äº’åŠ¨ã€‚æœ€åˆä¸»è¦æ˜¯æ„å»º Istio çš„å›¢é˜Ÿï¼Œä½†æ¸æ¸åœ°ï¼Œæˆ‘ä»¬ä¸ Anna Berenberg èŠ±äº†æ›´å¤šæ—¶é—´ï¼Œå¥¹ç°åœ¨æ˜¯è°·æ­Œçš„æ°å‡ºå·¥ç¨‹å¸ˆï¼Œé¢†å¯¼å„ç§ç½‘ç»œå’Œè´Ÿè½½å‡è¡¡å·¥ä½œã€‚è¿™ç§å…³ç³»å°†äº§ç”Ÿ &amp;quot; å–·æ°”ç‡ƒæ–™â€ï¼Œåœ¨ 2017 å¹´åˆçœŸæ­£å¯åŠ¨è¯¥é¡¹ç›®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¼€å§‹èµ·é£&#34;&gt;å¼€å§‹èµ·é£&lt;/h3&gt;
&lt;p&gt;åˆ°äº† 2017 å¹´åˆï¼Œå¾ˆæ˜æ˜¾ï¼ŒEnvoy çš„å¼€å‘æ­£åœ¨åŠ é€Ÿã€‚è°·æ­Œæ‰¿è¯ºç”¨ Envoy å–ä»£ NGINXï¼Œç”¨äº Istioï¼ˆæœ€ç»ˆåœ¨ 2017 å¹´æ˜¥å­£æ¨å‡ºï¼‰ï¼Œå¯¹é¡¹ç›®çš„æœªæ¥æ¥è¯´æ›´é‡è¦çš„æ˜¯ï¼ŒAnna çš„å¤§å‹å›¢é˜Ÿè‡´åŠ›äº GCP äº‘è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œä»–ä»¬å¼€å§‹å‘ä½¿ç”¨ Envoy çš„å„ç§äº‘è´Ÿè½½å‡è¡¡äº§å“ä»¥åŠå†…éƒ¨ç”¨ä¾‹ï¼ˆè¿™åœ¨è¿™ä¸ªæ—¶æœŸéƒ½æ˜¯éå¸¸ç§˜å¯†çš„ï¼Œä½†ç°åœ¨å·²ç»ä¼—æ‰€å‘¨çŸ¥ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å°†æ°¸è¿œè®°å¾—ä¸è°·æ­Œäº’åŠ¨çš„é‚£æ®µæ—¶é—´æ˜¯æˆ‘èŒä¸šç”Ÿæ¶¯ä¸­æœ€ç´§å¼ çš„æ—¶æœŸä¹‹ä¸€ã€‚è¯´å®è¯ï¼Œé‚£æ„Ÿè§‰å°±åƒä¸€ä¸ªæ”¶è´­ï¼ˆå®¡è®¯ï¼‰è¿‡ç¨‹ã€‚æˆ‘è®°å¾—é•¿é•¿çš„ä¼šè®®å’Œç”µå­é‚®ä»¶çº¿ç¨‹ï¼Œä»¥è¯æ˜æˆ‘ä»¬çš„æŠ€æœ¯å†³å®šï¼Œâ€œé¢è¯• &amp;ldquo;ä¸­ï¼Œè°·æ­Œè¯•å›¾ç¡®å®šæˆ‘ä»¬æ˜¯å¦ä¼šæˆä¸ºä¸€ä¸ªå¥½çš„å¼€æºé¡¹ç›®åˆä½œä¼™ä¼´ï¼Œç­‰ç­‰ã€‚å½“æ—¶æˆ‘ä»¬å¾ˆç—›è‹¦åœ°å‘ç°ï¼Œè¿™æ¬¡&amp;rdquo; æ”¶è´­ &amp;quot; å°†ä½¿ Envoy è¿›å…¥ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±æ°¸è¿œæ— æ³•å®ç°çš„è½¨é“ï¼Œæ‰€ä»¥æˆ‘ä»¬å°½ä¸€åˆ‡åŠªåŠ›ä½¿å®ƒè·å¾—æˆåŠŸï¼Œæœ€ç»ˆä¹Ÿè·å¾—äº†æˆåŠŸã€‚è€Œä¸”ï¼Œåœ¨è¿‡å» 4 å¹´å¤šçš„æ—¶é—´é‡Œï¼Œæˆ‘ä»¬ä¸è°·æ­Œçš„åˆä½œç¡®å®æ˜¯ä¸€ç§æ°å‡ºçš„ä¼™ä¼´å…³ç³»ã€‚æ—©æœŸçš„è°·æ­Œäº‘å·¥ç¨‹å¸ˆæœ€ç»ˆæˆä¸ºç»´æŠ¤è€…ï¼ŒHarvey Tuch å’Œ Alyssa Wilkï¼Œä¸ºé¡¹ç›®å¸¦æ¥äº†å¤§é‡çš„äººæ‰ï¼ŒåŒ…æ‹¬æŠ€æœ¯ä¸Šçš„ï¼Œä»¥åŠå¯¹å¼€æºå’Œç¤¾åŒºçš„æ”¯æŒã€‚æˆ‘å¯¹ä»–ä»¬çš„æ„Ÿæ¿€ä¹‹æƒ…æº¢äºè¨€è¡¨ï¼Œæ²¡æœ‰ä»–ä»¬ï¼Œé¡¹ç›®å°±ä¸ä¼šæœ‰ä»Šå¤©çš„æˆå°±ã€‚å¤šå¹´æ¥ä¸ºè¯¥é¡¹ç›®åšå‡ºè´¡çŒ®çš„å…¶ä»–è°·æ­Œå·¥ç¨‹å¸ˆï¼ˆç°åœ¨æœ‰å¾ˆå¤šï¼‰ï¼Œé™¤äº†æ™®éæ˜¯ä¼˜ç§€çš„ç¤¾åŒºç®¡ç†è€…ä¹‹å¤–ï¼Œè¿˜ä¸ºè¯¥é¡¹ç›®å¢åŠ äº†å¤§é‡çš„å·¥ç¨‹åŠ›é‡ï¼Œå¦åˆ™è¯¥é¡¹ç›®å°±ä¸ä¼šæœ‰ã€‚æˆ‘å½“ç„¶å¯¹æœ€åˆçš„è°·æ­Œåˆä½œå…³ç³»æœ‰é¡¾è™‘ï¼ˆæŠ€æœ¯å’Œç†å¿µä¸Šçš„åˆ†æ­§ï¼Œç­‰ç­‰ï¼‰ï¼Œä½†æˆ‘å¯ä»¥è¯šå®åœ°è¯´ï¼Œè¿™äº›é¡¾è™‘éƒ½æ²¡æœ‰æˆä¸ºç°å®ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†ç¡®ä¿ Istio å’Œ GCP å›¢é˜Ÿä¸è°·æ­Œåˆä½œçš„æˆåŠŸä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜èŠ±äº†å¤§é‡æ—¶é—´ä¸å…¶ä»–å…¬å¸å’Œç»´æŠ¤è€…åˆä½œå¹¶åŠ å…¥ä»–ä»¬ï¼Œå…¶ä¸­è®¸å¤šäººå¯¹é¡¹ç›®äº§ç”Ÿäº†å·¨å¤§çš„å½±å“ï¼Œè‡³ä»Šä»ä½œä¸ºç»´æŠ¤è€…ã€è´¡çŒ®è€…æˆ–ç”¨æˆ·å¤§é‡å‚ä¸ã€‚å¦‚æœæ²¡æœ‰è¿™äº›æ—©æœŸçš„ç¤¾åŒºæˆå‘˜ï¼Œè¿™ä¸ªé¡¹ç›®å°±ä¸ä¼šæœ‰ä»Šå¤©ï¼Œæˆ‘ä¹Ÿéå¸¸æ„Ÿè°¢ä»–ä»¬å¯¹é¡¹ç›®çš„ä¿¡ä»»ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶ï¼Œéšç€é¡¹ç›®çš„ä¸æ–­æ·±å…¥ï¼Œæˆ‘å¼€å§‹æ”¶åˆ°å¤§é‡æŠ•èµ„è€…å¯¹ Envoy çš„å…´è¶£ã€‚æœ‰å¼ºçƒˆçš„æ„¿æœ›è®©æˆ‘ç¦»å¼€ Lyftï¼Œå›´ç»•è¿™ä¸ªé¡¹ç›®å¼€ä¸€å®¶å…¬å¸ã€‚æˆ‘&lt;a href=&#34;https://medium.com/@mattklein123/optimizing-impact-why-i-will-not-start-an-envoy-platform-company-8904286658cb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å†™è¿‡è¿™éƒ¨åˆ†çš„æ—…ç¨‹&lt;/a&gt;ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šåœ¨è¿™é‡Œé‡è¿°ï¼Œç•™åœ¨ Lyft æˆ‘ä¼šæœ‰å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›æ¥å¤„ç†æ‰€æœ‰è¿™äº›äº’åŠ¨ã€‚æ­£å¦‚é“¾æ¥çš„æ–‡ç« æ‰€æè¿°çš„ï¼Œæˆ‘æœ€ç»ˆå†³å®šç•™åœ¨ Lyftï¼Œä¸å¼€å…¬å¸ï¼Œä»¥æ”¯æŒ Envoy çš„æŒç»­æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»ç„¶åœ¨ Lyft å·¥ä½œï¼Œæ­£å¦‚æˆ‘å°†åœ¨åé¢è¿›ä¸€æ­¥è®¨è®ºçš„é‚£æ ·ï¼Œæˆ‘è¶Šæ¥è¶Šå¤šåœ°ä»äº‹ä¸¤ä»½å·¥ä½œã€‚æˆ‘çš„ç¬¬ä¸€ä»½å·¥ä½œæ˜¯åœ¨å†…éƒ¨é¢†å¯¼ç½‘ç»œå›¢é˜Ÿï¼Œå¹¶åœ¨è¿è¥ä¸Šæ”¯æŒ Lyft çš„ Envoyã€‚æˆ‘çš„ç¬¬äºŒä»½å·¥ä½œæ˜¯ä½œä¸º Envoy çš„å…¬ä¼—å½¢è±¡ï¼ŒåŒ…æ‹¬ OSS é¢†å¯¼ï¼Œä»£ç å®¡æŸ¥ï¼Œä¿®å¤é”™è¯¯ï¼Œç¼–å†™å¯ä»¥ä¿ƒè¿›é¡¹ç›®çš„åŠŸèƒ½ï¼Œåœ¨ä¼šè®®ä¸Šå‘è¨€ï¼Œå¸®åŠ©å…¶ä»–å…¬å¸é‡‡ç”¨å’Œéƒ¨ç½² Envoyï¼Œç­‰ç­‰ã€‚æˆ‘å¼€å§‹å˜å¾—è¿‡äºåˆ†æ•£ï¼Œå¹¶å‡ºç°äº†å€¦æ€ çš„è¿¹è±¡ã€‚ç„¶è€Œï¼Œåˆ°äº† 2017 å¹´å¹´ä¸­ï¼Œä¸å¯å¦è®¤çš„äº‹å®æ˜¯ï¼ŒEnvoy çš„å‘å±•è½¨è¿¹æ˜¯å¤§å¤§çš„â€œå‘ä¸Šå’Œå‘å³â€ã€‚å„å¤§å…¬å¸ã€â€œåŒè¡Œå…¬å¸â€ã€å‚ç›´äº§å“å’ŒæœåŠ¡ç­‰çš„é‡‡ç”¨ç‡ç»§ç»­æ”€å‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æèµ ç»™-cncf-ä¸”æ„Ÿåˆ°å€¦æ€ &#34;&gt;æèµ ç»™ CNCF ä¸”æ„Ÿåˆ°å€¦æ€ &lt;/h3&gt;
&lt;p&gt;åˆ° 2017 å¹´ç§‹å¤©ï¼Œæœ‰ä¸¤ä»¶äº‹æ˜¯æ¸…æ¥šçš„ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Envoy å·²ç»è¶…å‡ºäº† Lyft OSS è®¾å¤‡æ‰€èƒ½æä¾›çš„èŒƒå›´ã€‚è¯¥é¡¹ç›®éœ€è¦æ³•å¾‹ã€å…¬å…±å…³ç³»ã€è¥é”€ã€æ´»åŠ¨ç»„ç»‡ç­‰æ–¹é¢çš„å¸®åŠ©ã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘å¾ˆå¿«å°±å®Œå…¨å€¦æ€ äº†ï¼Œéœ€è¦æ‰¾å‡ºä¸€æ¡å¯æŒç»­å‘å±•çš„é“è·¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸ºäº†è§£å†³ç¬¬ä¸€ç‚¹ï¼Œæˆ‘ä»¬æœ€ç»ˆåŒæ„è€ƒè™‘å°† Envoy è½¬äº¤åˆ° CNCFã€‚æ•°æœˆæ¥ï¼ŒCNCF ä¸€ç›´åœ¨è¿½æ±‚è¯¥é¡¹ç›®ï¼Œä½†ä¼¼ä¹ä»æ¥æ²¡æœ‰ä»»ä½•ä»¤äººä¿¡æœçš„ç†ç”±æ¥åŠ å…¥ã€‚åˆ° 2017 å¹´åº•ï¼Œå¾ˆæ˜æ˜¾ï¼ŒCNCF çš„èµ„æºå³ä½¿ä¸æ˜¯å‡€æ”¶ç›Šï¼Œä¹Ÿè‡³å°‘å¯¹é¡¹ç›®æ˜¯ä¸­æ€§çš„ã€‚æˆ‘ä»¬å¼€å§‹äº†æäº¤ç¨‹åºï¼Œå¹¶æœ€ç»ˆåœ¨æˆ‘ä»¬æœ€åˆå¼€æ”¾é¡¹ç›®èµ„æºçš„å‡ ä¹æ•´æ•´ä¸€å¹´å&lt;a href=&#34;https://eng.lyft.com/envoy-joins-the-cncf-dc18baefbc22&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ å…¥äº†è¯¥åŸºé‡‘ä¼š&lt;/a&gt;ã€‚æˆ‘å¾ˆæ„Ÿè°¢ Alexis Richardson å’Œ Chris Aniszczyk åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¯¹é¡¹ç›®çš„æŒ‡å¯¼ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒç‚¹åˆ™è¦å¤æ‚å¾—å¤šã€‚ä»æ ¹æœ¬ä¸Šè¯´ï¼Œæˆ‘çš„å·¥ä½œæ—¶é—´è¶…è¿‡äº†æˆ‘çš„å·¥ä½œèƒ½åŠ›ï¼Œæœ‰æ•ˆåœ°è·¨è¶Šäº†ä¸¤ä¸ªä¸åŒçš„å·¥ä½œã€‚æ­¤å¤–ï¼Œæˆ‘æ­£åœ¨æœŸå¾…æˆ‘çš„ç¬¬ä¸€ä¸ªå­©å­ï¼Œé¢„äº§æœŸåœ¨ 2018 å¹´åˆï¼Œéšç€åˆ°æ¥çš„æ—¥æœŸè¶Šæ¥è¶Šè¿‘ï¼Œè¿™è®©æˆ‘è¶Šæ¥è¶Šç„¦è™‘ã€‚åˆ°è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘å·²ç»å¾ˆæ¸…æ¥šï¼Œæˆ‘åœ¨è®¾å®šæœŸæœ›å’Œç•Œé™æ–¹é¢åšå¾—ä¸å¤Ÿå¥½ï¼Œä¸çŸ¥é“è‡ªå·±èƒ½å¤Ÿä¸º Lyft æä¾›ä»€ä¹ˆï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰ä»è¡Œä¸šçš„è§’åº¦å…³æ³¨ Envoy çš„æŒç»­å¢é•¿ã€‚åœ¨ Lyftï¼Œæˆ‘è¶Šæ¥è¶Šæ”¾ä»»è‡ªæµï¼Œé™·å…¥äººé™…å…³ç³»çš„äº‰åµï¼Œåœ¨ä¸ºæ›´å¤šçš„åˆçº§å›¢é˜Ÿæˆå‘˜æä¾›æŒ‡å¯¼å’Œé¢†å¯¼æ–¹é¢ï¼Œæ²¡æœ‰è¾¾åˆ°æˆ‘è¿™ä¸ªçº§åˆ«çš„æœŸæœ›ã€‚&lt;/p&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘å½“æ—¶æ­£å¤„äºå´©æºƒçš„è¾¹ç¼˜ï¼Œæœ€ç»ˆæˆ‘é€‰æ‹©äº† Envoy è€Œä¸æ˜¯ Lyftï¼Œè¿™å¯¹æˆ‘çš„ Lyft åŒäº‹é€ æˆäº†ä¼¤å®³ã€‚æˆ‘æƒ³ï¼Œå¦‚æœæˆ‘åœ¨ 2017 å¹´åˆè‡³å¹´ä¸­å¯¹æˆ‘çš„å·¥ä½œé‡ä¸ Lyft çš„é¢†å¯¼å±‚æ›´åŠ é€æ˜ï¼Œæˆ‘å¯èƒ½ä¼šé¿å…ä¸€äº›æœ€ç³Ÿç³•çš„ç»“æœï¼Œä½†ä¸å¹¸çš„ç°å®æ˜¯ï¼Œ&lt;strong&gt;ä¸ºå¼€æºè½¯ä»¶è¡Œä¸šçš„å·¥ä½œæä¾›èµ„æºï¼Œè€Œè¿™äº›å·¥ä½œå¯¹é›‡ä¸»æ²¡æœ‰ç«‹å³æ˜æ˜¾çš„ä½œç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„åŠªåŠ›&lt;/strong&gt;ã€‚å®ƒå¯èƒ½ä¼šæ›´é¡ºåˆ©ï¼Œä¹Ÿå¯èƒ½ä¸ä¼šã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œè™½ç„¶æˆ‘å¯¹ä¸€äº›æˆ‘æœ¬å¯ä»¥å¤„ç†å¾—æ›´å¥½çš„äººé™…å…³ç³»é—®é¢˜æ„Ÿåˆ°é—æ†¾ï¼Œä½†æ— è®ºå¥½åï¼Œ&lt;strong&gt;æˆ‘éƒ½ä¸åæ‚”æŠŠç²¾åŠ›æ”¾åœ¨ Envoy ä¸Šã€‚æˆ‘ä¼˜å…ˆè€ƒè™‘çš„æ˜¯ Envoyï¼Œè€Œä¸æ˜¯ Lyftï¼Œæˆ‘åšäº†æˆ‘è®¤ä¸ºå½“æ—¶å¿…é¡»åšçš„äº‹æƒ…ï¼Œä»¥ä½¿å®ƒæˆåŠŸ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯æŒç»­å‘å±•é“è·¯&#34;&gt;å¯æŒç»­å‘å±•é“è·¯&lt;/h3&gt;
&lt;p&gt;æˆ‘çš„ç¬¬ä¸€ä¸ªå­©å­åœ¨ 2018 å¹´ 2 æœˆå‡ºç”Ÿï¼ŒLyft æå…¶æ…·æ…¨çš„é™ªäº§å‡æ”¿ç­–ä¸ºæˆ‘æä¾›äº†ä¼‘æ¯å’Œæ”¾ç©ºè‡ªå·±çš„æ—¶é—´ã€‚æˆ‘ä» Lyft è·å¾—äº†ä¸€äº›ç©ºé—´ï¼Œå¹¶å¼€å§‹æ›´æ·±å…¥åœ°æ€è€ƒæˆ‘æƒ³è¦ä»€ä¹ˆä»¥åŠä»€ä¹ˆå¯¹æˆ‘æ¥è¯´æ˜¯å¯æŒç»­çš„ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä¼‘å®Œé™ªäº§å‡å›æ¥åï¼Œæˆ‘ä¸ Lyft é¢†å¯¼å±‚æ˜ç¡®è¡¨ç¤ºï¼Œæˆ‘ä¸èƒ½å†å‚ä¸ Lyft çš„ Envoy çš„ &amp;ldquo;æ—¥å¸¸&amp;rdquo; è¿ç»´ã€‚ç›¸åï¼Œç”±äº 2017 å¹´åº•çš„ä¸€äº›åæœï¼ŒåŸºç¡€è®¾æ–½å›¢é˜Ÿä¹Ÿå¸Œæœ›ä¸æˆ‘åˆ†å¼€ä¸€äº›ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œ&lt;strong&gt;æˆ‘å¤§å¹…åé€€ï¼Œå®é™…ä¸Šå®Œå…¨åœæ­¢äº†åœ¨ Lyft çš„åŸºç¡€è®¾æ–½å·¥ä½œ&lt;/strong&gt;ï¼Œåœ¨ 2018 å¹´å¹´ä¸­è‡³å¹´æœ«çš„ Lyft Bikes å’Œ Scooters åˆå§‹ç‰ˆæœ¬ä¸­ç¼–å†™å›ºä»¶ç½‘ç»œä»£ç ã€‚è¿™æ˜¯ä¸€ä¸ªäº†ä¸èµ·çš„å›¢é˜ŸåŠªåŠ›ï¼Œåœ¨å‹ç¼©çš„æ—¶é—´èŒƒå›´å†…å¾—åˆ°äº†ä¸€äº›ä¸œè¥¿ï¼Œæˆ‘çœŸçš„å¾ˆå–œæ¬¢åœ¨å‡ ä¸ªæœˆå†…åšä¸€äº›å®Œå…¨ä¸åŒçš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;p&gt;2018 å¹´ä¹Ÿæ˜¯æˆ‘ç§¯æå¼€å§‹ç¢ç£¨åœ¨ Envoy OSS ç¤¾åŒºä¸­ &amp;ldquo;å–ä»£è‡ªå·±&amp;rdquo; çš„é‚£ä¸€å¹´ã€‚æˆ‘èŠ±äº†å¤§é‡çš„æ—¶é—´ï¼ˆå¹¶å°†ç»§ç»­èŠ±å¤§é‡çš„æ—¶é—´ï¼‰æ¥åŸ¹å…»ç»´æŠ¤è€…ã€æ–°çš„è´¡çŒ®è€…ï¼Œç»„ç»‡ç¬¬ä¸€æ¬¡ä¸“é—¨çš„ EnvoyConï¼Œç­‰ç­‰ã€‚ä»»ä½•é¢†å¯¼è€…éƒ½åº”è¯¥æœ‰ä¸€ä¸ªç›®æ ‡ï¼Œé‚£å°±æ˜¯ç¡®ä¿è¯¥ç»„ç»‡åœ¨æœ‰ä¸€å¤©è¯¥é¢†å¯¼è€…é€€ä½æ—¶èƒ½å¤Ÿç»§ç»­è‰¯å¥½åœ°è¿ä½œã€‚&lt;/p&gt;
&lt;p&gt;åˆ° 2018 å¹´åº•ï¼Œæˆ‘çš„ä¸»è¦èŒä¸šå€¦æ€ é£é™©å·²ç»å¾—åˆ°è§£å†³ï¼Œæˆ‘åˆå¼€å§‹äº†åˆç†çš„å·¥ä½œæ—¶é—´ï¼Œå¹¶èŠ±äº†å¾ˆå¤šæ—¶é—´ä¸æˆ‘çš„å¦»å­å’Œå„¿å­åœ¨ä¸€èµ·ï¼Œæˆ‘çš„æ—¶é—´å¤§è‡´åœ¨ Envoy OSS å·¥ä½œå’Œ Lyft çš„ä¸€èˆ¬åŸºç¡€è®¾æ–½é¢†å¯¼ä¹‹é—´å„å ä¸€åŠã€‚æ˜ç¡®åœ°è¯´ï¼ŒEnvoy çš„æˆåŠŸå¸¦æ¥çš„ç‰¹æƒä½¿æˆ‘èƒ½å¤Ÿåœ¨ Lyft çš„å·¥ä½œç”Ÿæ´»ä¸­å–å¾—è¿™ç§å¹³è¡¡ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œéšç€æˆ‘çš„è¡Œä¸šåœ°ä½çš„æé«˜ï¼Œæˆ‘çš„å½±å“åŠ›ä¹Ÿåœ¨åŒæ­¥å¢åŠ ï¼Œè¿™ä½¿å¾—æˆ‘æ›´å®¹æ˜“æŒ‰ç…§è‡ªå·±çš„æ„æ„¿è®¾å®šå°±ä¸šæ¡æ¬¾ã€‚æ²¡æœ‰å¤šå°‘äººæœ‰è¿™æ ·çš„è¿æ°”ï¼Œæˆ‘æ˜ç™½æˆ‘æ˜¯å¤šä¹ˆå¹¸è¿ï¼Œèƒ½å¤Ÿâ€œçªç ´â€œå€¦æ€ å¢™çš„å¦ä¸€è¾¹è€Œä¸å¿…ç¦»å¼€æˆ‘çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;envoy-é•¿å¤§äº†&#34;&gt;Envoy é•¿å¤§äº†&lt;/h3&gt;
&lt;p&gt;è‡ª 2019 å¹´ä»¥æ¥ï¼Œå› ä¸ºæ–°å† ç–«æƒ…ï¼Œæˆ‘åœ¨ Lyft çš„åŸºç¡€è®¾æ–½é¢†å¯¼å’Œ OSS é¢†å¯¼ä¹‹é—´ç»§ç»­ä¿æŒç€æˆ‘ä¸Šé¢æè¿°çš„äº”äº”å¼€çš„æ¯”ä¾‹ã€‚å½“ç„¶ä¹Ÿæœ‰å•è°ƒå’Œæ¸´æœ›ä¸åŒçš„æ—¶å€™ï¼ˆä»å†å²ä¸Šçœ‹ï¼Œæˆ‘æ˜¯ä¸€ä¸ªä¹ æƒ¯æ€§æ¢å·¥ä½œçš„äººï¼Œ6.5 å¹´æ˜¯è¿„ä»Šä¸ºæ­¢æˆ‘åœ¨ä¸€ä»¶äº‹æƒ…ä¸Šå·¥ä½œçš„æœ€é•¿æ—¶é—´ï¼‰ï¼Œä½†æ€»çš„æ¥è¯´ï¼Œæˆ‘å¾ˆé«˜å…´çœ‹åˆ° Envoy ä»ä¸€ä¸ªâ€œæ–°ç§€ &amp;quot; å˜æˆæ›´å¤šçš„â€œå°‘å¹´â€ã€‚æˆ‘ä¸å†ä¸“æ³¨äºåšæˆ‘æ‰€èƒ½æƒ³åˆ°çš„ä¸€åˆ‡ï¼Œä½¿ Envoy è·å¾—å·¨å¤§çš„æˆåŠŸï¼Œå› ä¸ºå¦ç‡åœ°è¯´ï¼ŒEnvoy æ˜¯ä¸€ä¸ªå·¨å¤§çš„æˆåŠŸï¼Œå·²ç»å¸­å·äº†å¸‚åœºï¼Œå¹¶æ”¹å˜äº†ç”¨æˆ·å¯¹åº”ç”¨è´Ÿè½½å‡è¡¡å·¥å…·çš„æœŸæœ›ã€‚ç›¸åï¼Œæˆ‘æ›´å…³æ³¨é¡¹ç›®çš„å¯æŒç»­æ€§ã€‚æˆ‘ä»¬æ˜¯åœ¨åšé•¿æœŸçš„å·¥ä½œï¼Œè¿™äº›å¤©æˆ‘è§‰å¾—è‡ªå·±æ›´åƒä¸€ä¸ª CEOï¼Œçœ‹å‡å‘˜äººæ•°ã€ä¼˜å…ˆçº§ã€é¢„ç®—ç¼–åˆ¶ã€å®‰å…¨é—®é¢˜ç­‰ç­‰ã€‚è¿™å¹¶ä¸æ˜¯è¯´è¿™ä¸æ˜¯æœ‰ç”¨çš„å·¥ä½œï¼›å®ƒæ˜¾ç„¶æ˜¯æœ‰ç”¨çš„ï¼Œå®ƒåªæ˜¯ä¸æ—©æœŸçš„å·¥ä½œä¸åŒï¼Œæ—©æœŸçš„å·¥ä½œæŠ€æœ¯æ€§æ›´å¼ºï¼ŒèŠ‚å¥æ›´å¿«ã€‚&lt;/p&gt;
&lt;p&gt;æˆªæ­¢åˆ° 2021 å¹´æœ«ï¼Œæˆ‘å¯¹ Envoy æœ€å¼•ä»¥ä¸ºè±ªçš„äº‹æƒ…æ˜¯ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ä¸ªç¤¾åŒºå·²ç»å¯ä»¥è‡ªæˆ‘ç»´æŒäº†ã€‚æˆ‘ä»¬æœ‰ä¸€ç¾¤ä»¤äººéš¾ä»¥ç½®ä¿¡çš„ç»´æŠ¤è€…ã€è´¡çŒ®è€…å’Œç”¨æˆ·ï¼Œä»–ä»¬å¯¹é¡¹ç›®çš„æˆåŠŸå……æ»¡çƒ­æƒ…ï¼Œå¹¶åœ¨ä½¿ Envoy æˆä¸ºä»Šå¤©çš„æ ·å­ä¸­å‘æŒ¥äº†ä½œç”¨ã€‚è¿™ç¡®å®æ˜¯ä¸€ä¸ªå›¢é˜Ÿçš„åŠªåŠ›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»éªŒæ•™è®­&#34;&gt;ç»éªŒæ•™è®­&lt;/h2&gt;
&lt;p&gt;è¿‡å»çš„ 5 å¹´æ˜¯ä¸€ä¸ªå²è¯—èˆ¬çš„æ—…ç¨‹ã€‚è™½ç„¶æˆ‘è§‰å¾—æˆ‘åœ¨æŠ€æœ¯ä¸Šå­¦åˆ°çš„ä¸œè¥¿ç›¸å¯¹è¾ƒå°‘ï¼Œä½†æˆ‘åœ¨é¢†å¯¼åŠ›ã€ç¤¾åŒºå»ºè®¾å’Œæ‰€æœ‰å…¶ä»–éæŠ€æœ¯æ€§çš„ä¸œè¥¿æ–¹é¢éƒ½å¾—åˆ°äº†æˆé•¿å’Œå­¦ä¹ ï¼Œè¿™äº›éƒ½æ˜¯å»ºç«‹ä¸€ä¸ªæˆåŠŸçš„ä¼ä¸šï¼Œæ— è®ºæ˜¯ä¼ä¸šè¿˜æ˜¯ä¸€ä¸ªä¸»è¦çš„å¼€æºæˆåŠŸæ•…äº‹ã€‚ä»¥ä¸‹æ˜¯æˆ‘å¯¹ä¸€äº›ä¸»è¦å­¦ä¹ å†…å®¹çš„ç®€çŸ­æ€»ç»“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æˆåŠŸçš„å¼€æºè½¯ä»¶å°±åƒåˆ›åŠä¸€ä¸ªä¼ä¸š&#34;&gt;æˆåŠŸçš„å¼€æºè½¯ä»¶å°±åƒåˆ›åŠä¸€ä¸ªä¼ä¸š&lt;/h3&gt;
&lt;p&gt;ä¹Ÿè®¸æœ‰äº‰è®®çš„æ˜¯ï¼Œ&lt;strong&gt;æˆ‘è®¤ä¸ºå¦‚æœä¸€ä¸ªäººæœ‰ç›®æ ‡è¦åˆ›å»ºä¸€ä¸ªéå¸¸æˆåŠŸçš„å¼€æºè½¯ä»¶é¡¹ç›®ï¼Œä»–ä»¬éœ€è¦æŠŠå®ƒæƒ³æˆä¸€ä¸ªä¼ä¸š&lt;/strong&gt;ã€‚é™¤äº†æ ¸å¿ƒæŠ€æœ¯ä¹‹å¤–ï¼Œåˆ›ä¸šè¿˜æ¶‰åŠå¾ˆå¤šå› ç´ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‹›è˜ï¼ˆåœ¨å¼€æºè½¯ä»¶ä¸­ï¼Œè¿™æ„å‘³ç€æ‹›è˜è´¡çŒ®è€…å’Œç»´æŠ¤è€…ï¼‰&lt;/li&gt;
&lt;li&gt;è·å–å®¢æˆ·ï¼ˆåœ¨å¼€æºè½¯ä»¶ä¸­ï¼Œè¿™è¢«è½¬åŒ–ä¸ºç”¨æˆ·ï¼‰&lt;/li&gt;
&lt;li&gt;æ–‡æ¡£å’ŒæŠ€æœ¯å†™ä½œ&lt;/li&gt;
&lt;li&gt;å…¬å…±å…³ç³»&lt;/li&gt;
&lt;li&gt;å¸‚åœºè¥é”€&lt;/li&gt;
&lt;li&gt;æ³•å¾‹ï¼ˆå•†æ ‡ã€è®¸å¯ç­‰ï¼‰&lt;/li&gt;
&lt;li&gt;äººåŠ›èµ„æºï¼ˆåœ¨å¼€æºè½¯ä»¶ä¸­ï¼Œè¿™å°†è½¬åŒ–ä¸ºè§£å†³ç¤¾åŒºçº çº·å’Œåˆ¶å®šæ–‡åŒ–ï¼‰&lt;/li&gt;
&lt;li&gt;èµ„é‡‘ï¼ˆåœ¨å¼€æºè½¯ä»¶ä¸­ï¼Œè¿™è½¬åŒ–ä¸ºè¾…åŠ©è´¹ç”¨ï¼Œå¦‚ CIã€ä¸ºç»´æŠ¤è€…æ‰¾åˆ°å…è®¸ä»–ä»¬åœ¨é¡¹ç›®ä¸­éƒ¨åˆ†æˆ–å…¨éƒ¨æ—¶é—´å·¥ä½œçš„å·¥ä½œï¼Œç­‰ç­‰ï¼‰&lt;/li&gt;
&lt;li&gt;æ€»çš„è¯´æ¥ï¼Œå°±æ˜¯é¢†å¯¼å’Œæ–¹å‘çš„ç¡®å®šã€‚èµ„æºæœ‰é™ï¼Œæœ‰å¾ˆå¤šäº‹æƒ…å¯ä»¥åšã€‚ä¼ä¸š / é¡¹ç›®éœ€è¦ä¸“æ³¨äºæœ€é‡è¦çš„äº‹æƒ…ï¼Œä»¥å®ç°äº§å“çš„å¸‚åœºé€‚åº”æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›´è§‚åœ°è¯´ï¼Œæˆ‘çŸ¥é“è¿™ä¸€ç‚¹ï¼Œåœ¨æœ€åˆä¸º Envoy è¿›è¡Œå¼€æºåŠªåŠ›æ—¶ï¼Œæˆ‘ç§¯æåœ°è¿½æ±‚ä¸Šè¿°æ‰€æœ‰çš„é¢†åŸŸï¼ŒåŠªåŠ›ä½¿é¡¹ç›®ä»å¼€å§‹å‘å±•åˆ°ä»Šå¤©çš„è§„æ¨¡ã€‚ä¸Šè¿°åˆ—è¡¨ä¸­çš„æ¯ä¸€é¡¹éƒ½å¾ˆå…³é”®ï¼Œå¦‚æœæ²¡æœ‰æ‰€æœ‰è¿™äº›ï¼Œä¸€ä¸ªé¡¹ç›®æ˜¯ä¸å¯èƒ½æˆåŠŸçš„ï¼Œå°¤å…¶æ˜¯åœ¨æŠ€æœ¯é¢†åŸŸæœ‰å¾ˆå¤šèµ„é‡‘é›„åšçš„å…¬å¸ç«äº‰å¯¹æ‰‹çš„æƒ…å†µä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å¼ºçƒˆé¼“åŠ±é‚£äº›è€ƒè™‘è¿›è¡Œå¤§è§„æ¨¡å¼€æºå·¥ä½œçš„äººæå‰åœ¨ä¸Šè¿°é¢†åŸŸè¿›è¡ŒæŠ•èµ„ï¼Œä»¥ä¾¿åœ¨ç¬¬ä¸€å¤©å°±ç»™äººç•™ä¸‹æœ€ä½³å°è±¡ã€‚æ­¤å¤–ï¼Œæ–°çš„å¼€æºé¡¹ç›®åº”è¯¥å‡†å¤‡åœ¨é¡¹ç›®æˆé•¿å¹¶å¼€å§‹çœ‹åˆ°é‡‡ç”¨æ—¶ï¼Œåœ¨ä¸Šè¿°é¢†åŸŸè¿›è¡Œæ›´å¤šçš„æŠ•èµ„ã€‚&lt;/p&gt;
&lt;p&gt;æ¯«ä¸å¥‡æ€ªï¼Œè¿™äº›å¤©æˆ‘åœ¨ Envoy ä¸Šåšçš„ç¼–ç å·¥ä½œç›¸å¯¹è¾ƒå°‘ã€‚æˆ‘åœ¨é¡¹ç›®ä¸Šçš„æ—¶é—´ä¸»è¦æ˜¯ç®¡ç†é¡¹ç›®çš„æ‰€æœ‰éæŠ€æœ¯æ–¹é¢ï¼ˆä¸Šè¿°åˆ—è¡¨ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œç”šè‡³æ›´å¤šï¼ï¼‰ï¼Œå¹¶ç¡®ä¿äº‹æƒ…æŒ‰è®¡åˆ’è¿›è¡Œã€‚æˆ‘æ‰€åšçš„å¤§å¤šæ•°ç¼–ç é¡¹ç›®éƒ½æ˜¯â€œæ¸…æ´ &amp;quot; çš„å¹•åé¡¹ç›®ï¼Œå¯¹é¡¹ç›®æœ‰å¥½å¤„ï¼Œä½†æ²¡æœ‰ä»€ä¹ˆä¹è¶£ï¼Œä¹Ÿä¸å¯èƒ½æ¿€åŠ±å…¶ä»–è´¡çŒ®è€…ï¼ˆå½“ç„¶ï¼Œæˆ‘å¯¹ä»–ä»¬æ¯å¤©çš„å·¥ä½œæ²¡æœ‰å‘è¨€æƒï¼Œæˆ‘æœ‰åŠ¨åŠ›è®©ä»–ä»¬å°½å¯èƒ½çš„å¼€å¿ƒï¼Œè¿™æ ·ä»–ä»¬å°±ä¸ä¼šç¦»å¼€ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç»ˆç«¯ç”¨æˆ·é©±åŠ¨çš„å¼€æºè½¯ä»¶æ˜¯ä¸€ç§ç»“æ„æ€§ä¼˜åŠ¿&#34;&gt;ç»ˆç«¯ç”¨æˆ·é©±åŠ¨çš„å¼€æºè½¯ä»¶æ˜¯ä¸€ç§ç»“æ„æ€§ä¼˜åŠ¿&lt;/h3&gt;
&lt;p&gt;è¿™äº›å¤©æ¥ï¼Œå¾ˆå¤šâ€œå¤§çš„å¼€æºè½¯ä»¶â€ï¼Œç‰¹åˆ«æ˜¯åœ¨åŸºç¡€è®¾æ–½é¢†åŸŸï¼Œæ˜¯ç”±å¤§å…¬å¸å’Œé£é™©æŠ•èµ„æ”¯æŒçš„åˆåˆ›å…¬å¸èµ„åŠ©çš„ã€‚æˆ‘ä¸ä¼šç»•åˆ°å…³äºå¼€æºè½¯ä»¶çš„å›°éš¾ç»æµçš„è®¨è®ºï¼Œå› ä¸ºæˆ‘&lt;a href=&#34;https://medium.com/@mattklein123/the-broken-economics-of-oss-5a1b31fc0182&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å·²ç»å†™è¿‡äº†&lt;/a&gt;ã€‚æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œ&lt;strong&gt;æˆ‘åšä¿¡ç»ˆç«¯ç”¨æˆ·çš„å¼€æºè½¯ä»¶æ¯”ä¼ä¸šå’Œé£é™©æŠ•èµ„æ”¯æŒçš„å¼€æºè½¯ä»¶æœ‰å¾ˆå¤§çš„ä¼˜åŠ¿&lt;/strong&gt;ï¼šæœ€åˆçš„å®¢æˆ·å‡ ä¹è‚¯å®šä¼šä»è½¯ä»¶ä¸­è·å¾—ä»·å€¼ï¼Œå¦åˆ™è½¯ä»¶å°±ä¸ä¼šå¾—åˆ°èµ„åŠ©ã€‚è¿™ç§ä¸å®¢æˆ·ä¸€èµ·å»ºç«‹ä¸œè¥¿çš„è‰¯æ€§å¾ªç¯æ˜¯éå¸¸å¼ºå¤§çš„ã€‚å®ƒå‡ ä¹æ™®éå¯¼è‡´äº†æ›´å¥½çš„ç»“æœï¼šè½¯ä»¶æ›´å¯é ã€æ›´ä¸“æ³¨ã€åŠŸèƒ½æ›´å°‘ã€‚æœ‰å¾ˆå¤šç”±æœ€ç»ˆç”¨æˆ·é©±åŠ¨çš„å¼€æºè½¯ä»¶çš„ä¾‹å­ï¼Œç„¶åå–å¾—äº†å·¨å¤§çš„å•†ä¸šæˆåŠŸã€‚é‰´äºåšå®çš„åŸºç¡€å’Œå†…åœ¨çš„äº§å“å¸‚åœºé€‚åº”æ€§ï¼Œè¿™å¯¹æˆ‘æ¥è¯´å¹¶ä¸å¥‡æ€ªã€‚æˆ‘å¸Œæœ›çœ‹åˆ°æ¯”ä»Šå¤©æ›´å¤šçš„æœ€ç»ˆç”¨æˆ·é©±åŠ¨çš„å¼€æºè½¯ä»¶ï¼Œå°½ç®¡æˆ‘è®¤è¯†åˆ°ç»æµä¸Šæ˜¯å›°éš¾çš„ã€‚å¯¹äºé‚£äº›æœ‰æœºä¼šçš„äººæ¥è¯´ï¼Œè¯·å‘è¿™ç§ç±»å‹çš„è½¯ä»¶æ‰€å…·æœ‰çš„ç»“æ„æ€§ä¼˜åŠ¿é æ‹¢ï¼&lt;/p&gt;
&lt;h3 id=&#34;ä¸è¦è·Ÿé£è¦è·Ÿéšå®¢æˆ·&#34;&gt;ä¸è¦è·Ÿé£ï¼Œè¦è·Ÿéšå®¢æˆ·&lt;/h3&gt;
&lt;p&gt;è¿™ä¹Ÿè®¸æ˜¯ &amp;ldquo;æˆåŠŸçš„å¼€æºè½¯ä»¶å°±åƒåˆ›ä¸š&amp;rdquo; å’Œ &amp;ldquo;æœ€ç»ˆç”¨æˆ·é©±åŠ¨çš„å¼€æºè½¯ä»¶æ˜¯ä¸€ç§ç»“æ„æ€§ä¼˜åŠ¿&amp;rdquo; çš„å¿…ç„¶ç»“æœï¼Œä½†æˆ‘æ— æ³•å¼ºè°ƒåšæŒä¸æ‡ˆåœ°å…³æ³¨å®¢æˆ·çš„å®é™…éœ€æ±‚è€Œä¸æ˜¯ç‚’ä½œå‘¨æœŸæ‰€è®¤ä¸ºçš„å®¢æˆ·éœ€æ±‚æ˜¯å¤šä¹ˆå…³é”®ã€‚ä¾‹å¦‚ï¼Œ&lt;strong&gt;å¤šå¹´æ¥ï¼Œäººä»¬ä¸€ç›´åœ¨å˜²ç¬‘ Envoy æ˜¯ç”¨ C++ ç¼–å†™çš„ï¼Œè¿™å¼•èµ·äº†æ— æ•°çš„ç¬‘è¯&lt;/strong&gt;ã€‚æˆ‘å–œæ¬¢ C++ å—ï¼Ÿä¸ï¼Œä¸æ˜¯å¾ˆå–œæ¬¢ã€‚å®ƒæ˜¯å¦åœ¨ 2015 å¹´å®Œæˆäº†å·¥ä½œï¼Œå¹¶å¸å¼•äº†æœ€åˆçš„ä¸€æ‰¹ä¸»è¦ç”¨æˆ·ï¼Ÿè‚¯å®šæ˜¯çš„ã€‚è¿™æ˜¯ä¸€ä¸ªå…³æ³¨å®¢æˆ·å’Œå¸‚åœºçš„ä¾‹å­ï¼Œè€Œä¸æ˜¯å±ˆæœäºæ²¡æœ‰å®é™…â€œå•†ä¸š &amp;quot; å½±å“çš„ç‚’ä½œã€‚å¦‚æœä¸€ä¸ªäººæŠŠå¼€æºè½¯ä»¶å½“åšä¸€ä¸ªä¼ä¸šï¼Œå°±ä¼šç«‹åˆ»æ˜ç™½ï¼Œ&lt;strong&gt;ä»¥å®¢æˆ·å’Œå¸‚åœºä¸ºä¸­å¿ƒæ˜¯å–å¾—å·¨å¤§æˆåŠŸçš„å”¯ä¸€é€”å¾„&lt;/strong&gt;ã€‚åœ¨ Envoyï¼Œæˆ‘èŠ±äº†å¤§é‡çš„æ—¶é—´ä¸ºç»ˆç«¯ç”¨æˆ·äº‰è®ºï¼Œä»¥ç¡®ä¿æˆ‘ä»¬å»ºç«‹çš„ä¸œè¥¿èƒ½è®©æ‰€æœ‰äººå—ç›Šï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€å°éƒ¨åˆ†å°ä¼—ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯æ‰©å±•æ€§æ˜¯è‡³å…³é‡è¦çš„&#34;&gt;å¯æ‰©å±•æ€§æ˜¯è‡³å…³é‡è¦çš„&lt;/h3&gt;
&lt;p&gt;è·Ÿç€å®¢æˆ·èµ°å¾€å¾€ä¼šå¯¼è‡´å®¢æˆ·çš„è¦æ±‚ä¸èƒ½å¾ˆå¥½åœ°èå…¥é¡¹ç›®çš„æ¶æ„ä¸­ã€‚ä»å¼€æºè½¯ä»¶çš„è§’åº¦æ¥çœ‹ï¼Œå¤±å»å¯¹é¡¹ç›®ä¸»è¦ç›®æ ‡çš„å…³æ³¨ä¼šå¯¼è‡´åŠŸèƒ½è”“å»¶ã€è½¯ä»¶æ— æ³•ç»´æŠ¤å’Œç»´æŠ¤äººå‘˜è´Ÿæ‹…è¿‡é‡ã€‚åŒæ—¶ï¼Œè¯´â€œä¸ &amp;quot; ä¹Ÿæ˜¯å¤±å»æ½œåœ¨ç”¨æˆ·çš„ä¸€ä¸ªä¿è¯ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº Envoyï¼Œæˆ‘æƒ³ç¡®ä¿æˆ‘ä»¬è‡³å°‘å¯ä»¥è¯´â€œæ˜¯çš„ï¼Œä½†æ˜¯â€¦â€¦&amp;quot;ï¼Œå³æä¾›ä¸€ä¸ªå¼ºå¤§çš„å¯æ‰©å±•æ€§æ¨¡å‹ï¼Œè®©ç”¨æˆ·å¯ä»¥æ»¡è¶³ä»–ä»¬çš„éœ€æ±‚ï¼Œè€Œä¸éœ€è¦å°†æ¯ä¸€ä¸ªæ”¹åŠ¨å’ŒåŠŸèƒ½éƒ½æ¨åˆ°ä¸Šæ¸¸ã€‚è¿™ç§ç­–ç•¥å·²ç»å¤šæ¬¡å¾—åˆ°å›æŠ¥ï¼Œå®ƒå‡è½»äº†ç»´æŠ¤è€…çš„è´Ÿæ‹…ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿè§£å†³ä»–ä»¬è‡ªå·±çš„é—®é¢˜ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå°† Envoy æ¨å‘äº†æˆ‘åœ¨æœ€åˆè®¾è®¡è¯¥è½¯ä»¶æ—¶ä»æœªæƒ³è±¡è¿‡çš„ç”¨ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;å¯æ‰©å±•æ€§ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¼€æºè½¯ä»¶çš„æ„å»ºæ¨¡å—ï¼Œæ˜¯è‡³å…³é‡è¦çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è´¨é‡é—®é¢˜&#34;&gt;è´¨é‡é—®é¢˜&lt;/h3&gt;
&lt;p&gt;è·Ÿéšå®¢æˆ·çš„å¦ä¸€ä¸ªæ¨è®ºæ˜¯ï¼Œè´¨é‡ç¡®å®å¾ˆé‡è¦ã€‚ç”¨æˆ·å¸Œæœ›è½¯ä»¶æ˜“äºæ“ä½œï¼Œç›¸å¯¹æ¥è¯´æ²¡æœ‰é”™è¯¯ï¼Œå…³å¿ƒå®‰å…¨ï¼Œç­‰ç­‰ã€‚æ›¾å‡ ä½•æ—¶å¾ˆå¤šäººä¼šè§‰å¾—å› ä¸ºå¼€æºè½¯ä»¶æ˜¯ &amp;quot; å…è´¹çš„â€ï¼Œæ‰€ä»¥è´¨é‡å°±å¾—ä¸åˆ°ä¿è¯ã€‚è¿™åœ¨ç†è®ºä¸Šä¹Ÿè®¸æ˜¯æ­£ç¡®çš„ï¼Œä½†å®é™…ä¸Šï¼Œåœ¨ä¸€ä¸ªé¡¹ç›®å¯¹è½¯ä»¶è´¨é‡è®¤çœŸå¯¹å¾…ä¹‹å‰ï¼Œç”¨æˆ·ä¸ä¼šå¤§é‡åœ°èšé›†åœ¨ä¸€ä¸ªè½¯ä»¶ä¸Šã€‚å› ä¸ºè·å¾—ç”¨æˆ·æ˜¯ä¸€ä¸ªé£è½®ï¼Œå¯ä»¥è·å¾—æ›´å¤šçš„ç”¨æˆ·ï¼ˆç‰¹åˆ«æ˜¯å½“ä»æ—©æœŸé‡‡ç”¨è€…è½¬å‘æ™šæœŸé‡‡ç”¨è€…æ—¶ï¼‰ï¼Œæ‰€ä»¥ç¡®ä¿ä¸ºæ•´ä¸ªè½¯ä»¶è´¨é‡ç¼–åˆ—æ—¶é—´é¢„ç®—å°±æ›´åŠ å…³é”®äº†ã€‚&lt;/p&gt;
&lt;p&gt;å…³äº Envoyï¼Œæˆ‘ä¸€ç›´æœ‰ä¸€ä¸ª &amp;ldquo;é›¶ç¢°æ’&amp;rdquo; çš„ç†å¿µã€‚ä»»ä½•å´©æºƒéƒ½ä¼šè¢«è°ƒæŸ¥å’Œä¿®å¤ï¼Œæ— è®ºå¤šä¹ˆä¸é¢‘ç¹çš„é”™è¯¯ã€‚è¿™ç§å¯¹ç¨³å®šæ€§å’Œè´¨é‡çš„å…³æ³¨ä¸ä¼šè¢«å¿½è§†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¤¾åŒºæ˜¯æ‰©å¤§è§„æ¨¡çš„å”¯ä¸€é€”å¾„&#34;&gt;ç¤¾åŒºæ˜¯æ‰©å¤§è§„æ¨¡çš„å”¯ä¸€é€”å¾„&lt;/h3&gt;
&lt;p&gt;è¿™å¾ˆæ˜æ˜¾ï¼Œä½†æˆ‘è¿˜æ˜¯è¦è¯´ï¼šç¤¾åŒºæ˜¯æ‰©å±•å¼€æºè½¯ä»¶çš„å”¯ä¸€é€”å¾„ã€‚è¿™æ˜¯ä¸€ä¸ªç”±ç»´æŠ¤è€…ã€è´¡çŒ®è€…å’Œç”¨æˆ·ç»„æˆçš„ç¤¾åŒºã€‚æ­¤å¤–ï¼Œç¤¾åŒºçš„&lt;strong&gt;åŸºè°ƒ&lt;/strong&gt;åœ¨é¡¹ç›®å¼€å§‹æ—¶å°±å·²ç»ç¡®å®šï¼Œè€Œä¸”æéš¾æ”¹å˜ã€‚äººç±»å€¾å‘äºéµå¾ªè§„èŒƒã€‚ä¸€æ—¦è§„èŒƒè¢«ç¡®å®šä¸‹æ¥ï¼Œæ— è®ºè§„èŒƒæ˜¯ä»€ä¹ˆï¼Œä¸è¿™äº›è§„èŒƒä¸ä¸€è‡´çš„äººéƒ½ä¼šè¢«é¿å¼€ã€‚å› æ­¤ï¼Œ&lt;strong&gt;é¡¹ç›®æœ€åˆçš„å…¬å…±åŸºè°ƒå¯¹äºè®¾å®šå…¶é•¿æœŸçš„ç¤¾åŒºè½¨è¿¹æä¸ºå…³é”®&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬æŠŠ Envoy åšæˆå¼€æºè½¯ä»¶æ—¶ï¼Œæˆ‘åœ¨ GitHub ä¸ŠæŠ•å…¥äº†å¤§é‡çš„ç²¾åŠ›ä¸äººä»¬ä¸€èµ·å·¥ä½œï¼Œä½¿ç”¨å»ºè®¾æ€§å’Œæ¬¢è¿æ€§çš„è¯­è¨€ã€‚æ€»çš„æ¥è¯´ï¼Œæˆ‘å°½æˆ‘æ‰€èƒ½è®© Envoy æˆä¸ºä¸€ä¸ªå—æ¬¢è¿çš„åœ°æ–¹ï¼Œè®©äººä»¬æ„¿æ„æ¥è´¡çŒ®è‡ªå·±çš„åŠ›é‡ï¼Œæ— è®ºæ˜¯ç»´æŠ¤ã€å¶å°”çš„è´¡çŒ®ï¼Œè¿˜æ˜¯ç”¨æˆ·å¸®åŠ©å…¶ä»–ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Envoy æ‰€å–å¾—çš„æ‰€æœ‰ä¸åŒç±»å‹çš„æˆåŠŸä¸­ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œç»™æˆ‘å¸¦æ¥æœ€å¤šä¸ªäººæ»¡è¶³æ„Ÿçš„éƒ¨åˆ†æ˜¯ï¼Œæœ‰ç›¸å½“å¤šçš„äººå‘Šè¯‰æˆ‘ï¼Œä»–ä»¬å·²ç»å‘èª“ä¸å†ä½¿ç”¨å¼€æºè½¯ä»¶ï¼Œå°¤å…¶æ˜¯åŸºç¡€è®¾æ–½å¼€æºè½¯ä»¶ï¼Œå› ä¸ºä»–ä»¬è§‰å¾—å¤§å¤šæ•°é¡¹ç›®ä¸­çš„äººå¯¹å½¼æ­¤æ„Ÿè§‰éƒ½å¾ˆç³Ÿç³•ã€‚ç›¸åçš„ï¼Œä»–ä»¬å–œæ¬¢ä¸º Envoy åšè´¡çŒ®ï¼Œå› ä¸ºè¿™ä¸ªç¤¾åŒºæ˜¯å¦‚æ­¤çš„å°Šé‡å’Œæ¬¢è¿å½¼æ­¤ã€‚è¿™éœ€è¦å¤§é‡çš„åŠªåŠ›å’Œçºªå¾‹ï¼Œå°¤å…¶æ˜¯åœ¨é¡¹ç›®çš„æ—©æœŸï¼Œæ‰èƒ½è¾¾åˆ°è¿™æ ·çš„ç»“æœï¼Œè€Œè¿™å·²ç»å¾—åˆ°äº†ä¼—å¤šçš„å›æŠ¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¦ä½ä¼°ä»ä¸€å¼€å§‹å°±ç¡®å®šé¡¹ç›®çš„æ–‡åŒ–å’ŒåŸºè°ƒçš„å¤åˆæ•ˆåº”ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ··åˆå•†ä¸šå’Œå¼€æºè½¯ä»¶çš„åˆ©ç›Šæ˜¯éå¸¸å›°éš¾çš„&#34;&gt;æ··åˆå•†ä¸šå’Œå¼€æºè½¯ä»¶çš„åˆ©ç›Šæ˜¯éå¸¸å›°éš¾çš„&lt;/h3&gt;
&lt;p&gt;å·²ç»æœ‰å¾ˆå¤šå…³äºå¼€æºè½¯ä»¶çš„å›°éš¾ç»æµå­¦çš„æ–‡ç« ï¼ˆ&lt;a href=&#34;https://medium.com/@mattklein123/the-broken-economics-of-oss-5a1b31fc0182&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŒ…æ‹¬æˆ‘è‡ªå·±çš„æ–‡ç« &lt;/a&gt;ï¼Œæˆ‘åœ¨ä¸Šé¢æåˆ°çš„ï¼‰ã€‚æˆ‘åªæƒ³è¯´ï¼Œ&lt;strong&gt;è¯•å›¾å°†å•†ä¸šä¸Šçš„æˆåŠŸå’Œå¼€æ”¾æºç çš„æˆåŠŸç»“åˆèµ·æ¥æ˜¯éå¸¸å›°éš¾çš„ï¼Œä¸»è¦æ˜¯å› ä¸ºè¿™äº›æˆåŠŸå¾€å¾€æ˜¯ç›¸äº’çŸ›ç›¾çš„&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ç›¸ä¿¡ï¼ŒEnvoy é€šè¿‡å…¶å¼ºå¤§çš„ API å’Œå¯æ‰©å±•æ€§ç³»ç»Ÿç©¿é€äº†è¿™ä¸ªçŸ›ç›¾ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼ŒEnvoy å·²ç»æˆä¸ºä¸€ä¸ªå·¥å…·ï¼Œç°åœ¨è¢«å¤§é‡çš„å‚ç›´äº§å“å’ŒæœåŠ¡æ‰€ä½¿ç”¨ã€‚è¿™å°±äº§ç”Ÿäº†ä¸€ä¸ªç¤¾åŒºï¼Œè¯¥ç¤¾åŒºå……æ»¡äº†é€‰æ‹©åœ¨ä¸€ä¸ªå…±åŒçš„åŸºåº•ä¸Šåˆä½œçš„å…¬å¸ï¼Œå³ä½¿æ˜¯é€šè¿‡åœ¨æ‰©å±• / API / æ§åˆ¶å¹³é¢ / UI/UX å±‚ä¸Šçš„åˆ›æ–°ï¼Œæ¨å‡ºç›¸äº’ç«äº‰çš„ä¸Šå±‚äº§å“ã€‚&lt;/p&gt;
&lt;p&gt;ä»»ä½•æˆåŠŸçš„å¼€æºé¡¹ç›®éƒ½ä¼šçœ‹åˆ°å¤§é‡çš„å•†ä¸š / æŠ•èµ„äººçš„å…´è¶£ã€‚å¦‚æœä¸€ä¸ªé¡¹ç›®çš„ç›®æ ‡æ˜¯ä¿æŒä¸€ä¸ªå……æ»¡æ´»åŠ›çš„ç¤¾åŒºï¼ŒåŒæ—¶åˆèƒ½å–å¾—å•†ä¸šä¸Šçš„æˆåŠŸï¼ˆæˆ‘è®¤ä¸ºè¿™å¯¹æ•´ä¸ªé¡¹ç›®çš„æˆåŠŸæ˜¯å¿…è¦çš„ï¼Œå› ä¸ºé’±å¿…é¡»æ¥è‡ªæŸå¤„ï¼‰ï¼Œ&lt;strong&gt;é‚£ä¹ˆé¢„å…ˆè€ƒè™‘å¦‚ä½•å°†æ ¸å¿ƒå±‚å’Œå•†ä¸šå±‚åˆ†å¼€æ˜¯æå…¶é‡è¦çš„&lt;/strong&gt;ã€‚è¿™æ ·åšçš„å®ç”¨æ€§å’Œç­–ç•¥ä¼šå› é¡¹ç›®å’ŒæŠ€æœ¯çš„ä¸åŒè€Œä¸åŒï¼Œä½†æˆ‘ç›¸ä¿¡ä¸“æ³¨äºå¼ºå¤§çš„ API / æ‰©å±•æ€§çš„åˆ†å‰²æ˜¯ä¸€ä¸ªå¯Œæœ‰æˆæ•ˆçš„ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŸºé‡‘ä¼šæ˜¯å¾ˆæ£˜æ‰‹çš„&#34;&gt;åŸºé‡‘ä¼šæ˜¯å¾ˆæ£˜æ‰‹çš„&lt;/h3&gt;
&lt;p&gt;åœ¨ç°ä»£çš„å¼€æºè®¨è®ºä¸­ï¼Œæœ‰å¾ˆå¤šå…³äºåŸºé‡‘ä¼šçš„ä½œç”¨çš„è®¨è®ºã€‚æˆ‘ä¸æ‰“ç®—å¯¹è¿™ä¸€è¯é¢˜åšå¤§é‡çš„è¯„è®ºï¼Œ&lt;strong&gt;ä½†æˆ‘çš„ä¸»è¦å»ºè®®æ˜¯ä¸è¦è¢«åŸºé‡‘ä¼šå’Œå®ƒä»¬å¯èƒ½æä¾›çš„ç†è®ºåˆ©ç›Šæ‰€å¹²æ‰°&lt;/strong&gt;ã€‚ç›¸åï¼Œè¦ç§¯æåœ°å…³æ³¨äº§å“çš„å¸‚åœºé€‚åº”æ€§ï¼Œç”Ÿäº§é«˜è´¨é‡çš„è½¯ä»¶ï¼Œå¹¶ä¸ºç”¨æˆ·æä¾›ä»·å€¼ã€‚å¦‚æœè¿™äº›äº‹æƒ…å¾—ä»¥å®ç°ï¼Œå…¶ä½™çš„äº‹æƒ…å°±ä¼šè‡ªç„¶è€Œç„¶åœ°å‘ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºéå¸¸æˆåŠŸçš„é¡¹ç›®æ¥è¯´ï¼ŒåŸºé‡‘ä¼šï¼Œæ›´ç¡®åˆ‡åœ°è¯´ï¼Œä¸­ç«‹çš„å•†æ ‡æŒæœ‰åœ°ï¼Œæ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘è‚¯å®šä¼šåœ¨é‚£ä¸ªæ—¶å€™è€ƒè™‘åŠ å…¥ä¸€ä¸ªã€‚éšç€é¡¹ç›®çš„æˆç†Ÿï¼ŒEnvoy ä»æˆä¸º CNCF çš„ä¸€éƒ¨åˆ†æ‰€è·å¾—çš„ä»·å€¼ä¹Ÿåœ¨ä¸æ–­å¢åŠ ã€‚CNCF é›‡ä½£äº†å¼€æºè½¯ä»¶å¾‹å¸ˆã€è¥é”€äººå‘˜ã€å…¬å…±å…³ç³»äººå‘˜ã€ä¸€æµçš„æ´»åŠ¨äººå‘˜ç­‰ç­‰ã€‚è¿™äº›é¢å¤–çš„èµ„æºåœ¨â€œç»è¥ä¸šåŠ¡ &amp;quot; æ–¹é¢æ˜¯éå¸¸å®è´µçš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æå‰è€ƒè™‘æ²»ç†é—®é¢˜&#34;&gt;æå‰è€ƒè™‘æ²»ç†é—®é¢˜&lt;/h3&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-oss-5-year/008i3skNly1guh3vqvywcj60tw0h8go702_hu6ac8b8cc30c17da5f988e9f0241abad9_89600_1c32a376126cb6e7a9bfad870bfb333d.webp 400w,
               /blog/envoy-oss-5-year/008i3skNly1guh3vqvywcj60tw0h8go702_hu6ac8b8cc30c17da5f988e9f0241abad9_89600_42d4ff813d9d979802ac2f0a4330e154.webp 760w,
               /blog/envoy-oss-5-year/008i3skNly1guh3vqvywcj60tw0h8go702_hu6ac8b8cc30c17da5f988e9f0241abad9_89600_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-oss-5-year/008i3skNly1guh3vqvywcj60tw0h8go702_hu6ac8b8cc30c17da5f988e9f0241abad9_89600_1c32a376126cb6e7a9bfad870bfb333d.webp&#34;
               width=&#34;760&#34;
               height=&#34;438&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
å¼€æºæ²»ç†æ˜¯&lt;strong&gt;éå¸¸&lt;/strong&gt;å›°éš¾çš„ã€‚å°±å…¶æœ¬è´¨è€Œè¨€ï¼Œå¼€æ”¾æºä»£ç æ˜¯æ— æ”¿åºœçš„ï¼Œæ²¡æœ‰æ˜ç¡®çš„é¢†å¯¼ç»“æ„ã€‚æ²¡æœ‰ä¸€ä¸ªé€‚åˆæ‰€æœ‰é¡¹ç›®çš„æ²»ç†æ–¹æ³•ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½å¿…é¡»æ‰¾åˆ°è‡ªå·±çš„å‰è¿›æ–¹å‘ï¼Œå¯ä»¥é€šè¿‡â€œBDFLâ€/CEO ç±»å‹çš„æ¨¡å¼ã€æŒ‡å¯¼å§”å‘˜ä¼šã€ç±»ä¼¼ Apache PMC çš„ç¨‹åºç­‰ã€‚æ‰€æœ‰çš„æ²»ç†æ¨¡å¼éƒ½æœ‰ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œå¹¶ä¸”æœ‰ä¸åŒçš„å¤±è´¥æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;æœ€é‡è¦çš„æ˜¯ï¼Œåœ¨é¡¹ç›®å˜å¾—åºå¤§å’ŒæˆåŠŸä¹‹å‰ï¼Œå…ˆè®¤çœŸæ€è€ƒæ²»ç†é—®é¢˜ã€‚å†™ä¸‹ä¸€å¥—è§„åˆ™å’Œè§„èŒƒï¼Œç‰¹åˆ«æ˜¯èŠ±æ—¶é—´è®°å½•é¡¹ç›®çš„å†²çªè§£å†³è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶ä¹Ÿè¦æ„è¯†åˆ°ï¼Œæ ¹æ®æˆ‘åœ¨ä¸Šé¢å…³äºç¤¾åŒºè§„èŒƒå¦‚ä½•åœ¨æ—©æœŸè®¾å®šçš„è¯„è®ºï¼Œæ—©æœŸçš„é¡¹ç›®ç»´æŠ¤è€…å°†å¯¹æ•´ä¸ªå¯¹è¯å’Œå†²çªè§£å†³çš„é£æ ¼äº§ç”Ÿå·¨å¤§çš„å½±å“ï¼Œå°±åƒå…¬å¸çš„æ—©æœŸå‘˜å·¥å¯¹å…¬å¸çš„æ–‡åŒ–äº§ç”Ÿå·¨å¤§çš„å½±å“ä¸€æ ·ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘çš„å°è±¡ä¸­ï¼Œæˆ‘ä»¬åœ¨ Envoy å†…éƒ¨éå¸¸å¹¸è¿ï¼Œæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•é‡å¤§åˆ†æ­§ï¼Œå‡ºç°çš„é—®é¢˜ä¹Ÿå¯ä»¥è¿…é€Ÿå‹å¥½åœ°è§£å†³ã€‚åœ¨é¡¹ç›®çš„å†å²ä¸Šï¼Œæˆ‘ä»¬ä»æ¥æ²¡æœ‰éœ€è¦æ´å¼•&lt;a href=&#34;https://github.com/envoyproxy/envoy/blob/main/GOVERNANCE.md#conflict-resolution-and-voting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç»´æŠ¤è€…æŠ•ç¥¨ç¨‹åºæ¥è§£å†³å†²çª&lt;/a&gt;ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„æˆå°±ï¼Œä¹Ÿæ˜¯å¯¹æ‰€æœ‰ç»´æŠ¤è€…çš„ç´ è´¨å’Œä¸“ä¸šæ€§çš„è¯æ˜ï¼Œå°¤å…¶æ˜¯è€ƒè™‘åˆ°è¯¥é¡¹ç›®å·²ç»å˜å¾—å¦‚æ­¤å—æ¬¢è¿ï¼Œä»¥åŠå›´ç»•å®ƒçš„æ‰€æœ‰å•†ä¸šåˆ©ç›Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯¹å¼€æºè´¡çŒ®çš„æœŸæœ›æ˜¯è‡³å…³é‡è¦çš„&#34;&gt;å¯¹å¼€æºè´¡çŒ®çš„æœŸæœ›æ˜¯è‡³å…³é‡è¦çš„&lt;/h3&gt;
&lt;p&gt;æˆ‘åœ¨ä¸Šé¢æåˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼Œä½†æˆ‘è‡ªå·±çš„èŒä¸šå€¦æ€ å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç”±äºæˆ‘æ²¡æœ‰å¾ˆå¥½åœ°ä¸æˆ‘çš„é›‡ä¸»å°±æˆ‘éœ€è¦èŠ±å¤šå°‘æ—¶é—´æ¥ç®¡ç† Envoy çš„å¼€æºå¢é•¿è®¾å®šåˆç†çš„æœŸæœ›ã€‚æˆ‘ä¸ä¼šæ’’è°è¯´ï¼Œè¿›è¡Œè¿™æ ·çš„å¯¹è¯å°±èƒ½ç¥å¥‡åœ°ä½¿é›‡ä¸»ä¸ºæŸäººè…¾å‡ºå¤§é‡æ—¶é—´æ¥ä»äº‹å¼€æºå·¥ä½œï¼Œç‰¹åˆ«æ˜¯é‚£äº›å¯èƒ½ä¸ç›´æ¥é€‚ç”¨äºå…¶æ—¥å¸¸å·¥ä½œçš„é¡¹ç›®ã€‚è¯è™½å¦‚æ­¤ï¼Œæˆ‘ç¡®ä¿¡å¯¹æ‰€æœ‰å‚ä¸çš„äººæ¥è¯´ï¼Œå¯¹å¼€æºè¿‡ç¨‹æœ‰å…¬å¼€å’Œè¯šå®çš„æœŸæœ›æ˜¯éå¸¸é‡è¦çš„ã€‚ä»¥ä¸‹æ˜¯åœ¨å¼€æºé¡¹ç›®ä¹‹å‰æˆ–å¼€å§‹ä»¥å¼€æºèº«ä»½å·¥ä½œä¹‹å‰è¦é—®çš„åˆç†é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é›‡å‘˜åº”è¯¥é—®ä»–ä»¬çš„é›‡ä¸»ï¼Œä¸ºä»€ä¹ˆä»–ä»¬è¦å¼€æ”¾æºä»£ç ï¼Ÿ&lt;/li&gt;
&lt;li&gt;é›‡ä¸»åº”è¯¥é—®ä»–ä»¬çš„å‘˜å·¥ï¼Œä¸ºä»€ä¹ˆä»–ä»¬è¦å¼€æ”¾æºä»£ç ï¼Ÿ(è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå’Œå‰ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆä¸åŒæ˜¯å®Œå…¨åˆç†çš„ï¼Œä½†åº”è¯¥åœ¨å…¬å¼€åœºåˆè®¨è®º)ã€‚&lt;/li&gt;
&lt;li&gt;é›‡å‘˜åº”è¯¥é—®ä»–ä»¬çš„é›‡ä¸»ï¼Œå¦‚æœé¡¹ç›®æˆåŠŸäº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿè¯¥é¡¹ç›®å°†æœ‰å“ªäº›èµ„æºå¯ç”¨ï¼Ÿå‘˜å·¥å°†æœ‰å¤šå°‘æ—¶é—´å¯ä»¥åœ¨é€šç”¨çš„å¼€æºè½¯ä»¶é—®é¢˜ä¸Šå·¥ä½œï¼Œç›®çš„æ˜¯ç›´æ¥æ¨åŠ¨é¡¹ç›®çš„å‘å±•ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;é›‡ä¸»å’Œé›‡å‘˜ä¹‹é—´ä¸åŒ¹é…çš„æœŸæœ›æ˜¯æœªæ¥æ€¨æ¨å’Œå€¦æ€ çš„æ ¹æœ¬åŸå› ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;ä»£ç†å®¹æ˜“api-éš¾&#34;&gt;ä»£ç†å®¹æ˜“ï¼ŒAPI éš¾&lt;/h3&gt;
&lt;p&gt;å¯¹ä¸€äº›äººæ¥è¯´ï¼ŒEnvoy æä¾›çš„åº•å±‚ç½‘ç»œä»£ç†æœºåˆ¶ä¼¼ä¹æ˜¯è¿™ä¸ªé¡¹ç›®çš„å¤æ‚éƒ¨åˆ†ã€‚äº‹å®è¯æ˜ï¼Œä¸ä¸º Envoy å‘å±•ä¸€ä¸ªç¨³å®šçš„ API ç”Ÿæ€ç³»ç»Ÿæ‰€åšçš„å·¥ä½œç›¸æ¯”ï¼Œä»£ç†éƒ¨åˆ†ï¼ˆåœ¨æˆ‘çœ‹æ¥ï¼‰ç›¸å¯¹ç®€å•ã€‚å¹³è¡¡äººç±»å’Œè®¡ç®—æœºæ¶ˆè´¹çš„ API äººä½“å·¥ç¨‹å­¦ï¼Œä¿æŒä¸åŒç‰ˆæœ¬çš„ç¨³å®šæ€§ï¼Œå‘å±• API ä»¥æ”¯æŒå…¶ä»–å®¢æˆ·ç«¯ï¼Œå¦‚ gRPCï¼ŒæŒ‡å®šåè®®è¯­ä¹‰ä»¥ä½¿ Envoy èƒ½å¤Ÿä¸æ•°ç™¾ï¼ˆå¯èƒ½æ˜¯æ•°åƒï¼‰ä¸ªä¸åŒçš„ç®¡ç†æœåŠ¡å™¨å¯¹è¯ï¼Œç­‰ç­‰ï¼Œéƒ½æ˜¯éå¸¸å¤æ‚çš„ã€‚æˆ‘ä¸ºå›¢é˜Ÿåœ¨è¿™ä¸€é¢†åŸŸå–å¾—çš„æˆå°±æ„Ÿåˆ°éª„å‚²ï¼ˆç‰¹åˆ«è¦æ„Ÿè°¢æ¨åŠ¨è¿™ä¸€å·¥ä½œçš„ Harveyï¼‰ï¼Œå³ä½¿åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€äº›é”™è¯¯ï¼ˆæ¯”å¦‚ä» API çš„ V2 ç‰ˆæœ¬å¼ºåˆ¶è¿ç§»åˆ° V3 ç‰ˆæœ¬ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªè½¯ä»¶æä¾›äº†ä¸€ä¸ª APIï¼Œè€Œä¸”æ›´é‡è¦çš„æ˜¯å¸Œæœ›è¿™ä¸ª API æˆä¸ºå…¶ä»–ç³»ç»Ÿçš„å…³é”®ç»„ä»¶ï¼Œé‚£ä¹ˆä¸è¦ä½ä¼°æä¾›ä¸€ä¸ªç¨³å®šå’Œç¬¦åˆäººä½“å·¥ç¨‹å­¦çš„ API çš„æˆæœ¬å’Œå¤æ‚æ€§ã€‚åè¿‡æ¥è¯´ï¼Œ&lt;strong&gt;å¼ºå¤§çš„ API æ˜¯ä¸€ä¸ªç”Ÿæ€ç³»ç»Ÿé£è½®çš„é‡è¦ç»„æˆéƒ¨åˆ†&lt;/strong&gt;ï¼Œä¼šä»¥æ­¤äº§ç”Ÿæ›´å¤šçš„äº§å“å’Œç”¨æˆ·ï¼Œæ‰€ä»¥åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™äº›åŠªåŠ›æ˜¯éå¸¸å€¼å¾—çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸è¦å¿½è§†èŒä¸šå€¦æ€ &#34;&gt;ä¸è¦å¿½è§†èŒä¸šå€¦æ€ &lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å¦‚æœä¸€ä¸ªäººæƒ³æˆå°±å¤§äº‹ä¸šï¼Œæˆ‘ä¸ç›¸ä¿¡ä»–å¯ä»¥ 100% å®ç°è‰¯å¥½çš„å·¥ä½œç”Ÿæ´»å¹³è¡¡&lt;/strong&gt;ã€‚ç°å®æƒ…å†µæ˜¯ï¼Œä»»ä½•æˆåŠŸéƒ½æ˜¯ç”±ç°æœ‰çš„ç‰¹æƒ / æœºä¼šã€ä¸€ä¸ªå¥½çš„æƒ³æ³•ã€è‰¯å¥½çš„æ‰§è¡ŒåŠ›å’Œå¤§é‡çš„è¿æ°”ï¼ˆåŒ…æ‹¬åœ¨æ­£ç¡®çš„æ—¶é—´å‡ºç°åœ¨æ­£ç¡®çš„åœ°ç‚¹ï¼‰ç»„æˆçš„ã€‚æ‰€æœ‰è¿™äº›ä¸œè¥¿éƒ½åœ¨ Envoy ä¸­å‘æŒ¥ä½œç”¨ï¼Œæˆ‘ä¸ä¼šå‡è£…æˆ‘æ²¡æœ‰æŠŠè‡ªå·±æå¾—å¾ˆç´¯ï¼Œç‰¹åˆ«æ˜¯åœ¨ 2017 å¹´ã€‚æˆ‘ä¹Ÿä¼šé‡æ–°åšä¸€é 2017 å¹´çš„å·¥ä½œï¼Œå› ä¸ºä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘åšäº†æˆ‘å¿…é¡»åšçš„äº‹æƒ…ï¼Œä½¿é¡¹ç›®è·å¾—æˆåŠŸã€‚(æœ‰æ—¶æˆ‘æƒ³ï¼Œå¦‚æœæˆ‘å·²ç»æœ‰äº†å­©å­ï¼ŒEnvoy æ˜¯å¦è¿˜ä¼šè¯ç”Ÿã€‚æˆ‘ä¸ç¡®å®šå®ƒæ˜¯å¦ä¼šå‘ç”Ÿï¼Œä½†è¿™æ˜¯ä¸€ä¸ªæ›´é•¿çš„è°ˆè¯ä¸»é¢˜ï¼)&lt;/p&gt;
&lt;p&gt;ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘åœ¨ 2017 å¹´æè¿°çš„é‚£ç§å²è¯—èˆ¬çš„æ¨åŠ¨åŠ›åªèƒ½æŒç»­è¿™ä¹ˆä¹…ï¼Œç›´åˆ°ä¸€ä¸ªäººå´©æºƒã€‚æˆ‘é¼“åŠ±å¤§å®¶ä¸æ–­åæ€è‡ªå·±çš„å·¥ä½œç”Ÿæ´»å¹³è¡¡ï¼Œå¹¶ä¸ºè‡ªå·±æ‰¾å‡ºä¸€æ¡å¯æŒç»­å‘å±•çš„é“è·¯ã€‚æ¯ä¸ªäººçš„æƒ…å†µéƒ½ä¸åŒï¼Œæˆ‘ä¸èƒ½æä¾›ä»»ä½•ä¸€ä¸ªé¿å…èŒä¸šå€¦æ€ çš„å»ºè®®ï¼Œä½†æˆ‘è®¤ä¸ºåæ€æ˜¯ä¸€ä¸ªå¥½çš„å¼€å§‹ï¼Œä¹Ÿæ˜¯æˆ‘è‡ªå·±ä¸å¾—ä¸åŠªåŠ›çš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ„Ÿè°¢&#34;&gt;æ„Ÿè°¢&lt;/h2&gt;
&lt;p&gt;åœ¨è¿‡å» 6 å¹´åŠçš„æ—¶é—´é‡Œï¼Œåœ¨ Envoy ä¸Šå·¥ä½œï¼Œå…¶ä¸­ 5 å¹´æ˜¯ä½œä¸ºå¼€æºè½¯ä»¶ï¼Œè¿™æ˜¯æˆ‘èŒä¸šç”Ÿæ¶¯ä¸­çš„äº®ç‚¹ã€‚è¿™ä¸ªé¡¹ç›®çš„æˆåŠŸç¡®å®æ˜¯ä¸€ä¸ªå›¢é˜Ÿçš„åŠªåŠ›ï¼Œæˆ‘ä¸€ä¸ªäººæ˜¯ä¸å¯èƒ½å®Œæˆçš„ï¼Œæˆ‘ä¸ºæˆ‘ä»¬æ‰€æœ‰äººï¼ˆç»´æŠ¤è€…ã€è´¡çŒ®è€…å’Œç”¨æˆ·ï¼‰å…±åŒå®Œæˆçš„äº‹æƒ…æ„Ÿåˆ°éå¸¸è‡ªè±ªã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸Šå·¥ä½œçš„ç»´æŠ¤è€…å’Œè´¡çŒ®è€…æ˜¯æˆ‘æ‰€å…±äº‹è¿‡çš„æœ€å¥½çš„å·¥ç¨‹å¸ˆç¾¤ä½“ï¼Œä»–ä»¬æ‰åæ¨ªæº¢ï¼Œä»–ä»¬å°±èŒåœ¨ä¸åŒå…¬å¸ï¼Œä½äºä¸åŒçš„åœ°ç†ä½ç½®ï¼Œè¿™çœŸæ˜¯å¼€æºçš„ç†è®ºæ½œåŠ›åœ¨å®è·µä¸­çš„ä½“ç°ã€‚ä½œä¸ºä¸€ä¸ªå›¢é˜Ÿï¼Œæˆ‘ä»¬å·²ç»äº§ç”Ÿäº†ä¸–ç•Œæ€§çš„å½±å“ï¼Œæ”¹å˜äº†ç”¨æˆ·å¯¹è½¯ä»¶è´Ÿè½½å‡è¡¡ç³»ç»Ÿçš„æœŸæœ›ï¼ŒåŒæ—¶ä¹Ÿå»ºç«‹äº†ä¸€ä¸ªå……æ»¡æ´»åŠ›å’Œçƒ­æƒ…çš„ç¤¾åŒºã€‚åœ¨æˆ‘æœ€ç–¯ç‹‚çš„æ¢¦æƒ³ä¸­ï¼Œæˆ‘ä»æœªæƒ³è¿‡è¿™ä¸ªé¡¹ç›®ä¼šæˆä¸ºä»Šå¤©çš„æ ·å­ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹æˆ‘æ¥è¯´ï¼Œæœªæ¥ä¼šå‘ç”Ÿä»€ä¹ˆå°±ä¸é‚£ä¹ˆæ¸…æ¥šäº†ã€‚æ­£å¦‚æˆ‘ä¸Šé¢æ‰€è¯´çš„ï¼Œæˆ‘çš„é‡ç‚¹å·²ç»è½¬ç§»åˆ°äº†å¯æŒç»­æ€§ä¸Šã€‚æˆ‘æƒ³ç¡®ä¿ï¼Œå¦‚æœæœ‰ä¸€å¤©æˆ‘ç¦»å¼€äº†ï¼Œè¿™ä¸ªé¡¹ç›®å°†ä¿æŒå¥åº·ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™ä¸€å¤©è¿˜æ²¡æœ‰åˆ°æ¥ï¼Œæˆ‘æœŸå¾…ç€åœ¨å¯é¢„è§çš„æœªæ¥å¸®åŠ©é¢†å¯¼é¡¹ç›®å‰è¿›ï¼Œå¸Œæœ›èƒ½å–å¾—æ›´å¤§çš„æˆåŠŸå’Œé‡‡ç”¨ã€‚å‘å‰è¿ˆè¿›ï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨åŸºäº WebAssembly çš„ GetEnvoy å·¥å…·åŒ…æ‰©å±• Envoy</title>
      <link>https://cloudnative.to/blog/introducing-getenvoy-extension-toolkit-for-webassembly-based-envoy-extensions/</link>
      <pubDate>Wed, 21 Apr 2021 10:03:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/introducing-getenvoy-extension-toolkit-for-webassembly-based-envoy-extensions/</guid>
      <description>&lt;p&gt;è¯´ä¸€è¯´æ¥é¾™å»è„‰ï¼ŒEnvoy æ˜¯ä¸€ä¸ªéå¸¸æ³¨é‡è§„æ¨¡åŒ–ä¸šåŠ¡çš„åº•å±‚ç½‘ç»œç»„ä»¶ï¼Œä»¤äººæ¿€åŠ¨ä¸”åŠŸèƒ½å¼ºå¤§ã€‚ç„¶è€Œå®ƒåœ¨ç”¨æˆ·ä½“éªŒæ–¹é¢ä¸€ç›´å¾ˆæ¬ ç¼ºã€‚&lt;/p&gt;
&lt;p&gt;å½“ç”¨æˆ·å¼€å§‹ä½¿ç”¨ä¸€ä¸ªæ–°å·¥å…·æ—¶ï¼Œå¿…ç„¶ä¼šä»â€œå¦‚ä½•åœ¨è‡ªå·±çš„ç¯å¢ƒä¸­å®‰è£…â€è¿™ä¸€é—®é¢˜å¼€å§‹ã€‚è€Œ Envoy ä¹‹å‰å¹¶æ²¡æœ‰ç»™å‡ºç­”æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¡«è¡¥è¿™ä¸€ç©ºç™½ï¼ŒTetrate &lt;a href=&#34;https://www.getenvoy.io/blog/announcing-the-getenvoy-project/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯åŠ¨äº†&lt;/a&gt; GetEnvoy é¡¹ç›®å¹¶ä¸” &lt;a href=&#34;https://www.getenvoy.io/blog/introducing-the-getenvoy-cli/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ¨å‡ºäº†&lt;/a&gt; getenvoy CLIï¼Œä½œä¸ºæä¾›ç»™ç”¨æˆ·çš„ç»„ä»¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ–°æŒ‘æˆ˜&#34;&gt;æ–°æŒ‘æˆ˜&lt;/h3&gt;
&lt;p&gt;ä¸‹ä¸€ä¸ªå…³äº Envoy çš„å¸¸è§éœ€æ±‚æ˜¯â€œå¦‚ä½•æ‰©å±•â€ã€‚&lt;/p&gt;
&lt;p&gt;æˆªæ­¢ç›®å‰ï¼Œå¦‚æœæƒ³æ‰©å±•æˆ–å®šåˆ¶ Envoyï¼Œä½ å°†ä¸å¾—ä¸â€œè¶Šç•Œâ€æˆä¸ºå®è´¨ä¸Šçš„ Envoy å¼€å‘è€…ã€‚&lt;/p&gt;
&lt;p&gt;å¹¸è¿çš„æ˜¯ï¼Œè¿™ç§æƒ…å†µå³å°†æ”¹å˜ã€‚ä¸€ç§åä¸º &lt;a href=&#34;https://webassembly.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WebAssemblyï¼ˆWasmï¼‰&lt;/a&gt; çš„æ–°æŠ€æœ¯å³å°†çº³å…¥ Envoyã€‚Wasm è®©ä½¿ç”¨ä¸åŒç¼–ç¨‹è¯­è¨€å¼€å‘ Envoy æ‰©å±•æˆä¸ºå¯èƒ½ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œèƒ½ä»¥å®Œå…¨åŠ¨æ€çš„æ–¹å¼éƒ¨ç½²è¿™äº›æ‰©å±•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;getenvoy-æ‰©å±•å·¥å…·åŒ…&#34;&gt;GetEnvoy æ‰©å±•å·¥å…·åŒ…&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://www.getenvoy.io/reference/getenvoy_extension_toolkit_reference/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GetEnvoy æ‰©å±•å·¥å…·åŒ…&lt;/a&gt; çš„ç›®çš„åœ¨äºå¸®åŠ©æœ‰æ‰©å±• Envoy éœ€æ±‚çš„å¼€å‘è€…ï¼Œåœ¨çŸ­æ—¶é—´å†…å®Œæˆæ‰©å±•å¼€å‘å¹¶å¯åŠ¨è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä½œä¸ºå¼€å‘è€…ï¼Œä½ å¾ˆå¯èƒ½æƒ³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»å·¥ä½œä¸­çš„å…¸å‹ç¤ºä¾‹å…¥æ‰‹&lt;/li&gt;
&lt;li&gt;ä»å¼€å§‹å°±å»ºç«‹æœ‰æ•ˆçš„å¼€å‘å·¥ä½œæµ&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨æœ€ä½³å®è·µï¼Œè‡ªåŠ¨é¿å…å¸¸è§é™·é˜±&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;GetEnvoy æ‰©å±•å·¥å…·åŒ…å°†å¸®åŠ©æ‚¨è§£å†³ä»¥ä¸Šæ‰€æœ‰é—®é¢˜ï¼&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-rust-åˆ›å»º-envoy-http-filter&#34;&gt;ä½¿ç”¨ Rust åˆ›å»º Envoy HTTP Filter&lt;/h3&gt;
&lt;p&gt;è®©æˆ‘ä»¬ä½¿ç”¨ Rust å¼€å‘ä¸€ä¸ª Envoy HTTP Filter æ¥è¯•è¯• GetEnvoy æ‰©å±•å·¥å…·åŒ…å§ï¼&lt;/p&gt;
&lt;h4 id=&#34;1-å‰ç½®è¦æ±‚&#34;&gt;1. å‰ç½®è¦æ±‚&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://www.getenvoy.io/install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£…&lt;/a&gt; getenvoy CLIï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl -L https://getenvoy.io/cli &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; bash -s -- -b /usr/local/bin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://docs.docker.com/engine/install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£…&lt;/a&gt; Dockerã€‚&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥&lt;/p&gt;
&lt;p&gt;è¿è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ getenvoy --version
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;getenvoy version 0.2.0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker --version
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Docker version 19.03.8, build afacb8b
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;2-å®‰è£…æ–°çš„-http-filter-æ‰©å±•åŒ…çš„è„šæ‰‹æ¶&#34;&gt;2. å®‰è£…æ–°çš„ HTTP Filter æ‰©å±•åŒ…çš„è„šæ‰‹æ¶&lt;/h4&gt;
&lt;p&gt;å¦‚æœæƒ³åœ¨äº¤äº’æ¨¡å¼ä¸‹æ„å»ºä¸€ä¸ªæ–°æ‰©å±•ï¼Œè¿è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ getenvoy extension init
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤å¤–ï¼Œå¦‚æœæƒ³è·³è¿‡å‘å¯¼ï¼Œéœ€è¦åœ¨å‘½ä»¤è¡Œæä¾›å‚æ•°ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ getenvoy extension init &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --category envoy.filters.http &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --language rust &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --name me.filters.http.my_http_filter &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    my_http_filter 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ£€æŸ¥&lt;/p&gt;
&lt;p&gt;è¿è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ tree -a my_http_filter
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my_http_filter
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ .cargo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â””â”€â”€ config
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ .getenvoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â””â”€â”€ extension
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚       â””â”€â”€ extension.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ .gitignore
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ Cargo.toml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ README.md
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ src
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ config.rs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ factory.rs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ filter.rs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ lib.rs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â””â”€â”€ stats.rs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ wasm
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    â””â”€â”€ module
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        â”œâ”€â”€ Cargo.toml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        â””â”€â”€ src
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            â””â”€â”€ lib.rs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;3-æ„å»ºæ‰©å±•&#34;&gt;3. æ„å»ºæ‰©å±•&lt;/h4&gt;
&lt;p&gt;è¿è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ getenvoy extension build
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Updating crates.io index
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Downloaded envoy-sdk v0.1.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Compiling envoy-sdk v0.1.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Finished dev &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;unoptimized + debuginfo&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; target &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;s&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; in 23.57s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Copying *.wasm file to &lt;span class=&#34;s1&#34;&gt;&amp;#39;target/getenvoy/extension.wasm&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ£€æŸ¥&lt;/p&gt;
&lt;p&gt;è¿è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ tree target/getenvoy/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target/getenvoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ extension.wasm
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;4-è¿è¡Œå•å…ƒæµ‹è¯•&#34;&gt;4. è¿è¡Œå•å…ƒæµ‹è¯•&lt;/h4&gt;
&lt;p&gt;è¿è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ getenvoy extension &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ£€æŸ¥&lt;/p&gt;
&lt;p&gt;åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;running &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt; tests::should_initialize ... ok
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt; result: ok. &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; passed&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; failed&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; ignored&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; measured&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; filtered out
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;5-åœ¨-envoy-ä¸­è¿è¡Œæ‰©å±•&#34;&gt;5. åœ¨ Envoy ä¸­è¿è¡Œæ‰©å±•&lt;/h4&gt;
&lt;p&gt;è®©æˆ‘ä»¬ç”¨è¾ƒå›°éš¾çš„æ–¹å¼å®Œæˆè¿™éƒ¨åˆ†å·¥ä½œã€‚ä¸å…¶ä½¿ç”¨ä¸€æ¡ç®€å•çš„è‡ªåŠ¨åŒ–å‘½ä»¤ï¼Œä¸å¦‚æ‰‹åŠ¨å®Œæˆæ¯ä¸€æ­¥ã€‚&lt;/p&gt;
&lt;h5 id=&#34;1-ä¸‹è½½-envoy-äºŒè¿›åˆ¶æ–‡ä»¶&#34;&gt;1. ä¸‹è½½ Envoy äºŒè¿›åˆ¶æ–‡ä»¶&lt;/h5&gt;
&lt;p&gt;éœ€è¦å»ä¸‹è½½å’Œæ‰©å±•å¼€å‘ç‰ˆæœ¬ç›¸åŒçš„ Envoy&lt;/p&gt;
&lt;p&gt;è¿è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat .getenvoy/extension/extension.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â€¦
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Runtime the extension is being developed against.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;runtime:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  envoy:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    version: wasm:1.15
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†ä¸‹è½½è¯¥ç‰ˆæœ¬çš„ Envoyï¼Œè¿è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ getenvoy fetch wasm:1.15
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fetching wasm:1.15/darwin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Fetching Envoy&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; 100%
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;2-åˆ›å»ºä¸€ä¸ªç¤ºä¾‹-envoy-é…ç½®&#34;&gt;2. åˆ›å»ºä¸€ä¸ªç¤ºä¾‹ Envoy é…ç½®&lt;/h5&gt;
&lt;p&gt;è¿è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ getenvoy extension examples add
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ£€æŸ¥ä¸€ä¸‹ï¼Œè¿è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ tree .getenvoy/extension/examples
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;.getenvoy/extension/examples
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”œâ”€â”€ README.md
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”œâ”€â”€ envoy.tmpl.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”œâ”€â”€ example.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â””â”€â”€ extension.json
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;3-é€šè¿‡æŸ¥çœ‹-readmemd-æ–‡ä»¶äº†è§£æ›´å¤šå…³äºç¤ºä¾‹é…ç½®çš„ä¿¡æ¯&#34;&gt;3. é€šè¿‡æŸ¥çœ‹ README.md æ–‡ä»¶äº†è§£æ›´å¤šå…³äºç¤ºä¾‹é…ç½®çš„ä¿¡æ¯&lt;/h5&gt;
&lt;h5 id=&#34;4-å¿«é€Ÿæµè§ˆç¤ºä¾‹-envoy-é…ç½®&#34;&gt;4. å¿«é€Ÿæµè§ˆç¤ºä¾‹ Envoy é…ç½®&lt;/h5&gt;
&lt;p&gt;è¿è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$  cat .getenvoy/extension/examples/default/envoy.tmpl.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.filters.http.wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configuration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{{&lt;span class=&#34;l&#34;&gt;.GetEnvoy.Extension.Config}}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{{&lt;span class=&#34;l&#34;&gt;.GetEnvoy.Extension.Name}}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;root_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{{&lt;span class=&#34;l&#34;&gt;.GetEnvoy.Extension.Name}}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vm_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{{&lt;span class=&#34;l&#34;&gt;.GetEnvoy.Extension.Name}}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.wasm.runtime.v8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{{&lt;span class=&#34;l&#34;&gt;.GetEnvoy.Extension.Code}}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.filters.http.router&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„ï¼Œç¤ºä¾‹ Envoy é…ç½®ä¸­åŒ…å«äº†å ä½ç¬¦ {{â€¦}}ï¼Œè¿™äº›å ä½ç¬¦ä¼šç”± getenvoy CLI è§£å†³ã€‚&lt;/p&gt;
&lt;h5 id=&#34;5-ä½¿ç”¨è¯¥ç¤ºä¾‹é…ç½®å¯åŠ¨-envoy&#34;&gt;5. ä½¿ç”¨è¯¥ç¤ºä¾‹é…ç½®å¯åŠ¨ Envoy&lt;/h5&gt;
&lt;p&gt;è¿è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ getenvoy extension run
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;info Envoy command: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$HOME&lt;/span&gt;/.getenvoy/builds/wasm/1.15/darwin/bin/envoy -c /tmp/getenvoy_extension_run732371719/envoy.tmpl.yaml&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;info&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;main&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;external/envoy/source/server/server.cc:339&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; admin address: 127.0.0.1:9901
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;info&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;config&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;external/envoy/source/server/listener_manager_impl.cc:700&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; all dependencies initialized. starting workers
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;info&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;main&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;external/envoy/source/server/server.cc:575&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; starting main dispatch loop
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶ Envoy å·²å¯åŠ¨ï¼Œæ‰©å±•ä¹Ÿå¯ä»¥ä½¿ç”¨äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æµ‹è¯• HTTP Filter æ‰©å±•ï¼Œè¿è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl -i http://0.0.0.0:10000
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ Envoy çš„è¾“å‡ºä¸­ï¼Œåº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my_http_filter: &lt;span class=&#34;c1&#34;&gt;#2 new http exchange starts at 2020-07-01T18:22:51.623813+00:00 with config:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my_http_filter: &lt;span class=&#34;c1&#34;&gt;#2 observing request headers&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my_http_filter: &lt;span class=&#34;c1&#34;&gt;#2 -&amp;gt; :authority: 0.0.0.0:10000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my_http_filter: &lt;span class=&#34;c1&#34;&gt;#2 -&amp;gt; :path: /&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my_http_filter: &lt;span class=&#34;c1&#34;&gt;#2 -&amp;gt; :method: GET&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my_http_filter: &lt;span class=&#34;c1&#34;&gt;#2 -&amp;gt; user-agent: curl/7.64.1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my_http_filter: &lt;span class=&#34;c1&#34;&gt;#2 -&amp;gt; accept: */*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my_http_filter: &lt;span class=&#34;c1&#34;&gt;#2 -&amp;gt; x-forwarded-proto: http&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my_http_filter: &lt;span class=&#34;c1&#34;&gt;#2 -&amp;gt; x-request-id: 8902ca62-75a7-40e7-9b2e-cd7dc983b091&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my_http_filter: &lt;span class=&#34;c1&#34;&gt;#2 http exchange complete&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”±äºç°åœ¨ä½ çŸ¥é“äº†è¿è¡Œæ‰©å±•çš„èƒŒåéƒ½å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä¸‹æ¬¡å°±å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤ç®€å•å¯åŠ¨æ‰©å±•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ getenvoy extension run
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;å¢åŠ ä¸€ä¸ªæ–°ç‰¹æ€§&#34;&gt;å¢åŠ ä¸€ä¸ªæ–°ç‰¹æ€§&lt;/h4&gt;
&lt;p&gt;è®©æˆ‘ä»¬ä¸ºæ‰©å±•æ·»åŠ ä¸€ä¸ªæ–°ç‰¹æ€§ï¼šåœ¨ä»£ç†çš„ HTTP å“åº”ä¸­æ³¨å…¥ä¸€ä¸ªé¢å¤–çš„æ ‡å¤´ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæ›´æ–°æ‰©å±•é…ç½®ä»¥ä¿å­˜æ³¨å…¥çš„æ ‡å¤´çš„åç§°ï¼ˆæ·»åŠ çš„è¡Œåæ·»åŠ äº†æ³¨é‡Šï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨ src/config.rs æ–‡ä»¶ä¸­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;/// Configuration for a Sample HTTP Filter.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#[derive (Debug, Default, Deserialize)]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;SampleHttpFilterConfig&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#[serde (default)]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#[serde(default)]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;response_header_name&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// æ·»åŠ çš„ä»£ç 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ç€ï¼Œæ·»åŠ  on_response_headers æ–¹æ³•åˆ° SampleHttpFilter ä¸­ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨ src/filter.rs æ–‡ä»¶ä¸­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;/// Called when HTTP response headers have been received. å½“ HTTP å“åº”å¤´è¢«æ¥æ”¶æ—¶è°ƒç”¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;///
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;/// Use `filter_ops` to access and mutate response headers. ä½¿ç”¨ filter_ops è®¿é—®å’Œå˜å¼‚å“åº”å¤´
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;on_response_headers&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;mut&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_num_headers&lt;/span&gt;: &lt;span class=&#34;kt&#34;&gt;usize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_end_of_stream&lt;/span&gt;: &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filter_ops&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;dyn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;ResponseHeadersOps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;-&amp;gt; &lt;span class=&#34;nb&#34;&gt;Result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;response_header_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_empty&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filter_ops&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;set_response_header&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;response_header_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;injected by WebAssembly extension&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Ok&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åï¼Œåœ¨é»˜è®¤çš„ç¤ºä¾‹è®¾ç½®ä¸­æ›´æ–°æ‰©å±•é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;code&gt;.getenvoy/extension/examples/default/extension.json&lt;/code&gt; æ–‡ä»¶ä¸­&lt;/p&gt;
&lt;p&gt;&lt;code&gt;{&amp;quot;response_header_name&amp;quot;:&amp;quot;my-header&amp;quot;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç¡®è®¤å˜æ›´ï¼Œé‡å¯ç¤ºä¾‹è®¾ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ getenvoy extension run
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‘å‡ºä»¥ä¸‹ç¤ºä¾‹è¯·æ±‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl -i localhost:10000
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä¸‹é¢çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;22&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: text/plain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Tue, &lt;span class=&#34;m&#34;&gt;07&lt;/span&gt; Jul &lt;span class=&#34;m&#34;&gt;2020&lt;/span&gt; 18:36:23 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my-header: injected by WebAssembly extension
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Hi from mock service!
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„åˆ°ä¸€æ¡é¢å¤–çš„æ ‡å¤´è¢«æ³¨å…¥åˆ°å“åº”ä¸­ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å¢åŠ ä¸€ä¸ªæ–°æŒ‡æ ‡&#34;&gt;å¢åŠ ä¸€ä¸ªæ–°æŒ‡æ ‡&lt;/h4&gt;
&lt;p&gt;Envoy å¤§åŠ›æ”¯æŒå¯¹æ–°è¡Œä¸ºçš„å¯è§‚å¯Ÿæ€§ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ›´æ–°æ‰©å±•ä»¥æš´éœ²å…³äºå…¶æ–°è¡Œä¸ºçš„åº¦é‡ã€‚å…·ä½“æ¥è¯´ï¼Œæä¾›ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ˜¾ç¤ºè¢«é¢å¤–çš„æ ‡å¤´æ³¨å…¥äº†çš„ HTTP å“åº”çš„æ•°é‡ã€‚&lt;/p&gt;
&lt;p&gt;ç¼–è¾‘æºç å¦‚ä¸‹ï¼ˆæ·»åŠ çš„è¡ŒååŠ å…¥äº†æ³¨é‡Šï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨ src/stats.rs æ–‡ä»¶ä¸­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;use&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;envoy&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;host&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;Counter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;/// Sample stats.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;SampleHttpFilterStats&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;requests_total&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;Box&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;dyn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;responses_injected_total&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;Box&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;dyn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//added code æ–°å¢è¡Œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;impl&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SampleHttpFilterStats&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;requests_total&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;Box&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;dyn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;responses_injected_total&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;Box&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;dyn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//added code æ–°å¢è¡Œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;-&amp;gt; &lt;span class=&#34;nc&#34;&gt;Self&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SampleHttpFilterStats&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;requests_total&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;responses_injected_total&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//added code æ–°å¢è¡Œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;requests_total&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;-&amp;gt; &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;dyn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Counter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;*&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;requests_total&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;responses_injected_total&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;-&amp;gt; &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;dyn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Counter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//added code æ–°å¢è¡Œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;*&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;responses_injected_total&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ src/factory.rs ä¸­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;/// Creates a new factory.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;pub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;clock&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;dyn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Clock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;dyn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Stats&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;-&amp;gt; &lt;span class=&#34;nb&#34;&gt;Result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;Self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SampleHttpFilterStats&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;examples.http_filter.requests_total&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;examples.http_filter.responses_injected_total&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//added code æ–°å¢è¡Œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Inject dependencies on Envoy host APIs
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Ok&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SampleHttpFilterFactory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;Rc&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SampleHttpFilterConfig&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;Rc&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;clock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ src/filter.rs ä¸­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;/// Called when HTTP response headers have been received.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;///
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;/// Use `filter_ops` to access and mutate response headers.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;on_response_headers&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;mut&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_num_headers&lt;/span&gt;: &lt;span class=&#34;kt&#34;&gt;usize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_end_of_stream&lt;/span&gt;: &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filter_ops&lt;/span&gt;: &lt;span class=&#34;kp&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nc&#34;&gt;dyn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;ResponseHeadersOps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;-&amp;gt; &lt;span class=&#34;nb&#34;&gt;Result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;response_header_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_empty&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filter_ops&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;set_response_header&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;response_header_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;injected by WebAssembly extension&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;responses_injected_total&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//added code
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Ok&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ£€æŸ¥&lt;/p&gt;
&lt;p&gt;é‡å¯ç¤ºä¾‹è®¾ç½®ï¼Œå‘å‡ºç¤ºä¾‹è¯·æ±‚å¹¶æ£€æŸ¥ Envoy çš„æŒ‡æ ‡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$ getenvoy extension run&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl -i localhost:10000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl -i localhost:10000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl -s localhost:9901/stats &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep responses_injected_total
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;examples.http_filter.responses_injected_total: 2
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬å¯¹ä½¿ç”¨ &lt;a href=&#34;https://www.getenvoy.io/reference/getenvoy_extension_toolkit_reference/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GetEnvoy æ‰©å±•å·¥å…·åŒ…&lt;/a&gt; çš„å¼€å‘æµç¨‹çš„ç®€å•ä»‹ç»åˆ°æ­¤ç»“æŸã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç»“æŸè¯­&#34;&gt;ç»“æŸè¯­&lt;/h3&gt;
&lt;p&gt;ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å±•ç¤ºäº†ä½¿ç”¨ GetEnvoy å¼€å‘ Envoy æ‰©å±•æ˜¯å¤šä¹ˆå®¹æ˜“ã€‚&lt;/p&gt;
&lt;p&gt;ç»“åˆ &lt;a href=&#34;https://www.getenvoy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;getenvoy CLI&lt;/a&gt; çš„ä¾¿åˆ©å’Œ &lt;a href=&#34;https://docs.rs/envoy-sdk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Rust SDK&lt;/a&gt; çš„æŒ‡å¼•ï¼Œä½ å¯ä»¥è½»æ¾èƒœä»»è¿™äº›å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†ä¸Šé¢æ¼”ç¤ºçš„ &lt;a href=&#34;https://docs.rs/envoy-sdk/0.1.0/envoy_sdk/extension/filter/http/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP Filter&lt;/a&gt; æ‰©å±•å¤–ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨è¯¥å·¥å…·åŒ…å¼€å‘å…¶ä»–ç±»å‹çš„ Envoy æ‰©å±•ï¼Œæ¯”å¦‚ &lt;a href=&#34;https://docs.rs/envoy-sdk/0.1.0/envoy_sdk/extension/filter/network/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Network Filter&lt;/a&gt; å’Œ &lt;a href=&#34;https://docs.rs/envoy-sdk/0.1.0/envoy_sdk/extension/access_logger/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Access Logger&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœªæ¥è®¡åˆ’&#34;&gt;æœªæ¥è®¡åˆ’&lt;/h3&gt;
&lt;p&gt;åœ¨æœªæ¥çš„å‡ ä¸ªæœˆé‡Œï¼Œæˆ‘ä»¬å°†ä¸º GetEnvoy æ·»åŠ ä¸€äº›æ–°ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å°†æŠŠé‡ç‚¹è½¬ç§»åˆ°æ‰©å±•ç”¨æˆ·ä½“éªŒä¸Šï¼Œä¸ºç”¨æˆ·æä¾›èƒ½å¤Ÿè½»æ¾å‘ç°å’Œä½¿ç”¨æ‰©å±•çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ”¹å–„å¼€å‘è€…æµç¨‹çš„ç”¨æˆ·ä½“éªŒã€‚å¯¹æ›´å¤šç¼–ç¨‹è¯­è¨€å’Œæ›´å¤šæ‰©å±•ç±»å‹çš„æ”¯æŒå°†ä¼šåˆ°æ¥ã€‚&lt;/p&gt;
&lt;p&gt;æ•¬è¯·å…³æ³¨ GetEnvoy çš„è¿›ä¸€æ­¥æ›´æ–°ï¼è¯·ä¸æˆ‘ä»¬åˆ†äº«ä½ åœ¨ Rust ä¸­çš„ Envoy æ‰©å±•ï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>äº‘åŸç”Ÿç¤¾åŒº meetup ç¬¬ä¸‰æœŸæ­å·ç«™</title>
      <link>https://cloudnative.to/event/cloud-native-meetup-hangzhou-03/</link>
      <pubDate>Sat, 17 Apr 2021 13:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/event/cloud-native-meetup-hangzhou-03/</guid>
      <description>&lt;h3 id=&#34;å¼€åœºè‡´è¾&#34;&gt;å¼€åœºè‡´è¾&lt;/h3&gt;
&lt;p&gt;è®²å¸ˆï¼šå®‹å‡€è¶…ï¼ˆTetrate å¸ƒé“å¸ˆã€äº‘åŸç”Ÿç¤¾åŒºåˆ›å§‹äººï¼‰&lt;/p&gt;
&lt;p&gt;è®²å¸ˆä»‹ç»ï¼šTetrate äº‘åŸç”Ÿå¸ƒé“å¸ˆï¼Œäº‘åŸç”Ÿç¤¾åŒºåˆ›å§‹äººï¼ŒCNCF Ambassadorã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-chaos-mesh-æ¥ä¿éšœäº‘åŸç”Ÿç³»ç»Ÿçš„å¥å£®æ€§&#34;&gt;ä½¿ç”¨ Chaos Mesh æ¥ä¿éšœäº‘åŸç”Ÿç³»ç»Ÿçš„å¥å£®æ€§&lt;/h3&gt;
&lt;p&gt;è®²å¸ˆï¼šå‘¨å¼º&lt;/p&gt;
&lt;p&gt;å…¬å¸ï¼šPingCAP&lt;/p&gt;
&lt;p&gt;è®²å¸ˆä»‹ç»ï¼šå‘¨å¼ºï¼ŒPingCAP å·¥ç¨‹æ•ˆç‡è´Ÿè´£äººï¼ŒChaos Mesh è´Ÿè´£äººï¼Œä¸“æ³¨ç¨³å®šæ€§å’Œæ€§èƒ½æµ‹è¯•å¹³å°ã€‚åœ¨æ··æ²Œå·¥ç¨‹é¢†åŸŸæœ‰ 4 å¹´çš„ä»ä¸šç»éªŒï¼Œé¢†å¯¼å¼€å‘äº‘åŸç”Ÿæ··æ²Œæµ‹è¯•å¹³å° Chaos Meshã€‚&lt;/p&gt;
&lt;p&gt;æ¼”è®²æ¦‚è¦ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨äº‘åŸç”Ÿçš„ä¸–ç•Œä¸­ï¼Œé”™è¯¯æ— å¤„ä¸åœ¨ï¼Œæ··æ²Œå·¥ç¨‹åœ¨æé«˜ç³»ç»Ÿç¨³å®šæ€§æ–¹é¢èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚é€šè¿‡æ‰§è¡Œæ··æ²Œå·¥ç¨‹å®éªŒï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£ç³»ç»Ÿçš„å¼±ç‚¹å¹¶ä¸»åŠ¨è§£å†³ã€‚æˆ‘ä»¬å¼€å‘äº†äº‘åŸç”Ÿæ··æ²Œå·¥ç¨‹å¹³å° Chaos Meshï¼Œå¹¶åœ¨å†…éƒ¨ä½¿ç”¨ Chaos Mesh æ¥æå‡äº‘åŸç”Ÿåˆ†å¸ƒå¼æ•°æ®åº“ TiDB çš„å¥å£®æ€§ã€‚ç›®å‰ Chaos Mesh å·²åŠ å…¥ CNCF Sandbox é¡¹ç›®ï¼Œè¯¥å¹³å°ä¾æ‰˜äº k8s åŸºç¡€è®¾æ–½ï¼Œé€šè¿‡å¯¹ pod/container è¿›è¡Œè¯¸å¦‚æ€èŠ‚ç‚¹ã€IO é”™è¯¯å’Œå»¶æ—¶æ³¨å…¥ã€æ—¶é—´å›é€€ã€å†…æ ¸åˆ†é…å†…å­˜å¤±è´¥ç­‰ç­‰æ¥è¿›è¡Œæ··æ²Œæµ‹è¯•ã€‚ä¸»é¢˜å¤§çº²ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨åˆ†å¸ƒå¼é¢†åŸŸä¼šé‡åˆ°çš„è´¨é‡å’Œç¨³å®šæ€§é—®é¢˜&lt;/li&gt;
&lt;li&gt;æ··æ²Œå·¥ç¨‹åœ¨æå‡ç³»ç»Ÿç¨³å®šæ€§æ–¹é¢çš„ä½œç”¨å’Œæ„ä¹‰&lt;/li&gt;
&lt;li&gt;Chaos Mesh é¡¹ç›®ç®€ä»‹&lt;/li&gt;
&lt;li&gt;æ··æ²Œå·¥ç¨‹ä¸»è¦çš„æµ‹è¯•æ–¹å¼å’Œä½¿ç”¨æ¡ˆä¾‹&lt;/li&gt;
&lt;li&gt;æ··æ²Œå·¥ç¨‹å¹³å°çš„æ„å»ºå®è·µ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¬ä¼—æ”¶ç›Šï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;äº†è§£åœ¨æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿå¯èƒ½å‡ºç°çš„é—®é¢˜å’Œé£é™©&lt;/li&gt;
&lt;li&gt;äº†è§£æ··æ²Œå·¥ç¨‹çš„ä½¿ç”¨ç»éªŒå’Œè¸©è¿‡çš„å‘ï¼Œè§‚ä¼—åç»­å¯ä»¥é€šè¿‡æ··æ²Œå·¥ç¨‹æ¥è¿›è¡Œç›¸å…³å®è·µï¼Œæå‡äº§å“è´¨é‡&lt;/li&gt;
&lt;li&gt;é€šè¿‡ case study å¯ä»¥å¸®åŠ©å¤§å®¶æ„å»ºåˆ†å¸ƒå¼æ··æ²Œæµ‹è¯•å¹³å°&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;envoy-åœ¨è½»èˆŸå¾®æœåŠ¡ä¸­è½åœ°å®è·µ&#34;&gt;Envoy åœ¨è½»èˆŸå¾®æœåŠ¡ä¸­è½åœ°å®è·µ&lt;/h3&gt;
&lt;p&gt;è®²å¸ˆï¼šç‹ä½°å¹³&lt;/p&gt;
&lt;p&gt;å…¬å¸ï¼šç½‘æ˜“&lt;/p&gt;
&lt;p&gt;è®²å¸ˆä»‹ç»ï¼šç½‘æ˜“æ•°å¸†èµ„æ·±å·¥ç¨‹å¸ˆï¼Œè´Ÿè´£è½»èˆŸ Envoy ç½‘å…³ä¸è½»èˆŸ Service Mesh æ•°æ®é¢å¼€å‘ã€åŠŸèƒ½å¢å¼ºã€æ€§èƒ½ä¼˜åŒ–ç­‰å·¥ä½œã€‚å¯¹äº Envoy æ•°æ®é¢å¼€å‘ã€å¢å¼ºã€è½åœ°å…·æœ‰è¾ƒä¸ºä¸°å¯Œçš„ç»éªŒã€‚&lt;/p&gt;
&lt;p&gt;æ¼”è®²æ¦‚è¦ï¼š&lt;/p&gt;
&lt;p&gt;Envoy æ˜¯ç”± Lyft å¼€æºçš„é«˜æ€§èƒ½æ•°æ®å’ŒæœåŠ¡ä»£ç†ï¼Œä»¥å…¶å¯è§‚æµ‹æ€§å’Œé«˜æ‰©å±•æ€§è‘—ç§°ã€‚å¦‚ä½•å……åˆ†åˆ©ç”¨ Envoy çš„ç‰¹æ€§ï¼Œä¸ºä¸šåŠ¡æ„å»ºçµæ´»æ˜“æ‰©å±•ã€ç¨³å®šé«˜æ€§èƒ½çš„åŸºç¡€è®¾æ–½ï¼ˆæœåŠ¡ç½‘æ ¼ã€API ç½‘å…³ï¼‰æ˜¯ Envoy è½åœ°ç”Ÿäº§å®è·µå¿…é¡»è€ƒè™‘çš„é—®é¢˜ã€‚æœ¬æ¬¡åˆ†äº«ä¸»è¦ä»‹ç» Envoy åœ¨è½»èˆŸå¾®æœåŠ¡ç½‘å…³ä¸è½»èˆŸå¾®æœåŠ¡ç½‘æ ¼ä¸­è½åœ°å®è·µç»éªŒå’Œæ„å»ºæ­¤ç±»åŸºç¡€è®¾æ–½æ—¶è½»èˆŸå…³æ³¨çš„æ ¸å¿ƒé—®é¢˜ã€‚å¸Œæœ›èƒ½å¤Ÿç»™å¤§å®¶å¸¦æ¥ä¸€äº›å¸®åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;å¬ä¼—æ”¶ç›Šï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;äº†è§£ Envoy æœ¬èº«æ¶æ„ä¸å…³é”®ç‰¹æ€§ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ç”Ÿäº§å®è·µå½“ä¸­å¾®æœåŠ¡ç½‘å…³ä¸æœåŠ¡ç½‘æ ¼å…³æ³¨çš„æ ¸å¿ƒé—®é¢˜ä»¥åŠè½»èˆŸ Envoy çš„è§£å†³ä¹‹é“ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºæœŸæœ›å®ç°é›†ç¾¤æµé‡å…¨æ–¹ä½æ²»ç†å’Œè§‚å¯Ÿçš„å¬ä¼—æä¾›äº›è®¸å€Ÿé‰´ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;kubevelaé˜¿é‡Œå·´å·´æ–°ä¸€ä»£åº”ç”¨äº¤ä»˜ç®¡ç†ç³»ç»Ÿå®è·µ&#34;&gt;KubeVelaï¼šé˜¿é‡Œå·´å·´æ–°ä¸€ä»£åº”ç”¨äº¤ä»˜ç®¡ç†ç³»ç»Ÿå®è·µ&lt;/h3&gt;
&lt;p&gt;è®²å¸ˆï¼šå­™å¥æ³¢&lt;/p&gt;
&lt;p&gt;å…¬å¸ï¼šé˜¿é‡Œå·´å·´&lt;/p&gt;
&lt;p&gt;è®²å¸ˆä»‹ç»ï¼šå­™å¥æ³¢ (èŠ±åï¼šå¤©å…ƒ) é˜¿é‡Œäº‘æŠ€æœ¯ä¸“å®¶ï¼Œäº‘åŸç”Ÿåº”ç”¨æ¨¡å‹ OAM (Open Application Model) æ ¸å¿ƒæˆå‘˜å’Œä¸»è¦åˆ¶å®šè€…ï¼ŒKubeVela é¡¹ç›®ä½œè€…ï¼Œè‡´åŠ›äºæ¨åŠ¨äº‘åŸç”Ÿåº”ç”¨æ ‡å‡†åŒ–ï¼Œè´Ÿè´£å¤§è§„æ¨¡äº‘åŸç”Ÿåº”ç”¨äº¤ä»˜ä¸åº”ç”¨ç®¡ç†ç›¸å…³å·¥ä½œã€‚æ›¾å‚ä¸ç¼–å†™ã€ŠDocker å®¹å™¨ä¸å®¹å™¨äº‘ã€‹æŠ€æœ¯ä¹¦ç±ã€‚&lt;/p&gt;
&lt;p&gt;æ¼”è®²æ¦‚è¦ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;äº‘åŸç”Ÿåº”ç”¨äº¤ä»˜é¢ä¸´çš„é—®é¢˜ä¸æŒ‘æˆ˜&lt;/li&gt;
&lt;li&gt;ç¤¾åŒºä¸­å¸¸è§çš„åº”ç”¨äº¤ä»˜è§£å†³æ–¹æ¡ˆå¯¹æ¯”&lt;/li&gt;
&lt;li&gt;åŸºäº KubeVela çš„æ ‡å‡†åŒ–åº”ç”¨äº¤ä»˜ç®¡ç†æ ¸å¿ƒåŸç†&lt;/li&gt;
&lt;li&gt;é˜¿é‡Œå·´å·´åŸºäº KubeVela çš„åº”ç”¨äº¤ä»˜å®è·µ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¬ä¼—æ”¶ç›Šï¼š&lt;/p&gt;
&lt;p&gt;éšç€â€œäº‘åŸç”Ÿâ€çš„æ™®åŠï¼ŒåŸºç¡€è®¾æ–½é€æ¸æˆç†Ÿçš„ä»Šå¤©ï¼Œè¶Šæ¥è¶Šå¤šçš„åº”ç”¨å¼€å‘è€…ä»¬å¼€å§‹è¿½æ±‚å¿«é€Ÿçš„æ„å»ºäº¤ä»˜åº”ç”¨ã€‚ç„¶è€Œä½¿ç”¨åœºæ™¯çš„ä¸åŒå¾€å¾€æ„å‘³ç€åº”ç”¨äº¤ä»˜çš„ç¯å¢ƒä¼šæœ‰å·¨å¤§çš„å·®å¼‚ã€‚å°±æ¯”å¦‚ï¼ŒK8s ä¸­ä¸åŒçš„å·¥ä½œè´Ÿè½½ç±»å‹éœ€è¦å¯¹æ¥ä¸åŒçš„ç°åº¦å‘å¸ƒã€æµé‡ç®¡ç†ç­‰å®ç°æ–¹æ¡ˆï¼Œä¸åŒçš„éƒ¨ç½²ç¯å¢ƒï¼ˆå…¬æœ‰äº‘ã€ç§æœ‰åŒ–éƒ¨ç½²ç­‰ï¼‰ä¹Ÿå¸¸å¸¸éœ€è¦å¯¹æ¥ä¸åŒçš„æ—¥å¿—ç›‘æ§ä½“ç³»ã€‚å¦‚ä½•æ‰èƒ½å°†åº”ç”¨ç®¡ç†å’Œäº¤ä»˜å˜å¾—æ ‡å‡†åŒ–ï¼Œä½¿å¾—åº”ç”¨ç ”å‘ä¸å†éœ€è¦èŠ±å¤§é‡ç²¾åŠ›å¯¹æ¥ä¸åŒçš„äº¤ä»˜å¹³å°ï¼Ÿè¿™å·²ç»é€æ¸æˆä¸ºäº‘åŸç”Ÿåº”ç”¨ç®¡ç†é¢†åŸŸçš„ä¸€å¤§ç—›ç‚¹ã€‚æœ¬æ¬¡åˆ†äº«å°†é’ˆå¯¹è¿™äº›é—®é¢˜ä¸ºå¤§å®¶ä»‹ç»å¦‚ä½•åŸºäº KubeVela æ„å»ºæ ‡å‡†åŒ–çš„åº”ç”¨äº¤ä»˜ç®¡ç†å¹³å°ï¼Œä»‹ç»é˜¿é‡Œå·´å·´åœ¨æ­¤åŸºç¡€ä¸Šçš„å®è·µç»éªŒã€‚&lt;/p&gt;
&lt;h3 id=&#34;envoy-åœ¨é˜¿é‡Œå·´å·´å†…éƒ¨çš„è½åœ°å®è·µ&#34;&gt;Envoy åœ¨é˜¿é‡Œå·´å·´å†…éƒ¨çš„è½åœ°å®è·µ&lt;/h3&gt;
&lt;p&gt;è®²å¸ˆï¼šå¼ ä¹‰é£&lt;/p&gt;
&lt;p&gt;å…¬å¸ï¼šé˜¿é‡Œå·´å·´&lt;/p&gt;
&lt;p&gt;è®²å¸ˆä»‹ç»ï¼šé˜¿é‡Œå·´å·´äº‘åŸç”Ÿéƒ¨é—¨é«˜çº§å·¥ç¨‹å¸ˆï¼Œä¸»è¦è´Ÿè´£é˜¿é‡Œå·´å·´å†…éƒ¨ ServiceMesh æ•°æ®é¢çš„è½åœ°ã€‚Envoy/Istio ç¤¾åŒº Memberï¼Œç»™ envoy ç¤¾åŒºè´¡çŒ®äº† Dubbo Proxy filterï¼Œmetadata ä¼˜åŒ–ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æ¼”è®²æ¦‚è¦ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä»‹ç» Envoy åœ¨å¤§è§„æ¨¡åœºæ™¯ä¸‹å­˜åœ¨çš„é—®é¢˜ä»¥åŠå¦‚ä½•ä¼˜åŒ–&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»‹ç» Envoy å®ç°è‡ªå®šä¹‰åè®®çš„æœ€ä½³å®è·µ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ol&gt;
&lt;li&gt;æ‰©å±•è‡ªå®šä¹‰åè®®&lt;/li&gt;
&lt;li&gt;æ‰©å±•è¿æ¥æ± &lt;/li&gt;
&lt;li&gt;æ‰©å±• Cluster&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»‹ç» Envoy åœ¨é˜¿é‡Œå·´å·´å†…éƒ¨è½åœ°é‡åˆ°çš„ä¸€äº›å›°éš¾&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¬ä¼—æ”¶ç›Šï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Envoy åœ¨å¤§è§„æ¨¡åœºæ™¯ä¸‹å­˜åœ¨çš„ä¸€äº›é—®é¢˜&lt;/li&gt;
&lt;li&gt;æœºå™¨æ•°é‡è¿‡å¤šå¯¼è‡´çš„å†…å­˜é—®é¢˜&lt;/li&gt;
&lt;li&gt;æœºå™¨å…¨é‡ä¸‹å‘å¯¼è‡´çš„ CPU é—®é¢˜&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Aeraki åœ¨ Isito ä¸­æ”¯æŒ Dubboã€Thriftã€Redisï¼Œä»¥åŠä»»ä½•ä¸ƒå±‚åè®®</title>
      <link>https://cloudnative.to/blog/istiocon-layer7-traffic/</link>
      <pubDate>Fri, 05 Mar 2021 11:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/istiocon-layer7-traffic/</guid>
      <description>&lt;p&gt;æœ¬æ–‡æ ¹æ®è…¾è®¯äº‘èµµåŒ–å†°å’ŒçŸ¥ä¹å”é˜³åœ¨ IstioCon 2021 ä¸­çš„æ¼”è®² &lt;a href=&#34;https://events.istio.io/istiocon-2021/sessions/how-to-manage-any-layer-7-traffic-in-an-istio-service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;â€œHow to Manage Any Layer-7 Traffic in an Istio Service Mesh?â€&lt;/a&gt; æ•´ç†è€Œæˆã€‚&lt;/p&gt;
&lt;p&gt;å¤§å®¶å¥½ï¼Œä»Šå¤©æˆ‘ä»¬æƒ³å’Œå¤§å®¶åˆ†äº«çš„ä¸»é¢˜æ˜¯å¦‚ä½•æ‰©å±• Istio ä»¥æ”¯æŒä»»ä½•ä¸ƒå±‚åè®®ï¼Ÿä½œä¸ºäº‘åŸç”Ÿé¢†åŸŸä¸­ä¸€ä¸ªäººæ°”éå¸¸é«˜çš„å¼€æºé¡¹ç›®ï¼ŒIstio ç›®å‰å·²ç»åŸºæœ¬æˆä¸ºäº† Service Mesh çš„äº‹å®æ ‡å‡†ã€‚è…¾è®¯äº‘ä¸Šä¹Ÿæä¾›äº†åŸºäº Istio è¿›è¡Œå¢å¼ºï¼Œå’Œ Istio API å®Œå…¨å…¼å®¹çš„ Service Mesh ç®¡ç†æœåŠ¡ TCMï¼ˆTencent Cloud Meshï¼‰ï¼Œä»¥å¸®åŠ©æˆ‘ä»¬çš„ç”¨æˆ·ä»¥è¾ƒå°çš„è¿ç§»æˆæœ¬å’Œç»´æŠ¤ä»£ä»·å¿«é€Ÿåˆ©ç”¨åˆ° Service Mesh æä¾›çš„æµé‡ç®¡ç†å’ŒæœåŠ¡æ²»ç†èƒ½åŠ›ã€‚ä»Šå¤©éå¸¸é«˜å…´èƒ½å¤Ÿæœ‰è¿™ä¸ªæœºä¼šæ¥å’Œå¤§å®¶ä¸€èµ·åˆ†äº«ä¸€ä¸‹æˆ‘ä»¬åœ¨æ­¤è¿‡ç¨‹ä¸­çš„ä¸€äº›ç»éªŒã€‚&lt;/p&gt;
&lt;p&gt;Service Mesh æä¾›äº†ä¸€ä¸ªå¯¹åº”ç”¨é€æ˜çš„åŸºç¡€è®¾æ–½å±‚ï¼Œå¯ä»¥è§£å†³æˆ‘ä»¬åœ¨åˆ†å¸ƒå¼åº”ç”¨/å¾®æœåŠ¡ä¸­é‡åˆ°çš„å¸¸è§æŒ‘æˆ˜ï¼Œä¾‹å¦‚ï¼šå¦‚ä½•æ‰¾åˆ°æœåŠ¡æä¾›è€…ï¼Ÿå¦‚ä½•ä¿è¯æœåŠ¡ä¹‹é—´çš„é€šä¿¡å®‰å…¨ï¼Ÿå¦‚ä½•å¾—çŸ¥æœåŠ¡ä¹‹é—´çš„è°ƒç”¨å…³ç³»ï¼Ÿå¦‚ä½•è¿›è¡Œæµé‡ç®¡ç†å¦‚ç°åº¦å‘å¸ƒï¼Ÿç­‰ç­‰ã€‚Service Mesh çš„å®ç°æ–¹å¼æ˜¯ä¼´éšåº”ç”¨éƒ¨ç½²ä¸€ä¸ª Sidecar Proxyï¼Œè¯¥ Sidecar Proxy ä¼šæ‹¦æˆªåº”ç”¨çš„å‡ºå‘å’Œå…¥å‘æµé‡ï¼Œå¯¹è¿™äº›æµé‡è¿›è¡Œåˆ†æå’Œå¤„ç†ï¼Œä»¥è¾¾åˆ°åœ¨ä¸ä¿®æ”¹åº”ç”¨ä»£ç çš„æƒ…å†µä¸‹å¯¹æœåŠ¡è¿›è¡Œæµé‡ç®¡ç†ã€å®‰å…¨åŠ å¯†ï¼Œé¥æµ‹æ•°æ®æ”¶é›†çš„ç›®çš„ã€‚ä¸ºäº†å®ç°è¿™äº›æœåŠ¡æ²»ç†èƒ½åŠ›ï¼ŒSidecar Proxy ä¸åªéœ€è¦åœ¨ OSI ç½‘ç»œæ¨¡å‹çš„ä¸‰ã€å››å±‚ä¸Šå¯¹æµé‡è¿›è¡Œå¤„ç†ï¼Œæ›´é‡è¦çš„æ˜¯éœ€è¦åœ¨ä¸ƒå±‚ä¸Šè¿›è¡Œå¤„ç†ã€‚åœ¨ä¸ƒå±‚ä¸Šï¼ŒIstio ç¼ºçœåªæ”¯æŒäº† HTTP å’Œ gPRC ä¸¤ç§åè®®ã€‚ä½†æˆ‘ä»¬åœ¨å¾®æœåŠ¡ä¸­ç»å¸¸è¿˜ä¼šä½¿ç”¨åˆ°çš„å…¶ä»–ä¸ƒå±‚åè®®ï¼Œå½“å°†è¿™äº›å¾®æœåŠ¡åº”ç”¨è¿ç§»åˆ° Service Mesh æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ä¸€è‡´çš„æ–¹å¼å¯¹æ‰€æœ‰çš„è¿™äº›ä¸ƒå±‚åè®®è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œä»¥å……åˆ†åˆ©ç”¨ Service Mesh åŸºç¡€è®¾æ–½æä¾›çš„äº‘åŸç”Ÿèƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä»Šå¤©çš„åˆ†äº«ä¸­ï¼Œæˆ‘å°†ä¼šä»‹ç»å‡ ç§å°† Istio æµé‡ç®¡ç†èƒ½åŠ›æ‰©å±•åˆ°å…¶ä»–ä¸ƒå±‚åè®®çš„æ–¹æ³•ï¼Œå¹¶å¯¹æ¯”åˆ†æè¿™å‡ ç§æ–¹æ³•å„è‡ªçš„ä¼˜ç¼ºç‚¹ã€‚æˆ‘ä¼šä»‹ç»å¦‚ä½•åˆ©ç”¨ Aeraki å¼€æºé¡¹ç›®æ¥åœ¨ Istio ä¸­ç®¡ç†ä»»ä½•ä¸ƒå±‚åè®®ï¼ŒåŒ…æ‹¬ Dubboã€Thriftã€Redis ç­‰ã€‚ä¸ºäº†è®©å¤§å®¶äº†è§£ Aeraki æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä¼šå±•ç¤ºä¸€ä¸ªé‡‡ç”¨ Aeraki å®ç° Thrift æœåŠ¡ Traffic Splitting çš„ä¾‹å­ã€‚æ¥è‡ªçŸ¥ä¹çš„å”é˜³è¿˜ä¼šä¸ºæˆ‘ä»¬å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Aeraki çš„ä¸€äº›æœ‰è¶£çš„çœŸå®æ¡ˆä¾‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;service-mesh-ä¸­å¸¸è§çš„ä¸ƒå±‚åè®®&#34;&gt;Service Mesh ä¸­å¸¸è§çš„ä¸ƒå±‚åè®®&lt;/h2&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸€ä¸ªå…¸å‹çš„å¾®æœåŠ¡åº”ç”¨ä¸­é€šå¸¸ä¼šä½¿ç”¨åˆ°è¿™äº›ä¸ƒå±‚åè®®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŒæ­¥è°ƒç”¨ï¼šä¸åŒæœåŠ¡ä¹‹é—´ä¼šé‡‡ç”¨ RPCï¼ˆè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼‰è¿›è¡Œç›¸äº’è°ƒç”¨ã€‚å¸¸è§çš„ RPC è°ƒç”¨åè®®åŒ…æ‹¬ gRPCï¼ŒThriftï¼ŒDubboï¼ŒHTTP ä¹Ÿå¯ä»¥çœ‹åšä¸€ç§ RPCï¼ˆåªæ”¯æŒ GET/SET/POST è¿™å‡ ç§æ ‡å‡†æ–¹æ³•ï¼‰ ã€‚ä¸€äº›å¤§çš„å…¬å¸ä¸ºäº†æ»¡è¶³è‡ªå·±ç‰¹å®šä¸šåŠ¡åœºæ™¯çš„éœ€æ±‚ï¼Œå¾€å¾€è¿˜ä¼šé‡‡ç”¨ä¸€äº›ç§ç”¨çš„ RPC åè®®ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥æ¶ˆæ¯ï¼šé™¤äº† RPC ä¹‹å¤–ï¼Œå¼‚æ­¥æ¶ˆæ¯ä¹Ÿæ˜¯å¾®æœåŠ¡é€šä¿¡çš„ä¸€ç§å¸¸è§æ¨¡å¼ï¼ŒåŒ…æ‹¬ Kafkaï¼ŒRabbitMQï¼ŒActiveMQ ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;å„ç§æ•°æ®åº“å’Œç¼“å­˜ç³»ç»Ÿï¼šä¾‹å¦‚ Redisï¼ŒMySQLï¼ŒMongoDB ç­‰ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Redis çš„ä¸€ä¸ªå¸¸è§ç”¨é€”æ˜¯ç”¨ä½œæ•°æ®é«˜é€Ÿç¼“å­˜ã€‚é€šè¿‡åœ¨åº”ç”¨æœåŠ¡å™¨å’Œæ•°æ®åº“æœåŠ¡å™¨ä¹‹é—´åŠ å…¥ä¸€ä¸ª Redis ç¼“å­˜å±‚ï¼Œå¯ä»¥å‡å°‘åº”ç”¨æœåŠ¡å™¨å¯¹æ•°æ®åº“çš„å¤§é‡è¯»æ“ä½œï¼Œé¿å…æ•°æ®åº“æœåŠ¡å™¨åœ¨å¤§å‹åŠ›ä¸‹å“åº”ç¼“æ…¢ç”šè‡³å®•æœºçš„é£é™©ï¼Œæ˜¾è‘—åŠ å¼ºæ•´ä¸ªç³»ç»Ÿçš„å¥å£®æ€§ã€‚Redis ä½œä¸ºæ•°æ®ç¼“å­˜çš„åŸç†å¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istiocon-layer7-traffic/images/protocols-in-service-mesh_hu1067015855dbf9e6ad72aa1d62e48d69_139259_14a1ce8277d310bac8bd239ce1fa9b88.webp 400w,
               /blog/istiocon-layer7-traffic/images/protocols-in-service-mesh_hu1067015855dbf9e6ad72aa1d62e48d69_139259_7bc7967174e2caa00f20ecbcdd927a7a.webp 760w,
               /blog/istiocon-layer7-traffic/images/protocols-in-service-mesh_hu1067015855dbf9e6ad72aa1d62e48d69_139259_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istiocon-layer7-traffic/images/protocols-in-service-mesh_hu1067015855dbf9e6ad72aa1d62e48d69_139259_14a1ce8277d310bac8bd239ce1fa9b88.webp&#34;
               width=&#34;760&#34;
               height=&#34;442&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå½“å°†è¿™æ ·ä¸€ä¸ªå¾®æœåŠ¡åº”ç”¨åŠ å…¥åˆ° Service Mesh ä»¥åï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿé€šè¿‡ Service Mesh å¾—åˆ°å“ªäº›ç®¡ç†èƒ½åŠ›å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ› Service Mesh èƒ½å¤Ÿç®¡ç†å¾®æœåŠ¡ä¸­ç”¨åˆ°çš„æ‰€æœ‰ä¸ƒå±‚åè®®çš„æµé‡ï¼ŒåŒ…æ‹¬ RPCã€Messagingã€Cacheã€DB ç­‰ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸºäºè¯·æ±‚çš„è´Ÿè½½å‡è¡¡ï¼šå¯ä»¥å°†æ¥è‡ªåŒä¸€ä¸ª TCP é“¾æ¥çš„å¤šä¸ªç‹¬ç«‹çš„è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œä»¥å®ç°æ›´æ™ºèƒ½ï¼Œæ›´åˆç†çš„è´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;li&gt;åŸºäºä¸ƒå±‚ Header çš„æµé‡è·¯ç”±ï¼šæ ¹æ®ä¸ƒå±‚ Header ä¸­çš„å±æ€§è¿›è¡Œè·¯ç”±ï¼Œä¾‹å¦‚æ ¹æ® Dubbo è¯·æ±‚ä¸­çš„æœåŠ¡åæˆ–è€… Redis è¯·æ±‚çš„ Key è¿›è¡Œè·¯ç”±ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚å“åº”æ³¨å…¥å»¶è¿Ÿæˆ–è€…é”™è¯¯ï¼Œä»¥æµ‹è¯•å¾®æœåŠ¡ç”¨çš„å¼¹æ€§ã€‚&lt;/li&gt;
&lt;li&gt;æä¾›åº”ç”¨çº§å®‰å…¨ï¼Œä¾‹å¦‚åŸºäº HTTP Header ä¸­çš„ JWT Token è¿›è¡Œè®¤è¯ï¼Œæˆ–è€…å¯¹ Redis æœåŠ¡å™¨è¿›è¡Œè®¤è¯ã€‚&lt;/li&gt;
&lt;li&gt;è¯·æ±‚å±‚é¢çš„é¥æµ‹æ•°æ®ï¼ŒåŒ…æ‹¬è¯·æ±‚æˆåŠŸç‡ã€è¯·æ±‚è€—æ—¶ã€è°ƒç”¨è·Ÿè¸ªç­‰ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istiocon-layer7-traffic/images/expect-from-mesh_hufac02667438311024404b8154319a630_191185_c1ce6e531d212c8e49e5d697f576d944.webp 400w,
               /blog/istiocon-layer7-traffic/images/expect-from-mesh_hufac02667438311024404b8154319a630_191185_3d9237d85fc3dd407e1f87ded9aa48be.webp 760w,
               /blog/istiocon-layer7-traffic/images/expect-from-mesh_hufac02667438311024404b8154319a630_191185_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istiocon-layer7-traffic/images/expect-from-mesh_hufac02667438311024404b8154319a630_191185_c1ce6e531d212c8e49e5d697f576d944.webp&#34;
               width=&#34;760&#34;
               height=&#34;432&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¦å®ç°ä»¥ä¸Šè¿™äº›æµé‡ç®¡ç†å’ŒæœåŠ¡æ²»ç†èƒ½åŠ›ï¼ŒService Mesh éœ€è¦åˆ†æå’Œå¤„ç† TCP æ•°æ®åŒ…ä¸­çš„ä¸ƒå±‚åè®®çš„ Headerã€‚å³ Service Mesh å¿…é¡»å…·æœ‰ä¸ƒå±‚åè®®çš„ç®¡ç†èƒ½åŠ›ï¼Œè€Œä¸åªæ˜¯åœ¨ TCP å±‚é¢ä¸Šè¿›è¡Œå¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œåœ¨ Istio ä¸­ï¼Œå¯¹äºé™¤äº† HTTP å’Œ gRPC ä¹‹å¤–çš„åè®®ï¼Œæˆ‘ä»¬åªèƒ½åœ¨ OSI ä¸‰åˆ°å…­å±‚å¯¹è¿™äº›åè®®è¿›è¡Œå¤„ç†ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬åªèƒ½åŸºäºä¸‰å±‚çš„ IP åœ°å€ï¼Œå››å±‚çš„ TCP ç«¯å£æˆ–è€…å…­å±‚çš„ SNIï¼ˆServer Name Indicationï¼‰å¯¹è¿™äº›åè®®è¿›è¡Œè·¯ç”±ã€‚åªèƒ½æ”¶é›†åˆ° TCP å±‚é¢çš„æŒ‡æ ‡ï¼Œä¾‹å¦‚ TCP æ”¶å‘åŒ…æ•°é‡æˆ–è€…æ‰“å¼€/å…³é—­çš„ TCP é“¾æ¥æ•°é‡ã€‚åªèƒ½é‡‡ç”¨ mTLS è¿›è¡Œé“¾è·¯å±‚é¢çš„è®¤è¯å’Œæƒé™æ§åˆ¶ã€‚æ¢è€Œè¨€ä¹‹ï¼Œå¯¹äºè¿™äº›åè®®ï¼Œæˆ‘ä»¬ä¾ç„¶éœ€è¦åœ¨åº”ç”¨ä»£ç ä¸­å¤„ç†æµé‡æ§åˆ¶ã€å¯è§‚æµ‹æ€§ã€å®‰å…¨è®¤è¯è¿™äº›æœ¬åº”è¯¥ç”± Service Mesh åŸºç¡€è®¾æ–½æ¥ç»Ÿä¸€å¤„ç†çš„å…±æ€§é—®é¢˜ã€‚è¿™è¿èƒŒäº†æˆ‘ä»¬å°†å¾®æœåŠ¡è¿ç§»åˆ° Service Mesh çš„åˆè¡·ï¼šå°†å¾®æœåŠ¡é€šä¿¡å’Œæ²»ç†çš„å…±æ€§é—®é¢˜ä»åº”ç”¨ä»£ç ä¸‹æ²‰åˆ° Service Mesh åŸºç¡€è®¾æ–½å±‚ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istiocon-layer7-traffic/images/got-from-mesh_hu46ee1980604880b2fd5daa5fd99a4781_199348_1b7a0bb54bc701f603e43b2ea34e6229.webp 400w,
               /blog/istiocon-layer7-traffic/images/got-from-mesh_hu46ee1980604880b2fd5daa5fd99a4781_199348_ee9ab6dcfec6a73137d1f493aabdec92.webp 760w,
               /blog/istiocon-layer7-traffic/images/got-from-mesh_hu46ee1980604880b2fd5daa5fd99a4781_199348_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istiocon-layer7-traffic/images/got-from-mesh_hu46ee1980604880b2fd5daa5fd99a4781_199348_1b7a0bb54bc701f603e43b2ea34e6229.webp&#34;
               width=&#34;760&#34;
               height=&#34;432&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å¦‚ä½•æ‰©å±•-istio-çš„åè®®ç®¡ç†èƒ½åŠ›&#34;&gt;å¦‚ä½•æ‰©å±• Istio çš„åè®®ç®¡ç†èƒ½åŠ›ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨ Istio ä¸­ç®¡ç†è¿™äº›ä¸ƒå±‚åè®®ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª BookInfo å¾®æœåŠ¡ï¼Œä½†è¯¥å¾®æœåŠ¡é‡‡ç”¨äº†ä¸€ç§ç§°ä¸º AwesomeRPC çš„åè®®è€Œä¸æ˜¯ HTTP æ¥å®ç°æœåŠ¡é—´çš„è¿œç¨‹è°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istiocon-layer7-traffic/images/awesomerpc-bookinfo_hu036fbe53b3d42a2cc01d05776d6a59fe_68964_0b891de30784e22d24381377dc9448da.webp 400w,
               /blog/istiocon-layer7-traffic/images/awesomerpc-bookinfo_hu036fbe53b3d42a2cc01d05776d6a59fe_68964_9ad9c8b77e8d3b27b59faf4c23b158e2.webp 760w,
               /blog/istiocon-layer7-traffic/images/awesomerpc-bookinfo_hu036fbe53b3d42a2cc01d05776d6a59fe_68964_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istiocon-layer7-traffic/images/awesomerpc-bookinfo_hu036fbe53b3d42a2cc01d05776d6a59fe_68964_0b891de30784e22d24381377dc9448da.webp&#34;
               width=&#34;760&#34;
               height=&#34;268&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•æ‰èƒ½å¤Ÿåœ¨ Istio ä¸­å®ç° AwesomeRPC åè®®çš„æµé‡ç®¡ç†ï¼Œä¾‹å¦‚æ ¹æ®è¯·æ±‚ header ä¸­çš„ user name å­—æ®µå°†æ¥è‡ª ProductPage çš„è¯·æ±‚è·¯ç”±åˆ°ä¸åŒç‰ˆæœ¬çš„ Reviews ä¸­ï¼Œä»¥å®ç°ä¸€ä¸ªç°åº¦å‘å¸ƒçš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æƒ³åˆ°çš„æœ€æ˜¾è€Œæ˜“è§çš„æ–¹å¼å°±æ˜¯ç›´æ¥ä¿®æ”¹ Istio ä»£ç ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨ Istio çš„ VirtualService CRD ä¸­æ”¯æŒ AwesomeRPC åè®®ã€‚å¢å¼ºåçš„ VirtualService CRD å¦‚ä¸‹å›¾ä¸­æœ€å·¦çš„è§„åˆ™é…ç½®æ‰€ç¤ºã€‚AwesomeRPC å’Œ HTTP è·¯ç”±çš„è¯­ä¹‰ç±»ä¼¼ï¼Œéƒ½æ˜¯æ ¹æ® Header ä¸­æŸäº›å±æ€§çš„å€¼è¿›è¡Œè·¯ç”±ã€‚å› æ­¤æˆ‘ä»¬åªéœ€è¦å°† HTTP åè®®ç±»å‹æ”¹ä¸º AwesomeRPCï¼Œå¯ä»¥ç›´æ¥é‡‡ç”¨ VirtualService ä¸­çš„ HTTPRoute ç»“æ„æ¥è¡¨ç¤º AwesomeRPC çš„è·¯ç”±è§„åˆ™ã€‚ç„¶åæˆ‘ä»¬éœ€è¦åœ¨ Pilot ä»£ç ä¸­æ ¹æ® AwesomeRPC çš„æœåŠ¡å®šä¹‰å’Œ VirtualService å®šä¹‰çš„è·¯ç”±è§„åˆ™ç”Ÿæˆ Envoy æ‰€éœ€çš„çœŸå®é…ç½®ï¼Œå¹¶é€šè¿‡ xDS ä¸‹å‘ç»™æ•°æ®é¢çš„ Envoyã€‚å½“ç„¶ï¼Œä»¥ä¸Šçš„å‰ææ˜¯æˆ‘ä»¬å·²ç»é€šè¿‡ Envoy çš„ Filter æ‰©å±•æœºåˆ¶ç¼–å†™äº† AwesomeRPC çš„ Filter æ’ä»¶ï¼Œå®ç° AwesomeRPC çš„ç¼–è§£ç ï¼ŒHeader è§£æï¼ŒåŠ¨æ€è·¯ç”±ç­‰æ•°æ®é¢æ‰€éœ€çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istiocon-layer7-traffic/images/code-modification_hu42518921c739fb092c7fe017f962c16c_265670_43ec89bb77b0d874d4efcf52c728f473.webp 400w,
               /blog/istiocon-layer7-traffic/images/code-modification_hu42518921c739fb092c7fe017f962c16c_265670_66f6bb8749af943d9435799403f43a7b.webp 760w,
               /blog/istiocon-layer7-traffic/images/code-modification_hu42518921c739fb092c7fe017f962c16c_265670_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istiocon-layer7-traffic/images/code-modification_hu42518921c739fb092c7fe017f962c16c_265670_43ec89bb77b0d874d4efcf52c728f473.webp&#34;
               width=&#34;760&#34;
               height=&#34;419&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œåœ¨ Envoy Filter å·²ç»å®ç°äº†çš„æƒ…å†µä¸‹ï¼Œåœ¨æ§åˆ¶é¢å¢åŠ ä¸€ä¸ªæ–°çš„ä¸ƒå±‚åè®®çš„è¿‡ç¨‹æ˜¯ç›¸å¯¹æ¯”è¾ƒç®€å•çš„ã€‚ä½†æ˜¯ç”±äºæˆ‘ä»¬ä¿®æ”¹äº† Istio çš„æºç ï¼Œå› æ­¤éœ€è¦è‡ªå·±ç»´æŠ¤ä¸€ä¸ª Istio çš„ç§æœ‰åˆ†æ”¯ï¼Œè¿™å¯¼è‡´äº†é¢å¤–çš„ç»´æŠ¤ä»£ä»·ï¼Œå¹¶ä¸”å¾ˆéš¾è·Ÿä¸Š Istio å¿«é€Ÿçš„è¿­ä»£æ­¥ä¼ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸å¸Œæœ›ç»´æŠ¤è‡ªå·±çš„ Istio ä»£ç åˆ†æ”¯ï¼Œä¸€ç§å¯è¡Œçš„æ›¿ä»£æ–¹å¼æ˜¯é‡‡ç”¨ Istio EnvoyFilter CRDï¼šEnvoyFilter æ˜¯ Istio æä¾›çš„ä¸€ç§çµæ´»å¼ºå¤§çš„é…ç½®æœºåˆ¶ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ EnvoyFilter ä¸º Pilot ç”Ÿæˆçš„ç¼ºçœ Envoy é…ç½®æ‰“ä¸€ä¸ªè¡¥ä¸ï¼Œæ·»åŠ ã€ä¿®æ”¹æˆ–è€…åˆ é™¤ç¼ºçœ Envoy é…ç½®ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œä»¥æŒ‰æˆ‘ä»¬çš„è¦æ±‚ä¿®æ”¹ Envoy åœ¨ Istio Service Mesh ä¸­çš„ç¼ºçœè¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç”±äº Pilot å¹¶ä¸ç†è§£ AwesomeRPC åè®®ï¼Œå¯¹äº Pilot æ¥è¯´ï¼ŒAwesomeRPC æœåŠ¡åªæ˜¯ä¸€ä¸ª TCP æœåŠ¡ã€‚åœ¨ Pilot ç”Ÿæˆçš„ç¼ºçœé…ç½®ä¸­ï¼ŒAwesomeRPC æœåŠ¡å¯¹åº”çš„ Outbound Listener çš„ FilterChain ä¸­é‡‡ç”¨äº†ä¸€ä¸ª TCP Proxy æ¥å¤„ç†å…¶æµé‡ã€‚æˆ‘ä»¬åœ¨ EnvoyFilter çš„ Match éƒ¨åˆ†ä¸­é€‰ä¸­è¯¥ TCP Proxyï¼Œå¹¶åœ¨ Operation éƒ¨åˆ†å°†å…¶æ›¿æ¢ä¸ºä¸€ä¸ªé…ç½®äº† Traffic Splitting è§„åˆ™çš„ AwesomeRPC Filterã€‚Pilot ä¼šæ ¹æ® EnvoyFilter ä¿®æ”¹å…¶ç”Ÿæˆçš„ç¼ºçœ Envoy é…ç½®ï¼Œç„¶åä¸‹å‘åˆ°æ•°æ®é¢çš„ Envoy ä¸Šã€‚è¿™æ ·æˆ‘ä»¬å°±é€šè¿‡ EnvoyFilter åœ¨ Istio ä¸­å®ç°äº†å¯¹ AwesomeRPC åè®®çš„æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istiocon-layer7-traffic/images/awesomerpc-envoyfilter_hu4f04842443c495e2994b4d25e5591cde_213769_46fc26f465815a358b080179363696ca.webp 400w,
               /blog/istiocon-layer7-traffic/images/awesomerpc-envoyfilter_hu4f04842443c495e2994b4d25e5591cde_213769_dbe7aa3f697245a6621af363259f3120.webp 760w,
               /blog/istiocon-layer7-traffic/images/awesomerpc-envoyfilter_hu4f04842443c495e2994b4d25e5591cde_213769_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istiocon-layer7-traffic/images/awesomerpc-envoyfilter_hu4f04842443c495e2994b4d25e5591cde_213769_46fc26f465815a358b080179363696ca.webp&#34;
               width=&#34;760&#34;
               height=&#34;419&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªé‡‡ç”¨ Thrift åè®®çš„çœŸå®æ¡ˆä¾‹ã€‚Thrift æ˜¯ Apache åŸºé‡‘ä¼šä¸‹ä¸€ä¸ªè½»é‡çº§ã€æ”¯æŒå¤šè¯­è¨€çš„å¼€æº RPC æ¡†æ¶ã€‚Envoy ä¸­å·²ç»æ”¯æŒ Thriftï¼Œä½† Istio ä¸­åªå¯¹ Thrift æä¾›äº†æœ‰é™çš„æ”¯æŒï¼Œå¹¶ä¸èƒ½å®ç° Traffic Splitting ç­‰é«˜çº§æµé‡ç®¡ç†åŠŸèƒ½ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨ Istio ä¸­æä¾›ä¸‹å›¾ä¸­å³ä¸‹è§’æ‰€ç¤º Thrift æœåŠ¡çš„ Traffic Splitting æµé‡æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ EnvoyFilter æ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;(æœ¬ç¤ºä¾‹ç›¸å…³æºç å¯ä»¥ä» &lt;a href=&#34;https://github.com/aeraki-framework/thrift-envoyfilter-example&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/aeraki-framework/thrift-envoyfilter-example&lt;/a&gt; ä¸‹è½½ï¼‰&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istiocon-layer7-traffic/images/envoyfilter-thrift_huca39f7fea42e76475e24b19f6e91c292_272568_63f49b8139bd707295a2eeef6ca2e8fb.webp 400w,
               /blog/istiocon-layer7-traffic/images/envoyfilter-thrift_huca39f7fea42e76475e24b19f6e91c292_272568_c166ef74156ba3ded2a08481f33e7d98.webp 760w,
               /blog/istiocon-layer7-traffic/images/envoyfilter-thrift_huca39f7fea42e76475e24b19f6e91c292_272568_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istiocon-layer7-traffic/images/envoyfilter-thrift_huca39f7fea42e76475e24b19f6e91c292_272568_63f49b8139bd707295a2eeef6ca2e8fb.webp&#34;
               width=&#34;760&#34;
               height=&#34;423&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå›¾ä¸­å·¦è¾¹æ‰€ç¤ºçš„ EnvoyFilter æ¥å¤„ç†å®¢æˆ·ç«¯çš„å‡ºå‘æµé‡ï¼Œè¯¥ EnvoyFilter çš„ Match æ¡ä»¶é€‰ä¸­äº†  &lt;code&gt;$(thrift-sample-server-vip)_9090&lt;/code&gt; è¿™ä¸ª Outbound Listener ä¸­ çš„ tcp_proxyï¼Œåœ¨ Patch éƒ¨åˆ†å°†å…¶æ›¿æ¢ä¸ºä¸€ä¸ª thrift_proxyã€‚åœ¨è¯¥ thrift_proxy ä¸­ï¼Œæˆ‘ä»¬æŒ‰ç…§ Traffic Splitting çš„è¦æ±‚ä¸ºå…¶é…ç½®äº†ç›¸åº”çš„è·¯ç”±ï¼šå°† 30% çš„æµé‡è·¯ç”±åˆ° Server v1 ç‰ˆæœ¬ï¼Œ70% çš„æµé‡è·¯ç”±åˆ° Server v2 ç‰ˆæœ¬ã€‚æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸º Thrift Server ç«¯åˆ›å»ºä¸€ä¸ªå¦‚å›¾å³ä¸Šæ‰€ç¤ºçš„ EnvoyFilter æ¥å¤„ç†æœåŠ¡å™¨ç«¯çš„å…¥å‘æµé‡ã€‚ç›¸æ¯”å®¢æˆ·ç«¯çš„ EnvoyFilter è€Œè¨€ï¼ŒæœåŠ¡å™¨ç«¯çš„ EnvoyFilter é…ç½®è¦ç®€å•ä¸€äº›ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦åœ¨æœåŠ¡å™¨ç«¯é…ç½®ä»»ä½•è·¯ç”±è§„åˆ™ï¼Œåªéœ€è¦å°† tcp_proxy æ›¿æ¢ä¸º thrift_proxy å³å¯ã€‚è¿™ä¸ª thrift_proxy è™½ç„¶æ²¡æœ‰è·¯ç”±è§„åˆ™ï¼Œä½†æä¾›äº†å¤§é‡ä¸ƒå±‚çš„æœåŠ¡é€šä¿¡å’Œæ²»ç†èƒ½åŠ›ï¼ŒåŒ…æ‹¬è¯·æ±‚å±‚é¢çš„è´Ÿè½½å‡è¡¡ã€äº§ç”Ÿè¯·æ±‚å±‚é¢çš„ Metrics æ•°æ®ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä»ä¸Šé¢çš„ä»‹ç»å’Œç¤ºä¾‹å¯ä»¥çœ‹åˆ°ï¼ŒEnvoyFilter CRD å¥½æ¯”æ˜¯ Istio ä¸­çš„ä¸€æŠŠç‘å£«å†›åˆ€ï¼Œå¯ä»¥å¯¹ Pilot ç”Ÿæˆçš„ Envoy é…ç½®è¿›è¡Œéå¸¸çµæ´»çš„å®šåˆ¶ï¼Œä»¥è¾¾åˆ°å¯¹ä¸ƒå±‚åè®®è¿›è¡Œç®¡ç†çš„ç›®çš„ã€‚ä½†æ˜¯ EnvoyFilter ä¹Ÿå¸¦æ¥äº†ä¸€äº›éš¾ä»¥å¤„ç†çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;EnvoyFilter å°† Envoy çš„åº•å±‚å®ç°ç»†èŠ‚ç›´æ¥æš´éœ²ç»™äº†è¿ç»´äººå‘˜ï¼šè¿ç»´äººå‘˜å¿…é¡»éå¸¸äº†è§£ Envoy çš„é…ç½®ç»†èŠ‚ï¼Œè€Œè¿™äº›é…ç½®ç»†èŠ‚å¾€å¾€å’Œ Envoy Filter å†…éƒ¨çš„å®ç°æœºåˆ¶ç´§å¯†ç›¸å…³ï¼Œä¾‹å¦‚ Filter çš„åç§°å’Œ Filter å†…éƒ¨çš„é…ç½®æ ¼å¼ç­‰ã€‚è¿™å¯¼è‡´åˆ›å»º EnvoyFilter æˆä¸ºäº†ä¸€ç§å’Œä»£ç ç»†èŠ‚é«˜åº¦è€¦åˆçš„å·¥ä½œï¼Œéš¾ä»¥ç›´æ¥äº¤ä»˜ç»™è¿ç»´äººå‘˜ã€‚æ›´ä¸ºåˆç†çš„æ–¹å¼åˆ™åº”è¯¥æ˜¯é‡‡ç”¨ä¸€ç§é¢å‘ç”¨æˆ·çš„é«˜çº§é…ç½®è¯­è¨€æ¥å±è”½è¿™äº›å®ç°ç»†èŠ‚ï¼Œä¾‹å¦‚ Istio ä¸­çš„ VirtualService å’Œ DestinationRuleã€‚&lt;/li&gt;
&lt;li&gt;EnvoyFilter ä¸­çš„åŒ¹é…æ¡ä»¶ä¾èµ–äº Pilot ç”Ÿæˆçš„ Envoy é…ç½®ä¸­çš„ç»“æ„ç»„æˆå’Œå…ƒç´ å‘½åï¼Œä¾‹å¦‚ Listener çš„åç§°ï¼ŒFilterChain çš„æ„æˆç­‰ã€‚è€Œè¿™äº›ç»“æ„å’Œå‘½ååœ¨ä¸åŒçš„ Istio ç‰ˆæœ¬ä¹‹é—´å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´åŸæœ¬èƒ½å¤Ÿæ­£å¸¸å·¥ä½œçš„ EnvoyFilter åœ¨æ–°ç‰ˆæœ¬ä¸­å‡ºç°é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;EnvoyFilter ä¸­çš„åŒ¹é…æ¡ä»¶è¿˜ä¾èµ–äºä¸€äº›å’Œç‰¹å®š Kubernetes é›†ç¾¤ç›¸å…³çš„å†…å®¹ï¼Œä¾‹å¦‚ Service Cluster IPï¼Œè¿™æ„å‘³ç€ä¸€ä¸ª EnvoyFilter ä¸èƒ½ç”¨äºå¤šä¸ªä¸åŒé›†ç¾¤ä¸­çš„ç›¸åŒæœåŠ¡ã€‚å½“ Service è¢«é‡å»ºæ—¶ï¼Œç”±äº Cluster IP ä¼šå‘ç”Ÿå˜åŒ–ï¼Œç›¸åº”çš„ EnvoyFilter ä¹Ÿå¿…é¡»è¿›è¡Œæ”¹åŠ¨ï¼Œä¿®æ”¹ Match æ¡ä»¶ä¸­çš„ Cluster IPã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ª Service åˆ›å»ºç›¸åº”çš„ EnvoyFilterï¼Œå½“ Mesh ä¸­ç®¡ç†çš„æœåŠ¡è¾ƒå¤šæ—¶ï¼Œæ‰‹åŠ¨åˆ›å»ºæˆç™¾ä¸Šåƒçš„ EnvoyFilter çš„å·¥ä½œæ˜¯éå¸¸ç¹çè€Œä¸”åŠæ˜“å‡ºé”™çš„ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹ Istio è€Œè¨€ï¼ŒEnvoyFilter ä¸­çš„ Patch éƒ¨åˆ†åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œå› æ­¤ Istio åªèƒ½å¯¹ EnvoyFilter çš„æ­£ç¡®æ€§è¿›è¡Œéå¸¸æœ‰é™çš„éªŒè¯ã€‚è¿™å¯¼è‡´ EnvoyFilter çš„è°ƒè¯•éå¸¸å›°éš¾ï¼Œå½“ Envoy æœªèƒ½æŒ‰ç…§ä½ çš„è®¾æƒ³å·¥ä½œæ—¶ï¼Œä½ å¾ˆéš¾çŸ¥é“åˆ°åº•æ˜¯ EnvoyFilter çš„ä»€ä¹ˆåœ°æ–¹å‡ºç°äº†é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±äºä¸Šè¿°çš„ç§ç§é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶å¯ä»¥ä½¿ç”¨ EnvoyFilter æ¥åœ¨ Istio ä¸­å®ç°ä¸ƒå±‚åè®®çš„ç®¡ç†ï¼Œä½†æ˜¯åœ¨ä¸€ä¸ªç”Ÿäº§ç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯ä¸€ä¸ªä¸­å¤§å‹çš„ Service Mesh ä¸­ç®¡ç†å’Œç»´æŠ¤è¿™äº› EnvoyFilter æ˜¯éå¸¸å›°éš¾çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;aerakiåœ¨-istio-ä¸­ç®¡ç†ä»»ä½•ä¸ƒå±‚åè®®&#34;&gt;Aerakiï¼šåœ¨ Istio ä¸­ç®¡ç†ä»»ä½•ä¸ƒå±‚åè®®&lt;/h2&gt;
&lt;p&gt;ç”±äºéš¾ä»¥æ‰‹åŠ¨å¯¹ EnvoyFilter è¿›è¡Œç®¡ç†å’Œç»´æŠ¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†&lt;a href=&#34;https://github.com/aeraki-framework/aeraki&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Aeraki&lt;/a&gt; (å‘éŸ³ï¼š[Air-rah-ki]ï¼‰é¡¹ç›®æ¥è‡ªåŠ¨åŒ–è¿™ä¸ªæµç¨‹ã€‚Aeraki æ˜¯å¸Œè…Šè¯­ä¸­â€œå¾®é£â€çš„æ„æ€ï¼Œæˆ‘ä»¬å¸Œæœ› Aeraki è¿™è‚¡å¾®é£èƒ½å¸®åŠ© Istio åœ¨äº‘åŸç”Ÿçš„æ—…ç¨‹ä¸­èˆªè¡Œå¾—æ›´è¿œã€‚&lt;/p&gt;
&lt;p&gt;Aeraki çš„åŸºæœ¬å·¥ä½œåŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šAeraki ä» Istio ä¸­æ‹‰å–æœåŠ¡æ•°æ®ï¼Œæ ¹æ® ServiceEntry å’Œ Aeraki æµé‡è§„åˆ™ç”Ÿæˆ Envoy é…ç½®ï¼Œå¹¶é‡‡ç”¨ EnvoyFilter å°†ç”Ÿæˆçš„é…ç½®æ¨é€åˆ° Istio ä¸­ã€‚ç®€è€Œè¨€ä¹‹ï¼Œä½ å¯ä»¥æŠŠ Aeraki çœ‹åš Istio ä¸­ç®¡ç†çš„ä¸ƒå±‚åè®®çš„ &lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/operator/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Operator&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istiocon-layer7-traffic/images/aeraki_hu64ffc35a9aade04963827015f821a114_151446_c73f0ca41cf5fb148197b4cf14f4be95.webp 400w,
               /blog/istiocon-layer7-traffic/images/aeraki_hu64ffc35a9aade04963827015f821a114_151446_f67313b4f169db5912a1befc9a95d7a1.webp 760w,
               /blog/istiocon-layer7-traffic/images/aeraki_hu64ffc35a9aade04963827015f821a114_151446_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istiocon-layer7-traffic/images/aeraki_hu64ffc35a9aade04963827015f821a114_151446_c73f0ca41cf5fb148197b4cf14f4be95.webp&#34;
               width=&#34;760&#34;
               height=&#34;445&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç›¸æ¯”äºç›´æ¥ä¿®æ”¹ Istio ä»£ç å’Œé‡‡ç”¨ EnvoyFilter è¿™ä¸¤ç§æ‰©å±• Istio æµé‡ç®¡ç†èƒ½åŠ›çš„æ–¹å¼ï¼Œé‡‡ç”¨ Aeraki ä¸ºæˆ‘ä»¬å¸¦æ¥äº†ä»¥ä¸‹çš„å¥½å¤„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸éœ€è¦ä¿®æ”¹ Istio ä»£ç ï¼Œå› æ­¤èŠ‚çœäº†å•ç‹¬ç»´æŠ¤ä¸€ä¸ª Istio çš„ç§æœ‰ä»£ç åˆ†æ”¯çš„é¢å¤–å·¥ä½œé‡ï¼Œå¯ä»¥å¿«é€Ÿè·Ÿéš Istio çš„ç‰ˆæœ¬è¿­ä»£è¿›è¡Œå‡çº§ã€‚&lt;/li&gt;
&lt;li&gt;Aeraki ä½œä¸ºä¸€ä¸ªç‹¬ç«‹ç»„ä»¶éƒ¨ç½²åœ¨ Mesh çš„æ§åˆ¶é¢ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä½œä¸ºä¸€ä¸ªæ’ä»¶å’Œ Istio è¿›è¡Œé›†æˆï¼Œå¯¹ Istio çš„æµé‡ç®¡ç†èƒ½åŠ›è¿›è¡Œæ‰©å±•ã€‚&lt;/li&gt;
&lt;li&gt;åè®®ç›¸å…³çš„ç¼ºçœé…ç½®ç”± Aeraki è‡ªåŠ¨ç”Ÿæˆï¼Œå¹¶ä¸”è¿™äº›é…ç½®å¯ä»¥æ ¹æ® Istio ç‰ˆæœ¬å’Œ Kubernetes é›†ç¾¤ç›¸å…³ä¿¡æ¯è‡ªåŠ¨è¿›è¡Œè°ƒæ•´ã€‚èŠ‚çº¦äº†å¤§é‡ EnvoyFilter çš„æ‰‹åŠ¨åˆ›å»ºå’Œç»´æŠ¤å·¥ä½œã€‚&lt;/li&gt;
&lt;li&gt;Aeraki åœ¨ Envoy é…ç½®ä¹‹ä¸Šè¿›è¡Œäº†æŠ½è±¡ï¼Œæä¾›äº†ä¸€å±‚é¢å‘ç”¨æˆ·çš„é…ç½® CRD æ¥å¯¹è¿™äº›ä¸ƒå±‚åè®®è¿›è¡Œç®¡ç†ã€‚è¿™äº›é«˜çº§ CRD éšè—äº† Envoy çš„é…ç½®ç»†èŠ‚ï¼Œå±è”½äº†ä¸åŒ Istio ç‰ˆæœ¬ç”Ÿæˆçš„ç¼ºçœ Envoy é…ç½®çš„å·®å¼‚ï¼Œå¯¹äºè¿ç»´éå¸¸å‹å¥½ã€‚å¯¹äº Thrift å’Œ Dubbo è¿™æ ·çš„ RPC åè®®ï¼Œç”±äºå…¶è¯­ä¹‰å’Œ HTTP ç±»ä¼¼ï¼ŒAeraki ç›´æ¥é‡‡ç”¨äº† Istio VirtualService å’Œ DestinationRuleï¼›å¯¹äºé RPC åè®®ï¼ŒAeraki åˆ™å®šä¹‰äº†ä¸€äº›æ–°çš„ CRD æ¥è¿›è¡Œç®¡ç†ï¼Œä¾‹å¦‚ RedisService å’Œ RedisDestinationã€‚æˆ‘ä»¬åé¢å°†è¿›ä¸€æ­¥ä»‹ç»å¦‚ä½•ä½¿ç”¨è¿™äº›é…ç½® CRD æ¥å®šåˆ¶è§„åˆ™ï¼Œä¾‹å¦‚å®ç° Traffic Splittingã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å’Œ Istio ç±»ä¼¼ï¼ŒAeraki ä¹Ÿé‡‡ç”¨äº†ç«¯å£åç§°æ¥è¯†åˆ«åè®®ç±»å‹ã€‚ç«¯å£å–åéœ€è¦éµå¾ªâ€œtcp-ä¸ƒå±‚åè®®å-xxxâ€çš„å‘½åè§„åˆ™ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª Thrift æœåŠ¡åº”å–åä¸ºâ€œtcp-thrift-serviceâ€ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»ä¿ç•™ç«¯å£åä¸­çš„â€œtcp-â€å‰ç¼€ï¼Œå› ä¸ºå¯¹äº Istio è€Œè¨€ï¼Œè¿™æ˜¯ä¸€ä¸ª TCP åè®®çš„æœåŠ¡ã€‚Aeraki åˆ™ä¼šæ ¹æ®ç«¯å£åä¸­çš„ä¸ƒå±‚åè®®æ¥ç”Ÿæˆç›¸åº”çš„ Envoy é…ç½®ï¼Œå¹¶æ›¿æ¢ Istio ç¼ºçœç”Ÿæˆçš„ tcp_proxyã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•é‡‡ç”¨ Aeraki æ¥å®ç°ä¸Šé¢ Thrift æœåŠ¡çš„ Traffic Splitting ç”¨ä¾‹ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨ Thrift Service å®šä¹‰çš„ Port å‘½åä¸­å£°æ˜è¯¥ Service çš„ä¸ƒå±‚åè®®ç±»å‹ï¼šâ€œtcp-thrift-hello-serverâ€ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª VirtualService å°† Thrift è¯·æ±‚æŒ‰ç…§æŒ‡å®šæ¯”ä¾‹è·¯ç”±åˆ°ä¸åŒçš„æœåŠ¡ç‰ˆæœ¬ä¸­ã€‚Aeraki å°†æ ¹æ®æœåŠ¡å®šä¹‰å’Œ VirtualService ç”Ÿæˆæ‰€éœ€çš„ Envoy é…ç½®ï¼Œå¹¶é€šè¿‡ EnvoyFilter å‘é€ç»™ Istioã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istiocon-layer7-traffic/images/aeraki-thrift_huae1abf41405b3559af9e1f90dab428ae_120225_90751abf946e1b41684842d32367e56a.webp 400w,
               /blog/istiocon-layer7-traffic/images/aeraki-thrift_huae1abf41405b3559af9e1f90dab428ae_120225_606d45241bb11c6a174465a19f0858f9.webp 760w,
               /blog/istiocon-layer7-traffic/images/aeraki-thrift_huae1abf41405b3559af9e1f90dab428ae_120225_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istiocon-layer7-traffic/images/aeraki-thrift_huae1abf41405b3559af9e1f90dab428ae_120225_90751abf946e1b41684842d32367e56a.webp&#34;
               width=&#34;760&#34;
               height=&#34;274&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œç›¸å¯¹äºæ‰‹åŠ¨åˆ›å»º EnvoyFilterï¼Œé‡‡ç”¨ Aeraki æ¥ç®¡ç† Thrift è¦ç®€å•å¾—å¤šã€‚å¦‚æœä¸éœ€è¦ç‰¹æ®Šçš„æµé‡è§„åˆ™ï¼Œåˆ™ä¼šæ›´ç®€å•ï¼Œåªéœ€è¦æŒ‰ç…§å‘½åè§„èŒƒåœ¨ Port åç§°ä¸­å£°æ˜ Thrift åè®®å³å¯ï¼ŒAeraki ä¼šç”Ÿæˆæ‰€éœ€çš„ Envoy é…ç½®ï¼Œæ— éœ€ä»»ä½•é¢å¤–çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è‡ªå·±è¯•è¯• Aeraki çš„ Thriftã€Dubboã€Redis æœåŠ¡ç®¡ç†èƒ½åŠ›ï¼Ÿéå¸¸ç®€å•ï¼Œåªéœ€åœ¨ä¸€ä¸ªè¿æ¥åˆ° K8s é›†ç¾¤çš„å‘½ä»¤è¡Œç»ˆç«¯ä¸Šè¿è¡Œä¸‹é¢ä¸¤è¡Œä»£ç ï¼Œå°±å¯ä»¥å®‰è£…ä¸€ä¸ªå¸¦æœ‰ Aeraki æ’ä»¶çš„ Istio é›†ç¾¤ä»¥åŠç›¸åº”çš„ Demo ç¨‹åºï¼Œæ¬¢è¿å¤§å®¶å°è¯•ï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/aeraki-framework/aeraki.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aeraki/demo/install-demo.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹Ÿå¯ä»¥è®¿é—® Aeraki çš„åœ¨çº¿ Demoï¼ŒæŸ¥çœ‹ä» Thriftã€Dubboã€Redis ç­‰æœåŠ¡æ”¶é›†åˆ°çš„ç›‘æ§æŒ‡æ ‡é¢æ¿ï¼šhttp://aeraki.zhaohuabing.com:3000/d/pgz7wp-Gz/aeraki-demo?orgId=1&amp;amp;refresh=10s&amp;amp;kiosk&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-aeraki-å¢å¼º-service-mesh&#34;&gt;ä½¿ç”¨ Aeraki å¢å¼º Service Mesh&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä½¿ç”¨ Aeraki çš„ä¸ƒå±‚åè®®ç®¡ç†èƒ½åŠ›æ¥å¢å¼º Service Mesh çš„ä¸€äº›æ¡ˆä¾‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å±è”½å¼€å‘ç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚&#34;&gt;å±è”½å¼€å‘/ç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒä¸­é€šå¸¸éœ€è¦è®¿é—®ä¸åŒçš„åç«¯èµ„æºï¼Œä¾‹å¦‚éœ€è¦è¿æ¥åˆ°ä¸åŒçš„ Redis ç¼“å­˜æˆ–è€…ä¸åŒçš„ MySQL æ•°æ®åº“ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹éšåº”ç”¨ç¨‹åºå‘å¸ƒçš„é…ç½®æ–‡ä»¶ä¸­çš„åç«¯èµ„æºåœ°å€ï¼Œä»¥è¾¾åˆ°åœ¨ä¸åŒç¯å¢ƒä¸­åˆ‡æ¢åç«¯èµ„æºçš„ç›®çš„ã€‚é€šè¿‡ Aeraki çš„å¸®åŠ©ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ Service Mesh æ¥å±è”½ä¸åŒåç«¯èµ„æºçš„é…ç½®å·®å¼‚ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºå¯ä»¥ç”¨ç›¸åŒçš„æ–¹å¼è®¿é—®ä¸åŒç¯å¢ƒä¸­çš„åç«¯èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬åœ¨ Devã€Staging å’Œ Prod ä¸‰ä¸ªç¯å¢ƒä¸­éƒ½éœ€è¦è®¿é—® Redis æœåŠ¡ï¼Œè¿™ä¸‰ä¸ª Redis æœåŠ¡æœ‰ä¸åŒçš„ IP åœ°å€å’Œè®¿é—®å¯†ç ï¼Œéƒ¨ç½²æ–¹å¼ä¹Ÿå¯èƒ½ä¸åŒï¼šåœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œä¸ºäº†èŠ‚çº¦èµ„æºå’Œç®€åŒ–éƒ¨ç½²ï¼Œæˆ‘ä»¬å¯èƒ½ä½¿ç”¨å•ä¸ª Redis å®ä¾‹ï¼›åœ¨æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ Redis é›†ç¾¤æ¥ä¿è¯ Redis æœåŠ¡çš„é«˜å¯ç”¨å’Œæ‰©å±•æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯èƒ½ç›´æ¥ä½¿ç”¨äº‘æœåŠ¡å•†æä¾›çš„ Redis æ‰˜ç®¡æœåŠ¡ã€‚å½“åœ¨è¿™ä¸‰ä¸ªç¯å¢ƒä¸­è¿›è¡Œåˆ‡æ¢æ—¶ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸åŒçš„ IP åœ°å€å’Œè®¿é—®å¯†ç ï¼Œå¦‚æœ Redis éƒ¨ç½²çš„æ–¹å¼ä¸åŒï¼Œæˆ‘ä»¬ç”šè‡³å¯èƒ½éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç æ¥åˆ‡æ¢ Redis å•å®ä¾‹æ¨¡å¼å’Œé›†ç¾¤æ¨¡å¼ï¼Œè¿™æå¤§å½±å“äº†æˆ‘ä»¬å¼€å‘ã€æµ‹è¯•å’Œä¸Šçº¿çš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istiocon-layer7-traffic/images/redis-example_hu5de80e3b1876e794b076b4ed494f82e9_875261_7586bac45e7517c79fec95d431b469ca.webp 400w,
               /blog/istiocon-layer7-traffic/images/redis-example_hu5de80e3b1876e794b076b4ed494f82e9_875261_51a3a0e07020bd2c52275e9012a13a05.webp 760w,
               /blog/istiocon-layer7-traffic/images/redis-example_hu5de80e3b1876e794b076b4ed494f82e9_875261_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istiocon-layer7-traffic/images/redis-example_hu5de80e3b1876e794b076b4ed494f82e9_875261_7586bac45e7517c79fec95d431b469ca.webp&#34;
               width=&#34;760&#34;
               height=&#34;569&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é€šè¿‡ Aeraki æä¾›çš„ RedisService å’Œ RedisDestination CRDï¼Œæˆ‘ä»¬å¯ä»¥å±è”½è¿™äº›ä¸åŒ Redis æœåŠ¡æä¾›è€…ä¹‹é—´çš„å·®å¼‚ï¼Œå…è®¸å®¢æˆ·ç«¯ä»¥ç»Ÿä¸€çš„æ–¹å¼è®¿é—®åç«¯çš„ Redis æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istiocon-layer7-traffic/images/redis-example-aeraki_hu11bd34b07d55f09124b5104aa3608b12_203291_adad2303a9bf06d4962ab20220cdb0da.webp 400w,
               /blog/istiocon-layer7-traffic/images/redis-example-aeraki_hu11bd34b07d55f09124b5104aa3608b12_203291_c9912b08cfe92faa56cb56b8aeb61270.webp 760w,
               /blog/istiocon-layer7-traffic/images/redis-example-aeraki_hu11bd34b07d55f09124b5104aa3608b12_203291_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istiocon-layer7-traffic/images/redis-example-aeraki_hu11bd34b07d55f09124b5104aa3608b12_203291_adad2303a9bf06d4962ab20220cdb0da.webp&#34;
               width=&#34;760&#34;
               height=&#34;432&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨é‡‡ç”¨ Aeraki ä¹‹å‰ï¼Œæˆ‘ä»¬åœ¨ä¸åŒçš„ç¯å¢ƒä¸­éœ€è¦é…ç½®ä¸åŒçš„ IP åœ°å€å’Œ Redis è®¿é—®å¯†ç ã€‚é‡‡ç”¨ Aeraki ä¹‹åï¼Œåœ¨å®¢æˆ·ç«¯å¯ä»¥é‡‡ç”¨ç›¸åŒçš„ä»£ç å’Œé…ç½®ï¼Œé€šè¿‡ä¿®æ”¹ Aeraki CRD æ¥åˆ‡æ¢ä¸åŒç¯å¢ƒä¸­çš„ Redis é…ç½®ï¼Œå¤§å¤§å‡å°‘åœ¨ä¸åŒç¯å¢ƒä¹‹é—´è¿›è¡Œåˆ‡æ¢çš„æˆæœ¬ã€‚å³ä½¿ Redis ä»å•å®ä¾‹æ”¹ä¸ºäº† Redis é›†ç¾¤ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥é‡‡ç”¨ç›¸åŒçš„æ–¹å¼è¿›è¡Œè®¿é—®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é‡‡ç”¨æµé‡é•œåƒè¿›è¡Œå¯¹æ¯”æµ‹è¯•&#34;&gt;é‡‡ç”¨æµé‡é•œåƒè¿›è¡Œå¯¹æ¯”æµ‹è¯•&lt;/h3&gt;
&lt;p&gt;æœ‰ä¸€äº›æ•°æ®åº“æˆ–è€…æ•°æ®åº“ä»£ç†é‡‡ç”¨ç›¸åŒçš„ç½‘ç»œåè®®ã€‚ä¾‹å¦‚ TiDBã€Oceanbaseã€Auroraã€Kingshard ç­‰éƒ½å…¼å®¹ MySQL åè®®ï¼›Twemproxyã€Codisã€Tendisã€Pika ç­‰éƒ½é‡‡ç”¨äº† Redis åè®®ã€‚ç”±äºä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘ä»¬æœ‰æ—¶éœ€è¦ä»ä¸€ä¸ªå®ç°è¿ç§»åˆ°å¦ä¸€ä¸ªå®ç°ä¸Šã€‚åœ¨è¿ç§»ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œå¯¹æ¯”æµ‹è¯•ï¼Œä»¥å¯¹æ¯”ä¸åŒå®ç°çš„æ€§èƒ½ã€åŠŸèƒ½åŠå…¼å®¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ä¸‹é¢çš„åœºæ™¯ï¼šæˆ‘ä»¬æœ€åˆåªç”¨äº†ä¸€ä¸ªå•å®ä¾‹ Redis æ¥åšç¼“å­˜ï¼Œéšç€çº¿ä¸Šä¸šåŠ¡çš„ä¸æ–­æ‰©å±•ï¼Œè¯¥ Redis å®ä¾‹å·²ç»å‡ºç°äº†è®¿é—®ç“¶é¢ˆï¼Œæˆ‘ä»¬å¸Œæœ›åˆ‡æ¢ä¸ºé‡‡ç”¨ Twemproxy æ¥å¯¹ Redis è¿›è¡Œæ°´å¹³æ‰©å±•ã€‚é€šè¿‡é‡‡ç”¨ Aeraki æ¥å°†çº¿ä¸Šçš„ Redis æµé‡é•œåƒåˆ° Twemproxy æµ‹è¯•ç¯å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨çœŸå®çš„ä¸šåŠ¡æ•°æ®å¯¹ Twemproxy è¿›è¡Œå……åˆ†çš„æµ‹è¯•ï¼Œä»¥è¯„ä¼°å…¶å¯¹çº¿ä¸Šä¸šåŠ¡çš„å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istiocon-layer7-traffic/images/database-example_hu8ab031fc0a92c30bf16985e1927a93d2_213266_d6a17ebada8be542f224ddaea8d90164.webp 400w,
               /blog/istiocon-layer7-traffic/images/database-example_hu8ab031fc0a92c30bf16985e1927a93d2_213266_a6729d7020990f215f0aaedf09404a6b.webp 760w,
               /blog/istiocon-layer7-traffic/images/database-example_hu8ab031fc0a92c30bf16985e1927a93d2_213266_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istiocon-layer7-traffic/images/database-example_hu8ab031fc0a92c30bf16985e1927a93d2_213266_d6a17ebada8be542f224ddaea8d90164.webp&#34;
               width=&#34;760&#34;
               height=&#34;284&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;é‡‡ç”¨å…¨æµé‡æ•…éšœæ³¨å…¥æµ‹è¯•ç³»ç»Ÿå¼¹æ€§&#34;&gt;é‡‡ç”¨å…¨æµé‡æ•…éšœæ³¨å…¥æµ‹è¯•ç³»ç»Ÿå¼¹æ€§&lt;/h3&gt;
&lt;p&gt;Istio å¯ä»¥å®ç° HTTP å’Œ gRPC çš„æ•…éšœæ³¨å…¥ï¼Œä½†è¿™è¿˜ä¸å¤Ÿã€‚åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåº”ç”¨æœåŠ¡ã€æ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯ç³»ç»Ÿç­‰éƒ½å¯èƒ½ç”±äºç½‘ç»œæˆ–è€…å…¶ä»–åŸå› å‡ºç°ä¸å¯ç”¨çš„æƒ…å†µã€‚é‡‡ç”¨ Aerakiï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ç³»ç»Ÿä¸­çš„æ‰€æœ‰è¿™äº›å¯èƒ½çš„æ•…éšœç‚¹è¿›è¡Œå®Œæ•´çš„æ¨¡æ‹Ÿï¼Œä»¥æµ‹è¯•ç³»ç»Ÿçš„å¼¹æ€§ï¼Œä¿è¯æˆ‘ä»¬çš„ç³»ç»Ÿåœ¨ä¸€éƒ¨åˆ†å‡ºç°é—®é¢˜åå¯ä»¥è‡ªæ„ˆæˆ–è€…é€šè¿‡é™çº§ä¿è¯ç³»ç»ŸåŸºæœ¬å¯ç”¨ï¼Œè€Œä¸è‡³äºæ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istiocon-layer7-traffic/images/fault-injection_huf1302325b16294d498fbfdf7fbd6de0a_432419_442f46521961a6157daae4bf931bbc01.webp 400w,
               /blog/istiocon-layer7-traffic/images/fault-injection_huf1302325b16294d498fbfdf7fbd6de0a_432419_873c70c9cabab767e51604d8eb021a93.webp 760w,
               /blog/istiocon-layer7-traffic/images/fault-injection_huf1302325b16294d498fbfdf7fbd6de0a_432419_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istiocon-layer7-traffic/images/fault-injection_huf1302325b16294d498fbfdf7fbd6de0a_432419_442f46521961a6157daae4bf931bbc01.webp&#34;
               width=&#34;760&#34;
               height=&#34;525&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å°ç»“&#34;&gt;å°ç»“&lt;/h2&gt;
&lt;p&gt;Service Mesh ä¸­æœ‰å¤§é‡çš„ä¸ƒå±‚åè®®æµé‡ï¼ŒåŒ…æ‹¬ RPCã€Databaseã€Cacheã€Messaging ç­‰ç±»å‹çš„ä¸ƒå±‚åè®®ï¼Œä½† Istio åªæä¾›äº† HTTP å’Œ gRPC çš„ä¸ƒå±‚ç®¡ç†èƒ½åŠ›ï¼Œå¯¹å…¶ä»–ä¸ƒå±‚åè®®çš„æ”¯æŒéå¸¸æœ‰é™ã€‚Aerkai å¼€æºé¡¹ç›®é€šè¿‡éä¾µå…¥çš„æ–¹å¼ä¸º Istio æä¾›äº†ä»»æ„ä¸ƒå±‚åè®®çš„æ”¯æŒèƒ½åŠ›ï¼Œå¹¶æä¾›äº†é¢å‘ç”¨æˆ·çš„é«˜çº§é…ç½® CRDï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹è¿™äº›åè®®çš„æµé‡è¿›è¡Œç®¡ç†ï¼Œå®ç°ç°åº¦å‘å¸ƒç­‰é«˜çº§æµé‡ç®¡ç†èƒ½åŠ›ã€‚ç›®å‰ Aeraki å·²ç»æ”¯æŒäº† Thriftã€Dubboã€Redisã€Kafkaã€Zookeeperï¼Œå¹¶å³å°†æ”¯æŒæ›´å¤šçš„åè®®ã€‚Aeraki çš„å®šä½æ˜¯åšæˆä¸€ä¸ªéä¾µå…¥å¼ Istio åŠŸèƒ½å¢å¼ºå·¥å…·é›†ï¼Œé™¤äº†åè®®æ‰©å±•ä¹‹å¤–ï¼Œè¿˜ä¼šå…³æ³¨è§£å†³åœ¨ Istio ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°çš„å…¶ä»–å¸¸è§é—®é¢˜ï¼ŒåŒ…æ‹¬æ•ˆç‡ä¼˜åŒ–ã€é…ç½®ç®€åŒ–ã€ç¬¬ä¸‰æ–¹æœåŠ¡å‘ç°æ¥å…¥ã€åŠŸèƒ½æ‰©å±•ç­‰ã€‚å¦‚æœæ‚¨å¸Œæœ›äº†è§£æ›´å¤šå…³äº Aeraki çš„å†…å®¹ï¼Œæ¬¢è¿è®¿é—® Github ä¸»é¡µ  &lt;a href=&#34;https://github.com/aeraki-framework&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/aeraki-framework&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ‹›è˜ä¿¡æ¯&lt;/strong&gt;ï¼šè…¾è®¯äº‘ Service Mesh å›¢é˜Ÿæ­£åœ¨ç«çƒ­æ‹›è˜ä¸­ï¼ŒBase æˆéƒ½ã€åŒ—äº¬ã€æ·±åœ³æˆ–è€…è¥¿å®‰ï¼Œè¦æ±‚å€™é€‰è€…ç†Ÿæ‚‰ Kubernetes/Istio/Envoyã€‚æ¬¢è¿å¤§å®¶å‘é€ç®€å†åˆ° &lt;a href=&#34;mailto:huabingzhao@tencent.com&#34;&gt;huabingzhao@tencent.com&lt;/a&gt; æˆ–è€…å¾®ä¿¡è”ç³» zhao_huabingã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒé“¾æ¥&#34;&gt;å‚è€ƒé“¾æ¥&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1XN41197Sq&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IstioCon talkâ€œHow to Manage Any Layer-7 Traffic in an Istio Service Mesh?â€è§†é¢‘å›æ”¾&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhaohuabing.com/slides/how-to-manage-any-layer-7-traffic-in-istio.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IstioCon talkâ€œHow to Manage Any Layer-7 Traffic in an Istio Service Mesh? è®²ç¨¿ä¸‹è½½&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/aeraki-framework&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Aeraki Github ä¸»é¡µ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://aeraki.zhaohuabing.com:3000/d/pgz7wp-Gz/aeraki-demo?orgId=1&amp;amp;refresh=10s&amp;amp;kiosk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Aeraki åœ¨çº¿ Demo&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ CLion æ­å»º istio-proxy (envoy) å¼€å‘ç¯å¢ƒ</title>
      <link>https://cloudnative.to/blog/use-clion-read-envoy-source/</link>
      <pubDate>Fri, 26 Feb 2021 12:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/use-clion-read-envoy-source/</guid>
      <description>&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;è¦æƒ³æ·±å…¥å­¦ä¹  istioï¼Œè¿˜å¾—å­¦ä¹ ä¸‹æ•°æ®é¢çš„å®ç°ï¼Œistio çš„æ•°æ®é¢ä½¿ç”¨äº† envoyï¼Œåœ¨ istio group ä¸‹æœ‰ä¸ªå« &lt;a href=&#34;https://github.com/istio/proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;proxy&lt;/a&gt; çš„ä»“åº“ï¼ŒåŒ…å«äº†ä¸€äº› istio ç”¨åˆ°çš„ä¸€äº› envoy æ‰©å±•ï¼Œç¼–è¯‘æ—¶å°† envoy ä»£ç ä½œä¸ºåº“æ¥å¼•ç”¨ï¼Œæœ€ç»ˆä½¿ç”¨ bazel ç¼–è¯‘å‡º istio ç‰ˆæœ¬çš„ Envoyã€‚&lt;/p&gt;
&lt;p&gt;ä»£ç é‡éå¸¸åºå¤§ï¼Œå¦‚æœæ²¡æœ‰æ™ºèƒ½çš„ä»£ç è·³è½¬ã€æŸ¥æ‰¾å¼•ç”¨ä¸å®ç°ï¼Œé˜…è¯»å’Œå¼€å‘èµ·æ¥ç®€ç›´ä½æ•ˆçš„è¦å‘½ã€‚å¦‚ä½•æ›´åŠ é«˜æ•ˆå‘¢ï¼Ÿå…³é”®åœ¨äº IDE/ç¼–è¾‘å™¨ çš„ä»£ç ç´¢å¼•èƒ½åŠ›è¦å¥½ï¼Œéœ€è¦èƒ½å¤Ÿå‡†ç¡®è·³è½¬å’ŒæŸ¥è¯¢ï¼Œvscode ç”¨çš„åŒå­¦æ¯”è¾ƒå¤šï¼Œä½†å®ƒçš„ c/c++ æ’ä»¶ä¸å¤Ÿæ™ºèƒ½ï¼Œå¾ˆå¤šæƒ…å†µæ— æ³•è·³è½¬ï¼Œè€Œä¸”æ•ˆç‡è¾ƒä½ï¼›å®ƒè¿˜æœ‰ä¸ª clangd çš„æ’ä»¶ï¼ŒåŸºäº LSPï¼Œä½†ä¸å¤Ÿæˆç†Ÿã€‚è¿™æ–¹é¢åšçš„æœ€å¥½çš„ç›®å‰è¿˜æ˜¯æ¥è‡ª JetBrains çš„ CLionï¼Œä¸è¿‡å®ƒéœ€è¦ä¾èµ– &lt;code&gt;CMakeLists.txt&lt;/code&gt; æ–‡ä»¶æ¥è§£æé¡¹ç›®ç»“æ„ï¼Œç”±äº c/c++ æ²¡æœ‰ç»Ÿä¸€çš„ç»“æ„æ ‡å‡†ï¼Œä¸åŒé¡¹ç›®ç»“æ„åƒå·®ä¸‡åˆ«ï¼Œä¸å¤ªå¥½è‡ªåŠ¨ç”Ÿæˆ &lt;code&gt;CMakeLists.txt&lt;/code&gt;ï¼Œéœ€è¦æˆ‘ä»¬å…ˆç†è§£é¡¹ç›®ç»“æ„ï¼Œç„¶åç¼–å†™ &lt;code&gt;CMakeLists.txt&lt;/code&gt; æ¥è®© CLion è¿›è¡Œè§£æã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶ç¤¾åŒºæœ‰äººé’ˆå¯¹ bazel æ„å»ºçš„é¡¹ç›®å†™äº†ä¸€ä¸ªé€šç”¨è„šæœ¬ &lt;a href=&#34;https://github.com/lizan/bazel-cmakelists&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bazel-cmakelists&lt;/a&gt; ï¼Œä½†å¾ˆä¹…æ²¡ç»´æŠ¤ï¼Œæµ‹è¯•äº†ç”¨å®ƒæ¥ç”Ÿæˆæœ€æ–° envoy çš„ &lt;code&gt;CMakeLists.txt&lt;/code&gt; ï¼Œç”±äºä»£ç é‡åºå¤§ï¼Œæœ€ç»ˆä¼š OOM è€Œå¤±è´¥ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¦å¯»æ›´å¥½çš„æ–¹æ³•ï¼Œä¸å¤ªäº†è§£è¿™æ–¹é¢çš„åŒå­¦å¼„èµ·æ¥ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œæœ¬äººä¹ŸæŠ˜è…¾äº†å¥½ä¸€æ®µæ—¶é—´æ‰æå®šï¼Œæœ¬æ–‡è®°å½•ä¸‹æ–¹æ³•å’Œå¿ƒå¾—ï¼Œä»¥ä¾›å¤§å®¶å‚è€ƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…‹éš†ä»£ç &#34;&gt;å…‹éš†ä»£ç &lt;/h2&gt;
&lt;p&gt;é¦–å…ˆå…‹éš† &lt;a href=&#34;https://github.com/istio/proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;istio-proxy&lt;/a&gt; çš„ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/istio/proxy.git istio-proxy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€å¥½åˆ‡åˆ°æŸä¸ªç¨³å®šçš„ release åˆ†æ”¯ä¸Šï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; istio-proxy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git checkout -b release-1.9 origin/release-1.9
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;é¡¹ç›®åˆ†æ&#34;&gt;é¡¹ç›®åˆ†æ&lt;/h2&gt;
&lt;p&gt;istio-proxy ä»£ç åº“ä¸­ä¸»è¦åªåŒ…å«äº†åœ¨ istio é‡Œç”¨åˆ°çš„ä¸€äº› envoy æ‰©å±•ï¼Œä»£ç é‡ä¸å¤§ï¼Œæºç ä¸»è¦åˆ†å¸ƒåœ¨ src ä¸ extensions ç›®å½•ï¼Œä½†ç¼–è¯‘éœ€è¦å¾ˆä¹…ï¼Œå› ä¸ºå®ƒå®é™…ç¼–è¯‘çš„æ˜¯ envoyï¼Œåªæ˜¯åˆ©ç”¨ bazel å°†è‡ªèº«ä»£ç ä½œä¸ºæ‰©å±•ç¼–è¯‘è¿› envoyï¼ˆå¾—ç›Šäº envoy çš„æ‰©å±•æœºåˆ¶ï¼‰ï¼Œä»è¿™ä¸ª bazel çš„ &lt;a href=&#34;https://github.com/istio/proxy/blob/master/src/envoy/BUILD&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;BUILD æ–‡ä»¶&lt;/a&gt; å°±èƒ½çœ‹å¾—å‡ºæ¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-txt&#34; data-lang=&#34;txt&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy_cc_binary(
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    name = &amp;#34;envoy&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    repository = &amp;#34;@envoy&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    visibility = [&amp;#34;//visibility:public&amp;#34;],
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    deps = [
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;//extensions/access_log_policy:access_log_policy_lib&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;//extensions/attributegen:attributegen_plugin&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;//extensions/metadata_exchange:metadata_exchange_lib&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;//extensions/stackdriver:stackdriver_plugin&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;//extensions/stats:stats_plugin&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;//src/envoy/extensions/wasm:wasm_lib&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;//src/envoy/http/alpn:config_lib&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;//src/envoy/http/authn:filter_lib&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;//src/envoy/tcp/forward_downstream_sni:config_lib&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;//src/envoy/tcp/metadata_exchange:config_lib&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;//src/envoy/tcp/sni_verifier:config_lib&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;//src/envoy/tcp/tcp_cluster_rewrite:config_lib&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;@envoy//source/exe:envoy_main_entry_lib&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ],
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ &lt;code&gt;@envoy&lt;/code&gt; è¡¨ç¤ºå¼•ç”¨ envoy ä»£ç åº“ï¼Œmain å‡½æ•°ä¹Ÿä½äº envoy ä»£ç åº“ä¸­ã€‚é‚£ä¹ˆ envoy ä»£ç åº“ä»å“ªå„¿æ¥çš„å‘¢ï¼Ÿbazel åœ¨æ„å»ºæ—¶ä¼šè‡ªåŠ¨ä¸‹è½½æŒ‡å®šçš„ä¾èµ–ï¼Œenvoy çš„ä»£ç æ¥æºåœ¨ &lt;a href=&#34;https://github.com/istio/proxy/blob/master/WORKSPACE&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WORKSPACE&lt;/a&gt; ä¸­æœ‰æŒ‡å®šï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-txt&#34; data-lang=&#34;txt&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;http_archive(
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    name = &amp;#34;envoy&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    sha256 = ENVOY_SHA256,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    strip_prefix = ENVOY_REPO + &amp;#34;-&amp;#34; + ENVOY_SHA,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    url = &amp;#34;https://github.com/&amp;#34; + ENVOY_ORG + &amp;#34;/&amp;#34; + ENVOY_REPO + &amp;#34;/archive/&amp;#34; + ENVOY_SHA + &amp;#34;.tar.gz&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;bazel ä¼šè‡ªåŠ¨ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„æºç åŒ…æ¥ç¼–è¯‘ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¦‚æœè·å–ä¾èµ–æºæ–‡ä»¶&#34;&gt;å¦‚æœè·å–ä¾èµ–æºæ–‡ä»¶ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ç”±äº istio-proxy ä¾èµ–äº†å¤§é‡çš„ç¬¬ä¸‰æ–¹æºæ–‡ä»¶ï¼Œæˆ‘ä»¬è¦é˜…è¯»ä»£ç éœ€è¦å°†è¿™äº›æºæ–‡ä»¶éƒ½ä¸‹ä¸‹æ¥ï¼Œåªè¦å°†å®ƒç¼–è¯‘ä¸€æ¬¡ï¼Œæ‰€æœ‰ä¾èµ–æºæ–‡ä»¶ä»¥åŠ generated çš„ä»£ç éƒ½å¯ä»¥è‡ªåŠ¨ç»™ä½ å¤‡å¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹å®ƒè¿›è¡Œä¸€æ¬¡ç¼–è¯‘ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºç¼–è¯‘ envoy æœ‰å¤æ‚çš„å·¥å…·é“¾ä¾èµ–ï¼Œå®˜æ–¹æ¨èä½¿ç”¨å®¹å™¨è¿›è¡Œç¼–è¯‘ï¼Œåœ¨æ‰§è¡Œ &lt;code&gt;make&lt;/code&gt; å‰åŠ ä¸ª &lt;code&gt;BUILD_WITH_CONTAINER=1&lt;/code&gt; å³å¯æŒ‡å®šä½¿ç”¨å®¹å™¨ç¼–è¯‘ï¼Œå…å»å¤æ‚çš„ç¯å¢ƒä¾èµ–ã€‚ä½† bazel ç¼–è¯‘ä¼šå°†ä¾èµ–å’Œ generated çš„æºæ–‡ä»¶éƒ½è½¯é“¾åˆ°ä¸´æ—¶ç›®å½•ï¼Œå¦‚æœç”¨å®¹å™¨ç¼–è¯‘ï¼Œå°±ä¼šä¸¢å¤±è¿™éƒ¨åˆ†ä»£ç ï¼Œè€Œæˆ‘ä»¬é˜…è¯» istio-proxy ä»£ç æ—¶æœ€å…³é”®çš„å°±æ˜¯è¿™éƒ¨åˆ†ä»£ç äº†ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨å®¹å™¨ç¼–è¯‘ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…-bazelisk&#34;&gt;å®‰è£… bazelisk&lt;/h2&gt;
&lt;p&gt;ä¸ç”¨å®¹å™¨ç¼–è¯‘å°±éœ€è¦æœ¬æœºç¯å¢ƒåŸºæœ¬æ»¡è¶³å·¥å…·é“¾è¦æ±‚ï¼Œé¦–å…ˆæ˜¯éœ€è¦å®‰è£… bazelï¼Œç”±äº bazel ç‰ˆæœ¬å¾ˆå¤šï¼Œä¸åŒ istio-proxy (envoy) ç‰ˆæœ¬ä¾èµ–çš„ bazel ç‰ˆæœ¬ä¹Ÿä¸ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å®‰è£… &lt;a href=&#34;https://github.com/bazelbuild/bazelisk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bazelisk&lt;/a&gt; ï¼Œä¸€ä¸ªç”¨äº bazel å¤šç‰ˆæœ¬ç®¡ç†çš„å·¥å…·ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨è¯†åˆ«é¡¹ç›®ä¸­ &lt;a href=&#34;https://github.com/istio/proxy/blob/master/.bazelversion&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;.bazelversion&lt;/a&gt; æ–‡ä»¶ï¼Œé€‰å–æŒ‡å®šç‰ˆæœ¬çš„ bazel æ¥è¿›è¡Œæ„å»ºï¼ˆå¯ä»¥è‡ªåŠ¨ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ bazel äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯ macOS ç”¨æˆ·ï¼Œå®‰è£…å¾ˆç®€å•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;brew install bazelisk
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å¦‚æœä¹‹å‰å·²å®‰è£…è¿‡ bazelï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;brew link --overwrite bazelisk&lt;/code&gt; å¼ºåˆ¶è¦†ç›–ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…¶å®ƒå¹³å°çš„å¯ä»¥åœ¨ &lt;a href=&#34;https://github.com/bazelbuild/bazelisk/releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;release&lt;/a&gt; é¡µé¢ä¸‹è½½æœ€æ–°çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé‡å‘½åä¸º &lt;code&gt;bazel&lt;/code&gt; ç„¶åæ”¾åˆ° &lt;code&gt;PATH&lt;/code&gt; ä¸‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…¶å®ƒä¾èµ–&#34;&gt;å…¶å®ƒä¾èµ–&lt;/h2&gt;
&lt;p&gt;å¦‚æœæ˜¯ macOS ç”¨æˆ·ï¼Œç¡®ä¿åŠ¡å¿…å®‰è£…å¥½ xcodeï¼Œæ–¹ä¾¿è·³è½¬ç³»ç»Ÿåº“å‡½æ•°ï¼Œå®‰è£…å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xcode-select --install
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦å¤–ä¸»è¦è¿˜æœ‰ python3ï¼ˆmacOS è‡ªå¸¦ï¼‰ï¼Œå…¶å®ƒä¾èµ–é€šå¸¸éƒ½ç³»ç»Ÿè‡ªå¸¦ï¼Œå¯ä»¥å…ˆä¸ç”¨ç®¡ï¼Œç­‰å¦‚æœç¼–è¯‘æŠ¥é”™äº†å†çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;æ›´å¤šä¾èµ–å¯å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/start/building#requirements&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼–è¯‘&#34;&gt;ç¼–è¯‘&lt;/h2&gt;
&lt;p&gt;åœ¨ istio-proxy ä»£ç æ ¹ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make build_envoy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¯å¢ƒæ²¡é—®é¢˜çš„è¯ä¼šç»è¿‡æ¼«é•¿çš„æ„å»ºå’Œç¼–è¯‘ï¼Œé€šå¸¸å¯èƒ½å‡ ååˆ†é’Ÿï¼Œå–å†³äºç”µè„‘é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ç¼–è¯‘å®Œåä¼šå‘ç° bazel ä¸ºæˆ‘ä»¬ç”Ÿæˆäº†ä¸€äº›ç›®å½•è½¯é“¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-1_hu1d3eef741008757970ff2272bba31166_76427_78e987efd75fc14571b4d7fdd9b2b753.webp 400w,
               /blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-1_hu1d3eef741008757970ff2272bba31166_76427_78859c8afea179b977c38a16b4184150.webp 760w,
               /blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-1_hu1d3eef741008757970ff2272bba31166_76427_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-1_hu1d3eef741008757970ff2272bba31166_76427_78e987efd75fc14571b4d7fdd9b2b753.webp&#34;
               width=&#34;760&#34;
               height=&#34;50&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;bazel è¾“å‡ºç›®å½•ç»“æ„å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ &lt;a href=&#34;https://docs.bazel.build/versions/master/output_directories.html#layout-diagram&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Output Directory Layout&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬ä¸»è¦å…³æ³¨ä»¥ä¸‹ä¸¤ä¸ªç›®å½•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;bazel-istio-proxy&lt;/strong&gt;ï¼šåŒ…å«æ„å»º istio-proxy ç”¨åˆ°çš„æºæ–‡ä»¶ï¼ˆåŒ…å«ä¾èµ–ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;bazel-bin&lt;/strong&gt;ï¼šåŒ…å«ä¸€äº› generated ä»£ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç”Ÿæˆæºç æ–‡ä»¶åˆ—è¡¨&#34;&gt;ç”Ÿæˆæºç æ–‡ä»¶åˆ—è¡¨&lt;/h2&gt;
&lt;p&gt;åœ¨ istio-proxy æ ¹ç›®å½•åˆ›å»ºè„šæœ¬æ–‡ä»¶ &lt;code&gt;generate-srcs.sh&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; -ex
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;bazel_dir&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;bazel-&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;PWD&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;##*/&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;find -L -E &lt;span class=&#34;nv&#34;&gt;$bazel_dir&lt;/span&gt;/external src extensions -regex &lt;span class=&#34;s1&#34;&gt;&amp;#39;.*\.(cc|c|cpp)&amp;#39;&lt;/span&gt; &amp;gt; sourcefiles.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œæ­¤è„šæœ¬å¯ä»¥ç”Ÿæˆ istio-proxy åŠå…¶ä¾èµ–çš„æºæ–‡ä»¶åˆ—è¡¨ï¼ˆ&lt;code&gt;sourcefiles.txt&lt;/code&gt;ï¼‰ï¼Œç”¨äºåœ¨ &lt;code&gt;CMakeLists.txt&lt;/code&gt; ä¸­å¼•ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨ï¼š&lt;/strong&gt; &lt;code&gt;$bazel_dir/external&lt;/code&gt; ä¸‹åŒ…å«å†…å®¹è¾ƒå¤šï¼Œå…¨éƒ¨ç´¢å¼•çš„è¯ CLion å¯èƒ½ä¼šæ¯”è¾ƒå¡ï¼Œå¾ˆå¤šä»£ç åŸºæœ¬ä¹Ÿéƒ½ä¸ä¼šçœ‹ï¼Œå¯ä»¥é€‚å½“ç¼©å°èŒƒå›´ï¼ŒæŒ‰éœ€æ¥é…ç½®ï¼Œæ¯”å¦‚å…ˆåªæ·»åŠ  &lt;code&gt;$bazel_dir/external/envoy&lt;/code&gt;ï¼Œåç»­æœ‰éœ€è¦å†æ·»åŠ å…¶å®ƒç›®å½•ï¼Œç„¶å &lt;code&gt;Reload Cmake Project&lt;/code&gt; é‡æ–°ç´¢å¼•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç”Ÿæˆ-cmakeliststxt&#34;&gt;ç”Ÿæˆ CMakeLists.txt&lt;/h2&gt;
&lt;p&gt;ç„¶åå°±å¯ä»¥åœ¨ istio-proxy é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸‹ &lt;code&gt;CMakeLists.txt&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-txt&#34; data-lang=&#34;txt&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cmake_minimum_required(VERSION 3.15)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;STRING( REGEX REPLACE &amp;#34;.*/(.*)&amp;#34; &amp;#34;\\1&amp;#34; CURRENT_FOLDER ${CMAKE_CURRENT_SOURCE_DIR} )
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;project(istio-proxy)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;macro(print_all_variables)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    message(STATUS &amp;#34;print_all_variables------------------------------------------{&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    get_cmake_property(_variableNames VARIABLES)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    foreach (_variableName ${_variableNames})
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        message(STATUS &amp;#34;${_variableName}=${${_variableName}}&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    endforeach()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    message(STATUS &amp;#34;print_all_variables------------------------------------------}&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;endmacro()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;set(CMAKE_CXX_STANDARD 17)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;add_definitions(-DNULL_PLUGIN) # enable wasm nullvm navigation
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;file(STRINGS sourcefiles.txt all_SRCS)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;message(STATUS &amp;#34;CMAKE_SOURCE_DIR=${CMAKE_SOURCE_DIR}&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;message(STATUS &amp;#34;CMAKE_HOME_DIRECTORY=${CMAKE_HOME_DIRECTORY}&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;add_executable(istio-proxy ${all_SRCS})
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;set(istio_include_dirs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./src&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./extensions&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/envoy&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/envoy/source&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/envoy/include&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/envoy/api/wasm/cpp&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/boringssl/src/include/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_gabime_spdlog/include&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_c_ares_c_ares&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_google_absl&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_google_cel_cpp&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_google_protobuf/src&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_fmtlib_fmt/include&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_eile_tclap/include&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_grpc_grpc/include&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_envoyproxy_protoc_gen_validate/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_tencent_rapidjson/include/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_datadog_dd_opentracing_cpp/include/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_libevent_libevent/include&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_mirror_tclap/include&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_grpc_grpc&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_circonus_labs_libcircllhist/src/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_nodejs_http_parser&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_nghttp2_nghttp2/lib/includes/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_cyan4973_xxhash/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_google_flatbuffers/include/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-${CURRENT_FOLDER}/external/com_github_fmtlib_fmt/test&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-bin&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-bin/external/envoy_api&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-bin/external/mixerapi_git&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-bin/external/com_envoyproxy_protoc_gen_validate&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-bin/external/com_google_googleapis&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &amp;#34;./bazel-bin/external/com_github_cncf_udpa&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target_include_directories(istio-proxy PUBLIC ${istio_include_dirs})
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§£é‡Šä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;add_executable&lt;/code&gt; å°†éœ€è¦ç´¢å¼•çš„æºæ–‡ä»¶åˆ—è¡¨ (&lt;code&gt;sourcefiles.txt&lt;/code&gt;) åŠ è¿›ç´¢å¼•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;target_include_directories&lt;/code&gt; å°†ç”¨åˆ°çš„ä¸€äº›çº¯å¤´æ–‡ä»¶ç›®å½•åŠ è¿›ç´¢å¼•ï¼ˆä¸åŒ…å«å®ç°ä»£ç ï¼Œä¸»è¦æ˜¯ä¸€äº›æ¥å£ï¼‰ï¼Œè¿™é‡Œä¹Ÿæ˜¯å¯ä»¥æŒ‰éœ€è¿›è¡Œå¢åˆ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä½¿ç”¨-clion-é˜…è¯»&#34;&gt;ä½¿ç”¨ CLion é˜…è¯»&lt;/h2&gt;
&lt;p&gt;ä¸è¦ç›´æ¥æ‰“å¼€ istio-proxy ç›®å½•ï¼Œè€Œæ˜¯ Open æ—¶é€‰ä¸­ &lt;code&gt;CMakeLists.txt&lt;/code&gt;ï¼Œç„¶å &lt;code&gt;Open as Project&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-2_hufb07b5843625af2ecac86d2e10c36e7a_15111_00d886ba6a67bc0708066bf5471e65b6.webp 400w,
               /blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-2_hufb07b5843625af2ecac86d2e10c36e7a_15111_53cb171b10e61502e3cb01466720880b.webp 760w,
               /blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-2_hufb07b5843625af2ecac86d2e10c36e7a_15111_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-2_hufb07b5843625af2ecac86d2e10c36e7a_15111_00d886ba6a67bc0708066bf5471e65b6.webp&#34;
               width=&#34;454&#34;
               height=&#34;148&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¼¹å‡º &lt;code&gt;Load Project&lt;/code&gt; æ—¶ä¸è¦å‹¾é€‰ &lt;code&gt;Clean project&lt;/code&gt;ï¼Œä¸ç„¶é€€å‡º CLion æ—¶ä¼šæ‰§è¡Œ &lt;code&gt;make clean&lt;/code&gt;ï¼Œå¯¼è‡´æŠŠ bazel ç”Ÿæˆçš„æºæ–‡ä»¶éƒ½ç»™åˆ é™¤æ‰ï¼Œå°±æ²¡æ³•è·³è½¬äº†ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-6_hu7201e749b27ede544db3edff38b49647_17994_484f78a816b80404337cb2a4e9057f14.webp 400w,
               /blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-6_hu7201e749b27ede544db3edff38b49647_17994_87036bfd560ae3f0eb27cc265b2edb67.webp 760w,
               /blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-6_hu7201e749b27ede544db3edff38b49647_17994_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-6_hu7201e749b27ede544db3edff38b49647_17994_484f78a816b80404337cb2a4e9057f14.webp&#34;
               width=&#34;760&#34;
               height=&#34;183&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç„¶åå°±ä¼šå¼€å§‹ç´¢å¼•ï¼Œå®Œæˆåå°±å¯ä»¥æ„‰å¿«çš„çœ‹ä»£ç äº†ï¼Œå…ˆä» main çœ‹èµ·å§ (&lt;code&gt;bazel-istio-proxy/external/envoy/source/exe/main.cc&lt;/code&gt;):&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34;
           src=&#34;https://cloudnative.to/blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-3.gif&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æŸ¥æ‰¾å¼•ç”¨ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-4_hua83b4d540b579914bbe30223bd9a8c99_392530_86135113b0d260f9508be52628b53094.webp 400w,
               /blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-4_hua83b4d540b579914bbe30223bd9a8c99_392530_a586cf993d64cad5353842f71151e5b5.webp 760w,
               /blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-4_hua83b4d540b579914bbe30223bd9a8c99_392530_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-4_hua83b4d540b579914bbe30223bd9a8c99_392530_86135113b0d260f9508be52628b53094.webp&#34;
               width=&#34;760&#34;
               height=&#34;446&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è·³è½¬åˆ°å®ç°ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34;
           src=&#34;https://cloudnative.to/blog/use-clion-read-envoy-source/use-clion-read-envoy-source-code-5.gif&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å°ç»“&#34;&gt;å°ç»“&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ CLion æ¥é˜…è¯» istio-proxy (envoy) çš„ä»£ç ï¼ŒåŒ…å«æºç ç»“æ„åˆ†æã€ç¯å¢ƒæ­å»ºï¼Œä»¥åŠç”Ÿæˆ CLion æ‰€éœ€è¦çš„ &lt;code&gt;CMakeLists.txt&lt;/code&gt; æ–‡ä»¶çš„æ–¹æ³•ï¼Œæœ€åä¹Ÿå±•ç¤ºäº†æ•ˆæœï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Envoy HTTP è¿æ¥ç®¡ç†</title>
      <link>https://cloudnative.to/blog/envoy-http-connection-management/</link>
      <pubDate>Thu, 31 Dec 2020 10:03:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-http-connection-management/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ª Envoy å®˜æ–¹æ–‡æ¡£ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/http/http_connection_management&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP connection management&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;http-è¿æ¥ç®¡ç†&#34;&gt;HTTP è¿æ¥ç®¡ç†&lt;/h2&gt;
&lt;p&gt;HTTP æ˜¯ç°ä»£é¢å‘æœåŠ¡ä½“ç³»æ¶æ„çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼ŒEnvoy å®ç°äº†å¤§é‡çš„ HTTP ç‰¹å®šåŠŸèƒ½ã€‚Envoy å†…ç½®äº†ä¸€ä¸ªå« &lt;a href=&#34;https://cloudnative.to/envoy/configuration/http/http_conn_man/http_conn_man.html#config-http-conn-man&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP è¿æ¥ç®¡ç†å™¨&lt;/a&gt; çš„ç½‘ç»œå±‚è¿‡æ»¤å™¨ã€‚æ­¤è¿‡æ»¤å™¨å°†åŸå§‹å­—èŠ‚è½¬æ¢ä¸º HTTP åè®®çš„æ¶ˆæ¯å’Œäº‹ä»¶ï¼Œä¾‹å¦‚ï¼Œè¯·æ±‚å¤´æ¥æ”¶ã€è¯·æ±‚ä½“æ•°æ®æ¥æ”¶ã€è¯·æ±‚æ ‡å°¾ (trailers) æ¥æ”¶ç­‰ã€‚è¿‡æ»¤å™¨åŒæ—¶å¤„ç†æ‰€æœ‰ HTTP è¿æ¥å’Œè¯·æ±‚çš„é€šç”¨åŠŸèƒ½ï¼Œä¾‹å¦‚ &lt;a href=&#34;https://cloudnative.to/envoy/intro/arch_overview/observability/access_logging.html#arch-overview-access-logs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¿é—®æ—¥å¿—&lt;/a&gt;ã€ &lt;a href=&#34;https://cloudnative.to/envoy/intro/arch_overview/observability/tracing.html#arch-overview-tracing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯·æ±‚ ID ç”Ÿæˆä¸è¿½è¸ª&lt;/a&gt;ã€ &lt;a href=&#34;https://cloudnative.to/envoy/configuration/http/http_conn_man/headers.html#config-http-conn-man-headers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯·æ±‚å¤´/å“åº”å¤´çš„æ“ä½œ&lt;/a&gt;ã€ &lt;a href=&#34;https://cloudnative.to/envoy/intro/arch_overview/http/http_routing.html#arch-overview-http-routing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯ç”±è¡¨&lt;/a&gt; ç®¡ç†å’Œ &lt;a href=&#34;https://cloudnative.to/envoy/configuration/http/http_conn_man/stats.html#config-http-conn-man-stats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç»Ÿè®¡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;HTTP è¿æ¥ç®¡ç†å™¨ &lt;a href=&#34;https://cloudnative.to/envoy/configuration/http/http_conn_man/http_conn_man.html#config-http-conn-man&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é…ç½®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;http-åè®®&#34;&gt;HTTP åè®®&lt;/h2&gt;
&lt;p&gt;Envoy çš„ HTTP è¿æ¥ç®¡ç†å™¨åŸç”Ÿæ”¯æŒ HTTP/1.1ã€WebSockets å’Œ HTTP/2ã€‚ç°åœ¨è¿˜ä¸æ”¯æŒ SPDYã€‚Envoy HTTP è®¾è®¡çš„é¦–è¦ç›®æ ‡æ˜¯æˆä¸ºä¸€ä¸ª HTTP/2 å¤šè·¯å¤ç”¨ä»£ç†ã€‚åœ¨å†…éƒ¨ï¼ŒHTTP/2 æœ¯è¯­ç”¨äºæè¿°ç³»ç»Ÿç»„ä»¶ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª HTTP è¯·æ±‚å’Œå“åº”å‘ç”Ÿåœ¨æµä¸Šã€‚ä¸€ä¸ªç¼–è§£ç  API è¢«ç”¨æ¥å°†ä¸åŒçš„ç”µæŠ¥åè®®è½¬æ¢ä¸ºæµã€è¯·æ±‚ã€å“åº”ç­‰åè®®æ— å…³çš„æ ¼å¼ã€‚å¯¹äº HTTP/1.1 æ¥è¯´ï¼Œç¼–è§£ç å™¨å°†åè®®çš„ä¸²è¡Œ/æµåŠŸèƒ½è½¬æ¢æˆåƒ HTTP/2 çš„æŸäº›ä¸œè¥¿æä¾›ç»™æ›´é«˜å±‚çº§ã€‚è¿™æ„å‘³ç€å¤§éƒ¨åˆ†ä»£ç ä¸éœ€è¦ç†è§£ä¸€ä¸ªæµæ˜¯æ¥è‡ª HTTP/1.1 è¿˜æ˜¯ HTTP/2 è¿æ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;http-å¤´æ¸…ç†&#34;&gt;HTTP å¤´æ¸…ç†&lt;/h2&gt;
&lt;p&gt;HTTP è¿æ¥ç®¡ç†å™¨æ‰§è¡Œå„ç§ &lt;a href=&#34;https://cloudnative.to/envoy/configuration/http/http_conn_man/header_sanitizing.html#config-http-conn-man-header-sanitizing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤´æ¸…ç†&lt;/a&gt; æ“ä½œä¸ºäº†å®‰å…¨å› ç´ ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è·¯ç”±è¡¨é…ç½®&#34;&gt;è·¯ç”±è¡¨é…ç½®&lt;/h2&gt;
&lt;p&gt;æ¯ä¸€ä¸ª &lt;a href=&#34;https://cloudnative.to/envoy/configuration/http/http_conn_man/http_conn_man.html#config-http-conn-man&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP è¿æ¥ç®¡ç†è¿‡æ»¤å™¨&lt;/a&gt; æœ‰ä¸€ä¸ªç›¸å…³çš„ &lt;a href=&#34;https://cloudnative.to/envoy/intro/arch_overview/http/http_routing.html#arch-overview-http-routing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯ç”±è¡¨&lt;/a&gt;ã€‚è·¯ç”±è¡¨å¯ä»¥ä½¿ç”¨ä¸‹é¢ä¸¤ç§ä¹‹ä¸€æ¥é…ç½®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é™æ€é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;åŸºäº &lt;a href=&#34;https://cloudnative.to/envoy/configuration/http/http_conn_man/rds.html#config-http-conn-man-rds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RDS API&lt;/a&gt; çš„åŠ¨æ€é…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é‡è¯•æ’ä»¶é…ç½®&#34;&gt;é‡è¯•æ’ä»¶é…ç½®&lt;/h2&gt;
&lt;p&gt;é€šå¸¸åœ¨é‡è¯•æœŸé—´ï¼Œä¸»æœºé€‰æ‹©éµå¾ªä¸åŸå§‹è¯·æ±‚ç›¸åŒçš„è¿‡ç¨‹ã€‚é‡è¯•æ’ä»¶å¯ä»¥ç”¨æ¥ä¿®æ”¹è¿™ç§è¡Œä¸ºï¼Œå®ƒä»¬åˆ†ä¸ºä¸¤ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://cloudnative.to/envoy/api-v3/config/route/v3/route_components.proto.html#envoy-v3-api-field-config-route-v3-retrypolicy-retry-host-predicate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸»æœºè°“è¯&lt;/a&gt;ï¼šè¿™äº›è°“è¯å¯ä»¥ç”¨æ¥â€œæ‹’ç»â€ä¸€ä¸ªä¸»æœºï¼Œå°†å¯¼è‡´é‡æ–°å°è¯•ä¸»æœºé€‰æ‹©ã€‚å¯ä»¥æŒ‡å®šä»»æ„æ•°é‡çš„è°“è¯ï¼Œå¦‚æœä»»ä½•è°“è¯æ‹’ç»ä¸»æœºï¼Œåˆ™ä¸»æœºå°†è¢«æ‹’ç»ã€‚&lt;/p&gt;
&lt;p&gt;Envoy æ”¯æŒä»¥ä¸‹å†…ç½®çš„ä¸»æœºè°“è¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;envoy.retry_host_predicates.previous_hosts&lt;/em&gt;ï¼šè¿™å°†è·Ÿè¸ªä»¥å‰å°è¯•è¿‡çš„ä¸»æœºå¹¶ä¸”æ‹’ç»å·²ç»å°è¯•è¿‡çš„ä¸»æœºã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;envoy.retry_host_predicates.omit_canary_hosts&lt;/em&gt;ï¼šè¿™å°†æ‹’ç»ä»»ä½•è¢«æ ‡è®°ä¸ºé‡‘ä¸é›€ä¸»æœºçš„ä¸»æœºã€‚é€šè¿‡åœ¨è¿‡æ»¤å™¨å…ƒæ•°æ®ä¸­ä¸º &lt;code&gt;envoy.lb&lt;/code&gt; è¿‡æ»¤å™¨è®¾ç½® &lt;code&gt;canary: true&lt;/code&gt; æ¥æ ‡è®°ä¸»æœºã€‚æŸ¥çœ‹ &lt;a href=&#34;https://cloudnative.to/envoy/api-v3/config/endpoint/v3/endpoint_components.proto.html#envoy-v3-api-msg-config-endpoint-v3-lbendpoint&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;LbEndpoint&lt;/a&gt; è·å¾—æ›´å¤šä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;envoy.retry_host_predicates.omit_host_metadata&lt;/em&gt;ï¼šè¿™å°†æ‹’ç»ä»»ä½•ç¬¦åˆé¢„å®šä¹‰æ¡ä»¶çš„ä¸»æœºã€‚æŸ¥çœ‹ä¸‹é¢çš„é…ç½®ç¤ºä¾‹è·å¾—æ›´å¤šä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://cloudnative.to/envoy/api-v3/config/route/v3/route_components.proto.html#envoy-v3-api-field-config-route-v3-retrypolicy-retry-priority&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¼˜å…ˆçº§è°“è¯&lt;/a&gt;ï¼šè¿™ç±»è°“è¯å¯ä»¥ç”¨æ¥åœ¨ä¸ºä¸€ä¸ªé‡è¯•å°è¯•é€‰æ‹©ä¼˜å…ˆçº§æ—¶è°ƒæ•´è´Ÿè½½çš„ä¼˜å…ˆçº§ã€‚åªå¯ä»¥å®šä¹‰ ä¸€ä¸ªè¿™æ ·çš„è°“è¯ã€‚&lt;/p&gt;
&lt;p&gt;Envoy å†…ç½®æ”¯æŒä¸‹é¢çš„ä¼˜å…ˆçº§è°“è¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;envoy.retry_priorities.previous_priorities&lt;/em&gt;ï¼šè¿™å°†è·Ÿè¸ªä»¥å‰å°è¯•è¿‡çš„ä¼˜å…ˆçº§ï¼Œå¹¶è°ƒæ•´ä¼˜å…ˆçº§è´Ÿè½½ï¼Œä»¥ä¾¿åœ¨åç»­é‡è¯•ä¸­å°†å…¶ä»–ä¼˜å…ˆçº§ä½œä¸ºç›®æ ‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸»æœºé€‰æ‹©å°†ä¼šç»§ç»­ç›´åˆ°é…ç½®çš„è°“è¯æ¥å—ä¸»æœºæˆ–è€…è¾¾åˆ°äº†é…ç½®çš„ &lt;a href=&#34;https://cloudnative.to/envoy/api-v3/config/route/v3/route_components.proto.html#envoy-v3-api-field-config-route-v3-retrypolicy-host-selection-retry-max-attempts&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ€å¤§å°è¯•æ¬¡æ•°&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥ç»„åˆä½¿ç”¨è¿™äº›æ’ä»¶æ¥å½±å“ä¸»æœºé€‰æ‹©å’Œä¼˜å…ˆçº§ã€‚Envoy ä¹Ÿå¯ä»¥åƒæ·»åŠ è¿‡æ»¤å™¨ä¸€æ ·é€šè¿‡è‡ªå®šä¹‰çš„é‡è¯•æ’ä»¶è¿›è¡Œæ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®ç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œæƒ³è¦é…ç½®ä¼˜å…ˆé‡è¯•æ²¡æœ‰å°è¯•è¿‡çš„ä¸»æœºï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„ &lt;code&gt;envoy.retry_host_predicates.previous_hosts&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;retry_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;retry_host_predicate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.retry_host_predicates.previous_hosts&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host_selection_retry_max_attempts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†æ‹’ç»å·²ç»å°è¯•è¿‡çš„ä¸»æœºï¼Œå¹¶ä¸”æœ€å¤šå°è¯• 3 æ¬¡ä¸»æœºé€‰æ‹©ã€‚ä¸ºäº†å¤„ç†å¯»æ‰¾ä¸€ä¸ªå¯ç”¨ä¸»æœºè¿‡ç¨‹ä¸­ä¸å¯èƒ½å‘ç”Ÿï¼ˆæ²¡æœ‰ä¸»æœºæ»¡è¶³è°“è¯ï¼‰æˆ–è€…ä¸å¤ªå¯èƒ½å‘ç”Ÿï¼ˆå”¯ä¸€ åˆé€‚çš„ä¸»æœºç›¸å¯¹æƒé‡éå¸¸ä½ï¼‰çš„æƒ…å†µï¼Œå°è¯•æ¬¡æ•°çš„ä¸Šé™æ˜¯æœ‰å¿…è¦çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®ä¸»æœºçš„å…ƒæ•°æ®æ‹’ç»ä¸»æœºï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;envoy.retry_host_predicates.omit_host_metadata&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;retry_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;retry_host_predicate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.retry_host_predicates.omit_host_metadata&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.retry.host.omit_host_metadata.v3.OmitHostMetadataConfig&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata_match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;envoy.lb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†æ‹’ç»ä»»ä½•åŒ¹é…å…ƒæ•°æ®ä¸­å­˜åœ¨ï¼ˆkeyï¼Œvalueï¼‰çš„ä¸»æœºã€‚&lt;/p&gt;
&lt;p&gt;é…ç½®åœ¨é‡è¯•æœŸé—´é‡è¯•å…¶ä»–ä¼˜å…ˆçº§ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„ &lt;code&gt;envoy.retry_priorities.previous_priorities&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;retry_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;retry_priority&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.retry_priorities.previous_priorities&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.retry.priority.previous_priorities.v3.PreviousPrioritiesConfig&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;update_frequency&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†é’ˆå¯¹åç»­é‡è¯•ä¸­å°šæœªä½¿ç”¨è¿‡çš„ä¼˜å…ˆçº§ã€‚&lt;code&gt;update_frequency&lt;/code&gt; å‚æ•°å†³å®šä¼˜å…ˆçº§è´Ÿè½½åº”å¤šé•¿æ—¶é—´é‡æ–°è®¡ç®—ä¸€æ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›æ’ä»¶å¯ä»¥è¢«ç»„åˆä½¿ç”¨ï¼Œè¿™å°†æ’é™¤ä»¥å‰å°è¯•è¿‡çš„ä¸»æœºå’Œä»¥å‰å°è¯•è¿‡çš„ä¼˜å…ˆçº§ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;retry_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;retry_host_predicate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.retry_host_predicates.previous_hosts&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host_selection_retry_max_attempts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;retry_priority&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.retry_priorities.previous_priorities&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.retry.priority.previous_priorities.v3.PreviousPrioritiesConfig&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;update_frequency&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å†…éƒ¨é‡å®šå‘&#34;&gt;å†…éƒ¨é‡å®šå‘&lt;/h2&gt;
&lt;p&gt;Envoy æ”¯æŒå¤„ç† 3xx å†…éƒ¨é‡å®šå‘ï¼Œæ•è·å¯é…ç½®çš„ 3xx é‡å®šå‘å“åº”ï¼Œåˆæˆä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼Œå°†ä»–å‘é€ç»™æ–°è·¯ç”±åŒ¹é…æŒ‡å®šçš„ä¸Šæ¸¸ï¼Œå°†é‡å®šå‘çš„å“åº”ä½œä¸ºå¯¹åŸå§‹è¯·æ±‚çš„å“åº”è¿”å›ã€‚&lt;/p&gt;
&lt;p&gt;å†…éƒ¨é‡å®šå‘å¯ä»¥ä½¿ç”¨è·¯ç”±é…ç½®ä¸­çš„ &lt;a href=&#34;https://cloudnative.to/envoy/api-v3/config/route/v3/route_components.proto.html#envoy-v3-api-field-config-route-v3-routeaction-internal-redirect-policy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å†…éƒ¨é‡å®šå‘ç­–ç•¥&lt;/a&gt; å­—æ®µæ¥é…ç½®ã€‚å½“é‡å®šå‘å¤„ç†å¼€å¯ï¼Œä»»ä½•æ¥è‡ªä¸Šæ¸¸çš„ 3xx å“åº”ï¼Œåªè¦åŒ¹é…åˆ°é…ç½®çš„ &lt;a href=&#34;https://cloudnative.to/envoy/api-v3/config/route/v3/route_components.proto.html#envoy-v3-api-field-config-route-v3-internalredirectpolicy-redirect-response-codes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;redirect_response_codes&lt;/a&gt; çš„å“åº”éƒ½å°†ç”± Envoy æ¥å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;è¦æˆåŠŸåœ°å¤„ç†é‡å®šå‘ï¼Œå¿…é¡»é€šè¿‡ä»¥ä¸‹æ£€æŸ¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å“åº”ç åŒ¹é…åˆ°é…ç½®çš„ &lt;a href=&#34;https://cloudnative.to/envoy/api-v3/config/route/v3/route_components.proto.html#envoy-v3-api-field-config-route-v3-internalredirectpolicy-redirect-response-codes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;redirect_response_codes&lt;/a&gt;ï¼Œé»˜è®¤æ˜¯ 302ï¼Œæˆ–è€…å…¶ä»–çš„ 3xx çŠ¶æ€ç ï¼ˆ301, 302, 303, 307, 308ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ‹¥æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„ã€å®Œå…¨é™å®šçš„ URL çš„ location å¤´ã€‚&lt;/li&gt;
&lt;li&gt;è¯¥è¯·æ±‚å¿…é¡»å·²è¢« Envoy å®Œå…¨å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;è¯·æ±‚ä¸èƒ½åŒ…å«è¯·æ±‚ä½“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloudnative.to/envoy/api-v3/config/route/v3/route_components.proto.html#envoy-v3-api-field-config-route-v3-internalredirectpolicy-allow-cross-scheme-redirect&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;allow_cross_scheme_redirect&lt;/a&gt; æ˜¯ trueï¼ˆé»˜è®¤æ˜¯ falseï¼‰ï¼Œæˆ–è€…ä¸‹æ¸¸è¯·æ±‚çš„ scheme å’Œ location å¤´ä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;ç»™å®šçš„ä¸‹æ¸¸è¯·æ±‚ä¹‹å‰å¤„ç†çš„å†…éƒ¨é‡å®šå‘æ¬¡æ•°ä¸è¶…è¿‡è¯·æ±‚æˆ–é‡å®šå‘è¯·æ±‚å‘½ä¸­çš„è·¯ç”±é…ç½®çš„ &lt;a href=&#34;https://cloudnative.to/envoy/api-v3/config/route/v3/route_components.proto.html#envoy-v3-api-field-config-route-v3-internalredirectpolicy-max-internal-redirects&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ€å¤§é‡å®šå‘æ•°&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å…¨éƒ¨ &lt;a href=&#34;https://cloudnative.to/envoy/api-v3/config/route/v3/route_components.proto.html#envoy-v3-api-field-config-route-v3-internalredirectpolicy-predicates&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è°“è¯&lt;/a&gt; æ¥å—ç›®æ ‡è·¯ç”±ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»»ä½•å¤±è´¥éƒ½å°†å¯¼è‡´é‡å®šå‘ä¼ é€’ç»™ä¸‹æ¸¸ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºé‡å®šå‘è¯·æ±‚å¯èƒ½ä¼šåœ¨ä¸åŒçš„è·¯ç”±ä¹‹é—´ä¼ é€’ï¼Œé‡å®šå‘é“¾ä¸­çš„ä»»ä½•æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„è·¯ç”±éƒ½å°†å¯¼è‡´é‡å®šå‘è¢«ä¼ é€’ç»™ä¸‹æ¸¸ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ²¡æœ‰å¯ç”¨å†…éƒ¨é‡å®šå‘&lt;/li&gt;
&lt;li&gt;æˆ–è€…å½“é‡å®šå‘é“¾å‘½ä¸­çš„è·¯ç”±çš„ &lt;a href=&#34;https://cloudnative.to/envoy/api-v3/config/route/v3/route_components.proto.html#envoy-v3-api-field-config-route-v3-internalredirectpolicy-max-internal-redirects&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ€å¤§é‡å®šå‘æ¬¡æ•°&lt;/a&gt; å°äºç­‰äºé‡å®šå‘é“¾çš„é•¿åº¦ã€‚&lt;/li&gt;
&lt;li&gt;æˆ–è€…è·¯ç”±è¢« &lt;a href=&#34;https://cloudnative.to/envoy/api-v3/config/route/v3/route_components.proto.html#envoy-v3-api-field-config-route-v3-internalredirectpolicy-predicates&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è°“è¯&lt;/a&gt; æ‹’ç»ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ‰ä¸¤ä¸ªè°“è¯å¯ä»¥åˆ›å»ºä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ (DAG) æ¥å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼Œä»–ä»¬æ˜¯ &lt;a href=&#34;https://cloudnative.to/envoy/api-v3/extensions/internal_redirect/previous_routes/v3/previous_routes_config.proto.html#envoy-v3-api-msg-extensions-internal-redirect-previous-routes-v3-previousroutesconfig&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…ˆå‰çš„è·¯ç”±&lt;/a&gt; è°“è¯ å’Œ &lt;a href=&#34;https://cloudnative.to/envoy/api-v3/extensions/internal_redirect/allow_listed_routes/v3/allow_listed_routes_config.proto.html#envoy-v3-api-msg-extensions-internal-redirect-allow-listed-routes-v3-allowlistedroutesconfig&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;allow_listed_routes&lt;/a&gt;ã€‚å…·ä½“æ¥è¯´ï¼Œ&lt;em&gt;allow listed routes&lt;/em&gt; è°“è¯å®šä¹‰çš„æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ä¸­å„ä¸ªèŠ‚ç‚¹çš„è¾¹ï¼Œè€Œ å…ˆå‰çš„è·¯ç”± è°“è¯å®šä¹‰äº†è¾¹çš„â€œè®¿é—®â€çŠ¶æ€ï¼Œå¦‚æœæ˜¯è¿™æ ·å°±å¯ä»¥é¿å…å¾ªç¯ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸‰ä¸ªè°“è¯ &lt;a href=&#34;https://cloudnative.to/envoy/api-v3/extensions/internal_redirect/safe_cross_scheme/v3/safe_cross_scheme_config.proto.html#envoy-v3-api-msg-extensions-internal-redirect-safe-cross-scheme-v3-safecrossschemeconfig&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;safe_cross_scheme&lt;/a&gt; è¢«ç”¨æ¥é˜²æ­¢ HTTP -&amp;gt; HTTPS çš„é‡å®šå‘ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦é‡å®šå‘é€šè¿‡è¿™äº›æ£€æŸ¥ï¼Œå‘é€åˆ°åŸå§‹ä¸Šæ¸¸çš„è¯·æ±‚å¤´å°†è¢«ä¿®æ”¹ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°†å®Œå…¨é™å®šçš„åŸå§‹è¯·æ±‚ URL æ”¾åˆ° x-envoy-original-url å¤´ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Location å¤´ä¸­çš„å€¼æ›¿æ¢ Authority/Hostã€Schemeã€Path å¤´ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¿®æ”¹åçš„è¯·æ±‚å¤´å°†é€‰æ‹©ä¸€ä¸ªæ–°çš„è·¯ç”±ï¼Œé€šè¿‡ä¸€ä¸ªæ–°çš„è¿‡æ»¤å™¨é“¾å‘é€ï¼Œç„¶åæŠŠæ‰€æœ‰æ­£å¸¸çš„ Envoy è¯·æ±‚éƒ½å‘é€åˆ°ä¸Šæ¸¸è¿›è¡Œæ¸…ç†ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼ŒHTTP è¿æ¥ç®¡ç†å™¨å¤´æ¸…ç†ï¼ˆä¾‹å¦‚æ¸…é™¤ä¸å—ä¿¡ä»»çš„æ ‡å¤´ï¼‰ä»…åº”ç”¨ä¸€æ¬¡ã€‚å³ä½¿åŸå§‹è·¯ç”±å’Œç¬¬äºŒä¸ªè·¯ç”±ç›¸åŒï¼Œæ¯ä¸ªè·¯ç”±çš„å¤´ä¿®æ”¹ä¹Ÿå°†åŒæ—¶åº”ç”¨äºåŸå§‹è·¯ç”±å’Œç¬¬äºŒè·¯ç”±ï¼Œå› æ­¤è¯·è°¨æ…é…ç½®å¤´ä¿®æ”¹è§„åˆ™ï¼Œä»¥é¿å…é‡å¤ä¸å¿…è¦çš„è¯·æ±‚å¤´å€¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸€ä¸ªç®€å•çš„é‡å®šå‘æµå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ç«¯å‘é€ GET è¯·æ±‚ä»¥è·å– &lt;em&gt;&lt;a href=&#34;http://foo.com/bar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://foo.com/bar&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;ä¸Šæ¸¸ 1 å‘é€ 302 å“åº”ç å¹¶æºå¸¦â€œ&lt;em&gt;location: &lt;a href=&#34;http://baz.com/eep&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://baz.com/eep&lt;/a&gt;&lt;/em&gt;â€&lt;/li&gt;
&lt;li&gt;Envoy è¢«é…ç½®ä¸ºå…è®¸åŸå§‹è·¯ç”±ä¸Šé‡å®šå‘ï¼Œå¹¶å‘é€æ–°çš„ GET è¯·æ±‚åˆ°ä¸Šæ¸¸ 2ï¼Œæºå¸¦è¯·æ±‚å¤´â€œ&lt;em&gt;x-envoy-original-url: &lt;a href=&#34;http://foo.com/bar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://foo.com/bar&lt;/a&gt;&lt;/em&gt;â€è·å– &lt;em&gt;&lt;a href=&#34;http://baz.com/eep&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://baz.com/eep&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;Envoy å°† &lt;em&gt;&lt;a href=&#34;http://baz.com/eep&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://baz.com/eep&lt;/a&gt;&lt;/em&gt; çš„å“åº”æ•°æ®ä»£ç†åˆ°å®¢æˆ·ç«¯ï¼Œä½œä¸ºå¯¹åŸå§‹è¯·æ±‚çš„å“åº”ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;è¶…æ—¶&#34;&gt;è¶…æ—¶&lt;/h2&gt;
&lt;p&gt;å„ç§å¯é…ç½®çš„è¶…æ—¶é€‚ç”¨äº HTTP è¿æ¥åŠå…¶ç»„æˆçš„æµã€‚æœ‰å…³é‡è¦è¶…æ—¶é…ç½®çš„æ¦‚è¿°ï¼Œè¯·å‚è€ƒ &lt;a href=&#34;https://cloudnative.to/envoy/faq/configuration/timeouts.html#faq-configuration-timeouts&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤ FAQ æ¡ç›®&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Envoy WASM æºç æŠ½ä¸å‰¥èŒ§</title>
      <link>https://cloudnative.to/blog/envoy-wasm-source-deep-dive/</link>
      <pubDate>Wed, 23 Dec 2020 11:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-wasm-source-deep-dive/</guid>
      <description>&lt;p&gt;åœ¨ Envoy ç½‘å…³å’Œ Service Mesh æœåŠ¡ç½‘æ ¼è½åœ°è¿‡ç¨‹ä¸­ï¼Œå¤§éƒ¨åˆ†ç»„ç»‡å’Œå…¬å¸å‡ ä¹ä¸å¯é¿å…çš„éœ€è¦å¯¹ Envoy åšä¸€äº›äºŒæ¬¡å¼€å‘å’ŒåŠŸèƒ½å¢å¼ºï¼Œä»¥åº”å¯¹è‡ªèº«çš„ä¸ªæ€§åŒ–éœ€æ±‚ï¼Œåªæ˜¯æˆ–å¤šæˆ–å°‘çš„é—®é¢˜ã€‚è™½ç„¶ Envoy æœ¬èº«åŸºäº L4/L7 Filter æä¾›äº†éå¸¸çµæ´»å¯æ‰©å±•æ€§ï¼Œå¯ä»¥è®©å¼€å‘è€…åœ¨å„ä¸ªå±‚çº§å¯¹ Envoy è¿›è¡Œæ‰©å±•ã€‚ç„¶è€Œä»¥ç°æœ‰çš„ Filter å¼€å‘æµç¨‹å¤ªè¿‡ç¹çæ²‰é‡ã€‚ä¸€ä¸ªç®€å•çš„åŠŸèƒ½æ‰©å±•éƒ½éœ€è¦é‡æ–°æ„å»ºæ•´ä¸ª Envoyï¼Œå‡çº§å’Œéƒ¨ç½²ä¹Ÿæ¶‰åŠåˆ°æœåŠ¡é‡å¯ç­‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºæ­¤ï¼ŒEnvoy ç¤¾åŒºåœ¨ Envoy ä¸­åµŒå…¥äº† WASM è™šæ‹Ÿæœºä»¥è·å¾—ä¸€ä¸ªå®‰å…¨çš„æ²™ç®±ç¯å¢ƒï¼Œç”¨äºåŠ¨æ€åŠ è½½å’Œè¿è¡Œå¯æ‹”æ’çš„æ‰©å±•ä»£ç ï¼ˆè¢«ç¼–è¯‘ä¸º WASM å­—èŠ‚ç ï¼‰ï¼Œç®€åŒ– Envoy äºŒæ¬¡å¼€å‘å’ŒåŠŸèƒ½å¢å¼ºçš„å¤æ‚åº¦ã€‚å®é™…ä¸Šï¼Œåœ¨ Envoy ç¤¾åŒºå°†è¯¥ç‰¹æ€§åˆå…¥ä¸»å¹²ä¹‹å‰ï¼ŒIstio ç¤¾åŒºå°±å·²ç»åœ¨åŠ›æ¨è¯¥ç‰¹æ€§ï¼Œå¹¶åŸºäºè¯¥ç‰¹æ€§é‡å†™äº†éƒ¨åˆ†çš„åŠŸèƒ½æ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;ç½‘æ˜“æ•°å¸†æ——ä¸‹è½»èˆŸäº‘åŸç”Ÿå›¢é˜Ÿä¹Ÿä¸€ç›´åœ¨å…³æ³¨ç¤¾åŒºçš„è¿›å±•å’ŒåŠ¨æ€ã€‚è½»èˆŸå¾®æœåŠ¡åœ¨å„ä¸ªä¸šåŠ¡æ–¹è½åœ°çš„è¿‡ç¨‹ä¸­ï¼Œä¸šåŠ¡æ–¹çš„å®šåˆ¶åŒ–éœ€æ±‚å¾€å¾€éš¾ä»¥é¿å…ï¼Œè€Œéšç€ä¸šåŠ¡æ–¹çš„ä¸æ–­å¢å¤šï¼Œå¦‚ä½•ç®¡ç†è¿™äº›ä¸æ–­æ¨ªå‘è†¨èƒ€çš„å®šåˆ¶åŒ–éœ€æ±‚ï¼Œé¿å…å®ƒä»¬æˆä¸ºè½»èˆŸå¾®æœåŠ¡äº§å“æœ¬èº«æ¼”è¿›çš„è´Ÿç´¯æ˜¯ä¸€ä¸ªå…³é”®é—®é¢˜ã€‚è€Œ WASM åˆ™æ˜¯ä¸€ä¸ªå¯èƒ½çš„ç­”æ¡ˆã€‚æ­¤å¤–ï¼Œè½»èˆŸå›¢é˜Ÿè‡ªç ”çš„ç±» OpenResty Lua æ¡†æ¶ä¹Ÿæ˜¯ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå…¶åŸç†æœ¬è´¨ä¸Šä¹Ÿå’Œ WASM ç±»ä¼¼ï¼Œåˆ©ç”¨ Envoy ä¸­åµŒå…¥çš„ LuaJIT æ¥è¿è¡ŒåŠ¨æ€ Lua è„šæœ¬ï¼Œä¸è¿‡è¿™ä¸æ˜¯æœ¬æ–‡çš„è®¨è®ºèŒƒç•´ã€‚&lt;/p&gt;
&lt;p&gt;è¯´å›åˆ° WASMã€‚WASM æœ¬èº«æ˜¯æºè‡ªå‰ç«¯çš„æŠ€æœ¯ï¼Œæ˜¯ä¸ºäº†è§£å†³æ—¥ç›Šå¤æ‚çš„å‰ç«¯ Web åº”ç”¨ä»¥åŠæœ‰é™çš„ JS è„šæœ¬è§£é‡Šæ€§èƒ½è€Œè¯ç”Ÿçš„æŠ€æœ¯ï¼ˆæœ‰åˆ«äº JIT çš„å¦ä¸€æ¡è·¯çº¿ï¼‰ã€‚WASM å¹¶ä¸æ˜¯ä¸€ç§è¯­è¨€ï¼Œè€Œæ˜¯å­—èŠ‚ç æ ‡å‡†ã€‚ç†è®ºä¸Šä»»ä½•ä¸€ç§è¯­è¨€ï¼Œéƒ½å¯ä»¥è¢«ç¼–è¯‘æˆ WASM å­—èŠ‚ç ï¼Œç„¶ååœ¨ WASM è™šæ‹Ÿæœºä¸­æ‰§è¡Œã€‚å…¶åŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-wasm-source-deep-dive/envoy-wasm-filters_hu4cef6522171451d36f81dfcb97a2193c_63279_bddadc04dfa761a0d9b588522f9edde3.webp 400w,
               /blog/envoy-wasm-source-deep-dive/envoy-wasm-filters_hu4cef6522171451d36f81dfcb97a2193c_63279_2cc70ae485ca38d048f85f061e3ffd49.webp 760w,
               /blog/envoy-wasm-source-deep-dive/envoy-wasm-filters_hu4cef6522171451d36f81dfcb97a2193c_63279_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-wasm-source-deep-dive/envoy-wasm-filters_hu4cef6522171451d36f81dfcb97a2193c_63279_bddadc04dfa761a0d9b588522f9edde3.webp&#34;
               width=&#34;760&#34;
               height=&#34;224&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ—¨åœ¨ä»æºç è§’åº¦è§£æ Envoy å’Œ WASM æ²™ç®±æ˜¯å¦‚ä½•æ¡¥æ¥çš„ã€‚å¸Œæœ›è¯»è€…é€šè¿‡é˜…è¯»æœ¬æ–‡ï¼Œèƒ½å¤Ÿå¯¹ Envoy WASM çš„æ¥å…¥æœ‰ä¸€å®šçš„äº†è§£ã€‚åœ¨å®è·µçš„è¿‡ç¨‹ä¹‹ä¸­ï¼Œèƒ½å¤Ÿå¸®åŠ©è¯»è€…åœ¨ç¹æ‚çš„ç±»å‹å…³ç³»å’Œè°ƒç”¨é“¾è·¯ä¸­ç†æ¸…æ€è·¯ã€‚æœ¬æ–‡é»˜è®¤è¯»è€…å…·å¤‡ä¸€å®šçš„ Envoy çŸ¥è¯†åŸºç¡€å¹¶ä¸”å¯¹ Envoy Filter æœºåˆ¶å…·å¤‡ä¸€å®šçš„äº†è§£ã€‚å¦‚æœä»…ä»…æ˜¯å¸Œæœ›ä½¿ç”¨ WASM è€Œä¸éœ€è¦æ·±å…¥äº†è§£æˆ–è€…äºŒæ¬¡å¼€å‘ Envoy WASMï¼Œé‚£ä¹ˆå¯ä»¥é˜…è¯» SDK æ–‡æ¡£å³å¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nl&#34;&gt;commit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;f6cc741026445382d5869e97cf7c9c36a44b57a9&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;1-ä»-envoy-å¼€å§‹&#34;&gt;1. ä» Envoy å¼€å§‹&lt;/h2&gt;
&lt;p&gt;Envoy æ”¯æŒä½¿ç”¨ä½¿ç”¨ WASM æ¥æ‰©å±•ä¸ƒå±‚ HTTP Filter æˆ–è€…å››å±‚ Network Filterã€‚ä½†æ˜¯æ— è®ºæ˜¯ä¸ƒå±‚ HTTP Filter è¿˜æ˜¯å››å±‚ Network Filterï¼Œå…¶æœ¬è´¨éƒ½æ˜¯ç±»ä¼¼çš„ã€‚Envoy å†…ç½®äº†ä¸€ä¸ªåŸç”Ÿ C++ HTTP Filter å’Œä¸€ä¸ªåŸç”Ÿ C++ Network Filter ç”¨äºå°è£… WASM APIï¼Œç®¡ç† WASM Sandboxï¼Œè½½å…¥ WASM å­—èŠ‚ç å¹¶ä¸”å¯¹ Envoy æš´éœ²æ ‡å‡†çš„ HTTP Filter å’Œ Network Filter æ¥å£ã€‚å®ƒä»¬æ˜¯ WASM å­—èŠ‚ç ç®¡ç†è€…ï¼Œä¹Ÿæ˜¯ WASM æ²™ç®±å’Œ Envoy ä¸»å¹²äº¤äº’çš„æ¡¥æ¢ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤„ä½¿ç”¨æ¥å£ç›¸å¯¹æ›´åŠ å¤æ‚çš„ HTTP Filter ä½œä¸ºç¤ºä¾‹æ¥ä½œä¸ºæºç é˜…è¯»çš„èµ·ç‚¹ã€‚ï¼ˆåœ¨å…·ä½“çš„å®è·µå½“ä¸­ï¼Œä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„ Network Filter å¾€å¾€ä¼šæ¯” HTTP Filter å¤æ‚ä¸å°‘ï¼Œä½†æ˜¯è¿™ç§å¤æ‚æ€§ä¸»è¦åœ¨ Filter å®ç°å†…éƒ¨ã€‚å°±æš´éœ²çš„æ¥å£æ¥è¯´ï¼Œåè€Œæ˜¯ HTTP Filter å…·å¤‡æ›´å¤šçš„æ¥å£å’Œç›¸å¯¹å¤æ‚çš„å¤„ç†ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹äºä¸€ä¸ªæ™®é€šçš„ C++ HTTP Filterï¼Œåœ¨é…ç½®çš„åˆå§‹åŒ–é˜¶æ®µï¼ŒEnvoy ä¼šå®Œæˆ Proto é…ç½®ï¼ˆé€šè¿‡é™æ€æ–‡ä»¶æˆ–è€… xDS åè®®è·å–ï¼‰çš„åŠ è½½å’Œåˆå§‹åŒ–ã€‚&lt;strong&gt;è€Œåœ¨è¯·æ±‚é˜¶æ®µï¼Œå¯¹äºæ¯ä¸ª HTTP è¯·æ±‚ï¼ŒEnvoy ä¼šæ ¹æ® HCMï¼ˆHTTP Connection Managerï¼Œç”¨äºå¤„ç† HTTP åè®®çš„å››å±‚ Network Filterï¼‰çš„é…ç½®åˆ›å»ºä¸€ä¸ª HTTP Filter é“¾ã€‚å¹¶ä¸”å°†æ¯ä¸ª HTTP Filter çš„é…ç½®æ³¨å…¥åˆ°å¯¹åº”çš„ Filter å®ä¾‹ä¸­ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥äº†è§£ WASM æ‰©å±•çš„ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯çœ‹ Envoy æ˜¯å¦‚ä½•åˆ›å»ºä¸€ä¸ª HTTP WASM Filter çš„ã€‚å‰é¢æåˆ°è¿‡ï¼ŒWASM æ‰©å±•ä¼šç»è¿‡å†…ç½® C++ æ’ä»¶çš„åŒ…è£…ï¼Œæ‰€ä»¥åœ¨ Envoy ä¸»ä½“çœ‹æ¥ï¼Œåˆ›å»º WASM æ‰©å±•çš„è¿‡ç¨‹å…¶å®å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ™®é€šçš„ C++ Filter çš„è¿‡ç¨‹ï¼Œåªä¸è¿‡è¯¥ Filter ä½¿ç”¨ WASM å­—èŠ‚ç ä½œä¸ºå®ƒçš„è¾“å…¥é…ç½®ï¼ˆæœ¬è´¨ä¸Šå°±æ˜¯ Lua Filter å’Œ Lua è„šæœ¬çš„å…³ç³»ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å…¶æºç å¦‚ä¸‹æ‰€ç¤ºã€‚&lt;code&gt;createFilterFactoryFromProtoTyped&lt;/code&gt; åªä¼šåœ¨é…ç½®åˆå§‹åŒ–é˜¶æ®µæ‰§è¡Œä¸€æ¬¡ã€‚ä¹‹åï¼Œæ¯å½“è¯·æ±‚åˆ°æ¥ï¼Œå…¶è¿”å›çš„é—­åŒ…å‡½æ•°å°±ä¼šè¢«æ‰§è¡Œï¼Œç”¨äºåˆ›å»º WASM HTTP Filter å®ä¾‹æ¥è¯·æ±‚å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;ä»ä»£ç ä¸éš¾çœ‹å‡º &lt;code&gt;FilterConfig&lt;/code&gt; æ˜¯ä¸€ä¸ªå…³é”®ç±»å‹ã€‚å› ä¸ºæœ€ç»ˆçš„ Filter å®ä¾‹æ˜¯è°ƒç”¨ &lt;code&gt;FilterConfig&lt;/code&gt; çš„ &lt;code&gt;createFilter&lt;/code&gt; æ¥å£åˆ›å»ºå‡ºæ¥çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// source/extensions/filters/http/wasm/config.cc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FilterFactoryCb&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WasmFilterConfig&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;createFilterFactoryFromProtoTyped&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;envoy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;extensions&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proto_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Configuration&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FactoryContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ ¹æ® Proto é…ç½®åˆå§‹åŒ– filter_config
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filter_config&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;make_shared&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FilterConfig&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;proto_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filter_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;](&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FilterChainFactoryCallbacks&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;callbacks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// åˆ›å»º WASM HTTP Filter å®ä¾‹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filter_config&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;createFilter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Fail open
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;callbacks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addStreamFilter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;callbacks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addAccessLogHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;å°ç»“ï¼šEnvoy é€šè¿‡ä¸€ä¸ªå†…ç½®çš„ä¸ƒå±‚ HTTP Filter å’Œä¸€ä¸ªå†…ç½®çš„å››å±‚ Network Filter å……å½“åŒ…è£…å™¨ï¼Œç®¡ç† WASM runtime å¹¶ä¸ WASM Sandbox äº¤äº’ä»¥å®ç° HTTP Filter æˆ–è€… Network Filter çš„ç›¸å…³åŠŸèƒ½ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;2-åˆ›å»ºä¸€ä¸ªæ²™ç®±&#34;&gt;2. åˆ›å»ºä¸€ä¸ªæ²™ç®±&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;FilterConfig&lt;/code&gt; åªæä¾›äº†ä¸€ä¸ª &lt;code&gt;createFilter&lt;/code&gt; æ¥å£ã€‚å…¶æ ¸å¿ƒçš„å†…å®¹éƒ½åœ¨æ„é€ å‡½æ•°å½“ä¸­ã€‚å…¶æ„é€ å‡½æ•°æºç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// source/extensions/filters/http/wasm/wasm_filter.cc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;FilterConfig&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FilterConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;envoy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;extensions&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                           &lt;span class=&#34;n&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Configuration&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FactoryContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tls_slot_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;n&#34;&gt;ThreadLocal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TypedSlot&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Common&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PluginHandle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;makeUnique&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;threadLocal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;plugin_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;make_shared&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Common&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Plugin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;Common&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;anyToBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;configuration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fail_open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;direction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;localInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;listenerMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// å›è°ƒå‡½æ•°ï¼Œå½“æˆåŠŸåˆ›å»º WASM è™šæ‹Ÿæœºä¹‹åæ‰§è¡Œï¼Œç”¨äºåœ¨æ¯ä¸ª Worker çº¿ç¨‹ä¹‹ä¸­éƒ½æ‹·è´åˆ›å»ºä¸€ä¸ª WASM è™šæ‹Ÿæœº
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;callback&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;](&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Common&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmHandleSharedPtr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;base_wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// NB: the Slot set() call doesn&amp;#39;t complete inline, so all arguments must outlive this call.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;tls_slot_&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base_wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;](&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Event&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Dispatcher&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dispatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Common&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getOrCreateThreadLocalPlugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base_wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dispatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// æ ¹æ®é…ç½®åˆ›å»º WASM è™šæ‹Ÿæœº
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Common&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;createWasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;createScope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;clusterManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;initManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dispatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lifecycleNotifier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;remote_data_provider_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;move&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;callback&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Common&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmException&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unable to create Wasm HTTP filter {}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;Common::Wasm::Plugin&lt;/code&gt; æ­¤å¤„ç•¥å»å¯¹å®ƒçš„ä»‹ç»ã€‚è¯»è€…åªéœ€è¦çŸ¥é“å®ƒæ˜¯å¯¹ &lt;strong&gt;WASM å­—èŠ‚ç ã€å­—èŠ‚ç æ’ä»¶æœ¬èº«é…ç½®&lt;/strong&gt;ä»¥åŠä¸€äº› Filter çŠ¶æ€çš„å°è£…å’Œé›†åˆå³å¯ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;code&gt;FilterConfig&lt;/code&gt; çš„æ„é€ å‡½æ•°å½“ä¸­ï¼Œæœ‰ä¸€ä¸ªå…³é”®å‡½æ•°ï¼Œ&lt;code&gt;Common::Wasm::createWasm&lt;/code&gt;ã€‚å®ƒç”¨äºåˆ›å»ºä¸€ä¸ª WASM è™šæ‹Ÿæœºã€‚è¯¥å‡½æ•°ç›¸å¯¹å¤æ‚ï¼Œæ•…è€Œæ­¤å¤„åªç²˜è´´å‡ºå…³é”®å†…å®¹ã€‚å…¶ä¸»è¦å·¥ä½œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æ®é…ç½®ä¸­ WASM å­—èŠ‚ç ä½ç½®ï¼ˆæœ¬åœ°æˆ–è€…è¿œç¨‹ï¼‰ï¼Œè¯»å–å­—èŠ‚ç &lt;/li&gt;
&lt;li&gt;åˆ›å»º WASM è™šæ‹Ÿæœº&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// source/extensions/common/wasm/wasm.cc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createWasmInternal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;VmConfig&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PluginSharedPtr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                               &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Stats&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ScopeSharedPtr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                               &lt;span class=&#34;n&#34;&gt;Upstream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ClusterManager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cluster_manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                               &lt;span class=&#34;n&#34;&gt;Init&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Manager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;init_manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Event&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Dispatcher&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dispatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                               &lt;span class=&#34;n&#34;&gt;Api&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Api&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ServerLifecycleNotifier&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lifecycle_notifier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                               &lt;span class=&#34;n&#34;&gt;Config&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DataSource&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RemoteAsyncDataProviderPtr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;remote_data_provider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                               &lt;span class=&#34;n&#34;&gt;CreateWasmCallback&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                               &lt;span class=&#34;n&#34;&gt;CreateContextFn&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_root_context_for_testing&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// è¯¥é—­åŒ…å‡½æ•°æ¥å—å­—èŠ‚ç  code ä¸ºå‚æ•°ï¼Œå¹¶æ•è·äº†ç›¸å…³çš„é…ç½®ä»¥åŠå…³é”®ä¸Šä¸‹æ–‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;complete_cb&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cluster_manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dispatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lifecycle_notifier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_root_context_for_testing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      &lt;span class=&#34;n&#34;&gt;wasm_extension&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;](&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;empty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;cb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// proxy_wasm æ˜¯ä¸€ä¸ªå…³é”®å¤–éƒ¨ä¾èµ–ï¼Œæ˜¯å¯¹ WASM è™šæ‹Ÿæœºç¯å¢ƒçš„å°è£…
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;proxy_wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;makeVmKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;anyToBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;configuration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_factory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_extension&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasmFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;proxy_wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmHandleFactory&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxy_wasm_factory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cluster_manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dispatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lifecycle_notifier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;n&#34;&gt;wasm_factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;](&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;absl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WasmHandleBaseSharedPtr&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cluster_manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dispatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lifecycle_notifier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          &lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨ proxy_wasm ä¸­ createWasm å‡½æ•°åˆ›å»º WASM æ²™ç®±
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxy_wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;createWasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxy_wasm_factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;getCloneFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm_extension&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dispatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_root_context_for_testing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;allow_precompiled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Stats&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ScopeSharedPtr&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_wasm_stats_scope&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;wasm_extension&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lockAndCreateStats&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;wasm_extension&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onEvent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;toWasmEvent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;isFailed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;ENVOY_LOG_TO_LOGGER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Envoy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Logger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Registry&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Envoy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Logger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;trace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          &lt;span class=&#34;s&#34;&gt;&amp;#34;Unable to create Wasm&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;cb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æ‰§è¡Œ FilterConfig ä¸­çš„å›è°ƒå‡½æ•°ï¼Œåœ¨å„ä¸ª Worker ä¸­åˆ›å»º WASM æ²™ç®±
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;cb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;static_pointer_cast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmHandle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤å¤„å‡ºç°äº†ä¸€ä¸ªå…¨æ–°çš„åç§°ç©ºé—´ï¼Œ&lt;code&gt;proxy_wasm&lt;/code&gt;ã€‚&lt;code&gt;prxoy_wasm&lt;/code&gt; ç”±ä¸€ä¸ªå…³é”®çš„å¤–éƒ¨ä¾èµ–æä¾›ï¼Œç”± Envoy ç¤¾åŒºå’Œ Istio ç¤¾åŒºç­‰å…±åŒç»´æŠ¤ã€‚å®ƒåŒ…å«äº†å¯¹ WASM è™šæ‹Ÿæœºçš„å°è£…ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å·¥ç¨‹è·¯å¾„ä¸ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//github.com/proxy-wasm/proxy-wasm-cpp-host](https://github.com/proxy-wasm/proxy-wasm-cpp-host)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;commit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cce535101c3b1cab61fb6bf83a61b0e9834bd957&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;å°ç»“ï¼šFilterConfig æ˜¯ Envoy HTTP WASM Filter æœºåˆ¶çš„æ ¸å¿ƒã€‚å®ƒä¼šåœ¨æ„é€ è¿‡ç¨‹ä¸­æ ¹æ®é…ç½®ä»¥åŠå­—èŠ‚ç åˆ›å»º WASM Sandboxã€‚è€Œ WASM Sandbox åˆ›å»ºéœ€è¦å¤–éƒ¨ä¾èµ– proxy_wasm çš„ä»‹å…¥ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;3-åˆ›å»ºä¸€ä¸ªæ²™ç®±---ç»­&#34;&gt;3. åˆ›å»ºä¸€ä¸ªæ²™ç®± - ç»­&lt;/h2&gt;
&lt;p&gt;ä»å‰æ–‡çš„ä»£ç ä¸éš¾å‘ç°ï¼ŒWASM æ²™ç®±çš„åˆ›å»ºéœ€è¦ &lt;code&gt;proxy_wasm&lt;/code&gt; çš„ä»‹å…¥ã€‚ç°åœ¨å¼€å§‹è¿›å…¥ &lt;code&gt;proxy_wasm&lt;/code&gt; çš„ä¸–ç•Œã€‚åœ¨å‰æ–‡æºç ä¸­ï¼Œä¸»è¦åŒ…å« &lt;code&gt;proxy_wasm&lt;/code&gt; ä¸­ä¸¤ä¸ªå‡½æ•°ã€‚å…¶ä¸­ &lt;code&gt;proxy_wasm::makeVmKey&lt;/code&gt; ç›¸å¯¹ç®€å•ï¼Œä¸»è¦ä½œç”¨æ˜¯æ ¹æ® WASM å­—èŠ‚ç ã€WASM æ²™ç®±é…ç½®ï¼ˆæ˜¯æ²™ç®±æœ¬èº«é…ç½®è€Œéè¿è¡Œåœ¨æ²™ç®±ä¸­çš„å­—èŠ‚ç æ’ä»¶é…ç½®ï¼‰è®¡ç®—å‡ºä¸€ä¸ª WASM è™šæ‹Ÿæœº IDã€‚è¯¥ ID å°†å”¯ä¸€æ ‡è¯†åŒä¸€çº¿ç¨‹ä¸­çš„ä¸€ä¸ªæ²™ç®±ã€‚&lt;/p&gt;
&lt;p&gt;å…³é”®æ˜¯ç¬¬äºŒä¸ªå‡½æ•° &lt;code&gt;proxy_wasm::createWasm&lt;/code&gt;ã€‚å…¶ä¸­æœ‰å››ä¸ªé‡è¦çš„å‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;vm_keyï¼šæ²™ç®±å”¯ä¸€æ ‡è¯†&lt;/li&gt;
&lt;li&gt;codeï¼šå­—èŠ‚ç &lt;/li&gt;
&lt;li&gt;pluginï¼šFilterConfig æ„é€ å‡½æ•°ä¸­åˆ›å»ºçš„ &lt;code&gt;Common::Wasm::Plugin&lt;/code&gt; å¯¹è±¡å®ä¾‹&lt;/li&gt;
&lt;li&gt;proxy_wasm_factoryï¼šåˆ›å»º WASM è™šæ‹Ÿæœºç¯å¢ƒçš„å·¥å‚é—­åŒ…å‡½æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œçœ‹çœ‹ &lt;code&gt;proxy_wasm::createWasm&lt;/code&gt; å‡½æ•°çš„æºç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shared_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmHandleBase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;createWasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                           &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shared_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PluginBase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                           &lt;span class=&#34;n&#34;&gt;WasmHandleFactory&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                           &lt;span class=&#34;n&#34;&gt;WasmHandleCloneFactory&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;clone_factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                           &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;allow_precompiled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shared_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmHandleBase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock_guard&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mutex&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;guard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base_wasms_mutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base_wasms&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;base_wasms&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;remove_reference&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;decltype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base_wasms&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// base_wasms ç®¡ç† vm_key åˆ°å·²æœ‰ WASM è™šæ‹Ÿæœºçš„æ˜ å°„ã€‚å¦‚æœ vm_key å·²ç»å­˜åœ¨ä¸€ä¸ªå¯¹åº”çš„ WASM è™šæ‹Ÿæœº
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// åˆ™å¯ä»¥ç›´æ¥å¤ç”¨ã€‚å¦è€…å°±è°ƒç”¨ä¼ å…¥çš„å·¥å‚é—­åŒ…å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿæœºã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;base_wasms&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;find&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;base_wasms&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;base_wasms&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;erase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;it&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base_wasms&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;initialize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;allow_precompiled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FailState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;UnableToInitializeCode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to initialize Wasm code&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;configuration_canary_handle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;clone_factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;configuration_canary_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FailState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;UnableToCloneVM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to clone Base Wasm&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;configuration_canary_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;initialize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;allow_precompiled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FailState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;UnableToInitializeCode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to initialize Wasm code&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_context&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;configuration_canary_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;configuration_canary_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FailState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;StartFailed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to start base Wasm&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;configuration_canary_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;configure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;configuration_canary_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FailState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ConfigureFailed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                              &lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to configure base Wasm plugin&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;configuration_canary_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kill&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;å¯ä»¥ä»æºç ä¸­çœ‹åˆ°ï¼Œåœ¨ Envoy ä¸»å¹²å‡½æ•°ä»£ç ä¸­ä¼ å…¥çš„å·¥å‚é—­åŒ…å‡½æ•°åœ¨æ­¤ï¼ˆå¯èƒ½ï¼‰ä¼šè¢«è°ƒç”¨ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ª WASM è™šæ‹Ÿæœºç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œæ­¤å¤„éœ€è¦å›åˆ° Envoy ä¸­æŸ¥çœ‹å…¶è¯¥é—­åŒ…å·¥å‚å‡½æ•°æ˜¯å¦‚ä½•å®ç°çš„ã€‚ç»è¿‡å‡ æ¬¡è¯·æ±‚çš„è½¬å‘ï¼Œè¯¥å·¥å‚å‡½æ•°æœ€ç»ˆä¼šåˆ›å»ºä¸€ä¸ª &lt;code&gt;Wasm::Wasm&lt;/code&gt; å®ä¾‹ï¼Œå¹¶å°è£…åœ¨ä¸€ä¸ª  &lt;code&gt;WasmHandle&lt;/code&gt; å®ä¾‹ä¸­ï¼ˆç»§æ‰¿è‡ª &lt;code&gt;proxy_wasm::WasmHandleBase&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// source/extensions/common/wasm/wasm_extension.cc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;WasmHandleExtensionFactory&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EnvoyWasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasmFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[](&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;VmConfig&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Stats&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ScopeSharedPtr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;Upstream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ClusterManager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cluster_manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Event&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Dispatcher&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dispatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ServerLifecycleNotifier&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lifecycle_notifier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;absl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WasmHandleBaseSharedPtr&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;make_shared&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                       &lt;span class=&#34;n&#34;&gt;anyToBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;configuration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                       &lt;span class=&#34;n&#34;&gt;cluster_manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dispatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;initializeLifecycle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lifecycle_notifier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;static_pointer_cast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmHandleBase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;make_shared&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmHandle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;move&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è€Œ &lt;code&gt;Wasm::Wasm&lt;/code&gt; åˆ™ç»§æ‰¿äº† &lt;code&gt;proxy_wasm::WasmBase&lt;/code&gt;ã€‚&lt;code&gt;proxy_wasm::WasmBase&lt;/code&gt; æ˜¯å¯¹ &lt;code&gt;proxy_wasm&lt;/code&gt; ä¸­ç®¡ç† WASM è™šæ‹Ÿæœºä»¥åŠ Envoy å’Œ Sandbox äº¤äº’ API çš„çš„ä¸€ä¸ªåŸºç¡€ç±»å‹ï¼šï¼ˆä¸å¾—ä¸åæ§½ä¸€å¥ï¼Œå°è£…çš„çœŸçš„å¥½å¥½å¥½å¥½å¤æ‚ï¼Œæ­¤å¤„çš„ç»•äº†ä¸€å±‚ä¸€å±‚åˆä¸€å±‚ï¼‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// source/extensions/common/wasm/wasm.cc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;absl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;absl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;absl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_configuration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;n&#34;&gt;absl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Stats&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ScopeSharedPtr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;n&#34;&gt;Upstream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ClusterManager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cluster_manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Event&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Dispatcher&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dispatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WasmBase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;createWasmVm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_configuration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scope_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;cluster_manager_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cluster_manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dispatcher_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dispatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;time_source_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dispatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;timeSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;wasm_stats_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmStats&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;n&#34;&gt;ALL_WASM_STATS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;POOL_COUNTER_PREFIX&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;scope_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;absl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;StrCat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;wasm.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                         &lt;span class=&#34;n&#34;&gt;POOL_GAUGE_PREFIX&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;scope_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;absl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;StrCat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;wasm.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;initializeStats&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;ENVOY_LOG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;debug&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Base Wasm created {} now active&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;active_wasms&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤å¤„çš„å…³é”®æ˜¯ createWasmVm å‡½æ•°ã€‚è¯¥å‡½æ•°ä¼šæ ¹æ® runtime ç±»å‹åˆ›å»ºæŸä¸€ç§çš„ WASM è¿è¡Œæ—¶ç¯å¢ƒã€‚ç›®å‰æ”¯æŒï¼šnullã€v8ã€wasmtimeã€wavm å››ç§ä¸åŒçš„ runtimeã€‚ä½ å¯ä»¥åœ¨ä»¥ä¸‹ç›®å½•æ‰¾åˆ°å®ƒä»¬çš„ç›¸å…³å·¥å‚ç±»ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// source/extensions/wasm_runtime
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Envoy ä¸­å°è£…çš„å·¥å‚ç±»æœ¬è´¨ä¸Šåˆä»…ä»…æ˜¯å¯¹ &lt;code&gt;proxy_wasm&lt;/code&gt; ä¸­å¯¹åº” runtime çš„å‡½æ•°çš„å°è£…ï¼Œä»¥ V8 ä¸ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// source/extensions/wasm_runtime/v8/config.cc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;V8RuntimeFactory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WasmRuntimeFactory&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;WasmVmPtr&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;createWasmVm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;override&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxy_wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;createV8Vm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// proxy_wasm src/v8/v8.cc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// proxy_wasm::WasmVm
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unique_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmVm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;createV8Vm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;make_unique&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;V8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ &lt;code&gt;proxy_wasm::WasmVm&lt;/code&gt; ç±»å‹æ˜¯å¯¹å„ç§ä¸åŒ WASM runtime çš„ä¸€ä¸ªç»Ÿä¸€å°è£…ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å°ç»“ï¼š&lt;strong&gt;åœ¨é…ç½®åˆå§‹åŒ–é˜¶æ®µï¼ŒEnvoy ä¼šåˆ›å»º WASM è™šæ‹Ÿæœºè¿è¡Œç¯å¢ƒï¼Œæœ€ç»ˆè°ƒç”¨ &lt;code&gt;proxy_wasm::createWasm&lt;/code&gt; å‡½æ•°ã€‚ &lt;code&gt;proxy_wasm::createWasm&lt;/code&gt; æœ€ç»ˆä¼šåå‘è°ƒç”¨ Envoy ä¸­ä¸€ä¸ªå·¥å‚å‡½æ•°ç”¨äºåˆ›å»º &lt;code&gt;Wasm::Wasm&lt;/code&gt; å®ä¾‹ä»¥åŠåŒ…è£…è¯¥å®ä¾‹çš„ &lt;code&gt;WasmHandle&lt;/code&gt; å®ä¾‹ï¼ˆ&lt;code&gt;proxy::WasmHandleBase&lt;/code&gt;ï¼‰ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¯¥è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„ç›¸å…³ç±»å‹ä»¥åŠå…³ç³»åˆ™æ˜¯ï¼š&lt;code&gt;Wasm::Wasm&lt;/code&gt; æ˜¯ Envoy ä¸­å¯¹ WASM runtime çš„æŠ½è±¡å’Œå°è£…ï¼Œå®ƒç›´æ¥ç»§æ‰¿è‡ª &lt;code&gt;proxy_wasm::WasmBase&lt;/code&gt;ã€‚&lt;code&gt;proxy_wasm::WasmBase&lt;/code&gt; ä¼šç»„åˆï¼ˆåŒ…å«ï¼‰ä¸€ä¸ª WASM è™šæ‹Ÿæœºå®ä¾‹ &lt;code&gt;proxy_wasm::WasmVm&lt;/code&gt;ï¼ŒåŒæ—¶è´Ÿè´£æ²™ç®±çš„ API æš´éœ²ï¼ˆåæ–‡è¯¦è¿°ï¼‰ã€‚è€Œ &lt;code&gt;proxy_wasm::WasmVm&lt;/code&gt; åˆ™å°è£…äº† V8/WAVM ç­‰ WASM runtime çš„ä¸€äº›é€šç”¨åŠŸèƒ½ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;4-æ²™ç®±åˆå§‹åŒ–&#34;&gt;4. æ²™ç®±åˆå§‹åŒ–&lt;/h2&gt;
&lt;p&gt;ç°åœ¨å›åˆ° &lt;code&gt;proxy_wasm::createWasm&lt;/code&gt; å‡½æ•°ã€‚åœ¨åˆ›å»º &lt;code&gt;Wasm::Wasm&lt;/code&gt; å®ä¾‹ï¼ˆåœ¨ proxy_wasm ä¸­ä¹Ÿå³æ˜¯ &lt;code&gt;proxy_wasm::WasmBase&lt;/code&gt; å®ä¾‹ï¼‰ä¹‹åï¼Œä¼šè°ƒç”¨å…¶ &lt;code&gt;initialize&lt;/code&gt; æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šå‘å…¶ç®¡ç†çš„å†…éƒ¨ WASM æ²™ç®±æ³¨å†Œç›¸å…³çš„æ¥å£å‡½æ•°ï¼ŒåŒæ—¶ä¹Ÿä¼šæŠŠ WASM æ²™ç®±æš´éœ²çš„å‡½æ•°ç»‘å®šåˆ° &lt;code&gt;proxy_wasm::WasmBase&lt;/code&gt; å®ä¾‹ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;initialize&lt;/code&gt; æ–¹æ³•æ˜¯æ•´ä¸ªè¿‡ç¨‹ä¸­æœ€ä¸ºæ ¸å¿ƒçš„å†…å®¹ã€‚ä¹Ÿæ˜¯ Envoy ä¸ WASM æ²™ç®±å®ç°äº¤äº’çš„å…³é”®ã€‚æ³¨æ„åˆ°ï¼Œ&lt;code&gt;proxy_wasm::WasmBase&lt;/code&gt; å®ä¾‹åŒ…å«çš„æ²™ç®± runtime æ ¹æ®é…ç½®çš„ä¸åŒä¹Ÿå¯èƒ½ä¼šæœ‰ä¸åŒï¼Œæ‰€ä»¥æ­¤å¤„ä»æ—§ä»¥ V8 runtime ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WasmBase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;initialize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;allow_precompiled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm_vm_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;started_from_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Cloneable&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NotCloneable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// è½½å…¥å­—èŠ‚ç è‡³è™šæ‹Ÿæœºä¹‹ä¸­
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_vm_&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;allow_precompiled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;fail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FailState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;UnableToInitializeCode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to load Wasm code&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;code_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;allow_precompiled_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;allow_precompiled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;abi_version_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_vm_&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getAbiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;abi_version_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AbiVersion&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Unknown&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;fail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FailState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;UnableToInitializeCode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Missing or unknown Proxy-Wasm ABI version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;started_from_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Cloneable&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InstantiatedModule&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// å‘ WASM runtime æ³¨å†Œ API
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;registerCallbacks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm_vm_&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;link&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_id_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;vm_context_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;reset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;createVmContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// è·å– WASM runtime å¯¹å¤–æš´éœ² API
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;getFunctions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;started_from_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Cloneable&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InstantiatedModule&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Base VM was already started, so don&amp;#39;t try to start cloned VMs again.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;startVm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_context_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;isFailed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­éœ€è¦å…³æ³¨çš„æœ‰ä¸‰ä¸ªå‡½æ•°ï¼ˆEnvoy WASM å·²ç»ç›¸å½“å¤æ‚äº†ï¼Œæ‰€ä»¥åˆ‡å¿Œè¿‡å¤šçš„å…³æ³¨ç»†èŠ‚ï¼Œä¸ç„¶ä¼šé™·å…¥åˆ°æ— ç©·çš„ç»†èŠ‚ä¹‹ä¸­ï¼Œè€—æ—¶é•¿ä¹…ï¼Œåè€Œä¸€æ— æ‰€è·ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;registerCallbacks&lt;/li&gt;
&lt;li&gt;linkï¼ˆ&lt;code&gt;proxy_wasm::WasmVm&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;getFunctions&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;registerCallbacks&lt;/code&gt; ä¼šå‘ WASM runtime æ³¨å†Œç›¸å…³çš„ APIï¼Œç”±äº API æ•°é‡å¾ˆå¤šï¼Œæ‰€ä»¥æ­¤å¤„åŒæ ·çœå»å¤§éƒ¨åˆ†ä»£ç ï¼Œåªæˆªå–éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// proxy_wasm src/wasm.cc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WasmBase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;registerCallbacks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// Calls with the &amp;#34;proxy_&amp;#34; prefix.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#define _REGISTER_PROXY(_fn)                                                                       \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;  wasm_vm_-&amp;gt;registerCallback(                                                                      \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;      &amp;#34;env&amp;#34;, &amp;#34;proxy_&amp;#34; #_fn, &amp;amp;exports::_fn,                                                         \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;      &amp;amp;ConvertFunctionWordToUint32&amp;lt;decltype(exports::_fn),                                         \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;                                   exports::_fn&amp;gt;::convertFunctionWordToUint32);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;_REGISTER_PROXY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_header_map_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;_REGISTER_PROXY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;add_header_map_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;_REGISTER_PROXY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;replace_header_map_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;_REGISTER_PROXY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;remove_header_map_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#undef _REGISTER_PROXY
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”±ä¸Šè¿°çš„ä»£ç å¯çŸ¥ï¼Œ&lt;code&gt;registerCallbacks&lt;/code&gt; ä¼šå°† &lt;code&gt;proxy_wasm::exports&lt;/code&gt; ä¸­ç›¸å…³å‡½æ•°é€šè¿‡ WASM runtime æä¾›çš„ &lt;code&gt;registerCallback&lt;/code&gt; æ³¨å†Œåˆ° WASM runtime ä¸­å»ã€‚WASM æ²™ç®±ä¸­çš„ç›¸å…³ä»£ç å°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„å‡½æ•°äº†ã€‚æ­¤å¤„åªéœ€è¦äº†è§£ &lt;code&gt;proxy_wasm::exports&lt;/code&gt; ä¸­æ˜¯ä¸€ä¸ªä¸ªæ³¨å†Œåˆ°æ²™ç®±å¹¶å…è®¸æ²™ç®±å†…è°ƒç”¨çš„ APIï¼Œå¹¶ä¸”ä½¿ç”¨ &lt;code&gt;proxy_wasm::ContextBase&lt;/code&gt; æŒ‡é’ˆä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚åæ–‡åœ¨è®²åˆ° Context æ—¶ä¼šæœ‰æ›´è¯¦ç»†çš„ç¤ºä¾‹è¯´æ˜ API çš„è°ƒç”¨è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ä»¥ V8 runtime ä¸ºä¾‹ï¼ŒæŸ¥çœ‹ &lt;code&gt;registerCallback&lt;/code&gt;  çš„å…·ä½“å®ç°ã€‚å…¶ä¸­ &lt;code&gt;wasm::&lt;/code&gt; åç§°ç©ºé—´ä¸‹çš„ç›¸å…³ç±»å‹å’Œç›¸å…³å‡½æ•°æ˜¯ V8 runtime æœ¬èº«æä¾›çš„çš„ C++ APIï¼Œç”¨äºå¤–éƒ¨ä»£ç å’Œ Sandbox å†…ä»£ç äº¤äº’ã€‚å¯ä»¥çœ‹åˆ°ï¼Œ&lt;code&gt;registerCallback&lt;/code&gt;  å°†åŸæœ¬çš„å‡½æ•°åŒ…è£…ä¹‹åæ·»åŠ åˆ° &lt;code&gt;host_functions_&lt;/code&gt; ä¸­ã€‚åŒ…è£…åçš„å‡½æ•°å°†ä¼šä½¿ç”¨ &lt;code&gt;current_context_&lt;/code&gt; ä½œä¸ºå®é™…æ³¨å…¥å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// proxy_wasm src/v8/v8.cc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;template&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typename&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;R&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;typename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;V8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;registerHostFunctionImpl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;module_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;function_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                  &lt;span class=&#34;n&#34;&gt;R&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;make_unique&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FuncData&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;module_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;function_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FuncType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;convertArgsTupleToValTypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tuple&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                   &lt;span class=&#34;n&#34;&gt;convertArgsTupleToValTypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tuple&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;R&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Func&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;store_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;[](&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Val&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;params&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Val&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;results&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[])&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;own&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Trap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;func_data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;reinterpret_cast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FuncData&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args_tuple&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;convertValTypesToArgsTuple&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tuple&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;params&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tuple_cat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;make_tuple&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;current_context_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args_tuple&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;reinterpret_cast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;R&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;func_data&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;raw_func_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;R&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rvalue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;absl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;apply&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;results&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;makeVal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rvalue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;callback_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;move&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;raw_func_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;reinterpret_cast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;host_functions_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;insert_or_assign&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;module_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;function_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                   &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;move&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;current_context_&lt;/code&gt; æ˜¯ä¸€ä¸ª thread_local çš„å…¨å±€å˜é‡ã€‚æ¯å½“ Envoy ä»å¤–éƒ¨è°ƒç”¨ WASM æ²™ç®±å†… API æ—¶ï¼Œå°†ä¼šè®¾ç½®è¯¥ contextï¼ˆåæ–‡ä¹Ÿä¼šè®²åˆ°ï¼‰ã€‚å½“ WASM æ²™ç®±ä¸­ä»£ç è°ƒç”¨ Envoy API æ—¶ï¼Œå°±å¯ä»¥è·å¾—æ­£ç¡®çš„ contextã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// proxy_wasm include/proxy-wasm/wasm_vm.h
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;*/&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Thread&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;local&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;during&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;call&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;into&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WASM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;VM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;so&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;that&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;calls&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;coming&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// VM can be attributed correctly to calling Filter. We use thread_local instead of ThreadLocal
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// because this state is live only during the calls and does not need to be initialized consistently
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// over all workers as with ThreadLocal data.**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;extern&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;thread_local&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ContextBase&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;current_context_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡ä»¥ä¸Šçš„æ–¹æ³•ï¼Œå°±å¯ä»¥å®ç°æ²™ç®±å¤–çš„ä»£ç /APIï¼ˆ&lt;code&gt;proxy_wasm&lt;/code&gt; ä¸­ä»£ç ä»æ—§æ˜¯æ²™ç®±å¤–ä»£ç ï¼‰å‘æ²™ç®±å†…çš„æ³¨å†Œï¼ˆç›®å‰ä»æ—§æ²¡æœ‰æ³¨å†Œï¼Œåªæ˜¯é€šè¿‡ runtime API å®Œæˆäº†å‡½æ•°ç±»å‹çš„å°è£…ï¼‰ã€‚ï¼ˆå®é™…ä¸Šï¼Œæ›´åº•å±‚çš„å‡½æ•°æ³¨å†Œè¿‡ç¨‹ã€ç±»å‹çš„è½¬æ¢è¿‡ç¨‹ç­‰å®é™…ä¸Šå°±æ˜¯ WASM C++ API çš„å·¥ä½œï¼Œå°±è¶…å‡ºæœ¬æ–‡çš„èŒƒç•´äº†ï¼‰&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;code&gt;initialize&lt;/code&gt; ä¸­ï¼Œå®Œæˆ &lt;code&gt;registerCallbacks&lt;/code&gt; ä¹‹åï¼Œå°±å¯ä»¥å¼€å§‹è¿›ä¸€æ­¥çš„æ“ä½œï¼Œ&lt;code&gt;link&lt;/code&gt;ã€‚link ä¸»è¦å®Œæˆä¸¤ä¸ªæ“ä½œï¼šç¬¬ä¸€ï¼Œå°† &lt;code&gt;registerCallbacks&lt;/code&gt; æ‰€å°è£…å¥½çš„ API æ³¨å†Œç»‘å®šåˆ° WASM æ²™ç®±ä¸­å»ï¼›å°† WASM æ²™ç®±ä¸­æš´éœ²çš„ API å¯¼å‡ºåˆ° &lt;code&gt;proxy_wasm&lt;/code&gt; ä¸­æ¥ã€‚ä»æ—§ä»¥ V8 ä¸ºä¾‹ï¼Œå…¶ &lt;code&gt;link&lt;/code&gt; æ–¹æ³•æºç å¦‚ä¸‹ï¼ˆç•¥å‡ºäº†éƒ¨åˆ†ä»£ç ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;V8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;link&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;debug_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;assert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;module_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;import_types&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;module_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;imports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vector&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Extern&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;imports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;import_types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;module&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;import_types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;module&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;import_types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;module&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;import_types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;import_types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;import_type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;import_types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;import_type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;EXTERN_FUNC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;host_functions_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;find&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;module&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;callback_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;imports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;push_back&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;export_types&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;module_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;exports&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;instance_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;assert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;export_types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;exports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;export_types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;export_types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;export_types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;export_type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;export_types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;export_item&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;exports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;assert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;export_type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;export_item&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;export_type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;EXTERN_FUNC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;assert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;export_item&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;module_functions_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;insert_or_assign&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;export_item&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;isFailed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤å¤„çš„ä»£ç è™½ç„¶ä»æ—§æ˜¯ WASM æ²™ç®±ä¹‹å¤–ï¼Œä½†æ˜¯å·²ç»å¼€å§‹å¤§é‡ä½¿ç”¨ WASM runtime æä¾›çš„å’Œæ²™ç®±äº¤äº’çš„ç±»å‹å’Œ API äº†ã€‚å†æ¬¡å¼ºè°ƒï¼Œå¿½ç•¥ç»†èŠ‚ï¼Œå…³æ³¨æ ¸å¿ƒã€‚è½½å…¥å­—èŠ‚ç ä¹‹åï¼Œå¯ä»¥è·å–å¯¼å…¥ç¬¦å·è¡¨å’Œå¯¼å‡ºç¬¦å·è¡¨ã€‚imports æ˜¯åœ¨æ²™ç®±ä¸­éœ€è¦ä½¿ç”¨ä½†æœªåœ¨æ²™ç®±ä¸­å®ç°æˆ–è€…åˆ›å»ºçš„å‡½æ•° APIã€å†…å­˜å—ç­‰ï¼ˆéœ€è¦ä»å¤–éƒ¨å¼•å…¥ï¼‰ã€‚æ­¤æ—¶å¯ä»¥çœ‹åˆ° &lt;code&gt;link&lt;/code&gt; æ ¹æ® imports ä¸­åç§°ä»  &lt;code&gt;host_functions_&lt;/code&gt; æœç´¢å‡½æ•°å¹¶æ³¨å…¥åˆ° WASM Module ä¸­ä¾› Sandbox è°ƒç”¨ã€‚è€Œåå‘çš„ï¼Œlink ä¹Ÿä¼šå°† WASM æ²™ç®±æœ¬èº«å¯¹å¤–æš´éœ²çš„ API  æ·»åŠ åˆ° &lt;code&gt;module_functions_&lt;/code&gt; ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“åˆ° Envoy HTTP Filter å½“ä¸­ï¼ŒWASM æ²™ç®±éœ€è¦ä»å¤–éƒ¨å¼•å…¥çš„ Envoy API ä»¥åŠè‡ªèº«å¯¹å¤–æš´éœ²çš„ Filter API éƒ½æœ‰å“ªäº›åœ¨åç»­ä»‹ç»åˆ° SDK åï¼Œå„ä½è¯»è€…å°±ä¼šæœ‰æ›´æ˜ç¡®çš„è®¤çŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;å›åˆ°å½“å‰ï¼Œåœ¨ &lt;code&gt;link&lt;/code&gt; æ–¹æ³•æ‰§è¡Œå®Œæˆä¹‹åï¼Œå°±ä¼šæ‰§è¡Œ &lt;code&gt;getFunctions&lt;/code&gt; æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šå°†ä» WASM æ²™ç®±ä¸­å¯¼å‡ºçš„å‡½æ•°ï¼ˆå­˜å‚¨åœ¨ &lt;code&gt;module_functions_&lt;/code&gt; ä¸­ï¼‰ç»‘å®šåˆ° &lt;code&gt;proxy_wasm::WasmBase&lt;/code&gt; çš„æˆå‘˜å½“ä¸­ï¼Œä»¥ä¾›åç»­è°ƒç”¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WasmBase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getFunctions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#define _GET_PROXY(_fn) wasm_vm_-&amp;gt;getFunction(&amp;#34;proxy_&amp;#34; #_fn, &amp;amp;_fn##_);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#define _GET_PROXY_ABI(_fn, _abi) wasm_vm_-&amp;gt;getFunction(&amp;#34;proxy_&amp;#34; #_fn, &amp;amp;_fn##_abi##_);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;_GET_PROXY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;on_request_body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;_GET_PROXY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;on_request_trailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;_GET_PROXY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;on_request_metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;_GET_PROXY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;on_response_body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;_GET_PROXY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;on_response_trailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;abiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AbiVersion&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ProxyWasm_0_1_0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;_GET_PROXY_ABI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;on_request_headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_abi_01&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;_GET_PROXY_ABI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;on_response_headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_abi_01&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;abiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AbiVersion&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ProxyWasm_0_2_0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;n&#34;&gt;abiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AbiVersion&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ProxyWasm_0_2_1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;_GET_PROXY_ABI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;on_request_headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_abi_02&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;_GET_PROXY_ABI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;on_response_headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_abi_02&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;_GET_PROXY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;on_foreign_function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#undef _GET_PROXY_ABI
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#undef _GET_PROXY
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;template&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;V8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getModuleFunctionImpl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;function_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                               &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ContextBase&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;function_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;](&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ContextBase&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Val&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;params&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;makeVal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)...};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å°† API åˆ†è£…ä¸ºä¸€ä¸ªé—­åŒ…å‡½æ•°ã€‚ä¸”åœ¨æ‰§è¡Œ API ä¹‹å‰ï¼Œä¼šé€šè¿‡ SaveRestoreContext çš„æ„é€ å’Œææ„æ¥è®¾ç½®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// current_context_
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;SaveRestoreContext&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;saved_context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;trap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;call&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;params&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;trap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;fail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FailState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RuntimeError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Function: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;function_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; failed: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;trap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;trap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ &lt;code&gt;getFunctions&lt;/code&gt; ä¸­éœ€è¦æ³¨æ„çš„ä¸€ä¸ªç»†èŠ‚æ˜¯ï¼Œå°† WASM æ²™ç®±æš´éœ²çš„ API ç»‘å®šåˆ° &lt;code&gt;proxy_wasm::WasmBase&lt;/code&gt; æˆå‘˜æ—¶ï¼Œä¼šå°† API å†æ¬¡åŒ…è£…ï¼Œå¹¶åœ¨ API è°ƒç”¨å‰åï¼Œé€šè¿‡ &lt;code&gt;SaveRestoreContext&lt;/code&gt; çš„æ„é€ å’Œææ„æ¥å®Œæˆ &lt;code&gt;current_context_&lt;/code&gt; çš„è®¾ç½®å’Œé‡ç½®ã€‚&lt;/p&gt;
&lt;p&gt;å†æ¬¡å›åˆ° &lt;code&gt;proxy_wasm::createWasm&lt;/code&gt; å‡½æ•°ï¼Œå®ƒè¿˜æ²¡æœ‰ç»“æŸã€‚å¯ä»¥ä»ä»£ç çœ‹åˆ°ï¼Œåœ¨å®Œæˆ WASM æ²™ç®±çš„ &lt;code&gt;initialize&lt;/code&gt; ä¹‹åï¼Œå‡½æ•°ç«‹åˆ»å…‹éš†äº†ä¸€ä¸ªæ–°çš„æ²™ç®±å¹¶ä¸”è°ƒç”¨å…¶ start ä»¥åŠ configure ç­‰æ–¹æ³•ï¼Œæ ¡éªŒå­—èŠ‚ç ä»¥åŠå­—èŠ‚ç é…ç½®ã€‚æœ€åï¼Œä¸€å¼€å§‹åˆ›å»ºçš„ WASM æ²™ç®±è¢«åŒ…è£…åœ¨ &lt;code&gt;WasmHandleBase&lt;/code&gt; ä¸­è¢«è¿”å›ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œè¦æ³¨æ„åˆ°ï¼Œåœ¨ &lt;code&gt;proxy_wasm::createWasm&lt;/code&gt; åˆ›å»ºå¹¶åˆå§‹åŒ–å®Œæˆçš„ WASM æ²™ç®±æˆ–è€…è¯´è™šæ‹Ÿæœºä¼šä»¥å‚æ•°ä¸­çš„ vm_key ä¸º key å­˜å‚¨åœ¨ &lt;code&gt;base_wasms&lt;/code&gt; ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å°ç»“ï¼š&lt;code&gt;initialize&lt;/code&gt; æ˜¯åœ¨åˆ›å»º WASM è™šæ‹Ÿæœºè¿‡ç¨‹ä¸­æœ€ä¸ºå…³é”®çš„ä¸€ä¸ªå‡½æ•°ã€‚å®ƒå®Œæˆçš„ Envoy ä¸»è¿›ç¨‹å’Œ Sandbox çš„å¯¹æ¥å’Œäº¤äº’ã€‚é€šè¿‡ &lt;code&gt;registerCallbacks&lt;/code&gt; å°† Envoy éœ€è¦æš´éœ²çš„ API å°è£…ä¸ºæ²™ç®±å¯ä»¥æ‰§è¡Œçš„å‡½æ•°ç±»å‹ï¼ˆWASM runtime æä¾› C++ API å®ç°ï¼‰ã€‚&lt;code&gt;link&lt;/code&gt; å°†å°è£…å¥½çš„ Envoy API æ ¹æ®åç§°æ³¨å†Œåˆ°æ²™ç®±ä¸­ï¼Œå¹¶ä» WASM æ²™ç®± ä¸­å¯¼å‡º Envoy ä¸»è¿›ç¨‹æ‰€éœ€è¦çš„ APIã€‚æœ€åï¼Œ&lt;code&gt;getFunctions&lt;/code&gt; å°†æ²™ç®±å¯¼å‡ºçš„ API ç»‘å®šåˆ° &lt;code&gt;proxy_wasm::WasmBase&lt;/code&gt; ä¸Šï¼Œä¾›åç»­ Envoy è°ƒç”¨ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;5-åªæœ‰-worker-å·¥ä½œ&#34;&gt;5. åªæœ‰ Worker å·¥ä½œ&lt;/h2&gt;
&lt;p&gt;æ³¨æ„åˆ°ï¼Œä¸Šè¿°åˆ›å»ºçš„ WASM æ²™ç®±åªåœ¨ä¸»çº¿ç¨‹å½“ä¸­ã€‚ä½†æ˜¯å®é™…ä¸Š HTTP è¯·æ±‚éƒ½æ˜¯åœ¨å·¥ä½œçº¿ç¨‹ä¸­çš„ã€‚æ‰€ä»¥è¿˜æœ‰ä¸€æ­¥å·¥ä½œè¦åšã€‚&lt;/p&gt;
&lt;p&gt;å›åˆ°æœ€æœ€å¼€å§‹çš„ &lt;code&gt;FilterConfig&lt;/code&gt; æ„é€ å‡½æ•°ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚åœ¨ WASM Sandbox å®Œæˆåˆ›å»ºä¹‹åï¼Œåœ¨ Envoy çš„ createWasmInternal å‡½æ•°ä¸­ï¼Œè¯¥å›è°ƒå‡½æ•°ä¼šè¢«æ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// source/extensions/filters/http/wasm/wasm_filter.cc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;FilterConfig&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FilterConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;envoy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;extensions&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                           &lt;span class=&#34;n&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Configuration&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FactoryContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tls_slot_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;n&#34;&gt;ThreadLocal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TypedSlot&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Common&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PluginHandle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;makeUnique&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;threadLocal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// .......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// å›è°ƒå‡½æ•°ï¼Œå½“æˆåŠŸåˆ›å»º WASM è™šæ‹Ÿæœºä¹‹åæ‰§è¡Œï¼Œç”¨äºåœ¨æ¯ä¸ª Worker çº¿ç¨‹ä¹‹ä¸­éƒ½æ‹·è´åˆ›å»ºä¸€ä¸ª WASM è™šæ‹Ÿæœº
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;callback&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;](&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Common&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmHandleSharedPtr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;base_wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// NB: the Slot set() call doesn&amp;#39;t complete inline, so all arguments must outlive this call.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;tls_slot_&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base_wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;](&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Event&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Dispatcher&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dispatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Common&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getOrCreateThreadLocalPlugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base_wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dispatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥ Callback ä¼šåœ¨æ¯ä¸ªçº¿ç¨‹ï¼ˆåŒ…æ‹¬ä¸»çº¿ç¨‹ï¼‰ä¸­ï¼Œè°ƒç”¨ &lt;code&gt;Common::Wasm::getOrCreateThreadLocalPlugin&lt;/code&gt; æ–¹æ³•ï¼Œå¹¶æœ€ç»ˆè°ƒç”¨ &lt;code&gt;proxy_wasm::proxy_wasm::getOrCreateThreadLocalPlugin&lt;/code&gt; æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// proxy_wasm src/wasm.cc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shared_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmHandleBase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;getOrCreateThreadLocalWasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shared_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmHandleBase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;base_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                           &lt;span class=&#34;n&#34;&gt;WasmHandleCloneFactory&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;clone_factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// Get existing thread-local WasmVM.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;local_wasms&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;find&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;local_wasms&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Remove stale entry.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;local_wasms&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;erase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// Create and initialize new thread-local WasmVM.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;clone_factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;base_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FailState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;UnableToCloneVM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to clone Base Wasm&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;initialize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                       &lt;span class=&#34;n&#34;&gt;base_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;allow_precompiled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;base_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FailState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;UnableToInitializeCode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to initialize Wasm code&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;local_wasms&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shared_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PluginHandleBase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;getOrCreateThreadLocalPlugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shared_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmHandleBase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;base_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shared_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PluginBase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;WasmHandleCloneFactory&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;clone_factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PluginHandleFactory&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin_factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;||&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// Get existing thread-local Plugin handle.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;local_plugins&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;find&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;local_plugins&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin_handle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plugin_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Remove stale entry.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;local_plugins&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;erase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// Get thread-local WasmVM.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;getOrCreateThreadLocalWasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;clone_factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// Create and initialize new thread-local Plugin.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin_context&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plugin_context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;base_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FailState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;StartFailed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to start thread-local Wasm&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;configure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plugin_context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;base_handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FailState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ConfigureFailed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                              &lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to configure thread-local Wasm plugin&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin_handle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin_factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;local_plugins&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin_handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥æ–¹æ³•é¦–å…ˆä¼šåœ¨ &lt;code&gt;local_plugins&lt;/code&gt; ä¸­å°è¯•æœç´¢ï¼Œç¡®è®¤æ˜¯å¦å·²ç»å­˜åœ¨æ‰€éœ€è¦çš„ Pluginï¼ˆvm key ä¸ plugin key å…±åŒç¡®å®šå”¯ä¸€çš„ä¸€ä¸ª pluginï¼‰ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å†æ¬¡å°è¯•å† &lt;code&gt;local_wasms&lt;/code&gt; ä¸­æœç´¢æ˜¯å¦å­˜åœ¨å¯¹åº”çš„ WASM æ²™ç®±ã€‚å¦‚æœ local_wasms ä¸­ä¸å­˜åœ¨å¯¹åº”çš„æ²™ç®±ï¼Œåˆ™ä¼šæŒ‰å‰æ‰€è¿°çš„æ–¹æ³•ï¼Œä»åˆšåˆšä¸»çº¿ç¨‹æ‰€åˆ›å»ºçš„åŸºç¡€æ²™ç®±ä¸­æ‹·è´ä¸€ä»½å¹¶å®Œæˆåˆå§‹åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;local_plugins&lt;/code&gt; å’Œ &lt;code&gt;local_wasms&lt;/code&gt; æ˜¯ threadlocal ç±»å‹ï¼Œç”¨äºå­˜å‚¨ç‰¹å®šçº¿ç¨‹ä¸­çš„ WASM æ²™ç®±ä»¥åŠ Pluginã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åˆ›å»ºå®Œæˆ ThreadLocal çš„ WASM Sandbox ä¹‹åï¼Œä¼šè¿›ä¸€æ­¥æ‰§è¡Œè¯¥æ²™ç®±çš„ start å’Œ configure æ–¹æ³•ä»¥å®ç°å­—èŠ‚ç  Filter çš„é…ç½®åˆå§‹åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œ&lt;code&gt;getOrCreateThreadLocalPlugin&lt;/code&gt; ä¼šè°ƒç”¨ Envoy ä¼ å…¥çš„ä¸€ä¸ªé—­åŒ…å·¥å‚å‡½æ•°æ¥åˆ›å»ºå¯¹åº”ä¸€ä¸ª &lt;code&gt;proxy_wasm::PluginHandleBase&lt;/code&gt;ï¼ˆ&lt;code&gt;Wasm::PluginHandle&lt;/code&gt;ï¼‰å®ä¾‹ã€‚&lt;code&gt;PluginHandleBase&lt;/code&gt; æ˜¯å¯¹ WASM æ²™ç®±çš„ä¸€ä¸ªç®€å•åŒ…è£…ï¼Œç›®å‰åªæ˜¯åŒ…å«æŒ‡å‘æ²™ç®±çš„æŒ‡é’ˆä»¥åŠä¸€ä¸ª Plugin Keyï¼Œæ‰€ä»¥æ­¤å¤„ä¸å†å¤šåšèµ˜è¿°ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å®Œæˆäº†ä»¥ä¸Šçš„æ­¥éª¤ä¹‹åï¼ŒFilterConfig çš„æ„é€ æ‰ç®—çœŸæ­£å®Œæˆã€‚Envoy WASM HTTP Filter çš„é…ç½®æ‰åˆšåˆšåˆå§‹åŒ–å¥½ï¼Œæ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥å¼€å§‹æœåŠ¡ HTTP è¯·æ±‚äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å°ç»“ï¼šä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„æ€§èƒ½ï¼Œåœ¨æ¯ä¸ªçº¿ç¨‹ä¹‹ä¸Šï¼Œéƒ½è‡³å°‘æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ WASM æ²™ç®±ï¼ˆSandbox çš„ä¸ªæ•°ä¸ vm_key æœ‰å…³ï¼Œä¸åŒçš„ vm_key æ ‡è¯†å”¯ä¸€ä¸€ä¸ª æ²™ç®±ï¼‰ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;6-ä¸€ä¸ª-http-è¯·æ±‚&#34;&gt;6. ä¸€ä¸ª HTTP è¯·æ±‚&lt;/h2&gt;
&lt;p&gt;å½“è¯·æ±‚åˆ°æ¥æ—¶ï¼ŒFilterConfig çš„ createFilter æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œåˆ›å»ºä¸€ä¸ª HTTP Filterã€‚å®ƒé¦–å…ˆä¼šä»é€šè¿‡ Envoy çš„ TLS æœºåˆ¶è·å–é…ç½®åˆå§‹åŒ–é˜¶æ®µæœ€ååˆ›å»ºçš„ PluginHandle å¹¶è·å–å¯¹åº”çš„ WASM æ²™ç®±ã€‚ç„¶ååŸºäºè¯¥æ²™ç®±åˆ›å»ºä¸€ä¸ª &lt;code&gt;Wasm::Context&lt;/code&gt; å®ä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// source/extensions/filters/http/wasm/wasm_filter.h
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shared_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;createFilter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tls_slot_&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;has_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plugin_&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fail_open_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;isFailed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_context_id_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;root_context_id_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getRootContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plugin_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;make_shared&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_context_id_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plugin_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;Wasm::Context&lt;/code&gt; æ˜¯ Envoy WASM ä¸­ç¬¬äºŒä¸ªæ ¸å¿ƒç±»å‹ã€‚&lt;code&gt;FilterConfig&lt;/code&gt; è´Ÿè´£äº† WASM æ²™ç®±çš„åˆ›å»ºå’Œç®¡ç†ã€‚è€Œ &lt;code&gt;Wasm::Context&lt;/code&gt; åˆ™è´Ÿè´£äº† Envoy API çš„å®ç°ä»¥åŠ Filter çš„åŒ…è£…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Wasm::Context&lt;/code&gt; å®ç°äº† HTTP Filter/Network Filter çš„çš„æ¥å£ï¼ŒåŒæ—¶ç»§æ‰¿äº† &lt;code&gt;proxy_wasm::ContextBase&lt;/code&gt; ç±»å‹ã€‚å‡ ä¹ Envoy æ‰€æœ‰å¯¹ WASM æ²™ç®±æš´éœ²çš„ API éƒ½ç”± &lt;code&gt;Wasm::Context&lt;/code&gt; å®é™…å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Wasm::Context&lt;/code&gt; è™½ç„¶æºç é‡å¤§ï¼Œä½†æ˜¯åè€Œæ²¡æœ‰ç‰¹åˆ«å¤æ‚çš„åœ°æ–¹ã€‚æ¥ä¸‹æ¥ï¼Œå°†é€šè¿‡ä¸€æ¬¡ HTTP Filter çš„è¯·æ±‚è°ƒç”¨æ¥å¸¦é¢†è¯»è€…å¿«é€Ÿäº†è§£ &lt;code&gt;Wasm::Context&lt;/code&gt; æ˜¯å¦‚ä½•å·¥ä½œå¹¶ä¸ WASM æ²™ç®±äº¤äº’çš„ã€‚&lt;/p&gt;
&lt;p&gt;å½“ Envoy ä¸­ HCM è°ƒç”¨ &lt;code&gt;Wasm::Context&lt;/code&gt; çš„ &lt;code&gt;decodeTrailers&lt;/code&gt; æ–¹æ³•æ—¶ã€‚å°†ä¼šè°ƒç”¨åˆ°åŸºç±» &lt;code&gt;proxy_wasm::ContextBase&lt;/code&gt; çš„ &lt;code&gt;onRequestTrailers&lt;/code&gt; æ–¹æ³•ï¼Œå¹¶æœ€ç»ˆè°ƒç”¨æ²™ç®±å¯¹å¤–æš´éœ²çš„ç›¸å…³ APIã€‚ï¼ˆç»‘å®šåœ¨ &lt;code&gt;proxy::WasmBase&lt;/code&gt; ä¸­ï¼‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// source/extensions/filters/common/context.cc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FilterTrailersStatus&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;decodeTrailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RequestTrailerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;trailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http_request_started_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FilterTrailersStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;request_trailers_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;trailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;convertFilterTrailersStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onRequestTrailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;headerSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;trailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FilterTrailersStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;request_trailers_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// proxy_wasm src/context.cc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;FilterTrailersStatus&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ContextBase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onRequestTrailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;trailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;CHECK_HTTP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;on_request_trailers_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterTrailersStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;n&#34;&gt;FilterTrailersStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;StopIteration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;DeferAfterCallActions&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// å‰æ–‡ä¸­ link å¤„å°† Sandbox API å¯¼å‡ºï¼ŒgetFunctions å®Œæˆ API ç»‘å®š
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;convertVmCallResultToFilterTrailersStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;wasm_&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;on_request_trailers_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;trailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;u64_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è€Œåœ¨ WASM æ²™ç®±å†…éƒ¨ï¼Œå½“å¯¹åº”çš„ API è¢«è°ƒç”¨ï¼Œåœ¨ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹å½“ä¸­åŒæ ·å¯èƒ½ä¼šè°ƒç”¨å¤–éƒ¨ä¸»è¿›ç¨‹å‘æ²™ç®±æ³¨å†Œçš„ä¸€äº› APIï¼ˆå‰æ–‡ä¸­æåˆ°çš„ &lt;code&gt;proxy_wasm::exports&lt;/code&gt; åç§°ç©ºé—´ä¸‹çš„ç›¸å…³å‡½æ•°ï¼‰ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå½“åœ¨æ²™ç®±ä¸­è°ƒç”¨ API æ¥è·å– HTTP request ä¸­ Headers æ—¶ï¼Œå°†ä¼šè°ƒç”¨ &lt;code&gt;proxy_wasm::exports&lt;/code&gt; ä¸­ &lt;code&gt;get_header_map_value&lt;/code&gt; å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ª void ç±»å‹æŒ‡é’ˆï¼Œç”¨äºä¼ é€’è¯·æ±‚ä¸Šä¸‹æ–‡ã€‚ç”±å‰æ–‡çš„ &lt;code&gt;registerCallbacks&lt;/code&gt; ç›¸å…³å†…å®¹å¯çŸ¥ï¼Œ&lt;code&gt;current_context_&lt;/code&gt; å°†è¢«ä½œä¸ºå®å‚ä¼ å…¥ã€‚ä¹Ÿå³æ˜¯è¯´ï¼Œæœ€ç»ˆï¼Œcontext æœ¬èº«çš„ &lt;code&gt;getHeaderMapValue&lt;/code&gt; æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚å¦‚æ­¤å°±å®Œæˆäº† Envoy è°ƒç”¨æ²™ç®± APIï¼Œæ²™ç®±å†…è°ƒç”¨ Envoy API çš„å®Œæ•´äº¤äº’è¿‡ç¨‹äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// proxy_wasm src/exports.cc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Word&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;get_header_map_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;raw_context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Word&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Word&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Word&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          &lt;span class=&#34;n&#34;&gt;Word&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value_ptr_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Word&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value_size_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;static_cast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint64_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmHeaderMapType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MAX&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WasmResult&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BadArgument&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// å°† raw_context è½¬æ¢ä¸º ContextBase ç±»å‹ã€‚ContextBase ä¼šå¯¹è¯·æ±‚ä¸Šä¸‹æ–‡çš„å°è£…ï¼Œåæ–‡å°†ä¼šè¯¦ç»†ä»‹ç»
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WASM_CONTEXT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;raw_context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasmVm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WasmResult&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InvalidMemoryAccess&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string_view&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getHeaderMapValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;static_cast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmHeaderMapType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;u64_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WasmResult&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Ok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;copyToPointerSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value_ptr_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value_size_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WasmResult&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InvalidMemoryAccess&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WasmResult&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Ok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;å°ç»“ï¼šåœ¨ Envoy è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå½“æ’ä»¶é“¾æ‰§è¡Œåˆ° WASM Filter æ—¶ï¼Œä½œä¸º HTTP Filter å’Œ Network Filter åŒ…è£…å™¨çš„ Wasm::Context çš„ç›¸åº”æ¥å£ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”æœ€ç»ˆä¼šè°ƒç”¨æ²™ç®± APIã€‚è€Œæ²™ç®±åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šé€šè¿‡è°ƒç”¨ Envoy APIï¼ˆ&lt;code&gt;proxy_wasm::exports&lt;/code&gt; ä¸­çš„å„ä¸ªå‡½æ•°ï¼‰è·å–æˆ–è€…ä¿®æ”¹è¯·æ±‚çŠ¶æ€ã€‚Envoy API çš„æœ€ç»ˆä¹Ÿä¼šè°ƒç”¨ &lt;code&gt;Wasm::Context&lt;/code&gt; ä¸­çš„æŸä¸ªæˆå‘˜æ–¹æ³•å¦‚ &lt;code&gt;getHeaderMapValue&lt;/code&gt; æ¥å®ç°å¯¹ç‰¹å®šè¯·æ±‚çš„å¤„ç†ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;7-èµ°åœ¨æ²™ç®±ä¹‹å†…&#34;&gt;7. èµ°åœ¨æ²™ç®±ä¹‹å†…&lt;/h2&gt;
&lt;p&gt;å¦‚æœç»†ç»†çœ‹å®Œäº†å‰æ–‡ï¼Œé‚£ä¹ˆç›¸ä¿¡å¯¹äº Envoy ä¸ WASM æ²™ç®±çš„äº¤äº’å·²ç»æœ‰æ‰€äº†è§£ã€‚ä½†æ˜¯ï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªå°å°çš„é—®é¢˜ã€‚å¦‚ä½•ä¿è¯æ²™ç®± API ä¸ proxy::WasmBase ä¸­å¾…ç»‘å®šçš„æˆå‘˜ä¸€ä¸€å¯¹åº”ï¼Ÿï¼ˆæ²™ç®± API æœ€ç»ˆéƒ½ä¼šåœ¨åŒ…è£…ä¹‹åç»‘å®šåˆ° proxy::WasmBase çš„æˆå‘˜ä¸­å¾…è°ƒç”¨ï¼Œå‰æ–‡å·²ç»å¤šæ¬¡è¯´æ˜äº†ï¼‰å¦‚ä½•ä¿è¯ Envoy API ä¸æ²™ç®±éœ€è¦å¼•ç”¨çš„å¤–éƒ¨ API ä¸€ä¸€å¯¹åº”ï¼Ÿï¼ˆæ²™ç®±å¯ä»¥è°ƒç”¨çš„å¤–éƒ¨æ–¹æ³•éƒ½åœ¨ &lt;code&gt;proxy_wasm::exports&lt;/code&gt; ä¸­ï¼Œå¿…é¡»ä¿è¯æ²™ç®±åªå¼•å…¥è¿™ä¸€éƒ¨åˆ† APIã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;è¦ç†è§£è¿™ä¸€éƒ¨åˆ†å†…å®¹ï¼Œå°±å¿…é¡»é˜…è¯» SDK ä»£ç ã€‚æ­¤å¤„ï¼Œä»¥ C++ SDK ä¸ºä¾‹ã€‚å…¶å·¥ç¨‹è·¯å¾„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nl&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//github.com/proxy-wasm/proxy-wasm-cpp-sdk
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;commit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;956f&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d500c380cc1656a2d861b7ee12c2515a664&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‰æ–‡ä¸­ Envoy ä¸»å¹²ä»£ç ä»¥åŠ &lt;code&gt;proxy_wasm&lt;/code&gt; ä¸­ä»£ç ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯åœ¨ä¸»è¿›ç¨‹ä¸­æ‰§è¡Œã€‚è€Œ SDK åˆ™è¿›å…¥äº† WASM æ²™ç®±çš„ä¸–ç•Œã€‚SDK ä¸»è¦çš„è´£ä»»åœ¨äºä¸¤ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¯¹ Envoy ä¸»è¿›ç¨‹ï¼šæš´éœ²ç‰¹å®šçš„æ²™ç®± API åŒæ—¶å£°æ˜å¯¹ Envoy API çš„å¼•ç”¨ï¼›&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯¹ WASM Filterï¼šé€šè¿‡è‰¯å¥½çš„å°è£…éšè— Envoy API çš„ç»†èŠ‚ï¼›é€šè¿‡ç»§æ‰¿å…³ç³»å’Œæ¥å£çš„çº¦æŸï¼Œä¿è¯æš´éœ²çš„æ²™ç®± API å…·å¤‡ç›¸åº”çš„å®ç°ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœç”± Lua C API å¼€å‘ç»éªŒï¼Œç›¸ä¿¡å¤§å®¶å¾ˆå®¹æ˜“å°±èƒ½å¤Ÿç†è§£ï¼Œå› ä¸ºæœ¬è´¨éƒ½æ˜¯å¤§åŒå°å¼‚ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ SDK ä¸­æ²™ç®± API å’Œ Envoy API çš„ç›¸å…³å£°æ˜ã€‚å¯ä»¥æ³¨æ„åˆ°ï¼Œæ²™ç®± API å£°æ˜å’Œ &lt;code&gt;proxy_wasm::WasmBase&lt;/code&gt; ä¸­å¾…ç»‘å®š API çš„æ•°æ®æˆå‘˜å…·å¤‡å¯¹åº”å…³ç³»ã€‚è€Œ Envoy API å£°æ˜åˆ™å’Œ &lt;code&gt;proxy_wasm::exports&lt;/code&gt; ä¸­å‡½æ•°å…·å¤‡å¯¹åº”å…³ç³»ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// C++ SDK proxy_wasm_externs.h
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Sandbox API å£°æ˜
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;extern&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterTrailersStatus&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxy_on_request_trailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;trailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;extern&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterMetadataStatus&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxy_on_request_metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nelements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Envoy API å£°æ˜
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;extern&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WasmResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxy_add_header_map_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmHeaderMapType&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                 &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                 &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value_size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;extern&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WasmResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxy_get_header_map_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WasmHeaderMapType&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                 &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;**&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                 &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value_size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢ä¸€æ®µæºç åˆ™æ˜¯æ²™ç®± API çš„å®ç°ï¼ˆEnvoy API åœ¨ SDK å†…æ²¡æœ‰å®ç°åªèƒ½åŠ è½½åç»‘å®š Envoy ä¸»è¿›ç¨‹æä¾›çš„å®ç°ï¼‰ã€‚å¯ä»¥çœ‹åˆ°ï¼Œæ²™ç®± API æœ€ç»ˆä¼šé€šè¿‡ context_id æ‰¾åˆ°å’Œ Envoy ä¸»è¿›ç¨‹ä¸­ &lt;code&gt;Wasm::Context&lt;/code&gt;ï¼ˆ&lt;code&gt;proxy_wasm::ContextBase&lt;/code&gt;ï¼‰å®ä¾‹å¯¹åº”çš„ä¸€ä¸ª WASM æ²™ç®±å†… SDK Context å®ä¾‹ï¼Œå¹¶è°ƒç”¨å…¶å¯¹åº”çš„æ¥å£å®ç°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// C++ SDK proxy_wasm_intrinsics.cc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Sandbox API å®ç°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;extern&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PROXY_WASM_KEEPALIVE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterMetadataStatus&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxy_on_request_metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                                               &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;context_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onRequestMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;extern&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PROXY_WASM_KEEPALIVE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterTrailersStatus&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxy_on_request_trailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                                               &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;trailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;context_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onRequestTrailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;trailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;SDK Context çš„éƒ¨åˆ†å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Context for a stream. The distinguished context id == 0 is used for
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// non-stream calls.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Context&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ContextBase&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;virtual&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;onRequestHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;virtual&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterMetadataStatus&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onRequestMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterMetadataStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;virtual&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterDataStatus&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onRequestBody&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;cm&#34;&gt;/* body_buffer_length */&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                         &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;cm&#34;&gt;/* end_of_stream */&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterDataStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;virtual&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterTrailersStatus&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onRequestTrailers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterTrailersStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;virtual&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onResponseHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;å°ç»“ï¼šè§æœ¬å°èŠ‚åŠ ç²—å†…å®¹ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;8-ç²¾ç®€ç‰ˆæ€»ç»“&#34;&gt;8. ç²¾ç®€ç‰ˆæ€»ç»“&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-wasm-source-deep-dive/envoy_wasm_hu8136398bf969589c77f6862bf828dfaa_125669_f2d9e859a92ede9ee893a134f85d4e32.webp 400w,
               /blog/envoy-wasm-source-deep-dive/envoy_wasm_hu8136398bf969589c77f6862bf828dfaa_125669_7d4077f0d88b25e14102cf8fab70aadf.webp 760w,
               /blog/envoy-wasm-source-deep-dive/envoy_wasm_hu8136398bf969589c77f6862bf828dfaa_125669_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-wasm-source-deep-dive/envoy_wasm_hu8136398bf969589c77f6862bf828dfaa_125669_f2d9e859a92ede9ee893a134f85d4e32.webp&#34;
               width=&#34;760&#34;
               height=&#34;311&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Wasm::Context&lt;/code&gt;ï¼šå°è£… HTTP/Network Filter æ¥å£ä½¿å¾— Envoy ä¸Šå±‚å¯ä»¥å°†å…¶åµŒå…¥åˆ°æ’ä»¶é“¾ä¸­ã€‚åŒæ—¶æä¾›äº†å¯¹ Envoy API çš„å…·ä½“å®ç°ã€‚å°è£…äº†è¯·æ±‚ä¸Šä¸‹æ–‡ã€‚ç»§æ‰¿è‡ª &lt;code&gt;proxy_wasm::ContextBase&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;proxy_wasm::ContextBase&lt;/code&gt;ï¼šå°è£… &lt;code&gt;proxy_wasm::WasmBase&lt;/code&gt; ä¸­ç»‘å®šçš„ WASM æ²™ç®± APIã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Wasm::Wasm&lt;/code&gt;ï¼šå¯¹ WASM æ²™ç®±çš„ä¸Šå±‚å°è£…ï¼Œç»§æ‰¿è‡ª &lt;code&gt;proxy_wasm::WasmBase&lt;/code&gt;ã€‚ç›¸æ¯”äºå…¶åŸºç±»ï¼Œå¢åŠ äº† Envoy ç›¸å…³çš„ä¸€äº›çŠ¶æ€ï¼Œå¦‚ stats æŒ‡æ ‡ç›‘æ§ï¼Œæ—¥å¿—ä»¥åŠä¸€äº›å…¨å±€çš„ API å¦‚ Cluster Manager ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;proxy_wasm::WasmBase&lt;/code&gt;ï¼šproxy_wasm ä¸­å¯¹ WASM æ²™ç®±çš„å°è£…ã€‚é€šè¿‡ç»„åˆç®¡ç† &lt;code&gt;proxy_wasm::WasmVM&lt;/code&gt;ã€‚ç»‘å®š WASM æ²™ç®± API ä»¥æä¾›ç»™ &lt;code&gt;proxy_wasm::ContextBase&lt;/code&gt; è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;proxy_wasm::WasmVM&lt;/code&gt;ï¼šå¯¹ä¸åŒç±»å‹ WSAM runtime çš„å°è£…ï¼Œæš´éœ²å¤„ç»Ÿä¸€çš„å¯¹å¤–æ¥å£ï¼Œå¦‚æ³¨å†Œ APIï¼Œè·å– API ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;proxy_wasm::exports&lt;/code&gt;ï¼šåç§°ç©ºé—´ã€‚å…¶ä¸­åŒ…å«æ‰€æœ‰ Envoy æä¾›ç»™ WASM æ²™ç®±çš„ Envoy API å‡½æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ä½œè€…ç®€ä»‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç‹ä½°å¹³ï¼Œç½‘æ˜“æ•°å¸†èµ„æ·±å·¥ç¨‹å¸ˆï¼Œè´Ÿè´£è½»èˆŸ Envoy ç½‘å…³ä¸è½»èˆŸ Service Mesh æ•°æ®é¢å¼€å‘ã€åŠŸèƒ½å¢å¼ºã€æ€§èƒ½ä¼˜åŒ–ç­‰å·¥ä½œã€‚å¯¹äº Envoy æ•°æ®é¢å¼€å‘ã€å¢å¼ºã€è½åœ°å…·æœ‰è¾ƒä¸ºä¸°å¯Œçš„ç»éªŒã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Envoy æ˜¯ä»€ä¹ˆï¼Ÿ</title>
      <link>https://cloudnative.to/blog/what-is-envoy/</link>
      <pubDate>Tue, 08 Dec 2020 10:03:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/what-is-envoy/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ª Envoy å®˜æ–¹æ–‡æ¡£ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/what_is_envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;What is Envoy&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Envoy æ˜¯ä¸ºé¢å‘å¤§å‹ç°ä»£æœåŠ¡æ¶æ„è€Œè®¾è®¡çš„ L7 ä»£ç†å’Œé€šä¿¡æ€»çº¿ã€‚è¯¥é¡¹ç›®æºäºä»¥ä¸‹ç†å¿µï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯¹äºåº”ç”¨æ¥è¯´ç½‘ç»œåº”è¯¥æ˜¯é€æ˜çš„ã€‚å½“ç½‘ç»œå’Œåº”ç”¨å‡ºç°æ•…éšœæ—¶ï¼Œåº”è¯¥éå¸¸å®¹æ˜“å®šä½é—®é¢˜å‘ç”Ÿçš„æ ¹æºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;äº‹å®ä¸Šï¼Œå®ç°ä¸Šè¿°çš„ç›®æ ‡éå¸¸å›°éš¾ã€‚Envoy è¯•å›¾é€šè¿‡æä¾›ä»¥ä¸‹é«˜çº§åŠŸèƒ½æ¥å®ç°è¿™ä¸€ç›®æ ‡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿›ç¨‹å¤–æ¶æ„&lt;/strong&gt;ï¼šEnvoy æ˜¯ä¸€ä¸ªç‹¬ç«‹è¿›ç¨‹ï¼Œä¼´éšæ¯ä¸ªåº”ç”¨æœåŠ¡è¿è¡Œã€‚æ‰€æœ‰çš„ Envoy å½¢æˆä¸€ä¸ªé€æ˜çš„é€šä¿¡ç½‘æ ¼ï¼Œæ¯ä¸ªåº”ç”¨ä¸ localhost æ”¶å‘ä¿¡æ¯ï¼Œå¯¹ç½‘ç»œçš„æ‹“æ‰‘ç»“æ„æ— æ„ŸçŸ¥ã€‚åœ¨æœåŠ¡é—´é€šä¿¡çš„åœºæ™¯ä¸‹ï¼Œè¿›ç¨‹å¤–æ¶æ„å¯¹æ¯”ä¼ ç»Ÿè½¯ä»¶åº“çš„æ–¹å¼æœ‰ä¸¤å¤§ä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Envoy é€‚ç”¨äºä»»ä½•åº”ç”¨ç¼–ç¨‹è¯­è¨€ã€‚Envoy éƒ¨ç½²å¯ä»¥åœ¨ Javaã€C++ã€Goã€PHPã€Python ç­‰ä¸åŒè¯­è¨€ç¼–å†™çš„åº”ç”¨ä¹‹é—´å½¢æˆä¸€ä¸ªç½‘æ ¼ã€‚åœ¨é¢å‘æœåŠ¡æ¶æ„ä¸­ï¼Œä½¿ç”¨å¤šç§åº”ç”¨æ¡†æ¶å’Œç¼–ç¨‹è¯­è¨€å˜å¾—è¶Šæ¥è¶Šæ™®éã€‚Envoy å¼¥åˆäº†å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚&lt;/li&gt;
&lt;li&gt;ä»»ä½•ä¸é¢å‘å¤§å‹æœåŠ¡æ¶æ„æ‰“è¿‡äº¤é“çš„äººéƒ½çŸ¥é“éƒ¨ç½²å’Œå‡çº§è½¯ä»¶åº“éå¸¸çš„ç—›è‹¦ã€‚Envoy å¯ä»¥é€æ˜åœ°åœ¨æ•´ä¸ªåŸºç¡€æ¶æ„ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œå‡çº§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;L3/L4 filter æ¶æ„&lt;/strong&gt;ï¼šEnvoy çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ª L3/L4 ç½‘ç»œä»£ç†ã€‚å¯æ’æ‹”çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/listeners/network_filters#arch-overview-network-filters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;filter&lt;/a&gt; é“¾æœºåˆ¶å…è®¸å¼€å‘ filter æ¥æ‰§è¡Œä¸åŒ TCP/UDP ä»£ç†ä»»åŠ¡å¹¶å°†å…¶æ’å…¥åˆ°ä¸»æœåŠ¡ä¸­ã€‚ç°å·²æœ‰å¤šä¸ªæ”¯æŒå„ç§ä»»åŠ¡çš„ filterï¼Œå¦‚åŸå§‹çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/listeners/tcp_proxy#arch-overview-tcp-proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TCP ä»£ç†&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/listeners/udp_proxy#arch-overview-udp-proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;UDP ä»£ç†&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/http/http_connection_management#arch-overview-http-conn-man&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP ä»£ç†&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/security/ssl#arch-overview-ssl-auth-filter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TLS å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_protocols/redis#arch-overview-redis&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Redis&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_protocols/mongo#arch-overview-mongo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MongoDB&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_protocols/postgres#arch-overview-postgres&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Postgres&lt;/a&gt; ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HTTP L7 filter æ¶æ„&lt;/strong&gt;ï¼šHTTP æ˜¯ç°ä»£åº”ç”¨æ¶æ„ä¸­çš„å…³é”®ç»„ä»¶ï¼ŒEnvoy &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/http/http_filters#arch-overview-http-filters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ”¯æŒ&lt;/a&gt; é¢å¤–çš„ HTTP L7 filter å±‚ã€‚å¯ä»¥å°† HTTP filter æ’å…¥æ‰§è¡Œä¸åŒä»»åŠ¡çš„ HTTP è¿æ¥ç®¡ç†å­ç³»ç»Ÿä¸­ï¼Œå¦‚ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/buffer_filter#config-http-filters-buffer&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¼“å­˜&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_features/global_rate_limiting#arch-overview-global-rate-limit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é™é€Ÿ&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/http/http_routing#arch-overview-http-routing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯ç”±/è½¬å‘&lt;/a&gt;ã€å—…æ¢ Amazon çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_protocols/dynamo#arch-overview-dynamo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DynamoDB&lt;/a&gt; ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é¡¶çº§ HTTP/2 æ”¯æŒ&lt;/strong&gt;ï¼šå½“ä»¥ HTTP æ¨¡å¼è¿è¡Œæ—¶ï¼ŒEnvoy åŒæ—¶ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/http/http_connection_management#arch-overview-http-protocols&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ”¯æŒ&lt;/a&gt; HTTP/1.1 å’Œ HTTP/2ã€‚Envoy å¯ä»¥ä½œä¸º HTTP/1.1 å’Œ HTTP/2 ä¹‹é—´çš„åŒå‘é€æ˜ä»£ç†ã€‚è¿™æ„å‘³ç€ä»»æ„ HTTP/1.1 å’Œ HTTP/2 å®¢æˆ·ç«¯å’Œç›®æ ‡æœåŠ¡å™¨çš„ç»„åˆéƒ½å¯ä»¥æ¡¥æ¥åœ¨ä¸€èµ·ã€‚å»ºè®®é…ç½®æ‰€æœ‰æœåŠ¡ä¹‹é—´çš„ Envoy ä½¿ç”¨ HTTP/2 æ¥åˆ›å»ºæŒä¹…è¿æ¥çš„ç½‘æ ¼ï¼Œä»¥ä¾¿å¯ä»¥å®ç°è¯·æ±‚å’Œå“åº”çš„å¤šè·¯å¤ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HTTP L7 è·¯ç”±&lt;/strong&gt;ï¼šå½“ä»¥ HTTP æ¨¡å¼è¿è¡Œæ—¶ï¼ŒEnvoy æ”¯æŒä¸€ç§ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/http/http_routing#arch-overview-http-routing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯ç”±&lt;/a&gt; å­ç³»ç»Ÿï¼Œèƒ½å¤Ÿæ ¹æ®è·¯å¾„ã€æƒé™ã€å†…å®¹ç±»å‹ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/runtime#arch-overview-runtime&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿è¡Œæ—¶&lt;/a&gt; å‚æ•°å€¼ç­‰å¯¹è¯·æ±‚è¿›è¡Œè·¯ç”±å’Œé‡å®šå‘ã€‚è¿™é¡¹åŠŸèƒ½åœ¨å°† Envoy ç”¨ä½œå‰ç«¯/è¾¹ç¼˜ä»£ç†æ—¶éå¸¸æœ‰ç”¨ï¼ŒåŒæ—¶åœ¨æ„å»ºæœåŠ¡ç½‘æ ¼æ—¶ä¹Ÿä¼šä½¿ç”¨æ­¤åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;gRPC æ”¯æŒ&lt;/strong&gt;ï¼š&lt;a href=&#34;https://www.grpc.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC&lt;/a&gt; æ˜¯ä¸€ä¸ªæ¥è‡ª Google çš„ RPC æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ HTTP/2 ä½œä¸ºåº•å±‚å¤šè·¯å¤ç”¨ä¼ è¾“åè®®ã€‚Envoy &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_protocols/grpc#arch-overview-grpc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ”¯æŒ&lt;/a&gt; è¢« gRPC è¯·æ±‚å’Œå“åº”çš„ä½œä¸ºè·¯ç”±å’Œè´Ÿè½½å‡è¡¡åº•å±‚çš„æ‰€æœ‰ HTTP/2 åŠŸèƒ½ã€‚è¿™ä¸¤ä¸ªç³»ç»Ÿæ˜¯éå¸¸äº’è¡¥çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡å‘ç°å’ŒåŠ¨æ€é…ç½®&lt;/strong&gt;ï¼šEnvoy å¯ä»¥é€‰æ‹©ä½¿ç”¨ä¸€ç»„åˆ†å±‚çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/dynamic_configuration#arch-overview-dynamic-config&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ¨æ€é…ç½®&lt;/a&gt; API æ¥å®ç°é›†ä¸­åŒ–ç®¡ç†ã€‚è¿™äº›å±‚ä¸º Envoy æä¾›äº†ä»¥ä¸‹å†…å®¹çš„åŠ¨æ€æ›´æ–°ï¼šåç«¯é›†ç¾¤å†…çš„ä¸»æœºã€åç«¯é›†ç¾¤æœ¬èº«ã€HTTP è·¯ç”±ã€ç›‘å¬å¥—æ¥å­—å’ŒåŠ å¯†ææ–™ã€‚å¯¹äºæ›´ç®€å•çš„éƒ¨ç½²ï¼Œå¯ä»¥ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/service_discovery#arch-overview-service-discovery-types-strict-dns&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€šè¿‡ DNS è§£æ&lt;/a&gt;ï¼ˆç”šè‡³å®Œå…¨ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/service_discovery#arch-overview-service-discovery-types-static&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·³è¿‡&lt;/a&gt;ï¼‰å‘ç°åç«¯ä¸»æœºï¼Œä½¿ç”¨é™æ€é…ç½®æ–‡ä»¶å°†æ›¿ä»£æ·±å±‚é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¥åº·æ£€æŸ¥&lt;/strong&gt;ï¼š&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/service_discovery#arch-overview-service-discovery-eventually-consistent&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ¨è&lt;/a&gt; ä½¿ç”¨å°†æœåŠ¡å‘ç°è§†ä¸ºæœ€ç»ˆä¸€è‡´çš„è¿‡ç¨‹çš„æ–¹å¼æ¥å»ºç«‹ Envoy ç½‘æ ¼ã€‚Envoy åŒ…å«äº†ä¸€ä¸ª &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/health_checking#arch-overview-health-checking&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¥åº·æ£€æŸ¥&lt;/a&gt;ï¼Œå¯ä»¥é€‰æ‹©å¯¹ä¸Šæ¸¸æœåŠ¡é›†ç¾¤æ‰§è¡Œä¸»åŠ¨å¥åº·æ£€æŸ¥ã€‚ç„¶åï¼ŒEnvoy è”åˆä½¿ç”¨æœåŠ¡å‘ç°å’Œå¥åº·æ£€æŸ¥ä¿¡æ¯æ¥ç¡®å®šå¥åº·çš„è´Ÿè½½å‡è¡¡ç›®æ ‡ã€‚Envoy è¿˜é€šè¿‡ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/outlier#arch-overview-outlier-detection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼‚å¸¸æ£€æŸ¥&lt;/a&gt; å­ç³»ç»Ÿæ”¯æŒè¢«åŠ¨å¥åº·æ£€æŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é«˜çº§è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼š&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/overview#arch-overview-load-balancing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´Ÿè½½å‡è¡¡&lt;/a&gt; æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸åŒç»„ä»¶ä¹‹é—´çš„ä¸€ä¸ªå¤æ‚é—®é¢˜ã€‚ç”±äº Envoy æ˜¯ä¸€ä¸ªç‹¬ç«‹ä»£ç†è€Œä¸æ˜¯è½¯ä»¶åº“ï¼Œå› æ­¤å¯ä»¥ç‹¬ç«‹å®ç°é«˜çº§è´Ÿè½½å‡è¡¡ä»¥ä¾›ä»»ä½•åº”ç”¨ç¨‹åºè®¿é—®ã€‚ç›®å‰ï¼ŒEnvoy æ”¯æŒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/http/http_routing#arch-overview-http-routing-retry&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªåŠ¨é‡è¯•&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/circuit_breaking#arch-overview-circuit-break&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†”æ–­&lt;/a&gt;ã€é€šè¿‡å¤–éƒ¨é€Ÿç‡é™åˆ¶æœåŠ¡çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_features/global_rate_limiting#arch-overview-global-rate-limit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¨å±€é™é€Ÿ&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/route/v3/route_components.proto#envoy-v3-api-msg-config-route-v3-routeaction-requestmirrorpolicy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯·æ±‚æ˜ å°„&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/outlier#arch-overview-outlier-detection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼‚å¸¸æ£€æµ‹&lt;/a&gt;ã€‚æœªæ¥è¿˜è®¡åˆ’æ”¯æŒè¯·æ±‚ç«äº‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å‰ç«¯/è¾¹ç¼˜ä»£ç†æ”¯æŒ&lt;/strong&gt;ï¼šåœ¨è¾¹ç¼˜ä½¿ç”¨ç›¸åŒçš„è½¯ä»¶å¤§æœ‰å¥½å¤„ï¼ˆå¯è§‚å¯Ÿæ€§ã€ç®¡ç†ã€ç›¸åŒçš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ç®—æ³•ç­‰ï¼‰ã€‚Envoy åŒ…å«è¶³å¤Ÿå¤šçš„åŠŸèƒ½ï¼Œå¯ä½œä¸ºå¤§å¤šæ•°ç°ä»£ Web åº”ç”¨ç¨‹åºçš„è¾¹ç¼˜ä»£ç†ã€‚åŒ…æ‹¬ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/security/ssl#arch-overview-ssl&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TLS&lt;/a&gt; ç»ˆæ­¢ã€HTTP/1.1 å’Œ HTTP/2 &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/http/http_connection_management#arch-overview-http-protocols&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ”¯æŒ&lt;/a&gt;ï¼Œä»¥åŠ HTTP L7 &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/http/http_routing#arch-overview-http-routing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯ç”±&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ€ä½³çš„å¯è§‚å¯Ÿæ€§&lt;/strong&gt;ï¼šå¦‚ä¸Šæ‰€è¿°ï¼ŒEnvoy çš„ä¸»è¦ç›®æ ‡æ˜¯è®©ç½‘ç»œé€æ˜åŒ–ã€‚ç„¶è€Œï¼Œåœ¨ç½‘ç»œå±‚é¢å’Œåº”ç”¨å±‚é¢éƒ½æœ‰å¯èƒ½å‡ºç°é—®é¢˜ã€‚Envoy åŒ…å«å¯¹æ‰€æœ‰å­ç³»ç»Ÿçš„å¼ºå¤§ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/observability/statistics#arch-overview-statistics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç»Ÿè®¡&lt;/a&gt; æ”¯æŒã€‚ç›®å‰æ”¯æŒ &lt;a href=&#34;https://github.com/etsy/statsd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;statsd&lt;/a&gt;ï¼ˆå’Œå…¼å®¹ç¨‹åºï¼‰ä½œä¸ºç»Ÿè®¡ä¿¡æ¯æ¥æ”¶å™¨ï¼Œä½†æ˜¯æ’å…¥ä¸åŒçš„æ¥æ”¶å™¨å¹¶ä¸å›°éš¾ã€‚ç»Ÿè®¡ä¿¡æ¯ä¹Ÿå¯ä»¥é€šè¿‡ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/operations/admin#operations-admin-interface&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç®¡ç†&lt;/a&gt; ç«¯å£æŸ¥çœ‹ã€‚é€šè¿‡ç¬¬ä¸‰æ–¹æä¾›å•†ï¼ŒEnvoy è¿˜æ”¯æŒåˆ†å¸ƒå¼ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/observability/tracing#arch-overview-tracing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿½è¸ª&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å¦‚ä½•ä¸º Envoy æ„å»ºä¸€ä¸ªæ§åˆ¶é¢æ¥ç®¡ç†é›†ç¾¤ç½‘ç»œæµé‡</title>
      <link>https://cloudnative.to/blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/</link>
      <pubDate>Sat, 21 Nov 2020 08:45:20 +0800</pubDate>
      <guid>https://cloudnative.to/blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://blog.christianposta.com/envoy/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Guidance for Building a Control Plane to Manage Envoy Proxy at the edge, as a gateway, or in a mesh&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« æˆ‘çœ‹äº†ä¹‹åéå¸¸æƒ³ç¿»è¯‘ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸€æ–¹é¢æˆ‘ä¹Ÿåœ¨å­¦ä¹  Envoyï¼Œå¹¶ä¸”åœ¨å…¬å¸çš„å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ Envoyï¼Œå¦ä¸€æ–¹é¢ï¼Œæˆ‘ç¡®å®ä¹Ÿåœ¨è®¾è®¡ä¸€ä¸ªæ§åˆ¶ç®¡ç†ç«¯æ¥ç»Ÿä¸€ç®¡æ§å¤šä¸ªé›†ç¾¤çš„æ‰€æœ‰æµé‡ï¼Œæ²¡é”™æˆ‘è¯´çš„æ˜¯æ‰€æœ‰çš„æµé‡ç®¡æ§ã€‚ç›®å‰è¿™ä¸ªç®¡ç†ç³»ç»Ÿåœ¨å†…éƒ¨å·²ç»åœ¨é€æ­¥ä½¿ç”¨èµ·æ¥äº†ã€‚æ‰€ä»¥ç¿»è¯‘è¿™ç¯‡æ–‡ç« ï¼Œå³å­¦ä¹  Envoy æŠ€æœ¯ï¼Œä¹Ÿæ˜¯æƒ³åšä¸€ä¸ªå‚è€ƒï¼Œå°è¯æˆ‘çš„æƒ³æ³•æ˜¯ä¸æ˜¯ OK çš„ï¼Œå–é•¿è¡¥çŸ­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æŒ‡å¯¼åœ¨æœåŠ¡è¾¹ç¼˜æ„å»ºæ§åˆ¶é¢æ¥ç®¡ç†-envoy-proxyè®©å®ƒä½œä¸ºæœåŠ¡ç½‘å…³æˆ–è€…åœ¨æœåŠ¡ç½‘æ ¼ä¸­ä½¿ç”¨&#34;&gt;æŒ‡å¯¼åœ¨æœåŠ¡è¾¹ç¼˜æ„å»ºæ§åˆ¶é¢æ¥ç®¡ç† Envoy Proxyï¼Œè®©å®ƒä½œä¸ºæœåŠ¡ç½‘å…³æˆ–è€…åœ¨æœåŠ¡ç½‘æ ¼ä¸­ä½¿ç”¨&lt;/h2&gt;
&lt;p&gt;Envoy å·²ç»æˆä¸ºäº†ä¸€ä¸ªéå¸¸æµè¡Œçš„ç½‘ç»œç»„ä»¶äº†ã€‚Matt Klein &lt;a href=&#34;https://blog.envoyproxy.io/the-universal-data-plane-api-d15cec7a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‡ å¹´å‰å†™è¿‡ä¸€ç¯‡åšæ–‡&lt;/a&gt;ï¼Œå°±åœ¨è®¨è®º Envoy çš„åŠ¨æ€é…ç½® API å’Œå®ƒå¦‚ä½•æˆä¸º Envoy è¢«é‡‡ç”¨è¶Šæ¥è¶Šå¤šçš„åŸå› ä¹‹ä¸€ã€‚ä»–åœ¨åšæ–‡ä¸­è¯´è¿™æ˜¯â€œç»Ÿä¸€æ•°æ®é¢æ¿ APIâ€ï¼ˆUDPAï¼‰ã€‚éšç€å¾ˆå¤šå…¶å®ƒé¡¹ç›®éƒ½é‡‡ç”¨ Envoy ä½œä¸ºå…¶æ ¸å¿ƒç»„ä»¶ï¼Œå¯ä»¥æ¯«ä¸å¤¸å¼ çš„è¯´ Envoy ä¸ä»…ä»…å»ºç«‹äº†æ ‡å‡† APIï¼Œè€Œä¸”å¯¹äºåº”ç”¨ 7 å±‚çš„ç½‘ç»œè§£å†³æ–¹æ¡ˆæ¥è¯´ï¼šâ€œEnvoy å·²ç»å˜æˆäº†åœ¨äº‘åŸç”Ÿæ¶æ„ä¸‹çš„ç»Ÿä¸€æ•°æ®å¹³é¢â€ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vlafpmj30dm07f74o_hu6bf1dc25595581217e31a8322eee9229_15412_a163a0d8d2fb5ee4a461a071f8c7bcfe.webp 400w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vlafpmj30dm07f74o_hu6bf1dc25595581217e31a8322eee9229_15412_40c9725ef0bdd5c9994d9f19cd33c42d.webp 760w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vlafpmj30dm07f74o_hu6bf1dc25595581217e31a8322eee9229_15412_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vlafpmj30dm07f74o_hu6bf1dc25595581217e31a8322eee9229_15412_a163a0d8d2fb5ee4a461a071f8c7bcfe.webp&#34;
               width=&#34;490&#34;
               height=&#34;267&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è€Œä¸”ï¼Œç”±äº Envoy çš„ç»Ÿä¸€æ•°æ®å¹³é¢ APIï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸šç•Œå¼€å‘äº†å¾ˆå¤šé’ˆå¯¹åŸºäº Envoy æŠ€æœ¯è®¾æ–½è¿›è¡Œé…ç½®ç®¡ç†çš„ç®¡ç†ç³»ç»Ÿã€‚æœ¬æ–‡å°†ä¼šæ·±å…¥è®¨è®ºä¸º Envoy æ„å»ºä¸€ä¸ªæ§åˆ¶å¹³é¢éœ€è¦ä»€ä¹ˆï¼Œå¤§å®¶å¯ä»¥é€šè¿‡è¿™äº›ä¿¡æ¯æ¥è¯„ä¼°ä»€ä¹ˆæ ·çš„åŸºç¡€è®¾æ–½æœ€é€‚åˆä½ çš„ç»„ç»‡å’Œåœºæ™¯ã€‚å› ä¸ºè¿™ä¸ªæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è¯é¢˜ï¼Œä½œè€…ä¼šå‡ºä¸€ä¸ªç³»åˆ—æ–‡ç« æ¥å¯¹æ­¤è¿›è¡Œè¯¦ç»†è¯´æ˜ï¼ˆåé¢æˆ‘ä¹Ÿä¼šæŒ‘ä¸€äº›æˆ‘æ„Ÿå…´è¶£çš„æ–‡ç« è¿›è¡Œç¿»è¯‘å­¦ä¹ ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;a href=&#34;https://blog.envoyproxy.io/envoycon-recap-579d53576511&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EnvoyCon/KubeCon è®ºå›æœ‰å¾ˆå¤šéå¸¸å¥½çš„è®¨è®º&lt;/a&gt;ï¼Œè¿™é‡Œå¥½å¤šç»„ç»‡éƒ½åˆ†äº«äº†ä»–ä»¬é‡‡ç”¨ Envoy çš„ç»éªŒï¼Œä¹ŸåŒ…æ‹¬äº†å¦‚ä½•æ„å»ºä»–ä»¬è‡ªå·±çš„æ§åˆ¶å¹³é¢ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä»–ä»¬ä¸ºä»€ä¹ˆé€‰æ‹©è‡ªå»ºæ§åˆ¶å¹³é¢çš„åŸå› ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç°æœ‰çš„è§£å†³æ–¹æ¡ˆæ„å»ºåœ¨ä¸åŒçš„æ•°æ®å¹³é¢ä¸Šï¼Œè€Œä¸”å·²ç»æœ‰äº†æ§åˆ¶å¹³é¢ï¼Œéœ€è¦åœ¨è¿™é‡Œå…¼å®¹ Envoyã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºä¸åŒ…å«ä»»ä½•å¼€æºåŸºç¡€è®¾æ–½æ¥æ„å»ºï¼Œæˆ–è€…ä½¿ç”¨å…¶å®ƒçš„ Envoy æ§åˆ¶å¹³é¢ï¼ˆæ¯”å¦‚ï¼šVMsï¼ŒAWSï¼ŒECS ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¸éœ€è¦ä½¿ç”¨æ‰€æœ‰ Envoy çš„ç‰¹æ€§ï¼Œåªæ˜¯éœ€è¦ä¸€éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºäº†æ›´å¥½é€‚é…è‡ªå·±çš„å·¥ä½œæµå’Œå·¥ä½œè§†å›¾è€Œéœ€è¦ä¸º Envoy é…ç½®å¼€å‘ä¸“å±é¢†åŸŸçš„ API å¯¹è±¡æ¨¡å‹ã€‚&lt;/li&gt;
&lt;li&gt;è¦çº¿ä¸Šä½¿ç”¨ï¼Œä½†æ˜¯å‘ç°å…¶å®ƒçš„æ§åˆ¶å¹³é¢å¹¶ä¸å¤Ÿæˆç†Ÿã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vmv5i7j30go0di7a5_hub12fb9ad8728f1f4dd520322db97d959_24348_6151cbfb15dbb9a793111a8d5ab1d3f1.webp 400w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vmv5i7j30go0di7a5_hub12fb9ad8728f1f4dd520322db97d959_24348_c2ab3edc3708b9847e4252d74831db65.webp 760w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vmv5i7j30go0di7a5_hub12fb9ad8728f1f4dd520322db97d959_24348_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vmv5i7j30go0di7a5_hub12fb9ad8728f1f4dd520322db97d959_24348_6151cbfb15dbb9a793111a8d5ab1d3f1.webp&#34;
               width=&#34;600&#34;
               height=&#34;486&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œä»…ä»…å› ä¸ºæœ‰äº›æ—©æœŸä½¿ç”¨è€…æ„å»ºäº†ä»–ä»¬è‡ªå·±çš„æ§åˆ¶å¹³é¢ï¼Œè¿™å¹¶ä¸æ„å‘³ç€ä½ ä¹Ÿåº”è¯¥åšè¿™æ ·çš„äº‹æƒ…ã€‚é¦–å…ˆåœ¨å»å¹´ä¸­å¾ˆå¤šä¸º Envoy å¼€å‘çš„æ§åˆ¶å¹³é¢å·²ç»ç›¸å½“æˆç†Ÿäº†ï¼Œæ‰€ä»¥ä½ åº”è¯¥åœ¨å†³å®šè¦é‡æ–°å¼€å‘å¦å¤–ä¸€ä¸ªæ§åˆ¶å¹³é¢ä¹‹å‰å…ˆæ¥ç ”ç©¶ä¸€ä¸‹è¿™äº›å·²ç»å­˜åœ¨çš„ã€‚å…¶æ¬¡ï¼Œæ­£å¦‚ Datawire çš„äººä»¬å‘ç°ï¼Œå¹¶ä¸” Daniel Bryant æœ€è¿‘ä¹Ÿå‘æ–‡ç« è¯´ï¼Œä¸º Envoy æ„å»ºä¸€ä¸ªæ§åˆ¶å¹³é¢å¹¶ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“çš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å‚ä¸å¼€å‘å‡ ä¸ªä¸º Enovy æ„å»ºæ§åˆ¶å¹³é¢çš„å¼€æºé¡¹ç›®ã€‚æ¯”å¦‚ï¼ŒGloo æ˜¯ä¸€ä¸ªåŠŸèƒ½æ€§ç½‘å…³ï¼Œå®ƒå¯ä»¥ä½œä¸ºå¼ºå¤§çš„ Kubernetes æ¥å…¥æœåŠ¡ï¼ŒAPI ç½‘å…³ï¼Œæˆ–è€…ä½œä¸ºä»å•ä½“æœåŠ¡åˆ°å¾®æœåŠ¡è¿‡åº¦çš„åŠŸèƒ½ç½‘å…³ã€‚Gloo æœ‰ä¸€ä¸ªé’ˆå¯¹ Envoy çš„æ§åˆ¶å¹³é¢ï¼Œå®ƒå¯ä»¥ä½œä¸ºæˆ‘è¿™ä¸ªç³»åˆ—æ–‡ç« çš„ä¾‹å­ï¼Œæ¥è¯´æ˜å¦‚ä½•åœ¨æ§åˆ¶å¹³é¢ä¸ŠæŒ‰ç…§éœ€æ±‚æ¥æŠ½è±¡è®¾è®¡ï¼Œä»¥å®ç°æ’ä»¶ç®¡ç†å’Œæ‰©å±•æ€§ç®¡ç†ã€‚å…¶å®ƒå¯ä»¥å‚è€ƒçš„å·²ç»å®ç°çš„æ§åˆ¶å¹³é¢å¦‚ istio å’Œ &lt;a href=&#34;https://github.com/heptio/contour&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Heptio Contour&lt;/a&gt;ï¼Œè¿™äº›ä¹Ÿæ˜¯è´¯ç©¿æˆ‘è¿™ä¸ªç³»åˆ—æ–‡ç« ä¸­çš„å¥½ä¾‹å­ã€‚å¦‚æœä½ ç¡®å®šè¦è‡ªå·±å¼€å‘æ§åˆ¶å¹³é¢ï¼Œé‚£ä¹ˆé™¤äº†è¿™äº›ï¼Œä½ è¿˜å¯ä»¥å‚è€ƒå…¶å®ƒä¸€äº›å·²ç»å­˜åœ¨çš„æ§åˆ¶å¹³é¢ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vly994j31200a875u_hu79aaf487b850e1ff613096e6f36e3add_32344_bc28e78da3c135b4c92747a2ca36f32d.webp 400w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vly994j31200a875u_hu79aaf487b850e1ff613096e6f36e3add_32344_0bc9beda17977ccc654308dfd581d18d.webp 760w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vly994j31200a875u_hu79aaf487b850e1ff613096e6f36e3add_32344_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vly994j31200a875u_hu79aaf487b850e1ff613096e6f36e3add_32344_bc28e78da3c135b4c92747a2ca36f32d.webp&#34;
               width=&#34;760&#34;
               height=&#34;204&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå…³æ³¨ä»¥ä¸‹ä¸€äº›å…³é”®ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é‡‡ç”¨ä¸€ç§æœºåˆ¶å¯ä»¥åŠ¨æ€æ›´æ–° Envoy çš„è·¯ç”±ï¼ŒæœåŠ¡å‘ç°å’Œå…¶å®ƒé…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;è¯†åˆ«ä½¿ç”¨å“ªäº›ç»„ä»¶æ¥æ„æˆä½ çš„æ§åˆ¶å¹³é¢ï¼ŒåŒ…æ‹¬äº†åç«¯å­˜å‚¨ï¼ŒæœåŠ¡å‘ç° APIï¼Œå®‰å…¨ç»„ä»¶ç­‰ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;æ ¹æ®åœºæ™¯å’Œå›¢é˜Ÿç»„ç»‡ä»¥æœ€åˆé€‚çš„æ–¹å¼å»ºç«‹ä»»æ„åˆ¶å®šåŒºåŸŸçš„é…ç½®å¯¹è±¡å’Œ APIã€‚&lt;/li&gt;
&lt;li&gt;æ€è€ƒå¦‚ä½•åœ¨éœ€è¦çš„åœ°æ–¹ä»¥æœ€å¥½æ–¹å¼åµŒå…¥æ§åˆ¶å¹³é¢ã€‚&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²å„ç§æ§åˆ¶å¹³é¢ç»„ä»¶çš„æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;æ€è€ƒå¦‚ä½•æµ‹è¯•æ§åˆ¶å¹³é¢ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¦å¼€å§‹è¿™ä¸€ç³»åˆ—çš„è®¨è®ºï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹å¦‚ä½•åœ¨ Envoy è¿è¡Œæ—¶ï¼Œä½¿ç”¨ Envoy çš„åŠ¨æ€é…ç½® API æ¥æ›´æ–° Envoyï¼Œä»¥å¤„ç†æ‹“æ‰‘å’Œéƒ¨ç½²ä¸­çš„å˜æ›´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-envoy-çš„-xds-api-åŠ¨æ€é…ç½®-envoy&#34;&gt;ä½¿ç”¨ Envoy çš„ xDS API åŠ¨æ€é…ç½® Envoy&lt;/h2&gt;
&lt;p&gt;åœ¨ Envoy ä¹‹ä¸Šæ„å»ºæ„æ§åˆ¶å¹³é¢çš„ä¸»è¦æ–¹ä¾¿æ”¯æŒå¤„åœ¨äºå®ƒçš„æ•°æ®å¹³é¢ APIã€‚æœ‰äº†æ•°æ®å¹³é¢ APIï¼Œæˆ‘ä»¬å¯å°±å¯ä»¥åŠ¨æ€çš„é…ç½® Envoy çš„å¤§å¤šæ•°é‡è¦è¿è¡Œæ—¶è®¾ç½®ã€‚é€šè¿‡ xDS API è¿›è¡Œçš„ Envoy é…ç½®æ˜¯è¢«è®¾è®¡ä¸ºæœ€ç»ˆä¸€è‡´æ€§çš„ï¼Œæ²¡æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å¯¹é›†ç¾¤ä¸­çš„æ‰€æœ‰ä»£ç†è¿›è¡ŒåŸå­æ€§çš„æ›´æ–°ã€‚å½“æ§åˆ¶å¹³é¢ä¸Šæœ‰é…ç½®æ›´æ–°æ—¶ï¼Œå®ƒå°±é€šè¿‡ xDS API è®©æ•°æ®å¹³é¢ä»£ç†éƒ½å¯ä»¥è·å–åˆ°ï¼Œæ¯ä¸ªä»£ç†éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„æ¥è·å–åº”ç”¨è¿™äº›é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ xDS åŠ¨æ€é…ç½® Envoy çš„éƒ¨åˆ†è¿è¡Œæ—¶æ¨¡å‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/configuration/listeners/lds#config-listeners-lds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç›‘å¬å‘ç°æœåŠ¡ï¼ˆLDSï¼‰API&lt;/a&gt; - LDS ç”¨äºä¸‹å‘æœåŠ¡ç›‘å¬çš„ç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/api-v2/api/v2/eds.proto#envoy-api-file-envoy-api-v2-eds-proto&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç»ˆç«¯å‘ç°æœåŠ¡ï¼ˆEDSï¼‰API&lt;/a&gt;- EDS ç”¨æˆ·æœåŠ¡å‘ç°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/configuration/http_conn_man/rds#config-http-conn-man-rds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯ç”±å‘ç°æœåŠ¡ï¼ˆRDSï¼‰API&lt;/a&gt;- RDS ç”¨äºæµé‡è·¯ç”±å†³ç­–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/configuration/cluster_manager/cds#config-cluster-manager-cds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›†ç¾¤å‘ç°æœåŠ¡ï¼ˆCDSï¼‰&lt;/a&gt;- CDS ç”¨äºå¯ä»¥è·¯ç”±æµé‡è¿‡å»çš„åç«¯æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/configuration/secret&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯†é’¥å‘ç°æœåŠ¡ï¼ˆSDSï¼‰&lt;/a&gt; - SDS ç”¨æˆ·åˆ†å‘å¯†é’¥ï¼ˆè¯ä¹¦å’Œå¯†é’¥ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vnd41kj30p00gmjwe_hu1b87c11f6c87aed80802fb9c813cb3ca_47229_4aa6b6777ab49945741a9e44704f0e33.webp 400w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vnd41kj30p00gmjwe_hu1b87c11f6c87aed80802fb9c813cb3ca_47229_545b06dcaf657e944d5a9224e656a085.webp 760w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vnd41kj30p00gmjwe_hu1b87c11f6c87aed80802fb9c813cb3ca_47229_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/0081Kckwly1gkx5vnd41kj30p00gmjwe_hu1b87c11f6c87aed80802fb9c813cb3ca_47229_4aa6b6777ab49945741a9e44704f0e33.webp&#34;
               width=&#34;760&#34;
               height=&#34;505&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™äº› API ä½¿ç”¨ proto3 çš„ Protocol Buffer æ¥å®šä¹‰çš„ï¼Œå¹¶ä¸”å·²ç»æœ‰ä¸€äº›ç›¸å…³å®ç°äº†ï¼Œå¯ä»¥æä¾›å¤§å®¶åœ¨æ„å»ºè‡ªå·±çš„æ§åˆ¶å¹³é¢æ—¶å‚è€ƒï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/envoyproxy/go-control-plane&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;go-control-plane&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/envoyproxy/java-control-plane&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;java-control-plane&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è™½ç„¶æ¯ä¸ª xDSï¼ˆLDS/EDS/RDS/CDS/SDSï¼Œè¿™äº›ç»Ÿç§° xDSï¼‰éƒ½æ˜¯å¯ä»¥åŠ¨æ€å¯é…ç½®çš„ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€ä½ å¿…é¡»åŠ¨æ€é…ç½®æ‰€æœ‰å†…å®¹ã€‚ä½ å¯ä»¥ç»„åˆé€‚åº”ï¼ŒåŒºåˆ†é™æ€é…ç½®å’ŒåŠ¨æ€é…ç½®ã€‚ä¾‹å¦‚ï¼Œè¦é€šè¿‡é…ç½®å®ç°ä¸€ç§ç±»å‹çš„æœåŠ¡å‘ç°ï¼šå¸Œæœ›ç»ˆç«¯æ˜¯åŠ¨æ€çš„ï¼Œä½†æ˜¯é›†ç¾¤åœ¨éƒ¨ç½²çš„æ—¶å€™å°±æ˜¯å·²ç»çŸ¥é“è·¯ç”±ä¿¡æ¯äº†ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨ Envoy ä¸­çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/api-v2/api/v2/eds.proto#envoy-api-file-envoy-api-v2-eds-proto&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Endpoint Discovery Service&lt;/a&gt; æ¥é™æ€çš„å®šä¹‰é›†ç¾¤çš„é…ç½®ã€‚å¦‚æœåœ¨éƒ¨ç½²çš„æ—¶å€™ä½ ä¸ç¡®å®šæ˜¯é‚£ä¸ªä¸Šæ¸¸é›†ç¾¤ï¼Œé‚£ä½ å¯ä»¥ä½¿ç”¨&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/configuration/cluster_manager/cds#config-cluster-manager-cds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cluster Discovery Service&lt;/a&gt;æ¥åŠ¨æ€çš„é…ç½®å‘ç°ä¸Šæ¸¸ã€‚å…³é”®æ˜¯ä½ å¯ä»¥æ„å»ºä¸€ä¸ªå·¥ä½œæµå’Œå¤„ç†æµç¨‹æ¥é™æ€çš„é…ç½®ä½ éœ€è¦çš„éƒ¨åˆ†ï¼Œè€Œä¸”å¯ä»¥ä½¿ç”¨åŠ¨æ€ xDS æœåŠ¡åœ¨è¿è¡Œæ—¶å‘ç°ä½ éœ€è¦çš„éƒ¨åˆ†ã€‚ä¸ºä»€ä¹ˆæœ‰ä¸åŒçš„æ§åˆ¶å¹³é¢å®ç°ï¼Œå…¶ä¸­ä¸€ä¸ªåŸå› å°±æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰äººéƒ½æœ‰ä¸€ä¸ªå®Œå…¨åŠ¨æ€å’Œå¯æ›¿ä»£çš„ç¯å¢ƒï¼ˆè¿™ä¸ªç¯å¢ƒä¸‹æ‰€æœ‰çš„é…ç½®éƒ½åº”è¯¥æ˜¯åŠ¨æ€çš„ï¼‰ï¼Œè¿™ç‚¹å‡ ä¹ä¸å¯èƒ½ã€‚æ ¹æ®ç°æœ‰æ¡ä»¶çš„çº¦æŸå’Œå¯ç”¨å·¥ä½œæµï¼Œè¦ä¸ºä½ çš„ç³»ç»Ÿé‡‡å–åˆé€‚çº§åˆ«çš„åŠ¨æ€é…ç½®ï¼Œè€Œä¸æ˜¯å…¨åŠ¨æ€é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Gloo çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬åŸºäº go-control-plane çš„å®ç°æ¥æ„å»ºæ§åˆ¶å¹³é¢ï¼Œå®ç°äº† xDS API åˆ° Envoy çš„åŠ¨æ€é…ç½®ã€‚Istio å’Œ Heptio Contour ä¹Ÿæ˜¯ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚è¿™ä¸ªæ§åˆ¶å¹³é¢çš„ API ä½¿ç”¨ gRPC streaming å®ç°ï¼Œå¹¶ä¸”ç•™äº†å®ç°æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å®ç°çš„æ—¶å€™åªéœ€è¦å®ç°è¿™äº›æ¥å£å°±å¯ä»¥äº†ã€‚è¿™ç§æ–¹å¼å¯ä»¥ä»¥éå¸¸é«˜æ•ˆçš„æ–¹å¼æŠŠ Envoy æ•°æ®å¹³é¢ API é›†æˆåˆ°æ§åˆ¶å¹³é¢ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;gRPC streaming æ–¹å¼å¹¶ä¸æ˜¯å”¯ä¸€çš„æ›´æ–° Envoy é…ç½®çš„æ–¹æ³•ã€‚åœ¨&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.5.0/api-v1/api&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy æ—©æœŸç‰ˆæœ¬ä¸­çš„ xDS API&lt;/a&gt;ï¼Œè½®è¯¢æ˜¯å”¯ä¸€æ£€æµ‹æ˜¯å¦æœ‰æ–°é…ç½®å¯ç”¨çš„æ–¹å¼ã€‚è™½ç„¶è¿™ä¹Ÿæ˜¯æ¥å—çš„ï¼Œå¹¶ä¸”ä¹Ÿç¬¦åˆé…ç½®æ›´æ–°æœ€ç»ˆä¸€è‡´æ€§çš„åŸåˆ™ï¼Œä½†æ˜¯åœ¨ç½‘ç»œå’Œè®¡ç®—ä½¿ç”¨ä¸Šè¿˜æ˜¯ä¸å¤Ÿé«˜æ•ˆã€‚ä¹Ÿæ¯”è¾ƒå›°éš¾å»è°ƒæ•´ä¼˜åŒ–è½®è¯¢é…ç½®ä»¥å‡å°‘èµ„æºæµªè´¹ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œä¸€äº› Envoy ç®¡ç†ç³»ç»Ÿçš„å®ç°é‡‡å–ç”Ÿæˆ&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/overview/v2_overview#static&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é™æ€ Envoy é…ç½®æ–‡ä»¶&lt;/a&gt;å’Œç»™ Envoy å‘¨æœŸæ€§çš„è¦†ç›–å†™å…¥ç£ç›˜ä¸Šçš„é…ç½®æ–‡ä»¶ï¼Œå†æ‰§è¡Œ&lt;a href=&#34;https://blog.envoyproxy.io/envoy-hot-restart-1d16b14555b5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy è¿›ç¨‹çš„çƒ­é‡å¯&lt;/a&gt;ã€‚åœ¨é«˜åº¦åŠ¨æ€ç¯å¢ƒä¸­ï¼ˆåƒ Kubernetesï¼Œå®é™…ä¸Šä»»ä½•çŸ­æš‚çš„è®¡ç®—å¹³å°éƒ½ç®—ï¼‰ï¼Œç®¡ç†è¿™ç§æ–‡ä»¶çš„ç”Ÿæˆï¼Œä¼ é€’ï¼Œçƒ­é‡å¯ç­‰ç­‰ä¼šæ˜¾å¾—éå¸¸ç¬¨é‡ã€‚Envoy æœ€åˆå°±æ˜¯åœ¨è¿™æ ·æ“ä½œçš„ï¼ˆLyft å…¬å¸åˆ›å»ºè¿™ä¸ªé¡¹ç›®æ˜¯å°±æ˜¯è¿™æ ·ï¼‰ï¼Œä½†æ˜¯å®ƒé€æ­¥å‘å±•åˆ°ç°åœ¨çš„ xDS API äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;Gloo å›¢é˜Ÿç›¸ä¿¡ä½¿ç”¨ gRPC streaming å’Œ xDS API æ¥å®ç°å¯¹ Envoy çš„åŠ¨æ€é…ç½®å’Œæ§åˆ¶æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„æ–¹å¼ã€‚åŒæ ·ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ Envoy é…ç½®éƒ½åº”è¯¥æ˜¯åŠ¨æ€çš„ï¼Œå°¤å…¶æ˜¯ä½ ä¸éœ€è¦åŠ¨æ€é…ç½®çš„å†…å®¹ã€‚ä½†æ˜¯å¦‚æœä½ æ˜¯åœ¨ä¸€ä¸ªé«˜åº¦åŠ¨æ€çš„ç¯å¢ƒï¼ˆæ¯”å¦‚åœ¨ Kubernetes ä¸­ï¼‰ï¼ŒåŠ¨æ€é…ç½® Envoy å°±å¾ˆå…³é”®äº†ã€‚å…¶å®ƒçš„ç¯å¢ƒæˆ–è®¸ä¹Ÿæœ‰è¿™æ ·çš„éœ€è¦ã€‚ä¸ç®¡æ€ä¹ˆæ ·ï¼ŒåŠ¨æ€é…ç½®ä½¿ç”¨ gRPC streaming API æ˜¯æœ€ç†æƒ³çš„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸€äº›å¥½å¤„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;äº‹ä»¶é©±åŠ¨é…ç½®æ›´æ–°ï¼›åœ¨æ§åˆ¶å¹³é¢ä¸­é…ç½®ä¼šåœ¨å¯ç”¨çš„æ—¶å€™ä¸‹å‘åˆ° Envoyã€‚&lt;/li&gt;
&lt;li&gt;ä¸éœ€è¦è½®è¯¢é…ç½®å˜åŒ–äº†ã€‚&lt;/li&gt;
&lt;li&gt;ä¸éœ€è¦çƒ­é‡å¯ Envoyã€‚&lt;/li&gt;
&lt;li&gt;ä¸ä¼šä¸­æ–­æµé‡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ä¸‹ä¸€æ­¥&#34;&gt;ä¸‹ä¸€æ­¥&lt;/h2&gt;
&lt;p&gt;è¿™æ˜¯ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬åªæ˜¯å»ºç«‹äº†ä¸º Envoy æ„å»ºæ§åˆ¶å¹³é¢çš„åŸºæœ¬æ¦‚å¿µï¼Œç®€è¿°äº† xDS API å’Œå¯¹ Envoy åŠ¨æ€é…ç½®ä¸åŒçš„è€ƒè™‘ã€‚åœ¨ä¸‹ä¸€èŠ‚ï¼Œä¼šåœ¨å‡ å¤©åå‘å¸ƒï¼Œå°†ä¼šæŠŠæ§åˆ¶é¢åˆ†è§£æˆä¸ºå¯éƒ¨ç½²çš„ç»„ä»¶ï¼Œç¡®å®šä½ éœ€è¦çš„ç»„ä»¶ï¼Œç‰¹å®šé¢†åŸŸå¯¹è±¡ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿä»¥åŠå¯¹æ§åˆ¶å¹³é¢æ‰©å±•æ’ä»¶çš„æ€è€ƒã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Envoy è°ƒè¯•æµé‡çš„å¸¸ç”¨æŠ€å·§ç›´æ’­åˆ†äº«åŠé—®ç­”æ•´ç†</title>
      <link>https://cloudnative.to/blog/envoy-ama/</link>
      <pubDate>Mon, 02 Nov 2020 14:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-ama/</guid>
      <description>&lt;p&gt;æœ¬æœŸæ˜¯ Envoy ç³»åˆ—åˆ†äº«çš„ç¬¬ä¸€æœŸï¼Œåœ¨æœ¬æ¬¡åˆ†äº«å¼€å§‹å‰äº‘åŸç”Ÿç¤¾åŒºä¸­è¿›è¡Œäº†å…³äº Envoy çš„é—®å·è°ƒæŸ¥ï¼Œä»é—®å·ç»“æœæ¥çœ‹å¤§å¤šæ•°åŒå­¦éƒ½å¸Œæœ›äº†è§£è°ƒè¯•æµé‡è¿™ä¸ªä¸»é¢˜ï¼Œæ‰€ä»¥å°±é€‰äº†è¿™ä¸ªä¸»é¢˜ä½œä¸ºç¬¬ä¸€æ¬¡åˆ†äº«ã€‚è€Œä¸”å¤§å¤šæ•°åŒå­¦éƒ½æ˜¯åˆšå¼€å§‹çœ‹ Envoyï¼Œæ‰€ä»¥æœ¬æ¬¡åˆ†äº«ä¹Ÿä¼šæ¶‰åŠåˆ°å¾ˆå¤š Envoy å…¥é—¨çš„å†…å®¹ï¼Œæœªæ¥æˆ‘ä¹Ÿä¼šåœ¨ç¤¾åŒºä¸­ç»™å¤§å®¶åˆ†äº«æ›´å¤š Envoy çš„å†…å®¹ã€‚è§†é¢‘å›æ”¾è§ &lt;a href=&#34;https://www.bilibili.com/video/BV1Qa411A7hF&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;B ç«™&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy-ç›´æ’­å›æ”¾åœ°å€&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy ç›´æ’­å›æ”¾åœ°å€&#34; srcset=&#34;
               /blog/envoy-ama/0081Kckwly1gkd7z7bv71j30b40e43zi_hu2101b765fb6e82b49f337bfaa17ca054_34984_4d48131aaed1a05491e223cfbbadac9f.webp 400w,
               /blog/envoy-ama/0081Kckwly1gkd7z7bv71j30b40e43zi_hu2101b765fb6e82b49f337bfaa17ca054_34984_48b0a7b1c45dc3dda466da644a416c1b.webp 760w,
               /blog/envoy-ama/0081Kckwly1gkd7z7bv71j30b40e43zi_hu2101b765fb6e82b49f337bfaa17ca054_34984_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-ama/0081Kckwly1gkd7z7bv71j30b40e43zi_hu2101b765fb6e82b49f337bfaa17ca054_34984_4d48131aaed1a05491e223cfbbadac9f.webp&#34;
               width=&#34;400&#34;
               height=&#34;508&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy ç›´æ’­å›æ”¾åœ°å€
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ­¤æ¬¡åˆ†äº«ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å†å²å’Œè®¾è®¡ç†å¿µï¼šè¿™éƒ¨åˆ†ä¸»è¦æ˜¯ Envoy å…¥é—¨ï¼Œä»‹ç»ä¸ºä»€ä¹ˆ Envoy è¢«å¼€å‘å‡ºæ¥ï¼Œæœ‰å“ªäº›è®¾è®¡ç†å¿µï¼Œæ‰©å±•ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;Envoy å¦‚ä½•å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼šè¿™éƒ¨åˆ†è®²è§£äº†ä¸€ä¸‹ Envoy å¦‚ä½•å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œåœ¨å…¶ä¸­ Listenerã€Transport Socketã€Filterã€Cluster è¿™äº›æ¦‚å¿µåˆ†åˆ«èµ·åˆ°ä»€ä¹ˆä½œç”¨ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ç”¨è°ƒè¯•æµé‡ï¼šåˆ†äº«äº†ä»¥ä¸‹å‡ ç§è°ƒè¯•æµé‡çš„æ–¹æ³•ï¼šæ—¥å¿—ã€statsã€TAPã€‚æ¼”ç¤ºäº†å¦‚ä½•ç”¨æ—¥å¿—å’Œ TAP æ¥è°ƒè¯•æµé‡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Envoy AMAï¼ˆAsk Me Anythingï¼‰ç¯èŠ‚çš„é—®ç­”ä¸»è¦å›´ç»•ç€ï¼šWasmã€Istio æ”¯æŒã€æ€§èƒ½æ–¹é¢ï¼Œè¿˜æœ‰ä¸€äº›ç¤¾åŒºç›¸å…³çš„é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯å¯¹é—®ç­”å†…å®¹çš„æ•´ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;wasm-ç›¸å…³çš„é—®é¢˜&#34;&gt;WASM ç›¸å…³çš„é—®é¢˜&lt;/h2&gt;
&lt;h3 id=&#34;wasm-åœ¨åç«¯å…¶å®ƒé¢†åŸŸæœ‰å“ªäº›åº”ç”¨&#34;&gt;WASM åœ¨åç«¯å…¶å®ƒé¢†åŸŸæœ‰å“ªäº›åº”ç”¨ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;èµ·æºäºæµè§ˆå™¨ï¼Œå®‰å…¨é«˜æ€§èƒ½æ‰§è¡Œ Native Codeã€‚è¡ç”Ÿäº† WASI è§„æ ¼æ”¯æŒå•ç‹¬æ‰§è¡Œæ–‡ä»¶ã€‚å¾®è½¯åŸºäºæ­¤åšäº† WASM å®¹å™¨ (Krustlet)ã€‚&lt;/p&gt;
&lt;h3 id=&#34;envoy-wasm-æ€§èƒ½ä¸æ˜¯å¾ˆç†æƒ³ç¤¾åŒºå¯¹è¿™å—æœ‰ä»€ä¹ˆä¼˜åŒ–çš„æ–¹å‘å—&#34;&gt;Envoy WASM æ€§èƒ½ä¸æ˜¯å¾ˆç†æƒ³ï¼Œç¤¾åŒºå¯¹è¿™å—æœ‰ä»€ä¹ˆä¼˜åŒ–çš„æ–¹å‘å—ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;WASM è¿˜ç›¸å¯¹æ—©æœŸï¼Œåˆå¹¶åˆ°å®˜æ–¹çš„ä»“åº“é‡Œåœ¨æœ¬æœˆåˆå·²å®ç°ï¼ˆè¿˜åœ¨ alpha é˜¶æ®µï¼‰ï¼Œæ€§èƒ½ä¼˜åŒ–è¿˜æ²¡é‡ç‚¹æ”¹è¿›ï¼Œæœ‰å¾ˆå¤§çš„æ”¹è¿›ç©ºé—´ï¼Œæ¬¢è¿è´¡çŒ®ã€‚WASM æœ‰å¾ˆå¤š runtimeï¼Œå¦‚ V8 (Chrome)ã€WAVMã€Cranelift (Firefox) ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;wasm-ä¼šä¸»è¦æ”¯æŒå“ªäº›è¯­è¨€&#34;&gt;WASM ä¼šä¸»è¦æ”¯æŒå“ªäº›è¯­è¨€ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ç†è®ºä¸Šå„ç§è¯­è¨€éƒ½å¯ä»¥æ”¯æŒï¼Œä½†æ˜¯éœ€è¦ç¤¾åŒºè·Ÿè¿›ã€‚ä¸Šä¸ªæœˆ Tetrate å‘å¸ƒäº† &lt;a href=&#34;https://www.getenvoy.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GetEnvoy&lt;/a&gt; Toolkitï¼Œç›®å‰æ”¯æŒ Goã€Rustã€‚&lt;/p&gt;
&lt;h3 id=&#34;envoy-ä¸­ä½¿ç”¨-wasm-å®ç°çš„-filter-å’ŒåŸç”Ÿåœ¨-envoy-é‡Œé¢çš„-c-å®ç°çš„-filter-æ€§èƒ½å·®å¤šå¤§é¢„è®¡ä»€ä¹ˆæ—¶å€™-envoy-çš„-wasm-æ¨¡å—å¯ä»¥ä¸Šç”Ÿäº§ä½¿ç”¨&#34;&gt;Envoy ä¸­ä½¿ç”¨ WASM å®ç°çš„ filter å’ŒåŸç”Ÿåœ¨ Envoy é‡Œé¢çš„ C++ å®ç°çš„ filter æ€§èƒ½å·®å¤šå¤§ï¼Ÿé¢„è®¡ä»€ä¹ˆæ—¶å€™ Envoy çš„ WASM æ¨¡å—å¯ä»¥ä¸Šç”Ÿäº§ä½¿ç”¨ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å·²ç»æœ‰å®é™…è½åœ°ï¼Œå®é™…æ¡ˆä¾‹ï¼Œå¦‚ American Express å’Œ Yahoo ç¾å›½ã€‚EnvoyCon åˆ†åˆ«æœ‰æ¼”è®²ã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œ2-3 å€çš„æ€§èƒ½å·®å¼‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-ç›¸å…³çš„é—®é¢˜&#34;&gt;Istio ç›¸å…³çš„é—®é¢˜&lt;/h2&gt;
&lt;h3 id=&#34;istioenvoy-æœªæ¥çš„è®¡åˆ’æ˜¯å¦ä¼šåœ¨ä»¥åå¯ä»¥ç›´æ¥ä½¿ç”¨-envoyproxyenvoy&#34;&gt;Istio/Envoy æœªæ¥çš„è®¡åˆ’ï¼Ÿæ˜¯å¦ä¼šåœ¨ä»¥åå¯ä»¥ç›´æ¥ä½¿ç”¨ envoyproxy/envoyï¼Ÿ&lt;/h3&gt;
&lt;p&gt;æ˜¯çš„ï¼Œå»å¹´åº•å°±åœ¨å¼€å§‹å¾€è¿™ä¸ªæ–¹å‘åšã€‚æ­£åœ¨æŠŠç°æœ‰çš„ Istio çš„æ‰©å±•åŠŸèƒ½è½¬æ¢æˆ WebAssemblyã€‚&lt;/p&gt;
&lt;h3 id=&#34;envoy-æˆ–è€…-istio-å¯¹äºç¬¬ä¸‰æ–¹åè®®æ‰©å±•æœªæ¥æœ‰ä»€ä¹ˆè®¡åˆ’&#34;&gt;Envoy æˆ–è€… Istio å¯¹äºç¬¬ä¸‰æ–¹åè®®æ‰©å±•æœªæ¥æœ‰ä»€ä¹ˆè®¡åˆ’ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;Envoy ç”±ç¤¾åŒºä¸»å¯¼ï¼Œæ²¡æœ‰æ˜ç¡®çš„æœªæ¥è®¡åˆ’ã€‚éœ€è¦ç»´æŠ¤è€…æ¥ cover è¿™äº›äº‹æƒ…ã€‚ç¬¬ä¸‰æ–¹åè®®èŒƒå›´å¾ˆå¹¿ï¼Œå…¶ä¸­ Tetrate åœ¨åšä¸€äº›æ•°æ®åº“åè®®çš„é›†æˆã€‚å…¶ä»–åè®®ä¾‹å¦‚ Dubbo æˆ–è€… Thrift éœ€è¦è´¡çŒ®è€…å¸®åŠ©ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€§èƒ½æ–¹é¢çš„é—®é¢˜&#34;&gt;æ€§èƒ½æ–¹é¢çš„é—®é¢˜&lt;/h2&gt;
&lt;h3 id=&#34;å¯¹æ¯”-nginxtraefik-ç­‰çš„æ€§èƒ½å·®å¼‚å¦‚ä½•&#34;&gt;å¯¹æ¯” NGINXã€traefik ç­‰çš„æ€§èƒ½å·®å¼‚å¦‚ä½•ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å› ä¸º Envoy é»˜è®¤å¼€å¯å¾ˆå¤šå¯è§‚æµ‹æ€§ä¼šå½±å“å‹æµ‹æ€§èƒ½ï¼Œå¯¹æ­¤ Envoy å®˜æ–¹æ–‡æ¡£é‡Œæœ‰ä¸ª benchmark æ–‡æ¡£è§£è¯´å¦‚ä½•å‹æµ‹ Envoyã€‚æœ‰äº›å‹æµ‹åœºæ™¯ Envoy æ¯” NGINX å¥½ï¼Œæœ‰äº›ç›¸åã€‚Traefik ä¸çŸ¥é“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¦‚ä½•åˆ©ç”¨ç¡¬ä»¶åŠ é€Ÿ-envoy-https&#34;&gt;å¦‚ä½•åˆ©ç”¨ç¡¬ä»¶åŠ é€Ÿ Envoy HTTPSï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å®˜æ–¹æœ‰æ‰©å±•ç‚¹ï¼Œéœ€è¦è‡ªè¡Œæ‰©å±•è€Œå®ç°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åœ¨å“ªé‡Œå¯ä»¥äº†è§£-envoy-çš„æœ€ä½³é…ç½®ä»¥åŠå¦‚ä½•é«˜æ•ˆå¯é çš„ç»´æŠ¤-envoy&#34;&gt;åœ¨å“ªé‡Œå¯ä»¥äº†è§£ Envoy çš„æœ€ä½³é…ç½®ï¼Œä»¥åŠå¦‚ä½•é«˜æ•ˆå¯é çš„ç»´æŠ¤ Envoyï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å–å†³äºå…·ä½“æ¡ˆä¾‹ã€‚å®˜æ–¹æ–‡æ¡£ï¼Œç¬¬ä¸‰æ–¹æ–‡æ¡£æœ‰ç›¸å…³èµ„æ–™ï¼Œ&lt;/p&gt;
&lt;h3 id=&#34;envoy-çš„æ€§èƒ½å¦‚ä½•è°ƒä¼˜&#34;&gt;Envoy çš„æ€§èƒ½å¦‚ä½•è°ƒä¼˜ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å–å†³äºå…·ä½“æ¡ˆä¾‹ã€‚éœ€è¦ Profilingã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆä¸€å¼€å§‹é€‰æ‹©-cæ„Ÿè§‰æ€§èƒ½æ¯”è¾ƒå·®&#34;&gt;ä¸ºä»€ä¹ˆä¸€å¼€å§‹é€‰æ‹© C++ï¼Œæ„Ÿè§‰æ€§èƒ½æ¯”è¾ƒå·®&lt;/h3&gt;
&lt;p&gt;C++ æ¯”ç»å¤§å¤šæ•°è¯­è¨€æ€§èƒ½éƒ½å¥½ã€‚å½“æ—¶æ²¡æœ‰æ›´å¥½çš„è¯­è¨€é€‰æ‹©ã€‚æœ‰ GC çš„è¯­è¨€ä¼šæœ‰å¤§çš„ tail-latencyã€‚C å¯èƒ½å¯ä»¥æ€§èƒ½æ›´å¥½ï¼Œä½†å¯¹å†…å­˜ç®¡ç†æ›´ä¸ºè‹›åˆ»ï¼Œéš¾ç»´æŠ¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äº-xds-çš„é—®é¢˜&#34;&gt;å…³äº xDS çš„é—®é¢˜&lt;/h2&gt;
&lt;h3 id=&#34;å…³äº-on-demandç›®å‰å·²ç»æœ‰äº†-vhdså…¶ä»–-xds-ä¼šé™†ç»­æ”¯æŒå—æ¯”å¦‚-on-demand-cdseds&#34;&gt;å…³äº on-demandï¼Œç›®å‰å·²ç»æœ‰äº† VHDSï¼Œå…¶ä»– xDS ä¼šé™†ç»­æ”¯æŒå—ï¼Ÿæ¯”å¦‚ on-demand CDS/EDS?&lt;/h3&gt;
&lt;p&gt;VHDS å¹¶ä¸æ˜¯ on-demandã€‚ç°åœ¨ä¸»è¦æ˜¯æŠŠ Delta xDS åšå¥½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;envoy-å¦‚ä½•æ ¹æ®è¯·æ±‚å‚æ•°çš„å€¼åŠ¨æ€è¿‡æ»¤-endpoint-å®ä¾‹&#34;&gt;Envoy å¦‚ä½•æ ¹æ®è¯·æ±‚å‚æ•°çš„å€¼ï¼ŒåŠ¨æ€è¿‡æ»¤ endpoint å®ä¾‹ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;é‡‘ä¸é›€å‘å¸ƒ / è“ç»¿å‘å¸ƒã€‚å¯ä»¥å‚ç…§å®˜æ–¹ Subset LB èµ„æ–™ã€‚&lt;/p&gt;
&lt;p&gt;å• Envoy èƒ½å¦åŒæ—¶è¿æ¥å¤šä¸ª xDS server ä»¥åˆå¹¶ CDSã€EDS æ•°æ®ï¼Œä¾‹å¦‚ Istiod + consulï¼Œä»¥é€‚é…æ··åˆç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;CDS æœåŠ¡å™¨éœ€è¦ç»™å‡ºå¯¹åº”çš„ EDS æœåŠ¡ã€‚å–å†³äº CDS æ•°æ®ã€‚&lt;a href=&#34;https://github.com/tetratelabs/istio-cloud-map&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Istio Cloud Map&lt;/a&gt; æ”¯æŒè¿ Consul åˆ° Istioã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…¶ä»–é—®é¢˜&#34;&gt;å…¶ä»–é—®é¢˜&lt;/h2&gt;
&lt;h3 id=&#34;å¯¹äºæ–°æ‰‹å­¦ä¹ -envoy-æœ‰å“ªäº›å»ºè®®&#34;&gt;å¯¹äºæ–°æ‰‹å­¦ä¹  Envoy æœ‰å“ªäº›å»ºè®®ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆæ ¹æ®è‡ªå·±çš„ç”¨ä¾‹å’Œæ–¹å‘æ€§æ¥ç¡®å®šç›®æ ‡ï¼ŒEnvoy æœ¬èº«åŠŸèƒ½å¼ºå¤§èŒƒå›´å¹¿ï¼Œå®˜ç½‘èµ„æ–™ç›¸å¯¹é½å…¨ã€‚ç¤¾åŒºï¼ˆSlackã€GitHubï¼‰æé—®ä¸€èˆ¬å¯ä»¥å¾—åˆ°å›ç­”ã€‚&lt;/p&gt;
&lt;h3 id=&#34;listenerfilter-å‰åé¡ºåºæœ‰å½±å“å—&#34;&gt;ListenerFilter å‰åé¡ºåºæœ‰å½±å“å—ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;æœ‰çš„æ²¡æœ‰ï¼ˆå¦‚ HTTPï¼‰ï¼Œæœ‰çš„æœ‰å½±å“ï¼ˆå¦‚ Proxy Protocolï¼‰&lt;/p&gt;
&lt;h3 id=&#34;listenerfilter-å†²çªä¼šå’Œæ—¶é—´æœ‰å…³å—ç°åœ¨æœ‰-debug-æ–¹æ¡ˆå’Œè¿‡æ»¤éªŒè¯æœºåˆ¶å—&#34;&gt;ListenerFilter å†²çªä¼šå’Œæ—¶é—´æœ‰å…³å—ï¼Ÿç°åœ¨æœ‰ debug æ–¹æ¡ˆå’Œè¿‡æ»¤éªŒè¯æœºåˆ¶å—ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;è¶…æ—¶æœºåˆ¶è·Ÿæ—¶é—´æœ‰å…³ï¼ˆserver ä¸»åŠ¨å‘èµ·çš„æ¶ˆæ¯åœºæ™¯éœ€è¦è¶…æ—¶æœºåˆ¶ï¼‰&lt;/p&gt;
&lt;h3 id=&#34;envoy-çš„è¿è¡Œæ—¶çš„åŠ¨æ€é…ç½®ä¸ºä»€ä¹ˆä¸åšæŒä¹…åŒ–å¤„ç†åŠ¨æ€æ›´æ–°çš„é…ç½®è½ç›˜&#34;&gt;Envoy çš„è¿è¡Œæ—¶çš„åŠ¨æ€é…ç½®ä¸ºä»€ä¹ˆä¸åšæŒä¹…åŒ–å¤„ç†ï¼ˆåŠ¨æ€æ›´æ–°çš„é…ç½®è½ç›˜ï¼‰ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªå¸¸è§é—®é¢˜ï¼ŒæŒä¹…è¯åŠ¨æ€é…ç½®æ˜¯é”™è¯¯è¡¥ä¸ï¼Œåº”è¯¥æå‡æ§åˆ¶é¢çš„å¯é æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;tetrate-å¯¹-envoy-éƒ½åœ¨å“ªäº›æ–¹é¢åšäº†å¢å¼º&#34;&gt;Tetrate å¯¹ Envoy éƒ½åœ¨å“ªäº›æ–¹é¢åšäº†å¢å¼ºï¼Ÿ&lt;/h3&gt;
&lt;p&gt;åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GetEnvoy: &lt;a href=&#34;https://www.getenvoy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.getenvoy.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;PostgreSQL Filter&lt;/li&gt;
&lt;li&gt;WASM æ‰©å±•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¤§å®¶å¯ä»¥å…³æ³¨ Tetrate çš„å¾®ä¿¡å…¬ä¼—å·ï¼Œäº†è§£ Tetrate å¯¹ Envoy æ”¯æŒçš„æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-tetrate-å…¬ä¼—å·&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;tetrate å…¬ä¼—å·&#34; srcset=&#34;
               /blog/envoy-ama/0081Kckwly1gkce34sy73j303k03k3yf_hu0c8271da16373a1555b1e6dcde2d9cea_7401_e5d9a103d2ed72855450b66ca5d25203.webp 400w,
               /blog/envoy-ama/0081Kckwly1gkce34sy73j303k03k3yf_hu0c8271da16373a1555b1e6dcde2d9cea_7401_8b5d46297f083b03da1e42e7355f7276.webp 760w,
               /blog/envoy-ama/0081Kckwly1gkce34sy73j303k03k3yf_hu0c8271da16373a1555b1e6dcde2d9cea_7401_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-ama/0081Kckwly1gkce34sy73j303k03k3yf_hu0c8271da16373a1555b1e6dcde2d9cea_7401_e5d9a103d2ed72855450b66ca5d25203.webp&#34;
               width=&#34;128&#34;
               height=&#34;128&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      tetrate å…¬ä¼—å·
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆä¸åŸºäº-nginx-æ”¹é€ &#34;&gt;ä¸ºä»€ä¹ˆä¸åŸºäº Nginx æ”¹é€ ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;åœ¨åšç½‘å…³çš„æ—¶å€™å·²ç»è°ƒæŸ¥è¿‡å¾ˆå¤šäº§å“ï¼ŒEnvoy çš„å¯æ‰©å±•æ€§å¼ºï¼ŒXDS å¯ä»¥åŠ¨æ€é…ç½® service meshï¼Œæœ‰å¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œè¿™ä¸ªä¸å…¶ä»–ç½‘å…³äº§å“ä¸åŒã€‚ç¤¾åŒºæ–‡åŒ–ä¸ HAProxyã€Nginx ä¸åŒï¼Œä»–ä»¬éƒ½æ˜¯å•†ä¸šå…¬å¸çš„èƒŒæ™¯å¼€å‘çš„ï¼Œå¢åŠ åŠŸèƒ½çš„æ—¶å€™ä¸ä»–ä»¬çš„å•†ä¸šç‰ˆæœ¬ä¼šæœ‰å†²çªã€‚Envoy è¿˜æ²¡æœ‰å•†ä¸šå…¬å¸å®Œå…¨æ§åˆ¶å…¶å¼€æºï¼Œæ›´ç¤¾åŒºåŒ–ä¸€äº›ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¦‚ä½•æäº¤-pr-å’Œ-feature-ç»™-envoy-ç¤¾åŒº&#34;&gt;å¦‚ä½•æäº¤ PR å’Œ feature ç»™ Envoy ç¤¾åŒºï¼Ÿ&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆæäº¤ GitHub issueï¼Œæ‰©å±•éœ€è¦ç»´æŠ¤è€… sponsorï¼Œå‚åŠ ç¤¾åŒºä¼šè®®è®¨è®ºï¼ˆæ¯æœˆ 2 æ¬¡ï¼Œä¸€æ¬¡è¥¿æµ·å²¸æ—¶é—´æ—©ä¸Šï¼Œä¸€æ¬¡äºšå¤ªæ—¶é—´æ—©ä¸Šï¼‰&lt;/p&gt;
&lt;h3 id=&#34;envoy-åç»­æ”¯æŒ-graphql-çš„è®¡åˆ’&#34;&gt;Envoy åç»­æ”¯æŒ graphQL çš„è®¡åˆ’&lt;/h3&gt;
&lt;p&gt;éœ€è¦ç»´æŠ¤è€…æäº¤ã€‚&lt;/p&gt;
&lt;h3 id=&#34;envoycon-è§†é¢‘ä»€ä¹ˆæ—¶å€™æœ‰&#34;&gt;EnvoyCon è§†é¢‘ä»€ä¹ˆæ—¶å€™æœ‰ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;EnvoyCon 10 æœˆ 15 å·åˆšå¼€å®Œï¼Œä¸‹ä¸ªæœˆå³å¯æœ‰è§†é¢‘ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åœ¨ Istio ä¸­å®ç° Redis é›†ç¾¤çš„æ•°æ®åˆ†ç‰‡ã€è¯»å†™åˆ†ç¦»å’Œæµé‡é•œåƒ</title>
      <link>https://cloudnative.to/blog/redis-cluster-with-istio/</link>
      <pubDate>Mon, 26 Oct 2020 11:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/redis-cluster-with-istio/</guid>
      <description>&lt;p&gt;Redis æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ key-value å­˜å‚¨ç³»ç»Ÿï¼Œè¢«å¹¿æ³›ç”¨äºå¾®æœåŠ¡æ¶æ„ä¸­ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦ä½¿ç”¨ Redis é›†ç¾¤æ¨¡å¼æä¾›çš„é«˜çº§ç‰¹æ€§ï¼Œåˆ™éœ€è¦å¯¹å®¢æˆ·ç«¯ä»£ç è¿›è¡Œæ”¹åŠ¨ï¼Œè¿™å¸¦æ¥äº†åº”ç”¨å‡çº§å’Œç»´æŠ¤çš„ä¸€äº›å›°éš¾ã€‚åˆ©ç”¨ Istio å’Œ Envoyï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç çš„å‰æä¸‹å®ç°å®¢æˆ·ç«¯æ— æ„ŸçŸ¥çš„ Redis Cluster æ•°æ®åˆ†ç‰‡ï¼Œå¹¶æä¾›è¯»å†™åˆ†ç¦»ã€æµé‡é•œåƒç­‰é«˜çº§æµé‡ç®¡ç†åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;redis-cluster&#34;&gt;Redis Cluster&lt;/h2&gt;
&lt;p&gt;Redis çš„ä¸€ä¸ªå¸¸è§ç”¨é€”æ˜¯ç”¨ä½œæ•°æ®é«˜é€Ÿç¼“å­˜ã€‚é€šè¿‡åœ¨åº”ç”¨æœåŠ¡å™¨å’Œæ•°æ®åº“æœåŠ¡å™¨ä¹‹é—´åŠ å…¥ä¸€ä¸ª Redis ç¼“å­˜å±‚ï¼Œå¯ä»¥å‡å°‘åº”ç”¨æœåŠ¡å™¨å¯¹æ•°æ®åº“çš„å¤§é‡è¯»æ“ä½œï¼Œé¿å…æ•°æ®åº“æœåŠ¡å™¨åœ¨å¤§å‹åŠ›ä¸‹å“åº”ç¼“æ…¢ç”šè‡³å®•æœºçš„é£é™©ï¼Œæ˜¾è‘—åŠ å¼ºæ•´ä¸ªç³»ç»Ÿçš„å¥å£®æ€§ã€‚Redis ä½œä¸ºæ•°æ®ç¼“å­˜çš„åŸç†å¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/redis-cluster-with-istio/images/redis-as-cache_hu3d9207b6334bba1f01f3327c446d9094_32114_b3dde88ba07705a383d844c4bcd3e8a8.webp 400w,
               /blog/redis-cluster-with-istio/images/redis-as-cache_hu3d9207b6334bba1f01f3327c446d9094_32114_8523ad33872dc825c2cccc4044d69a3f.webp 760w,
               /blog/redis-cluster-with-istio/images/redis-as-cache_hu3d9207b6334bba1f01f3327c446d9094_32114_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/redis-cluster-with-istio/images/redis-as-cache_hu3d9207b6334bba1f01f3327c446d9094_32114_b3dde88ba07705a383d844c4bcd3e8a8.webp&#34;
               width=&#34;491&#34;
               height=&#34;225&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ä¸€ä¸ªå°è§„æ¨¡çš„ç³»ç»Ÿä¸­ï¼Œä¸Šå›¾æ‰€ç¤ºçš„å•ä¸ª Redis å°±å¯ä»¥å¾ˆå¥½åœ°å®ç°ç¼“å­˜å±‚çš„åŠŸèƒ½ã€‚å½“ç³»ç»Ÿä¸­éœ€è¦ç¼“å­˜çš„æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œä¸€ä¸ª Redis æœåŠ¡å™¨æ— æ³•æ‰¿æ‹…æ‰€æœ‰åº”ç”¨æœåŠ¡å™¨çš„ç¼“å­˜éœ€æ±‚ï¼›åŒæ—¶å•ä¸ª Redis å®ä¾‹å¤±æ•ˆæ—¶ä¹Ÿä¼šå¯¼è‡´å¤§é‡è¯»è¯·æ±‚è¢«ç›´æ¥å‘é€åˆ°åç«¯çš„æ•°æ®åº“æœåŠ¡å™¨ä¸Šï¼Œå¯¼è‡´æ•°æ®åº“æœåŠ¡å™¨ç¬æ—¶å‹åŠ›è¶…æ ‡ï¼Œå½±å“ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ &lt;a href=&#34;https://redis.io/topics/cluster-spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Redis Cluster&lt;/a&gt; æ¥å¯¹ç¼“å­˜æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œå°†ä¸åŒçš„æ•°æ®æ”¾åˆ°ä¸åŒçš„ Redis åˆ†ç‰‡ä¸­ï¼Œä»¥æé«˜ Redis ç¼“å­˜å±‚çš„å®¹é‡èƒ½åŠ›ã€‚åœ¨æ¯ä¸ª Redis åˆ†ç‰‡ä¸­ï¼Œè¿˜å¯ä»¥é‡‡ç”¨å¤šä¸ª replica èŠ‚ç‚¹å¯¹ç¼“å­˜çš„è¯»è¯·æ±‚è¿›è¡Œè´Ÿè½½åˆ†æ‹…ï¼Œå¹¶å®ç° Redis çš„é«˜å¯ç”¨ã€‚é‡‡ç”¨äº† Redis Cluster çš„ç³»ç»Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/redis-cluster-with-istio/images/redis-cluster-no-proxy_huba836917efa84911435a9b0e8a37f54a_77682_f5d1b291eee788894e881ec1ddd0c044.webp 400w,
               /blog/redis-cluster-with-istio/images/redis-cluster-no-proxy_huba836917efa84911435a9b0e8a37f54a_77682_7ad40ecd53c53b56872c5c5bee62d69d.webp 760w,
               /blog/redis-cluster-with-istio/images/redis-cluster-no-proxy_huba836917efa84911435a9b0e8a37f54a_77682_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/redis-cluster-with-istio/images/redis-cluster-no-proxy_huba836917efa84911435a9b0e8a37f54a_77682_f5d1b291eee788894e881ec1ddd0c044.webp&#34;
               width=&#34;760&#34;
               height=&#34;384&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ Redis Cluster æ¨¡å¼ä¸‹ï¼Œå®¢æˆ·ç«¯éœ€è¦æ ¹æ®é›†ç¾¤çš„åˆ†ç‰‡è§„åˆ™å°†ä¸åŒ key çš„è¯»å†™æ“ä½œå‘é€åˆ°é›†ç¾¤ä¸­ä¸åŒçš„ Redis èŠ‚ç‚¹ä¸Šï¼Œå› æ­¤å®¢æˆ·ç«¯éœ€è¦äº†è§£ Redis Cluster çš„æ‹“æ‰‘ç»“æ„ï¼Œè¿™å¯¼è‡´æˆ‘ä»¬æ— æ³•åœ¨ä¸ä¿®æ”¹å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹å°†ä¸€ä¸ªä½¿ç”¨ Redis ç‹¬ç«‹èŠ‚ç‚¹æ¨¡å¼çš„åº”ç”¨å¹³æ»‘è¿ç§»åˆ° Redis Cluster ä¸Šã€‚å¦å¤–ï¼Œç”±äºå®¢æˆ·ç«¯éœ€è¦äº†è§£ Redis Cluster çš„å†…éƒ¨æ‹“æ‰‘ï¼Œä¹Ÿå°†å¯¼è‡´å®¢æˆ·ç«¯ä»£ç å’Œ Redis Cluster è¿ç»´ä¸Šçš„è€¦åˆï¼Œä¾‹å¦‚è¦å®ç°è¯»å†™åˆ†ç¦»æˆ–è€…æµé‡é•œåƒçš„è¯ï¼Œå°±éœ€è¦ä¿®æ”¹æ¯ä¸ªå®¢æˆ·ç«¯çš„ä»£ç å¹¶é‡æ–°éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨æœåŠ¡å™¨å’Œ Redis Cluster ä¹‹é—´æ”¾ç½®ä¸€ä¸ª Envoy ä»£ç†æœåŠ¡å™¨ï¼Œç”± Envoy æ¥è´Ÿè´£å°†åº”ç”¨å‘å‡ºçš„ç¼“å­˜è¯»å†™è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„ Redis èŠ‚ç‚¹ä¸Šã€‚ä¸€ä¸ªå¾®æœåŠ¡ç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡éœ€è¦è®¿é—®ç¼“å­˜æœåŠ¡å™¨çš„åº”ç”¨è¿›ç¨‹ï¼Œä¸ºäº†é¿å…å•ç‚¹æ•…éšœå’Œæ€§èƒ½ç“¶é¢ˆï¼Œæˆ‘ä»¬ä»¥ Sidecar çš„å½¢å¼ä¸ºæ¯ä¸ªåº”ç”¨è¿›ç¨‹éƒ¨ç½²ä¸€ä¸ª Envoy ä»£ç†ã€‚åŒæ—¶ï¼Œä¸ºäº†ç®€åŒ–å¯¹è¿™äº›ä»£ç†çš„ç®¡ç†å·¥ä½œï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ Istio ä½œä¸ºæ§åˆ¶é¢æ¥ç»Ÿä¸€å¯¹æ‰€æœ‰ Envoy ä»£ç†è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/redis-cluster-with-istio/images/redis-cluster-with-proxy_hucbdfe8712407070907d2a3e51e04c9b0_89297_b95df2fcd74e781a48ae16435e0df947.webp 400w,
               /blog/redis-cluster-with-istio/images/redis-cluster-with-proxy_hucbdfe8712407070907d2a3e51e04c9b0_89297_a7fbcb40ba7fd18120e0b9879b86d1d0.webp 760w,
               /blog/redis-cluster-with-istio/images/redis-cluster-with-proxy_hucbdfe8712407070907d2a3e51e04c9b0_89297_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/redis-cluster-with-istio/images/redis-cluster-with-proxy_hucbdfe8712407070907d2a3e51e04c9b0_89297_b95df2fcd74e781a48ae16435e0df947.webp&#34;
               width=&#34;760&#34;
               height=&#34;361&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬æ–‡çš„åç»­éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•é€šè¿‡ Istio å’Œ Envoy æ¥ç®¡ç† Redis Clusterï¼Œå®ç°å®¢æˆ·ç«¯æ— æ„ŸçŸ¥çš„æ•°æ®åˆ†åŒºï¼Œä»¥åŠè¯»å†™åˆ†ç¦»ã€æµé‡é•œåƒç­‰é«˜çº§è·¯ç”±ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²-istio&#34;&gt;éƒ¨ç½² Istio&lt;/h2&gt;
&lt;p&gt;Pilot ä¸­å·²ç»æ”¯æŒäº† Redis åè®®ï¼Œä½†åŠŸèƒ½è¾ƒå¼±ï¼Œåªèƒ½ä¸º Redis ä»£ç†é…ç½®ä¸€ä¸ªç¼ºçœè·¯ç”±ï¼Œè€Œä¸”ä¸æ”¯æŒ Redis Cluster æ¨¡å¼ï¼Œæ— æ³•å®ç° Redis filter çš„æ•°æ®åˆ†ç‰‡ã€è¯»å†™åˆ†ç¦»ã€æµé‡é•œåƒç­‰é«˜çº§æµé‡ç®¡ç†åŠŸèƒ½ã€‚ä¸ºäº†è®© Istio å¯ä»¥å°† Redis Cluster ç›¸å…³çš„é…ç½®ä¸‹å‘åˆ° Envoy Sidecar ä¸Šï¼Œæˆ‘ä»¬ä¿®æ”¹äº† EnvoyFilter é…ç½®ç›¸å…³ä»£ç ï¼Œä»¥æ”¯æŒ EnvoyFilter çš„ &amp;ldquo;REPLCAE&amp;rdquo; æ“ä½œã€‚è¯¥ä¿®æ”¹çš„ PR &lt;a href=&#34;https://github.com/istio/istio/pull/27426/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Implement REPLACE operation for EnvoyFilter patch&lt;/a&gt; å·²ç»æäº¤åˆ° Istio ç¤¾åŒºï¼Œå¹¶åˆå…¥åˆ°äº†ä¸»åˆ†æ”¯ä¸­ï¼Œå°†åœ¨ Istio åç»­çš„ç‰ˆæœ¬ä¸­å‘å¸ƒã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ’°å†™æœ¬æ–‡çš„æ—¶å€™ï¼Œæœ€æ–°çš„ Istio å‘å¸ƒç‰ˆæœ¬ 1.7.3 ä¸­å°šæœªåˆå…¥è¯¥ PRã€‚å› æ­¤æˆ‘æ„å»ºäº†ä¸€ä¸ª Pilot é•œåƒï¼Œä»¥å¯ç”¨ EnvoyFilter çš„ &amp;ldquo;REPLACE&amp;rdquo; æ“ä½œã€‚åœ¨å®‰è£… Istio æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ istioctl å‘½ä»¤ä¸­æŒ‡å®šé‡‡ç”¨è¯¥ Pilot é•œåƒï¼Œå¦‚ä¸‹é¢çš„å‘½ä»¤è¡Œæ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; istio-1.7.3/bin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ./istioctl install --set components.pilot.hub&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;zhaohuabing --set components.pilot.tag&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1.7.3-enable-ef-replace
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¤‡æ³¨ï¼šå¦‚æœä½ é‡‡ç”¨çš„ Istio ç‰ˆæœ¬æ–°äº 1.7.3ï¼Œå¹¶ä¸”å·²ç»åˆå…¥äº†è¯¥ PRï¼Œåˆ™å¯ä»¥ç›´æ¥é‡‡ç”¨ Istio ç‰ˆæœ¬ä¸­ç¼ºçœçš„ Pilot é•œåƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²-redis-cluster&#34;&gt;éƒ¨ç½² Redis Cluster&lt;/h2&gt;
&lt;p&gt;è¯·ä» &lt;a href=&#34;https://github.com/zhaohuabing/istio-redis-culster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/zhaohuabing/istio-redis-culster&lt;/a&gt; ä¸‹è½½ä¸‹é¢ç¤ºä¾‹ä¸­éœ€è¦ç”¨åˆ°çš„ç›¸å…³ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ git clone https://github.com/zhaohuabing/istio-redis-culster.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; istio-redis-culster
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª &amp;ldquo;redis&amp;rdquo; namespace æ¥éƒ¨ç½²æœ¬ä¾‹ä¸­çš„ Redis Clusterã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl create ns redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;namespace/redis created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨ç½² Redis æœåŠ¡å™¨çš„ Statefulset å’Œ Configmapã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f k8s/redis-cluster.yaml -n redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;configmap/redis-cluster created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;statefulset.apps/redis-cluster created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/redis-cluster created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éªŒè¯-redis-éƒ¨ç½²&#34;&gt;éªŒè¯ Redis éƒ¨ç½²&lt;/h3&gt;
&lt;p&gt;ç¡®è®¤ Redis èŠ‚ç‚¹å·²ç»å¯åŠ¨å¹¶æ­£å¸¸è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pod -n redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME              READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster-0   2/2     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          4m25s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster-1   2/2     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          3m56s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster-2   2/2     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          3m28s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster-3   2/2     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          2m58s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster-4   2/2     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          2m27s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster-5   2/2     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          117s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åˆ›å»º-redis-cluster&#34;&gt;åˆ›å»º Redis Cluster&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨ Statefulset éƒ¨ç½²äº† 6 ä¸ª Redis èŠ‚ç‚¹ï¼Œä½†ç›®å‰è¿™ 6 ä¸ªèŠ‚ç‚¹è¿˜æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå¹¶æœªå½¢æˆä¸€ä¸ªé›†ç¾¤ã€‚ä¸‹é¢æˆ‘ä»¬é‡‡ç”¨ Redis çš„ &lt;code&gt;cluster create&lt;/code&gt; å‘½ä»¤å°†è¿™äº›èŠ‚ç‚¹ç»„æˆä¸€ä¸ª Redis Clusterã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it redis-cluster-0 -n redis -- redis-cli --cluster create --cluster-replicas &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pods -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;redis-cluster -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{range.items[*]}{.status.podIP}:6379 &amp;#39;&lt;/span&gt; -n redis&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Defaulting container name to redis.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Use &lt;span class=&#34;s1&#34;&gt;&amp;#39;kubectl describe pod/redis-cluster-0 -n redis&amp;#39;&lt;/span&gt; to see all of the containers in this pod.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt;&amp;gt;&amp;gt; Performing &lt;span class=&#34;nb&#34;&gt;hash&lt;/span&gt; slots allocation on &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; nodes...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Master&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; -&amp;gt; Slots &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; - &lt;span class=&#34;m&#34;&gt;5460&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Master&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;1&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; -&amp;gt; Slots &lt;span class=&#34;m&#34;&gt;5461&lt;/span&gt; - &lt;span class=&#34;m&#34;&gt;10922&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Master&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; -&amp;gt; Slots &lt;span class=&#34;m&#34;&gt;10923&lt;/span&gt; - &lt;span class=&#34;m&#34;&gt;16383&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Adding replica 172.16.0.72:6379 to 172.16.0.138:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Adding replica 172.16.0.201:6379 to 172.16.1.52:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Adding replica 172.16.0.139:6379 to 172.16.1.53:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;M: 8fdc7aa28a6217b049a2265b87bff9723f202af0 172.16.0.138:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   slots:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0-5460&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5461&lt;/span&gt; slots&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; master
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;M: 4dd6c1fecbbe4527e7d0de61b655e8b74b411e4c 172.16.1.52:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   slots:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;5461-10922&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5462&lt;/span&gt; slots&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; master
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;M: 0b86a0fbe76cdd4b48434b616b759936ca99d71c 172.16.1.53:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   slots:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;10923-16383&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5461&lt;/span&gt; slots&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; master
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S: 94b139d247e9274b553c82fbbc6897bfd6d7f693 172.16.0.139:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   replicates 0b86a0fbe76cdd4b48434b616b759936ca99d71c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S: e293d25881c3cf6db86034cd9c26a1af29bc585a 172.16.0.72:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   replicates 8fdc7aa28a6217b049a2265b87bff9723f202af0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S: ab897de0eca1376558e006c5b0a49f5004252eb6 172.16.0.201:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   replicates 4dd6c1fecbbe4527e7d0de61b655e8b74b411e4c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Can I &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; the above configuration? &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;yes&amp;#39;&lt;/span&gt; to accept&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;: yes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt;&amp;gt;&amp;gt; Nodes configuration updated
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt;&amp;gt;&amp;gt; Assign a different config epoch to each node
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt;&amp;gt;&amp;gt; Sending CLUSTER MEET messages to join the cluster
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Waiting &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the cluster to join
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;using node 172.16.0.138:6379&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;M: 8fdc7aa28a6217b049a2265b87bff9723f202af0 172.16.0.138:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   slots:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0-5460&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5461&lt;/span&gt; slots&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; master
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; additional replica&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;s&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;M: 4dd6c1fecbbe4527e7d0de61b655e8b74b411e4c 172.16.1.52:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   slots:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;5461-10922&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5462&lt;/span&gt; slots&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; master
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; additional replica&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;s&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S: 94b139d247e9274b553c82fbbc6897bfd6d7f693 172.16.0.139:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   slots: &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; slots&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; slave
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   replicates 0b86a0fbe76cdd4b48434b616b759936ca99d71c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;M: 0b86a0fbe76cdd4b48434b616b759936ca99d71c 172.16.1.53:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   slots:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;10923-16383&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5461&lt;/span&gt; slots&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; master
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; additional replica&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;s&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S: ab897de0eca1376558e006c5b0a49f5004252eb6 172.16.0.201:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   slots: &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; slots&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; slave
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   replicates 4dd6c1fecbbe4527e7d0de61b655e8b74b411e4c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S: e293d25881c3cf6db86034cd9c26a1af29bc585a 172.16.0.72:6379
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   slots: &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; slots&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; slave
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   replicates 8fdc7aa28a6217b049a2265b87bff9723f202af0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OK&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; All nodes agree about slots configuration.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt;&amp;gt;&amp;gt; Check &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; open slots...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OK&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; All &lt;span class=&#34;m&#34;&gt;16384&lt;/span&gt; slots covered.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éªŒè¯-redis-cluster&#34;&gt;éªŒè¯ Redis Cluster&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ &lt;code&gt;cluster info&lt;/code&gt; å‘½ä»¤æŸ¥çœ‹ Redis Cluster çš„é…ç½®ä¿¡æ¯å’Œ Cluster ä¸­çš„æˆå‘˜èŠ‚ç‚¹ï¼Œä»¥éªŒè¯é›†ç¾¤æ˜¯å¦åˆ›å»ºæˆåŠŸã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it redis-cluster-0 -c redis -n redis -- redis-cli cluster info 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_state:ok
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_slots_assigned:16384
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_slots_ok:16384
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_slots_pfail:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_slots_fail:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_known_nodes:6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_size:3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_current_epoch:6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_my_epoch:1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_stats_messages_ping_sent:206
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_stats_messages_pong_sent:210
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_stats_messages_sent:416
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_stats_messages_ping_received:205
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_stats_messages_pong_received:206
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_stats_messages_meet_received:5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cluster_stats_messages_received:416
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éƒ¨ç½²æµ‹è¯•ç”¨å®¢æˆ·ç«¯&#34;&gt;éƒ¨ç½²æµ‹è¯•ç”¨å®¢æˆ·ç«¯&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œä»¥ç”¨äºå‘é€æµ‹è¯•å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f k8s/redis-client.yaml -n redis
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.apps/redis-client created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;é€šè¿‡-istio-ä¸‹å‘-redis-cluster-ç›¸å…³çš„-envoy-é…ç½®&#34;&gt;é€šè¿‡ Istio ä¸‹å‘ Redis Cluster ç›¸å…³çš„ Envoy é…ç½®&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸‹é¢çš„æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡ Istio å‘ Envoy Sidecar ä¸‹å‘ Redis Cluster ç›¸å…³é…ç½®ï¼Œä»¥åœ¨æ— éœ€æ”¹åŠ¨å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹å¯ç”¨ Redis Cluster çš„é«˜çº§åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ•°æ®åˆ†ç‰‡ã€è¯»å†™åˆ†ç¦»å’Œæµé‡é•œåƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ›å»º-envoy-redis-cluster&#34;&gt;åˆ›å»º Envoy Redis Cluster&lt;/h3&gt;
&lt;p&gt;Envoy æä¾›äº† &amp;ldquo;envoy.clusters.redis&amp;rdquo; ç±»å‹çš„ Envoy Cluster æ¥è¿æ¥åç«¯çš„ Redis Clusterï¼ŒEnvoy ä¼šé€šè¿‡è¯¥ Cluster è·å–åç«¯ Redis Cluster çš„æ‹“æ‰‘ç»“æ„ï¼ŒåŒ…æ‹¬æœ‰å¤šå°‘ä¸ªåˆ†ç‰‡ï¼ˆshardï¼‰ï¼Œæ¯ä¸ªåˆ†ç‰‡è´Ÿè´£å“ªäº› slotï¼Œä»¥åŠåˆ†ç‰‡ä¸­åŒ…å«å“ªäº›èŠ‚ç‚¹ï¼Œä»¥å°†æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚åˆ†å‘åˆ°æ­£ç¡®çš„ Redis èŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;é‡‡ç”¨ EnvoyFilter æ¥åˆ›å»ºæ‰€éœ€çš„ Envoy Redis Clusterï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f istio/envoyfilter-custom-redis-cluster.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoyfilter.networking.istio.io/custom-redis-cluster created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åˆ›å»º-envoy-redis-proxy&#34;&gt;åˆ›å»º Envoy Redis Proxy&lt;/h3&gt;
&lt;p&gt;Istio ç¼ºçœä¸‹å‘çš„ LDS ä¸­é…ç½®çš„æ˜¯ TCP proxy filterï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ›¿æ¢ä¸º Redis Proxy filterã€‚&lt;/p&gt;
&lt;p&gt;ç”±äº 1.7.3 ä¸­å°šä¸æ”¯æŒ EnvoyFilter çš„ &amp;ldquo;REPLACE&amp;rdquo; æ“ä½œï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ›´æ–° EnvoyFilter çš„ CRD å®šä¹‰ï¼Œç„¶åæ‰èƒ½åˆ›å»ºè¯¥ EnvoyFilterï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f istio/envoyfilter-crd.yaml 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;customresourcedefinition.apiextensions.k8s.io/envoyfilters.networking.istio.io configured
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡‡ç”¨ EnvoyFilter æ¥å°† TCP proxy filter æ›¿æ¢ä¸º Redis Proxy filterï¼Œä»¥ä½¿ Envoy å¯ä»¥ä»£ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ Redis æ“ä½œè¯·æ±‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sed -i .bak &lt;span class=&#34;s2&#34;&gt;&amp;#34;s/\${REDIS_VIP}/`kubectl get svc redis-cluster -n redis -o=jsonpath=&amp;#39;{.spec.clusterIP}&amp;#39;`/&amp;#34;&lt;/span&gt; istio/envoyfilter-redis-proxy.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f istio/envoyfilter-redis-proxy.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoyfilter.networking.istio.io/add-redis-proxy created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;éªŒè¯-redis-cluster-åŠŸèƒ½&#34;&gt;éªŒè¯ Redis Cluster åŠŸèƒ½&lt;/h2&gt;
&lt;p&gt;ç°åœ¨ä¸€åˆ‡å°±ç»ªï¼Œä¸‹é¢æˆ‘ä»¬æ¥éªŒè¯ Redis Cluster çš„å„é¡¹åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;redis-æ•°æ®åˆ†ç‰‡&#34;&gt;Redis æ•°æ®åˆ†ç‰‡&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬é€šè¿‡ Istio å°† EnvoyFilter ä¸­å®šä¹‰çš„é…ç½®ä¸‹å‘åˆ° Envoy åï¼ŒEnvoy å°±èƒ½å¤Ÿè‡ªåŠ¨å‘ç°åç«¯ Redis Cluster çš„æ‹“æ‰‘ç»“æ„ï¼Œå¹¶æ ¹æ®å®¢æˆ·ç«¯è¯·æ±‚ä¸­çš„ key å°†è¯·æ±‚è‡ªåŠ¨åˆ†å‘åˆ° Redis Cluster ä¸­æ­£ç¡®çš„èŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®å‰é¢åˆ›å»º Redis Cluster æ­¥éª¤ä¸­çš„å‘½ä»¤è¡Œè¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¯¥ Redis Cluster çš„æ‹“æ‰‘ç»“æ„ï¼šCluster ä¸­æœ‰ä¸‰ä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡ä¸­æœ‰ä¸€ä¸ª Master èŠ‚ç‚¹ï¼Œä¸€ä¸ª Slave(Replica) èŠ‚ç‚¹ã€‚å®¢æˆ·ç«¯é€šè¿‡å’Œå…¶éƒ¨ç½²åœ¨åŒä¸€ä¸ª Pod ä¸­çš„ Envoy Proxy è®¿é—® Redis Clusterï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/redis-cluster-with-istio/images/redis-cluster_hu574d5d43183bde6e78ff5d137e785540_148320_ebe9711fa14bcb54b89180256ae838cd.webp 400w,
               /blog/redis-cluster-with-istio/images/redis-cluster_hu574d5d43183bde6e78ff5d137e785540_148320_eb8a470b50dd6283f177ee3ac311ea69.webp 760w,
               /blog/redis-cluster-with-istio/images/redis-cluster_hu574d5d43183bde6e78ff5d137e785540_148320_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/redis-cluster-with-istio/images/redis-cluster_hu574d5d43183bde6e78ff5d137e785540_148320_ebe9711fa14bcb54b89180256ae838cd.webp&#34;
               width=&#34;760&#34;
               height=&#34;321&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Redis Cluster ä¸­å„ä¸ªåˆ†ç‰‡çš„ Master å’Œ Slave èŠ‚ç‚¹åœ°å€ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Shard[0] Master[0]  redis-cluster-0 172.16.0.138:6379   replica  redis-cluster-4 172.16.0.72:6379  -&amp;gt; Slots 0 - 5460 
Shard[1] Master[1]  redis-cluster-1 172.16.1.52:6379    replica  redis-cluster-5 172.16.0.201:6379 -&amp;gt; Slots 5461 - 10922
Shard[2] Master[2]  redis-cluster-2 172.16.1.53:6379    replica  redis-cluster-3 172.16.0.139:6379 -&amp;gt; Slots 10923 - 16383
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¤‡æ³¨ï¼šå¦‚æœä½ åœ¨è‡ªå·±çš„ K8s cluster ä¸­éƒ¨ç½²è¯¥ç¤ºä¾‹ï¼Œé‚£ä¹ˆ Redis Cluster ä¸­å„ä¸ªèŠ‚ç‚¹çš„ IP åœ°å€å’Œæ‹“æ‰‘ç»“æ„å¯èƒ½ç¨æœ‰ä¸åŒï¼Œä½†åŸºæœ¬ç»“æ„åº”è¯¥æ˜¯ç±»ä¼¼çš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°è¯•ä»å®¢æˆ·ç«¯å‘ Rdeis Cluster å‘é€ä¸€äº›ä¸åŒ key çš„ &lt;code&gt;set&lt;/code&gt; è¯·æ±‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;redis-client -n redis -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[0].metadata.name}&amp;#34;&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt; -c redis-client -n redis -- redis-cli -h redis-cluster
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; a a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; b b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; c c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; d d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; e e
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; f f
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; g g
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; h h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OK
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»å®¢æˆ·ç«¯æ¥çœ‹ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½æˆåŠŸäº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code&gt;scan&lt;/code&gt; å‘½ä»¤åœ¨æœåŠ¡å™¨ç«¯æŸ¥çœ‹å„ä¸ªèŠ‚ç‚¹ä¸­çš„æ•°æ®ï¼š&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹åˆ†ç‰‡ Shard[0] ä¸­çš„æ•°æ®ï¼Œmaster èŠ‚ç‚¹æ˜¯ redis-cluster-0 slave èŠ‚ç‚¹æ˜¯ redis-cluster-4ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; redis-cluster-0 -c redis -n redis -- redis-cli --scan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;f
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; redis-cluster-4 -c redis -n redis -- redis-cli --scan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;f
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹åˆ†ç‰‡ Shard[1] ä¸­çš„æ•°æ®ï¼Œmaster èŠ‚ç‚¹æ˜¯ redis-cluster-1 slave èŠ‚ç‚¹æ˜¯ redis-cluster-5ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; redis-cluster-1 -c redis -n redis -- redis-cli --scan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;g
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; redis-cluster-5 -c redis -n redis -- redis-cli --scan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;g
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹åˆ†ç‰‡ Shard[2] ä¸­çš„æ•°æ®ï¼Œmaster èŠ‚ç‚¹æ˜¯ redis-cluster-2 slave èŠ‚ç‚¹æ˜¯ redis-cluster-3ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; redis-cluster-2 -c redis -n redis -- redis-cli --scan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;e
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; redis-cluster-3 -c redis -n redis -- redis-cli --scan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;e
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»ä¸Šé¢çš„éªŒè¯ç»“æœä¸­å¯ä»¥çœ‹åˆ°ï¼Œå®¢æˆ·ç«¯è®¾ç½®çš„æ•°æ®è¢«åˆ†å‘åˆ°äº† Redis Cluster ä¸­çš„ä¸‰ä¸ªåˆ†ç‰‡ä¸­ã€‚è¯¥æ•°æ®åˆ†å‘è¿‡ç¨‹æ˜¯ç”± Envoy Redis Proxy è‡ªåŠ¨å®ç°çš„ï¼Œå®¢æˆ·ç«¯å¹¶ä¸æ„ŸçŸ¥åç«¯çš„ Redis Clusterï¼Œå¯¹å®¢æˆ·ç«¯è€Œè¨€ï¼Œå’Œè¯¥ Redis Cluster çš„äº¤äº’ä¸å’Œä¸€ä¸ªå•ä¸€ Redis èŠ‚ç‚¹çš„äº¤äº’æ˜¯ç›¸åŒçš„ã€‚&lt;/p&gt;
&lt;p&gt;é‡‡ç”¨è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ä¸šåŠ¡è§„æ¨¡é€æ¸æ‰©å¼ ï¼Œå•ä¸€ Redis èŠ‚ç‚¹å‹åŠ›è¿‡å¤§æ—¶ï¼Œå°†ç³»ç»Ÿä¸­çš„ Redis ä»å•èŠ‚ç‚¹æ— ç¼è¿ç§»åˆ°é›†ç¾¤æ¨¡å¼ã€‚åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œä¸åŒ key çš„æ•°æ®è¢«ç¼“å­˜åœ¨ä¸åŒçš„æ•°æ®åˆ†ç‰‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ åˆ†ç‰‡ä¸­ Replica èŠ‚ç‚¹çš„æ•°é‡æ¥å¯¹ä¸€ä¸ªåˆ†ç‰‡è¿›è¡Œæ‰©å®¹ï¼Œä¹Ÿå¯ä»¥å¢åŠ åˆ†ç‰‡ä¸ªæ•°æ¥å¯¹æ•´ä¸ªé›†ç¾¤è¿›è¡Œæ‰©å±•ï¼Œä»¥åº”å¯¹ç”±äºä¸šåŠ¡ä¸æ–­æ‰©å±•è€Œå¢åŠ çš„æ•°æ®å‹åŠ›ã€‚ç”±äº Envoy å¯ä»¥æ„ŸçŸ¥ Redis Cluster é›†ç¾¤æ‹“æ‰‘ï¼Œæ•°æ®çš„åˆ†å‘ç”± Envoy å®Œæˆï¼Œæ•´ä¸ªè¿ç§»å’Œæ‰©å®¹è¿‡ç¨‹æ— éœ€å®¢æˆ·ç«¯ï¼Œä¸ä¼šå½±å“åˆ°çº¿ä¸Šä¸šåŠ¡çš„æ­£å¸¸è¿è¡Œã€‚&lt;/p&gt;
&lt;h3 id=&#34;redis-è¯»å†™åˆ†ç¦»&#34;&gt;Redis è¯»å†™åˆ†ç¦»&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸€ä¸ª Redis åˆ†ç‰‡ä¸­ï¼Œé€šå¸¸æœ‰ä¸€ä¸ª Master èŠ‚ç‚¹ï¼Œä¸€åˆ°å¤šä¸ª Slaveï¼ˆReplicaï¼‰èŠ‚ç‚¹ï¼ŒMaster èŠ‚ç‚¹è´Ÿè´£å†™æ“ä½œï¼Œå¹¶å°†æ•°æ®å˜åŒ–åŒæ­¥åˆ° Slave èŠ‚ç‚¹ã€‚å½“æ¥è‡ªåº”ç”¨çš„è¯»æ“ä½œå‹åŠ›è¾ƒå¤§æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ†ç‰‡ä¸­å¢åŠ æ›´å¤šçš„ Replicaï¼Œä»¥å¯¹è¯»æ“ä½œè¿›è¡Œè´Ÿè½½åˆ†æ‹…ã€‚Envoy Redis Rroxy æ”¯æŒè®¾ç½®ä¸åŒçš„è¯»ç­–ç•¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MASTERï¼š&lt;/strong&gt;        åªä» Master èŠ‚ç‚¹è¯»å–æ•°æ®ï¼Œå½“å®¢æˆ·ç«¯è¦æ±‚æ•°æ®å¼ºä¸€è‡´æ€§æ—¶éœ€è¦é‡‡ç”¨è¯¥æ¨¡å¼ã€‚è¯¥æ¨¡å¼å¯¹ Master å‹åŠ›è¾ƒå¤§ï¼Œåœ¨åŒä¸€ä¸ªåˆ†ç‰‡å†…æ— æ³•é‡‡ç”¨å¤šä¸ªèŠ‚ç‚¹å¯¹è¯»æ“ä½œè¿›è¡Œè´Ÿè½½åˆ†æ‹…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PREFER_MASTERï¼š&lt;/strong&gt;   ä¼˜å…ˆä» Master èŠ‚ç‚¹è¯»å–æ•°æ®ï¼Œå½“ Master èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œä» Replica èŠ‚ç‚¹è¯»å–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;REPLICAï¼š&lt;/strong&gt;         åªä» Replica èŠ‚ç‚¹è¯»å–æ•°æ®ï¼Œç”±äº Master åˆ° Replica çš„æ•°æ®å¤åˆ¶è¿‡ç¨‹æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œé‡‡ç”¨è¯¥æ–¹å¼æœ‰å¯èƒ½è¯»å–åˆ°è¿‡æœŸçš„æ•°æ®ï¼Œå› æ­¤é€‚ç”¨äºå®¢æˆ·ç«¯å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚è¯¥æ¨¡å¼ä¸‹å¯ä»¥é‡‡ç”¨å¤šä¸ª Replica èŠ‚ç‚¹æ¥åˆ†æ‹…æ¥è‡ªå®¢æˆ·ç«¯çš„è¯»è´Ÿè½½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PREFER_REPLICAï¼š&lt;/strong&gt;  ä¼˜å…ˆä» Replica èŠ‚ç‚¹è¯»å–æ•°æ®ï¼Œå½“ Replica èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œä» Master èŠ‚ç‚¹è¯»å–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ANYï¼š&lt;/strong&gt;             ä»ä»»æ„èŠ‚ç‚¹è¯»å–æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨å‰é¢ä¸‹å‘çš„ EnvoyFilter ä¸­ï¼Œæˆ‘ä»¬å°† Envoy Redis Proxy çš„è¯»ç­–ç•¥è®¾ç½®ä¸ºäº† &amp;ldquo;REPLICA&amp;rdquo;ï¼Œå› æ­¤å®¢æˆ·ç«¯çš„è¯»æ“ä½œåº”è¯¥åªä¼šè¢«å‘é€åˆ° Replica èŠ‚ç‚¹ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥éªŒè¯è¯»å†™åˆ†ç¦»çš„ç­–ç•¥ï¼š&lt;/p&gt;
&lt;p&gt;é€šè¿‡å®¢æˆ·ç«¯å‘èµ·ä¸€ç³»åˆ— key ä¸º &amp;ldquo;b&amp;rdquo; çš„ &lt;code&gt;get&lt;/code&gt; å’Œ &lt;code&gt;set&lt;/code&gt; æ“ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;redis-client -n redis -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[0].metadata.name}&amp;#34;&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt; -c redis-client -n redis -- redis-cli -h redis-cluster
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; get b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;b&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; get b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;b&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; get b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;b&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; b bb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; get b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;bb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨å‰é¢çš„ Redis Cluster æ‹“æ‰‘ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¾—çŸ¥ key &amp;ldquo;b&amp;rdquo; å±äº Shard[0] è¿™ä¸ªåˆ†ç‰‡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤ &lt;code&gt;redis-cli monitor&lt;/code&gt; æŸ¥çœ‹è¯¥åˆ†ç‰‡ä¸­ Master å’Œ Replica èŠ‚ç‚¹ä¸­æ”¶åˆ°çš„å‘½ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;Master èŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; redis-cluster-0 -c redis -n redis -- redis-cli monitor
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Slave èŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; redis-cluster-4 -c redis -n redis -- redis-cli monitor
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»ä¸‹å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰ &lt;code&gt;get&lt;/code&gt; è¯·æ±‚éƒ½è¢« Envoy å‘é€åˆ°äº† Replica èŠ‚ç‚¹ä¸Šã€‚
















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/redis-cluster-with-istio/images/redis-cluster-read-policy_hu013a6684a049a4c9a45bb95ef422917b_336243_e1bc14f652a7dd6618f4c6f9b22fc631.webp 400w,
               /blog/redis-cluster-with-istio/images/redis-cluster-read-policy_hu013a6684a049a4c9a45bb95ef422917b_336243_8e96f2eac8175a255ac76ed1ef5b9c2a.webp 760w,
               /blog/redis-cluster-with-istio/images/redis-cluster-read-policy_hu013a6684a049a4c9a45bb95ef422917b_336243_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/redis-cluster-with-istio/images/redis-cluster-read-policy_hu013a6684a049a4c9a45bb95ef422917b_336243_e1bc14f652a7dd6618f4c6f9b22fc631.webp&#34;
               width=&#34;760&#34;
               height=&#34;455&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;redis-æµé‡é•œåƒ&#34;&gt;Redis æµé‡é•œåƒ&lt;/h3&gt;
&lt;p&gt;Envoy Redis Proxy æ”¯æŒæµé‡é•œåƒï¼Œå³å°†å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚åŒæ—¶å‘é€åˆ°ä¸€ä¸ªé•œåƒ Redis æœåŠ¡å™¨/é›†ç¾¤ä¸Šã€‚æµé‡é•œåƒæ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æµé‡é•œåƒå°†ç”Ÿäº§ç¯å¢ƒä¸­çš„çº¿ä¸Šæ•°æ®å¯¼å…¥åˆ°æµ‹è¯•ç¯å¢ƒä¸­ï¼Œä»¥ä½¿ç”¨çº¿ä¸Šæ•°æ®å¯¹åº”ç”¨è¿›è¡Œå°½å¯èƒ½çœŸå®çš„æ¨¡æ‹Ÿæµ‹è¯•ï¼ŒåŒæ—¶åˆä¸ä¼šå½±å“åˆ°çº¿ä¸Šç”¨æˆ·çš„æ­£å¸¸ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå•èŠ‚ç‚¹çš„ Redis èŠ‚ç‚¹ï¼Œç”¨åšé•œåƒæœåŠ¡å™¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f k8s/redis-mirror.yaml -n redis 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.apps/redis-mirror created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/redis-mirror created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡‡ç”¨ EnvoFilter æ¥å¯ç”¨é•œåƒç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sed -i .bak &lt;span class=&#34;s2&#34;&gt;&amp;#34;s/\${REDIS_VIP}/`kubectl get svc redis-cluster -n redis -o=jsonpath=&amp;#39;{.spec.clusterIP}&amp;#39;`/&amp;#34;&lt;/span&gt; istio/envoyfilter-redis-proxy-with-mirror.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f istio/envoyfilter-redis-proxy-with-mirror.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoyfilter.networking.istio.io/add-redis-proxy configured
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡å®¢æˆ·ç«¯å‘èµ·ä¸€ç³»åˆ— key ä¸º &amp;ldquo;b&amp;rdquo; çš„ &lt;code&gt;get&lt;/code&gt; å’Œ &lt;code&gt;set&lt;/code&gt; æ“ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;redis-client -n redis -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[0].metadata.name}&amp;#34;&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt; -c redis-client -n redis -- redis-cli -h redis-cluster
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; get b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;b&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; get b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;b&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; get b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;b&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; b bb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; get b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;bb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; b bbb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; get b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;bbb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;redis-cluster:6379&amp;gt; get b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;bbb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥é€šè¿‡å‘½ä»¤ &lt;code&gt;redis-cli monitor&lt;/code&gt; åˆ†åˆ«æŸ¥çœ‹ Masterã€Replica å’Œé•œåƒèŠ‚ç‚¹ä¸­æ”¶åˆ°çš„å‘½ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;Master èŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; redis-cluster-0 -c redis -n redis -- redis-cli monitor
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Slave èŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; redis-cluster-4 -c redis -n redis -- redis-cli monitor
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é•œåƒèŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;redis-mirror -n redis -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[0].metadata.name}&amp;#34;&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt; -c redis-mirror -n redis -- redis-cli monitor
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»ä¸‹å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰ &lt;code&gt;set&lt;/code&gt; è¯·æ±‚éƒ½è¢« Envoy å‘é€åˆ°äº†ä¸€ä»½é•œåƒèŠ‚ç‚¹ä¸Šã€‚
















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/redis-cluster-with-istio/images/redis-cluster-mirror-policy_huf7ae1a63d4a796cfdefa85a80ff75cfa_531950_e09e9c64fc3ef8d2055aec3aa361ddd4.webp 400w,
               /blog/redis-cluster-with-istio/images/redis-cluster-mirror-policy_huf7ae1a63d4a796cfdefa85a80ff75cfa_531950_c0ade408dc6a7a753bbf75542e9c8aa3.webp 760w,
               /blog/redis-cluster-with-istio/images/redis-cluster-mirror-policy_huf7ae1a63d4a796cfdefa85a80ff75cfa_531950_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/redis-cluster-with-istio/images/redis-cluster-mirror-policy_huf7ae1a63d4a796cfdefa85a80ff75cfa_531950_e09e9c64fc3ef8d2055aec3aa361ddd4.webp&#34;
               width=&#34;760&#34;
               height=&#34;361&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å®ç°åŸç†&#34;&gt;å®ç°åŸç†&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬åœ¨ Istio ä¸­åˆ›å»ºäº†ä¸¤ä¸ª EnvoyFilter é…ç½®å¯¹è±¡ã€‚è¿™ä¸¤ä¸ª EnvoyFilter ä¿®æ”¹äº† Envoy ä»£ç†çš„é…ç½®ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†å†…å®¹ï¼šRedis Proxy Network Filter é…ç½®å’Œ Redis Cluster é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢çš„ EnvoyFilter æ›¿æ¢äº† Pilot ä¸º Redis Service åˆ›å»ºçš„ Listener ä¸­çš„ TCP Proxy Network Filterï¼Œå°†å…¶æ›¿æ¢ä¸ºä¸€ä¸ª &amp;ldquo;type.googleapis.com/envoy.config.filter.network.redis_proxy.v2.RedisProxy&amp;rdquo; ç±»å‹çš„ Network Filterã€‚è¯¥ Redis Proxy çš„ç¼ºçœè·¯ç”±æŒ‡å‘ &amp;ldquo;custom-redis-cluster&amp;rdquo;ï¼Œå¹¶ä¸”é…ç½®äº†è¯»å†™åˆ†ç¦»ç­–ç•¥å’Œæµé‡é•œåƒç­–ç•¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EnvoyFilter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;add-redis-proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configPatches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;applyTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NETWORK_FILTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;${REDIS_VIP}_6379            &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Replace REDIS_VIP with the cluster IP of &amp;#34;redis-cluster service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filterChain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.network.tcp_proxy&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;REPLACE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.redis_proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.config.filter.network.redis_proxy.v2.RedisProxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;redis_stats&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix_routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;catch_all_route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;request_mirror_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Send requests to the mirror cluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;outbound|6379||redis-mirror.redis.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exclude_read_commands&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;True     # Mirror write commands only&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;custom-redis-cluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;settings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;op_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;5s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;enable_redirection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;enable_command_stats&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;read_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;REPLICA              &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Send read requests to replica&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢çš„ EnvoyFilter åœ¨ Pilot ä¸‹å‘çš„ CDS ä¸­åˆ›å»ºäº†ä¸€ä¸ª &amp;ldquo;envoy.clusters.redis&amp;rdquo; ç±»å‹çš„ Clusterï¼š &amp;ldquo;custom-redis-cluster&amp;rdquo;ï¼Œè¯¥ Cluster ä¼šé‡‡ç”¨ &lt;a href=&#34;https://redis.io/commands/cluster-slots&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CLUSTER SLOTS å‘½ä»¤&lt;/a&gt; å‘ Redis é›†ç¾¤ä¸­çš„ä¸€ä¸ªéšæœºèŠ‚ç‚¹æŸ¥è¯¢é›†ç¾¤çš„æ‹“æ‰‘ç»“æ„ï¼Œå¹¶åœ¨æœ¬åœ°ä¿å­˜è¯¥æ‹“æ‰‘ç»“æ„ï¼Œä»¥å°†æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚åˆ†å‘åˆ°é›†ç¾¤ä¸­æ­£ç¡®çš„ Redis èŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EnvoyFilter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;custom-redis-cluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configPatches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;applyTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CLUSTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;INSERT_FIRST&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;custom-redis-cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;5s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CLUSTER_PROVIDED&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;load_assignment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;custom-redis-cluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;endpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;lb_endpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;redis-cluster-0.redis-cluster.redis.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;6379&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;redis-cluster-1.redis-cluster.redis.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;6379&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;redis-cluster-2.redis-cluster.redis.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;6379&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;redis-cluster-3.redis-cluster.redis.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;6379&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;redis-cluster-4.redis-cluster.redis.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;6379&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;redis-cluster-5.redis-cluster.redis.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;6379&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.clusters.redis&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/google.protobuf.Struct&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster_refresh_rate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;5s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster_refresh_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;3s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;redirect_refresh_interval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;5s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;redirect_refresh_threshold&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å°ç»“&#34;&gt;å°ç»“&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Envoy ä¸ºå¾®æœåŠ¡åº”ç”¨æä¾›å®¢æˆ·ç«¯æ— æ„ŸçŸ¥çš„ Redis æ•°æ®åˆ†ç‰‡ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡ Istio æ¥ç»Ÿä¸€ç®¡ç†ç³»ç»Ÿä¸­å¤šä¸ª Envoy ä»£ç†çš„ Redis Cluster é…ç½®ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé‡‡ç”¨ Istio å’Œ Envoy å¯ä»¥å¤§å¤§ç®€åŒ–å®¢æˆ·ç«¯ä½¿ç”¨ Redis Cluster çš„ç¼–ç å’Œé…ç½®å·¥ä½œï¼Œå¹¶ä¸”å¯ä»¥åœ¨çº¿ä¿®æ”¹ Redis Cluster çš„è¿ç»´ç­–ç•¥ï¼Œå®ç°è¯»å†™åˆ†ç¦»ã€æµé‡é•œåƒç­‰é«˜çº§æµé‡ç®¡ç†ã€‚å½“ç„¶ï¼Œå¼•å…¥ Istio å’Œ Envoy å¹¶æœªå‡å°‘æ•´ä¸ªç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œè€Œæ˜¯å°† Redis Cluster ç»´æŠ¤çš„å·¥ä½œä»å„ä¸ªåˆ†æ•£çš„åº”ç”¨ä»£ç ä¸­é›†ä¸­åˆ°äº†æœåŠ¡ç½‘æ ¼åŸºç¡€è®¾æ–½å±‚ã€‚å¯¹åº”å¹¿å¤§åº”ç”¨å¼€æ”¾è€…æ¥è¯´ï¼Œå…¶ä¸šåŠ¡ä»·å€¼ä¸»è¦æ¥è‡ªäºåº”ç”¨ä»£ç ï¼Œå°†å¤§é‡ç²¾åŠ›æŠ•å…¥æ­¤ç±»åŸºç¡€è®¾æ–½æ˜¯ä¸å¤ªåˆ’ç®—çš„ã€‚å»ºè®®ç›´æ¥é‡‡ç”¨è…¾è®¯äº‘ä¸Šçš„äº‘åŸç”Ÿ Service Mesh æœåŠ¡ TCMï¼ˆTencent Cloud Meshï¼‰ï¼Œä¸ºå¾®æœåŠ¡åº”ç”¨å¿«é€Ÿå¼•å…¥ Service Mesh çš„æµé‡ç®¡ç†å’ŒæœåŠ¡æ²»ç†èƒ½åŠ›ï¼Œè€Œæ— éœ€å†å…³æ³¨ Service Mesh åŸºç¡€è®¾æ–½è‡ªèº«çš„å®‰è£…ã€ç»´æŠ¤ã€å‡çº§ç­‰äº‹é¡¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒæ–‡æ¡£&#34;&gt;å‚è€ƒæ–‡æ¡£&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://rancher.com/blog/2019/deploying-redis-cluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Deploying Redis Cluster on Top of Kubernetes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/@fr33m0nk/migrating-to-redis-cluster-using-envoy-93a87ae79dc3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Migrating to Redis cluster using envoy proxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/istio/pull/27426/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Implement REPLACE operation for EnvoyFilter patch&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>äº‘åŸç”Ÿç¤¾åŒº Envoy å®˜ç½‘ç¿»è¯‘å°ç»„æˆå‘˜æ‹›å‹Ÿä¸­</title>
      <link>https://cloudnative.to/blog/envoy-trans-recruit/</link>
      <pubDate>Mon, 12 Oct 2020 13:05:42 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-trans-recruit/</guid>
      <description>&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;Istio ä¸€ç›´æ˜¯æœåŠ¡ç½‘æ ¼äº§å“ä¸­çš„ä½¼ä½¼è€…ï¼Œå…¶æ•°æ®é¢çš„ç»„ä»¶â€”â€” Envoy ä¹Ÿå—åˆ°å¾ˆå¤šäº’è”ç½‘å‚å®¶åŠ IT è¡Œä¸šäººå‘˜çš„è¿½æ§å’Œé’çã€‚äº‘åŸç”Ÿç¤¾åŒºç§‰æ‰¿æ™®åŠå’Œæ¨å¹¿äº‘åŸç”Ÿç›¸å…³æŠ€æœ¯çš„å®—æ—¨ï¼Œå·²ç»åœ¨æ—©äº›æ—¶å€™æˆç«‹äº†&lt;a href=&#34;https://cloudnative.to/blog/sig-envoy-announcement/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy SIG&lt;/a&gt;ã€‚ä¸ºäº†æ–¹ä¾¿å›½å†… IT è¡Œä¸šäººå‘˜å­¦ä¹ ä¸ç ”ç©¶ Envoyï¼Œäº‘åŸç”Ÿç¤¾åŒºå†³å®šå°†&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy å®˜ç½‘&lt;/a&gt;æœ€æ–°ç‰ˆæœ¬è¿›è¡Œç¿»è¯‘ï¼ˆ&lt;a href=&#34;https://www.servicemesher.com/envoy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy æœ‰ 1.7 ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;ï¼Œä½†æ˜¯ç‰ˆæœ¬è¿‡è€ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¿»è¯‘å¿—æ„¿è€…çš„æ¡ä»¶å’Œæ”¶è·&#34;&gt;ç¿»è¯‘å¿—æ„¿è€…çš„æ¡ä»¶å’Œæ”¶è·&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ æ»¡è¶³ä»¥ä¸‹å‡ ç‚¹è¦æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çƒ­çˆ±äº‘åŸç”ŸæŠ€æœ¯ï¼Œå¹¿äº¤å¤©ä¸‹äº‘åŸç”ŸåŒå¥½&lt;/li&gt;
&lt;li&gt;å…³æ³¨æœåŠ¡ç½‘æ ¼&lt;/li&gt;
&lt;li&gt;è¿½è¸ª Envoy æœ€æ–°è¿›å±•&lt;/li&gt;
&lt;li&gt;å–œæ¬¢ç¿»è¯‘å·¥ä½œï¼Œå¹¶èƒ½å¤ŸæŒç»­è´¡çŒ®&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é‚£å°±è€ƒè™‘åŠ å…¥äº‘åŸç”Ÿç¤¾åŒº Envoy å®˜ç½‘ç¿»è¯‘å›¢é˜Ÿå§ã€‚ä½ èƒ½å¤Ÿæ”¶è·ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº‘åŸç”Ÿç¤¾åŒºä¸­ä¼—å¤šå¿—åŒé“åˆçš„å°ä¼™ä¼´&lt;/li&gt;
&lt;li&gt;å¯¹ Envoy æ›´æ·±åˆ»ï¼Œæ›´å…¨é¢çš„è®¤çŸ¥&lt;/li&gt;
&lt;li&gt;æ™®åŠäº‘åŸç”ŸæŠ€æœ¯æ‰€å¸¦æ¥çš„æˆå°±æ„Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¦‚ä½•åŠ å…¥ç¿»è¯‘å¿—æ„¿è€…å›¢é˜Ÿ&#34;&gt;å¦‚ä½•åŠ å…¥ç¿»è¯‘å¿—æ„¿è€…å›¢é˜Ÿ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åŠ å…¥äº‘åŸç”Ÿç¤¾åŒºï¼Œ&lt;a href=&#34;https://cloudnative.to/contact&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ å…¥æˆ‘ä»¬&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åŠ å…¥ Envoy SIGï¼ˆæ·»åŠ å¾®ä¿¡ &lt;a href=&#34;https://jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;jimmysongio&lt;/a&gt; æˆ–è€… majinghe11ï¼Œå¤‡æ³¨å§“å - å…¬å¸ï¼Œå¹¶è¯´æ˜åŠ å…¥ Envoy SIGï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¿»è¯‘çš„ç›¸å…³äº‹é¡¹éƒ½ä¼šåœ¨ Envoy SIG ç¾¤é‡Œå…¬å¸ƒï¼ŒåŒ…æ‹¬æˆå‘˜æ‹›å‹Ÿï¼Œå¯åŠ¨ç¿»è¯‘ï¼Œè¿›åº¦è·Ÿè¸ªç­‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-ç¿»è¯‘ä»“åº“&#34;&gt;Envoy ç¿»è¯‘ä»“åº“&lt;/h2&gt;
&lt;p&gt;Envoy å®˜æ–¹æ–‡æ¡£ fork è‡ªä¸Šæ¸¸ï¼Œä½äº &lt;a href=&#34;https://github.com/cloudnativeto/envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cloudnativeto/envoy&lt;/a&gt; ä»“åº“ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç­‰ä½ å“¦ï¼ï¼ï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>äº‘åŸç”Ÿç¤¾åŒº Envoy SIG æˆç«‹å•¦ï¼</title>
      <link>https://cloudnative.to/blog/sig-envoy-announcement/</link>
      <pubDate>Mon, 14 Sep 2020 18:05:42 +0800</pubDate>
      <guid>https://cloudnative.to/blog/sig-envoy-announcement/</guid>
      <description>&lt;p&gt;éšç€äº‘åŸç”Ÿå‘å±•çš„æ·±å…¥ï¼ŒæœåŠ¡ç½‘æ ¼çš„å‘å±•ä¹Ÿå¦‚ç«å¦‚è¼ï¼Œå…¶ä¸­çš„ç¿˜æ¥šä¹‹æ‰â€”â€”Istio ä¹Ÿæ˜¯å¤‡å—å¤§å®¶çš„å…³æ³¨ä¸å–œçˆ±ï¼Œéƒ¨åˆ†ä¼ä¸šå·²ç»å°† Istio åœ¨ç”Ÿäº§ä¸Šè¿›è¡Œäº†ä½¿ç”¨ã€‚è™½ç„¶ Istio ç»å†äº†æ¶æ„å˜åŒ–ã€æèµ é£æ³¢ï¼Œä½†æ˜¯ä¸å½±å“å¹¿å¤§ IT ä»ä¸šè€…å¯¹å…¶çš„çƒ­çˆ±ã€‚&lt;/p&gt;
&lt;p&gt;äº‘åŸç”Ÿç¤¾åŒºä¸ºäº†èƒ½å¤Ÿç»™å›½å†…æœåŠ¡ç½‘æ ¼çƒ­çˆ±è€…æä¾›ä¸€ä¸ªäº¤æµå­¦ä¹ çš„æœºä¼šï¼Œå¹¶ç§‰æ‰¿äº‘åŸç”Ÿç¤¾åŒºçš„å®—æ—¨â€”â€”æ™®åŠå’Œæ¨å¹¿äº‘åŸç”Ÿç›¸å…³æŠ€æœ¯ï¼Œäº‘åŸç”Ÿå†³å®šæˆç«‹ Envoy SIGï¼ˆç›®å‰å·²ç»æœ‰ Operator SIGã€OAM SIGï¼‰ï¼Œå¹¶åœ¨æ—¶æœºæˆç†Ÿæ—¶ï¼ˆä¼šåœ¨äº‘åŸç”Ÿç¤¾åŒº Envoy SIG å¾®ä¿¡ç¾¤åŠç¤¾åŒºå…¬ä¼—å·è¿›è¡Œå…¬å¸ƒï¼‰æ‹›å‹Ÿå¿—æ„¿è€…ç¿»è¯‘ Envoy çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆ&lt;a href=&#34;https://www.servicemesher.com/envoy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy æœ‰ 1.7 ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;ï¼Œä½†æ˜¯ç‰ˆæœ¬è¿‡è€ï¼‰ï¼Œå¹¶ä¸¾åŠæ›´å¤šçš„ Envoy æŠ€æœ¯äº¤æµæ´»åŠ¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆåŠ å…¥-envoy-sig&#34;&gt;ä¸ºä»€ä¹ˆåŠ å…¥ Envoy SIG&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çƒ­çˆ±äº‘åŸç”ŸæŠ€æœ¯ï¼Œå¹¿äº¤å¤©ä¸‹äº‘åŸç”ŸåŒå¥½&lt;/li&gt;
&lt;li&gt;å…³æ³¨æœåŠ¡ç½‘æ ¼&lt;/li&gt;
&lt;li&gt;è¿½è¸ª Envoy æœ€æ–°è¿›å±•&lt;/li&gt;
&lt;li&gt;è®¨è®ºè´Ÿè½½å‡è¡¡å’Œç½‘ç»œä»£ç†æŠ€æœ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é‚£å°±åŠ å…¥ Envoy SIG å§ã€‚æˆ‘ä»¬ä¸€èµ·æäº‹æƒ…ã€‚&lt;/p&gt;
&lt;p&gt;Envoy SIG ä»“åº“ï¼š&lt;a href=&#34;https://github.com/cloudnativeto/sig-envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cloudnativeto/sig-envoy&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;å¦‚ä½•åŠ å…¥-envoy-sig&#34;&gt;å¦‚ä½•åŠ å…¥ Envoy SIG&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åŠ å…¥äº‘åŸç”Ÿç¤¾åŒºç»„ç»‡ï¼Œè¯¦æƒ…è¯·çœ‹äº‘åŸç”Ÿç¤¾åŒºçš„è¿™ä¸ª&lt;a href=&#34;https://github.com/cloudnativeto/community/issues/44&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitHub Issue&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åŠ å…¥ Envoy SIG å¾®ä¿¡ç¾¤ï¼ˆæ·»åŠ å¾®ä¿¡ &lt;a href=&#34;https://jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;jimmysongio&lt;/a&gt; æˆ–è€… majinghe11ï¼Œå¤‡æ³¨å§“å - å…¬å¸ï¼Œå¹¶è¯´æ˜åŠ å…¥ Envoy SIGï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬ç­‰ä½ å“¦ï¼ï¼ï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åº”ç”¨äº¤ä»˜è€å…µçœ¼ä¸­çš„ Envoy, äº‘åŸç”Ÿæ—¶ä»£ä¸‹çš„æ€è€ƒ</title>
      <link>https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/</link>
      <pubDate>Tue, 30 Jun 2020 00:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä½œè€…ï¼šæ—é™ï¼ŒF5 è½¯ä»¶æ–¹å‘è§£å†³æ–¹æ¡ˆæ¶æ„å¸ˆï¼Œå†ä»» F5 Global Service ENEï¼ŒAPAC Professional Service é¡¾é—®ï¼ŒæŠ€æœ¯ä¸“å®¶ã€‚æ‹¥æœ‰è¶…è¿‡ 10 å¤šå¹´çš„åº”ç”¨äº¤ä»˜é¢†åŸŸå·¥ä½œç»éªŒï¼Œç§‰æ‰¿æŒç»­å­¦ä¹ å’Œåé¦ˆçš„ç†å¿µï¼Œè‡´åŠ›äºç°ä»£åº”ç”¨ä½“ç³»ä¸‹çš„åº”ç”¨æœåŠ¡ç ”ç©¶ã€‚CNCF Kubernetes CKA 664 å·è®¤è¯è·å¾—è€…ï¼Œä¸­å›½é¦–ä½ F5 Security Solution Expert è®¤è¯è·å¾—è€…ã€‚&lt;/p&gt;
&lt;p&gt;æ„Ÿè°¢é‚±ä¸–è¾¾å¯¹æœ¬æ–‡çš„å®¡æ ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;Envoyï¼Œä½¿è€…ï¼Œä½¿èŠ‚ï¼Œä»£è¡¨ï¼å°±åƒå…¶å•è¯å«ä¹‰æœ¬èº«ä¸€æ ·ï¼Œå¸¦ç€ä¸€ç§æƒå¨æ„Ÿï¼Œä¸€ç§å…¨ä»£ç†çš„ç¥åœ£æ„Ÿã€‚ç»“åˆå…¶æœ¬èº«ç”¨é€”ä¸è§’è‰²ï¼ŒçœŸæ˜¯â€œäººå¦‚å…¶åâ€ï¼Œä¸ç¦ä¸º Lyft ç‚¹èµï¼Œä¸çŸ¥æ˜¯å¾—åˆ°äº†å“ªä½å¤§å¸ˆçš„æŒ‡ç‚¹æ¥èµ·è¿™ä¸ªåå­—ã€‚åœ¨å½“å‰ç«çƒ­çš„å¾®æœåŠ¡æ—¶ä»£ä¸‹ï¼ŒEnvoy æ˜¯ä¸ªç»å¯¹çš„æ˜æ˜Ÿï¼Œç”¨ä¼—äººçš†çŸ¥æ¥å½¢å®¹å¯ä»¥è¯´ä¸€ç‚¹ä¹Ÿä¸ä¸ºè¿‡ã€‚æ›¾æœ‰äººé—®æˆ‘å¦‚ä½•çœ‹ Envoy ä»¥åŠåœ¨äº‘åŸç”Ÿæ—¶ä»£ä¸‹æ˜¯å¦ Envoy å°†å–ä»£ F5 å–ä»£ NGINXï¼Œä½œä¸ºä¸€ä¸ªç»å†äº†ä¸¤æ¬¡åº”ç”¨äº¤ä»˜æŠ€æœ¯é¢†åŸŸæ›´è¿­æµªæ½®çš„è€å…µï¼Œåœ¨æœ¬æ–‡ä¸­æˆ‘å°†æ¥æµ…è°ˆä¸€ä¸‹ Envoyï¼Œä»¥åŠè¯•å›¾ä»ä¸ªäººè§’åº¦æ¥ç†è§£ä¸å›ç­”ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚ä¸ºä»€ä¹ˆè¯´æµ…è°ˆä¸€ä¸‹ï¼Œè¿™çœŸçš„ä¸æ˜¯è°¦è™šï¼Œè€Œæ˜¯å®¢è§‚ä¸ŠçœŸçš„æ²¡æœ‰é‚£ä¹ˆæ·±å…¥çš„å¤§è§„æ¨¡é•¿æ—¶é—´ä½¿ç”¨å’Œç ”ç©¶ Envoy çš„æ‰€æœ‰æŠ€æœ¯ç»†èŠ‚ï¼Œå› æ­¤æˆ‘å°†ç»“åˆæˆ‘çš„ä»ä¸šç»å†ä¸ç»éªŒæ¥å¯¹ Envoy åšä¸€ä¸ªæµ…è°ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ˜Ÿå…‰ç† ç† çš„-envoy&#34;&gt;æ˜Ÿå…‰ç† ç† çš„ Envoy&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹ Envoy å®˜æ–¹æ˜¯å¦‚ä½•ä»‹ç» Envoy çš„ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ENVOY IS AN OPEN SOURCE EDGE AND SERVICE PROXY, DESIGNED FOR CLOUD-NATIVE APPLICATIONS
&lt;em&gt;Envoy æ˜¯ä¸€ä¸ªå¼€æºçš„è¾¹ç¼˜ä»¥åŠæœåŠ¡ä»£ç†ï¼Œä¸ºäº‘åŸç”Ÿåº”ç”¨è€Œç”Ÿã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»ç½‘ç«™é¦–é¡µçš„è¿™ä¸€æ®µæè¿°å¯ä»¥æ¸…æ™°çš„çœ‹å‡ºå®˜æ–¹å¯¹ Envoy çš„å®šä¹‰ï¼Œç®€å•æ¥è¯´å°±æ˜¯äº‘åŸç”Ÿæ—¶ä»£ä¸‹ä¸œè¥¿å—åŒ—æµé‡çš„ä»£ç†ã€‚Lfyt å…¬å¸æ˜¯å¾®æœåŠ¡åº”ç”¨æ¶æ„çš„å…ˆå¯¼è€…ï¼Œåœ¨å¤§é‡çš„å¾®æœåŠ¡ç±»å¸ƒé“æ–‡ç« ä¸­æˆ‘ä»¬éƒ½å¯ä»¥çœ‹åˆ° Lfyt çš„èº«å½±ï¼Œåœ¨ä»å•ä½“åº”ç”¨å¤§è§„æ¨¡è½¬å‘å¾®æœåŠ¡æ¶æ„åï¼Œä¸€ä¸ªä¸¥é‡çš„é—®é¢˜æ‘†åœ¨äº†å¼€å‘ä¸æ¶æ„äººå‘˜é¢å‰ï¼Œä¸€æ–¹é¢ Lyft çš„æœåŠ¡é‡‡ç”¨äº†å¤šç§è¯­è¨€å¼€å‘ï¼Œè€Œé‡‡ç”¨ç±»åº“æ¥è§£å†³åˆ†å¸ƒå¼æ¶æ„ä¸‹çš„å„ç§é—®é¢˜éœ€è¦è¿›è¡Œå¤§é‡çš„è¯­è¨€é€‚é…ä»¥åŠå¯¹ä»£ç çš„ä¾µå…¥ï¼Œå¦ä¸€æ–¹é¢ Lyft çš„ä¸šåŠ¡éƒ½æ˜¯éƒ¨ç½²åœ¨ AWS ä¸Šçš„ï¼Œå¤§é‡ä¾èµ– AWS çš„ ELB ä»¥åŠ EC2ï¼Œä½†æ˜¯ ELB ä»¥åŠ AWS åœ¨å½“æ—¶æ‰€æä¾›çš„æœåŠ¡é—´æµé‡ç®¡æ§ã€æ´å¯Ÿä¸é—®é¢˜æ’é™¤éƒ½ä¸èƒ½æ»¡è¶³ Lyft çš„éœ€æ±‚ï¼Œæ­£æ˜¯åŸºäºè¿™æ ·çš„èƒŒæ™¯ï¼ŒLfyt äº 2015 å¹´ 5 æœˆå¼€å§‹äº† Envoy çš„å¼€å‘ï¼Œæœ€æ—©æ˜¯ä½œä¸ºä¸€ä¸ªè¾¹ç¼˜ä»£ç†è¿›è¡Œéƒ¨ç½²å¹¶å¼€å§‹æ›¿ä»£ ELBï¼Œéšåå¼€å§‹ä½œä¸º sidecar æ–¹å¼è¿›è¡Œå¤§è§„æ¨¡éƒ¨ç½²ã€‚2016 å¹´ 9 æœˆ 14 æ—¥ï¼ŒLyft åœ¨å…¶åšå®¢ä¸Šæ­£å¼å¯¹å¤–å®£å¸ƒäº†è¿™ä¸€é¡¹ç›®ï¼š &lt;a href=&#34;https://eng.lyft.com/announcing-envoy-c-l7-proxy-and-communication-bus-92520b6c8191&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy C++ L7 ä»£ç†ä¸é€šä¿¡æ€»çº¿&lt;/a&gt;ã€‚ä¸€æ—¶é—´ Envoy å¾—åˆ°äº†å¤§é‡çš„å…³æ³¨ï¼ŒGoogle ç­‰å…¬å¸å¼€å§‹è´¡çŒ®åˆ°è¿™ä¸ªé¡¹ç›®é‡Œï¼Œå¹¶åœ¨ä¸€å¹´åçš„ 2017 å¹´ 9 æœˆå°†é¡¹ç›®æçŒ®ç»™ CNCFã€‚æœ‰äº† Lyft è¿™æ ·ä¸€ä¸ªå¥½å¦ˆï¼Œåˆè¿‡ç»§ç»™äº† CNCF è¿™æ ·ä¸€ä¸ªå¯Œçˆ¸ï¼Œå†åŠ ä¸ŠåŒçˆ¶å¼‚æ¯çš„ Istio æ˜æ˜Ÿå…„å¼Ÿçš„åŠ æŒï¼Œå¯ä»¥è¯´ Envoy ä¸€æ—¶é£å…‰æ— ä¸¤ï¼Œèµšè¶³äº†çœ¼çƒä¸å¼€å‘è€…çš„æ”¯æŒï¼Œä»…ä¸€å¹´å¤šç‚¹æ—¶é—´ä¾¿ä» CNCF æ¯•ä¸šäº†ã€‚&lt;/p&gt;
&lt;p&gt;å®¹å™¨æŠ€æœ¯åŠ©æ¨äº†ä¼ä¸šå®è·µ Devops ä¸è¿›è¡Œå¾®æœåŠ¡æ”¹é€ ï¼Œk8s å®¹å™¨ç¼–æ’å¹³å°åˆ™è®©ä¼ä¸šèƒ½å¤Ÿæ›´åŠ è‡ªä¿¡çš„å°†æ›´å¤šä¸šåŠ¡ä»ä¼ ç»Ÿæ¶æ„è¿ç§»åˆ°åŸºäºå®¹å™¨çš„ç°ä»£åŸºç¡€æ¶æ„ä¹‹ä¸Šï¼Œk8s è§£å†³äº†å®¹å™¨ç¼–æ’ã€åº”ç”¨å‘å¸ƒç­‰é—®é¢˜ï¼Œä½†æ˜¯å½“æœåŠ¡ä¹‹é—´çš„é€šä¿¡ä»ä»¥å‰çš„å†…å­˜ä¹‹é—´è°ƒç”¨å˜æˆäº†åŸºäº TCP çš„ç½‘ç»œé€šä¿¡åï¼Œç½‘ç»œå¯¹åº”ç”¨æœåŠ¡çš„å½±å“å˜å¾—æ›´åŠ å·¨å¤§ä¸ä¸ç¡®å®šï¼ŒåŸºäºä¼ ç»Ÿçš„åº”ç”¨æ¶æ„çš„è¿ç»´æ‰‹æ®µæ— æ³•é€‚åº”ä¸è§£å†³å·¨å¤§ä¸”å¤æ‚çš„æœåŠ¡é—´é€šä¿¡æ´å¯Ÿã€æ’é”™ï¼Œä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œsevice mesh åº”ç”¨è€Œç”Ÿï¼Œå¹¶è¿…é€Ÿæˆä¸ºå…³æ³¨çš„çƒ­ã€‚Istio é¡¹ç›®åˆ™æ˜¯æ­¤ç”Ÿæ€ä¸­æœ€é‡è¦çš„ç©å®¶ï¼ŒIstio çš„æ¶æ„æ˜¯ä¸€ä¸ªå…¸å‹çš„ç®¡ç†å¹³é¢ä¸æ•°æ®åˆ†ç¦»çš„æ¶æ„ï¼Œåœ¨æ•°æ®å¹³é¢çš„é€‰æ‹©ä¸Šæ˜¯å¼€æ”¾çš„ï¼Œä½†æ˜¯ Istio é»˜è®¤é€‰æ‹©äº† Envoy ä½œä¸ºæ•°æ®å¹³é¢ã€‚ä¸¤å¤§äººæ°”æ˜æ˜Ÿå¼ºå¼ºè”æ‰‹ï¼Œè®©å‡ ä¹åŒä¸€æ—¶æœŸçš„ linkerd å˜å¾—é»¯ç„¶å¤±è‰²ã€‚è€Œåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ï¼ŒNGINX åŒæ ·ä¹Ÿæ›¾çŸ­æš‚çš„è¿›è¡Œäº† Nginmesh é¡¹ç›®ï¼Œè¯•å›¾è®© NGINX ä½œä¸º Istio çš„æ•°æ®å¹³é¢ï¼Œä½†æœ€ç»ˆåœ¨ 2018 å¹´åº•æ”¾å¼ƒäº†ï¼Œä¸ºä»€ä¹ˆä¼šæ”¾å¼ƒï¼Œè¿™ä¸ªæœ¬æ–‡åé¢ä¼šæåˆ°ã€‚&lt;/p&gt;
&lt;p&gt;å½“å‰é™¤äº† Istio é€‰æ‹© Envoy ä½œä¸ºæ•°æ®å¹³é¢å¤–ï¼Œä»¥ Envoy ä¸ºåŸºç¡€çš„é¡¹ç›®è¿˜æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ k8s çš„å¤šä¸ª Ingress Controller é¡¹ç›®ï¼šGloo, Contur, Ambassadorã€‚Istio è‡ªèº«çš„ Ingress gateway ä¸ Egress gateway åŒæ ·é€‰æ‹©çš„æ˜¯ Envoyã€‚æ¥çœ‹ä¸‹å…¶å®˜æ–¹é¦–é¡µåˆ—å‡ºçš„ Envoy ç”¨æˆ·ï¼Œè¯´æ˜Ÿå…‰ç† ç† ä¸€ç‚¹ä¹Ÿä¸ä¸ºè¿‡ã€‚æ³¨æ„åˆ—è¡¨é‡Œçš„ F5ï¼Œæ˜¯ä¸æ˜¯å¾ˆæœ‰æ„æ€ã€‚
















&lt;figure  id=&#34;figure-envoy-end-user&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoy-end-user&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-endusers_hu7cb940f114033bf71e13e700fd2218af_80122_1ad808ea7d41c35ab89df8b7cc8d1abd.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-endusers_hu7cb940f114033bf71e13e700fd2218af_80122_f8d63db4fe0c21e67be0b6ef0db10109.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-endusers_hu7cb940f114033bf71e13e700fd2218af_80122_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/envoy-endusers_hu7cb940f114033bf71e13e700fd2218af_80122_1ad808ea7d41c35ab89df8b7cc8d1abd.webp&#34;
               width=&#34;744&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoy-end-user
    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;em&gt;ï¼ˆEnvoy æœ€ç»ˆç”¨æˆ·åˆ—è¡¨ï¼‰&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&#34;åæµªä¸ºæ—¶ä»£è€Œç”Ÿ&#34;&gt;åæµªï¼šä¸ºæ—¶ä»£è€Œç”Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢æˆ‘å°†ä»æŠ€æœ¯æ–¹é¢æ¥çœ‹çœ‹ä¸ºä½• Envoy èƒ½å¤Ÿå¾—åˆ°ç¤¾åŒºçš„å¦‚æ­¤é‡è§†ã€‚å°†ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥æ€»ç»“ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŠ€æœ¯ç‰¹å¾&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²æ¶æ„&lt;/li&gt;
&lt;li&gt;è½¯ä»¶æ¶æ„&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æŠ€æœ¯ç‰¹å¾&#34;&gt;æŠ€æœ¯ç‰¹å¾&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ¥å£åŒ–ä¸ API&lt;/li&gt;
&lt;li&gt;åŠ¨æ€æ€§&lt;/li&gt;
&lt;li&gt;æ‰©å±•æ€§&lt;/li&gt;
&lt;li&gt;å¯è§‚æµ‹æ€§&lt;/li&gt;
&lt;li&gt;ç°ä»£æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;æ¥å£åŒ–ä¸-api&#34;&gt;æ¥å£åŒ–ä¸ API&lt;/h4&gt;
&lt;p&gt;å½“æˆ‘ç¬¬ä¸€æ¬¡æ‰“å¼€ Envoy çš„é…ç½®æ—¶å€™ï¼Œæˆ‘çš„ç¬¬ä¸€æ„Ÿè§‰æ˜¯ï¼Œå¤©å•Šï¼Œè¿™æ ·ä¸€ä¸ªäº§å“ç”¨æˆ·è¯¥æ€ä¹ˆé…ç½®å’Œä½¿ç”¨ã€‚å…ˆæ¥ç›´è§‚çš„æ„Ÿå—ä¸‹ï¼Œåœ¨ä¸€ä¸ªå¹¶ä¸å¤æ‚çš„å®éªŒç¯å¢ƒä¸‹ï¼Œä¸€ä¸ª Envoy çš„å®é™…é…ç½®æ–‡ä»¶è¡Œæ•°ç«Ÿç„¶è¾¾åˆ°äº† 20000 è¡Œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#  kubectl exec -it productpage-v1-7f4cc988c6-qxqjs -n istio-bookinfo -c istio-proxy -- sh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl http://127.0.0.1:15000/config_dump &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; wc -l
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                 Dload  Upload   Total   Spent    Left  Speed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;  634k    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;  634k    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;  10.1M      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; --:--:-- --:--:-- --:--:-- 10.1M
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;20550&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°½ç®¡è¿™æ˜¯ Istio ç¯å¢ƒä¸‹çš„åŠ¨æ€é…ç½®ï¼Œè™½ç„¶è¿˜æœ‰æ–¹å¼å»ä¼˜åŒ–ä½¿å¾—å®é™…é…ç½®é‡å‡å°‘ï¼Œæˆ–è€…è¯´å½“å®Œå…¨ä½¿ç”¨é™æ€é…ç½®æ–¹å¼è¿›è¡Œé…ç½®çš„æ—¶å€™æˆ‘ä»¬ä¸ä¼šåšå¦‚æ­¤å¤§é‡çš„é…ç½®ï¼Œä½†æ˜¯å½“æˆ‘ä»¬çœ‹åˆ°ä»¥ä¸‹å®é™…çš„é…ç½®ç»“æ„è¾“å‡ºå°±ä¼šæ„Ÿè§‰åˆ°å¯¹äºè¿™æ ·ä¸€ä¸ªè½¯ä»¶ï¼Œå¦‚æœä»¥æ™®é€šæ–¹å¼è¿›è¡Œé…ç½®ä¸ç»´æŠ¤æ˜¾ç„¶æ˜¯ä¸åˆ‡å®é™…çš„ï¼Œå…¶é…ç½®å®Œå…¨ json ç»“æ„åŒ–ï¼Œå¹¶æ‹¥æœ‰å¤§é‡çš„æè¿°æ€§é…ç½®ï¼Œç›¸å¯¹äº NGINX ç­‰è¿™äº›åå‘ä»£ç†è½¯ä»¶æ¥è¯´ï¼Œå…¶é…ç½®ç»“æ„å®åœ¨æ˜¯è¿‡äºå¤æ‚ã€‚
















&lt;figure  id=&#34;figure-å¤æ‚çš„é…ç½®ç»“æ„&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å¤æ‚çš„é…ç½®ç»“æ„&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-json_hu049b77ebbfa003698c50b940541e3c4e_82292_e92b6da85637ffe0b1cad47609945a9c.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-json_hu049b77ebbfa003698c50b940541e3c4e_82292_11b3637b9827a1442c1621ed05bdd32b.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-json_hu049b77ebbfa003698c50b940541e3c4e_82292_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/envoy-json_hu049b77ebbfa003698c50b940541e3c4e_82292_e92b6da85637ffe0b1cad47609945a9c.webp&#34;
               width=&#34;760&#34;
               height=&#34;604&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å¤æ‚çš„é…ç½®ç»“æ„
    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;em&gt;(å¤æ‚çš„é…ç½®ç»“æ„)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æ˜¾ç„¶ï¼ŒEnvoy çš„è®¾è®¡å¤©ç”Ÿå°±ä¸æ˜¯ä¸ºæ‰‹å·¥è€Œè®¾ï¼Œå› æ­¤ Envoy è®¾è®¡äº†å¤§é‡çš„ xDS åè®®æ¥å£ï¼Œéœ€è¦ç”¨æˆ·è‡ªè¡Œè®¾è®¡ä¸€ä¸ª xDS çš„æœåŠ¡ç«¯å®ç°å¯¹æ‰€æœ‰é…ç½®å¤„ç†ï¼ŒEnvoy æ”¯æŒ gRPC æˆ–è€… REST ä¸æœåŠ¡ç«¯è¿›è¡Œé€šä¿¡ä»è€Œæ›´æ–°è‡ªèº«çš„é…ç½®ã€‚xDS æ˜¯ Envoy DSï¼ˆdiscover serviceï¼‰åè®®çš„ç»Ÿç§°ï¼Œå…·ä½“å¯åˆ†ä¸º Listener DSï¼ˆLDS), Route DS (RDS), Cluster DS (CDS), Endpoint DS (EDS), æ­¤å¤–è¿˜æœ‰ Secret DSï¼Œä¸ºäº†ä¿è¯é…ç½®ä¸€è‡´æ€§çš„èšåˆ DS-ADS ç­‰ï¼Œæ›´å¤šçš„ xDS å¯ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/dynamic_configuration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŸ¥çœ‹è¿™é‡Œ&lt;/a&gt;ã€‚è¿™äº›æ¥å£ç”¨äºè‡ªåŠ¨åŒ–äº§ç”Ÿå„ç§å…·ä½“ä¸åŒçš„é…ç½®å¯¹è±¡ã€‚å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜åº¦åŠ¨æ€æ€§çš„è¿è¡Œæ—¶é…ç½®ï¼Œè¦æƒ³ç”¨å¥½å®ƒåˆ™å¿…é¡»å¼€å‘ä¸€ä¸ªå…·æœ‰è¶³å¤Ÿèƒ½åŠ›çš„ server ç«¯ï¼Œæ˜¾ç„¶è¿™ä¸æ˜¯ä¼ ç»Ÿåå‘ä»£ç†è½¯ä»¶çš„è®¾è®¡æ€ç»´ã€‚
















&lt;figure  id=&#34;figure-envoyxds&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoyxDS&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-xds_hu724ec8bf45126a8e9f005682f8fe1d8e_169263_215c65734e422ef6d3db5096acbeb079.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-xds_hu724ec8bf45126a8e9f005682f8fe1d8e_169263_e640be59935f7994024d5467b0f68f54.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-xds_hu724ec8bf45126a8e9f005682f8fe1d8e_169263_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/envoy-xds_hu724ec8bf45126a8e9f005682f8fe1d8e_169263_215c65734e422ef6d3db5096acbeb079.webp&#34;
               width=&#34;760&#34;
               height=&#34;372&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoyxDS
    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;em&gt;(å›¾ç‰‡æ¥è‡ª &lt;a href=&#34;https://gist.github.com/nikhilsuvarna/bd0aa0ef01880270c13d145c61a4af22&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://gist.github.com/nikhilsuvarna/bd0aa0ef01880270c13d145c61a4af22&lt;/a&gt;)&lt;/em&gt;&lt;/p&gt;
&lt;h4 id=&#34;åŠ¨æ€æ€§&#34;&gt;åŠ¨æ€æ€§&lt;/h4&gt;
&lt;p&gt;æ­£å¦‚å‰é¢æ‰€è¿°ï¼ŒEnvoy çš„é…ç½®é«˜åº¦ä¾èµ–æ¥å£è‡ªåŠ¨åŒ–äº§ç”Ÿå„ç§é…ç½®ï¼Œè¿™äº›é…ç½®æ˜¯å¯ä»¥è¿›è¡Œ Runtime ä¿®æ”¹è€Œæ— éœ€ reload æ–‡ä»¶ï¼Œåœ¨ç°ä»£åº”ç”¨æ¶æ„ä¸­ï¼Œä¸€ä¸ªæœåŠ¡ç«¯ç‚¹çš„ç”Ÿå‘½å‘¨æœŸéƒ½å˜å¾—æ›´çŸ­ï¼Œå…¶è¿è¡Œçš„ä¸ç¡®å®šæ€§æˆ–å¼¹æ€§éƒ½å˜å¾—æ›´å¤§ï¼Œæ‰€ä»¥èƒ½å¤Ÿå¯¹é…ç½®è¿›è¡Œ runtime ä¿®æ”¹è€Œæ— éœ€é‡æ–° reload é…ç½®æ–‡ä»¶è¿™ä¸ªèƒ½åŠ›åœ¨ç°ä»£åº”ç”¨æ¶æ„ä¸­æ˜¾å¾—å°¤å…¶çè´µï¼Œè¿™æ­£æ˜¯ Istio é€‰æ‹© Envoy ä½œä¸ºæ•°æ®å¹³é¢çš„ä¸€ä¸ªé‡è¦è€ƒè™‘ã€‚Envoy åŒæ—¶è¿˜å…·å¤‡çƒ­é‡å¯èƒ½åŠ›ï¼Œè¿™ä½¿å¾—åœ¨å‡çº§æˆ–å¿…é¡»è¿›è¡Œé‡å¯çš„æ—¶å€™å˜å¾—æ›´åŠ ä¼˜é›…ï¼Œå·²æœ‰è¿æ¥èƒ½å¤Ÿå¾—åˆ°æ›´å¤šçš„ä¿æŠ¤ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio åœºæ™¯ä¸‹ï¼ŒEnvoy çš„å®¹å™¨é‡Œè¿è¡Œä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªå« pilot-agentï¼Œä¸€ä¸ªæ˜¯ envoy-proxy æœ¬èº«ï¼Œpilot-agent è´Ÿè´£ç®¡ç†ä¸å¯åŠ¨ Envoyï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªä½äº /etc/istio/proxy/ ä¸‹çš„ envoy-rev0.json åˆå§‹é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œå®šä¹‰äº† Envoy åº”è¯¥å¦‚ä½•ä¸ pilot server è¿›è¡Œé€šä¿¡ä»¥è·å–é…ç½®ï¼Œåˆ©ç”¨è¯¥é…ç½®æ–‡ä»¶æœ€ç»ˆå¯åŠ¨ Envoy è¿›ç¨‹ã€‚ä½†æ˜¯ Envoy æœ€ç»ˆè¿è¡Œçš„é…ç½®å¹¶ä¸ä»…ä»…æ˜¯ envoy-rev0.json é‡Œçš„å†…å®¹ï¼Œå®ƒåŒ…å«ä¸Šæ–‡æ‰€è¯´çš„é€šè¿‡ xDS åè®®å‘ç°çš„æ‰€æœ‰åŠ¨æ€é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#  kubectl exec -it productpage-v1-7f4cc988c6-qxqjs -n istio-bookinfo -c istio-proxy -- sh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ps -ef
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;UID         PID   PPID  C STIME TTY          TIME CMD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-p+      &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; Jun25 ?        00:00:33 /usr/local/bin/pilot-agent proxy sidecar --domain istio-bookinfo.svc.cluster.local --serviceCluster productpage.istio-bookinfo --proxyLogLevel&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;warning --proxyComp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-p+     &lt;span class=&#34;m&#34;&gt;14&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; Jun25 ?        00:05:31 /usr/local/bin/envoy -c etc/istio/proxy/envoy-rev0.json --restart-epoch &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; --drain-time-s &lt;span class=&#34;m&#34;&gt;45&lt;/span&gt; --parent-shutdown-time-s &lt;span class=&#34;m&#34;&gt;60&lt;/span&gt; --service-cluster productpage.istio-bookin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-p+    &lt;span class=&#34;m&#34;&gt;142&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 15:38 pts/0    00:00:00 sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-p+    &lt;span class=&#34;m&#34;&gt;148&lt;/span&gt;    &lt;span class=&#34;m&#34;&gt;142&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 15:38 pts/0    00:00:00 ps -ef
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ä¸‹å›¾çš„ envoy æ•´ä½“é…ç½® dump ä¸­å¯ä»¥çœ‹åˆ°åŒ…å«äº† bootstrap çš„å†…å®¹ä»¥åŠå…¶å®ƒé™æ€ä»¥åŠåŠ¨æ€é…ç½®ï¼š
















&lt;figure  id=&#34;figure-envoy-config-dump&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoy-config-dump&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-dump-config-json-struc.jpg_hu25c887d7ae3d28cdbc7867a5dcf9af83_125860_ec41335445f2a1e54c04c548c44c335a.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-dump-config-json-struc.jpg_hu25c887d7ae3d28cdbc7867a5dcf9af83_125860_f4bb1ad014b6d00b6dd2ee60a23c1e26.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-dump-config-json-struc.jpg_hu25c887d7ae3d28cdbc7867a5dcf9af83_125860_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/envoy-dump-config-json-struc.jpg_hu25c887d7ae3d28cdbc7867a5dcf9af83_125860_ec41335445f2a1e54c04c548c44c335a.webp&#34;
               width=&#34;760&#34;
               height=&#34;737&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoy-config-dump
    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;em&gt;(Envoy é…ç½®ç»“æ„)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;ç»“åˆä¸‹å›¾å¯ä»¥çœ‹å‡ºåŸºæœ¬çš„ Envoy é…ç½®ç»“æ„åŠå…¶é€»è¾‘ï¼Œæ— è®ºæ˜¯å…¥å£ listenerï¼ˆç±»ä¼¼ F5 çš„ VS ä»¥åŠéƒ¨åˆ† profile é…ç½®ï¼ŒNGINX çš„ listener ä»¥åŠéƒ¨åˆ† Server æ®µè½é…ç½®ï¼‰è¿˜æ˜¯è·¯ç”±æ§åˆ¶é€»è¾‘ï¼ˆç±»ä¼¼ F5 LTM policyï¼ŒNGINX çš„å„ç§ Locations åŒ¹é…ç­‰ï¼‰ï¼Œè¿˜æ˜¯ Clustersï¼ˆç±»ä¼¼ F5 poolï¼ŒNGINX çš„ upstreamï¼‰ã€Endpointsï¼ˆç±»ä¼¼ F5 pool memberï¼ŒNGINX çš„ upstream é‡Œçš„ serverï¼‰ï¼Œä¹ƒè‡³ SSL è¯ä¹¦å®Œå…¨å¯ä»¥é€šè¿‡æ¥å£ä»æœåŠ¡ä¾§è‡ªåŠ¨åŒ–çš„å‘ç°è¿‡æ¥
















&lt;figure  id=&#34;figure-envoy-objects&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoy-objects&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-basic-objects-logic_hu082c2285404329f7e9fac55f8d1a6899_151308_bbff9fdc2dcad0997dadf763449511c8.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-basic-objects-logic_hu082c2285404329f7e9fac55f8d1a6899_151308_9e880413d9357ae7e1d3ad618febd5b9.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-basic-objects-logic_hu082c2285404329f7e9fac55f8d1a6899_151308_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/envoy-basic-objects-logic_hu082c2285404329f7e9fac55f8d1a6899_151308_bbff9fdc2dcad0997dadf763449511c8.webp&#34;
               width=&#34;760&#34;
               height=&#34;625&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoy-objects
    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;em&gt;(å›¾ç‰‡æ¥è‡ª &lt;a href=&#34;https://gist.github.com/nikhilsuvarna/bd0aa0ef01880270c13d145c61a4af22&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://gist.github.com/nikhilsuvarna/bd0aa0ef01880270c13d145c61a4af22&lt;/a&gt;)&lt;/em&gt;&lt;/p&gt;
&lt;h4 id=&#34;æ‰©å±•æ€§&#34;&gt;æ‰©å±•æ€§&lt;/h4&gt;
&lt;p&gt;Envoy çš„é…ç½®ä¸­å¯ä»¥çœ‹åˆ°å¤§é‡çš„ filterï¼Œè¿™äº›éƒ½æ˜¯å…¶æ‰©å±•æ€§çš„è¡¨ç°ï¼ŒEnvoy å­¦ä¹ äº† F5 ä»¥åŠ NGINX çš„æ¶æ„ï¼Œå¤§é‡ä½¿ç”¨æ’ä»¶å¼ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥æ›´åŠ å®¹æ˜“çš„å¼€å‘ã€‚ä» listener å¼€å§‹å°±æ”¯æŒä½¿ç”¨ filterï¼Œæ”¯æŒå¼€å‘è€…å¼€å‘ L3,L4,L7 çš„æ’ä»¶ä»è€Œå®ç°å¯¹åè®®æ‰©å±•ä¸æ›´å¤šæ§åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å®é™…ä¸­ï¼Œä¼ä¸šåœ¨ C++ çš„å¼€å‘å‚¨å¤‡æ–¹é¢å¯èƒ½è¿œä¸å¦‚ JavaScript ç­‰è¿™æ ·çš„è¯­è¨€å¤šï¼Œå› æ­¤ Envoy è¿˜æ”¯æŒ Lua ä»¥åŠ Webassembly æ‰©å±•ï¼Œè¿™ä¸€æ–¹é¢ä½¿å¾—æ— éœ€ç»å¸¸é‡æ–°ç¼–è¯‘äºŒè¿›åˆ¶å¹¶é‡å¯ï¼Œå¦ä¸€æ–¹é¢é™ä½äº†ä¼ä¸šæ’ä»¶å¼€å‘éš¾åº¦ï¼Œè®©ä¼ä¸šå¯ä»¥ä½¿ç”¨æ›´å¤šå…¼å®¹ Webassembly çš„è¯­è¨€è¿›è¡Œæ’ä»¶ç¼–å†™ï¼Œç„¶åç¼–è¯‘ä¸º Webassenmbly æœºå™¨ç å®ç°é«˜æ•ˆçš„è¿è¡Œã€‚ç›®å‰æ¥è¯´ Envoy ä»¥åŠ Istio åˆ©ç”¨ Webassembly åšæ‰©å±•è¿˜åœ¨æ—©æœŸé˜¶æ®µï¼Œèµ°å‘æˆç†Ÿè¿˜éœ€ä¸€æ®µæ—¶é—´ã€‚
















&lt;figure  id=&#34;figure-envoy-traffic-logic&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoy-traffic-logic&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/concept-envoy-filter_hu04529daf972c21e481b9a5566f50efdd_148379_f6c468906d276a32e6abdc5cf3da2ea1.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/concept-envoy-filter_hu04529daf972c21e481b9a5566f50efdd_148379_aad95f496b0c06438c14e534dba49544.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/concept-envoy-filter_hu04529daf972c21e481b9a5566f50efdd_148379_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/concept-envoy-filter_hu04529daf972c21e481b9a5566f50efdd_148379_f6c468906d276a32e6abdc5cf3da2ea1.webp&#34;
               width=&#34;760&#34;
               height=&#34;567&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoy-traffic-logic
    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;em&gt;(å›¾ç‰‡æ¥è‡ª &lt;a href=&#34;https://www.servicemesher.com/istio-handbook/concepts/envoy.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.servicemesher.com/istio-handbook/concepts/envoy.html&lt;/a&gt;)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;ä»ä¸Šé¢çš„å›¾å¯ä»¥çœ‹å‡ºï¼Œè¿™æ ·çš„è¯·æ±‚å¤„ç†ç»“æ„éå¸¸çš„æ¥è¿‘äº F5 TMOS ç³»ç»Ÿçš„è®¾è®¡æ€æƒ³ï¼Œä¹Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¸ NGINX ç±»ä¼¼ã€‚è¿æ¥ã€è¯·æ±‚åœ¨ä¸åŒçš„åè®®å±‚é¢ä¸é˜¶æ®µå¯¹åº”ä¸åŒçš„å¤„ç†ç»„ä»¶ï¼Œè€Œè¿™äº›ç»„ä»¶æœ¬èº«æ˜¯å¯æ‰©å±•çš„ã€å¯ç¼–ç¨‹çš„ï¼Œè¿›è€Œå®ç°å¯¹æ•°æ®æµçš„çµæ´»ç¼–ç¨‹æ§åˆ¶ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å¯è§‚æµ‹æ€§&#34;&gt;å¯è§‚æµ‹æ€§&lt;/h4&gt;
&lt;p&gt;è¯´ Envoy ç”Ÿæ¥å…·å¤‡äº‘åŸç”Ÿçš„ç‰¹è´¨ï¼Œå…¶ä¸­ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯å¯¹å¯è§‚æµ‹æ€§çš„é‡è§†ï¼Œå¯ä»¥çœ‹åˆ°å¯è§‚æµ‹çš„ä¸‰å¤§ç»„ä»¶ï¼š&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/observability/observability&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;logsï¼Œmetricsï¼Œtracing&lt;/a&gt; é»˜è®¤éƒ½è¢« Envoy æ‰€æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;Envoy å®¹è®¸ç”¨æˆ·ä»¥çµæ´»çš„æ–¹å¼åœ¨çµæ´»çš„ä½ç½®å®šä¹‰çµæ´»çš„æ—¥å¿—æ ¼å¼ï¼Œè¿™äº›å˜åŒ–å¯ä»¥é€šè¿‡åŠ¨æ€é…ç½®ä¸‹å‘ä»è€Œå®ç°ç«‹å³ç”Ÿæ•ˆï¼Œå¹¶å®¹è®¸å®šä¹‰å¯¹æ—¥å¿—çš„é‡‡æ ·ç­‰ã€‚åœ¨ Metrics åˆ™æä¾›äº†èƒ½å¤Ÿä¸ Prometheus è¿›è¡Œé›†æˆçš„è¯¸å¤šæŒ‡æ ‡ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ Envoy å®¹è®¸ filter æœ¬èº«æ¥æ‰©å……è¿™äº›æŒ‡æ ‡ï¼Œä¾‹å¦‚åœ¨é™æµæˆ–è€…éªŒè¯ç­‰ filter ä¸­å®¹è®¸æ’ä»¶æœ¬èº«å®šä¹‰å±äºè‡ªå·±çš„æŒ‡æ ‡ä»è€Œå¸®åŠ©ç”¨æˆ·æ›´å¥½çš„ä½¿ç”¨å’Œé‡åŒ–æ’ä»¶çš„è¿è¡ŒçŠ¶æ€ã€‚åœ¨ Tracing æ–¹é¢ Envoy æ”¯æŒå‘ zipkinï¼Œjaegerï¼Œdatadogï¼ŒlightStep ç­‰ç¬¬ä¸‰æ–¹é›†æˆï¼ŒEnvoy èƒ½å¤Ÿç”Ÿäº§ç»Ÿä¸€çš„è¯·æ±‚ ID å¹¶åœ¨æ•´ä¸ªç½‘ç»œç»“æ„ä¸­ä¿æŒä¼ æ’­ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå¤–éƒ¨çš„ x-client-trace-idï¼Œä»è€Œå®ç°å¯¹å¾®æœåŠ¡ä¹‹é—´å…³ç³»æ‹“æ‰‘çš„æè¿°ã€‚
















&lt;figure  id=&#34;figure-envoy-kiali&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoy-kiali&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-kiali_hu380bb71e3e55bcc143b17ddc912575aa_32992_f13a980fa855b41ace8c1dc4418df619.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-kiali_hu380bb71e3e55bcc143b17ddc912575aa_32992_8bd0a75a841c9f881d3dff61963e06a7.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-kiali_hu380bb71e3e55bcc143b17ddc912575aa_32992_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/envoy-kiali_hu380bb71e3e55bcc143b17ddc912575aa_32992_f13a980fa855b41ace8c1dc4418df619.webp&#34;
               width=&#34;760&#34;
               height=&#34;440&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoy-kiali
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Envoy ç”Ÿæˆçš„æ¯ä¸ª span åŒ…å«ä»¥ä¸‹æ•°æ®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡è®¾ç½® &lt;code&gt;--service-cluster&lt;/code&gt; çš„åŸå§‹æœåŠ¡é›†ç¾¤ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;è¯·æ±‚çš„å¼€å§‹æ—¶é—´å’ŒæŒç»­æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡è®¾ç½® &lt;code&gt;--service-node&lt;/code&gt; çš„åŸå§‹ä¸»æœºä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;x-envoy-downstream-service-cluster&lt;/code&gt; æ ‡å¤´è®¾ç½®çš„ä¸‹æ¸¸é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;HTTP è¯·æ±‚ URLï¼Œæ–¹æ³•ï¼Œåè®®å’Œç”¨æˆ·ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;custom_tags&lt;/code&gt; è®¾ç½®çš„å…¶ä»–è‡ªå®šä¹‰æ ‡ç­¾ã€‚&lt;/li&gt;
&lt;li&gt;ä¸Šæ¸¸é›†ç¾¤åç§°å’Œåœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;HTTP å“åº”çŠ¶æ€ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;GRPC å“åº”çŠ¶æ€å’Œæ¶ˆæ¯ï¼ˆå¦‚æœå¯ç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;HTTP çŠ¶æ€ä¸º 5xx æˆ– GRPC çŠ¶æ€ä¸æ˜¯â€œOKâ€æ—¶çš„é”™è¯¯æ ‡è®°ã€‚&lt;/li&gt;
&lt;li&gt;è·Ÿè¸ªç‰¹å®šäºç³»ç»Ÿçš„å…ƒæ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;ç°ä»£æ€§&#34;&gt;ç°ä»£æ€§&lt;/h4&gt;
&lt;p&gt;å…¶å®ï¼Œè¯´ Envoy å…·æœ‰ç°ä»£æ€§æ˜¾ç„¶æ˜¯æ­£ç¡®çš„åºŸè¯ï¼ŒEnvoy å¤©ç”Ÿä¸ºç°ä»£åº”ç”¨æ¶æ„è€Œç”Ÿï¼Œè¿™é‡Œä¸»è¦æ˜¯æƒ³ä»å‡ ä¸ªæˆ‘ä»¬æœ€å®¹æ˜“èƒ½å¤Ÿæ„Ÿå—åˆ°çš„æ–¹é¢æ¥è¯´æ˜ä¸€ä¸‹ã€‚é¦–å…ˆæ˜¯å…¶ç‰¹æ®Šçš„ç»“æ„è®¾è®¡ï¼Œåœ¨ Envoy é‡Œå®ƒæ”¯æŒåˆ©ç”¨ iptables æˆªå–æµé‡å¹¶åšé€æ˜å¤„ç†ï¼Œå…¶æœ¬èº«èƒ½å¤Ÿåˆ©ç”¨ getsockopt () å®ç°å¯¹ NAT æ¡ç›®ä¸­åŸå§‹ç›®çš„ä¿¡æ¯çš„æå–ï¼Œå¹¶åœ¨ listener ç›‘å¬ä¸Šå®¹è®¸åœ¨ä»è¢«è·³è½¬çš„ç«¯å£ listener ä¸­è·³è·ƒåˆ°å®é™…èƒ½åŒ¹é…åŸå§‹ç›®çš„ä¿¡æ¯çš„éç»‘å®šå‹ listenerï¼Œå°½ç®¡ä»åå‘ä»£ç†è§’åº¦çœ‹è¿™å°±æœ‰ç‚¹åƒ F5 çš„ VS å†…éƒ¨è·³è½¬ï¼ŒNGINX çš„ subrequestï¼Œä½†æ˜¯å…¶æœ€å¤§çš„ç‰¹ç‚¹å’Œèƒ½åŠ›åœ¨äºå¯¹è¿æ¥çš„é€æ˜æ€§ï¼Œè¿™åœ¨ Pod sidecar æ¨¡å¼çš„éƒ¨ç½²ä¸­æ˜¾å¾—å°¤å…¶é‡è¦ï¼Œå…·ä½“åŸç†å¯å‚è€ƒ &lt;a href=&#34;https://www.cnadn.net/post/2945.htm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºç°ä»£åº”ç”¨æœ€çˆ±çš„ç°åº¦å‘å¸ƒï¼Œæµé‡é•œåƒï¼Œæ–­è·¯å™¨ï¼Œå…¨å±€é™æµç­‰ç­‰åŠŸèƒ½ï¼Œå…¶åœ¨é…ç½®ä¸Šä¹Ÿéå¸¸çš„ç®€æ´ï¼Œè¿™ä¸€ç‚¹å°½ç®¡ F5/NGINX ç­‰è½¯ä»¶ä¹Ÿèƒ½å®Œæˆç±»ä¼¼çš„å·¥ä½œï¼Œä½†åœ¨åŸç”Ÿæ€§ä¸Šä»¥åŠé…ç½®çš„éš¾æ˜“ç¨‹åº¦ä¸Š Envoy å…·æœ‰æ›´å¤§ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;p&gt;ç°ä»£æ€§çš„å¦ä¸€ä¸ªè¡¨ç°å°±æ˜¯å¯¹åè®®çš„æ”¯æŒï¼Œçœ‹çœ‹ä»¥ä¸‹æ”¯æŒçš„åè®®ï¼Œç†Ÿæ‚‰åº”ç”¨äº¤ä»˜ã€åå‘ä»£ç†è½¯ä»¶çš„åŒå­¦å¯èƒ½ä¼šæƒ…ä¸è‡ªç¦çš„è¡¨ç¤ºèµå¹ï¼Œè€Œè¿™äº›åè®®çš„æ”¯æŒæ›´ä»å¦ä¸€æ–¹é¢è¡¨ç°äº† Envoy ä½œä¸ºæ›´åŠ é¢å‘å¼€å‘è€…å’Œ SRE çš„ä¸€ä¸ªç‰¹è´¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;gRPC&lt;/li&gt;
&lt;li&gt;HTTP2&lt;/li&gt;
&lt;li&gt;MongoDB&lt;/li&gt;
&lt;li&gt;DynamoDB&lt;/li&gt;
&lt;li&gt;Redis&lt;/li&gt;
&lt;li&gt;Postgres&lt;/li&gt;
&lt;li&gt;Kafka&lt;/li&gt;
&lt;li&gt;Dubbo&lt;/li&gt;
&lt;li&gt;Thrift&lt;/li&gt;
&lt;li&gt;ZooKeeper&lt;/li&gt;
&lt;li&gt;RockeMQ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;éƒ¨ç½²æ¶æ„&#34;&gt;éƒ¨ç½²æ¶æ„&lt;/h3&gt;
&lt;p&gt;åœ¨äº†è§£å®Œ Envoy çš„æŠ€æœ¯ç‰¹å¾åï¼Œå†æ¥ä»éƒ¨ç½²æ¶æ„è§’åº¦çœ‹ Envoyã€‚&lt;/p&gt;
&lt;p&gt;å®Œæ•´ Sidecar æ¨¡å‹éƒ¨ç½²ï¼Œè¿™æ˜¯ Envoy æœ€å¤§çš„éƒ¨ç½²ç‰¹å¾ï¼Œservices ä¹‹é—´çš„é€šä¿¡å®Œå…¨è½¬åŒ–ä¸º Envoy ä»£ç†ä¹‹é—´çš„é€šä¿¡ï¼Œä»è€Œå®ç°å°†è¯¸å¤šéä¸šåŠ¡åŠŸèƒ½ä»æœåŠ¡ä»£ç ä¸­ç§»å‡ºåˆ°å¤–éƒ¨ä»£ç†ç»„ä»¶ï¼ŒEnvoy è´Ÿè´£ç½‘ç»œé€šä¿¡æ§åˆ¶ä¸æµé‡çš„å¯è§‚æµ‹ã€‚ä¹Ÿå¯ä»¥éƒ¨ç½²ä¸ºç®€åŒ–çš„ sidecarï¼Œå…¶ä»…å……å½“ service å…¥ç«™æ–¹å‘çš„ä»£ç†ï¼Œæ— éœ€é¢å¤–çš„æµé‡æ“çºµï¼Œè¿™ä¸ªç»“æ„åœ¨æˆ‘å¯¹å¤–é˜è¿°çš„åŸºäº NGINX å®ç°ä¸šåŠ¡å¯è§‚æµ‹æ€§ä¸­æ‰€ä½¿ç”¨
















&lt;figure  id=&#34;figure-envoy-topo-1&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoy-topo-1&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/t1_huec2a4fbc614331982926fcd6e30b6be9_66853_6f9370f771c22cac86868a0a71d88b7c.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/t1_huec2a4fbc614331982926fcd6e30b6be9_66853_23c3bb7b148bac9c7699be702495b207.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/t1_huec2a4fbc614331982926fcd6e30b6be9_66853_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/t1_huec2a4fbc614331982926fcd6e30b6be9_66853_6f9370f771c22cac86868a0a71d88b7c.webp&#34;
               width=&#34;752&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoy-topo-1
    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;em&gt;(å›¾ç‰‡æ¥è‡ª &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/life_of_a_request#request-flow&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.envoyproxy.io/docs/envoy/latest/intro/life_of_a_request#request-flow&lt;/a&gt;)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Hub å‹ï¼Œè¿™ä¸ NGINX çš„ MRA ä¸­çš„ Router-mesh å‹ç†å¿µç›¸åŒï¼Œæ‰€æœ‰æœåŠ¡ä½¿ç”¨ä¸€ä¸ªé›†ä¸­çš„ Envoy è¿›è¡Œé€šä¿¡ï¼Œè¿™ç§éƒ¨ç½²ç»“æ„ä¸€èˆ¬é€‚ç”¨äºä¸­å°å‹æœåŠ¡ï¼Œå¯é€šè¿‡ä¸æœåŠ¡æ³¨å†Œçš„é€‚é…å°†æœåŠ¡æµé‡å¯¼å‘åˆ° Envoy
















&lt;figure  id=&#34;figure-envoy-topo-hub&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoy-topo-hub&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/t2_hu6d6bc4e58a40ae71a4cd036ae63c3794_31390_af88b25ad7bad74453ad84e896ff9d0f.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/t2_hu6d6bc4e58a40ae71a4cd036ae63c3794_31390_5ae7ce5ccbf4a5aac43fdf2eb0d73c72.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/t2_hu6d6bc4e58a40ae71a4cd036ae63c3794_31390_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/t2_hu6d6bc4e58a40ae71a4cd036ae63c3794_31390_af88b25ad7bad74453ad84e896ff9d0f.webp&#34;
               width=&#34;760&#34;
               height=&#34;583&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoy-topo-hub
    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;em&gt;(å›¾ç‰‡æ¥è‡ª &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/life_of_a_request#request-flow&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.envoyproxy.io/docs/envoy/latest/intro/life_of_a_request#request-flow&lt;/a&gt;)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Envoy ä¹Ÿå¯ä»¥ä½œä¸º Ingress edge ç½‘å…³æˆ– Egress ç½‘å…³ï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹ä¸€èˆ¬ Envoy å¤šç”¨äº Ingress controller æˆ– API ç½‘å…³ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šçš„æ­¤ç±»å®ç°å–œæ¬¢ä½¿ç”¨ Envoy ä½œä¸ºåº•å±‚ï¼Œä¾‹å¦‚ Gloo, Ambassador ç­‰
















&lt;figure  id=&#34;figure-envoy-topo-in-out&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoy-topo-in-out&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/t3_hu9ad53efc3e64f75a9ecfcf2154fa4988_26988_8647f6d5663ec4f9583f4dc44fc74ff5.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/t3_hu9ad53efc3e64f75a9ecfcf2154fa4988_26988_c224f22c858e9258a600350fd4910fc0.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/t3_hu9ad53efc3e64f75a9ecfcf2154fa4988_26988_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/t3_hu9ad53efc3e64f75a9ecfcf2154fa4988_26988_8647f6d5663ec4f9583f4dc44fc74ff5.webp&#34;
               width=&#34;760&#34;
               height=&#34;280&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoy-topo-in-out
    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;em&gt;(å›¾ç‰‡æ¥è‡ª &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/life_of_a_request#request-flow&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.envoyproxy.io/docs/envoy/latest/intro/life_of_a_request#request-flow&lt;/a&gt;)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªéƒ¨ç½²ç»“æ„åº”è¯¥æ˜¯å¤§å®¶æ¯”è¾ƒç†Ÿæ‚‰çš„ï¼ŒEnvoy ä½œä¸ºä¸€ä¸ª Edge ç½‘å…³ï¼Œå¹¶åŒæ—¶éƒ¨ç½²é¢å¤–ä¸€å±‚å¾®æœåŠ¡ç½‘å…³ï¼ˆæˆ–ä»£ç†å¹³å°å±‚ï¼‰
















&lt;figure  id=&#34;figure-envoy-topo-in-out&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoy-topo-in-out&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/t5_hua67da8aa10670a4011593fb67b4be231_40719_05e5da9cb875d044134ea4fde486fe8d.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/t5_hua67da8aa10670a4011593fb67b4be231_40719_185ae9927a71526ad6432072ea308f58.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/t5_hua67da8aa10670a4011593fb67b4be231_40719_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/t5_hua67da8aa10670a4011593fb67b4be231_40719_05e5da9cb875d044134ea4fde486fe8d.webp&#34;
               width=&#34;760&#34;
               height=&#34;369&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoy-topo-in-out
    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;em&gt;(å›¾ç‰‡æ¥è‡ª &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/life_of_a_request#request-flow&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.envoyproxy.io/docs/envoy/latest/intro/life_of_a_request#request-flow&lt;/a&gt;)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œè¿™æ˜¯å°†æ‰€æœ‰å½¢æ€çš„ Envoy éƒ¨ç½²é›†ä¸­åˆ°äº†ä¸€èµ·ï¼Œè¿™ç§æ¶æ„å¯èƒ½ä¼šåœ¨æœåŠ¡ä»ä¼ ç»Ÿæ¶æ„å‘å¾®æœåŠ¡æ¶æ„è¿ç§»è¿‡ç¨‹çš„ä¸­é—´å½¢æ€
















&lt;figure  id=&#34;figure-envoy-topo-all&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoy-topo-all&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/t4_hu85bed4e945564ff4ebdefa8abe61018f_30348_0afbe33bb03c77ab3f773231cfdfaf89.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/t4_hu85bed4e945564ff4ebdefa8abe61018f_30348_81e937b6dea37534f90ee184b6af4344.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/t4_hu85bed4e945564ff4ebdefa8abe61018f_30348_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/t4_hu85bed4e945564ff4ebdefa8abe61018f_30348_0afbe33bb03c77ab3f773231cfdfaf89.webp&#34;
               width=&#34;760&#34;
               height=&#34;277&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoy-topo-all
    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;em&gt;(å›¾ç‰‡æ¥è‡ª &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/life_of_a_request#request-flow&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.envoyproxy.io/docs/envoy/latest/intro/life_of_a_request#request-flow&lt;/a&gt;)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œæ¥çœ‹ä¸€ä¸‹ Istio é‡Œæ˜¯å¦‚ä½•ä½¿ç”¨ Envoy çš„
















&lt;figure  id=&#34;figure-envoy-istio&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoy-istio&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/t6_huf57be224c2fc98b5451cef6c9f24b3a2_49095_dce079f7e6a0384d3461f4f19b8fb03a.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/t6_huf57be224c2fc98b5451cef6c9f24b3a2_49095_18979c7e50a8e8dcd7e4f39b1ec3a32e.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/t6_huf57be224c2fc98b5451cef6c9f24b3a2_49095_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/t6_huf57be224c2fc98b5451cef6c9f24b3a2_49095_dce079f7e6a0384d3461f4f19b8fb03a.webp&#34;
               width=&#34;665&#34;
               height=&#34;539&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoy-istio
    &lt;/figcaption&gt;&lt;/figure&gt;

&lt;em&gt;(å›¾ç‰‡æ¥è‡ªç½‘ç»œ)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æ€»ç»“æ¥çœ‹ï¼Œç”±äº Envoy çš„è·¨å¹³å°æ€§ï¼Œä½¿å…¶å…·æœ‰å’Œ NGINX ä¸€æ ·çš„çµæ´»éƒ¨ç½²ç»“æ„ï¼Œä½†æ˜¯å®é™…ä¸Šéƒ¨ç½²ç»“æ„å¾€å¾€ä¸æœ€ç»ˆçš„é…ç½®å®ç°æœºåˆ¶æœ‰ç€å¼ºå…³ç³»ï¼Œè½¯ä»¶çš„èƒ½åŠ›èƒ½å¦é€‚åº”åœ¨æ­¤ç»“æ„ä¸‹çš„çµæ´»ä¸ç®€å•çš„é…ç½®å®ç°æ˜¯æœ€ç»ˆè€ƒéªŒã€‚å®¢è§‚çš„è®²ï¼Œåœ¨è¿™æ–¹é¢ Envoy æ›´å…·æœ‰ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è½¯ä»¶æ¶æ„&#34;&gt;è½¯ä»¶æ¶æ„&lt;/h3&gt;
&lt;p&gt;Envoy é‡‡ç”¨äº†å•è¿›ç¨‹å¤šçº¿ç¨‹çš„è®¾è®¡ç»“æ„ï¼Œä¸»çº¿ç¨‹è´Ÿè´£é…ç½®æ›´æ–°ï¼Œè¿›ç¨‹ä¿¡å·å¤„ç†ç­‰ã€‚è¯·æ±‚åˆ™æ˜¯ç”±å¤šä¸ª worker çº¿ç¨‹æ¥å¤„ç†ï¼Œä¸ºäº†ç®€åŒ–ä¸é¿å…å¤„ç†å¤æ‚ï¼Œä¸€ä¸ªè¿æ¥å§‹ç»ˆç”±ä¸€ä¸ªçº¿ç¨‹å¤„ç†ï¼Œè¿™æ ·å¯å°½é‡å‡å°‘çº¿ç¨‹é—´çš„æ•°æ®å…±äº«è€Œå¼•å‘çš„ä¸€äº›é”æ“ä½œã€‚Envoy å°½å¯èƒ½çš„é¿å…çº¿ç¨‹ä¹‹é—´çš„çŠ¶æ€å…±äº«ï¼Œä¸ºæ­¤è®¾è®¡äº† Thread Local Store æœºåˆ¶ã€‚åœ¨æ—¥å¿—çš„å†™å…¥ä¸Šï¼Œå®é™…ä¸Šæ˜¯ worker çº¿ç¨‹å†™å…¥åˆ°å†…å­˜ç¼“å­˜ï¼Œæœ€åå†ç”±æ–‡ä»¶åˆ·æ–°çº¿ç¨‹æ¥è´Ÿè´£å†™å…¥åˆ°ç£ç›˜ï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜æ•ˆç‡ã€‚æ•´ä½“ä¸Šæ¥è¯´ï¼ŒEnvoy åœ¨è®¾è®¡æ—¶å€™è¿˜æ˜¯æ¯”è¾ƒåé‡äºç®€åŒ–å¤æ‚æ€§ï¼Œå¹¶å¼ºè°ƒçµæ´»æ€§ï¼Œå› æ­¤ä¸ NGINX ä¸åŒå®ƒå¹¶æ²¡æœ‰æŠŠå¯¹æ€§èƒ½çš„è¿½æ±‚æ”¾åœ¨ç¬¬ä¸€ä½ï¼Œè¿™ä¸€ç‚¹åœ¨ Envoy çš„ç›¸å…³å®˜æ–¹åšå®¢é‡Œå¯ä»¥å¾—åˆ°éªŒè¯ã€‚
















&lt;figure  id=&#34;figure-envoy-threads&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoy-threads&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-thread_hu8cd365bb3fd7d4af38c7ddbe253f5a37_117905_7f7c1651fb34b1147010d6c60da060c1.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-thread_hu8cd365bb3fd7d4af38c7ddbe253f5a37_117905_bb2d6193dac2c55b45386468050a3d15.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-thread_hu8cd365bb3fd7d4af38c7ddbe253f5a37_117905_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/envoy-thread_hu8cd365bb3fd7d4af38c7ddbe253f5a37_117905_7f7c1651fb34b1147010d6c60da060c1.webp&#34;
               width=&#34;760&#34;
               height=&#34;622&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoy-threads
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å›¾ç‰‡æ¥è‡ª &lt;a href=&#34;https://blog.envoyproxy.io/envoy-threading-model-a8d44b922310&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://blog.envoyproxy.io/envoy-threading-model-a8d44b922310&lt;/a&gt;*&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ NGINX ç±»ä¼¼ï¼ŒEnvoy æ•´ä½“æ˜¯å¼‚æ­¥éé˜»å¡çš„è®¾è®¡ï¼Œé‡‡ç”¨çš„æ˜¯äº‹ä»¶é©±åŠ¨æ–¹å¼ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½è´Ÿè´£æ¯ä¸€ä¸ª listenerï¼Œå¯ä»¥é‡‡ç”¨ SO_REUSEPORT ä¹Ÿå¯ä»¥å…±äº« socketï¼ŒNGINX ä¹Ÿæœ‰ç±»ä¼¼çš„æœºåˆ¶ã€‚
















&lt;figure  id=&#34;figure-envoy-listener&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoy-listener&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/t7_hu074f6e40f655e514805a48e2e53b5df3_70524_1a70b5d687f2030a2b3295931464494f.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/t7_hu074f6e40f655e514805a48e2e53b5df3_70524_14c199375dae20fd6e4e6de43b679076.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/t7_hu074f6e40f655e514805a48e2e53b5df3_70524_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/t7_hu074f6e40f655e514805a48e2e53b5df3_70524_1a70b5d687f2030a2b3295931464494f.webp&#34;
               width=&#34;760&#34;
               height=&#34;364&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoy-listener
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å›¾ç‰‡æ¥è‡ª &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/life_of_a_request#request-flow&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.envoyproxy.io/docs/envoy/latest/intro/life_of_a_request#request-flow&lt;/a&gt;*&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“è¯·æ±‚ç”± listener ç›‘å¬å¹¶å¼€å§‹å¤„ç†åï¼Œæ ¹æ®é…ç½®è¿æ¥å°†ä¼šè¢«åç»­çš„ L3ã€4ã€7 ç­‰å¤šä¸ª filter è¿›è¡Œå¤„ç†ã€‚
















&lt;figure  id=&#34;figure-envoy-proxy-arch&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoy proxy arch&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-arch_hu85e1397c916f7683db0f1f7214f5b215_159982_a8d535ece97bed564a2c227814e9206a.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-arch_hu85e1397c916f7683db0f1f7214f5b215_159982_2baaeb7452ca3d58e876e2fe49b9e39d.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/envoy-arch_hu85e1397c916f7683db0f1f7214f5b215_159982_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/envoy-arch_hu85e1397c916f7683db0f1f7214f5b215_159982_a8d535ece97bed564a2c227814e9206a.webp&#34;
               width=&#34;760&#34;
               height=&#34;558&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoy proxy arch
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å›¾ç‰‡å–è‡ª jimmysong.io*&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å‰æµªå®åˆ€æœªè€&#34;&gt;å‰æµªï¼šå®åˆ€æœªè€&lt;/h2&gt;
&lt;p&gt;åœ¨äº†è§£å®Œ Envoy çš„æŠ€æœ¯ç‰¹æ€§åŠå…¶æ¶æ„åï¼Œæˆ‘ä»¬å†å›åˆ°æ­¤æ–‡çš„åŸç‚¹ã€‚Envoy ä»å‡ºç”Ÿå°±å¸¦ç€ç°ä»£åº”ç”¨æ¶æ„çš„åŸºå› ï¼Œæ˜¯ä¸æ˜¯è¯´å¯¹äº NGINX/F5 ç­‰è¿™äº›å‰æµªå°±è½ä¼äº†å‘¢ã€‚&lt;/p&gt;
&lt;p&gt;è®°å¾— NGINX çš„ä½œè€… Igor åœ¨ F5 ä¸­å›½ 520 å¤§ä¼šä¸Šæ›¾è¿™æ ·å¯¹å¤§å®¶ä»‹ç» NGINX ä¸ºä½•å¦‚æ­¤æˆåŠŸã€‚ä»–è¯´ï¼Œä»–æ²¡æœ‰æƒ³åˆ°ä¼šå¦‚æ­¤æˆåŠŸï¼Œç©¶å…¶åŸå› æ˜¯ä»–åœ¨æ­£ç¡®çš„æ—¶é—´ç‚¹å¼€å‘äº†ä¸€ä¸ªæ­£ç¡®çš„è½¯ä»¶ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ 2003 å¹´å·¦å³é‚£ä¸ªæ—¶æœŸï¼Œè¿˜è°ˆä¸ä¸Šä»€ä¹ˆåˆ†å¸ƒå¼æ¶æ„ã€å¾®æœåŠ¡ï¼Œé‚£æ—¶å€™ä¸»è¦è¦è§£å†³çš„æ˜¯å•æœºæ€§èƒ½é—®é¢˜ï¼Œæ­£æ˜¯åŸºäºè¿™æ ·çš„èƒŒæ™¯ï¼ŒNGINX æ— è®ºä»æ¶æ„è®¾è®¡è¿˜æ˜¯ä»£ç è´¨é‡éƒ½ä¸¥æ ¼è‹›æ±‚äºæ€§èƒ½ã€‚åœ¨åŠŸèƒ½ä¸Šï¼ŒNGINX æœ¬æ¥æ˜¯ä¸€æ¬¾ Web Server è½¯ä»¶ï¼ŒL7 åå‘ä»£ç†åˆ™æ˜¯å…¶èƒ½åŠ›çš„å»¶ä¼¸ï¼Œè€Œ L4 ä»£ç†èƒ½åŠ›çš„å¢åŠ åˆ™æ›´æ™šï¼Œé‰´äºè¿™æ ·çš„èƒŒæ™¯ï¼Œä»ç°ä»£åº”ç”¨æ¶æ„è§’åº¦æ¥çœ‹ï¼Œç¡®å®æœ‰ä¸€äº›èƒ½åŠ›æ˜¯è¾ƒéš¾è¦†ç›–çš„ã€‚åŒæ ·ï¼ŒEnvoy è¯ç”Ÿå’Œå‘å±•äºç°ä»£åº”ç”¨æ¶æ„æ—¶ä»£ï¼Œæ­£å¦‚ Envoy è‡ªæˆ‘é˜è¿°ï¼Œå…¶å‚è€ƒäº†å¤§é‡å·²æœ‰çš„è½¯ç¡¬ä»¶åå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡äº§å“ï¼Œä»ä¸Šé¢çš„æŠ€æœ¯åˆ†æä¸­ä¹Ÿå¯ä»¥çœ‹å‡º Envoy æœ‰å¾ˆå¤š NGINX ä»¥åŠ F5 æ¶æ„ç†å¿µï¼Œå¯ä»¥è¯´ Envoy ä»æˆç†Ÿçš„åå‘ä»£ç†äº§å“ä¸­å¸å–äº†è¯¸å¤šç²¾åï¼Œå¹¶åœ¨è®¾è®¡æ—¶å€™å……åˆ†è€ƒè™‘ç°ä»£åº”ç”¨æ¶æ„çš„éœ€æ±‚ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªåœ¨æ­£ç¡®çš„æ—¶é—´çš„ä¸€ä¸ªæ­£ç¡®è½¯ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œå¾ˆå¤šé—®é¢˜éƒ½å˜æˆäº†å¦‚ä½•æ§åˆ¶æœåŠ¡ä¹‹é—´çš„é€šä¿¡ä¸æµé‡æ´å¯Ÿï¼Œè¿™æ˜¯å…¸å‹çš„åº”ç”¨äº¤ä»˜é¢†åŸŸï¼Œä½œä¸ºè¿™ä¸ªé¢†åŸŸçš„å‰æµªä¸€æ–¹é¢éœ€ç§¯ææ‹¥æŠ±å’Œé€‚åº”æ–°æ—¶ä»£çš„åº”ç”¨æ¶æ„ï¼Œä¸€æ–¹é¢éœ€è¦åˆ›æ–°å¹¶ç»§ç»­å¼•é¢†æ–°çš„æ–¹å‘ã€‚å†å²ä¸Šè¿™ä¸ªé¢†åŸŸå‘ç”Ÿäº†ä¸¤æ¬¡æŠ€æœ¯é©æ–°ï¼Œç¬¬ä¸€æ¬¡æ˜¯åœ¨ 2006 å¹´å·¦å³ï¼Œå½“æ—¶ä¸€åº¦å…³äºâ€œè´Ÿè½½å‡è¡¡å·²æ­»â€è¯é¢˜è¢«ç‚’çˆ†ï¼Œå®è´¨æ˜¯å½“æ—¶å¸‚åœºå¼€å§‹å‘ç”Ÿå˜æ¢ï¼Œå¤§å®¶ä¸å†æ»¡è¶³äºç®€å•çš„è´Ÿè½½å‡è¡¡ï¼Œéœ€æ±‚è¡ç”Ÿåˆ°åº”ç”¨å®‰å…¨ã€ç½‘ç»œä¼˜åŒ–ã€åº”ç”¨ä¼˜åŒ–ã€æ¥å…¥æ§åˆ¶ã€æµé‡æ§åˆ¶ç­‰æ›´å¤šå¤æ‚çš„åœºæ™¯ï¼Œåº”ç”¨äº¤ä»˜æ¦‚å¿µå¼€å§‹è¢«æå‡ºï¼Œå¯ä»¥è¯´åœ¨ 2006 å¹´å‰ï¼Œå¸‚åœºçš„ä¸»è¦æ¦‚å¿µå’ŒæŠ€æœ¯æ–¹å‘æ˜¯ä»¥å››å±‚äº¤æ¢æœºä¸ºæ ¸å¿ƒç†å¿µçš„è´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼Œå¤§éƒ¨åˆ†ç©å®¶æ˜¯ä¼ ç»Ÿç½‘ç»œå‚å•†ï¼Œæ€ç»´ä¸æ¦‚å¿µéƒ½æ˜¯ä»¥ç½‘ç»œäº¤æ¢ä¸ºåŸºç¡€ï¼Œè€Œ F5 å°±åƒä¸€ä¸ªå¥‡æ€ªçš„å®¶ä¼™ï¼Œäº§å“è®¾è®¡æ€æƒ³å®Œå…¨åœ¨å¦ä¸€ä¸ªç»´åº¦ä¹‹ä¸Šï¼Œè‡ª 2004 å¹´å°±å¼€å§‹å‘å¸ƒçš„ TMOS V9 æ“ä½œç³»ç»Ÿè‡ªæ­¤å¼€å§‹å¼•é¢†å¸‚åœºï¼Œæ­¤å 10 å¹´ï¼Œæ— äººè¶…è¶Šã€‚ç¬¬äºŒæ¬¡æŠ€æœ¯é©æ–°å‘ç”Ÿåœ¨ 2016 å¹´å·¦å³ï¼Œå—äº‘ã€å¾®æœåŠ¡çš„å½±å“ï¼Œè½¯ä»¶åŒ–ã€è½»é‡åŒ–å˜ä¸ºå¸‚åœºä¸»æµï¼ŒåŒæ—¶ Devops æ€æƒ³æ„å‘³ç€ä½¿ç”¨è€…è§’è‰²å‘ç”Ÿäº†å˜åŒ–ï¼Œä¼ ç»Ÿçš„é¢å‘ç½‘ç»œè¿ç»´äººå‘˜çš„è®¾è®¡å¼€å§‹å˜å¾—éš¾ä»¥æ»¡è¶³å¸‚åœºéœ€æ±‚ã€‚ä»¥ F5 ä¸ºä¸»å¯¼çš„è¿™ä¸ªé¢†åŸŸåœ¨å¸‚åœºä¸Šä¹Ÿå‘ç”Ÿäº†æ–°çš„å˜åŒ–ï¼ŒGartner ä¸å†å¯¹åº”ç”¨äº¤ä»˜é¢†åŸŸå‘å¸ƒé­”åŠ›è±¡é™åˆ†æï¼Œè½¬è€Œå½¢æˆä»¥ Guide æ–¹å¼çš„æŒ‡å¯¼ã€‚
















&lt;figure  id=&#34;figure-f5stock&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;F5stock&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/F5-stock_hu5306cdb135854cc08e6409c3bbfe95e8_79808_cc02f4af706021351fb68285eda6f0df.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/F5-stock_hu5306cdb135854cc08e6409c3bbfe95e8_79808_2a746c6b81dc64b8be56e1242c2609c8.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/F5-stock_hu5306cdb135854cc08e6409c3bbfe95e8_79808_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/F5-stock_hu5306cdb135854cc08e6409c3bbfe95e8_79808_cc02f4af706021351fb68285eda6f0df.webp&#34;
               width=&#34;760&#34;
               height=&#34;317&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      F5stock
    &lt;/figcaption&gt;&lt;/figure&gt;

*F5 è‚¡ä»·èµ°åŠ¿å›¾ *&lt;/p&gt;
&lt;p&gt;çœ‹å½“ä¸‹ï¼Œå†å²æ€»æ˜¯æƒŠäººçš„ç›¸ä¼¼ã€‚&lt;/p&gt;
&lt;p&gt;ç°ä»£åº”ç”¨æ¶æ„é£é€Ÿå‘å±•ï¼Œå¤§é‡åº”ç”¨å¼€å§‹å¾®æœåŠ¡åŒ–ï¼Œä½†ä»ä¸šåŠ¡è®¿é—®çš„æ•´ä½“é“¾æ¡æ¥çœ‹ï¼ŒEnvoy è¿˜ä¸èƒ½è§£å†³æ‰€æœ‰é—®é¢˜ï¼Œä¾‹å¦‚åº”ç”¨å®‰å…¨é˜²æŠ¤ï¼Œå¤æ‚çš„ä¼ä¸šåè®®ï¼Œä»¥åŠä¸åŒçš„ç»„ç»‡å…³ç³»å¯¼è‡´çš„ä¸åŒéœ€æ±‚ã€‚å¯ä»¥çœ‹åˆ°ä»¥ F5/NGINX ä¸ºä»£è¡¨çš„åº”ç”¨äº¤ä»˜äº§å“åœ¨ Devops å¤§æ½®ä¸‹ä¹Ÿå¼€å§‹ç§¯æçš„å®ç°äº§å“èå…¥ï¼ŒF5 å‘å¸ƒäº†å®Œæ•´çš„è‡ªåŠ¨åŒ–å·¥å…·é“¾ï¼Œä»äº§å“çš„ bootstrap åˆ°ç½‘ç»œé…ç½®ã€åˆ°åº”ç”¨æœåŠ¡é…ç½®ï¼Œåˆ°æœ€åçš„ç›‘æ§é¥æµ‹éƒ½å·²ç»å½¢æˆäº†å®Œæ•´çš„æ¥å£ï¼Œå¹¶é‡‡ç”¨å£°æ˜å¼æ¥å£æ¥å°†äº§å“ç®¡ç†æå‡åˆ°æ›´é«˜è§’è‰²äººç¾¤ä¸ç®¡ç†ç³»ç»Ÿä¸­ã€‚NGINX åŒæ ·æ„å»ºäº†è‡ªèº«çš„ API ä»¥åŠ Controller å¹³é¢ï¼Œå¯¹å¤–æä¾›å£°æ˜å¼ API æ¥å£ï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½çš„åˆ©ç”¨æ¥å£èå…¥è‡ªèº«çš„æ§åˆ¶å¹³é¢ã€‚è¿™äº›å˜åŒ–éƒ½æ˜¯ä¸ºäº†è®©å¼€å‘è€…æˆ–è€… SRE èƒ½å¤Ÿæ›´å¥½çš„ä½¿ç”¨ F5/NGINX, è¯¦ç»†å¯ä»¥å‚è€ƒæˆ‘çš„ã€Šä»ä¼ ç»Ÿ ADC è¿ˆå‘ Cloud Native ADCã€‹&lt;a href=&#34;https://mp.weixin.qq.com/s?src=11&amp;amp;timestamp=1593224168&amp;amp;ver=2425&amp;amp;signature=znUdlLDdpbGGxWX7pZhH2uSVq1SAdQuloO09HIXssdQ15nRtWVOIgzlYTFmjOIUsDrqghPbSZM6vQI45TIqmINQKjposI7AfJ6jKQaEXm9KD4tEV5Bk9AF0RGuKvVuHI&amp;amp;new=1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç³»åˆ—æ–‡ç« &lt;/a&gt;ã€‚
















&lt;figure  id=&#34;figure-slides3&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;slides3&#34; srcset=&#34;
               /blog/thoughts-to-envoy-from-adn-perspective/slides-3_hu843b0f00406c9fa5d96432a9bd2f19da_81440_ec95f11ab21e16c4f545a1df5c309b66.webp 400w,
               /blog/thoughts-to-envoy-from-adn-perspective/slides-3_hu843b0f00406c9fa5d96432a9bd2f19da_81440_21e35bf05de18f9cc22d760b687ab29d.webp 760w,
               /blog/thoughts-to-envoy-from-adn-perspective/slides-3_hu843b0f00406c9fa5d96432a9bd2f19da_81440_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/thoughts-to-envoy-from-adn-perspective/slides-3_hu843b0f00406c9fa5d96432a9bd2f19da_81440_ec95f11ab21e16c4f545a1df5c309b66.webp&#34;
               width=&#34;760&#34;
               height=&#34;447&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      slides3
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;F5 åœ¨æ”¶è´­ NGINX ä¸ Shape ä¹‹åï¼Œæå‡ºäº†æ–°çš„ viewï¼Œå°†å……åˆ†åˆ©ç”¨å¯å¹¿æ³›è§¦è¾¾çš„æ•°æ®å¹³é¢èƒ½åŠ›ï¼Œå€ŸåŠ© AI è¿›ä¸€æ­¥æŒ–æ˜æ•°æ®æ½œèƒ½å¸®åŠ©ç”¨æˆ·æ›´å¥½çš„æŒæ¡å’Œäº†è§£åº”ç”¨è¡Œä¸ºã€æ€§èƒ½ï¼Œä¸ºä¸šåŠ¡è¿è¥æå‡ºå‚è€ƒï¼Œå¹¶åé¦ˆåˆ°ç»„ä»¶é…ç½®ä¸è¿è¡Œç®¡ç†ï¼Œä»è€Œå½¢æˆé—­ç¯ã€‚&lt;/p&gt;
&lt;p&gt;ç°ä»£åº”ç”¨äº¤ä»˜ä¾ç„¶ä¸èƒ½ç¼ºå°‘ä¸€ä¸ªé‡è¦åœºæ™¯ï¼Œé‚£å°±æ˜¯åº”ç”¨å®‰å…¨ï¼Œå°½ç®¡ Istio ç­‰äº§å“åœ¨å®‰å…¨é€šä¿¡ï¼Œèº«ä»½ï¼Œç­–ç•¥æ–¹é¢åšäº†ä¸å°‘çš„å°è¯•ï¼Œä½†æ˜¯åº”ç”¨å®‰å…¨æœ¬èº«åˆ™æ¯”è¾ƒç¼ºä¹ï¼ŒF5 ä½œä¸º WAF å®‰å…¨é¢†åŸŸçš„é¢†å¯¼å‚å•†ï¼Œé€šè¿‡å°†å®‰å…¨èƒ½åŠ›è½¬ç§»åˆ° NGINX ä¸Šå½¢æˆäº†æ–°çš„ NGINX APP Protectï¼Œåˆ©ç”¨å…¶è·¨å¹³å°çš„èƒ½åŠ›å¸®åŠ©ç”¨æˆ·æ›´å¥½çš„ç®¡ç†å¾®æœåŠ¡åœºæ™¯ä¸‹çš„åº”ç”¨å®‰å…¨èƒ½åŠ›ï¼Œå¸®åŠ©ä¼ä¸šæ›´å¥½çš„è½åœ° DevSecOpsã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå°† Envoy çš„é‚£äº›æŠ€æœ¯ç‰¹å¾ä¸ F5 è¿›è¡Œå¯¹æ¯”çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° F5 ä¸€å®šç¨‹åº¦ä¸Šæ¬ ç¼ºåœ¨æ‰©å±•æ€§ä¸ç°ä»£æ€§ä¸Šï¼ŒF5 å…·æœ‰è¾ƒå¥½çš„ç¼–ç¨‹æ§åˆ¶èƒ½åŠ›ï¼Œä½†æ˜¯ç›¸å¯¹äºæ›´å¤§çš„æ’ä»¶å¼€å‘æ¥è¯´æ˜¯ä¸è¶³çš„ï¼Œè¿™å’Œç°ä»£æ€§å¾€å¾€å¯ä»¥è”ç³»åˆ°ä¸€èµ·çœ‹ï¼Œæ¯”å¦‚æƒ³é’ˆå¯¹æŸä¸ªå¾ˆæ–°çš„åè®®åšä¸€ä¸ªç±»ä¼¼ Envoy çš„å¤æ‚ 7 å±‚ filter æ˜¯æ— æ³•å®ç°çš„ï¼Œå°½ç®¡ iRule æˆ–è€… iRuleLX å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šåšä¸€äº›äº‹æƒ…ã€‚ç„¶è€Œæ— è®ºæ€æ ·ï¼Œæœ€ç»ˆ F5 çš„äº§å“å½¢æ€æœ¬èº«å†³å®šäº† F5 çš„ BIGIP æ˜¯æ— æ³•å®Œå…¨è·¨å¹³å°çš„ï¼Œå› ä¸ºå®ƒæ— æ³•ä»¥å®¹å™¨æ¥è¿è¡Œã€‚å€¼å¾—æœŸå¾…çš„æ˜¯ï¼Œè¿™æ ·çš„å½¢æ€é™åˆ¶å°†ä¼šè¢« F5 ä¸‹ä¸€ä»£ TMOS ç³»ç»Ÿæ‰“ç ´ã€‚&lt;/p&gt;
&lt;p&gt;Service Mesh æ˜¯å½“å‰çƒ­é—¨çš„æŠ€æœ¯æ–¹å‘ï¼ŒF5 åŸºäº Istio æ‰“é€ äº†ä¼ä¸šçº§çš„ Aspen Mesh æœåŠ¡ç½‘æ ¼äº§å“ï¼Œå¸®åŠ©ä¼ä¸šæ›´å¥½ã€æ›´å®¹æ˜“çš„éƒ¨ç½²å’Œä½¿ç”¨ Istioã€‚Aspen mesh å›¢é˜Ÿæˆå‘˜è¿›å…¥ä»…æœ‰ 7 ä¸ªä½ç½®çš„çš„ Istio Technical Oversight Committeeï¼Œè´Ÿè´£ Istio çš„ RFCs/Designs/APIs ç­‰æ–¹é¢çš„é‡è¦èŒè´£ã€‚å°½ç®¡ Istio åœ¨ service mesh é¢†åŸŸæ‹¥æœ‰ç»å¯¹çš„ç”Ÿæ€ä¸çƒ­åº¦ï¼Œä½†è¿™å¹¶ä¸è¡¨ç¤º Istio æ˜¯å”¯ä¸€çš„é€‰æ‹©ï¼Œåœ¨å¾ˆå¤šæ—¶å€™å®¢æˆ·å¯èƒ½å¸Œæœ›é‡‡ç”¨ä¸€ç§æ›´åŠ ç®€æ´çš„ Service Mesh å»å®ç°å¤§éƒ¨åˆ†æ‰€éœ€åŠŸèƒ½è€Œä¸æ˜¯å»éƒ¨ç½²ä¸€æ•´å¥—å¤æ‚çš„ Istio æ–¹æ¡ˆï¼ŒåŸºäº NGINX ç»„ä»¶æ‰“é€ çš„ NGINX Service Mesh (NSM) å°†ä¸ºç”¨æˆ·å¸¦æ¥æ–°çš„é€‰æ‹©ï¼Œä¸€ä¸ªæ›´åŠ ç®€å•æ˜“ç”¨çš„ Service Mesh äº§å“ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨æ–‡ç« æœ€å¼€å§‹æåˆ° NGINX ç»ˆæ­¢ Nginmesh çš„åŸå› ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æŠ€æœ¯å‘å±•æ˜¯ä¸€ä¸ªå¿…ç„¶çš„è¿‡ç¨‹ï¼Œ2006 å¹´ä»ä¼ ç»Ÿçš„è´Ÿè½½å‡è¡¡æŠ€æœ¯æ¼”å˜ä¸ºåº”ç”¨äº¤ä»˜ï¼Œé™¤äº†è´Ÿè½½å‡è¡¡ä¹‹å¤–ï¼Œå¼•å…¥å®‰å…¨ã€è®¿é—®æ§åˆ¶ã€æ¥å…¥æ§åˆ¶ã€æµé‡æ§åˆ¶ç­‰è¯¸å¤šæ–¹é¢ã€‚2016 å¹´å·¦å³ï¼Œè¿™ä¸ªé¢†åŸŸå†æ¬¡å‘ç”Ÿæ–°çš„æŠ€æœ¯å˜é©ï¼Œå¤§é‡æ–°ç”Ÿä»£åå‘ä»£ç†å¼€æºè½¯ä»¶çš„å‡ºç°å¯¹ä¼ ç»Ÿåº”ç”¨äº¤ä»˜ç±»äº§å“äº§ç”Ÿäº†ä¸€æ¬¡æ–°çš„å†²å‡»ï¼Œç§¯æé€‚åº”ä¸æ”¹å˜å¹¶åˆ›æ–°æ˜¯åˆ¶èƒœçš„å…³é”®ã€‚Envoy ä½œä¸ºæ–°ä»£è¡¨æœ‰ç€ä¼˜ç§€çš„èƒ½åŠ›ï¼Œä½†å®ƒä¹Ÿä¸æ˜¯è§£å†³æ‰€æœ‰é—®é¢˜çš„é“¶å¼¹ï¼ŒEnvoy æ‹¥æœ‰æ›´é™¡å³­çš„å­¦ä¹ æ›²çº¿ä»¥åŠæ›´é«˜å¼€å‘æˆæœ¬ä¸ç»´æŠ¤æˆæœ¬ï¼Œå¯¹äºä¼ä¸šæ¥è¯´åº”æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©åˆé€‚çš„è§£å†³æ–¹æ¡ˆä¸äº§å“æ¥è§£å†³æ¶æ„ä¸­çš„ä¸åŒé—®é¢˜ï¼Œé¿å…è¿½èµ¶æ½®æµè€Œè®©è‡ªå·±é™·å…¥é™·é˜±ã€‚&lt;/p&gt;
&lt;p&gt;F5 åˆ™æ›´åŠ éœ€è¦è®©å¼€å‘äººå‘˜äº†è§£ TMOS ç³»ç»Ÿæ‰€æ‹¥æœ‰çš„å·¨å¤§æ½œèƒ½ï¼ˆç‰¹åˆ«æ˜¯ä¸‹ä¸€ä»£äº§å“åœ¨æ¶æ„ä»¥åŠå½¢æ€ä¸Šçš„é¢ è¦†ï¼‰ï¼Œäº†è§£å…¶ä¼˜ç§€å…¨ä»£ç†æ¶æ„ä»¥åŠå¯ä»¥åœ¨ä»»æ„å±‚é¢è¿›è¡Œçš„ç¼–ç¨‹æ§åˆ¶ï¼Œè®©å¼€å‘è€…ã€SRE ä»¥ F5 TMOS ä½œä¸ºä¸€ç§èƒ½åŠ›å¹³å°å’Œä¸­é—´ä»¶è¿›è¡Œå¼€å‘ï¼Œæ›´å¥½çš„åˆ©ç”¨ F5 è‡ªèº«å·²ç»æ‹¥æœ‰çš„åº”ç”¨äº¤ä»˜èƒ½åŠ›æ¥å¿«é€Ÿå®ç°è‡ªèº«éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œå†æ¬¡å¼•ç”¨ Envoy å®˜æ–¹ç½‘ç«™é¦–é¡µçš„ä¸€å¥è¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ­£å¦‚å¾®æœåŠ¡ä»ä¸šè€…å¾ˆå¿«æ„è¯†åˆ°çš„é‚£æ ·ï¼Œå½“è½¬ç§»åˆ°åˆ†å¸ƒå¼ä½“ç³»ç»“æ„æ—¶å‡ºç°çš„å¤§å¤šæ•°æ“ä½œé—®é¢˜æœ€ç»ˆéƒ½åŸºäºä¸¤ä¸ªæ–¹é¢ï¼šç½‘ç»œå’Œå¯è§‚å¯Ÿæ€§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è€Œä¿è¯æ›´å¯é çš„ç½‘ç»œäº¤ä»˜ä¸æ›´å¥½çš„å¯è§‚å¯Ÿæ€§æ­£æ˜¯å‰æµªä»¬çš„å¼ºé¡¹ã€‚åˆ›æ–°å§ï¼Œå‰æµªã€‚&lt;/p&gt;
&lt;p&gt;å†™åœ¨æœ€åï¼š
æ— è®ºæŠ€æœ¯å¦‚ä½•æ›´è¿­ï¼Œäººçš„å› ç´ ä¾æ—§æ˜¯æ ¸å¿ƒï¼Œä¸è®ºä¼ä¸šè‡ªèº«è¿˜æ˜¯å‚å•†ï¼Œåœ¨è¿™æ ·ä¸€è½®æŠ€æœ¯æµªæ½®ä¸­éƒ½åº”å…·å¤‡è¶³å¤Ÿçš„æŠ€æœ¯å‚¨å¤‡ï¼Œå°±åƒä¼ ç»Ÿé‡‘èè¡Œä¸šé€šè¿‡å»ºç«‹ç§‘æŠ€å…¬å¸å¯»æ±‚è½¬å˜ä¸€æ ·ï¼Œå‚å•†åŒæ ·éœ€è¦è½¬å‹ï¼ŒF5 ä¸­å›½çš„ SE å‡ ä¹ 100% çš„é€šè¿‡äº† CKA è®¤è¯ï¼Œæ— è®ºç›¸å¯¹æ¯”ä¾‹è¿˜æ˜¯ç»å¯¹æ•°é‡åœ¨ä¸šç•Œåº”è¯¥æ˜¯æƒŸä¸€äº†ï¼Œè½¬å‹ä¸åªåœ¨äº§å“ï¼Œæ›´åœ¨äºæ€æƒ³ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio è¿›é˜¶å­¦ä¹ ç³»åˆ— - åŸºäº WebAssembly å®ç° Envoy ä¸ Istio çš„åŠŸèƒ½æ‰©å±•</title>
      <link>https://cloudnative.to/blog/envoy-wasm/</link>
      <pubDate>Fri, 12 Jun 2020 12:00:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-wasm/</guid>
      <description>&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;Istio ä»å‘å¸ƒå¼€å§‹å°±ä½¿ç”¨ Envoy ä½œä¸ºè‡ªå·±çš„æ•°æ®å¹³é¢ï¼Œå……åˆ†åˆ©ç”¨äº† Envoy æä¾›çš„æœåŠ¡å‘ç°ã€è·¯ç”±ã€ç†”æ–­ã€è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ã€‚ä¸æ­¤åŒæ—¶ï¼ŒIstio é¡¹ç›®ä¹Ÿä¸€ç›´è‡´åŠ›äºæä¾›ä¸€ä¸ªä¾¿äºçµæ´»æ‰©å±•çš„å¹³å°ï¼Œä»¥æ»¡è¶³ç”¨æˆ·å¤šæ ·åŒ–çš„éœ€æ±‚ã€‚åœ¨è¿‡å»çš„ä¸€å¹´åŠä¸­ï¼ŒGoogle çš„å›¢é˜Ÿä¸€ç›´åœ¨åŠªåŠ›ç”¨ WebAssembly æŠ€æœ¯ä¸º Envoy ä»£ç†æ·»åŠ åŠ¨æ€æ‰©å±•ï¼Œå¹¶æ¨å‡ºäº†é’ˆå¯¹ Envoy ä»£ç†çš„ WebAssembly (ä»¥ä¸‹ç®€ç§°ä¸º WASM) æ‰©å±•æœºåˆ¶ï¼ŒåŒ…æ‹¬æ ‡å‡†åŒ–çš„ ABIï¼ŒSDKï¼Œä»¥åŠè¯¥æ‰©å±•æœºåˆ¶çš„ç¬¬ä¸€ä¸ªé‡ç‚¹å®ç°ï¼šå…¨æ–°çš„ã€ä½å»¶è¿Ÿçš„ Istio é¥æµ‹ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦å¯¹ Envoy å’Œ WebAssembly æŠ€æœ¯è¿›è¡Œä»‹ç»ï¼Œå¹¶ä½¿ç”¨ solo.io å›¢é˜Ÿæ¨å‡ºçš„ wasme å·¥å…·å®Œæˆ WASM filter çš„æ„å»ºã€å‘å¸ƒå’Œéƒ¨ç½²ï¼Œæ–¹ä¾¿è¯»è€…äº†è§£ Envoy WASM Filter çš„æ‰©å±•æ–¹å¼åŠå…¶å®ç°åŸç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-çš„è¿‡æ»¤å™¨æœºåˆ¶&#34;&gt;Envoy çš„è¿‡æ»¤å™¨æœºåˆ¶&lt;/h2&gt;
&lt;p&gt;Envoy æ˜¯ Istio ä¸­çš„ Sidecar å®˜æ–¹æ ‡é…ï¼Œæ˜¯ä¸€ä¸ªé¢å‘æœåŠ¡æ¶æ„çš„é«˜æ€§èƒ½ç½‘ç»œä»£ç†ï¼Œç”± C++ è¯­è¨€å®ç°ï¼Œæ‹¥æœ‰å¼ºå¤§çš„å®šåˆ¶åŒ–èƒ½åŠ›ã€‚Envoy æä¾›äº†è¿›ç¨‹å¤–æ¶æ„ã€æ”¯æŒ L3/L4 filterã€HTTP L7 filterã€æœåŠ¡å‘ç°å’ŒåŠ¨æ€é…ç½®ã€å¥åº·æ£€æŸ¥ç­‰é«˜çº§åŠŸèƒ½ã€‚è¿™é‡Œæˆ‘ä»¬é‡ç‚¹ä»‹ç»ä¸€ä¸‹ Envoy æµé‡å¤„ç†è¿‡ç¨‹ä¸­çš„ filter æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¿‡æ»¤å™¨æœºåˆ¶&#34;&gt;è¿‡æ»¤å™¨æœºåˆ¶&lt;/h3&gt;
&lt;p&gt;Envoy æ˜¯é¢å‘æœåŠ¡æ¶æ„è®¾è®¡çš„ L7 ä»£ç†å’Œé€šä¿¡æ€»çº¿ï¼Œæ ¸å¿ƒæ˜¯ä¸€ä¸ª L3/L4 ç½‘ç»œä»£ç†ã€‚å¯æ’å…¥ filter é“¾æœºåˆ¶å…è®¸å¼€å‘äººå‘˜ç¼–å†™ filter æ¥æ‰§è¡Œä¸åŒçš„ TCP ä»£ç†ä»»åŠ¡å¹¶å°†å…¶æ’å…¥åˆ°ä¸»ä½“æœåŠ¡ä¸­ã€‚Envoy è¿˜æ”¯æŒé¢å¤–çš„ HTTP L7 filter å±‚ã€‚å¯ä»¥å°† HTTP filter æ’å…¥æ‰§è¡Œä¸åŒä»»åŠ¡çš„ HTTP è¿æ¥ç®¡ç†å­ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-wasm/envoy-wasm-1_hu46d0a70461f2a22811b2f7328fb4b6e0_22118_dcf5d2d68e92da763d0199ffc47c5cd2.webp 400w,
               /blog/envoy-wasm/envoy-wasm-1_hu46d0a70461f2a22811b2f7328fb4b6e0_22118_d8f9cfa9a05a5341bf6b4b1f1052a395.webp 760w,
               /blog/envoy-wasm/envoy-wasm-1_hu46d0a70461f2a22811b2f7328fb4b6e0_22118_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-wasm/envoy-wasm-1_hu46d0a70461f2a22811b2f7328fb4b6e0_22118_dcf5d2d68e92da763d0199ffc47c5cd2.webp&#34;
               width=&#34;760&#34;
               height=&#34;133&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç›®å‰ï¼ŒEnvoy æä¾›çš„è¿‡æ»¤å™¨åŒ…æ‹¬ä¾¦å¬å™¨è¿‡æ»¤å™¨ï¼ˆListener Filtersï¼‰ã€ç½‘ç»œè¿‡æ»¤å™¨ï¼ˆNetwork Filtersï¼‰ã€HTTP è¿‡æ»¤å™¨ï¼ˆHTTP Filtersï¼‰ä¸‰ç§ç±»å‹ï¼Œå®ƒä»¬å…±åŒç»„æˆäº†ä¸€ä¸ªå±‚æ¬¡åŒ–çš„è¿‡æ»¤å™¨é“¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1ã€ä¾¦å¬å™¨è¿‡æ»¤å™¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¾¦å¬å™¨è¿‡æ»¤å™¨åœ¨åˆå§‹è¿æ¥é˜¶æ®µè®¿é—®åŸå§‹æ•°æ®å¹¶æ“ä½œ L4 è¿æ¥çš„å…ƒæ•°æ®ã€‚ä¾‹å¦‚ï¼ŒTLS æ£€æŸ¥å™¨è¿‡æ»¤å™¨ï¼ˆTLS Inspector Filterï¼‰æ ‡è¯†è¿æ¥æ˜¯å¦ç»è¿‡ TLS åŠ å¯†ï¼Œå¹¶è§£æä¸è¯¥è¿æ¥å…³è”çš„ TLS å…ƒæ•°æ®ï¼ˆSNI æˆ– ALPN åå•†çš„åè®®ç±»å‹ï¼‰ï¼›HTTP Inspector Filter æ£€æµ‹åº”ç”¨åè®®æ˜¯å¦æ˜¯ HTTPï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå†è¿›ä¸€æ­¥æ£€æµ‹ HTTP åè®®ç±»å‹ (HTTP/1.x or HTTP/2) ï¼Œè¿™ä¸¤ç§è¿‡æ»¤å™¨è§£æåˆ°çš„å…ƒæ•°æ®éƒ½å¯ä»¥å’Œ FilterChainMatch ç»“åˆä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2ã€ç½‘ç»œè¿‡æ»¤å™¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç½‘ç»œè¿‡æ»¤å™¨è®¿é—®å’Œæ“ä½œ L4 è¿æ¥ä¸Šçš„åŸå§‹æ•°æ®ï¼Œå³ TCP æ•°æ®åŒ…ã€‚ä¾‹å¦‚ï¼ŒTCP ä»£ç†è¿‡æ»¤å™¨ï¼ˆTCP Proxy Filterï¼‰å°†å®¢æˆ·ç«¯è¿æ¥æ•°æ®è·¯ç”±åˆ°ä¸Šæ¸¸ä¸»æœºï¼Œå®ƒè¿˜å¯ä»¥ç”Ÿæˆè¿æ¥ç»Ÿè®¡æ•°æ®ã€‚æ­¤å¤–ï¼ŒMySQL proxyã€Redis proxyã€Dubbo proxyã€Thrift proxy ç­‰éƒ½å±äºç½‘ç»œè¿‡æ»¤å™¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3ã€HTTP è¿‡æ»¤å™¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;HTTP è¿‡æ»¤å™¨åœ¨ L7 ä¸Šè¿è¡Œï¼Œç”±ç½‘ç»œè¿‡æ»¤å™¨ï¼ˆå³ HTTP è¿æ¥ç®¡ç†å™¨ï¼ŒHTTP Connection Managerï¼‰åˆ›å»ºã€‚è¿™äº›è¿‡æ»¤å™¨ç”¨äºè®¿é—®ã€æ“ä½œ HTTP è¯·æ±‚å’Œå“åº”ï¼Œä¾‹å¦‚ï¼ŒgRPC-JSON è½¬ç å™¨è¿‡æ»¤å™¨ï¼ˆgRPC-JSON Transcoder Filterï¼‰å¯ä»¥ä¸º gRPC åç«¯æä¾›ä¸€ä¸ª REST APIï¼Œå¹¶å°†è¯·æ±‚å’Œå“åº”è½¬æ¢ä¸ºç›¸åº”çš„æ ¼å¼ã€‚æ­¤å¤–ï¼Œè¿˜åŒ…æ‹¬  JWTã€Routerã€RBAC ç­‰å¤šç§è¿‡æ»¤å™¨ã€‚&lt;/p&gt;
&lt;p&gt;æ•´ä½“æ¥çœ‹ï¼ŒEnvoy çš„è¿‡æ»¤å™¨æœºåˆ¶ä¸ºç”¨æˆ·æä¾›äº†å¾ˆå¤šå¥½å¤„ï¼Œæ¯”å¦‚ï¼šç”¨æˆ·å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸­é—´å±‚ï¼Œä»¥ä¾¿åœ¨ä¸ä¸å…¼å®¹çš„æœåŠ¡å™¨é€šä¿¡æ—¶ä¼˜é›…åœ°å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼›ä»£ç†å¯ä»¥æ‰§è¡Œåè®®è½¬æ¢ï¼Œå…è®¸ä¸åŒçš„åè®®äº’æ“ä½œï¼›ä»£ç†å¯ä»¥é€šè¿‡è¿‡æ»¤å™¨åšå‡ºæ™ºèƒ½è·¯ç”±å†³ç­–ç­‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ‰©å±•æ–¹å¼&#34;&gt;æ‰©å±•æ–¹å¼&lt;/h3&gt;
&lt;p&gt;ç°æœ‰çš„ Filter å¯èƒ½æ— æ³•æ»¡è¶³ç”¨æˆ·çš„ä½¿ç”¨éœ€æ±‚ï¼Œè¿™æ—¶å€™å°±éœ€è¦å¯¹ Envoy è¿›è¡ŒåŠŸèƒ½æ‰©å±•ï¼Œé€šè¿‡åœ¨ç°æœ‰çš„è¿‡æ»¤é“¾åŸºç¡€ä¸Šè‡ªå®šä¹‰æ–°çš„ filterï¼Œå®ç°å®šåˆ¶åŒ–éœ€æ±‚ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼å¯¹ Envoy è¿›è¡Œæ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1ã€ç¼–å†™ C++ ä»£ç æ‰©å±• Envoy&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹å¼ç›´æ¥åœ¨ Envoy åŸºç¡€ä¸Šç¼–å†™ C++ ä»£ç è¿›è¡ŒåŠŸèƒ½å¢å¼ºï¼Œå®ç°è‡ªå®šä¹‰çš„ filter ä¹‹åï¼Œé‡æ–°ç¼–è¯‘æ–°çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®Œæˆç°æœ‰ä¸šåŠ¡çš„å‡çº§æ›¿æ¢ã€‚è¿™ç§æ–¹å¼æœ‰ä»¥ä¸‹ä¸¤æ–¹é¢é—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;å—è¯­è¨€é™åˆ¶ï¼Œåªèƒ½ä½¿ç”¨ C++ è¿›è¡Œæ‰©å±•ï¼Œä¸åˆ©äºç”Ÿæ€å‘å±•ï¼›
æé«˜äº†éƒ¨ç½²ã€è¿ç»´ã€å‡çº§çš„å¤æ‚æ€§ï¼ŒEnvoy å°†ä¼šå˜å¾—è¶Šæ¥è¶Šé‡ï¼Œå¹¶ä¸”æ¯æ¬¡æ›´æ”¹éƒ½éœ€è¦é‡æ–°ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸åˆ©äºæŠ€æœ¯è¿­ä»£å’Œç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2ã€ä½¿ç”¨ lua è„šæœ¬æ‰©å±• filter&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Lua æ˜¯ä¸€ç§è½»é‡å°å·§çš„è„šæœ¬è¯­è¨€ï¼Œç”¨æ ‡å‡† C è¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€æ”¾ï¼Œå…¶è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚HTTP Lua Filter å…è®¸åœ¨è¯·æ±‚å’Œå“åº”æµç¨‹ä¸­è¿è¡Œ Lua è„šæœ¬ï¼Œåœ¨è¿è¡Œæ—¶ä½¿ç”¨ LuaJITã€‚è¯¥è¿‡æ»¤å™¨ä»…æ”¯æŒåœ¨é…ç½®ä¸­ç›´æ¥åŠ è½½ Lua ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰æ”¯æŒçš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼šå¯¹ä¼ è¾“çš„è¯·æ±‚æˆ–å“åº”æµï¼Œæä¾›å¤´éƒ¨ã€æ­£æ–‡å’Œå°¾éƒ¨çš„æ£€æŸ¥ï¼›å¯¹å¤´éƒ¨å’Œå°¾éƒ¨è¿›è¡Œä¿®æ”¹ï¼›å¯¹ä¸Šæ¸¸ä¸»æœºæ‰§è¡Œå¼‚æ­¥ HTTP è°ƒç”¨ï¼›ç›´æ¥æ‰§è¡Œå“åº”å¹¶è·³è¿‡åç»­çš„è¿‡æ»¤å™¨ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼ŒHTTP Lua Filter æ˜¯å®éªŒæ€§çš„ï¼Œåœ¨ç”Ÿäº§ä¸­ä½¿ç”¨éœ€è¦è‡ªæ‹…é£é™©ã€‚è‹¥å­˜åœ¨éå¸¸å¤æ‚æˆ–æ›´é«˜æ€§èƒ½çš„åœºæ™¯ï¼Œå»ºè®®ä½¿ç”¨æœ¬åœ° C++ è¿‡æ»¤å™¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3ã€ä½¿ç”¨ WASM æ‰©å±• envoy&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æä¾›æ›´åŠ æ–¹ä¾¿ã€æ›´åŠ çµæ´»çš„æ‰©å±•æ–¹å¼ï¼ŒGoogle å›¢é˜Ÿè®¡åˆ’ç”¨ WebAssembly ä¸º Envoy ä»£ç†æ·»åŠ åŠ¨æ€æ‰©å±•ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨è‡ªå·±æ“…é•¿çš„ç¼–ç¨‹è¯­è¨€ç¼–å†™ filterï¼Œå¹¶ä½¿ç”¨å·¥å…·ç¼–è¯‘æˆ wasm æ ¼å¼ï¼ŒåµŒå…¥åˆ° Envoy ä¸­è¿è¡Œå³å¯ã€‚ç›®å‰ï¼ŒGoogle ä¹Ÿä¸ç¤¾åŒºç´§å¯†åˆä½œï¼Œä»¥ç¡®ä¿ä¸ºç”¨æˆ·æä¾›è‰¯å¥½çš„å¼€å‘è€…ä½“éªŒï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿä¸Šæ‰‹ã€‚Google å›¢é˜Ÿä¹Ÿä¸€ç›´ä¸ Solo.io å›¢é˜Ÿç´§å¯†åˆä½œï¼ŒSolo å›¢é˜Ÿå·²ç»å»ºç«‹äº† WebAssembly Hub æœåŠ¡ï¼Œç”¨äºæ„å»ºï¼Œå…±äº«ï¼Œå‘ç°å’Œéƒ¨ç½² WASM æ‰©å±•ã€‚æœ‰äº† WebAssembly Hubï¼ŒWASM æ‰©å±•å°±ä¼šåƒå®¹å™¨ä¸€æ ·æ˜“äºç®¡ç†ï¼Œå®‰è£…å’Œè¿è¡Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;wasm-æ¦‚è¿°&#34;&gt;WASM æ¦‚è¿°&lt;/h2&gt;
&lt;h3 id=&#34;ä»‹ç»&#34;&gt;ä»‹ç»&lt;/h3&gt;
&lt;p&gt;WebAssemblyï¼ˆWASMï¼‰æ˜¯ä¸€ç§ç”±å¤šç§è¯­è¨€ç¼–å†™çš„ï¼Œå¯ç§»æ¤çš„å­—èŠ‚ç æ ¼å¼ï¼Œå®ƒèƒ½ä»¥æ¥è¿‘æœ¬æœºçš„é€Ÿåº¦æ‰§è¡Œã€‚ä½œä¸ºä¸€ç§å¯ç§»æ¤ã€ä½“ç§¯å°ã€åŠ è½½å¿«å¹¶ä¸”å…¼å®¹ Web çš„å…¨æ–°æ ¼å¼ï¼Œwasm å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é«˜æ•ˆï¼šWASM æœ‰ä¸€å¥—å®Œæ•´çš„è¯­ä¹‰ï¼Œå®é™…ä¸Š WASM æ˜¯ä½“ç§¯å°ä¸”åŠ è½½å¿«çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œå…¶ç›®æ ‡å°±æ˜¯å……åˆ†å‘æŒ¥ç¡¬ä»¶èƒ½åŠ›ä»¥è¾¾åˆ°åŸç”Ÿæ‰§è¡Œæ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;å®‰å…¨ï¼šWASM è¿è¡Œåœ¨ä¸€ä¸ªæ²™ç®±åŒ–çš„æ‰§è¡Œç¯å¢ƒä¸­ï¼Œç”šè‡³å¯ä»¥åœ¨ç°æœ‰çš„ JavaScript è™šæ‹Ÿæœºä¸­å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;å¼€æ”¾ï¼šWASM è®¾è®¡äº†ä¸€ä¸ªéå¸¸è§„æ•´çš„æ–‡æœ¬æ ¼å¼ï¼Œç”¨äºè°ƒè¯•ã€æµ‹è¯•ã€å®éªŒã€ä¼˜åŒ–ã€å­¦ä¹ ã€æ•™å­¦æˆ–è€…ç¼–å†™ç¨‹åºã€‚&lt;/li&gt;
&lt;li&gt;æ ‡å‡†ï¼šWASM åœ¨ web ä¸­è¢«è®¾è®¡æˆæ— ç‰ˆæœ¬ã€ç‰¹æ€§å¯æµ‹è¯•ã€å‘åå…¼å®¹çš„ç‰¹ç‚¹ã€‚WASM ä¸ä»…å¯ä»¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥è¿è¡Œåœ¨é web ç¯å¢ƒä¸‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒWASM æ˜¯ä¸€ä¸ªç¼–è¯‘ç›®æ ‡ï¼Œä¸æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ã€‚WebAssembly æ˜¯ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘ä¹‹åçš„ç›®æ ‡æ ¼å¼ï¼Œä½“ç§¯å°ã€èµ·æ­¥å¿«ã€‚åœ¨è¯­æ³•ä¸Šå®Œå…¨è„±ç¦» JavaScriptï¼ŒåŒæ—¶å…·æœ‰æ²™ç›’åŒ–çš„æ‰§è¡Œç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡ WASM æœ€åˆæ˜¯ä½œä¸ºå®¢æˆ·ç«¯æŠ€æœ¯è¯ç”Ÿçš„ï¼Œä½†å®ƒåº”ç”¨äºæœåŠ¡å™¨ç«¯æ—¶ä¹Ÿæœ‰å¾ˆå¤šä¼˜åŠ¿ã€‚æ¯”å¦‚è¿è¡Œæ—¶æ˜¯å†…å­˜å®‰å…¨çš„ï¼Œå¹¶ä¸”ä»¥æ²™ç›’æ–¹å¼è¿è¡Œä»¥ç¡®ä¿å…¶å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å·¥å…·é“¾&#34;&gt;å·¥å…·é“¾&lt;/h3&gt;
&lt;p&gt;è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ WASM ç¼–è¯‘ç›¸å…³çš„å·¥å…·é“¾ã€‚ä¼ ç»Ÿçš„ç¼–è¯‘å™¨è®¾è®¡éƒ½æ˜¯ä¸‰æ­¥å¼çš„ï¼šFrontend(å‰ç«¯)ï¼ŒOptimizerï¼ˆä¼˜åŒ–å™¨ï¼‰ï¼ŒBackend(åç«¯)ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Frontendï¼šæºä»£ç è§£æï¼Œé”™è¯¯æ£€æŸ¥ï¼Œç„¶åæ„å»ºä¸€ä¸ªè¯­è¨€ç›¸å…³çš„æŠ½è±¡è¯­æ³•æ ‘ (AST) æ¥è¡¨ç¤ºè¾“å…¥çš„ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;Optimizerï¼šä¼˜åŒ–å™¨ä¼šåšå¾ˆå¤šçš„è½¬æ¢æ¥å‡å°‘ä»£ç çš„è¿è¡Œæ—¶é—´ï¼Œæ¯”å¦‚è¯´å‡å°‘å†—ä½™çš„è®¡ç®—ã€‚&lt;/li&gt;
&lt;li&gt;Backendï¼šå°†ä¼˜åŒ–åçš„ä»£ç æ˜ å°„åˆ°ç›®æ ‡æŒ‡ä»¤é›†ï¼Œä¹Ÿå¯ä»¥è¢«ç§°ä¸ºä»£ç ç”Ÿæˆå™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è€Œåœ¨ä¸€ä¸ªåŸºäº LLVM çš„ç¼–è¯‘å™¨ä¸­ï¼Œä¸€ä¸ª Frontend çš„ä»»åŠ¡æ˜¯å¯¹æºä»£ç è¿›è¡Œè§£æã€é”™è¯¯è¯Šæ–­ï¼Œç„¶åå°†è§£æåçš„çš„ä»£ç è½¬æ¢ä¸º LLVM IRï¼ˆIntermediate Representationï¼‰ï¼ŒIR ä¼šç»è¿‡ä¸€ç³»åˆ—çš„åˆ†æå’Œä¼˜åŒ–ä»¥ä¾¿æé«˜ä»£ç æ€§èƒ½ï¼Œæœ€ååŸºäºä¼˜åŒ–åçš„ä»£ç ç”Ÿæˆç›¸åº”çš„æœºå™¨ä»£ç ã€‚è¿™ç§æ–¹å¼ååˆ†çµæ´»ï¼Œå½“æ‰©å±•ç¼–ç¨‹è¯­è¨€æˆ–ç¡¬ä»¶ç±»å‹æ—¶ï¼Œæ·»åŠ å¯¹åº”çš„å‰ç«¯æˆ–åç«¯å³å¯ï¼Œä¼˜åŒ–é˜¶æ®µåˆ™æˆä¸ºäº†ä¸€ä¸ªé€šç”¨çš„é˜¶æ®µã€‚&lt;/p&gt;
&lt;p&gt;Emscripten çš„åº•å±‚å°±æ˜¯ LLVM ç¼–è¯‘å™¨ï¼Œå¯ä»¥å°† LLVM å­—èŠ‚ç ç¼–è¯‘æˆ JavaScriptï¼Œè¿˜æ”¯æŒ WebAssembly è¿™ä¸€æ›´åŠ å…ˆè¿›çš„ Web æŠ€æœ¯ï¼Œå¯ä»¥ç”Ÿæˆ WASM å­—èŠ‚ç æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;wasm-ä¸-envoy-å’Œ-istio&#34;&gt;WASM ä¸ Envoy å’Œ Istio&lt;/h2&gt;
&lt;h3 id=&#34;istio-å¼•å…¥-webassembly&#34;&gt;Istio å¼•å…¥ WebAssembly&lt;/h3&gt;
&lt;p&gt;è¯¥ç‰¹æ€§åœ¨ Istio 1.5 è‡ªå¸¦çš„ Envoy ä¸­ä»¥ Alpha ç‰ˆæœ¬æ¨å‡ºï¼Œå…¶æºä»£ç åœ¨ envoy-wasm å¼€å‘åˆ†æ”¯ä¸­ï¼Œå¹¶ä¸”æ­£åœ¨åŠªåŠ›å°†å…¶åˆå¹¶åˆ° Envoy ä¸»å¹²ä¸Šã€‚è¯¥å®ç°ä½¿ç”¨äº† Google é«˜æ€§èƒ½ V8 å¼•æ“ ä¸­å†…ç½®çš„ WebAssembly è¿è¡Œæ—¶ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†æ„å»ºåº•å±‚çš„è¿è¡Œæ—¶ï¼ŒGoogle å›¢é˜Ÿè¿˜å¼€å±•äº†ä»¥ä¸‹å…³é”®å·¥ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ¶å®š Wasm åµŒå…¥ä»£ç†çš„é€šç”¨åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆABIï¼‰ï¼Œè¿™æ„å‘³ç€ç¼–è¯‘åçš„æ‰©å±•å°†å¯ä»¥åœ¨ä¸åŒç‰ˆæœ¬çš„ Envoy ä¸­å·¥ä½œï¼Œç”šè‡³å…¶å®ƒä»£ç†ä¹Ÿå¯ä»¥ï¼Œå‰ææ˜¯å…¶å®ƒä»£ç†å®ç°äº† ABI&lt;/li&gt;
&lt;li&gt;ç”¨ C++, Rust å’Œ AssemblyScript å¯ä»¥æ–¹ä¾¿è¿›è¡Œæ‰©å±•å¼€å‘çš„ SDKï¼Œåç»­è¿˜ä¼šæ”¯æŒæ›´å¤šç±»å‹çš„ç¼–ç¨‹è¯­è¨€&lt;/li&gt;
&lt;li&gt;å…¨é¢çš„ç¤ºä¾‹å’Œè¯´æ˜ï¼Œä»‹ç»å¦‚ä½•åœ¨ Istio å’Œç‹¬ç«‹çš„ Envoy ä¸­éƒ¨ç½²&lt;/li&gt;
&lt;li&gt;å…è®¸ä½¿ç”¨å…¶å®ƒ WASM è¿è¡Œæ—¶çš„æŠ½è±¡ï¼ŒåŒ…æ‹¬æŠŠæ‰©å±•ç›´æ¥ç¼–è¯‘è¿› Envoy ä¸­â€œnullâ€è¿è¡Œæ—¶ï¼Œè¿™å¯¹äºæµ‹è¯•å’Œè°ƒè¯•éå¸¸æœ‰ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨ WASM æ‰©å±• Envoy å¸¦æ¥äº†å¾ˆå¤šå¥½å¤„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•æ·æ€§ï¼šå¯ä»¥ç”¨ Istio æ§åˆ¶å¹³é¢åœ¨è¿è¡Œæ—¶ä¸‹å‘å’Œé‡è½½æ‰©å±•ï¼Œè¿™å°±å¯ä»¥å¿«é€Ÿçš„è¿›è¡Œå¼€å‘ã€æµ‹è¯•ã€å‘å¸ƒï¼Œè€Œæ— éœ€é‡å¯ Envoyã€‚&lt;/li&gt;
&lt;li&gt;å¯é æ€§å’Œéš”ç¦»æ€§ï¼šæ‰©å±•æ¨¡å—éƒ¨ç½²åœ¨å…·æœ‰èµ„æºé™åˆ¶çš„æ²™ç®±ä¸­ï¼Œè¿™æ„å‘³ç€è™½ç„¶è¯¥æ¨¡å—å¯èƒ½å´©æºƒæˆ–æ³„æ¼å†…å­˜ï¼Œä½†ä¸ä¼šè®©æ•´ä¸ª Envoy æŒ‚æ‰ã€‚&lt;/li&gt;
&lt;li&gt;çµæ´»æ€§ï¼šå¯ä»¥å°†å¤šç§ç¼–ç¨‹è¯­è¨€ç¼–è¯‘ä¸º WASMï¼Œè®©å„ç§æŠ€æœ¯èƒŒæ™¯çš„å¼€å‘äººå‘˜éƒ½å¯ä»¥é€‰æ‹©è‡ªå·±çš„è¯­è¨€æ¥ç¼–å†™ Envoy æ‰©å±•ï¼Œæ¯”å¦‚ï¼šC++ï¼ŒGoï¼ŒRustï¼ŒJavaï¼ŒTypeScript ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;wasme-å®è·µ&#34;&gt;WASME å®è·µ&lt;/h3&gt;
&lt;p&gt;Solo.io å›¢é˜Ÿå‘å¸ƒäº† WebAssembly Hubï¼Œè¿™æ˜¯ä¸€å¥—ä¸º Envoy å’Œ Istio å‡†å¤‡çš„ï¼Œç”¨äºæ„å»ºã€éƒ¨ç½²ã€å…±äº«å’Œå‘ç° Envoy Proxy WASM æ‰©å±•çš„å·¥å…·å’Œä»“åº“ã€‚&lt;/p&gt;
&lt;p&gt;WebAssembly Hub å°†å¼€å‘å’Œéƒ¨ç½² Wasm æ‰©å±•æ‰€éœ€çš„è®¸å¤šæ­¥éª¤éƒ½è‡ªåŠ¨åŒ–äº†ã€‚ä½¿ç”¨ WebAssembly Hub æä¾›çš„å·¥å…·ï¼Œç”¨æˆ·å¯ä»¥è½»æ¾åœ°æŠŠä»»ä½•å—æ”¯æŒè¯­è¨€å¼€å‘çš„ä»£ç ç¼–è¯‘ä¸º WASM æ‰©å±•ï¼Œå¹¶å°†è¿™äº›æ‰©å±•ä¸Šä¼ åˆ° Hub ä»“åº“ï¼Œä½¿ç”¨å•ä¸ªå‘½ä»¤å°±å°†å…¶åœ¨ Istio ä¸­éƒ¨ç½²å’Œåˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;WebAssembly Hub å·¥å…·æä¾›äº†åŠŸèƒ½å¼ºå¤§çš„ CLI å’Œä¼˜é›…ä¸”æ˜“äºä½¿ç”¨çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼Œè¯¥äº§å“çš„ä¸€ä¸ªé‡è¦ç›®æ ‡æ˜¯ç®€åŒ–æ„å»º WASM æ¨¡å—çš„ä½“éªŒã€‚ä¸‹é¢ä»‹ç»ä¸€ä¸‹ä½¿ç”¨ wasme å·¥å…·å¼€å‘ã€æ„å»ºå’Œéƒ¨ç½² filter çš„æ•´ä½“æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1ã€å®‰è£… wasme cli&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;wasme å‘½ä»¤è¡Œå·¥å…·ç”¨äºæ„å»ºã€ç®¡ç† wasm filterï¼Œä½œç”¨å’Œæµç¨‹æœ‰ç‚¹åƒ docker æ„å»ºå’Œç®¡ç†å®¹å™¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å®‰è£…wasme&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -sL https://run.solo.io/wasme/install &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;PATH&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$HOME&lt;/span&gt;/.wasme/bin:&lt;span class=&#34;nv&#34;&gt;$PATH&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æŸ¥çœ‹ç‰ˆæœ¬å·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wasme --version
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;2ã€åˆå§‹åŒ– filter é¡¹ç›®&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªæ–°çš„ filter é¡¹ç›®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wasme init ./new-filter
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ ¹æ®å‘½ä»¤è¡Œçš„æç¤ºå¯ä»¥çŸ¥é“ï¼Œç°åœ¨åªæ”¯æŒ cppã€assemblyscript ä¸¤ç§è¯­è¨€ï¼›å¯ä»¥é€‰æ‹©éƒ¨ç½²åˆ° Istio æˆ– Gloo å¹³å°ã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹© cppã€istio é€‰é¡¹ï¼Œå®Œæˆé¡¹ç›®åˆ›å»ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-wasm/envoy-wasm-2_hu127be71ac65ad85c307623a054a10fb8_96747_362a3a2955f71501aa2d6fc764b71cdc.webp 400w,
               /blog/envoy-wasm/envoy-wasm-2_hu127be71ac65ad85c307623a054a10fb8_96747_e7188ee255da1be0b65595cecfd8bd45.webp 760w,
               /blog/envoy-wasm/envoy-wasm-2_hu127be71ac65ad85c307623a054a10fb8_96747_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-wasm/envoy-wasm-2_hu127be71ac65ad85c307623a054a10fb8_96747_362a3a2955f71501aa2d6fc764b71cdc.webp&#34;
               width=&#34;760&#34;
               height=&#34;182&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ç”Ÿæˆçš„é¡¹ç›®åŒ…æ‹¬å“ªäº›æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# tree&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;-- bazel
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;-- external
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;-- BUILD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;-- emscripten-toolchain.BUILD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;       &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;-- envoy-wasm-api.BUILD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;-- BUILD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;-- filter.cc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;-- filter.proto
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;-- README.md
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;-- runtime-config.json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;-- toolchain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;-- BUILD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;-- cc_toolchain_config.bzl
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;-- common.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;-- emar.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;-- emcc.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;-- WORKSPACE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; directories, &lt;span class=&#34;m&#34;&gt;14&lt;/span&gt; files
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™äº›æ–‡ä»¶çš„ä½œç”¨åˆ†åˆ«ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BUILDï¼šç”¨äºç¼–è¯‘ filter çš„ bazel ç¼–è¯‘æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;WORKSPACEï¼šç”¨äºç¼–è¯‘ filter çš„ bazel WORKSPACE æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;bazel/ï¼šbazel å¤–éƒ¨ä¾èµ–&lt;/li&gt;
&lt;li&gt;toolchain/ï¼šç¼–è¯‘ WASM æ¨¡å—çš„ bazel å·¥å…·é“¾&lt;/li&gt;
&lt;li&gt;filter.ccï¼šfilter æºä»£ç ï¼Œè¿™é‡Œæ˜¯ C++è¯­è¨€&lt;/li&gt;
&lt;li&gt;filter.protoï¼šfilter é…ç½®çš„ protobuf schema&lt;/li&gt;
&lt;li&gt;runtime-config.jsonï¼šå’Œ filter é•œåƒå…±åŒå­˜å‚¨çš„ config æ–‡ä»¶ï¼Œç”¨äºåœ¨è¿è¡Œæ—¶åŠ è½½ filter&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™é‡Œé‡ç‚¹å…³æ³¨ filter.cc æ–‡ä»¶å³å¯ï¼Œé‡Œé¢å®šä¹‰äº†ä¸€ç»„æ¥å£å’Œå®ç°ï¼Œåªéœ€è¦å¯¹ç›¸å…³çš„æ–¹æ³•è¿›è¡Œä¿®æ”¹ï¼Œå°±å¯ä»¥å®ç°è‡ªå®šä¹‰çš„ filterã€‚å…¶ä»–æ–‡ä»¶ä¸»è¦ç”¨äºç¼–è¯‘ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œä¹Ÿå¼•å…¥äº† emscripten å·¥å…·é“¾ï¼Œç”¨äºç¼–è¯‘æˆ wasm å­—èŠ‚ç æ ¼å¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3ã€ä¿®æ”¹å’Œç¼–è¯‘&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬åœ¨å“åº”å¤´æ·»åŠ ä¸€ç»„ header ä¿¡æ¯ï¼Œä»¥éªŒè¯ filter åŠŸèƒ½æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AddHeaderContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onResponseHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;LOG_DEBUG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;onResponseHeaders &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;addResponseHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;header_name_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;header_value_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;replaceResponseHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;location&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;envoy-wasm&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;addResponseHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;hello&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;world!&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ä½¿ç”¨ wasme å‘½ä»¤ç¼–è¯‘ filterï¼Œè¿™é‡Œä¼šè‡ªåŠ¨æ‹‰å– quay.io/solo-io/ee-builder é•œåƒå®Œæˆç¼–è¯‘è¿‡ç¨‹ï¼Œæ„å»ºå®Œæˆçš„ filter é•œåƒå°†ä¼šå­˜å‚¨åœ¨æœ¬åœ°çš„ registry ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wasme build cpp -t webassemblyhub.io/sunboy0213/add-header:v0.1 .
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹æœ¬åœ°ç¼–è¯‘å®Œæˆçš„ filter é•œåƒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wasme list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                    TAG  SIZE   SHA      UPDATED
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;webassemblyhub.io/sunboy0213/add-header v0.1 1.0 MB 72ad74e2 &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt; Apr &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; 11:03 CST
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘ä»¬æœ€ç»ˆç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶å¦‚ä¸‹ï¼Œç›®æ ‡æ–‡ä»¶ filter.wasm åªæœ‰ 1021Kï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„é›†æˆåˆ° envoy ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls store/41aabc92e1f91207d4b4e12385fd5bca/ -alh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;total 1.1M
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwxr-xr-x &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; root root  4.0K Apr &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt; 12:19 .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwxr-xr-x &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; root root  4.0K Apr &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt; 12:19 ..
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-rw-r--r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root   &lt;span class=&#34;m&#34;&gt;226&lt;/span&gt; Apr &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt; 20:58 descriptor.json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-rw-r--r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root 1021K Apr &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt; 20:58 filter.wasm
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-rw-r--r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root    &lt;span class=&#34;m&#34;&gt;44&lt;/span&gt; Apr &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt; 20:58 image_ref
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-rw-r--r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root   &lt;span class=&#34;m&#34;&gt;128&lt;/span&gt; Apr &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt; 20:58 runtime-config.json
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;4ã€æ¨é€åˆ° WebAssembly hub&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œéœ€è¦é¦–å…ˆæ³¨å†Œ &lt;a href=&#34;https://webassemblyhub.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://webassemblyhub.io&lt;/a&gt; è´¦å·ï¼Œç„¶åå°†æœ¬åœ°ç¼–è¯‘å®Œæˆçš„é•œåƒæ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ç™»å½•è´¦å·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wasme login -u &lt;span class=&#34;nv&#34;&gt;$YOUR_USERNAME&lt;/span&gt; -p &lt;span class=&#34;nv&#34;&gt;$YOUR_PASSWORD&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æ¨é€é•œåƒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wasme push webassemblyhub.io/sunboy0213/add-header:v0.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æŸ¥æ‰¾æˆ‘çš„è¿œç¨‹é•œåƒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wasme list --search &lt;span class=&#34;nv&#34;&gt;$YOUR_USERNAME&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;5ã€éƒ¨ç½²åˆ° istio é›†ç¾¤&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸€æ­¥çš„å‰ææ˜¯å·²ç»æ­å»ºäº† Istio è¿è¡Œç¯å¢ƒï¼Œå¹¶éƒ¨ç½²å¥½äº† bookinfo ç¤ºä¾‹åº”ç”¨ã€‚æµ‹è¯•æœåŠ¡é—´çš„è®¿é—®è¿é€šæ€§å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# kubectl exec -ti deploy/productpage-v1 -c istio-proxy -- curl -v http://details:9080/details/123&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;*   Trying 172.18.233.86...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* TCP_NODELAY &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* Connected to details &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;172.18.233.86&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; port &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#0)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; GET /details/123 HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; Host: details:9080
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; User-Agent: curl/7.58.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; Accept: */*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; content-type: application/json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; server: istio-envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; date: Thu, &lt;span class=&#34;m&#34;&gt;23&lt;/span&gt; Apr &lt;span class=&#34;m&#34;&gt;2020&lt;/span&gt; 09:16:53 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; content-length: &lt;span class=&#34;m&#34;&gt;180&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; x-envoy-peer-metadata: Ch4KDElOU1RBTkNFX0lQUxIOGgwxNzIuMTYuMC4yMDYK1QEKBkxBQkVMUxLKASrHAQoQCgNhcHASCRoHZGV0YWlscwohChFwb2QtdGVtcGxhdGUtaGFzaBIMGgo3NWQ5NGM0OGY1CiQKGXNlY3VyaXR5LmlzdGlvLmlvL3Rsc01vZGUSBxoFaXN0aW8KLAofc2VydmljZS5pc3Rpby5pby9jYW5vbmljYWwtbmFtZRIJGgdkZXRhaWxzCisKI3NlcnZpY2UuaXN0aW8uaW8vY2Fub25pY2FsLXJldmlzaW9uEgQaAnYxCg8KB3ZlcnNpb24SBBoCdjEKGgoHTUVTSF9JRBIPGg1jbHVzdGVyLmxvY2FsCiUKBE5BTUUSHRobZGV0YWlscy12MS03NWQ5NGM0OGY1LTdibHhtChYKCU5BTUVTUEFDRRIJGgdkZWZhdWx0Ck4KBU9XTkVSEkUaQ2t1YmVybmV0ZXM6Ly9hcGlzL2FwcHMvdjEvbmFtZXNwYWNlcy9kZWZhdWx0L2RlcGxveW1lbnRzL2RldGFpbHMtdjEKJQoPU0VSVklDRV9BQ0NPVU5UEhIaEGJvb2tpbmZvLWRldGFpbHMKHQoNV09SS0xPQURfTkFNRRIMGgpkZXRhaWxzLXYx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; x-envoy-peer-metadata-id: sidecar~172.16.0.206~details-v1-75d94c48f5-7blxm.default~default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; x-envoy-decorator-operation: details.default.svc.cluster.local:9080/*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* Connection &lt;span class=&#34;c1&#34;&gt;#0 to host details left intact&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;:123,&lt;span class=&#34;s2&#34;&gt;&amp;#34;author&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;William Shakespeare&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;year&amp;#34;&lt;/span&gt;:1595,&lt;span class=&#34;s2&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;paperback&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;pages&amp;#34;&lt;/span&gt;:200,&lt;span class=&#34;s2&#34;&gt;&amp;#34;publisher&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;PublisherA&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;language&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;English&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;ISBN-10&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;1234567890&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;ISBN-13&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;123-1234567890&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨ç½²æˆ‘ä»¬åˆšæ‰å®šåˆ¶å¼€å‘çš„ filterï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wasme deploy istio webassemblyhub.io/sunboy0213/add-header:v0.1 --id&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;myfilter
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æ¬¡è®¿é—®ï¼Œå¯ä»¥å‘ç°å“åº”å¤´å·²ç»å¢åŠ äº† &amp;ldquo;hello: world!&amp;rdquo; é”®å€¼å¯¹ã€‚æ³¨æ„ï¼šè¯¥éƒ¨ç½²è¿‡ç¨‹ä¼šè§¦å‘ pod é‡å»ºæ“ä½œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -ti deploy/productpage-v1 -c istio-proxy -- curl -v http://details:9080/details/123
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;*   Trying 172.18.233.86...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* TCP_NODELAY &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* Connected to details &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;172.18.233.86&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; port &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#0)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; GET /details/123 HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; Host: details:9080
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; User-Agent: curl/7.58.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; Accept: */*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; content-type: application/json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; server: istio-envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; date: Thu, &lt;span class=&#34;m&#34;&gt;23&lt;/span&gt; Apr &lt;span class=&#34;m&#34;&gt;2020&lt;/span&gt; 09:20:12 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; content-length: &lt;span class=&#34;m&#34;&gt;180&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; :
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; location: envoy-wasm
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; hello: world!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; x-envoy-peer-metadata: Ch4KDElOU1RBTkNFX0lQUxIOGgwxNzIuMTYuMC4yMDgK1QEKBkxBQkVMUxLKASrHAQoQCgNhcHASCRoHZGV0YWlscwohChFwb2QtdGVtcGxhdGUtaGFzaBIMGgo3NzdkOGY1NDc1CiQKGXNlY3VyaXR5LmlzdGlvLmlvL3Rsc01vZGUSBxoFaXN0aW8KLAofc2VydmljZS5pc3Rpby5pby9jYW5vbmljYWwtbmFtZRIJGgdkZXRhaWxzCisKI3NlcnZpY2UuaXN0aW8uaW8vY2Fub25pY2FsLXJldmlzaW9uEgQaAnYxCg8KB3ZlcnNpb24SBBoCdjEKGgoHTUVTSF9JRBIPGg1jbHVzdGVyLmxvY2FsCiUKBE5BTUUSHRobZGV0YWlscy12MS03NzdkOGY1NDc1LWY0Z3c0ChYKCU5BTUVTUEFDRRIJGgdkZWZhdWx0Ck4KBU9XTkVSEkUaQ2t1YmVybmV0ZXM6Ly9hcGlzL2FwcHMvdjEvbmFtZXNwYWNlcy9kZWZhdWx0L2RlcGxveW1lbnRzL2RldGFpbHMtdjEKJQoPU0VSVklDRV9BQ0NPVU5UEhIaEGJvb2tpbmZvLWRldGFpbHMKHQoNV09SS0xPQURfTkFNRRIMGgpkZXRhaWxzLXYx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; x-envoy-peer-metadata-id: sidecar~172.16.0.208~details-v1-777d8f5475-f4gw4.default~default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; x-envoy-decorator-operation: details.default.svc.cluster.local:9080/*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* Connection &lt;span class=&#34;c1&#34;&gt;#0 to host details left intact&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;:123,&lt;span class=&#34;s2&#34;&gt;&amp;#34;author&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;William Shakespeare&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;year&amp;#34;&lt;/span&gt;:1595,&lt;span class=&#34;s2&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;paperback&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;pages&amp;#34;&lt;/span&gt;:200,&lt;span class=&#34;s2&#34;&gt;&amp;#34;publisher&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;PublisherA&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;language&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;English&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;ISBN-10&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;1234567890&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;ISBN-13&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;123-1234567890&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;6ã€ç”Ÿäº§ç¯å¢ƒçš„éƒ¨ç½²&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å‰é¢æˆ‘ä»¬ä½¿ç”¨çš„ wasme å‘½ä»¤è¡Œæä¾›äº†ä¸€ç§ç¼–è¯‘ã€éƒ¨ç½² wasm filter çš„ç®€å•æ–¹å¼ï¼Œå¯ä»¥æ–¹ä¾¿çš„åœ¨å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œä½†è¯¥æ–¹å¼æ˜¾ç„¶æ— æ³•ç”¨äºå£°æ˜å¼ã€æ— çŠ¶æ€çš„ k8s ç”Ÿäº§ç¯å¢ƒä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºæ­¤ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ Wasme Operator ç®¡ç† Service Mesh é›†ç¾¤ä¸­çš„ wasm filterã€‚ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªç»„ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é•œåƒç¼“å­˜ï¼šä» filter registry æ‹‰å– filter é•œåƒï¼Œå¹¶ç¼“å­˜åˆ°æœ¬åœ°ï¼Œè¯¥ç»„ä»¶ä»¥ DaemonSet çš„å½¢å¼è¿›è¡Œéƒ¨ç½²ï¼›&lt;/li&gt;
&lt;li&gt;operatorï¼šå®‰è£…ã€é…ç½® wasm filter åˆ°æ•°æ®é¢ä»£ç†ï¼Œä»¥ Kubernetes Deployment çš„å½¢å¼éƒ¨ç½²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”¨æˆ·æäº¤çš„ FilterDeployment ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;wasme.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;FilterDeployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo-custom-filter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;name&amp;#34;:&amp;#34;hello&amp;#34;,&amp;#34;value&amp;#34;:&amp;#34;world&amp;#34;}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;webassemblyhub.io/ilackarms/istio-test:1.5.0-0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å·¥ä½œåŸç†åˆ†æ&#34;&gt;å·¥ä½œåŸç†åˆ†æ&lt;/h3&gt;
&lt;p&gt;åˆšæ‰æˆ‘ä»¬ä½¿ç”¨ wasme å‘½ä»¤è¡Œå·¥å…·å®Œæˆäº† wasm filter çš„æ„å»ºã€éƒ¨ç½²è¿‡ç¨‹ï¼Œå…¶èƒŒåçš„å·¥ä½œåŸç†ç®€å•æè¿°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”± Wasme Operator è®¾ç½® wasm filter çš„æœ¬åœ°ç¼“å­˜ä¿¡æ¯ï¼ŒåŒæ—¶ç”Ÿæˆ EnvoyFilter èµ„æºæäº¤ç»™ k8sï¼›&lt;/li&gt;
&lt;li&gt;é•œåƒç¼“å­˜æ¨¡å—æ‹‰å–éœ€è¦çš„ wasm filter åˆ°æœ¬åœ°ç¼“å­˜ä¸­ï¼Œè¯¥æ¨¡å—ä»¥ DaemonSet çš„å½¢å¼éƒ¨ç½²åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;ç¼“å­˜æ¨¡å—æ‹‰å–å®Œæˆåï¼Œå°† wasm æ–‡ä»¶æŒ‚è½½åˆ°ç›®æ ‡çš„ workload ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;åŒæ—¶ï¼ŒIstiod ç›‘æµ‹åˆ° EnvoyFilter å˜æ›´ï¼Œé€šè¿‡ xDS API å°† wasm æ–‡ä»¶çš„ä¿¡æ¯ä¸‹å‘åˆ° envoy ä»£ç†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-wasm/envoy-wasm-3_hu8cb1a6e0d500f0f05a2507e639b8f793_69223_dc47353fb9a809a186777b46bab612e6.webp 400w,
               /blog/envoy-wasm/envoy-wasm-3_hu8cb1a6e0d500f0f05a2507e639b8f793_69223_d83241b109fc39a50fe05d1cf97b3241.webp 760w,
               /blog/envoy-wasm/envoy-wasm-3_hu8cb1a6e0d500f0f05a2507e639b8f793_69223_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-wasm/envoy-wasm-3_hu8cb1a6e0d500f0f05a2507e639b8f793_69223_dc47353fb9a809a186777b46bab612e6.webp&#34;
               width=&#34;760&#34;
               height=&#34;302&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç›®å‰ï¼ŒWASM æ‰©å±•æ˜¯é€šè¿‡ mount æœºåˆ¶æ¥åˆ†å‘ç»™å¯¹åº”çš„ workloadï¼Œè¿™ç§æ–¹å¼æ˜¾ç„¶ä¸å¤Ÿçµæ´»ï¼Œç†æƒ³çš„æ–¹æ¡ˆæ˜¯é€šè¿‡ç½‘ç»œæ‹‰å– WASM æ–‡ä»¶ï¼Œå®Œæˆå®æ—¶åŠ è½½ã€‚é’ˆå¯¹è¯¥é—®é¢˜ï¼Œç¤¾åŒºä¹Ÿæ­£åœ¨ç§¯æä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;ç»“åˆå‰é¢çš„å®è·µå†…å®¹å’ŒåŸç†åˆ†æï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å·²ç»æ·»åŠ çš„ EnvoyFilter èµ„æºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;root@c-wfodwhfz-aaxyxwyz ~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# kubectl get envoyfilters.networking.istio.io&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                      AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;details-v1-myfilter       50m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;productpage-v1-myfilter   50m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ratings-v1-myfilter       50m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reviews-v1-myfilter       50m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reviews-v2-myfilter       50m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reviews-v3-myfilter       50m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œçš„ EnvoyFilter æ˜¯ Istio æä¾›çš„ä¸€ç§èµ„æºå¯¹è±¡ï¼Œç”¨æ¥æ›´æ–°é…ç½® Envoy ä¸­çš„ filterï¼Œä¸ºæœåŠ¡ç½‘æ ¼æ§åˆ¶é¢æä¾›äº†å¼ºå¤§çš„æ‰©å±•èƒ½åŠ›ã€‚å¯ä»¥è¯¦ç»†çœ‹ä¸€ä¸‹ productpage-v1-myfilter çš„å…·ä½“æè¿°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: networking.istio.io/v1alpha3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: EnvoyFilter
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  creationTimestamp: &lt;span class=&#34;s2&#34;&gt;&amp;#34;2020-04-23T09:19:34Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  generation: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: productpage-v1-myfilter
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  namespace: default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  resourceVersion: &lt;span class=&#34;s2&#34;&gt;&amp;#34;9071122&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  selfLink: /apis/networking.istio.io/v1alpha3/namespaces/default/envoyfilters/productpage-v1-myfilter
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  uid: b528b175-5e08-4b08-85ed-a324a2418a64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  configPatches:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - applyTo: HTTP_FILTER
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    match:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      context: SIDECAR_INBOUND
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      listener:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        filterChain:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          filter:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            name: envoy.http_connection_manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            subFilter:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              name: envoy.router
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    patch:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      operation: INSERT_BEFORE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      value:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        config:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          config:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            name: myfilter
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            rootId: add_header_root_id
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            vmConfig:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              code:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                local:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  filename: /var/local/lib/wasme-cache/72ad74e260c99fd77bbfd62f5dfab16af666dbdee8bacca39d97eafe60c69584
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              runtime: envoy.wasm.runtime.v8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              vmId: myfilter
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        name: envoy.filters.http.wasm
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  workloadSelector:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    labels:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      app: productpage
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      version: v1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥é…ç½®å†…å®¹é€šè¿‡ xDS API ä¸‹å‘åˆ° Envoy ä»£ç†ä¹‹åï¼Œenvoy çš„è¿è¡Œæ—¶é…ç½®å°±ä¼šå‡ºç°å¦‚ä¸‹ç±»å‹çš„ http filterï¼Œå¯ä»¥çœ‹åˆ°è¯¥ filter æŒ‡å®šäº† wasm æ–‡ä»¶çš„ä½ç½®ï¼Œå¹¶å°† wasm çš„è¿è¡Œæ—¶è®¾ç½®ä¸º v8 å¼•æ“ï¼Œä»è€Œå®ç°äº† wasm filter çš„åŠ è½½å’Œè¿è¡Œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.http.wasm&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;myfilter&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;rootId&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;add_header_root_id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;vmConfig&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;code&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;filename&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/var/local/lib/wasme-cache/72ad74e260c99fd77bbfd62f5dfab16af666dbdee8bacca39d97eafe60c69584&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;runtime&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.wasm.runtime.v8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;vmId&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;myfilter&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å°ç»“&#34;&gt;å°ç»“&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡é¦–å…ˆä»‹ç»äº† Envoy çš„è¿‡æ»¤å™¨æ¨¡å‹å’Œ WASM æ‰©å±•æŠ€æœ¯ï¼Œå¹¶ç»“åˆ Solo å›¢é˜Ÿæä¾›çš„ wasme å·¥å…·å®Œæˆäº† WASM æ‰©å±•çš„æ„å»ºã€éƒ¨ç½²è¿‡ç¨‹ï¼Œæœ€åå¯¹èƒŒåçš„å·¥ä½œåŸç†è¿›è¡Œäº†åˆ†æã€‚å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ WASM å¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†è‡ªå®šä¹‰ filter é›†æˆåˆ° Envoy ä¸­ï¼Œå®ç° Envoy ä»£ç†çš„åŠŸèƒ½å¢å¼ºï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå‘ç° envoy-wasm ä»ç„¶å¤„äºåˆæ­¥é˜¶æ®µï¼Œåœ¨æ”¯æŒçš„è¯­è¨€ç±»å‹ã€è¿è¡Œæ€§èƒ½ã€éƒ¨ç½²è¿ç»´ç­‰æ–¹é¢ä»ç„¶æœ‰å¾…å®Œå–„ï¼Œç›¸ä¿¡åœ¨ç¤¾åŒºçš„ä¸æ–­åŠªåŠ›ä¸‹ï¼ŒWASM æŠ€æœ¯èƒ½å¤Ÿèµ°å‘æˆç†Ÿå¹¶åº”ç”¨äºæ›´å¤šçš„ä½¿ç”¨åœºæ™¯ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/latest/zh/blog/2020/wasm-announce/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é‡æ–°å®šä¹‰ä»£ç†çš„æ‰©å±•æ€§ï¼šEnvoy å’Œ Istio å¼•å…¥ WebAssembly&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://cloud.tencent.com/developer/article/1548607&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚ä½•é«˜æ•ˆåœ°ç¼–å†™ Envoy è¿‡æ»¤å™¨ï¼ç¬¬ 1 éƒ¨åˆ†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/proxy-wasm/spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WebAssembly for Proxies (ABI specification)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/latest/blog/2020/deploy-wasm-declarative/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Declarative WebAssembly deployment for Istio&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio1.5 &amp; Envoy æ•°æ®é¢ WASM å®è·µ</title>
      <link>https://cloudnative.to/blog/istio-envoy-wasm/</link>
      <pubDate>Sat, 11 Apr 2020 11:40:00 +0800</pubDate>
      <guid>https://cloudnative.to/blog/istio-envoy-wasm/</guid>
      <description>&lt;h2 id=&#34;ç®€ä»‹&#34;&gt;ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;Istio 1.5 å›å½’å•ä½“æ¶æ„ï¼Œå¹¶æŠ›å´åŸæœ‰çš„ out-of-process çš„æ•°æ®é¢ï¼ˆEnvoyï¼‰æ‰©å±•æ–¹å¼ï¼Œè½¬è€Œæ‹¥æŠ±åŸºäº WASM çš„ in-proxy æ‰©å±•ï¼Œä»¥æœŸè·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚æœ¬æ–‡åŸºäºç½‘æ˜“æ­å·ç ”ç©¶é™¢è½»èˆŸäº‘åŸç”Ÿå›¢é˜Ÿçš„è°ƒç ”ä¸æ¢ç´¢ï¼Œä»‹ç» WASM çš„ç¤¾åŒºå‘å±•ä¸å®è·µã€‚&lt;/p&gt;
&lt;p&gt;è¶…ç®€å•ç‰ˆè§£é‡Šï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;ndash;&amp;gt; Envoy å†…ç½® Google V8 å¼•æ“ï¼Œæ”¯æŒ WASM å­—èŠ‚ç è¿è¡Œï¼Œå¹¶å¼€æ”¾ç›¸å…³æ¥å£ç”¨äºå’Œ WASM è™šæ‹Ÿæœºäº¤äº’æ•°æ®ï¼›
&amp;ndash;&amp;gt; ä½¿ç”¨å„ç§è¯­è¨€å¼€å‘ç›¸å…³æ‰©å±•å¹¶ç¼–è¯‘ä¸º .WASM æ–‡ä»¶ï¼›
&amp;ndash;&amp;gt; å°†æ‰©å±•æ–‡ä»¶æŒ‚è½½æˆ–è€…æ‰“åŒ…è¿›å…¥ Envoy å®¹å™¨é•œåƒï¼Œé€šè¿‡ xDS åŠ¨æ€ä¸‹å‘æ–‡ä»¶è·¯å¾„åŠç›¸å…³é…ç½®ç”±è™šæ‹Ÿæœºæ‰§è¡Œã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;webassembly-ç®€è¿°&#34;&gt;WebAssembly ç®€è¿°&lt;/h2&gt;
&lt;p&gt;Istio æœ€æ–°å‘å¸ƒçš„ 1.5 ç‰ˆæœ¬ï¼Œæ¶æ„å‘ç”Ÿäº†å·¨å¤§è°ƒæ•´ï¼Œä»åŸæœ‰çš„åˆ†å¸ƒå¼ç»“æ„å›å½’ä¸ºå•ä½“ï¼ŒåŒæ—¶æŠ›å´äº†åŸæœ‰çš„ out-of-process çš„ Envoy æ‰©å±•æ–¹å¼ï¼Œè½¬è€Œæ‹¥æŠ±åŸºäº WASM çš„ in-proxy æ‰©å±•ï¼Œä»¥æœŸè·å¾—æ›´å¥½çš„æ€§èƒ½ï¼ŒåŒæ—¶å‡å°éƒ¨ç½²å’Œä½¿ç”¨çš„å¤æ‚æ€§ã€‚æ‰€æœ‰çš„ WASM æ’ä»¶éƒ½åœ¨ Envoy çš„æ²™ç®±ä¸­è¿è¡Œï¼Œç›¸æ¯”äºåŸç”Ÿ C++ Envoy æ’ä»¶ï¼ŒWASM æ’ä»¶å…·æœ‰ä»¥ä¸‹çš„ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¥è¿‘åŸç”Ÿæ’ä»¶æ€§èƒ½ï¼ˆå­˜ç–‘ï¼Œå¾…éªŒè¯ï¼Œç¤¾åŒºæœªç»™å‡ºå¯ä¿¡æµ‹è¯•ç»“æœï¼Œä½†æ˜¯ WASM å­—èŠ‚ç å’Œæœºå™¨ç æ¯”è¾ƒæ¥è¿‘ï¼Œå®ƒçš„æ€§èƒ½æé™ç¡®å®å€¼å¾—æœŸå¾…ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;æ²™ç®±è¿è¡Œï¼Œæ›´å®‰å…¨ï¼Œå•ä¸ª filter æ•…éšœä¸ä¼šå½±å“åˆ° Envoy ä¸»ä½“æ‰§è¡Œï¼Œä¸” filter é€šè¿‡ç‰¹å®šæ¥å£å’Œ Envoy äº¤äº’æ•°æ®ï¼ŒEnvoy å¯ä»¥å¯¹æš´éœ²çš„æ•°æ®è¿›è¡Œé™åˆ¶ï¼ˆæ²™ç®±å®‰å…¨æ€§å¯¹äº Envoy æ•´ä½“ç¨³å®šæ€§ä¿éšœå…·æœ‰å¾ˆé‡è¦çš„æ„ä¹‰ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;å¯åŠ¨æ€åˆ†å‘å’Œè½½å…¥è¿è¡Œï¼ˆå•ä¸ªæ’ä»¶å¯ä»¥ç¼–è¯‘ä¸º .WASM æ–‡ä»¶è¿›è¡Œåˆ†å‘å…±äº«ï¼ŒåŠ¨æ€æŒ‚è½½ï¼ŒåŠ¨æ€è½½å…¥ï¼Œä¸”æ²¡æœ‰å¹³å°é™åˆ¶ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;æ— å¼€å‘è¯­è¨€é™åˆ¶ï¼Œå¼€å‘æ•ˆç‡æ›´é«˜ï¼ˆWASM æœ¬èº«æ”¯æŒè¯­è¨€ä¼—å¤šï¼Œä½†æ˜¯é™å®šåˆ° Envoy æ’ä»¶å¼€å‘ï¼Œå¿…ç„¶ä¾èµ–ä¸€äº›å°è£…å¥½çš„ SDK ç”¨äºå’Œ Envoy è¿›è¡Œäº¤äº’ï¼Œç›®å‰åªæœ‰ C++ è¯­è¨€æœ¬èº«ã€Rust ä»¥åŠ AssemblysScript æœ‰ä¸€å®šçš„æ”¯æŒï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;WASM çš„è¯ç”Ÿæºè‡ªå‰ç«¯ï¼Œæ˜¯ä¸€ç§ä¸ºäº†è§£å†³æ—¥ç›Šå¤æ‚çš„å‰ç«¯ web åº”ç”¨ä»¥åŠæœ‰é™çš„ JavaScript æ€§èƒ½è€Œè¯ç”Ÿçš„æŠ€æœ¯ã€‚å®ƒæœ¬èº«å¹¶ä¸æ˜¯ä¸€ç§è¯­è¨€ï¼Œè€Œæ˜¯ä¸€ç§å­—èŠ‚ç æ ‡å‡†ï¼Œä¸€ä¸ªâ€œç¼–è¯‘ç›®æ ‡â€ã€‚WASM å­—èŠ‚ç å’Œæœºå™¨ç éå¸¸æ¥è¿‘ï¼Œå› æ­¤å¯ä»¥éå¸¸å¿«é€Ÿçš„è£…è½½è¿è¡Œã€‚ä»»ä½•ä¸€ç§è¯­è¨€ï¼Œéƒ½å¯ä»¥è¢«ç¼–è¯‘æˆ WASM å­—èŠ‚ç ï¼Œç„¶ååœ¨ WASM è™šæ‹Ÿæœºä¸­æ‰§è¡Œï¼ˆæœ¬èº«æ˜¯ä¸º web è®¾è®¡ï¼Œå¿…ç„¶å¤©ç„¶è·¨å¹³å°ï¼ŒåŒæ—¶ä¸ºäº†æ²™ç®±è¿è¡Œä¿éšœå®‰å…¨ï¼Œæ‰€ä»¥ç›´æ¥ç¼–è¯‘æˆæœºå™¨ç å¹¶ä¸æ˜¯æœ€ä½³é€‰æ‹©ï¼‰ã€‚ç†è®ºä¸Šï¼Œæ‰€æœ‰è¯­è¨€ï¼ŒåŒ…æ‹¬ JavaScriptã€Cã€C++ã€Rustã€Goã€Java ç­‰éƒ½å¯ä»¥ç¼–è¯‘æˆ WASM å­—èŠ‚ç å¹¶åœ¨ WASM è™šæ‹Ÿæœºä¸­æ‰§è¡Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¤¾åŒºå‘å±•åŠç°çŠ¶&#34;&gt;ç¤¾åŒºå‘å±•åŠç°çŠ¶&lt;/h2&gt;
&lt;h3 id=&#34;envoy--wasm&#34;&gt;Envoy &amp;amp; WASM&lt;/h3&gt;
&lt;p&gt;Envoy æä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„ Http ä¸ƒå±‚ filterï¼Œåä¸º wasmï¼Œç”¨äºè½½å…¥å’Œæ‰§è¡Œ WASM å­—èŠ‚ç ã€‚è¯¥ä¸ƒå±‚ filter åŒæ ·ä¹Ÿè´Ÿè´£ WASM è™šæ‹Ÿæœºçš„åˆ›å»ºå’Œç®¡ç†ï¼Œä½¿ç”¨çš„æ˜¯ Google å†…éƒ¨çš„ v8 å¼•æ“ï¼ˆæ”¯æŒ JS å’Œ WASMï¼‰ã€‚å½“å‰ filter æœªè¿›å…¥ Envoy ä¸»å¹²ï¼Œè€Œæ˜¯åœ¨å•ç‹¬çš„ä¸€ä¸ª&lt;a href=&#34;https://github.com/envoyproxy/envoy-WASM&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å·¥ç¨‹&lt;/a&gt;ä¸­ã€‚è¯¥å·¥ç¨‹ä¼šå‘¨æœŸæ€§ä»ä¸»å¹²åˆå¹¶ä»£ç ã€‚ä»æœºåˆ¶çœ‹ï¼ŒWASM æ‰©å±•å’Œ Lua æ‰©å±•æœºåˆ¶éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯ Lua è½½å…¥çš„æ˜¯åŸå§‹è„šæœ¬ï¼Œè€Œ WASM è½½å…¥çš„æ˜¯ç¼–è¯‘åçš„ WASM å­—èŠ‚ç ã€‚Envoy æš´éœ²ç›¸å…³çš„æ¥å£å¦‚è·å–è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ï¼Œä¿®æ”¹è¯·æ±‚å¤´ï¼Œè¯·æ±‚ä½“ï¼Œæ”¹å˜æ’ä»¶é“¾æ‰§è¡Œæµç¨‹ç­‰ç­‰ï¼Œç”¨äº WASM æ’ä»¶å’Œ Envoy ä¸»ä½“è¿›è¡Œæ•°æ®äº¤äº’ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæ¯ä¸€ä¸ª WASM æ‰©å±•æ’ä»¶éƒ½å¯ä»¥è¢«ç¼–è¯‘ä¸ºä¸€ä¸ª *.WASM æ–‡ä»¶ï¼Œè€Œ Envoy ä¸ƒå±‚æä¾›çš„ wasm Filter å¯ä»¥é€šè¿‡åŠ¨æ€ä¸‹å‘ç›¸å…³é…ç½®ï¼ˆæŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼‰ä½¿å…¶è½½å…¥å¯¹åº”çš„æ–‡ä»¶å¹¶æ‰§è¡Œï¼šå‰ææ˜¯å¯¹åº”çš„æ–‡ä»¶å·²ç»åœ¨é•œåƒä¸­æˆ–è€…æŒ‚è½½è¿›å…¥äº†å¯¹åº”çš„è·¯å¾„ã€‚å½“ç„¶ï¼ŒWASM Filter ä¹Ÿæ”¯æŒä»è¿œç¨‹è·å–å¯¹åº”çš„ *.WASM æ–‡ä»¶ï¼ˆå’Œç›®å‰ç½‘æ˜“è½»èˆŸ API ç½‘å…³å¯¹ Lua è„šæœ¬æ‰©å±•çš„æ”¯æŒéå¸¸ç›¸ä¼¼ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;istio--wasm&#34;&gt;Istio &amp;amp; WASM&lt;/h3&gt;
&lt;p&gt;ç°æœ‰çš„ Istio æä¾›äº†åä¸º Mixer æ’ä»¶æ¨¡å‹ç”¨äºæ‰©å±• Envoy æ•°æ®é¢åŠŸèƒ½ï¼Œå…·ä½“æ¥è¯´ï¼Œåœ¨ Envoy å†…éƒ¨ï¼ŒIstio å¼€å‘äº†ä¸€ä¸ªåŸç”Ÿ C++ æ’ä»¶ç”¨äºæ”¶é›†å’Œè·å–è¿è¡Œæ—¶è¯·æ±‚ä¿¡æ¯å¹¶é€šè¿‡ gRPC å°†ä¿¡æ¯ä¸ŠæŠ¥ç»™ Mixerï¼Œå¤–éƒ¨ Mixer åˆ™è°ƒç”¨å„ä¸ª Mixer Adapter ç”¨äºç›‘æ§ã€æˆæƒæ§åˆ¶ã€é™æµç­‰ç­‰æ“ä½œï¼Œç›¸å…³å¤„ç†ç»“æœå¦‚æœ‰å¿…è¦å†è¿”å›ç»™ Envoy ä¸­ C++ æ’ä»¶ç”¨äºåšç›¸å…³æ§åˆ¶ã€‚
Mixer æ¨¡å‹è™½ç„¶æé«˜äº†æé«˜çš„çµæ´»æ€§ï¼Œä¸”å¯¹ Envoy ä¾µå…¥æ€§æä½ï¼Œä½†æ˜¯å¼•å…¥äº†å¤§é‡çš„é¢å¤–çš„å¤–éƒ¨è°ƒç”¨å’Œæ•°æ®äº¤äº’ï¼Œå¸¦æ¥äº†å·¨å¤§çš„æ€§èƒ½å¼€é”€ï¼ˆç›¸å…³çš„æµ‹è¯•ç»“æœå¾ˆå¤šï¼ŒæŒ‰ç…§ istio ç¤¾åŒºçš„æ•°æ®ï¼šç§»é™¤ Mixer å¯ä»¥ä½¿æ•´ä½“ CPU æ¶ˆè€—å‡å°‘ 50%ï¼‰ã€‚è€Œä¸” Istio æ’ä»¶æ‰©å±•æ¨¡å‹å’Œ Envoy æ’ä»¶æ¨¡å‹æ•´ä½“æ˜¯å‰²è£‚çš„ï¼ŒIstio æ’ä»¶åœ¨ out-of-process ä¸­æ‰§è¡Œï¼Œé€šè¿‡ gRPC è¿›è¡Œæ’ä»¶ä¸ Envoy ä¸»ä½“çš„æ•°æ®äº¤äº’ï¼Œè€Œ Envoy åŸç”Ÿæ’ä»¶åˆ™æ˜¯ in-proxy æ¨¡å¼ï¼Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­é€šè¿‡è™šå‡½æ•°æ¥å£è¿›è¡Œè°ƒç”¨å’Œæ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤åœ¨ Istio 1.5 ä¸­ï¼ŒIstio æä¾›äº†å…¨æ–°çš„æ’ä»¶æ‰©å±•æ¨¡å‹ï¼šWASM in proxyã€‚ä½¿ç”¨ Envoy æ”¯æŒçš„ WASM æœºåˆ¶æ¥æ‰©å±•æ’ä»¶ï¼šå…¼é¡¾æ€§èƒ½ã€å¤šè¯­è¨€æ”¯æŒã€åŠ¨æ€ä¸‹å‘åŠ¨æ€è½½å…¥ã€ä»¥åŠå®‰å…¨æ€§ã€‚å”¯ä¸€çš„ç¼ºç‚¹å°±æ˜¯ç°æœ‰çš„æ”¯æŒè¿˜ä¸å¤Ÿå®Œå–„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æå‡æ€§èƒ½ï¼ŒIstio ç¤¾åŒºåœ¨ 1.5 å‘å¸ƒä¸­ï¼Œå·²ç»å°†å‡ ä¸ªæ‰©å±•ä½¿ç”¨ in-proxy æ¨¡å‹ï¼ˆåŸºäº WASM API è€ŒéåŸç”Ÿ Envoy C++ HTTP æ’ä»¶ APIï¼‰è¿›è¡Œå®ç°ã€‚ä½†æ˜¯ç›®å‰è€ƒè™‘åˆ° WASM è¿˜ä¸å¤Ÿç¨³å®šï¼Œæ‰€ä»¥ç›¸å…³æ‰©å±•é»˜è®¤ä¸ä¼šæ‰§è¡Œåœ¨ WSAM æ²™ç®±ä¹‹ä¸­ï¼ˆåœ¨æ‰€è°“ NullVM ä¸­æ‰§è¡Œï¼‰ã€‚è™½ç„¶ istio ä¹Ÿæ”¯æŒå°†ç›¸å…³æ‰©å±•ç¼–è¯‘ä¸º WASM æ¨¡å—ï¼Œå¹¶åœ¨æ²™ç®±ä¸­æ‰§è¡Œï¼Œä½†æ˜¯ä¸æ˜¯é»˜è®¤é€‰é¡¹ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€è°“ Mixer V2 å…¶æœ€ç»ˆç›®æ ‡å°±æ˜¯å°†ç°æœ‰çš„ out-of-process çš„æ’ä»¶æ¨¡å‹æœ€ç»ˆç”¨åŸºäº WASM çš„ in-proxy æ‰©å±•æ¨¡å‹æ¥æ›¿ä»£ã€‚ä½†æ˜¯ç›®å‰ä¸¾ä¾‹ç›®æ ‡ä»æ—§æœ‰è¾ƒé•¿ä¸€æ®µè·¯è¦èµ°ï¼Œæ¯•ç«Ÿå³ä½¿ Istio ç¤¾åŒºæœ¬èº«çš„æ’ä»¶ï¼Œä¹Ÿæœªèƒ½å®Œå…¨åœ¨ WASM æ²™ç®±ä¸­è½åœ°ã€‚ä½†ä» Istio 1.5 å¼€å§‹ï¼ŒIstio ç¤¾åŒºåº”è¯¥ä¼šå¿«é€Ÿæ¨åŠ¨ WASM çš„å‘å±•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;soloio--wasm&#34;&gt;solo.io &amp;amp; WASM&lt;/h3&gt;
&lt;p&gt;solo.io æ¨å‡ºäº† WebAssembly Hubï¼Œç”¨äºæ„å»ºã€å‘å¸ƒä»¥åŠå…±äº« Envoy WASM æ‰©å±•ã€‚WebAssembly Hub åŒ…æ‹¬ä¸€å¥—ç”¨äºç®€åŒ–æ‰©å±•å¼€å‘çš„ SDKï¼ˆç›®å‰ solo.io æä¾›äº† AssemblysScript SDKï¼Œè€Œ Istio/Envoy ç¤¾åŒºæä¾›äº† Rust/C++ SDKï¼‰ï¼Œç›¸å…³çš„æ„å»ºã€å‘å¸ƒå‘½ä»¤ï¼Œä¸€ä¸ªç”¨äºå…±äº«å’Œå¤ç”¨çš„æ‰©å±•ä»“åº“ã€‚å…·ä½“çš„å†…å®¹å¯ä»¥å‚è€ƒ &lt;a href=&#34;https://docs.solo.io/web-assembly-hub/latest/tutorial_code/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;solo.io æä¾›çš„æ•™ç¨‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;wasm-å®è·µ&#34;&gt;WASM å®è·µ&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢ç®€å•å®ç°ä¸€ä¸ª WASM æ‰©å±•ä½œä¸ºæ¼”ç¤º DEMOï¼Œå¯ä»¥å¸®åŠ©å¤§å®¶å¯¹ WASM æœ‰è¿›ä¸€æ­¥äº†è§£ã€‚æ­¤å¤„ç›´æ¥ä½¿ç”¨äº† solo.io æä¾›çš„æ„å»ºå·¥å…·ï¼Œé¿å…ç¯å¢ƒæ­å»ºç­‰å„ä¸ªæ–¹é¢çš„ä¸€äº›å†—ä½™å·¥ä½œã€‚&lt;strong&gt;è¯¥æ‰©å±•åä¸º path_rewriteï¼Œå¯ä»¥æ ¹æ®è·¯ç”±åŸå§‹çš„ path å€¼åŒ¹é…ï¼Œæ¥å°†è¯·æ±‚ path é‡å†™ä¸ºä¸åŒå€¼&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… wasmeï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -sL https://run.solo.io/wasme/install &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;PATH&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$HOME&lt;/span&gt;/.wasme/bin:&lt;span class=&#34;nv&#34;&gt;$PATH&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;wasme æ˜¯ solo.io æä¾›çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œä¸€ä¸ªç®€å•çš„ç±»æ¯”å°±æ˜¯ï¼šdocker cli ä¹‹äºå®¹å™¨é•œåƒï¼Œwasme ä¹‹äº WASM æ‰©å±•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ping@ping-OptiPlex-3040:~/Desktop/wasm_example$ wasme init ./path_rewrite
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Use the arrow keys to navigate: â†“ â†‘ â†’ â†
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;? What language &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; you wish to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the filter:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â–¸ cpp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    assemblyscript
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œ wasme åˆå§‹åŒ–å‘½ä»¤ï¼Œä¼šè®©ç”¨æˆ·é€‰æ‹©ä½¿ç”¨ä½•ç§è¯­è¨€å¼€å‘ WASM æ‰©å±•ï¼Œç›®å‰ wasme å·¥å…·ä»…æ”¯æŒ C++ å’Œ AssemblyScriptï¼Œå½“å‰ä»æ—§é€‰æ‹© cpp è¿›è¡Œå¼€å‘ï¼ˆAssemblyScript æ²¡æœ‰å¼€å‘ç»éªŒï¼Œåç»­æœ‰æœºä¼šå¯ä»¥å­¦ä¹ ä¸€ä¸‹ï¼‰ã€‚æ‰§è¡Œå‘½ä»¤ä¹‹åï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª bazel å·¥ç¨‹ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼šå…¶ä¸­å…³é”®çš„å‡ ä¸ªæ–‡ä»¶å·²ç»æ·»åŠ äº†æ³¨é‡Šã€‚ä»ç›®å½•ç»“æ„çœ‹ï¼Œsolo.io æ²¡æœ‰åœ¨ wasme ä¸­æ·»åŠ ä»»ä½•é»‘ç§‘æŠ€ï¼Œç”Ÿæˆçš„æ¨¡æ¿éå¸¸çš„å¹²å‡€ï¼Œå®Œæ•´è€Œç®€æ´ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ bazel
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â””â”€â”€ external
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â      â”œâ”€â”€ BUILD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â      â”œâ”€â”€ emscripten-toolchain.BUILD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â      â””â”€â”€ envoy-wasm-api.BUILD      &lt;span class=&#34;c1&#34;&gt;# è¯´æ˜å¦‚ä½•ç¼–è¯‘envoy apiä¾èµ–&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ BUILD                             &lt;span class=&#34;c1&#34;&gt;# è¯´æ˜å¦‚ä½•ç¼–è¯‘æ’ä»¶æœ¬èº«ä»£ç &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ filter.cc                         &lt;span class=&#34;c1&#34;&gt;# æ’ä»¶å…·ä½“ä»£ç &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ filter.proto                      &lt;span class=&#34;c1&#34;&gt;# æ‰©å±•æ•°æ®é¢æ¥å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ README.md
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ runtime-config.json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ toolchain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ BUILD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ cc_toolchain_config.bzl
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ common.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â”œâ”€â”€ emar.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚Â Â  â””â”€â”€ emcc.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ WORKSPACE                         &lt;span class=&#34;c1&#34;&gt;# å·¥ç¨‹æè¿°æ–‡ä»¶åŒ…å«å¯¹envoy apiä¾èµ–&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;filter.cc ä¸­å·²ç»å¡«å……äº†æ ·æ¿ä»£ç ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„æ’ä»¶éœ€è¦å®ç°çš„æ¥å£ã€‚å¼€å‘è€…åªéœ€è¦æŒ‰éœ€ä¿®æ”¹æŸä¸ªæ¥å£çš„å…·ä½“å®ç°å³å¯ (æ­¤å¤„åˆ—å‡ºäº†æ•´ä¸ªæ’ä»¶çš„å…¨éƒ¨ä»£ç ï¼Œä»¥ä¾›å‚è€ƒã€‚è™½ç„¶è¯¥ä»£ç æ²¡æœ‰å®ç°ä»€ä¹ˆç‰¹è®¸åŠŸèƒ½ï¼Œä½†æ˜¯å·²ç»åŒ…å«äº†ä¸€ä¸ª WASM æ‰©å±•ï¼ˆC++ è¯­è¨€ç‰ˆï¼‰åº”å½“å…·å¤‡çš„æ‰€æœ‰ç»“æ„ï¼Œæ— è®ºå¤šä¹ˆå¤æ‚çš„æ’ä»¶ï¼Œéƒ½åªæ˜¯åœ¨è¯¥ç»“æ„çš„åŸºç¡€ä¸Šå¡«å……ç›¸å…³çš„é€»è¾‘ä»£ç è€Œå·²&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// NOLINT(namespace-envoy)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;string&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;unordered_map&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;#34;google/protobuf/util/json_util.h&amp;#34;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;#34;proxy_wasm_intrinsics.h&amp;#34;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;#34;filter.pb.h&amp;#34;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;AddHeaderRootContext&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RootContext&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;explicit&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AddHeaderRootContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StringView&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RootContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onConfigure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;cm&#34;&gt;/* configuration_size */&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;override&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;override&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;header_name_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;header_value_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;AddHeaderContext&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Context&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;explicit&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AddHeaderContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RootContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;static_cast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AddHeaderRootContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;static_cast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onCreate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;override&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onRequestHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;override&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;FilterDataStatus&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onRequestBody&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;body_buffer_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end_of_stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;override&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onResponseHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;override&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onDone&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;override&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;override&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onDelete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;override&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;private&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;AddHeaderRootContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RegisterContextFactory&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;register_AddHeaderContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CONTEXT_FACTORY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AddHeaderContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                      &lt;span class=&#34;n&#34;&gt;ROOT_FACTORY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AddHeaderRootContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                      &lt;span class=&#34;s&#34;&gt;&amp;#34;add_header_root_id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AddHeaderRootContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onConfigure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;conf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;getConfiguration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;Config&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;google&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;protobuf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;JsonParseOptions&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;case_insensitive_enum_parsing&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ignore_unknown_fields&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;google&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;protobuf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;JsonStringToMessage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;conf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;toString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;LOG_DEBUG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;onConfigure name &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;LOG_DEBUG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;onConfigure &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;header_name_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;header_value_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AddHeaderRootContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LOG_DEBUG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;onStart&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AddHeaderContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onCreate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LOG_DEBUG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;onCreate &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())));&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AddHeaderContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onRequestHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;LOG_DEBUG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;onRequestHeaders &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AddHeaderContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onResponseHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;LOG_DEBUG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;onResponseHeaders &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;addResponseHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;header_name_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;header_value_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;replaceResponseHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;location&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;envoy-wasm&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;FilterDataStatus&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AddHeaderContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onRequestBody&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;body_buffer_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end_of_stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterDataStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AddHeaderContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onDone&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LOG_DEBUG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;onDone &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())));&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AddHeaderContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onLog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LOG_DEBUG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;onLog &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())));&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AddHeaderContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onDelete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LOG_DEBUG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;onDelete &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())));&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„åˆ°ç”Ÿæˆçš„æ ·æ¿ä»£ç ç±»å‹åç§°ä»æ—§ä»¥ AddHeader ä¸ºå‰ç¼€ï¼Œè€Œæ²¡æœ‰æ ¹æ®æä¾›çš„è·¯å¾„åç§°ç”Ÿæˆï¼Œæ­¤å¤„æ˜¯ wasme å¯ä»¥ä¼˜åŒ–çš„ä¸€ä¸ªåœ°æ–¹ã€‚æ­¤å¤–ï¼Œ&lt;strong&gt;è‡ªåŠ¨ç”Ÿæˆçš„æ ·æ¿ä»£ç ä¸­å·²ç»åŒ…å«äº† AddHeader çš„ä¸€äº›ä»£ç ï¼Œé€»è¾‘ç®€å•ï¼Œä½†æ˜¯é…ç½®è§£æã€API è®¿é—®ï¼Œè¯·æ±‚å¤´ä¿®æ”¹ç­‰è¿‡ç¨‹éƒ½å…·å¤‡ï¼Œéº»é›€è™½å°ï¼Œäº”è„ä¿±å…¨ï¼Œæ­£å¥½å¯ä»¥å¸®åŠ©åˆæ¬¡çš„å¼€å‘è€…å¯ä»¥ä¾è‘«èŠ¦ç”»ç“¢ç†Ÿæ‚‰ WASM æ’ä»¶çš„å¼€å‘è¿‡ç¨‹&lt;/strong&gt;ã€‚å¯¹äºå…¥é—¨æ˜¯éå¸¸å‹å¥½çš„ã€‚&lt;/p&gt;
&lt;p&gt;é’ˆå¯¹ path_rewrite å…·ä½“çš„å¼€å‘æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;STEP ONE&lt;/strong&gt; é¦–å…ˆä¿®æ”¹æ¨¡æ¿ä»£ç ä¸­ filter.proto æ–‡ä»¶ï¼Œå› ä¸º path rewrite è‚¯å®šä¸èƒ½ç®€å•çš„åªèƒ½æ›¿æ¢å›ºå®šå€¼ï¼Œä¿®æ”¹å proto æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-protobuf&#34; data-lang=&#34;protobuf&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;syntax&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;proto3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;PathRewriteConfig&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Rewrite&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;regex_match&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pathæ­£åˆ™åŒ¹é…æ—¶æ›¿æ¢&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;custom_path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;å¾…æ›¿æ¢å€¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;repeated&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Rewrite&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rewrites&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;STEP TWO&lt;/strong&gt; ä¿®æ”¹é…ç½®è§£ææ¥å£ï¼Œå…·ä½“æ–¹æ³•åä¸º onConfigureã€‚ä¿®æ”¹åè§£ææ¥å£å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AddHeaderRootContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onConfigure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;conf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;getConfiguration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;PathRewriteConfig&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// message type in filter.proto
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;conf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;google&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;protobuf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;JsonParseOptions&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;case_insensitive_enum_parsing&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ignore_unknown_fields&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// è§£æå­—ç¬¦ä¸²é…ç½®å¹¶è½¬æ¢ä¸ºPathRewriteConfigç±»å‹ï¼šé…ç½®ååºåˆ—åŒ–
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;google&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;protobuf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;JsonStringToMessage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;conf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;toString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                              &lt;span class=&#34;n&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// é…ç½®é˜¶æ®µç¼–è¯‘regexé¿å…è¯·æ±‚æ—¶é‡å¤ç¼–è¯‘ï¼Œæé«˜æ€§èƒ½
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;rewrite&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rewrites&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;rewrites_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;push_back&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rewrite&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;regex_match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rewrite&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;custom_path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()});&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;STEP THREE&lt;/strong&gt; ä¿®æ”¹è¯·æ±‚å¤´æ¥å£ï¼Œå…·ä½“æ–¹æ³•åä¸º onRequestHeadersï¼Œä¿®æ”¹åæ¥å£ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AddHeaderContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;onRequestHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;LOG_DEBUG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;onRequestHeaders &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// Envoyä¸­pathåŒæ ·å­˜å‚¨åœ¨headerä¸­ï¼Œkeyä¸º:path
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;getRequestHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;:path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path_string&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;toString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;rewrite&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rewrites_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;regex_match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rewrite&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;first&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rewrite&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;empty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;replaceRequestHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;:path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rewrite&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;replaceRequestHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;location&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;envoy-wasm&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FilterHeadersStatus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»ä¸Šè¿°è¿‡ç¨‹ä¸éš¾çœ‹å‡ºï¼Œæ•´ä¸ªæ‰©å±•çš„å¼€å‘ä½“éªŒç›¸å½“ç®€å•ï¼ŒæŒ‰éœ€å®ç°å¯¹åº”æ¥å£å³å¯ï¼Œæ‰©å±•æœ¬èº«å†…å®¹éå¸¸è½»ï¼Œå†…éƒ¨å…·ä½“çš„åŠŸèƒ½é€»è¾‘æ‰æ˜¯å†³å®šæ‰©å±•å¼€å‘å¤æ‚æ€§çš„å…³é”®ã€‚è€Œä¸”å€ŸåŠ© wasme å·¥å…·ï¼Œè‡ªåŠ¨ç”Ÿæˆä»£ç åï¼Œæ•ˆç‡å¯ä»¥æ›´é«˜ï¼ˆå’Œç›®å‰åœ¨å†…éƒ¨ä½¿ç”¨çš„ filter_creator.py æœ‰éƒ¨åˆ†ç›¸ä¼¼ï¼Œæ ·æ¿ä»£ç è‡ªåŠ¨ç”Ÿæˆï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è‡³æ­¤ï¼Œæ’ä»¶å·²ç»å¼€å‘å®Œæˆï¼Œå¯ä»¥æ‰“åŒ…ç¼–è¯‘äº†ã€‚wasm åŒæ ·æä¾›äº†æ‰“åŒ…ç¼–è¯‘çš„åŠŸèƒ½ï¼Œç”šè‡³å¯ä»¥ç±»ä¼¼äºå®¹å™¨é•œåƒå°†ç¼–è¯‘åç»“æ„æ¨é€åˆ°è¿œç«¯ä»“åº“ä¹‹ä¸­ï¼Œç”¨äºåˆ†äº«æˆ–è€…å­˜å‚¨ã€‚ä¸è¿‡æœ‰ä¸€ä¸ªæç¤ºï¼Œåœ¨å¼€å‘ä¹‹å‰ï¼Œå…ˆç›´æ¥æ‰§è¡Œ bazel å‘½ä»¤ç¼–è¯‘ï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œä¸€äº›åŸºç¡€ä¾èµ–ä¼šè¢«è‡ªåŠ¨æ‹‰å–å¹¶ç¼“å­˜åˆ°æœ¬åœ°ï¼Œå€ŸåŠ© IDE å¯ä»¥è·å¾—æ›´å¥½çš„ä»£ç æç¤ºå’Œå¼€å‘ä½“éªŒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;bazel build :filter.wasm
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥æ˜¯ wasme å‘½ä»¤ç¼–è¯‘ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wasme build cpp -t webassemblyhub.io/wbpcode/path_rewrite:v0.1 .
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥å‘½ä»¤ä¼šä½¿ç”¨å›ºå®šé•œåƒä½œä¸ºç¼–è¯‘ç¯å¢ƒï¼Œä½†æ˜¯æœ¬è´¨å’Œç›´æ¥ä½¿ç”¨ bazel ç¼–è¯‘å¹¶æ— ä¸åŒã€‚å…·ä½“çš„ç¼–è¯‘æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œå®é™…ä¸Šï¼Œè¯¥å‘½ä»¤ä¹Ÿæ˜¯ä½¿ç”¨çš„&lt;code&gt;bazel build :filter.wasm&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Status: Downloaded newer image &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; quay.io/solo-io/ee-builder:0.0.19
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Building with bazel...running bazel build :filter.wasm
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Extracting Bazel installation...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Starting &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; Bazel server and connecting to it...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„ï¼Œä¸Šè¿°å‘½ä»¤ä¸­ wbpcode ä¸ºç”¨æˆ·åï¼Œå…·ä½“å®è·µæ—¶æè®®æ›¿æ¢ä¸ºè‡ªèº«ç”¨æˆ·åï¼Œå¦‚æœæ³¨å†Œäº† webassemblyhub.io è´¦å·ï¼Œç”šè‡³å¯ä»¥è¿›è¡Œ push å’Œ pull æ“ä½œã€‚æ­¤æ¬¡å°±ä¸åšç›¸å…³æ“ä½œäº†ï¼Œç›´æ¥æœ¬åœ°å¯åŠ¨å¸¦ WASM çš„ envoyã€‚å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# --configå‚æ•°ç”¨äºæŒ‡å®šwasmæ‰©å±•é…ç½®
wasme deploy envoy webassemblyhub.io/wbpcode/path_rewrite:v0.1 --config &amp;#34;{\&amp;#34;rewrites\&amp;#34;: [ {\&amp;#34;regex_match\&amp;#34;:\&amp;#34;...\&amp;#34;, \&amp;#34;custom_path\&amp;#34;: \&amp;#34;/anything\&amp;#34;} ]}&amp;#34; --envoy-run-args &amp;#34;-l trace&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä» envoy æ‰§è¡Œæ—¥å¿—å¯ä»¥çœ‹åˆ°ï¼šæœ€ç»ˆ envoy ä¼šæ‰§è¡Œä¸ƒå±‚ Filterï¼š&lt;code&gt;envoy.filters.http.wasm&lt;/code&gt;ï¼Œç›¸å…³é…ç½®ä¸ºï¼šwasm æ–‡ä»¶ä½ç½®ï¼ˆdocker æ‰§è¡Œæ—¶æŒ‚è½½è¿›å…¥å®¹å™¨å†…éƒ¨ï¼‰ã€wasm æ–‡ä»¶å¯¹åº”æ’ä»¶é…ç½®ã€runtime ç­‰ç­‰ã€‚é€šè¿‡åœ¨ http_filters ä¸­é‡å¤æ·»åŠ å¤šä¸ª&lt;code&gt;envoy.filters.http.wasm&lt;/code&gt;ï¼Œå³å¯å®ç°å¤šä¸ª WASM æ‰©å±•çš„æ‰§è¡Œã€‚ä»ä¸‹é¢çš„æ—¥å¿—ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œå³ä½¿ä¸ä½¿ç”¨ solo.io çš„å·¥å…·ï¼Œåªéœ€è¦ä¸º Envoy æŒ‡å®šç¼–è¯‘å¥½çš„ wasm æ–‡ä»¶ï¼Œå…¶æ‰§è¡Œç»“æœæ˜¯å®Œå…¨ç›¸åŒçš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2020-03-31 08:41:24.831&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;1&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;debug&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;config&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;external/envoy/source/extensions/filters/network/http_connection_manager/config.cc:388&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;       name: envoy.filters.http.wasm
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2020-03-31 08:41:24.831&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;1&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;debug&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;config&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;external/envoy/source/extensions/filters/network/http_connection_manager/config.cc:390&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;     config: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;rootId&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;add_header_root_id&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;vmConfig&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;s2&#34;&gt;&amp;#34;code&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;local&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;filename&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;/home/ping/.wasme/store/e58ddd90347b671ad314f1c969771cea/filter.wasm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;s2&#34;&gt;&amp;#34;runtime&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.wasm.runtime.v8&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;configuration&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;{\&amp;#34;rewrites\&amp;#34;: [ {\&amp;#34;regex_match\&amp;#34;:\&amp;#34;...\&amp;#34;, \&amp;#34;custom_path\&amp;#34;: \&amp;#34;/anything\&amp;#34;} ]}&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;add_header_root_id&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹‹åä½¿ç”¨å¯¹åº” path è°ƒç”¨æ¥å£ï¼šå¯å‘ç° WASM æ’ä»¶å·²ç»ç”Ÿæ•ˆï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;:authority&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;localhost:8080&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;:path&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;/ab&amp;#39;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# åŸå§‹è¯·æ±‚pathåŒ¹é…&amp;#34;...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;:method&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;GET&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;user-agent&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;curl/7.58.0&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;accept&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;*/*&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;:authority&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;localhost:8080&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;:path&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;/anything&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;:method&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;GET&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;:scheme&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;https&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;user-agent&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;curl/7.58.0&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;accept&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;*/*&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;x-forwarded-proto&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;http&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;x-request-id&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;1009236e-ab57-4ded-a8ff-3d1b17c6787b&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;location&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;envoy-wasm&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;x-envoy-expected-rq-timeout-ms&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;15000&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;wasm-æ€»ç»“&#34;&gt;WASM æ€»ç»“&lt;/h2&gt;
&lt;p&gt;WASM æ‰©å±•ä»åœ¨å¿«é€Ÿå‘å±•å½“ä¸­ï¼Œä½†æ˜¯ Istio ä½¿ç”¨ WASM API å®ç°äº†ç›¸å…³çš„æ’ä»¶ï¼Œè¯´æ˜å·²ç»åšå¥½äº†è¿ç§»çš„å‡†å¤‡ã€‚å‰æ™¯ç¾å¥½ï¼Œå€¼å¾—æœŸå¾…ï¼Œä½†æœ‰å¾…è¿›ä¸€æ­¥ç¡®å®š WASM æ²™ç®±æœ¬èº«ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ä»å¼€å‘ä½“éªŒæ¥è¯´ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å€ŸåŠ© solo.io å·¥å…·ï¼Œç®€å•æ’ä»¶çš„å¼€å‘å‡ ä¹æ²¡æœ‰ä»»ä½•çš„éš¾åº¦ï¼Œåªæ˜¯ç›®å‰æ”¯æŒçš„è¯­è¨€åªæœ‰ C++/AssemblyScriptï¼ˆEnvoy ç¤¾åŒºå¼€å‘äº† Rust è¯­è¨€ SDKï¼Œä½†æ˜¯æ­£åœ¨å¼€å‘å½“ä¸­è€Œä¸”ä½¿ç”¨ Rust å¼€å‘ WASM æ‰©å±•çš„ä»·å€¼å­˜ç–‘ï¼šRust ç›¸æ¯”äº C++ æœ€å¤§çš„ä¼˜åŠ¿æ˜¯é€šè¿‡ä¸¥æ ¼çš„ç¼–è¯‘æ£€æŸ¥æ¥ä¿è¯å†…å­˜å®‰å…¨ï¼Œä½†æ˜¯ä¹Ÿä½¿å¾—ä¸Šæ‰‹éš¾åº¦åˆæå‡äº†ä¸€ä¸ªå°é˜¶ï¼Œåœ¨æœ‰ WASM æ²™ç®±ä¸ºå†…å­˜å®‰å…¨å…œåº•çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ Rust è€Œä¸ä½¿ç”¨ JSã€Go ç­‰ä¸Šæ‰‹æ›´ç®€æ˜“çš„è¯­è¨€æ¥å¼€å‘æ‰©å±•ï¼Œå®æ— å¿…è¦ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºç›¸å¯¹å¤æ‚çš„æ’ä»¶ï¼Œå¦‚æœä½¿ç”¨ WASM çš„è¯ï¼Œæµ‹è¯•ç›¸æ¯”äºåŸç”Ÿæ’ä»¶ä¼šæ›´å›°éš¾ä¸€äº›ï¼ŒWASM æ‰©å±•é…ç½®çš„è¾“å…¥åªèƒ½ä¾èµ–æ‰‹å†™ JSON å­—ç¬¦ä¸²ï¼Œå¸Œæœ›æœªæ¥èƒ½å¤Ÿæ”¹å–„ã€‚&lt;/li&gt;
&lt;li&gt;ç¼ºå°‘è·¯ç”±ç²’åº¦çš„é…ç½®ï¼Œæ‰€æœ‰é…ç½®éƒ½æ˜¯å…¨å±€ç”Ÿæ•ˆï¼Œä¾èµ–æ’ä»¶å†…éƒ¨åˆ¤æ–­ï¼Œä½†æ˜¯è¿™ä¸€éƒ¨åˆ†å¦‚æœç¡®å®æœ‰éœ€è¦ï¼Œæ”¯æŒèµ·æ¥åº”è¯¥å¾ˆå¿«ï¼Œä¸å­˜åœ¨æŠ€æœ¯ä¸Šçš„é˜»ç¢ï¼Œå€’æ˜¯ä¸ç”¨æ‹…å¿ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä½œè€…ç®€ä»‹&#34;&gt;ä½œè€…ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;ç‹ä½°å¹³ï¼Œç½‘æ˜“æ­å·ç ”ç©¶é™¢è½»èˆŸäº‘åŸç”Ÿå›¢é˜Ÿå·¥ç¨‹å¸ˆï¼Œè´Ÿè´£è½»èˆŸ Envoy ç½‘å…³ä¸è½»èˆŸ Service Mesh æ•°æ®é¢å¼€å‘ã€åŠŸèƒ½å¢å¼ºã€æ€§èƒ½ä¼˜åŒ–ç­‰å·¥ä½œï¼Œå¯¹ Envoy æ•°æ®é¢å¼€å‘ã€å¢å¼ºã€è½åœ°å…·æœ‰è¾ƒä¸ºä¸°å¯Œçš„ç»éªŒã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>é‡æ–°å®šä¹‰ä»£ç†çš„æ‰©å±•æ€§ï¼šWebAssembly åœ¨ Envoy ä¸ Istio ä¸­çš„åº”ç”¨</title>
      <link>https://cloudnative.to/blog/redefining-extensibility-in-proxies/</link>
      <pubDate>Sat, 07 Mar 2020 15:14:43 +0800</pubDate>
      <guid>https://cloudnative.to/blog/redefining-extensibility-in-proxies/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://istio.io/blog/2020/wasm-announce/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¯‘è€…æ³¨ï¼šIstio çš„æ¶æ„åœ¨ 1.5 ç‰ˆæœ¬ä¸­å‘ç”Ÿäº†ç¿»å¤©è¦†åœ°çš„å˜åŒ–ï¼Œæ§åˆ¶å¹³é¢ä»å¾®æœåŠ¡å›å½’å•ä½“ï¼Œpilotã€citadelã€galley ç­‰æ§åˆ¶å¹³é¢ç»„ä»¶æ•´åˆæˆäº†å•ä¸€çš„ istiod äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒåŒæ—¶é¥±å—è¯Ÿç—…çš„ mixer åŒå¿—ç»ˆäºåœ¨ 1.5 ä¸­ deprecated äº†ï¼Œç¤¾åŒºå‘¼å£°å¾ˆé«˜çš„ Wasm ä»¥ Proxy-Wasm plugins çš„æ–¹å¼ç™»ä¸Šå†å²èˆå°ï¼Œå®˜æ–¹æ‰¿è¯ºåœ¨ 1.6 ç‰ˆæœ¬ä¸­æä¾›æ ‡å‡†çš„ wasm æ’ä»¶é…ç½® APIï¼Œç”šè‡³è¿˜æ¨å‡ºäº† webassemblyhub è¿™æ ·çš„ç±»ä¼¼åº”ç”¨å•†åº—çš„æœåŠ¡ï¼Œæ„å»º wasm plugin ç”Ÿæ€çš„é‡å¿ƒä¸å¯è°“ä¸å¤§ã€‚ç»“åˆä»£ç†æ— å…³çš„ ABI æ ‡å‡†ï¼Œåªèƒ½è¯´è°·æ­Œåˆåœ¨ä¸‹ä¸€ç›˜å¤§æ£‹ã€‚mixer çš„ä¸¤å¤§æ ¸å¿ƒåŠŸèƒ½ï¼Œcheck å’Œ reportï¼Œåˆ†åˆ«ä½¿ç”¨ Proxy-Wasm plugins å’Œ telemetry V2 æ›¿ä»£ï¼Œæ›¾ç»æ‰€è°“çš„ Mixer V2 è®¡åˆ’ä¹Ÿæ¸æ¸çƒŸæ¶ˆäº‘æ•£ï¼Œæ¹®æ²¡åœ¨å†å²å°˜åŸƒä¸­ã€‚æœ¬æ–‡ç¿»è¯‘å®˜æ–¹çš„æŠ€æœ¯åšå®¢ï¼Œæ¥ä¸€æ¢æœ¬æ¬¡çš„åˆ’æ—¶ä»£å˜æ›´ proxy-wasm plugin çš„ç©¶ç«Ÿã€‚&lt;/p&gt;
&lt;p&gt;è‡ª 2016 å¹´é‡‡ç”¨&lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;ä»¥æ¥ï¼ŒIstio é¡¹ç›®ä¸€ç›´å¸Œæœ›æä¾›ä¸€ä¸ªå¹³å°ï¼Œåœ¨æ­¤å¹³å°ä¸Šå¯ä»¥æ„å»ºä¸°å¯Œçš„æ‰©å±•ï¼Œä»¥æ»¡è¶³ç”¨æˆ·çš„å¤šæ ·åŒ–éœ€æ±‚ã€‚æœ‰å¾ˆå¤šç†ç”±å¯ä»¥å‘æœåŠ¡ç½‘æ ¼çš„æ•°æ®å¹³é¢æ·»åŠ åŠŸèƒ½ - æ”¯æŒæ›´æ–°çš„åè®®ï¼Œä¸ä¸“æœ‰å®‰å…¨æ§ä»¶é›†æˆæˆ–é€šè¿‡è‡ªå®šä¹‰æŒ‡æ ‡å¢å¼ºå¯è§‚å¯Ÿæ€§ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿‡å»çš„ä¸€å¹´åŠä¸­ï¼Œæˆ‘ä»¬åœ¨ Google çš„å›¢é˜Ÿä¸€ç›´åœ¨åŠªåŠ›ä½¿ç”¨&lt;a href=&#34;https://webassembly.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WebAssembly&lt;/a&gt;å‘ Envoy ä»£ç†æ·»åŠ åŠ¨æ€å¯æ‰©å±•æ€§ã€‚æˆ‘ä»¬å¾ˆé«˜å…´ä»Šå¤©ä¸å¤§å®¶åˆ†äº«è¿™é¡¹å·¥ä½œï¼Œå¹¶æ¨å‡º&lt;a href=&#34;https://github.com/proxy-wasm/spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WebAssembly (Wasm) for Proxies&lt;/a&gt; (Proxy-Wasm)ï¼šæˆ‘ä»¬æ‰“ç®—æ ‡å‡†åŒ–çš„ ABIï¼›SDKï¼›å®ƒçš„ç¬¬ä¸€ä¸ªä¸»è¦å®ç°æ˜¯æ–°å‹çš„ï¼Œä½å»¶è¿Ÿçš„&lt;a href=&#34;https://istio.io/docs/reference/config/telemetry&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio é¥æµ‹ç³»ç»Ÿ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜ä¸ç¤¾åŒºç´§å¯†åˆä½œï¼Œä»¥ç¡®ä¿ä¸ºç”¨æˆ·æä¾›è‰¯å¥½çš„å¼€å‘äººå‘˜ä½“éªŒï¼Œä»¥å¸®åŠ©ä»–ä»¬å¿«é€Ÿå…¥é—¨ã€‚Google å›¢é˜Ÿä¸€ç›´ä¸&lt;a href=&#34;https://solo.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Solo.io&lt;/a&gt;å›¢é˜Ÿç´§å¯†åˆä½œï¼Œä»–ä»¬å·²ç»æ„å»ºäº†&lt;a href=&#34;https://webassemblyhub.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WebAssembly Hub&lt;/a&gt;ï¼Œè¯¥æœåŠ¡ç”¨äºæ„å»ºï¼Œå…±äº«ï¼Œå‘ç°å’Œéƒ¨ç½² Wasm æ‰©å±•ã€‚ä½¿ç”¨ WebAssembly Hubï¼ŒWasm æ‰©å±•ä¸å®¹å™¨ä¸€æ ·æ˜“äºç®¡ç†ï¼Œå®‰è£…å’Œè¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è¿™é¡¹å·¥ä½œä»Šå¤©å‘å¸ƒäº† Alpha ç‰ˆæœ¬ï¼Œè¿˜æœ‰å¾ˆå¤šå·¥ä½œè¦åšï¼Œä½†æ˜¯æˆ‘ä»¬å¾ˆé«˜å…´å°†å…¶äº¤åˆ°å¼€å‘äººå‘˜æ‰‹ä¸­ï¼Œä»¥ä¾¿ä»–ä»¬å¯ä»¥å¼€å§‹å°è¯•ç”±æ­¤å¸¦æ¥çš„å·¨å¤§å¯èƒ½æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;Istio å’Œ Envoy é¡¹ç›®çš„åˆ›å»ºåŸåˆ™éƒ½æ˜¯åŸºäºå¯¹å¯æ‰©å±•æ€§çš„éœ€æ±‚ï¼Œä½†æ˜¯ä¸¤ä¸ªé¡¹ç›®é‡‡ç”¨äº†ä¸åŒçš„æ–¹æ³•ã€‚Istio é¡¹ç›®çš„é‡ç‚¹æ˜¯å¯ç”¨å…·æœ‰è½»é‡çº§å¼€å‘äººå‘˜ä½“éªŒçš„ç§°ä¸º&lt;a href=&#34;https://istio.io/docs/reference/config/policy-and-telemetry/mixer-overview/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mixer&lt;/a&gt;çš„é€šç”¨è¿›ç¨‹å¤–æ‰©å±•æ¨¡å‹ï¼Œè€Œ Envoy åˆ™ä¸“æ³¨äºä»£ç†å†…&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/extending/extending&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‰©å±•&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ç§æ–¹æ³•éƒ½æœ‰å…¶ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚Istio æ¨¡å‹å¯¼è‡´ä¸¥é‡çš„èµ„æºæ•ˆç‡ä½ä¸‹ï¼Œä»è€Œå½±å“äº†å°¾éƒ¨å»¶è¿Ÿå’Œèµ„æºåˆ©ç”¨ç‡ã€‚è¯¥æ¨¡å‹åœ¨æœ¬è´¨ä¸Šä¹Ÿå—åˆ°é™åˆ¶ - ä¾‹å¦‚ï¼Œå®ƒæ°¸è¿œä¸ä¼šä¸ºå®ç°&lt;a href=&#34;https://blog.envoyproxy.io/how-to-write-envoy-filters-like-a-ninja-part-1-d166e5abec09&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªå®šä¹‰åè®®å¤„ç†&lt;/a&gt;æä¾›æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;Envoy æ¨¡å‹å¼ºåŒ–äº†æ•´ä½“çš„æ„å»ºè¿‡ç¨‹ï¼Œå¹¶è¦æ±‚ä½¿ç”¨ C++ç¼–å†™æ‰©å±•ï¼Œä»è€Œé™åˆ¶äº†å¼€å‘äººå‘˜ç”Ÿæ€ç³»ç»Ÿã€‚ä¸ºé›†ç¾¤å‘å¸ƒæ–°çš„æ‰©å±•éœ€è¦æ¨å…¥æ–°çš„äºŒè¿›åˆ¶æ–‡ä»¶å¹¶é‡æ–°å¯åŠ¨ï¼Œè¿™å¯èƒ½å¾ˆéš¾åè°ƒï¼Œå¹¶ä¸”ä¼šé€ æˆåœæœºé£é™©ã€‚è¿™ä¹Ÿæ¿€åŠ±äº†å¼€å‘äººå‘˜å‘ Envoy ä¸Šæ¸¸æäº¤ä»–ä»¬çš„æ‰©å±•ï¼Œè€Œè¿™äº›æ‰©å±•ä»…ç”±ä¸€å°éƒ¨åˆ†ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œåªæ˜¯ä¸ºäº†è‚©è´Ÿå…¶å‘å¸ƒæœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;éšç€æ—¶é—´çš„æµé€ï¼ŒIstio çš„ä¸€äº›å¯¹æ€§èƒ½æœ€æ•æ„Ÿçš„åŠŸèƒ½å·²è¿›å…¥ Envoy çš„ä¸Šæ¸¸ï¼Œä¾‹å¦‚&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/security/rbac_filter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æµé‡ç­–ç•¥æ£€æŸ¥&lt;/a&gt;å’Œ&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/security/rbac_filter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é¥æµ‹æŠ¥å‘Š&lt;/a&gt;ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬ä¸€ç›´å¸Œæœ›å°†å•ä¸ªå †æ ˆèåˆä»¥å®ç°å¯æ‰©å±•æ€§ï¼Œä»è€Œå‡å°‘æŠ˜è¡·ï¼šè¿™ä½¿ Envoy ç‰ˆæœ¬ä¸å…¶æ‰©å±•ç”Ÿæ€ç³»ç»Ÿè„±é’©ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿä½¿ç”¨ä»–ä»¬é€‰æ‹©çš„è¯­è¨€è¿›è¡Œå·¥ä½œï¼Œå¹¶ä½¿ Istio å¯é åœ°æ¨å‡ºæ–°åŠŸèƒ½è€Œä¸ä¼šé€ æˆåœæœºé£é™©ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-webassembly&#34;&gt;ä»€ä¹ˆæ˜¯ WebAssemblyï¼Ÿ&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://webassembly.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WebAssembly&lt;/a&gt;ï¼ˆWasmï¼‰æ˜¯ä¸€ç§å¯ç§»æ¤çš„å­—èŠ‚ç æ ¼å¼ï¼Œç”¨äºä»¥æ¥è¿‘æœ¬æœºçš„é€Ÿåº¦æ‰§è¡Œä»¥&lt;a href=&#34;https://github.com/appcypher/awesome-wasm-langs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤šç§è¯­è¨€&lt;/a&gt;ç¼–å†™çš„ä»£ç ã€‚å…¶æœ€åˆçš„&lt;a href=&#34;https://webassembly.org/docs/high-level-goals/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¾è®¡ç›®æ ‡&lt;/a&gt;ä¸ä¸Šè¿°æŒ‘æˆ˜å¾ˆå¥½åœ°å»åˆï¼Œå¹¶ä¸”åœ¨å…¶èƒŒåå¾—åˆ°äº†å¯è§‚çš„è¡Œä¸šæ”¯æŒã€‚Wasm æ˜¯åœ¨æ‰€æœ‰ä¸»è¦æµè§ˆå™¨ä¸­æœ¬åœ°è¿è¡Œçš„ç¬¬å››ç§æ ‡å‡†è¯­è¨€ï¼ˆç»§ HTMLï¼ŒCSS å’Œ JavaScript ä¹‹åï¼‰ï¼Œäº 2019 å¹´ 12 æœˆæˆä¸º&lt;a href=&#34;https://www.w3.org/TR/wasm-core-1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;W3C Recommendation&lt;/a&gt;ã€‚è¿™ä½¿æˆ‘ä»¬æœ‰ä¿¡å¿ƒå¯¹å…¶è¿›è¡Œæˆ˜ç•¥ä¸‹æ³¨ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡ WebAssembly æœ€åˆæ˜¯ä½œä¸ºå®¢æˆ·ç«¯æŠ€æœ¯è€Œè¯ç”Ÿçš„ï¼Œä½†åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨å®ƒå…·æœ‰è®¸å¤šä¼˜ç‚¹ã€‚è¿è¡Œæ—¶æ˜¯å†…å­˜å®‰å…¨çš„ï¼Œå¹¶ä¸”ç»è¿‡æ²™ç›’å¤„ç†ä»¥ç¡®ä¿å®‰å…¨ã€‚æœ‰ä¸€ä¸ªå¤§å‹å·¥å…·ç”Ÿæ€ç³»ç»Ÿå¯ç”¨äºä»¥æ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ ¼å¼ç¼–è¯‘å’Œè°ƒè¯• Wasmã€‚ &lt;a href=&#34;https://www.w3.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;W3C&lt;/a&gt;å’Œ&lt;a href=&#34;https://bytecodealliance.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;BytecodeAlliance&lt;/a&gt;å·²æˆä¸ºå…¶ä»–æœåŠ¡å™¨ç«¯å·¥ä½œçš„æ´»è·ƒä¸­æ¢ã€‚ä¾‹å¦‚ï¼ŒWasm ç¤¾åŒºæ­£åœ¨ W3C æ ‡å‡†åŒ–&lt;a href=&#34;https://hacks.mozilla.org/2019/03/standardizing-wasi-a-webassembly-system-interface/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;â€œWebAssembly ç³»ç»Ÿæ¥å£â€ï¼ˆWASIï¼‰&lt;/a&gt;ï¼Œå¹¶æä¾›ä¸€ä¸ªç¤ºä¾‹å®ç°ï¼Œè¯¥ç¤ºä¾‹ä¸º Wasmâ€œç¨‹åºâ€æä¾›ç±»ä¼¼äº OS çš„æŠ½è±¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸º-envoy-å¸¦æ¥-webassembly&#34;&gt;ä¸º Envoy å¸¦æ¥ WebAssembly&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/envoyproxy/envoy/issues/4272&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨è¿‡å»çš„ 18 ä¸ªæœˆä¸­&lt;/a&gt;ï¼Œæˆ‘ä»¬ä¸€ç›´ä¸ Envoy ç¤¾åŒºåˆä½œï¼Œå°† Wasm å¯æ‰©å±•æ€§çº³å…¥ Envoy å¹¶åœ¨ä¸Šæ¸¸åšå‡ºè´¡çŒ®ã€‚æˆ‘ä»¬å¾ˆé«˜å…´åœ°å®£å¸ƒï¼Œæ­¤ç‰¹æ€§åœ¨&lt;a href=&#34;https://istio.io/news/releases/1.5.x/announcing-1.5/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio 1.5&lt;/a&gt;éšé™„çš„ Envoy ç‰ˆæœ¬ä¸­ Alpha å¯ç”¨ï¼Œå…¶æºä»£ç åŒ…å«åœ¨&lt;a href=&#34;https://github.com/envoyproxy/envoy-wasm/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;envoy-wasm&lt;/a&gt;å¼€å‘åˆ†æ”¯ä¸­ï¼Œå¹¶ä¸”æ­£åœ¨åŠªåŠ›å°†å…¶åˆå¹¶åˆ° Envoy ä¸»å¹²ä¸­ã€‚è¯¥å®ç°ä½¿ç”¨å†…ç½®åœ¨ Google é«˜æ€§èƒ½&lt;a href=&#34;https://v8.dev/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;V8 å¼•æ“&lt;/a&gt;ä¸­çš„ WebAssembly è¿è¡Œæ—¶ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†åº•å±‚çš„è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬è¿˜æ„å»ºäº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç”¨äºåœ¨ä»£ç†ä¸­åµŒå…¥ Wasm çš„é€šç”¨åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆABIï¼‰ï¼Œè¿™æ„å‘³ç€ç¼–è¯‘åçš„æ‰©å±•å°†åœ¨ä¸åŒç‰ˆæœ¬çš„ Envoy æˆ–å…¶ä»–ä»£ç†ï¼ˆå¦‚æœä»–ä»¬é€‰æ‹©å®æ–½ ABIï¼‰ä¸‹ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”¨äºåœ¨&lt;a href=&#34;https://github.com/proxy-wasm/proxy-wasm-cpp-sdk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;C++&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://github.com/proxy-wasm/proxy-wasm-rust-sdk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Rust&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/solo-io/proxy-runtime&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AssemblyScript&lt;/a&gt;ä¸­è½»æ¾è¿›è¡Œæ‰©å±•å¼€å‘çš„ SDKï¼Œè¿˜æœ‰æ›´å¤šåç»­æ›´æ–°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ‰å…³å¦‚ä½•åœ¨ Istio å’Œç‹¬ç«‹çš„ Envoy ä¸­è¿›è¡Œéƒ¨ç½²çš„ç»¼åˆ&lt;a href=&#34;https://docs.solo.io/web-assembly-hub/latest/tutorial_code/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¤ºä¾‹å’Œè¯´æ˜&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…è®¸ä½¿ç”¨å…¶ä»– Wasm è¿è¡Œæ—¶çš„æŠ½è±¡ï¼ŒåŒ…æ‹¬â€œç©ºâ€è¿è¡Œæ—¶ï¼Œè¯¥è¿è¡Œæ—¶å°†åœ¨æœ¬åœ°æŠŠæ‰©å±•ç¼–è¯‘è¿› Envoy ä¸­ï¼Œè¿™å¯¹äºæµ‹è¯•å’Œè°ƒè¯•éå¸¸æœ‰ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨ Wasm æ‰©å±• Envoy å¯ä»¥ä¸ºæˆ‘ä»¬å¸¦æ¥å‡ ä¸ªä¸»è¦å¥½å¤„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ•æ·æ€§ï¼šå¯ä»¥ä½¿ç”¨ Istio æ§åˆ¶å¹³é¢åœ¨è¿è¡Œæ—¶äº¤ä»˜å’Œé‡æ–°åŠ è½½æ‰©å±•ã€‚è¿™æ ·å¯ä»¥å¿«é€Ÿè¿›è¡Œæ‰©å±•çš„å¼€å‘â†’æµ‹è¯•â†’å‘å¸ƒå‘¨æœŸï¼Œè€Œæ— éœ€ Envoy çš„é‡å¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ ‡å‡†å‘å¸ƒï¼šåˆå¹¶åˆ°ä¸»æ ‘ä¸­ä¹‹åï¼ŒIstio å’Œå…¶ä»–äººå°†èƒ½å¤Ÿä½¿ç”¨ Envoy çš„æ ‡å‡†å‘å¸ƒï¼Œè€Œä¸æ˜¯è‡ªå®šä¹‰ç‰ˆæœ¬ã€‚è¿™ä¹Ÿå°†ä½¿ Envoy ç¤¾åŒºæœ‰æ›´å¤šçš„æ—¶é—´å°†æŸäº›å†…ç½®æ‰©å±•è¿ç§»åˆ°è¯¥æ¨¡å‹ï¼Œä»è€Œå‡å°‘å…¶å—æ”¯æŒçš„è¦†ç›–åŒºåŸŸã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯é æ€§å’Œéš”ç¦»æ€§ï¼šæ‰©å±•éƒ¨ç½²åœ¨å…·æœ‰èµ„æºé™åˆ¶çš„æ²™ç®±ä¸­ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ç°åœ¨å¯ä»¥å´©æºƒæˆ–æ³„æ¼å†…å­˜ï¼Œè€Œä¸ä¼šå½±å“ Envoy ä¸»è¿›ç¨‹ã€‚CPU å’Œå†…å­˜ä½¿ç”¨ç‡ä¹Ÿå¯ä»¥å—åˆ°é™åˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®‰å…¨æ€§ï¼šæ²™ç›’å…·æœ‰ç”¨äºä¸ Envoy è¿›è¡Œé€šä¿¡çš„æ˜ç¡®å®šä¹‰çš„ APIï¼Œå› æ­¤æ‰©å±•åªèƒ½è®¿é—®å¹¶ä¿®æ”¹è¿æ¥æˆ–è¯·æ±‚ä¸­æœ‰é™æ•°é‡çš„å±æ€§ã€‚æ­¤å¤–ï¼Œç”±äº Envoy ä¼šåè°ƒæ­¤äº¤äº’è¿‡ç¨‹ï¼Œå› æ­¤å¯ä»¥éšè—æˆ–æ¸…é™¤æ‰©å±•ä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼ŒHTTP æ ‡å¤´ä¸­çš„â€œAuthorizationâ€å’Œâ€œCookieâ€å±æ€§ï¼Œæˆ–å®¢æˆ·ç«¯çš„ IP åœ°å€ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;çµæ´»æ€§ï¼š&lt;a href=&#34;https://github.com/appcypher/awesome-wasm-langs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯ä»¥å°† 30 å¤šç§ç¼–ç¨‹è¯­è¨€ç¼–è¯‘ä¸º WebAssembly&lt;/a&gt;ï¼Œä»è€Œä½¿æ¥è‡ªå„ç§èƒŒæ™¯ï¼ˆC++ï¼ŒGoï¼ŒRustï¼ŒJavaï¼ŒTypeScript ç­‰ï¼‰çš„å¼€å‘äººå‘˜éƒ½å¯ä»¥ä½¿ç”¨ä»–ä»¬é€‰æ‹©çš„è¯­è¨€æ¥ç¼–å†™ Envoy æ‰©å±•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€œçœ‹åˆ° WASM åœ¨ Envoy ä¸­çš„æ”¯æŒï¼Œæˆ‘æ„Ÿåˆ°éå¸¸å…´å¥‹ï¼›è¿™æ˜¯ Envoy å¯æ‰©å±•æ€§çš„æœªæ¥ã€‚Envoy çš„ WASM æ”¯æŒä¸ç¤¾åŒºé©±åŠ¨ hub ç›¸ç»“åˆï¼Œå°†åœ¨æœåŠ¡ç½‘æ ¼å’Œ API ç½‘å…³ç”¨ä¾‹ä¸­é‡Šæ”¾å‡ºä»¤äººéš¾ä»¥ç½®ä¿¡çš„ç½‘ç»œé¢†åŸŸåˆ›æ–°ã€‚æˆ‘è¿«ä¸åŠå¾…åœ°æƒ³çœ‹åˆ°ç¤¾åŒºçš„å»ºè®¾å‘å‰å‘å±•ã€‚â€ â€“Envoy åˆ›ä½œè€… Matt Kleinã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å…³å®ç°çš„æŠ€æœ¯ç»†èŠ‚ï¼Œè¯·å…³æ³¨å³å°†åœ¨&lt;a href=&#34;https://blog.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy åšå®¢&lt;/a&gt;ä¸Šå‘å¸ƒçš„å¸–å­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»æœºç¯å¢ƒå’Œæ‰©å±•ä¹‹é—´çš„&lt;a href=&#34;https://github.com/proxy-wasm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Proxy-Wasm&lt;/a&gt;æ¥å£æœ‰æ„è®¾è®¡ä¸ºä¸ä»£ç†æ— å…³ã€‚æˆ‘ä»¬å·²å°†å…¶å†…ç½®åˆ° Envoy ä¸­ï¼Œä½†æ—¨åœ¨ä¾›å…¶ä»–ä»£ç†ä¾›åº”å•†é‡‡ç”¨ã€‚æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°ä¸€ä¸ªä¸–ç•Œï¼Œæ‚¨å¯ä»¥è·å–ä¸º Istio å’Œ Envoy ç¼–å†™çš„æ‰©å±•ï¼Œå¹¶åœ¨å…¶ä»–åŸºç¡€æ¶æ„ä¸­è¿è¡Œå®ƒã€‚æ‚¨å¾ˆå¿«å°±ä¼šå¬åˆ°æ›´å¤šæœ‰å…³æ­¤çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åœ¨-istio-ä¸­æ„å»º-webassembly&#34;&gt;åœ¨ Istio ä¸­æ„å»º WebAssembly&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†æé«˜æ€§èƒ½ï¼ŒIstio å°†å…¶å‡ ä¸ªæ‰©å±•ç§»åŠ¨åˆ°äº† 1.5 ç‰ˆæœ¬ä¸­å†…ç½®çš„ Envoy æ„å»ºä¸­ã€‚åœ¨æ‰§è¡Œæ­¤å·¥ä½œæ—¶ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨æµ‹è¯•ä»¥ç¡®ä¿è¿™äº›ç›¸åŒçš„æ‰©å±•å¯ä»¥ä½œä¸º Proxy-Wasm æ¨¡å—è¿›è¡Œç¼–è¯‘å’Œè¿è¡Œï¼Œè€Œè¡Œä¸ºæ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚é‰´äºæˆ‘ä»¬è®¤ä¸º Wasm ç›®å‰çš„æ”¯æŒä¸º Alphaï¼Œå› æ­¤æˆ‘ä»¬è¿˜æ²¡æœ‰å‡†å¤‡å¥½å°†æ­¤è®¾ç½®è®¾ä¸ºé»˜è®¤è®¾ç½®ã€‚ç„¶è€Œï¼Œè¿™ä½¿æˆ‘ä»¬å¯¹é€šç”¨æ–¹æ³•ä»¥åŠå·²å¼€å‘çš„ä¸»æœºç¯å¢ƒ ABI å’Œ SDK å……æ»¡äº†ä¿¡å¿ƒã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜éå¸¸å°å¿ƒåœ°ç¡®ä¿ Istio æ§åˆ¶å¹³é¢åŠå…¶&lt;a href=&#34;https://istio.io/docs/reference/config/networking/envoy-filter/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy é…ç½® API&lt;/a&gt;å¯ä»¥æ”¯æŒ Wasmã€‚æˆ‘ä»¬æœ‰ä¸€äº›ç¤ºä¾‹æ¥è¯´æ˜å¦‚ä½•æ‰§è¡Œå‡ ç§å¸¸è§çš„å®šåˆ¶æ“ä½œï¼Œä¾‹å¦‚å®šåˆ¶æ ‡å¤´è§£ç æˆ–ç¨‹åºåŒ–è·¯ç”±ï¼Œè¿™æ˜¯ç”¨æˆ·çš„å¸¸è§è¦æ±‚ã€‚å½“æˆ‘ä»¬å°†æ”¯æŒè½¬ç§»åˆ° Beta æ—¶ï¼Œæ‚¨å°†çœ‹åˆ°è¯´æ˜åœ¨ Istio ä¸­ä½¿ç”¨ Wasm çš„æœ€ä½³å®è·µçš„æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬æ­£åœ¨ä¸è®¸å¤šç¼–å†™äº†&lt;a href=&#34;https://istio.io/docs/reference/config/policy-and-telemetry/adapters/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mixer é€‚é…å™¨&lt;/a&gt;çš„ä¾›åº”å•†åˆä½œï¼Œä»¥å¸®åŠ©ä»–ä»¬è¿ç§»åˆ° Wasm â€”å¦‚æœè¿™æ˜¯å‰è¿›çš„æœ€ä½³é€”å¾„ã€‚Mixer å°†åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è½¬ä¸ºç¤¾åŒºé¡¹ç›®ï¼Œåœ¨é‚£é‡Œå®ƒå°†ä»å¯ç”¨äºé—ç•™ç”¨ä¾‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¼€å‘è€…ä½“éªŒ&#34;&gt;å¼€å‘è€…ä½“éªŒ&lt;/h2&gt;
&lt;p&gt;æ²¡æœ‰å‡ºè‰²çš„å¼€å‘äººå‘˜ä½“éªŒï¼Œå†å¼ºå¤§çš„å·¥å…·ä¹Ÿæ¯«æ— ç”¨å¤„ã€‚Solo.io&lt;a href=&#34;https://www.solo.io/blog/an-extended-and-improved-webassembly-hub-to-helps-bring-the-power-of-webassembly-to-envoy-and-istio/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ€è¿‘å®£å¸ƒ&lt;/a&gt;å‘å¸ƒ&lt;a href=&#34;https://webassemblyhub.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WebAssembly Hub&lt;/a&gt;ï¼Œè¿™æ˜¯ä¸€å¥—ç”¨äºæ„å»ºï¼Œéƒ¨ç½²ï¼Œå…±äº«å’Œå‘ç° Envoy å’Œ Istio çš„ Envoy Proxy Wasm æ‰©å±•çš„å·¥å…·å’Œå­˜å‚¨åº“ã€‚&lt;/p&gt;
&lt;p&gt;WebAssembly Hub å®Œå…¨è‡ªåŠ¨åŒ–äº†å¼€å‘å’Œéƒ¨ç½² Wasm æ‰©å±•æ‰€éœ€çš„è®¸å¤šæ­¥éª¤ã€‚ä½¿ç”¨ WebAssembly Hub å·¥å…·ï¼Œç”¨æˆ·å¯ä»¥è½»æ¾åœ°ä»¥ä»»ä½•å—æ”¯æŒçš„è¯­è¨€å°†å…¶ä»£ç ç¼–è¯‘ä¸º Wasm æ‰©å±•ã€‚ç„¶åï¼Œå¯ä»¥å°†è¿™äº›æ‰©å±•ä¸Šä¼ åˆ° Hub æ³¨å†Œè¡¨ï¼Œå¹¶ä½¿ç”¨å•ä¸ªå‘½ä»¤å°†å…¶éƒ¨ç½²å’Œå–æ¶ˆéƒ¨ç½²åˆ° Istioã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åå°ï¼ŒHub ä¼šå¤„ç†å¾ˆå¤šç»†èŠ‚é—®é¢˜ï¼Œä¾‹å¦‚å¼•å…¥æ­£ç¡®çš„å·¥å…·é“¾ï¼ŒABI ç‰ˆæœ¬éªŒè¯ï¼Œæƒé™æ§åˆ¶ç­‰ã€‚è¯¥å·¥ä½œæµç¨‹è¿˜é€šè¿‡è‡ªåŠ¨åŒ–æ‰©å±•éƒ¨ç½²ï¼Œæ¶ˆé™¤äº†è·¨ Istio æœåŠ¡ä»£ç†çš„é…ç½®æ›´æ”¹å¸¦æ¥çš„éº»çƒ¦ã€‚è¯¥å·¥å…·å¯å¸®åŠ©ç”¨æˆ·å’Œè¿ç»´äººå‘˜é¿å…ç”±äºé…ç½®é”™è¯¯æˆ–ç‰ˆæœ¬ä¸åŒ¹é…è€Œå¼•èµ·çš„æ„å¤–è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;WebAssembly Hub å·¥å…·æä¾›äº†åŠŸèƒ½å¼ºå¤§çš„ CLI å’Œä¼˜é›…ä¸”æ˜“äºä½¿ç”¨çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ã€‚WebAssembly Hub çš„ä¸€ä¸ªé‡è¦ç›®æ ‡æ˜¯ç®€åŒ–æ„å»º Wasm æ¨¡å—çš„ä½“éªŒï¼Œå¹¶ä¸ºå¼€å‘äººå‘˜æä¾›å…±äº«å’Œå‘ç°æœ‰ç”¨æ‰©å±•çš„åä½œåœºæ‰€ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æŸ¥çœ‹&lt;a href=&#34;https://docs.solo.io/web-assembly-hub/latest/tutorial_code/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¥é—¨æŒ‡å—&lt;/a&gt;ï¼Œä»¥åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ª Proxy-Wasm æ‰©å±•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸‹ä¸€æ­¥&#34;&gt;ä¸‹ä¸€æ­¥&lt;/h2&gt;
&lt;p&gt;é™¤äº†åŠªåŠ›å‘å¸ƒ Beta ç‰ˆï¼Œæˆ‘ä»¬è¿˜è‡´åŠ›äºç¡®ä¿å›´ç»• Proxy-Wasm æœ‰ä¸€ä¸ªæŒä¹…çš„ç¤¾åŒºã€‚ABI éœ€è¦æœ€ç»ˆç¡®å®šï¼Œè€Œå°†å…¶è½¬å˜ä¸ºæ ‡å‡†çš„å·¥ä½œå°†ä¼šåœ¨é€‚å½“çš„æ ‡å‡†æœºæ„å†…è·å¾—æ›´å¹¿æ³›çš„åé¦ˆåå®Œæˆã€‚å‘ Envoy ä¸»å¹²æä¾›ä¸Šæ¸¸æ”¯æŒçš„å·¥ä½œä»åœ¨è¿›è¡Œä¸­ã€‚æˆ‘ä»¬è¿˜åœ¨ä¸ºå·¥å…·å’Œ WebAssembly Hub å¯»æ‰¾åˆé€‚çš„ç¤¾åŒºä¹‹å®¶ã€‚&lt;/p&gt;
&lt;p&gt;åŸæ–‡ï¼š&lt;a href=&#34;https://istio.io/blog/2020/wasm-announce/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Redefining extensibility in proxies - introducing WebAssembly to Envoy and Istio&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>istio æ•°æ®é¢æ—¥å¿—è°ƒè¯•</title>
      <link>https://cloudnative.to/blog/istio-debug-with-envoy-log/</link>
      <pubDate>Tue, 18 Feb 2020 11:29:01 +0800</pubDate>
      <guid>https://cloudnative.to/blog/istio-debug-with-envoy-log/</guid>
      <description>&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;è¿™æ˜¯ä½¿ç”¨ istio æœ€å¸¸è§çš„å›°å¢ƒï¼šåœ¨å¾®æœåŠ¡ä¸­å¼•å…¥ envoy ä½œä¸ºä»£ç†åï¼Œå½“æµé‡è®¿é—®å’Œé¢„æœŸè¡Œä¸ºä¸ç¬¦æ—¶ï¼Œç”¨æˆ·å¾ˆéš¾å¿«é€Ÿç¡®å®šé—®é¢˜æ˜¯å‡ºåœ¨å“ªä¸ªç¯èŠ‚ã€‚å®¢æˆ·ç«¯æ”¶åˆ°çš„å¼‚å¸¸å“åº”ï¼Œè¯¸å¦‚ 403ã€404ã€503 æˆ–è€…è¿æ¥ä¸­æ–­ç­‰ï¼Œå¯èƒ½æ˜¯é“¾è·¯ä¸­ä»»ä¸€ sidecar æ‰§è¡Œæµé‡ç®¡æ§çš„ç»“æœï¼Œä½†ä¹Ÿæœ‰å¯èƒ½æ˜¯æ¥è‡ªæŸä¸ªæœåŠ¡çš„åˆç†é€»è¾‘å“åº”ã€‚&lt;/p&gt;
&lt;p&gt;ç‰¹åˆ«çš„ï¼Œå½“ service mesh ç³»ç»Ÿçš„ç»´æŠ¤è€…å’Œåº”ç”¨ç¨‹åºçš„å¼€å‘è€…æ¥è‡ªä¸åŒçš„å›¢é˜Ÿæ—¶ï¼Œé—®é¢˜å°¤ä¸ºå‡¸æ˜¾ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ mesh ä¸­å¼•å…¥å…¨é“¾è·¯è·Ÿè¸ªç³»ç»Ÿï¼Œå¯ä»¥è§£å†³éƒ¨åˆ†é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è¯·æ±‚åˆ°è¾¾äº†å“ªäº›å·¥ä½œè´Ÿè½½ï¼Œä½†æ˜¯å¯¹äºä¸­æ–­çš„å¼‚å¸¸è¯·æ±‚ï¼Œæˆ‘ä»¬ä»ç„¶å¾ˆéš¾ç¡®å®šåŸå› ã€‚å› ä¸ºæœ¬ç€æœ€å¤§é€æ˜åŒ–ï¼ˆMaximize Transparencyï¼‰çš„&lt;a href=&#34;https://istio.io/docs/ops/deployment/architecture/#design-goals&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¾è®¡ç›®æ ‡&lt;/a&gt;ï¼Œistio çš„é¥æµ‹ç³»ç»Ÿä¼šå°½é‡å±è”½æ‰ sidecar çš„å­˜åœ¨ã€‚å¦ä¸€æ–¹é¢ï¼Œç”¨æˆ·è‡ªè¡Œç»´æŠ¤ä¸€å¥—å…¨é“¾è·¯è·Ÿè¸ªç³»ç»Ÿæˆæœ¬ä¹Ÿå¾ˆé«˜ï¼Œå—é™äºé¥æµ‹é‡‡æ ·ç‡å’Œæœ‰é™çš„åè®®æ”¯æŒï¼Œæˆ‘ä»¬é€šå¸¸æ— æ³•é‡‡é›†æ‰€æœ‰é“¾è·¯æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å¹¸è¿çš„æ˜¯ï¼Œenvoy æœ¬èº«å¯ä»¥è®°å½•æµé‡çš„ä¿¡æ¯ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•åˆ©ç”¨ envoy æ—¥å¿—ï¼Œå¯¹ç±»ä¼¼é—®é¢˜è¿›è¡Œå®šä½ã€‚&lt;/p&gt;
&lt;p&gt;demo ç¯å¢ƒä¸ºè…¾è®¯äº‘ TKEï¼Œistio ç‰ˆæœ¬ 1.4.3ï¼Œä»£ç å½’æ¡£äºï¼š&lt;a href=&#34;https://github.com/zhongfox/envoy-log-demo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github.com/zhongfox/envoy-log-demo&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;envoy-æµé‡æ¨¡å‹&#34;&gt;Envoy æµé‡æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆçœ‹çœ‹ envoy çš„æµé‡æ¨¡å‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç›‘å¬ï¼Œæ¥å—è¿æ¥&lt;/li&gt;
&lt;li&gt;æ ¹æ®ç”¨æˆ·æµé‡æ“çºµè§„åˆ™ï¼Œè¿›è¡Œæµé‡ç‰¹å¾è¯†åˆ«&lt;/li&gt;
&lt;li&gt;è¿›è¡Œæµé‡æ“çºµï¼Œå¦‚è´Ÿè½½å‡è¡¡ï¼Œè½¬å‘ï¼Œæ‹’ç»ç­‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨ä»¥ä¸Šæµç¨‹ä¸­ï¼ŒEnvoy æ¥å—è¯·æ±‚æµé‡å«åš &lt;strong&gt;Downstream&lt;/strong&gt;ï¼ŒEnvoy å‘å‡ºè¯·æ±‚æµé‡å«åš&lt;strong&gt;Upstream&lt;/strong&gt;ã€‚åœ¨å¤„ç† Downstream å’Œ Upstream è¿‡ç¨‹ä¸­ï¼Œåˆ†åˆ«ä¼šæ¶‰åŠ 2 ä¸ªæµé‡ç«¯ç‚¹ï¼Œå³è¯·æ±‚çš„å‘èµ·ç«¯å’Œæ¥æ”¶ç«¯ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20200212134617057&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2020-02-12-054619.png&#34; alt=&#34;image-20200212134617057&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20200212134617057
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œenvoy ä¼šæ ¹æ®ç”¨æˆ·è§„åˆ™ï¼Œè®¡ç®—å‡ºç¬¦åˆæ¡ä»¶çš„è½¬å‘ç›®çš„ä¸»æœºé›†åˆï¼Œè¿™ä¸ªé›†åˆå«åš &lt;strong&gt;UPSTREAM_CLUSTER&lt;/strong&gt;,  å¹¶æ ¹æ®è´Ÿè½½å‡è¡¡è§„åˆ™ï¼Œä»è¿™ä¸ªé›†åˆä¸­é€‰æ‹©ä¸€ä¸ª host ä½œä¸ºæµé‡è½¬å‘çš„æ¥æ”¶ç«¯ç‚¹ï¼Œè¿™ä¸ª host å°±æ˜¯ &lt;strong&gt;UPSTREAM_HOST&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯ envoy è¯·æ±‚å¤„ç†çš„ &lt;strong&gt;æµé‡äº”å…ƒç»„ä¿¡æ¯&lt;/strong&gt;ï¼Œè¿™æ˜¯ envoy æ—¥å¿—é‡Œæœ€é‡è¦çš„éƒ¨åˆ†ï¼Œé€šè¿‡è¿™ä¸ªäº”å…ƒç»„æˆ‘ä»¬å¯ä»¥å‡†ç¡®çš„è§‚æµ‹æµé‡ã€Œä»å“ªé‡Œæ¥ã€å’Œã€Œåˆ°å“ªé‡Œå»ã€ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;UPSTREAM_CLUSTER&lt;/li&gt;
&lt;li&gt;DOWNSTREAM_REMOTE_ADDRESS&lt;/li&gt;
&lt;li&gt;DOWNSTREAM_LOCAL_ADDRESS&lt;/li&gt;
&lt;li&gt;UPSTREAM_LOCAL_ADDRESS&lt;/li&gt;
&lt;li&gt;UPSTREAM_HOST&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;helloworld-example&#34;&gt;Helloworld example&lt;/h2&gt;
&lt;p&gt;åœ¨ istio åœºæ™¯ä¸­ï¼Œenvoy æ—¢å¯ä»¥æ˜¯æ­£å‘ä»£ç†ï¼Œä¹Ÿå¯ä»¥æ˜¯åå‘ä»£ç†ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œå¦‚æœ envoy å¤„ç†çš„æ˜¯ outbound æµé‡ï¼Œä¸šåŠ¡å®¹å™¨æ˜¯ä½œä¸º Downstream ç«¯ç‚¹ï¼ˆå³è¾¹ï¼‰ï¼›å¦‚æœ envoy å¤„ç†çš„æ˜¯ inbound æµé‡ï¼Œä¸šåŠ¡å®¹å™¨æ˜¯ä½œä¸º Upstream ç«¯ç‚¹ï¼ˆå·¦è¾¹ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;istio ä¸­é»˜è®¤ä¸å¼€å¯ envoy ä¸­çš„è®¿é—®æ—¥å¿—ï¼Œéœ€è¦æ‰‹åŠ¨æ‰“å¼€ï¼Œå°† istio é…ç½®ä¸­ &lt;code&gt;accessLogFile&lt;/code&gt; è®¾ç½®ä¸º &lt;code&gt;/dev/stdout&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;% kubectl -n istio-system edit cm istio&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Set accessLogFile to empty string to disable access log.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;accessLogFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/dev/stdout&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å¼€å¯æ—¥å¿—&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;accessLogEncoding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;JSON&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# é»˜è®¤æ—¥å¿—æ˜¯å•è¡Œæ ¼å¼ï¼Œå¯é€‰è®¾ç½®ä¸º JSON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä»¥ sleep pod è®¿é—® hello æœåŠ¡æ¥ä¸¾ä¾‹è¯´æ˜ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f sleep-hello.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  id=&#34;figure-image-20200212222251433&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2020-02-12-142255.png&#34; alt=&#34;image-20200212222251433&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20200212222251433
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¯¥æ–‡ä»¶å®šä¹‰äº† 2 ä¸ªç‰ˆæœ¬çš„ helloworld å’Œä¸€ä¸ª sleep Podï¼Œhelloworld service çš„ç«¯å£æ˜¯ 4000ï¼Œè€Œ pod çš„ç«¯å£æ˜¯ 5000ã€‚&lt;/p&gt;
&lt;p&gt;ä» sleep Pod ä¸­å»è®¿é—® helloworld æœåŠ¡ï¼Œç¡®è®¤åº”ç”¨æ­£å¸¸ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% &lt;span class=&#34;nv&#34;&gt;SLEEP_POD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sleep -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[0].metadata.name}&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% &lt;span class=&#34;nv&#34;&gt;HELLO_V1_POD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;helloworld -l &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1 -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[0].metadata.name}&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it &lt;span class=&#34;nv&#34;&gt;$SLEEP_POD&lt;/span&gt; -csleep -- sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/ &lt;span class=&#34;c1&#34;&gt;# curl helloworld:4000/hello&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥å»åˆ†æ 2 ä¸ª pod å„è‡ªçš„ envoy æ—¥å¿—ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20200212222055391&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2020-02-12-142111.png&#34; alt=&#34;image-20200212222055391&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20200212222055391
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç”¨ä¸€å¼ å›¾æ¥è¯´æ˜ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20200218100343328&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2020-02-18-020347.png&#34; alt=&#34;image-20200218100343328&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20200218100343328
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»æ—¥å¿—ä¸­æˆ‘ä»¬å¯ä»¥åˆ†æå‡ºï¼š&lt;/p&gt;
&lt;p&gt;å¯¹äº sleep podï¼Œsleep app å‘å‡ºçš„æµé‡ç›®çš„ç«¯æ˜¯ hello service ip å’Œ service portï¼Œsleep envoy å¤„ç†çš„æ˜¯ outbound æµé‡ï¼Œenvoy æ ¹æ®è§„åˆ™é€‰æ‹©çš„ã€ŒUPSTREAM_CLUSTERã€æ˜¯&lt;code&gt;outbound|4000||helloworld.default.svc.cluster.local&lt;/code&gt;, ç„¶åè½¬å‘ç»™å…¶ä¸­çš„ä¸€ä¸ªã€ŒUPSTREAM_HOSTã€, ä¹Ÿå°±æ˜¯ hello pod çš„ ip å’Œ portã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº hello podï¼Œå…¶ envoy å¤„ç†çš„æ˜¯ inbound æµé‡ï¼Œenvoy æ ¹æ®è§„åˆ™é€‰æ‹©çš„ã€ŒUPSTREAM_CLUSTERã€æ˜¯&lt;code&gt;inbound|4000|http|helloworld.default.svc.cluster.local&lt;/code&gt;, å…¶ä¸­çš„ã€ŒUPSTREAM_HOSTã€æ˜¯ã€Œ127.0.0.1:5000ã€, ä¹Ÿå°±æ˜¯è¯¥ pod é‡Œçš„ hello appã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡º istio ä¸­æµé‡ç«¯ç‚¹å€¼çš„é€»è¾‘è§„åˆ™ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UPSTREAM_HOST&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šæ¸¸ä¸»æœºçš„ hostï¼Œè¡¨ç¤ºä» envoy å‘å‡ºçš„è¯·æ±‚çš„ç›®çš„ç«¯ï¼Œé€šå¸¸æ˜¯ã€Œip:portã€&lt;/p&gt;
&lt;p&gt;é€šå¸¸æ¥è¯´ï¼Œå¯¹äº outbound clusterï¼Œæ­¤å€¼æ˜¯ã€Œä¸Šæ¸¸ pod-ip : pod-portã€ ï¼Œè€Œå¯¹äº inbound  clusterï¼Œæ­¤å€¼æ˜¯ã€Œ127.0.0.1 : pod-portã€&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UPSTREAM_LOCAL_ADDRESS&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šæ¸¸è¿æ¥ä¸­ï¼Œå½“å‰ envoy çš„æœ¬åœ°åœ°å€ï¼Œæ­¤å€¼æ˜¯ã€Œå½“å‰ pod-ip : éšæœºç«¯å£ã€&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DOWNSTREAM_LOCAL_ADDRESS&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹æ¸¸è¿æ¥ä¸­ï¼Œå½“å‰ envoy çš„æœ¬åœ°åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸æ¥è¯´ï¼Œå¯¹äº outbound clusterï¼Œæ­¤å€¼æ˜¯ã€Œç›®çš„ service-ip : service-portã€ï¼Œè€Œå¯¹äº inbound  clusterï¼Œæ­¤å€¼æ˜¯ã€Œå½“å‰ pod-ip : pod-portã€&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DOWNSTREAM_REMOTE_ADDRESS&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹æ¸¸è¿æ¥ä¸­è¿œç«¯åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸æ¥è¯´ï¼Œå¯¹äº outbound clusterï¼Œæ­¤å€¼æ˜¯ã€Œå½“å‰ pod-ip : éšæœºç«¯å£ã€ï¼Œè€Œå¯¹äº inbound  clusterï¼Œæ­¤å€¼æ˜¯ã€Œä¸‹æ¸¸ pod-ip : éšæœºç«¯å£ã€&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;envoy-æ—¥å¿—æ ¼å¼&#34;&gt;Envoy æ—¥å¿—æ ¼å¼&lt;/h2&gt;
&lt;p&gt;envoy å…è®¸å®šåˆ¶æ—¥å¿—æ ¼å¼ï¼Œæ ¼å¼é€šè¿‡è‹¥å¹²ã€ŒCommand Operatorsã€ç»„åˆï¼Œç”¨äºæå–è¯·æ±‚ä¿¡æ¯ï¼Œistio æ²¡æœ‰ä½¿ç”¨ envoy é»˜è®¤çš„æ—¥å¿—æ ¼å¼ï¼Œistio å®šåˆ¶çš„è®¿é—®æ—¥å¿—æ ¼å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20200205002607125&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2020-02-04-162610.png&#34; alt=&#34;image-20200205002607125&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20200205002607125
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å®Œæ•´çš„ã€ŒCommand Operatorsã€å«ä¹‰å¯æŸ¥é˜… &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log#command-operators&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Access logging Command Operators&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é™¤äº†ä»¥ä¸Šæµé‡äº”å…ƒç»„ï¼Œæµé‡åˆ†æä¸­å¸¸ç”¨çš„é‡è¦ä¿¡æ¯è¿˜æœ‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;RESPONSE_CODE&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å“åº”çŠ¶æ€ç &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;RESPONSE_FLAGS&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¾ˆé‡è¦çš„ä¿¡æ¯ï¼Œenvoy ä¸­è‡ªå®šä¹‰çš„å“åº”æ ‡å¿—ä½ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ envoy é™„åŠ çš„æµé‡çŠ¶æ€ç ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ã€ŒNRã€è¡¨ç¤ºæ‰¾ä¸åˆ°è·¯ç”±ï¼Œã€ŒUHã€è¡¨ç¤º upstream cluster ä¸­æ²¡æœ‰å¥åº·çš„ hostï¼Œã€ŒRLã€è¡¨ç¤ºè§¦å‘ rate limitï¼Œã€ŒUOã€è§¦å‘æ–­è·¯å™¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;RESPONSE_FLAGS&lt;/code&gt;  å¯é€‰å€¼æœ‰åå‡ ä¸ªï¼Œè¿™äº›ä¿¡æ¯åœ¨è°ƒè¯•ä¸­éå¸¸å…³é”®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;X-REQUEST-ID&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸€æ¬¡ C åˆ° S çš„ http è¯·æ±‚ï¼Œenvoy ä¼šåœ¨ C ç«¯ç”Ÿäº§ request idï¼Œå¹¶é™„åŠ åˆ° header ä¸­ï¼Œä¼ é€’åˆ° S ç«¯ï¼Œåœ¨ 2 ç«¯çš„æ—¥å¿—ä¸­éƒ½ä¼šè®°å½•è¯¥å€¼ï¼Œå› æ­¤å¯ä»¥é€šè¿‡è¿™ä¸ª ID å…³è”è¯·æ±‚çš„ä¸Šä¸‹æ¸¸ã€‚æ³¨æ„ä¸è¦å’Œå…¨é“¾è·¯è·Ÿè¸ªä¸­çš„ trace id æ··æ·†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ROUTE_NAME&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åŒ¹é…æ‰§è¡Œçš„è·¯ç”±åç§°&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;åœºæ™¯ä¸€åˆ¤æ–­å¼‚å¸¸è¿”å›æ˜¯æ¥è‡ªä¸šåŠ¡è¿˜æ˜¯-sidecar&#34;&gt;åœºæ™¯ä¸€ï¼šåˆ¤æ–­å¼‚å¸¸è¿”å›æ˜¯æ¥è‡ªä¸šåŠ¡è¿˜æ˜¯ sidecarï¼Ÿ&lt;/h2&gt;
&lt;p&gt;æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›æ‰€æœ‰è¯·æ±‚ helloworld éƒ½è·¯ç”±åˆ° v1 ç‰ˆæœ¬ï¼Œåˆ›å»ºå¯¹åº”çš„ virtual serviceï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl apply -f hello-v1-virtualservice.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;helloworld&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä» sleep ä¸­è®¿é—®å‘ç°å“åº” 503ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20200212222518280&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2020-02-12-142520.png&#34; alt=&#34;image-20200212222518280&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20200212222518280
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰ä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬å¾ˆéš¾åˆ¤æ–­ 503 æ˜¯æ¥è‡ªä¸šåŠ¡å®¹å™¨è¿˜æ˜¯ sidecarï¼ŒæŸ¥çœ‹ sleep å’Œ hello çš„ envoy æ—¥å¿—ï¼Œå¯ä»¥å‘ç°ï¼šhello pod çš„ envoy æ²¡æœ‰æ¥å—åˆ°è¯·æ±‚ï¼Œsleep pod çš„ envoy é‡Œæ—¥å¿—ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20200212222631659&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2020-02-12-142634.png&#34; alt=&#34;image-20200212222631659&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20200212222631659
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…¶ä¸­&lt;code&gt;&amp;quot;response_flags&amp;quot;: &amp;quot;NR&amp;quot;&lt;/code&gt;  è¡¨ç¤ºã€ŒNo route configuredã€ï¼Œä¹Ÿå°±æ˜¯ envoy æ‰¾ä¸åˆ°è·¯ç”±ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­å‡ºè¯¥å¼‚å¸¸æ˜¯æœ‰ envoy è¿”å›ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ç®€å•çš„åˆ†æå°±å¯ä»¥æ‰¾åˆ°åŸå› ï¼Œæˆ‘ä»¬åœ¨ VirtualService ä¸­ä½¿ç”¨çš„ Destination æ²¡æœ‰å®šä¹‰ï¼Œå°†å…¶è¡¥ä¸Šï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl apply -f hello-v1-destinationrule.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subsets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æ¬¡è®¿é—®è¯·æ±‚æ­£å¸¸ï¼Œæ—¥å¿—ä¸­&lt;code&gt;response_flags&lt;/code&gt; ä¸ºç©ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20200212222913583&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2020-02-12-142915.png&#34; alt=&#34;image-20200212222913583&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20200212222913583
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;åœºæ™¯äºŒè°ƒè¯•-istio-mtls-ç¥å‘&#34;&gt;åœºæ™¯äºŒï¼šè°ƒè¯• istio mTLS ç¥å‘&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨ç°æœ‰ç¯å¢ƒä¸­å¼€å¯ mTLS: åœ¨ istio-system namespace ä¸­é…ç½® mTLS æ‰€éœ€ meshpolicy å’Œ destinationruleï¼Œåˆ†åˆ«ä»£è¡¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å¼€å¯ mTLSï¼ˆçœç•¥ äº† istio-policy istio-telemetry ç›¸å…³çš„è°ƒæ•´ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl -n istio-system apply -f mtls-init.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meshpolicy.authentication.istio.io/default configured
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destinationrule.networking.istio.io/default created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;authentication.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;MeshPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;peers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;mtls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;*.local&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ISTIO_MUTUAL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç‰‡åˆ»åï¼Œsleep å†æ¬¡è®¿é—® helloworld å‡ºç°&lt;code&gt;connection termination&lt;/code&gt;å¼‚å¸¸ï¼Œsleep envoy ä¸­æœ‰å¦‚ä¸‹æ—¥å¿—ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20200212123932832&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2020-02-12-060832.png&#34; alt=&#34;image-20200212123932832&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20200212123932832
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Sleep envoy &lt;code&gt;&amp;quot;response_flags&amp;quot;: &amp;quot;UC&amp;quot;&lt;/code&gt; è¡¨ç¤º Upstream ç«¯ç»ˆæ­¢äº†è¿æ¥ï¼Œ &lt;code&gt;&amp;quot;upstream_host&amp;quot;: &amp;quot;172.16.0.15:5000&amp;quot;&lt;/code&gt;å¯ä»¥çœ‹å‡ºæµé‡æ˜¯å‘å¾€äº† helloworld v1 podï¼Œè¿›è€ŒæŸ¥çœ‹ helloworld pod envoy æ—¥å¿—ï¼Œå‘ç°å±…ç„¶æ²¡æœ‰æ—¥å¿—ï¼&lt;/p&gt;
&lt;p&gt;ä¸€æ—¶é—´æˆ‘ä»¬æ²¡æ³•åˆ¤æ–­æµé‡æ˜¯å› ä½•ç»ˆæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å¼€å¯æ›´é«˜çº§åˆ«çš„æ—¥å¿—è®°å½•ï¼Œenvoy é»˜è®¤çš„æ—¥å¿—çº§åˆ«æ˜¯ warningï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´ä¸º debug æˆ–è€… traceã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ istio ä¸­ æœ‰ 2 ç§æ–¹å¼è°ƒæ•´ envoy æ—¥å¿—çº§åˆ«ï¼Œç¬¬ä¸€ç§æ˜¯åœ¨ istio å…¨å±€é…ç½®ä¸­è°ƒæ•´ï¼Œè¿™ä¼šä¿®æ”¹ mesh ä¸­æ‰€æœ‰ envoy çš„æ—¥å¿—çº§åˆ«ï¼Œç¬¬äºŒç§æ–¹å¼ï¼Œå¦‚æœå·²ç»çŸ¥é“è°ƒè¯•çš„ç›®æ ‡ Podï¼Œæˆ‘ä»¬å¯ä»¥ç»™è¯¥ pod envoy ä¸‹å‘æŒ‡ä»¤ï¼Œåªä¿®æ”¹ç›®æ ‡ envoy çš„æ—¥å¿—çº§åˆ«ã€‚&lt;/p&gt;
&lt;p&gt;ç™»å½• helloworld podï¼Œé€šè¿‡ admin api å°†æ—¥å¿—çº§åˆ«æ”¹ä¸º debugï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it &lt;span class=&#34;nv&#34;&gt;$HELLO_V1_POD&lt;/span&gt; -chelloworld -- sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# curl -XPOST http://localhost:15000/logging\?level\=info&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šæ“ä½œä¼šæ”¹åŠ¨è¿™ä¸ª envoy çš„æ‰€æœ‰æ—¥å¿—ç›®æ ‡ï¼Œè¿˜å¯ä»¥åªä¿®æ”¹æŒ‡å®šç›®æ ‡çš„æ—¥å¿—çº§åˆ«ï¼Œä»¥å‡å°‘æ—¥å¿—é‡ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -XPOST http://localhost:15000/logging&lt;span class=&#34;se&#34;&gt;\?&lt;/span&gt;filter&lt;span class=&#34;se&#34;&gt;\=&lt;/span&gt;debug
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -XPOST http://localhost:15000/logging&lt;span class=&#34;se&#34;&gt;\?&lt;/span&gt;conn_handler&lt;span class=&#34;se&#34;&gt;\=&lt;/span&gt;debug
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -XPOST http://localhost:15000/logging&lt;span class=&#34;se&#34;&gt;\?&lt;/span&gt;connection&lt;span class=&#34;se&#34;&gt;\=&lt;/span&gt;debug
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -XPOST http://localhost:15000/logging&lt;span class=&#34;se&#34;&gt;\?&lt;/span&gt;router&lt;span class=&#34;se&#34;&gt;\=&lt;/span&gt;debug
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæµé‡çš„ç¡®åˆ°è¾¾äº† helloworldï¼Œä½†æ˜¯åœ¨ TLS æ¡æ‰‹é˜¶æ®µå‘ç”Ÿäº†é”™è¯¯ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20200212131616274&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2020-02-12-061445.png&#34; alt=&#34;image-20200212131616274&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20200212131616274
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿›ä¸€æ­¥åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ˜¯å› ä¸ºæœåŠ¡ç«¯ï¼ˆhelloworldï¼‰å¼€å¯äº† mTLSï¼Œä½†æ˜¯å®¢æˆ·ç«¯ï¼ˆsleepï¼‰å´æ²¡æœ‰å¼€å¯ï¼Œä¸ºä»€ä¹ˆ istio-system ä¸­çš„ default destination rule æ²¡æœ‰èµ·ä½œç”¨ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åŸæ¥æˆ‘ä»¬åœ¨ä¸Šä¸€ä¸ª demo ä¸­å¢åŠ çš„ helloworld DestinationRule ä¸­ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰ mTLS å®šä¹‰ï¼ˆæ‰€ä»¥ä¸å¼€å¯ mTLSï¼‰ï¼Œè¿™ä¸ª DR ä¼šåœ¨ helloworld pod ä¸­è¦†ç›– istio-system ä¸­çš„ default destination ruleã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨ helloworld DestinationRule ä¸­è¡¥å…… mTLS é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl apply -f hello-v1-destinationrule-with-mtls.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ISTIO_MUTUAL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subsets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æ¬¡æµ‹è¯•ï¼Œè®¿é—®æ­£å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§ istio mTLS ç”¨æˆ·æ¥å£æåº¦ä¸å‹å¥½ï¼Œè™½ç„¶ mTLS é»˜è®¤åšåˆ°äº†å…¨å±€é€æ˜ï¼Œä¸šåŠ¡æ„ŸçŸ¥ä¸åˆ° mTLS çš„å­˜åœ¨ï¼Œä½†æ˜¯ä¸€æ—¦ä¸šåŠ¡å®šä¹‰äº† DestinationRuleï¼ŒDestinationRule å°±å¿…é¡»è¦çŸ¥é“å½“å‰ mTLS æ˜¯å¦å¼€å¯ï¼Œå¹¶ä½œå‡ºè°ƒæ•´ã€‚è¯•æƒ³ mTLS é…ç½®äº¤ç”±å®‰å…¨å›¢é˜Ÿè´Ÿè´£ï¼Œè€Œä¸šåŠ¡å›¢é˜Ÿè´Ÿè´£å„è‡ªçš„ DestinationRuleï¼Œ2 ä¸ª å›¢é˜Ÿçš„è€¦åˆä¼šéå¸¸ä¸¥é‡ã€‚&lt;/p&gt;
&lt;p&gt;istio å®˜æ–¹åœ¨&lt;a href=&#34;https://istio.io/docs/tasks/security/authentication/authn-policy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡æ¡£&lt;/a&gt;é‡Œåšäº†æç¤ºï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Donâ€™t forget that destination rules are also used for non-auth reasons such as setting up canarying, but the same order of precedence applies. So if a service requires a specific destination rule for any reason - for example, for a configuration load balancer - the rule must contain a similar TLS block with &lt;code&gt;ISTIO_MUTUAL&lt;/code&gt; mode, as otherwise it will override the mesh- or namespace-wide TLS settings and disable TLS.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç¤¾åŒºä¹Ÿæœ‰å¯¹è¿™å—çš„å®ç°è¿›è¡Œåæ€å’Œé‡æ–°è®¾è®¡ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20200212133704748&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2020-02-12-061458.png&#34; alt=&#34;image-20200212133704748&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20200212133704748
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœªæ¥ç‰ˆæœ¬ä¸­æˆ‘ä»¬åº”è¯¥å¯ä»¥çœ‹åˆ° mTLS å®šä¹‰çš„ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;å°ç»“&#34;&gt;å°ç»“&lt;/h2&gt;
&lt;p&gt;envoy æ—¥å¿—è®°å½•äº† mesh ä¸­æµé‡èµ°å‘å’Œç‰¹å¾çš„å…³é”®ä¿¡æ¯ï¼Œæ˜¯æ•°æ®é¢é—®é¢˜è°ƒè¯•çš„åˆ©å™¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæµé‡é—®é¢˜çš„æ’æŸ¥è¿˜å¯ä»¥åˆ†æ xDS å†…å®¹ï¼Œä»¥åŠ istio å®˜æ–¹çš„å‘½ä»¤è¡Œå·¥å…· istioctl ç­‰ç­‰ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes ä¸Šçš„ Service Mesh å®è·µï¼šç”¨ EnvoyFilter æ‰©å±• Istio</title>
      <link>https://cloudnative.to/blog/using-envoyfilter-extend-istio/</link>
      <pubDate>Thu, 05 Sep 2019 10:30:10 +0800</pubDate>
      <guid>https://cloudnative.to/blog/using-envoyfilter-extend-istio/</guid>
      <description>&lt;p&gt;KUNï¼ˆä¸­æ–‡åé²²ï¼‰æ˜¯ UCloud é¢å‘å†…éƒ¨çš„åŸºäº Kubernetes çš„èµ„æºäº¤ä»˜å¹³å°ï¼Œæä¾›ç›‘æ§å‘Šè­¦ã€CI/CDã€ç½‘ç»œåŒæ ˆã€Service Mesh ç­‰èƒ½åŠ›ã€‚åœ¨è·µè¡Œ Service Mesh ç†å¿µçš„è¿‡ç¨‹ä¸­ï¼Œé¢å¯¹ Istio çš„ä¸è¶³ï¼Œå›¢é˜Ÿé’ˆå¯¹å…¶æºç åšäº†å¤§é‡æ”¹è¿›ï¼ŒåŒ…æ‹¬ç»™ç½‘ç»œå­ç³»ç»Ÿ Pilot ä¸‹çš„èµ„æºåšéš”ç¦»ï¼Œå¯¹ EnvoyFilter åšæ·±åº¦ä¼˜åŒ–ç­‰ï¼Œä½¿å…¶èƒ½åœ¨ç”Ÿäº§ç¯å¢ƒç¨³å®šè¿è¡Œï¼Œå¹¶æä¾›å¼ºå¤§çš„æ‰©å±•èƒ½åŠ›ã€‚æˆªæ­¢ç›®å‰ï¼ŒKUN å¹³å°ä¸Šå·²æœ‰ 175 ä¸ªåº”ç”¨é€šè¿‡ Istio æä¾›æœåŠ¡ã€‚ä¸‹é¢å°†åˆ†äº«æˆ‘ä»¬åœ¨è¿™æ–¹é¢çš„å®è·µç»éªŒã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-æµé‡ç®¡ç†ç­–ç•¥&#34;&gt;Istio æµé‡ç®¡ç†ç­–ç•¥&lt;/h2&gt;
&lt;p&gt;Istio ä¸­çš„æµé‡ç®¡ç†ç­–ç•¥æ˜¯é€šè¿‡ Pilot ç»Ÿä¸€ç®¡ç†ä¸‹å‘ç»™ Envoy çš„ï¼ŒEnvoy ä½œä¸ºæ•°æ®é¢ï¼Œå¯¹å¤–æä¾› XDS æ¥å£ã€‚ä¸ºäº†ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼ŒPilot å®ç°äº† Envoy æä¾›çš„ ADS(Aggregated Discovery Service) æ¥å£ï¼Œæ‰§è¡Œé¡ºåºä¸ºï¼šCDS, EDS, LDS, RDSã€‚Pilot æœ¬èº«æ˜¯æ— çŠ¶æ€çš„ï¼Œæ‰€æœ‰çš„èµ„æºé…ç½®å…¨éƒ¨ä»¥ CRD å®ä¾‹çš„å½¢å¼ä¿å­˜åœ¨ Kubernetes é›†ç¾¤ä¸Šï¼ŒEnvoy å’Œ Pilot è¿æ¥å»ºç«‹å®Œæˆä»¥åï¼ŒPilot ä»¥äº‹ä»¶é€šçŸ¥çš„å½¢å¼è§¦å‘æ¨é€ï¼ŒEnvoy é…ç½®æ›´æ–°ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/using-envoyfilter-extend-istio/ads_hu9e76d7824c58b107998995538d53d391_141975_a23bd774ac8a9e1f011f5841156a5f49.webp 400w,
               /blog/using-envoyfilter-extend-istio/ads_hu9e76d7824c58b107998995538d53d391_141975_c9c31c51a274b1446f6f293877dc26b9.webp 760w,
               /blog/using-envoyfilter-extend-istio/ads_hu9e76d7824c58b107998995538d53d391_141975_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/using-envoyfilter-extend-istio/ads_hu9e76d7824c58b107998995538d53d391_141975_a23bd774ac8a9e1f011f5841156a5f49.webp&#34;
               width=&#34;760&#34;
               height=&#34;709&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç»Ÿä¸€çš„é…ç½®ç®¡ç†ç®€åŒ–äº†è¿ç»´æˆæœ¬ï¼ŒåŒæ—¶ä¹Ÿæ„å‘³ç€å®šåˆ¶åŒ–èƒ½åŠ›çš„ç¼ºå¤±ã€‚äº«å— Pilot é€šç”¨é…ç½®ç®¡ç†æ‰€å¸¦æ¥çš„ä¾¿åˆ©åŒ–çš„åŒæ—¶ï¼Œåˆè¦é’ˆå¯¹å…·ä½“çš„ sidecar æµé‡ç®¡ç†åšå¾®è°ƒï¼Œå¦‚ä½•æ‰èƒ½åšåˆ°ä¸¤è€…å…¼é¡¾å‘¢ï¼Ÿè¿™å°±æ¶‰åŠä»Šå¤©è¦ä»‹ç»çš„ä¸»é¢˜ï¼šEnvoyFilter&lt;/p&gt;
&lt;h2 id=&#34;envoy-æ¶æ„&#34;&gt;Envoy æ¶æ„&lt;/h2&gt;
&lt;p&gt;EnvoyFilter æ˜¯ Istio ä¸­è‡ªå®šä¹‰çš„ä¸€ç§ç½‘ç»œèµ„æºå¯¹è±¡ï¼Œç”¨æ¥æ›´æ–°é…ç½® Envoy ä¸­çš„ filterï¼Œä¸ºæœåŠ¡ç½‘æ ¼æ§åˆ¶é¢æä¾›äº†æ›´å¼ºå¤§çš„æ‰©å±•èƒ½åŠ›ï¼Œä½¿ Envoy ä¸­ filter chain å…·å¤‡è‡ªå®šä¹‰é…ç½®çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ Envoy çš„æ•´ä½“æ¶æ„ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/using-envoyfilter-extend-istio/envoyfilter_hua367272a6e042ccc52bb11235471b48a_127632_4ab5525103dedc2dba109c1ccb1f36f9.webp 400w,
               /blog/using-envoyfilter-extend-istio/envoyfilter_hua367272a6e042ccc52bb11235471b48a_127632_34e3dbb97f124f1c6b2b318b8af9a12a.webp 760w,
               /blog/using-envoyfilter-extend-istio/envoyfilter_hua367272a6e042ccc52bb11235471b48a_127632_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/using-envoyfilter-extend-istio/envoyfilter_hua367272a6e042ccc52bb11235471b48a_127632_4ab5525103dedc2dba109c1ccb1f36f9.webp&#34;
               width=&#34;760&#34;
               height=&#34;354&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Envoy ä¸­åŒ…å«ä¸¤ç§ç±»å‹çš„ filter:L4 filter(å³ network filter) å’Œ L7 filterã€‚EnvoyFilter ä¸­å¯ä»¥è‡ªå®šä¹‰é…ç½®çš„ filter å³ä¸ºè¿™ä¸¤ç§ filterã€‚ä»ä¸‹é¢çš„ç›‘å¬å™¨é…ç½®å¯ä»¥çœ‹åˆ°å…·ä½“çš„ filter æ‰€å¤„çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;// L4 filter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;l&#34;&gt;L4-filter-name}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.http_connection_manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;// L7 filter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;l&#34;&gt;L7-filter-name}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/listeners/network_filters/network_filters#config-network-filters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;L4 filter&lt;/a&gt;ä¸»è¦åŒ…æ‹¬ï¼šHTTP connection manager, MySQL proxy, Rate limit, RBAC, Redis proxy, TCP proxy ç­‰ã€‚&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/http_filters#config-http-filters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;L7 filter&lt;/a&gt;æ˜¯ L4 filter ä¸­&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_conn_man/http_conn_man#config-http-conn-man&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP connection manager&lt;/a&gt;ä¸‹é¢å®šä¹‰çš„ filter, ä¸»è¦åŒ…æ‹¬ï¼šCORS, External Authorization, Fault Injection, Health check, JWT Authentication, Lua, Rate limit, Router ç­‰ã€‚æ— è®º L4 è¿˜æ˜¯ L7 çš„ filter éƒ½æ˜¯æŒ‰ç…§æŒ‡å®šçš„æ¬¡åºæ‰§è¡Œï¼Œistio ä¸­ä½¿ç”¨çš„ istio-proxy ä¹Ÿæ˜¯åœ¨ envoy çš„åŸºç¡€ä¸Šé¢å¤–ç¼–è¯‘è¿›äº† istio_authnï¼Œmixer ç­‰ filterï¼Œä»¥å®ç° istio ä¸­çš„ policy å’Œ telemetry ç­‰åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ›´è¿‘ä¸€æ­¥envoyfilter-æ¡ˆä¾‹åˆ†æ&#34;&gt;æ›´è¿‘ä¸€æ­¥ï¼šEnvoyFilter æ¡ˆä¾‹åˆ†æ&lt;/h2&gt;
&lt;p&gt;å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œåœ¨è°ƒç”¨ REST æ¥å£æ—¶å€™å¦‚æœ header ä¸­å«æœ‰ k/v ä¸ºâ€œfoo:barâ€çš„è¯·æ±‚è¦æ±‚è¿”å› 444ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ EnvoyFilter å®ç°ï¼Œåœ¨ sidecar çš„ inbound é“¾ä¸­ä¿®æ”¹ç›‘å¬å™¨é…ç½®ï¼Œåœ¨ http_connection_manager çš„ç¬¬ä¸€ä¸ªä½ç½®æ’å…¥ envoy.fault è¿™æ ·ä¸€ä¸ª filterã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EnvoyFilter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;simple-envoy-filter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;listenerMatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listenerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SIDECAR_INBOUND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listenerProtocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;insertPosition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;FIRST&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filterType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filterName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.fault&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filterConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;abort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;percentage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;numerator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;denominator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HUNDRED&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;httpStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;444&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exactMatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é…ç½®å®Œæˆåæˆ‘ä»¬çœ‹ä¸‹ XDS æ¥å£ç”Ÿæˆçš„åŠ¨æ€ç›‘å¬å™¨é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;dynamic_active_listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.http_connection_manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.fault&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;abort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;percentage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;denominator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HUNDRED&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;numerator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;httpStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;444&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exactMatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio_authn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mixer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ° envoy.fault æ·»åŠ åˆ°äº† envoy.http_connection_manager è¿™ä¸ª L4 ä¸‹é¢çš„ http_filters é“¾ä¸­ç¬¬ä¸€æ¡è§„åˆ™ï¼Œç¬¦åˆé¢„æœŸï¼ŒåŒæ—¶è¯·æ±‚ç»“æœç”Ÿæ•ˆã€‚
EnvoyFilter çš„æ›´å¤šå…·ä½“é…ç½®å¯ä»¥å‚è€ƒ&lt;a href=&#34;https://istio.io/docs/reference/config/networking/v1alpha3/envoy-filter/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¤¾åŒº&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;è¿½æœ¬æº¯æºç¼ºå°‘éš”ç¦»&#34;&gt;è¿½æœ¬æº¯æºï¼šç¼ºå°‘éš”ç¦»&lt;/h2&gt;
&lt;p&gt;äº†è§£ EnvoyFilter çš„åŸºæœ¬ä½¿ç”¨ä¹‹åï¼Œæˆ‘ä»¬å°†æ·±å…¥åˆ†æ Pilot(1.1.2) æºç ï¼Œæ¥æ¢ç©¶ EnvoyFilter çš„å·¥ä½œåŸç†å’Œéš”ç¦»æ€§ä¸è¶³çš„æ ¹æºã€‚ä¸‹å›¾å±•ç¤ºäº†æ„å»º Envoy ç›‘å¬å™¨çš„ä¸»è¦å·¥ä½œæµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/using-envoyfilter-extend-istio/workflow_hu6a3a5914781f5fe69a7f5e9c5dca8d9d_18674_19cf67407f3d43cf5a6400f289aa3562.webp 400w,
               /blog/using-envoyfilter-extend-istio/workflow_hu6a3a5914781f5fe69a7f5e9c5dca8d9d_18674_0330477718a02c64d0573c153c8e51dd.webp 760w,
               /blog/using-envoyfilter-extend-istio/workflow_hu6a3a5914781f5fe69a7f5e9c5dca8d9d_18674_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/using-envoyfilter-extend-istio/workflow_hu6a3a5914781f5fe69a7f5e9c5dca8d9d_18674_19cf67407f3d43cf5a6400f289aa3562.webp&#34;
               width=&#34;453&#34;
               height=&#34;598&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;insertUserFilter æ˜¯åœ¨ç›‘å¬å™¨é…ç½®å®Œæˆä¹‹åæ‰§è¡Œçš„ï¼Œç”¨äºå‘ envoy filter chain ä¸­æ’å…¥ç”¨æˆ·è‡ªå®šä¹‰çš„ filterã€‚insertUserFilter ä¼šè°ƒç”¨ä¸‹å›¾ä¸­çš„ getUserFiltersForWorkload å‡½æ•°ï¼Œåœ¨æ•´ä¸ªé›†ç¾¤èŒƒå›´å†…æŸ¥æ‰¾æ»¡è¶³æ¡ä»¶çš„ EnvoyFilterï¼ŒæŠŠè·å–åˆ°çš„ filter åˆå¹¶åæ’å…¥åˆ°ç›‘å¬å™¨çš„ filter chain ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getUserFiltersForWorkload&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;networking&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EnvoyFilter&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Env&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// collect workload labels
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;workloadInstances&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ProxyInstances&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;workloadLabels&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LabelsCollection&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;workloadInstances&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;workloadLabels&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;workloadLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;EnvoyFilter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;workloadLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é›†ç¾¤èŒƒå›´æŸ¥æ‰¾
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;networking&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EnvoyFilter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°±ä¼šäº§ç”Ÿä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ã€‚å› ä¸ºç”¨æˆ·ä¹‹é—´çš„è¡Œä¸ºæ˜¯ä¸å¯æ„ŸçŸ¥çš„ï¼Œåœ¨é›†ç¾¤èŒƒå›´å†…æŸ¥æ‰¾ EnvoyFilter ä¼šå¯¼è‡´ç”¨æˆ·è¡Œä¸ºçš„ä¸å¯æ§ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿè®©æˆ‘ä»¬é€šè¿‡ä¸‹å›¾æ¥å…·ä½“è¯´æ˜ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/using-envoyfilter-extend-istio/isolated-before_hu27eadea31e9a36f3c188e4e5e9e55876_378597_882c89847928c203559fad4e9f463b3e.webp 400w,
               /blog/using-envoyfilter-extend-istio/isolated-before_hu27eadea31e9a36f3c188e4e5e9e55876_378597_e8157843f98b9090833955cfa29e6e9e.webp 760w,
               /blog/using-envoyfilter-extend-istio/isolated-before_hu27eadea31e9a36f3c188e4e5e9e55876_378597_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/using-envoyfilter-extend-istio/isolated-before_hu27eadea31e9a36f3c188e4e5e9e55876_378597_882c89847928c203559fad4e9f463b3e.webp&#34;
               width=&#34;760&#34;
               height=&#34;746&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚æœå›¾ä¸­çš„ä¸¤ä¸ªç”¨æˆ· user1 å’Œ user2ï¼Œåˆ†åˆ«åœ¨å¯¹åº”çš„ namespace ä¸‹é¢éƒ¨ç½²ä¸¤ä¸ªå…·æœ‰ç›¸åŒæ ‡ç­¾çš„ podï¼Œç»‘å®šä¸åŒçš„ EnvoyFilterï¼Œè¿”å›ç åº”è¯¥åˆ†åˆ«ä¸º 555ï¼ˆuser1ï¼‰å’Œ 444ï¼ˆuser2ï¼‰ã€‚ä½† user2 è®¿é—®/hello å¾—åˆ°çš„æœ€ç»ˆè¿”å›ç æ˜¯ 555ï¼Œä¸é¢„æœŸ 444 ä¸ç¬¦ï¼Œå…¶è¡Œä¸ºè¢« user1 å¹²æ‰°äº†ã€‚
åŸå› å°±åœ¨äºç¼ºå°‘ namespace çº§åˆ«çš„éš”ç¦»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è§£å†³namespace-çº§åˆ«éš”ç¦»&#34;&gt;è§£å†³ï¼šnamespace çº§åˆ«éš”ç¦»&lt;/h3&gt;
&lt;p&gt;EnvoyFilter ä¸ºä»€ä¹ˆä¸åš namespace çº§åˆ«çš„éš”ç¦»ï¼Ÿé’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œç¬”è€…æ›¾å‘ istio ç¤¾åŒºå¯»æ±‚ç­”æ¡ˆï¼Œä½†æ²¡æœ‰å¾—åˆ°åˆç†çš„ç­”å¤ã€‚åŸºäºæ­¤ï¼ŒKUN å›¢é˜Ÿé’ˆå¯¹ istio1.1.2 ä¸­ EnvoyFilter åšäº† namespace çº§åˆ«çš„éš”ç¦»ï¼Œä½¿å…¶å½±å“èŒƒå›´æ§åˆ¶åœ¨å•ä¸€çš„ namespace ä¸‹ï¼Œè®©æ™®é€šç”¨æˆ·å…·å¤‡å¯ä»¥ä¿®æ”¹ envoy filter chain çš„èƒ½åŠ›è€Œä¸ä¼šç›¸äº’å¹²æ‰°ã€‚
















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/using-envoyfilter-extend-istio/source_hu3b1eceb10513875cd9ae42787e8d498e_131913_c9606ffa5d44d91e6173685ff03f5867.webp 400w,
               /blog/using-envoyfilter-extend-istio/source_hu3b1eceb10513875cd9ae42787e8d498e_131913_d945a98ae63e8ec84c2736daa307d0de.webp 760w,
               /blog/using-envoyfilter-extend-istio/source_hu3b1eceb10513875cd9ae42787e8d498e_131913_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/using-envoyfilter-extend-istio/source_hu3b1eceb10513875cd9ae42787e8d498e_131913_c9606ffa5d44d91e6173685ff03f5867.webp&#34;
               width=&#34;760&#34;
               height=&#34;318&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ° EnvoyFilter çš„ä½œç”¨åŸŸè¢«æ§åˆ¶åœ¨äº† namespace çº§åˆ«
















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/using-envoyfilter-extend-istio/isolated-after_huc50de950c8aa9877cd5b294a4a22a3c2_366947_74cf57de755b54d32ee6cfd06ff16347.webp 400w,
               /blog/using-envoyfilter-extend-istio/isolated-after_huc50de950c8aa9877cd5b294a4a22a3c2_366947_c0551816e27fb2a6be909c73fad2145b.webp 760w,
               /blog/using-envoyfilter-extend-istio/isolated-after_huc50de950c8aa9877cd5b294a4a22a3c2_366947_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/using-envoyfilter-extend-istio/isolated-after_huc50de950c8aa9877cd5b294a4a22a3c2_366947_74cf57de755b54d32ee6cfd06ff16347.webp&#34;
               width=&#34;760&#34;
               height=&#34;755&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆªæ­¢ç›®å‰ä¸ºæ­¢ï¼ŒKUN å¹³å°ä¸Šå…±æœ‰ 175 ä¸ªåº”ç”¨é€šè¿‡ Istio æä¾›æœåŠ¡ï¼Œé™¤äº† EnvoyFilterï¼ŒKUN åŒæ—¶é’ˆå¯¹å…¶ä»–ç½‘ç»œèµ„æºä¹Ÿåšäº†ä¸¥æ ¼çš„éš”ç¦»ï¼Œä»¥æ­¤æ¥ä¿è¯ä¸åŒç”¨æˆ·çš„æœåŠ¡çš„ç¨³å®šæ€§ã€‚åŸºäºæ­¤ï¼Œä¸åŒç”¨æˆ·å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚åœ¨è‡ªå®šä¹‰ namespace ä¸‹åˆ›å»º EnvoyFilterï¼Œä¸ºè‡ªå·±çš„æœåŠ¡åšåŠŸèƒ½æ‰©å±•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æŒç»­æ”¹è¿›æ ¡éªŒ&#34;&gt;æŒç»­æ”¹è¿›ï¼šæ ¡éªŒ&lt;/h2&gt;
&lt;p&gt;é™¤äº†éš”ç¦»ä¹‹å¤–ï¼Œå¦‚æœç”¨æˆ·åœ¨ EnvoyFilter ä¸­é…ç½®çš„ filter æ²¡æœ‰è¢«ç¼–è¯‘è¿› Envoyï¼Œé‚£ä¹ˆ Pilot ä¸‹å‘ç»™ Envoy çš„é…ç½®ä¼šç›´æ¥å¯¼è‡´ Envoy å‡ºé”™ï¼Œå¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2019-08-08 02:03:44.048][19][warning][config] [external/envoy/source/common/config/grpc_mux_subscription_impl.cc:73] gRPC config for type.googleapis.com/envoy.api.v2.Listener rejected: Error adding/updating listener(s) 172.17.0.13_80: Didn&amp;#39;t find a registered implementation for name: &amp;#39;envoy.filters.unknown&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;KUN å›¢é˜Ÿä¸ºäº†æå‡æ•´ä¸ªæœåŠ¡ç½‘æ ¼çš„å®¹é”™æ€§å’Œå¯ç”¨æ€§ï¼Œå¯¹ EnvoyFilter çš„åˆ›å»ºåšäº†è¿›ä¸€æ­¥çš„æ ¡éªŒï¼Œè¿™æ¶‰åŠåˆ° istio-galleyã€‚
istio-galley çš„ä½œç”¨ä¹‹ä¸€æ˜¯å®ç°äº† kubernetes ä¸­ validating webhook çš„åŠŸèƒ½ï¼Œç”¨æˆ·åœ¨åˆ›å»º EnvoyFilter çš„æ—¶å€™ apiserver ä¼šè°ƒç”¨ istio-galley åšæ ¡éªŒï¼Œå¦‚æœæ ¡éªŒå¤±è´¥åˆ™ç›´æ¥è¿”å›ï¼Œè¯¥å®ä¾‹ä¸ä¼šæŒä¹…åŒ–åˆ°é›†ç¾¤ã€‚äºæ˜¯æˆ‘ä»¬ä¿®æ”¹äº† istio-galley æºç ï¼Œå°† Envoy ä¸­çš„åŸç”Ÿæ”¯æŒçš„ filter åŠ istio-proxy ç¼–è¯‘çš„ filter ä½œä¸ºåŸºå‡†è¿›è¡Œæ ¡éªŒã€‚&lt;/p&gt;
&lt;p&gt;# kubectl create -f&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EnvoyFilter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;network-filter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;listenerMatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listenerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SIDECAR_INBOUND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listenerProtocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;insertPosition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;LAST&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filterType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NETWORK&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filterName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.filters.unknown&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filterConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é”™è¯¯çš„é…ç½®ç›´æ¥è¢«æ‹¦æˆªåœ¨åˆ›å»ºæ—¶&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Error from server: error when creating &amp;#34;networkfilter.yaml&amp;#34;: admission webhook &amp;#34;pilot.validation.istio.io&amp;#34; denied the request: configuration is invalid: envoy filter: unknown
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;Service Mesh å°†åŸºç¡€è®¾æ–½ä¸‹æ²‰ï¼Œä½¿ä¸Šå±‚ä¸šåŠ¡åªä¸“æ³¨äºä¸šåŠ¡æœ¬èº«ï¼Œåœ¨äº‘åŸç”Ÿé¢†åŸŸå…·æœ‰å¹¿é˜”çš„åº”ç”¨å‰æ™¯ã€‚KUN å›¢é˜Ÿå¾ˆæ—©å¼€å§‹è·Ÿè¿› Service Meshï¼Œæ—©åœ¨ Istio1.0 ç‰ˆæœ¬ä¹‹å‰å°±å·²åœ¨å†…éƒ¨è¯•ç”¨ã€‚å›¢é˜Ÿå°†å§‹ç»ˆè‡´åŠ›äºæ”¹é© UCloud å†…éƒ¨ç ”å‘æµç¨‹ï¼Œæå‡ç ”å‘æ•ˆç‡ï¼Œå¹¶ååŒç¤¾åŒºä¸€åŒå®Œå–„ Service Mesh åŠŸèƒ½ã€‚åŒæ—¶ä¹Ÿå¾ˆæ¬£å–œåœ°çœ‹åˆ°ï¼Œæˆ‘ä»¬æ­¤å‰åšçš„ä¸€äº›æ”¹è¿›å·¥ä½œï¼Œå¦‚æ”¯æŒ IPv6 ç¯å¢ƒã€èµ„æºéš”ç¦»ç­‰ï¼Œåœ¨ Istio åç»­ç‰ˆæœ¬ä¸­ä¹Ÿé™†ç»­å¼€å§‹æ”¯æŒã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Contour å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šä½¿ç”¨ Contour æ¥ç®¡ Kubernetes çš„å—åŒ—æµé‡</title>
      <link>https://cloudnative.to/blog/use-envoy-as-a-kubernetes-ingress/</link>
      <pubDate>Sat, 31 Aug 2019 22:16:10 +0800</pubDate>
      <guid>https://cloudnative.to/blog/use-envoy-as-a-kubernetes-ingress/</guid>
      <description>&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-31-142544.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­è¿è¡Œå¤§è§„æ¨¡ä»¥ Web ä¸ºä¸­å¿ƒçš„å·¥ä½œè´Ÿè½½ï¼Œæœ€å…³é”®çš„éœ€æ±‚ä¹‹ä¸€å°±æ˜¯åœ¨ &lt;code&gt;L7&lt;/code&gt; å±‚å®ç°é«˜æ•ˆæµç•…çš„å…¥å£æµé‡ç®¡ç†ã€‚è‡ªä»ç¬¬ä¸€æ‰¹ &lt;code&gt;Kubernetes Ingress Controller&lt;/code&gt; å¼€å‘å®Œæˆä»¥æ¥ï¼Œ&lt;code&gt;Envoy&lt;/code&gt;ï¼ˆç”± Matt Klein å’Œ Lyft å›¢é˜Ÿå¼€å‘ï¼‰å·²ç»æˆä¸ºäº‘åŸç”Ÿç”Ÿæ€ç³»ç»Ÿä¸­çš„æ–°ç”ŸåŠ›é‡ã€‚Envoy ä¹‹æ‰€ä»¥å—åˆ°æ”¯æŒï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ª CNCF æ‰˜ç®¡çš„é¡¹ç›®ï¼Œä¸æ•´ä¸ªå®¹å™¨åœˆå’Œäº‘åŸç”Ÿæ¶æ„æœ‰ç€å¤©ç„¶çš„æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;å®¹å™¨å…¬å¸ &lt;a href=&#34;https://heptio.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Heptio&lt;/a&gt; å¼€æºçš„é¡¹ç›® &lt;a href=&#34;https://github.com/heptio/contour&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Contour&lt;/a&gt; ä½¿ç”¨ &lt;code&gt;Envoy&lt;/code&gt; ä½œä¸º Kubernetes çš„ Ingress Controller å®ç°ï¼Œä¸ºå¤§å®¶æä¾›äº†ä¸€æ¡æ–°çš„ Kubernetes å¤–éƒ¨è´Ÿè½½å‡è¡¡å®ç°æ€è·¯ã€‚&lt;/p&gt;
&lt;p&gt;æ®&lt;a href=&#34;https://blog.heptio.com/making-it-easy-to-use-envoy-as-a-kubernetes-load-balancer-dde82959f171&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹åšå®¢&lt;/a&gt;ä»‹ç»ï¼Œ&lt;code&gt;Heptio Contour&lt;/code&gt; å¯ä»¥ä¸ºç”¨æˆ·æä¾›ä»¥ä¸‹å¥½å¤„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ç§ç®€å•çš„å®‰è£…æœºåˆ¶æ¥å¿«é€Ÿéƒ¨ç½²å’Œé›†æˆ Envoyã€‚&lt;/li&gt;
&lt;li&gt;ä¸ Kubernetes å¯¹è±¡æ¨¡å‹çš„é›†æˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ingress&lt;/code&gt; é…ç½®çš„åŠ¨æ€æ›´æ–°ï¼Œè€Œæ— éœ€é‡å¯åº•å±‚è´Ÿè½½å‡è¡¡å™¨ã€‚&lt;/li&gt;
&lt;li&gt;é¡¹ç›®æˆç†Ÿåï¼Œå°†å…è®¸ä½¿ç”¨ Envoy ä¸€äº›å¼ºå¤§çš„åŠŸèƒ½ï¼Œå¦‚ç†”æ–­å™¨ã€æ’ä»¶å¼çš„å¤„ç†å™¨é“¾ï¼Œä»¥åŠå¯è§‚æµ‹æ€§å’Œå¯è°ƒè¯•æ€§ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°å¯¹æ¥ç›‘æ§ç³»ç»Ÿã€‚&lt;/li&gt;
&lt;li&gt;IngressRoute ä¹‹é—´å¯ä»¥çº§è”ï¼Œç”¨æ¥åšè“ç»¿éƒ¨ç½²éå¸¸æ–¹ä¾¿ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬å°±æ¥è¯•ç”¨ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;1-å®‰è£…æ­¥éª¤&#34;&gt;1. å®‰è£…æ­¥éª¤&lt;/h2&gt;
&lt;p&gt;Contour Ingress controller ç”±ä¸¤ä¸ªç»„ä»¶ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Envoy&lt;/code&gt; : æä¾›é«˜æ€§èƒ½åå‘ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Contour&lt;/code&gt; : å……å½“ Envoy çš„æ§åˆ¶å¹³é¢ï¼Œä¸º Envoy çš„è·¯ç”±é…ç½®æä¾›ç»Ÿä¸€çš„æ¥æºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®˜æ–¹æ–‡æ¡£æä¾›äº†ä¸‰ç§éƒ¨ç½²æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;DaemonSet&lt;/code&gt; æ¥éƒ¨ç½²ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šè·‘ä¸€ä¸ª Contour å®ä¾‹ï¼ˆContour ä¸ Envoy åœ¨åŒä¸€ä¸ª Pod ä¸­ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;Deployment&lt;/code&gt; æ¥éƒ¨ç½²ï¼Œæ€»å…±è·‘ä¸¤ä¸ª Contour å®ä¾‹ï¼ˆContour ä¸ Envoy åœ¨åŒä¸€ä¸ª Pod ä¸­ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;Deployment&lt;/code&gt; æ¥éƒ¨ç½² Contourï¼Œæ€»å…±è·‘ä¸¤ä¸ª Contour å®ä¾‹ï¼›é€šè¿‡ &lt;code&gt;DaemonSet&lt;/code&gt; æ¥éƒ¨ç½² Envoyï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šè·‘ä¸€ä¸ª Envoy å®ä¾‹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç¬¬ä¸‰ç§æ–¹æ¡ˆæ¯”è¾ƒå·§å¦™ï¼Œè¿™æ ·å¯ä»¥è®© Contour å’Œ Envoy è¿™ä¸¤ä¸ªç»„ä»¶è§£è€¦ï¼Œå¯ä»¥åˆ†åˆ«æŒ‰éœ€å¯¹ä¸åŒçš„ç»„ä»¶è¿›è¡Œæ‰©å±•ï¼Œå…·ä½“çš„ä¼˜åŠ¿å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Envoy ä»¥ Daemonset çš„å½¢å¼è¿è¡Œï¼Œå…·æœ‰å¾ˆå¼ºçš„æ‰©å±•æ€§ï¼Œåç»­å¯é€šè¿‡ &lt;code&gt;ipvs&lt;/code&gt; å’Œ &lt;code&gt;keepalived&lt;/code&gt; ç­‰å·¥å…·æ¥å®ç°å…¶è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;Envoy è¿è¡Œçš„ç½‘ç»œæ¨¡å¼æ˜¯ &lt;code&gt;hostNetwork&lt;/code&gt;ï¼Œå‡å°‘äº†é¢å¤–çš„ç½‘ç»œæ€§èƒ½æŸè€—ã€‚&lt;/li&gt;
&lt;li&gt;Contour ä¸ Envoy ä¹‹é—´é€šè¿‡åŒå‘è®¤è¯çš„è‡ªç­¾åè¯ä¹¦è¿›è¡Œé€šä¿¡ï¼Œå¤§å¤§å¢å¼ºäº†å®‰å…¨æ€§ã€‚&lt;/li&gt;
&lt;li&gt;å‡çº§ Contour ä¸éœ€è¦é‡å¯ Envoyã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-28-080529.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°±é‡‡ç”¨ç¬¬ä¸‰ç§æ–¹æ¡ˆæ¥éƒ¨ç½²ï¼Œé¦–å…ˆå…‹éš†å®˜æ–¹ä»“åº“ï¼Œè¿›å…¥ manifest æ¸…å•ç›®å½•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ git clone https://github.com/heptio/contour
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; contour/examples/ds-hostnet-split
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†ä¾¿äºæŸ¥çœ‹ envoy çš„é…ç½®ï¼Œä¿®æ”¹ &lt;code&gt;03-envoy.yaml&lt;/code&gt;ï¼Œå°† envoy çš„ &lt;code&gt;admin-adress&lt;/code&gt; è®¾ç½®ä¸º 0.0.0.0ï¼Œå¹¶æš´éœ² 9001 ç«¯å£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;çœç•¥...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;initContainers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;bootstrap&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;admin-address=0.0.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/config/contour.json&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;çœç•¥...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°† Envoy Service çš„ç±»å‹æ”¹ä¸º &lt;code&gt;ClusterIP&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;$ cat 02-service-envoy.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;heptio-contour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service.beta.kubernetes.io/aws-load-balancer-type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nlb&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;externalTrafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterIP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨ç½²ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f ./
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹çŠ¶æ€ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n heptio-contour get pod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                       READY   STATUS      RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;contour-767fd99989-27qjw   0/1     Running     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          21s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;contour-767fd99989-kcjxz   0/1     Running     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          21s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;contour-certgen-29nqs      0/1     Completed   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          21s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy-cnzvm                0/1     Running     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          21s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy-lb8mm                0/1     Running     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          21s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy-qzmt4                0/1     Running     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          21s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n heptio-contour get job
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME              COMPLETIONS   DURATION   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;contour-certgen   1/1           2s         4m42s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;contour-certgen&lt;/code&gt; æ˜¯ä¸€ä¸ª Jobï¼Œå®ƒä¼šç”Ÿæˆæœ‰æ•ˆæœŸä¸ºä¸€å¹´çš„ mTLSï¼ˆåŒå‘è®¤è¯ï¼‰è¯ä¹¦ï¼Œå¹¶å°†å…¶æŒ‚è½½åˆ° Contour å’Œ Envoy çš„å®¹å™¨ä¸­ã€‚å¦‚æœä½ æƒ³è‡ªå®šä¹‰è¯ä¹¦ï¼Œå¯ä»¥å‚è€ƒ&lt;a href=&#34;https://github.com/heptio/contour/blob/master/docs/grpc-tls-howto.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœä½ è¿˜æ²¡æœ‰éƒ¨ç½² Kubernetes é›†ç¾¤æ€ä¹ˆåŠï¼ŸåºŸè¯ï¼Œå½“ç„¶æ˜¯ç”¨ &lt;a href=&#34;https://www.yangcs.net/posts/sealos/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sealos&lt;/a&gt; å•Šï¼åˆ†åˆ†é’Ÿæèµ·ä¸€ä¸ªé«˜å¯ç”¨é›†ç¾¤ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;2-ingress-æµ‹è¯•&#34;&gt;2. Ingress æµ‹è¯•&lt;/h2&gt;
&lt;p&gt;å®‰è£…ç»“æŸåï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥æµ‹è¯• Ingress äº†ã€‚åœ¨ &lt;code&gt;examples/example-workload&lt;/code&gt; ç›®å½•ä¸‹åŒ…å«ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f examples/example-workload/kuard-ingressroute.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹åˆ›å»ºå¥½çš„èµ„æºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get po,svc,ingressroute -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kuard
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                         READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pod/kuard-67789b8754-5c4w7   1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          63s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pod/kuard-67789b8754-fpdfb   1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          63s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pod/kuard-67789b8754-fx9bn   1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          63s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME            TYPE        CLUSTER-IP    EXTERNAL-IP   PORT&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;S&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/kuard   ClusterIP   10.97.46.79   &amp;lt;none&amp;gt;        80/TCP    63s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                    FQDN          TLS SECRET   FIRST ROUTE   STATUS   STATUS DESCRIPTION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ingressroute.contour.heptio.com/kuard   kuard.local                /             valid    valid IngressRoute
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†åŸŸååŠ å…¥æœ¬åœ°ç”µè„‘çš„ hostsï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$INGRESS_HOST&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; kuard.local&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; /etc/hosts
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ &lt;code&gt;$INGRESS_HOST&lt;/code&gt; æ˜¯ä»»æ„è¿è¡Œ Envoy èŠ‚ç‚¹çš„ IPã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥åŸŸå &lt;code&gt;kuard.local&lt;/code&gt; è®¿é—®åº”ç”¨äº†ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-27-135235.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;3-contour-å·¥ä½œåŸç†&#34;&gt;3. Contour å·¥ä½œåŸç†&lt;/h2&gt;
&lt;p&gt;Contour åŒæ—¶æ”¯æŒ &lt;code&gt;Ingress&lt;/code&gt; èµ„æºå¯¹è±¡å’Œ &lt;code&gt;IngressRoute&lt;/code&gt; èµ„æºå¯¹è±¡ï¼ˆé€šè¿‡ CRD åˆ›å»ºï¼‰ï¼Œè¿™äº›å¯¹è±¡éƒ½æ˜¯ä¸ºè¿›å…¥é›†ç¾¤çš„è¯·æ±‚æä¾›è·¯ç”±è§„åˆ™çš„é›†åˆã€‚è¿™ä¸¤ä¸ªå¯¹è±¡çš„ç»“æ„å’Œå®ç°æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œä½†å®ƒä»¬çš„æ ¸å¿ƒæ„å›¾æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯ä¸ºè¿›å…¥é›†ç¾¤çš„è¯·æ±‚æä¾›è·¯ç”±è§„åˆ™ã€‚å¦‚ä¸ä½œç‰¹æ®Šè¯´æ˜ï¼Œåé¢å½“æˆ‘ä»¬æè¿°â€œIngressâ€æ—¶ï¼Œå®ƒå°†åŒæ—¶é€‚ç”¨äº &lt;code&gt;Ingress&lt;/code&gt; å’Œ &lt;code&gt;IngressRoute&lt;/code&gt; å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ Envoy é…ç½®äº† &lt;code&gt;CDS&lt;/code&gt; çš„ endpoint æ—¶ï¼Œå®ƒä¼šå®šæœŸè½®è¯¢ç«¯ç‚¹ï¼Œç„¶åå°†è¿”å›çš„ JSON ç‰‡æ®µåˆå¹¶åˆ°å…¶è¿è¡Œé…ç½®ä¸­ã€‚å¦‚æœè¿”å›åˆ° Envoy çš„é›†ç¾¤é…ç½®ä»£è¡¨å½“å‰çš„ Ingress å¯¹è±¡çš„é›†åˆï¼Œåˆ™å¯ä»¥å°† Contour è§†ä¸ºä» &lt;code&gt;Ingress&lt;/code&gt; å¯¹è±¡åˆ° &lt;code&gt;Envoy&lt;/code&gt; é›†ç¾¤é…ç½®çš„è½¬æ¢å™¨ã€‚éšç€ Ingress å¯¹è±¡çš„æ·»åŠ å’Œåˆ é™¤ï¼ŒEnvoy ä¼šåŠ¨æ€æ·»åŠ å¹¶åˆ é™¤ç›¸å…³é…ç½®ï¼Œè€Œæ— éœ€ä¸æ–­é‡æ–°åŠ è½½é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å®è·µä¸­ï¼Œå°† Ingress å¯¹è±¡è½¬æ¢ä¸º Envoy é…ç½®æ›´åŠ å¾®å¦™ï¼Œéœ€è¦å°† Envoy ä¸­çš„ xDS é…ç½®ï¼ˆåŒ…æ‹¬ &lt;code&gt;CDS&lt;/code&gt;ï¼Œ&lt;code&gt;EDS&lt;/code&gt; å’Œ &lt;code&gt;RDS&lt;/code&gt;ï¼‰æ˜ å°„åˆ° Kubernetes ä¸­ã€‚Contour è‡³å°‘éœ€è¦è§‚å¯Ÿ &lt;code&gt;Ingress&lt;/code&gt;ã€&lt;code&gt;Service&lt;/code&gt; å’Œ &lt;code&gt;Endpoint&lt;/code&gt; è¿™å‡ ä¸ªèµ„æºå¯¹è±¡ä»¥æ„å»ºè¿™äº›æœåŠ¡çš„å“åº”ï¼Œå®ƒé€šè¿‡ &lt;code&gt;client-go&lt;/code&gt; çš„ &lt;a href=&#34;https://www.kubernetes.org.cn/2693.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cache/informer&lt;/a&gt; æœºåˆ¶å…è´¹è·å¾—è¿™äº› &lt;code&gt;watchers&lt;/code&gt;ã€‚è¿™äº› watchers æä¾›æ·»åŠ ï¼Œæ›´æ–°å’Œåˆ é™¤å¯¹è±¡çš„è¾¹ç¼˜è§¦å‘é€šçŸ¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ &lt;code&gt;watch API&lt;/code&gt; åœ¨æœ¬åœ°ç¼“å­˜ç¼“å­˜å¯¹è±¡ï¼Œä»¥ä¾¿åç»­æŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;p&gt;Contour å°†æ”¶é›†åˆ°çš„è¿™äº›å¯¹è±¡å¤„ç†ä¸ºè™šæ‹Ÿä¸»æœºåŠå…¶è·¯ç”±è§„åˆ™çš„&lt;strong&gt;æœ‰å‘éå¾ªç¯å›¾&lt;/strong&gt;ï¼ˆDAGï¼‰ï¼Œè¿™è¡¨æ˜ Contour å°†æœ‰æƒæ„å»ºè·¯ç”±è§„åˆ™çš„é¡¶çº§è§†å›¾ï¼Œå¹¶å°†ç¾¤é›†ä¸­çš„ç›¸åº”æœåŠ¡å’Œ TLS ç§˜é’¥è¿æ¥åœ¨ä¸€èµ·ã€‚ä¸€æ—¦æ„å»ºäº†è¿™ä¸ªæ–°çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ¾å®ç° &lt;code&gt;IngressRoute&lt;/code&gt; å¯¹è±¡çš„éªŒè¯ï¼Œæˆæƒå’Œåˆ†å‘ã€‚è¯¥æ•°æ®ç»“æ„å¯¼å‡ºçš„ &lt;code&gt;png&lt;/code&gt; å›¾ç‰‡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/DQTYlY.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Envoy API è°ƒç”¨å’Œ Kubernetes API èµ„æºä¹‹é—´çš„æ˜ å°„å…³ç³»å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;CDS&lt;/strong&gt; : é›†ç¾¤å‘ç°æœåŠ¡ã€‚æ˜ å°„ä¸º Kubernetes ä¸­çš„ &lt;code&gt;Service&lt;/code&gt; ä»¥åŠä¸€éƒ¨åˆ† Ingress å¯¹è±¡çš„ &lt;code&gt;TLS&lt;/code&gt; é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;EDS&lt;/strong&gt; : æœåŠ¡å‘ç°æœåŠ¡ã€‚æ˜ å°„ä¸º Kubernetes ä¸­çš„ &lt;code&gt;Endpoint&lt;/code&gt;ã€‚Envoy ä½¿ç”¨ EDS è‡ªåŠ¨è·å– &lt;code&gt;Cluster&lt;/code&gt; æˆå‘˜ï¼Œè¿™ä¸ Endpoint å¯¹è±¡ä¸­åŒ…å«çš„ä¿¡æ¯éå¸¸åŒ¹é…ã€‚Envoy ä½¿ç”¨ Contour åœ¨ &lt;code&gt;EDS&lt;/code&gt; å“åº”ä¸­è¿”å›çš„åç§°æŸ¥è¯¢ &lt;code&gt;EDS&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;RDS&lt;/strong&gt; : è·¯ç”±å‘ç°æœåŠ¡ã€‚æ˜ å°„ä¸º Kubernetes ä¸­çš„ &lt;code&gt;Ingress&lt;/code&gt;ã€‚æä¾›äº†è™šæ‹Ÿä¸»æœºåå’Œå‰ç¼€è·¯ç”±ä¿¡æ¯çš„ RDS ä¸ Ingress åŒ¹é…å¾—æ›´å¥½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;4-æ˜ å°„å…³ç³»è¯¦æƒ…&#34;&gt;4. æ˜ å°„å…³ç³»è¯¦æƒ…&lt;/h2&gt;
&lt;h3 id=&#34;cds&#34;&gt;CDS&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;CDS&lt;/code&gt; æ›´åƒæ˜¯ Kubernetes ä¸­çš„ &lt;code&gt;Service&lt;/code&gt; èµ„æºï¼Œå› ä¸º Service æ˜¯å…·ä½“ &lt;code&gt;Endpoint&lt;/code&gt;ï¼ˆPodsï¼‰çš„æŠ½è±¡ï¼ŒEnvoy Cluster æ˜¯æŒ‡ Envoy è¿æ¥åˆ°çš„ä¸€ç»„é€»è¾‘ä¸Šç›¸ä¼¼çš„ä¸Šæ¸¸ä¸»æœºï¼ˆå‚è€ƒä¸‹æ–‡çš„ RDSï¼‰ã€‚å…¶ä¸­ &lt;code&gt;TLS&lt;/code&gt; é…ç½®ä¹Ÿæ˜¯ CDS çš„ä¸€éƒ¨åˆ†ï¼Œè€Œ Kubernetes ä¸­çš„ TLS ä¿¡æ¯ç”± Ingress æä¾›ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†ä¹‹é—´çš„æ˜ å°„å…³ç³»ä¼šæœ‰äº›å¤æ‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;eds&#34;&gt;EDS&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;EDS&lt;/code&gt; æ›´åƒæ˜¯ Kubernetes ä¸­çš„ &lt;code&gt;Endpoint&lt;/code&gt; èµ„æºï¼Œè¿™éƒ¨åˆ†æ˜ å°„å…³ç³»çš„å®ç°æœ€ç®€å•ã€‚Contour å°† Endpoint çš„å“åº”å¯¹è±¡è½¬æ¢ä¸º EDS çš„ &lt;code&gt;{ address: [] }&lt;/code&gt; json é…ç½®å—ã€‚&lt;/p&gt;
&lt;h3 id=&#34;rds&#34;&gt;RDS&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;RDS&lt;/code&gt; æ›´åƒæ˜¯ Kubernetes ä¸­çš„ &lt;code&gt;Ingress&lt;/code&gt; èµ„æºã€‚RDS å°†å‰ç¼€ï¼Œè·¯å¾„æˆ–æ­£åˆ™è¡¨è¾¾å¼ä¹‹ä¸€è·¯ç”±åˆ° Envoy é›†ç¾¤ã€‚Envoy é›†ç¾¤çš„åç§°å¯ä»¥ä» Ingress çš„ &lt;code&gt;IngressSpec&lt;/code&gt; çš„é…ç½®é¡¹ä¸­è·å–ï¼ˆæ¯”å¦‚ï¼š&lt;code&gt;namespace/serviceName_servicePort&lt;/code&gt;ï¼‰ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œå®ƒä¼šåŒ¹é… Service å¯¹è±¡è¢«è½¬æ¢åè¿”å›çš„ CDS å¯¹è±¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;5-contour-æ¶æ„åˆ†æ&#34;&gt;5. Contour æ¶æ„åˆ†æ&lt;/h2&gt;
&lt;p&gt;Contour Ingress controller ç”±ä¸¤ä¸ªç»„ä»¶ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Envoy&lt;/code&gt; : æä¾›é«˜æ€§èƒ½åå‘ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Contour&lt;/code&gt; : å……å½“ Envoy çš„æ§åˆ¶å¹³é¢ï¼Œä¸º Envoy çš„è·¯ç”±é…ç½®æä¾›ç»Ÿä¸€çš„æ¥æºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥æœ¬æ–‡çš„éƒ¨ç½²æ–¹å¼ä¸ºä¾‹ï¼Œåœ¨ Envoy çš„ Pod åˆå§‹åŒ–æœŸé—´ï¼ŒContour ä½œä¸º &lt;code&gt;Init&lt;/code&gt; å®¹å™¨è¿è¡Œï¼Œå¹¶å°† bootstrapï¼ˆåˆå§‹åŒ–ï¼‰é…ç½®å†™å…¥ä¸€ä¸ª temporary volumeã€‚è¯¥ &lt;code&gt;Volume&lt;/code&gt; è¢«ä¼ é€’ç»™ Envoy å®¹å™¨å¹¶å‘Šè¯‰ Envoy å°†å¦ä¸€ä¸ª Deployment ä¸­çš„ Contour å®¹å™¨è§†ä¸ºæ§åˆ¶å¹³é¢ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-27-143803.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åˆå§‹åŒ–å®Œæˆåï¼ŒEnvoy å®¹å™¨å¯åŠ¨ï¼Œæ£€ç´¢ Contour å†™å…¥çš„ bootstrap é…ç½®ï¼Œå¹¶å¼€å§‹è½®è¯¢ Contour ä»¥çƒ­æ›´æ–°é…ç½®ã€‚å¦‚æœæ§åˆ¶å¹³é¢æ— æ³•è®¿é—®ï¼ŒEnvoy å°†ä¼šè¿›è¡Œä¼˜é›…é‡è¯•ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-27-143825.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Contour ç›¸å½“äº Kubernetes API çš„å®¢æˆ·ç«¯ã€‚å®ƒç›‘è§† &lt;code&gt;Ingress&lt;/code&gt;ï¼Œ&lt;code&gt;Service&lt;/code&gt; å’Œ &lt;code&gt;Endpoint&lt;/code&gt; å¯¹è±¡ï¼Œå¹¶é€šè¿‡å°†å…¶å¯¹è±¡ç¼“å­˜è½¬æ¢ä¸ºç›¸å…³çš„ &lt;code&gt;JSON&lt;/code&gt; å­—æ®µæ¥å……å½“å…¶ Envoy çš„æ§åˆ¶å¹³é¢ã€‚&lt;/p&gt;
&lt;p&gt;ä» Kubernetes åˆ° Contour çš„ä¿¡æ¯è½¬æ¢æ˜¯é€šè¿‡ &lt;code&gt;SharedInformer&lt;/code&gt; æ¡†æ¶ watching API æ¥å®Œæˆçš„ï¼›è€Œä» Contour åˆ° Envoy çš„ä¿¡æ¯è½¬æ¢æ˜¯é€šè¿‡ Envoy å®šæœŸè½®è¯¢æ¥å®ç°çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;6-ingressroute-ä»‹ç»&#34;&gt;6. IngressRoute ä»‹ç»&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress&lt;/a&gt; å¯¹è±¡ä» Kubernetes 1.1 ç‰ˆæœ¬å¼€å§‹è¢«å¼•è¿›ï¼Œç”¨æ¥æè¿°è¿›å…¥é›†ç¾¤çš„è¯·æ±‚çš„ HTTP è·¯ç”±è§„åˆ™ã€‚ä½†è¿„ä»Šä¸ºæ­¢ Ingress å¯¹è±¡è¿˜åœç•™åœ¨ &lt;code&gt;beta&lt;/code&gt; é˜¶æ®µï¼Œä¸åŒçš„ Ingress Controller æ’ä»¶ä¸ºäº†æ·»åŠ  HTTP è·¯ç”±çš„é¢å¤–å±æ€§ï¼Œåªèƒ½é€šè¿‡æ·»åŠ å¤§é‡çš„ &lt;code&gt;annotation&lt;/code&gt; æ¥å®ç°ï¼Œè€Œä¸”æ¯ä¸ªæ’ä»¶çš„ annotation éƒ½ä¸ä¸€æ ·ï¼Œéå¸¸æ··ä¹±ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;IngressRoute&lt;/code&gt; CRD çš„ç›®æ ‡å°±æ˜¯æ‰©å±• Ingress API çš„åŠŸèƒ½ï¼Œä»¥ä¾¿æä¾›æ›´ä¸°å¯Œçš„ç”¨æˆ·ä½“éªŒä»¥åŠè§£å†³åŸå§‹è®¾è®¡ä¸­çš„ç¼ºç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;**ç›®å‰ Contour æ˜¯å”¯ä¸€æ”¯æŒ IngressRoute CRD çš„ Kubernetes Ingress Controllerã€‚**ä¸‹é¢å°±æ¥çœ‹çœ‹å®ƒä¸ Ingress ç›¸æ¯”çš„ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®‰å…¨åœ°æ”¯æŒå¤šå›¢é˜Ÿ Kubernetes é›†ç¾¤ï¼Œèƒ½å¤Ÿé™åˆ¶å“ªäº›å‘½åç©ºé—´å¯ä»¥é…ç½®è™šæ‹Ÿä¸»æœºå’Œ TLS å‡­æ®ã€‚&lt;/li&gt;
&lt;li&gt;å…è®¸å°†è·¯å¾„æˆ–åŸŸåçš„è·¯ç”±é…ç½®åˆ†å‘ç»™å¦ä¸€ä¸ªå‘½åç©ºé—´ã€‚&lt;/li&gt;
&lt;li&gt;æ¥å—å•ä¸ªè·¯ç”±ä¸­çš„å¤šä¸ªæœåŠ¡ï¼Œå¹¶å¯¹å®ƒä»¬ä¹‹é—´çš„æµé‡è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;li&gt;æ— éœ€é€šè¿‡æ·»åŠ  &lt;code&gt;annotation&lt;/code&gt; å°±å¯ä»¥å®šä¹‰æœåŠ¡æƒé‡å’Œè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨åˆ›å»ºæ—¶éªŒè¯ IngressRoute å¯¹è±¡ï¼Œå¹¶åœ¨åˆ›å»ºåæŠ¥å‘ŠéªŒè¯æ˜¯å¦æœ‰æ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä»-ingress-åˆ°-ingressroute&#34;&gt;ä» Ingress åˆ° IngressRoute&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªåŸºæœ¬çš„ &lt;code&gt;Ingress&lt;/code&gt; å¯¹è±¡å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# ingress.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;basic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo-basic.bar.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;s1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ª Ingress å¯¹è±¡åä¸º &lt;code&gt;basic&lt;/code&gt;ï¼Œå®ƒå°†ä¼ å…¥çš„ HTTP æµé‡è·¯ç”±åˆ°å¤´æ–‡ä»¶ä¸­ &lt;code&gt;Host:&lt;/code&gt; å­—æ®µå€¼ä¸º &lt;code&gt;foo-basic.bar.com&lt;/code&gt; ä¸”ç«¯å£ä¸º 80 çš„ &lt;code&gt;s1&lt;/code&gt; æœåŠ¡ã€‚è¯¥è·¯ç”±è§„åˆ™é€šè¿‡ &lt;code&gt;IngressRoute&lt;/code&gt; æ¥å®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# ingressroute.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;contour.heptio.com/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IngressRoute&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;basic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtualhost&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fqdn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo-basic.bar.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;services&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;s1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯¹åº”å…³ç³»å¾ˆç®€å•ï¼Œæˆ‘å°±ä¸å†è¯¦ç»†ä»‹ç»äº†ï¼Œæ›´å¤šåŠŸèƒ½é…ç½®å¯ä»¥å‚è€ƒå®˜æ–¹ä»“åº“çš„æ–‡æ¡£ï¼š&lt;a href=&#34;https://github.com/heptio/contour/blob/master/docs/ingressroute.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IngressRoute&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;7-envoy-åˆå§‹é…ç½®æ–‡ä»¶&#34;&gt;7. Envoy åˆå§‹é…ç½®æ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;Contour ä¼šæ ¹æ®å¯åŠ¨å‚æ•°å’Œ K8S API Server ä¸­çš„é…ç½®ä¿¡æ¯ç”Ÿæˆ Envoy çš„åˆå§‹é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°† Envoy Pod ä¸­çš„é…ç½®æ–‡ä»¶å¯¼å‡ºæ¥æŸ¥çœ‹å…¶ä¸­çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n heptio-contour &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; envoy-lb8mm -- cat /config/envoy.json &amp;gt; envoy.json
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰“å¼€ç½‘ç«™ &lt;a href=&#34;https://www.bejson.com/jsonviewernew/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.bejson.com/jsonviewernew/&lt;/a&gt;ï¼Œå°†é…ç½®æ–‡ä»¶å†…å®¹å¤åˆ¶ç²˜è´´è¿›å»ï¼Œå¯ä»¥çœ‹åˆ°é…ç½®æ–‡ä»¶çš„ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-27-145403.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…¶ä¸­å„ä¸ªé…ç½®èŠ‚ç‚¹çš„å†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;h3 id=&#34;dynamic_resources&#34;&gt;Dynamic_resources&lt;/h3&gt;
&lt;p&gt;é…ç½®åŠ¨æ€èµ„æºï¼Œè¿™é‡Œé…ç½®äº† LDS å’Œ RDS æœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;dynamic_resources&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;lds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_config_source&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GRPC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc_services&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy_grpc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;contour&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;cds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_config_source&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GRPC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc_services&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy_grpc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;contour&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;static_resources&#34;&gt;Static_resources&lt;/h3&gt;
&lt;p&gt;é…ç½®é™æ€èµ„æºï¼ŒåŒ…æ‹¬äº† &lt;code&gt;contour&lt;/code&gt; å’Œ &lt;code&gt;service-stats&lt;/code&gt; ä¸¤ä¸ª clusterï¼Œå…¶ä¸­ contour cluster å¯¹åº”å‰é¢ dynamic_resources ä¸­çš„ LDS å’Œ RDS é…ç½®ï¼ŒæŒ‡æ˜äº† Envoy ç”¨äºè·å–åŠ¨æ€èµ„æºçš„æœåŠ¡å™¨åœ°å€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;static_resources&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;contour&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;alt_stat_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;heptio-contour_contour_8001&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;STRICT_DNS&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;5s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;load_assignment&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;contour&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;contour&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      &lt;span class=&#34;nt&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;8001&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;circuit_breakers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;thresholds&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;priority&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;HIGH&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_connections&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_pending_requests&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_requests&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;60000000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_retries&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_connections&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_pending_requests&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_requests&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;60000000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_retries&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;common_tls_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_certificates&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;certificate_chain&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;filename&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/certs/tls.crt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;private_key&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;filename&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/certs/tls.key&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;validation_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;trusted_ca&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;filename&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/ca/cacert.pem&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;verify_subject_alt_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;s2&#34;&gt;&amp;#34;contour&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;http2_protocol_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;service-stats&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;alt_stat_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;heptio-contour_service-stats_9001&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;LOGICAL_DNS&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.250s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;load_assignment&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;service-stats&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      &lt;span class=&#34;nt&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9001&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;admin&#34;&gt;Admin&lt;/h3&gt;
&lt;p&gt;é…ç½® Envoy çš„æ—¥å¿—è·¯å¾„ä»¥åŠç®¡ç†ç«¯å£ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;admin&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;access_log_path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/dev/null&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9001&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“åˆ Envoy çš„åˆå§‹åŒ–é…ç½®æ–‡ä»¶å’Œç¬¬ 5 èŠ‚çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´çœ‹åˆ° Contour é€šè¿‡ Envoy æ¥å®ç°å—åŒ—æµé‡ç®¡ç†çš„åŸºæœ¬åŸç†ã€‚å³æ§åˆ¶å¹³é¢å°† xDS server ä¿¡æ¯é€šè¿‡ &lt;code&gt;static resource&lt;/code&gt; çš„æ–¹å¼é…ç½®åˆ° Envoy çš„åˆå§‹åŒ–é…ç½®æ–‡ä»¶ä¸­ï¼ŒEnvoy å¯åŠ¨åé€šè¿‡ xDS server è·å–åˆ° &lt;code&gt;dynamic resource&lt;/code&gt;ï¼ŒåŒ…æ‹¬é›†ç¾¤ä¸­çš„ service ä¿¡æ¯åŠè·¯ç”±è§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;Envoy é…ç½®åˆå§‹åŒ–æµç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/contour-envoy.svg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Envoy initContainer æ ¹æ®å¯åŠ¨å‚æ•°å’Œ K8S API Server ä¸­çš„é…ç½®ä¿¡æ¯ç”Ÿæˆ Envoy çš„åˆå§‹é…ç½®æ–‡ä»¶ &lt;code&gt;envoy.json&lt;/code&gt;ï¼Œè¯¥æ–‡ä»¶å‘Šè¯‰ Envoy ä» &lt;code&gt;xDS server&lt;/code&gt; ä¸­è·å–åŠ¨æ€é…ç½®ä¿¡æ¯ï¼Œå¹¶é…ç½®äº† xDS server çš„åœ°å€ä¿¡æ¯ï¼Œå³æ§åˆ¶å¹³é¢çš„ &lt;code&gt;Contour&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;Envoy ä½¿ç”¨é…ç½®æ–‡ä»¶ &lt;code&gt;envoy.json&lt;/code&gt; å¯åŠ¨ã€‚&lt;/li&gt;
&lt;li&gt;Envoy æ ¹æ®è·å–åˆ°çš„åŠ¨æ€é…ç½®å¯åŠ¨ Listenerï¼Œå¹¶æ ¹æ® Listener çš„é…ç½®ï¼Œç»“åˆ Route å’Œ Cluster å¯¹è¿›å…¥çš„æµé‡è¿›è¡Œå¤„ç†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;8-ingressroute-é…ç½®æ˜ å°„&#34;&gt;8. IngressRoute é…ç½®æ˜ å°„&lt;/h2&gt;
&lt;p&gt;é€šè¿‡ä¸ŠèŠ‚çš„åˆ†ææˆ‘ä»¬çŸ¥é“ï¼ŒEnvoy ä¸­å®é™…ç”Ÿæ•ˆçš„é…ç½®æ˜¯ç”±åˆå§‹åŒ–é…ç½®æ–‡ä»¶ä¸­çš„é™æ€é…ç½®å’Œä» Contour è·å–çš„åŠ¨æ€é…ç½®ä¸€èµ·ç»„æˆçš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Envoy çš„ç®¡ç†æ¥å£æ¥è·å– Envoy çš„å®Œæ•´é…ç½®ï¼Œå…ˆæ‰“å¼€ Envoy çš„ç®¡ç†æ¥å£ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-28-033029.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç„¶åç‚¹å‡» &lt;code&gt;config_dump&lt;/code&gt;ï¼Œå°±èƒ½çœ‹åˆ° Envoy çš„å®Œæ•´é…ç½®ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-28-033133.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨ç¬¬äºŒèŠ‚åˆ›å»ºäº†ä¸€ä¸ª ingressrouteï¼Œç°åœ¨æ¥çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆæ˜ å°„åˆ° Envoy çš„é…ç½®æ–‡ä»¶ä¸­çš„ã€‚ä½ å¯ä»¥åˆ° &lt;code&gt;config_dump&lt;/code&gt; ä¸­æŸ¥æ‰¾ç›¸å…³é…ç½®ï¼Œä½†è¿˜æœ‰æ›´å¥½çš„åŠæ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Contour çš„å‘½ä»¤è¡Œå·¥å…·ç›´æ¥è°ƒç”¨ Contour çš„ xDS gRPC æ¥å£æ¥åˆ†åˆ«æŸ¥çœ‹ Envoy çš„ Listenerã€Routeã€Cluster å’Œ Endpoint é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;Contour æ€»å…±æœ‰ä¸¤ä¸ªå®ä¾‹ï¼Œé€šè¿‡é€‰ä¸¾æ¥å®ç°é«˜å¯ç”¨ï¼Œè¢«é€‰ä¸­çš„å®ä¾‹ä½œä¸º &lt;code&gt;leader&lt;/code&gt; æ¥å¯¹å¤–æä¾›æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n heptio-contour get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;contour
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                       READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;contour-767fd99989-27qjw   1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          14h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;contour-767fd99989-kcjxz   0/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          14h
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çœ‹çœ‹å“ªä¸ªæ˜¯ leaderï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-28-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-08-28%20%E4%B8%8A%E5%8D%8811.53.32.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°è¯¥å®ä¾‹ä¸æ˜¯ leaderï¼Œæˆ‘ä»¬åˆ°å¦ä¸€ä¸ªå®ä¾‹ä¸­å»æŸ¥çœ‹ Envoy xDS é…ç½®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;listener&#34;&gt;Listener&lt;/h3&gt;
&lt;p&gt;Envoy é‡‡ç”¨ listener æ¥æ¥æ”¶å¹¶å¤„ç† &lt;code&gt;downstream&lt;/code&gt; å‘è¿‡æ¥çš„è¯·æ±‚ï¼Œlistener çš„å¤„ç†é€»è¾‘æ˜¯æ’ä»¶å¼çš„ï¼Œå¯ä»¥é€šè¿‡é…ç½®ä¸åŒçš„ filter æ¥æ’å…¥ä¸åŒçš„å¤„ç†é€»è¾‘ã€‚Listener å¯ä»¥ç»‘å®šåˆ° &lt;code&gt;IP Socket&lt;/code&gt; æˆ–è€… &lt;code&gt;Unix Domain Socket&lt;/code&gt; ä¸Šï¼Œä¹Ÿå¯ä»¥ä¸ç»‘å®šåˆ°ä¸€ä¸ªå…·ä½“çš„ç«¯å£ä¸Šï¼Œè€Œæ˜¯æ¥æ”¶ä»å…¶ä»– listener è½¬å‘æ¥çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;Listener çš„é…ç½®å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n heptio-contour &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it contour-767fd99989-27qjw -- contour cli --cafile&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/ca/cacert.pem --cert-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/certs/tls.crt --key-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/certs/tls.key lds
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-28-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-08-28%20%E4%B8%8B%E5%8D%8812.02.20.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ° Listener è¢«ç»‘å®šåˆ°äº† 80 ç«¯å£ä¸Šï¼ŒåŒæ—¶é€šè¿‡ RDS é…ç½®äº†ä¸€ä¸ªè·¯ç”±è§„åˆ™ &lt;code&gt;ingress_http&lt;/code&gt;ï¼Œåœ¨è·¯ç”±è§„åˆ™ä¸­å†æ ¹æ®ä¸åŒçš„è¯·æ±‚ç›®çš„åœ°å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;route&#34;&gt;Route&lt;/h3&gt;
&lt;p&gt;Route ç”¨æ¥é…ç½® Envoy çš„è·¯ç”±è§„åˆ™ï¼Œæ ¹æ® host æ¥å¯¹è¯·æ±‚è¿›è¡Œè·¯ç”±åˆ†å‘ã€‚&lt;/p&gt;
&lt;p&gt;Route çš„é…ç½®å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n heptio-contour &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it contour-767fd99989-27qjw -- contour cli --cafile&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/ca/cacert.pem --cert-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/certs/tls.crt --key-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/certs/tls.key rds
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-28-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-08-28%20%E4%B8%8B%E5%8D%882.58.38.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šé¢æ˜¯ &lt;code&gt;ingress_http&lt;/code&gt; çš„è·¯ç”±é…ç½®ï¼Œå¯¹åº”äº†ä¸¤ä¸ª &lt;code&gt;virtual host&lt;/code&gt;ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯é»˜è®¤è·¯ç”±ï¼ˆå›¾ä¸­çœç•¥ï¼‰ï¼Œä¸Šé¢å±•ç¤ºçš„æ˜¯ kuard çš„è·¯ç”±ï¼Œå¯¹åº”åˆ° Cluster &lt;code&gt;default/kuard/80/da39a3ee5e&lt;/code&gt;ã€‚å…¶ä¸­ &lt;code&gt;domains: &amp;quot;kuard.local:*&amp;quot;&lt;/code&gt; è¡¨ç¤ºå…è®¸è®¿é—®çš„åŸŸåä¸º kuard.localï¼Œç«¯å£å¯ä»¥æ˜¯ä»»æ„å€¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cluster&#34;&gt;Cluster&lt;/h3&gt;
&lt;p&gt;Cluster æ˜¯ä¸€ä¸ªæœåŠ¡é›†ç¾¤ï¼ŒCluster ä¸­åŒ…å«ä¸€ä¸ªåˆ°å¤šä¸ª endpointï¼Œæ¯ä¸ª endpoint éƒ½å¯ä»¥æä¾›æœåŠ¡ï¼ŒEnvoy æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•å°†è¯·æ±‚å‘é€åˆ°è¿™äº› endpoint ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;Cluster çš„é…ç½®å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n heptio-contour &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it contour-767fd99989-27qjw -- contour cli --cafile&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/ca/cacert.pem --cert-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/certs/tls.crt --key-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/certs/tls.key cds
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-28-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-08-28%20%E4%B8%8B%E5%8D%883.10.32.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;code&gt;cluster_name: &amp;quot;contour&amp;quot;&lt;/code&gt; è¡¨ç¤ºé€šè¿‡ xDS æ¥å£ä» contour æ§åˆ¶å¹³é¢åŠ¨æ€è·å– Endpoint ä¿¡æ¯ã€‚è·å–åˆ°çš„ Endpoint æ˜¯ &lt;code&gt;default/kuard&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;endpoint&#34;&gt;Endpoint&lt;/h3&gt;
&lt;p&gt;Endpoint å°±å¯¹åº”åˆ° Kubernetes ä¸­çš„ &lt;code&gt;Endpoint&lt;/code&gt; èµ„æºï¼Œå¯¹åº”çš„å³æ˜¯ Pod çš„ &lt;code&gt;IP+Port&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Cluster çš„é…ç½®å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n heptio-contour &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it contour-767fd99989-27qjw -- contour cli --cafile&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/ca/cacert.pem --cert-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/certs/tls.crt --key-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/certs/tls.key eds&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;grep &lt;span class=&#34;s2&#34;&gt;&amp;#34;default/kuard&amp;#34;&lt;/span&gt; -A &lt;span class=&#34;m&#34;&gt;34&lt;/span&gt; -B &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-28-071943.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;éªŒè¯ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get ep -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kuard
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME    ENDPOINTS                                                     AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kuard   100.118.117.18:8080,100.119.55.150:8080,100.91.147.204:8080   17h
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;9-å¯¹æ¥ç›‘æ§&#34;&gt;9. å¯¹æ¥ç›‘æ§&lt;/h2&gt;
&lt;p&gt;Contour å’Œ Envoy éƒ½æš´éœ²ä¸€äº›ç›‘æ§æŒ‡æ ‡å¯ä»¥è¢« &lt;code&gt;Prometheus&lt;/code&gt; æŠ“å–ï¼Œå®˜æ–¹ä¹Ÿæä¾›äº† Prometheus å’Œ Grafana çš„éƒ¨ç½²æ¨¡æ¿ï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¼šæœ‰è‡ªå·±çš„ç›‘æ§ç³»ç»Ÿï¼Œæ¯”å¦‚ &lt;a href=&#34;https://github.com/coreos/prometheus-operator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;prometheus-operator&lt;/a&gt;ï¼Œåªéœ€è¦å°†å®˜æ–¹çš„ Grafana æ¨¡æ¿å¯¼å…¥è‡ªå·±çš„ Grafana ä¸­å°±å¯ä»¥äº†ï¼Œåç»­ä¼šæ¢è®¨è¯¦ç»†æ­¥éª¤ã€‚&lt;/p&gt;
&lt;h3 id=&#34;envoy-metrics&#34;&gt;Envoy Metrics&lt;/h3&gt;
&lt;p&gt;Envoy é»˜è®¤é€šè¿‡ admin æ¥å£æš´éœ²ç›‘æ§æŒ‡æ ‡ï¼Œä¸ºäº†é¿å…æš´éœ² admin æ¥å£ï¼ŒContour åˆ›å»ºäº†ä¸€ä¸ªé™æ€ Listenerï¼Œåªå°†è®¿é—®è·¯å¾„ä¸º &lt;code&gt;/stats&lt;/code&gt; çš„æµé‡è½¬å‘åˆ° &lt;code&gt;service-stats&lt;/code&gt; Clusterï¼Œå³ admin æ¥å£ï¼Œå…¶ä»–æ‰€æœ‰è¯·æ±‚ä¸€å¾‹æ‹’ç»è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-28-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-08-28%20%E4%B8%8B%E5%8D%884.28.00.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-28-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-08-28%20%E4%B8%8B%E5%8D%884.31.22.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡åªæ˜¯ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œæ‰å°† admin æ¥å£çš„ IP æ”¹ä¸º 0.0.0.0ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¸è¦æ”¹ï¼Œé»˜è®¤å€¼ä¸º &lt;code&gt;127.0.0.1&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰€ä»¥ Envoy åœ¨ &lt;code&gt;8002&lt;/code&gt; ç«¯å£æš´éœ²ç›‘æ§æŒ‡æ ‡ï¼Œè·¯å¾„ä¸º &lt;code&gt;/stats/prometheus&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;contour-metrics&#34;&gt;Contour Metrics&lt;/h3&gt;
&lt;p&gt;Contour åœ¨ &lt;code&gt;8000&lt;/code&gt; ç«¯å£ä¸Šæš´éœ²ç›‘æ§æŒ‡æ ‡ï¼Œè·¯å¾„ä¸º &lt;code&gt;/metrics&lt;/code&gt;ã€‚åŒ…å«ä»¥ä¸‹ç›‘æ§æŒ‡æ ‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;contour_ingressroute_total (gauge)&lt;/strong&gt; : IngressRoute çš„æ€»æ•°é‡ï¼ŒåŒ…æ‹¬çŠ¶æ€ä¸º &lt;code&gt;Valid / Invalid / Orphaned&lt;/code&gt; çš„ IngressRouteã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;contour_ingressroute_orphaned_total (gauge)&lt;/strong&gt; : çŠ¶æ€ä¸º &lt;code&gt;Orphaned&lt;/code&gt; çš„ IngressRoute æ•°é‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;contour_ingressroute_root_total (gauge)&lt;/strong&gt; : &lt;code&gt;Root&lt;/code&gt; IngressRoute çš„æ•°é‡ï¼ˆæ¯ä¸ª vhost åªæœ‰ä¸€ä¸ª Root IngressRouteï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;contour_ingressroute_valid_total (gauge)&lt;/strong&gt; : çŠ¶æ€ä¸º &lt;code&gt;Valid&lt;/code&gt; çš„ IngressRoute æ•°é‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;contour_ingressroute_invalid_total (gauge)&lt;/strong&gt; : çŠ¶æ€ä¸º &lt;code&gt;Invalid&lt;/code&gt; çš„ IngressRoute æ•°é‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;contour_ingressroute_dagrebuild_timestamp (gauge)&lt;/code&gt; : æœ€è¿‘ä¸€æ¬¡é‡å»º DAG çš„æ—¶é—´æˆ³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢å°±æ¥æ•™å¤§å®¶æ€ä¹ˆå°† Contour æ¥å…¥ Prometheus-Operatorï¼Œå¯¹ Prometheus-Operator ä¸ç†Ÿçš„åŒå­¦ï¼Œæ¨èçœ‹ä¸€ä¸‹å¼ é¦†é•¿çš„è¿™ç¯‡æ–‡ç« ï¼š&lt;a href=&#34;https://www.servicemesher.com/blog/prometheus-operator-manual/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¨æ‰‹åŠ¨éƒ¨ç½² prometheus-operator ç›‘æ§ Kubernetes é›†ç¾¤é‡åˆ°çš„å‘&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;rbac-æˆæƒ&#34;&gt;RBAC æˆæƒ&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†è®© Prometheus èƒ½å¤Ÿ &lt;code&gt;list&lt;/code&gt; å…¶ä»– namespace ä¸­çš„ podï¼Œæˆ‘ä»¬éœ€è¦èµ‹äºˆå®ƒç›¸åº”çš„æƒé™ï¼Œé¦–å…ˆè¿›å…¥ &lt;code&gt;kube-prometheus&lt;/code&gt; é¡¹ç›®çš„ manifests ç›®å½•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; kube-prometheus/manifests
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ll *SpecificNamespace*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; -rw-r--r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root  &lt;span class=&#34;m&#34;&gt;988&lt;/span&gt; 8æœˆ  &lt;span class=&#34;m&#34;&gt;27&lt;/span&gt; 05:22 prometheus-roleBindingSpecificNamespaces.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; -rw-r--r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;1078&lt;/span&gt; 8æœˆ  &lt;span class=&#34;m&#34;&gt;27&lt;/span&gt; 05:15 prometheus-roleSpecificNamespaces.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¿®æ”¹ &lt;code&gt;prometheus-roleSpecificNamespaces.yaml&lt;/code&gt;ï¼Œå‘å…¶ä¸­æ·»åŠ å¦‚ä¸‹çš„ Roleï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- &lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Role&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;prometheus-k8s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;heptio-contour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;services&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;endpoints&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;watch&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¿®æ”¹ &lt;code&gt;prometheus-roleBindingSpecificNamespaces.yaml&lt;/code&gt;ï¼Œå‘å…¶ä¸­æ·»åŠ å¦‚ä¸‹çš„ RoleBindingï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- &lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;RoleBinding&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;prometheus-k8s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;heptio-contour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;roleRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Role&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;prometheus-k8s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subjects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceAccount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;prometheus-k8s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;monitoring&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶ååˆ›å»ºç›¸åº”çš„ &lt;code&gt;Role&lt;/code&gt; å’Œ &lt;code&gt;RoleBinding&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f prometheus-roleSpecificNamespaces.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f prometheus-roleBindingSpecificNamespaces.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä¿®æ”¹-contour-manifest-æ–‡ä»¶&#34;&gt;ä¿®æ”¹ Contour manifest æ–‡ä»¶&lt;/h3&gt;
&lt;p&gt;Prometheus ç›‘æ§çš„å¯¹è±¡è¢«å«åš &lt;code&gt;Target&lt;/code&gt;ï¼ŒTarget é€šè¿‡ Cluster ä¸­çš„ &lt;code&gt;Endpoint&lt;/code&gt; èµ„æºæ¥å®šä¹‰ï¼Œæ¯ä¸ªç›‘æ§å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ Endpointã€‚è€Œ &lt;code&gt;ServiceMonitor&lt;/code&gt; æ˜¯ Target çš„æŠ½è±¡ï¼ŒServiceMonitor é€šè¿‡æ ‡ç­¾æ¥æ‰¾åˆ°å¯¹åº”çš„ Endpointï¼Œç„¶åå°†ç›¸åº”çš„ Target æ·»åŠ åˆ° Prometheus çš„ç›‘æ§åˆ—è¡¨ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ Contour çš„ Service æ˜¯æ²¡æœ‰æ‰“æ ‡ç­¾çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ yaml æ–‡ä»¶ï¼ŒåŠ ä¸Šç›¸åº”çš„æ ‡ç­¾ã€‚é¦–å…ˆä¿®æ”¹ Contour Deployment çš„ yaml æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# 03-contour.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8001&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;xds&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å°† name æ”¹ä¸º http-metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†ä¿®æ”¹ Contour Service çš„ yaml æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# 02-service-envoy.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ·»åŠ æ–°ç«¯å£&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8002&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Envoy ç±»ä¼¼ï¼Œå…ˆä¿®æ”¹ Envoy Deployment çš„ yaml æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# 03-envoy.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ·»åŠ æ–°ç«¯å£&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8002&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8002&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†ä¿®æ”¹ Envoy Service çš„ yaml æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# 02-service-envoy.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ·»åŠ æ–°ç«¯å£&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8002&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åé‡æ–° apply ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# åœ¨ contour/examples/ds-hostnet-split ç›®å½•ä¸‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f ./
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åˆ›å»º-servicemonitor&#34;&gt;åˆ›å»º ServiceMonitor&lt;/h3&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°±æ˜¯åˆ›å»ºç›¸åº”çš„ &lt;code&gt;ServiceMonitor&lt;/code&gt; æ¥æŠ“å–æŒ‡æ ‡æ•°æ®ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œè‡ªå·±çœ‹ yaml æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;$ cat prometheus-serviceMonitorContour.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;monitoring.coreos.com/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceMonitor&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;contour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;contour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;monitoring&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;endpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;30s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;jobLabel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaceSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;heptio-contour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;contour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;monitoring.coreos.com/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceMonitor&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;monitoring&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;endpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;30s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/stats/prometheus&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaceSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;heptio-contour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åˆ›å»º-ingressroute&#34;&gt;åˆ›å»º IngressRoute&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†æŸ¥çœ‹ &lt;code&gt;Prometheus&lt;/code&gt; å’Œ &lt;code&gt;Grafana&lt;/code&gt; çš„ Dashboardï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå®ƒä»¬åˆ›å»ºç›¸åº”çš„ IngressRouteï¼Œyaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# ingressroute-prometheus.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;contour.heptio.com/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IngressRoute&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grafana&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grafana&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;monitoring&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtualhost&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fqdn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grafana.sealos.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;services&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grafana&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;contour.heptio.com/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IngressRoute&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;prometheus&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;prometheus&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;monitoring&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtualhost&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fqdn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;prometheus.sealos.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;services&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;prometheus-k8s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9090&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç›´æ¥ applyï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f ingressroute-prometheus.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†åŸŸåå†™å…¥æœ¬åœ°ç”µè„‘çš„ hosts ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$INGRESS_HOST&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; grafana.sealos.io&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; /etc/hosts
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$INGRESS_HOST&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; prometheus.sealos.io&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; /etc/hosts
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ &lt;code&gt;$INGRESS_HOST&lt;/code&gt; æ˜¯ä»»æ„è¿è¡Œ Envoy èŠ‚ç‚¹çš„ IPã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥åŸŸå &lt;code&gt;prometheus.sealos.io&lt;/code&gt; æ¥æŸ¥çœ‹ Prometheus Target çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-28-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-08-29%20%E4%B8%8A%E5%8D%881.01.47.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ª Target å·²ç»è¢«æŠ“å–åˆ°äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯¼å…¥-grafana-æ¨¡æ¿&#34;&gt;å¯¼å…¥ Grafana æ¨¡æ¿&lt;/h3&gt;
&lt;p&gt;å‰é¢æåˆ° Contour å®˜æ–¹ä»“åº“ä¸­æä¾›äº† Grafana Dashboard æ¨¡æ¿ï¼Œç°åœ¨æˆ‘ä»¬è¦åšçš„äº‹å°±æ˜¯æŠŠè¿™ä¸ªæ¨¡æ¿å¯¼å…¥åˆ°è‡ªå·±çš„ Grafana ä¸­ã€‚å®˜æ–¹çš„ Grafana Dashboard æ¨¡æ¿å®šä¹‰åœ¨ &lt;code&gt;contour/examples/grafana&lt;/code&gt; ç›®å½•ä¸‹çš„ ConfigMap æ–‡ä»¶ä¸­ï¼Œå¯ä»¥å…ˆæŠŠå®ƒå¯¼å‡ºæ¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å‡è®¾ contour é¡¹ç›®åœ¨ä½ çš„ $HOME ç›®å½•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sed &lt;span class=&#34;s1&#34;&gt;&amp;#39;/---/,$d&amp;#39;&lt;/span&gt; ~/contour/examples/grafana/02-grafana-configmap.yaml &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  sed &lt;span class=&#34;s1&#34;&gt;&amp;#39;s/grafana-dashs/grafana-dashboard-contour/&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  sed &lt;span class=&#34;s1&#34;&gt;&amp;#39;s/contour-monitoring/monitoring/&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  sed &lt;span class=&#34;s1&#34;&gt;&amp;#39;s/kubernetes_pod_name/pod/g&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  sed &lt;span class=&#34;s1&#34;&gt;&amp;#39;s/ingress_http_update/update/g&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;configmap/grafana-dashboard-contour created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ›å»ºäº† &lt;code&gt;ConfigMap&lt;/code&gt; åï¼Œè¿˜è¦å†æŒ‚è½½åˆ° Grafana çš„ Dashboard ä¸­ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ Grafana Deployment çš„ yaml æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# ~/kube-prometheus/manifests/grafana-deployment.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/var/lib/grafana&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grafana-storage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...çœç•¥...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ–°å¢æŒ‚è½½&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/grafana-dashboard-definitions/0/contour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grafana-dashboard-contour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...çœç•¥...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;emptyDir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grafana-storage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...çœç•¥...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ–°å¢ ConfigMap&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;configMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grafana-dashboard-contour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grafana-dashboard-contour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡æ–° apply ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f grafana-deployment.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨åœ¨æµè§ˆå™¨ä¸­è¾“å…¥åŸŸå &lt;code&gt;grafana.sealos.io&lt;/code&gt;ï¼Œå°±å¯ä»¥çœ‹åˆ° Contour å’Œ Envoy çš„ Dashboard äº†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-29-060947.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-29-061037.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯¹æ¥ç›‘æ§åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå‰©ä¸‹çš„å¤§å®¶å¯ä»¥è‡ªå·±å»æ¢ç´¢ï¼Œæ€»ä½“æ¥è¯´éš¾åº¦è¿˜æ˜¯ç¨å¾®æœ‰ç‚¹å¤§ï¼Œå¸Œæœ›æˆ‘çš„ç»†å¿ƒè®²è§£èƒ½å¤Ÿå¸®åŠ©åˆ°ä½ ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä¸º Envoy æ„å»ºæ§åˆ¶é¢æŒ‡å—ç¬¬ 2 éƒ¨åˆ†ï¼šè¯†åˆ«ç»„ä»¶</title>
      <link>https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-2-identify-components/</link>
      <pubDate>Fri, 28 Jun 2019 10:41:16 +0800</pubDate>
      <guid>https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-2-identify-components/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://blog.christianposta.com/envoy/guidance-for-building-a-control-plane-for-envoy-identify-components/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç¼–è€…æŒ‰&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•ä¸º Envoy æ„å»ºæ§åˆ¶é¢æŒ‡å—çš„ç¬¬ 2 éƒ¨åˆ†ï¼šè¯†åˆ«æ§åˆ¶å¹³é¢çš„å„ä¸ªç»„ä»¶ã€‚å¯¹å®æ–½ Envoy æ§åˆ¶å¹³é¢éœ€è¦äº†è§£çš„åŸºç¡€çŸ¥è¯†å¾ˆæœ‰å¸®åŠ©ã€‚ä¹Ÿç®—æ˜¯ Envoy çš„æ¦‚å¿µä»‹ç»ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;https://blog.christianposta.com/envoy/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ä¸ªç³»åˆ—æ–‡ç« çš„å‰ä¸€ç¯‡&lt;/a&gt;ä¸­ï¼Œæˆ‘ä»¬æµè§ˆäº† Envoy åŠ¨æ€é…ç½®å¯¹äºåœ¨äº‘åŸç”Ÿç¯å¢ƒä¸­è¿è¡Œ Envoy æ˜¯å¤šä¹ˆçš„é‡è¦ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ¥ä¸€èµ·çœ‹çœ‹ä¸ºäº†æ”¯æŒæ§åˆ¶å¹³é¢ï¼Œæˆ‘ä»¬éœ€è¦å¦‚ä½•åè°ƒå„ä¸ªç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºæ“ä½œç¯å¢ƒçš„å˜åŒ–å¾ˆå¤§ï¼Œå› æ­¤ä¸º Envoy å®æ–½æ§åˆ¶å¹³é¢æ‰€éœ€çš„ç»„ä»¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæç«¯æƒ…å†µä¸‹ï¼Œå¦‚æœä½ éœ€è¦æ„å»ºæ—¶é™æ€ç”Ÿæˆ Envoy æ–‡ä»¶å¹¶å‘é€ç»™ Envoy çš„éœ€æ±‚ï¼Œä½ éœ€è¦ä»¥ä¸‹ç»„ä»¶æ¥æ»¡è¶³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¨¡æ¿å¼•æ“&lt;/li&gt;
&lt;li&gt;æ•°æ®å­˜å‚¨/ VCSï¼Œç”¨äºè¾“å…¥æ¨¡æ¿çš„å€¼&lt;/li&gt;
&lt;li&gt;ä»»ä½•ç‰¹å®šäºæœåŠ¡çš„é…ç½®ï¼Œå¯èƒ½/å¯èƒ½ä¸ä¸æœåŠ¡/åº”ç”¨ç¨‹åºä¸€èµ·å­˜å‚¨&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªå°†å„ä¸ªéƒ¨åˆ†ç»„åˆåœ¨ä¸€èµ·çš„ç¼–æ’å™¨&lt;/li&gt;
&lt;li&gt;ä¸€ç§å°†è¿™äº›ä¼ é€’ç»™ Envoy çš„æ–¹æ³•&lt;/li&gt;
&lt;li&gt;ä¸€ç§è§¦å‘é…ç½®æ–‡ä»¶é‡æ–°åŠ è½½/çƒ­é‡å¯çš„æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ‚¨é€‰æ‹©ä½¿ç”¨ gRPC æµå¼ xDS å®ç°ï¼Œåˆ™éœ€è¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ ¸å¿ƒ xDS æœåŠ¡æ¥å£å’Œå®ç°&lt;/li&gt;
&lt;li&gt;ç”¨äºå¤„ç†å‘æœåŠ¡æ³¨å†Œè¡¨æ³¨å†Œ/å–æ¶ˆæ³¨å†ŒæœåŠ¡çš„ç»„ä»¶&lt;/li&gt;
&lt;li&gt;æœåŠ¡æ³¨å†Œè¡¨&lt;/li&gt;
&lt;li&gt;æè¿°æ‚¨çš„ Envoy é…ç½®çš„æŠ½è±¡å¯¹è±¡æ¨¡å‹ï¼ˆå¯é€‰ï¼‰&lt;/li&gt;
&lt;li&gt;ç”¨äºä¿å­˜é…ç½®çš„æ•°æ®å­˜å‚¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‚¨æœ€æœ‰å¯èƒ½éœ€è¦æ”¯æŒ Envoy æ“ä½œçš„å…¶ä»–è¾…åŠ©ç»„ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯ä¹¦/ CA å­˜å‚¨&lt;/li&gt;
&lt;li&gt;ç»Ÿè®¡æ”¶é›†å¼•æ“&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼è·Ÿè¸ªåç«¯/å¼•æ“&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨è®¤è¯&lt;/li&gt;
&lt;li&gt;é™é€ŸæœåŠ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šå¸¸ï¼Œæ‚¨éœ€è¦è€ƒè™‘æ„å»ºæ§åˆ¶å¹³é¢ï¼Œä»¥ä¾¿ç»„ä»¶ç‹¬ç«‹è¿è¡Œï¼Œå¹¶ä¸”å¯ä»¥æ¾æ•£åä½œä»¥æ»¡è¶³æ§åˆ¶å¹³é¢çš„éœ€æ±‚ã€‚æ‚¨è¦åšçš„æœ€åä¸€ä»¶äº‹æ˜¯é€šè¿‡éƒ¨ç½²æ•´ä½“æ§åˆ¶å¹³é¢æ¥æ”¯æŒ Envoy çš„å¾®æœåŠ¡éƒ¨ç½²ã€‚ä¾‹å¦‚ï¼Œåœ¨&lt;a href=&#34;https://gloo.solo.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼€æº Gloo é¡¹ç›®&lt;/a&gt; ä¸­ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹é©±åŠ¨æ§åˆ¶å¹³é¢çš„ç»„ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Gloo&lt;/code&gt; - ä¸€ä¸ªäº‹ä»¶é©±åŠ¨çš„ç»„ä»¶ï¼Œè´Ÿè´£ä¸ºæ ¸å¿ƒ xDS æœåŠ¡ç”Ÿæˆé…ç½®å¹¶ä¸ºå…¶æä¾›æœåŠ¡ï¼Œå¹¶é…ç½®è‡ªå®šä¹‰ Envoy è¿‡æ»¤å™¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Discovery&lt;/code&gt; - ä¸€ä¸ªå¯é€‰ç»„ä»¶ï¼ŒçŸ¥é“å¦‚ä½•ä½¿ç”¨æœåŠ¡å‘ç°æœåŠ¡ï¼ˆConsulï¼ŒKubernetes ç­‰ï¼‰æ¥å‘ç°å’Œé€šå‘Šä¸Šæ¸¸é›†ç¾¤å’Œç«¯ç‚¹ã€‚å®ƒè¿˜å¯ä»¥å‘ç° REST ç«¯ç‚¹ï¼ˆé€šè¿‡ swaggerï¼‰ï¼ŒgRPC åŠŸèƒ½ï¼ˆåŸºäº gRPC åå°„ï¼‰å’Œ AWS / GCP / Azure äº‘åŠŸèƒ½ã€‚è¯¥ç»„ä»¶åˆ›å»ºé…ç½®ï¼ˆåœ¨ Kubernetes ä¸Šï¼Œç”¨&lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CustomResourceDefinitions&lt;/a&gt;è¡¨ç¤ºï¼‰&lt;code&gt;Gloo&lt;/code&gt;ç»„ä»¶å¯ç”¨äº æ„å»ºé€šè¿‡ xDS è¡¨ç¤ºçš„è§„èŒƒ Envoy é…ç½®ã€‚æˆ‘ä»¬å°†åœ¨æœ¬ç³»åˆ—åšå®¢çš„åç»­éƒ¨åˆ†ä¸­çœ‹åˆ°æ›´å¤šå†…å®¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Gateway&lt;/code&gt; - è¯¥ç»„ä»¶å…è®¸ç”¨æˆ·ä½¿ç”¨æ›´èˆ’é€‚çš„å¯¹è±¡æ¨¡å‹æ¥æ ¹æ®å…¶è§’è‰²ï¼ˆå³è¾¹ç¼˜ç½‘å…³ï¼Œå…±äº«ä»£ç†ï¼Œknative ç¾¤é›†å…¥å£ç­‰ï¼‰é…ç½® Envoy ä»£ç†ã€‚æ§åˆ¶å¹³é¢çš„è¿™ä¸€éƒ¨åˆ†è¿˜ç”Ÿæˆâ€œGlooâ€æ§åˆ¶å¹³é¢å¯ç”¨äºé€šè¿‡ xDS ç”Ÿæˆ Envoy é…ç½®çš„é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-for-envoy-part-2-identify-components/gloo-control-plane_huda258205fbc8cf19ff43879cf7716c68_37149_dfdb3cb2bcc35cf894f7f697d517c64e.webp 400w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-2-identify-components/gloo-control-plane_huda258205fbc8cf19ff43879cf7716c68_37149_df08abf8311283e2ac47b8fdc8a87016.webp 760w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-2-identify-components/gloo-control-plane_huda258205fbc8cf19ff43879cf7716c68_37149_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-2-identify-components/gloo-control-plane_huda258205fbc8cf19ff43879cf7716c68_37149_dfdb3cb2bcc35cf894f7f697d517c64e.webp&#34;
               width=&#34;522&#34;
               height=&#34;373&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè¿™äº›åŸºæœ¬ç»„ä»¶è¢«éƒ¨ç½²ä¸ºååŒå·¥ä½œçš„æœåŠ¡ï¼Œä»¥æ„å»ºé€šè¿‡ xDS æä¾›çš„ç›¸åº” Envoy é…ç½®ã€‚Gloo é€šè¿‡ä½¿ç”¨è¿™äº›æ¾æ•£åè°ƒçš„æ§åˆ¶å¹³é¢ç»„ä»¶æ¥å®ç°å…¶å¼ºå¤§çš„å‘ç°åŠŸèƒ½ï¼Œå¯¹å‡½æ•°çš„è¯­ä¹‰ç†è§£ç­‰ï¼Œè¿™äº›ç»„ä»¶å¯ç”¨äºæœåŠ¡ Envoy é…ç½®ã€‚å½“ Gloo éƒ¨ç½²åˆ° Kubernetes æ—¶ï¼Œå­˜å‚¨å’Œé…ç½®éå¸¸å…·æœ‰â€œkube-nativeâ€çš„æ„Ÿè§‰ï¼šæ‰€æœ‰å†…å®¹éƒ½ç”±&lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªå®šä¹‰èµ„æºå®šä¹‰&lt;/a&gt;è¡¨ç¤ºã€‚å…·ä½“è€Œè¨€ï¼Œæ‰€æœ‰é¢å‘ç”¨æˆ·çš„é…ç½®ä»¥åŠé©±åŠ¨ xDS ç«¯ç‚¹çš„æ ¸å¿ƒé…ç½®éƒ½æ˜¯ CRDsã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Kubernetes API å’Œ kubectl ä¸ Gloo è¿›è¡Œäº¤äº’ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜æä¾›äº†ä¸€ä¸ª&lt;code&gt;glooctl&lt;/code&gt; &lt;a href=&#34;https://gloo.solo.io/cli/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CLI å·¥å…·æ¥ç®€åŒ–ä¸ Gloo æ§åˆ¶å¹³é¢çš„äº¤äº’&lt;/a&gt; - ç‰¹åˆ«æ˜¯å¦‚æœä½ ä¸æƒ³çš„è¯ï¼Œä½ ä¸å¿…ä¸ºäº† YAML è€Œçƒ¦æ¼ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒGloo éå¸¸æ³¨é‡å¼€å‘äººå‘˜çš„ä½“éªŒå’Œç®€åŒ– YAML çš„é…ç½®ï¼Œå¯¹å¼€å‘äººå‘˜ï¼ˆæˆ–ä»»ä½•äººï¼Ÿï¼‰æ¥è¯´è¿™äº›å¯èƒ½éå¸¸ç¹çã€‚&lt;/p&gt;
&lt;p&gt;Istio ä¹Ÿé‡‡ç”¨ç±»ä¼¼çš„æ–¹æ³•æ¥ä½¿ç”¨é€šè¿‡ Kubernetes CRDs é…ç½®çš„æ¾æ•£åè°ƒçš„æ§åˆ¶å¹³é¢ç»„ä»¶ã€‚Istio çš„æ§åˆ¶å¹³é¢ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Istio Pilot&lt;/code&gt;  - æ ¸å¿ƒ xDS æœåŠ¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Istio Galley&lt;/code&gt;  - é…ç½®/å­˜å‚¨æŠ½è±¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Istio Citadel&lt;/code&gt;  -  CA /è¯ä¹¦å¼•æ“&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Istio Telemetry&lt;/code&gt; - é¥æµ‹ä¿¡å·çš„æ¥æ”¶å™¨&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Istio Policy&lt;/code&gt; - ä¸€ä¸ªå¯æ’æ‹”çš„ç­–ç•¥å¼•æ“&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-for-envoy-part-2-identify-components/istio-control-plane_hu0fff0fdc4144dde132fdc9d70f76a2ce_35657_355abe2bbf5bba8345519f13d06d70f0.webp 400w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-2-identify-components/istio-control-plane_hu0fff0fdc4144dde132fdc9d70f76a2ce_35657_2ebb0506efcae4922a4a9b9d9480d6f9.webp 760w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-2-identify-components/istio-control-plane_hu0fff0fdc4144dde132fdc9d70f76a2ce_35657_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-2-identify-components/istio-control-plane_hu0fff0fdc4144dde132fdc9d70f76a2ce_35657_355abe2bbf5bba8345519f13d06d70f0.webp&#34;
               width=&#34;760&#34;
               height=&#34;249&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Heptio Contour å®é™…ä¸Šåªæœ‰ä¸¤ä¸ªç»„ä»¶ç»„æˆäº†å®ƒçš„æ§åˆ¶å¹³é¢ï¼Œä½†æ˜¯ï¼Œç”±äºå®ƒå®Œå…¨åŸºäº Kubernetesï¼Œå®ƒå®é™…ä¸Šåˆ©ç”¨äº†å¾ˆå¤šå†…ç½®çš„ Kubernetes å·¥å…·ï¼Œå¦‚ Kubernetes API / Storage å’Œ CRDs æ¥é©±åŠ¨é…ç½®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;contour&lt;/code&gt;æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;&lt;code&gt;init-container&lt;/code&gt; å¯åŠ¨å¼•å¯¼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-for-envoy-part-2-identify-components/contour-control-plane_hud7a2bca7d4cb5f148d4367841731967a_14871_a72d02b9e812d63d10dfe8000d81d9a4.webp 400w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-2-identify-components/contour-control-plane_hud7a2bca7d4cb5f148d4367841731967a_14871_84f4caa581fa9e4e87f320c251cf8386.webp 760w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-2-identify-components/contour-control-plane_hud7a2bca7d4cb5f148d4367841731967a_14871_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-2-identify-components/contour-control-plane_hud7a2bca7d4cb5f148d4367841731967a_14871_a72d02b9e812d63d10dfe8000d81d9a4.webp&#34;
               width=&#34;760&#34;
               height=&#34;181&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Contour ä½¿ç”¨&lt;code&gt;init-container&lt;/code&gt;ä¸º Envoy ç”Ÿæˆä¸€ä¸ªé™æ€å¼•å¯¼é…ç½®æ–‡ä»¶ï¼Œå‘Šè¯‰å®ƒåœ¨å“ªé‡Œæ‰¾åˆ° xDS æœåŠ¡ã€‚xDS æœåŠ¡å™¨æ˜¯æ§åˆ¶å¹³é¢ä¸­çš„ç¬¬äºŒä¸ªç»„ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸æ•°æ®å¹³é¢ä¸€èµ·éƒ¨ç½²ï¼Œå¹¶æä¾›å•ç‹¬éƒ¨ç½²çš„é€‰é¡¹ã€‚æˆ‘ä»¬å°†åœ¨æœ¬ç³»åˆ—â€œéƒ¨ç½²æ§åˆ¶å¹³é¢ç»„ä»¶â€çš„ç¬¬ 5 éƒ¨åˆ†ä¸­ä»‹ç»è¿™ç§æ¶æ„åŠå…¶æƒè¡¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h3&gt;
&lt;p&gt;ç¡®å®šæ§åˆ¶å¹³é¢æ‰€éœ€çš„æ ¸å¿ƒç»„ä»¶ã€‚ä¸è¦è¯•å›¾æ„å»ºä¸€ä¸ªå•ä½“çš„æ§åˆ¶å¹³é¢æŠ½è±¡ï¼Œå› ä¸ºè¿™å°†æˆä¸ºç»´æŠ¤å’Œæ›´æ–°çš„å™©æ¢¦ã€‚åœ¨æ¾æ•£è€¦åˆçš„ä½“ç³»ç»“æ„ä¸­æ„å»ºæ§åˆ¶å¹³é¢æ‰€éœ€çš„ç»„ä»¶ã€‚å¦‚æœæ‚¨å¯ä»¥æ„å»ºåœ¨ Kubernetes ä¹‹ä¸Šï¼Œé‚£ä¹ˆè¿™æ ·åšï¼š&lt;a href=&#34;https://medium.com/@allingeek/kubernetes-as-a-common-ops-data-plane-f8f2cf40cd59&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes æä¾›äº†ä¸€ä¸ªéå¸¸å¼ºå¤§çš„é›†æˆæ•°æ®å¹³é¢&lt;/a&gt;ç”¨äºæ“ä½œåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä¾‹å¦‚ Envoy æ§åˆ¶å¹³é¢ã€‚å¦‚æœä½ åœ¨ Kubernetes ä¹‹ä¸Šæ„å»ºä¸€ä¸ªæ§åˆ¶å¹³é¢ï¼Œä½ åº”è¯¥åˆ©ç”¨&lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªå®šä¹‰èµ„æºå®šä¹‰&lt;/a&gt;æ¥é©±åŠ¨é…ç½®ä½ çš„æ§åˆ¶å¹³é¢ã€‚æœ‰äº›äººé€‰æ‹©ä½¿ç”¨&lt;a href=&#34;https://github.com/kubernetes/ingress-nginx/blob/master/docs/user-guide/nginx-configuration/annotations.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¥å£å®šä¹‰&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://www.getambassador.io/reference/configuration/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡æ³¨é‡Š&lt;/a&gt;ï¼Œæˆ–&lt;a href=&#34;https://www.youtube.com/watch?v=a1tXFUrqt5M&amp;amp;list=PLj6h78yzYM2PF_iYEBntfR0m4KAZET18Q&amp;amp;index=14&amp;amp;t=0s&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é…ç½®æ˜ å°„&lt;/a&gt;æ¥æ„å»ºä»–ä»¬çš„æ§åˆ¶å¹³é¢ã€‚åœ¨ Kubernetes CRDs å¯ç”¨ä¹‹å‰ï¼Œè¿™äº›å¯èƒ½æ˜¯é€‚å½“çš„è§£å†³æ–¹æ³•ï¼Œä½†æ­¤æ—¶ä½ åº”è¯¥é¿å…è¿™äº›æ–¹æ³•å¹¶åšæŒä½¿ç”¨ CRDsã€‚å°±åƒ&lt;a href=&#34;https://kubernetespodcast.com/episode/041-ingress/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tim Hockinï¼ˆKubernetes çš„åˆ›å§‹äººï¼‰åœ¨æœ€è¿‘çš„æ’­å®¢ä¸­æ‰€è¯´çš„é‚£æ ·&lt;/a&gt;ï¼Œç”¨äºé©±åŠ¨ Ingress Gateway èµ„æºçš„æ³¨é‡Šæ˜¯ä¸€ä¸ªç³Ÿç³•çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« å®é™…ä¸Šå·²ç»å‘å¸ƒï¼š&lt;a href=&#34;https://blog.christianposta.com/envoy/guidance-for-building-a-control-plane-for-envoy-domain-specific-configuration-api/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸º Envoy æ„å»ºæ§åˆ¶å¹³é¢çš„æŒ‡å—ç¬¬ 3 éƒ¨åˆ† - åŸŸç‰¹å®šé…ç½® API&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Envoy åŠŸèƒ½ç‚¹è¯¦è§£ä¹‹å¼‚å¸¸ç‚¹æ£€æµ‹</title>
      <link>https://cloudnative.to/blog/envoy-feature-explain-outlier-detection/</link>
      <pubDate>Fri, 21 Jun 2019 19:20:19 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-feature-explain-outlier-detection/</guid>
      <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;å¾ˆå¤šäººå­¦ä¹ å’Œä½¿ç”¨ envoy æ—¶ï¼Œå¾ˆå®¹æ˜“æ··æ·†ä¸€äº›æ¦‚å¿µï¼Œæ¯”å¦‚æŠŠå¼‚å¸¸ç‚¹é©±é€å’Œå¾®æœåŠ¡ç†”æ–­æ··ä¸ºä¸€è°ˆï¼Œåˆ†ä¸æ¸…æœ€å¤§é©±é€æ¯”ä¸ææ…Œé˜ˆå€¼çš„åŒºåˆ«ç­‰ã€‚æœ¬æ–‡å°†åŸºäº envoy å®˜æ–¹æ–‡æ¡£ (&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;v1.10.0&lt;/a&gt;)ï¼Œè¯¦ç»†ä»‹ç»å¼‚å¸¸ç‚¹æ£€æµ‹çš„ç±»å‹ã€é©±é€ç®—æ³•ä»¥åŠç›¸å…³æ¦‚å¿µçš„è§£æï¼Œå¹¶ä¸”æœ€åå¯¹æ˜“æ··æ·†çš„å‡ ä¸ªæ¦‚å¿µè¿›è¡Œè¾¨æã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç®€ä»‹&#34;&gt;ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;å¼‚å¸¸ç‚¹æ£€æµ‹ (Outlier detection) å’Œé©±é€ (Ejection) æ˜¯ç”¨æ¥åŠ¨æ€ç¡®å®š&lt;code&gt;ä¸Šæ¸¸é›†ç¾¤&lt;/code&gt;ä¸­æ˜¯å¦æœ‰è¡¨ç°ä¸åŒäºå…¶ä»–ä¸»æœºçš„å®ä¾‹ï¼Œå¹¶å°†å®ƒä»¬ä»å¥åº·&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/intro/arch_overview/load_balancing/overview#arch-overview-load-balancing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´Ÿè½½å‡è¡¡&lt;/a&gt;é›†ä¸­ç§»é™¤çš„è¿‡ç¨‹ã€‚æ€§èƒ½å¯èƒ½ä¼šæ²¿ç€ä¸åŒçš„è½´å˜åŒ–ï¼Œå¦‚è¿ç»­å¤±è´¥ï¼Œä¸€æ—¶çš„æˆåŠŸç‡ï¼ŒçŸ­æ—¶é—´å†…çš„å»¶è¿Ÿç­‰ã€‚å¼‚å¸¸å€¼æ£€æµ‹æ˜¯ä¸€ç§&lt;code&gt;è¢«åŠ¨çš„&lt;/code&gt;å¥åº·æ£€æŸ¥å½¢å¼ã€‚Envoy è¿˜æ”¯æŒ&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/intro/arch_overview/health_checking#arch-overview-health-checking&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸»åŠ¨å¥åº·æ£€æŸ¥&lt;/a&gt;ã€‚è¢«åŠ¨å’Œä¸»åŠ¨å¥åº·æ£€æŸ¥åŠŸèƒ½å¯ä»¥ä¸€èµ·æˆ–ç‹¬ç«‹ä½¿ç”¨ï¼Œå®ƒä»¬å…±åŒæ„æˆæ•´ä¸ªä¸Šæ¸¸å¥åº·æ£€æŸ¥è§£å†³æ–¹æ¡ˆçš„åŸºç¡€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é©±é€ç®—æ³•&#34;&gt;é©±é€ç®—æ³•&lt;/h2&gt;
&lt;p&gt;æ ¹æ®å¼‚å¸¸å€¼æ£€æµ‹çš„ç±»å‹ï¼Œé©±é€è¦ä¹ˆä»¥ç›´çº¿æ–¹å¼è¿è¡Œï¼ˆä¾‹å¦‚åœ¨è¿ç»­è¿”å› 5xx çš„æƒ…å†µä¸‹ï¼‰ï¼Œè¦ä¹ˆä»¥æŒ‡å®šçš„é—´éš”è¿è¡Œï¼ˆä¾‹å¦‚åœ¨å‘¨æœŸæ€§æˆåŠŸç‡çš„æƒ…å†µä¸‹ï¼‰ã€‚é©±é€ç®—æ³•çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸»æœºè¢«ç¡®å®šä¸ºå¼‚å¸¸ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ²¡æœ‰ä¸»æœºè¢«é©±é€ï¼ŒEnvoy ä¼šç«‹å³é©±é€ä¸»æœºã€‚å¦åˆ™ï¼Œå®ƒä¼šæ£€æŸ¥ä»¥ç¡®ä¿é©±é€ä¸»æœºçš„æ•°é‡ä½äºå…è®¸çš„é˜ˆå€¼ï¼ˆé€šè¿‡ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/api-v2/api/v2/cluster/outlier_detection.proto#envoy-api-field-cluster-outlierdetection-max-ejection-percent&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outlier_detection.max_ejection_percent&lt;/a&gt;è®¾ç½®æŒ‡å®šï¼‰ã€‚å¦‚æœé©±é€çš„ä¸»æœºæ•°é‡è¶…è¿‡é˜ˆå€¼ï¼Œåˆ™ä¸»æœºä¸ä¼šè¢«é©±é€ã€‚&lt;/li&gt;
&lt;li&gt;ä¸»æœºè¢«é©±é€çš„çŠ¶æ€ä¼šä¿æŒä¸€å°æ®µæ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚è¢«é©±é€æ„å‘³ç€è¯¥ä¸»æœºè¢«æ ‡è®°ä¸ºä¸å¥åº·ï¼Œå¹¶ä¸”åœ¨è´Ÿè½½å‡è¡¡æœŸé—´ä¸ä¼šè¢«ä½¿ç”¨ï¼Œé™¤éè´Ÿè½½å‡è¡¡å™¨å¤„äº&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/intro/arch_overview/load_balancing/panic_threshold#arch-overview-load-balancing-panic-threshold&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ææ…Œ&lt;/a&gt;çŠ¶æ€ã€‚è¢«é©±é€çš„æ—¶é—´ç­‰äº&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/api-v2/api/v2/cluster/outlier_detection.proto#envoy-api-field-cluster-outlierdetection-base-ejection-time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outlier_detection.base_ejection_time_ms&lt;/a&gt;çš„å€¼ä¹˜ä»¥è¯¥ä¸»æœºè¢«é©±é€çš„æ¬¡æ•°ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœè¯¥ä¸»æœºè¿ç»­å¤±è´¥ï¼Œå®ƒè¢«é©±é€çš„æ—¶é—´å°†è¶Šæ¥è¶Šé•¿ã€‚&lt;/li&gt;
&lt;li&gt;é©±é€æ—¶é—´æ»¡è¶³åï¼Œè¢«é©±é€ä¸»æœºå°†è‡ªåŠ¨æ¢å¤æœåŠ¡ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¼‚å¸¸å€¼æ£€æµ‹ä¸ä¸»åŠ¨å¥åº·æ£€æŸ¥ (&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/intro/arch_overview/health_checking#arch-overview-health-checking&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;active health checking&lt;/a&gt;) ä¸€èµ·ä½¿ç”¨ï¼Œä»¥è·å¾—å…¨é¢çš„å¥åº·æ£€æŸ¥è§£å†³æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ£€æµ‹ç±»å‹&#34;&gt;æ£€æµ‹ç±»å‹&lt;/h2&gt;
&lt;p&gt;Envoy æ”¯æŒä»¥ä¸‹å¼‚å¸¸ç‚¹æ£€æµ‹ç±»å‹ï¼š&lt;/p&gt;
&lt;h3 id=&#34;è¿ç»­è¿”å›-5xx&#34;&gt;è¿ç»­è¿”å› 5xx&lt;/h3&gt;
&lt;p&gt;å¦‚æœä¸Šæ¸¸ä¸»æœºè¿”å›ä¸€äº›è¿ç»­çš„ 5xxï¼Œå®ƒå°†è¢«é©±é€ã€‚æ³¨æ„ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œ5xx è¡¨ç¤ºå®é™…çš„ 5xx å“åº”ç ï¼Œæˆ–è€…å¯¼è‡´ HTTP è·¯ç”±å™¨ä»£è¡¨ä¸Šæ¸¸è¿”å›è¯¥å“åº”ç çš„äº‹ä»¶ï¼ˆé‡ç½®ã€è¿æ¥å¤±è´¥ç­‰ï¼‰ã€‚é©±é€æ‰€éœ€çš„è¿ç»­ 5xx çš„æ•°é‡ç”±&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/api-v2/api/v2/cluster/outlier_detection.proto#envoy-api-field-cluster-outlierdetection-consecutive-5xx&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outlier_detection.continutive_5xx&lt;/a&gt;å€¼æ§åˆ¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¿ç»­ç½‘å…³å¤±è´¥&#34;&gt;è¿ç»­ç½‘å…³å¤±è´¥&lt;/h3&gt;
&lt;p&gt;å¦‚æœä¸Šæ¸¸ä¸»æœºè¿”å›ä¸€äº›è¿ç»­çš„&amp;quot;ç½‘å…³é”™è¯¯â€ï¼ˆ502ã€503 æˆ– 504 çŠ¶æ€ç ï¼‰ï¼Œå®ƒå°†è¢«é©±é€ã€‚æ³¨æ„ï¼Œè¿™åŒ…æ‹¬å¯èƒ½å¯¼è‡´ HTTP è·¯ç”±å™¨ä»£è¡¨ä¸Šæ¸¸è¿”å›å…¶ä¸­ä¸€ä¸ªçŠ¶æ€ç çš„äº‹ä»¶ï¼ˆé‡ç½®ã€è¿æ¥å¤±è´¥ç­‰ï¼‰ã€‚é©±é€æ‰€éœ€çš„è¿ç»­ç½‘å…³æ•…éšœæ•°é‡ç”±&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/api-v2/api/v2/cluster/outlier_detection.proto#envoy-api-field-cluster-outlierdetection-consecutive-gateway-failure&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outlier_detection.consecutive_gateway_failure&lt;/a&gt;å€¼æ‰€å†³å®šçš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æˆåŠŸç‡&#34;&gt;æˆåŠŸç‡&lt;/h3&gt;
&lt;p&gt;åŸºäºæˆåŠŸç‡çš„å¼‚å¸¸ç‚¹é©±é€èšåˆäº†é›†ç¾¤ä¸­æ¯ä¸ªä¸»æœºçš„æˆåŠŸç‡æ•°æ®ã€‚ç„¶ååœ¨ç»™å®šçš„æ—¶é—´é—´éš”å†…ï¼ŒåŸºäºç»Ÿè®¡çš„å¼‚å¸¸ç‚¹æ£€æµ‹æ•°æ®å¯¹ä¸»æœºè¿›è¡Œé©±é€ã€‚å¦‚æœä¸»æœºçš„è¯·æ±‚é‡æ±‡æ€»æ—¶é—´é—´éš”å°äº&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/api-v2/api/v2/cluster/outlier_detection.proto#envoy-api-field-cluster-outlierdetection-success-rate-request-volume&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outlier_detection.success_rate_request_volume&lt;/a&gt;å€¼ï¼Œè¯¥å¼‚å¸¸ç‚¹é©±é€å°†ä¸ä¼šè¢«è®¡ç®—ã€‚å¦å¤–ï¼Œå¦‚æœä¸€ä¸ªé—´éš”ä¸­å…·æœ‰æœ€å°æ‰€éœ€è¯·æ±‚å·çš„ä¸»æœºæ•°é‡å°äº&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/api-v2/api/v2/cluster/outlier_detection.proto#envoy-api-field-cluster-outlierdetection-success-rate-minimum-hosts&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outlier_detection.success_rate_minimum_hosts&lt;/a&gt; å€¼ï¼Œæ£€æµ‹å°†ä¸èƒ½è¿›è¡Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;é©±é€äº‹ä»¶æ—¥å¿—&#34;&gt;é©±é€äº‹ä»¶æ—¥å¿—&lt;/h2&gt;
&lt;p&gt;å¼‚å¸¸ç‚¹é©±é€äº‹ä»¶çš„æ—¥å¿—å¯ä»¥ç”± Envoy é€‰æ‹©æ€§åœ°ç”Ÿæˆã€‚è¿™åœ¨æ—¥å¸¸æ“ä½œä¸­éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå…¨å±€ç»Ÿè®¡ä¿¡æ¯ä¸èƒ½æä¾›å…³äºå“ªäº›ä¸»æœºè¢«é©±é€ä»¥åŠå‡ºäºä»€ä¹ˆåŸå› è¢«é©±é€çš„è¶³å¤Ÿä¿¡æ¯ã€‚æ—¥å¿—è¢«ç»“æ„åŒ–ä¸ºåŸºäº protobuf çš„&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/api-v2/data/cluster/v2alpha/outlier_detection_event.proto#envoy-api-msg-data-cluster-v2alpha-outlierdetectionevent&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OutlierDetectionEvent messages&lt;/a&gt;è½¬å­˜æ–‡ä»¶ã€‚é©±é€äº‹ä»¶æ—¥å¿—æ˜¯åœ¨é›†ç¾¤ç®¡ç†å™¨&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/api-v2/config/bootstrap/v2/bootstrap.proto#envoy-api-field-config-bootstrap-v2-clustermanager-outlier-detection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outlier detection configuration&lt;/a&gt;ä¸­é…ç½®çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç›¸å…³æ¦‚å¿µ&#34;&gt;ç›¸å…³æ¦‚å¿µ&lt;/h2&gt;
&lt;h3 id=&#34;ä¸»åŠ¨å¥åº·æ£€æŸ¥&#34;&gt;ä¸»åŠ¨å¥åº·æ£€æŸ¥&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/intro/arch_overview/health_checking&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸»åŠ¨å¥åº·æ£€æŸ¥&lt;/a&gt;å¯ä»¥åœ¨æ¯ä¸ªä¸Šæ¸¸é›†ç¾¤çš„åŸºç¡€ä¸Šè¿›è¡Œé…ç½®ã€‚ä¸»åŠ¨è¿è¡Œå¥åº·æ£€æŸ¥å’Œ EDS ç±»å‹æœåŠ¡å‘ç°ä¼šåŒæ—¶è¿›è¡Œã€‚ä½†æ˜¯ï¼Œå³ä½¿ä½¿ç”¨å…¶ä»–æœåŠ¡å‘ç°ç±»å‹ï¼Œä¹Ÿæœ‰å…¶ä»–éœ€è¦è¿›è¡Œä¸»åŠ¨å¥åº·æ£€æŸ¥çš„æƒ…å†µã€‚Envoy æ”¯æŒä¸‰ç§ä¸åŒç±»å‹çš„å¥åº·æ£€æŸ¥ï¼ˆHTTP,  L3/L4, Redisï¼‰åŠå„ç§è®¾ç½®ï¼ˆæ£€æŸ¥æ—¶é—´é—´éš”ã€ä¸»æœºä¸å¥åº·æ ‡è®°ä¸ºæ•…éšœã€ä¸»æœºå¥åº·æ—¶æ ‡è®°ä¸ºæˆåŠŸç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åŒæ—¶ä½¿ç”¨ä¸»åŠ¨å¥åº·æ£€æŸ¥å’Œè¢«åŠ¨å¥åº·æ£€æŸ¥ (å¼‚å¸¸ç‚¹æ£€æµ‹) æ—¶ï¼Œé€šå¸¸ä½¿ç”¨è¾ƒé•¿çš„å¥åº·æ£€æŸ¥é—´éš”æ¥é¿å…å¤§é‡çš„ä¸»åŠ¨å¥åº·æ£€æŸ¥æµé‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ä½¿ç”¨&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/operations/admin#operations-admin-interface-healthcheck-fail&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/healthcheck/fail&lt;/a&gt;ç®¡ç†ç«¯ç‚¹æ—¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿè€—å°½ä¸Šæ¸¸ä¸»æœºä»ç„¶æ˜¯æœ‰ç”¨çš„ï¼Œ&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/configuration/http_filters/router_filter#config-http-filters-router&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;router filter&lt;/a&gt;ä¼šåœ¨&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/configuration/http_filters/router_filter#config-http-filters-router-x-envoy-immediate-health-check-fail&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;x-envoy-immediate-health-check-fail&lt;/a&gt; header é‡Œé¢å“åº”æ¥æ”¯æŒå®ƒçš„å®ç°ã€‚å¦‚æœ header ç”±ä¸Šæ¸¸ä¸»æœºè®¾ç½®æ ‡è®°ï¼ŒEnvoy å°†ç«‹å³å°†ä¸»æœºæ ‡è®°ä¸ºä¸»åŠ¨å¥åº·æ£€æŸ¥å¤±è´¥ã€‚æ³¨æ„ï¼Œåªæœ‰åœ¨ä¸»æœºé›†ç¾¤çš„ä¸»åŠ¨å¥åº·æ£€æŸ¥&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/configuration/cluster_manager/cluster_hc#config-cluster-manager-cluster-hc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å·²é…ç½®&lt;/a&gt;æ—¶æ‰ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚å¦‚æœ Envoy å·²ç»é€šè¿‡&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/operations/admin#operations-admin-interface-healthcheck-fail&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/healthcheck/fail&lt;/a&gt;ç®¡ç†ç«¯ç‚¹æ ‡è®°ä¸ºå¤±è´¥ï¼Œ&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/configuration/http_filters/health_check_filter#config-http-filters-health-check&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¥åº·æ£€æŸ¥è¿‡æ»¤å™¨&lt;/a&gt;å°†è‡ªåŠ¨è®¾ç½®è¿™ä¸ª headerã€‚&lt;/p&gt;
&lt;h3 id=&#34;ææ…Œé˜ˆå€¼&#34;&gt;ææ…Œé˜ˆå€¼&lt;/h3&gt;
&lt;p&gt;åœ¨è´Ÿè½½å‡è¡¡æœŸé—´ï¼ŒEnvoy é€šå¸¸åªä¼šè€ƒè™‘ä¸Šæ¸¸é›†ç¾¤ä¸­å¥åº·çš„ä¸»æœºã€‚ä½†æ˜¯ï¼Œå¦‚æœé›†ç¾¤ä¸­å¥åº·ä¸»æœºçš„ç™¾åˆ†æ¯”å˜å¾—è¿‡ä½ï¼Œenvoy å°†å¿½è§†æ‰€æœ‰ä¸»æœºä¸­çš„å¥åº·çŠ¶å†µå’Œå‡è¡¡ã€‚è¿™è¢«ç§°ä¸º&lt;em&gt;ææ…Œé˜ˆå€¼ (panic threshold)&lt;/em&gt;ã€‚ç¼ºçœææ…Œé˜ˆå€¼æ˜¯ 50ï¼…ã€‚è¿™å¯ä»¥é€šè¿‡&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/configuration/cluster_manager/cluster_runtime#config-cluster-manager-cluster-runtime&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿è¡Œæ—¶é…ç½®&lt;/a&gt;æˆ–è€…&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cds.proto#envoy-api-field-cluster-commonlbconfig-healthy-panic-threshold&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›†ç¾¤é…ç½®&lt;/a&gt;è¿›è¡Œé…ç½®ã€‚ææ…Œé˜ˆå€¼ç”¨äºé¿å…åœ¨è´Ÿè½½å¢åŠ æ—¶ä¸»æœºæ•…éšœå¯¼è‡´æ•´ä¸ªé›†ç¾¤ä¸­çº§è”æ•…éšœçš„æƒ…å†µã€‚æ³¨æ„ï¼šææ…Œé˜ˆå€¼ä¸åŒäºé©±é€ç®—æ³•ç¬¬ 2 ç‚¹æåˆ°çš„æœ€å¤§é©±é€ç™¾åˆ†æ¯” (outlier_detection.max_ejection_percent)ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œææ…Œé˜ˆå€¼ä¸ä¼˜å…ˆçº§ååŒå·¥ä½œã€‚å¦‚æœæŸä¸ªä¼˜å…ˆçº§çš„å¯ç”¨ä¸»æœºæ•°é‡ä¸‹é™ï¼ŒEnvoy å°†å°è¯•å°†ä¸€äº›æµé‡è½¬ç§»åˆ°è¾ƒä½çš„ä¼˜å…ˆçº§ã€‚å¦‚æœå®ƒæˆåŠŸåœ°åœ¨è¾ƒä½çš„ä¼˜å…ˆçº§æ‰¾åˆ°è¶³å¤Ÿçš„å¯ç”¨ä¸»æœºï¼ŒEnvoy å°†ä¸é¡¾ææ…Œé˜ˆå€¼ã€‚åœ¨æ•°å­¦æœ¯è¯­ä¸­ï¼Œå¦‚æœæ‰€æœ‰ä¼˜å…ˆçº§çš„è§„èŒƒåŒ– (normalized) æ€»å¯ç”¨æ€§ä¸º 100%ï¼ŒEnvoy å°†å¿½ç•¥ææ…Œé˜ˆå€¼ï¼Œå¹¶ç»§ç»­æ ¹æ®è¿™é‡Œæè¿°çš„ç®—æ³•åœ¨ä¼˜å…ˆçº§ä¹‹é—´åˆ†é…æµé‡è´Ÿè½½ã€‚ç„¶è€Œï¼Œå½“è§„èŒƒåŒ–æ€»å¯ç”¨æ€§ä¸‹é™åˆ° 100% ä»¥ä¸‹æ—¶ï¼ŒEnvoy å‡å®šåœ¨æ‰€æœ‰ä¼˜å…ˆçº§ä¸Šéƒ½æ²¡æœ‰è¶³å¤Ÿçš„å¯ç”¨ä¸»æœºã€‚å®ƒå°†ç»§ç»­è·¨ä¼˜å…ˆçº§åˆ†é…æµé‡è´Ÿè½½ï¼Œä½†æ˜¯å¦‚æœç»™å®šä¼˜å…ˆçº§çš„å¯ç”¨æ€§ä½äº panic é˜ˆå€¼ï¼Œåˆ™æµé‡å°†è´Ÿè½½å‡è¡¡åˆ°è¯¥ä¼˜å…ˆçº§çš„æ‰€æœ‰ä¸»æœºï¼Œè€Œä¸ç®¡å®ƒä»¬çš„å¯ç”¨æ€§å¦‚ä½•ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;P=0 healthy endpoints&lt;/th&gt;
&lt;th&gt;P=1 healthy endpoints&lt;/th&gt;
&lt;th&gt;Traffic to P=0&lt;/th&gt;
&lt;th&gt;P=0 in panic&lt;/th&gt;
&lt;th&gt;Traffic to P=1&lt;/th&gt;
&lt;th&gt;P=1 in panic&lt;/th&gt;
&lt;th&gt;normalized total health&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;72%&lt;/td&gt;
&lt;td&gt;72%&lt;/td&gt;
&lt;td&gt;100%&lt;/td&gt;
&lt;td&gt;NO&lt;/td&gt;
&lt;td&gt;0%&lt;/td&gt;
&lt;td&gt;NO&lt;/td&gt;
&lt;td&gt;100%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;71%&lt;/td&gt;
&lt;td&gt;71%&lt;/td&gt;
&lt;td&gt;99%&lt;/td&gt;
&lt;td&gt;NO&lt;/td&gt;
&lt;td&gt;1%&lt;/td&gt;
&lt;td&gt;NO&lt;/td&gt;
&lt;td&gt;100%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;50%&lt;/td&gt;
&lt;td&gt;60%&lt;/td&gt;
&lt;td&gt;50%&lt;/td&gt;
&lt;td&gt;NO&lt;/td&gt;
&lt;td&gt;50%&lt;/td&gt;
&lt;td&gt;NO&lt;/td&gt;
&lt;td&gt;100%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;25%&lt;/td&gt;
&lt;td&gt;100%&lt;/td&gt;
&lt;td&gt;25%&lt;/td&gt;
&lt;td&gt;NO&lt;/td&gt;
&lt;td&gt;75%&lt;/td&gt;
&lt;td&gt;NO&lt;/td&gt;
&lt;td&gt;100%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;25%&lt;/td&gt;
&lt;td&gt;25%&lt;/td&gt;
&lt;td&gt;50%&lt;/td&gt;
&lt;td&gt;YES&lt;/td&gt;
&lt;td&gt;50%&lt;/td&gt;
&lt;td&gt;YES&lt;/td&gt;
&lt;td&gt;70%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5%&lt;/td&gt;
&lt;td&gt;65%&lt;/td&gt;
&lt;td&gt;7%&lt;/td&gt;
&lt;td&gt;YES&lt;/td&gt;
&lt;td&gt;93%&lt;/td&gt;
&lt;td&gt;NO&lt;/td&gt;
&lt;td&gt;98%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ç»“åˆä»¥ä¸Šä»‹ç»æ¥çœ‹ï¼Œå¼‚å¸¸ç‚¹æ£€æµ‹æ˜¯ä¸€ç§è¢«åŠ¨çš„å¥åº·æ£€æŸ¥ï¼ŒåŒºåˆ«äºä¸»åŠ¨å¥åº·æ£€æŸ¥ï¼Œå®ƒä¸æ˜¯å‘ä¸»æœºå‘é€å¿ƒè·³æˆ–è€…é€šè¿‡é•¿é“¾æ¥æ¢æ´»æ¥åˆ¤å®šå®ä¾‹çš„å¥åº·ï¼Œè€Œæ˜¯é€šè¿‡å¯¹è¯¥ä¸»æœºå‘èµ·çš„è¯·æ±‚çš„è¿”å›å€¼åšåˆ†æï¼ŒåŸºäºä¸åŒçš„æ£€æµ‹ç±»å‹ä»¥åŠä¸åŒçš„é©±é€ç®—æ³•ï¼Œå¯¹ç›®æ ‡ä¸»æœºåšé©±é€æˆ–è€…æ¢å¤ã€‚&lt;/p&gt;
&lt;p&gt;è€Œå¾®æœåŠ¡ä¸­çš„ç†”æ–­ä¸»è¦æ˜¯ä¸€ç§ç³»ç»Ÿä¿æŠ¤ç­–ç•¥ï¼Œå®ƒçš„åŸºæœ¬åŠŸèƒ½æ˜¯åœ¨æ£€æµ‹åˆ°æ•…éšœååˆ‡æ–­é“¾è·¯ï¼Œé€šè¿‡ç›´æ¥è¿”å›é”™è¯¯æˆ–è€… fallback å€¼ï¼Œæ¥ç›´æ¥æé«˜ç³»ç»Ÿå¯ç”¨æ€§ï¼Œé˜²æ­¢è¯¥æ•…éšœç¨‹åºå‡ºç°é—®é¢˜è”“å»¶è‡³æ•´ä¸ªç½‘ç»œé€ æˆé›ªå´©æ•ˆæœã€‚ç¬”è€…ä»¥ä¸ºï¼Œenvoy ä¸­çš„å¼‚å¸¸ç‚¹æ£€æµ‹å¯ä»¥ç†è§£ä¸º&amp;quot;å®ä¾‹çº§åˆ«&amp;quot;çš„ç†”æ–­ï¼Œå¹¶ä¸”æ²¡æœ‰åŠå¼€æ”¾çŠ¶æ€ã€‚å…³äºè¯¥å®ä¾‹çº§åˆ«çš„ç†”æ–­ä¸å…¬ç§°æ–­è·¯å™¨çš„åŒºåˆ«çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒ&lt;a href=&#34;http://www.servicemesher.com/blog/istio-vs-hystrix-circuit-breaker/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¾®æœåŠ¡æ–­è·¯å™¨æ¨¡å¼å®ç°ï¼šIstio vs Hystrix&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¹¶ä¸”ï¼Œenvoy å¼‚å¸¸ç‚¹æ£€æµ‹ä¸­çš„&lt;code&gt;maxEjectionPercent&lt;/code&gt;å±æ€§çš„ä½œç”¨ä¼šä¿æŒä¸€éƒ¨åˆ†çš„å®ä¾‹æ± ï¼Œå³ä½¿å…¶ä¸­éƒ¨åˆ†å®ä¾‹ä¸å¯ç”¨ã€‚å…¶ç›®çš„æ˜¯ä¸ºäº†é¿å…åœ¨è´Ÿè½½å¢åŠ æ—¶ä¸»æœºæ•…éšœå¯¼è‡´æ•´ä¸ªé›†ç¾¤ä¸­çº§è”æ•…éšœé›ªå´©ï¼Œè¿™ä¸€ç‚¹å’Œææ…Œé˜ˆå€¼çš„ä½œç”¨ç›¸ä¼¼ã€‚ä½†æ˜¯&amp;rsquo;maxEjectionPercent&amp;rsquo;ä¸&amp;rsquo;panic threshold&amp;rsquo;çš„ä½œç”¨åŸŸå´å®Œå…¨ä¸åŒã€‚è¾¾åˆ°ææ…Œé˜ˆå€¼åï¼Œæµé‡å°†è´Ÿè½½å‡è¡¡åˆ°è¯¥ä¼˜å…ˆçº§çš„æ‰€æœ‰ä¸»æœºï¼Œæ‰€æœ‰ä¸»æœºåŒ…æ‹¬è¢«å¼‚å¸¸ç‚¹æ£€æµ‹æ ‡è®°ä¸ºä¸å¥åº·çš„å®ä¾‹å’Œå¥åº·çš„å®ä¾‹ï¼Œå¹¶ä¸”å¦‚æœé©±é€è¾¾åˆ°äº†â€˜maxEjectionPercentâ€™è®¾å®šå€¼ï¼Œé‚£ä¹ˆè¿™ç»„å¥åº·çš„å®ä¾‹ä¸­è¿˜å¯èƒ½åŒ…å«ä¸å¯ç”¨çš„å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;æœ€å Envoy è‡ªèº«è¿˜å®ç°äº†ç½‘ç»œçº§åˆ«çš„&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.10.0/intro/arch_overview/circuit_breaking&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆ†å¸ƒå¼æ–­è·¯å™¨&lt;/a&gt;ï¼Œè¿™æ‰æ˜¯ istio/envoy æä¾›çš„&amp;quot;æ­£ç»Ÿ&amp;quot;æ–­è·¯å™¨ã€‚ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼æ–­è·¯å™¨ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯åœ¨ç½‘ç»œçº§åˆ«å¼ºåˆ¶å®ç°æ–­è·¯ï¼Œè€Œä¸å¿…ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºå•ç‹¬é…ç½®æˆ–è€…ç¼–ç¨‹ï¼Œå®ç°é›¶ä¾µå…¥ã€‚Envoy æ”¯æŒçš„åˆ†å¸ƒå¼æ–­è·¯åŒ…æ‹¬ï¼šé›†ç¾¤æœ€å¤§è¿æ¥æ•°ã€é›†ç¾¤æœ€å¤§æŒ‚èµ·è¯·æ±‚æ•°ã€é›†ç¾¤æœ€å¤§è¯·æ±‚æ•°ã€é›†ç¾¤æœ€å¤§æ´»åŠ¨é‡è¯•æ¬¡æ•°ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æ€»è€Œè¨€ä¹‹ï¼Œä¸ç®¡æ˜¯ envoy çš„å¼‚å¸¸ç‚¹æ£€æµ‹è¿˜æ˜¯ç½‘ç»œçº§åˆ«çš„åˆ†å¸ƒå¼æ–­è·¯å™¨ï¼Œä½œä¸ºä¸€ç§ sidecar ä»£ç†ï¼Œé‡‡ç”¨çš„æ˜¯é»‘ç›’æ–¹å¼çš„å®ç°ï¼Œå¹¶ä¸”å¯¹åº”ç”¨ç¨‹åºé›¶ä¾µå…¥ã€‚ä½†æ˜¯å¦‚æœä½ çš„ç³»ç»Ÿéœ€è¦å¯¹æŸä¸ªåº”ç”¨ç¨‹åºåšåˆ°æ–¹æ³•çº§åˆ«çš„ç²¾ç¡®ç†”æ–­ï¼Œè®¾ç½®å„ç§è¶…æ—¶é‡è¯•ç­‰å‚æ•°ï¼Œè®¾ç½®ä¸åŒçš„ fallback è¿”å›å€¼ï¼ŒæŠ‘æˆ–æ˜¯è°ƒç”¨å…¶å®ƒçš„æœåŠ¡åšé™çº§å¤„ç†ç­‰ç­‰ï¼Œåˆ™éœ€è¦ä¾µå…¥å¼çš„æ–­è·¯å™¨ï¼ˆå¯å‚è€ƒ Resilience4J ä¸ Hystrixï¼‰ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æ„å»º Envoy çš„æ§åˆ¶å¹³é¢æ‰‹å†Œç¬¬ 5 éƒ¨åˆ† - éƒ¨ç½²çš„æƒè¡¡</title>
      <link>https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/</link>
      <pubDate>Fri, 14 Jun 2019 10:30:32 +0800</pubDate>
      <guid>https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://blog.christianposta.com/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼–è€…æŒ‰&#34;&gt;ç¼–è€…æŒ‰&lt;/h2&gt;
&lt;p&gt;ä½œä¸ºæ¢ç´¢ä¸º Envoy æ„å»ºæ§åˆ¶å¹³é¢ç³»åˆ—æ–‡ç« çš„ç¬¬ 5 éƒ¨åˆ†ï¼Œæœ¬æ–‡ä»‹ç»äº†éƒ¨ç½²æ§åˆ¶å¹³é¢çš„é€‰é¡¹ä¸æƒè¡¡ï¼Œç€é‡é˜è¿°äº†ä¿æŒæ§åˆ¶å¹³é¢ä¸æ•°æ®å¹³é¢è§£è€¦çš„å‡ å¤§å¥½å¤„ï¼Œå¹¶ä¸”åœ¨æ–‡ç« ç»“å°¾å»ºè®®æ„å»ºä¸€ä¸ªå¯æ‹”æ’çš„æ§åˆ¶å¹³é¢ä»¥æ”¯æŒå„ç§æ–°ç‰¹æ€§ã€æ‹“å±•å’Œé€‚é…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;è¿™æ˜¯æ¢ç´¢ä¸º Envoy æ„å»ºæ§åˆ¶å¹³é¢&lt;a href=&#34;https://blog.christianposta.com/envoy/guidfor-build-a-control-plane-to-management-Envoy-Proxy-based-infrastructure/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç³»åˆ—æ–‡ç« &lt;/a&gt;çš„ç¬¬ 5 éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.christianposta.com/envoy/guidance-for-building-a-control-plane-to-manage-envoy-proxy-based-infrastructure/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é‡‡ç”¨ä¸€ç§æœºåˆ¶æ¥åŠ¨æ€æ›´æ–° Enovy çš„è·¯ç”±ã€æœåŠ¡å‘ç°å’Œå…¶ä»–é…ç½®&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.christianposta.com/envoy/guidance-for-building-a-control-plane-for-envoy-identify-components/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯†åˆ«æ„æˆæ§åˆ¶å¹³é¢çš„ç»„ä»¶ï¼ŒåŒ…æ‹¬æ”¯æŒå­˜å‚¨ã€æœåŠ¡å‘ç° apiã€å®‰å…¨ç»„ä»¶ç­‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.christianposta.com/envoy/guidance-for-building-a-control-plane-for-envoy-domain-specific-configuration-api/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ„å»ºæœ€é€‚åˆä½ çš„ä½¿ç”¨åœºæ™¯å’Œç»„ç»‡æ¶æ„çš„ç‰¹å®šåŸŸçš„é…ç½®å¯¹è±¡å’Œ api&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.christianposta.com/guidance-for-building-a-control-plane-for-envoy-build-for-pluggability/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è€ƒè™‘å¦‚ä½•æœ€å¥½åœ°ä½¿ä½ çš„æ§åˆ¶å¹³é¢å¯æ’åœ¨ä½ éœ€è¦å®ƒçš„åœ°æ–¹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²å„ç§æ§åˆ¶å¹³é¢ç»„ä»¶çš„é€‰é¡¹ (æœ¬æ–‡)&lt;/li&gt;
&lt;li&gt;åŸºäºæ§åˆ¶å¹³é¢çš„æµ‹è¯•å·¥å…·çš„æ€è€ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†ä¸ºä»€ä¹ˆå¯æ‹”æ’æ§åˆ¶å¹³é¢å¯¹äºè·Ÿä¸Šå¿«é€Ÿè¿­ä»£çš„ Envoy API ä»¥åŠä¸ç»„ç»‡å¯èƒ½é‡‡ç”¨çš„ä¸åŒå·¥ä½œæµé›†æˆè‡³å…³é‡è¦ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºéƒ¨ç½²å„ç§æ§åˆ¶å¹³é¢ç»„ä»¶æ—¶çš„æƒè¡¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²æ§åˆ¶å¹³é¢ç»„ä»¶&#34;&gt;éƒ¨ç½²æ§åˆ¶å¹³é¢ç»„ä»¶&lt;/h2&gt;
&lt;p&gt;ä¸€æ—¦æ‚¨æ„å»ºå¹¶è®¾è®¡äº†æ§åˆ¶å¹³é¢åŠå…¶å„ç§æ”¯æŒç»„ä»¶ï¼Œæ‚¨å°±éœ€è¦å‡†ç¡®åœ°å†³å®šå¦‚ä½•éƒ¨ç½²å®ƒçš„ç»„ä»¶ã€‚åœ¨ç¡®å®šæœ€é€‚åˆæ‚¨çš„å®ç°æ—¶ï¼Œæ‚¨éœ€è¦æƒè¡¡å„ç§å®‰å…¨æ€§ã€å¯ä¼¸ç¼©æ€§å’Œå¯ç”¨æ€§é—®é¢˜ã€‚è¿™äº›é€‰é¡¹é‡ŒåŒ…æ‹¬å°†æ§åˆ¶å¹³é¢ç»„ä»¶ä¸æ•°æ®å¹³é¢ä¸€èµ·éƒ¨ç½²ï¼Œä»¥åŠå°†æ§åˆ¶å¹³é¢ä¸æ•°æ®å¹³é¢å®Œå…¨è§£è€¦ã€‚è¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆï¼šéƒ¨ç½²ä¸€äº›ä¸æ§åˆ¶å¹³é¢å…±å­˜çš„ç»„ä»¶ï¼Œå¹¶ä¿æŒä¸€äº›é›†ä¸­ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio service-mesh é¡¹ç›®ä¸­ï¼Œæ§åˆ¶å¹³é¢ç»„ä»¶ä¸æ•°æ®å¹³é¢åˆ†åˆ«éƒ¨ç½²å’Œè¿è¡Œã€‚è¿™åœ¨æœåŠ¡ç½‘æ ¼å®ç°ä¸­éå¸¸å¸¸è§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®å¹³é¢ä¸åº”ç”¨ç¨‹åºä¸€èµ·è¿è¡Œï¼Œå¤„ç†æ‰€æœ‰çš„åº”ç”¨ç¨‹åºæµé‡ï¼Œå¹¶é€šè¿‡ gRPC æµä¸Šçš„ xDS API ä¸æ§åˆ¶å¹³é¢é€šä¿¡ã€‚æ§åˆ¶å¹³é¢ç»„ä»¶é€šå¸¸åœ¨å®ƒä»¬è‡ªå·±çš„å‘½åç©ºé—´ä¸­è¿è¡Œï¼Œå¹¶ä¸”åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œä¸å½“æ“ä½œæˆ–è€…æ„å¤–ä½¿ç”¨å°†å¯¼è‡´ç»„ä»¶è¢«é”å®šã€‚&lt;/p&gt;
&lt;p&gt;Gloo é¡¹ç›®ä½œä¸ºä¸€ä¸ª API ç½‘å…³ï¼Œéµå¾ªç±»ä¼¼çš„éƒ¨ç½²æ¨¡å‹ã€‚æ§åˆ¶å¹³é¢ç»„ä»¶ä¸æ•°æ®å¹³é¢è§£è€¦ï¼ŒEnvoy æ•°æ®å¹³é¢ä½¿ç”¨ xDS gRPC æµæ¥æ”¶é›†å…³äºç›‘å¬å™¨ã€è·¯ç”±ã€ç«¯ç‚¹å’Œé›†ç¾¤ç­‰çš„é…ç½®ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Gloo éƒ¨ç½²ä¸æ•°æ®å¹³é¢ä»£ç†å…±å­˜çš„æ§åˆ¶é¢æ¿ç»„ä»¶ï¼Œä½†ä¸å»ºè®®è¿™æ ·åšã€‚æˆ‘ä»¬ç¨åä¼šçœ‹ä¸€äº›æƒè¡¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-separatecontrolplane&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;separatecontrolplane&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/separatecontrolplane_hu48b9226059de18385631ab6094eb1523_29191_33d5e86ba89dfdd1b2da3eabdca49986.webp 400w,
               /blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/separatecontrolplane_hu48b9226059de18385631ab6094eb1523_29191_fbb978739ba7dbc44650ef03adc760f2.webp 760w,
               /blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/separatecontrolplane_hu48b9226059de18385631ab6094eb1523_29191_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/separatecontrolplane_hu48b9226059de18385631ab6094eb1523_29191_33d5e86ba89dfdd1b2da3eabdca49986.webp&#34;
               width=&#34;760&#34;
               height=&#34;375&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      separatecontrolplane
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬ç ”ç©¶äº†æ§åˆ¶å¹³é¢ç»„ä»¶ä¸æ•°æ®å¹³é¢çš„ååŒéƒ¨ç½²ã€‚åœ¨ Contour é¡¹ç›®ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ§åˆ¶å¹³é¢ç»„ä»¶æ˜¯ä¸æ•°æ®å¹³é¢ä¸€èµ·éƒ¨ç½²çš„ï¼Œå°½ç®¡&lt;a href=&#34;https://github.com/heptio/contour/blob/master/docs/deploy-seperate-pods.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å­˜åœ¨ä¸€ä¸ªæ‹†åˆ†éƒ¨ç½²çš„é€‰é¡¹&lt;/a&gt;ã€‚Contour å®é™…ä¸Šåˆ©ç”¨ CRD æˆ– Ingress èµ„æºè¿›è¡Œé…ç½®ï¼Œæ‰€ä»¥æ‰€æœ‰çš„é…ç½®æ–‡ä»¶å¤„ç†å’Œç›‘æ§éƒ½å‘ç”Ÿåœ¨ Kubernetes ä¸­ã€‚ç„¶è€Œï¼ŒxDS æœåŠ¡å´æ˜¯ä¸æ•°æ®å¹³é¢å…±åŒéƒ¨ç½² (åŒæ ·ï¼Œè¿™æ˜¯é»˜è®¤æƒ…å†µâ€”æ‚¨ä¾ç„¶å¯ä»¥å°†å®ƒä»¬æ‹†åˆ†)ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-codeployed&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;codeployed&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/codeployed_hu91092138ea0553a909fe7137845a8f0f_7436_bb1a45ba761bc729d531a3b62aeb91ae.webp 400w,
               /blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/codeployed_hu91092138ea0553a909fe7137845a8f0f_7436_cebf2aaaed1c39c0bfa6211b81776ff2.webp 760w,
               /blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/codeployed_hu91092138ea0553a909fe7137845a8f0f_7436_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/codeployed_hu91092138ea0553a909fe7137845a8f0f_7436_bb1a45ba761bc729d531a3b62aeb91ae.webp&#34;
               width=&#34;231&#34;
               height=&#34;174&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      codeployed
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“&lt;a href=&#34;https://www.youtube.com/watch?v=a1tXFUrqt5M&amp;amp;list=PLj6h78yzYM2PF_iYEBntfR0m4KAZET18Q&amp;amp;index=14&amp;amp;t=0s&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;eBay ä¸ºä»–ä»¬çš„ Envoy éƒ¨ç½²æ„å»ºäº†æ§åˆ¶å¹³é¢&lt;/a&gt;æ—¶ï¼Œä»–ä»¬è¿˜å°†æ§åˆ¶å¹³é¢ (discovery pieces) çš„&lt;em&gt;éƒ¨åˆ†ç»„ä»¶&lt;/em&gt;ä¸æ•°æ®å¹³é¢è”åˆéƒ¨ç½²ã€‚ä»–ä»¬åŸºæœ¬ä¸Šè‡ªå·±å®ç°äº†ä¸€ä¸ªæ§åˆ¶å™¨æ¥ç›‘è§† CRDã€Ingress å’ŒæœåŠ¡èµ„æºï¼Œå¹¶ä¸”ç”Ÿæˆé…ç½®æ˜ å°„ã€‚ç„¶åï¼Œè¿™äº›é…ç½®æ˜ å°„å°†ç”±ä¸ Pod ä¸€èµ·è¿è¡Œçš„&lt;code&gt;discovery&lt;/code&gt;å®¹å™¨ä½¿ç”¨ï¼Œå¹¶éšç€æ”¹åŠ¨é‡æ–°çƒ­å¯åŠ¨ï¼Œä»¥åŠæ›´æ–° Envoyã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/ebay-control-plane_hu254cd36c4f118d9ebc2fa637de15da85_100039_2fd28a5d6f67baf7f923c6eccdeb0d8d.webp 400w,
               /blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/ebay-control-plane_hu254cd36c4f118d9ebc2fa637de15da85_100039_b2f1de56cc3dcc182e66be4a5e518569.webp 760w,
               /blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/ebay-control-plane_hu254cd36c4f118d9ebc2fa637de15da85_100039_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/ebay-control-plane_hu254cd36c4f118d9ebc2fa637de15da85_100039_2fd28a5d6f67baf7f923c6eccdeb0d8d.webp&#34;
               width=&#34;760&#34;
               height=&#34;220&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/double-click-ebay-control-plane_hu6d6ff89cc47bbf75e4f158d6281175b3_182478_2fa45b01316bf69b8919ee7399b73c44.webp 400w,
               /blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/double-click-ebay-control-plane_hu6d6ff89cc47bbf75e4f158d6281175b3_182478_4a997330a3701b3d064968afd57cea44.webp 760w,
               /blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/double-click-ebay-control-plane_hu6d6ff89cc47bbf75e4f158d6281175b3_182478_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/double-click-ebay-control-plane_hu6d6ff89cc47bbf75e4f158d6281175b3_182478_2fa45b01316bf69b8919ee7399b73c44.webp&#34;
               width=&#34;760&#34;
               height=&#34;239&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ Ebay çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ç§â€œæ··åˆâ€çš„æ–¹æ³•ï¼Œå¹¶ä¸”æ·±å—å…¶æ¶æ„å…¶ä½™éƒ¨åˆ†çš„å…·ä½“å½±å“ã€‚é‚£ä¹ˆï¼Œåœ¨ä¸º Envoy è¯„ä¼°æ§åˆ¶å¹³é¢æ—¶ï¼Œæˆ–è€…è€ƒè™‘è‡ªå·±æ„å»ºæ§åˆ¶å¹³é¢æ—¶ï¼Œåº”è¯¥å¦‚ä½•éƒ¨ç½²æ§åˆ¶å¹³é¢ç»„ä»¶ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&#34;æˆ‘åº”è¯¥å°†æ§åˆ¶å¹³é¢ä¸æ•°æ®å¹³é¢åˆ†å¼€å—&#34;&gt;æˆ‘åº”è¯¥å°†æ§åˆ¶å¹³é¢ä¸æ•°æ®å¹³é¢åˆ†å¼€å—ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å„ç§æ–¹æ³•éƒ½æœ‰ä¼˜ç¼ºç‚¹ã€‚&lt;a href=&#34;https://github.com/solo-io/gloo/graphs/contributor&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo å›¢é˜Ÿ&lt;/a&gt;è®¤ä¸ºï¼Œå¯¹äºå¤§å¤šæ•°åº”ç”¨åœºæ™¯æ¥è¯´ï¼Œä¿æŒæ§åˆ¶å¹³é¢ç‹¬ç«‹æ˜¯æ­£ç¡®çš„é€‰æ‹©ï¼Œåº”è¯¥é¿å…å°†æ§åˆ¶å¹³é¢ä¸æ•°æ®å¹³é¢å®Œå…¨éƒ¨ç½²åœ¨ä¸€èµ·ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/separatecontrolplane_hu48b9226059de18385631ab6094eb1523_29191_33d5e86ba89dfdd1b2da3eabdca49986.webp 400w,
               /blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/separatecontrolplane_hu48b9226059de18385631ab6094eb1523_29191_fbb978739ba7dbc44650ef03adc760f2.webp 760w,
               /blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/separatecontrolplane_hu48b9226059de18385631ab6094eb1523_29191_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-deployment-tradeoffs/separatecontrolplane_hu48b9226059de18385631ab6094eb1523_29191_33d5e86ba89dfdd1b2da3eabdca49986.webp&#34;
               width=&#34;760&#34;
               height=&#34;375&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚æœ Envoy æ˜¯ L7 ç½‘ç»œçš„æ ¸å¿ƒå’Œçµé­‚ï¼Œé‚£ä¹ˆæ§åˆ¶å¹³é¢å°±æ˜¯å¤§è„‘ã€‚éƒ¨ç½²ä¸æ•°æ®å¹³é¢åˆ†ç¦»çš„æ§åˆ¶å¹³é¢éå¸¸é‡è¦ï¼ŒåŸå› å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®‰å…¨æ€§â€”å¦‚æœæ‚¨çš„æ•°æ®å¹³é¢ä¸­çš„æŸä¸ªèŠ‚ç‚¹å—åˆ°æ”»å‡»ï¼Œæ‚¨è‚¯å®šä¸å¸Œæœ›å› ä¸ºå…è®¸æ‚¨çš„æ§åˆ¶å¹³é¢å—åˆ°æ”»å‡»è€Œæ”¾å¼ƒå¯¹å…¶ä»–åº”ç”¨ç¨‹åºå’Œç½‘ç»œçš„æ§åˆ¶ï¼Œä»è€ŒåŠ å‰§æ‚¨çš„æƒ…å†µã€‚æ­¤å¤–ï¼Œæ§åˆ¶å¹³é¢å¯ä»¥å¤„ç†å¯†é’¥ã€è¯ä¹¦æˆ–å…¶ä»–æœºå¯†çš„åˆ†å‘ï¼Œè¿™äº›æœºå¯†ä¿¡æ¯åº”è¯¥ä¸æ•°æ®å¹³é¢åˆ†å¼€ä¿å­˜ã€‚&lt;/li&gt;
&lt;li&gt;ä¼¸ç¼©æ€§â€”æ‚¨å¯èƒ½æœ€ç»ˆä¼šä»¥ä¸åŒçš„æ–¹å¼ä¼¸ç¼©æ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„æ§åˆ¶å¹³é¢æ­£åœ¨è½®è¯¢ Kubernetes ä¸­çš„æœåŠ¡/ç«¯ç‚¹ç­‰ï¼Œé‚£ä¹ˆæ‚¨è‚¯å®šä¸å¸Œæœ›å°†è¿™äº›ç»„ä»¶ä¸æ‚¨çš„æ•°æ®å¹³é¢æ”¾åœ¨ä¸€èµ·â€”æ‚¨å°†æ‰¼æ€ä»»ä½•å¯ä¼¸ç¼©æ€§çš„æœºä¼šã€‚&lt;/li&gt;
&lt;li&gt;åˆ†ç»„â€”æ‚¨çš„æ•°æ®å¹³é¢å¯èƒ½å…·æœ‰ä¸åŒçš„è§’è‰²å’ŒèŒè´£ï¼›ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½åœ¨è¾¹ç¼˜æœ‰æ•°æ®å¹³é¢ Envoyï¼Œè¿™å°†éœ€è¦ä¸åŒçš„å®‰å…¨æ€§å’Œç½‘ç»œçŠ¶æ€ï¼Œè€Œä¸æ˜¯ç”¨äºå¾®æœåŠ¡çš„å…±äº«ä»£ç†æ± ä¸æ‚¨å¯èƒ½éƒ¨ç½²çš„ä»»ä½• sidecar ä»£ç†ã€‚å°†æ§åˆ¶å¹³é¢ä¸æ•°æ®å¹³é¢æ”¾åœ¨ä¸€èµ·ä¼šä½¿æ•°æ®å’Œé…ç½®åˆ†å¼€å˜å¾—æ›´åŠ å›°éš¾ã€‚&lt;/li&gt;
&lt;li&gt;èµ„æºåˆ©ç”¨â€”æ‚¨å¯èƒ½å¸Œæœ›æ ¹æ®ç»„ä»¶åˆ†é…æˆ–é™åˆ¶æŸäº›èµ„æºä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œæ‚¨çš„æ•°æ®å¹³é¢å¯èƒ½æ¯”æ§åˆ¶å¹³é¢æ›´éœ€è¦è®¡ç®— (æ§åˆ¶å¹³é¢å¯èƒ½æ›´éœ€è¦å†…å­˜)ï¼Œå¹¶ä¸”æ‚¨å°†ä½¿ç”¨ä¸åŒçš„èµ„æºé™åˆ¶æ¥æ»¡è¶³è¿™äº›è§’è‰²çš„éœ€æ±‚ã€‚å°†å®ƒä»¬åˆ†å¼€å¯ä»¥è®©æ‚¨è·å¾—æ›´å¤šç»†ç²’åº¦çš„èµ„æºæ± é€‰é¡¹ï¼Œè€Œä¸åªæ˜¯å°†å®ƒä»¬é›†ä¸­åœ¨ä¸€èµ·ã€‚æ­¤å¤–ï¼Œå¦‚æœæ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢è¢«é…ç½®åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”äº‰å¤ºç›¸åŒçš„èµ„æºï¼Œæ‚¨å¯èƒ½ä¼šå¾—åˆ°éš¾ä»¥è¯Šæ–­çš„å¥‡æ€ªçš„å°¾å»¶è¿Ÿ (Tail Latency)ã€‚&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²/ç”Ÿå‘½å‘¨æœŸâ€”æ‚¨å¯èƒ½å¸Œæœ›ç‹¬ç«‹äºæ•°æ®å¹³é¢å¯¹æ§åˆ¶å¹³é¢è¿›è¡Œè¡¥ä¸ã€å‡çº§æˆ–å…¶ä»–æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;å­˜å‚¨â€”å¦‚æœæ‚¨çš„æ§åˆ¶å¹³é¢éœ€è¦ä»»ä½•ç±»å‹çš„å­˜å‚¨ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å•ç‹¬é…ç½®å®ƒï¼Œå¦‚æœæ‚¨å°†ç»„ä»¶åˆ†ç¦»å‡ºæ¥ï¼Œåˆ™ä¸éœ€è¦æ¶‰åŠæ•°æ®å¹³é¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±äºè¿™äº›åŸå› ï¼Œæˆ‘ä»¬å»ºè®®ä¿æŒæ§åˆ¶å¹³é¢ä¸æ•°æ®å¹³é¢è§£è€¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¦ç‚¹&#34;&gt;è¦ç‚¹&lt;/h2&gt;
&lt;p&gt;ä¸º Envoy æ„å»ºæ§åˆ¶å¹³é¢å¹¶ä¸å®¹æ˜“ï¼Œä¸€æ—¦æ‚¨äº†è§£äº†å·¥ä½œæµéœ€è¦ä»æ§åˆ¶å¹³é¢å¾—åˆ°ä»€ä¹ˆï¼Œæ‚¨å°±éœ€è¦äº†è§£å¦‚ä½•æœ€å¥½åœ°éƒ¨ç½²å®ƒã€‚Gloo å›¢é˜Ÿå»ºè®®æ„å»ºä¸€ä¸ªå¯æ‹”æ’çš„æ§åˆ¶å¹³é¢ï¼Œå¹¶å°†å…¶ä¸æ•°æ®å¹³é¢åˆ†å¼€ï¼ŒåŸå› å¦‚ä¸Šæ‰€è¿°ã€‚Gloo çš„ä½“ç³»ç»“æ„æ˜¯è¿™æ ·æ„å»ºçš„ï¼Œå®ƒä½¿&lt;a href=&#34;https://github.com/solo-io/gloo/graphs/contributor&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo å›¢é˜Ÿ&lt;/a&gt;èƒ½å¤Ÿå¿«é€Ÿæ·»åŠ ä»»ä½•æ–°ç‰¹æ€§å’Œæ‰©å±•ï¼Œä»¥æ”¯æŒä»»ä½•å¹³å°ã€é…ç½®ã€è¿‡æ»¤å™¨ï¼Œä»¥åŠæ›´å¤šã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>éƒ¨ç½² Envoy ä»£ç†æ¥ä¸º Monzo æé€Ÿ</title>
      <link>https://cloudnative.to/blog/deploying-envoy-proxy/</link>
      <pubDate>Mon, 27 May 2019 04:55:44 +0800</pubDate>
      <guid>https://cloudnative.to/blog/deploying-envoy-proxy/</guid>
      <description>&lt;h2 id=&#34;ç¼–è€…æŒ‰&#34;&gt;ç¼–è€…æŒ‰&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»äº†ä½¿ç”¨ Envoy æ¥åŠ é€Ÿ Monzoï¼Œå¯¹æ¯”äº†ä½¿ç”¨ Linkerd å’Œ Envoyï¼Œé€šè¿‡è¯•éªŒè¯æ˜ Envoy æ‹¥æœ‰æ›´å°çš„å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬åŸºç¡€è®¾æ–½çš„ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶æ˜¯è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ (RPC) ç³»ç»Ÿã€‚å®ƒå…è®¸å¾®æœåŠ¡é€šè¿‡ç½‘ç»œä»¥å¯ä¼¸ç¼©å’Œå¯å®¹é”™çš„æ–¹å¼å½¼æ­¤é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;æ¯å½“è¯„ä¼° RPC ç³»ç»Ÿæ—¶ï¼Œé€šå¸¸ä¼šæŸ¥çœ‹ä»¥ä¸‹å‡ ä¸ªå…³é”®æŒ‡æ ‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é«˜å¯ç”¨&lt;/strong&gt;ï¼ŒæœåŠ¡ä¹‹é—´çš„é€šä¿¡åº”è¯¥å°½å¯èƒ½å¿«ã€‚RPC å­ç³»ç»Ÿåº”è¯¥åšåˆ°å»¶è¿Ÿå¼€é”€æœ€å°åŒ–ï¼Œå¹¶åœ¨è·¯ç”±è¯·æ±‚æ—¶é¿å…è·¯ç”±åˆ°å¤±è´¥çš„æœåŠ¡å‰¯æœ¬ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯ä¼¸ç¼©æ€§&lt;/strong&gt;ï¼Œå¹³å°æ¯ç§’ä¼šæ”¶åˆ°æ•°ä»¥ä¸‡è®¡çš„è¯·æ±‚ï¼Œéšç€ç”¨æˆ·åŸºæ•°çš„å¢é•¿ï¼Œè¿™äº›è¯·æ±‚çš„æ•°é‡è¿˜åœ¨ä¸æ–­å¢åŠ ã€‚æ‰€æ‹¥æœ‰çš„ä»»ä½•å­ç³»ç»Ÿéƒ½éœ€è¦ç»§ç»­æ”¯æŒè¿™ç§å¢é•¿ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯æ¢å¤æ€§&lt;/strong&gt;ï¼Œå½“æœåŠ¡å‰¯æœ¬å®•æœºã€å‘ç”Ÿ bug æˆ–è€…ç½‘ç»œä¸å¯é æ—¶ã€‚å­ç³»ç»Ÿåº”è¯¥èƒ½æ£€æµ‹åˆ°ä¸å¯ç”¨çš„ä¸‹æ¸¸å’Œå¼‚å¸¸å€¼ï¼Œè®©ç³»ç»Ÿæ”¶åˆ°åé¦ˆå¹¶ç»•è¿‡å¤±è´¥è¿›è¡Œè·¯ç”±ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯è§‚å¯Ÿæ€§&lt;/strong&gt;ï¼ŒRPC å­ç³»ç»Ÿç”Ÿæˆå¤§é‡å…³äºå¹³å°æ€§èƒ½çš„æ•°æ®ã€‚ä¸ç°æœ‰çš„&lt;a href=&#34;https://monzo.com/blog/2018/07/27/how-we-monitor-monzo/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åº¦é‡æ ‡å‡†å’Œè¿½è¸ªåŸºç¡€è®¾æ–½&lt;/a&gt;é›†æˆï¼Œä»¥åœ¨ç°æœ‰çš„æœåŠ¡åº¦é‡æ ‡å‡†å’Œè¿½è¸ªçš„åŒæ—¶å…¬å¼€æœåŠ¡ç½‘æ ¼ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;2016 å¹´ï¼Œæˆ‘ä»¬å†™äº†ä¸€ç¯‡å…³äº&lt;a href=&#34;https://monzo.com/blog/2016/09/19/building-a-modern-bank-backend/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ„å»ºç°ä»£é“¶è¡Œåå°&lt;/a&gt;çš„åšå®¢ï¼Œå…¶ä¸­ä¸€ä¸ªå…³é”®éƒ¨åˆ†æ˜¯æœåŠ¡ç½‘æ ¼ï¼Œå®ƒç”±&lt;a href=&#34;https://linkerd.io/1/overview/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd 1.0&lt;/a&gt;æä¾›æ”¯æŒã€‚å½“æˆ‘ä»¬åœ¨ 2016 å¹´é€‰æ‹© Linkerd 1.0 æ—¶ï¼ŒæœåŠ¡ç½‘æ ¼ç”Ÿæ€ä½“ç³»è¿˜æ¯”è¾ƒå¹´è½»ã€‚&lt;/p&gt;
&lt;p&gt;ä»é‚£æ—¶èµ·ï¼Œè®¸å¤šæ–°é¡¹ç›®éƒ½è¿½éšäº†æˆ‘ä»¬è¿™ä¸ªæƒ³æ³•ã€‚æˆ‘ä»¬æƒ³é‡æ–°è¯„ä¼° Linkerd 1.0 æ˜¯å¦é€‚åˆæˆ‘ä»¬çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼&#34;&gt;æœåŠ¡ç½‘æ ¼&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çš„å¾®æœåŠ¡æ¯ç§’é€šè¿‡ HTTP æ‰§è¡Œæ•°ä¸‡æ¬¡ RPC è°ƒç”¨ã€‚ç„¶è€Œï¼Œè¦å»ºç«‹ä¸€ä¸ªå¯é çš„ã€å¯å®¹é”™çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œéœ€è¦å…·æœ‰æœåŠ¡å‘ç°ã€è‡ªåŠ¨é‡è¯•ã€é”™è¯¯é¢„ç®—ã€è´Ÿè½½å‡è¡¡å’Œç†”æ–­åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æƒ³å»ºç«‹ä¸€ä¸ªæ”¯æŒæ‰€æœ‰ç¼–ç¨‹è¯­è¨€çš„å¹³å°ã€‚è™½ç„¶å¤§å¤šæ•°å¾®æœåŠ¡éƒ½æ˜¯ç”¨ Go å®ç°çš„ï¼Œä½†æ˜¯æœ‰äº›å›¢é˜Ÿé€‰æ‹©ä½¿ç”¨å…¶ä»–è¯­è¨€ (ä¾‹å¦‚ï¼Œæ•°æ®å›¢é˜Ÿä½¿ç”¨ Python ç¼–å†™ä¸€äº›æœºå™¨å­¦ä¹ æœåŠ¡)ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬ä½¿ç”¨çš„æ¯ä¸€ç§è¯­è¨€ä¸­å®ç°è¿™äº›å¤æ‚çš„ç‰¹æ€§ï¼Œä¼šå¯¹æˆ‘ä»¬è¦ä½¿ç”¨çš„æ–°äº‹ç‰©è®¾ç½®å¾ˆé«˜çš„éšœç¢ã€‚æ­¤å¤–ï¼Œå¯¹ RPC å­ç³»ç»Ÿçš„æ›´æ”¹å°†æ„å‘³ç€é‡æ–°éƒ¨ç½²æ‰€æœ‰æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ—©æœŸåšå‡ºçš„ä¸€ä¸ªå…³é”®å†³å®šæ˜¯å°½å¯èƒ½åœ°ä½¿è¿™ä¸ªå¤æ‚çš„é€»è¾‘è„±ç¦»æµç¨‹ï¼šLinkerd å¯¹æœåŠ¡é€æ˜æä¾›äº†è®¸å¤šç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/deploying-envoy-proxy/envoy-blog-1.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿è¡Œ Linkerd ä½œä¸º&lt;a href=&#34;https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Daemonset&lt;/a&gt;ã€‚è¿™æ„å‘³ç€æ¯ä¸ªæœåŠ¡å°†ä¸æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ Linkerd çš„æœ¬åœ°æœåŠ¡å‰¯æœ¬é€šä¿¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿ç§»åˆ°-envoy&#34;&gt;è¿ç§»åˆ° Envoy&lt;/h2&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬ä¸º&lt;a href=&#34;https://monzo.com/blog/2019/01/15/crowdfunding-technology-testing/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¼—ç­¹åšå‡†å¤‡&lt;/a&gt;çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç° Linkerd æ— æ³•åœ¨ä¸èµ‹äºˆå®ƒä¸æˆæ¯”ä¾‹çš„å¤„ç†èƒ½åŠ›çš„æƒ…å†µä¸‹å¤„ç†è´Ÿè½½ã€‚æˆ‘ä»¬å¿…é¡»å¤§è§„æ¨¡æ‰©å±•æˆ‘ä»¬çš„åŸºç¡€è®¾æ–½æ¥åº”å¯¹ã€‚éšç€æˆ‘ä»¬ä¸šåŠ¡éœ€æ±‚çš„ä¸æ–­å¢é•¿ï¼Œè¿è¡Œ RPC åŸºç¡€è®¾æ–½æ‰€éœ€çš„èµ„æºæ•°é‡æ˜¯ä¸å¯æŒç»­çš„ã€‚å³ä½¿åœ¨æ­£å¸¸çš„è´Ÿè½½æ¨¡å¼ä¸­ï¼ŒLinkerd æœ¬èº«ä¹Ÿæ˜¯é€ æˆç¬¬ 99 ç™¾åˆ†ä½å»¶è¿Ÿçš„ä¸»è¦å› ç´ ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¼€å§‹è¯„ä¼°ä¸ RPC å­ç³»ç»Ÿæ ‡å‡†ç›¸åŒ¹é…çš„æ›¿ä»£æ–¹æ¡ˆã€‚æˆ‘ä»¬ç ”ç©¶äº† Linkerd 2.0ã€Istio å’Œ Envoyã€‚æˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº† Envoyï¼Œå› ä¸ºå®ƒå…·æœ‰é«˜æ€§èƒ½ã€ç›¸å¯¹æˆç†Ÿå’Œå¹¿æ³›åº”ç”¨äºå¤§å‹å·¥ç¨‹å›¢é˜Ÿå’Œé¡¹ç›®çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;æ˜¯ä¸€ä¸ªå¼€æºçš„é«˜æ€§èƒ½æœåŠ¡ç½‘æ ¼ï¼Œæœ€åˆç”± Lyft å¼€å‘ã€‚å®ƒæ˜¯ç”¨ C++ç¼–å†™çš„ï¼Œå› æ­¤ä¸ä¼šå—åˆ°åƒåœ¾æ”¶é›†çš„å½±å“ï¼Œä¹Ÿä¸ä¼šå‡ºç°ç¼–è¯‘æš‚åœã€‚å®ƒæ˜¯æ”¯æ’‘ Istio å’Œ Ambassador ç­‰å…¶ä»–ä¸€äº›é¡¹ç›®çš„æ ¸å¿ƒä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;Envoy å¹¶æ²¡æœ‰å¯¹ Kubernetes çš„ä»»ä½•ä¾èµ–ã€‚æˆ‘ä»¬ç¼–å†™äº†è‡ªå·±çš„å°å‹æ§åˆ¶å¹³é¢ï¼Œå®ƒå°†ç›‘è§† Kubernetes åŸºç¡€è®¾æ–½ä¸­çš„æ›´æ”¹ (ä¾‹å¦‚ç”±äºæ–° Pod è€Œæ›´æ”¹çš„ç«¯ç‚¹)ï¼Œå¹¶é€šè¿‡&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/cluster_manager/cds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›†ç¾¤å‘ç°æœåŠ¡&lt;/a&gt;(CDS) API å°†æ›´æ”¹æ¨é€ç»™ Envoyï¼Œä½¿å…¶æ„ŸçŸ¥åˆ°æ–°æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ä¸ºæµ‹è¯•ä¼—ç­¹ç³»ç»Ÿè€Œå¼€å‘çš„&lt;a href=&#34;https://monzo.com/blog/2019/01/15/crowdfunding-technology-testing/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´Ÿè½½æµ‹è¯•å·¥å…·&lt;/a&gt;æ¥æµ‹è¯•ç°æœ‰çš„ Linkerd å’Œæ–°çš„ Envoy çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/deploying-envoy-proxy/envoy-blog-2.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬æ‰€æœ‰çš„æµ‹è¯•ä¸­ï¼ŒEnvoy éƒ½æ¯”æˆ‘ä»¬ç°æœ‰çš„ Linkerd 1.0 è¡¨ç°å¾—å¥½å¾—å¤šï¼ŒåŒæ—¶éœ€è¦æ›´å°‘çš„å¤„ç†èƒ½åŠ›å’Œå†…å­˜èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;ä¸ Linkerd ç›¸æ¯”ï¼ŒEnvoy ç¼ºå°‘ä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚å»¶è¿Ÿæ„ŸçŸ¥è´Ÿè½½å‡è¡¡ (è€Œä¸ä»…ä»…æ˜¯è½®è¯¢) å’ŒåŸºäºæœåŠ¡çš„é”™è¯¯é¢„ç®— (è€Œä¸ä»…ä»…æ˜¯åŸºäºæ¯ä¸ªè¯·æ±‚çš„è‡ªåŠ¨é‡è¯•)ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬æ²¡æœ‰å‘ç°è¿™äº›æ˜¯äº¤æ˜“ç ´åè€…ï¼Œå°½ç®¡æˆ‘ä»¬æƒ³åœ¨æœªæ¥æ·»åŠ å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¸Œæœ›è½¬æ¢å¯¹æœåŠ¡æ˜¯é€æ˜çš„ã€‚åœ¨æˆ‘ä»¬çš„æ¨å‡ºä¸­ï¼Œä¸€ä¸ªå…³é”®å› ç´ æ˜¯å¦‚æœéœ€è¦å›æ»šï¼Œè¯¥æ›´æ”¹çš„å¯å›æº¯æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è®¾ç½®äº† Envoy æ¥æ¥æ”¶å’Œè·¯ç”± HTTP è¯·æ±‚ï¼Œå°±åƒ Linkerd ä¸€æ ·ï¼Œå¹¶ä»¥ Kubernetes daemonset æ–¹å¼å°†å…¶æ¨å‡ºã€‚åœ¨å‡ ä¸ªæœˆçš„æ—¶é—´é‡Œï¼Œæˆ‘ä»¬åœ¨é¢„å‘å¸ƒç¯å¢ƒä¸­å¤§é‡æµ‹è¯•äº†è¿™äº›æ›´æ”¹ã€‚ä¸€æ—¦åˆ°äº†æŠ•å…¥ç”Ÿäº§çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šåœ¨å‡ å¤©çš„æ—¶é—´é‡Œé€æ­¥æ¨å‡ºå®ƒï¼Œä»¥å‘ç°å¹¶è§£å†³ä»»ä½•åœ¨æœ€åä¸€åˆ»å‡ºç°çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯è§‚å¯Ÿæ€§&#34;&gt;å¯è§‚å¯Ÿæ€§&lt;/h2&gt;
&lt;p&gt;è™½ç„¶ Linkerd 1.0 æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ§åˆ¶å¹³é¢ï¼Œä½†å®ƒä¸èƒ½å¾ˆå¥½åœ°ä¸åŸºäº Prometheus çš„ç›‘æ§ç³»ç»Ÿé›†æˆã€‚åœ¨ Envoy æŠ•å…¥ç”Ÿäº§ä¹‹å‰ï¼Œæˆ‘ä»¬å¯¹å…¶ä¸ Prometheus çš„èåˆç»™äºˆäº†å¯†åˆ‡å…³æ³¨ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬&lt;a href=&#34;https://github.com/envoyproxy/envoy/pulls?utf8=%E2%9C%93&amp;amp;q=is%3Apr&amp;#43;author%3Asuhailpatel&amp;#43;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å›é¦ˆ Envoy ç¤¾åŒº&lt;/a&gt;ï¼Œå®Œæˆäº†å¯¹ Prometheus çš„ä¸€çº§æ”¯æŒã€‚è¿™å…è®¸æˆ‘ä»¬æ‹¥æœ‰ä¸°å¯Œçš„ä»ªè¡¨æ¿æ¥å¢å¼ºç°æœ‰çš„æœåŠ¡åº¦é‡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/deploying-envoy-proxy/envoy-blog-3.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é€šè¿‡æ‹¥æœ‰è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬å¯¹é¦–æ¬¡å±•ç¤ºè·å¾—äº†ä¿¡å¿ƒï¼Œä»¥ç¡®ä¿å®ƒæ˜¯æ— ç¼çš„å’Œæ— é”™è¯¯çš„ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä½ çš„åº”ç”¨ç¨‹åºä¸æˆ‘ä»¬çš„åç«¯é€šä¿¡æ—¶ï¼Œå®ƒä¼šç»è¿‡æˆ‘ä»¬çš„è¾¹ç¼˜å±‚ï¼Œç„¶åå¯ç”¨ä¸åŒæ•°é‡çš„å¾®æœåŠ¡ (æœ‰æ—¶è¶…è¿‡ 20 ä¸ª) æ¥æ»¡è¶³è¯·æ±‚ã€‚å½“æˆ‘ä»¬æ¨å‡º Envoy æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬çš„è¾¹ç¼˜å»¶è¿Ÿå‡å°‘äº†ï¼Œè¿™è¯å®äº†æˆ‘ä»¬çš„æµ‹è¯•ç»“æœã€‚è¿™æœ€ç»ˆæ„å‘³ç€ï¼Œå¯¹äºæ‰€æœ‰ä½¿ç”¨ Monzo çš„äººæ¥è¯´ï¼Œéƒ½èƒ½è·å¾—æ›´å¿«çš„åº”ç”¨ä½“éªŒã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/deploying-envoy-proxy/envoy-blog-4.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;envoy-ä½œä¸º-sidecar&#34;&gt;Envoy ä½œä¸º sidecar&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ç°åœ¨æ­£åœ¨è¿›è¡Œçš„ä¸€ä¸ªå…³é”®é¡¹ç›®æ˜¯å°†æœåŠ¡ç§»åŠ¨åˆ° Envoy Proxy ä½œä¸ºå¾®æœåŠ¡å®¹å™¨çš„&lt;a href=&#34;https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sidecar&lt;/a&gt;ã€‚è¿™æ„å‘³ç€ï¼Œæ¯ä¸ªæœåŠ¡å°†æ‹¥æœ‰è‡ªå·±çš„ Envoy å‰¯æœ¬ï¼Œè€Œä¸æ˜¯ä¸ä¸»æœºä¸Šçš„ Envoy é€šä¿¡ (è¿™æ˜¯ä¸€ä¸ªå…±äº«èµ„æº)ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬é‡‡ç”¨ sidecar æ¨¡å‹ï¼Œè®¾ç½® Envoy æ¥å¤„ç†å‡ºå…¥å£é—®é¢˜ã€‚ä¼ å…¥çš„è¯·æ±‚ (æ¥è‡ªå¦ä¸€ä¸ªæœåŠ¡æˆ–å¦ä¸€ä¸ª Envoy çš„å…¥å£) å°†é€šè¿‡æœ¬åœ° Envoy ä¼ å…¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è§„åˆ™æ¥éªŒè¯æµé‡æ˜¯å¦åˆæ³•ã€‚å‘å¤– (å‡ºå£) çš„æµé‡å°†é€šè¿‡ sidecar Envoyï¼Œsidecar Envoy åƒä»¥å‰ä¸€æ ·è´Ÿè´£å°†æµé‡è·¯ç”±åˆ°æ­£ç¡®çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/deploying-envoy-proxy/envoy-blog-5.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è½¬ç§»åˆ° sidecar çš„ä¸€ä¸ªå…³é”®ä¼˜åŠ¿æ˜¯èƒ½å¤Ÿå®šä¹‰ç½‘ç»œéš”ç¦»è§„åˆ™ã€‚ä»¥å‰ï¼Œæˆ‘ä»¬æ— æ³•é”å®šæ•æ„Ÿçš„å¾®æœåŠ¡ï¼Œå› ä¸ºæµé‡æ¥è‡ªä¸€ä¸ªå…±äº«çš„ Envoyï¼Œæ‰€ä»¥åªèƒ½åœ¨ç½‘ç»œçº§åˆ«ä¸Šæ¥æ”¶æ¥è‡ªæŸäº› Kubernaetes Pod ip çš„æµé‡ã€‚æœåŠ¡å¿…é¡»æœ‰è‡ªå·±çš„é€»è¾‘æ¥éªŒè¯è¯·æ±‚æ˜¯å¦åˆæ³•ï¼Œæ˜¯å¦æ¥è‡ªå¯ä¿¡æºã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡åœ¨ Pod åç§°ç©ºé—´ä¸­ç§»åŠ¨ Envoyï¼Œæˆ‘ä»¬èƒ½å¤Ÿå‘ Pod æ·»åŠ &lt;a href=&#34;https://docs.projectcalico.org/v3.5/reference/calicoctl/resources/networkpolicy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Calico ç½‘ç»œç­–ç•¥è§„åˆ™&lt;/a&gt;ï¼Œä»è€Œä¸ºæ¯ä¸ªå¾®æœåŠ¡æœ‰æ•ˆåœ°å»ºç«‹ç½‘ç»œé˜²ç«å¢™ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¯´æµé‡åªèƒ½è¿›å…¥æœåŠ¡ã€‚æ¥è‡ªå…¶ä»–å¾®æœåŠ¡ Pod çš„ç‰¹å®šå­é›†çš„å¸æˆ· Podã€‚é€šè¿‡æ‹’ç»ç½‘ç»œçº§åˆ«ä¸ŠæœªçŸ¥çš„æµé‡ï¼Œè¿™æä¾›äº†ä¸€ä¸ªé¢å¤–çš„å®‰å…¨å±‚ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ Envoy è€Œä¸ä½¿ç”¨ Linkerd çš„ä¸€ä¸ªå…³é”®åŸå› æ˜¯ï¼Œä½¿ç”¨ Envoy å¤„ç†èƒ½åŠ›å’Œå†…å­˜éœ€æ±‚æ˜¾è‘—é™ä½ã€‚æˆ‘ä»¬ç°åœ¨åœ¨æˆ‘ä»¬çš„åŸºç¡€è®¾æ–½ä¸­è¿è¡Œäº†æ•°åƒä»½ Envoyï¼Œéšç€æˆ‘ä»¬å°† Envoy ä½œä¸ºæ‰€æœ‰æœåŠ¡éƒ¨ç½²çš„ sidecar æ¨å‡ºï¼Œè¿™ä¸ªæ•°å­—è¿˜åœ¨ç»§ç»­å¢é•¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æˆ‘ä»¬ä»-envoy-ä¸­æ”¶è·äº†ä»€ä¹ˆ&#34;&gt;æˆ‘ä»¬ä» Envoy ä¸­æ”¶è·äº†ä»€ä¹ˆ&lt;/h2&gt;
&lt;p&gt;æ‹¥æœ‰ Envoy æ˜¯ä¸€æ®µä¼Ÿå¤§çš„æ—…ç¨‹ã€‚æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸é‡æ–°æ„å»ºä»»ä½•ç°æœ‰æœåŠ¡çš„æƒ…å†µä¸‹è¿›è¡Œæ­¤å‡çº§ï¼Œä»è€Œè·å¾—æ›´å¥½çš„æ´å¯ŸåŠ›ã€‚æˆ‘ä»¬å¯¹æ‰€çœ‹åˆ°çš„èµ„æºæ¶ˆè€—å’Œå»¶è¿Ÿæ–¹é¢çš„æ”¹è¿›éå¸¸æ»¡æ„ï¼Œå¹¶ä¸”æˆ‘ä»¬ç›¸ä¿¡éšç€ç”¨æˆ·åŸºæ•°çš„å¢é•¿ï¼ŒEnvoy èƒ½å¤Ÿæ”¯æŒæˆ‘ä»¬æœªæ¥çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ„Ÿè°¢æ‚¨å¯¹ Envoy ç¤¾åŒºæä¾›çš„å¸®åŠ©å’Œæ”¯æŒï¼Œå¹¶å¸Œæœ›ç»§ç»­ä½œå‡ºæ›´å¤šè´¡çŒ®ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>CNCF æ­£åœ¨ç­¹å»ºé€šç”¨æ•°æ®å¹³é¢ API å·¥ä½œç»„ï¼Œä»¥åˆ¶å®šæ•°æ®å¹³é¢çš„æ ‡å‡† API</title>
      <link>https://cloudnative.to/blog/cncf-udpa-wg/</link>
      <pubDate>Wed, 08 May 2019 10:12:18 +0800</pubDate>
      <guid>https://cloudnative.to/blog/cncf-udpa-wg/</guid>
      <description>&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;æ˜¨æ—¥å¾—åˆ°çš„æ¶ˆæ¯ï¼ŒCNCF æ­£åœ¨ç­¹å»ºé€šç”¨æ•°æ®å¹³é¢ API å·¥ä½œç»„ï¼ˆUniversal Data Plane API Working Group / UDPA-WG)ï¼Œä»¥åˆ¶å®šæ•°æ®å¹³é¢çš„æ ‡å‡† APIï¼Œä¸º L4/L7 æ•°æ®å¹³é¢é…ç½®æä¾›äº‹å®ä¸Šçš„æ ‡å‡†ï¼Œåˆå§‹æˆå‘˜å°†åŒ…æ‹¬ Envoy å’Œ gRPC é¡¹ç›®çš„ä»£è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰è¿˜å¤„äºéå¸¸æ—©æœŸçš„ç­¹å¤‡é˜¶æ®µï¼Œå…·ä½“å†…å®¹å¯ä»¥è§ä¸‹é¢çš„æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.google.com/document/d/1y-H-pQ2mmhBPX_U9pP3mMMUbEpZskxBdEbwd5KlivY4/edit#heading=h.fdi15bvpmxen&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://docs.google.com/document/d/1y-H-pQ2mmhBPX_U9pP3mMMUbEpZskxBdEbwd5KlivY4/edit#heading=h.fdi15bvpmxen&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ–¹ä¾¿èµ·è§ï¼Œæˆ‘å°†ç›®å‰æ–‡æ¡£çš„å†…å®¹æ¬è¿å‡ºæ¥å¹¶ç®€å•ç¿»è¯‘å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;h2 id=&#34;æ–‡æ¡£å†…å®¹&#34;&gt;æ–‡æ¡£å†…å®¹&lt;/h2&gt;
&lt;h3 id=&#34;ç›®æ ‡&#34;&gt;ç›®æ ‡&lt;/h3&gt;
&lt;p&gt;é€šç”¨æ•°æ®å¹³é¢ API å·¥ä½œç»„ï¼ˆUniversal Data Plane API Working Group/UDPA-WGï¼‰çš„ç›®æ ‡æ˜¯å°†å¯¹æ•°æ®å¹³é¢ä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨çš„é€šç”¨æ§åˆ¶å’Œé…ç½®APIæ„Ÿå…´è¶£çš„è¡Œä¸šå„æ–¹èšé›†åœ¨ä¸€èµ·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ„¿æ™¯&#34;&gt;æ„¿æ™¯&lt;/h3&gt;
&lt;p&gt;é€šç”¨æ•°æ®å¹³é¢ APIï¼ˆUDPAï¼‰çš„æ„¿æ™¯åœ¨ &lt;a href=&#34;https://blog.envoyproxy.io/the-universal-data-plane-api-d15cec7a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://blog.envoyproxy.io/the-universal-data-plane-api-d15cec7a&lt;/a&gt; ä¸­é˜è¿°ã€‚æˆ‘ä»¬å°†å¯»æ±‚ä¸€å¥— APIï¼Œä¸º L4/L7 æ•°æ®å¹³é¢é…ç½®æä¾›äº‹å®ä¸Šçš„æ ‡å‡†ï¼Œç±»ä¼¼äº OpenFlow åœ¨ SDN L2 /L3/L4 ä¸­æ‰€æ‰®æ¼”çš„è§’è‰²ã€‚&lt;/p&gt;
&lt;p&gt;API ä»¥ proto3 çš„è§„èŒƒæ–¹å¼å®šä¹‰ï¼Œå¹¶é€šè¿‡å®šä¹‰è‰¯å¥½çš„ç¨³å®š API ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥ä»ç°æœ‰çš„ Envoy xDS API é€æ­¥æ¼”å˜ã€‚API å°†æ¶µç›–æœåŠ¡å‘ç°ï¼Œè´Ÿè½½å‡è¡¡åˆ†é…ï¼Œè·¯ç”±å‘ç°ï¼Œç›‘å¬å™¨é…ç½®ï¼Œå®‰å…¨å‘ç°ï¼Œè´Ÿè½½æŠ¥å‘Šï¼Œå¥åº·æ£€æŸ¥å§”æ´¾ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†å‘å±•å’Œå¡‘é€  API ä»¥æ”¯æŒå®¢æˆ·ç«¯æ—è§†ï¼ˆlookasideï¼‰è´Ÿè½½å‡è¡¡ï¼ˆä¾‹å¦‚ gRPC-LBï¼‰ï¼ŒEnvoy ä¹‹å¤–çš„æ•°æ®å¹³é¢ä»£ç†ï¼Œç¡¬ä»¶ LBï¼Œç§»åŠ¨å®¢æˆ·ç«¯ç­‰ã€‚æˆ‘ä»¬å°†åŠªåŠ›å°½å¯èƒ½åœ°ä¸ä¾›åº”å•†å’Œå®ç°æ— å…³ï¼ŒåŒæ—¶ä¸å›å½’æ”¯æŒå·²æŠ•å…¥ç”Ÿäº§ä¸­çš„ UDPA çš„é¡¹ç›®ï¼ˆEnvoyï¼†gRPC-LBï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We will strive to be vendor and implementation agnostic to the degree possible while not regressing on support for projects that have committed to UDPA in production (Envoy &amp;amp; gRPC-LB so far).&lt;/p&gt;
&lt;p&gt;ååŠå¥çš„æ²¡èƒ½ç†è§£åœ¨è¯´ä»€ä¹ˆï¼Œç¨åæ›´æ–°â€¦â€¦&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;æˆå‘˜&#34;&gt;æˆå‘˜&lt;/h3&gt;
&lt;p&gt;åˆå§‹æˆå‘˜å°†åŒ…æ‹¬ Envoy å’Œ gRPC é¡¹ç›®çš„ä»£è¡¨ã€‚è¿™å°†åŒ…æ‹¬æ¥è‡ª è°·æ­Œ å’Œ Lyft çš„ç»´æŠ¤è€…ï¼Œä»¥åŠå¾®è½¯å’Œäºšé©¬é€Šçš„æˆå‘˜ã€‚æˆ‘ä»¬æ­£åœ¨å¾æ±‚æ•°æ®å¹³é¢ä»£ç†ç¤¾åŒºæ›´å¹¿æ³›çš„å¯¹åˆå§‹æˆå‘˜èµ„æ ¼çš„é¢å¤–å…´è¶£ï¼Œå› ä¸ºæˆ‘ä»¬è®¤ä¸ºçœŸæ­£çš„é€šç”¨ API åº”è¯¥åæ˜ å„ç§å„æ ·çš„é¡¹ç›®ï¼Œç»„ç»‡å’Œä¸ªäººã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¸Œæœ›å·¥ä½œç»„ä¿æŒå°è§„æ¨¡ï¼Œå¹¶ç´§å¯†å…³æ³¨æœ‰æ•ˆå¹³è¡¡å¢é‡ APIï¼ŒåŒæ—¶è¿½æ±‚é•¿æœŸæˆ˜ç•¥æ¼”å˜ã€‚æˆ‘ä»¬å°†æ¯ä¸¤å‘¨ä¸¾è¡Œä¸€æ¬¡ Zoom ä¼šè®®ï¼Œå¹¶é€šè¿‡ TBD é‚®ä»¶åˆ—è¡¨è¿›è¡Œæ²Ÿé€šã€‚&lt;/p&gt;
&lt;h2 id=&#34;è§£é‡Š&#34;&gt;è§£é‡Š&lt;/h2&gt;
&lt;p&gt;ä¸Šé¢æ–‡æ¡£ä¸­æåˆ°çš„å‡ ä¸ªå†…å®¹ï¼š&lt;/p&gt;
&lt;h3 id=&#34;ç°æœ‰çš„-envoy-xds-api&#34;&gt;ç°æœ‰çš„ Envoy xDS API&lt;/h3&gt;
&lt;p&gt;Universal Data Plane API çš„ä»‹ç»å’Œè®¾æƒ³è§ Matt Klein çš„åšå®¢æ–‡ç«  &lt;a href=&#34;https://blog.envoyproxy.io/the-universal-data-plane-api-d15cec7a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The universal data plane API&lt;/a&gt;ï¼Œå‘è¡¨äº 2017-09-06ã€‚ä¹Ÿå¯ä»¥çœ‹ servermesher ç½‘ç«™ç¿»è¯‘çš„ä¸­æ–‡ç‰ˆæœ¬ &lt;a href=&#34;http://www.servicemesher.com/blog/the-universal-data-plane-api/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh ä¸­çš„é€šç”¨æ•°æ®å¹³é¢ API è®¾è®¡&lt;/a&gt;ã€‚è¿™ä¸ªåšå®¢é˜è¿°äº† xDS API è¯ç”Ÿçš„æƒ³æ³•/è®¾è®¡å’Œä»v1åˆ°v2ç‰ˆæœ¬çš„æ¼”è¿›&lt;/p&gt;
&lt;p&gt;Envoy xDS API æœ€æ–°çš„å®šä¹‰è¯·è§ï¼šhttps://github.com/envoyproxy/data-plane-api&lt;/p&gt;
&lt;h3 id=&#34;ç¨³å®šçš„-api-ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥&#34;&gt;ç¨³å®šçš„ API ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥&lt;/h3&gt;
&lt;p&gt;è§æ–‡æ¡£ &lt;a href=&#34;https://docs.google.com/document/d/1xeVvJ6KjFBkNjVspPbY_PwEDHC7XPi0J5p1SqUXcCl8/edit#heading=h.c0uts5ftkk58&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Stable Envoy API versioning&lt;/a&gt; : è¿™ä¸ªæ–‡æ¡£æä¾›äº†è§£å†³ Envoy API ä¸­ç¨³å®šæ€§é—®é¢˜çš„è®¾è®¡æ–¹æ¡ˆï¼Œä»¥åŠæœ‰å…³ API å½“å‰çŠ¶æ€çš„ä¸€äº›èƒŒæ™¯ï¼Œè€ƒè™‘çš„æ›¿ä»£æ–¹æ¡ˆä»¥åŠ Envoy API ä¸­æœªæ¥æ–¹å‘çš„è®¨è®ºã€‚ï¼ˆæ–‡æ¡£æœ‰ç‚¹é•¿ï¼‰&lt;/p&gt;
&lt;h3 id=&#34;client-side-lookaside-load-balancing&#34;&gt;client-side lookaside load balancing&lt;/h3&gt;
&lt;p&gt;ä»‹ç»è§ &lt;a href=&#34;https://grpc.io/blog/loadbalancing/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://grpc.io/blog/loadbalancing/&lt;/a&gt; ä¸­çš„â€œLookaside Load Balancingâ€ä¸€èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šæ—è§†ï¼ˆlookasideï¼‰è´Ÿè½½å¹³è¡¡å™¨ä¹Ÿç§°ä¸ºå¤–éƒ¨ï¼ˆexternalï¼‰è´Ÿè½½å¹³è¡¡å™¨æˆ–å•è‡‚ï¼ˆone-armï¼‰è´Ÿè½½å¹³è¡¡å™¨&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ c æ—¶ï¼Œè´Ÿè½½å‡è¡¡çš„æ™ºèƒ½åœ¨ç‰¹æ®Šçš„ LB æœåŠ¡å™¨ä¸­å®ç°ã€‚å®¢æˆ·ç«¯æŸ¥è¯¢æ—è§† LBï¼ŒLB å“åº”æœ€åˆé€‚æœåŠ¡å™¨ç»™å®¢æˆ·ç«¯ä½¿ç”¨ã€‚ä¿æŒæœåŠ¡å™¨çŠ¶æ€å’Œ LB ç®—æ³•çš„å®ç°åœ¨æ—è§† LB ä¸­å®ç°ã€‚è¯·æ³¨æ„ï¼Œå®¢æˆ·ç«¯å¯èƒ½ä¼šé€‰æ‹©åœ¨ LB ä¸­å®ç°çš„å¤æ‚ç®—æ³•ä¹‹ä¸Šå®ç°ç®€å•ç®—æ³•ã€‚gRPC ä½¿ç”¨è¯¥æ¨¡å‹å®šä¹‰å®¢æˆ·ç«¯å’Œ LB ä¹‹é—´çš„é€šä¿¡åè®®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾è¯´æ˜äº†è¿™ç§æ–¹æ³•ã€‚å®¢æˆ·ç«¯ä»æ—è§† LB (#1) è·å–è‡³å°‘ä¸€ä¸ªåœ°å€ã€‚ç„¶åå®¢æˆ·ç«¯ä½¿ç”¨æ­¤åœ°å€ç”Ÿæˆ RPC (#2)ï¼ŒæœåŠ¡å™¨å°†è´Ÿè½½æŠ¥å‘Šå‘é€åˆ° LB (#3)ã€‚æ—è§† LB ä¸å…¶ä»–åŸºç¡€è®¾æ–½é€šä¿¡ï¼Œä¾‹å¦‚åç§°è§£æï¼ŒæœåŠ¡å‘ç°ç­‰ (#4)ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://grpc.io/img/image_2.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;åˆ†æ&#34;&gt;åˆ†æ&lt;/h2&gt;
&lt;p&gt;ä¹‹å‰ servicemesher ç¤¾åŒºåœ¨å¤šæ¬¡è®¨è®º servicemesh å¸‚åœºç«äº‰æ—¶ï¼Œéƒ½åœ¨ç¬‘è¯´ï¼šEnvoy æ‰æ˜¯çœŸæ­£çš„èµ¢å®¶ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ä»…ä»…åœ¨äº Envoy è¡¨ç°ç¨³å®šã€ä½¿ç”¨å¹¿æ³›ã€é¡ºåˆ©ä» CNCF æ¯•ä¸šï¼Œä¹Ÿåœ¨äº Envoy çš„ xDS v2 APIï¼Œå·²ç»æˆä¸ºæ•°æ®å¹³é¢çš„äº‹å®æ ‡å‡†ã€‚è€Œè¿™ä¸€æ¬¡ CNCF ç»„ç»‡é€šç”¨æ•°æ®å¹³é¢ API å·¥ä½œç»„ï¼Œå‡†å¤‡åŸºäº xDS v2 API åˆ¶å®šå®˜æ–¹æ ‡å‡†ï¼Œå¯ä»¥è¯´æ˜¯æ°´åˆ°æ¸ æˆã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ç›®å‰å”¯ä¸€æ‹…å¿ƒçš„æ˜¯ï¼šBueyant ä¼šä¸ä¼šå‚ä¸è¿›æ¥ï¼ŸLinkerd2 ä¼šä¸ä¼šé€‰æ‹©æ”¾å¼ƒç°åœ¨ä½¿ç”¨çš„ç§æœ‰ API è€Œéµå¾ªæ–°æ ‡å‡†ï¼Ÿ&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title></title>
      <link>https://cloudnative.to/blog/envoy-service-mesh-and-observability-best-practices-for-enterprises/</link>
      <pubDate>Tue, 07 May 2019 11:50:05 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-service-mesh-and-observability-best-practices-for-enterprises/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://medium.com/@ustela101/envoy-service-mesh-and-observability-best-practices-for-enterprises-6b72bbaa723c&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼–è€…æŒ‰&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Envoy åˆ›å§‹äºº Matt Klein åˆ†äº«äº†ä»–å¯¹ä¼ä¸šå¼€å§‹ä½¿ç”¨ Envoy éƒ¨ç½²å¾®æœåŠ¡æ‰€é‡åˆ°çš„æŒ‘æˆ˜ä»¥åŠå¯è§‚å¯Ÿæ€§çš„çœ‹æ³•å’Œé€‰æ‹©ï¼Œä»–è®¤ä¸º Service Mesh è¿˜å¤„äºæ—©æœŸé˜¶æ®µï¼Œä¼ä¸šåº”è¯¥é€æ­¥æ¨è¿›ï¼ŒåŒæ—¶æœ€å¥½é€‰æ‹©å•†ä¸šè§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Service Mesh çš„å—æ¬¢è¿ç¨‹åº¦æ­£åœ¨é£™å‡ï¼Œå°½ç®¡å®ƒè¿˜å¤„äºåˆæœŸé˜¶æ®µã€‚åœ¨ä¸ºéƒ¨ç½² Envoy çš„ä¼ä¸šå¯»æ±‚æœ‰å…³æœåŠ¡ç½‘æ ¼å’Œå¯è§‚å¯Ÿæ€§æœ€ä½³å®è·µçš„å»ºè®®æ—¶ï¼Œæˆ‘ä¸ &lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt; çš„åˆ›å»ºè€…å’Œ&lt;a href=&#34;https://www.cncf.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼š&lt;/a&gt;ï¼ˆCNCFï¼‰æŠ€æœ¯ç›‘ç£å§”å‘˜ä¼šï¼ˆTOCï¼‰çš„ä»£è¡¨ Matt Klein èŠäº†èŠã€‚åœ¨ä¸‹é¢çš„è®¨è®ºä¸­ï¼ŒMatt åˆ†äº«äº†ä»–å¯¹ä¼ä¸šå¼€å§‹ä½¿ç”¨ Envoy éƒ¨ç½²å¾®æœåŠ¡æ‰€é‡åˆ°æŒ‘æˆ˜çš„çœ‹æ³•ï¼ŒåŒæ—¶ä¹Ÿè°ˆåˆ°äº†å¯è§‚å¯Ÿæ€§ï¼Œä»¥åŠåœ¨ä¸ Envoy ä¸€èµ·é€‰æ‹©å¯è§‚å¯Ÿæ€§å¹³å°æ—¶å¯ä»¥åšå‡ºçš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Stela Udovicicï¼šæ‚¨è®¤ä¸ºåœ¨é‡‡ç”¨å¾®æœåŠ¡æ—¶é‡åˆ°ä»€ä¹ˆæ ·çš„ç—›ç‚¹è¡¨æ˜åº”è¯¥å»è€ƒè™‘ Envoyï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Matt Klein&lt;/strong&gt;ï¼šæˆ‘è®¤ä¸ºå½“äººä»¬é‡‡ç”¨å¾®æœåŠ¡æ—¶ï¼Œä»–ä»¬ä¼šçœ‹åˆ°æ™®éå­˜åœ¨çš„é—®é¢˜ï¼Œå…¶ä¸­å¾ˆå¤šé—®é¢˜éƒ½ä¸ç½‘ç»œå’Œå¯è§‚å¯Ÿæ€§æœ‰å…³ã€‚æœ‰å…³ç½‘ç»œç¨³å®šæ€§çš„é—®é¢˜ï¼Œæœ‰å…³é‡è¯•å’Œæ–­è·¯ç­‰ç›¸ä¼¼çš„é—®é¢˜éƒ½æ˜¯å¸¸è§çš„ä¾‹å­ã€‚æ‰€ä»¥ï¼Œè¿™å°†é€šè¿‡ç”¨ä»–ä»¬æœ€ç»ˆä½¿ç”¨çš„ä»»ä½•è¯­è¨€ç¼–å†™ä¸€å †ä»£ç æ¥è§£å†³ï¼Œæˆ–è€…ä»–ä»¬å¯èƒ½ä¼šé‡‡ç”¨ä¸€äº›å¤–éƒ¨è¿›ç¨‹ä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Stela Udovicicï¼šå¯¹äºåœ¨ç”Ÿäº§ä¸­éƒ¨ç½² Envoy çš„äººæ¥è¯´ï¼Œä»–ä»¬å°†é¢ä¸´å“ªäº›æŒ‘æˆ˜ï¼Œä»¥åŠå­¦ä¹ å“ªäº›ç»éªŒæ•™è®­å¯ä»¥æ›´é¡ºåˆ©åœ°é‡‡ç”¨ Envoyï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Matt Klein&lt;/strong&gt;ï¼šä» Envoy çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘è®¤ä¸ºè¿™å¹¶ä¸å®¹æ˜“ï¼Œå®ƒæœ‰æ•°æ®å¹³é¢ï¼Œè¿˜æœ‰æ§åˆ¶å¹³é¢ã€‚åœ¨æˆ‘ä»¬çš„ç»„ç»‡ï¼ˆLyftï¼‰ä¸­ï¼Œæˆ‘ä»¬å°†ä¸å¯é¿å…åœ°æœ€ç»ˆéœ€è¦ä¸¤è€…ï¼Œå¹¶ä¸” Envoy æ²¡æœ‰è‡ªå·±çš„æ§åˆ¶å¹³é¢ã€‚ç„¶è€Œï¼Œè®¸å¤šé¡¹ç›®å’Œç³»ç»Ÿæ­£åœ¨æ¶Œç°ï¼Œç°åœ¨ï¼Œæ‰€æœ‰è¿™äº›éƒ½æ˜¯æ§åˆ¶å¹³é¢ï¼Œæ— è®ºæ˜¯åƒ Istioï¼ŒAWS App Mesh è¿™æ ·çš„äº‘ç®¡ç†æœåŠ¡ï¼Œè¿˜æ˜¯æ¥è‡ª Solo.io çš„ Gloo ç­‰ç­‰ã€‚æ‰€ä»¥æˆ‘è®¤ä¸ºäººä»¬å¿…é¡»å†³å®šçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä»–ä»¬æ˜¯å¦æƒ³ç›´æ¥ä½¿ç”¨ Envoyï¼Œæˆ–è€…ä»–ä»¬æ˜¯å¦æƒ³å°è¯•ä½¿ç”¨æ›´åŠ æ•´ä½“çš„è§£å†³æ–¹æ¡ˆã€‚å†è¯´ä¸€æ¬¡ï¼Œæ— è®ºæ˜¯ Istioï¼ŒConsul Connector App Mesh è¿˜æ˜¯å…¶ä»–ä»€ä¹ˆç±»ä¼¼çš„æ–¹æ¡ˆï¼Œæˆ‘ä¸ªäººå»ºè®®å¤§å¤šæ•°å®¢æˆ·å¼€å§‹å°è¯•å…¶ä¸­ä¸€ä¸ªé¡¹ç›®ã€‚æˆ‘è®¤ä¸ºä»–ä»¬åº”è¯¥é€‰æ‹©ä¸€ä¸ªæ¯” Envoy çŸ¥è¯†æ›´å°‘ä½†æ˜¯åŠŸèƒ½æ›´å…¨é¢çš„æ–¹æ¡ˆï¼Œæˆ‘æƒ³è¯´ï¼Œæ™®é€šç”¨æˆ·æ›´å®¹æ˜“æ¥å—ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥çš„äº‹æƒ…æ˜¯è€ƒè™‘é€æ­¥éƒ¨ç½²ã€‚å®ƒä¸åº”è¯¥æ˜¯ä¸€ä¸ªå¤§çˆ†ç‚¸ï¼Œæ‰€ä»¥æ‚¨è¦è€ƒè™‘å¥½æ‚¨æƒ³è¦è§£å†³çš„é—®é¢˜ï¼Œå°±ä»é‚£ä¸ªé—®é¢˜å¼€å§‹ï¼Œé¦–å…ˆæå®šå¦‚ä½•éƒ¨ç½²ä¸€ç»„æœåŠ¡ï¼Œå¹¶çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œç„¶åä»é‚£é‡Œå±•å¼€ã€‚æ‰€ä»¥æˆ‘è®¤ä¸ºé€æ­¥éƒ¨ç½²æ˜¯ä¸€ä¸ªå…³é”®ã€‚æ˜¾ç„¶ï¼Œé€æ­¥éƒ¨ç½²å’Œå›æ»šï¼Œå¹¶è¯•å›¾å¼„æ¸…æ¥š Envoy æ˜¯åº”è¯¥å•ç‹¬ä½¿ç”¨è¿˜æ˜¯åº”è¯¥å°†å®ƒä½œä¸ºæ›´å¤§äº§å“æˆ–ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Stela Udovicicï¼šåœ¨æ‚¨çš„ä¼šè®®ä¸­ï¼Œæ‚¨æåˆ° Envoy æä¾›çš„æœ€æœ‰ä»·å€¼çš„ä¸œè¥¿ä¹‹ä¸€å°±æ˜¯å¯è§‚å¯Ÿæ€§ã€‚äº†è§£å»¶è¿Ÿçš„åˆ†å¸ƒè‡³å…³é‡è¦ï¼Œä¸ä»…é€‚ç”¨äºäº‘åŸç”Ÿç»„ç»‡ï¼Œä¹Ÿé€‚ç”¨äºå°å‹å…¬å¸å’Œæ›´ä¼ ç»Ÿçš„ä¼ä¸šã€‚æ‚¨èƒ½è¯¦ç»†è¯´æ˜ä¿¡ä»»æµ‹é‡æ•°æ®çš„é‡è¦æ€§ä»¥åŠå°¾ç«¯å»¶è¿Ÿçš„è´Ÿé¢å½±å“å—ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Matt Klein&lt;/strong&gt;ï¼šå—¯ï¼Œæˆ‘è®¤ä¸ºå¤§å®¶å¯¹äºç”¨æˆ·ä½“éªŒæˆ–è€…æ‚¨å°è¯•æä¾›çš„ SLA æˆ– SLO éƒ½æœ‰é«˜åº¦å…³æ³¨ã€‚è™½ç„¶çŸ¥é“ P50 å¯èƒ½å¾ˆæœ‰ç”¨ï¼Œä½†äº‹æƒ…é€šå¸¸å¾€å¾€ä¼šæœ‰ä¸€ä¸ªéå¸¸å¤¸å¼ çš„æ›²çº¿ï¼Œè€Œä¸”æ˜¯ 1ï¼…çš„ç”¨æˆ·å¯èƒ½ä¼šé‡åˆ° 10 å€çš„å»¶è¿Ÿ â€”â€”â€” ä»äº§å“çš„è§’åº¦æ¥çœ‹ï¼Œè¿™å¯èƒ½æ˜¯éå¸¸é‡è¦çš„äº‹æƒ…ã€‚è¿™å°±æ˜¯å‡†ç¡®æµ‹é‡ P99 æœ‰é‡è¦æ„ä¹‰çš„åœ°æ–¹ã€‚å®ƒè®©æ‚¨äº†è§£è¾¹ç¼˜çš„è´¨é‡æ ‡å‡†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨æ­£åœ¨åŠªåŠ›å®ç°éå¸¸é«˜è´¨é‡å’Œéå¸¸å¯é çš„æœåŠ¡ï¼Œé‚£ä¹ˆæ‚¨è‚¯å®šä¸ä¼šå¸Œæœ›æ¯ä¸€ç™¾ä¸ªè¯·æ±‚ä¸­çš„ä¸€ä¸ªä¼šå‡ºé”™ã€‚æˆ‘æƒ³å¤§å¤šæ•°äººä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªéå¸¸é«˜çš„é”™è¯¯ç‡ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒå¾ˆé‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Stela Udovicicï¼šé‚£ä¹ˆï¼Œå¼€å‘äººå‘˜å¦‚ä½•ä¿¡ä»»ä»–ä»¬çš„æµ‹é‡æ•°æ®å‘¢ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Matt Klein&lt;/strong&gt;ï¼šåœ¨è·å¾—å¯é æ•°æ®æ–¹é¢ï¼Œæœ‰ä¸€ä¸ªç†è®ºæ˜¯è§‚å¯Ÿè¡Œä¸ºä¼šæ”¹å˜è§‚å¯Ÿç»“æœã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬åœ¨è®¡ç®—ç³»ç»Ÿçš„å½±å“ä¸­çœ‹åˆ°äº†å¾ˆå¤šè¿™æ ·çš„å½±å“ï¼Œå› æ­¤å¾ˆéš¾é€šè¿‡è§‚å¯Ÿè€Œä¸æ”¹å˜è§‚å¯Ÿç»“æœï¼Œä½†æ˜¯æ‚¨è¦å°½å¯èƒ½å¤šåœ°å°è¯• â€”â€” è·å¾—å¯é çš„æ•°æ®ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‚¨å…³å¿ƒè¿™äº›ç±»å‹çš„ä»£ç†å’Œæµ‹é‡ç³»ç»Ÿçš„æ€§èƒ½ â€”â€” å› ä¸ºå¦‚æœä»£ç†æœ¬èº«æˆ–å®ƒä»¬è¿è¡Œçš„â€‹â€‹ç³»ç»Ÿæœ‰ä»»æ„æ”¶é›†æš‚åœæˆ–æœ‰æ˜æ˜¾çš„æ€§èƒ½ç¼ºé™·ï¼Œæ‚¨å°±ä¸èƒ½ä¿¡ä»»è¿™äº›æ•°æ®åšå‡ºæ›´é«˜å±‚æ¬¡çš„å…³é”®å†³ç­–ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Stela Udovicicï¼šåœ¨å¤„ç†æ—¶é—´æ•æ„Ÿçš„åº”ç”¨ç¨‹åºæ—¶ï¼Œè§‚å¯Ÿè€…çš„å½±å“å˜å¾—é‡è¦ã€‚æˆ‘ä»¬æ˜¯å¦å¯ä»¥å‡è®¾ Envoy å·²ç»è¶³å¤Ÿä¼˜åŒ–ï¼Œä¸ä¼šç»™å¤§å¤šæ•°ç”¨æˆ·çš„æœåŠ¡å¸¦æ¥æ€§èƒ½è´Ÿæ‹…ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Matt Klein&lt;/strong&gt;ï¼šæˆ‘è®¤ä¸ºæˆ‘ä»¬å¯¹ Envoy æœ€å¸¸è§çš„é—®é¢˜æ˜¯ï¼šâ€œå®ƒæœ‰å¤šå¿«ï¼Ÿæ€§èƒ½å¼€é”€æ€æ ·ï¼Ÿâ€œå› ä¸ºï¼Œç¡®å®ï¼Œæœ‰ä¸€äº›æ€§èƒ½å¼€é”€ã€‚ä»é¡¹ç›®çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬ä¸ä¼šä»…ä»…å› ä¸ºå¾ˆéš¾åšåˆ°è€Œå…¬å¸ƒå®˜æ–¹æ€§èƒ½æ•°æ®ã€‚å®ƒéå¸¸ä¾èµ–äºç”¨æˆ·çš„ç¯å¢ƒä»¥åŠå®ƒä»¬æ­£åœ¨è¿è¡Œçš„é…ç½®ç­‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çŸ¥é“ Envoy å—åˆ°äº†å¾ˆå¤šæ€§èƒ½å…³æ³¨ï¼Œæˆ‘ä»¬æ€»æ˜¯è¯•å›¾è®©å®ƒå˜å¾—æ›´å¥½ï¼Œæ‰€ä»¥æ°¸è¿œä¸ä¼šæœ‰ä»»ä½•å®Œç¾çš„æƒ…å†µï¼Œä½†æˆ‘ä»¬ç¡®å®è§‰å¾—å®ƒåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹çš„è¡¨ç°å·²ç»è¶³å¤Ÿå¿«äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Stela Udovicicï¼šè°ˆåˆ°å¾®æœåŠ¡ï¼Œæœ‰å¾ˆå¤šç»Ÿè®¡/æŒ‡æ ‡å’Œè¿½è¸ªè¦æ”¶é›†ã€‚å¯ä¼¸ç¼©æ€§æœ‰å¤šé‡è¦ â€”â€” å½“äººä»¬æƒ³è¦åˆ†æ Envoy æ•°æ®æ—¶ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Matt Klein&lt;/strong&gt;ï¼šæˆ‘è®¤ä¸ºä¼¸ç¼©æœ‰ä¸¤ä¸ªæ–¹é¢ã€‚æˆ‘è®¤ä¸ºåªæœ‰ä¸€äº›æŒ‡æ ‡ç‚¹ã€‚å½“ç„¶ï¼Œè¿˜æœ‰å¾ˆå¤šä¸åŒçš„æŒ‡æ ‡ã€‚å› æ­¤ï¼ŒEnvoy è¾“å‡º 20 ä¸ªä¸åŒçš„å‚æ•°ï¼ŒEnvoy å¤§è§„æ¨¡åœ°å‘å‡ºå¦‚æ­¤å¤šçš„æŒ‡æ ‡ï¼Œä¾‹å¦‚å¦‚æœé€‰æ‹©è·Ÿè¸ªåŸºäºæ¯ä¸ªä¸»æœºçš„æ‰€æœ‰æŒ‡æ ‡ï¼Œä»£ä»·å¯èƒ½å˜å¾—æ˜‚è´µã€‚å› æ­¤ï¼Œé€‰æ‹©æµ‹é‡å†…å®¹çš„çµæ´»æ€§å˜å¾—å¾ˆé‡è¦ã€‚æˆ‘è®¤ä¸ºåœ¨ä¸»æœºæ€»æ•°ï¼Œæ•°æ®ç‚¹æ€»æ•°ï¼Œæ˜¯å¦åº”è¯¥è¿‡æ»¤æŸäº›æŒ‡æ ‡ä»¥åŠå¦‚ä½•æ‰©å±•æŒ‡æ ‡å¹³å°æ–¹é¢éœ€è¦è€ƒè™‘ä¸åŒçš„äº‹æƒ…ã€‚æ ¹æ®æ‰©å±•é—®é¢˜ï¼Œäº†è§£å¯¹åç«¯å¯è§‚å¯Ÿæ€§ç³»ç»Ÿçš„å½±å“éå¸¸é‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Stela Udovicicï¼šå½“å›¢é˜Ÿå¼€å§‹é‡‡ç”¨ Envoy å’Œå¾®æœåŠ¡æ—¶ï¼Œåœ¨é€‰æ‹©ä¸ Envoy ä¸€èµ·ä½¿ç”¨çš„å¹³å°æ—¶ï¼Œè€ƒè™‘åŸºæ•°é—®é¢˜æœ‰å¤šé‡è¦ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Matt Klein&lt;/strong&gt;ï¼šå¦‚æœåœ¨ä¸»æœºå¤ªå¤šçš„æƒ…å†µä¸‹å°è¯•å¯¹æ¯ä¸ªä¸»æœºè¿›è¡Œå¾ˆå¤šçš„åº¦é‡ï¼Œé‚£ä¹ˆä¸è€ƒè™‘åŸºæ•°æ–¹é¢å¯èƒ½ä¼šæˆä¸ºé—®é¢˜ã€‚å¦å¤–ï¼Œå¦‚æœæ‚¨æ­£åœ¨è¿›è¡ŒæœåŠ¡åº¦é‡å¹¶ä¸”æ‚¨ç°åœ¨æ‹¥æœ‰æ•°åƒç§æœåŠ¡ï¼Œå¹¶ä¸”æ‚¨æ­£åœ¨å°è¯•æ‰§è¡ŒåŒ…å«å¯èƒ½æ•°åƒç§ä¸åŒå†…å®¹çš„æŸ¥è¯¢ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¼šå‘ç°è¿™ä¼šæˆä¸ºé—®é¢˜ã€‚æœåŠ¡é‡ä»¥åŠæ‚¨æ˜¯å¦å°è¯•æ‰§è¡Œè®¸å¤šä»¥æ¯ä¸ªä¸»æœºä¸ºåŸºå‡†çš„æŒ‡æ ‡ï¼Œè¿™äº›æ˜¯æœ€å¸¸è§çš„å› ç´ ã€‚æ­¤å¤–ï¼Œå½“æ‚¨å…·æœ‰é«˜åº¦åŠ¨æ€çš„æ—¶åºå†…å®¹ï¼ˆå¦‚å®¹å™¨å®ä¾‹ IDï¼‰æ—¶ï¼ŒåŸºæ•°é—®é¢˜è‚¯å®šä¼šå½±å“å¯è§‚å¯Ÿæ€§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Stela Udovicicï¼šå¯¹äºé‚£äº›ä¸ Kubernetes ä¸€èµ·éƒ¨ç½² Envoy çš„äººæ¥è¯´ï¼Œæ‚¨å¯¹â€œæœ€ä½³å®è·µâ€çš„å»ºè®®æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Matt Klein&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„é—®é¢˜ã€‚å†æ¬¡ï¼Œå®ƒå½’ç»“ä¸ºæ§åˆ¶å¹³é¢ã€‚å› æ­¤ï¼Œåœ¨è¿™äº›é«˜åº¦åŠ¨æ€çš„ç¯å¢ƒä¸­ï¼Œæ‚¨æœ€ç»ˆä½¿ç”¨çš„æ§åˆ¶å¹³é¢ä¼šæœ€ç»ˆå½±å“å·¥ä½œçš„æœ€ç»ˆç»“æœã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨å°è¯•ä½¿ç”¨ Envoy ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨å¹¶ä¸”æ‚¨æƒ³è¦ä¸€ä¸ª Kubernetes å…¥å£æ§åˆ¶å™¨ï¼Œæ‚¨å¯ä»¥çœ‹çœ‹ Contourï¼Œæ‚¨å¯ä»¥å¯ä»¥çœ‹çœ‹ Datawire çš„ Ambassador â€”â€” æœ‰ä¸¤ç§ä¸åŒçš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœåŠ¡ç½‘ç»œæ–¹é¢ï¼Œæœ‰ Istioï¼Œä¹Ÿæœ‰äººå…³æ³¨åœ¨ Kubernetes ä¸Šè¿è¡Œçš„ Consul Connectï¼Œä»¥åŠå…¶ä»–å‡ ä¸ªè§£å†³æ–¹æ¡ˆã€‚æˆ‘çš„å»ºè®®æ˜¯é’ˆå¯¹å¤§å¤šæ•°äººæ¥è¯´ â€”â€” æˆ‘ä»¬ä»å¤„äºæ—©æœŸé˜¶æ®µï¼Œä½†å¯¹äºå¤§å¤šæ•°ä¼ä¸šæˆ–ä»Šå¤©å³å°†åˆ°æ¥çš„äººæ¥è¯´ï¼Œæˆ‘ä»¬å¯èƒ½å·²ç»èµ°å¾—è¶³å¤Ÿè¿œäº† â€”â€” å¯èƒ½ä¸å€¼å¾—æ¨åŠ¨ä»–ä»¬çš„æ§åˆ¶å¹³é¢è§£å†³æ–¹æ¡ˆã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å»ºè®®æŸ¥çœ‹å·²ç»å¼€å‘çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Stela Udovicicï¼šå¯¹äºé‚£äº›å¼€å§‹éƒ¨ç½² Envoy å¹¶å‘å±•å…¶å¾®æœåŠ¡ç¯å¢ƒçš„ä¼ä¸šï¼šå½“é€‰æ‹©ä¸€ä¸ªå¯è§‚å¯Ÿæ€§å¹³å°ä¸ Envoy ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œä»–ä»¬åº”è¯¥é€‰æ‹©å¼€æºè§£å†³æ–¹æ¡ˆè¿˜æ˜¯ä¾›åº”å•†ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Matt Klein&lt;/strong&gt;ï¼šæˆ‘è®¤ä¸ºæˆ‘çš„å»ºè®®å¯èƒ½æ˜¯å¤§å¤šæ•°äººä¸ä¾›åº”å•†åˆä½œã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œå°è¯•åœ¨å®¶é‡Œåšä¸€äº›å¯ä»¥ä¸ä¾›åº”å•†æä¾›çš„ä¸œè¥¿ç›¸åª²ç¾çš„ä¸œè¥¿æˆ–è®¸æ˜¯ä¸å¯èƒ½çš„ã€‚æˆ‘æƒ³ç°åœ¨ä¸€äº›ä¾›åº”å•†æ­£åœ¨æ„å»ºæ›´å…¨é¢çš„è§£å†³æ–¹æ¡ˆã€‚ä¸€äº›ä¾›åº”å•†ä¸€ç›´åœ¨ç§¯æç¡®ä¿ Envoy è¿ä½œè‰¯å¥½ã€‚æ­¤å¤–ï¼Œå®ƒä»¬è¿˜æä¾›æŒ‡æ ‡ï¼Œè·Ÿè¸ªç­‰ã€‚äº†è§£å¼€å‘äººå‘˜æƒ³è¦çš„åŠŸèƒ½ç±»å‹éå¸¸é‡è¦ã€‚ä»–ä»¬æƒ³è¦ä»€ä¹ˆç±»å‹çš„ç”¨æˆ·æ§ä»¶ï¼Œä»€ä¹ˆæ ·çš„ä»ªè¡¨æ¿ï¼Œè·Ÿè¸ªï¼Œå‘Šè­¦ â€”â€” å¹¶ä¸”å¯èƒ½ä»é‚£é‡ŒæŒ‘é€‰ä¾›åº”å•†ã€‚åœ¨è¿™æ–¹é¢ï¼Œæˆ‘ä¸èƒ½å»ºè®®äººä»¬ä½¿ç”¨è‡ªå·±çš„ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Stela Udovicicï¼šæ•´åˆ Kafka å’Œ Envoy ç°åœ¨æ˜¯ä»€ä¹ˆçŠ¶æ€ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Matt Klein&lt;/strong&gt;ï¼šæˆ‘ä»¬å¤„äºéå¸¸æ—©æœŸçš„é˜¶æ®µã€‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ª PR è¿˜æ˜¯å¼€å¯çš„ã€‚æˆ‘å¸Œæœ›ä¸€æ—¦åˆå¹¶ï¼Œæˆ‘ä»¬å°†ä¼šæœ‰è¿›ä¸€æ­¥çš„åŠ¨ä½œã€‚ä¸ç®¡æ€æ ·ï¼Œæˆ‘è®¤ä¸ºç°åœ¨å®ƒè¿˜å¤„äºèµ·æ­¥é˜¶æ®µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Stela Udovicicï¼šæ‚¨è®¤ä¸ºæ•´åˆ Kafka å¯¹ Envoy çš„ç”¨æˆ·æœ‰ä½•å½±å“ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Matt Klein&lt;/strong&gt;ï¼šæˆ‘è®¤ä¸ºè¿˜ä¸å¤ªæ¸…æ¥šã€‚æˆ‘è®¤ä¸ºäººä»¬æƒ³è¦ç”¨å®ƒåšå¾ˆå¤šäº‹æƒ…ã€‚ç›®å‰è¿˜ä¸å®Œå…¨æ¸…æ¥šä»€ä¹ˆæ‰æ˜¯é“¶å¼¹ã€‚æˆ‘è®¤ä¸ºæœ€åˆå¯èƒ½æ˜¯å›´ç»•ç»Ÿè®¡æ•°æ®ã€‚å› æ­¤ï¼Œä»å¯è§‚å¯Ÿæ€§å¼€å§‹ï¼Œç„¶åå¯èƒ½è¿›å…¥è´Ÿè½½å‡è¡¡æˆ–å®¢æˆ·ç«¯æ›¿æ¢æˆ–å‡çº§æˆ–é‚£äº›ç±»å‹çš„äº‹æƒ…ã€‚ä¸è¿‡ï¼Œæˆ‘è®¤ä¸ºæˆ‘ä»¬å¯èƒ½ä¼šä»å¯è§‚å¯Ÿæ€§å¼€å§‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Stela Udovicicï¼šæ‚¨ä»Šå¤©ä½¿ç”¨å“ªäº›æ‚¨å¼€å§‹æ²¡æœ‰çš„å·¥å…·æ¥å®Œæˆ Lyft æœåŠ¡ç½‘æ ¼çš„å·¥ä½œï¼ŒIstio æ˜¯ä¸€ä¸ªä¾‹å­å—ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Matt Klein&lt;/strong&gt;ï¼šæ˜¯çš„ï¼Œæˆ‘çš„æ„æ€æ˜¯ï¼Œè¿™å°±æ˜¯æˆ‘è®¤ä¸º Lyft çš„æƒ…å†µå¯èƒ½ä¸æ˜¯ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œç”šè‡³ä¸ä¸€å®šè¦è€ƒè™‘ã€‚å› ä¸ºæˆ‘ä»¬å¼€å‘äº† Envoyï¼Œæ‰€ä»¥æˆ‘ä»¬å¼€å‘äº†è®¸å¤šä¸€æ¬¡æ€§å·¥å…·ã€‚é‚£ä¸æ˜¯é€šç”¨ç³»ç»Ÿã€‚æˆ‘çš„æ„æ€æ˜¯å®ƒä¸ Lyft éå¸¸ç›¸å…³ã€‚æ‰€ä»¥æˆ‘è®¤ä¸ºæˆ‘ä»¬è¿˜å¤„äºæœåŠ¡ç½‘æ ¼çš„æ—©æœŸé˜¶æ®µï¼Œäº§å“ä»ç„¶å¾ˆéš¾ä½¿ç”¨ã€‚ç›®å‰è¿˜æ²¡æœ‰ä¸€ä¸ªæ€æ‰‹çº§çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ç¡®å®è®¤ä¸ºå¾ˆå¤šå…¬å¸å’Œç»„ç»‡åœ¨è¿™ä¸ªé¢†åŸŸéƒ½åœ¨è¿…é€Ÿè¿­ä»£ã€‚å°±åƒæˆ‘ä»¬å·²ç»è°ˆè¿‡çš„é‚£æ ·ï¼Œä¾‹å¦‚ AWS ä¸Šçš„ App Meshï¼Œæˆ– Istio å¼€æºé¡¹ç›®ï¼Œæˆ– Consul Connectï¼Œæˆ–æ¥è‡ª Solo.io çš„ Glooï¼Œæˆ– Ciliumã€‚ä»–ä»¬æœ‰å¾ˆå¤šï¼Œä¹Ÿæœ‰åˆ›ä¸šå…¬å¸ã€‚æ‰€ä»¥æˆ‘è®¤ä¸ºåœ¨æ¥ä¸‹æ¥çš„å‡ å¹´é‡Œä¼šæœ‰å¾ˆå¤šç«äº‰ã€‚åœ¨é‚£ä¸ªé¢†åŸŸä¼šæœ‰ä¸€äº›èµ¢å®¶å’Œä¸€äº›è¾“å®¶ã€‚&lt;/p&gt;
&lt;p&gt;ä¸å¹¸çš„æ˜¯ï¼Œå¯¹äºæˆ‘å‘äººä»¬æ¨èçš„å†…å®¹ï¼Œç°åœ¨æ²¡æœ‰å”¯ä¸€ç­”æ¡ˆã€‚ç„¶è€Œï¼Œæˆ‘å»ºè®®äººä»¬ä¿æŒå¼€æ”¾çš„å¿ƒæ€ï¼Œçœ‹çœ‹ä¸åŒçš„é€‰æ‹©ï¼Œå¹¶ä¸”å¯èƒ½ä¸ä¼šå‘æŒ¥è‡ªå·±çš„ä½œç”¨ã€‚é™¤éä»–ä»¬çš„å·¥ç¨‹ç»„ç»‡å…·æœ‰è¶³å¤Ÿçš„è§„æ¨¡å’Œå¤æ‚æ€§ï¼Œä»–ä»¬ä¹Ÿè®¸å¯ä»¥å®ç°è¿™ä¸€ç›®æ ‡ã€‚æˆ‘ä»¬ç¡®å®çœ‹åˆ°å¾ˆå¤šç»„ç»‡éƒ½åœ¨è‡ªå·±æˆé•¿ï¼Œä½†è¿™äº›ç»„ç»‡å¾€å¾€æ˜¯è§„æ¨¡è¦å¤§å¾—å¤šçš„å·¥ç¨‹ç»„ç»‡ï¼Œæˆ‘æƒ³è¯´ï¼Œä¸å…¸å‹çš„ä¼ä¸šä¸åŒï¼Œè¿™äº›ç»„ç»‡æ‹¥æœ‰æ›´å¤šçš„æŠ€æœ¯äººæ‰ã€‚å› æ­¤ï¼Œæˆ‘é¼“åŠ±å…¸å‹çš„ä¼ä¸šæ›´å¤šåœ°å¯»æ‰¾ä¾›åº”å•†è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Stela Udovicicï¼šè°¢è°¢æ‚¨ï¼Œé©¬ç‰¹ï¼Œè°¢è°¢èŠ±æ—¶é—´åˆ†äº«æ‚¨çš„æŒ‡å¯¼å’Œä¸°å¯Œçš„çŸ¥è¯†ã€‚&lt;/strong&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä¸º Envoy æ„å»ºæ§åˆ¶é¢æŒ‡å—ç¬¬ 4 éƒ¨åˆ†ï¼šæ„å»ºçš„å¯æ‰©å±•æ€§</title>
      <link>https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/</link>
      <pubDate>Mon, 22 Apr 2019 10:41:16 +0800</pubDate>
      <guid>https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://medium.com/solo-io/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility-40f8ac8e48e&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼–è€…æŒ‰&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•ä¸º Envoy æ„å»ºæ§åˆ¶é¢æŒ‡å—çš„ç¬¬ 4 éƒ¨åˆ†ï¼šæ„å»ºçš„å¯æ‰©å±•æ€§ã€‚Gloo å›¢é˜Ÿå»ºè®®å°†é‡ç‚¹æ”¾åœ¨æ§åˆ¶å¹³é¢çš„ç®€å•æ ¸å¿ƒä¸Šï¼Œç„¶åé€šè¿‡æ’ä»¶å’Œå¾®æœåŠ¡æ§åˆ¶å™¨çš„å¯ç»„åˆæ€§æ‰©å±•å®ƒã€‚Gloo çš„ä½“ç³»ç»“æ„æ˜¯è¿™æ ·æ„å»ºçš„ï¼Œå®ƒä½¿ Gloo å›¢é˜Ÿèƒ½å¤Ÿå¿«é€Ÿæ·»åŠ ä»»ä½•æ–°ç‰¹æ€§ï¼Œä»¥æ”¯æŒä»»ä½•å¹³å°ã€é…ç½®ã€è¿‡æ»¤å™¨ï¼Œä»¥åŠæ›´å¤šçš„æ–°ç‰¹æ€§ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œå°½ç®¡ Gloo æ˜¯éå¸¸ kubernets åŸç”Ÿçš„ï¼Œä½†å®ƒæ˜¯ä¸ºåœ¨ä»»ä½•äº‘ä¸Šçš„ä»»ä½•å¹³å°ä¸Šè¿è¡Œè€Œæ„å»ºçš„ã€‚æ ¸å¿ƒæ§åˆ¶å¹³é¢çš„è®¾è®¡å…è®¸è¿™æ ·åšã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æ˜¯æ¢ç©¶ä¸º Envoy ä»£ç†æ„å»ºæ§åˆ¶å¹³é¢ç³»åˆ—æ–‡ç« çš„ç¬¬ 4 éƒ¨åˆ†ã€‚è¯·å…³æ³¨&lt;a href=&#34;https://twitter.com/christianposta&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@christianposta&lt;/a&gt;å’Œ&lt;a href=&#34;https://twitter.com/soloio_inc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@soloio_inc&lt;/a&gt;å°†åœ¨ä¸€å‘¨å†…æ¨å‡ºä¸‹ä¸€éƒ¨åˆ†å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬ç³»åˆ—åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†å…³æ³¨ä»¥ä¸‹é¢†åŸŸï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/solo-io/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh-badb6c36a2af&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é‡‡ç”¨ä¸€ç§æœºåˆ¶æ¥åŠ¨æ€æ›´æ–° Envoy çš„è·¯ç”±ã€æœåŠ¡å‘ç°å’Œå…¶ä»–é…ç½®&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/solo-io/guidance-for-building-a-control-plane-for-envoy-proxy-part-2-identify-components-2d0731b0d8a4&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¡®å®šæ§åˆ¶å¹³é¢ç”±å“ªäº›ç»„ä»¶ç»„æˆï¼ŒåŒ…æ‹¬æ”¯æŒå­˜å‚¨ã€æœåŠ¡å‘ç° APIã€å®‰å…¨ç»„ä»¶ç­‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;./Guidance-for-Building-a-Control-Plane-for-Envoy-Part-3-Domain-Specific-Configuration.md&#34;&gt;å»ºç«‹æœ€é€‚åˆæ‚¨çš„ä½¿ç”¨åœºæ™¯å’Œç»„ç»‡æ¶æ„çš„ç‰¹å®šäºåŸŸçš„é…ç½®å¯¹è±¡å’Œ API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;è€ƒè™‘å¦‚ä½•è®©æ§åˆ¶å¹³é¢æ”¯æŒå¯æ‹”æ’ (æœ¬åšå®¢)&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²å„ç§æ§åˆ¶å¹³é¢ç»„ä»¶çš„é€‰é¡¹&lt;/li&gt;
&lt;li&gt;ä¸ºä½ çš„æ§åˆ¶å¹³é¢è€ƒè™‘æµ‹è¯•å¥—ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;./Guidance-for-Building-a-Control-Plane-for-Envoy-Part-3-Domain-Specific-Configuration.md&#34;&gt;ä¸Šä¸€ç¯‡æ–‡ç« &lt;/a&gt;ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†ä¸ºæ‚¨çš„æ§åˆ¶å¹³é¢æ„å»ºä¸€ä¸ªç‰¹å®šäºé¢†åŸŸçš„ APIï¼Œä½¿å¾—è¯¥ API æœ€é€‚åˆæ‚¨çš„ç»„ç»‡å’Œå·¥ä½œæµå¹¶æ»¡è¶³é¦–é€‰æ¡ä»¶/çº¦æŸã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ„å»ºå¯æ’æ‹”çš„æ§åˆ¶å¹³é¢å¼•æ“&#34;&gt;æ„å»ºå¯æ’æ‹”çš„æ§åˆ¶å¹³é¢å¼•æ“&lt;/h2&gt;
&lt;p&gt;Envoy æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„è½¯ä»¶ï¼Œæ¯å¤©éƒ½æœ‰&lt;a href=&#34;https://github.com/envoyproxy/envoy/pull/4950&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–°çš„ç”¨ä¾‹å’Œè´¡çŒ®è¢«æäº¤ç»™ç¤¾åŒº&lt;/a&gt;ã€‚å°½ç®¡ Envoy çš„æ ¸å¿ƒéå¸¸ç¨³å®šï¼Œä½†å®ƒå»ºç«‹åœ¨&lt;a href=&#34;https://github.com/envoyproxy/envoy-filter-example&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯æ’æ‹”çš„è¿‡æ»¤å™¨æ¶æ„&lt;/a&gt;ä¹‹ä¸Šï¼Œå› æ­¤äººä»¬å¯ä»¥ä¸ºä¸åŒçš„ L7 åè®®ç¼–å†™æ–°çš„ç¼–è§£ç å™¨æˆ–æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚ç›®å‰ï¼ŒEnvoy è¿‡æ»¤å™¨æ˜¯ç”¨ C++ç¼–å†™çš„ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http_filters/lua_filter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Lua&lt;/a&gt;æ‰©å±• Envoyï¼Œä½†æ˜¯ä¹Ÿæœ‰&lt;a href=&#34;https://github.com/envoyproxy/envoy/issues/4272&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€äº›è®¨è®ºæ”¯æŒ Web Assembly å®ç°&lt;/a&gt;å¯æ‰©å±•æ€§ã€‚åŒæ ·å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ&lt;a href=&#34;https://cilium.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cilium&lt;/a&gt;ç¤¾åŒºçš„å¾ˆå¤šäººæ­£åœ¨å›´ç»•ä¸€ä¸ª&lt;a href=&#34;https://cilium.io/blog/2018/10/23/cilium-13-envoy-go/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸºäº Go çš„ Envoy å¯æ‰©å±•æœºåˆ¶&lt;/a&gt;å¼€å±•å·¥ä½œã€‚ä¼´éšç€ Envoy ç¤¾åŒºçš„å¿«é€Ÿå‘å±•å’Œéœ€è¦é…ç½®è¿™äº›æ–°åŠŸèƒ½ï¼Œè¿˜éœ€è¦æ–°çš„ç‰¹å®šäºé¢†åŸŸçš„å¯¹è±¡æ¨¡å‹æ¥æ”¯æŒæƒ³åˆ©ç”¨ Envoy æ–°å¹³å°çš„éœ€æ±‚ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢æ²¿ç€è¿™ä¸¤ä¸ªç»´åº¦æ‰©å±• Envoy æ§åˆ¶å¹³é¢ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ç¼–å†™ C++è¿‡æ»¤å™¨ï¼Œæ‰©å±• Envoy éå¸¸ç®€å•ã€‚æˆ‘ä»¬åœ¨&lt;a href=&#34;https://github.com/solo-io/envoy-gloo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo é¡¹ç›®&lt;/a&gt;ä¸Šåˆ›å»ºçš„ Envoy è¿‡æ»¤å™¨åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/solo-io/squash&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Squash&lt;/a&gt;è°ƒè¯•å™¨
(&lt;a href=&#34;https://github.com/envoyproxy/envoy/tree/master/api/envoy/config/filter/http/squash&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/envoyproxy/envoy/tree/master/api/envoy/config/filter/http/squash&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Caching(ç›®å‰ä¸ºå°é—­æºç ;åº”è¯¥åœ¨ä¸ä¹…çš„å°†æ¥å¼€æ”¾æºä»£ç )&lt;/li&gt;
&lt;li&gt;Request/Response ä¼ è¾“ (&lt;a href=&#34;https://github.com/solo-io/envoy-gloo/tree/master/source/extensions/filters/http/transformation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/solo-io/envoy-gloo/tree/master/source/extensions/filters/http/transformation&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;AWS lambda (&lt;a href=&#34;https://github.com/solo-io/envoy-gloo/tree/master/source/extensions/filters/http/aws_lambda&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/solo-io/envoy-gloo/tree/master/source/extensions/filters/http/aws_lambda&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;NATS streaming (&lt;a href=&#34;https://github.com/solo-io/envoy-nats-streaming&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/solo-io/envoy-nats-streaming&lt;/a&gt;, &lt;a href=&#34;https://github.com/solo-io/envoy-gloo/tree/master/source/extensions/filters/http/nats/streaming&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/solo-io/envoy-gloo/tree/master/source/extensions/filters/http/nats/streaming&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Google Cloud Functions (&lt;a href=&#34;https://github.com/solo-io/envoy-google-function&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/solo-io/envoy-google-function&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Azure function (&lt;a href=&#34;https://github.com/solo-io/envoy-azure-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/solo-io/envoy-azure-functions&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34;
           src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLgy1g202enyhmsg30q10iajsu.gif&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„å›¾ç¤ºä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°è¯·æ±‚æ˜¯å¦‚æœé€šè¿‡ Envoy å¹¶ç»è¿‡ä¸€äº›è¿‡æ»¤å™¨çš„ï¼Œè¿™äº›è¿‡æ»¤å™¨å…·æœ‰åº”ç”¨äºè¯·æ±‚å’Œå“åº”çš„ç‰¹å®šä»»åŠ¡ã€‚ä½ å¯ä»¥åœ¨&lt;a href=&#34;https://www.solo.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Solo.io&lt;/a&gt;é¦–å¸­æ‰§è¡Œå®˜/åˆ›å§‹äºº&lt;a href=&#34;https://medium.com/@idit.levine_92620&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Idit Levine&lt;/a&gt;å’Œ Solo.io é¦–å¸­æ¶æ„å¸ˆ&lt;a href=&#34;https://medium.com/@yuval.kohavi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Yuval Kohavi&lt;/a&gt;å†™çš„ä¸€ç¯‡åšå®¢æ–‡ç« ä¸­è¯»åˆ°æ›´å¤šå…³äº&lt;a href=&#34;https://medium.com/solo-io/building-a-control-plane-for-envoy-7524ceb09876&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy çš„åŠŸèƒ½å’Œæ„å»º Gloo çš„æ§åˆ¶å¹³é¢æ‰€åšçš„æƒè¡¡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸º Envoy åŠŸèƒ½éå¸¸å¤šï¼Œè€Œä¸”ä¸€ç›´åœ¨æ·»åŠ æ–°ç‰¹æ€§ï¼Œæ‰€ä»¥å€¼å¾—èŠ±ä¸€äº›æ—¶é—´æ¥è€ƒè™‘æ˜¯å¦è¦å°†æ§åˆ¶å¹³é¢æ„å»ºä¸ºå¯æ‰©å±•çš„ï¼Œä»¥ä¾¿èƒ½å¤Ÿä½¿ç”¨è¿™äº›æ–°ç‰¹æ€§ã€‚åœ¨ Gloo é¡¹ç›®ä¸­ï¼Œé€‰æ‹©åœ¨ä»¥ä¸‹å‡ ä¸ªå±‚æ¬¡ä¸Šè¿›è¡Œæ‰©å±•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æ ¸å¿ƒ Gloo é…ç½®å¯¹è±¡çš„åŸºç¡€ä¸Šæ„å»ºæ›´å®¹æ˜“è¿›è¡Œè‡ªå®šä¹‰ç‰¹å®šåŸŸçš„é…ç½®å¯¹è±¡&lt;/li&gt;
&lt;li&gt;æ§åˆ¶å¹³é¢æ’ä»¶åŒ–ä»¥å¢å¼ºæ§åˆ¶å¹³é¢çš„ç°æœ‰è¡Œä¸º&lt;/li&gt;
&lt;li&gt;åˆ›å»ºå·¥å…·æ¥åŠ é€Ÿå‰é¢ä¸¤ç‚¹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ¯ä¸€ä¸ªå±‚æ¬¡ï¼Œä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•æ„å»ºå¯æ‰©å±•å’Œçµæ´»çš„æ§åˆ¶å¹³é¢çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ ¸å¿ƒ-api-å¯¹è±¡æ„å»ºæ—¶è¦è€ƒè™‘çµæ´»æ€§&#34;&gt;æ ¸å¿ƒ API å¯¹è±¡ï¼Œæ„å»ºæ—¶è¦è€ƒè™‘çµæ´»æ€§&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹è®¨è®ºäº†ç”¨äºé…ç½®æ§åˆ¶å¹³é¢çš„ç‰¹å®šäºåŸŸçš„é…ç½®å¯¹è±¡ã€‚åœ¨ Gloo ä¸­ï¼Œæˆ‘ä»¬æœ‰&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gloo/api/v1/proxy.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ€ä½çº§åˆ«çš„é…ç½®å¯¹è±¡&lt;/a&gt;ï¼Œç§°ä¸º&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gloo/api/v1/proxy.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Proxy&lt;/a&gt;å’Œ&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gloo/api/v1/upstream.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Upstream&lt;/a&gt;ã€‚&lt;code&gt;Proxy&lt;/code&gt;å®šä¹‰äº†æˆ‘ä»¬å¯ä»¥å¯¹åº•å±‚ä»£ç† (åœ¨æœ¬ä¾‹ä¸­æ˜¯ Envoy) è¿›è¡Œçš„æœ€ä½çº§åˆ«é…ç½®ã€‚ä½¿ç”¨&lt;code&gt;Proxy&lt;/code&gt;å¯¹è±¡ï¼Œæˆ‘ä»¬å®šä¹‰è¯·æ±‚å¦‚ä½•è·¯ç”±åˆ°&lt;code&gt;Upstream&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ Proxy å¯¹è±¡çš„ä¸€ä¸ªä¾‹å­ (åœ¨ Kubernetes ä¸­æ˜¯ CRD)ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gloo.solo.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusterName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;creationTimestamp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2019-02-15T13:27:39Z&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;generation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;created_by&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway-proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gloo-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;5209108&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selfLink&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/apis/gloo.solo.io/v1/namespaces/gloo-system/proxies/gateway-proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;uid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;771377f2-3125-11e9-8523-42010aa800e0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;bindAddress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;::&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;bindPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;httpListener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtualHosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gloo-system.default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;matcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/petstore/findPet&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routeAction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;single&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;destinationSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;functionName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;findPetById&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;upstream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default-petstore-8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gloo-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;matcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/sample-route-1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routeAction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;single&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;upstream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default-petstore-8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gloo-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routePlugins&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefixRewrite&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefixRewrite&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/api/pets&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;reported_by&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gloo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‚¨å¯ä»¥çœ‹åˆ°&lt;code&gt;Proxy&lt;/code&gt;å¯¹è±¡æŒ‡å®šç›‘å¬å™¨ã€ç±»å‹ä»¥åŠè·¯ç”±ä¿¡æ¯ã€‚å¦‚æœæ‚¨ä»”ç»†è§‚å¯Ÿï¼Œæ‚¨ä¼šå‘ç°å®ƒåœ¨ä¸€å®šç¨‹åº¦ä¸Šéµå¾ª Envoy çš„é…ç½®ï¼Œä½†åœ¨æ”¯æŒé™„åŠ åŠŸèƒ½æ–¹é¢æœ‰æ‰€ä¸åŒã€‚åœ¨è·¯ç”±ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°è¯·æ±‚è¢«å‘é€åˆ°â€œUpstreamâ€ã€‚Gloo çŸ¥é“å¦‚ä½•è·¯ç”±åˆ°&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gloo/api/v1/upstream.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Upstream&lt;/a&gt;ï¼Œæ‚¨å¯ä»¥åœ¨ä¸Šé¢çš„&lt;code&gt;Proxy&lt;/code&gt;å¯¹è±¡ä¸­çœ‹åˆ°è¿™äº›å®šä¹‰ã€‚&lt;code&gt;Proxy&lt;/code&gt;å¯¹è±¡æ˜¯ç”± Gloo çš„æ§åˆ¶å¹³é¢è½¬æ¢ä¸º Envoy xDS API çš„å¯¹è±¡ã€‚æ‚¨ä¼šçœ‹åˆ°å¦‚ä¸‹çš„ Gloo çš„ç»„ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                             READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;discovery-676bcc49f8-n55jt       1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          8m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gateway-d8598c78c-425hz          1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          8m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gateway-proxy-6b4b86b4fb-cm2cr   1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          8m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gloo-565659747c-x7lvf            1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          8m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;gateway-proxy&lt;/code&gt;ç»„ä»¶æ˜¯ Envoy ä»£ç†ã€‚æ§åˆ¶å¹³é¢ç”±ä»¥ä¸‹ç»„ä»¶ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;gateway&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;discovery&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;gloo&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è´Ÿè´£æ­¤&lt;code&gt;Proxy&lt;/code&gt;-&amp;gt;Envoy xDS è½¬æ¢çš„ç»„ä»¶æ˜¯&lt;code&gt;gloo&lt;/code&gt;ï¼Œå®ƒæ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ç»„ä»¶ï¼Œé€šè¿‡å°†&lt;code&gt;Proxy&lt;/code&gt;å¯¹è±¡è½¬æ¢ä¸ºEnvoyçš„LDS/RDS/CDS/EDS APIï¼Œè´Ÿè´£æ ¸å¿ƒ xDS æœåŠ¡å’Œè‡ªå®šä¹‰ Envoy è¿‡æ»¤å™¨çš„é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g222c27h5dj30ht06174i_hub1191896ce95597f775b040ddb264591_15887_44f3d929c6393f33feb13b76bd91194b.webp 400w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g222c27h5dj30ht06174i_hub1191896ce95597f775b040ddb264591_15887_18d97dc83c1e97a3f70ea087d0fde104.webp 760w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g222c27h5dj30ht06174i_hub1191896ce95597f775b040ddb264591_15887_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g222c27h5dj30ht06174i_hub1191896ce95597f775b040ddb264591_15887_44f3d929c6393f33feb13b76bd91194b.webp&#34;
               width=&#34;641&#34;
               height=&#34;217&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Gloo çŸ¥é“å¦‚ä½•è·¯ç”±åˆ°&lt;code&gt;Upstream&lt;/code&gt;å’Œå®ƒä¸Šé¢çš„å‡½æ•°ã€‚&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gloo/api/v1/upstream.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Upstream&lt;/a&gt;ä¹Ÿæ˜¯ Gloo çš„æ ¸å¿ƒé…ç½®å¯¹è±¡ã€‚æˆ‘ä»¬éœ€è¦è¿™ä¸ª&lt;code&gt;Upstream&lt;/code&gt;å¯¹è±¡çš„åŸå› æ˜¯ï¼Œå®ƒå°è£…äº†ä¸Šæ¸¸é›†ç¾¤åŠŸèƒ½çš„æ›´å¤šå®ç°ï¼Œè€Œä¸æ˜¯ Envoy æ‰€çŸ¥é“çš„å¼€ç®±å³ç”¨çš„åŠŸèƒ½ã€‚Envoy çŸ¥é“â€œé›†ç¾¤â€ï¼Œä½†æ˜¯ Gloo(ä½äº Envoy ä¹‹ä¸Š) çŸ¥é“å…¶ä¸Šçš„å‡½æ•°ã€‚æ­¤åŠŸèƒ½æ”¯æŒ&lt;a href=&#34;https://medium.com/solo-io/announcing-gloo-the-function-gateway-3f0860ef6600&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠŸèƒ½çº§è·¯ç”±&lt;/a&gt;ï¼ŒåŠŸèƒ½çº§è·¯ç”±æ˜¯ç”¨äºç»„åˆæ–°åº”ç”¨ç¨‹åºå’Œ API çš„æ›´å¼ºå¤§çš„è·¯ç”±ç»“æ„ã€‚Envoy ä»â€œhost:portâ€ç«¯ç‚¹æ–¹é¢äº†è§£é›†ç¾¤ï¼Œä½†æ˜¯ä½¿ç”¨ Glooï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºè¿™äº›é›†ç¾¤é™„åŠ é¢å¤–çš„ä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿å®ƒä»¬ç†è§£â€œå‡½æ•°â€ï¼Œè¿™äº›å‡½æ•°å¯ä»¥æ˜¯ REST æ–¹æ³•/è·¯å¾„ã€gRPC æ“ä½œæˆ– Lambda ä¹‹ç±»çš„äº‘å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªåä¸º&lt;code&gt;default-petstore-8080&lt;/code&gt;çš„ Gloo ä¸Šæ¸¸ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;discoveryMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;discovered_by&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetesplugin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;petstore&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sevice&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;petstore&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default-petstore-8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gloo-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;reportedBy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gloo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Accepted&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;upstreamSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kube&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;petstore&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;petstore&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;swaggerInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http://petstore.default.svc.cluster.local:8080/swagger.json&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;transformations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;addPet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;id&amp;#34;: {{ default(id, &amp;#34;&amp;#34;) }},&amp;#34;name&amp;#34;: &amp;#34;{{ default(name, &amp;#34;&amp;#34;)}}&amp;#34;,&amp;#34;tag&amp;#34;:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;                &amp;#34;{{ default(tag, &amp;#34;&amp;#34;)}}&amp;#34;}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;:method&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;POST&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;:path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/api/pets&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;content-type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application/json&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;deletePet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;:method&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DELETE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;:path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/api/pets/{{ default(id, &amp;#34;&amp;#34;) }}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;content-type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application/json&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;findPetById&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;:method&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;GET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;:path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/api/pets/{{ default(id, &amp;#34;&amp;#34;) }}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;content-length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;content-type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;transfer-encoding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;findPets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;:method&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;GET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;:path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/api/pets?tags={{default(tags, &amp;#34;&amp;#34;)}}&amp;amp;limit={{default(limit,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;)}}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;content-length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;content-type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;transfer-encoding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„ï¼Œæˆ‘ä»¬æœ‰æ›´å¤šè´£ä»»æ¥ç¡®å®š upstream çš„å‡½æ•°è¦å…¬å¼€å“ªäº›éƒ¨åˆ†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸Šæ¸¸æ°å¥½æ˜¯ä¸€ä¸ª REST æœåŠ¡ï¼Œå®ƒå…¬å¼€äº†ä¸€ä¸ª&lt;a href=&#34;https://github.com/OAI/OpenAPI-Specification&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Open API Spec/Swagger&lt;/a&gt;æ–‡æ¡£ã€‚Gloo è‡ªåŠ¨å‘ç°è¿™äº›ä¿¡æ¯ï¼Œå¹¶ç”¨è¿™äº›ä¿¡æ¯ä¸°å¯Œè¿™ä¸ª Upstream å¯¹è±¡ï¼Œç„¶åå¯ä»¥åœ¨ä»£ç†å¯¹è±¡ä¸­ä½¿ç”¨è¿™äº›ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g222ij2oucj30ht0ep0ti_hu68b1aa09e08641da09fe859d5ab7a9eb_28646_9e19cab558025300bf2a4bf4ac15a29d.webp 400w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g222ij2oucj30ht0ep0ti_hu68b1aa09e08641da09fe859d5ab7a9eb_28646_a6e765806af67451ca48841440bbcb76.webp 760w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g222ij2oucj30ht0ep0ti_hu68b1aa09e08641da09fe859d5ab7a9eb_28646_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g222ij2oucj30ht0ep0ti_hu68b1aa09e08641da09fe859d5ab7a9eb_28646_9e19cab558025300bf2a4bf4ac15a29d.webp&#34;
               width=&#34;641&#34;
               height=&#34;529&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›åˆ° Gloo æ§åˆ¶å¹³é¢çš„ç»„ä»¶ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ª&lt;code&gt;discovery&lt;/code&gt;ç»„ä»¶ï¼Œå®ƒé€šè¿‡æ·»åŠ â€œUpstream Discovery Serviceâ€(UDS) å’Œâ€œFunction Discovery Serviceâ€(FDS) æ¥å¢å¼º Envoy çš„æœåŠ¡å‘ç° APIã€‚UDS ä½¿ç”¨ä¸€ç»„æ’ä»¶ (å‚è§ä¸‹ä¸€èŠ‚) è‡ªåŠ¨åœ°ä»å„è‡ªçš„è¿è¡Œæ—¶ç›®å½•ä¸­å‘ç°&lt;code&gt;Upstream&lt;/code&gt;ã€‚æœ€ç®€å•çš„ä¾‹å­æ˜¯åœ¨ Kubernetes ä¸­è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªåŠ¨å‘ç°&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/service/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Services&lt;/a&gt;ã€‚Gloo è¿˜å¯ä»¥å‘ç°æ¥è‡ª Consulã€AWS å’Œ&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gloo/api/v1/plugins.proto.sk/#a-name-upstreamspec-upstreamspec-a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¶ä»–&lt;/a&gt;çš„&lt;code&gt;Upstream&lt;/code&gt;ã€‚å‡½æ•°å‘ç°æœåŠ¡ (FDS) è¯„ä¼°å·²ç»å‘ç°çš„æ¯ä¸ª&lt;code&gt;Upstream&lt;/code&gt;ï¼Œå¹¶å°è¯•å‘ç°å®ƒä»¬çš„ç±»å‹ (RESTã€gRPCã€GraphQLã€AWS Lambda ç­‰)ã€‚å¦‚æœ FDS èƒ½å¤Ÿå‘ç°å…³äºä¸Šæ¸¸çš„è¿™äº›é™„åŠ å±æ€§ï¼Œå®ƒå°±ä¼šç”¨è¿™äº›â€œå‡½æ•°â€ä¸°å¯Œ upstream å…ƒæ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;Gloo æ§åˆ¶å¹³é¢ä¸­çš„&lt;code&gt;discovery&lt;/code&gt;ç»„ä»¶ä»…ä½¿ç”¨å…¶ UDS å’Œ FDS æœåŠ¡æ¥å‘ç°&lt;code&gt;Upstream&lt;/code&gt;å¯¹è±¡å¹¶å°†å…¶å†™å…¥ Kuberentes CRDsã€‚ä»è¿™é‡Œï¼Œç”¨æˆ·å¯ä»¥åˆ›å»ºä» Envoy ä»£ç†ä¸Šçš„ç‰¹å®š API è·¯å¾„åˆ°&lt;code&gt;Upstream&lt;/code&gt;ä¸Šçš„ç‰¹å®šå‡½æ•°çš„è·¯ç”±è§„åˆ™ã€‚Envoy ä»£ç†ä¸ç›´æ¥ä¸è¿™ä¸ªæ§åˆ¶å¹³é¢ç»„ä»¶äº¤äº’ (è¯·å›å¿†ä¸€ä¸‹ï¼ŒEnvoy åªä½¿ç”¨&lt;code&gt;gloo&lt;/code&gt;ç»„ä»¶å…¬å¼€çš„ xDS API)ã€‚ç›¸åï¼Œ&lt;code&gt;discovery&lt;/code&gt;ç»„ä»¶ä¿ƒè¿›äº†å‘&lt;code&gt;Upstream&lt;/code&gt;çš„åˆ›å»ºï¼Œç„¶åå¯ä»¥ç”±&lt;code&gt;Proxy&lt;/code&gt;å¯¹è±¡ä½¿ç”¨ã€‚è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨æ”¯æŒå¾®æœåŠ¡ (æœ¬ä¾‹ä¸­çš„&lt;code&gt;discovery&lt;/code&gt;æœåŠ¡) æ¥ä¸ºæ§åˆ¶å¹³é¢çš„æ•´ä½“åŠŸèƒ½åšå‡ºè´¡çŒ®çš„å¥½ä¾‹å­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Proxy&lt;/code&gt;å’Œ&lt;code&gt;Upstream&lt;/code&gt;æ˜¯ä¸Šä¸€èŠ‚ä¸­æåˆ°çš„è¾ƒåº•å±‚ç‰¹å®šäºåŸŸçš„é…ç½®å¯¹è±¡ã€‚æ›´æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘ä»¬å¦‚ä½•åœ¨æ­¤ä¹‹ä¸Šåˆ†å±‚ä¸€ç»„é…ç½®å¯¹è±¡ï¼Œä»¥æ»¡è¶³å…·æœ‰æ›´è‡ªå®šä¹‰å·¥ä½œæµçš„ç”¨æˆ·ç‰¹å®šç”¨ä¾‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ‰©å±•ç‰¹å®šäºåŸŸçš„é…ç½®å±‚&#34;&gt;æ‰©å±•ç‰¹å®šäºåŸŸçš„é…ç½®å±‚&lt;/h2&gt;
&lt;p&gt;åœ¨ Gloo çš„æ§åˆ¶å¹³é¢ä¸­ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªç»„ä»¶ç§°ä¸º&lt;code&gt;gateway&lt;/code&gt;ã€‚è¯¥ç»„ä»¶å®ç°æ›´é«˜çº§åˆ«çš„ç‰¹å®šäºåŸŸçš„é…ç½®ï¼Œç”¨æˆ·æœ€ç»ˆå°†ä¸ä¹‹äº¤äº’ (ç›´æ¥é€šè¿‡ YAML æ–‡ä»¶æˆ–é€šè¿‡&lt;code&gt;glooctl&lt;/code&gt; CLI å·¥å…·é—´æ¥åœ°äº¤äº’)ã€‚&lt;code&gt;gateway&lt;/code&gt;ç»„ä»¶æ¶‰åŠä¸¤ä¸ªç‰¹å®šäºåŸŸçš„å¯¹è±¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gateway/api/v1/gateway.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway&lt;/a&gt;â€Šâ€” æŒ‡å®šç‰¹å®šç›‘å¬å™¨ç«¯å£ä¸Šå¯ç”¨çš„è·¯ç”±å’Œ API ç«¯ç‚¹ï¼Œä»¥åŠæ¯ä¸ª API çš„å®‰å…¨æ€§&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gateway/api/v1/virtual_service.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VirtualService&lt;/a&gt;â€Šâ€”â€Šå°† API è·¯ç”±åˆ†ç»„åˆ°ä¸€ç»„â€œè™šæ‹Ÿ APIâ€ä¸­ï¼Œè¿™äº›â€œè™šæ‹Ÿ APIâ€å¯ä»¥è·¯ç”±åˆ°æ”¯æŒçš„å‡½æ•° (gRPCã€http/1ã€http/2ã€lambda ç­‰)ï¼›è®©å¼€å‘äººå‘˜æ§åˆ¶è·¯ç”±å¦‚ä½•å¤„ç†&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gloo/api/v1/plugins/transformation/transformation.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸åŒçš„è½¬æ¢&lt;/a&gt;ï¼Œä»¥ä¾¿å°†å‰ç«¯ API ä¸åç«¯ API(ä»¥åŠåç«¯å¯èƒ½å¼•å…¥çš„ä»»ä½•ç ´åæ€§æ›´æ”¹) åˆ†ç¦»å¼€æ¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g223285hajj30o20dxabd_hu5eb490e4c36db39adb5ef3d76db51ba9_44915_e9baf4a4bf325c6725256de7644ec8d5.webp 400w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g223285hajj30o20dxabd_hu5eb490e4c36db39adb5ef3d76db51ba9_44915_acb0d8734aee086c0bafe7f14db8f1a4.webp 760w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g223285hajj30o20dxabd_hu5eb490e4c36db39adb5ef3d76db51ba9_44915_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g223285hajj30o20dxabd_hu5eb490e4c36db39adb5ef3d76db51ba9_44915_e9baf4a4bf325c6725256de7644ec8d5.webp&#34;
               width=&#34;760&#34;
               height=&#34;440&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™äº›å¯¹è±¡å…è®¸ä¸&lt;code&gt;Proxy&lt;/code&gt;å¯¹è±¡è§£è€¦ã€‚å½“ç”¨æˆ·ä½¿ç”¨ç¬¦åˆæ ‡å‡†çš„ API æˆ–æ˜¯ä¸æ ‡å‡†çš„ API åˆ›å»ºæ–°çš„&lt;code&gt;Gateway&lt;/code&gt;æˆ–&lt;code&gt;VirtualService&lt;/code&gt;å¯¹è±¡æ—¶ï¼ŒGloo çš„&lt;code&gt;Gateway&lt;/code&gt;ç»„ä»¶å°†æ¥å—è¿™äº›å¯¹è±¡ (Kubernetes ä¸­çš„ crdã€Consul ä¸­çš„é…ç½®) å¹¶æ›´æ–°åº•å±‚&lt;code&gt;Proxy&lt;/code&gt;å¯¹è±¡ã€‚è¿™æ˜¯æ‰©å±• Gloo çš„ä¸€ç§å¸¸è§æ¨¡å¼ï¼šé¦–é€‰æ§ä»¶å¹³é¢ç»„ä»¶çš„å¯ç»„åˆæ€§ã€‚è¿™å…è®¸æˆ‘ä»¬ä¸ºä¸»è§‚çš„é¢†åŸŸç‰¹å®šå¯¹è±¡æ„å»ºæ›´ä¸“é—¨åŒ–çš„æ§åˆ¶å™¨ï¼Œä»¥æ”¯æŒä¸åŒçš„ä½¿ç”¨ã€‚æ¯”å¦‚&lt;a href=&#34;https://www.solo.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Solo.io&lt;/a&gt;å›¢é˜Ÿè¿˜ä¸º Gloo æ„å»ºäº†ä¸€ä¸ªåä¸º&lt;a href=&#34;https://sqoop.solo.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sqoop&lt;/a&gt;çš„å¼€æºæ§åˆ¶å™¨ï¼Œè¯¥æ§åˆ¶å™¨éµå¾ªç›¸åŒçš„æ¨¡å¼ï¼Œå¹¶æ‰©å±•äº† Gloo APIï¼Œç”¨äºå£°æ˜åŸºäº&lt;a href=&#34;https://graphql.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GraphQL å¼•æ“&lt;/a&gt;çš„è·¯ç”±è§„åˆ™ã€‚åœ¨ Sqoop ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥&lt;a href=&#34;https://sqoop.solo.io/introduction/concepts/api_objects/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Schema å’Œ ResolverMap&lt;/a&gt;å¯¹è±¡ï¼Œå®ƒä»¬æœ€ç»ˆç»„åˆè¿› Proxy å¯¹è±¡ï¼Œç„¶åå°†ä»£ç†å¯¹è±¡è½¬æ¢ä¸º Envoy xDSã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g2235n0elij30m80i5jsa_hu44ea526c1cef32dc4412b36156261e43_31104_b3d52f5aa992b06fc152fb617cc67542.webp 400w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g2235n0elij30m80i5jsa_hu44ea526c1cef32dc4412b36156261e43_31104_a03ecb515921cd7e9143466ef381c083.webp 760w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g2235n0elij30m80i5jsa_hu44ea526c1cef32dc4412b36156261e43_31104_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-4-build-for-extensibility/006gLaqLly1g2235n0elij30m80i5jsa_hu44ea526c1cef32dc4412b36156261e43_31104_b3d52f5aa992b06fc152fb617cc67542.webp&#34;
               width=&#34;760&#34;
               height=&#34;620&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ„å»ºåœ¨åŸºæœ¬ Gloo å¯¹è±¡ä¸Šçš„é¢†åŸŸç‰¹å®šé…ç½®åˆ†å±‚çš„å¦ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œæˆ‘ä»¬æœ€è¿‘åœ¨&lt;a href=&#34;https://medium.com/solo-io/gloo-by-solo-io-is-the-first-alternative-to-istio-on-knative-324753586f3a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Knative ä¸­ä½¿ç”¨ Gloo ä»£ç†ä½œä¸º Istio çš„æ›¿ä»£æ–¹æ¡ˆ&lt;/a&gt;ã€‚Knative æœ‰ä¸€ä¸ªç”¨æ¥å£°æ˜é›†ç¾¤å…¥å£èµ„æºçš„ç‰¹å®šå¯¹è±¡ï¼Œç§°ä¸º&lt;a href=&#34;https://github.com/knative/serving/blob/master/pkg/client/clientset/versioned/typed/networking/v1alpha1/clusteringress.go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ClusterIngress&lt;/a&gt;å¯¹è±¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.internal.knative.dev/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterIngress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serving.knative.dev/route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld-go&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serving.knative.dev/routeNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld-go-txrqt&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;generation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;helloworld-go.default.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;helloworld-go.default.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;helloworld-go.default.svc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;helloworld-go.default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;appendHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;knative-serving-namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;knative-serving-revision&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld-go-00001&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;retries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;attempts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;perTryTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;10m0s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;splits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;percent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;activator-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;knative-serving&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;10m0s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;visibility&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ExternalIP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†æ”¯æŒ Gloo ä¸­çš„è¿™ä¸ªç”¨ä¾‹ï¼Œæˆ‘ä»¬æ‰€åšçš„å°±æ˜¯&lt;a href=&#34;https://github.com/solo-io/gloo/blob/ac3bddf202423b297fb909eb6eff498745a8c015/projects/clusteringress/pkg/translator/translate.go#L19&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ„å»ºä¸€ä¸ªæ–°çš„æ§åˆ¶å™¨&lt;/a&gt;ï¼Œç”¨äºç›‘è§†å’Œå°†&lt;a href=&#34;https://github.com/knative/serving/blob/master/pkg/client/clientset/versioned/typed/networking/v1alpha1/clusteringress.go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ClusterIngress&lt;/a&gt;å¯¹è±¡è½¬æ¢ä¸º Gloo çš„&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gloo/api/v1/proxy.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Proxy&lt;/a&gt;ã€‚æœ‰å…³åœ¨ Knative ä¸­ä½¿ç”¨ Gloo ä»¥ç®€åŒ–&lt;a href=&#34;https://github.com/knative/serving&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Knative Serving&lt;/a&gt;å®‰è£…ä»¥ä½¿ç”¨ Gloo ä½œä¸ºé›†ç¾¤å…¥å£çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…&lt;a href=&#34;https://blog.christianposta.com/guidance-for-building-a-control-plane-for-envoy-build-for-pluggability/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ¬åšå®¢&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ§åˆ¶å¹³é¢æ’ä»¶åŒ–ä»¥å¢å¼ºç°æœ‰è¡Œä¸º&#34;&gt;æ§åˆ¶å¹³é¢æ’ä»¶åŒ–ä»¥å¢å¼ºç°æœ‰è¡Œä¸º&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†é€šè¿‡åœ¨æ ¸å¿ƒå¯¹è±¡ä¹‹ä¸Šåˆ†å±‚ç‰¹å®šäºåŸŸçš„é…ç½®å¯¹è±¡æ¥æ‰©å±•æ§åˆ¶å¹³é¢çš„åŠŸèƒ½ã€‚å¦ä¸€ä¸ªæ‰©å±•ç‚¹ç›´æ¥ä½äºæ§ä»¶å¹³é¢æ ¸å¿ƒå¯¹è±¡æœ¬èº«ä¸­ã€‚åœ¨ Istio ä¸­æ˜¯&lt;code&gt;VirtualService&lt;/code&gt;å’Œ&lt;code&gt;DestinationRule&lt;/code&gt;ï¼Œåœ¨ Contour ä¸­æ˜¯&lt;code&gt;IngressRoute&lt;/code&gt;ï¼Œåœ¨ Gloo ä¸­æ˜¯&lt;code&gt;Proxy&lt;/code&gt;å’Œ&lt;code&gt;Upstream&lt;/code&gt;å¯¹è±¡ã€‚ä¾‹å¦‚ï¼ŒGloo çš„&lt;a href=&#34;https://github.com/solo-io/gloo/blob/7a5c3a9a7a060841a7047efce79e5b7b3ed981be/projects/gloo/api/v1/proxy.proto#L30&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Proxy å¯¹è±¡&lt;/a&gt;åŒ…å«&lt;a href=&#34;https://github.com/solo-io/gloo/blob/7a5c3a9a7a060841a7047efce79e5b7b3ed981be/projects/gloo/api/v1/proxy.proto#L90&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Listeners&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/solo-io/gloo/blob/7a5c3a9a7a060841a7047efce79e5b7b3ed981be/projects/gloo/api/v1/proxy.proto#L124&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VirtualHosts&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/solo-io/gloo/blob/7a5c3a9a7a060841a7047efce79e5b7b3ed981be/projects/gloo/api/v1/proxy.proto#L154&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Routes&lt;/a&gt;çš„æ‰©å±•ç‚¹ã€‚è¿™æ„å‘³ç€åœ¨ Proxy é…ç½®ä¸­æœ‰ä¸€äº›å®šä¹‰è‰¯å¥½çš„ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æœ€å°çš„ä¿®æ”¹ä»£ä»·å°†æ–°åŠŸèƒ½å¼•å…¥åˆ°æˆ‘ä»¬çš„é…ç½®ä¸­ (ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›å…¬å¼€æ–°çš„ Envoy åŠŸèƒ½ï¼Œæˆ–è€…ä¸ºæˆ‘ä»¬å¸Œæœ›å…¬å¼€é…ç½®çš„ Envoy ç¼–å†™æ–°çš„è¿‡æ»¤å™¨ç­‰)ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬&lt;a href=&#34;https://github.com/solo-io/gloo/blob/a27e1018640c46f7a25e4c1a0dc1f4cadf1773f5/projects/gloo/api/v1/plugins.proto#L44&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¼–å†™äº†ä¸€äº›æ’ä»¶ä¸°å¯Œäº† Envoy çš„è·¯ç”±å’Œè½¬æ¢åŠŸèƒ½&lt;/a&gt;ã€‚ä¾‹å¦‚ï¼Œè¦å°†ä¸€ä¸ªè¯·æ±‚è½¬æ¢ä¸º Envoy å¹¶å‘é€åˆ°ä¸€ä¸ªåä¸º&lt;code&gt;foo-service&lt;/code&gt;çš„æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;a href=&#34;https://github.com/pantor/inja&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Inja template&lt;/a&gt;æ‰‹å·¥æ’å…¥å¤´æˆ–æ­£æ–‡ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§&lt;a href=&#34;https://gloo.solo.io/user_guides/function_routing/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo æ–‡æ¡£ä¸­çš„å‡½æ•°è·¯ç”±æŒ‡å—&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;matcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routeAction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;single&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;upstream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routePlugins&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;transformations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requestTransformation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;transformationTemplate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;x-canary-foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo-bar-v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;:path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/v2/canary/feature&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;passthrough&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¦æŸ¥çœ‹ Gloo &lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gloo/api/v1/proxy.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Proxy&lt;/a&gt;å’Œ&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gloo/api/v1/upstream.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Upstream&lt;/a&gt;å¯¹è±¡ä¸Šå¯ç”¨æ’ä»¶çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜…è¿™é‡Œçš„&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gloo/api/v1/plugins.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦å‘æ§åˆ¶å¹³é¢æ·»åŠ äº†æ–°çš„æ’ä»¶ï¼Œå°±å¯ä»¥æ‰©å±•é¢å‘ç”¨æˆ·çš„ç‰¹å®šäºåŸŸçš„é…ç½®å¯¹è±¡ï¼Œä»¥åˆ©ç”¨è¿™äº›æ–°åŠŸèƒ½ã€‚æ‚¨å¯ä»¥å¢å¼ºç°æœ‰çš„æ§åˆ¶å™¨æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ–è€…æ·»åŠ æ–°çš„æ§åˆ¶å™¨ (éµå¾ªå¾®æœåŠ¡æ¾æ•£åè°ƒçš„åŸåˆ™)ã€‚æˆ‘ä»¬å·²ç»ç¼–å†™äº†&lt;a href=&#34;https://gloo.solo.io/dev/example-proxy-controller/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤§é‡çš„ä¾‹å­æ¥å¸®åŠ©æ‚¨ç¼–å†™æ§åˆ¶å™¨&lt;/a&gt;æ¥å¢å¼ºæ‚¨çš„æ§åˆ¶å¹³é¢åŠŸèƒ½ï¼Œæˆ–è€…åœ¨&lt;a href=&#34;https://slack.solo.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slack&lt;/a&gt;ä¸Šå¯»æ‰¾æ›´å¤šå…³äºè¿™æ–¹é¢çš„æŒ‡å—ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åˆ©ç”¨å·¥å…·åŠ å¿«å‰é¢ä¸¤ä¸ªå·¥ä½œçš„å®æ–½&#34;&gt;åˆ©ç”¨å·¥å…·åŠ å¿«å‰é¢ä¸¤ä¸ªå·¥ä½œçš„å®æ–½&lt;/h2&gt;
&lt;p&gt;åœ¨å‰å‡ èŠ‚ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†å¦‚ä½•è€ƒè™‘æ§åˆ¶å¹³é¢çš„å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚æˆ‘ä»¬äº†è§£äº†å¦‚ä½•ä½¿ç”¨å¤šå±‚ç‰¹å®šäºåŸŸçš„é…ç½®å¯¹è±¡ï¼Œé€šè¿‡æ·»åŠ æ–°å¯¹è±¡å’Œæ§åˆ¶å™¨æ¥å®ç°å¯æ‰©å±•æ€§ã€‚åœ¨&lt;a href=&#34;https://www.solo.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Solo.io&lt;/a&gt;æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º&lt;a href=&#34;https://github.com/solo-io/solo-kit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;solo-kit&lt;/a&gt;çš„å¼€æºé¡¹ç›®ï¼Œå®ƒé€šè¿‡ä»&lt;a href=&#34;https://developers.google.com/protocol-buffers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;protobuf&lt;/a&gt;å¯¹è±¡å¼€å§‹ï¼Œå¹¶é€šè¿‡ä»£ç ç”Ÿæˆæ­£ç¡®çš„ç±»å‹å®‰å…¨å®¢æˆ·æœºï¼Œä»¥ä¾¿åœ¨å¹³å°ä¸Šä¸è¿™äº›å¯¹è±¡äº¤äº’ï¼Œä»è€ŒåŠ å¿«ä¸ºæ‚¨çš„æ§åˆ¶å¹³é¢æ„å»ºæ–°çš„ã€å£°æ˜æ€§çš„ã€è‡ªå®šä¹‰çš„ API å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œåœ¨ Kubernetes ä¸Šï¼Œ&lt;a href=&#34;https://github.com/solo-io/solo-kit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;solo-kit&lt;/a&gt;å°†è¿™äº›åŸå‹è½¬æ¢ä¸º&lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CustomResourceDefinitions&lt;/a&gt;ï¼Œå¹¶ç”Ÿæˆ Golang Kubernetes å®¢æˆ·æœºï¼Œç”¨äºç›‘è§†å’Œä¸è¿™äº›èµ„æºäº¤äº’ã€‚å¦‚æœä¸åœ¨ Kubernetes ä¸Šï¼Œè¿˜å¯ä»¥ä½¿ç”¨ Consulã€Vault å’Œå…¶ä»–ç»„ä»¶ä½œä¸ºåç«¯å­˜å‚¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦æ‚¨åˆ›å»ºäº†èµ„æºå¹¶ç”Ÿæˆäº†ç±»å‹å®‰å…¨çš„å®¢æˆ·ç«¯ï¼Œæ‚¨å°±éœ€è¦æ£€æµ‹ç”¨æˆ·ä½•æ—¶åˆ›å»ºæ–°èµ„æºæˆ–æ›´æ”¹ç°æœ‰èµ„æºã€‚ä½¿ç”¨&lt;a href=&#34;https://github.com/solo-io/solo-kit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;solo-kit&lt;/a&gt;ï¼Œæ‚¨åªéœ€æŒ‡å®šå¸Œæœ›æŸ¥çœ‹å“ªäº›èµ„æºï¼Œæˆ–è€…ç§°ä¸ºâ€œå¿«ç…§â€çš„èµ„æºç»„åˆï¼Œå®¢æˆ·ç«¯è¿è¡Œä¸€ä¸ªäº‹ä»¶å¾ªç¯æ¥å¤„ç†ä»»ä½•é€šçŸ¥ã€‚åœ¨äº‹ä»¶å¾ªç¯ä¸­ï¼Œå¯ä»¥æ›´æ–°åä½œå¯¹è±¡æˆ–æ ¸å¿ƒå¯¹è±¡ã€‚äº‹å®ä¸Šï¼Œè¿™å°±æ˜¯ Gloo åˆ†å±‚çš„ç‰¹å®šäºåŸŸçš„é…ç½®å¯¹è±¡çš„å·¥ä½œæ–¹å¼ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§&lt;a href=&#34;https://gloo.solo.io/operator_guide/gloo_declarative_model/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo å£°æ˜æ€§æ¨¡å‹æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å°ç»“&#34;&gt;å°ç»“&lt;/h2&gt;
&lt;p&gt;æ§åˆ¶å¹³é¢å¯ä»¥ç®€å•åˆ°æ‚¨éœ€è¦çš„ç¨‹åº¦ï¼Œä¹Ÿå¯ä»¥å¤æ‚åˆ°æ‚¨éœ€è¦çš„ç¨‹åº¦ã€‚Gloo å›¢é˜Ÿå»ºè®®å°†é‡ç‚¹æ”¾åœ¨æ§åˆ¶å¹³é¢çš„ç®€å•æ ¸å¿ƒä¸Šï¼Œç„¶åé€šè¿‡æ’ä»¶å’Œå¾®æœåŠ¡æ§åˆ¶å™¨çš„å¯ç»„åˆæ€§æ‰©å±•å®ƒã€‚Gloo çš„ä½“ç³»ç»“æ„æ˜¯è¿™æ ·æ„å»ºçš„ï¼Œå®ƒä½¿&lt;a href=&#34;https://github.com/solo-io/gloo/graphs/contributors&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo å›¢é˜Ÿ&lt;/a&gt;èƒ½å¤Ÿå¿«é€Ÿæ·»åŠ ä»»ä½•æ–°ç‰¹æ€§ï¼Œä»¥æ”¯æŒä»»ä½•å¹³å°ã€é…ç½®ã€è¿‡æ»¤å™¨ï¼Œä»¥åŠæ›´å¤šçš„æ–°ç‰¹æ€§ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œå°½ç®¡ Gloo æ˜¯éå¸¸ kubernets åŸç”Ÿçš„ï¼Œä½†å®ƒæ˜¯ä¸ºåœ¨ä»»ä½•äº‘ä¸Šçš„ä»»ä½•å¹³å°ä¸Šè¿è¡Œè€Œæ„å»ºçš„ã€‚æ ¸å¿ƒæ§åˆ¶å¹³é¢çš„è®¾è®¡å…è®¸è¿™æ ·åšã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºéƒ¨ç½²æ§åˆ¶å¹³é¢ç»„ä»¶çš„ä¼˜ç¼ºç‚¹ï¼ŒåŒ…æ‹¬å¯ä¼¸ç¼©æ€§ã€å®¹é”™ã€ç‹¬ç«‹æ€§å’Œå®‰å…¨æ€§ã€‚è¯·&lt;a href=&#34;https://twitter.com/soloio_inc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç»§ç»­å…³æ³¨ï¼&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä¸º Envoy æ„å»ºæ§åˆ¶å¹³é¢æŒ‡å—ç¬¬ 3 éƒ¨åˆ†ï¼šé¢†åŸŸç‰¹å®šé…ç½®</title>
      <link>https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/</link>
      <pubDate>Thu, 04 Apr 2019 18:00:43 +0800</pubDate>
      <guid>https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://medium.com/solo-io/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration-c97e8124b9d1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯æ¢ç´¢ä¸º Envoy ä»£ç†æ„å»ºæ§åˆ¶å¹³é¢ç³»åˆ—æ–‡ç« çš„ç¬¬ 3 éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬ç³»åˆ—åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†å…³æ³¨ä»¥ä¸‹é¢†åŸŸï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/solo-io/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh-badb6c36a2af&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é‡‡ç”¨ä¸€ç§æœºåˆ¶æ¥åŠ¨æ€æ›´æ–° Envoy çš„è·¯ç”±ã€æœåŠ¡å‘ç°å’Œå…¶ä»–é…ç½®&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/solo-io/guidance-for-building-a-control-plane-for-envoy-proxy-part-2-identify-components-2d0731b0d8a4&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¡®å®šæ§åˆ¶å¹³é¢ç”±å“ªäº›ç»„ä»¶ç»„æˆï¼ŒåŒ…æ‹¬æ”¯æŒå­˜å‚¨ã€æœåŠ¡å‘ç° apiã€å®‰å…¨ç»„ä»¶ç­‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å»ºç«‹æœ€é€‚åˆæ‚¨çš„ä½¿ç”¨åœºæ™¯å’Œç»„ç»‡æ¶æ„çš„ç‰¹å®šäºåŸŸçš„é…ç½®å¯¹è±¡å’Œ apiï¼ˆæœ¬åšå®¢ï¼‰&lt;/li&gt;
&lt;li&gt;è€ƒè™‘å¦‚ä½•æœ€å¥½åœ°ä½¿æ‚¨çš„æ§åˆ¶å¹³é¢å¯æ’åœ¨æ‚¨éœ€è¦å®ƒçš„åœ°æ–¹&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²å„ç§æ§åˆ¶å¹³é¢ç»„ä»¶çš„é€‰é¡¹&lt;/li&gt;
&lt;li&gt;é€šè¿‡æ§åˆ¶å¹³é¢çš„æµ‹è¯•å·¥å…·æ¥æ€è€ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨å‰é¢çš„&lt;a href=&#34;https://medium.com/solo-io/guidance-for-building-a-control-plane-for-envoy-proxy-part-2-identify-components-2d0731b0d8a4&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åšå®¢éƒ¨åˆ†&lt;/a&gt;ä¸­ï¼Œæˆ‘ä»¬è¯„ä¼°äº†æ§åˆ¶å¹³é¢å¯èƒ½éœ€è¦çš„ç»„ä»¶ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢ç‰¹å®šäºåŸŸçš„ API åœ¨æ‚¨çš„æ§åˆ¶å¹³é¢ä¸Šå¯èƒ½æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å»ºç«‹æ‚¨çš„æ§åˆ¶å¹³é¢äº¤äº’ç‚¹å’Œ-api-é¢&#34;&gt;å»ºç«‹æ‚¨çš„æ§åˆ¶å¹³é¢äº¤äº’ç‚¹å’Œ API é¢&lt;/h2&gt;
&lt;p&gt;ä¸€æ—¦æ‚¨è€ƒè™‘äº†å“ªäº›ç»„ä»¶å¯èƒ½æ„æˆæ‚¨çš„æ§åˆ¶å¹³é¢ä½“ç³»ç»“æ„ (è¯·å‚é˜…å‰é¢çš„éƒ¨åˆ†)ï¼Œæ‚¨å°±éœ€è¦è€ƒè™‘æ‚¨çš„ç”¨æˆ·å°†å¦‚ä½•ä¸æ§åˆ¶å¹³é¢äº¤äº’ï¼Œç”šè‡³æ›´é‡è¦çš„æ˜¯ï¼Œæ‚¨çš„ç”¨æˆ·å°†æ˜¯è°ï¼Ÿè¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨å¿…é¡»å†³å®šåŸºäº Envoy çš„åŸºç¡€è®¾æ–½å°†æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Œä»¥åŠæµé‡å°†å¦‚ä½•é€šè¿‡ä½“ç³»ç»“æ„ã€‚å®ƒå¯ä»¥æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;API ç®¡ç†ç½‘å…³ï¼ˆå—åŒ—å‘æµé‡ï¼‰&lt;/li&gt;
&lt;li&gt;ç®€å• Kubernetes è¾¹ç¼˜è´Ÿè½½å‡è¡¡å™¨/åå‘ä»£ç†/å…¥å£æ§åˆ¶ï¼ˆå—åŒ—å‘æµé‡ï¼‰&lt;/li&gt;
&lt;li&gt;å…±äº«æœåŠ¡ä»£ç†ï¼ˆä¸œè¥¿å‘æµé‡ï¼‰&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªæœåŠ¡çš„ sidecarï¼ˆä¸œè¥¿å‘æµé‡ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio é¡¹ç›®æ—¨åœ¨æˆä¸ºæœåŠ¡ç½‘æ ¼å¹³å°ï¼Œç”¨æˆ·é€šè¿‡å¹³å°ï¼Œå¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ„å»ºå·¥å…·æ¥é©±åŠ¨æœåŠ¡å’Œåº”ç”¨ç¨‹åºä¹‹é—´çš„ç½‘ç»œæ§åˆ¶ã€‚Istio ç”¨äºé…ç½® Envoy çš„é¢†åŸŸç‰¹å®šé…ç½®å¯¹è±¡ä¸»è¦å›´ç»•ä»¥ä¸‹å¯¹è±¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/docs/reference/config/networking/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway&lt;/a&gt;ï¼šå®šä¹‰ä¸€ä¸ªå…±äº«ä»£ç†ç»„ä»¶ï¼ˆèƒ½å¤Ÿé›†ç¾¤è¿›å…¥ï¼‰ï¼Œè¯¥ç»„ä»¶æŒ‡å®šå¯ç”¨äºè´Ÿè½½å‡è¡¡å’Œè·¯ç”±æµé‡çš„åè®®ã€TLSã€ç«¯å£å’Œä¸»æœº/æƒé™&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/docs/reference/config/networking/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VirtualService&lt;/a&gt;ï¼šå¦‚ä½•ä¸ç‰¹å®šæœåŠ¡äº¤äº’çš„è§„åˆ™ï¼›å¯ä»¥æŒ‡å®šè¯¸å¦‚è·¯ç”±åŒ¹é…ã€è¶…æ—¶ã€é‡è¯•ç­‰å†…å®¹&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/docs/reference/config/networking/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DestinationRule&lt;/a&gt;ï¼šå¦‚ä½•ä¸ç‰¹å®šæœåŠ¡è¿›è¡Œäº¤äº’çš„è§„åˆ™ï¼ŒåŒ…æ‹¬ç†”æ–­ã€è´Ÿè½½å‡è¡¡ã€mTLS ç­–ç•¥ã€æœåŠ¡çš„å­é›†å®šä¹‰ç­‰&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/docs/reference/config/networking/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ServiceEntry&lt;/a&gt;ï¼šæ˜¾å¼åœ°å°†æœåŠ¡æ·»åŠ åˆ° Istio çš„æœåŠ¡æ³¨å†Œä¸­å¿ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/006gLaqLgy1g1ocpfgj5dj30ma09dq3j_hu17a096fd059e21d397c9b21591df634f_30694_cdf9aba798d01c17a8d391eb74f10157.webp 400w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/006gLaqLgy1g1ocpfgj5dj30ma09dq3j_hu17a096fd059e21d397c9b21591df634f_30694_233c3490a269b033440d5dd2954a6662.webp 760w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/006gLaqLgy1g1ocpfgj5dj30ma09dq3j_hu17a096fd059e21d397c9b21591df634f_30694_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/006gLaqLgy1g1ocpfgj5dj30ma09dq3j_hu17a096fd059e21d397c9b21591df634f_30694_cdf9aba798d01c17a8d391eb74f10157.webp&#34;
               width=&#34;760&#34;
               height=&#34;319&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿è¡Œåœ¨ Kubernetes ä¸­çš„æ‰€æœ‰è¿™äº›é…ç½®å¯¹è±¡éƒ½å®ç°ä¸º &lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CustomResourceDefinitions&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/heptio/contour&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Heptio/VMWare Contour&lt;/a&gt; æ—¨åœ¨ä½œä¸º Kubernetes ingress ç½‘å…³ï¼Œå¹¶å…·æœ‰ä¸€ä¸ªç®€åŒ–çš„ç‰¹å®šäºåŸŸçš„é…ç½®æ¨¡å‹ï¼Œå…·æœ‰ CustomResourceDefinitionï¼ˆCRDï¼‰é£æ ¼å’Œ &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes ingress èµ„æº&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/heptio/contour/blob/master/docs/ingressroute.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IngressRoute&lt;/a&gt; æ˜¯ä¸€ä¸ª Kubernetes CRDï¼Œå®ƒæä¾›ä¸€ä¸ªä½ç½®æ¥æŒ‡å®š Contour ä»£ç†çš„é…ç½®&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/heptio/contour/blob/master/docs/annotations.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress èµ„æºæ”¯æŒ&lt;/a&gt;ï¼Œå…è®¸ä½ åœ¨ä½ çš„ Kubernetes Ingress èµ„æºä¸ŠæŒ‡å®šæ³¨è§£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/006gLaqLly1g1oao8vmp8j30hc05gaa8_hua7d16a1f5effe7b9c68e2ed05dd9ebd2_14644_fc5155c11320887974331d56d91e72bf.webp 400w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/006gLaqLly1g1oao8vmp8j30hc05gaa8_hua7d16a1f5effe7b9c68e2ed05dd9ebd2_14644_2b385b0d73fac94804a08ca81a14b922.webp 760w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/006gLaqLly1g1oao8vmp8j30hc05gaa8_hua7d16a1f5effe7b9c68e2ed05dd9ebd2_14644_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/006gLaqLly1g1oao8vmp8j30hc05gaa8_hua7d16a1f5effe7b9c68e2ed05dd9ebd2_14644_fc5155c11320887974331d56d91e72bf.webp&#34;
               width=&#34;624&#34;
               height=&#34;196&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;a href=&#34;https://gloo.solo.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo é¡¹ç›®&lt;/a&gt;ä¸­ï¼Œå°†å¯ç”¨çš„é…ç½®å¯¹è±¡åˆ†æˆä¸¤ä¸ªçº§åˆ«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºç”¨æˆ·æä¾›æœ€ä½³ç¬¦åˆäººæœºå·¥ç¨‹å­¦çš„é¢å‘ç”¨æˆ·çš„é…ç½®ï¼Œå¹¶ä¸ºå¯æ‰©å±•æ€§ç•™ä¸‹é€‰é¡¹ï¼ˆä¸‹ä¸€èŠ‚å°†è¯¦ç»†ä»‹ç»ï¼‰&lt;/li&gt;
&lt;li&gt;æŠ½è±¡ Envoy ä½†ä¸æ˜ç¡®ç”¨äºç›´æ¥ç”¨æˆ·æ“ä½œçš„ä½å±‚é…ç½®ã€‚è¾ƒé«˜çº§åˆ«çš„å¯¹è±¡è¢«è½¬æ¢ä¸ºè¿™ç§è¾ƒä½çº§åˆ«çš„è¡¨ç¤ºå½¢å¼ï¼Œæœ€ç»ˆç”¨äºè½¬æ¢ä¸º Envoy xDS apiã€‚è¿™æ ·è®¾è®¡çš„åŸå› å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­è¯´æ˜&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºç”¨æˆ·ï¼ŒGloo å…³æ³¨æ‹¥æœ‰è·¯ç”±é…ç½®çš„å›¢é˜Ÿï¼Œå› ä¸ºè·¯ç”±çš„è¯­ä¹‰ï¼ˆä»¥åŠå¯ç”¨çš„è½¬æ¢/èšåˆåŠŸèƒ½ï¼‰å—åˆ° API å’Œå¾®æœåŠ¡å¼€å‘äººå‘˜çš„ä¸¥é‡å½±å“ã€‚å¯¹äºé¢å‘ç”¨æˆ·çš„ API å¯¹è±¡ï¼Œæˆ‘ä»¬ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gateway/api/v1/gateway.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway&lt;/a&gt;ï¼šæŒ‡å®šç‰¹å®šç›‘å¬å™¨ç«¯å£ä¸Šå¯ç”¨çš„è·¯ç”±å’Œ API ç«¯ç‚¹ï¼Œä»¥åŠæ¯ä¸ª API çš„å®‰å…¨æ€§&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gateway/api/v1/virtual_service.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VirtualServiceâ€Š&lt;/a&gt;ï¼šå°† API è·¯ç”±åˆ†ç»„åˆ°ä¸€ç»„â€œè™šæ‹Ÿ APIâ€ä¸­ï¼Œè¿™äº›â€œè™šæ‹Ÿ APIâ€å¯ä»¥è·¯ç”±åˆ°æ”¯æŒçš„å‡½æ•°ï¼ˆgRPCã€http/1ã€http/2ã€lambda ç­‰ï¼‰ï¼›ä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿæ§åˆ¶è·¯ç”±å¦‚ä½•å¤„ç†&lt;a href=&#34;&#34;&gt;ä¸åŒçš„è½¬æ¢&lt;/a&gt;ï¼Œä»è€Œå°è¯•å°†å‰ç«¯ API ä¸åç«¯ APIï¼ˆä»¥åŠåç«¯å¯èƒ½å¼•å…¥çš„ä»»ä½•ç ´åæ€§æ›´æ”¹ï¼‰åˆ†ç¦»å¼€æ¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ³¨æ„ï¼Œè¿™äº›å¯¹è±¡ä¸è¿™äº›å¯¹è±¡çš„ Istio å˜ä½“ä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;Gloo ä¸­çš„é¢å‘ç”¨æˆ·çš„ API å¯¹è±¡é©±åŠ¨è¾ƒä½å±‚çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡æœ€ç»ˆç”¨äºæ´¾ç”Ÿ Envoy xDS é…ç½®ã€‚ä¾‹å¦‚ï¼ŒGloo çš„åº•å±‚æ ¸å¿ƒ API å¯¹è±¡æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gloo/api/v1/upstream.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Upstream&lt;/a&gt;ï¼šè·å–å…³äºåç«¯é›†ç¾¤å’Œåœ¨æ­¤ä¸Šå…¬å¼€çš„å‡½æ•°çš„è¯¦ç»†ä¿¡æ¯ã€‚æ‚¨å¯ä»¥å°† Gloo ä¸Šæ¸¸ä¸ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cds.proto&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy é›†ç¾¤&lt;/a&gt;æ¾æ•£åœ°å…³è”èµ·æ¥ï¼Œä½†æœ‰ä¸€ä¸ªå¾ˆå¤§çš„åŒºåˆ«ï¼šä¸Šæ¸¸å¯ä»¥ç†è§£ç‰¹å®šç«¯ç‚¹ä¸Šå¯ç”¨çš„å®é™…æœåŠ¡åŠŸèƒ½ï¼ˆæ¢å¥è¯è¯´ï¼Œäº†è§£ &lt;code&gt;/foo/bar&lt;/code&gt; å’Œ &lt;code&gt;/bar/wine&lt;/code&gt;ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„é¢„æœŸå‚æ•°å’Œå‚æ•°ç»“æ„ï¼Œè€Œä¸ä»…ä»…æ˜¯ &lt;code&gt;hostname:port&lt;/code&gt;ï¼‰ï¼Œåæ–‡ä¼šè¯¦ç»†è§£é‡Šã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gloo/api/v1/proxy.proto.sk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Proxy&lt;/a&gt;ï¼šä»£ç†æ˜¯æŠ½è±¡æˆ‘ä»¬å¯ä»¥åº”ç”¨äº Envoy çš„æ‰€æœ‰é…ç½®çš„ä¸»è¦å¯¹è±¡ã€‚è¿™åŒ…æ‹¬ç›‘å¬å™¨ã€è™šæ‹Ÿä¸»æœºã€è·¯ç”±å’Œä¸Šè¡Œæµã€‚é«˜çº§å¯¹è±¡ï¼ˆVirtualServiceï¼ŒGateway ç­‰ï¼‰ç”¨äºé©±åŠ¨è¿™ä¸ªä½çº§ä»£ç†å¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/006gLaqLgy1g1ocrrdccrj30o20dxabd_hu5eb490e4c36db39adb5ef3d76db51ba9_44915_a767809aeae8961728ec7f515bbd07e0.webp 400w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/006gLaqLgy1g1ocrrdccrj30o20dxabd_hu5eb490e4c36db39adb5ef3d76db51ba9_44915_f0ac3ced87ef8d00b8f87873e027dc82.webp 760w,
               /blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/006gLaqLgy1g1ocrrdccrj30o20dxabd_hu5eb490e4c36db39adb5ef3d76db51ba9_44915_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/006gLaqLgy1g1ocrrdccrj30o20dxabd_hu5eb490e4c36db39adb5ef3d76db51ba9_44915_a767809aeae8961728ec7f515bbd07e0.webp&#34;
               width=&#34;760&#34;
               height=&#34;440&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Gloo æ§ä»¶çš„ä¸¤å±‚é…ç½®ä¹‹é—´çš„åˆ†ç¦»å…è®¸æˆ‘ä»¬åœ¨ä¿æŒé…ç½® Envoy çš„ç®€å•æŠ½è±¡çš„åŒæ—¶æ‰©å±• Gloo æ§åˆ¶å¹³é¢åŠŸèƒ½ã€‚æœ¬ç³»åˆ—çš„ç¬¬ 4 éƒ¨åˆ†å°†å¯¹æ­¤è¿›è¡Œæ›´è¯¦ç»†çš„è§£é‡Šã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å‰é¢çš„ä¸‰ä¸ªç¤ºä¾‹ä¸­ï¼ˆIstioã€Contourã€Glooï¼‰ï¼Œæ¯ä¸ªæ§åˆ¶å¹³é¢å…¬å¼€ä¸€ç»„ç‰¹å®šäºåŸŸçš„é…ç½®å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒï¼Œä½†æœ€ç»ˆè½¬æ¢ä¸º Envoy é…ç½®ï¼Œå¹¶é€šè¿‡ xDS æ•°æ®é¢ API å…¬å¼€ã€‚è¿™æä¾›äº† Envoy ä¸ç”¨æˆ·çš„å·¥ä½œæ–¹å¼åŠå…¶å·¥ä½œæµä¹‹é—´çš„è§£è€¦ã€‚å°½ç®¡æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸€äº›ä¸ºæŠ½è±¡ Envoy åˆ›å»ºæ›´å…³æ³¨ç”¨æˆ·å’Œå·¥ä½œæµçš„é¢†åŸŸç‰¹å®šé…ç½®çš„ä¾‹å­ï¼Œä½†è¿™å¹¶ä¸æ˜¯æ„å»º Envoy æ§åˆ¶å¹³é¢çš„å”¯ä¸€æ–¹æ³•ã€‚&lt;a href=&#34;https://www.slideshare.net/IvanKruglov/ivan-kruglov-introducing-envoybased-service-mesh-at-bookingcom-version-7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Booking.com æœ‰ä¸€ä¸ªå¾ˆæ£’çš„æ¼”ç¤º&lt;/a&gt;ï¼Œä»‹ç»äº†ä»–ä»¬æ˜¯å¦‚ä½•ä¸ Envoy é…ç½®ä¿æŒæ›´ç´§å¯†çš„è”ç³»ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªå¼•æ“å°†æ‰€æœ‰ä¸åŒå›¢é˜Ÿçš„é…ç½®ç‰‡æ®µåˆå¹¶åˆ°å®é™…çš„ Envoy é…ç½®ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†è€ƒè™‘ç‰¹å®šäºåŸŸçš„é…ç½®ä¹‹å¤–ï¼Œè¿˜åº”è¯¥è€ƒè™‘ API/å¯¹è±¡æ¨¡å‹çš„ç‰¹å®šæ¥è§¦ç‚¹ã€‚ä¾‹å¦‚ï¼ŒKubernetes éå¸¸å…³æ³¨ YAML å’Œèµ„æºæ–‡ä»¶ã€‚æ‚¨å¯ä»¥æ„å»ºä¸€ä¸ªæ›´ç‰¹å®šäºé¢†åŸŸçš„ CLI å·¥å…·ï¼ˆå°±åƒ &lt;a href=&#34;https://docs.openshift.com/enterprise/3.2/dev_guide/new_app.html#dev-guide-new-app&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenShift å¯¹ oc CLI&lt;/a&gt; ï¼Œ&lt;a href=&#34;https://istio.io/docs/reference/commands/istioctl/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å¯¹ istioctl&lt;/a&gt; ï¼Œ &lt;a href=&#34;https://gloo.solo.io/cli/glooctl/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo å¯¹ glooctl&lt;/a&gt; æ‰€åšçš„é‚£æ ·ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å°ç»“&#34;&gt;å°ç»“&lt;/h2&gt;
&lt;p&gt;å½“æ‚¨æ„å»ºä¸€ä¸ª Envoy æ§åˆ¶å¹³é¢æ—¶ï¼Œæ‚¨æ˜¯å¸¦ç€ä¸€ä¸ªç‰¹å®šçš„æ„å›¾æˆ–ä¸€ç»„æ¶æ„/ç”¨æˆ·æ¥åšè¿™ä»¶äº‹çš„ã€‚æ‚¨åº”è¯¥è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œå¹¶æ„å»ºé€‚åˆæ‚¨çš„ç”¨æˆ·å¹¶æ”¹è¿›æ‚¨çš„ Envoy æ“ä½œå·¥ä½œæµä½¿å…¶ç¬¦åˆäººä½“å·¥ç¨‹å­¦çš„ã€æœ‰ä¸»è§çš„ç‰¹å®šäºé¢†åŸŸçš„ APIã€‚&lt;a href=&#34;https://github.com/solo-io/gloo/graphs/contributors&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo å›¢é˜Ÿ&lt;/a&gt;å»ºè®®ç ”ç©¶ç°æœ‰çš„ Envoy æ§åˆ¶å¹³é¢å®ç°ï¼Œåªæœ‰åœ¨å…¶ä»–å®ç°éƒ½ä¸åˆé€‚çš„æƒ…å†µä¸‹æ‰æ„å»ºè‡ªå·±çš„ Envoy æ§åˆ¶å¹³é¢ã€‚Gloo çš„æ§åˆ¶ä¸ºæ‰©å±•å’Œå®šåˆ¶å¥ å®šäº†åŸºç¡€ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­çœ‹åˆ°ï¼Œå¯ä»¥æ„å»ºä¸€ä¸ªå®Œå…¨å¯æ‰©å±•çš„æ§åˆ¶å¹³é¢ï¼Œä»¥é€‚åº”è®¸å¤šä¸åŒçš„ç”¨æˆ·ã€å·¥ä½œæµå’Œæ“ä½œçº¦æŸã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä¸º Envoy èµ‹èƒ½â€”â€”å¦‚ä½•åŸºäº Envoy æ„å»ºä¸€ä¸ªå¤šç”¨é€”æ§åˆ¶å¹³é¢</title>
      <link>https://cloudnative.to/blog/building-a-control-plane-for-envoy/</link>
      <pubDate>Mon, 25 Mar 2019 21:02:19 +0800</pubDate>
      <guid>https://cloudnative.to/blog/building-a-control-plane-for-envoy/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://medium.com/solo-io/building-a-control-plane-for-envoy-7524ceb09876&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼–è€…æ¡ˆ&#34;&gt;ç¼–è€…æ¡ˆ&lt;/h2&gt;
&lt;p&gt;Idit Levine ä½œä¸º solo.io åˆ›å§‹äººå…¼é¦–å¸­æ‰§è¡Œå®˜ï¼Œåœ¨æœ¬ç³»åˆ—åšå®¢ä¸­ä»‹ç»äº†å¥¹ä»¬çš„äº§å“ Glooã€‚è¿™ç¯‡åšå®¢æ˜¯ç³»åˆ—ä¸­çš„å…¶ä¸­ä¸€ç¯‡ï¼Œè¿™ä¸€ç¯‡çš„ä¸»è¦å†…å®¹æ˜¯ï¼Œå¦‚æœè¦åŸºäº Envoy æ„å»ºä¸€ä¸ªæ§åˆ¶å¹³é¢çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å“ªäº›é—®é¢˜ï¼›è¦ç”¨ä»€ä¹ˆæ ·çš„è§£å†³æ–¹æ¡ˆæ¥åº”å¯¹è¿™äº›é—®é¢˜ã€‚ä½œè€…åœ¨æœ¬æ–‡ç« é˜è¿°äº† Envoy çš„å·¥ä½œåŸç†ã€ä¸ºä»€ä¹ˆè¦é€‰æ‹© Envoy ä»¥åŠåœ¨æ„å»ºä¸€ä¸ªæ§åˆ¶å¹³é¢è¿‡ç¨‹ä¸­è¦åšå‡ºçš„æŠ€æœ¯ä½“ç³»ç»“æ„çš„æŠ‰æ‹©ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœ¨æœ¬ç³»åˆ—åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†åˆ†äº«å¦‚ä½•ä¸º &lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Proxy&lt;/a&gt; æ„å»ºä¸€ä¸ªå¤šç”¨é€”æ§åˆ¶å¹³é¢ &lt;a href=&#34;https://gloo.solo.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo&lt;/a&gt; çš„ç»éªŒã€‚æœ¬ç³»åˆ—çš„ç¬¬ä¸€ä¸ªåšå®¢å…³æ³¨äº Envoy çš„è®¾è®¡ï¼Œä»¥åŠåœ¨æ„å»ºæ§åˆ¶å¹³é¢çš„ç¬¬ä¸€å±‚æ—¶éœ€è¦åšå‡ºçš„æŠ€æœ¯ä½“ç³»ç»“æ„æŠ‰æ‹©ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Envoy Proxy æ˜¯ç”± Lyft ç ”å‘å›¢é˜Ÿè®¾è®¡çš„&lt;a href=&#34;https://blog.envoyproxy.io/the-universal-data-plane-api-d15cec7a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€šç”¨æ•°æ®å¹³é¢&lt;/a&gt;ã€‚Envoy çš„ä¼˜åŠ¿æºäºæ€§èƒ½ã€å¯æ‰©å±•æ€§å’ŒåŠ¨æ€é…ç½®çš„ç»“åˆã€‚ç„¶è€Œï¼Œè¿™ç§èƒ½åŠ›æ˜¯ä»¥å¢åŠ é…ç½®å¤æ‚æ€§ä¸ºä»£ä»·çš„ã€‚äº‹å®ä¸Šï¼ŒEnvoy é…ç½®æ˜¯ç”±ç®¡ç†å±‚ (é€šå¸¸ç§°ä¸ºâ€œæ§åˆ¶å¹³é¢â€) é€šè¿‡æœºå™¨ç”Ÿæˆçš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸º Envoy ç¼–å†™ä¸€ä¸ªæ§åˆ¶å¹³é¢å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œå°±åƒ Ambassador åˆ›å»ºè€…æœ€è¿‘åœ¨ä¸€ç¯‡&lt;a href=&#34;https://www.infoq.com/articles/ambassador-api-gateway-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡ç« &lt;/a&gt;ä¸­æè¿°çš„é‚£æ ·ï¼Œè¯¥æ–‡ç« è¯¦ç»†æè¿°äº†ä»–ä»¬åå¤å°è¯•æ„å»ºè¿™ä¸ªæ§åˆ¶å¹³é¢çš„è¿‡ç¨‹ã€‚åœ¨æ¥ä¸‹æ¥çš„ä¸€ç³»åˆ—åšå®¢ä¸­ï¼Œå°†å‘ä½ åˆ†äº«æˆ‘ä»¬è‡ªå·±çš„ç»éªŒã€è®¾è®¡é€‰æ‹©å’Œå®ç°è€ƒè™‘ï¼Œè¿™äº›è®©æˆ‘ä»¬èƒ½å¤Ÿåˆ©ç”¨ Envoy æä¾›çš„å¼ºå¤§åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-æ˜¯å¦‚ä½•å·¥ä½œçš„&#34;&gt;Envoy æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;åœ¨è®¨è®ºå¦‚ä½•æ„å»ºæ§åˆ¶å¹³é¢ä¹‹å‰ï¼Œé¦–å…ˆæ¥ç®€è¦å›é¡¾ä¸€ä¸‹ Envoy ä½œä¸ºè¾¹ç¼˜ä»£ç†çš„å·¥ä½œåŸç†ã€‚&lt;/p&gt;
&lt;p&gt;å½“è¯·æ±‚åˆ°è¾¾é›†ç¾¤æ—¶ï¼ŒEnvoy å¯ä»¥ä½¿ç”¨æ§åˆ¶å¹³é¢åšå¾ˆå¤šäº‹æƒ…ï¼ŒåŒ…æ‹¬è·¯ç”±ã€é‰´æƒã€è´Ÿè½½å¹³è¡¡ç­‰ç­‰ã€‚æ§åˆ¶å¹³é¢çš„è§’è‰²å°±æ˜¯é€šè¿‡é…ç½®æ¥å‘Šè¯‰ Envoy åº”è¯¥åšä»€ä¹ˆã€‚&lt;/p&gt;
&lt;p&gt;Envoy å¤„ç†è¯·æ±‚çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ç¡®å®šå®ƒçš„ç›®çš„åœ°ã€‚ä¸ºæ­¤ï¼Œå®ƒä½¿ç”¨è™šæ‹Ÿä¸»æœºå’Œè·¯ç”±è¡¨ã€‚ç„¶åé€šè¿‡ä¸€ç³»åˆ—è¿‡æ»¤å™¨ (ç§°ä¸ºè¿‡æ»¤å™¨é“¾) å‘é€è¯·æ±‚ã€‚é“¾ä¸­çš„æ¯ä¸ªè¿‡æ»¤å™¨æ‰§è¡Œä¸åŒçš„æ“ä½œï¼ŒåŒ…æ‹¬ä¿®æ”¹è¯·æ±‚ã€ä¿æŒè¯·æ±‚ç›´åˆ°æŸä¸ªäº‹ä»¶å‘ç”Ÿã€æ‹’ç»è¯·æ±‚ç­‰ç­‰ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿‡æ»¤å™¨éœ€è¦ä»å¤–éƒ¨æœåŠ¡å™¨è·å–ä¿¡æ¯æ‰èƒ½æ‰§è¡Œå…¶ä»»åŠ¡ã€‚é“¾ä¸­çš„æœ€åä¸€ä¸ªè¿‡æ»¤å™¨ä¸€å®šæ˜¯è·¯ç”±å™¨è¿‡æ»¤å™¨ï¼Œå®ƒå‘ä¸Šæ¸¸å‘é€è¯·æ±‚ã€‚ä¸‹å›¾æè¿°äº†è¯·æ±‚é€šè¿‡ Envoy æ—¶æ‰€é‡‡å–çš„è·¯å¾„ç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å“åº”è¿”å›çš„è¿‡ç¨‹ä¸­ï¼Œå“åº”è¿˜èƒ½å¤Ÿä»é›†ç¾¤å‘å›ä¹‹å‰å†æ¬¡é€šè¿‡è¿‡æ»¤å™¨é“¾ã€‚åŒæ ·ï¼Œæ ¹æ®éœ€è¦ï¼Œè¿™äº›è¿‡æ»¤å™¨å¯èƒ½ä¸å¤–éƒ¨æœåŠ¡å™¨äº¤äº’ï¼Œä¹Ÿå¯èƒ½ä¸ä¸å¤–éƒ¨æœåŠ¡å™¨äº¤äº’ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-filter-chain&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/building-a-control-plane-for-envoy/006gLaqLly1g109jfa12cg30q10ia3zz.gif&#34; alt=&#34;filter chain&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      filter chain
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è®¾ç½®è¿‡æ»¤å™¨é“¾å’Œé…ç½®ä¸åŒçš„è¿‡æ»¤å™¨åŠå…¶å¤–éƒ¨æœåŠ¡å™¨æ˜¯æ§åˆ¶å¹³é¢çš„å·¥ä½œä¹‹ä¸€ã€‚ä½¿ç”¨ xDS API å°†æ­¤é…ç½®ä¿¡æ¯å‘é€ç»™ Envoyã€‚æ§åˆ¶å¹³é¢çš„èŒè´£æ˜¯ç¡®ä¿ Envoy æ€»æ˜¯å¾—åˆ°æ›´æ–°ï¼Œå¹¶å°†ä»»ä½•éœ€è¦æ›´æ”¹å…¶é…ç½®çš„æƒ…å†µé€šçŸ¥ Envoyã€‚ç”±äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­&lt;a href=&#34;https://queue.acm.org/detail.cfm?id=2745385&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;â€œæ²¡æœ‰ç°åœ¨â€&lt;/a&gt;ï¼ŒEnvoy çš„ç­–ç•¥æ˜¯éµå¾ªæœ€ç»ˆä¸€è‡´æ€§çš„é…ç½®æ¨¡å‹æ¥å¤„ç†é…ç½®æ›´æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰é…ç½®ä¿¡æ¯éƒ½ä»æ§åˆ¶å¹³é¢å¼‚æ­¥åœ°å‘é€åˆ° Envoyã€‚è¿™æ„å‘³ç€å½“ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå®ƒä¼šå‘ç° Envoy å·²ç»å®Œå…¨é…ç½®å¥½ï¼Œå¹¶ä¸”ä¸éœ€è¦ç­‰å¾…æ§åˆ¶å¹³é¢è¿›è¡Œå¹²é¢„ã€‚å› æ­¤ï¼Œä¸ä¼šå› ä¸ºæ§åˆ¶å¹³é¢æ“ä½œè€Œå¯¼è‡´å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€æ–¹é¢ï¼Œè¿‡æ»¤å™¨å’Œå®ƒä»¬ä½¿ç”¨çš„å¤–éƒ¨æœåŠ¡å™¨å¦‚æœç¡®å®ä½äºæ•°æ®è·¯å¾„ä¸Šï¼Œå¯èƒ½ä¼šå¯¼è‡´å»¶è¿Ÿã€‚å¯ä»¥é€šè¿‡ç¼“å­˜æ¥ç¼“è§£æ­¤ç±»æ½œåœ¨é—®é¢˜ï¼Œå¹¶ä¸”æ§åˆ¶å¹³é¢å¯ä»¥ä¸ºè¿™äº›æœåŠ¡è®¾ç½®è¶…æ—¶ã€‚ç„¶åå¯ä»¥ä½¿ç”¨è·Ÿè¸ªæ¥è¯Šæ–­ç”±è¿‡æ»¤å™¨å’ŒæœåŠ¡å™¨å¼•èµ·çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆé€‰æ‹©-envoy&#34;&gt;ä¸ºä»€ä¹ˆé€‰æ‹© Envoyï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Envoy çš„è®¸å¤šç‰¹æ€§ä»¥å‰å·²ç»è¯¦ç»†åœ°æè¿°è¿‡ (ä¾‹å¦‚ï¼Œ&lt;a href=&#34;https://blog.envoyproxy.io/the-universal-data-plane-api-d15cec7a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;å’Œ&lt;a href=&#34;https://blog.envoyproxy.io/envoy-graduates-a6f71879852e&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;)ã€‚å…¶ä¸­ï¼Œä»¥ä¸‹æ˜¯ä¸æˆ‘ä»¬æœ€ç›¸å…³çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Envoy æ˜¯éå¸¸å®¹æ˜“æ‰©å±•çš„ï¼Œä½¿æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†å…¶æ‰©å±•åˆ°æ–°çš„ç”¨ä¾‹ä¸­ (ç¨åå°†è¯¦ç»†ä»‹ç»)ã€‚&lt;/li&gt;
&lt;li&gt;å³ä½¿åœ¨å¿«é€Ÿè¿­ä»£çš„ Envoy ä¸­ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸ç¨³å®šçš„è½¯ä»¶ï¼Œå¸¦æœ‰å•å…ƒæµ‹è¯•ï¼Œé›†æˆæµ‹è¯•è¦†ç›–äº† 98% ä»¥ä¸Šçš„ä»£ç  (ç”± CI ä¿è¯)ã€‚&lt;/li&gt;
&lt;li&gt;æœ€é‡è¦çš„æ˜¯ï¼ŒEnvoy å¾—åˆ°äº†ç¤¾ä¼šçš„å¤§åŠ›æ”¯æŒã€‚å®ƒæ˜¯å‡ ä¸ªæˆåŠŸçš„æœåŠ¡ç½‘æ ¼é¡¹ç›® (åŒ…æ‹¬ Istio ) èƒŒåçš„é©±åŠ¨åŠ›ï¼Œå¹¶å—åˆ°ç”Ÿæ€ç³»ç»Ÿä¸­è®¸å¤šå…³é”®å‚ä¸è€… (å¦‚ Googleã€Pivotalã€Red Hat å’Œ IBM ) çš„è´¡çŒ®ã€‚Envoy ç¤¾åŒºå…·æœ‰çœŸæ­£çš„åˆä½œç²¾ç¥ï¼Œè¿™ä½¿å¾—ä¸ºè¯¥é¡¹ç›®ä½œå‡ºè´¡çŒ®æˆä¸ºä¸€ç§æœ‰ç›Šå’Œæ„‰å¿«çš„ç»å†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å®‰è£…å’Œé…ç½®&#34;&gt;å®‰è£…å’Œé…ç½®&lt;/h2&gt;
&lt;p&gt;æ—¢ç„¶å·²ç»äº†è§£äº† Envoy å¦‚ä½•å¤„ç†è¯·æ±‚å’Œå“åº”ï¼Œå¹¶ç¡®å®šäº†æ§åˆ¶å¹³é¢çš„è§’è‰²ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±å¼€å§‹ç ”ç©¶æ§åˆ¶å¹³é¢çš„è®¾è®¡ã€‚ä¸‹é¢å°†å‘ä½ æè¿°è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠçš„æŠ‰æ‹©ï¼Œå¹¶è§£é‡Šåœ¨è®¾è®¡ Gloo æ—¶æ‰€åšçš„æŠ‰æ‹©ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆè¦åšçš„æŠ‰æ‹©æ˜¯å¦‚ä½•éƒ¨ç½² Envoyã€‚Envoy å¯ä»¥éƒ¨ç½²åœ¨è™šæ‹Ÿæœºä¸­ï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨å®¹å™¨ä¸­ã€‚è¿™ä¸¤ç§é€‰é¡¹éƒ½æœ‰å„è‡ªçš„ä¼˜åŠ¿ï¼Œè€Œä¸” Gloo æ”¯æŒè¿™ä¸¤ç§é€‰é¡¹ï¼Œä»¥åŠå¤šä¸ªå®¹å™¨ç®¡ç†å¹³å°ã€‚ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåªå°† Envoy ä½œä¸ºä¸€ä¸ªç”± kubernetes ç®¡ç†çš„å®¹å™¨æ¥è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­ï¼ŒEnvoy é€šå¸¸ä½œä¸º Deployment (å…è®¸è¿è¡ŒæŒ‡å®šæ•°é‡çš„å®¹å™¨å¹¶å¯¹å…¶è¿›è¡Œå‘ä¸Šå’Œå‘ä¸‹ä¼¸ç¼©) æˆ–  DaemonSet (æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹åªè¿è¡Œä¸€ä¸ªå®¹å™¨) è¿è¡Œã€‚å®˜æ–¹ Envoy å®¹å™¨é•œåƒå¯ä»¥åœ¨&lt;a href=&#34;https://hub.docker.com/r/envoyproxy/envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº Glooï¼Œæˆ‘ä»¬é€‰æ‹©åœ¨é›†ç¾¤ä¸­ä½¿ç”¨ Kubernetes Deployment è¿è¡Œ Envoyã€‚ä¸ºäº†å‘å¤–ç•Œå…¬å¼€ Envoyï¼Œä½¿ç”¨ Kubernetes LoadBalancer æœåŠ¡ã€‚è¯¥æœåŠ¡æä¾›ä¸€ä¸ªç‰¹å®šäºäº‘çš„å¤–éƒ¨è´Ÿè½½å¹³è¡¡å™¨ï¼Œå°†æµé‡è½¬å‘ç»™ Envoy å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶ Envoy é€šå¸¸æ˜¯é€šè¿‡æ§åˆ¶å¹³é¢é…ç½®çš„ï¼Œä½†å®ƒç¡®å®éœ€è¦ä¸€äº›åˆå§‹é…ç½®ï¼Œåœ¨ Envoy æœ¯è¯­ä¸­ç§°ä¸º Bootstrap é…ç½®ã€‚è¯¥é…ç½®åŒ…å«å…³äºå¦‚ä½•è¿æ¥åˆ°æ§åˆ¶å¹³é¢ (ç®¡ç†æœåŠ¡å™¨)ã€å½“å‰ Envoy å®ä¾‹çš„æ ‡è¯†ã€è·Ÿè¸ªã€ç®¡ç†æ¥å£é…ç½®å’Œé™æ€èµ„æºçš„ä¿¡æ¯ (æœ‰å…³ Envoy èµ„æºçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ä¸‹é¢çš„ç®¡ç†éƒ¨åˆ†)ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æä¾› Envoy çš„ Bootstrap é…ç½®ï¼Œæˆ‘ä»¬ä½¿ç”¨ Kubernetes ConfigMap å¯¹è±¡ï¼Œè¿™æ˜¯åœ¨ Kubernetes ä¸­åˆ†å‘é…ç½®ä¿¡æ¯çš„å¸¸ç”¨æ–¹æ³•ã€‚æˆ‘ä»¬å°† ConfigMap ä½œä¸ºä¸€ä¸ªæ–‡ä»¶æŒ‚è½½åˆ° Envoy podï¼Œå®ƒå°†å¼•å¯¼é…ç½®æ–‡ä»¶ä¸å®¹å™¨è§£è€¦ã€‚åœ¨ Kubernetes ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¨¡æ¿è¿›è¡Œé…ç½®ï¼Œå¹¶ä¸ºæ¯ä¸ª Envoy å®ä¾‹ç”Ÿæˆä¸€ä¸ªæƒŸä¸€çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç‰¹å®šæ ‡è¯†ã€‚å…·æœ‰ç‰¹å®šäºå®ä¾‹çš„ ID æœ‰åŠ©äºæé«˜å¯è§‚å¯Ÿæ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦ Envoy å¯åŠ¨èµ·æ¥ä¹‹åï¼Œå®ƒå°±ä¼šè¿æ¥åˆ°ç®¡ç†æœåŠ¡å™¨ (å¦‚å¼•å¯¼é…ç½®ä¸­æŒ‡å®šçš„é‚£æ ·)ï¼Œä»¥å®Œæˆé…ç½®å¹¶ä¸æ–­æ›´æ–°å®ƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç®¡ç†&#34;&gt;ç®¡ç†&lt;/h2&gt;
&lt;p&gt;å¯ä»¥åœ¨ä¸åœæœºçš„æƒ…å†µä¸‹å®ç°å¯¹ Envoy çš„åŠ¨æ€é…ç½®ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼ŒEnvoy å®šä¹‰äº†ä¸€ç»„é€šå¸¸ç§°ä¸º xDS åè®®çš„ apiã€‚ä» Envoy çš„ v2 å¼€å§‹ï¼Œè¿™æ˜¯ä¸€ä¸ª gRPC æµé€šé“ï¼ŒEnvoy å°†ç›‘å¬æ¥è‡ªæ§åˆ¶å¹³é¢çš„é…ç½®æ›´æ–°ã€‚è¿™æ ·å¯ä»¥é…ç½® Envoy çš„ç»å¤§å¤šæ•°æ–¹é¢ã€‚è¿™äº›åŠ¨æ€èµ„æºåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Listener Discovery Serviceï¼ˆç›‘å¬å™¨å‘ç°æœåŠ¡ï¼‰â€”â€”é…ç½® Envoy ç›‘å¬çš„ç«¯å£ä»¥åŠå¯¹ä¼ å…¥è¿æ¥é‡‡å–æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;Cluster Discovery Serviceï¼ˆé›†ç¾¤å‘ç°æœåŠ¡ï¼‰â€”â€”é…ç½®ä¸Šæ¸¸é›†ç¾¤ã€‚Envoy å°†æŠŠä¼ å…¥çš„è¿æ¥/è¯·æ±‚è·¯ç”±åˆ°è¿™äº›é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;Route Discovery Serviceï¼ˆè·¯ç”±å‘ç°æœåŠ¡ï¼‰â€”â€”ä¸ºä¼ å…¥çš„è¯·æ±‚é…ç½® L7 è·¯ç”±ã€‚&lt;/li&gt;
&lt;li&gt;Endpoint Discovery Serviceï¼ˆç«¯ç‚¹æœåŠ¡å‘ç°ï¼‰â€”â€”å…è®¸ Envoy åŠ¨æ€åœ°å‘ç°é›†ç¾¤æˆå‘˜å’Œå¥åº·ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;Secret Discovery Serviceï¼ˆå¯†é’¥å‘ç°æœåŠ¡ï¼‰â€”â€”å…è®¸ Envoy å‘ç° ssl secretã€‚è¿™ç”¨äºç‹¬ç«‹äºç›‘å¬å™¨é…ç½® ssl secretï¼Œå¹¶å…è®¸ä»æœ¬åœ°èŠ‚ç‚¹è€Œä¸æ˜¯é›†ä¸­æ§åˆ¶å¹³é¢æä¾› ssl secretã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Gloo å®ç°äº†èšåˆæœåŠ¡å‘ç°åŠŸèƒ½ï¼Œç§°ä¸º ADSã€‚ADS å°†æ‰€æœ‰ xDS èµ„æºèšåˆåˆ°ä¸€ä¸ªæµé€šé“ä¸­ã€‚ä¹‹æ‰€ä»¥é€‰æ‹© ADS æ˜¯å› ä¸ºå®ƒä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œå¹¶ä¸”éœ€è¦ä» Envoy å®ä¾‹åˆ°ç®¡ç†æœåŠ¡å™¨çš„å•ä¸€è¿æ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯è§‚å¯Ÿæ€§å’Œæ•…éšœæ’æŸ¥&#34;&gt;å¯è§‚å¯Ÿæ€§å’Œæ•…éšœæ’æŸ¥&lt;/h2&gt;
&lt;p&gt;Envoy æä¾›è®¸å¤šç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸€ä¸ªè¿æ¥ç»Ÿè®¡ï¼Œå®ƒæŒ‡ç¤ºæ˜¯å¦è¿æ¥åˆ°å…¶ç®¡ç†çš„æœåŠ¡å™¨ã€‚è¿™äº›æ•°æ®å¯ä»¥è¢« Prometheus æ”¶é›†ï¼Œæˆ–è€…å‘é€åˆ° StatsDã€‚Envoy è¿˜å¯ä»¥å‘å‡º Zipkin è·Ÿè¸ªï¼ˆä»¥åŠå…¶ä»–è·Ÿè¸ªï¼Œå¦‚ Datadog å’Œ OpenTracingï¼‰ã€‚åœ¨ Gloo çš„ä¼ä¸šç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†è¿™äº›åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä½¿ç”¨é¢„å…ˆé…ç½®çš„ä»ªè¡¨æ¿éƒ¨ç½² Prometheus å’Œ Grafanaã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ gRPC APIï¼ˆä¸ä»¥å‰ç‰ˆæœ¬çš„ Envoy ä¸­å¯ç”¨çš„ REST API ç›¸æ¯”ï¼‰æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œä½†æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼šä¸ºäº†è°ƒè¯•ç›®çš„è€Œæ‰‹åŠ¨æŸ¥è¯¢æ¯”è¾ƒå›°éš¾ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼€å‘äº†ä¸€ä¸ªå®ç”¨ç¨‹åºæ¥æŸ¥è¯¢ç®¡ç†æœåŠ¡å™¨ï¼Œå¹¶åœ¨å°† xDS é…ç½®æäº¤ç»™ Envoy æ—¶æ‰“å°å‡ºæ¥ã€‚&lt;/p&gt;
&lt;p&gt;å½“å¤„ç†å¤æ‚çš„é…ç½®æ—¶å¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ã€‚å½“å‘ Envoy æä¾›æ— æ•ˆé…ç½®æ—¶ï¼Œå®ƒé€šè¿‡åœ¨ xDS åè®®ä¸­å‘é€ä¸€ä¸ª NACK é€šçŸ¥ç®¡ç†æœåŠ¡å™¨é”™è¯¯çŠ¶æ€ï¼ˆè¿™å¯èƒ½æ˜¯æš‚æ—¶çš„ï¼Œå› ä¸º Envoy éµå¾ªæœ€ç»ˆä¸€è‡´æ€§çš„é…ç½®æ¨¡å‹ï¼‰ã€‚åœ¨æˆ‘ä»¬çš„ä¼ä¸šç‰ˆ Gloo ä¸­ï¼Œæˆ‘ä»¬æ£€æµ‹è¿™äº› NACK å¹¶å°†å®ƒä»¬ä½œä¸ºæŒ‡æ ‡å…¬å¼€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯æ‰©å±•æ€§&#34;&gt;å¯æ‰©å±•æ€§&lt;/h2&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡å‘è¿‡æ»¤å™¨é“¾æ·»åŠ æ–°çš„è¿‡æ»¤å™¨æ¥æ‰©å±• Envoy è¡Œä¸ºï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚è¿™äº›è¿‡æ»¤å™¨å¯ä»¥ä¿®æ”¹è¯·æ±‚ã€å½±å“è·¯ç”±å’Œå‘å‡ºæŒ‡æ ‡ã€‚ä¸€äº›æœ‰è¶£çš„ Envoy è¿‡æ»¤å™¨åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ratelimitâ€”â€”é€Ÿç‡é™åˆ¶è¯·æ±‚ã€‚ä¸€æ—¦é€Ÿç‡è¶…è¿‡é™åˆ¶ï¼ŒEnvoy å°±ä¸ä¼šå‘ä¸Šä¼ é€’è¯·æ±‚ï¼Œè€Œæ˜¯è¿”å› 429 ç»™è°ƒç”¨è€…ã€‚&lt;/li&gt;
&lt;li&gt;Gzipâ€”â€”æ”¯æŒ Gzip ç¼–ç ï¼ŒåŠ¨æ€å‹ç¼©å“åº”ã€‚&lt;/li&gt;
&lt;li&gt;Bufferâ€”â€”ç¼“å†²åŒºåœ¨å°†è¯·æ±‚è½¬å‘åˆ°ä¸Šæ¸¸ä¹‹å‰å®Œæˆè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;ExtAuthzâ€”â€”å…è®¸å¯¹è¯·æ±‚è¿›è¡Œå¯é…ç½®çš„èº«ä»½éªŒè¯/æˆæƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨æ•°æ®è·¯å¾„ä¸Šæ‰©å±• Envoy çš„èƒ½åŠ›éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒå¤„ç†é€Ÿåº¦éå¸¸å¿«ï¼Œè€Œä¸éœ€è¦å°†è¯·æ±‚å‘é€åˆ°å…¶ä»–ä»£ç†ï¼Œä»è€Œå‡å°‘äº†å»¶è¿Ÿå¹¶æé«˜äº†æ•´ä½“æ€§èƒ½ã€‚æ§åˆ¶å¹³é¢å¯ä»¥åœ¨è¿è¡Œæ—¶å¯ç”¨æˆ–ç¦ç”¨è¿™äº›æ‰©å±•ï¼Œä»¥ç¡®ä¿æ•°æ®è·¯å¾„åªåŒ…å«æ‰€éœ€çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;Envoy çš„å¯æ‰©å±•è®¾è®¡å…è®¸æˆ‘ä»¬ä½¿ç”¨ä¸Šæ¸¸ Envoyï¼Œå¹¶é€šè¿‡æä¾›æˆ‘ä»¬å†…éƒ¨å¼€å‘çš„ä¸€ç³»åˆ—è¿‡æ»¤å™¨æ¥æ‰©å±•å®ƒã€‚æˆ‘ä»¬å¼€å‘çš„&lt;a href=&#34;https://github.com/solo-io/envoy-gloo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€äº›è¿‡æ»¤å™¨&lt;/a&gt;åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;AWSâ€”â€”å…è®¸ä½¿ç”¨ AWS v4 ç­¾åè°ƒç”¨ AWS Lambda å‡½æ•°è¿›è¡Œèº«ä»½éªŒè¯ã€‚&lt;/li&gt;
&lt;li&gt;NATS Streamingâ€”â€”å°† http è¯·æ±‚è½¬æ¢ä¸º NATS Streaming å‘å¸ƒã€‚&lt;/li&gt;
&lt;li&gt;Transformationâ€”â€”é«˜çº§è¯·æ±‚ä½“å’Œå¤´è½¬æ¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“è®¾è®¡ Gloo æ—¶ï¼Œæˆ‘ä»¬è¯•å›¾ä½¿å®ƒå…·æœ‰é«˜åº¦å¯æ‰©å±•æ€§ï¼Œå¹¶ä¸ Envoy å…±äº«ç›¸åŒçš„è®¾è®¡åŸåˆ™ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åŸºäºæ’ä»¶æ„å»ºäº† Gloo çš„ä½“ç³»ç»“æ„ã€‚é€šå¸¸ï¼ŒGloo ä¸ºæ¯ä¸ª Envoy è¿‡æ»¤å™¨æä¾›ä¸€ä¸ªæ’ä»¶ï¼Œè´Ÿè´£é…ç½®è¯¥è¿‡æ»¤å™¨ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿæ”¯æŒæ–°çš„ Envoy æ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.solo.io/glooe&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo Enterprise&lt;/a&gt; è¿˜åŒ…æ‹¬ä¸€ä¸ªç¼“å­˜è¿‡æ»¤å™¨ï¼Œä»¥åŠå¤–éƒ¨è®¤è¯å’Œé€Ÿç‡é™åˆ¶æœåŠ¡å™¨ (å°†åœ¨ä»¥åçš„åšå®¢æ–‡ç« ä¸­è®¨è®º)ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‡çº§å’Œå›æ»š&#34;&gt;å‡çº§å’Œå›æ»š&lt;/h2&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬å¼€å‘æ‰©å±•ç‰ˆ Envoy æ—¶ï¼Œä¸ä¸Šæ¸¸ Envoy ä¿æŒåŒæ­¥å¯¹æˆ‘ä»¬æ¥è¯´éå¸¸é‡è¦ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬çš„ä»£ç ä»“åº“ç›®å½•ç»“æ„å’Œ CI éå¸¸ç±»ä¼¼äº Envoy çš„ä»£ç ç›®å½•ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;Envoy master åˆ†æ”¯ä¸€ç›´è¢«è®¤ä¸ºæ˜¯ RC è´¨é‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ç»å¸¸ç¡®ä¿å¯ä»¥ä½¿ç”¨æœ€æ–°çš„ master åˆ†æ”¯ä»£ç æ„å»º Glooã€‚è¿™ç¡®ä¿æˆ‘ä»¬å§‹ç»ˆæ‹¥æœ‰æœ€æ–°çš„ Envoy ç‰¹æ€§å’Œä¼˜åŒ–ï¼Œå¹¶ä¸”åœ¨éœ€è¦å®‰å…¨æ›´æ–°æ—¶å¯ä»¥å¿«é€Ÿå“åº”ã€‚åœ¨æˆ‘ä»¬ä½¿ç”¨çš„ 32 ä¸ªæ ¸å¿ƒ CI ä¸Šæ„å»º Envoy å¤§çº¦éœ€è¦ 10 åˆ†é’Ÿã€‚&lt;/p&gt;
&lt;p&gt;å³ä½¿æ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡å’Œæµ‹è¯•çš„åº”ç”¨ç¨‹åºï¼Œåœ¨éƒ¨ç½²åˆ°ç”Ÿäº§ä¸­çš„å¤æ‚ç¯å¢ƒæ—¶ä¹Ÿå¯èƒ½é‡åˆ°é—®é¢˜ã€‚ä¸ºäº†é™ä½è¿™ç§é£é™©ï¼Œé€šå¸¸å»ºè®®é‡‡ç”¨é‡‘ä¸é›€éƒ¨ç½²æ–¹æ³•ï¼Œå³é¦–å…ˆå°†æ–°ç‰¹æ€§éƒ¨ç½²åˆ°ç”¨æˆ·æˆ–ç³»ç»Ÿçš„å­é›†ä¸­ï¼Œå¹¶åœ¨ä»”ç»†è§‚å¯Ÿä¹‹åæ‰å¹¿æ³›éƒ¨ç½²ã€‚ä½¿ç”¨ Glooï¼Œæˆ‘ä»¬åœ¨å‡ ä¸ªå±‚æ¬¡ä¸Šé‡‡ç”¨è¿™ç§æ–¹æ³•ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å…è®¸å°†é…ç½®çš„æ–°ç‰ˆæœ¬æœ€åˆéƒ¨ç½²åˆ°ä¸€å°éƒ¨åˆ† Envoy å®ä¾‹ï¼Œåœ¨è¿™äº›å®ä¾‹ä¸­æˆ‘ä»¬å¯ä»¥æµ‹è¯•é…ç½®ã€‚ç¬¬äºŒï¼Œå½“ Envoy çš„æ–°ç‰ˆæœ¬å¯ç”¨æ—¶ï¼Œæˆ‘ä»¬å°†é€æ­¥æ¨å‡ºè¿™ä¸ªæ–°ç‰ˆæœ¬ã€‚æœ€åï¼Œå½“æˆ‘ä»¬å‡†å¤‡å‘å¸ƒæ§åˆ¶å¹³é¢çš„æ–°ç‰ˆæœ¬æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆå°†æ–°ç‰ˆæœ¬è¿æ¥åˆ°å°‘é‡çš„ Envoy å®ä¾‹ï¼Œåœ¨è¿™äº›å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä»”ç»†éªŒè¯é¢„æœŸçš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶ Gloo ä½œä¸º Envoy çš„æ§åˆ¶å¹³é¢çš„è®¾è®¡ã€æˆ‘ä»¬æ‰€åšçš„ä½“ç³»ç»“æ„é€‰æ‹©ä»¥åŠå®ƒä»¬æ‰€ä»£è¡¨çš„æŠ˜è¡·ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Envoy Proxy æ„å»ºæ§åˆ¶å¹³é¢æŒ‡å—</title>
      <link>https://cloudnative.to/blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/</link>
      <pubDate>Wed, 06 Mar 2019 12:17:02 +0800</pubDate>
      <guid>https://cloudnative.to/blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://medium.com/solo-io/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh-badb6c36a2af&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼–è€…æ¡ˆ&#34;&gt;ç¼–è€…æ¡ˆ&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Envoy ä½œä¸ºæœ€å—æ¬¢è¿çš„æ—©æœŸç½‘ç»œç»„ä»¶ï¼Œç°åœ¨å·²ç»å¯ä»¥è¯´æ˜¯äº‘åŸç”Ÿæ¶æ„ä¸­çš„é€šç”¨æ•°æ®å¹³é¢ã€‚æœ¬æ–‡ä½œè€…æŒ‡å¼•æˆ‘ä»¬æ›´æ–¹ä¾¿çš„ä½¿ç”¨ Envoyï¼ŒåŠå…¶å®šåˆ¶æ§åˆ¶å¹³é¢ï¼Œä½œè€…é€šè¿‡æ”¶é›†åˆ°çš„æ•°æ®ç»™å‡ºå®šåˆ¶æ§åˆ¶å¹³é¢ä¸åŒçš„æ„è§ï¼Œéå¸¸ä¸­è‚¯ï¼Œåç»­ç³»åˆ—ä¼šæ›´æ·±å…¥ï¼Œæ¬¢è¿å…³æ³¨è¯¥ç³»åˆ—æ–‡ç« ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt; æœ€è¿‘æˆä¸ºä¸€ä¸ªå—æ¬¢è¿çš„ç½‘ç»œç»„ä»¶ã€‚å‡ å¹´å‰ Matt Klein &lt;a href=&#34;https://blog.envoyproxy.io/the-universal-data-plane-api-d15cec7a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å†™äº†ä¸€ç¯‡åšå®¢&lt;/a&gt; ï¼Œè®¨è®ºäº† Envoy çš„åŠ¨æ€é…ç½® APIï¼Œä»¥åŠ Envoy å‘å±•çš„å†å²å’ŒåŠ¨æœºã€‚ä»–ç§°è¯¥åšå®¢ä¸ºâ€œé€šç”¨æ•°æ®å¹³é¢ APIâ€ã€‚ç”±äºè®¸å¤šå…¶ä»–é¡¹ç›®é‡‡ç”¨&lt;a href=&#34;https://www.envoyproxy.io/community&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt; ä½œä¸ºå…¶äº§å“çš„æ ¸å¿ƒç»„ä»¶ï¼Œå› æ­¤å¯¹äºåº”ç”¨ç¨‹åº/L7 ç½‘ç»œè§£å†³æ–¹æ¡ˆè€Œè¨€ï¼Œæ¯«ä¸å¤¸å¼ åœ°è¯´ï¼Œâ€œEnvoy å·²æˆä¸ºäº‘åŸç”Ÿæ¶æ„ä¸­çš„é€šç”¨æ•°æ®å¹³é¢â€ï¼Œè€Œä¸ä»…ä»…æ˜¯ç®€å•å»ºç«‹äº† API æ ‡å‡†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mfoc0c9yj20dm07faap_hudf23e0a428ceb7a0c01878aedbbc47fc_15451_c91ac818338e3d55a41cea949ede3621.webp 400w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mfoc0c9yj20dm07faap_hudf23e0a428ceb7a0c01878aedbbc47fc_15451_cd646d9b07cfb1446de34f629b79e62f.webp 760w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mfoc0c9yj20dm07faap_hudf23e0a428ceb7a0c01878aedbbc47fc_15451_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mfoc0c9yj20dm07faap_hudf23e0a428ceb7a0c01878aedbbc47fc_15451_c91ac818338e3d55a41cea949ede3621.webp&#34;
               width=&#34;490&#34;
               height=&#34;267&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œç”±äº &lt;a href=&#34;https://blog.envoyproxy.io/the-universal-data-plane-api-d15cec7a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy çš„é€šç”¨æ•°æ®å¹³é¢ API&lt;/a&gt; ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†è®¸å¤š &lt;em&gt;ç®¡ç†å±‚&lt;/em&gt; çš„å®ç°ï¼Œç”¨äºé…ç½®å’Œé©±åŠ¨åŸºäº Envoy çš„åŸºç¡€æ¶æ„ã€‚æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ä¸º Envoy æ„å»ºæ§åˆ¶å¹³é¢æ‰€éœ€çš„å†…å®¹ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä½¿ç”¨æ­¤ä¿¡æ¯æ¥è¯„ä¼°å“ªç§ç±»å‹çš„åŸºç¡€æ¶æ„æœ€é€‚åˆæ‚¨çš„ç»„ç»‡å’Œä½¿ç”¨æƒ…å†µã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªå¹¿æ³›çš„ä¸»é¢˜ï¼Œæˆ‘ä»¬å°†åœ¨æœªæ¥å‡ å¤©å‘å¸ƒçš„å¤šéƒ¨ç³»åˆ—åšå®¢ä¸­è§£å†³å®ƒã€‚&lt;/p&gt;
&lt;p&gt;åœ¨EnvoyCon/KubeConä¸Š æœ‰ä¸€äº› &lt;a href=&#34;https://blog.envoyproxy.io/envoycon-recap-579d53576511&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç²¾å½©çš„æ¼”è®²&lt;/a&gt; ï¼Œä¸€äº›ç»„ç»‡åˆ†äº«äº†ä»–ä»¬é‡‡ç”¨ Envoy çš„ç»éªŒï¼ŒåŒ…æ‹¬ä»–ä»¬å¦‚ä½•æ„å»ºè‡ªå·±çš„æ§åˆ¶å¹³é¢ã€‚äººä»¬é€‰æ‹©è‡ªå·±å»ºç«‹æ§åˆ¶å¹³é¢çš„ä¸€äº›åŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç°æœ‰çš„è§£å†³æ–¹æ¡ˆï¼Œå»ºç«‹åœ¨å·²æœ‰ä¸åŒæ•°æ®å¹³é¢çš„æ§åˆ¶å¹³é¢ï¼Œéœ€è¦æ”¹é€  Envoyï¼ˆä¸å·²æœ‰æ–¹æ¡ˆä¸”å†²çªï¼‰&lt;/li&gt;
&lt;li&gt;ä¸ºæ²¡æœ‰ä»»ä½•ç°æœ‰å¼€æºæˆ–å…¶ä»– Envoy æ§åˆ¶å¹³é¢ï¼ˆå³ VMï¼ŒAWS ECS ç­‰ï¼‰çš„åŸºç¡€æ¶æ„æ„å»ºï¼ˆå•†ä¸šå…¬å¸å¿…é¡»é‡æ–°å»ºæ–¹æ¡ˆï¼‰&lt;/li&gt;
&lt;li&gt;ä¸éœ€è¦ä½¿ç”¨ Envoy çš„æ‰€æœ‰åŠŸèƒ½; åªæ˜¯ä¸€ä¸ªå­é›†ï¼ˆåŠŸèƒ½å¤ªå¤šï¼Œéœ€è¦ç²¾ç®€ï¼‰&lt;/li&gt;
&lt;li&gt;é¦–é€‰é€‚ç”¨äºEnvoyé…ç½®çš„ç‰¹å®šäºåŸŸçš„API/å¯¹è±¡æ¨¡å‹ï¼Œä»¥æ›´å¥½åœ°é€‚åº”å…¶å·¥ä½œæµç¨‹/ä¸–ç•Œè§‚ï¼ˆä¸å·²æœ‰æ–¹æ¡ˆå†²çªï¼‰&lt;/li&gt;
&lt;li&gt;å½“å…¶ç»„ç»‡å‡†å¤‡éƒ¨ç½²æ—¶ï¼Œæš‚æ—¶æ²¡æœ‰æˆç†Ÿçš„æ§åˆ¶å¹³é¢ï¼ˆèµ°çš„å¤ªå¿«ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mforyrc1j20go0digsn_hu3c7deadaadec3420292b0bd4d3791232_27465_cd80eb3cb2c00853e4334ab99462a35d.webp 400w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mforyrc1j20go0digsn_hu3c7deadaadec3420292b0bd4d3791232_27465_1dee8e2b8ce7931aa66d6016b538ce69.webp 760w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mforyrc1j20go0digsn_hu3c7deadaadec3420292b0bd4d3791232_27465_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mforyrc1j20go0digsn_hu3c7deadaadec3420292b0bd4d3791232_27465_cd80eb3cb2c00853e4334ab99462a35d.webp&#34;
               width=&#34;600&#34;
               height=&#34;486&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è‹¥æ˜¯å› ä¸ºä¸€äº›æ—©æœŸé‡‡ç”¨è€…å»ºç«‹äº†ä»–ä»¬è‡ªå·±çš„å®šåˆ¶æ§åˆ¶å¹³é¢ï¼Œå¹¶ä¸æ„å‘³ç€ä½ ç°åœ¨ä¹Ÿè¦è‡ªå·±é‡æ–°å¼€å‘æ§åˆ¶å¹³é¢ã€‚å› ä¸º Envoy æ„å»ºæ§åˆ¶å¹³é¢çš„é¡¹ç›®åœ¨å»å¹´å·²ç»æˆç†Ÿäº†å¾ˆå¤šï¼Œè‹¥ä½ å†³å®šé‡æ–°å¼€å‘å¦ä¸€ä¸ªæ§åˆ¶å¹³é¢å‰ä½ åº”è¯¥æ¢ç´¢ä½¿ç”¨å®ƒä»¬ã€‚å…¶æ¬¡ï¼Œæ­£å¦‚ Datawire çš„äººä»¬å‘ç°çš„é‚£æ ·ï¼Œ&lt;a href=&#34;https://twitter.com/danielbryantuk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸¹å°¼å°”Â·å¸ƒè±æ©ç‰¹&lt;/a&gt; æœ€è¿‘æ˜ç¡®è¡¨ç¤ºï¼Œ &lt;a href=&#34;https://www.infoq.com/articles/ambassador-api-gateway-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸º Envoy å»ºé€ ä¸€ä¸ªæ§åˆ¶å¹³é¢å¹¶ä¸é€‚åˆèƒ†å°çš„äºº&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.solo.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘å‚ä¸&lt;/a&gt; äº† &lt;a href=&#34;https://github.com/istio/istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‡ ä¸ª&lt;/a&gt;ä¸º Envoy æ„å»ºæ§åˆ¶å¹³é¢çš„&lt;a href=&#34;https://github.com/solo-io/gloo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼€æºé¡¹ç›®&lt;/a&gt; ã€‚ä¾‹å¦‚ï¼Œ &lt;a href=&#34;https://gloo.solo.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo&lt;/a&gt; æ˜¯ &lt;a href=&#34;https://medium.com/solo-io/announcing-gloo-the-function-gateway-3f0860ef6600&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€ä¸ªåŠŸèƒ½ç½‘å…³&lt;/a&gt; ï¼Œå¯ä»¥å……å½“éå¸¸å¼ºå¤§çš„ Kubernetes å…¥å£ï¼ŒAPI ç½‘å…³æˆ–åŠŸèƒ½ç½‘å…³ï¼Œä»¥ç®€åŒ–å•ä½“åº”ç”¨åˆ°å¾®æœåŠ¡çš„è¿‡æ¸¡ã€‚Gloo &lt;a href=&#34;https://gloo.solo.io/introduction/architecture/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ‰ä¸€ä¸ª Envoy çš„æ§åˆ¶å¹³é¢&lt;/a&gt; ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸€ç³»åˆ—çš„å¸–å­ä¸­ä½œä¸ºä¸€ä¸ªä¾‹å­æ¥è¯´æ˜å¦‚ä½•æ„å»ºä¸€ä¸ªç®€å•çš„æŠ½è±¡ï¼Œå…è®¸åœ¨ä½ éœ€è¦çš„æ§åˆ¶ç‚¹ä¸Šå®ç°å¯æ’æ‹”æ€§å’Œå¯æ‰©å±•æ€§ã€‚æ‚¨å¯ä»¥ç”¨ä½œå‚è€ƒçš„å…¶ä»–å¯é çš„æ§åˆ¶å¹³é¢å®ç°æ˜¯ &lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/heptio/contour&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Heptio Contour&lt;/a&gt; æˆ‘ä»¬å°†åœ¨æ•´ä¸ªç³»åˆ—åšå®¢ä¸­ä½¿ç”¨è¿™äº›ä½œä¸ºå¾ˆå¥½çš„ä¾‹å­ã€‚å¦‚æœä¸å‡ºæ„å¤–ï¼Œæ‚¨å¯ä»¥äº†è§£ Envoy æ§åˆ¶å¹³é¢å­˜åœ¨å“ªäº›é€‰é¡¹ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥æŒ‡å¯¼æ‚¨çš„å®æ–½ï¼Œå¦‚æœæ‚¨å¿…é¡»èµ°è¿™æ¡è·¯ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mfpbj0hgj21200a840t_huab0a507186fa5a10cd67b572566ae990_32013_183fc367a0f388b9f88a16a960fc674c.webp 400w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mfpbj0hgj21200a840t_huab0a507186fa5a10cd67b572566ae990_32013_89ba3fee9898b8ca9058204ce5ec01a1.webp 760w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mfpbj0hgj21200a840t_huab0a507186fa5a10cd67b572566ae990_32013_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mfpbj0hgj21200a840t_huab0a507186fa5a10cd67b572566ae990_32013_183fc367a0f388b9f88a16a960fc674c.webp&#34;
               width=&#34;760&#34;
               height=&#34;204&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªåšå®¢ç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡‡ç”¨åŠ¨æ€æ›´æ–°æœºåˆ¶çš„ Envoy è·¯ç”±ã€æœåŠ¡å‘ç°å’Œå…¶ä»–é…ç½®&lt;/li&gt;
&lt;li&gt;ç¡®å®šæ„æˆæ§åˆ¶å¹³é¢çš„ç»„ä»¶ï¼ŒåŒ…æ‹¬åç«¯å­˜å‚¨ã€æœåŠ¡å‘ç° APIã€å®‰å…¨ç»„ä»¶ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºæ‚¨å’Œç»„ç»‡æœ€é€‚åˆçš„ç”¨ä¾‹ï¼Œå»ºç«‹ä»»ä½•ç‰¹å®šäºåŸŸçš„é…ç½®å¯¹è±¡å’Œ API&lt;/li&gt;
&lt;li&gt;è€ƒè™‘å¦‚ä½•æœ€å¥½åœ°å°†æ§åˆ¶å¹³é¢æ’å…¥æ‚¨éœ€è¦çš„åœ°æ–¹&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²å„ç§æ§åˆ¶å¹³é¢ç»„ä»¶çš„é€‰é¡¹&lt;/li&gt;
&lt;li&gt;é€šè¿‡æ§åˆ¶å¹³é¢çš„æµ‹è¯•å·¥å…·è¿›è¡Œæ€è€ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†å¼€å§‹è¿™ä¸ªç³»åˆ—ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä½¿ç”¨ Envoy çš„åŠ¨æ€é…ç½® API åœ¨è¿è¡Œæ—¶æ›´æ–° Envoy ä»¥å¤„ç†æ‹“æ‰‘å’Œéƒ¨ç½²çš„å˜åŒ–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-xds-api-åŠ¨æ€é…ç½®-envoy&#34;&gt;ä½¿ç”¨ xDS API åŠ¨æ€é…ç½® Envoy&lt;/h2&gt;
&lt;p&gt;æ„å»ºåœ¨ Envoy ä¹‹ä¸Šçš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€æ˜¯å®ƒçš„æ•°æ®å¹³é¢ APIã€‚ä½¿ç”¨æ•°æ®å¹³é¢ APIï¼Œæˆ‘ä»¬å¯ä»¥ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/intro/arch_overview/dynamic_configuration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ¨æ€é…ç½® Envoy çš„å¤§éƒ¨åˆ†é‡è¦è¿è¡Œæ—¶è®¾ç½®&lt;/a&gt; ã€‚Envoy é€šè¿‡å…¶ xDS API çš„é…ç½® &lt;a href=&#34;https://blog.envoyproxy.io/embracing-eventual-consistency-in-soa-networking-32a5ee5d443d&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ€ç»ˆä¸€è‡´çš„&lt;/a&gt; â€Š- å³æ— æ³•å½±å“é›†ç¾¤ä¸­æ‰€æœ‰ä»£ç†çš„â€œåŸå­æ›´æ–°â€ã€‚å½“æ§åˆ¶å¹³é¢å…·æœ‰é…ç½®æ›´æ–°æ—¶ï¼Œå®ƒé€šè¿‡ xDS API ä½¿å®ƒä»¬å¯ç”¨äºæ•°æ®å¹³é¢ä»£ç†ï¼Œå¹¶ä¸”æ¯ä¸ªä»£ç†å°†å½¼æ­¤ç‹¬ç«‹åœ°åº”ç”¨è¿™äº›æ›´æ–°ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ xDS åŠ¨æ€é…ç½®çš„ Envoy è¿è¡Œæ—¶æ¨¡å‹çš„éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/configuration/listeners/lds#config-listeners-lds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç›‘å¬å™¨å‘ç°æœåŠ¡ API -&lt;/a&gt; ç”¨äºå‘å¸ƒç›‘å¬æµé‡çš„ç«¯å£çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/configuration/listeners/lds#config-listeners-lds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;LDS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/api-v2/api/v2/eds.proto#envoy-api-file-envoy-api-v2-eds-proto&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç«¯ç‚¹å‘ç°æœåŠ¡ API-&lt;/a&gt; ç”¨äºæœåŠ¡å‘ç°çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/api-v2/api/v2/eds.proto#envoy-api-file-envoy-api-v2-eds-proto&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EDS&lt;/a&gt; ï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/configuration/http_conn_man/rds#config-http-conn-man-rds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯ç”±å‘ç°æœåŠ¡ API-RDS&lt;/a&gt; ç”¨äºæµé‡è·¯ç”±å†³ç­–&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/configuration/cluster_manager/cds#config-cluster-manager-cds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›†ç¾¤å‘ç°æœåŠ¡ -&lt;/a&gt; ç”¨äºåç«¯æœåŠ¡çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/configuration/cluster_manager/cds#config-cluster-manager-cds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CDS&lt;/a&gt; ï¼Œæˆ‘ä»¬å¯ä»¥å°†æµé‡è·¯ç”±åˆ°è¯¥æœåŠ¡&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/configuration/secret&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;secret å‘ç°æœåŠ¡ -&lt;/a&gt; ç”¨äºåˆ†å‘ Secret çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/configuration/secret&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SDS&lt;/a&gt; ï¼ˆè¯ä¹¦å’Œå¯†é’¥ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mfpqxtkyj20p00gm0yz_hu9700f3d9a54b517b437d0920a63f481f_49063_454788bf8a3cc1fa780a453da731b3aa.webp 400w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mfpqxtkyj20p00gm0yz_hu9700f3d9a54b517b437d0920a63f481f_49063_5254b90792886642630e560d59ec4b61.webp 760w,
               /blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mfpqxtkyj20p00gm0yz_hu9700f3d9a54b517b437d0920a63f481f_49063_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/guidance-for-building-a-control-plane-to-manage-envoy-proxy-at-the-edge-as-a-gateway-or-in-a-mesh/61411417ly1g0mfpqxtkyj20p00gm0yz_hu9700f3d9a54b517b437d0920a63f481f_49063_454788bf8a3cc1fa780a453da731b3aa.webp&#34;
               width=&#34;760&#34;
               height=&#34;505&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;API ä½¿ç”¨ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/configuration/overview/v2_overview#config-overview-v2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;proto3 Protocol Buffers&lt;/a&gt; å®šä¹‰ï¼Œç”šè‡³è¿˜æœ‰ä¸€äº›å‚è€ƒå®ç°å¯ç”¨äºå¼•å¯¼æ‚¨è‡ªå·±çš„æ§åˆ¶å¹³é¢ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/envoyproxy/go-control-plane&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;go æ§åˆ¶å¹³é¢&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/envoyproxy/java-control-plane&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;java çš„æ§åˆ¶å¹³é¢&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è™½ç„¶è¿™äº›é¢†åŸŸï¼ˆLDS/EDS/RDS/CDS/SDSï¼Œä¸€èµ·â€œxDSâ€ï¼‰ä¸­çš„æ¯ä¸€ä¸ªéƒ½æ˜¯åŠ¨æ€å¯é…ç½®çš„ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æ‚¨å¿…é¡»åŠ¨æ€é…ç½®æ‰€æœ‰å†…å®¹ã€‚æ‚¨å¯ä»¥æ‹¥æœ‰é™æ€å®šä¹‰çš„éƒ¨åˆ†ç»„åˆä»¥åŠåŠ¨æ€æ›´æ–°çš„éƒ¨åˆ†ç»„åˆã€‚ä¾‹å¦‚ï¼Œè¦å®ç°ä¸€ç§ &lt;code&gt;endpoints&lt;/code&gt; é¢„æœŸä¸ºåŠ¨æ€ä½† &lt;code&gt;clusters&lt;/code&gt; åœ¨éƒ¨ç½²æ—¶ä¼—æ‰€å‘¨çŸ¥ çš„æœåŠ¡å‘ç°ç±»å‹ï¼Œæ‚¨å¯ä»¥é™æ€å®šä¹‰ &lt;code&gt;clusters&lt;/code&gt; å¹¶ä½¿ç”¨ Envoy ä¸­ çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/api-v2/api/v2/eds.proto#envoy-api-file-envoy-api-v2-eds-proto&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç«¯ç‚¹å‘ç°æœåŠ¡&lt;/a&gt; ã€‚å¦‚æœæ‚¨ä¸ç¡®å®šåœ¨éƒ¨ç½²æ—¶å°†ä½¿ç”¨å“ªäº› &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/intro/arch_overview/terminology&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸Šæ¸¸é›†ç¾¤ï¼Œ&lt;/a&gt; åˆ™å¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.9.0/configuration/cluster_manager/cds#config-cluster-manager-cds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›†ç¾¤å‘ç°æœåŠ¡&lt;/a&gt; åŠ¨æ€åœ°æ‰¾åˆ°é‚£äº›ã€‚å…³é”®æ˜¯ï¼Œæ‚¨å¯ä»¥æ„å»ºä¸€ä¸ªå·¥ä½œæµç¨‹å’Œæµç¨‹ï¼Œé™æ€é…ç½®æ‚¨éœ€è¦çš„éƒ¨åˆ†ï¼ŒåŒæ—¶ä½¿ç”¨åŠ¨æ€ xDS æœåŠ¡æ¥å‘ç°è¿è¡Œæ—¶æ‰€éœ€çš„éƒ¨åˆ†ã€‚æ‚¨çœ‹åˆ°ä¸åŒçš„æ§åˆ¶å¹³é¢å®ç°çš„åŸå› ä¹‹ä¸€å¹¶ä¸æ˜¯æ¯ä¸ªäººéƒ½æœ‰ä¸€ä¸ªå®Œå…¨åŠ¨æ€å’Œå¯äº’æ¢çš„ç¯å¢ƒï¼Œå…¶ä¸­æ‰€æœ‰éƒ¨åˆ†éƒ½åº”è¯¥æ˜¯åŠ¨æ€çš„ã€‚åœ¨ç»™å®šç°æœ‰çº¦æŸå’Œå¯ç”¨å·¥ä½œæµç¨‹çš„æƒ…å†µä¸‹ï¼Œé‡‡ç”¨æœ€é€‚åˆæ‚¨ç³»ç»Ÿçš„åŠ¨æ€çº§åˆ«ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Gloo çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨&lt;a href=&#34;https://github.com/solo-io/gloo/blob/ac3bddf202423b297fb909eb6eff498745a8c015/projects/gloo/pkg/xds/envoy.go#L76&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸºäº go-control-plane çš„æ§åˆ¶å¹³é¢&lt;/a&gt; æ¥å®ç° xDS API ä»¥æœåŠ¡ Envoy çš„åŠ¨æ€é…ç½®ã€‚ä¸ Heptio Contour ä¸€æ ·ï¼ŒIstio ä¹Ÿä½¿ç”¨æ­¤å®ç°ã€‚æ­¤æ§åˆ¶å¹³é¢ API åˆ©ç”¨ &lt;a href=&#34;https://grpc.io/docs/guides/concepts.html#server-streaming-rpc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC æµ&lt;/a&gt; è°ƒç”¨å’Œå­˜æ ¹ APIï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨å®ç°å¡«å……å®ƒã€‚ &lt;a href=&#34;https://github.com/turbinelabs/rotor&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt; Turbine Labsâ€™Rotor é¡¹ç›®&lt;/a&gt; æ˜¯å¦ä¸€ä¸ªä¸å¹¸è¢«å¼ƒç”¨ä½†å¯ä»¥ç”¨æ¥å­¦ä¹ çš„&lt;a href=&#34;https://github.com/turbinelabs/rotor&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é¡¹ç›®&lt;/a&gt; ã€‚è¿™æ˜¯å°† Envoy çš„æ•°æ®å¹³é¢ API ä¸æ§åˆ¶å¹³é¢é›†æˆçš„é«˜æ•ˆæ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;gRPC æµä¸æ˜¯æ›´æ–° Envoy é…ç½®çš„å”¯ä¸€æ–¹å¼ã€‚åœ¨&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.5.0/api-v1/api&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»¥å‰ç‰ˆæœ¬çš„ Envoy xDS API ä¸­&lt;/a&gt; ï¼Œè½®è¯¢æ˜¯ç¡®å®šæ–°é…ç½®æ˜¯å¦å¯ç”¨çš„å”¯ä¸€é€‰é¡¹ã€‚è™½ç„¶è¿™æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå¹¶ä¸”ç¬¦åˆâ€œæœ€ç»ˆä¸€è‡´â€é…ç½®æ›´æ–°çš„æ ‡å‡†ï¼Œä½†å®ƒåœ¨ç½‘ç»œå’Œè®¡ç®—ä½¿ç”¨æ–¹é¢æ•ˆç‡éƒ½è¾ƒä½ã€‚ä¹Ÿå¯èƒ½éš¾ä»¥é€‚å½“åœ°è°ƒæ•´è½®è¯¢é…ç½®ä»¥å‡å°‘æµªè´¹çš„èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œä¸€äº› Envoy ç®¡ç†å®æ–½é€‰æ‹©ç”Ÿæˆ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/overview/v2_overview#static&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é™æ€ Envoy é…ç½®æ–‡ä»¶ï¼Œ&lt;/a&gt; å¹¶å®šæœŸæ›¿æ¢ Envoy ç£ç›˜ä¸Šçš„é…ç½®æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œ &lt;a href=&#34;https://blog.envoyproxy.io/envoy-hot-restart-1d16b14555b5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy è¿›ç¨‹&lt;/a&gt; çš„ &lt;a href=&#34;https://blog.envoyproxy.io/envoy-hot-restart-1d16b14555b5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çƒ­é‡æ–°åŠ è½½&lt;/a&gt; ã€‚åœ¨é«˜åº¦åŠ¨æ€çš„ç¯å¢ƒä¸­ï¼ˆå¦‚ Kubernetesï¼Œä½†å®é™…ä¸Šæ˜¯ä»»ä½•åŸºäº ephemeral-compute çš„å¹³å°ï¼‰ï¼Œæ­¤æ–‡ä»¶ç”Ÿæˆï¼Œäº¤ä»˜ï¼Œçƒ­é‡å¯ç­‰çš„ç®¡ç†å¯èƒ½å˜å¾—éš¾ä»¥å¤„ç†ã€‚Envoy æœ€åˆæ˜¯åœ¨ä¸€ä¸ªæ‰§è¡Œæ­¤ç±»æ›´æ–°çš„ç¯å¢ƒä¸­è¿è¡Œçš„ï¼ˆLyftï¼Œå®ƒæ˜¯åœ¨å“ªé‡Œåˆ›å»ºçš„ï¼‰ï¼Œä½†å®ƒä»¬é€æ¸è½¬å‘ä½¿ç”¨ xDS APIã€‚&lt;/p&gt;
&lt;h2 id=&#34;takeaway&#34;&gt;Takeaway&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/solo-io/gloo/graphs/contributors&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo å›¢é˜Ÿ&lt;/a&gt; è®¤ä¸ºä½¿ç”¨ gRPC æµå’Œ xDS API æ˜¯å®ç° Envoy åŠ¨æ€é…ç½®å’Œæ§åˆ¶çš„ç†æƒ³æ–¹å¼ã€‚åŒæ ·ï¼Œå¦‚æœæ‚¨ä¸éœ€è¦ï¼Œå¹¶éæ‰€æœ‰ Envoy é…ç½®éƒ½åº”åŠ¨æ€æä¾›ï¼Œä½†æ˜¯å¦‚æœæ‚¨åœ¨é«˜åº¦åŠ¨æ€çš„ç¯å¢ƒä¸­è¿è¡Œï¼ˆä¾‹å¦‚ï¼ŒKubernetesï¼‰ï¼Œåˆ™åŠ¨æ€é…ç½® Envoy çš„é€‰é¡¹è‡³å…³é‡è¦ã€‚å…¶ä»–ç¯å¢ƒå¯èƒ½æ²¡æœ‰è¿™ç§éœ€æ±‚ã€‚æ— è®ºå“ªç§æ–¹å¼ï¼ŒåŠ¨æ€çš„ gâ€‹â€‹RPC æµ API éƒ½æ˜¯ç†æƒ³çš„é€‰æ‹©ã€‚è¿™ç§æ–¹æ³•çš„ä¸€äº›å¥½å¤„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº‹ä»¶é©±åŠ¨çš„é…ç½®æ›´æ–°; å½“é…ç½®åœ¨æ§åˆ¶å¹³é¢ä¸­å¯ç”¨æ—¶ï¼Œé…ç½®è¢«æ¨é€åˆ° Envoy&lt;/li&gt;
&lt;li&gt;æ— éœ€è½®è¯¢æ›´æ”¹&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰å¿…è¦çƒ­åŠ è½½ Envoy&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰ä¸­æ–­æµé‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆ&#34;&gt;ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆ&lt;/h2&gt;
&lt;p&gt;åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä»‹ç» xDS API ä»¥åŠä¸º Envoy æä¾›åŠ¨æ€é…ç½®çš„ä¸åŒé€‰é¡¹ï¼Œä¸ºå¦‚ä½•ä¸º Envoy æ„å»ºæ§åˆ¶å¹³é¢å»ºç«‹äº†ä¸€äº›åŸºæœ¬èƒŒæ™¯ã€‚åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸­ï¼Œå°†åœ¨å‡ å¤©å†…å‘å¸ƒï¼Œå°†æ¶µç›–å°†æ‚¨çš„æ§åˆ¶å¹³é¢åˆ†è§£ä¸ºå¯éƒ¨ç½²ç»„ä»¶ï¼Œç¡®å®šæ‚¨éœ€è¦å“ªäº›éƒ¨åˆ†ï¼Œç‰¹å®šäºåŸŸçš„é…ç½®å¯¹è±¡æ¨¡å‹ï¼Œä»¥åŠå¦‚ä½•è€ƒè™‘æ§ä»¶çš„å¯æ’æ‹”æ€§å¹³é¢ã€‚å…³æ³¨ twitterï¼ˆ &lt;a href=&#34;https://twitter.com/christianposta&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@christianposta&lt;/a&gt; ï¼Œ &lt;a href=&#34;https://twitter.com/soloio_inc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@ solio_in&lt;/a&gt; ï¼‰æˆ–åšå®¢ï¼ˆ &lt;a href=&#34;https://medium.com/solo-io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://medium.com/solo-io&lt;/a&gt; ï¼‰&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Envoy æ¶æ„å¸ˆ Matt Klein å¯¹ Envoy çº¿ç¨‹æ¨¡å‹çš„ç®€ä»‹</title>
      <link>https://cloudnative.to/blog/envoy-threading-model/</link>
      <pubDate>Wed, 20 Feb 2019 20:17:12 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-threading-model/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://blog.envoyproxy.io/envoy-threading-model-a8d44b922310&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç¼–è€…æ³¨ï¼šåŸæ–‡äº 2017 å¹´ 7 æœˆ 30 æ—¥å‘å¸ƒäº Envoy åšå®¢ä¸Šã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…³äº Envoy ä»£ç åº“çš„åº•å±‚æŠ€æœ¯æ–‡æ¡£ç›®å‰ç›¸å½“ç¨€å°‘ã€‚ä¸ºäº†çº æ­£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ‰“ç®—åšä¸€ç³»åˆ—å…³äºå„ç§å­ç³»ç»Ÿçš„åšå®¢æ–‡ç« ã€‚ç”±äºè¿™æ˜¯ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œè¯·è®©æˆ‘çŸ¥é“æ‚¨çš„æƒ³æ³•ä»¥åŠæ‚¨å¸Œæœ›äº†è§£çš„å…¶ä»–ä¸»é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ç»å¸¸çœ‹åˆ°çš„å…³äº Envoy çš„æœ€å¸¸è§æŠ€æœ¯é—®é¢˜ä¹‹ä¸€å°±æ˜¯è¦æ±‚ä»åº•å±‚æè¿° Envoy ä½¿ç”¨çš„çº¿ç¨‹æ¨¡å‹ã€‚è¿™ç¯‡æ–‡ç« å°†ä»‹ç» Envoy å¦‚ä½•å°†è¿æ¥æ˜ å°„åˆ°çº¿ç¨‹ï¼Œä»¥åŠå†…éƒ¨ä½¿ç”¨çš„çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆTLSï¼‰ç³»ç»Ÿçš„æè¿°ï¼Œä»¥ä½¿ä»£ç æå…¶å¹¶è¡Œä¸”æ€§èƒ½æ›´é«˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;çº¿ç¨‹æ¨¡å‹æ¦‚è§ˆ&#34;&gt;çº¿ç¨‹æ¨¡å‹æ¦‚è§ˆ&lt;/h3&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-threading-model/5f3e3349gy1g0c5di41ayj218g10ewm0_hu72eff6473f02651f50aa3ab6fdcf151e_61685_695a58eee8ca4f704f2b87d72e5bfe4d.webp 400w,
               /blog/envoy-threading-model/5f3e3349gy1g0c5di41ayj218g10ewm0_hu72eff6473f02651f50aa3ab6fdcf151e_61685_e4fd09ccf4460ad96fc6345aaf5af508.webp 760w,
               /blog/envoy-threading-model/5f3e3349gy1g0c5di41ayj218g10ewm0_hu72eff6473f02651f50aa3ab6fdcf151e_61685_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-threading-model/5f3e3349gy1g0c5di41ayj218g10ewm0_hu72eff6473f02651f50aa3ab6fdcf151e_61685_695a58eee8ca4f704f2b87d72e5bfe4d.webp&#34;
               width=&#34;760&#34;
               height=&#34;622&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Envoy ä½¿ç”¨ä¸‰ç§ä¸åŒç±»å‹çš„çº¿ç¨‹ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Mainï¼šæ­¤çº¿ç¨‹è´Ÿè´£æœåŠ¡å™¨å¯åŠ¨å’Œå…³é—­ï¼Œæ‰€æœ‰ &lt;a href=&#34;https://lyft.github.io/envoy/docs/intro/arch_overview/dynamic_configuration.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS API&lt;/a&gt; å¤„ç†ï¼ˆåŒ…æ‹¬ &lt;a href=&#34;https://lyft.github.io/envoy/docs/intro/arch_overview/service_discovery.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DNS&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://lyft.github.io/envoy/docs/intro/arch_overview/health_checking.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿è¡ŒçŠ¶å†µæ£€æŸ¥&lt;/a&gt; å’Œå¸¸è§„ &lt;a href=&#34;https://lyft.github.io/envoy/docs/intro/arch_overview/cluster_manager.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›†ç¾¤ç®¡ç†&lt;/a&gt;ï¼‰ï¼Œ&lt;a href=&#34;https://lyft.github.io/envoy/docs/intro/arch_overview/runtime.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿è¡Œæ—¶&lt;/a&gt;ï¼Œç»Ÿè®¡åˆ·æ–°ï¼Œç®¡ç†å’Œä¸€èˆ¬è¿›ç¨‹ç®¡ç†ï¼ˆä¿¡å·ï¼Œ&lt;a href=&#34;https://lyft.github.io/envoy/docs/intro/arch_overview/hot_restart.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çƒ­å¯åŠ¨&lt;/a&gt; ç­‰ï¼‰ã€‚åœ¨æ­¤çº¿ç¨‹ä¸Šå‘ç”Ÿçš„æ‰€æœ‰äº‹æƒ…éƒ½æ˜¯å¼‚æ­¥çš„å¹¶ä¸”æ˜¯â€œéé˜»å¡çš„â€ã€‚é€šå¸¸ï¼Œä¸»çº¿ç¨‹åè°ƒæ‰€æœ‰ä¸éœ€è¦å¤§é‡ CPU æ¥å®Œæˆçš„å…³é”®è¿‡ç¨‹åŠŸèƒ½ã€‚è¿™å…è®¸å°†å¤§å¤šæ•°ç®¡ç†ä»£ç ç¼–å†™ä¸ºå•çº¿ç¨‹ç¼–å†™ã€‚&lt;/li&gt;
&lt;li&gt;Workerï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒEnvoy ä¸ºç³»ç»Ÿä¸­çš„æ¯ä¸ªç¡¬ä»¶çº¿ç¨‹ç”Ÿæˆä¸€ä¸ªå·¥ä½œçº¿ç¨‹ã€‚ï¼ˆè¿™å¯ä»¥é€šè¿‡ &lt;a href=&#34;https://lyft.github.io/envoy/docs/operations/cli.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&amp;ndash;concurrency&lt;/a&gt;Â &lt;a href=&#34;https://lyft.github.io/envoy/docs/operations/cli.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€‰é¡¹&lt;/a&gt; æ§åˆ¶ï¼‰ã€‚æ¯ä¸ªå·¥ä½œçº¿ç¨‹è¿è¡Œä¸€ä¸ªâ€œéé˜»å¡â€äº‹ä»¶å¾ªç¯ï¼Œè´Ÿè´£ç›‘å¬æ¯ä¸ªç›‘å¬å™¨ï¼ˆå½“å‰æ²¡æœ‰ç›‘å¬å™¨åˆ†ç‰‡ï¼‰ï¼Œæ¥å—æ–°è¿æ¥ï¼Œä¸ºè¿æ¥å®ä¾‹åŒ–è¿‡æ»¤å™¨å †æ ˆï¼Œä»¥åŠå¤„ç†æ‰€æœ‰ IO çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿æ¥ã€‚åŒæ ·ï¼Œè¿™å…è®¸å°†å¤§å¤šæ•°è¿æ¥å¤„ç†ä»£ç å†™æˆå¥½åƒæ˜¯å•çº¿ç¨‹çš„ã€‚&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶åˆ·æ–°å™¨ï¼šEnvoy å†™å…¥çš„æ¯ä¸ªæ–‡ä»¶ï¼ˆä¸»è¦æ˜¯è®¿é—®æ—¥å¿—ï¼‰å½“å‰éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„é˜»å¡åˆ·æ–°çº¿ç¨‹ã€‚è¿™æ˜¯å› ä¸ºå³ä½¿ä½¿ç”¨ O_NONBLOCK å†™å…¥æ–‡ä»¶ç³»ç»Ÿç¼“å­˜æ–‡ä»¶æœ‰æ—¶ä¹Ÿä¼šé˜»å¡ï¼ˆå“ï¼‰ã€‚å½“å·¥ä½œçº¿ç¨‹éœ€è¦å†™å…¥æ–‡ä»¶æ—¶ï¼Œæ•°æ®å®é™…ä¸Šè¢«ç§»å…¥å†…å­˜ç¼“å†²åŒºï¼Œæœ€ç»ˆé€šè¿‡æ–‡ä»¶åˆ·æ–°çº¿ç¨‹åˆ·æ–°ã€‚è¿™æ˜¯ä»£ç çš„ä¸€ä¸ªåŒºåŸŸï¼ŒæŠ€æœ¯ä¸Šæ‰€æœ‰ worker éƒ½å¯ä»¥é˜»æ­¢åŒä¸€ä¸ªé”å°è¯•å¡«å……å†…å­˜ç¼“å†²åŒºã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–çš„å°†åœ¨ä¸‹é¢è¿›ä¸€æ­¥è®¨è®ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è¿æ¥å¤„ç†&#34;&gt;è¿æ¥å¤„ç†&lt;/h3&gt;
&lt;p&gt;å¦‚ä¸Šæ‰€è¿°ï¼Œæ‰€æœ‰å·¥ä½œçº¿ç¨‹éƒ½ä¼šåœ¨æ²¡æœ‰ä»»ä½•åˆ†ç‰‡çš„æƒ…å†µä¸‹ç›‘å¬æ‰€æœ‰ç›‘å¬å™¨ã€‚å› æ­¤ï¼Œå†…æ ¸ç”¨äºæ™ºèƒ½åœ°å°†æ¥å—çš„å¥—æ¥å­—åˆ†æ´¾ç»™å·¥ä½œçº¿ç¨‹ã€‚ç°ä»£å†…æ ¸ä¸€èˆ¬éƒ½å¾ˆæ“…é•¿è¿™ä¸ªï¼›ä»–ä»¬ä½¿ç”¨è¯¸å¦‚ IO ä¼˜å…ˆçº§æå‡ä¹‹ç±»çš„åŠŸèƒ½æ¥å°è¯•å¡«å……çº¿ç¨‹çš„å·¥ä½œï¼Œç„¶åå¼€å§‹ä½¿ç”¨åŒæ—¶ç›‘å¬åŒä¸€å¥—æ¥å­—çš„å…¶ä»–çº¿ç¨‹ï¼Œä»¥åŠä¸ä½¿ç”¨å•ä¸ªè‡ªæ—‹é”æ¥å¤„ç†æ¯ä¸ªæ¥å—ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦è¿æ¥è¢« worker æ¥å—ï¼Œå®ƒå°±æ°¸è¿œä¸ä¼šç¦»å¼€é‚£ä¸ª workerã€‚æ‰€æœ‰è¿›ä¸€æ­¥çš„è¿æ¥å¤„ç†éƒ½åœ¨å·¥ä½œçº¿ç¨‹å†…å®Œå…¨å¤„ç†ï¼ŒåŒ…æ‹¬ä»»ä½•è½¬å‘è¡Œä¸ºã€‚è¿™æœ‰ä¸€äº›é‡è¦çš„å«ä¹‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Envoy ä¸­çš„æ‰€æœ‰è¿æ¥æ± éƒ½æ˜¯æ¯ä¸ªå·¥ä½œçº¿ç¨‹ã€‚å› æ­¤ï¼Œå°½ç®¡ HTTP / 2 è¿æ¥æ± ä¸€æ¬¡åªä¸æ¯ä¸ªä¸Šæ¸¸ä¸»æœºå»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œä½†å¦‚æœæœ‰å››ä¸ªå·¥ä½œç«™ï¼Œåˆ™æ¯ä¸ªä¸Šæ¸¸ä¸»æœºåœ¨ç¨³å®šçŠ¶æ€ä¸‹å°†æœ‰å››ä¸ª HTTP/2 è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;Envoy ä»¥è¿™ç§æ–¹å¼å·¥ä½œçš„åŸå› æ˜¯å› ä¸ºé€šè¿‡å°†æ‰€æœ‰ä»£ç ä¿å­˜åœ¨å•ä¸ªå·¥ä½œçº¿ç¨‹ä¸­ï¼Œå‡ ä¹æ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨æ²¡æœ‰é”çš„æƒ…å†µä¸‹ç¼–å†™ï¼Œå°±åƒå®ƒæ˜¯å•çº¿ç¨‹ä¸€æ ·ã€‚è¿™ç§è®¾è®¡ä½¿å¾—å¤§å¤šæ•°ä»£ç æ›´æ˜“äºç¼–å†™ï¼Œå¹¶ä¸”å¯ä»¥éå¸¸å¥½åœ°æ‰©å±•åˆ°å‡ ä¹æ— é™æ•°é‡çš„ workerã€‚&lt;/li&gt;
&lt;li&gt;ç„¶è€Œï¼Œä¸€ä¸ªä¸»è¦çš„é—®é¢˜æ˜¯ï¼Œä»å†…å­˜å’Œè¿æ¥æ± æ•ˆç‡çš„è§’åº¦æ¥çœ‹ï¼Œè°ƒæ•´å¹¶å‘é€‰é¡¹å®é™…ä¸Šéå¸¸é‡è¦ã€‚æ‹¥æœ‰æ¯”æ‰€éœ€æ›´å¤šçš„ worker å°†æµªè´¹å†…å­˜ï¼Œåˆ›å»ºæ›´å¤šç©ºé—²è¿æ¥ï¼Œå¹¶å¯¼è‡´æ›´ä½çš„è¿æ¥æ± å‘½ä¸­ç‡ã€‚åœ¨ Lyftï¼Œæˆ‘ä»¬çš„ sidecar Envoy ä»¥éå¸¸ä½çš„å¹¶å‘æ€§è¿è¡Œï¼Œå› æ­¤æ€§èƒ½å¤§è‡´ä¸ä»–ä»¬æ—è¾¹çš„æœåŠ¡ç›¸åŒ¹é…ã€‚æˆ‘ä»¬åªä»¥æœ€å¤§å¹¶å‘æ€§è¿è¡Œæˆ‘ä»¬çš„è¾¹ç¼˜ Envoyã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä»€ä¹ˆæ˜¯éé˜»å¡&#34;&gt;ä»€ä¹ˆæ˜¯éé˜»å¡&lt;/h3&gt;
&lt;p&gt;åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåœ¨è®¨è®ºä¸»çº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹å¦‚ä½•æ“ä½œæ—¶ï¼Œå·²ç»å¤šæ¬¡ä½¿ç”¨æœ¯è¯­â€œéé˜»å¡â€ã€‚æ‰€æœ‰ä»£ç éƒ½æ˜¯åœ¨å‡è®¾æ²¡æœ‰ä»»ä½•é˜»å¡çš„æƒ…å†µä¸‹ç¼–å†™çš„ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸å®Œå…¨æ­£ç¡®ï¼ˆå®Œå…¨æ˜¯è¿™æ ·çš„å—ï¼Ÿï¼‰ã€‚Envoy ç¡®å®é‡‡ç”¨äº†ä¸€äº›è¿›ç¨‹å®½é”ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚å‰æ‰€è¿°ï¼Œå¦‚æœæ­£åœ¨å†™å…¥è®¿é—®æ—¥å¿—ï¼Œåˆ™æ‰€æœ‰å·¥ä½œç¨‹åºåœ¨å¡«å……å†…å­˜è®¿é—®æ—¥å¿—ç¼“å†²åŒºä¹‹å‰éƒ½ä¼šè·å–ç›¸åŒçš„é”ã€‚é”å®šä¿æŒæ—¶é—´åº”è¯¥éå¸¸ä½ï¼Œä½†æ˜¯è¿™ç§é”å¯ä»¥åœ¨é«˜å¹¶å‘æ€§å’Œé«˜ååé‡ä¸‹ç«äº‰ã€‚&lt;/li&gt;
&lt;li&gt;Envoy é‡‡ç”¨äº†ä¸€ä¸ªéå¸¸å¤æ‚çš„ç³»ç»Ÿæ¥å¤„ç†çº¿ç¨‹æœ¬åœ°çš„ç»Ÿè®¡æ•°æ®ã€‚è¿™å°†æ˜¯ä¸€ä¸ªå•ç‹¬çš„å¸–å­çš„ä¸»é¢˜ã€‚ä½†æ˜¯ï¼Œæˆ‘å°†ç®€è¦æä¸€ä¸‹ï¼Œä½œä¸ºçº¿ç¨‹æœ¬åœ°ç»Ÿè®¡å¤„ç†çš„ä¸€éƒ¨åˆ†ï¼Œæœ‰æ—¶éœ€è¦è·å–å¯¹ä¸­å¤®â€œstat storeâ€çš„é”å®šã€‚è¿™ç§é”å®šä¸åº”è¯¥é«˜åº¦äº‰ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;ä¸»çº¿ç¨‹éœ€è¦å®šæœŸä¸æ‰€æœ‰å·¥ä½œçº¿ç¨‹åè°ƒã€‚è¿™æ˜¯é€šè¿‡ä»ä¸»çº¿ç¨‹â€œå‘å¸ƒâ€åˆ°å·¥ä½œçº¿ç¨‹ï¼ˆæœ‰æ—¶ä»å·¥ä½œçº¿ç¨‹è¿”å›åˆ°ä¸»çº¿ç¨‹ï¼‰æ¥å®Œæˆçš„ã€‚å‘å¸ƒéœ€è¦é”å®šï¼Œä»¥ä¾¿å°†å‘å¸ƒçš„æ¶ˆæ¯æ”¾å…¥é˜Ÿåˆ—ä¸­ä»¥ä¾¿ä»¥åå‘é€ã€‚è¿™äº›é”æ°¸è¿œä¸åº”è¯¥é«˜åº¦äº‰ç”¨ï¼Œä½†å®ƒä»¬ä»ç„¶å¯ä»¥åœ¨æŠ€æœ¯ä¸Šé˜»æ­¢ã€‚&lt;/li&gt;
&lt;li&gt;å½“ Envoy å°†è‡ªå·±è®°å½•åˆ°æ ‡å‡†é”™è¯¯æ—¶ï¼Œå®ƒä¼šè·å–è¿›ç¨‹èŒƒå›´çš„é”å®šã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒEnvoy æœ¬åœ°è®°å½•è¢«è®¤ä¸ºæ˜¯è¡¨ç°ç³Ÿç³•çš„ï¼Œæ‰€ä»¥æ²¡æœ‰å¤šå°‘è€ƒè™‘æ”¹å–„è¿™ä¸€ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;è¿˜æœ‰ä¸€äº›å…¶ä»–éšæœºé”ï¼Œä½†å®ƒä»¬éƒ½ä¸åœ¨æ€§èƒ½å…³é”®è·¯å¾„ä¸­ï¼Œæ°¸è¿œä¸åº”è¯¥äº‰ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;çº¿ç¨‹æœ¬åœ°å­˜å‚¨&#34;&gt;çº¿ç¨‹æœ¬åœ°å­˜å‚¨&lt;/h3&gt;
&lt;p&gt;ç”±äº Envoy å°†ä¸»çº¿ç¨‹èŒè´£ä¸å·¥ä½œçº¿ç¨‹èŒè´£åˆ†å¼€ï¼Œå› æ­¤éœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸Šå®Œæˆå¤æ‚å¤„ç†ï¼Œç„¶åä»¥é«˜åº¦å¹¶å‘çš„æ–¹å¼ä½¿æ¯ä¸ªå·¥ä½œçº¿ç¨‹å¯ç”¨ã€‚æœ¬èŠ‚ä»‹ç»äº† Envoy çš„é«˜çº§çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆTLSï¼‰ç³»ç»Ÿã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘å°†æè¿°å¦‚ä½•ä½¿ç”¨å®ƒæ¥å¤„ç†é›†ç¾¤ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-threading-model/5f3e3349gy1g0c5bd3l63j218g0n1wjh_hu9dd35e2629f1d98526e7b8aebe159291_47773_ac0100fd2af924c8aa3f08b4ce4bb6cf.webp 400w,
               /blog/envoy-threading-model/5f3e3349gy1g0c5bd3l63j218g0n1wjh_hu9dd35e2629f1d98526e7b8aebe159291_47773_13548da2056ee394d8f943a470f50135.webp 760w,
               /blog/envoy-threading-model/5f3e3349gy1g0c5bd3l63j218g0n1wjh_hu9dd35e2629f1d98526e7b8aebe159291_47773_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-threading-model/5f3e3349gy1g0c5bd3l63j218g0n1wjh_hu9dd35e2629f1d98526e7b8aebe159291_47773_ac0100fd2af924c8aa3f08b4ce4bb6cf.webp&#34;
               width=&#34;760&#34;
               height=&#34;394&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚å·²ç»æè¿°çš„é‚£æ ·ï¼Œä¸»çº¿ç¨‹åŸºæœ¬ä¸Šå¤„ç† Envoy è¿‡ç¨‹ä¸­çš„æ‰€æœ‰ç®¡ç† / æ§åˆ¶å¹³é¢åŠŸèƒ½ã€‚ ï¼ˆæ§åˆ¶å¹³é¢åœ¨è¿™é‡Œæœ‰ç‚¹è¿‡è½½ä½†æ˜¯å½“åœ¨ Envoy è¿›ç¨‹ä¸­è€ƒè™‘å¹¶ä¸å·¥äººåšçš„è½¬å‘è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œä¼¼ä¹æ˜¯åˆé€‚çš„ï¼‰ã€‚ä¸»çº¿ç¨‹è¿›ç¨‹æ‰§è¡ŒæŸäº›å·¥ä½œæ˜¯ä¸€ç§å¸¸è§æ¨¡å¼ï¼Œç„¶åéœ€è¦ä½¿ç”¨è¯¥å·¥ä½œçš„ç»“æœæ›´æ–°æ¯ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå¹¶ä¸”å·¥ä½œçº¿ç¨‹ä¸éœ€è¦åœ¨æ¯æ¬¡è®¿é—®æ—¶è·å–é”å®šã€‚&lt;/p&gt;
&lt;p&gt;Envoy çš„ TLS ç³»ç»Ÿçš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ä¸»çº¿ç¨‹ä¸Šè¿è¡Œçš„ä»£ç å¯ä»¥åˆ†é…è¿›ç¨‹èŒƒå›´çš„ TLS æ§½ã€‚è™½ç„¶æ˜¯æŠ½è±¡çš„ï¼Œä½†å®é™…ä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ªå…è®¸ Oï¼ˆ1ï¼‰è®¿é—®çš„å‘é‡ç´¢å¼•ã€‚&lt;/li&gt;
&lt;li&gt;ä¸»çº¿ç¨‹å¯ä»¥å°†ä»»æ„æ•°æ®è®¾ç½®åˆ°å…¶æ§½ä¸­ã€‚å®Œæˆæ­¤æ“ä½œåï¼Œæ•°æ®å°†ä½œä¸ºæ­£å¸¸äº‹ä»¶å¾ªç¯äº‹ä»¶å‘å¸ƒåˆ°æ¯ä¸ªå·¥ä½œç¨‹åºä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å·¥ä½œçº¿ç¨‹å¯ä»¥ä»å…¶ TLS æ§½è¯»å–ï¼Œå¹¶å°†æ£€ç´¢é‚£é‡Œå¯ç”¨çš„ä»»ä½•çº¿ç¨‹æœ¬åœ°æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è™½ç„¶éå¸¸ç®€å•ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„èŒƒä¾‹ï¼Œä¸ RCU é”å®šæ¦‚å¿µéå¸¸ç›¸ä¼¼ã€‚ ï¼ˆå®è´¨ä¸Šï¼Œå·¥ä½œçº¿ç¨‹åœ¨å·¥ä½œæ—¶ä»ä¸ä¼šçœ‹åˆ° TLS æ’æ§½ä¸­çš„æ•°æ®å‘ç”Ÿä»»ä½•å˜åŒ–ã€‚æ›´æ”¹åªå‘ç”Ÿåœ¨å·¥ä½œäº‹ä»¶ä¹‹é—´çš„é™æ­¢æœŸé—´ï¼‰ã€‚Envoy ä»¥ä¸¤ç§ä¸åŒçš„æ–¹å¼ä½¿ç”¨å®ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡åœ¨æ²¡æœ‰ä»»ä½•é”å®šçš„æƒ…å†µä¸‹è®¿é—®æ¯ä¸ª worker å­˜å‚¨ä¸åŒçš„æ•°æ®&lt;/li&gt;
&lt;li&gt;é€šè¿‡å°†å…±äº«æŒ‡é’ˆå­˜å‚¨åˆ°æ¯ä¸ª worker çš„åªè¯»å…¨å±€æ•°æ®ã€‚å› æ­¤ï¼Œæ¯ä¸ªå·¥ä½œè€…éƒ½å…·æœ‰å¯¹åœ¨å·¥ä½œæ—¶ä¸èƒ½é€’å‡çš„æ•°æ®çš„å¼•ç”¨è®¡æ•°ã€‚åªæœ‰å½“æ‰€æœ‰ worker éƒ½å·²åœé¡¿å¹¶åŠ è½½æ–°çš„å…±äº«æ•°æ®æ—¶ï¼Œæ—§æ•°æ®æ‰ä¼šè¢«é”€æ¯ã€‚è¿™ä¸ RCU ç›¸åŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é›†ç¾¤çº¿ç¨‹æ›´æ–°&#34;&gt;é›†ç¾¤çº¿ç¨‹æ›´æ–°&lt;/h3&gt;
&lt;p&gt;åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘å°†æè¿° TLS å¦‚ä½•ç”¨äºé›†ç¾¤ç®¡ç†ã€‚é›†ç¾¤ç®¡ç†åŒ…æ‹¬ xDS API å¤„ç†å’Œ / æˆ– DNS ä»¥åŠè¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-threading-model/5f3e3349gy1g0c5dx3j34j20ir0agwgn_hu2845ebd3f565627738d8055a9fc614e0_35033_1ddcb49db5f6b2799fd2689ccd96ff65.webp 400w,
               /blog/envoy-threading-model/5f3e3349gy1g0c5dx3j34j20ir0agwgn_hu2845ebd3f565627738d8055a9fc614e0_35033_8ce157718a8042919b37c710929b176c.webp 760w,
               /blog/envoy-threading-model/5f3e3349gy1g0c5dx3j34j20ir0agwgn_hu2845ebd3f565627738d8055a9fc614e0_35033_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-threading-model/5f3e3349gy1g0c5dx3j34j20ir0agwgn_hu2845ebd3f565627738d8055a9fc614e0_35033_1ddcb49db5f6b2799fd2689ccd96ff65.webp&#34;
               width=&#34;675&#34;
               height=&#34;376&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ˜¾ç¤ºäº†æ¶‰åŠä»¥ä¸‹ç»„ä»¶å’Œæ­¥éª¤çš„æ€»ä½“æµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é›†ç¾¤ç®¡ç†å™¨æ˜¯ Envoy å†…éƒ¨çš„ç»„ä»¶ï¼Œç”¨äºç®¡ç†æ‰€æœ‰å·²çŸ¥çš„ä¸Šæ¸¸é›†ç¾¤ï¼ŒCDS APIï¼ŒSDS / EDS APIï¼ŒDNS å’Œæ´»åŠ¨ï¼ˆå¸¦å¤–ï¼‰è¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€‚å®ƒè´Ÿè´£åˆ›å»ºæ¯ä¸ªä¸Šæ¸¸é›†ç¾¤çš„æœ€ç»ˆä¸€è‡´è§†å›¾ï¼Œå…¶ä¸­åŒ…æ‹¬å·²å‘ç°çš„ä¸»æœºä»¥åŠè¿è¡ŒçŠ¶å†µã€‚&lt;/li&gt;
&lt;li&gt;è¿è¡ŒçŠ¶å†µæ£€æŸ¥ç¨‹åºæ‰§è¡Œæ´»åŠ¨è¿è¡ŒçŠ¶å†µæ£€æŸ¥ï¼Œå¹¶å°†è¿è¡ŒçŠ¶å†µæ›´æ”¹æŠ¥å‘Šå›é›†ç¾¤ç®¡ç†å™¨ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œ CDS / SDS / EDS / DNS ä»¥ç¡®å®šé›†ç¾¤æˆå‘˜èµ„æ ¼ã€‚çŠ¶æ€æ›´æ”¹å°†æŠ¥å‘Šå›é›†ç¾¤ç®¡ç†å™¨ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½åœ¨ä¸æ–­è¿è¡Œäº‹ä»¶å¾ªç¯ã€‚&lt;/li&gt;
&lt;li&gt;å½“é›†ç¾¤ç®¡ç†å™¨ç¡®å®šé›†ç¾¤çš„çŠ¶æ€å·²æ›´æ”¹æ—¶ï¼Œå®ƒä¼šåˆ›å»ºé›†ç¾¤çŠ¶æ€çš„æ–°åªè¯»å¿«ç…§ï¼Œå¹¶å°†å…¶å‘å¸ƒåˆ°æ¯ä¸ªå·¥ä½œçº¿ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ä¸‹ä¸€ä¸ªé™æ­¢æœŸé—´ï¼Œå·¥ä½œçº¿ç¨‹å°†æ›´æ–°åˆ†é…çš„ TLS æ’æ§½ä¸­çš„å¿«ç…§ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨éœ€è¦ç¡®å®šè¦è´Ÿè½½å‡è¡¡çš„ä¸»æœºçš„ IO äº‹ä»¶æœŸé—´ï¼Œè´Ÿè½½å‡è¡¡å™¨å°†åœ¨ TLS æ’æ§½ä¸­æŸ¥è¯¢ä¸»æœºä¿¡æ¯ã€‚æ²¡æœ‰è·å¾—é”å®šæ¥æ‰§è¡Œæ­¤æ“ä½œã€‚ ï¼ˆå¦è¯·æ³¨æ„ï¼ŒTLS è¿˜å¯ä»¥åœ¨æ›´æ–°æ—¶è§¦å‘äº‹ä»¶ï¼Œä»¥ä¾¿è´Ÿè½½å¹³è¡¡å™¨å’Œå…¶ä»–ç»„ä»¶å¯ä»¥é‡æ–°è®¡ç®—é«˜é€Ÿç¼“å­˜ï¼Œæ•°æ®ç»“æ„ç­‰ã€‚è¿™è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ï¼Œä½†åœ¨ä»£ç ä¸­çš„å„ä¸ªä½ç½®ä½¿ç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡ä½¿ç”¨å…ˆå‰æè¿°çš„è¿‡ç¨‹ï¼ŒEnvoy èƒ½å¤Ÿå¤„ç†æ¯ä¸ªè¯·æ±‚è€Œä¸éœ€è¦ä»»ä½•é”å®šï¼ˆé™¤äº†ä¹‹å‰æè¿°çš„é‚£äº›ï¼‰ã€‚é™¤äº† TLS ä»£ç æœ¬èº«çš„å¤æ‚æ€§ä¹‹å¤–ï¼Œå¤§å¤šæ•°ä»£ç éƒ½ä¸éœ€è¦ç†è§£çº¿ç¨‹å¦‚ä½•å·¥ä½œï¼Œå¹¶ä¸”å¯ä»¥ç¼–å†™ä¸ºå•çº¿ç¨‹ã€‚è¿™ä½¿å¾—å¤§å¤šæ•°ä»£ç æ›´å®¹æ˜“ç¼–å†™ï¼Œå¹¶äº§ç”Ÿå‡ºè‰²çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…¶ä»–ä½¿ç”¨-tls-çš„å­ç³»ç»Ÿ&#34;&gt;å…¶ä»–ä½¿ç”¨ TLS çš„å­ç³»ç»Ÿ&lt;/h3&gt;
&lt;p&gt;TLS å’Œ RCU åœ¨ Envoy ä¸­å¹¿æ³›ä½¿ç”¨ã€‚å…¶ä»–ä¸€äº›ä¾‹å­åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿è¡Œæ—¶ï¼ˆåŠŸèƒ½æ ‡å¿—ï¼‰è¦†ç›–æŸ¥æ‰¾ï¼šåœ¨ä¸»çº¿ç¨‹ä¸Šè®¡ç®—å½“å‰åŠŸèƒ½æ ‡å¿—è¦†ç›–æ˜ å°„ã€‚ç„¶åä½¿ç”¨ RCU è¯­ä¹‰ä¸ºæ¯ä¸ªå·¥ä½œç¨‹åºæä¾›åªè¯»å¿«ç…§ã€‚&lt;/li&gt;
&lt;li&gt;è·¯ç”±è¡¨äº¤æ¢ï¼šå¯¹äº RDS æä¾›çš„è·¯ç”±è¡¨ï¼Œè·¯ç”±è¡¨åœ¨ä¸»çº¿ç¨‹ä¸Šå®ä¾‹åŒ–ã€‚ç„¶åä½¿ç”¨ RCU è¯­ä¹‰ä¸ºæ¯ä¸ªå·¥ä½œç¨‹åºæä¾›åªè¯»å¿«ç…§ã€‚è¿™ä½¿å¾—è·¯ç”±è¡¨äº¤æ¢æœ‰æ•ˆåœ°åŸå­åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;HTTP æ—¥æœŸæ ‡å¤´ç¼“å­˜ï¼šäº‹å®è¯æ˜ï¼Œåœ¨æ¯ä¸ªè¯·æ±‚ä¸Šè®¡ç®— HTTP æ—¥æœŸæ ‡å¤´ï¼ˆå½“æ¯ä¸ªæ ¸å¿ƒæ‰§è¡Œï½25K + RPS æ—¶ï¼‰éå¸¸æ˜‚è´µã€‚Envoy å¤§çº¦æ¯åŠç§’è®¡ç®—ä¸€æ¬¡æ—¥æœŸæ ‡é¢˜ï¼Œå¹¶é€šè¿‡ TLS å’Œ RCU å°†å…¶æä¾›ç»™æ¯ä¸ª workerã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿˜æœ‰å…¶ä»–æƒ…å†µï¼Œä½†å‰é¢çš„ä¾‹å­åº”è¯¥æä¾› TLS æ‰€ç”¨äº‹ç‰©çš„è‰¯å¥½å“å‘³ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å·²çŸ¥çš„æ€§èƒ½é™·é˜±&#34;&gt;å·²çŸ¥çš„æ€§èƒ½é™·é˜±&lt;/h3&gt;
&lt;p&gt;è™½ç„¶ Envoy æ•´ä½“è¡¨ç°ç›¸å½“ä¸é”™ï¼Œä½†æ˜¯å½“å®ƒä»¥éå¸¸é«˜çš„å¹¶å‘æ€§å’Œååé‡ä½¿ç”¨æ—¶ï¼Œæœ‰ä¸€äº›å·²çŸ¥é¢†åŸŸéœ€è¦æ³¨æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ­£å¦‚æœ¬æ–‡ä¸­å·²ç»æè¿°çš„é‚£æ ·ï¼Œå½“å‰æ‰€æœ‰å·¥ä½œè€…åœ¨å†™å…¥è®¿é—®æ—¥å¿—çš„å†…å­˜ç¼“å†²åŒºæ—¶éƒ½ä¼šè·å¾—é”å®šã€‚åœ¨é«˜å¹¶å‘æ€§å’Œé«˜ååé‡çš„æƒ…å†µä¸‹ï¼Œå½“å†™å…¥æœ€ç»ˆæ–‡ä»¶æ—¶ï¼Œå°†éœ€è¦ä»¥æŒ‰é¡ºåºäº¤ä»˜ä¸ºä»£ä»·å¯¹æ¯ä¸ª worker æ‰¹é‡è®¿é—®æ—¥å¿—è¿›è¡Œæ‰¹å¤„ç†ã€‚æˆ–è€…ï¼Œè®¿é—®æ—¥å¿—å¯ä»¥æˆä¸ºæ¯ä¸ªå·¥ä½œçº¿ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;å°½ç®¡ç»Ÿè®¡ä¿¡æ¯å·²ç»è¿‡éå¸¸ä¼˜åŒ–ï¼Œä½†åœ¨éå¸¸é«˜çš„å¹¶å‘æ€§å’Œååé‡ä¸‹ï¼Œä¸ªåˆ«ç»Ÿè®¡ä¿¡æ¯å¯èƒ½å­˜åœ¨åŸå­äº‰ç”¨ã€‚å¯¹æ­¤çš„è§£å†³æ–¹æ¡ˆæ˜¯æ¯ä¸ªå·¥äººè®¡æ•°å™¨ï¼Œå®šæœŸå†²æ´—åˆ°ä¸­å¤®è®¡æ•°å™¨ã€‚è¿™å°†åœ¨åç»­æ–‡ç« ä¸­è®¨è®ºã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ Envoy éƒ¨ç½²åœ¨å‡ ä¹æ²¡æœ‰éœ€è¦å¤§é‡èµ„æºæ¥å¤„ç†çš„è¿æ¥çš„åœºæ™¯ä¸­ï¼Œç°æœ‰æ¶æ„å°†æ— æ³•æ­£å¸¸è¿è¡Œã€‚è¿™æ˜¯å› ä¸ºæ— æ³•ä¿è¯è¿æ¥åœ¨ worker ä¹‹é—´å‡åŒ€åˆ†å¸ƒã€‚è¿™å¯ä»¥é€šè¿‡å®ç°å·¥ä½œè€…è¿æ¥å¹³è¡¡æ¥è§£å†³ï¼Œå…¶ä¸­ worker èƒ½å¤Ÿå°†è¿æ¥è½¬å‘ç»™å¦ä¸€ä¸ª worker è¿›è¡Œå¤„ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h3&gt;
&lt;p&gt;Envoy çš„çº¿ç¨‹æ¨¡å‹æ—¨åœ¨æ”¯æŒç¼–ç¨‹çš„ç®€å•æ€§å’Œå¤§è§„æ¨¡å¹¶è¡Œæ€§ï¼Œä½†å¦‚æœè°ƒæ•´ä¸å½“å¯èƒ½ä¼šæµªè´¹å†…å­˜å’Œè¿æ¥ä½¿ç”¨ã€‚è¯¥æ¨¡å‹å…è®¸å®ƒåœ¨éå¸¸é«˜çš„ worker æ•°é‡å’Œååé‡ä¸‹è¡¨ç°è‰¯å¥½ã€‚&lt;/p&gt;
&lt;p&gt;æ­£å¦‚æˆ‘åœ¨ &lt;a href=&#34;https://twitter.com/mattklein123/status/872291252695293952&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Twitter&lt;/a&gt; ä¸Šç®€è¦æåˆ°çš„é‚£æ ·ï¼Œè¯¥è®¾è®¡ä¹Ÿé€‚åˆåœ¨ DPDK ä¹‹ç±»çš„å®Œæ•´ç”¨æˆ·æ¨¡å¼ç½‘ç»œå †æ ˆä¸Šè¿è¡Œï¼Œè¿™å¯èƒ½å¯¼è‡´å•†ç”¨æœåŠ¡å™¨åœ¨æ‰§è¡Œå®Œæ•´çš„ L7 å¤„ç†æ—¶æ¯ç§’å¤„ç†æ•°ç™¾ä¸‡ä¸ªè¯·æ±‚ã€‚çœ‹çœ‹æœªæ¥å‡ å¹´å»ºæˆä»€ä¹ˆä¼šéå¸¸æœ‰è¶£ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åä¸€ä¸ªå¿«é€Ÿè¯„è®ºï¼šæˆ‘å¤šæ¬¡è¢«é—®åˆ°ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸º Envoy é€‰æ‹© C++ã€‚åŸå› ä»ç„¶æ˜¯å®ƒä»ç„¶æ˜¯å”¯ä¸€å¹¿æ³›éƒ¨ç½²çš„ç”Ÿäº§çº§è¯­è¨€ï¼Œä½¿ç”¨è¯¥è¯­è¨€ä¸­å¯ä»¥æ„å»ºæœ¬æ–‡ä¸­æè¿°çš„æ¶æ„ã€‚C++ å½“ç„¶ä¸é€‚åˆæ‰€æœ‰é¡¹ç›®ï¼Œç”šè‡³è®¸å¤šé¡¹ç›®ï¼Œä½†å¯¹äºæŸäº›ç”¨ä¾‹ï¼Œå®ƒä»ç„¶æ˜¯å®Œæˆå·¥ä½œçš„å”¯ä¸€å·¥å…·ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>REST çš„æ›¿ä»£è€…ï¼šEnvoy&#43;gRPC-Web</title>
      <link>https://cloudnative.to/blog/envoy-and-grpc-web-a-fresh-new-alternative-to-rest/</link>
      <pubDate>Mon, 28 Jan 2019 14:20:33 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-and-grpc-web-a-fresh-new-alternative-to-rest/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://blog.envoyproxy.io/envoy-and-grpc-web-a-fresh-new-alternative-to-rest-6504ce7eb880&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.npmjs.com/package/grpc-web&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC-Web&lt;/a&gt;ä½œä¸º gRPC çš„ JavaScript å®¢æˆ·ç«¯åº“ï¼Œä½¿ Web åº”ç”¨å¯ä»¥ä¸ç”¨è‡ªå®šä¹‰ HTTP æœåŠ¡å™¨ä¸ºä¸­ä»‹ï¼Œç›´æ¥é€šè¿‡ Envoy ä¸ gRPC æœåŠ¡äº¤äº’ã€‚ç»è¿‡äº†çº¦ä¸¤å¹´çš„æ´»è·ƒå¼€å‘ï¼Œä¸Šå‘¨ï¼ˆ2018 å¹´ 10 æœˆåº•ï¼Œè¯‘è€…æ³¨ï¼‰gRPC å›¢é˜Ÿåœ¨ CNCF åšå®¢å®£å¸ƒ gRPC-Web çš„ GA ç‰ˆæœ¬æ­£å¼å‘å¸ƒã€‚&lt;/p&gt;
&lt;p&gt;è‡ªä»åœ¨&lt;a href=&#34;https://improbable.io/games/blog&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Improbable engineering blog&lt;/a&gt;è¯»åˆ°äº†&lt;a href=&#34;https://improbable.io/games/blog/grpc-web-moving-past-restjson-towards-type-safe-web-apis&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ç¯‡åšæ–‡&lt;/a&gt;ï¼Œæˆ‘ä¸ªäººå°±å¯¹ gRPC-Web å¾ˆæ„Ÿå…´è¶£ã€‚ä¹‹å‰ä¸€ç›´å¾ˆçœ‹å¥½ gRPC çš„æ€§èƒ½ã€å¯æ‹“å±•æ€§å’Œ IDLï¼ˆæ¥å£æè¿°è¯­è¨€ï¼‰é©±åŠ¨çš„æœåŠ¡äº¤äº’æ–¹å¼ï¼Œè€Œä¸”ç‰¹åˆ«æƒ³åœ¨æœåŠ¡è°ƒç”¨é“¾ä¸­å»æ‰ REST éƒ¨åˆ†ã€‚æˆ‘å¾ˆé«˜å…´ gRPC-Web å‘å¸ƒæ­£å¼ç‰ˆæœ¬ï¼Œå®ƒåœ¨ Web å¼€å‘é¢†åŸŸå¼€è¾Ÿäº†æ–°çš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è§‰å¾— gRPC-Web çš„ä¼˜åŠ¿å°±æ˜¯è‡ª Web ç«¯å‘ä¸‹æ„å»ºäº†å®Œæ•´çš„ç«¯åˆ°ç«¯ gRPC æœåŠ¡æ¶æ„ã€‚åœ¨ä»¥å‰ï¼Œå¦‚æœä½ æƒ³è®© web ç«¯ä¸ gRPC æœåŠ¡äº¤äº’ï¼Œå°±å¿…é¡»è‡ªå·±å¼€å‘ REST æ¥å£å¤„ç† HTTP å’Œ gRPC ä¹‹é—´çš„è½¬æ¢ã€‚è€Œä½¿ç”¨ gRPC-Webï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è‡ªå·±å†™é¢å¤–çš„ HTTP æ¥å£ï¼Œå¯ä»¥ç›´æ¥ç”¨&lt;a href=&#34;https://developers.google.com/protocol-buffers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Protocol Buffers&lt;/a&gt;å°è£…æ‰€æœ‰æ•°æ®æ¥å£ï¼ˆè¿™é‡Œå€Ÿç”¨äº† Envoyï¼Œåœ¨ä¸‹æ–‡æˆ‘ä¼šè¯¦ç»†è§£é‡Šï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;rest-æ–¹å¼&#34;&gt;REST æ–¹å¼&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº†åŸºäº gRPC æœåŠ¡æ¶æ„æ„å»º Web App çš„ä¸¤ç§æ–¹å¼ã€‚å·¦è¾¹æ˜¯ä¼ ç»Ÿçš„ REST æ–¹å¼ã€‚å³è¾¹æ˜¯ gRPC-Web æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-and-grpc-web-a-fresh-new-alternative-to-rest/005UD0i6ly1fzl31y3zjdj31jk0drdib_hubd1116cec0db369e7c52ebd894d07fa2_37682_d780cb224a2c5666ddb0912ff878d496.webp 400w,
               /blog/envoy-and-grpc-web-a-fresh-new-alternative-to-rest/005UD0i6ly1fzl31y3zjdj31jk0drdib_hubd1116cec0db369e7c52ebd894d07fa2_37682_8ec663427875214c6ffb2d8deab6ea03.webp 760w,
               /blog/envoy-and-grpc-web-a-fresh-new-alternative-to-rest/005UD0i6ly1fzl31y3zjdj31jk0drdib_hubd1116cec0db369e7c52ebd894d07fa2_37682_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-and-grpc-web-a-fresh-new-alternative-to-rest/005UD0i6ly1fzl31y3zjdj31jk0drdib_hubd1116cec0db369e7c52ebd894d07fa2_37682_d780cb224a2c5666ddb0912ff878d496.webp&#34;
               width=&#34;760&#34;
               height=&#34;188&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å·¦å›¾æ‰€ç¤ºï¼ŒREST API åªæ˜¯ä½œä¸º Web App å’Œåç«¯ gRPC æœåŠ¡çš„è¿æ¥ç‚¹ã€‚åœ¨å¤§éƒ¨åˆ†åœºæ™¯ä¸‹ï¼ŒREST æœåŠ¡å°±æ˜¯ç®€å•çš„å°† HTTP è°ƒç”¨è½¬æ¢æˆ gRPC è°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼šå®¢æˆ·ç«¯éœ€è¦éªŒè¯æœåŠ¡äºæ˜¯ç”¨&lt;code&gt;POST&lt;/code&gt;è¯·æ±‚æäº¤ JSON æ•°æ®åˆ° HTTP æœåŠ¡å™¨çš„&lt;code&gt;/auth&lt;/code&gt;ã€‚ç„¶å HTTP ç«¯æŠŠ JSON æ•°æ®è½¬æ¢æˆ Protobuf æ¶ˆæ¯ &lt;code&gt;AuthRequest&lt;/code&gt;ï¼Œå¹¶å°†æ¶ˆæ¯å‘é€ç»™ gRPC è®¤è¯æœåŠ¡ï¼Œæœ€åä» gRPC æœåŠ¡è·å–åˆ° &lt;code&gt;AuthResponse&lt;/code&gt; å“åº”å¹¶å°†å…¶è½¬æ¢æˆ JSON æ•°æ®è¿”å›ç»™å‰ç«¯ã€‚æ­£å¦‚æˆ‘åœ¨&lt;a href=&#34;https://www.cncf.io/newsroom/blog/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNCF åšå®¢&lt;/a&gt;ä¸­&lt;a href=&#34;https://www.cncf.io/blog/2018/10/24/grpc-web-is-going-ga/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡ç« &lt;/a&gt;ä¸­è¯´çš„ä¸€æ ·ï¼Œè¿™ç§æ–¹æ³•æœ¬èº«å¹¶æ²¡æœ‰é”™ï¼Œå®ƒæ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œè€Œä¸”å¾ˆå¤šå¼€å‘è€…éƒ½ç”¨çš„å¾ˆå¥½ï¼Œå¦‚æœå®ƒèƒ½æ»¡è¶³ä½ ï¼Œä½ å¯ä»¥ç»§ç»­è¿™æ ·ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æ›´å¥½çš„æ–¹æ¡ˆï¼šå¦‚æœå¯ä»¥å»æ‰ HTTP ä¸­ä»‹æˆ‘ä»¬ä¼šå°‘åšå¾ˆå¤šå·¥ä½œï¼ˆè¯•æƒ³ä¸€ä¸‹ï¼ŒJavaScript ç«¯ç›´æ¥å‘é€&lt;code&gt;AuthRequest&lt;/code&gt;æ¶ˆæ¯ç»™ gRPC æœåŠ¡å¹¶è·å¾— &lt;code&gt;AuthResponse&lt;/code&gt; å“åº”ï¼‰ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒ HTTP çŠ¶æ€ç ã€JSON è§£æå’Œ HTTP æœåŠ¡æœ¬èº«å¸¦æ¥çš„éƒ¨ç½²å’Œç®¡ç†é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾å³åŠéƒ¨åˆ†æ˜¯ä½¿ç”¨ gRPC-Web çš„æ›¿ä»£æ–¹æ¡ˆã€‚å®ƒçš„æ¶æ„æ›´åŠ æ¸…æ™°ï¼Œä¸€ä¸ª protocol è´¯ç©¿æ•´ä¸ª gRPC æœåŠ¡è°ƒç”¨çš„å§‹ç»ˆã€‚ä¸å†æœ‰é¢å¤–çš„ HTTP é€»è¾‘ï¼Œæ‰€æœ‰çš„æ•°æ®æ¥å£éƒ½åœ¨ &lt;code&gt;.proto&lt;/code&gt; æ–‡ä»¶ä¸­å®šä¹‰ã€‚æ•´ä¸ªè°ƒç”¨è¿‡ç¨‹å°±æ˜¯å®¢æˆ·ç«¯å‘ gRPC æœåŠ¡å‘é€ Protobuf æ¶ˆæ¯å¹¶ä»æœåŠ¡è·å– Protobuf æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä»…éœ€è¦ä¸€ä¸ªç»„ä»¶å°±èƒ½è¾¾åˆ°è¿™ç§æ¯”è¾ƒå¥½çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-æ‰€æ‰®æ¼”çš„è§’è‰²&#34;&gt;Envoy æ‰€æ‰®æ¼”çš„è§’è‰²&lt;/h2&gt;
&lt;p&gt;è¿™é‡Œå¿…é¡»æ‰¿è®¤ï¼Œæˆ‘ä¹‹å‰è®² gRPC-Web ç›´æ¥è°ƒç”¨ gRPC æœåŠ¡çš„è¿™ç§è¯´æ³•ä¸æ˜¯å®Œå…¨æ­£ç¡®çš„ã€‚ä½¿ç”¨ gRPC-Web çš„å®¢æˆ·ç«¯è°ƒç”¨ä»ç„¶éœ€è¦è½¬æ¢æˆå¯¹äº gRPC å‹å¥½çš„è°ƒç”¨ã€‚Envoy å¡«è¡¥äº†è¿™ä¸ªè§’è‰²ã€‚åŒæ—¶ Envoy ä¹Ÿæ˜¯ gRPC-Web å†…ç½®çš„é»˜è®¤æœåŠ¡ç½‘å…³ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾ä¸­å±•ç¤ºäº† Envoy ç»“åˆ gRPC-Web ä½¿ç”¨ã€‚å›¾ä¸­ Web App è°ƒç”¨äº†ä¸€ä¸ª gRPC æœåŠ¡ï¼Œè¯¥æœåŠ¡åˆä¾èµ–å¦å¤–ä¸¤ä¸ª gRPC æœåŠ¡ã€‚Envoy å°† HTTP/1.1 è¯·æ±‚è½¬æ¢æˆ HTTP/2 è¯·æ±‚ã€‚åº•å±‚å…¶å®è¿˜æ˜¯éœ€è¦è¿›è¡Œ HTTP åè®®çš„è½¬æ¢ï¼Œä½†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½ä¸éœ€è¦è€ƒè™‘ HTTP å±‚çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-and-grpc-web-a-fresh-new-alternative-to-rest/005UD0i6ly1fzl32s48tnj31ep0lemyf_hu7f990dffafb8046cebc90a598fcc13ef_45065_056c6c917ad85357d320b86e59860ddc.webp 400w,
               /blog/envoy-and-grpc-web-a-fresh-new-alternative-to-rest/005UD0i6ly1fzl32s48tnj31ep0lemyf_hu7f990dffafb8046cebc90a598fcc13ef_45065_2f07ebadb138adea7ec8dfc1849a885d.webp 760w,
               /blog/envoy-and-grpc-web-a-fresh-new-alternative-to-rest/005UD0i6ly1fzl32s48tnj31ep0lemyf_hu7f990dffafb8046cebc90a598fcc13ef_45065_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-and-grpc-web-a-fresh-new-alternative-to-rest/005UD0i6ly1fzl32s48tnj31ep0lemyf_hu7f990dffafb8046cebc90a598fcc13ef_45065_056c6c917ad85357d320b86e59860ddc.webp&#34;
               width=&#34;760&#34;
               height=&#34;321&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;gRPC-Web æ˜æ˜¾ä¼˜äº RESTï¼Œå› ä¸ºå®ƒåªéœ€å¼€å‘è€…åˆ›å»ºä¸€ä¸ª Envoy å¹¶åšä¸€äº›åŸºç¡€é…ç½®ï¼Œè€Œä¸éœ€è¦è‡ªå·±åˆ›å»ºè½¬æ¢å±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-ç¤ºä¾‹é…ç½®&#34;&gt;Envoy ç¤ºä¾‹é…ç½®&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;static_resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;listener_0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address: 0.0.0.0, port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.http_connection_manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;codec_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;auto&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress_http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;local_route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;local_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/â€
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;                route:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;                  cluster: auth_service
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;              cors:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;                allow_origin:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;                - &amp;#34;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;allow_methods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;GET, PUT, DELETE, POST, OPTIONS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;allow_headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;keep-alive,user-agent,cache-control,content-type,content-transfer-encoding,x-accept-content-transfer-encoding,x-accept-response-streaming,x-user-agent,x-grpc-web&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;max_age&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;1728000&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;expose_headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-status,grpc-message&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.grpc_web&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.cors&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.router&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;auth_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;25s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;logical_dns&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http2_protocol_options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;round_robin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;auth-server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9090&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ€»çš„æ¥è®²å®ƒå°±æ˜¯ Envoy æœ€åŸºæœ¬çš„ HTTP é…ç½®ï¼Œåªæ˜¯æœ‰ä¸€ç‚¹ç‚¹åŒºåˆ«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ç‚¹ gRPC-Web å¿…é¡»çš„è‡ªå®šä¹‰å¤´éƒ¨ï¼š&lt;code&gt;x-grpc-web&lt;/code&gt;ï¼Œ&lt;code&gt;grpc-status&lt;/code&gt; å’Œ &lt;code&gt;grpc-message&lt;/code&gt; ï¼ˆJavaScript ä¼šè‡ªåŠ¨å¤„ç†å®ƒä»¬ï¼‰&lt;/li&gt;
&lt;li&gt;å†…ç½®çš„&lt;code&gt;envoy.grpc_web&lt;/code&gt;HTTP è¿‡æ»¤å™¨ç”¨æ¥å®Œæˆç¹æ‚çš„ gRPC-Web ä»£ç†å·¥ä½œ&lt;/li&gt;
&lt;li&gt;åœ¨&lt;code&gt;auth_service&lt;/code&gt;é…ç½®ä¸­æŒ‡å®š&lt;code&gt;http2_protocol_options: {}&lt;/code&gt;æ¥è·å–HTTP/2çš„é“¾æ¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½ åªéœ€è¦å†™ä¸€ç‚¹ YAML é…ç½®å°±å¯ä»¥ä»é¢å¤–çš„ HTTP é€‚é…å·¥ä½œä¸­è§£è„±å‡ºæ¥ã€‚ä½ ä¸ç”¨å…³å¿ƒ HTTP ä¸ gRPC çš„æ–¹æ³•æ˜ å°„é—®é¢˜ï¼Œä¹Ÿä¸ç”¨å» StackOverflow æ‰¾ HTTP çš„å“ªä¸ªçŠ¶æ€ç å¯¹åº” gRPC çš„å“ªä¸ªçŠ¶æ€ç ï¼Œæ›´ä¸éœ€è¦å°† Proto æ¶ˆæ¯åŒ…è£…æˆ JSONã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ–°æ–¹å¼&#34;&gt;æ–°æ–¹å¼&lt;/h2&gt;
&lt;p&gt;gRPC-Web + Envoy ä¸º web å¼€å‘æä¾›äº†ä¸€ç§å…¨æ–°çš„æ–¹å¼ï¼Œå®ƒèƒ½ä¿è¯ Protocol Buffers å’Œ gRPC çš„ç±»å‹å®‰å…¨è¿˜è§„é¿äº† HTTP+REST ä¸­çš„å¾ˆå¤šå¸¸è§é—®é¢˜ã€‚æˆ‘æ¨èå¤§å®¶åœ¨è‡ªå·±çš„ä¸‹ä¸€ä¸ªé¡¹ç›®ä¸­è¯•è¯•å®ƒã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Service Meshâ€”â€”å Kubernetes æ—¶ä»£çš„å¾®æœåŠ¡</title>
      <link>https://cloudnative.to/blog/service-mesh-the-microservices-in-post-kubernetes-era/</link>
      <pubDate>Thu, 17 Jan 2019 20:16:18 +0800</pubDate>
      <guid>https://cloudnative.to/blog/service-mesh-the-microservices-in-post-kubernetes-era/</guid>
      <description>&lt;p&gt;è¿™ä¸æ˜¯ä¸€ç¯‡æ•™ç¨‹ï¼Œæœ¬æ–‡è¯•å›¾å¸¦æ‚¨æ¢³ç†æ¸…æ¥š Kubernetesã€Envoyï¼ˆxDS åè®®ï¼‰ä»¥åŠ Istio Service Mesh ä¹‹é—´çš„å…³ç³»åŠå†…åœ¨è”ç³»ã€‚æœ¬æ–‡ä»‹ç»äº† Kubernetes ä¸­çš„è´Ÿè½½å‡è¡¡æ–¹å¼ï¼ŒEnvoy çš„ xDS åè®®å¯¹äº Service Mesh çš„æ„ä¹‰ä»¥åŠä¸ºä»€ä¹ˆè¯´æœ‰äº† Kubernetes è¿˜éœ€è¦ Istioã€‚&lt;/p&gt;
&lt;p&gt;Envoy å¯¹äº Service Mesh æˆ–è€…è¯´  Cloud Native æœ€å¤§çš„è´¡çŒ®å°±æ˜¯å®šä¹‰äº† xDSï¼ŒEnvoy è™½ç„¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª proxyï¼Œä½†æ˜¯å®ƒçš„é…ç½®åè®®è¢«ä¼—å¤šå¼€æºè½¯ä»¶æ‰€æ”¯æŒï¼Œå¦‚ &lt;a href=&#34;https://github.com/istio/istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;ã€&lt;a href=&#34;https://linkerd.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd&lt;/a&gt;ã€&lt;a href=&#34;https://aws.amazon.com/app-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS App Mesh&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/alipay/sofa-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SOFAMesh&lt;/a&gt; ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…³äºæœ¬æ–‡æ ‡é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;2018 å¹´ 9 æœˆ 1 æ—¥ï¼Œ&lt;a href=&#34;https://twitter.com/bibryam&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Bilgin Ibryam&lt;/a&gt; åœ¨ InfoQ å‘è¡¨äº†ä¸€ç¯‡æ–‡ç«  &lt;a href=&#34;https://www.infoq.com/articles/microservices-post-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Microservices in a Post-Kubernetes Era&lt;/a&gt;ï¼Œä¸­æ–‡ç‰ˆè§&lt;a href=&#34;https://www.infoq.cn/article/microservices-post-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å Kubernetes æ—¶ä»£çš„å¾®æœåŠ¡&lt;/a&gt;ï¼ˆè¯‘æ–‡æœ‰äº›é”™è¯¯ï¼Œä»…ä¾›å‚è€ƒï¼‰ã€‚æœ¬æ–‡æ ‡é¢˜ä¸­è™½ç„¶æ²¡æœ‰æ˜ç¡®æŒ‡æ˜â€å Kubernetes æ—¶ä»£çš„å¾®æœåŠ¡â€œæ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯ä»æ–‡ä¸­å¯ä»¥çœ‹å‡ºä½œè€…çš„è§‚ç‚¹æ˜¯ï¼šåœ¨å Kubernetes æ—¶ä»£ï¼ŒæœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰æŠ€æœ¯å·²å®Œå…¨å–ä»£äº†ä½¿ç”¨è½¯ä»¶åº“å®ç°ç½‘ç»œè¿ç»´ï¼ˆä¾‹å¦‚ Hystrix æ–­è·¯å™¨ï¼‰çš„æ–¹å¼ã€‚æœ¬æ–‡ç´¢æ€§å°±å€Ÿç”¨è¯¥æ ‡é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ¬æ–‡ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯´æ˜ kube-proxy çš„ä½œç”¨ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes åœ¨å¾®æœåŠ¡ç®¡ç†ä¸Šçš„å±€é™æ€§ã€‚&lt;/li&gt;
&lt;li&gt;ä»‹ç»ä¸‹ Istio Service Mesh çš„åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ä»‹ç»ä¸‹ xDS åŒ…å«å“ªäº›å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;æ¯”è¾ƒäº† Kubernetesã€Envoy å’Œ Istio Service Mesh ä¸­çš„ä¸€äº›æ¦‚å¿µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æœ¬æ–‡è§‚ç‚¹&#34;&gt;æœ¬æ–‡è§‚ç‚¹&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ æ²¡æœ‰ç²¾åŠ›é˜…è¯»ä¸‹æ–‡çš„æ‰€æœ‰å†…å®¹ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆé˜…è¯»çœ‹ä¸‹ä¸‹é¢åˆ—å‡ºçš„æœ¬æ–‡ä¸­çš„ä¸€äº›ä¸»è¦è§‚ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes çš„æœ¬è´¨æ˜¯åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œå…·ä½“è¯´æ˜¯éƒ¨ç½²å’Œç®¡ç†ï¼ˆæ‰©ç¼©å®¹ã€è‡ªåŠ¨æ¢å¤ã€å‘å¸ƒï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes ä¸ºå¾®æœåŠ¡æä¾›äº†å¯æ‰©å±•ã€é«˜å¼¹æ€§çš„éƒ¨ç½²å’Œç®¡ç†å¹³å°ã€‚&lt;/li&gt;
&lt;li&gt;Service Mesh çš„åŸºç¡€æ˜¯é€æ˜ä»£ç†ï¼Œé€šè¿‡ sidecar proxy æ‹¦æˆªåˆ°å¾®æœåŠ¡é—´æµé‡åå†é€šè¿‡æ§åˆ¶å¹³é¢é…ç½®ç®¡ç†å¾®æœåŠ¡çš„è¡Œä¸ºã€‚&lt;/li&gt;
&lt;li&gt;Service Mesh å°†æµé‡ç®¡ç†ä» Kubernetes ä¸­è§£è€¦ï¼ŒService Mesh å†…éƒ¨çš„æµé‡æ— éœ€ &lt;code&gt;kube-proxy&lt;/code&gt; ç»„ä»¶çš„æ”¯æŒï¼Œé€šè¿‡ä¸ºæ›´æ¥è¿‘å¾®æœåŠ¡åº”ç”¨å±‚çš„æŠ½è±¡ï¼Œç®¡ç†æœåŠ¡é—´çš„æµé‡ã€å®‰å…¨æ€§å’Œå¯è§‚å¯Ÿæ€§ã€‚&lt;/li&gt;
&lt;li&gt;Envoy xDS å®šä¹‰äº† Service Mesh é…ç½®çš„åè®®æ ‡å‡†ã€‚&lt;/li&gt;
&lt;li&gt;Service Mesh æ˜¯å¯¹ Kubernetes ä¸­çš„ service æ›´ä¸Šå±‚çš„æŠ½è±¡ï¼Œå®ƒçš„ä¸‹ä¸€æ­¥æ˜¯ serverlessã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é€‚ç”¨äººç¾¤&#34;&gt;é€‚ç”¨äººç¾¤&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡å‡å®šæ‚¨å·²ç»å¯¹ &lt;a href=&#34;https://kubernetes.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes&lt;/a&gt; æœ‰æ¯”è¾ƒå…¨é¢çš„äº†è§£ï¼ŒåŒæ—¶è¿˜ä½¿ç”¨è¿‡ &lt;a href=&#34;https://istio.io/zh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt; service meshï¼Œä½†æ˜¯å¯¹äº Kubernetesã€Envoy åŠ Istio ä¹‹é—´çš„å…³ç³»ä¸ç”šäº†è§£ï¼ŒåŠ Istio å¦‚ä½•ä½¿ç”¨ xDS åè®®æ§åˆ¶æ‰€æœ‰çš„ Sidecar æœ‰æµ“åšçš„å…´è¶£ï¼Œé‚£ä¹ˆæ¨èæ‚¨ç»§ç»­é˜…è¯»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é˜…è¯»æœ¬æ–‡ä¹‹å‰&#34;&gt;é˜…è¯»æœ¬æ–‡ä¹‹å‰&lt;/h2&gt;
&lt;p&gt;æ¨èå¤§å®¶åœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰å¸Œæœ›æ‚¨å¯¹å¾®æœåŠ¡ã€å®¹å™¨å’Œ Kubernetes æœ‰ä¸€å®šè®¤è¯†ï¼Œå¦‚æœæ‚¨å·²ç»é˜…è¯»è¿‡ä»¥ä¸‹å‡ ç¯‡æ–‡ç« å°†å¯¹æ‚¨ç†è§£æœ¬æ–‡æ›´æœ‰å¸®åŠ©ï¼Œæœ¬æ–‡ä¸­ä¹Ÿå¼•ç”¨è¿‡äº†ä¸‹é¢æ–‡ç« ä¸­çš„éƒ¨åˆ†è§‚ç‚¹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/163yun/p/8962278.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·±å…¥è§£è¯» Service Mesh èƒŒåçš„æŠ€æœ¯ç»†èŠ‚ by åˆ˜è¶…&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhaohuabing.com/post/2018-09-25-istio-traffic-management-impl-intro/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æµé‡ç®¡ç†å®ç°æœºåˆ¶æ·±åº¦è§£æ by èµµåŒ–å†°&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://skyao.io/post/201804-servicemesh-architecture-introspection/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh æ¶æ„åæ€ï¼šæ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢çš„ç•Œçº¿è¯¥å¦‚ä½•åˆ’å®šï¼Ÿby æ•–å°å‰‘&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/posts/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ by å®‹å‡€è¶…&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/blog/istio-service-mesh-source-code-pilot-agent-deepin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh æ·±åº¦å­¦ä¹ ç³»åˆ—â€”â€”Istio æºç åˆ†æä¹‹ pilot-agent æ¨¡å—åˆ†æ by ä¸è½¶ç¾¤&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆèµ°åˆ°è¿™ä¸€æ­¥&#34;&gt;ä¸ºä»€ä¹ˆèµ°åˆ°è¿™ä¸€æ­¥&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ Service Mesh å¹¶ä¸æ˜¯è¯´ä¸ Kubernetes å†³è£‚ï¼Œè€Œæ˜¯æ°´åˆ°æ¸ æˆçš„äº‹æƒ…ã€‚Kubernetes çš„æœ¬è´¨æ˜¯é€šè¿‡å£°æ˜å¼é…ç½®å¯¹åº”ç”¨è¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œè€Œ Service Mesh çš„æœ¬è´¨æ˜¯åº”ç”¨é—´çš„æµé‡å’Œå®‰å…¨æ€§ç®¡ç†ã€‚å‡å¦‚ä½ å·²ç»ä½¿ç”¨ Kubernetes æ„å»ºäº†ç¨³å®šçš„å¾®æœåŠ¡å¹³å°ï¼Œé‚£ä¹ˆå¦‚ä½•è®¾ç½®æœåŠ¡é—´è°ƒç”¨çš„è´Ÿè½½å‡è¡¡å’Œæµé‡æ§åˆ¶ï¼Ÿ&lt;/p&gt;
&lt;h2 id=&#34;åœ¨é˜…è¯»æœ¬æ–‡å‰å…ˆé—®è‡ªå·±å‡ ä¸ªé—®é¢˜&#34;&gt;åœ¨é˜…è¯»æœ¬æ–‡å‰å…ˆé—®è‡ªå·±å‡ ä¸ªé—®é¢˜&lt;/h2&gt;
&lt;p&gt;æˆ‘æƒ³å¬è¯´è¿‡ Service Mesh å¹¶è¯•ç”¨è¿‡ &lt;a href=&#34;https://istio.io/zh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt; çš„äººå¯èƒ½éƒ½ä¼šæœ‰ä»¥ä¸‹å‡ ä¸ªç–‘é—®ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆ Istio ä¸€å®šè¦ç»‘å®š Kubernetes å‘¢ï¼Ÿ&lt;/li&gt;
&lt;li&gt;Kubernetes å’Œ Service Mesh åˆ†åˆ«åœ¨äº‘åŸç”Ÿä¸­æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿ&lt;/li&gt;
&lt;li&gt;Istio æ‰©å±•äº† Kubernetes çš„å“ªäº›æ–¹é¢ï¼Ÿè§£å†³äº†å“ªäº›é—®é¢˜ï¼Ÿ&lt;/li&gt;
&lt;li&gt;Kubernetesã€Envoyï¼ˆxDS åè®®ï¼‰ä¸ Istio ä¹‹é—´åˆæ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ&lt;/li&gt;
&lt;li&gt;åˆ°åº•è¯¥ä¸è¯¥ä¸Š Service Meshï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« &#34;&gt;ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« &lt;/h2&gt;
&lt;p&gt;ä» &lt;a href=&#34;http://www.servicemesher.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ServiceMesher ç¤¾åŒº&lt;/a&gt;çš„åé¦ˆæ¥çœ‹ï¼Œå¾ˆå¤šåˆæ¬¡æ¥è§¦ Istio å’Œ Service Mesh çš„åŒå­¦ï¼Œè·Ÿç€é‚£ä¸ª &lt;a href=&#34;https://istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜æ–¹æ–‡æ¡£&lt;/a&gt;å¯ä»¥è¿…é€Ÿçš„æ­å»ºå’Œè¯•ç”¨ Istio çš„å„ç§åŠŸèƒ½ï¼Œäº†è§£ Service Mesh èƒ½ä¸ºä½ åšä»€ä¹ˆï¼Œä½†ç”¨æˆ·æ‰€æœ‰çš„æ“ä½œéƒ½ä»…æ˜¯åœ¨æ§åˆ¶å¹³é¢å®Œæˆçš„ï¼Œè‡³äº Istio å¦‚ä½•æ“ä½œæ•°æ®å¹³é¢ï¼Œå³æ¯ä¸ª Sidecar proxy çš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/appendix/kubernetes-1.13-changelog.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes 1.13&lt;/a&gt; å¦‚æœŸå‘å¸ƒäº†ï¼ŒKubernetes ä¾ç„¶æŒ‰ç…§å››ä¸ªæœˆä¸€ä¸ªç‰ˆæœ¬çš„é€Ÿåº¦è¿­ä»£ç€ï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½çœ‹åˆ°çš„é‡å¤§é©æ–°è¶Šæ¥è¶Šå°‘äº†ï¼Œå·²ç»è¿‡äº†æŠ€æœ¯é‡‡çº³çš„åˆçº§é˜¶æ®µï¼Œæ­£åœ¨å¤§è§„æ¨¡è½åœ°ï¼Œå…³äº Kubernetes çš„ä¹¦ç±ã€æ¼”è®²å·²ç»æ‰å †ï¼Œæˆ‘ä¸ä¼šè¿‡å¤šå¾—è®²åˆ° Kubernetesã€‚æœ¬æ–‡ä¸ä¸€å®šèƒ½å¤Ÿå›ç­”ä»¥ä¸Šæ‰€æœ‰é—®é¢˜ï¼Œæœ¬æ–‡ä»…ä¸ºæˆ‘ä¸ªäººç†è§£ï¼ŒæŠ›ç –å¼•ç‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼šè¿™ç¯‡æ–‡ç« ä¸­æ¶‰åŠå¤§é‡çš„æ•°æ®å¹³é¢çš„ç»†èŠ‚ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-vs-service-mesh&#34;&gt;Kubernetes vs Service Mesh&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„æ˜¯ Kubernetes ä¸ Service Mesh ä¸­çš„çš„æœåŠ¡è®¿é—®å…³ç³»ï¼Œæœ¬æ–‡ä»…é’ˆå¯¹ sidecar per-pod æ¨¡å¼ï¼Œè¯¦æƒ…è¯·å‚è€ƒ&lt;a href=&#34;https://jimmysong.io/istio-handbook/concepts/service-mesh-patterns.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼çš„å®ç°æ¨¡å¼&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-kubernetes-vs-service-mesh&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;kubernetes vs service mesh&#34; srcset=&#34;
               /blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz6c7pj4sqj31hk0rejuz_hu8584a0580f7b81d1653d9bef158ac7ca_71647_66a68b04e212651d1638fd3c7f54fdbf.webp 400w,
               /blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz6c7pj4sqj31hk0rejuz_hu8584a0580f7b81d1653d9bef158ac7ca_71647_1f6932765eb43895dd2027dfd77fc44c.webp 760w,
               /blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz6c7pj4sqj31hk0rejuz_hu8584a0580f7b81d1653d9bef158ac7ca_71647_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz6c7pj4sqj31hk0rejuz_hu8584a0580f7b81d1653d9bef158ac7ca_71647_66a68b04e212651d1638fd3c7f54fdbf.webp&#34;
               width=&#34;760&#34;
               height=&#34;388&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      kubernetes vs service mesh
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Kubernetes é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½éƒ¨ç½²äº†ä¸€ä¸ª &lt;code&gt;kube-proxy&lt;/code&gt; ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ä¼šä¸ Kubernetes API Server é€šä¿¡ï¼Œè·å–é›†ç¾¤ä¸­çš„ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/service.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;service&lt;/a&gt; ä¿¡æ¯ï¼Œç„¶åè®¾ç½® iptables è§„åˆ™ï¼Œç›´æ¥å°†å¯¹æŸä¸ª service çš„è¯·æ±‚å‘é€åˆ°å¯¹åº”çš„ Endpointï¼ˆå±äºåŒä¸€ç»„ service çš„ podï¼‰ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;Istio Service Mesh ä¸­æ²¿ç”¨äº† Kubernetes ä¸­çš„ service åšæœåŠ¡æ³¨å†Œï¼Œé€šè¿‡ Control Plane æ¥ç”Ÿæˆæ•°æ®å¹³é¢çš„é…ç½®ï¼ˆä½¿ç”¨ CRD å£°æ˜ï¼Œä¿å­˜åœ¨ etcd ä¸­ï¼‰ï¼Œæ•°æ®å¹³é¢çš„&lt;strong&gt;é€æ˜ä»£ç†&lt;/strong&gt;ï¼ˆtransparent proxyï¼‰ä»¥ sidecar å®¹å™¨çš„å½¢å¼éƒ¨ç½²åœ¨æ¯ä¸ªåº”ç”¨æœåŠ¡çš„ pod ä¸­ï¼Œè¿™äº› proxy éƒ½éœ€è¦è¯·æ±‚ Control Plane æ¥åŒæ­¥ä»£ç†é…ç½®ï¼Œä¹‹æ‰€ä»¥è¯´æ˜¯é€æ˜ä»£ç†ï¼Œæ˜¯å› ä¸ºåº”ç”¨ç¨‹åºå®¹å™¨å®Œå…¨æ— æ„ŸçŸ¥ä»£ç†çš„å­˜åœ¨ï¼Œè¯¥è¿‡ç¨‹ kube-proxy ç»„ä»¶ä¸€æ ·éœ€è¦æ‹¦æˆªæµé‡ï¼Œåªä¸è¿‡ &lt;code&gt;kube-proxy&lt;/code&gt; æ‹¦æˆªçš„æ˜¯è¿›å‡º Kubernetes èŠ‚ç‚¹çš„æµé‡ï¼Œè€Œ sidecar proxy æ‹¦æˆªçš„æ˜¯è¿›å‡ºè¯¥ Pod çš„æµé‡ï¼Œè¯¦è§&lt;a href=&#34;https://jimmysong.io/posts/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy Sidecar ä»£ç†çš„è·¯ç”±è½¬å‘&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Service Mesh çš„åŠ£åŠ¿&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å› ä¸º Kubernetes æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šè¿è¡Œä¼—å¤šçš„ Podï¼Œå°†åŸå…ˆ &lt;code&gt;kube-proxy&lt;/code&gt; æ–¹å¼çš„è·¯ç”±è½¬å‘åŠŸèƒ½ç½®äºæ¯ä¸ª pod ä¸­ï¼Œè¿™å°†å¯¼è‡´å¤§é‡çš„é…ç½®åˆ†å‘ã€åŒæ­¥å’Œæœ€ç»ˆä¸€è‡´æ€§é—®é¢˜ã€‚ä¸ºäº†ç»†ç²’åº¦çš„æœºå‹æµé‡ç®¡ç†ï¼Œå¿…å°†ä»£ç†ä¸€ç³»åˆ—æ–°çš„æŠ½è±¡ï¼Œå¢åŠ äº†ç”¨æˆ·çš„å¿ƒæ™ºè´Ÿæ‹…ï¼Œä½†éšç€æŠ€æœ¯çš„æ™®åŠæ…¢æ…¢å°†å¾—åˆ°ç¼“è§£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Service Mesh çš„ä¼˜åŠ¿&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kube-proxy&lt;/code&gt; çš„è®¾ç½®éƒ½æ˜¯å…¨å±€ç”Ÿæ•ˆçš„ï¼Œæ— æ³•å¯¹æ¯ä¸ªæœåŠ¡åšç»†ç²’åº¦çš„æ§åˆ¶ï¼Œè€Œ Service Mesh é€šè¿‡ sidecar proxy çš„æ–¹å¼å°† Kubernetes ä¸­å¯¹æµé‡çš„æ§åˆ¶ä» service ä¸€å±‚æŠ½ç¦»å‡ºæ¥ï¼Œå¯ä»¥åšæ›´å¤šçš„æ‰©å±•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kube-proxy-ç»„ä»¶&#34;&gt;kube-proxy ç»„ä»¶&lt;/h2&gt;
&lt;p&gt;åœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œæ¯ä¸ª Node è¿è¡Œä¸€ä¸ª &lt;code&gt;kube-proxy&lt;/code&gt; è¿›ç¨‹ã€‚&lt;code&gt;kube-proxy&lt;/code&gt; è´Ÿè´£ä¸º &lt;code&gt;Service&lt;/code&gt; å®ç°äº†ä¸€ç§ VIPï¼ˆè™šæ‹Ÿ IPï¼‰çš„å½¢å¼ã€‚åœ¨ Kubernetes v1.0 ç‰ˆæœ¬ï¼Œä»£ç†å®Œå…¨åœ¨ userspace å®ç°ã€‚Kubernetes v1.1 ç‰ˆæœ¬æ–°å¢äº† &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/service.html#iptables-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iptables ä»£ç†æ¨¡å¼&lt;/a&gt;ï¼Œä½†å¹¶ä¸æ˜¯é»˜è®¤çš„è¿è¡Œæ¨¡å¼ã€‚ä» Kubernetes v1.2 èµ·ï¼Œé»˜è®¤ä½¿ç”¨ iptables ä»£ç†ã€‚åœ¨ Kubernetes v1.8.0-beta.0 ä¸­ï¼Œæ·»åŠ äº† &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/service.html#ipvs-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ipvs ä»£ç†æ¨¡å¼&lt;/a&gt;ã€‚å…³äº kube-proxy ç»„ä»¶çš„æ›´å¤šä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;https://cizixs.com/2017/03/30/kubernetes-introduction-service-and-kube-proxy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes ç®€ä»‹ï¼šservice å’Œ kube-proxy åŸç†&lt;/a&gt; å’Œ &lt;a href=&#34;https://jishu.io/kubernetes/ipvs-loadbalancer-for-kubernetes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ IPVS å®ç° Kubernetes å…¥å£æµé‡è´Ÿè½½å‡è¡¡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;kube-proxy-çš„ç¼ºé™·&#34;&gt;kube-proxy çš„ç¼ºé™·&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„é“¾æ¥ä¸­ä½œè€…æŒ‡å‡ºäº† &lt;a href=&#34;https://cizixs.com/2017/03/30/kubernetes-introduction-service-and-kube-proxy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kube-proxy çš„ä¸è¶³ä¹‹å¤„&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é¦–å…ˆï¼Œå¦‚æœè½¬å‘çš„ pod ä¸èƒ½æ­£å¸¸æä¾›æœåŠ¡ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨å°è¯•å¦ä¸€ä¸ª podï¼Œå½“ç„¶è¿™ä¸ªå¯ä»¥é€šè¿‡ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/guide/configure-liveness-readiness-probes.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;liveness probes&lt;/code&gt;&lt;/a&gt; æ¥è§£å†³ã€‚æ¯ä¸ª pod éƒ½æœ‰ä¸€ä¸ªå¥åº·æ£€æŸ¥çš„æœºåˆ¶ï¼Œå½“æœ‰ pod å¥åº·çŠ¶å†µæœ‰é—®é¢˜æ—¶ï¼Œkube-proxy ä¼šåˆ é™¤å¯¹åº”çš„è½¬å‘è§„åˆ™ã€‚å¦å¤–ï¼Œ&lt;code&gt;nodePort&lt;/code&gt; ç±»å‹çš„æœåŠ¡ä¹Ÿæ— æ³•æ·»åŠ  TLS æˆ–è€…æ›´å¤æ‚çš„æŠ¥æ–‡è·¯ç”±æœºåˆ¶ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Kube-proxy å®ç°äº†æµé‡åœ¨ Kubernetes service å¤šä¸ª pod å®ä¾‹é—´çš„è´Ÿè½½å‡è¡¡ï¼Œä½†æ˜¯å¦‚ä½•å¯¹è¿™äº› service é—´çš„æµé‡åšç»†ç²’åº¦çš„æ§åˆ¶ï¼Œæ¯”å¦‚æŒ‰ç…§ç™¾åˆ†æ¯”åˆ’åˆ†æµé‡åˆ°ä¸åŒçš„åº”ç”¨ç‰ˆæœ¬ï¼ˆè¿™äº›åº”ç”¨éƒ½å±äºåŒä¸€ä¸ª  serviceï¼Œä½†ä½äºä¸åŒçš„ deployment ä¸Šï¼‰ï¼Œåšé‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦å‘å¸ƒï¼‰å’Œè“ç»¿å‘å¸ƒï¼ŸKubernetes ç¤¾åŒºç»™å‡ºäº† &lt;a href=&#34;https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#canary-deployments&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ Deployment åšé‡‘ä¸é›€å‘å¸ƒçš„æ–¹æ³•&lt;/a&gt;ï¼Œè¯¥æ–¹æ³•æœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡ä¿®æ”¹ pod çš„ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/label.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label&lt;/a&gt; æ¥å°†ä¸åŒçš„ pod åˆ’å½’åˆ° Deployment çš„ Service ä¸Šã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-ingress-vs-istio-gateway&#34;&gt;Kubernetes Ingress vs Istio Gateway&lt;/h2&gt;
&lt;p&gt;Kubernetes ä¸­çš„ Ingress èµ„æºå¯¹è±¡è·Ÿ Istio Service Mesh ä¸­çš„ Gateway çš„åŠŸèƒ½ç±»ä¼¼ï¼Œéƒ½æ˜¯è´Ÿè´£é›†ç¾¤å—åŒ—æµé‡ï¼ˆä»é›†ç¾¤å¤–éƒ¨è¿›å…¥é›†ç¾¤å†…éƒ¨çš„æµé‡ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kube-proxy&lt;/code&gt; åªèƒ½è·¯ç”± Kubernetes é›†ç¾¤å†…éƒ¨çš„æµé‡ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ Kubernetes é›†ç¾¤çš„ Pod ä½äº &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/cni.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNI&lt;/a&gt; åˆ›å»ºçš„å¤–ç½‘ç»œä¸­ï¼Œé›†ç¾¤å¤–éƒ¨æ˜¯æ— æ³•ç›´æ¥ä¸å…¶é€šä¿¡çš„ï¼Œå› æ­¤ Kubernetes ä¸­åˆ›å»ºäº† &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/ingress.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ingress&lt;/a&gt; è¿™ä¸ªèµ„æºå¯¹è±¡ï¼Œå®ƒç”±ä½äº Kubernetes &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/practice/edge-node-configuration.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¾¹ç¼˜èŠ‚ç‚¹&lt;/a&gt;ï¼ˆè¿™æ ·çš„èŠ‚ç‚¹å¯ä»¥æ˜¯å¾ˆå¤šä¸ªä¹Ÿå¯ä»¥æ˜¯ä¸€ç»„ï¼‰çš„ Ingress controller é©±åŠ¨ï¼Œè´Ÿè´£ç®¡ç†&lt;strong&gt;å—åŒ—å‘æµé‡&lt;/strong&gt;ï¼ˆä»é›†ç¾¤å¤–éƒ¨è¿›å…¥ Kubernetes é›†ç¾¤çš„æµé‡ï¼‰ï¼ŒIngress å¿…é¡»å¯¹æ¥å„ç§ä¸ª Ingress Controller æ‰èƒ½ä½¿ç”¨ï¼Œæ¯”å¦‚ &lt;a href=&#34;https://github.com/kubernetes/ingress-nginx&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;nginx ingress controller&lt;/a&gt;ã€&lt;a href=&#34;https://traefik.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;traefik&lt;/a&gt;ã€‚Ingress åªé€‚ç”¨äº HTTP æµé‡ï¼Œä½¿ç”¨æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œåªèƒ½å¯¹ serviceã€portã€HTTP è·¯å¾„ç­‰æœ‰é™å­—æ®µåŒ¹é…æ¥è·¯ç”±æµé‡ï¼Œè¿™å¯¼è‡´å®ƒæ— æ³•è·¯ç”±å¦‚ MySQLã€redis å’Œå„ç§ç§æœ‰ RPC ç­‰ TCP æµé‡ã€‚è¦æƒ³ç›´æ¥è·¯ç”±å—åŒ—å‘çš„æµé‡ï¼Œåªèƒ½ä½¿ç”¨ Service çš„ LoadBalancer æˆ– NodePortï¼Œå‰è€…éœ€è¦äº‘å‚å•†æ”¯æŒè€Œä¸”å¯èƒ½éœ€è¦ä»˜è´¹ï¼Œåè€…éœ€è¦è¿›è¡Œé¢å¤–çš„ç«¯å£ç®¡ç†ã€‚æœ‰äº› Ingress controller æ”¯æŒæš´éœ² TCP å’Œ UDP æœåŠ¡ï¼Œä½†æ˜¯åªèƒ½ä½¿ç”¨ Service æ¥æš´éœ²ï¼ŒIngress æœ¬èº«æ˜¯ä¸æ”¯æŒçš„ï¼Œä¾‹å¦‚ &lt;a href=&#34;https://kubernetes.github.io/ingress-nginx/user-guide/exposing-tcp-udp-services/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;nginx ingress controller&lt;/a&gt;ï¼ŒæœåŠ¡çš„æš´éœ²çš„ç«¯å£æ˜¯é€šè¿‡åˆ›å»º ConfigMap çš„æ–¹å¼æ¥é…ç½®çš„ã€‚&lt;/p&gt;
&lt;p&gt;Istio &lt;code&gt;Gateway&lt;/code&gt; æè¿°çš„è´Ÿè½½å‡è¡¡å™¨ç”¨äºæ‰¿è½½è¿›å‡ºç½‘æ ¼è¾¹ç¼˜çš„è¿æ¥ã€‚è¯¥è§„èŒƒä¸­æè¿°äº†ä¸€ç³»åˆ—å¼€æ”¾ç«¯å£å’Œè¿™äº›ç«¯å£æ‰€ä½¿ç”¨çš„åè®®ã€è´Ÿè½½å‡è¡¡çš„ SNI é…ç½®ç­‰å†…å®¹ã€‚Gateway æ˜¯ä¸€ç§ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/crd.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CRD æ‰©å±•&lt;/a&gt;ï¼Œå®ƒåŒæ—¶å¤ç”¨äº† Envoy proxy çš„èƒ½åŠ›ï¼Œè¯¦ç»†é…ç½®è¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/zh/docs/reference/config/istio.networking.v1alpha3/#gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜ç½‘&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;xds-åè®®&#34;&gt;xDS åè®®&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢è¿™å¼ å›¾å¤§å®¶åœ¨äº†è§£ Service Mesh çš„æ—¶å€™å¯èƒ½éƒ½çœ‹åˆ°è¿‡ï¼Œæ¯ä¸ªæ–¹å—ä»£è¡¨ä¸€ä¸ªæœåŠ¡çš„ç¤ºä¾‹ï¼Œä¾‹å¦‚ Kubernetes ä¸­çš„ä¸€ä¸ª Podï¼ˆå…¶ä¸­åŒ…å«äº† sidecar proxyï¼‰ï¼ŒxDS åè®®æ§åˆ¶äº† Istio Service Mesh ä¸­æ‰€æœ‰æµé‡çš„å…·ä½“è¡Œä¸ºï¼Œå³å°†ä¸‹å›¾ä¸­çš„æ–¹å—é“¾æ¥åˆ°äº†ä¸€èµ·ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-service-mesh-ç¤ºæ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Service Mesh ç¤ºæ„å›¾&#34; srcset=&#34;
               /blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz73xstibij30b409cmyh_hudfbdd53f218ce50d1574c451e48c6b67_37411_4ca8f392f8eaacce9523e62c88c8760d.webp 400w,
               /blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz73xstibij30b409cmyh_hudfbdd53f218ce50d1574c451e48c6b67_37411_c161feafbb03752e1799f83fd96a1f4b.webp 760w,
               /blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz73xstibij30b409cmyh_hudfbdd53f218ce50d1574c451e48c6b67_37411_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz73xstibij30b409cmyh_hudfbdd53f218ce50d1574c451e48c6b67_37411_4ca8f392f8eaacce9523e62c88c8760d.webp&#34;
               width=&#34;400&#34;
               height=&#34;336&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Service Mesh ç¤ºæ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;xDS åè®®æ˜¯ç”± &lt;a href=&#34;https://envoyproxy.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt; æå‡ºçš„ï¼Œåœ¨ Envoy v2 ç‰ˆæœ¬ API ä¸­æœ€åŸå§‹çš„ xDS åè®®åªæŒ‡ CDSã€EDSã€LDS å’Œ RDSã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬ä»¥ä¸¤ä¸ª serviceï¼Œæ¯ä¸ª service éƒ½æœ‰ä¸¤ä¸ªå®ä¾‹çš„ä¾‹å­æ¥çœ‹ä¸‹ Envoy çš„ xDS åè®®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy-xds-åè®®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy xDS åè®®&#34; srcset=&#34;
               /blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz7auvvrjnj30s80j8gn6_hu39e7602f57761f3eb9893c00d56935d1_87739_7b757a3d7edab68832622a5b1c7fbc8f.webp 400w,
               /blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz7auvvrjnj30s80j8gn6_hu39e7602f57761f3eb9893c00d56935d1_87739_89f3b183b99707373956c8380ae5c93f.webp 760w,
               /blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz7auvvrjnj30s80j8gn6_hu39e7602f57761f3eb9893c00d56935d1_87739_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz7auvvrjnj30s80j8gn6_hu39e7602f57761f3eb9893c00d56935d1_87739_7b757a3d7edab68832622a5b1c7fbc8f.webp&#34;
               width=&#34;760&#34;
               height=&#34;518&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy xDS åè®®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸­çš„ç®­å¤´ä¸æ˜¯æµé‡åœ¨è¿›å…¥ Enovy Proxy åçš„è·¯å¾„æˆ–è·¯ç”±ï¼Œè€Œæ˜¯æƒ³è±¡çš„ä¸€ç§ Envoy ä¸­ xDS æ¥å£å¤„ç†çš„é¡ºåºå¹¶éå®é™…é¡ºåºï¼Œå…¶å® xDS ä¹‹é—´ä¹Ÿæ˜¯æœ‰äº¤å‰å¼•ç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;Envoy é€šè¿‡æŸ¥è¯¢æ–‡ä»¶æˆ–ç®¡ç†æœåŠ¡å™¨æ¥åŠ¨æ€å‘ç°èµ„æºã€‚æ¦‚æ‹¬åœ°è®²ï¼Œå¯¹åº”çš„å‘ç°æœåŠ¡åŠå…¶ç›¸åº”çš„ API è¢«ç§°ä½œ &lt;em&gt;xDS&lt;/em&gt;ã€‚Envoy é€šè¿‡**è®¢é˜…ï¼ˆ&lt;em&gt;subscription&lt;/em&gt;ï¼‰**æ–¹å¼æ¥è·å–èµ„æºï¼Œè®¢é˜…æ–¹å¼æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–‡ä»¶è®¢é˜…&lt;/strong&gt;ï¼šç›‘æ§æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œå‘ç°åŠ¨æ€èµ„æºçš„æœ€ç®€å•æ–¹å¼å°±æ˜¯å°†å…¶ä¿å­˜äºæ–‡ä»¶ï¼Œå¹¶å°†è·¯å¾„é…ç½®åœ¨ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/core/config_source.proto#core-configsource&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ConfigSource&lt;/a&gt; ä¸­çš„ &lt;code&gt;path&lt;/code&gt; å‚æ•°ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;gRPC æµå¼è®¢é˜…&lt;/strong&gt;ï¼šæ¯ä¸ª xDS API å¯ä»¥å•ç‹¬é…ç½® &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/core/config_source.proto#core-apiconfigsource&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;ApiConfigSource&lt;/code&gt;&lt;/a&gt;ï¼ŒæŒ‡å‘å¯¹åº”çš„ä¸Šæ¸¸ç®¡ç†æœåŠ¡å™¨çš„é›†ç¾¤åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è½®è¯¢ REST-JSON è½®è¯¢è®¢é˜…&lt;/strong&gt;ï¼šå•ä¸ª xDS API å¯å¯¹ REST ç«¯ç‚¹è¿›è¡Œçš„åŒæ­¥ï¼ˆé•¿ï¼‰è½®è¯¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šçš„ xDS è®¢é˜…æ–¹å¼è¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://jimmysong.io/istio-handbook/concepts/envoy-xds-protocol.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS åè®®è§£æ&lt;/a&gt;ã€‚Istio  ä½¿ç”¨çš„ gRPC æµå¼è®¢é˜…çš„æ–¹å¼é…ç½®æ‰€æœ‰çš„æ•°æ®å¹³é¢çš„ sidecar proxyã€‚&lt;/p&gt;
&lt;p&gt;å…³äº xDS åè®®çš„è¯¦ç»†åˆ†è§£è¯·å‚è€ƒä¸è½¶ç¾¤åšå£«çš„è¿™å‡ ç¯‡æ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/blog/istio-service-mesh-source-code-pilot-agent-deepin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh æ·±åº¦å­¦ä¹ ç³»åˆ— part1â€”istio æºç åˆ†æä¹‹ pilot-agent æ¨¡å—åˆ†æ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/blog/istio-service-mesh-source-code-pilot-discovery-module-deepin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh æ·±åº¦å­¦ä¹ ç³»åˆ— part2â€”istio æºç åˆ†æä¹‹ pilot-discovery æ¨¡å—åˆ†æ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/blog/istio-service-mesh-source-code-pilot-discovery-module-deepin-part2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh æ·±åº¦å­¦ä¹ ç³»åˆ— part3â€”istio æºç åˆ†æä¹‹ pilot-discovery æ¨¡å—åˆ†æï¼ˆç»­ï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ–‡ç« ä¸­ä»‹ç»äº† Istio pilot çš„æ€»ä½“æ¶æ„ã€Envoy é…ç½®çš„ç”Ÿæˆã€pilot-discovery æ¨¡å—çš„åŠŸèƒ½ï¼Œä»¥åŠ xDS åè®®ä¸­çš„ CDSã€EDS åŠ ADSï¼Œå…³äº ADS è¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/overview/v2_overview#aggregated-discovery-service&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Enovy å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;xds-åè®®è¦ç‚¹&#34;&gt;xDS åè®®è¦ç‚¹&lt;/h3&gt;
&lt;p&gt;æœ€åæ€»ç»“ä¸‹å…³äº xDS åè®®çš„è¦ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CDSã€EDSã€LDSã€RDS æ˜¯æœ€åŸºç¡€çš„ xDS åè®®ï¼Œå®ƒä»¬å¯ä»¥åˆ†åˆ«ç‹¬ç«‹æ›´æ–°çš„ã€‚&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰çš„å‘ç°æœåŠ¡ï¼ˆDiscovery Serviceï¼‰å¯ä»¥è¿æ¥ä¸åŒçš„ Management Serverï¼Œä¹Ÿå°±æ˜¯è¯´ç®¡ç† xDS çš„æœåŠ¡å™¨å¯ä»¥æ˜¯å¤šä¸ªã€‚&lt;/li&gt;
&lt;li&gt;Envoy åœ¨åŸå§‹ xDS åè®®çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€äº›åˆ—æ‰©å……ï¼Œå¢åŠ äº† SDSï¼ˆç§˜é’¥å‘ç°æœåŠ¡ï¼‰ã€ADSï¼ˆèšåˆå‘ç°æœåŠ¡ï¼‰ã€HDSï¼ˆå¥åº·å‘ç°æœåŠ¡ï¼‰ã€MSï¼ˆMetric æœåŠ¡ï¼‰ã€RLSï¼ˆé€Ÿç‡é™åˆ¶æœåŠ¡ï¼‰ç­‰ APIã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œè‹¥ç›´æ¥ä½¿ç”¨ xDS åŸå§‹ API çš„è¯ï¼Œéœ€è¦ä¿è¯è¿™æ ·çš„é¡ºåºæ›´æ–°ï¼šCDS &amp;ndash;&amp;gt; EDS &amp;ndash;&amp;gt; LDS &amp;ndash;&amp;gt; RDSï¼Œè¿™æ˜¯éµå¾ªç”µå­å·¥ç¨‹ä¸­çš„&lt;strong&gt;å…ˆåˆåæ–­&lt;/strong&gt;ï¼ˆMake-Before-Breakï¼‰åŸåˆ™ï¼Œå³åœ¨æ–­å¼€åŸæ¥çš„è¿æ¥ä¹‹å‰å…ˆå»ºç«‹å¥½æ–°çš„è¿æ¥ï¼Œåº”ç”¨åœ¨è·¯ç”±é‡Œå°±æ˜¯ä¸ºäº†é˜²æ­¢è®¾ç½®äº†æ–°çš„è·¯ç”±è§„åˆ™çš„æ—¶å€™å´æ— æ³•å‘ç°ä¸Šæ¸¸é›†ç¾¤è€Œå¯¼è‡´æµé‡è¢«ä¸¢å¼ƒçš„æƒ…å†µï¼Œç±»ä¼¼äºç”µè·¯é‡Œçš„æ–­è·¯ã€‚&lt;/li&gt;
&lt;li&gt;CDS è®¾ç½® Service Mesh ä¸­æœ‰å“ªäº›æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;EDS è®¾ç½®å“ªäº›å®ä¾‹ï¼ˆEndpointï¼‰å±äºè¿™äº›æœåŠ¡ï¼ˆClusterï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;LDS è®¾ç½®å®ä¾‹ä¸Šç›‘å¬çš„ç«¯å£ä»¥é…ç½®è·¯ç”±ã€‚&lt;/li&gt;
&lt;li&gt;RDS æœ€ç»ˆæœåŠ¡é—´çš„è·¯ç”±å…³ç³»ï¼Œåº”è¯¥ä¿è¯æœ€åæ›´æ–° RDSã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;envoy&#34;&gt;Envoy&lt;/h2&gt;
&lt;p&gt;Envoy æ˜¯ Istio Service Mesh ä¸­é»˜è®¤çš„ Sidecarï¼ŒIstio åœ¨ Enovy çš„åŸºç¡€ä¸ŠæŒ‰ç…§ Envoy çš„ xDS åè®®æ‰©å±•äº†å…¶æ§åˆ¶å¹³é¢ï¼Œåœ¨è®²åˆ° Envoy xDS åè®®ä¹‹å‰è¿˜éœ€è¦æˆ‘ä»¬å…ˆç†Ÿæ‚‰ä¸‹ Envoy çš„åŸºæœ¬æœ¯è¯­ã€‚ä¸‹é¢åˆ—ä¸¾äº† Envoy é‡Œçš„åŸºæœ¬æœ¯è¯­åŠå…¶æ•°æ®ç»“æ„è§£æï¼Œå…³äº Envoy çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;http://www.servicemesher.com/envoy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ï¼Œè‡³äº Envoy åœ¨ Service Meshï¼ˆä¸ä»…é™äº Istioï¼‰ä¸­æ˜¯å¦‚ä½•ä½œä¸ºè½¬å‘ä»£ç†å·¥ä½œçš„è¯·å‚è€ƒç½‘æ˜“äº‘åˆ˜è¶…çš„è¿™ç¯‡&lt;a href=&#34;https://www.cnblogs.com/163yun/p/8962278.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·±å…¥è§£è¯» Service Mesh èƒŒåçš„æŠ€æœ¯ç»†èŠ‚ &lt;/a&gt;ä»¥åŠ&lt;a href=&#34;https://jimmysong.io/posts/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ&lt;/a&gt;ï¼Œæœ¬æ–‡å¼•ç”¨å…¶ä¸­çš„ä¸€äº›è§‚ç‚¹ï¼Œè¯¦ç»†å†…å®¹ä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy-proxy-æ¶æ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy proxy æ¶æ„å›¾&#34; srcset=&#34;
               /blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz69bsaqk7j314k0tsq90_hu468da1f52123af8c62013a4a45984cda_165074_7ef759f2740d09e37e3fc2d8abdb9971.webp 400w,
               /blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz69bsaqk7j314k0tsq90_hu468da1f52123af8c62013a4a45984cda_165074_50b319342193cf5087bba2b7cda13fc2.webp 760w,
               /blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz69bsaqk7j314k0tsq90_hu468da1f52123af8c62013a4a45984cda_165074_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz69bsaqk7j314k0tsq90_hu468da1f52123af8c62013a4a45984cda_165074_7ef759f2740d09e37e3fc2d8abdb9971.webp&#34;
               width=&#34;760&#34;
               height=&#34;558&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy proxy æ¶æ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;åŸºæœ¬æœ¯è¯­&#34;&gt;åŸºæœ¬æœ¯è¯­&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æ‚¨åº”è¯¥äº†è§£çš„ Enovy é‡Œçš„åŸºæœ¬æœ¯è¯­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Downstreamï¼ˆä¸‹æ¸¸ï¼‰&lt;/strong&gt;ï¼šä¸‹æ¸¸ä¸»æœºè¿æ¥åˆ° Envoyï¼Œå‘é€è¯·æ±‚å¹¶æ¥æ”¶å“åº”ï¼Œå³å‘é€è¯·æ±‚çš„ä¸»æœºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Upstreamï¼ˆä¸Šæ¸¸ï¼‰&lt;/strong&gt;ï¼šä¸Šæ¸¸ä¸»æœºæ¥æ”¶æ¥è‡ª Envoy çš„è¿æ¥å’Œè¯·æ±‚ï¼Œå¹¶è¿”å›å“åº”ï¼Œå³æ¥å—è¯·æ±‚çš„ä¸»æœºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Listenerï¼ˆç›‘å¬å™¨ï¼‰&lt;/strong&gt;ï¼šç›‘å¬å™¨æ˜¯å‘½åç½‘åœ°å€ï¼ˆä¾‹å¦‚ï¼Œç«¯å£ã€unix domain socket ç­‰)ï¼Œä¸‹æ¸¸å®¢æˆ·ç«¯å¯ä»¥è¿æ¥è¿™äº›ç›‘å¬å™¨ã€‚Envoy æš´éœ²ä¸€ä¸ªæˆ–è€…å¤šä¸ªç›‘å¬å™¨ç»™ä¸‹æ¸¸ä¸»æœºè¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Clusterï¼ˆé›†ç¾¤ï¼‰&lt;/strong&gt;ï¼šé›†ç¾¤æ˜¯æŒ‡ Envoy è¿æ¥çš„ä¸€ç»„é€»è¾‘ç›¸åŒçš„ä¸Šæ¸¸ä¸»æœºã€‚Envoy é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/service_discovery.html#arch-overview-service-discovery&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡å‘ç°&lt;/a&gt;æ¥å‘ç°é›†ç¾¤çš„æˆå‘˜ã€‚å¯ä»¥é€‰æ‹©é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/health_checking.html#arch-overview-health-checking&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸»åŠ¨å¥åº·æ£€æŸ¥&lt;/a&gt;æ¥ç¡®å®šé›†ç¾¤æˆå‘˜çš„å¥åº·çŠ¶æ€ã€‚Envoy é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/load_balancing.html#arch-overview-load-balancing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´Ÿè½½å‡è¡¡ç­–ç•¥&lt;/a&gt;å†³å®šå°†è¯·æ±‚è·¯ç”±åˆ°é›†ç¾¤çš„å“ªä¸ªæˆå‘˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Envoy ä¸­å¯ä»¥è®¾ç½®å¤šä¸ª Listenerï¼Œæ¯ä¸ª Listener ä¸­åˆå¯ä»¥è®¾ç½® filter chainï¼ˆè¿‡æ»¤å™¨é“¾è¡¨ï¼‰ï¼Œè€Œä¸”è¿‡æ»¤å™¨æ˜¯å¯æ‰©å±•çš„ï¼Œè¿™æ ·å°±å¯ä»¥æ›´æ–¹ä¾¿æˆ‘ä»¬æ“ä½œæµé‡çš„è¡Œä¸ºï¼Œä¾‹å¦‚è®¾ç½®åŠ å¯†ã€ç§æœ‰ RPC ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;xDS åè®®æ˜¯ç”± Envoy æå‡ºçš„ï¼Œç°åœ¨æ˜¯ Istio ä¸­é»˜è®¤çš„ sidecar proxyï¼Œä½†åªè¦å®ç° xDS åè®®ç†è®ºä¸Šéƒ½æ˜¯å¯ä»¥ä½œä¸º Istio ä¸­çš„ sidecar proxy çš„ï¼Œä¾‹å¦‚èš‚èšé‡‘æœå¼€æºçš„ &lt;a href=&#34;https://github.com/alipay/sofa-mosn&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SOFAMosn&lt;/a&gt; å’Œ nginx å¼€æºçš„ &lt;a href=&#34;https://github.com/nginxinc/nginmesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;nginmesh&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-service-mesh&#34;&gt;Istio Service Mesh&lt;/h2&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-service-mesh-æ¶æ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio service mesh æ¶æ„å›¾&#34; srcset=&#34;
               /blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz73sprcdlj31580u046j_hua3df09c2485b2f960a5486e00226e56b_111325_a8118487398b3732fc6d8c797b93b384.webp 400w,
               /blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz73sprcdlj31580u046j_hua3df09c2485b2f960a5486e00226e56b_111325_b843237cfc4dd9c31d102e2dfd635089.webp 760w,
               /blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz73sprcdlj31580u046j_hua3df09c2485b2f960a5486e00226e56b_111325_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-the-microservices-in-post-kubernetes-era/006tNc79ly1fz73sprcdlj31580u046j_hua3df09c2485b2f960a5486e00226e56b_111325_a8118487398b3732fc6d8c797b93b384.webp&#34;
               width=&#34;760&#34;
               height=&#34;553&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio service mesh æ¶æ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio æ˜¯ä¸€ä¸ªåŠŸèƒ½ååˆ†ä¸°å¯Œçš„ Service Meshï¼Œå®ƒåŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æµé‡ç®¡ç†ï¼šè¿™æ˜¯ Istio çš„æœ€åŸºæœ¬çš„åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ç­–ç•¥æ§åˆ¶ï¼šé€šè¿‡ Mixer ç»„ä»¶å’Œå„ç§é€‚é…å™¨æ¥å®ç°ï¼Œå®ç°è®¿é—®æ§åˆ¶ç³»ç»Ÿã€é¥æµ‹æ•è·ã€é…é¢ç®¡ç†å’Œè®¡è´¹ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;å¯è§‚æµ‹æ€§ï¼šé€šè¿‡ Mixer æ¥å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;å®‰å…¨è®¤è¯ï¼šCitadel ç»„ä»¶åšå¯†é’¥å’Œè¯ä¹¦ç®¡ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;istio-ä¸­çš„æµé‡ç®¡ç†&#34;&gt;Istio ä¸­çš„æµé‡ç®¡ç†&lt;/h3&gt;
&lt;p&gt;Istio ä¸­å®šä¹‰äº†å¦‚ä¸‹çš„ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/custom-resource.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CRD&lt;/a&gt; æ¥å¸®åŠ©ç”¨æˆ·è¿›è¡Œæµé‡ç®¡ç†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Gateway&lt;/strong&gt;ï¼šGateway æè¿°äº†åœ¨ç½‘ç»œè¾¹ç¼˜è¿è¡Œçš„è´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨äºæ¥æ”¶ä¼ å…¥æˆ–ä¼ å‡ºçš„ HTTP / TCP è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;VirtualService&lt;/strong&gt;ï¼š&lt;a href=&#34;https://istio.io/zh/docs/reference/config/istio.networking.v1alpha3/#virtualservice&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VirtualService&lt;/a&gt; å®é™…ä¸Šå°† Kubernetes æœåŠ¡è¿æ¥åˆ° Istio Gatewayã€‚å®ƒè¿˜å¯ä»¥æ‰§è¡Œæ›´å¤šæ“ä½œï¼Œä¾‹å¦‚å®šä¹‰ä¸€ç»„æµé‡è·¯ç”±è§„åˆ™ï¼Œä»¥ä¾¿åœ¨ä¸»æœºè¢«å¯»å€æ—¶åº”ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DestinationRule&lt;/strong&gt;ï¼š&lt;code&gt;DestinationRule&lt;/code&gt; æ‰€å®šä¹‰çš„ç­–ç•¥ï¼Œå†³å®šäº†ç»è¿‡è·¯ç”±å¤„ç†ä¹‹åçš„æµé‡çš„è®¿é—®ç­–ç•¥ã€‚ç®€å•çš„è¯´å°±æ˜¯å®šä¹‰æµé‡å¦‚ä½•è·¯ç”±ã€‚è¿™äº›ç­–ç•¥ä¸­å¯ä»¥å®šä¹‰è´Ÿè½½å‡è¡¡é…ç½®ã€è¿æ¥æ± å°ºå¯¸ä»¥åŠå¤–éƒ¨æ£€æµ‹ï¼ˆç”¨äºåœ¨è´Ÿè½½å‡è¡¡æ± ä¸­å¯¹ä¸å¥åº·ä¸»æœºè¿›è¡Œè¯†åˆ«å’Œé©±é€ï¼‰é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;EnvoyFilter&lt;/strong&gt;ï¼š&lt;code&gt;EnvoyFilter&lt;/code&gt; å¯¹è±¡æè¿°äº†é’ˆå¯¹ä»£ç†æœåŠ¡çš„è¿‡æ»¤å™¨ï¼Œè¿™äº›è¿‡æ»¤å™¨å¯ä»¥å®šåˆ¶ç”± Istio Pilot ç”Ÿæˆçš„ä»£ç†é…ç½®ã€‚è¿™ä¸ªé…ç½®åˆçº§ç”¨æˆ·ä¸€èˆ¬å¾ˆå°‘ç”¨åˆ°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ServiceEntry&lt;/strong&gt;ï¼šé»˜è®¤æƒ…å†µä¸‹ Istio Service Mesh ä¸­çš„æœåŠ¡æ˜¯æ— æ³•å‘ç° Mesh å¤–çš„æœåŠ¡çš„ï¼Œ&lt;code&gt;ServiceEntry&lt;/code&gt; èƒ½å¤Ÿåœ¨ Istio å†…éƒ¨çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­åŠ å…¥é¢å¤–çš„æ¡ç›®ï¼Œä»è€Œè®©ç½‘æ ¼ä¸­è‡ªåŠ¨å‘ç°çš„æœåŠ¡èƒ½å¤Ÿè®¿é—®å’Œè·¯ç”±åˆ°è¿™äº›æ‰‹å·¥åŠ å…¥çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;kubernetes-vs-envoy-xds-vs-istio&#34;&gt;Kubernetes vs Envoy xDS vs Istio&lt;/h2&gt;
&lt;p&gt;åœ¨é˜…è¯»å®Œä¸Šæ–‡å¯¹ Kubernetes çš„ &lt;code&gt;kube-proxy&lt;/code&gt; ç»„ä»¶ã€Envoy xDS å’Œ Istio ä¸­æµé‡ç®¡ç†çš„æŠ½è±¡æ¦‚å¿µä¹‹åï¼Œä¸‹é¢å°†å¸¦æ‚¨ä»…å°±æµé‡ç®¡ç†æ–¹é¢æ¯”è¾ƒä¸‹ä¸‰è€…å¯¹åº”çš„ç»„ä»¶/åè®®ï¼ˆæ³¨æ„ï¼Œä¸‰è€…ä¸å¯ä»¥å®Œå…¨ç­‰åŒï¼‰ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Kubernetes&lt;/th&gt;
&lt;th&gt;Envoy xDS&lt;/th&gt;
&lt;th&gt;Istio Service Mesh&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Endpoint&lt;/td&gt;
&lt;td&gt;Endpoint&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Service&lt;/td&gt;
&lt;td&gt;Route&lt;/td&gt;
&lt;td&gt;VirtualService&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kube-proxy&lt;/td&gt;
&lt;td&gt;Route&lt;/td&gt;
&lt;td&gt;DestinationRule&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kube-proxy&lt;/td&gt;
&lt;td&gt;Listener&lt;/td&gt;
&lt;td&gt;EnvoyFilter&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Ingress&lt;/td&gt;
&lt;td&gt;Listener&lt;/td&gt;
&lt;td&gt;Gateway&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Service&lt;/td&gt;
&lt;td&gt;Cluster&lt;/td&gt;
&lt;td&gt;ServiceEntry&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å¦‚æœè¯´ Kubernetes ç®¡ç†çš„å¯¹è±¡æ˜¯ Podï¼Œé‚£ä¹ˆ Service Mesh ä¸­ç®¡ç†çš„å¯¹è±¡å°±æ˜¯ä¸€ä¸ªä¸ª Serviceï¼Œæ‰€ä»¥è¯´ä½¿ç”¨ Kubernetes ç®¡ç†å¾®æœåŠ¡åå†åº”ç”¨ Service Mesh å°±æ˜¯æ°´åˆ°æ¸ æˆäº†ï¼Œå¦‚æœè¿ Service ä½ ä¹Ÿä¸åƒç®¡äº†ï¼Œé‚£å°±ç”¨å¦‚ &lt;a href=&#34;https://github.com/knative/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;knative&lt;/a&gt; è¿™æ ·çš„ serverless å¹³å°ï¼Œè¿™å°±æ˜¯åè¯äº†ã€‚&lt;/p&gt;
&lt;p&gt;Envoy çš„åŠŸèƒ½ä¹Ÿä¸åªæ˜¯åšæµé‡è½¬å‘ï¼Œä»¥ä¸Šæ¦‚å¿µåªä¸è¿‡æ˜¯ Istio åœ¨ Kubernetes ä¹‹ä¸Šæ–°å¢ä¸€å±‚æŠ½è±¡å±‚ä¸­çš„å†°å±±ä¸€è§’ï¼Œä½†å› ä¸ºæµé‡ç®¡ç†æ˜¯æœåŠ¡ç½‘æ ¼æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€é‡è¦çš„åŠŸèƒ½ï¼Œæ‰€ä»¥æœ¬æ–‡ä»è¿™é‡Œå¼€å§‹ï¼Œä»¥åå°†ç»™å¤§å®¶ä»‹ç»æ›´å¤šå…³äºæœåŠ¡ç½‘æ ¼çš„ç»†èŠ‚ï¼Œè¯·å…³æ³¨æˆ‘çš„åšå®¢ &lt;a href=&#34;https://jimmysong.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;jimmysong.io&lt;/a&gt; å’Œ &lt;a href=&#34;https://jimmysong.io/istio-handbook/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;istio-handbook&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/posts/istio-traffic-management-basic-concepts/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æµé‡ç®¡ç†çš„åŸºæœ¬æ¦‚å¿µè¯¦è§£ - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/service.html#iptables-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes  kube-proxy ä¸­çš„ iptables ä»£ç†æ¨¡å¼ - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/service.html#ipvs-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes kube-proxy ä¸­çš„ ipvs ä»£ç†æ¨¡å¼ - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/overview/v2_overview.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy v2 API æ¦‚è§ˆ - servicemesher.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/listeners/lds.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç›‘å¬å™¨å‘ç°æœåŠ¡ï¼ˆLDSï¼‰- servicemesher.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/http_conn_man/rds.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯ç”±å‘ç°æœåŠ¡ï¼ˆRDSï¼‰- servicemesher.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/cluster_manager/cds.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›†ç¾¤å‘ç°æœåŠ¡ï¼ˆCDSï¼‰- servicemesher.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/service.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes service - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/istio-handbook/concepts/envoy-xds-protocol.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS åè®®è§£æ - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/163yun/p/8962278.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·±å…¥è§£è¯» Service Mesh èƒŒåçš„æŠ€æœ¯ç»†èŠ‚ - cnblogs.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/posts/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cizixs.com/2017/03/30/kubernetes-introduction-service-and-kube-proxy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes ç®€ä»‹ï¼šservice å’Œ kube-proxy åŸç† - cizixs.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jishu.io/kubernetes/ipvs-loadbalancer-for-kubernetes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ IPVS å®ç° Kubernetes å…¥å£æµé‡è´Ÿè½½å‡è¡¡ - jishu.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhaohuabing.com/post/2018-09-25-istio-traffic-management-impl-intro/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æµé‡ç®¡ç†å®ç°æœºåˆ¶æ·±åº¦è§£æ - zhaohuabing.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/posts/the-enterprise-path-to-service-mesh-architectures/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¼ä¸šçº§æœåŠ¡ç½‘æ ¼æ¶æ„ä¹‹è·¯è§£è¯» - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://preliminary.istio.io/zh/help/ops/traffic-management/proxy-cmd/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è°ƒè¯• Envoy å’Œ Pilot - istio.io&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Istio çš„æ•°æ®å¹³é¢ Envoy Proxy é…ç½®è¯¦è§£</title>
      <link>https://cloudnative.to/blog/envoy-proxy-config-deep-dive/</link>
      <pubDate>Mon, 07 Jan 2019 17:48:01 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-proxy-config-deep-dive/</guid>
      <description>&lt;p&gt;Envoy æ˜¯ Istio Service Mesh ä¸­é»˜è®¤çš„ Sidecarï¼ŒIstio åœ¨ Enovy çš„åŸºç¡€ä¸ŠæŒ‰ç…§ Envoy çš„ xDS åè®®æ‰©å±•äº†å…¶æ§åˆ¶å¹³é¢ï¼Œåœ¨è®²åˆ° Envoy xDS åè®®ä¹‹å‰è¿˜éœ€è¦æˆ‘ä»¬å…ˆç†Ÿæ‚‰ä¸‹ Envoy çš„åŸºæœ¬æœ¯è¯­ã€‚ä¸‹é¢åˆ—ä¸¾äº† Envoy é‡Œçš„åŸºæœ¬æœ¯è¯­åŠå…¶æ•°æ®ç»“æ„è§£æï¼Œå…³äº Envoy çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;http://www.servicemesher.com/envoy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ï¼Œè‡³äº Envoy åœ¨ Service Meshï¼ˆä¸ä»…é™äº Istioï¼‰ä¸­æ˜¯å¦‚ä½•ä½œä¸ºè½¬å‘ä»£ç†å·¥ä½œçš„è¯·å‚è€ƒç½‘æ˜“äº‘åˆ˜è¶…çš„è¿™ç¯‡&lt;a href=&#34;https://www.cnblogs.com/163yun/p/8962278.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·±å…¥è§£è¯» Service Mesh èƒŒåçš„æŠ€æœ¯ç»†èŠ‚ &lt;/a&gt;ä»¥åŠ&lt;a href=&#34;https://jimmysong.io/posts/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ&lt;/a&gt;ï¼Œæœ¬æ–‡å¼•ç”¨å…¶ä¸­çš„ä¸€äº›è§‚ç‚¹ï¼Œè¯¦ç»†å†…å®¹ä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy-proxy-æ¶æ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy proxy æ¶æ„å›¾&#34; srcset=&#34;
               /blog/envoy-proxy-config-deep-dive/006tNbRwly1fy9qkff5nij314k0ts43z_hu3389d28631a70c0b3d55cd6a303e2cf6_154159_85713d3138a611650a7272921448334e.webp 400w,
               /blog/envoy-proxy-config-deep-dive/006tNbRwly1fy9qkff5nij314k0ts43z_hu3389d28631a70c0b3d55cd6a303e2cf6_154159_9cab5af5de315ac9534368e0831ea239.webp 760w,
               /blog/envoy-proxy-config-deep-dive/006tNbRwly1fy9qkff5nij314k0ts43z_hu3389d28631a70c0b3d55cd6a303e2cf6_154159_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-proxy-config-deep-dive/006tNbRwly1fy9qkff5nij314k0ts43z_hu3389d28631a70c0b3d55cd6a303e2cf6_154159_85713d3138a611650a7272921448334e.webp&#34;
               width=&#34;760&#34;
               height=&#34;558&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy proxy æ¶æ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;åŸºæœ¬æœ¯è¯­&#34;&gt;åŸºæœ¬æœ¯è¯­&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æ‚¨åº”è¯¥äº†è§£çš„ Enovy é‡Œçš„åŸºæœ¬æœ¯è¯­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Downstreamï¼ˆä¸‹æ¸¸ï¼‰&lt;/strong&gt;ï¼šä¸‹æ¸¸ä¸»æœºè¿æ¥åˆ° Envoyï¼Œå‘é€è¯·æ±‚å¹¶æ¥æ”¶å“åº”ï¼Œå³å‘é€è¯·æ±‚çš„ä¸»æœºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Upstreamï¼ˆä¸Šæ¸¸ï¼‰&lt;/strong&gt;ï¼šä¸Šæ¸¸ä¸»æœºæ¥æ”¶æ¥è‡ª Envoy çš„è¿æ¥å’Œè¯·æ±‚ï¼Œå¹¶è¿”å›å“åº”ï¼Œå³æ¥å—è¯·æ±‚çš„ä¸»æœºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Listenerï¼ˆç›‘å¬å™¨ï¼‰&lt;/strong&gt;ï¼šç›‘å¬å™¨æ˜¯å‘½åç½‘åœ°å€ï¼ˆä¾‹å¦‚ï¼Œç«¯å£ã€unix domain socket ç­‰)ï¼Œä¸‹æ¸¸å®¢æˆ·ç«¯å¯ä»¥è¿æ¥è¿™äº›ç›‘å¬å™¨ã€‚Envoy æš´éœ²ä¸€ä¸ªæˆ–è€…å¤šä¸ªç›‘å¬å™¨ç»™ä¸‹æ¸¸ä¸»æœºè¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Clusterï¼ˆé›†ç¾¤ï¼‰&lt;/strong&gt;ï¼šé›†ç¾¤æ˜¯æŒ‡ Envoy è¿æ¥çš„ä¸€ç»„é€»è¾‘ç›¸åŒçš„ä¸Šæ¸¸ä¸»æœºã€‚Envoy é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/service_discovery.html#arch-overview-service-discovery&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡å‘ç°&lt;/a&gt;æ¥å‘ç°é›†ç¾¤çš„æˆå‘˜ã€‚å¯ä»¥é€‰æ‹©é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/health_checking.html#arch-overview-health-checking&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸»åŠ¨å¥åº·æ£€æŸ¥&lt;/a&gt;æ¥ç¡®å®šé›†ç¾¤æˆå‘˜çš„å¥åº·çŠ¶æ€ã€‚Envoy é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/load_balancing.html#arch-overview-load-balancing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´Ÿè½½å‡è¡¡ç­–ç•¥&lt;/a&gt;å†³å®šå°†è¯·æ±‚è·¯ç”±åˆ°é›†ç¾¤çš„å“ªä¸ªæˆå‘˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘å°†åœ¨æœ¬æ–‡çš„ååŠéƒ¨åˆ†è§£é‡Šä»¥ä¸Šæœ¯è¯­ä¸ Kubernetesã€Istio ä¸­æ¦‚å¿µä¹‹é—´çš„è”ç³»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äº-xds-çš„ç‰ˆæœ¬&#34;&gt;å…³äº xDS çš„ç‰ˆæœ¬&lt;/h2&gt;
&lt;p&gt;æœ‰ä¸€ç‚¹éœ€è¦å¤§å®¶æ³¨æ„ï¼Œå°±æ˜¯ Envoy çš„ API æœ‰ v1 å’Œ v2 ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä» Envoy 1.5.0 èµ· v2 API å°±å·²ç»ç”Ÿäº§å°±ç»ªäº†ï¼Œä¸ºäº†èƒ½å¤Ÿè®©ç”¨æˆ·é¡ºåˆ©çš„å‘ v2 ç‰ˆæœ¬çš„é¢ API è¿‡åº¦ï¼ŒEnvoy å¯åŠ¨çš„æ—¶å€™è®¾ç½®äº†ä¸€ä¸ª &lt;code&gt;--v2-config-only&lt;/code&gt; çš„æ ‡å¿—ï¼ŒEnovy ä¸åŒç‰ˆæœ¬å¯¹ v1/v2 API çš„æ”¯æŒè¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://groups.google.com/forum/#!topic/envoy-announce/Lb1QZcSclGQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy v1 é…ç½®åºŸå¼ƒæ—¶é—´è¡¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Envoy çš„ä½œè€… Matt Klein åœ¨ &lt;a href=&#34;http://www.servicemesher.com/blog/the-universal-data-plane-api/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh ä¸­çš„é€šç”¨æ•°æ®å¹³é¢ API è®¾è®¡&lt;/a&gt;è¿™ç¯‡æ–‡ç« ä¸­è¯´æ˜äº† Envoy API v1 çš„å†å²åŠå…¶ç¼ºç‚¹ï¼Œè¿˜æœ‰ v2 çš„å¼•å…¥ã€‚v2 API æ˜¯ v1 çš„æ¼”è¿›ï¼Œè€Œä¸æ˜¯é©å‘½ï¼Œå®ƒæ˜¯ v1 åŠŸèƒ½çš„è¶…é›†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio 1.0 åŠä»¥ä¸Šç‰ˆæœ¬ä¸­ä½¿ç”¨çš„æ˜¯ &lt;strong&gt;Envoy 1.8.0-dev&lt;/strong&gt; ç‰ˆæœ¬ï¼Œå…¶æ”¯æŒ v2 çš„ APIï¼ŒåŒæ—¶åœ¨ Envoy ä½œä¸º Sidecar proxy å¯åŠ¨çš„ä½¿ç”¨ä½¿ç”¨äº†ä¾‹å¦‚ä¸‹é¢çš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ /usr/local/bin/envoy -c /etc/istio/proxy/envoy-rev0.json --restart-epoch &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; --drain-time-s &lt;span class=&#34;m&#34;&gt;45&lt;/span&gt; --parent-shutdown-time-s &lt;span class=&#34;m&#34;&gt;60&lt;/span&gt; --service-cluster ratings --service-node sidecar~172.33.14.2~ratings-v1-8558d4458d-ld8x9.default~default.svc.cluster.local --max-obj-name-len &lt;span class=&#34;m&#34;&gt;189&lt;/span&gt; --allow-unknown-fields -l warn --v2-config-only
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢æ˜¯éƒ½ Bookinfo ç¤ºä¾‹ä¸­çš„ rating pod ä¸­çš„ sidecar å¯åŠ¨çš„åˆ†æï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­æŒ‡å®šäº† &lt;code&gt;--v2-config-only&lt;/code&gt;ï¼Œè¡¨æ˜ Istio 1.0+ åªæ”¯æŒ xDS v2 çš„ APIã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-sidecar-proxy-é…ç½®&#34;&gt;Istio sidecar proxy é…ç½®&lt;/h2&gt;
&lt;p&gt;å‡å¦‚æ‚¨ä½¿ç”¨ &lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes-vagrant-centos-cluster&lt;/a&gt; éƒ¨ç½²äº† Kubernetes é›†ç¾¤å¹¶å¼€å¯äº† &lt;a href=&#34;https://istio.io/zh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Service Mesh&lt;/a&gt;ï¼Œå†éƒ¨ç½² &lt;a href=&#34;https://istio.io/zh/docs/examples/bookinfo/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bookinfo ç¤ºä¾‹&lt;/a&gt;ï¼Œé‚£ä¹ˆåœ¨ &lt;code&gt;default&lt;/code&gt; å‘½åç©ºé—´ä¸‹æœ‰ä¸€ä¸ªåå­—ç±»ä¼¼äº &lt;code&gt;ratings-v1-7c9949d479-dwkr4&lt;/code&gt; çš„ Podï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹è¯¥ Pod çš„ Envoy sidecar çš„å…¨é‡é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n default &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; ratings-v1-7c9949d479-dwkr4 -c istio-proxy curl http://localhost:15000/config_dump &amp;gt; dump-rating.json
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°† Envoy çš„è¿è¡Œæ—¶é…ç½® dump å‡ºæ¥ä¹‹åä½ å°†çœ‹åˆ°ä¸€ä¸ªé•¿ 6000 ä½™è¡Œçš„é…ç½®æ–‡ä»¶ã€‚å…³äºè¯¥é…ç½®æ–‡ä»¶çš„ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/overview/v2_overview.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy v2 API æ¦‚è§ˆ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy-é…ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy é…ç½®&#34; srcset=&#34;
               /blog/envoy-proxy-config-deep-dive/006tNbRwly1fyb74brsd5j30xg0lojvt_hud6d28e89c2570976eff46bb02abe27c8_115920_a50923d65ac7fe0f5d78bf8bad888fdf.webp 400w,
               /blog/envoy-proxy-config-deep-dive/006tNbRwly1fyb74brsd5j30xg0lojvt_hud6d28e89c2570976eff46bb02abe27c8_115920_0fdf256355bb9bd84a77b098a8acbda3.webp 760w,
               /blog/envoy-proxy-config-deep-dive/006tNbRwly1fyb74brsd5j30xg0lojvt_hud6d28e89c2570976eff46bb02abe27c8_115920_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-proxy-config-deep-dive/006tNbRwly1fyb74brsd5j30xg0lojvt_hud6d28e89c2570976eff46bb02abe27c8_115920_a50923d65ac7fe0f5d78bf8bad888fdf.webp&#34;
               width=&#34;760&#34;
               height=&#34;492&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy é…ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio ä¼šåœ¨ä¸º Service Mesh ä¸­çš„æ¯ä¸ª Pod æ³¨å…¥ Sidecar çš„æ—¶å€™åŒæ—¶ä¸º Envoy æ³¨å…¥ Bootstrap é…ç½®ï¼Œå…¶ä½™çš„é…ç½®æ˜¯é€šè¿‡ Pilot ä¸‹å‘çš„ï¼Œæ³¨æ„æ•´ä¸ªæ•°æ®å¹³é¢å³ Service Mesh ä¸­çš„ Envoy çš„åŠ¨æ€é…ç½®åº”è¯¥æ˜¯ç›¸åŒçš„ã€‚æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤æ£€æŸ¥å…¶ä»– sidecar çš„ Envoy é…ç½®æ˜¯å¦è·Ÿæœ€ä¸Šé¢çš„é‚£ä¸ªç›¸åŒã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ£€æŸ¥ Service Mesh ä¸­çš„æ‰€æœ‰æœ‰ Sidecar æ³¨å…¥çš„ Pod ä¸­çš„ proxy é…ç½®æ˜¯å¦åŒæ­¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl proxy-status
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PROXY                                                 CDS        LDS        EDS               RDS          PILOT                            VERSION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;details-v1-876bf485f-sx7df.default                    SYNCED     SYNCED     SYNCED &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;100%&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;     SYNCED       istio-pilot-5bf6d97f79-6lz4x     1.0.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://istio.io/zh/docs/reference/commands/istioctl/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;istioctl&lt;/a&gt; è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·å°±åƒ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/guide/kubectl-cheatsheet.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubectl&lt;/a&gt; ä¸€æ ·æœ‰å¾ˆå¤šç¥å™¨çš„é­”æ³•ï¼Œé€šè¿‡å®ƒå¯ä»¥é«˜æ•ˆçš„ç®¡ç† Istio å’Œ debugã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-proxy-é…ç½®è§£æ&#34;&gt;Envoy proxy é…ç½®è§£æ&lt;/h2&gt;
&lt;p&gt;Istio envoy sidecar proxy é…ç½®ä¸­åŒ…å«ä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;bootstrap&lt;/strong&gt;ï¼šEnvoy proxy å¯åŠ¨æ—¶å€™åŠ è½½çš„é™æ€é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;listeners&lt;/strong&gt;ï¼šç›‘å¬å™¨é…ç½®ï¼Œä½¿ç”¨ LDS ä¸‹å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;clusters&lt;/strong&gt;ï¼šé›†ç¾¤é…ç½®ï¼Œé™æ€é…ç½®ä¸­åŒ…æ‹¬ xds-grpc å’Œ zipkin åœ°å€ï¼ŒåŠ¨æ€é…ç½®ä½¿ç”¨  CDS ä¸‹å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;routes&lt;/strong&gt;ï¼šè·¯ç”±é…ç½®ï¼Œé™æ€é…ç½®ä¸­åŒ…æ‹¬äº†æœ¬åœ°ç›‘å¬çš„æœåŠ¡çš„é›†ç¾¤ä¿¡æ¯ï¼Œå…¶ä¸­å¼•ç”¨äº† clusterï¼ŒåŠ¨æ€é…ç½®ä½¿ç”¨ RDS ä¸‹å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¯ä¸ªéƒ¨åˆ†ä¸­éƒ½åŒ…å«é™æ€é…ç½®ä¸åŠ¨æ€é…ç½®ï¼Œå…¶ä¸­ bootstrap é…ç½®åˆæ˜¯åœ¨é›†ç¾¤å¯åŠ¨çš„æ—¶å€™é€šè¿‡ sidecar å¯åŠ¨å‚æ•°æ³¨å…¥çš„ï¼Œé…ç½®æ–‡ä»¶åœ¨ &lt;code&gt;/etc/istio/proxy/envoy-rev0.json&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Enovy çš„é…ç½® dump å‡ºæ¥åçš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy-é…ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy é…ç½®&#34; srcset=&#34;
               /blog/envoy-proxy-config-deep-dive/006tNbRwly1fy2x2zk1hhj30ee0h9jtg_hu02b8b795d6e73b215602cc762c75b25c_61934_9e1cab2e8a00ef1cbf32304c9527cb68.webp 400w,
               /blog/envoy-proxy-config-deep-dive/006tNbRwly1fy2x2zk1hhj30ee0h9jtg_hu02b8b795d6e73b215602cc762c75b25c_61934_bb1588e43a83a08ee34c9acc320d3710.webp 760w,
               /blog/envoy-proxy-config-deep-dive/006tNbRwly1fy2x2zk1hhj30ee0h9jtg_hu02b8b795d6e73b215602cc762c75b25c_61934_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-proxy-config-deep-dive/006tNbRwly1fy2x2zk1hhj30ee0h9jtg_hu02b8b795d6e73b215602cc762c75b25c_61934_9e1cab2e8a00ef1cbf32304c9527cb68.webp&#34;
               width=&#34;518&#34;
               height=&#34;621&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy é…ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç”±äº bootstrap ä¸­çš„é…ç½®æ˜¯æ¥è‡ª Envoy å¯åŠ¨æ—¶åŠ è½½çš„é™æ€æ–‡ä»¶ï¼Œä¸»è¦é…ç½®äº†èŠ‚ç‚¹ä¿¡æ¯ã€tracingã€admin å’Œç»Ÿè®¡ä¿¡æ¯æ”¶é›†ç­‰ä¿¡æ¯ï¼Œè¿™ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œç ”ç©¶ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-bootstrap-é…ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;bootstrap é…ç½®&#34; srcset=&#34;
               /blog/envoy-proxy-config-deep-dive/006tNbRwly1fy2xid761zj30c70ai0tj_hu3f8b9398f496a5383a5d6603e9d1e3e7_23719_75e8d8e5a68974d8549b257d8c0f4aab.webp 400w,
               /blog/envoy-proxy-config-deep-dive/006tNbRwly1fy2xid761zj30c70ai0tj_hu3f8b9398f496a5383a5d6603e9d1e3e7_23719_7f7cc50421351f767f638fab6603d6a7.webp 760w,
               /blog/envoy-proxy-config-deep-dive/006tNbRwly1fy2xid761zj30c70ai0tj_hu3f8b9398f496a5383a5d6603e9d1e3e7_23719_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-proxy-config-deep-dive/006tNbRwly1fy2xid761zj30c70ai0tj_hu3f8b9398f496a5383a5d6603e9d1e3e7_23719_75e8d8e5a68974d8549b257d8c0f4aab.webp&#34;
               width=&#34;439&#34;
               height=&#34;378&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      bootstrap é…ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ˜¯ bootstrap çš„é…ç½®ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Bootstrap&lt;/a&gt; æ˜¯ Envoy ä¸­é…ç½®çš„æ ¹æœ¬æ¥æºï¼Œ&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Bootstrap&lt;/a&gt; æ¶ˆæ¯ä¸­æœ‰ä¸€ä¸ªå…³é”®çš„æ¦‚å¿µï¼Œå°±æ˜¯é™æ€å’ŒåŠ¨æ€èµ„æºçš„ä¹‹é—´çš„åŒºåˆ«ã€‚ä¾‹å¦‚ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/lds.proto.html#envoy-api-msg-listener&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Listener&lt;/a&gt; æˆ– &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cds.proto.html#envoy-api-msg-cluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cluster&lt;/a&gt; è¿™äº›èµ„æºæ—¢å¯ä»¥ä» &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-static-resources&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;static_resources&lt;/a&gt; é™æ€çš„è·å¾—ä¹Ÿå¯ä»¥ä» &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-dynamic-resources&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;dynamic_resources&lt;/a&gt; ä¸­é…ç½®çš„ &lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/listeners/lds.html#config-listeners-lds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;LDS&lt;/a&gt; æˆ– &lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/cluster_manager/cds.html#config-cluster-manager-cds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CDS&lt;/a&gt; ä¹‹ç±»çš„ xDS æœåŠ¡è·å–ã€‚&lt;/p&gt;
&lt;h3 id=&#34;listener&#34;&gt;Listener&lt;/h3&gt;
&lt;p&gt;Listener é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç›‘å¬å™¨ï¼Œç›‘å¬ IP åœ°å€å’Œç«¯å£ï¼Œç„¶åæ ¹æ®ç­–ç•¥è½¬å‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Listener çš„ç‰¹ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ª Envoy è¿›ç¨‹ä¸­å¯ä»¥æœ‰å¤šä¸ª Listenerï¼ŒEnvoy ä¸ Listener ä¹‹é—´æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ª Listener ä¸­å¯ä»¥é…ç½®ä¸€æ¡ filter é“¾è¡¨ï¼ˆfilter_chainsï¼‰ï¼ŒEnvoy ä¼šæ ¹æ® filter é¡ºåºæ‰§è¡Œè¿‡æ»¤ã€‚&lt;/li&gt;
&lt;li&gt;Listener å¯ä»¥ç›‘å¬ä¸‹æ¸¸çš„ç«¯å£ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶æ¥è‡ªå…¶ä»– listener çš„æ•°æ®ï¼Œå½¢æˆé“¾å¼å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;filter æ˜¯å¯æ‰©å±•çš„ã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥é™æ€é…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ LDS åŠ¨æ€é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;ç›®å‰åªèƒ½ç›‘å¬ TCPï¼ŒUDP è¿˜æœªæ”¯æŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Listener çš„æ•°æ®ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Listener çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼Œé™¤äº† &lt;code&gt;name&lt;/code&gt;ã€&lt;code&gt;address&lt;/code&gt; å’Œ &lt;code&gt;filter_chains&lt;/code&gt; ä¸ºå¿…é¡»é…ç½®ä¹‹å¤–ï¼Œå…¶ä»–éƒ½ä¸ºå¯é€‰çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_chains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;use_original_dst&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;per_connection_buffer_limit_bytes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;drain_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener_filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;transparent&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;freebind&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;tcp_fast_open_queue_length&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;bugfix_reverse_write_filter_order&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯å…³äºä¸Šè¿°æ•°æ®ç»“æ„ä¸­çš„å¸¸ç”¨é…ç½®è§£æã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;name&lt;/strong&gt;ï¼šè¯¥ listener çš„ UUIDï¼Œå”¯ä¸€é™å®šåï¼Œé»˜è®¤ 60 ä¸ªå­—ç¬¦ï¼Œä¾‹å¦‚ &lt;code&gt;10.254.74.159_15011&lt;/code&gt;ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤å‚æ•°æŒ‡å®šé•¿åº¦é™åˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;address&lt;/strong&gt;ï¼šç›‘å¬çš„é€»è¾‘/ç‰©ç†åœ°å€å’Œç«¯å£å·ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.254.74.159&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15011&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;filter_chains&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼ŒEnvoy ä¸­å†…ç½®äº†ä¸€äº›é€šç”¨çš„ filterï¼Œæ¯ç§ filter éƒ½æœ‰ç‰¹å®šçš„æ•°æ®ç»“æ„ï¼ŒEnovy ä¼šæ ¹æ®è¯¥é…ç½®é¡ºåºæ‰§è¡Œ filterã€‚Envoy ä¸­å†…ç½®çš„ filter æœ‰ï¼š&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/client_ssl_auth_filter#config-network-filters-client-ssl-auth&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;envoy.client_ssl_auth&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/echo_filter#config-network-filters-echo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;envoy.echo&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/http_conn_man/http_conn_man#config-http-conn-man&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;enovy.http_connection_manager&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/mongo_proxy_filter#config-network-filters-mongo-proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;envoy.mongo_proxy&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/rate_limit_filter#config-network-filters-rate-limit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;envoy.rate_limit&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/redis_proxy_filter#config-network-filters-redis-proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;enovy.redis_proxy&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/tcp_proxy_filter#config-network-filters-tcp-proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;envoy.tcp_proxy&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/intro/arch_overview/http_filters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http_filters&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/thrift_filters/thrift_filters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;thrift_filters&lt;/a&gt;ç­‰ã€‚è¿™äº› filter å¯ä»¥å•ç‹¬ä½¿ç”¨ä¹Ÿå¯ä»¥ç»„åˆä½¿ç”¨ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰æ‰©å±•ï¼Œä¾‹å¦‚ä½¿ç”¨ Istio ä¸­çš„ &lt;a href=&#34;https://istio.io/zh/docs/reference/config/istio.networking.v1alpha3/#envoyfilter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EnvoyFilter é…ç½®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;use_original_dst&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœä½¿ç”¨ iptables é‡å®šå‘è¿æ¥ï¼Œåˆ™ä»£ç†æ¥æ”¶çš„ç«¯å£å¯èƒ½ä¸&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/listener_filters/original_dst_filter.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸå§‹ç›®çš„åœ°å€&lt;/a&gt;çš„ç«¯å£ä¸ä¸€æ ·ã€‚å½“æ­¤æ ‡å¿—è®¾ç½®ä¸º true æ—¶ï¼ŒListener å°†é‡å®šå‘çš„è¿æ¥åˆ‡æ¢åˆ°ä¸åŸå§‹ç›®çš„åœ°å€å…³è”çš„ Listenerã€‚å¦‚æœæ²¡æœ‰ä¸åŸå§‹ç›®çš„åœ°å€å…³è”çš„ Listenerï¼Œåˆ™è¿æ¥ç”±æ¥æ”¶å®ƒçš„ Listener å¤„ç†ã€‚é»˜è®¤ä¸º falseã€‚æ³¨æ„ï¼šè¯¥å‚æ•°å°†è¢«åºŸå¼ƒï¼Œè¯·ä½¿ç”¨&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/listener_filters/original_dst_filter.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸå§‹ç›®çš„åœ°å€&lt;/a&gt;çš„ Listener filter æ›¿ä»£ã€‚è¯¥å‚æ•°çš„ä¸»è¦ç”¨é€”æ˜¯ï¼šEnvoy é€šè¿‡ç›‘å¬ 15001 ç«¯å£å°†åº”ç”¨çš„æµé‡æˆªå–åå†ç”±å…¶ä»– Listener å¤„ç†è€Œä¸æ˜¯ç›´æ¥è½¬å‘å‡ºå»ï¼Œè¯¦æƒ…è§ &lt;a href=&#34;https://zhaohuabing.com/post/2018-09-25-istio-traffic-management-impl-intro/#virtual-listener&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Virtual Listener&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äº Listener çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/lds.proto#envoy-api-msg-listener&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy v2 API reference - listener&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;route&#34;&gt;Route&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨è¿™é‡Œæ‰€è¯´çš„è·¯ç”±æŒ‡çš„æ˜¯ &lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/http_routing.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP è·¯ç”±&lt;/a&gt;ï¼Œè¿™ä¹Ÿä½¿å¾— Envoy å¯ä»¥ç”¨æ¥å¤„ç†ç½‘æ ¼è¾¹ç¼˜çš„æµé‡ã€‚HTTP è·¯ç”±è½¬å‘æ˜¯é€šè¿‡è·¯ç”±è¿‡æ»¤å™¨å®ç°çš„ã€‚è¯¥è¿‡æ»¤å™¨çš„ä¸»è¦èŒèƒ½å°±æ˜¯æ‰§è¡Œ&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v1/route_config/route_config#config-http-conn-man-route-table&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯ç”±è¡¨&lt;/a&gt;ä¸­çš„æŒ‡ä»¤ã€‚é™¤äº†å¯ä»¥åšé‡å®šå‘å’Œè½¬å‘ï¼Œè·¯ç”±è¿‡æ»¤å™¨è¿˜éœ€è¦å¤„ç†é‡è¯•ã€ç»Ÿè®¡ä¹‹ç±»çš„ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HTTP è·¯ç”±çš„ç‰¹ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‰ç¼€å’Œç²¾ç¡®è·¯å¾„åŒ¹é…è§„åˆ™ã€‚&lt;/li&gt;
&lt;li&gt;å¯è·¨è¶Šå¤šä¸ªä¸Šæ¸¸é›†ç¾¤è¿›è¡ŒåŸºäº&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v1/route_config/route#config-http-conn-man-route-table-route-weighted-clusters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æƒé‡/ç™¾åˆ†æ¯”çš„è·¯ç”±&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åŸºäº&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/http_routing.html#arch-overview-http-routing-priority&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¼˜å…ˆçº§&lt;/a&gt;çš„è·¯ç”±ã€‚&lt;/li&gt;
&lt;li&gt;åŸºäº&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v1/route_config/route#config-http-conn-man-route-table-hash-policy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å“ˆå¸Œ&lt;/a&gt;ç­–ç•¥çš„è·¯ç”±ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Route çš„æ•°æ®ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;virtual_hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;internal_only_headers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;response_headers_to_add&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;response_headers_to_remove&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;request_headers_to_add&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;request_headers_to_remove&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;validate_clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯å…³äºä¸Šè¿°æ•°æ®ç»“æ„ä¸­çš„å¸¸ç”¨é…ç½®è§£æã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;name&lt;/strong&gt;ï¼šè¯¥åå­—è·Ÿ &lt;code&gt;envoy.http_connection_manager&lt;/code&gt; filter ä¸­çš„ &lt;code&gt;http_filters.rds.route_config_name&lt;/code&gt; ä¸€è‡´ï¼Œåœ¨ Istio Service Mesh ä¸­ä¸º Envoy ä¸‹å‘çš„é…ç½®ä¸­çš„ Route æ˜¯ä»¥ç›‘å¬çš„ç«¯å£å·ä½œä¸ºåå­—ï¼Œè€ŒåŒä¸€ä¸ªåå­—ä¸‹é¢çš„ &lt;code&gt;virtual_hosts&lt;/code&gt; å¯ä»¥æœ‰å¤šä¸ªå€¼ï¼ˆæ•°ç»„å½¢å¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;virtual_hosts&lt;/strong&gt;ï¼šå› ä¸º &lt;strong&gt;VirtualHosts&lt;/strong&gt; æ˜¯ Envoy ä¸­å¼•å…¥çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œæˆ‘ä»¬åœ¨ä¸‹æ–‡å°†è¯¦ç»†è¯´æ˜ &lt;code&gt;virtual_hosts&lt;/code&gt; çš„æ•°æ®ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;validate_clusters&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨æ¥è®¾ç½®å¼€å¯ä½¿ç”¨ cluster manager æ¥æ£€æµ‹è·¯ç”±è¡¨å¼•ç”¨çš„ cluster æ˜¯å¦æœ‰æ•ˆã€‚å¦‚æœæ˜¯è·¯ç”±è¡¨æ˜¯é€šè¿‡ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/filter/network/http_connection_manager/v2/http_connection_manager.proto#envoy-api-field-config-filter-network-http-connection-manager-v2-httpconnectionmanager-route-config&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;route_config&lt;/a&gt; é™æ€é…ç½®çš„åˆ™è¯¥å€¼é»˜è®¤è®¾ç½®ä¸º trueï¼Œå¦‚æœæ˜¯ä½¿ç”¨ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/filter/network/http_connection_manager/v2/http_connection_manager.proto#envoy-api-field-config-filter-network-http-connection-manager-v2-httpconnectionmanager-rds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rds&lt;/a&gt; åŠ¨æ€é…ç½®çš„è¯ï¼Œåˆ™è¯¥å€¼é»˜è®¤è®¾ç½®ä¸º falseã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äº Route çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/rds.proto&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy v2 API reference - HTTP route configuration&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;routevirtualhost&#34;&gt;route.VirtualHost&lt;/h4&gt;
&lt;p&gt;VirtualHost å³ä¸Šæ–‡ä¸­ Route é…ç½®ä¸­çš„ &lt;code&gt;virtual_hosts&lt;/code&gt;ï¼ŒVirtualHost æ˜¯è·¯ç”±é…ç½®ä¸­çš„é¡¶çº§å…ƒç´ ã€‚æ¯ä¸ªè™šæ‹Ÿä¸»æœºéƒ½æœ‰ä¸€ä¸ªé€»è¾‘åç§°ä»¥åŠä¸€ç»„æ ¹æ®ä¼ å…¥è¯·æ±‚çš„ host header è·¯ç”±åˆ°å®ƒçš„åŸŸã€‚è¿™å…è®¸å•ä¸ª Listener ä¸ºå¤šä¸ªé¡¶çº§åŸŸè·¯å¾„æ ‘æä¾›æœåŠ¡ã€‚åŸºäºåŸŸé€‰æ‹©äº†è™šæ‹Ÿä¸»æœºå Envoy  å°±ä¼šå¤„ç†è·¯ç”±ä»¥æŸ¥çœ‹è¦è·¯ç”±åˆ°å“ªä¸ªä¸Šæ¸¸é›†ç¾¤æˆ–æ˜¯å¦æ‰§è¡Œé‡å®šå‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;VirtualHost çš„æ•°æ®ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ VirtualHost çš„æ•°æ®ç»“æ„ï¼Œé™¤äº† &lt;code&gt;name&lt;/code&gt; å’Œ &lt;code&gt;domains&lt;/code&gt; æ˜¯å¿…é¡»é…ç½®é¡¹å¤–ï¼Œå…¶ä»–çš†ä¸ºå¯é€‰é¡¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;require_tls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;virtual_clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;rate_limits&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;request_headers_to_add&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;request_headers_to_remove&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;response_headers_to_add&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;response_headers_to_remove&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;cors&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;per_filter_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;include_request_attempt_count&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯å…³äºä¸Šè¿°æ•°æ®ç»“æ„ä¸­çš„å¸¸ç”¨é…ç½®è§£æã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;name&lt;/strong&gt;ï¼šè¯¥ VirtualHost çš„åå­—ï¼Œä¸€èˆ¬æ˜¯ FQDN åŠ ç«¯å£ï¼Œå¦‚ &lt;code&gt;details.default.svc.cluster.local:9080&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;domains&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸ªç”¨æ¥åŒ¹é… VirtualHost çš„åŸŸåï¼ˆhost/authority headerï¼‰åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œä½†æ˜¯é€šé…ç¬¦ä¸èƒ½åŒ¹é…ç©ºå­—ç¬¦ï¼Œé™¤äº†ä»…ä½¿ç”¨ &lt;code&gt;*&lt;/code&gt; ä½œä¸º domainsï¼Œæ³¨æ„åˆ—è¡¨ä¸­çš„å€¼ä¸èƒ½é‡å¤å’Œå­˜åœ¨äº¤é›†ï¼Œåªè¦æœ‰ä¸€æ¡ domain è¢«åŒ¹é…ä¸Šäº†ï¼Œå°±ä¼šæ‰§è¡Œè·¯ç”±ã€‚Istio ä¼šä¸ºè¯¥å€¼é…ç½®æ‰€æœ‰åœ°å€è§£æå½¢å¼ï¼ŒåŒ…æ‹¬ IP åœ°å€ã€FQDN å’ŒçŸ­åŸŸåç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;routes&lt;/strong&gt;ï¼šé’ˆå¯¹å…¥å£æµé‡çš„æœ‰åºè·¯ç”±åˆ—è¡¨ï¼Œç¬¬ä¸€ä¸ªåŒ¹é…ä¸Šçš„è·¯ç”±å°†è¢«æ‰§è¡Œã€‚æˆ‘ä»¬åœ¨ä¸‹æ–‡å°†è¯¦ç»†è¯´æ˜ route çš„æ•°æ®ç»“æ„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªå®é™…çš„ VirtualHost çš„ä¾‹å­ï¼Œè¯¥é…ç½®æ¥è‡ª &lt;a href=&#34;https://istio.io/zh/docs/examples/bookinfo/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Bookinfo åº”ç”¨&lt;/a&gt;çš„ details åº”ç”¨çš„ Sidecar æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;details&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;details:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc.cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc.cluster:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.254.4.113&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.254.4.113:9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080||details.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_grpc_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;decorator&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;operation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc.cluster.local:9080/*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;per_filter_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;mixer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;forward_attributes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;attributes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;destination.service.uid&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio://default/services/details&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;destination.service.host&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc.cluster.local&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;destination.service.namespace&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;destination.service.name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;details&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;destination.service&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc.cluster.local&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;mixer_attributes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;attributes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;destination.service.host&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc.cluster.local&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;destination.service.uid&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio://default/services/details&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;destination.service.name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;details&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;destination.service.namespace&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;destination.service&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;string_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc.cluster.local&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;disable_check_calls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…³äº route.VirtualHost çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#envoy-api-msg-route-virtualhost&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy v2 API reference - route.VirtualHost&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;routeroute&#34;&gt;route.Route&lt;/h4&gt;
&lt;p&gt;è·¯ç”±æ—¢æ˜¯å¦‚ä½•åŒ¹é…è¯·æ±‚çš„è§„èŒƒï¼Œä¹Ÿæ˜¯å¯¹ä¸‹ä¸€æ­¥åšä»€ä¹ˆçš„æŒ‡ç¤ºï¼ˆä¾‹å¦‚ï¼Œredirectã€forwardã€rewrite ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;route.Route çš„æ•°æ®ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æ˜¯ route.Route çš„æ•°æ®ç»“æ„ï¼Œé™¤äº† &lt;code&gt;match&lt;/code&gt; ä¹‹å¤–å…¶ä½™éƒ½æ˜¯å¯é€‰çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;redirect&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;direct_response&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;decorator&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;per_filter_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;request_headers_to_add&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;request_headers_to_remove&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;response_headers_to_add&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;response_headers_to_remove&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯å…³äºä¸Šè¿°æ•°æ®ç»“æ„ä¸­çš„å¸¸ç”¨é…ç½®è§£æã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;match&lt;/strong&gt;ï¼šè·¯ç”±åŒ¹é…å‚æ•°ã€‚ä¾‹å¦‚ URL prefixï¼ˆå‰ç¼€ï¼‰ã€pathï¼ˆURL çš„å®Œæ•´è·¯å¾„ï¼‰ã€regexï¼ˆè§„åˆ™è¡¨è¾¾å¼ï¼‰ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;route&lt;/strong&gt;ï¼šè¿™é‡Œé¢é…ç½®è·¯ç”±çš„è¡Œä¸ºï¼Œå¯ä»¥æ˜¯ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#envoy-api-field-route-route-route&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;route&lt;/a&gt;ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#envoy-api-field-route-route-redirect&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;redirect&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#envoy-api-field-route-route-direct-response&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;direct_response&lt;/a&gt;ï¼Œä¸è¿‡è¿™é‡Œé¢æ²¡æœ‰ä¸“é—¨çš„ä¸€ä¸ªé…ç½®é¡¹ç”¨æ¥é…ç½®ä»¥ä¸Šä¸‰ç§è¡Œä¸ºï¼Œè€Œæ˜¯æ ¹æ®å®é™…å¡«å……çš„é…ç½®é¡¹æ¥ç¡®å®šçš„ã€‚ä¾‹å¦‚åœ¨æ­¤å¤„æ·»åŠ  &lt;code&gt;cluster&lt;/code&gt; é…ç½®åˆ™æš—ç¤ºè·¯ç”±åŠ¨ä½œä¸ºâ€routeâ€œï¼Œè¡¨ç¤ºå°†æµé‡è·¯ç”±åˆ°è¯¥ clusterã€‚è¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#route-routeaction&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;route.RouteAction&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;decorator&lt;/strong&gt;ï¼šè¢«åŒ¹é…çš„è·¯ç”±çš„ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºè¢«åŒ¹é…çš„è™šæ‹Ÿä¸»æœºå’Œ URLã€‚è¯¥é…ç½®é‡Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªå¿…é¡»é…ç½®çš„é¡¹ &lt;code&gt;operation&lt;/code&gt;ï¼Œä¾‹å¦‚ &lt;code&gt;details.default.svc.cluster.local:9080/*&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;per_filter_config&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸€ä¸ª map ç±»å‹ï¼Œ&lt;code&gt;per_filter_config&lt;/code&gt; å­—æ®µå¯ç”¨äºä¸º filter æä¾›ç‰¹å®šè·¯ç”±çš„é…ç½®ã€‚Map çš„ key åº”ä¸ filleter åç§°åŒ¹é…ï¼Œä¾‹å¦‚ç”¨äº HTTP buffer filter çš„ &lt;code&gt;envoy.buffer&lt;/code&gt;ã€‚è¯¥å­—æ®µæ˜¯ç‰¹å®šäº filter çš„ï¼Œè¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http_filters/http_filters#config-http-filters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP filter&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äº route.Route çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#envoy-api-msg-route-route&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy v2 API reference - route.Route&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cluster&#34;&gt;Cluster&lt;/h3&gt;
&lt;p&gt;Cluster æ˜¯æŒ‡ Envoy è¿æ¥çš„ä¸€ç»„é€»è¾‘ç›¸åŒçš„ä¸Šæ¸¸ä¸»æœºã€‚Envoy é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/service_discovery.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡å‘ç°&lt;/a&gt;æ¥å‘ç° cluster çš„æˆå‘˜ã€‚å¯ä»¥é€‰æ‹©é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/health_checking.html#arch-overview-health-checking&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸»åŠ¨å¥åº·æ£€æŸ¥&lt;/a&gt;æ¥ç¡®å®šé›†ç¾¤æˆå‘˜çš„å¥åº·çŠ¶æ€ã€‚Envoy é€šè¿‡&lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/load_balancing.html#arch-overview-load-balancing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´Ÿè½½å‡è¡¡ç­–ç•¥&lt;/a&gt;å†³å®šå°†è¯·æ±‚è·¯ç”±åˆ° cluster çš„å“ªä¸ªæˆå‘˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cluster çš„ç‰¹ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ç»„é€»è¾‘ä¸Šç›¸åŒçš„ä¸»æœºæ„æˆä¸€ä¸ª clusterã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥åœ¨ cluster ä¸­å®šä¹‰å„ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;æ–°åŠ å…¥çš„ cluster éœ€è¦ä¸€ä¸ªçƒ­èº«çš„è¿‡ç¨‹æ‰å¯ä»¥ç»™è·¯ç”±å¼•ç”¨ï¼Œè¯¥è¿‡ç¨‹æ˜¯åŸå­çš„ï¼Œå³åœ¨ cluster çƒ­èº«ä¹‹å‰å¯¹äº Envoy åŠ Service Mesh çš„å…¶ä½™éƒ¨åˆ†æ¥è¯´æ˜¯ä¸å¯è§çš„ã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ¥é…ç½® clusterï¼Œä¾‹å¦‚é™æ€ç±»å‹ã€ä¸¥æ ¼é™å®š DNSã€é€»è¾‘ DNSã€EDS ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Cluster çš„æ•°æ®ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Cluster çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼Œé™¤äº† &lt;code&gt;name&lt;/code&gt; å­—æ®µï¼Œå…¶ä»–éƒ½æ˜¯å¯é€‰çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;alt_stat_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;eds_cluster_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;per_connection_buffer_limit_bytes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_policy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;load_assignment&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;health_checks&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_requests_per_connection&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;circuit_breakers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;common_http_protocol_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;http_protocol_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;http2_protocol_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;extension_protocol_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;dns_refresh_rate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;dns_lookup_family&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;dns_resolvers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;outlier_detection&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;cleanup_interval&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;upstream_bind_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_subset_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;ring_hash_lb_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;original_dst_lb_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;least_request_lb_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;common_lb_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;protocol_selection&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;upstream_connection_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;close_connections_on_host_health_failure&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;drain_connections_on_host_removal&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯å…³äºä¸Šè¿°æ•°æ®ç»“æ„ä¸­çš„å¸¸ç”¨é…ç½®è§£æã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;name&lt;/strong&gt;ï¼šå¦‚æœä½ ç•™æ„åˆ°ä½œä¸º Sidecar å¯åŠ¨çš„ Envoy çš„å‚æ•°çš„ä¼šæ³¨æ„åˆ° &lt;code&gt;--max-obj-name-len 189&lt;/code&gt;ï¼Œè¯¥é€‰é¡¹ç”¨æ¥ç”¨æ¥æŒ‡å®š cluster çš„åå­—ï¼Œä¾‹å¦‚ &lt;code&gt;inbound|9080||ratings.default.svc.cluster.local&lt;/code&gt;ã€‚è¯¥åå­—å­—ç¬¦ä¸²ç”± &lt;code&gt;|&lt;/code&gt; åˆ†éš”æˆå››ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ &lt;code&gt;inbound&lt;/code&gt; æˆ– &lt;code&gt;outbound&lt;/code&gt; ä»£è¡¨å…¥å‘æµé‡æˆ–å‡ºå‘æµé‡ã€ç«¯å£å·ã€subcluster åç§°ã€FQDNï¼Œå…¶ä¸­ subcluster åç§°å°†å¯¹åº”äº Istio &lt;code&gt;DestinationRule&lt;/code&gt; ä¸­é…ç½®çš„ &lt;code&gt;subnet&lt;/code&gt;ï¼Œå¦‚æœæ˜¯æŒ‰ç…§å¤šç‰ˆæœ¬æŒ‰æ¯”ä¾‹è·¯ç”±çš„è¯ï¼Œè¯¥å€¼å¯ä»¥æ˜¯ç‰ˆæœ¬å·ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;type&lt;/strong&gt;ï¼šå³&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/service_discovery#arch-overview-service-discovery-types&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡å‘ç°ç±»å‹&lt;/a&gt;ï¼Œæ”¯æŒçš„å‚æ•°æœ‰ &lt;code&gt;STATIC&lt;/code&gt;ï¼ˆç¼ºçœå€¼ï¼‰ã€&lt;code&gt;STRICT_DNS&lt;/code&gt;ã€&lt;code&gt;LOGICAL_DNS&lt;/code&gt;ã€&lt;code&gt;EDS&lt;/code&gt;ã€&lt;code&gt;ORIGINAL_DST&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;hosts&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸ªåˆ—è¡¨ï¼Œé…ç½®è´Ÿè½½å‡è¡¡çš„ IP åœ°å€å’Œç«¯å£ï¼Œåªæœ‰ä½¿ç”¨äº†  &lt;code&gt;STATIC&lt;/code&gt;ã€&lt;code&gt;STRICT_DNS&lt;/code&gt;ã€&lt;code&gt;LOGICAL_DNS&lt;/code&gt; æœåŠ¡å‘ç°ç±»å‹æ—¶æ‰éœ€è¦é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;eds_cluster_config&lt;/strong&gt;ï¼šå¦‚æœä½¿ç”¨ &lt;code&gt;EDS&lt;/code&gt; åšæœåŠ¡å‘ç°ï¼Œåˆ™éœ€è¦é…ç½®è¯¥é¡¹ç›®ï¼Œå…¶ä¸­åŒ…æ‹¬çš„é…ç½®æœ‰ &lt;code&gt;service_name&lt;/code&gt; å’Œ &lt;code&gt;ads&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äº Cluster çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cds.proto#cluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy v2 API reference - cluster&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/overview/v2_overview.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy v2 API æ¦‚è§ˆ - servicemesher.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/listeners/lds.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç›‘å¬å™¨å‘ç°æœåŠ¡ï¼ˆLDSï¼‰- servicemesher.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/http_conn_man/rds.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯ç”±å‘ç°æœåŠ¡ï¼ˆRDSï¼‰- servicemesher.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/cluster_manager/cds.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›†ç¾¤å‘ç°æœåŠ¡ï¼ˆCDSï¼‰- servicemesher.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/istio-handbook/concepts/envoy-xds-protocol.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS åè®®è§£æ - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/163yun/p/8962278.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·±å…¥è§£è¯» Service Mesh èƒŒåçš„æŠ€æœ¯ç»†èŠ‚ - cnblogs.com&lt;/a&gt;&lt;a href=&#34;https://jimmysong.io/posts/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>ç†è§£ Istio Service Mesh ä¸­ Envoy Sidecar ä»£ç†çš„è·¯ç”±è½¬å‘</title>
      <link>https://cloudnative.to/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/</link>
      <pubDate>Thu, 27 Dec 2018 11:46:42 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä»¥ Istio å®˜æ–¹çš„ &lt;a href=&#34;https://preliminary.istio.io/zh/docs/examples/bookinfo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bookinfo ç¤ºä¾‹&lt;/a&gt;æ¥è®²è§£åœ¨è¿›å…¥ Pod çš„æµé‡è¢« iptables è½¬äº¤ç»™ Envoy sidecar åï¼ŒEnvoy æ˜¯å¦‚ä½•åšè·¯ç”±è½¬å‘çš„ï¼Œè¯¦è¿°äº† Inbound å’Œ Outbound å¤„ç†è¿‡ç¨‹ã€‚å…³äºæµé‡æ‹¦æˆªçš„è¯¦ç»†åˆ†æè¯·å‚è€ƒ&lt;a href=&#34;https://jimmysong.io/posts/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ Istio å®˜æ–¹æä¾›çš„ bookinfo çš„è¯·æ±‚æµç¨‹å›¾ï¼Œå‡è®¾ bookinfo åº”ç”¨çš„æ‰€æœ‰æœåŠ¡ä¸­æ²¡æœ‰é…ç½® DestinationRuleã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwgy1fvlwjd3302j31bo0ro0x5_hu57173d76017487a79ec682b19f7b2978_64139_050a8b349bc2758fd98469da3503f164.webp 400w,
               /blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwgy1fvlwjd3302j31bo0ro0x5_hu57173d76017487a79ec682b19f7b2978_64139_45ab12315416258c45941bfda783c0d7.webp 760w,
               /blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwgy1fvlwjd3302j31bo0ro0x5_hu57173d76017487a79ec682b19f7b2978_64139_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwgy1fvlwjd3302j31bo0ro0x5_hu57173d76017487a79ec682b19f7b2978_64139_050a8b349bc2758fd98469da3503f164.webp&#34;
               width=&#34;760&#34;
               height=&#34;441&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ Istio è‡ªèº«ç»„ä»¶ä¸ Bookinfo ç¤ºä¾‹çš„è¿æ¥å…³ç³»å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„ HTTP è¿æ¥éƒ½åœ¨ 9080 ç«¯å£ç›‘å¬ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwly1fyitp0jsghj31o70u0x6p_hu1f61d73f72201028761e59070a74695a_121039_bbb8c5d9d6b69a55e80cd55457ce8d06.webp 400w,
               /blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwly1fyitp0jsghj31o70u0x6p_hu1f61d73f72201028761e59070a74695a_121039_0853d80e17fa97902cc7bdb5a6aee9df.webp 760w,
               /blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwly1fyitp0jsghj31o70u0x6p_hu1f61d73f72201028761e59070a74695a_121039_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwly1fyitp0jsghj31o70u0x6p_hu1f61d73f72201028761e59070a74695a_121039_bbb8c5d9d6b69a55e80cd55457ce8d06.webp&#34;
               width=&#34;760&#34;
               height=&#34;378&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯ä»¥åœ¨ &lt;a href=&#34;https://drive.google.com/open?id=19ed3_tkjf6RgGboxllMdt_Ytd5_cocib&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Drive&lt;/a&gt; ä¸Šä¸‹è½½åŸå›¾ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-æ³¨å…¥åŠæµé‡åŠ«æŒæ­¥éª¤æ¦‚è¿°&#34;&gt;Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒæ­¥éª¤æ¦‚è¿°&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä» Sidecar æ³¨å…¥ã€Pod å¯åŠ¨åˆ° Sidecar proxy æ‹¦æˆªæµé‡åŠ Envoy å¤„ç†è·¯ç”±çš„æ­¥éª¤æ¦‚è§ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1.&lt;/strong&gt; Kubernetes é€šè¿‡ Admission Controller è‡ªåŠ¨æ³¨å…¥ï¼Œæˆ–è€…ç”¨æˆ·ä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt; å‘½ä»¤æ‰‹åŠ¨æ³¨å…¥ sidecar å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2.&lt;/strong&gt; åº”ç”¨ YAML é…ç½®éƒ¨ç½²åº”ç”¨ï¼Œæ­¤æ—¶ Kubernetes API server æ¥æ”¶åˆ°çš„æœåŠ¡åˆ›å»ºé…ç½®æ–‡ä»¶ä¸­å·²ç»åŒ…å«äº† Init å®¹å™¨åŠ sidecar proxyã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3.&lt;/strong&gt; åœ¨ sidecar proxy å®¹å™¨å’Œåº”ç”¨å®¹å™¨å¯åŠ¨ä¹‹å‰ï¼Œé¦–å…ˆè¿è¡Œ Init å®¹å™¨ï¼ŒInit å®¹å™¨ç”¨äºè®¾ç½® iptablesï¼ˆIstio ä¸­é»˜è®¤çš„æµé‡æ‹¦æˆªæ–¹å¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ BPFã€IPVS ç­‰æ–¹å¼ï¼‰å°†è¿›å…¥ pod çš„æµé‡åŠ«æŒåˆ° Envoy sidecar proxyã€‚æ‰€æœ‰ TCP æµé‡ï¼ˆEnvoy ç›®å‰åªæ”¯æŒ TCP æµé‡ï¼‰å°†è¢« sidecar åŠ«æŒï¼Œå…¶ä»–åè®®çš„æµé‡å°†æŒ‰åŸæ¥çš„ç›®çš„åœ°è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4.&lt;/strong&gt; å¯åŠ¨ Pod ä¸­çš„ Envoy sidecar proxy å’Œåº”ç”¨ç¨‹åºå®¹å™¨ã€‚è¿™ä¸€æ­¥çš„è¿‡ç¨‹è¯·å‚è€ƒ&lt;a href=&#34;https://zhaohuabing.com/post/2018-09-25-istio-traffic-management-impl-intro/#%E9%80%9A%E8%BF%87%E7%AE%A1%E7%90%86%E6%8E%A5%E5%8F%A3%E8%8E%B7%E5%8F%96%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€šè¿‡ç®¡ç†æ¥å£è·å–å®Œæ•´é…ç½®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Sidecar proxy ä¸åº”ç”¨å®¹å™¨çš„å¯åŠ¨é¡ºåºé—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯åŠ¨ sidecar proxy å’Œåº”ç”¨å®¹å™¨ï¼Œç©¶ç«Ÿå“ªä¸ªå®¹å™¨å…ˆå¯åŠ¨å‘¢ï¼Ÿæ­£å¸¸æƒ…å†µæ˜¯ Envoy Sidecar å’Œåº”ç”¨ç¨‹åºå®¹å™¨å…¨éƒ¨å¯åŠ¨å®Œæˆåå†å¼€å§‹æ¥æ”¶æµé‡è¯·æ±‚ã€‚ä½†æ˜¯æˆ‘ä»¬æ— æ³•é¢„æ–™å“ªä¸ªå®¹å™¨ä¼šå…ˆå¯åŠ¨ï¼Œé‚£ä¹ˆå®¹å™¨å¯åŠ¨é¡ºåºæ˜¯å¦ä¼šå¯¹ Envoy åŠ«æŒæµé‡æœ‰å½±å“å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œä¸è¿‡åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æƒ…å†µ 1ï¼šåº”ç”¨å®¹å™¨å…ˆå¯åŠ¨ï¼Œè€Œ sidecar proxy ä»æœªå°±ç»ª&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒ…å†µä¸‹ï¼Œæµé‡è¢« iptables è½¬ç§»åˆ° 15001 ç«¯å£ï¼Œè€Œ Pod ä¸­æ²¡æœ‰ç›‘å¬è¯¥ç«¯å£ï¼ŒTCP é“¾æ¥å°±æ— æ³•å»ºç«‹ï¼Œè¯·æ±‚å¤±è´¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æƒ…å†µ 2ï¼šSidecar å…ˆå¯åŠ¨ï¼Œè¯·æ±‚åˆ°è¾¾è€Œåº”ç”¨ç¨‹åºä»æœªå°±ç»ª&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒ…å†µä¸‹è¯·æ±‚ä¹Ÿè‚¯å®šä¼šå¤±è´¥ï¼Œè‡³äºæ˜¯åœ¨å“ªä¸€æ­¥å¼€å§‹å¤±è´¥çš„ï¼Œç•™ç»™è¯»è€…æ¥æ€è€ƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼šå¦‚æœä¸º sidecar proxy å’Œåº”ç”¨ç¨‹åºå®¹å™¨æ·»åŠ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/guide/configure-liveness-readiness-probes.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å°±ç»ªå’Œå­˜æ´»æ¢é’ˆ&lt;/a&gt;æ˜¯å¦å¯ä»¥è§£å†³è¯¥é—®é¢˜å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;5.&lt;/strong&gt; ä¸è®ºæ˜¯è¿›å…¥è¿˜æ˜¯ä» Pod å‘å‡ºçš„ TCP è¯·æ±‚éƒ½ä¼šè¢« iptables åŠ«æŒï¼Œinbound æµé‡è¢«åŠ«æŒåç» Inbound Handler å¤„ç†åè½¬äº¤ç»™åº”ç”¨ç¨‹åºå®¹å™¨å¤„ç†ï¼Œoutbound æµé‡è¢« iptables åŠ«æŒåè½¬äº¤ç»™ Outbound Handler å¤„ç†ï¼Œå¹¶ç¡®å®šè½¬å‘çš„ upstream å’Œ Endpointã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;6.&lt;/strong&gt; Sidecar proxy è¯·æ±‚ Pilot ä½¿ç”¨ xDS åè®®åŒæ­¥ Envoy é…ç½®ï¼Œå…¶ä¸­åŒ…æ‹¬ LDSã€EDSã€CDS ç­‰ï¼Œä¸è¿‡ä¸ºäº†ä¿è¯æ›´æ–°çš„é¡ºåºï¼ŒEnvoy ä¼šç›´æ¥ä½¿ç”¨ ADS å‘ Pilot è¯·æ±‚é…ç½®æ›´æ–°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-å¦‚ä½•å¤„ç†è·¯ç”±è½¬å‘&#34;&gt;Envoy å¦‚ä½•å¤„ç†è·¯ç”±è½¬å‘&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºçš„æ˜¯ &lt;code&gt;productpage&lt;/code&gt; æœåŠ¡è¯·æ±‚è®¿é—® &lt;code&gt;http://reviews.default.svc.cluster.local:9080/&lt;/code&gt;ï¼Œå½“æµé‡è¿›å…¥ &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡å†…éƒ¨æ—¶ï¼Œ&lt;code&gt;reviews&lt;/code&gt; æœåŠ¡å†…éƒ¨çš„ Envoy Sidecar æ˜¯å¦‚ä½•åšæµé‡æ‹¦æˆªå’Œè·¯ç”±è½¬å‘çš„ã€‚å¯ä»¥åœ¨ &lt;a href=&#34;https://drive.google.com/file/d/1n-h235tm8DnL_RqxTTA95rgGtrLkBsyr/view?usp=sharing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Drive&lt;/a&gt; ä¸Šä¸‹è½½åŸå›¾ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwly1fyl39icd27j31c70u04gc_hue5bc29eff9a39a621e6d1fa82c03c0b3_167835_be4254ba37e6557ad84cfa1bb790b674.webp 400w,
               /blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwly1fyl39icd27j31c70u04gc_hue5bc29eff9a39a621e6d1fa82c03c0b3_167835_a6d1d6c7804ffcaa8a97443d7e7c8bcd.webp 760w,
               /blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwly1fyl39icd27j31c70u04gc_hue5bc29eff9a39a621e6d1fa82c03c0b3_167835_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-sidecar-routing-of-istio-service-mesh-deep-dive/006tNbRwly1fyl39icd27j31c70u04gc_hue5bc29eff9a39a621e6d1fa82c03c0b3_167835_be4254ba37e6557ad84cfa1bb790b674.webp&#34;
               width=&#34;760&#34;
               height=&#34;473&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ­¥å¼€å§‹æ—¶ï¼Œ&lt;code&gt;productpage&lt;/code&gt; Pod ä¸­çš„ Envoy sidecar å·²ç»é€šè¿‡ EDS é€‰æ‹©å‡ºäº†è¦è¯·æ±‚çš„ &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡çš„ä¸€ä¸ª Podï¼ŒçŸ¥æ™“äº†å…¶ IP åœ°å€ï¼Œå‘é€ TCP è¿æ¥è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;Istio å®˜ç½‘ä¸­çš„ &lt;a href=&#34;https://preliminary.istio.io/zh/help/ops/traffic-management/proxy-cmd/#envoy-%E9%85%8D%E7%BD%AE%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy é…ç½®æ·±åº¦è§£æ&lt;/a&gt;ä¸­æ˜¯ä»¥å‘èµ· HTTP è¯·æ±‚çš„ä¸€æ–¹æ¥è¯¦è¿° Envoy åšæµé‡è½¬å‘çš„è¿‡ç¨‹ï¼Œè€Œæœ¬æ–‡ä¸­è€ƒè™‘çš„æ˜¯æ¥å— downstream çš„æµé‡çš„ä¸€æ–¹ï¼Œå®ƒæ—¢è¦æ¥æ”¶ downstream å‘æ¥çš„è¯·æ±‚ï¼Œè‡ªå·±è¿˜éœ€è¦è¯·æ±‚å…¶ä»–æœåŠ¡ï¼Œä¾‹å¦‚ &lt;code&gt;reviews&lt;/code&gt; æœåŠ¡ä¸­çš„ Pod è¿˜éœ€è¦è¯·æ±‚ &lt;code&gt;ratings&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;reviews&lt;/code&gt; æœåŠ¡æœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä¸‰ä¸ªç‰ˆæœ¬ä¸­çš„ sidecar å·¥ä½œæ­¥éª¤ç±»ä¼¼ï¼Œä¸‹æ–‡åªä»¥ &lt;code&gt;reviews-v1-cb8655c75-b97zc&lt;/code&gt; è¿™ä¸€ä¸ª Pod ä¸­çš„ Sidecar æµé‡è½¬å‘æ­¥éª¤æ¥è¯´æ˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç†è§£-inbound-handler&#34;&gt;ç†è§£ Inbound Handler&lt;/h2&gt;
&lt;p&gt;Inbound handler çš„ä½œç”¨æ˜¯å°† iptables æ‹¦æˆªåˆ°çš„ downstream çš„æµé‡è½¬äº¤ç»™ localhostï¼Œä¸ Pod å†…çš„åº”ç”¨ç¨‹åºå®¹å™¨å»ºç«‹è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ä¸‹ &lt;code&gt;reviews-v1-cb8655c75-b97zc&lt;/code&gt; pod ä¸­çš„ Listenerã€‚&lt;/p&gt;
&lt;p&gt;è¿è¡Œ &lt;code&gt;istioctl pc listener reviews-v1-cb8655c75-b97zc&lt;/code&gt; æŸ¥çœ‹è¯¥ Pod ä¸­çš„å…·æœ‰å“ªäº› Listenerã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;ADDRESS            PORT      TYPE &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;172.33.3.3         9080      HTTP &amp;lt;--- æ¥æ”¶æ‰€æœ‰ Inbound HTTP æµé‡ï¼Œè¯¥åœ°å€å³ä¸ºå½“å‰ Pod çš„ IP åœ°å€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.0.1         443       TCP  &amp;lt;--+&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.4.253       80        TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.4.253       8080      TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.109.182     443       TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.22.50       15011     TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.22.50       853       TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.79.114      443       TCP     | &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.143.179     15011     TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.0.2         53        TCP     | æ¥æ”¶ä¸ 0.0.0.0_15001 ç›‘å¬å™¨é…å¯¹çš„ Outbound é HTTP æµé‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.22.50       443       TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.16.64       42422     TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.127.202     16686     TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.22.50       31400     TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.22.50       8060      TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.169.13      14267     TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.169.13      14268     TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.32.134      8443      TCP     |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;10.254.118.196     443       TCP  &amp;lt;--+&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            15004     HTTP &amp;lt;--+&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            8080      HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            15010     HTTP    | &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            8088      HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            15031     HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            9090      HTTP    | &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            9411      HTTP    | æ¥æ”¶ä¸ 0.0.0.0_15001 é…å¯¹çš„ Outbound HTTP æµé‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            80        HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            15030     HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            9080      HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            9093      HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            3000      HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            8060      HTTP    |&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            9091      HTTP &amp;lt;--+    &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;0.0.0.0            15001     TCP  &amp;lt;--- æ¥æ”¶æ‰€æœ‰ç» iptables æ‹¦æˆªçš„ Inbound å’Œ Outbound æµé‡å¹¶è½¬äº¤ç»™è™šæ‹Ÿç›‘å¬å™¨å¤„ç†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“æ¥è‡ª &lt;code&gt;productpage&lt;/code&gt; çš„æµé‡æŠµè¾¾ &lt;code&gt;reviews&lt;/code&gt; Pod çš„æ—¶å€™å·²ç»ï¼Œdownstream å¿…é¡»æ˜ç¡®çŸ¥é“ Pod çš„ IP åœ°å€ä¸º &lt;code&gt;172.33.3.3&lt;/code&gt; æ‰€ä»¥æ‰ä¼šè®¿é—®è¯¥ Podï¼Œæ‰€ä»¥è¯¥è¯·æ±‚æ˜¯ &lt;code&gt;172.33.3.3:9080&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;virtual&lt;/code&gt; Listener&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä»è¯¥ Pod çš„ Listener åˆ—è¡¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ0.0.0.0:15001/TCP çš„ Listenerï¼ˆå…¶å®é™…åå­—æ˜¯ &lt;code&gt;virtual&lt;/code&gt;ï¼‰ç›‘å¬æ‰€æœ‰çš„ Inbound æµé‡ï¼Œä¸‹é¢æ˜¯è¯¥ Listener çš„è¯¦ç»†é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;virtual&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15001&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;filterChains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.tcp_proxy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;BlackHoleCluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;stat_prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;BlackHoleCluster&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;useOriginalDst&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;UseOriginalDst&lt;/strong&gt;ï¼šä»é…ç½®ä¸­å¯ä»¥çœ‹å‡º &lt;code&gt;useOriginalDst&lt;/code&gt; é…ç½®æŒ‡å®šä¸º &lt;code&gt;true&lt;/code&gt;ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç¼ºçœä¸º falseï¼Œä½¿ç”¨ iptables é‡å®šå‘è¿æ¥æ—¶ï¼Œproxy æ¥æ”¶çš„ç«¯å£å¯èƒ½ä¸&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/listener_filters/original_dst_filter.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸå§‹ç›®çš„åœ°å€&lt;/a&gt;çš„ç«¯å£ä¸ä¸€æ ·ï¼Œå¦‚æ­¤å¤„ proxy æ¥æ”¶çš„ç«¯å£ä¸º 15001ï¼Œè€ŒåŸå§‹ç›®çš„åœ°ç«¯å£ä¸º 9080ã€‚å½“æ­¤æ ‡å¿—è®¾ç½®ä¸º true æ—¶ï¼ŒListener å°†è¿æ¥é‡å®šå‘åˆ°ä¸åŸå§‹ç›®çš„åœ°å€å…³è”çš„ Listenerï¼Œæ­¤å¤„ä¸º &lt;code&gt;172.33.3.3:9080&lt;/code&gt;ã€‚å¦‚æœæ²¡æœ‰ä¸åŸå§‹ç›®çš„åœ°å€å…³è”çš„ Listenerï¼Œåˆ™è¿æ¥ç”±æ¥æ”¶å®ƒçš„ Listener å¤„ç†ï¼Œå³è¯¥ &lt;code&gt;virtual&lt;/code&gt; Listenerï¼Œç»è¿‡ &lt;code&gt;envoy.tcp_proxy&lt;/code&gt; è¿‡æ»¤å™¨å¤„ç†è½¬å‘ç»™ &lt;code&gt;BlackHoleCluster&lt;/code&gt;ï¼Œè¿™ä¸ª Cluster çš„ä½œç”¨æ­£å¦‚å®ƒçš„åå­—ï¼Œå½“ Envoy æ‰¾ä¸åˆ°åŒ¹é…çš„è™šæ‹Ÿç›‘å¬å™¨æ—¶ï¼Œå°±ä¼šå°†è¯·æ±‚å‘é€ç»™å®ƒï¼Œå¹¶è¿”å› 404ã€‚è¿™ä¸ªå°†äºä¸‹æ–‡æåˆ°çš„ Listener ä¸­è®¾ç½® &lt;code&gt;bindToPort&lt;/code&gt; ç›¸å‘¼åº”ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šè¯¥å‚æ•°å°†è¢«åºŸå¼ƒï¼Œè¯·ä½¿ç”¨&lt;a href=&#34;http://www.servicemesher.com/envoy/configuration/listener_filters/original_dst_filter.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸå§‹ç›®çš„åœ°å€&lt;/a&gt;çš„ Listener filter æ›¿ä»£ã€‚è¯¥å‚æ•°çš„ä¸»è¦ç”¨é€”æ˜¯ï¼šEnvoy é€šè¿‡ç›‘å¬ 15001 ç«¯å£å°† iptables æ‹¦æˆªçš„æµé‡ç»ç”±å…¶ä»– Listener å¤„ç†è€Œä¸æ˜¯ç›´æ¥è½¬å‘å‡ºå»ï¼Œè¯¦æƒ…è§ &lt;a href=&#34;https://zhaohuabing.com/post/2018-09-25-istio-traffic-management-impl-intro/#virtual-listener&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Virtual Listener&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Listener 172.33.3.3_9080&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šæ–‡è¯´åˆ°è¿›å…¥ Inbound handler çš„æµé‡è¢« &lt;code&gt;virtual&lt;/code&gt; Listener è½¬ç§»åˆ° &lt;code&gt;172.33.3.3_9080&lt;/code&gt; Listenerï¼Œæˆ‘ä»¬åœ¨æŸ¥çœ‹ä¸‹è¯¥ Listener é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;è¿è¡Œ &lt;code&gt;istioctl pc listener reviews-v1-cb8655c75-b97zc --address 172.33.3.3 --port 9080 -o json&lt;/code&gt; æŸ¥çœ‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.33.3.3_9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.33.3.3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;filterChains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;filterChainMatch&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;transportProtocol&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;raw_buffer&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;route_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;validate_clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;virtual_hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|http|9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                            &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_grpc_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;use_remote_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;deprecatedV1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;bindToPort&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;filterChainMatch&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;transportProtocol&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;tls&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;tlsContext&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;bindToPort&lt;/strong&gt;ï¼šæ³¨æ„å…¶ä¸­æœ‰ä¸€ä¸ª &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.6.0/api-v1/listeners/listeners&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;bindToPort&lt;/code&gt;&lt;/a&gt; çš„é…ç½®ï¼Œå…¶å€¼ä¸º &lt;code&gt;false&lt;/code&gt;ï¼Œè¯¥é…ç½®çš„ç¼ºçœå€¼ä¸º &lt;code&gt;true&lt;/code&gt;ï¼Œè¡¨ç¤ºå°† Listener ç»‘å®šåˆ°ç«¯å£ä¸Šï¼Œæ­¤å¤„è®¾ç½®ä¸º &lt;code&gt;false&lt;/code&gt; åˆ™è¯¥ Listener åªèƒ½å¤„ç†å…¶ä»– Listener è½¬ç§»è¿‡æ¥çš„æµé‡ï¼Œå³ä¸Šæ–‡æ‰€è¯´çš„ &lt;code&gt;virtual&lt;/code&gt; Listenerï¼Œæˆ‘ä»¬çœ‹å…¶ä¸­çš„ filterChains.filters ä¸­çš„ &lt;code&gt;envoy.http_connection_manager&lt;/code&gt; é…ç½®éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;route_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;validate_clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;virtual_hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|http|9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                            &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_grpc_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                &lt;span class=&#34;nt&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥é…ç½®è¡¨ç¤ºæµé‡å°†è½¬äº¤ç»™ Cluster &lt;code&gt;inbound|9080||reviews.default.svc.cluster.local&lt;/code&gt; å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cluster &lt;code&gt;inbound|9080||reviews.default.svc.cluster.local&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿è¡Œ &lt;code&gt;istioctl pc cluster reviews-v1-cb8655c75-b97zc --fqdn reviews.default.svc.cluster.local --direction inbound -o json&lt;/code&gt; æŸ¥çœ‹è¯¥ Cluster çš„é…ç½®å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;connectTimeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;1.000s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;circuitBreakers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;thresholds&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°è¯¥ Cluster çš„ Endpoint ç›´æ¥å¯¹åº”çš„å°±æ˜¯ localhostï¼Œå†ç»è¿‡ iptables è½¬å‘æµé‡å°±è¢«åº”ç”¨ç¨‹åºå®¹å™¨æ¶ˆè´¹äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç†è§£-outbound-handler&#34;&gt;ç†è§£ Outbound Handler&lt;/h2&gt;
&lt;p&gt;å› ä¸º &lt;code&gt;reviews&lt;/code&gt; ä¼šå‘ &lt;code&gt;ratings&lt;/code&gt; æœåŠ¡å‘é€ HTTP è¯·æ±‚ï¼Œè¯·æ±‚çš„åœ°å€æ˜¯ï¼š&lt;code&gt;http://ratings.default.svc.cluster.local:9080/&lt;/code&gt;ï¼ŒOutbound handler çš„ä½œç”¨æ˜¯å°† iptables æ‹¦æˆªåˆ°çš„æœ¬åœ°åº”ç”¨ç¨‹åºå‘å‡ºçš„æµé‡ï¼Œç»ç”± Envoy åˆ¤æ–­å¦‚ä½•è·¯ç”±åˆ° upstreamã€‚&lt;/p&gt;
&lt;p&gt;åº”ç”¨ç¨‹åºå®¹å™¨å‘å‡ºçš„è¯·æ±‚ä¸º Outbound æµé‡ï¼Œè¢« iptables åŠ«æŒåè½¬ç§»ç»™ Envoy  Outbound handler å¤„ç†ï¼Œç„¶åç»è¿‡ &lt;code&gt;virtual&lt;/code&gt; Listenerã€&lt;code&gt;0.0.0.0_9080&lt;/code&gt; Listenerï¼Œç„¶åé€šè¿‡ Route 9080 æ‰¾åˆ° upstream çš„ clusterï¼Œè¿›è€Œé€šè¿‡ EDS æ‰¾åˆ° Endpoint æ‰§è¡Œè·¯ç”±åŠ¨ä½œã€‚è¿™ä¸€éƒ¨åˆ†å¯ä»¥å‚è€ƒ Istio å®˜ç½‘ä¸­çš„ &lt;a href=&#34;https://preliminary.istio.io/zh/help/ops/traffic-management/proxy-cmd/#envoy-%E9%85%8D%E7%BD%AE%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy æ·±åº¦é…ç½®è§£æ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Route 9080&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;reviews&lt;/code&gt; ä¼šè¯·æ±‚ &lt;code&gt;ratings&lt;/code&gt; æœåŠ¡ï¼Œè¿è¡Œ &lt;code&gt;istioctl proxy-config routes reviews-v1-cb8655c75-b97zc --name 9080 -o json&lt;/code&gt; æŸ¥çœ‹ route é…ç½®ï¼Œå› ä¸º Envoy ä¼šæ ¹æ® HTTP header ä¸­çš„ domains æ¥åŒ¹é… VirtualHostï¼Œæ‰€ä»¥ä¸‹é¢åªåˆ—ä¸¾äº† &lt;code&gt;ratings.default.svc.cluster.local:9080&lt;/code&gt; è¿™ä¸€ä¸ª VirtualHostã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.254.234.130&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.254.234.130:9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080||ratings.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;maxGrpcTimeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;decorator&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;operation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster.local:9080/*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;perFilterConfig&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»è¯¥ Virtual Host é…ç½®ä¸­å¯ä»¥çœ‹åˆ°å°†æµé‡è·¯ç”±åˆ° Cluster &lt;code&gt;outbound|9080||ratings.default.svc.cluster.local&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Endpoint &lt;code&gt;outbound|9080||ratings.default.svc.cluster.local&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Istio 1.1 ä»¥å‰ç‰ˆæœ¬ä¸æ”¯æŒä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt; å‘½ä»¤ç›´æ¥æŸ¥è¯¢ Cluster çš„ Endpointï¼Œå¯ä»¥ä½¿ç”¨æŸ¥è¯¢ Pilot çš„ debug ç«¯ç‚¹çš„æ–¹å¼æŠ˜ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; reviews-v1-cb8655c75-b97zc -c istio-proxy curl http://istio-pilot.istio-system.svc.cluster.local:9093/debug/edsz &amp;gt; endpoints.json
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;endpoints.json&lt;/code&gt; æ–‡ä»¶ä¸­åŒ…å«äº†æ‰€æœ‰ Cluster çš„ Endpoint ä¿¡æ¯ï¼Œæˆ‘ä»¬åªé€‰å–å…¶ä¸­çš„ &lt;code&gt;outbound|9080||ratings.default.svc.cluster.local&lt;/code&gt; Cluster çš„ç»“æœå¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;clusterName&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080||ratings.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;locality&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;lbEndpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.33.100.2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;filterMetadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;istio&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nt&#34;&gt;&amp;#34;uid&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;kubernetes://ratings-v1-8558d4458d-ns6lk.default&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Endpoint å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªï¼ŒEnvoy å°†æ ¹æ®ä¸€å®šè§„åˆ™é€‰æ‹©é€‚å½“çš„ Endpoint æ¥è·¯ç”±ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šIstio 1.1 å°†æ”¯æŒ &lt;code&gt;istioctl pc endpoint&lt;/code&gt; å‘½ä»¤æ¥æŸ¥è¯¢ Endpointã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://preliminary.istio.io/zh/help/ops/traffic-management/proxy-cmd/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è°ƒè¯• Envoy å’Œ Pilot - istio.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/posts/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhaohuabing.com/post/2018-09-25-istio-traffic-management-impl-intro/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æµé‡ç®¡ç†å®ç°æœºåˆ¶æ·±åº¦è§£æ - zhaohuabing.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Istio ä¸­çš„æœåŠ¡å’Œæµé‡çš„æŠ½è±¡æ¨¡å‹</title>
      <link>https://cloudnative.to/blog/istio-service-and-traffic-model/</link>
      <pubDate>Tue, 18 Dec 2018 19:49:56 +0800</pubDate>
      <guid>https://cloudnative.to/blog/istio-service-and-traffic-model/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä»‹ç»äº† Istio å’Œ Kubernetes ä¸­çš„ä¸€äº›æœåŠ¡å’Œæµé‡çš„æŠ½è±¡æ¨¡å‹ã€‚è™½ç„¶ Istio ä¸€å¼€å§‹ç¡®å®šçš„æŠ½è±¡æ¨¡å‹ä¸å¯¹æ¥çš„åº•å±‚å¹³å°æ— å…³ï¼Œä½†ç›®å‰æ¥çœ‹åŸºæœ¬ç»‘å®š Kubernetesï¼Œæœ¬æ–‡ä»…ä»¥ Kubernetes è¯´æ˜ã€‚å¦å¤–åœ¨ &lt;a href=&#34;http://www.servicemesher.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ServiceMesher ç¤¾åŒº&lt;/a&gt;ä¸­æœ€è¿‘æœ‰å¾ˆå¤šå…³äº Istioã€Envoyã€Kubernetes ä¹‹ä¸­çš„æœåŠ¡æ¨¡å‹å…³ç³»çš„è®¨è®ºï¼Œæœ¬æ–‡ä½œä¸ºä¸€ä¸ªå¼€ç¯‡è¯´æ˜ï¼ŒKubernetes å’Œ Istio ä¹‹é—´æœ‰å“ªäº›å…±æœ‰çš„æœåŠ¡æ¨¡å‹ï¼ŒIstio åœ¨ Kubernetes çš„æœåŠ¡æ¨¡å‹ä¹‹ä¸Šåˆå¢åŠ äº†ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;p&gt;**æœåŠ¡å…·æœ‰å¤šä¸ªç‰ˆæœ¬ã€‚**åœ¨ CI/CD è¿‡ç¨‹ä¸­ï¼ŒåŒä¸€ä¸ªæœåŠ¡å¯èƒ½åŒæ—¶éƒ¨ç½²åœ¨å¤šä¸ªç¯å¢ƒä¸­ï¼Œå¦‚å¼€å‘ã€ç”Ÿäº§å’Œæµ‹è¯•ç¯å¢ƒç­‰ï¼Œè¿™äº›æœåŠ¡ç‰ˆæœ¬ä¸ä¸€å®šå…·æœ‰ä¸åŒçš„ APIï¼Œå¯èƒ½åªæ˜¯ä¸€äº›å°çš„æ›´æ”¹å¯¼è‡´çš„è¿­ä»£ç‰ˆæœ¬ã€‚åœ¨ A/B æµ‹è¯•å’Œç°åº¦å‘å¸ƒä¸­ç»å¸¸é‡åˆ°è¿™ç§æƒ…å†µã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-ä¸-istio-ä¸­å…±æœ‰çš„æ¨¡å‹&#34;&gt;Kubernetes ä¸ Istio ä¸­å…±æœ‰çš„æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;å› ä¸º Istio åŸºæœ¬å°±æ˜¯ç»‘å®šåœ¨ Kubernetes ä¸Šï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„ Kubernetes åŠ Istio ä¸­å…±æœ‰çš„æœåŠ¡æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-service-and-traffic-model/006tNbRwly1fya24ci2x8j30go0b4ta3_huc0b89fda09d2a4e33bcad81468337791_39999_9daca97a24611a408408264d462ca9aa.webp 400w,
               /blog/istio-service-and-traffic-model/006tNbRwly1fya24ci2x8j30go0b4ta3_huc0b89fda09d2a4e33bcad81468337791_39999_e6d4f86444cc3a834f3ee1250d5ea9cb.webp 760w,
               /blog/istio-service-and-traffic-model/006tNbRwly1fya24ci2x8j30go0b4ta3_huc0b89fda09d2a4e33bcad81468337791_39999_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istio-service-and-traffic-model/006tNbRwly1fya24ci2x8j30go0b4ta3_huc0b89fda09d2a4e33bcad81468337791_39999_9daca97a24611a408408264d462ca9aa.webp&#34;
               width=&#34;600&#34;
               height=&#34;400&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ˜¯ Kubernetes ä¸­ iptables ä»£ç†æ¨¡å¼ï¼ˆå¦å¤–è¿˜æœ‰ IPVS æ¨¡å¼ï¼‰ä¸‹çš„ service æ¦‚å¿µå›¾ï¼Œç®¡ç†å‘˜å¯ä»¥åœ¨ kube-proxy ä¸­é…ç½®ç®€å•çš„è´Ÿè½½å‡è¡¡ï¼Œå¯¹æ•´ä¸ª node ç”Ÿæ•ˆï¼Œæ— æ³•é…ç½®åˆ°å•ä¸ªæœåŠ¡çš„è´Ÿè½½å‡è¡¡å’Œå…¶ä»–å¾®æœåŠ¡çš„é«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚ç†”æ–­ã€é™æµã€è¿½è¸ªç­‰ï¼Œè¿™äº›åŠŸèƒ½åªèƒ½åœ¨åº”ç”¨ä¸­å®ç°äº†ï¼Œè€Œåœ¨ Istio çš„æ¦‚å¿µæ¨¡å‹ä¸­å®Œå…¨å»æ‰äº† &lt;code&gt;kube-proxy&lt;/code&gt;  è¿™ä¸ªç»„ä»¶ï¼Œå°†å…¶åˆ†æ•£åˆ°æ¯ä¸ªåº”ç”¨ Pod ä¸­åŒæ—¶éƒ¨ç½²çš„ Envoy ä¸­å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢åˆ—ä¸¾çš„æ˜¯ Kubernetes å’Œ Istio ä¸­å…±æœ‰çš„æ¨¡å‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;service&#34;&gt;Service&lt;/h3&gt;
&lt;p&gt;è¿™å®é™…ä¸Šè·Ÿ Kubernetes ä¸­çš„ service æ¦‚å¿µæ˜¯ä¸€è‡´çš„ï¼Œè¯·å‚è€ƒ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/service.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes ä¸­çš„ service&lt;/a&gt;ã€‚Istio æ¨å‡ºäº†æ¯” service æ›´å¤æ‚çš„æ¨¡å‹ &lt;code&gt;VirtualService&lt;/code&gt;ï¼Œè¿™ä¸å•çº¯æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡å®šä¹‰äº†ï¼Œè€Œæ˜¯åœ¨æœåŠ¡ä¹‹ä¸Šå®šä¹‰äº†è·¯ç”±è§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªå®Œå…¨é™å®šçš„åŸŸåï¼ˆFQDNï¼‰ï¼Œç›‘å¬ä¸€ä¸ªæˆ–å¤šä¸ªç«¯å£ã€‚æœåŠ¡è¿˜å¯ä»¥æœ‰ä¸å…¶ç›¸å…³è”çš„å•ä¸ªè´Ÿè½½å‡è¡¡å™¨æˆ–è™šæ‹Ÿ IP åœ°å€ã€‚é’ˆå¯¹ FQDN çš„ DNS æŸ¥è¯¢å°†è§£æä¸ºè¯¥è´Ÿè½½å‡è¡¡å™¨æˆ–è€…è™šæ‹Ÿ IP çš„åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ Kubernetes ä¸­ä¸€ä¸ªæœåŠ¡ä¸º &lt;code&gt;foo.default.svc.cluster.local hostname&lt;/code&gt;ï¼Œè™šæ‹Ÿ IP /ClusterIP æ˜¯ 10.0.1.1ï¼Œç›‘å¬çš„ç«¯å£æ˜¯ 80 å’Œ 8080ã€‚&lt;/p&gt;
&lt;h3 id=&#34;endpoint&#34;&gt;Endpoint&lt;/h3&gt;
&lt;p&gt;è¿™é‡ŒæŒ‡çš„æ˜¯ Kubernetes ä¸­çš„ endpointï¼Œä¸€ä¸ª endpoint æ˜¯å®ç°äº†æŸæœåŠ¡çš„å…·ä½“å®ä¾‹ï¼Œä¸€ä¸ªæœåŠ¡å¯èƒ½æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª Endpointï¼Œè¡¨ç¤ºä¸º IP åœ°å€åŠ ç«¯å£ï¼Œä¹Ÿå¯ä»¥ä¸º DNS åç§°åŠ ç«¯å£ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®åˆ°åº•å“ªäº›å®ä¾‹å±äºåŒä¸€ä¸ª serviceï¼Œè¿˜æ˜¯éœ€è¦ é€šè¿‡ label åŒ¹é…æ¥é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h3 id=&#34;label&#34;&gt;Label&lt;/h3&gt;
&lt;p&gt;æœåŠ¡çš„ç‰ˆæœ¬ã€å¯¹åº”çš„å¼•ç”¨åç§°ç­‰æ˜¯é€šè¿‡ label æ¥æ ‡è®°çš„ï¼Œä¾‹å¦‚ä¸‹é¢ Kubernetes ä¸­ä¸€ä¸ªåº”ç”¨çš„ YAML é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ratings-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ratings&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ratings&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio/examples-bookinfo-ratings-v1:1.8.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;version: v1&lt;/code&gt; æ ‡è®°è¯¥æœåŠ¡æ˜¯ v1 ç‰ˆæœ¬ï¼Œ&lt;code&gt;version&lt;/code&gt; æ˜¯ä¸€ä¸ªçº¦å®šä¿—ç§°çš„æ ‡ç­¾ï¼Œå»ºè®®å¤§å®¶çš„æœåŠ¡ä¸Šéƒ½å¸¦ä¸Šè¯¥æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶æœåŠ¡çš„ label å¯ä»¥è®¾ç½®ä»»æ„å¤šä¸ªï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯åœ¨åšè·¯ç”±çš„æ—¶å€™å¯ä»¥æ ¹æ®æ ‡ç­¾åŒ¹é…æ¥åšç»†ç²’åº¦çš„æµé‡åˆ’åˆ†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ§åˆ¶é¢æ¿-envoy&#34;&gt;æ§åˆ¶é¢æ¿ Envoy&lt;/h2&gt;
&lt;p&gt;Envoy æ˜¯ Istio ä¸­é»˜è®¤çš„ proxy sidecarï¼Œè´Ÿè´£æœåŠ¡é—´çš„æµé‡ç®¡æ§ã€è®¤è¯ä¸å®‰å…¨åŠ å¯†ã€å¯è§‚å¯Ÿæ€§ç­‰ã€‚Envoy ä¸­æœ‰å¦‚ä¸‹å‡ ä¸ªé‡è¦æ¦‚å¿µã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy-proxy-æ¶æ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy proxy æ¶æ„å›¾&#34; srcset=&#34;
               /blog/istio-service-and-traffic-model/006tNbRwly1fy9qkff5nij314k0ts43z_hu3389d28631a70c0b3d55cd6a303e2cf6_154159_85713d3138a611650a7272921448334e.webp 400w,
               /blog/istio-service-and-traffic-model/006tNbRwly1fy9qkff5nij314k0ts43z_hu3389d28631a70c0b3d55cd6a303e2cf6_154159_9cab5af5de315ac9534368e0831ea239.webp 760w,
               /blog/istio-service-and-traffic-model/006tNbRwly1fy9qkff5nij314k0ts43z_hu3389d28631a70c0b3d55cd6a303e2cf6_154159_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istio-service-and-traffic-model/006tNbRwly1fy9qkff5nij314k0ts43z_hu3389d28631a70c0b3d55cd6a303e2cf6_154159_85713d3138a611650a7272921448334e.webp&#34;
               width=&#34;760&#34;
               height=&#34;558&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy proxy æ¶æ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ˜¯ Envoy çš„æ¶æ„å›¾ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cluster&#34;&gt;Cluster&lt;/h3&gt;
&lt;p&gt;é›†ç¾¤ï¼ˆclusterï¼‰æ˜¯ Envoy è¿æ¥åˆ°çš„ä¸€ç»„é€»è¾‘ä¸Šç›¸ä¼¼çš„ä¸Šæ¸¸ä¸»æœºã€‚Envoy é€šè¿‡&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/service_discovery#arch-overview-service-discovery&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡å‘ç°&lt;/a&gt;å‘ç°é›†ç¾¤ä¸­çš„æˆå‘˜ã€‚Envoy å¯ä»¥é€šè¿‡&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/health_checking#arch-overview-health-checking&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸»åŠ¨è¿è¡ŒçŠ¶å†µæ£€æŸ¥&lt;/a&gt;æ¥ç¡®å®šé›†ç¾¤æˆå‘˜çš„å¥åº·çŠ¶å†µã€‚Envoy å¦‚ä½•å°†è¯·æ±‚è·¯ç”±åˆ°é›†ç¾¤æˆå‘˜ç”±&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/load_balancing#arch-overview-load-balancing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´Ÿè½½å‡è¡¡ç­–ç•¥&lt;/a&gt;ç¡®å®šã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªä¸ Kubernetes ä¸­çš„ Service æ¦‚å¿µç±»ä¼¼ï¼Œåªä¸è¿‡ Kubernetes ä¸­çš„æœåŠ¡å‘ç°ä¸­å¹¶ä¸åŒ…å«å¥åº·çŠ¶å†µæ£€æŸ¥ï¼Œè€Œæ˜¯é€šè¿‡&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/guide/configure-liveness-readiness-probes.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é…ç½® Pod çš„ liveness å’Œ readiness æ¢é’ˆ&lt;/a&gt;æ¥å®ç°ï¼ŒæœåŠ¡å‘ç°é»˜è®¤ä¹Ÿæ˜¯é€šè¿‡ DNS æ¥å®ç°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;listener&#34;&gt;Listener&lt;/h3&gt;
&lt;p&gt;ç›‘å¬å™¨ï¼ˆlistenerï¼‰æ˜¯å¯ä»¥ç”±ä¸‹æ¸¸å®¢æˆ·ç«¯è¿æ¥çš„å‘½åç½‘ç»œä½ç½®ï¼ˆä¾‹å¦‚ï¼Œç«¯å£ã€unix åŸŸå¥—æ¥å­—ç­‰ï¼‰ã€‚Envoy å…¬å¼€ä¸€ä¸ªæˆ–å¤šä¸ªä¸‹æ¸¸ä¸»æœºè¿æ¥çš„ä¾¦å¬å™¨ã€‚ä¸€èˆ¬æ˜¯æ¯å°ä¸»æœºè¿è¡Œä¸€ä¸ª Envoyï¼Œä½¿ç”¨å•è¿›ç¨‹è¿è¡Œï¼Œä½†æ˜¯æ¯ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¯åŠ¨ä»»æ„æ•°é‡çš„ Listenerï¼ˆç›‘å¬å™¨ï¼‰ï¼Œç›®å‰åªç›‘å¬ TCPï¼Œæ¯ä¸ªç›‘å¬å™¨éƒ½ç‹¬ç«‹é…ç½®ä¸€å®šæ•°é‡çš„ï¼ˆL3/L4ï¼‰ç½‘ç»œè¿‡æ»¤å™¨ã€‚Listenter ä¹Ÿå¯ä»¥é€šè¿‡ Listener Discovery Serviceï¼ˆ&lt;strong&gt;LDS&lt;/strong&gt;ï¼‰åŠ¨æ€è·å–ã€‚&lt;/p&gt;
&lt;h3 id=&#34;listener-filter&#34;&gt;Listener filter&lt;/h3&gt;
&lt;p&gt;Listener ä½¿ç”¨ listener filterï¼ˆç›‘å¬å™¨è¿‡æ»¤å™¨ï¼‰æ¥æ“ä½œé“¾æ¥çš„å…ƒæ•°æ®ã€‚å®ƒçš„ä½œç”¨æ˜¯åœ¨ä¸æ›´æ”¹ Envoy çš„æ ¸å¿ƒåŠŸèƒ½çš„æƒ…å†µä¸‹æ·»åŠ æ›´å¤šçš„é›†æˆåŠŸèƒ½ã€‚Listener filter çš„ API ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºè¿™äº›è¿‡æ»¤å™¨æœ€ç»ˆæ˜¯åœ¨æ–°æ¥å—çš„å¥—æ¥å­—ä¸Šè¿è¡Œã€‚åœ¨é“¾ä¸­å¯ä»¥äº’ç›¸è¡”æ¥ä»¥æ”¯æŒæ›´å¤æ‚çš„åœºæ™¯ï¼Œä¾‹å¦‚è°ƒç”¨é€Ÿç‡é™åˆ¶ã€‚Envoy å·²ç»åŒ…å«äº†å¤šä¸ªç›‘å¬å™¨è¿‡æ»¤å™¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-ä¸­å¢åŠ çš„æµé‡æ¨¡å‹&#34;&gt;Istio ä¸­å¢åŠ çš„æµé‡æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;VirtualService&lt;/code&gt;ã€&lt;code&gt;DestinationRule&lt;/code&gt;ã€&lt;code&gt;Gateway&lt;/code&gt;ã€&lt;code&gt;ServiceEntry&lt;/code&gt; å’Œ &lt;code&gt;EnvoyFilter&lt;/code&gt; éƒ½æ˜¯ Istio ä¸­ä¸ºæµé‡ç®¡ç†æ‰€åˆ›å»ºçš„ CRDï¼Œè¿™äº›æ¦‚å¿µå…¶å®æ˜¯åšè·¯ç”±ç®¡ç†ï¼Œè€Œ Kubernetes ä¸­çš„ service åªæ˜¯ç”¨æ¥åšæœåŠ¡å‘ç°ï¼Œæ‰€ä»¥ä»¥ä¸Šå…¶å®ä¹Ÿä¸èƒ½æˆä¸º Istio ä¸­çš„æœåŠ¡æ¨¡å‹ï¼Œä½†å…¶å®å®ƒä»¬ä¹Ÿæ˜¯ç”¨æ¥ç®¡ç†æœåŠ¡çš„ï¼Œå¦‚æœæµé‡ä¸èƒ½è·¯ç”±çš„åˆ›å»ºçš„æœåŠ¡ä¸Šé¢å»ï¼Œé‚£æœåŠ¡çš„å­˜åœ¨åˆæœ‰ä½•æ„ä¹‰ï¼Ÿåœ¨ Service Mesh çœŸæ­£çš„æœåŠ¡æ¨¡å‹è¿˜æ˜¯å¾—ä» Envoy çš„ &lt;a href=&#34;http://www.servicemesher.com/blog/envoy-xds-protocol/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS åè®®&lt;/a&gt;æ¥çœ‹ï¼Œå…¶ä¸­åŒ…æ‹¬äº†æœåŠ¡çš„æµé‡æ²»ç†ï¼ŒæœåŠ¡çš„æ–­ç‚¹æ˜¯é€šè¿‡ EDS æ¥é…ç½®çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-pilot-æ¶æ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio pilot æ¶æ„å›¾&#34; srcset=&#34;
               /blog/istio-service-and-traffic-model/006tKfTcgy1ftczrqzgw5j31kw0t1q7o_hu05348fe51e98dd7f1390cc966e2539ce_61794_f9eb873e16ae8a009d3be92c5b4a2a97.webp 400w,
               /blog/istio-service-and-traffic-model/006tKfTcgy1ftczrqzgw5j31kw0t1q7o_hu05348fe51e98dd7f1390cc966e2539ce_61794_6ddf6a121ec23792605c6a4f9b54bc51.webp 760w,
               /blog/istio-service-and-traffic-model/006tKfTcgy1ftczrqzgw5j31kw0t1q7o_hu05348fe51e98dd7f1390cc966e2539ce_61794_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istio-service-and-traffic-model/006tKfTcgy1ftczrqzgw5j31kw0t1q7o_hu05348fe51e98dd7f1390cc966e2539ce_61794_f9eb873e16ae8a009d3be92c5b4a2a97.webp&#34;
               width=&#34;760&#34;
               height=&#34;388&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio pilot æ¶æ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ˜¯ Pilot è®¾è®¡å›¾ï¼Œæ¥è‡ª&lt;a href=&#34;https://github.com/istio/old_pilot_repo/blob/master/doc/design.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Pilot design overview&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;routing&#34;&gt;Routing&lt;/h3&gt;
&lt;p&gt;Kubernetes ä¸­çš„ service æ˜¯æ²¡æœ‰ä»»ä½•è·¯ç”±å±æ€§å¯ä»¥é…ç½®çš„ï¼ŒIstio åœ¨è®¾è®¡ä¹‹åˆå°±é€šè¿‡åœ¨åŒä¸€ä¸ª Pod ä¸­ï¼Œåœ¨åº”ç”¨å®¹å™¨æ—è¿è¡Œä¸€ä¸ª sidecar proxy æ¥é€æ˜å¾—å®ç°ç»†ç²’åº¦çš„è·¯ç”±æ§åˆ¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;virtualservice&#34;&gt;VirtualService&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;VirtualService&lt;/code&gt; å®šä¹‰é’ˆå¯¹æŒ‡å®šæœåŠ¡æµé‡çš„è·¯ç”±è§„åˆ™ã€‚æ¯ä¸ªè·¯ç”±è§„åˆ™éƒ½é’ˆå¯¹ç‰¹å®šåè®®çš„åŒ¹é…è§„åˆ™ã€‚å¦‚æœæµé‡ç¬¦åˆè¿™äº›ç‰¹å¾ï¼Œå°±ä¼šæ ¹æ®è§„åˆ™å‘é€åˆ°æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ç›®æ ‡æœåŠ¡ï¼ˆæˆ–è€…ç›®æ ‡æœåŠ¡çš„å­é›†æˆ–ç‰ˆæœ¬ï¼‰ã€‚å¯¹äº A/B æµ‹è¯•å’Œç°åº¦å‘å¸ƒç­‰åœºæ™¯ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨åˆ’åˆ† &lt;code&gt;subset&lt;/code&gt;ï¼ŒVirtualService ä¸­æ ¹æ® destination ä¸­çš„ subset é…ç½®æ¥é€‰æ‹©è·¯ç”±ï¼Œä½†æ˜¯è¿™äº› subset ç©¶ç«Ÿå¯¹åº”å“ªäº›æœåŠ¡ç¤ºä¾‹ï¼Œè¿™å°±éœ€è¦ &lt;code&gt;DestionationRule&lt;/code&gt;ã€‚è¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://preliminary.istio.io/zh/docs/reference/config/istio.networking.v1alpha3/#virtualservice&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VirtualService&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;destinationrule&#34;&gt;DestinationRule&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;DestinationRule&lt;/code&gt; æ‰€å®šä¹‰çš„ç­–ç•¥ï¼Œå†³å®šäº†ç»è¿‡è·¯ç”±å¤„ç†ä¹‹åçš„æµé‡çš„è®¿é—®ç­–ç•¥ã€‚è¿™äº›ç­–ç•¥ä¸­å¯ä»¥å®šä¹‰è´Ÿè½½å‡è¡¡é…ç½®ã€è¿æ¥æ± å°ºå¯¸ä»¥åŠå¤–éƒ¨æ£€æµ‹ï¼ˆç”¨äºåœ¨è´Ÿè½½å‡è¡¡æ± ä¸­å¯¹ä¸å¥åº·ä¸»æœºè¿›è¡Œè¯†åˆ«å’Œé©±é€ï¼‰é…ç½®ã€‚è¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://preliminary.istio.io/zh/docs/reference/config/istio.networking.v1alpha3/#destinationrule&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DestinationRule&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;gateway&#34;&gt;Gateway&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Gateway&lt;/code&gt; æè¿°äº†ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨äºæ‰¿è½½ç½‘æ ¼è¾¹ç¼˜çš„è¿›å…¥å’Œå‘å‡ºè¿æ¥ã€‚è¿™ä¸€è§„èŒƒä¸­æè¿°äº†ä¸€ç³»åˆ—å¼€æ”¾ç«¯å£ï¼Œä»¥åŠè¿™äº›ç«¯å£æ‰€ä½¿ç”¨çš„åè®®ã€è´Ÿè½½å‡è¡¡çš„ SNI é…ç½®ç­‰å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå®é™…ä¸Šå°±æ˜¯å®šä¹‰æœåŠ¡ç½‘æ ¼çš„è¾¹ç¼˜è·¯ç”±ã€‚è¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://preliminary.istio.io/zh/docs/reference/config/istio.networking.v1alpha3/#gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;serviceentry&#34;&gt;ServiceEntry&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;ServiceEntry&lt;/code&gt; èƒ½å¤Ÿåœ¨ Istio å†…éƒ¨çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­åŠ å…¥é¢å¤–çš„æ¡ç›®ï¼Œä»è€Œè®©ç½‘æ ¼ä¸­è‡ªåŠ¨å‘ç°çš„æœåŠ¡èƒ½å¤Ÿè®¿é—®å’Œè·¯ç”±åˆ°è¿™äº›æ‰‹å·¥åŠ å…¥çš„æœåŠ¡ã€‚&lt;code&gt;ServiceEntry&lt;/code&gt; æè¿°äº†æœåŠ¡çš„å±æ€§ï¼ˆDNS åç§°ã€VIPã€ç«¯å£ã€åè®®ä»¥åŠç«¯ç‚¹ï¼‰ã€‚è¿™ç±»æœåŠ¡å¯èƒ½æ˜¯ç½‘æ ¼å¤–çš„ APIï¼Œæˆ–è€…æ˜¯å¤„äºç½‘æ ¼å†…éƒ¨ä½†å´ä¸å­˜åœ¨äºå¹³å°çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ¡ç›®ï¼ˆä¾‹å¦‚éœ€è¦å’Œ Kubernetes æœåŠ¡æ²Ÿé€šçš„ä¸€ç»„è™šæ‹ŸæœºæœåŠ¡ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰é…ç½® ServiceEntry çš„è¯ï¼ŒIstio å®é™…ä¸Šæ˜¯æ— æ³•å‘ç°æœåŠ¡ç½‘æ ¼å¤–éƒ¨çš„æœåŠ¡çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;envoyfilter&#34;&gt;EnvoyFilter&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;EnvoyFilter&lt;/code&gt; å¯¹è±¡æè¿°äº†é’ˆå¯¹ä»£ç†æœåŠ¡çš„è¿‡æ»¤å™¨ï¼Œè¿™äº›è¿‡æ»¤å™¨å¯ä»¥å®šåˆ¶ç”± Istio Pilot ç”Ÿæˆçš„ä»£ç†é…ç½®ã€‚è¿™ä¸€åŠŸèƒ½ä¸€å®šè¦è°¨æ…ä½¿ç”¨ã€‚é”™è¯¯çš„é…ç½®å†…å®¹ä¸€æ—¦å®Œæˆä¼ æ’­ï¼Œå¯èƒ½ä¼šä»¤æ•´ä¸ªæœåŠ¡ç½‘æ ¼è¿›å…¥ç˜«ç—ªçŠ¶æ€ã€‚è¯¦æƒ…è¯·å‚è€ƒ &lt;a href=&#34;https://preliminary.istio.io/zh/docs/reference/config/istio.networking.v1alpha3/#envoyfilter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EnvoyFilter&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Envoy ä¸­çš„ listener å¯ä»¥é…ç½®å¤šä¸ª &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/listener_filters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;filter&lt;/a&gt;ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§é€šè¿‡ Istio æ¥æ‰©å±• Envoy çš„æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/service.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes ä¸­çš„ service - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/old_pilot_repo/blob/master/doc/service-registry.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio services model - github.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/zh/docs/reference/config/istio.networking.v1alpha3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æµé‡è·¯ç”± - istio.io&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Envoy å’Œ Jaeger å®ç°åˆ†å¸ƒå¼è¿½è¸ª</title>
      <link>https://cloudnative.to/blog/distributed-tracing-with-envoy-service-mesh-jaeger/</link>
      <pubDate>Tue, 11 Dec 2018 14:24:23 +0800</pubDate>
      <guid>https://cloudnative.to/blog/distributed-tracing-with-envoy-service-mesh-jaeger/</guid>
      <description>&lt;p&gt;å¦‚æœä½ æ˜¯åˆæ¬¡æ¥è§¦æœåŠ¡ç½‘æ ¼å’Œ Envoyï¼Œæˆ‘&lt;a href=&#34;https://medium.com/@dnivra26/service-mesh-with-envoy-101-e6b2131ee30b&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;æœ‰ä¸€ç¯‡æ–‡ç« å¯ä»¥å¸®åŠ©ä½ å…¥é—¨ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå¯è§‚æµ‹æ€§å˜å¾—è¶ŠåŠ é‡è¦ã€‚æˆ‘è®¤ä¸ºè¿™æ˜¯é€‰æ‹©å¾®æœåŠ¡è¿™æ¡è·¯çš„å¿…è¦æ¡ä»¶ä¹‹ä¸€ã€‚æˆ‘çš„ä¸€ä½å‰åŒäº‹åˆ—å‡ºäº†ä¸€ä»½éå¸¸æ£’çš„&lt;a href=&#34;https://news.ycombinator.com/item?id=12509533&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éœ€æ±‚æ¸…å•&lt;/a&gt;ï¼Œå¦‚æœä½ æƒ³åšå¾®æœåŠ¡ï¼Œé‚£ä¹ˆä½ éœ€è¦æ»¡è¶³æåˆ°çš„è¿™äº›è¦æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;å¯è§‚æµ‹æ€§æœ‰è®¸å¤šäº‹è¦åšï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›‘æ§&lt;/li&gt;
&lt;li&gt;æŠ¥è­¦&lt;/li&gt;
&lt;li&gt;æ—¥å¿—é›†ä¸­åŒ–&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼è¿½è¸ª&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ–‡åªè®¨è®º Envoy ä¸‹çš„åˆ†å¸ƒå¼è¿½è¸ªï¼Œæˆ‘å°½é‡ç»™å‡ºä¸€ä¸ªå…¨è²Œæ¥æè¿°åˆ†å¸ƒå¼è¿½è¸ªã€OpenTracingã€Envoy å’Œ Jaeger æ˜¯å¦‚ä½•æ•´åˆåœ¨ä¸€èµ·å·¥ä½œçš„ã€‚åœ¨&lt;a href=&#34;https://medium.com/@dnivra26/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana-a1c26a8595fc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸‹ä¸€ç¯‡æ–‡ç« &lt;/a&gt;ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºä½¿ç”¨ Envoyã€prometheus å’Œ grafana åšç›‘æ§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åˆ†å¸ƒå¼è¿½è¸ª&#34;&gt;åˆ†å¸ƒå¼è¿½è¸ª&lt;/h2&gt;
&lt;p&gt;éšç€å¤§é‡çš„æœåŠ¡å’Œè¯·æ±‚çš„æµè½¬ï¼Œä½ éœ€è¦èƒ½å¤Ÿå¿«é€Ÿå‘ç°å“ªé‡Œå‡ºäº†é—®é¢˜ã€‚åˆ†å¸ƒå¼è¿½è¸ªæœ€æ—©ç”±&lt;a href=&#34;https://ai.google/research/pubs/pub36356&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è°·æ­Œçš„ Dapper&lt;/a&gt;æ™®åŠå¼€æ¥ï¼Œå®ƒæœ¬è´¨ä¸Šå…·æœ‰åœ¨å¾®æœåŠ¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­è¿½è¸ªè¯·æ±‚çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;æœ€ç®€å•çš„å®ç°æ–¹æ³•æ˜¯åœ¨å‰ç«¯ä»£ç†ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„è¯·æ±‚ idï¼ˆx-request-idï¼‰ï¼Œå¹¶å°†è¯¥è¯·æ±‚ id ä¼ é€’ç»™ä¸å…¶äº¤äº’çš„æ‰€æœ‰æœåŠ¡ã€‚åŸºæœ¬ä¸Šå¯ä»¥å‘æ‰€æœ‰çš„æ—¥å¿—è¿½åŠ è¿™ä¸€è¯·æ±‚ idã€‚å› æ­¤ï¼Œå¦‚æœä½ åœ¨ kibana è¿™æ ·çš„ç³»ç»Ÿä¸­æœç´¢å”¯ä¸€ idï¼Œä½ ä¼šçœ‹åˆ°é’ˆå¯¹è¯¥ç‰¹å®šè¯·æ±‚çš„æ‰€æœ‰ç›¸å…³çš„æ—¥å¿—ã€‚&lt;/p&gt;
&lt;p&gt;è¿™éå¸¸æœ‰ç”¨ï¼Œä½†æ˜¯å®ƒä¸èƒ½å‘Šè¯‰ä½ æ¯ä¸ªæœåŠ¡ä¸­è¯·æ±‚å®Œæˆçš„é¡ºåºã€æ˜¯å¦æ˜¯å¹¶è¡Œå®Œæˆçš„æˆ–è€…èŠ±è´¹äº†å¤šå°‘æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹ OpenTracing å’Œ Envoy å¦‚ä½•å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸€é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;opentracing&#34;&gt;OpenTracing&lt;/h2&gt;
&lt;p&gt;ä¸å…¶åªä¼ é€’ä¸€ä¸ª idï¼ˆx-request-idï¼‰ï¼Œä¸å¦‚ä¼ é€’æ›´å¤šçš„æ•°æ®ï¼Œæ¯”å¦‚å“ªä¸ªæœåŠ¡ä½äºè¯·æ±‚çš„æ ¹çº§åˆ«ï¼Œå“ªä¸ªæœåŠ¡æ˜¯å“ªä¸ªæœåŠ¡çš„å­æœåŠ¡ç­‰ç­‰ã€‚è¿™å¯ä»¥å¸®æˆ‘ä»¬æ‰¾å‡ºæ‰€æœ‰çš„ç­”æ¡ˆã€‚æ ‡å‡†çš„åšæ³•æ˜¯ä½¿ç”¨ OpenTracingï¼Œå®ƒæ˜¯åˆ†å¸ƒå¼è¿½è¸ªçš„è§„èŒƒï¼Œå’Œè¯­è¨€æ— å…³ã€‚ä½ å¯ä»¥åœ¨&lt;a href=&#34;https://opentracing.io/speciation/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;é˜…è¯»æ›´å¤šå…³äºæ­¤è§„èŒƒçš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy&#34;&gt;Envoy&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼å°±åƒå¾®æœåŠ¡çš„é€šä¿¡å±‚ï¼ŒæœåŠ¡ä¹‹é—´çš„æ‰€æœ‰é€šä¿¡éƒ½æ˜¯é€šè¿‡ç½‘æ ¼è¿›è¡Œçš„ã€‚å®ƒå¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘ç°ã€æµé‡è½¬ç§»ã€é€Ÿç‡é™åˆ¶ã€æŒ‡æ ‡ï¼ˆmetricsï¼‰æ”¶é›†ç­‰åŠŸèƒ½ï¼ŒEnvoy å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªæœåŠ¡ç½‘æ ¼ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒEnvoy å°†å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆå”¯ä¸€æ ¹è¯·æ±‚ idï¼ˆx-request-idï¼‰ï¼Œç”Ÿæˆå­è¯·æ±‚ idï¼Œå¹¶å°†å®ƒä»¬å‘é€åˆ°&lt;a href=&#34;https://www.jaegertracing.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Jaeger&lt;/a&gt;æˆ–&lt;a href=&#34;https://zipkin.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Zipkin&lt;/a&gt;è¿™æ ·çš„è¿½è¸ªç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿå­˜å‚¨ã€èšåˆè¿½è¸ªæ•°æ®å¹¶ä¸ºå…¶æä¾›å¯è§†åŒ–çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬ä¼šä½¿ç”¨ Jaeger ä½œä¸ºè¿½è¸ªç³»ç»Ÿï¼ŒEnvoy ç”¨æ¥ç”ŸæˆåŸºäº zipkin æˆ– lighstep æ ¼å¼çš„è¿½è¸ªæ•°æ®ã€‚æˆ‘ä»¬ä¼šä½¿ç”¨ zipkin çš„æ ‡å‡†æ¥å…¼å®¹ Jaegerã€‚&lt;/p&gt;
&lt;h2 id=&#34;åªè¦ç»™æˆ‘çœ‹ä»£ç å°±å¥½&#34;&gt;åªè¦ç»™æˆ‘çœ‹ä»£ç å°±å¥½&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢çš„å›¾å±•ç¤ºäº†æˆ‘ä»¬å°è¯•æ„å»ºçš„ç³»ç»Ÿå…¨è²Œï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-service-setup&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;service setup&#34; srcset=&#34;
               /blog/distributed-tracing-with-envoy-service-mesh-jaeger/006tNbRwly1fxvygc19pfj30o70a6glq_hubdad3ed436c7fe3637eb973e4291aa57_18550_414c32bae749d919d331b2d40f1673d9.webp 400w,
               /blog/distributed-tracing-with-envoy-service-mesh-jaeger/006tNbRwly1fxvygc19pfj30o70a6glq_hubdad3ed436c7fe3637eb973e4291aa57_18550_440d6c9c8bb49ccbc3240797464b69ae.webp 760w,
               /blog/distributed-tracing-with-envoy-service-mesh-jaeger/006tNbRwly1fxvygc19pfj30o70a6glq_hubdad3ed436c7fe3637eb973e4291aa57_18550_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/distributed-tracing-with-envoy-service-mesh-jaeger/006tNbRwly1fxvygc19pfj30o70a6glq_hubdad3ed436c7fe3637eb973e4291aa57_18550_414c32bae749d919d331b2d40f1673d9.webp&#34;
               width=&#34;760&#34;
               height=&#34;319&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      service setup
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœåŠ¡å®‰è£…&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨ docker-compose æ¥éƒ¨ç½² Envoyã€‚ä½ éœ€è¦å‘ Envoy æä¾›ä¸€ä»½é…ç½®æ–‡ä»¶ã€‚è¿™é‡Œæˆ‘ä¸æ‰“ç®—è§£é‡Šå¦‚ä½•é…ç½® Envoyï¼Œåªé›†ä¸­è®¨è®ºä¸è¿½è¸ªç›¸å…³çš„éƒ¨åˆ†ã€‚ã€‚ä½ å¯ä»¥åœ¨&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/overview/v2_overview&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ°æ›´å¤šå…³äºé…ç½® Envoy çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‰ç«¯-envoy&#34;&gt;å‰ç«¯ Envoy&lt;/h2&gt;
&lt;p&gt;å‰ç«¯ Envoy çš„ä½œç”¨æ˜¯ç”Ÿæˆæ ¹è¯·æ±‚ idï¼Œä½ å¯ä»¥é€šè¿‡é…ç½®å»å®ç°ã€‚ä¸‹é¢æ˜¯å®ƒçš„é…ç½®æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tracing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.zipkin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;collector_cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;jaeger&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;collector_endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/api/v1/spans&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;admin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;access_log_path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/tmp/admin_access.log&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9901&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;static_resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http_listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tracing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operation_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;egress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;use_remote_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;add_user_agent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;access_log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.file_access_log&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/dev/stdout&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[ACCESS_LOG][%START_TIME%] \&amp;#34;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&amp;#34; %RESPONSE_CODE% %RESPONSE_FLAGS% %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&amp;#34;%REQ(X-FORWARDED-FOR)%\&amp;#34; \&amp;#34;%REQ(USER-AGENT)%\&amp;#34; \&amp;#34;%REQ(X-REQUEST-ID)%\&amp;#34; \&amp;#34;%REQ(:AUTHORITY)%\&amp;#34; \&amp;#34;%UPSTREAM_HOST%\&amp;#34; \&amp;#34;%DOWNSTREAM_REMOTE_ADDRESS_WITHOUT_PORT%\&amp;#34;\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ingress_443&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;codec_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;AUTO&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;generate_request_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;local_route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_a&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.router&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_a&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.25s&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;strict_dns&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ROUND_ROBIN&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_a_envoy&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8786&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;jaeger&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;25s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;strict_dns&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;round_robin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;jaeger&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9411&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¬¬ 1-8 è¡Œå¯ç”¨è¿½è¸ªå¹¶é…ç½®è¿½è¸ªç³»ç»Ÿå’Œå®ƒæ‰€åœ¨çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ 27-28 è¡ŒæŒ‡å®šæµé‡è¿›å‡ºçš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ 38 è¡ŒæŒ‡å‡º Envoy å¿…é¡»ç”Ÿæˆæ ¹è¯·æ±‚ idã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ 66-73 è¡Œé…ç½® Jaeger è¿½è¸ªç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰ Envoy çš„é…ç½®ä¸­ï¼ˆå‰ç«¯ï¼ŒæœåŠ¡ aï¼Œb å’Œ cï¼‰éƒ½éœ€è¦å¯ç”¨è¿½è¸ªå’Œé…ç½® Jaeger åœ°å€&lt;/p&gt;
&lt;h2 id=&#34;service-a&#34;&gt;Service A&lt;/h2&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æœåŠ¡ A å°†è°ƒç”¨æœåŠ¡ B å’ŒæœåŠ¡ Cã€‚å…³äºåˆ†å¸ƒå¼è¿½è¸ªéå¸¸é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œå°½ç®¡ Envoy æ”¯æŒè¿›è¡Œåˆ†å¸ƒå¼è¿½è¸ªï¼Œä½†ä¹Ÿ&lt;strong&gt;ä¾èµ–äºæœåŠ¡æŠŠç”Ÿæˆçš„ Header ä¼ é€’ç»™æµå‡ºçš„è¯·æ±‚&lt;/strong&gt;ã€‚å› æ­¤ï¼ŒæœåŠ¡ A å°†åœ¨è°ƒç”¨æœåŠ¡ B å’Œ C æ—¶è½¬å‘è¯·æ±‚å¤´ã€‚æœåŠ¡ A æ˜¯ä¸€ä¸ªåªæœ‰ä¸€ä¸ªç«¯ç‚¹ï¼ˆendpointï¼‰çš„ç®€å•çš„ go æœåŠ¡ï¼Œå†…éƒ¨è°ƒç”¨æœåŠ¡ B å’ŒæœåŠ¡ Cã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬éœ€è¦ä¼ é€’çš„å¤´ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;http://service_a_envoy:8788/&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;x-request-id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;x-request-id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;x-b3-traceid&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;x-b3-traceid&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;x-b3-spanid&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;x-b3-spanid&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;x-b3-parentspanid&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;x-b3-parentspanid&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;x-b3-sampled&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;x-b3-sampled&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;x-b3-flags&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;x-b3-flags&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;x-ot-span-context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;x-ot-span-context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;resp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Do&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‚¨å¯èƒ½æƒŠè®¶ä¸ºä»€ä¹ˆè°ƒç”¨æœåŠ¡ B æ—¶ URL æ˜¯&lt;code&gt;service_a_envoy&lt;/code&gt;ã€‚å¦‚æœä½ è¿˜è®°å¾—æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡æœåŠ¡ä¹‹é—´çš„æ‰€æœ‰é€šä¿¡éƒ½éœ€è¦é€šè¿‡ envoy ä»£ç†çš„è¯ï¼Œç±»ä¼¼çš„ï¼Œå¯ä»¥åœ¨è°ƒç”¨æœåŠ¡ C æ—¶ä¼ é€’ Headerã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡-b-å’ŒæœåŠ¡-c&#34;&gt;æœåŠ¡ B å’ŒæœåŠ¡ C&lt;/h2&gt;
&lt;p&gt;å‰©ä¸‹çš„ä¸¤ä¸ªæœåŠ¡ä¸éœ€è¦å¯¹ä»£ç è¿›è¡Œä»»ä½•æ›´æ”¹ï¼Œå› ä¸ºå®ƒä»¬å¤„äºå¶å­çº§åˆ«ã€‚ä¸€æ—¦è¿™ä¸¤ä¸ªæœåŠ¡è¦è°ƒç”¨å…¶ä»–ç«¯ç‚¹ï¼Œåˆ™å¿…é¡»è½¬å‘è¯·æ±‚è¿½è¸ªå¤´ï¼Œé™¤æ­¤ä¹‹å¤–ä¸éœ€è¦å¯¹ Envoy è¿›è¡Œä»»ä½•ç‰¹æ®Šé…ç½®ã€‚æœåŠ¡ B å’Œ C ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;net/http&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResponseWriter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Hello from service B&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ListenAndServe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;:8082&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s&#34;&gt;&amp;#34;net/http&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResponseWriter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Hello from service C&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ListenAndServe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;:8083&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€æœ‰è¿™äº›å®Œæˆåï¼Œå¦‚æœæ‚¨è¿è¡Œ&lt;code&gt;docker-compose up&lt;/code&gt;å¹¶è®¿é—®å‰ç«¯ Envoy ç«¯ç‚¹ï¼Œå°±ä¼šç”Ÿæˆè¿½è¸ªä¿¡æ¯å¹¶æ¨é€åˆ° Jaegerã€‚Jaeger æœ‰ä¸€ä¸ªéå¸¸å‹å¥½çš„ UI ç•Œé¢æ¥å±•ç¤ºè¿½è¸ªä¿¡æ¯ï¼Œæˆ‘ä»¬çš„ä¿¡æ¯çœ‹ä¸Šå»åƒè¿™æ ·ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-trace-from-jaeger&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;trace from jaeger&#34; srcset=&#34;
               /blog/distributed-tracing-with-envoy-service-mesh-jaeger/006tNbRwly1fxw0rfr8dyj31jk0e8q62_hu4c3e597ad002de97e59d7c59b452a249_37721_c26dda9e203cddac3a65c8eebcfd8fb8.webp 400w,
               /blog/distributed-tracing-with-envoy-service-mesh-jaeger/006tNbRwly1fxw0rfr8dyj31jk0e8q62_hu4c3e597ad002de97e59d7c59b452a249_37721_14aef102960563030c6f5b6e71b3197d.webp 760w,
               /blog/distributed-tracing-with-envoy-service-mesh-jaeger/006tNbRwly1fxw0rfr8dyj31jk0e8q62_hu4c3e597ad002de97e59d7c59b452a249_37721_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/distributed-tracing-with-envoy-service-mesh-jaeger/006tNbRwly1fxw0rfr8dyj31jk0e8q62_hu4c3e597ad002de97e59d7c59b452a249_37721_c26dda9e203cddac3a65c8eebcfd8fb8.webp&#34;
               width=&#34;760&#34;
               height=&#34;195&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      trace from jaeger
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ­£å¦‚ä½ çœ‹åˆ°çš„ï¼Œå®ƒæä¾›äº†æ€»ä½“çš„æ—¶é—´æŸè€—ï¼Œç³»ç»Ÿå„éƒ¨åˆ†æ˜¯æ—¶é—´æŸè€—ï¼Œå“ªä¸ªæœåŠ¡è°ƒç”¨å“ªä¸ªæœåŠ¡ï¼ŒæœåŠ¡å’ŒæœåŠ¡çš„å…³ç³»ï¼ˆæœåŠ¡ b å’ŒæœåŠ¡ c æ˜¯å…„å¼Ÿå…³ç³»ï¼‰ã€‚Jaeger çš„è¿›ä¸€æ­¥ä½¿ç”¨ç•™å¾…ä½ è‡ªå·±å»æ¢ç´¢ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥åœ¨&lt;a href=&#34;https://github.com/dnivra26/envoy_distributed_tracing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ°æ‰€æœ‰çš„ Envoy é…ç½®ã€ä»£ç å’Œ Docker compose æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å°±æ˜¯è¿™äº›ï¼Œè°¢è°¢ï¼Œè®©æˆ‘çŸ¥é“ä½ çš„åé¦ˆã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ åœ¨å¯»æ‰¾ Envoy çš„ xDS æœåŠ¡ç«¯çš„è¯ï¼Œæˆ‘çš„åŒäº‹å·²ç»æ­å»ºäº†&lt;a href=&#34;https://github.com/tak2siva/Envoy-Pilot&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€ä¸ª&lt;/a&gt;ã€‚å¯ä»¥ç›´æ¥è·å–ï¼ˆcheck outï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://medium.com/@dnivra26/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana-a1c26a8595fc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt; æ˜¯è¿™ä¸€ç³»åˆ—æ–‡ç« ä¸­çš„ä¸‹ä¸€ç¯‡ï¼ˆä½¿ç”¨ Envoyï¼ŒPrometheus å’Œ Grafana è¿›è¡Œç›‘æ§ï¼‰ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Envoy ä¸­çš„æ•°æ®ç»Ÿè®¡</title>
      <link>https://cloudnative.to/blog/envoy-stats/</link>
      <pubDate>Fri, 07 Dec 2018 12:52:58 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-stats/</guid>
      <description>&lt;p&gt;è¿™æ˜¯æˆ‘åœ¨&lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;æ¶æ„ç³»åˆ—ä¸­çš„ç¬¬ 3 ç¯‡æ–‡ç« ã€‚è¿™ç¯‡æ–‡ç« åŸºäºä»¥å‰å…³äº Envoy çš„&lt;a href=&#34;https://medium.com/@mattklein123/envoy-threading-model-a8d44b922310&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çº¿ç¨‹æ¨¡å‹&lt;/a&gt;å’Œ&lt;a href=&#34;https://medium.com/@mattklein123/envoy-hot-restart-1d16b14555b5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çƒ­é‡å¯&lt;/a&gt;åŠŸèƒ½çš„å¸–å­ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰é˜…è¯»è¿™äº›å¸–å­ï¼Œè¯·å…ˆé˜…è¯»ã€‚éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œéšç€é¢„æ¼”çš„ç»“æŸï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥è¿›å…¥æ›´æœ‰è¶£çš„è¯é¢˜ï¼&lt;/p&gt;
&lt;h2 id=&#34;ç»Ÿè®¡æ¦‚è¿°&#34;&gt;ç»Ÿè®¡æ¦‚è¿°&lt;/h2&gt;
&lt;p&gt;åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒEnvoy æ‰€åšçš„æœ€é‡è¦çš„äº‹æƒ…æ˜¯ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯è§‚æµ‹æ€§æä¾›äº†ä¸€ä¸ªå¥å£®çš„å¹³å°ã€‚è¿™åŒ…æ‹¬ç»Ÿè®¡æ•°æ®ã€æ—¥å¿—è®°å½•å’Œåˆ†å¸ƒå¼è·Ÿè¸ªã€‚è¿™ç¯‡æ–‡ç« å°†é›†ä¸­åœ¨ç»Ÿè®¡æ•°æ®å’Œ Envoy æ˜¯å¦‚ä½•å®ç°å…è®¸é«˜å®¹é‡çš„åŒæ—¶ä¿æŒå“è¶Šæ€§èƒ½çš„ã€‚Envoy ç›®å‰æ”¯æŒä¸‰ç§ä¸åŒçš„ç»Ÿè®¡æ•°æ®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Counterï¼ˆè®¡æ•°å™¨ï¼‰&lt;/strong&gt;ï¼šåªèƒ½å¢åŠ ä¸ä¼šå‡å°‘çš„æ— ç¬¦å·æ•´æ•°ã€‚ä¾‹å¦‚ï¼Œæ€»è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Gaugeï¼ˆè®¡é‡ï¼‰&lt;/strong&gt;ï¼šå¯ä»¥åŒæ—¶å¢åŠ å’Œå‡å°‘çš„æ— ç¬¦å·æ•´æ•°ã€‚ä¾‹å¦‚ï¼Œç›®å‰æœ‰æ•ˆçš„è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Timer/hitogramï¼ˆè®¡æ—¶å™¨/ç›´æ–¹å›¾ï¼‰&lt;/strong&gt;ï¼šæ— ç¬¦å·æ•´æ•°ï¼Œæœ€ç»ˆå°†äº§ç”Ÿæ±‡æ€»ç™¾åˆ†ä½å€¼ã€‚Envoy ä¸åŒºåˆ†è®¡æ—¶å™¨ï¼ˆé€šå¸¸ä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰å’ŒåŸå§‹ç›´æ–¹å›¾ï¼ˆå¯ä»¥æ˜¯ä»»ä½•å•ä½ï¼‰ã€‚ä¾‹å¦‚ï¼Œä¸Šæ¸¸è¯·æ±‚æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Envoy ç›®å‰ä¸æ”¯æŒä»»ä½•æµ®ç‚¹ç»Ÿè®¡æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-stats/006tNbRwly1fxv00zgfu2j30m804ugmh_hu838dfa745eaa8a4a104fd039dba7fe1f_29424_9c5ce7c5689b0d48f6a60484feee46b2.webp 400w,
               /blog/envoy-stats/006tNbRwly1fxv00zgfu2j30m804ugmh_hu838dfa745eaa8a4a104fd039dba7fe1f_29424_b751529213b7d182b53ec94a2820dc17.webp 760w,
               /blog/envoy-stats/006tNbRwly1fxv00zgfu2j30m804ugmh_hu838dfa745eaa8a4a104fd039dba7fe1f_29424_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-stats/006tNbRwly1fxv00zgfu2j30m804ugmh_hu838dfa745eaa8a4a104fd039dba7fe1f_29424_9c5ce7c5689b0d48f6a60484feee46b2.webp&#34;
               width=&#34;760&#34;
               height=&#34;165&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;center&gt;Envoy ç”Ÿæˆå¾ˆå¤šå¯¹è°ƒè¯•åˆ†å¸ƒå¼ç³»ç»Ÿæœ‰ç”¨çš„æ•°æ®ï¼&lt;/center&gt;
## ç»Ÿè®¡å­ç³»ç»Ÿç›®æ ‡
&lt;p&gt;Envoy ç»Ÿè®¡å­ç³»ç»Ÿçš„æ€»ä½“ç›®æ ‡å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç²—ç•¥çš„çº¿æ€§ååé‡ï¼šå¯ä»¥ä¸ä»»æ„æ•°é‡çš„å·¥ä½œçº¿ç¨‹ä¸€èµ·æ‰©å±•ã€‚å¦ä¸€ç§è¯´æ³•æ˜¯ï¼šåœ¨ç¨³å®šçŠ¶æ€ä¸‹ï¼Œä½¿ç”¨ stats æ—¶åº”è¯¥æ²¡æœ‰è·¨çº¿ç¨‹äº‰ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ä½¿ç”¨çƒ­é‡å¯æ—¶ï¼ŒçŠ¶æ€åº”è¯¥åœ¨é€»è¾‘ä¸Šä¿æŒä¸€è‡´ã€‚è¿™æ„å‘³ç€å³ä½¿æœ‰ä¸¤ä¸ª Envoy è¿›ç¨‹åœ¨è¿è¡Œï¼Œå½“é€»è¾‘ä¸Šè®¤ä¸ºæ˜¯å•ä¸ªè¿›ç¨‹æ—¶ï¼Œæ‰€æœ‰è®¡æ•°å™¨ã€é‡è§„å’Œç›´æ–¹å›¾éƒ½åº”è¯¥æ˜¯ä¸€è‡´çš„ã€‚ï¼ˆæœ‰å…³è¿™æ–¹é¢çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…&lt;a href=&#34;https://medium.com/@mattklein123/envoy-hot-restart-1d16b14555b5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çƒ­é‡å¯&lt;/a&gt;è¿™ç¯‡æ–‡ç« ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç»Ÿè®¡æ•°æ®åº”è¯¥åŒ…å«åœ¨ä½œç”¨åŸŸå†…å¹¶ä½œä¸ºä¸€ä¸ªç»„é‡Šæ”¾ã€‚ä½œç”¨åŸŸæ˜¯å…·æœ‰å…¬å…±å‰ç¼€çš„ç»Ÿè®¡æ•°æ®çš„é€»è¾‘åˆ†ç»„ã€‚ä¾‹å¦‚ï¼š&lt;code&gt;http.admin.*&lt;/code&gt;ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸º Envoy å…·æœ‰åŠ¨æ€æ€§ã€‚Envoy æ”¯æŒå„ç§&lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç®¡ç† API&lt;/a&gt;ï¼Œå¦‚ç›‘å¬å™¨å‘ç°æœåŠ¡ï¼ˆLDSï¼‰å’Œé›†ç¾¤å‘ç°æœåŠ¡ï¼ˆCDSï¼‰APIã€‚ä¸ºäº†ä¸è€—å°½å†…å­˜ï¼ŒEnvoy éœ€è¦æ¸…ç†ä¸å†ä½¿ç”¨çš„ç»Ÿè®¡æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç»Ÿè®¡èŒƒå›´åº”è¯¥èƒ½å¤Ÿé‡å å’Œæ­£ç¡®çš„å¼•ç”¨è®¡æ•°ã€‚è¿™æ„å‘³ç€å¦‚æœä½œç”¨åŸŸ A ä½¿ç”¨ä¸€ä¸ªåä¸º&lt;code&gt;foo.bar.baz&lt;/code&gt;çš„å±æ€§ï¼Œä½œç”¨åŸŸ B ä¹Ÿä½¿ç”¨&lt;code&gt;foo.bar.baz&lt;/code&gt;å±æ€§ï¼Œé‚£ä¹ˆ&lt;code&gt;foo.bar.baz&lt;/code&gt;çš„å±æ€§çš„å¼•ç”¨è®¡æ•°åº”è¯¥æ˜¯ 2ã€‚è¿™å¯¹äºçƒ­é‡å¯ï¼ˆä¸¤ä¸ªè¿›ç¨‹å°†åœ¨ä¸€æ®µæ—¶é—´å†…å†™å…¥ç›¸åŒçš„ç»Ÿè®¡æ•°æ®ï¼‰å’ŒåŠ¨æ€ç®¡ç† APIï¼ˆåœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œæ›´æ–°çš„ç›‘å¬å™¨æˆ–é›†ç¾¤å°†å¼•ç”¨ä¸æ—§ç›‘å¬å™¨æˆ–é›†ç¾¤ç›¸åŒçš„ç»Ÿè®¡æ•°æ®ï¼‰éƒ½æ˜¯å¿…éœ€çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç»Ÿè®¡æ•°æ®å­ç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿå¾ˆå¥½åœ°æ‰§è¡Œç›´åˆ°æ•°æ®å¹³é¢å¤„ç†å¼€å§‹æ—¶æ‰çŸ¥é“çš„ç»Ÿè®¡ä¿¡æ¯ã€‚è®¸å¤šç»Ÿè®¡æ•°æ®æœ¬è´¨ä¸Šæ˜¯â€œå›ºå®šçš„â€ï¼Œå¯ä»¥åœ¨åŠ è½½é…ç½®æˆ–åŠ¨æ€ API é‡æ–°é…ç½®æ•°æ®å¹³é¢æ—¶åˆ›å»ºï¼ˆä¾‹å¦‚ï¼Œ&lt;code&gt;cluster.foo.upstream_rq_5xx&lt;/code&gt;ï¼‰ã€‚è¿™äº›éƒ½æ˜¯ä½é¢‘äº‹ä»¶ã€‚å…¶ä»–ç»Ÿè®¡ä¿¡æ¯ï¼Œä¾‹å¦‚è¯¦ç»†çš„ HTTP å“åº”ä»£ç åº¦é‡ï¼ˆä¾‹å¦‚ï¼Œ&lt;code&gt;cluster.foo.upstream_rq_503&lt;/code&gt;ï¼‰ï¼Œåœ¨æ•°æ®å¼€å§‹æµåŠ¨ä¹‹å‰éƒ½ä¸çŸ¥é“ã€‚ä½¿ç”¨â€œåŠ¨æ€â€çš„ç»Ÿè®¡æ•°æ®æ°¸è¿œä¸ä¼šåƒä½¿ç”¨â€œå›ºå®šâ€çš„ç»Ÿè®¡æ•°æ®é‚£æ ·å¿«ï¼Œä½†æ˜¯å³ä½¿åœ¨å¤„ç†æ¯ä¸ªå†…æ ¸æ¯ç§’æ•°åƒä¸ªè¯·æ±‚çš„ 10 æ¬¡æ—¶ï¼Œæ€§èƒ½ä»ç„¶åº”è¯¥æ˜¯è¶³å¤Ÿçš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œä¸Šè¿°ç›®æ ‡éœ€è¦ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿæ¥æ»¡è¶³ã€‚æˆ‘ä»¬ç°åœ¨å°†æ·±å…¥ç ”ç©¶è¿™ä¸ªç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ•°æ®æ¶æ„&#34;&gt;æ•°æ®æ¶æ„&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-stats/006tNbRwly1fxv13dqf7mj30m808zwf9_hud9b4ed2350d50263f1f8ac2b54f843f6_26688_195204944141804a4134c4fcd3da7b95.webp 400w,
               /blog/envoy-stats/006tNbRwly1fxv13dqf7mj30m808zwf9_hud9b4ed2350d50263f1f8ac2b54f843f6_26688_bec3c804aa52a68a5ed2e4babbc48ee1.webp 760w,
               /blog/envoy-stats/006tNbRwly1fxv13dqf7mj30m808zwf9_hud9b4ed2350d50263f1f8ac2b54f843f6_26688_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-stats/006tNbRwly1fxv13dqf7mj30m808zwf9_hud9b4ed2350d50263f1f8ac2b54f843f6_26688_195204944141804a4134c4fcd3da7b95.webp&#34;
               width=&#34;760&#34;
               height=&#34;307&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;center&gt;å›¾ 1ï¼šé«˜çº§ç»Ÿè®¡æ¶æ„ï¼Œè“è‰²ç»Ÿè®¡æ•°æ®æ˜¾ç¤ºäº†ä¸€ä¸ªä½œç”¨åŸŸåˆ†ç»„ã€‚&lt;/center&gt;
**å›¾ 1**æ˜¾ç¤ºäº† Envoy æ•°æ®ç»Ÿè®¡å­ç³»ç»Ÿçš„é«˜çº§æ¶æ„ã€‚å®ƒç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆã€‚
&lt;h3 id=&#34;å­˜å‚¨&#34;&gt;å­˜å‚¨&lt;/h3&gt;
&lt;p&gt;stat å­˜å‚¨æ˜¯ Envoy å†…éƒ¨çš„ä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œé€šè¿‡è¯¥æ¥å£ï¼Œå…¶ä½™ä»£ç å¯ä»¥è·å¾—ä½œç”¨åŸŸã€è®¡æ•°å™¨ã€è®¡é‡å’Œç›´æ–¹å›¾çš„å¥æŸ„ã€‚è°ƒç”¨ä»£ç è´Ÿè´£ç»´æŠ¤æ‰€æœ‰åˆ›å»ºçš„ä½œç”¨åŸŸçš„æ‰€æœ‰æƒè¯­ä¹‰ã€‚å½“ä½œç”¨åŸŸè¢«é”€æ¯æ—¶ï¼Œæ‰€æœ‰åŒ…å«çš„ç»Ÿè®¡æ•°æ®çš„å¼•ç”¨è®¡æ•°éƒ½ä¼šå‡å°‘ 1ã€‚å¦‚æœä»»ä½•ç»Ÿè®¡æ•°æ®è¾¾åˆ° 0 å¼•ç”¨è®¡æ•°ï¼Œå®ƒä»¬å°†è¢«é‡Šæ”¾ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç»Ÿè®¡æ•°æ®&#34;&gt;ç»Ÿè®¡æ•°æ®&lt;/h3&gt;
&lt;p&gt;å¦‚å‰æ‰€è¿°ï¼Œç»Ÿè®¡æ•°æ®åŒ…æ‹¬è®¡æ•°å™¨ã€é‡è§„å’Œç›´æ–¹å›¾ã€‚ä»ç»ˆç«¯ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œè¿™äº›æ¥å£ä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ã€‚ä¾‹å¦‚ï¼Œè®¡æ•°å™¨å’Œè®¡é‡éƒ½åŒ…æ‹¬&lt;code&gt;inc()&lt;/code&gt;å’Œ&lt;code&gt;dec()&lt;/code&gt;æ–¹æ³•ï¼Œè€Œåªæœ‰è®¡é‡åŒ…æ‹¬&lt;code&gt;set()&lt;/code&gt;æ–¹æ³•ã€‚ç¨‹åºå‘˜çœ‹ä¸åˆ°ä»»ä½•æ½œåœ¨çš„å­˜å‚¨å¤æ‚æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;flusher&#34;&gt;Flusher&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†è·å¾—é«˜æ€§èƒ½ï¼Œä½¿ç”¨åŸå­ CPU æŒ‡ä»¤åœ¨å†…éƒ¨ç¼“å†²æ‰€æœ‰çš„çŠ¶æ€å˜åŒ–ã€‚åœ¨å¯é…ç½®çš„é—´éš”å†…ï¼Œæ‰€æœ‰è®¡æ•°å™¨å’Œè®¡é‡éƒ½è¢«å†²åˆ° flusher ä¸­ã€‚æ³¨æ„ï¼Œåœ¨å½“å‰çš„æ¶æ„ä¸­ï¼Œç›´æ–¹å›¾å€¼ç›´æ¥å‘é€åˆ°æ¥æ”¶å™¨ã€‚ä¸‹é¢å°†æ›´è¯¦ç»†åœ°æè¿°è¿™ä¸€ç‚¹ã€‚Flusher åœ¨ main çº¿ç¨‹ä¸­è¿è¡Œã€‚&lt;/p&gt;
&lt;h3 id=&#34;sink&#34;&gt;Sink&lt;/h3&gt;
&lt;p&gt;ç»Ÿè®¡æ•°æ®æ¥æ”¶å™¨æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæ¥å—é€šç”¨çš„ç»Ÿè®¡æ•°æ®å¹¶å°†å…¶è½¬æ¢ä¸ºç‰¹å®šäºåç«¯çš„è¿çº¿æ ¼å¼ã€‚æ‰€æœ‰æ¥æ”¶å™¨éƒ½ä½¿ç”¨ TLSï¼Œè¿™æ ·åœ¨åˆ·æ–°è¾“å‡ºæ—¶å°±ä¸ä¼šå‡ºç°äº‰ç”¨ã€‚ç„¶è€Œï¼Œåœ¨å®è·µä¸­ï¼Œç›®å‰åªæœ‰ä¸»çº¿ä¼šå†²æ‰è®¡æ•°å™¨å’Œé‡è§„ã€‚æ‰€æœ‰çº¿ç¨‹éƒ½åˆ·æ–°ç›´æ–¹å›¾ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰ Envoy åªæ”¯æŒ TCP å’Œ UDP &lt;a href=&#34;https://github.com/b/statsd_spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;statsd&lt;/a&gt;åè®®ã€‚statsd æ˜¯ä¸€ç§éå¸¸ç®€å•ä½†å¾—åˆ°å¹¿æ³›æ”¯æŒçš„ä¼ è¾“æ ¼å¼ã€‚åœ¨æœªæ¥ï¼Œå¾ˆå¯èƒ½ä¼šå®ç°å…¶ä»–æœ¬åœ°ç»Ÿè®¡æ•°æ®æ¥æ”¶å™¨ï¼Œå¦‚&lt;a href=&#34;https://prometheus.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus&lt;/a&gt;ã€&lt;a href=&#34;https://www.wavefront.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Wavefront&lt;/a&gt;å’Œ &lt;a href=&#34;https://www.influxdata.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;InfluxDB&lt;/a&gt;ã€‚è¿˜è¦æ³¨æ„ Envoy ç›®å‰ä¸æ”¯æŒç»´åº¦æˆ–æ ‡ç­¾ç»Ÿè®¡ã€‚è¿™å°†åœ¨ä¸‹é¢çš„å·¥ä½œéƒ¨åˆ†ä¸­è¿›ä¸€æ­¥è®¨è®ºã€‚&lt;/p&gt;
&lt;h3 id=&#34;admin&#34;&gt;Admin&lt;/h3&gt;
&lt;p&gt;ä»æ“ä½œçš„è§’åº¦æ¥çœ‹ï¼Œèƒ½å¤Ÿå®æ—¶åœ°åˆ°è¾¾ä¸€ä¸ªèŠ‚ç‚¹å¹¶è½¬å‚¨å½“å‰çŠ¶æ€æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚Envoy å¯ä»¥é€šè¿‡&lt;code&gt;/stats&lt;/code&gt;&lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç®¡ç†ç«¯ç‚¹&lt;/a&gt;å®ç°æ­¤åŠŸèƒ½ã€‚ç®¡ç†ç«¯ç‚¹ç›´æ¥æŸ¥çœ‹å­˜å‚¨åº“ä»¥åŠ è½½æ‰€æœ‰è®¡æ•°å™¨å’Œè®¡é‡å¹¶æ‰“å°å®ƒä»¬ã€‚è¿™ä¸ªç«¯ç‚¹ç›®å‰ä¸è¾“å‡ºä»»ä½•ç›´æ–¹å›¾æ•°æ®ã€‚è¿™åŒæ ·æ˜¯ç”±äºåœ¨å½“å‰çš„å®ç°ä¸­ç›´æ–¹å›¾å€¼æ˜¯ç›´æ¥å†™å…¥æ¥æ”¶å™¨çš„ï¼Œå› æ­¤å­˜å‚¨ä¸çŸ¥é“å®ƒä»¬ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç›´æ–¹å›¾çš„æ¶æ„&#34;&gt;ç›´æ–¹å›¾çš„æ¶æ„&lt;/h3&gt;
&lt;p&gt;æ­£å¦‚å·²ç»å¤šæ¬¡æåˆ°çš„ï¼ŒEnvoy ç›®å‰ä¸ç»´æŠ¤è¿›ç¨‹å†…ç›´æ–¹å›¾æ•°æ®ã€‚é™¤äº†å¼€å‘æ•ˆç‡ä¹‹å¤–ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„åŸå› ï¼›Lyft ä½¿ç”¨çš„ statsd æ‘„å–ç®¡é“æä¾›äº†è‡ªå·±çš„ç›´æ–¹å›¾æ”¯æŒï¼Œå¹¶å¸Œæœ›ç›´æ–¹å›¾å€¼ç›´æ¥å‘é€åˆ°å®ƒã€‚å› æ­¤ï¼Œç›´æ–¹å›¾å€¼ç›®å‰ä¸èƒ½é€šè¿‡ç®¡ç†ç«¯ç‚¹æŸ¥çœ‹ã€‚æœªæ¥æˆ‘ä»¬å¾ˆå¯èƒ½ç›´æ¥åœ¨ Envoy å†…éƒ¨å®ç°&lt;a href=&#34;http://hdrhistogram.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HDR ç›´æ–¹å›¾&lt;/a&gt;ã€‚è¿™ä¸€ç‚¹å°†åœ¨ä¸‹é¢è¿›ä¸€æ­¥è®¨è®ºã€‚&lt;/p&gt;
&lt;h3 id=&#34;çº¿ç¨‹æœ¬åœ°çƒ­é‡å¯çš„èƒ½åŠ›å­˜å‚¨&#34;&gt;çº¿ç¨‹æœ¬åœ°çƒ­é‡å¯çš„èƒ½åŠ›å­˜å‚¨&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸Šæ‰€æœ‰çš„èƒŒæ™¯éƒ½å®Œæˆäº†ï¼Œç°åœ¨æ˜¯æ—¶å€™æ·±å…¥åˆ°æœ‰è¶£çš„éƒ¨åˆ†ï¼šå®è·µä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ&lt;/p&gt;
&lt;h4 id=&#34;ç»Ÿè®¡é¡¹&#34;&gt;ç»Ÿè®¡é¡¹&lt;/h4&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-stats/006tNbRwly1fxv1793dqqj30m8028glv_hua791b4e250871810b193061761fb833d_12383_6d98083552cb528c4a1d6dbfdcd9f63c.webp 400w,
               /blog/envoy-stats/006tNbRwly1fxv1793dqqj30m8028glv_hua791b4e250871810b193061761fb833d_12383_f71d463cbadd00dd010e8b13f78b1d56.webp 760w,
               /blog/envoy-stats/006tNbRwly1fxv1793dqqj30m8028glv_hua791b4e250871810b193061761fb833d_12383_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-stats/006tNbRwly1fxv1793dqqj30m8028glv_hua791b4e250871810b193061761fb833d_12383_6d98083552cb528c4a1d6dbfdcd9f63c.webp&#34;
               width=&#34;760&#34;
               height=&#34;76&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;center&gt;å›¾ 2ï¼šå…±äº«å†…å­˜ä¸­å•ç‹¬çš„è®¡æ•°å™¨/è®¡é‡ç»Ÿè®¡é¡¹&lt;/center&gt;
æ­£å¦‚æˆ‘ä»¬åœ¨[çƒ­é‡å¯æ–‡ç« ](https://medium.com/@mattklein123/envoy-hot-restart-1d16b14555b5)ä¸­å·²ç»è®¨è®ºè¿‡çš„é‚£æ ·ï¼Œæœ€ç»ˆï¼Œæ‰€æœ‰ç»Ÿè®¡æ•°æ®éƒ½å­˜å‚¨åœ¨å…±äº«å†…å­˜ä¸­ï¼Œä»¥ä¾¿å¯ä»¥åœ¨æ‰€æœ‰è¿›ç¨‹ä¸­ä½¿ç”¨å®ƒä»¬ã€‚**å›¾ 2**æ˜¾ç¤ºäº†å•ä¸ª stat æ¡ç›®ã€‚å®ƒç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Name&lt;/strong&gt;ï¼šå®Œå…¨è§£æçš„å±æ€§åï¼Œä¾‹å¦‚&lt;code&gt;http.admin.downstream_cx_active&lt;/code&gt;ã€‚ç›®å‰é™åˆ¶ä¸º 128 ä¸ªå­—ç¬¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Value&lt;/strong&gt;ï¼šå±æ€§çš„å½“å‰å€¼ã€‚è¯¥æ•°æ®åŒ…å«é‡å…·çš„å½“å‰å€¼å’Œè®¡æ•°å™¨çš„å½“å‰æ€»ä»·å€¼ã€‚æ‰€æœ‰çš„æ•°æ®å†™æ“ä½œéƒ½ä½¿ç”¨åŸå­æ“ä½œï¼Œæ‰€ä»¥å®ƒä»¬åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ˜¯å®‰å…¨çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pending increment&lt;/strong&gt;ï¼šæ­¤æ•°æ®ä»…ä¾›è®¡æ•°å™¨ä½¿ç”¨ã€‚é™¤äº†å€¼ä¹‹å¤–ï¼Œæ¯ä¸ªå¢é‡éƒ½æ˜¯åŸå­å¼çš„ã€‚ä¹‹æ‰€ä»¥è¿™æ ·åšï¼Œæ˜¯å› ä¸ºå¤§å¤šæ•°ç»Ÿè®¡æ•°æ®æ¥æ”¶å™¨æƒ³è¦è·å–åˆ·æ–°ä¹‹é—´çš„å¢é‡è€Œä¸æ˜¯æ€»æ•°ã€‚å› æ­¤ï¼Œåœ¨å†²æ´—æœŸé—´è®¡æ•°å™¨æ˜¯é”ä½çš„ã€‚æŒ‚èµ·çš„å¢é‡è¢«å†™å…¥è®¡æ•°å™¨ï¼Œç„¶åå½’é›¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Flags&lt;/strong&gt;ï¼šç›®å‰åªæ”¯æŒæ ‡å¿—&lt;code&gt;used&lt;/code&gt;ã€‚è¿™è¡¨ç¤ºå¦‚æœç»Ÿè®¡æ•°æ®è¢«å†™è¿‡ï¼Œé‚£ä¹ˆä»£ç èƒ½å¤ŸåŒºåˆ†é›¶å’Œä»æœªå†™è¿‡ã€‚Envoy ä¸ä¼šåˆ·æ–°ä»æ¥æ²¡æœ‰ä½¿ç”¨è¿‡çš„ç»Ÿè®¡æ•°æ®ï¼Œä»¥é¿å…å‹å€’æ€§çš„ç»Ÿè®¡åç«¯å¾ˆå°‘ä½¿ç”¨çš„ç»Ÿè®¡æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ref count&lt;/strong&gt;ï¼šRef count å…è®¸é‡å èŒƒå›´ï¼ˆå¯èƒ½åœ¨å¤šä¸ªè¿›ç¨‹ä¸­ï¼‰ä½¿ç”¨ç›¸åŒçš„åº•å±‚ç»Ÿè®¡æ•°æ®ã€‚åªæœ‰å½“ ref è®¡æ•°ä¸º 0 æ—¶ï¼Œæ‰é‡Šæ”¾ç»Ÿè®¡æ•°æ®å†…å­˜ä¾›å°†æ¥ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;å­˜å‚¨-1&#34;&gt;å­˜å‚¨&lt;/h4&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-stats/006tNbRwly1fxv1e9mvjdj30m80f1gn7_huc6e336131a35f9f70bc74bf78bb5141f_46772_442a20ea61210846a144396be03cee10.webp 400w,
               /blog/envoy-stats/006tNbRwly1fxv1e9mvjdj30m80f1gn7_huc6e336131a35f9f70bc74bf78bb5141f_46772_3122d0b8c13add05cdabac45f80cb7fb.webp 760w,
               /blog/envoy-stats/006tNbRwly1fxv1e9mvjdj30m80f1gn7_huc6e336131a35f9f70bc74bf78bb5141f_46772_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-stats/006tNbRwly1fxv1e9mvjdj30m80f1gn7_huc6e336131a35f9f70bc74bf78bb5141f_46772_442a20ea61210846a144396be03cee10.webp&#34;
               width=&#34;760&#34;
               height=&#34;514&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;center&gt;å›¾ 3:çº¿ç¨‹æœ¬åœ°çƒ­é‡å¯æ”¯æŒçš„å­˜å‚¨ä½“ç³»ç»“æ„&lt;/center&gt;
**å›¾ 3** æ˜¾ç¤ºäº† Envoy å†…éƒ¨ä½¿ç”¨çš„çº¿ç¨‹æœ¬åœ° stat å­˜å‚¨çš„è®¾è®¡ã€‚è¿™ä¸ªç‰ˆæœ¬çš„å•†åº—æ»¡è¶³äº†ä¹‹å‰å‘å¸ƒçš„æ‰€æœ‰è®¾è®¡ç›®æ ‡ã€‚ç°åœ¨æˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»å®ƒçš„å·¥ä½œåŸç†ã€‚
&lt;ol&gt;
&lt;li&gt;è¯¥å­˜å‚¨æ˜¯å•ä¾‹å­˜å‚¨ï¼Œæ•´ä¸ª Envoy æµç¨‹éƒ½ä½¿ç”¨å®ƒã€‚æ‰€æœ‰çš„èŒƒå›´ã€è®¡æ•°å™¨å’Œæ ‡å‡†å¼•ç”¨éƒ½æ˜¯ä»è¿™ä¸ªå•ä¾‹ä¸­å¿ƒå­˜å‚¨åº“è·å¾—çš„ã€‚ï¼ˆæœ¬èŠ‚å°†ä¸ä»‹ç»ç›´æ–¹å›¾ï¼Œå› ä¸ºç›®å‰ç›´æ–¹å›¾ä¸é‡è¦ï¼Œç›´æ¥åˆ·æ–°åˆ° TLS ç»Ÿè®¡æ•°æ®æ¥æ”¶å™¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å½“çº¿ç¨‹è¯•å›¾é€šè¿‡ä½œç”¨åŸŸè·å–è®¡æ•°å™¨æˆ–é‡è§„æ—¶ï¼Œå®ƒé¦–å…ˆåœ¨ä½œç”¨åŸŸ TLS ç¼“å­˜ä¸­æŒ‰åç§°æŸ¥æ‰¾è®¡æ•°å™¨æˆ–é‡è§„ã€‚å¦‚æœåœ¨ç¼“å­˜ä¸­æ‰¾åˆ°äº†ç»Ÿè®¡æ•°æ®ï¼Œå®ƒå°†ç«‹å³è¿”å›ç»™è°ƒç”¨è€…ï¼Œè€Œä¸éœ€è¦ä»»ä½•é”å®šã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯¥å±æ€§ï¼Œåˆ™å¿…é¡»ä»èŒƒå›´ä¸­å¤®ç¼“å­˜ä¸­è·å–è¯¥å±æ€§ã€‚&lt;/li&gt;
&lt;li&gt;èŒƒå›´ä¸­å¤®ç¼“å­˜é€šè¿‡æ ‡å‡†è¿›ç¨‹èŒƒå›´å†…çš„äº’æ–¥é”é”å®šï¼ˆåœ¨ç¨³å®šçŠ¶æ€ä¸‹ï¼Œå®ƒä¸åº”è¯¥è¢«é«˜åº¦ç«äº‰ï¼Œå› ä¸ºç»Ÿè®¡ä¿¡æ¯å°†åœ¨èŒƒå›´ TLS ç¼“å­˜ä¸­æ‰¾åˆ°ï¼‰ã€‚å¦‚æœåœ¨ä¸­å¿ƒç¼“å­˜ä¸­æ‰¾åˆ°äº†ç»Ÿè®¡æ•°æ®ï¼Œé‚£ä¹ˆå®ƒå°†è¿”å›åˆ° TLS ç¼“å­˜ï¼Œåœ¨é‚£é‡Œå­˜å‚¨å®ƒä»¥ä¾›ä»¥åæ— é”æŸ¥æ‰¾ã€‚å¦‚æœåœ¨ä¸­å¤®ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°è¯¥å±æ€§ï¼Œåˆ™å¿…é¡»ä»å…±äº«å†…å­˜ä¸­åˆ†é…è¯¥å±æ€§ã€‚&lt;/li&gt;
&lt;li&gt;å…±äº«å†…å­˜åŒ…å«ä¸€ç³»åˆ—å›ºå®šçš„ä¸ªäººç»Ÿè®¡æ¡ç›®ï¼ˆå›¾ 2ï¼‰ã€‚Envoy åŒ…å«ä¸€ä¸ªéå¸¸åŸºæœ¬çš„åˆ†é…å™¨ï¼Œæœç´¢ç»Ÿè®¡æ¡ç›®åç§°ç›¸åŒçš„æ§½ (æ”¯æŒçƒ­é‡å¯å’Œé‡å èŒƒå›´) æˆ–ä¸€ä¸ªç©ºä½ç½®ï¼Œé€‰æ‹©åˆå§‹åŒ–æ§½å¦‚æœç›®å‰ç©ºï¼Œå¢åŠ å¼•ç”¨è®¡æ•°ï¼Œå¹¶è¿”å›å®ƒã€‚è¿™æ˜¯åœ¨çƒ­é‡å¯æœŸé—´è·¨è¿›ç¨‹ç»Ÿè®¡æ•°æ®çš„å·¥ä½œæ–¹å¼ã€‚ä¸¤ä¸ªè¿›ç¨‹éƒ½å°†ä»å…±äº«å†…å­˜ä¸­åˆ†é…ä¸€ä¸ªç»Ÿè®¡æ•°æ®æ¡ç›®æ§½ï¼Œä½†æ˜¯å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹æœ€ç»ˆå°†å¼•ç”¨è®¡æ•°å¢åŠ åˆ°ä¸¤ä¸ªï¼ˆç›¸åŒçš„è¿›ç¨‹åœ¨é‡å ä½œç”¨åŸŸåˆ›å»ºæœŸé—´å‘ç”Ÿï¼‰ã€‚å¦‚æœåœ¨å…±äº«å†…å­˜ä¸­æ‰¾ä¸åˆ°ç©ºé—´ï¼ŒEnvoy å°†å¢åŠ ä¸€ä¸ªâ€œpanicâ€å±æ€§å¹¶è¿”å›ä¸€ä¸ªç‰¹æ®Šçš„æº¢å‡ºå±æ€§æ§½ï¼Œä»¥ä¾¿è¿›ç¨‹å¯ä»¥åœ¨é™çº§çŠ¶æ€ä¸‹ç»§ç»­è¿è¡Œã€‚ä¸€æ—¦ä¸€ä¸ªç»Ÿè®¡æ•°æ®æ§½è¢«åˆ†é…ï¼Œå®ƒå°±è¢«åŒ…è£…åœ¨ä¸€ä¸ªè¿›ç¨‹æœ¬åœ°æ•°æ®ç»“æ„ä¸­ï¼Œå­˜å‚¨åœ¨èŒƒå›´ä¸­å¿ƒç¼“å­˜ä¸­ï¼Œå­˜å‚¨åœ¨èŒƒå›´ TLS ç¼“å­˜ä¸­ï¼Œç„¶åæœ€ç»ˆè¿”å›ç»™è°ƒç”¨è€…ã€‚&lt;/li&gt;
&lt;li&gt;å›æƒ³ä¸€ä¸‹ï¼Œstat å­ç³»ç»Ÿçš„ç›®æ ‡ä¹‹ä¸€æ˜¯ä½¿ä½œç”¨åŸŸå®‰å…¨å¯åˆ é™¤ã€‚ä½œç”¨åŸŸæ˜¯å…¨å±€å¯¹è±¡ï¼Œç”±ä¸»çº¿ç¨‹å’Œå•ä¾‹å­˜å‚¨ç®¡ç†ã€‚åˆ é™¤ä½œç”¨åŸŸæ—¶ï¼Œä¸åŒçº¿ç¨‹ä¸Šçš„ä½œç”¨åŸŸ TLS ç¼“å­˜å¯èƒ½æŒæœ‰å¯¹å•ä¸ªç»Ÿè®¡æ•°æ®çš„å¼•ç”¨ã€‚ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œâ€œä½œç”¨åŸŸç¼“å­˜åˆ·æ–°â€äº‹ä»¶é€šè¿‡ TLS å‘é€åˆ°æ¯ä¸ªçº¿ç¨‹ã€‚çº¿ç¨‹ä½¿ç”¨&lt;a href=&#34;https://medium.com/@mattklein123/envoy-threading-model-a8d44b922310&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çº¿ç¨‹æ¨¡å‹æ–‡ç« &lt;/a&gt;ä¸­æè¿°çš„ç±»ä¼¼ RCU çš„è¡Œä¸ºé‡Šæ”¾æ‰€æœ‰å¯¹ä½œç”¨åŸŸç»Ÿè®¡çš„å¼•ç”¨ã€‚ä¸€æ—¦è®¡æ•°å™¨æˆ–è¡¨çš„æœ€åä¸€æ¬¡å¼•ç”¨è®¡æ•°è¢«å‡å°‘ï¼Œå…±äº«å†…å­˜ç»Ÿè®¡é¡¹æ’æ§½ä¹Ÿè¢«é‡Šæ”¾ã€‚è¿™æ˜¯é€šè¿‡åœ¨ç»Ÿè®¡æ•°æ®æ¡ç›®æ’æ§½ä¸Šå‡å°‘å¼•ç”¨è®¡æ•°æ¥å®Œæˆçš„ã€‚å¦‚æœè¿™ä¸ªå¼•ç”¨è®¡æ•°ç°åœ¨ä¸ºé›¶ï¼Œé‚£ä¹ˆè¿™ä¸ªæ§½å°±è¢«å®Œå…¨é‡Šæ”¾äº†ï¼Œå¹¶ä¸”å¯ä»¥è¢«ä»»ä½•è¿›ç¨‹ç”¨äºä¸€ä¸ªæ–°çš„çŠ¶æ€ã€‚å¦‚æœå‰é¢çš„æè¿°æœ‰ç‚¹æ··ä¹±ï¼Œæ€»ç»“ä¸€ä¸‹ï¼šEnvoy ä¸­çš„æ‰€æœ‰ç»Ÿè®¡æ•°æ®éƒ½ç”±ä¸¤ä¸ªå¼•ç”¨è®¡æ•°æ§åˆ¶ã€‚ç¬¬ä¸€ä¸ªå¼•ç”¨è®¡æ•°ç”¨äºè¿›ç¨‹å†… TLS ç¼“å­˜çš„çŠ¶æ€ï¼Œç¬¬äºŒä¸ªå¼•ç”¨ç”¨äºå¤šä¸ªè¿›ç¨‹å…±äº«çš„å¤‡ä»½çŠ¶æ€å…¥å£æ§½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å›é¡¾ä¸€ä¸‹ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä¸Šé¢çš„è®¾è®¡å¦‚ä½•æ»¡è¶³æ‰€æœ‰çš„åŸå§‹ç›®æ ‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çº¿æ€§ååé‡&lt;/strong&gt;ï¼šåœ¨ç¨³å®šçŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰çš„ç»Ÿè®¡æ•°æ®åˆ†é…éƒ½é€šè¿‡ä½œç”¨åŸŸ TLS ç¼“å­˜è¿›è¡Œã€‚å¯¹äºå¤§é‡çš„å·¥ä½œçº¿ç¨‹æ¥è¯´è¿™è¦æ±‚ä¸èƒ½åŠ é”ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åœ¨çƒ­é‡æ–°å¯åŠ¨æœŸé—´é€»è¾‘ä¸Šæ˜¯ä¸€è‡´çš„&lt;/strong&gt;ï¼šæœ€ç»ˆï¼Œæ‰€æœ‰åŒåçš„æ•°æ®åœ¨å…±äº«å†…å­˜ä¸­ä½¿ç”¨ç›¸åŒçš„å¤‡ä»½å­˜å‚¨ã€‚è¿™åœ¨æµç¨‹ä¹‹é—´åˆ›å»ºäº†é€»è¾‘ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿè®¡æ•°æ®åŒ…å«åœ¨ä¸€ä¸ªä½œç”¨åŸŸå†…ï¼Œå¯ä»¥ä½œä¸ºä¸€ä¸ªç»„é‡Šæ”¾ï¼Œä¹Ÿå¯ä»¥é‡å &lt;/strong&gt;ï¼šä½œç”¨åŸŸå…·æœ‰å®Œå…¨ç‹¬ç«‹çš„ä¸­å¤®ç¼“å­˜å’Œ TLS ç¼“å­˜ï¼Œä»¥åŠç‹¬ç«‹çš„æ¯ä¸ªç»Ÿè®¡æ•°æ®å¼•ç”¨è®¡æ•°ã€‚ä¸€ä¸ªä½œç”¨åŸŸå¯ä»¥è¢«ç§»é™¤ï¼Œå¹¶ä¸”å®ƒçš„æ‰€æœ‰ç»Ÿè®¡æ•°æ®çš„å¼•ç”¨è®¡æ•°å°†ä¼šå‡å°‘ï¼Œå¹¶ä¸”å¯èƒ½ä¼šè¢«é‡Šæ”¾ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¶³å¤Ÿçš„åŠ¨æ€ç»Ÿè®¡æ•°æ®æ€§èƒ½&lt;/strong&gt;ï¼šé€šè¿‡èŒƒå›´ TLS ç¼“å­˜æŸ¥æ‰¾åŠ¨æ€ç»Ÿè®¡æ•°æ®å¹¶ä½¿ç”¨ O(1) å“ˆå¸Œè¡¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æœªæ¥çš„å·¥ä½œ&#34;&gt;æœªæ¥çš„å·¥ä½œ&lt;/h2&gt;
&lt;p&gt;è™½ç„¶ Envoystats å­ç³»ç»Ÿå·¥ä½œå¾—å¾ˆå¥½ï¼Œä½†æ˜¯æœ‰å‡ ä¸ªæ–¹é¢åœ¨æœªæ¥å¯ä»¥æ”¹è¿›ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»´åº¦/æ ‡è®°çŠ¶æ€:&lt;/strong&gt; å¤§å¤šæ•°æ›´æ–°çš„çŠ¶æ€åç«¯æ”¯æŒç»´åº¦/æ ‡è®°ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ‰å¹³çš„å±‚æ¬¡å‘½åç©ºé—´ã€‚åœ¨ç‰¹ä½¿ç»Ÿè®¡æ•°æ®çš„æŸäº›åŒºåŸŸä¸­ï¼Œè¿™æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚çŸ­æœŸè€Œè¨€ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ·»åŠ å…¨çƒæ ‡è®°æ”¯æŒï¼Œä½œä¸ºæ”¯æŒå®ƒçš„åç«¯ï¼ˆå¦‚Prometheusã€Wavefrontå’Œæµæ„Ÿæ•°æ®åº“ï¼‰çš„ç¬¬ä¸€æ­¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹æœ¬åœ°åŸå­ç¼“å­˜ï¼š&lt;/strong&gt; åœ¨ worker æ•°é‡å’Œååé‡æé«˜çš„æƒ…å†µä¸‹ï¼Œå•ä¸ª stat å€¼ä¸Šçš„åŸå­äº‰ç”¨å°†æˆä¸ºä¸€ä¸ªé—®é¢˜ã€‚è¿™å¯ä»¥é€šè¿‡ç§»åŠ¨åˆ° TLS è®¡æ•°å™¨å’Œå‹åŠ›è¡¨æ¥è§£å†³ï¼Œè¿™äº›è®¡æ•°å™¨å’Œå‹åŠ›è¡¨åœ¨å†²æ´—ä¹‹å‰è¢«èšé›†åˆ°ä¸­å¤®å­˜å‚¨ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…ç½®çš„ HDR ç›´æ–¹å›¾ï¼š&lt;/strong&gt; ç”±äºå‡ ä¸ªåŸå› ï¼ˆç®¡ç†è¾“å‡ºã€åŸºäºå¼‚å¸¸å€¼çš„å»¶è¿Ÿæ£€æµ‹å’Œæ²¡æœ‰å†…ç½®ç›´æ–¹å›¾æ”¯æŒçš„æ¥æ”¶å™¨ï¼‰ï¼Œå‘ Envoy æ·»åŠ ç›´æ¥çš„ HDR ç›´æ–¹å›¾æ”¯æŒå°†éå¸¸æœ‰ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¢å¤–çš„é™æ€æ¥æ”¶å™¨ï¼š&lt;/strong&gt; å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬å¸Œæœ›ç›´æ¥æ”¯æŒæ›´å¤šçš„åç«¯ï¼Œå¦‚ Prometheusã€Wavefrontã€InfluxDB ç­‰ã€‚å¹¸è¿çš„æ˜¯ï¼Œæ¥æ”¶å™¨æ¥å£å¾ˆç®€å•ï¼Œæ·»åŠ æ–°çš„å®ç°å¹¶ä¸å›°éš¾ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†æ»¡è¶³ä¸Šè¿°ç›®æ ‡ï¼ŒEnvoy çš„æ•°æ®ç»Ÿè®¡å­ç³»ç»Ÿçš„è®¾è®¡æ˜¯æ–°é¢–çš„ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®ƒåœ¨å®è·µä¸­è¡¨ç°å¾—éå¸¸å¥½ï¼Œå¯¹äºå…¶ä»–ç”¨ä¾‹æ¥è¯´ï¼Œæ‰©å±•èµ·æ¥åº”è¯¥ç›¸å¯¹å®¹æ˜“ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»£ç é“¾æ¥&#34;&gt;ä»£ç é“¾æ¥&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ä¸€äº›æ¥å£åŠå®ç°çš„å¤´æ–‡ä»¶è¯·å‚è€ƒä¸‹é¢é“¾æ¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/envoyproxy/envoy/blob/master/include/envoy/stats/stats.h&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/envoyproxy/envoy/blob/master/include/envoy/stats/stats.h&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/envoyproxy/envoy/tree/master/source/common/stats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/envoyproxy/envoy/tree/master/source/common/stats&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Istio å’Œ Envoy å®è·µæœåŠ¡ç½‘æ ¼ gRPC åº¦é‡</title>
      <link>https://cloudnative.to/blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/</link>
      <pubDate>Tue, 27 Nov 2018 19:09:15 +0800</pubDate>
      <guid>https://cloudnative.to/blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://medium.com/pismolabs/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice-d67a08acd8f7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªä»¤äººæƒŠå¥‡çš„æ—¶ä»£ï¼Œæˆ‘ä»¬å¯ä»¥ä¸éœ€è¦ç¼–å†™ä¸€è¡Œä»£ç ï¼Œä¾¿å¯ä»¥å¾ˆæ™ºèƒ½çš„é›†æˆåº”ç”¨ç¨‹åºï¼Œæ”¶é›†åº”ç”¨ç¨‹åºæŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†æ¼”ç¤ºä½¿ç”¨ helm å®‰è£… Istio mtls ç¯å¢ƒã€å¿…è¦çš„ yamls é…ç½®ä»¥åŠå®‰è£… Istio å¸¦æ¥çš„å…¶ä»–æ”¶è·ã€‚å¦å¤–ï¼Œåœ¨æ–‡ç« æœ€åï¼Œæˆ‘è¿˜ä¼šå±•ç¤ºè·¯ç”±é…ç½®çš„ä¸€äº›ä¾‹å­ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾ä½ å·²ç»å®‰è£…å¥½ Kubernetes å’Œ helmï¼Œå¹¶ä¸”å¯¹ä»–ä»¬éƒ½æœ‰ä¸€å®šçš„äº†è§£ã€‚æœ¬æ•™ç¨‹å°†ä»¥ AWS ä½œä¸ºæˆ‘ä»¬çš„è¿è¡Œç¯å¢ƒã€‚è¯·å‚è€ƒå®˜æ–¹å®‰è£…æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/docs/setup/kubernetes/helm-install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/docs/setup/kubernetes/helm-install/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ Istio çš„å®˜æ–¹æ‹“æ‰‘å›¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymh3xq3ij30z00o6abc_hubbcc6cd1be8fce3ebba87367d55ef4e6_63507_262332ae69e387499768627ef57f4764.webp 400w,
               /blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymh3xq3ij30z00o6abc_hubbcc6cd1be8fce3ebba87367d55ef4e6_63507_8026208d92e8517409d625f75bd19239.webp 760w,
               /blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymh3xq3ij30z00o6abc_hubbcc6cd1be8fce3ebba87367d55ef4e6_63507_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymh3xq3ij30z00o6abc_hubbcc6cd1be8fce3ebba87367d55ef4e6_63507_262332ae69e387499768627ef57f4764.webp&#34;
               width=&#34;760&#34;
               height=&#34;524&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é€šè¿‡æˆ‘ä»¬çš„è®¾ç½®ï¼Œæ‰€æœ‰çš„å®¹å™¨ä¼šè¿åŒä¸€ä¸ª istio-proxy ä¸€èµ·åˆ›å»ºå¹¶éƒ¨ç½²åˆ° istio-injected çš„å‘½åç©ºé—´ä¸­ã€‚åº”ç”¨ç¨‹åºå°†ä¸ istio-proxy (envoy) è¿›è¡Œé€šä¿¡ï¼Œç„¶ååè€…å°†å¤„ç†æ‰€æœ‰çš„é“¾æ¥ã€mtls ä»¥åŠå…¶ä»–åº”ç”¨ç¨‹åºçš„è´Ÿè½½å‡è¡¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…ä»¥åŠé…ç½®&#34;&gt;å®‰è£…ä»¥åŠé…ç½®&lt;/h2&gt;
&lt;p&gt;å¼€å§‹æ­¥éª¤ï¼Œä¸‹è½½å¹¶è§£å‹ istio-1.0.0 å®‰è£…åŒ…&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wget https://github.com/istio/istio/archive/1.0.0.zip&lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; unzip 1.0.0.zip
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¿®æ”¹ istio ç›®å½•ä¸‹çš„ values.yaml æ–‡ä»¶ï¼Œä¿®æ”¹ç¯å¢ƒéœ€è¦çš„è®¾ç½®&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-1.0.0/install/kubernetes/helm/istio/values.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸‹ä¿®æ”¹å°†ä½¿ istio ingressgateway çš„ mtlsã€ingressï¼ˆç”¨äºç›‘æ§æœåŠ¡ï¼‰å’Œ ssl ç«¯å£ï¼ˆ443ï¼‰é‡å®šå‘åˆ° 80 ç«¯å£ï¼Œå¹¶æ”¯æŒæ’ä»¶åˆ°å®‰è£…ï¼ˆgrafana, servicegraph, jaeger and kialiï¼‰ï¼š
è·å–ä¿®æ”¹ååˆ° values.yaml æ–‡ä»¶ï¼Œ&lt;a href=&#34;https://gist.github.com/Stocco/63077eab8cfd116aeb591fdb9958413c&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¤ºä¾‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹å®Œæˆåï¼Œå®‰è£…æ‰€æœ‰çš„ç¨‹åºå¹¶æŸ¥çœ‹ Istio è¿è¡Œæƒ…å†µï¼&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œå¦‚æœä½¿ç”¨ 2.10.0 ä¹‹å‰çš„ Helm ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡ kubectl apply å®‰è£… Istio çš„&lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#customresourcedefinitions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªå®šä¹‰èµ„æº&lt;/a&gt;ï¼›å¦‚æœä¸æ˜¯è¿™ç±»ç‰ˆæœ¬ï¼Œè¯·è·³è¿‡æ­¤æ­¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f istio-1.0.0/install/kubernetes/helm/istio/templates/crds.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f istio-1.0.0/install/kubernetes/helm/istio/charts/certmanager/templates/crds.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®‰è£… Istio (&lt;strong&gt;è¯·ä½¿ç”¨æˆ‘ä»¬è°ƒæ•´è¿‡çš„ values.yaml æ–‡ä»¶&lt;/strong&gt;)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm install istio-1.0.0/install/kubernetes/helm/istio --name istio --namespace istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ£€æŸ¥ä½ çš„ istio-system å‘½åç©ºé—´ï¼Œå¹¶æŸ¥çœ‹ pods æ˜¯å¦å¯ä»¥å±•ç¤ºå‡ºæ¥ï¼åŒæ—¶ä¸ºä½ çš„åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªå‘½åç©ºé—´ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create namespace istio-apps
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å¯ä»¥ä¸ºå®ƒåŠ ä¸Šæ ‡ç­¾ï¼Œè®© Istio çŸ¥é“åœ¨å“ªé‡Œæ³¨å…¥ istio-proxiesã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace istio-apps istio-injection&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;enabled
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬çš„ç¯å¢ƒå·²ç»è¿è¡Œèµ·æ¥ï¼Œè®©æˆ‘ä»¬æ€è€ƒä¸€ä¸‹åº”ç”¨ç¨‹åºæ˜¯å¦‚ä½•ç›¸äº’é€šä¿¡çš„ã€‚åœ¨ç½‘æ ¼ä¸­çš„æœåŠ¡é€šè¿‡ envoy æ¥å¤„ç†åŒå‘é€šè¡Œå’Œè´Ÿè½½å‡è¡¡ä»¥è¾¾åˆ°æœåŠ¡é—´ç›¸äº’é€šä¿¡ã€‚é‚£äº›ä¸åœ¨ç½‘æ ¼ä¸­çš„æœåŠ¡è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿä½ å¯èƒ½æƒ³çŸ¥é“ä»–ä»¬å¦‚ä½•ä¸æˆ‘ä»¬çš„æœåŠ¡è¿›è¡Œæ²Ÿé€šï¼Œæˆ‘ä»¬çš„æœåŠ¡å¦‚ä½•ä¸ç½‘æ ¼å¤–éƒ¨çš„æœåŠ¡è¿›è¡Œé€šä¿¡ã€‚è¿™å°±æ˜¯æˆ‘ä»¬é…ç½®å…¥å£çš„åœ°æ–¹ã€‚ä¸‹å›¾å°†è¯´æ˜å¤–éƒ¨æœåŠ¡å¦‚ä½•ä¸ç½‘æ ¼å†…çš„åº”ç”¨è¿›è¡Œè”ç³»çš„ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymltt2dxj31ff0quq4b_hu1a2dfb6024ad4c6ac62ec7bef41e8c37_42745_f2de08981ecc6ad477c0bb4cb3062a20.webp 400w,
               /blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymltt2dxj31ff0quq4b_hu1a2dfb6024ad4c6ac62ec7bef41e8c37_42745_3213184f192b22c5fc98413fdd123e50.webp 760w,
               /blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymltt2dxj31ff0quq4b_hu1a2dfb6024ad4c6ac62ec7bef41e8c37_42745_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymltt2dxj31ff0quq4b_hu1a2dfb6024ad4c6ac62ec7bef41e8c37_42745_f2de08981ecc6ad477c0bb4cb3062a20.webp&#34;
               width=&#34;760&#34;
               height=&#34;397&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰å¤–éƒ¨çš„æµé‡å°†é€šè¿‡ Istio-ingressgateway è¿›å…¥ç½‘æ ¼ä¸­ï¼ŒIstio-ingressgateway ä¼šå°è¯•æŸ¥æ‰¾ç½‘æ ¼å†…ä¸»æœºä¸è·¯å¾„åŒ¹é…ä¸€è‡´çš„è™šæ‹ŸæœåŠ¡ã€‚å¦‚æœæœªæŸ¥æ‰¾åˆ°åŒ¹é…çš„è™šæ‹ŸæœåŠ¡ï¼Œåˆ™å¤–éƒ¨æœåŠ¡å°†è®¿é—®ä¸åˆ°ç½‘æ ¼å†…çš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æç¤ºï¼šæ­£æ˜¯å› ä¸ºè¿™æ ·çš„è™šæ‹ŸæœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥åšåˆ°æµé‡çš„ç®¡ç†ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äºç½‘æ ¼ä¸­çš„æœåŠ¡éœ€è¦è®¿é—®å¤–éƒ¨çš„æœåŠ¡ï¼Œä¾‹å¦‚ï¼šè®¿é—®é•œåƒä¸­çš„å­˜å‚¨åº”ç”¨ï¼Œä½ è¿˜éœ€è¦åšè™šæ‹ŸæœåŠ¡çš„æµé‡æ˜ å°„ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ yaml æ–‡ä»¶ï¼ˆä¹Ÿå¯ä»¥æŒ‡å®š ipsï¼‰è®¿é—®ç½‘æ ¼ä¸­çš„æ‰€æœ‰ä¸»æœºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceEntry&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;allhosts-serviceentry&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-apps&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3306&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬éœ€è¦ç¡®ä¿ istio-ingressgateway å·²ç»æ˜ å°„å…¥ istio-apps çš„å‘½åç©ºé—´ä¸­ã€‚é¦–å…ˆï¼Œæ£€æŸ¥ä½ çš„ istio-ingressgateway æœåŠ¡ï¼Œå¹¶æŒ‡å‘ç”±è¯¥æœåŠ¡åˆ›å»ºçš„è´Ÿè½½å‡è¡¡å™¨çš„åŸŸåã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„ yaml é…ç½®æ˜ å°„ä½ çš„åŸŸååˆ° istio-ingressgatewayï¼Œæ•™ç¨‹ä¸­æˆ‘ä»¬ä½¿ç”¨ *.yourdomainã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦ä¸€ä¸ªä¸ªçš„æ˜ å°„ä½ çš„ä¸»æœºï¼ˆè¿™æ­¥æ“ä½œéœ€è¦èŠ±è´¹ä¸€äº›æ—¶é—´æ‰èƒ½ç”Ÿæ•ˆï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-apps&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*.yourdomain&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;PASSTHROUGH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*.yourdomain&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å¯ä»¥å‡†å¤‡æµ‹è¯•æˆ‘ä»¬çš„ç¯å¢ƒäº†ã€‚æˆ‘å·²ç»ä½¿ç”¨ http(8080)/grpc(8333) åˆ›å»ºäº†ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œåœ¨æµ‹è¯•ç¯å¢ƒè°ƒç”¨ç¬¬äºŒä¸ªåº”ç”¨ç¨‹åºã€‚åŒæ—¶åˆ›å»ºäº†ä¸€ä¸ªéƒ¨ç½²æœåŠ¡çš„æ–‡ä»¶æ¥å¯åŠ¨æµ‹è¯•ã€‚è¯·å¤åˆ¶ä¸‹é¢çš„ yaml æ–‡ä»¶å¹¶åº”ç”¨åˆ°ä½ çš„ç¯å¢ƒä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;pismotest/istio-application:v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-port&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8333&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-port&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-port&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8333&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8333&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;applicationtwo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;applicationtwo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;applicationtwo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;applicationtwo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;pismotest/istio-application:v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-port&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8333&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-port&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;applicationtwo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-port&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8333&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8333&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;applicationtwo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;use kubectl apply -f applications.yaml -n istio-apps
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºæˆ‘ä»¬çš„è™šæ‹ŸæœåŠ¡æ¥æ˜ å°„åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå·²ä¾¿ istio-ingressgateway å¯ä»¥å°†æµé‡è·¯ç”±åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼ˆ&lt;strong&gt;ä¿®æ”¹é…ç½®ä¸­çš„ application.yourdomain ä¿®æ”¹ä¸ºä½ çš„åŸŸå&lt;/strong&gt;ï¼‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application-ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-apps&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;application.yourdomain&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/health&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;retries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;attempts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;perTryTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8333&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;retries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;attempts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;perTryTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è™šæ‹ŸæœåŠ¡å°†ä¸»æœºæ˜ å°„åˆ°ä»»ä½•ä½ æƒ³åŒ¹é…çš„æœåŠ¡ä¸Šï¼Œåœ¨ç¤ºä¾‹ä¸­ï¼Œç¬¬ä¸€æ¡è§„åˆ™æ˜¯åŒ¹é…åˆ°æœåŠ¡ http å¥åº·ç«¯ç‚¹ï¼Œå¦‚æœåŒ¹é…å¤±è´¥å°†è·³è½¬åˆ° grpc æœåŠ¡ç«¯å£ä¸Šã€‚åœ¨é‡è¯•çš„éƒ¨åˆ†å¯ä»¥å¸®åŠ©æˆ‘ä»¬çŸ¥é“ç½‘ç»œæ˜¯å¦æœ‰å¹²æ‰°æˆ–æœ‰ä¸å¥åº·çš„ Podsã€‚ä½ å¯ä»¥æ·»åŠ æ›´å¤šä½ éœ€è¦çš„åŒ¹é…é¡¹ï¼Œé€šè¿‡è¿™äº›è§„åˆ™å¯ä»¥å°†ä»»ä½•å½¢å¼çš„è¯·æ±‚åŒ¹é…åˆ°ä¸»æœºä¸Šï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;.+&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥å°è¯•ä¸€ä¸‹æ–¹å¼è®¿é—® /health ç«¯ç‚¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --request GET &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --url http://application.yourdomain/health
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å°†æ¥æ”¶åˆ° 200ï¼ŒåŒæ—¶ä½ çš„åº”ç”¨ä¹Ÿä¼šè®°å½•æ¥å—åˆ°çš„è¯·æ±‚ã€‚&lt;strong&gt;å¦‚æœä½ æ¥æ”¶åˆ° 404ï¼Œå¯èƒ½æ˜¯ä½ çš„è™šæ‹ŸæœåŠ¡æ²¡æœ‰å°†ä½ çš„è¯·æ±‚åœ°å€æ˜ å°„åˆ°ä½ çš„æœåŠ¡ä¸Š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¯·å°è¯•å¦‚ä¸‹æ–¹å¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --request GET &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --url http://application.yourdomain/health &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --header &lt;span class=&#34;s1&#34;&gt;&amp;#39;propagate: yes&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ çš„åº”ç”¨ç¨‹åºä¼šè¯·æ±‚ç¬¬äºŒä¸ªåº”ç”¨ç¨‹åºï¼Œè¯·æ£€æŸ¥åº”ç”¨ç¨‹åºäºŒçš„æ—¥å¿—è®°å½•ã€‚&lt;/p&gt;
&lt;p&gt;Istio ä¹Ÿå¯ä»¥ä½¿ç”¨åŒæ ·çš„è§„åˆ™æ˜ å°„ grpc è¯·æ±‚ã€‚å¤åˆ¶åº”ç”¨ç¨‹åºä»“åº“å¹¶ä½¿ç”¨åŒæ ·çš„æ–¹å¼åˆ›å»ºåº”ç”¨ï¼Œä¿®æ”¹ main.go ä¸­çš„åŸŸååœ°å€å¹¶è¿›è¡Œå°è¯•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Stocco/istioapplications&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/Stocco/istioapplications&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç½‘æ ¼çš„å¯è§†åŒ–åº¦é‡&#34;&gt;ç½‘æ ¼çš„å¯è§†åŒ–åº¦é‡&lt;/h2&gt;
&lt;p&gt;æœ‰å¾ˆå¤šæ–¹æ³•æ¥å¯è§†åŒ–ç½‘æ ¼ä¸­çš„å†…å®¹ï¼Œæˆ‘å°†åœ¨æœ¬èŠ‚ä¸­åˆ—ä¸¾å‡ ç§ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼ŒIstio å°†æ”¶é›†æ‰€æœ‰éœ€è¦çš„åº¦é‡å‚æ•°æ¥ç»˜åˆ¶ç›‘æ§å›¾å½¢å’Œå¯¹è±¡ï¼Œä½†æ˜¯å¯¹äºåƒ &lt;strong&gt;Kiali å’Œ Jaeger&lt;/strong&gt; è¿™æ ·çš„åº¦é‡æœåŠ¡ï¼Œä½ éœ€è¦ç¡®ä¿åº”ç”¨ç¨‹åºå¯ä»¥ä¼ æ’­ Istio injected çš„è¯·æ±‚å¤´ï¼Œè¿™æ ·å°±å¯ä»¥å°†åº”ç”¨ç¨‹åºçš„è¯·æ±‚å†å²è¿æ¥èµ·æ¥ã€‚&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥åº”ç”¨ç¨‹åºå¤„ç†å¥åº·åŠŸèƒ½çš„ç¤ºä¾‹ï¼š
&lt;a href=&#34;https://github.com/Stocco/istioapplications/blob/a3c3275a63a0667f870d054ea5940284b8a100af/main.go#L72&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/Stocco/istioapplications/blob/a3c3275a63a0667f870d054ea5940284b8a100af/main.go#L72&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;kiali&#34;&gt;Kiali&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Kiali&lt;/strong&gt; å¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£å®æ—¶å‘ç”Ÿçš„äº‹æƒ…ã€‚å°† kiali ç«¯å£æš´éœ²åˆ°æœ¬åœ°ï¼Œè¿™æ ·å°±å¯ä»¥æŸ¥çœ‹åº”ç”¨ç¨‹åºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system port-forward &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl -n istio-system get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kiali -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; 20001:20001
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç‚¹å‡»é“¾æ¥å¹¶ä½¿ç”¨ admin(username)/admin(password) ç™»å½•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;http://localhost:20001/console/service-graph/istio-apps?layout&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;cose-bilkent&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;duration&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10800&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;edges&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;responseTime95thPercentile&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;graphType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;versionedApp
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç•Œé¢ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymwetflpj31es0opmy8_hu547942b944d19223cf37f93118a32429_28992_c344e363ef610fbb994ab7cae0e1bd29.webp 400w,
               /blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymwetflpj31es0opmy8_hu547942b944d19223cf37f93118a32429_28992_92685467325495852f787767fbddf166.webp 760w,
               /blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymwetflpj31es0opmy8_hu547942b944d19223cf37f93118a32429_28992_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymwetflpj31es0opmy8_hu547942b944d19223cf37f93118a32429_28992_c344e363ef610fbb994ab7cae0e1bd29.webp&#34;
               width=&#34;760&#34;
               height=&#34;369&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™æ ·å°±æˆåŠŸäº†ï¼ŒKiali è¿˜æœ‰å¾ˆå¤šå·¥å…·æœ‰å¾…æŒ–æ˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;jaeger&#34;&gt;&lt;strong&gt;Jaeger&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;Jaeger æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ç›‘æ§å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥ç›‘å¬è¯·æ±‚åˆ°æ‰§è¡Œæƒ…å†µä»¥åŠè¯·æ±‚åœ¨æ¯ä¸ªéƒ¨åˆ†ä¸­æ‰§è¡Œçš„æ—¶é•¿ã€‚ä½†æ˜¯ï¼Œä½ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ éœ€è¦ä½¿ç”¨å®ƒæ›´å¤šçš„æ½œåœ¨åŠŸèƒ½ï¼Œä½ éœ€è¦é€‚å½“çš„è°ƒæ•´ä½ çš„ä»£ç æ¥ä¼ æ’­ Istio injected çš„å¤´ã€‚å¦‚æœä½ éœ€è¦äº†è§£æ›´å¤šå…³äºè¯·æ±‚çš„ä¿¡æ¯ï¼Œä½ éœ€è¦ä½¿ç”¨ä¸€äº›å·¥å…·ï¼ˆä¾‹å¦‚ï¼šopentracingï¼‰æ¥è·å–åº”ç”¨ç¨‹åºå†…éƒ¨åŠŸèƒ½è°ƒç”¨çš„åº¦é‡æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;æš´éœ² jaeger ç«¯å£å’Œè®¿é—®æƒé™ &lt;a href=&#34;http://localhost:16686&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:16686&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl port-forward -n istio-system &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -n istio-system -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;jaeger -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; 16686:16686
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymxngfikj31eb0o940d_hu81e963270880d013c1a3e306b71bc44f_46072_031ad03ab5d89611f377d9d8d4c27f11.webp 400w,
               /blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymxngfikj31eb0o940d_hu81e963270880d013c1a3e306b71bc44f_46072_2bc40606356d8a257f76cd5a6ad1732c.webp 760w,
               /blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymxngfikj31eb0o940d_hu81e963270880d013c1a3e306b71bc44f_46072_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymxngfikj31eb0o940d_hu81e963270880d013c1a3e306b71bc44f_46072_031ad03ab5d89611f377d9d8d4c27f11.webp&#34;
               width=&#34;760&#34;
               height=&#34;366&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨å·¦è¾¹çš„ç•Œé¢ä¸­æœ‰ä¸€äº›è¿‡æ»¤æ¡ä»¶ï¼Œé€‰æ‹©ä½ éœ€è¦çš„æ¡ä»¶ï¼Œä½ å¯ä»¥é€šè¿‡ç‚¹å‡»æŸ¥æ‰¾åˆ°çš„æ•°æ®æŸ¥çœ‹æœ€æ–°çš„è·Ÿè¸ªè·¯å¾„ã€‚é€‰æ‹©ä¸€æ¡è·Ÿè¸ªè·¯å¾„ï¼Œä½ å¯ä»¥æŸ¥çœ‹åˆ°åº”ç”¨ç¨‹åºä¸­æ¯ä¸€ä¸ªè¯·æ±‚çš„æ‰€æ¶ˆè€—çš„å‡†ç¡®æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymxyb2c7j31ez0i9taf_huce0b2aff10ced3bfa70e3f9719d2672f_40408_bb621ce2b41eba5a2c67f4a415a7b433.webp 400w,
               /blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymxyb2c7j31ez0i9taf_huce0b2aff10ced3bfa70e3f9719d2672f_40408_8ea713a635eaa154778fe0f0f73dc036.webp 760w,
               /blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymxyb2c7j31ez0i9taf_huce0b2aff10ced3bfa70e3f9719d2672f_40408_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/006tNbRwgy1fwymxyb2c7j31ez0i9taf_huce0b2aff10ced3bfa70e3f9719d2672f_40408_bb621ce2b41eba5a2c67f4a415a7b433.webp&#34;
               width=&#34;760&#34;
               height=&#34;272&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚æœåœ¨åº”ç”¨ç¨‹åºä¸­å®‰è£…äº† opentracing å¹¶åœ¨æ¯ä¸ªåŠŸèƒ½è°ƒç”¨çš„åœ°æ–¹éƒ½ä½¿ç”¨åˆ°äº†ï¼Œåˆ™ä¼šæœ‰æ›´å¥½çš„ä½“éªŒã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ›´å¤šçš„åº¦é‡å·¥å…·&#34;&gt;æ›´å¤šçš„åº¦é‡å·¥å…·&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æœ‰ 3 ä¸ªåº”ç”¨ç¨‹åºé€šè¿‡ values.yaml å·²ç»å®‰è£…å¥½äº†ï¼Œå¹¶ä½¿ç”¨ Istio æ”¶é›†äº†éœ€è¦åº¦é‡çš„æ•°æ®ã€‚å°è¯•ä½¿ç”¨ grafanaï¼Œprometheus å’Œ servicegraph æ£€æŸ¥åº”ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸€ä¸‹å‘½ä»¤æš´éœ²åº”ç”¨ç¨‹åºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system port-forward &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl -n istio-system get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;prometheus -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; 9090:9090
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system port-forward &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl -n istio-system get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;grafana -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; 3000:3000 &lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system port-forward &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl -n istio-system get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;servicegraph -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; 8088:8088 &lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; æç¤ºï¼š
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    æœ¬æ•™ç¨‹ä¸­ grafana ç™»å½•/å¯†ç  æ˜¯ admin/adminï¼ˆå¯ä»¥åœ¨ values.yaml ä¿®æ”¹ä»–ä»¬ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªåœ°å€æŸ¥çœ‹ servicegraphï¼š
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    http://localhost:8088/force/forcegraph.html?time_horizon&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;3000s&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;filter_empty&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ™ºèƒ½è·¯ç”±&#34;&gt;æ™ºèƒ½è·¯ç”±&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ å¯ä»¥ç®¡ç†åº”ç”¨ç¨‹åºçš„ç‰ˆæœ¬ï¼ŸIstio å¯ä»¥ä¸º virtualservice.yaml æä¾›å¾®å°çš„ä¿®æ”¹ã€‚è®©æˆ‘ä»¬æ¥è°ƒæ•´æˆ‘ä»¬çš„è™šæ‹ŸæœåŠ¡ï¼ˆ&lt;strong&gt;ä¿®æ”¹ application.yourdomain ä¸ºä½ çš„åº”ç”¨ç¨‹åºå&lt;/strong&gt;ï¼‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application-ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-apps&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;application.yourdomain&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;myself&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;yourself&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;applicationtwo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/health&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;retries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;attempts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;perTryTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8333&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;retries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;attempts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;perTryTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1s  &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§„åˆ™éµå¾ªä¼˜å…ˆé¡ºåºã€‚ç°åœ¨å¯ä»¥ä½¿ç”¨å‰ä¸€ç« èŠ‚ä¸­ç»™çš„ curl å‘½ä»¤ï¼Œå¹¶å°†å¤´æ”¾åˆ°ç¬¬ä¸€æ¡è§„åˆ™ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --request GET &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --url http://application.pismolabs.io/health &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --header &lt;span class=&#34;s1&#34;&gt;&amp;#39;myself: yourself&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥ä»ç¬¬äºŒä¸ªåº”ç”¨ç¨‹åºä¸­æŸ¥çœ‹åˆ°æ—¥å¿—ï¼Œè€Œä¸æ˜¯åœ¨ç¬¬ä¸€ä¸ªç¨‹åºï¼è¿™æ˜¯å› ä¸ºç¬¬ä¸€æ¡è§„åˆ™åŒ¹é…åˆ°äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;grpc-ssl-ç›®æ ‡è§„åˆ™&#34;&gt;Grpc ssl ç›®æ ‡è§„åˆ™&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ åœ¨å·¥ä½œä¸­ä½¿ç”¨è¿‡ grpcï¼Œä½ çŸ¥é“å°† ssl åº”ç”¨åˆ° grpc è°ƒç”¨æ—¶ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ã€‚ä¸»è¦æ˜¯å› ä¸ºä½ éœ€è¦å°†æœåŠ¡æœåŠ¡å™¨çš„è¯ä¹¦æ”¾å…¥åˆ°ä»£ç ä¸­æ‰èƒ½ä½¿ ssl ç®¡é“ç”Ÿæ•ˆã€‚å¦‚ä½•åœ¨åŸºç¡€è®¾ç½®ä¸­è®¾ç½®ä¸€äº›é…ç½®è¾¾åˆ°è¿™æ ·çš„è°ƒç”¨ç›®æ ‡å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å°è¯•ä¸ºä½ çš„åŸŸååˆ›å»ºæœåŠ¡æ¡ç›®å’Œç›®æ ‡è§„åˆ™ï¼Œå¹¶æŸ¥çœ‹ä½ çš„é ssl åº”ç”¨ç¨‹åºå¯¹å¤–éƒ¨ grpc æœåŠ¡è¿›è¡Œäº†åŠ å¯†çš„è°ƒç”¨ï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceEntry&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;external-grpc-service-entry&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;application.yourdomain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8333&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-ssl&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;GRPC&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;originate-tls-grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application.yourdomain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;loadBalancer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;simple&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ROUND_ROBIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;portLevelSettings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8333&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SIMPLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰å¾ˆå¤šçš„æœåŠ¡æ¡ç›®å’Œç›®æ ‡è§„åˆ™é€‰é¡¹ï¼Œä½ å¯ä»¥å°†ä»–ä»¬ç»“åˆèµ·æ¥ä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºæ›´ä¸°å¯Œçš„ç¯å¢ƒã€‚ä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„åœ°å€æŸ¥çœ‹æ›´å¤šçš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;https://istio.io/docs/reference/config/istio.networking.v1alpha3/#DestinationRule
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æˆ‘ä»¬åªæ˜¯åˆå‡ºèŒ…åº&#34;&gt;æˆ‘ä»¬åªæ˜¯åˆå‡ºèŒ…åº&lt;/h2&gt;
&lt;p&gt;ç¥è´ºä½ ï¼Œä½ å·²ç»è·å¾—äº†ç¬¬ä¸€ä¸ª Istio ç¯å¢ƒåº”ç”¨ç¨‹åºã€‚ç°åœ¨ï¼Œå¯ä»¥å°è¯•å°†æˆ‘çš„ deployment.yaml æ›¿æ¢æˆä½ è‡ªå·±çš„åº”ç”¨ç¨‹åºå¹¶æŸ¥çœ‹å®ƒåœ¨ Istio ä¸­çš„è¿è¡Œæƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Istio å¯ä»¥è·å¾—å¾ˆå¤šé¢å¤–çš„å¥½å¤„ï¼Œä¾‹å¦‚ç‰¹æ®Šçš„ç›®æ ‡è§„åˆ™ï¼Œè‡ªå®šä¹‰ç­–ç•¥å’Œè‡ªå®šä¹‰åº¦é‡ï¼Œä½†è¿™æ˜¯ä¸‹ä¸€ç« çš„ä¸»é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨å¯¹æœ¬æ•™ç¨‹æœ‰ä»»ä½•ç–‘é—®ã€å»ºè®®æˆ–åé¦ˆï¼Œè¯·éšæ—¶æ·»åŠ ä»»ä½•æ„è§å¹¶ä¸æˆ‘è”ç³»ï¼&lt;/p&gt;
&lt;p&gt;ç¤¾åŒºè§ï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Envoy æ­å»º Service Mesh</title>
      <link>https://cloudnative.to/blog/service-mesh-with-envoy-101/</link>
      <pubDate>Fri, 23 Nov 2018 14:27:26 +0800</pubDate>
      <guid>https://cloudnative.to/blog/service-mesh-with-envoy-101/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://medium.com/@dnivra26/service-mesh-with-envoy-101-e6b2131ee30b&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°†ç®€å•çš„è®¨è®ºä¸‹æˆ‘ä»¬ç»å¸¸å¬åˆ°çš„â€œService Meshâ€æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨â€œEnvoyâ€æ„å»ºæœåŠ¡ç½‘æ ¼ (Service Mesh)ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-service-mesh&#34;&gt;ä»€ä¹ˆæ˜¯ Service Mesh?&lt;/h2&gt;
&lt;p&gt;Service Mesh å¯ä»¥æ¯”ä½œæ˜¯å¾®æœåŠ¡ç»“æ„ä¸­çš„é€šä¿¡å±‚ã€‚æ¯ä¸ªæœåŠ¡ä¹‹é—´æ¥å¾€çš„æ‰€æœ‰è¯·æ±‚éƒ½å°†é€šè¿‡ç½‘æ ¼ã€‚æ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„ä»£ç†æœåŠ¡ï¼Œæ‰€æœ‰è¿™äº›ä»£ç†æœåŠ¡å…±åŒç»„æˆäº†â€œæœåŠ¡ç½‘æ ¼â€(Service Mesh)ã€‚æ‰€ä»¥å‡å¦‚ä¸€ä¸ªæœåŠ¡æƒ³è¦å’Œå¦ä¸€ä¸ªæœåŠ¡é€šä¿¡ï¼Œä»–ä¸æ˜¯ç›´æ¥å’Œè¿™ä¸ªç›®æ ‡æœåŠ¡é€šä¿¡çš„ï¼Œä»–ä¼šå…ˆæŠŠè¯·æ±‚è·¯ç”±ç»™è‡ªå·±æœ¬åœ°çš„ä»£ç†ï¼Œå†ç”±ä»£ç†æŠŠè¯·æ±‚è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œæ¯ä¸ªæœåŠ¡å®ä¾‹éƒ½åªçŸ¥é“è‡ªå·±æœ¬åœ°çš„ä»£ç†ï¼Œå¹¶ä¸çŸ¥é“å¤–é¢ä¸–ç•Œæ˜¯ä»€ä¹ˆæ ·çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/service-mesh-with-envoy-101/7267315bgy1fx9svk4k4kj20dd059wef_hucda7c2be26f8c0d91a5382edb17e85f5_11154_73f6a7f1839faf46be24f95a362373c4.webp 400w,
               /blog/service-mesh-with-envoy-101/7267315bgy1fx9svk4k4kj20dd059wef_hucda7c2be26f8c0d91a5382edb17e85f5_11154_20f91e00f8cd137ffed9f5e0ac5739b7.webp 760w,
               /blog/service-mesh-with-envoy-101/7267315bgy1fx9svk4k4kj20dd059wef_hucda7c2be26f8c0d91a5382edb17e85f5_11154_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-with-envoy-101/7267315bgy1fx9svk4k4kj20dd059wef_hucda7c2be26f8c0d91a5382edb17e85f5_11154_73f6a7f1839faf46be24f95a362373c4.webp&#34;
               width=&#34;481&#34;
               height=&#34;189&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“ä½ åœ¨è°ˆè®ºâ€œService Meshâ€çš„æ—¶å€™ï¼Œä½ è‚¯å®šä¹Ÿä¼šå¬åˆ°â€œSidecarâ€è¿™ä¸ªè¯ï¼Œâ€œSideCarâ€å°±æ˜¯ç”¨äºæ¯ä¸ªæœåŠ¡å®ä¾‹ä¸­çš„ä»£ç†ï¼Œæ¯ä¸ªâ€œSideCarâ€è´Ÿè´£ä¸€ä¸ªæœåŠ¡ä¸­çš„ä¸€ä¸ªå®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/service-mesh-with-envoy-101/7267315bgy1fx9td4xqnjj20hd0csthg_hu7613110e57e4a4fe29297d061475f26d_71062_1f3ec4ebee196b5c0a5a04ecf486530e.webp 400w,
               /blog/service-mesh-with-envoy-101/7267315bgy1fx9td4xqnjj20hd0csthg_hu7613110e57e4a4fe29297d061475f26d_71062_8b4e30f0c6ab265ee8d8181df571a50b.webp 760w,
               /blog/service-mesh-with-envoy-101/7267315bgy1fx9td4xqnjj20hd0csthg_hu7613110e57e4a4fe29297d061475f26d_71062_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-with-envoy-101/7267315bgy1fx9td4xqnjj20hd0csthg_hu7613110e57e4a4fe29297d061475f26d_71062_1f3ec4ebee196b5c0a5a04ecf486530e.webp&#34;
               width=&#34;625&#34;
               height=&#34;460&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;service-mesh-èƒ½å¸¦æ¥ä»€ä¹ˆ&#34;&gt;Service Mesh èƒ½å¸¦æ¥ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;æœåŠ¡å‘ç°&lt;/li&gt;
&lt;li&gt;å¯è§‚æµ‹æ€§ï¼ˆMetricsï¼‰&lt;/li&gt;
&lt;li&gt;é™é€Ÿ&lt;/li&gt;
&lt;li&gt;ç†”æ–­&lt;/li&gt;
&lt;li&gt;æµé‡è¿ç§»&lt;/li&gt;
&lt;li&gt;è´Ÿè½½å‡è¡¡&lt;/li&gt;
&lt;li&gt;è®¤è¯ä¸æˆæƒ&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼è¿½è¸ª&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;envoy&#34;&gt;Envoy&lt;/h2&gt;
&lt;p&gt;Envoy æ˜¯ä¸€ä¸ªç”¨ C++ ç¼–å†™çš„é«˜æ€§èƒ½ä»£ç†ã€‚ç»ä¸æ˜¯ä¸€å®šè¦ä½¿ç”¨ Envoy æ¥æ­å»ºâ€œService Meshâ€ ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ä»£ç†ï¼Œå¦‚ Nginxã€Traefik ç­‰â€¦â€¦ä½†æ˜¯æœ¬æ–‡æˆ‘ä»¬å°†ä½¿ç”¨ Envoyã€‚&lt;/p&gt;
&lt;p&gt;å¥½ï¼Œè®©æˆ‘ä»¬æ¥æ­å»ºä¸€ä¸ªç”± 3 ä¸ªæœåŠ¡ç»„æˆçš„â€œService Meshâ€ã€‚æˆ‘ä»¬è¦æ­å»ºçš„â€œService Meshâ€çš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼Œæ¯ä¸ªæœåŠ¡æ—éƒ½è®¾ç½®æœ‰ä¸€ä¸ªä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/service-mesh-with-envoy-101/7267315bgy1fxaaka4lvdj20o70a63ys_hu690cc0210ce30860d4c7b391d0ce5014_16028_839cdd44e76757b04350080723d5d488.webp 400w,
               /blog/service-mesh-with-envoy-101/7267315bgy1fxaaka4lvdj20o70a63ys_hu690cc0210ce30860d4c7b391d0ce5014_16028_af946d49d6a7aea1a1324a5b20f5ac9e.webp 760w,
               /blog/service-mesh-with-envoy-101/7267315bgy1fxaaka4lvdj20o70a63ys_hu690cc0210ce30860d4c7b391d0ce5014_16028_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-with-envoy-101/7267315bgy1fxaaka4lvdj20o70a63ys_hu690cc0210ce30860d4c7b391d0ce5014_16028_839cdd44e76757b04350080723d5d488.webp&#34;
               width=&#34;760&#34;
               height=&#34;319&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;front-envoy&#34;&gt;Front Envoy&lt;/h2&gt;
&lt;p&gt;â€œFront Envoyâ€æ˜¯è¾¹ç•Œä»£ç†å³å‰ç«¯ä»£ç†ï¼Œå¸¸å¸¸ä¼šç”¨å®ƒæ¥åš TLS ç»ˆæ­¢ï¼Œè®¤è¯ï¼Œç”Ÿæˆè¯·æ±‚å¤´éƒ¨ï¼Œç­‰â€¦â€¦&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆä¸€èµ·æ¥çœ‹ä¸‹â€œFront Envoyâ€çš„é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;admin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;access_log_path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/tmp/admin_access.log&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9901&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;static_resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http_listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ingress&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;local_route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_a&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.router&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_a&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.25s&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;strict_dns&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ROUND_ROBIN&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_a_envoy&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8786&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Envoy çš„é…ç½®ä¸»è¦åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¾¦å¬å™¨ Listeners&lt;/li&gt;
&lt;li&gt;è·¯ç”± Routes&lt;/li&gt;
&lt;li&gt;é›†ç¾¤ Clusters&lt;/li&gt;
&lt;li&gt;ç«¯ç‚¹ Endpoints&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æˆ‘ä»¬é€ä¸ªæ¥çœ‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¾¦å¬å™¨listeners&#34;&gt;ä¾¦å¬å™¨ï¼ˆListenersï¼‰&lt;/h2&gt;
&lt;p&gt;Envoy å®ä¾‹ä¸­å¯ä»¥è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªä¾¦å¬å™¨ã€‚ç¬¬ 9-36 è¡Œï¼Œé…ç½®äº†&amp;quot;http_listener&amp;quot;çš„åœ°å€å’Œç«¯å£ï¼Œæ¯ä¸ªä¾¦å¬å™¨ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç½‘ç»œè¿‡æ»¤å™¨ï¼ˆfilterï¼‰ã€‚è¿™äº›è¿‡æ»¤å™¨å¯ä»¥å®ç°è·¯ç”±ã€TLS ç»ˆæ­¢ã€æµé‡è¿ç§»ç­‰â€¦â€¦ æˆ‘ä»¬è¿™é‡Œç”¨åˆ°çš„è¿‡æ»¤å™¨â€œenvoy.http_connection_managerâ€æ˜¯å†…åµŒçš„è¿‡æ»¤å™¨ä¹‹ä¸€ï¼ŒEnvoy è¿˜æœ‰å…¶ä»–å‡ ç§&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/network_filters/network_filters#config-network-filters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿‡æ»¤å™¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è·¯ç”±routes&#34;&gt;è·¯ç”±ï¼ˆRoutesï¼‰&lt;/h2&gt;
&lt;p&gt;ç¬¬ 22-34 è¡Œï¼Œä¸º filter é…ç½®è·¯ç”±è§„èŒƒ &amp;ldquo;local_routeâ€ï¼Œå£°æ˜åº”è¯¥ä»å“ªäº›åŸŸæ¥å—è¯·æ±‚å’Œä¸€ä¸ªç”¨æ¥ä¸æ¯ä¸ªè¯·æ±‚åŒ¹é…çš„è·¯ç”±åŒ¹é…å™¨ï¼Œå¹¶å°†è¯·æ±‚å‘é€åˆ°é€‚å½“çš„é›†ç¾¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é›†ç¾¤clusters&#34;&gt;é›†ç¾¤ï¼ˆClustersï¼‰&lt;/h2&gt;
&lt;p&gt;Clusters æ˜¯ Envoy å°†æµé‡è·¯ç”±åˆ°ä¸Šæ¸¸æœåŠ¡çš„è§„èŒƒã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ 41-50 è¡Œï¼Œå®šä¹‰çš„â€œService Aâ€ï¼Œå®ƒæ˜¯å”¯ä¸€è¦å‰ç«¯ä»£ç†â€œFront Envoyâ€å»ºç«‹é€šä¿¡çš„ä¸Šæ¸¸æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;â€œconnect_timeoutâ€æ˜¯åœ¨è¿”å› 503 ä¹‹å‰è·å¾—ä¸ä¸Šæ¸¸æœåŠ¡çš„è¿æ¥çš„æ—¶é—´é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸ä¸€ä¸ªæœåŠ¡ä¸ä¼šä»…ä»…åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼ŒEnvoy æ”¯æŒ&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/load_balancing#supported-load-balancers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•&lt;/a&gt;æ¥åˆ†å‘æµé‡ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æœ€åŸºç¡€çš„è½®è¯¢ç®—æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç«¯ç‚¹endpoints&#34;&gt;ç«¯ç‚¹ï¼ˆEndpointsï¼‰&lt;/h2&gt;
&lt;p&gt;â€œhostsâ€å®šä¹‰æˆ‘ä»¬è¦å°†æµé‡è·¯ç”±åˆ°çš„â€œService Aâ€çš„å¤šä¸ªå®ä¾‹ï¼Œåœ¨æœ¬æ–‡çš„æ¼”ç¤ºæ¡ˆä¾‹ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ³¨æ„åˆ°ç¬¬ 48 è¡Œï¼Œæ­£å¦‚æˆ‘ä»¬è®¨è®ºçš„ï¼Œæˆ‘ä»¬ä¸æ˜¯ç›´æ¥è®¿é—®â€œService Aâ€ ï¼Œè€Œæ˜¯å’Œâ€œService Aâ€ä¸­çš„å…¶ä¸­ä¸€ä¸ªå®ä¾‹çš„ Envoy ä»£ç†é€šä¿¡ï¼Œå†æŠŠæµé‡è·¯ç”±ç»™æœ¬åœ°çš„å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;ä½ ä¹Ÿå¯ä»¥å£°æ˜æœåŠ¡åç§°ï¼Œå¦‚â€œService Aâ€ï¼Œå®ƒå°†è¿”å›æœåŠ¡çš„æ‰€æœ‰å®ä¾‹ï¼Œç±»ä¼¼ Kubernetes ä¸­çš„ Headless Serviceã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ã€‚Envoy ä¼šç¼“å­˜â€œService Aâ€æ‰€æœ‰çš„â€œhostsâ€ï¼Œæ¯éš” 5 ç§’é’Ÿåˆ·æ–°ä¸€æ¬¡å®ä¾‹åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;Envoy æ”¯æŒä¸»åŠ¨å’Œè¢«åŠ¨çš„è´Ÿè½½å‡è¡¡ã€‚å¦‚æœæƒ³å¯ç”¨å¥åº·æ£€æŸ¥åŠŸèƒ½ï¼Œéœ€è¦åœ¨ cluster çš„é…ç½®ä¸­é…ç½®å¥åº·æ£€æŸ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…¶ä»–&#34;&gt;å…¶ä»–&lt;/h2&gt;
&lt;p&gt;ç¬¬ 2-7 è¡Œï¼Œé…ç½®ç®¡ç†æœåŠ¡å™¨ï¼Œç”¨äºæŸ¥çœ‹é…ç½®ã€ä¿®æ”¹æ—¥å¿—çº§åˆ«ã€æŸ¥çœ‹çŠ¶æ€ï¼Œç­‰ç­‰â€¦â€¦&lt;/p&gt;
&lt;p&gt;ç¬¬ 8 è¡Œï¼Œâ€œstatic_resourcesâ€ï¼Œæ„å‘³ç€æˆ‘ä»¬è¦æ‰‹åŠ¨åŠ è½½æ‰€æœ‰é…ç½®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åŠ¨æ€åŠ è½½é…ç½®ï¼Œåé¢æˆ‘ä»¬å†æ¥çœ‹çœ‹æ˜¯æ€ä¹ˆåšçš„ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶é™¤äº†ä¸Šæ–‡ç¤ºä¾‹é…ç½® Envoy è¿˜æœ‰å¾ˆå¤šé…ç½®é¡¹ï¼Œä½†æˆ‘ä»¬çš„ç›®æ ‡ä¸æ˜¯å°è¯•æ‰€æœ‰å¯ç”¨çš„é…ç½®ï¼Œè€Œæ˜¯è¦ä»æœ€å°é…ç½®å¼€å§‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;service-a&#34;&gt;Service A&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯â€œService Aâ€çš„ Envoy é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;admin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;access_log_path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/tmp/admin_access.log&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9901&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;static_resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service-a-svc-http-listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8786&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ingress&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;codec_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;AUTO&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service-a-svc-http-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service-a-svc-http-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_a&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.router&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service-b-svc-http-listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8788&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;egress&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;codec_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;AUTO&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service-b-svc-http-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service-b-svc-http-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_b&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.router&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service-c-svc-http-listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8791&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;egress&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;codec_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;AUTO&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service-b-svc-http-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service-b-svc-http-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_c&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.router&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_a&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.25s&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;strict_dns&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ROUND_ROBIN&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_a&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8081&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_b&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.25s&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;strict_dns&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ROUND_ROBIN&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_b_envoy&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8789&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_c&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.25s&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;strict_dns&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ROUND_ROBIN&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_c_envoy&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8790&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¬¬ 11-39 è¡Œï¼Œå®šä¹‰ä¸€ä¸ªä¾¦å¬å™¨æ¥è½¬å‘æµé‡ç»™â€œService Aâ€åç«¯çœŸå®çš„å®ä¾‹ï¼Œè€Œ 103-111 è¡Œï¼Œæ˜¯å…¶ç›¸åº”çš„é›†ç¾¤å®šä¹‰ã€‚&lt;/p&gt;
&lt;p&gt;â€œService Aâ€ä¹Ÿè¦ä¸â€œService Bâ€å’Œâ€œService Câ€é€šä¿¡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜é…ç½®äº†å¦å¤–ä¸¤ä¸ªä¾¦å¬å™¨å’Œå¯¹åº”çš„é›†ç¾¤ã€‚è¿™é‡Œæˆ‘ä»¬å°†æ¯ä¸ªä¸Šæ¸¸æœåŠ¡å•ç‹¬é…ç½®ä¸€ä¸ªä¾¦å¬å™¨ï¼ˆlocalhost, Service B, Service Cï¼‰ï¼Œå¦å¤–ä¸€ç§æ–¹å¼æ˜¯åªé…ç½®ä¸€ä¸ªä¾¦å¬å™¨å’Œè·¯ç”±ï¼Œç”¨ url æˆ–è€… headers æ¥åŒºåˆ†ä¸åŒçš„ä¸Šæ¸¸æœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;service-b--service-c&#34;&gt;Service B &amp;amp; Service C&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ B å’ŒæœåŠ¡ C éƒ½æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé™¤äº†æœ¬åœ°ä¸»æœºçš„æœåŠ¡å®ä¾‹å¤–ï¼Œä¸éœ€è¦å’Œå…¶ä»–ä¸Šæ¸¸æœåŠ¡é€šä¿¡ã€‚æ‰€ä»¥é…ç½®ç›¸å¯¹ç®€å•äº›ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;admin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;access_log_path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/tmp/admin_access.log&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9901&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;static_resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service-b-svc-http-listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8789&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ingress&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;codec_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;AUTO&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service-b-svc-http-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service-b-svc-http-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_b&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.router&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_b&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.25s&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;strict_dns&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ROUND_ROBIN&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_b&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8082&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€ä»¥ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„é…ç½®ï¼Œåªæœ‰ä¸€ä¸ªä¾¦å¬å™¨å’Œä¸€ä¸ªé›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°æ­¤æˆ‘ä»¬å®Œæˆäº†æ‰€æœ‰çš„é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶éƒ¨ç½²åˆ° Kubernetes ä¸Šæˆ–è€…ä½¿ç”¨ docker-compose è¿›è¡Œæµ‹è¯•ã€‚&lt;/p&gt;
&lt;p&gt;docker-compose.yaml é…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;3&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;services&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;front-envoy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoyproxy/envoy-alpine:v1.7.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;./front_envoy/envoy-config.yaml:/etc/envoy-config.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;8080:80&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;9901:9901&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/usr/local/bin/envoy -c /etc/envoy-config.yaml --v2-config-only -l info --service-cluster &amp;#39;front-envoy&amp;#39; --service-node &amp;#39;front-envoy&amp;#39; --log-format &amp;#39;[METADATA][%Y-%m-%d %T.%e][%t][%l][%n] %v&amp;#39;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service_a_envoy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoyproxy/envoy-alpine:v1.7.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;./service_a/envoy-config.yaml:/etc/envoy-config.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;8786:8786&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;8788:8788&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/usr/local/bin/envoy -c /etc/envoy-config.yaml --v2-config-only -l info --service-cluster &amp;#39;service-a&amp;#39; --service-node &amp;#39;service-a&amp;#39; --log-format &amp;#39;[METADATA][%Y-%m-%d %T.%e][%t][%l][%n] %v&amp;#39;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service_a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service_a/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;8081:8081&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service_b_envoy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoyproxy/envoy-alpine:v1.7.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;./service_b/envoy-config.yaml:/etc/envoy-config.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;8789:8789&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/usr/local/bin/envoy -c /etc/envoy-config.yaml --v2-config-only -l info --service-cluster &amp;#39;service-b&amp;#39; --service-node &amp;#39;service-b&amp;#39; --log-format &amp;#39;[METADATA][%Y-%m-%d %T.%e][%t][%l][%n] %v&amp;#39;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service_b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service_b/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;8082:8082&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service_c_envoy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoyproxy/envoy-alpine:v1.7.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;./service_c/envoy-config.yaml:/etc/envoy-config.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;8790:8790&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/usr/local/bin/envoy -c /etc/envoy-config.yaml --v2-config-only -l info --service-cluster &amp;#39;service-c&amp;#39; --service-node &amp;#39;service-c&amp;#39; --log-format &amp;#39;[METADATA][%Y-%m-%d %T.%e][%t][%l][%n] %v&amp;#39;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service_c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service_c/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;8083:8083&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œ docker-compose build å’Œ docker-compose upï¼Œè®¿é—® localhost:8080ï¼Œä½ åº”è¯¥å¯ä»¥çœ‹åˆ°è¯·æ±‚æˆåŠŸé€šè¿‡æ‰€æœ‰çš„æœåŠ¡å’Œä»£ç†ï¼Œå¯ä»¥ä½¿ç”¨æ—¥å¿—æ¥éªŒè¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-xds&#34;&gt;Envoy xDS&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬é€šè¿‡ä¸ºæ¯ä¸ª SideCar ä»£ç†æä¾›é…ç½®æ¥å®ç°è¿™äº›ï¼Œä¸åŒçš„æœåŠ¡ï¼Œé…ç½®ä¹Ÿç¨å¾®ä¼šæœ‰ä¸€å®šçš„åŒºåˆ«ã€‚ç°åœ¨ä»…æœ‰ä¸¤ä¸‰ä¸ªæœåŠ¡ï¼Œæ‰‹åŠ¨å»åˆ›å»ºå’Œç®¡ç† SideCar çš„é…ç½®æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†éšç€æœåŠ¡æ•°é‡çš„å¢åŠ ï¼Œæ‰‹å·¥åˆ›å»ºå’Œç®¡ç†ä¹Ÿæ˜¾å¾—æ›´åŠ å›°éš¾ã€‚å½“ä½ ä¿®æ”¹ä¸€ä¸ª SideCar çš„é…ç½®ï¼Œå¿…é¡»è¦é‡å¯ Envoy å®ä¾‹æ‰èƒ½ä½¿å˜æ›´ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;p&gt;æ­£å¦‚æˆ‘ä»¬å‰é¢æåˆ°çš„ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä¸ç”¨æ‰‹åŠ¨é…ç½®å’ŒåŠ è½½æ‰€æœ‰ç»„ä»¶ï¼ŒClusters(CDS), Endpoints(EDS), Listeners(LDS) å’Œ Routes(RDS) ä½¿ç”¨åŒä¸€ä¸ª api serverã€‚æ‰€ä»¥æ¯ä¸ª SideCar éƒ½è¦å’Œ api server é€šä¿¡ä»¥è·å–é…ç½®ï¼Œå¹¶ä¸”å½“ä¸€ä¸ªæ–°çš„é…ç½®åœ¨ api server æ›´æ–°åï¼Œå®ƒä¼šè‡ªåŠ¨æ›´æ–°åˆ° Envoy å®ä¾‹ä¸­ï¼Œé¿å…äº†é‡å¯å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;æ›´å¤šå…³äº&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/overview/v2_overview#dynamic&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ¨æ€é…ç½®&lt;/a&gt;çš„å†…å®¹ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ª &lt;a href=&#34;https://github.com/tak2siva/Envoy-Pilot&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS æœåŠ¡å™¨ç¤ºä¾‹&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes&#34;&gt;Kubernetes&lt;/h2&gt;
&lt;p&gt;æœ¬èŠ‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå‰é¢çš„æœåŠ¡é…ç½®éƒ½éƒ¨ç½²åœ¨ Kubernetes ä¸Šï¼Œå…¶æ•´ä¸ªç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/service-mesh-with-envoy-101/7267315bgy1fxde1rkcdwj20he08ymxb_hu9a1cd9f274305e0f977fe2f34c8a523b_13097_350357a5dd5b9b48f397e38caf046082.webp 400w,
               /blog/service-mesh-with-envoy-101/7267315bgy1fxde1rkcdwj20he08ymxb_hu9a1cd9f274305e0f977fe2f34c8a523b_13097_6fd0a29dc58faf0022038bb2a84e01e2.webp 760w,
               /blog/service-mesh-with-envoy-101/7267315bgy1fxde1rkcdwj20he08ymxb_hu9a1cd9f274305e0f977fe2f34c8a523b_13097_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-with-envoy-101/7267315bgy1fxde1rkcdwj20he08ymxb_hu9a1cd9f274305e0f977fe2f34c8a523b_13097_350357a5dd5b9b48f397e38caf046082.webp&#34;
               width=&#34;626&#34;
               height=&#34;322&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥éœ€è¦ä¿®æ”¹çš„é…ç½®æœ‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Pod&lt;/li&gt;
&lt;li&gt;Service&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;pod&#34;&gt;Pod&lt;/h2&gt;
&lt;p&gt;é€šå¸¸ Pod è§„èŒƒåªåœ¨ä¸€ä¸ª Pod ä¸­å®šä¹‰ä¸€ä¸ªå®¹å™¨ã€‚ä½†æ˜¯æ ¹æ®å®šä¹‰ï¼ŒPod ä¸­å¯ä»¥å®¹çº³ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ã€‚å› ä¸ºæˆ‘ä»¬æƒ³è¦ä¸ºæ¯ä¸ªæœåŠ¡å®ä¾‹æ—è¿è¡Œä¸€ä¸ª SideCar ä»£ç†ï¼Œæˆ‘ä»¬è¦å°† Envoy å®¹å™¨æ·»åŠ åˆ°æ¯ä¸ª Podã€‚æ‰€ä»¥ä¸ºäº†å’Œå¤–ç•Œé€šä¿¡ï¼ŒæœåŠ¡å®¹å™¨å°†é€šè¿‡ localhost ä¸ Envoy å®¹å™¨é€šä¿¡ã€‚ä»¥ä¸‹æ˜¯ deployment æ–‡ä»¶ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;servicea&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;servicea&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;servicea&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dnivra26/servicea:0.6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8081&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;svc-port&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoyproxy/envoy:latest&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9901&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy-admin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8786&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy-web&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy-config-volume&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/etc/envoy-config/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/usr/local/bin/envoy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;-c&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/etc/envoy-config/config.yaml&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;--v2-config-only&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;-l&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;--service-cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;servicea&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;--service-node&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;servicea&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;--log-format&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[METADATA][%Y-%m-%d %T.%e][%t][%l][%n] %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy-config-volume&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sidecar-config&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy-config&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;config.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°åœ¨å®¹å™¨å®šä¹‰éƒ¨åˆ†ï¼Œæˆ‘ä»¬æ·»åŠ äº† Envoy ä»£ç†ã€‚åœ¨ç¬¬ 33-39 è¡Œï¼Œæˆ‘ä»¬é€šè¿‡ configmap æŠŠ Envoy é…ç½®æ–‡ä»¶æŒ‚è½½åˆ° Envoy å®¹å™¨ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;service&#34;&gt;Service&lt;/h2&gt;
&lt;p&gt;Kubernetes çš„ services è´Ÿè´£ç»´æŠ¤å¯ä»¥è·¯ç”±æµé‡åˆ°è¾¾çš„ Pod ç«¯ç‚¹çš„åˆ—è¡¨ã€‚è€Œä¸”é€šå¸¸ kube-proxy ä½œä¸ºè¿™äº› pod ç«¯ç‚¹çš„è´Ÿè½½å‡è¡¡ã€‚ä½†åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åšçš„æ˜¯å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸æƒ³ä½¿ç”¨ kube-proxy æ¥åšè´Ÿè½½å‡è¡¡ï¼Œæˆ‘ä»¬æƒ³è·å– Pod ç«¯ç‚¹åˆ—è¡¨å¹¶è‡ªå·±åšè´Ÿè½½å‡è¡¡ã€‚å› æ­¤æˆ‘ä»¬ä½¿ç”¨ headless Serviceï¼Œåªç”¨æ¥è¿”å›ç«¯ç‚¹åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;servicea&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusterIP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy-web&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8786&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8786&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;servicea&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¬¬ 6 è¡Œç”³æ˜äº†è¿™ä¸ª Service ç±»å‹ä¸º Headless Serviceã€‚ä½ ä¹Ÿåº”è¯¥å¯ä»¥æ³¨æ„åˆ°æˆ‘ä»¬å¹¶æ²¡æœ‰æ˜ å°„åº”ç”¨æœåŠ¡ç«¯å£åˆ° Kubernetes çš„ service ç«¯å£ï¼Œä½†æˆ‘ä»¬æ˜ å°„äº† Envoy ä¾¦å¬å™¨çš„ 8786 ç«¯å£åˆ° service çš„ 8786 ç«¯å£ã€‚æµé‡ä¼šå…ˆåˆ°è¾¾ Envoyã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†è¿™äº›ä½ ä¹Ÿå¯ä»¥åœ¨ Kubernetes å¾ˆå¥½çš„å®è·µäº†ã€‚&lt;/p&gt;
&lt;p&gt;å¥½ï¼Œå°±åˆ°è¿™é‡Œã€‚æœŸå¾…ä½ çš„å›å¤ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ˜¯ã€Š&lt;a href=&#34;https://hackernoon.com/distributed-tracing-with-envoy-service-mesh-jaeger-c365b6191592&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ Envoy å®ç°åˆ†å¸ƒå¼è¿½è¸ª&lt;/a&gt;ã€‹å’Œã€Š&lt;a href=&#34;https://hackernoon.com/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana-a1c26a8595fc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ Envoyã€Prometheus å’Œ Grafana ç›‘æ§&lt;/a&gt;ã€‹è¿™ä¸¤ç¯‡æ–‡ç« çš„é˜…è¯»åŸºç¡€ï¼Œå¦‚æœæœ‰å…´è¶£çš„è¯å¯ä»¥éƒ½è¯»ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹æœ¬æ–‡æ‰€æœ‰çš„&lt;a href=&#34;https://github.com/dnivra26/envoy_servicemesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é…ç½®å’Œä»£ç &lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨Envoyå°†gRPCè½¬ç ä¸ºHTTP/JSON</title>
      <link>https://cloudnative.to/blog/transcoding-grpc-to-http-json-using-envoy/</link>
      <pubDate>Thu, 22 Nov 2018 15:16:06 +0800</pubDate>
      <guid>https://cloudnative.to/blog/transcoding-grpc-to-http-json-using-envoy/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://blog.jdriven.com/2018/11/transcoding-grpc-to-http-json-using-envoy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¯•ç”¨ gRPC æ„å»ºæœåŠ¡æ—¶è¦åœ¨.proto æ–‡ä»¶ä¸­å®šä¹‰æ¶ˆæ¯ï¼ˆmessageï¼‰å’ŒæœåŠ¡ï¼ˆserviceï¼‰ã€‚gRPC æ”¯æŒå¤šç§è¯­è¨€è‡ªåŠ¨ç”Ÿæˆå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯å’Œ DTO å®ç°ã€‚åœ¨è¯»å®Œè¿™ç¯‡æ–‡ç« åï¼Œä½ å°†äº†è§£åˆ°ä½¿ç”¨ Envoy ä½œä¸ºè½¬ç ä»£ç†ï¼Œä½¿ gRPC APIä¹Ÿå¯ä»¥é€šè¿‡HTTP/JSONçš„æ–¹å¼è®¿é—®ã€‚ä½ å¯ä»¥é€šè¿‡githubä»£ç åº“ä¸­çš„Javaä»£ç æ¥æµ‹è¯•å®ƒã€‚æœ‰å…³gRPCçš„ä»‹ç»è¯·å‚é˜…&lt;a href=&#34;https://blog.jdriven.com/2018/10/grpc-as-an-alternative-to-rest/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;blog.jdriven.com/2018/10/grpc-as-an-alternative-to-rest/&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆè¦å¯¹-grpc-æœåŠ¡è¿›è¡Œè½¬ç &#34;&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆè¦å¯¹ gRPC æœåŠ¡è¿›è¡Œè½¬ç ï¼Ÿ&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;ä¸€æ—¦æœ‰äº†ä¸€ä¸ªå¯ç”¨çš„ gRPC æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡å‘æœåŠ¡æ·»åŠ ä¸€äº›é¢å¤–çš„æ³¨è§£ï¼ˆannotationï¼‰å°†å…¶ä½œä¸º HTTP/JSON API å‘å¸ƒã€‚ä½ éœ€è¦ä¸€ä¸ªä»£ç†æ¥è½¬æ¢ HTTP/JSON è°ƒç”¨å¹¶å°†å…¶ä¼ é€’ç»™ gRPC æœåŠ¡ã€‚æˆ‘ä»¬ç§°è¿™ä¸ªè¿‡ç¨‹ä¸ºè½¬ç ã€‚ç„¶åä½ çš„æœåŠ¡å°±å¯ä»¥é€šè¿‡ gRPC å’Œ HTTP/JSON è®¿é—®ã€‚å¤§å¤šæ•°æ—¶å€™æˆ‘æ›´å€¾å‘ä½¿ç”¨ gRPCï¼Œå› ä¸ºä½¿ç”¨éµå¾ªâ€œå¥‘çº¦â€ç”Ÿæˆçš„ç±»å‹å®‰å…¨çš„ä»£ç æ›´æ–¹ä¾¿ã€æ›´å®‰å…¨ï¼Œä½†æœ‰æ—¶è½¬ç ä¹Ÿå¾ˆæœ‰ç”¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;webåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡HTTP/JSONè°ƒç”¨ä¸gRPCæœåŠ¡é€šä¿¡ã€‚&lt;a href=&#34;https://github.com/grpc/grpc-web&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github.com/grpc/grpc-web&lt;/a&gt;æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨çš„ JavaScript çš„ gRPC å®ç°ã€‚è¿™ä¸ªé¡¹ç›®å¾ˆæœ‰å‰é€”ï¼Œä½†è¿˜ä¸æˆç†Ÿã€‚&lt;/li&gt;
&lt;li&gt;å› ä¸º gRPC åœ¨ç½‘ç»œé€šä¿¡ä¸Šä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼Œæ‰€ä»¥å¾ˆéš¾çœ‹åˆ°å®é™…å‘é€å’Œæ¥æ”¶çš„å†…å®¹ã€‚å°†å…¶ä½œä¸º HTTP/JSON API å‘å¸ƒï¼Œå¯ä»¥ä½¿ç”¨ cURL æˆ– postman ç­‰å·¥å…·æ›´å®¹æ˜“åœ°æ£€æŸ¥æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ ä½¿ç”¨çš„è¯­è¨€ gRPC ä¸æ”¯æŒï¼Œä½ å¯ä»¥é€šè¿‡ HTTP/JSON è®¿é—®å®ƒã€‚&lt;/li&gt;
&lt;li&gt;å®ƒä¸ºåœ¨é¡¹ç›®ä¸­æ›´å¹³ç¨³åœ°é‡‡ç”¨ gRPC é“ºå¹³äº†é“è·¯ï¼Œå…è®¸å…¶ä»–å›¢é˜Ÿé€æ­¥è¿‡æ¸¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;åˆ›å»ºä¸€ä¸ª-grpc-æœåŠ¡reservationservice&#34;&gt;&lt;strong&gt;åˆ›å»ºä¸€ä¸ª gRPC æœåŠ¡ï¼šReservationService&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„ gRPC æœåŠ¡ä½œä¸ºç¤ºä¾‹ã€‚åœ¨ gRPC ä¸­ï¼Œå®šä¹‰åŒ…å«è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆrpcï¼‰çš„ç±»å‹å’ŒæœåŠ¡ã€‚ä½ å¯ä»¥éšæ„è®¾è®¡è‡ªå·±çš„æœåŠ¡ï¼Œä½†æ˜¯è°·æ­Œå»ºè®®ä½¿ç”¨é¢å‘èµ„æºçš„è®¾è®¡ï¼ˆæºä»£ç ï¼š&lt;a href=&#34;https://cloud.google.com/apis/design/resources&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cloud.google.com/apis/design/resources&lt;/a&gt;ï¼‰ï¼Œå› ä¸ºç”¨æˆ·æ— éœ€çŸ¥é“æ¯ä¸ªæ–¹æ³•æ˜¯åšä»€ä¹ˆçš„å°±å¯ä»¥å®¹æ˜“åœ°ç†è§£ APIã€‚å¦‚æœä½ åˆ›å»ºäº†è®¸å¤šä¸å›ºå®šæ ¼å¼çš„ rpcï¼Œç”¨æˆ·å¿…é¡»ç†è§£æ¯ç§æ–¹æ³•çš„ä½œç”¨ï¼Œä»è€Œä½¿ä½ çš„ API æ›´éš¾å­¦ä¹ ã€‚é¢å‘èµ„æºçš„è®¾è®¡è¿˜å¯ä»¥æ›´å¥½åœ°è½¬æ¢ä¸º HTTP/JSON APIã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªä¼šè®®é¢„è®¢æœåŠ¡ã€‚è¯¥æœåŠ¡ç§°ä¸º ReservationServiceï¼Œç”±åˆ›å»ºã€è·å–ã€è·å–åˆ—è¡¨å’Œåˆ é™¤é¢„è®¢ 4 ä¸ªæ“ä½œç»„æˆã€‚æœåŠ¡å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-protobuf&#34; data-lang=&#34;protobuf&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//reservation_service.proto
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;syntax&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;proto3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;reservations&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;option&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;java_multiple_files&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;option&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;java_outer_classname&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;ReservationServiceProto&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;option&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;java_package&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;nl.toefel.reservations.v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;google/protobuf/empty.proto&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReservationService&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CreateReservation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreateReservationRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Reservation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GetReservation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetReservationRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Reservation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ListReservations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ListReservationsRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Reservation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DeleteReservation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DeleteReservationRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;google.protobuf.Empty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Reservation&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;title&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;venue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;room&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;repeated&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Person&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;attendees&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Person&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ssn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;firstName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lastName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;CreateReservationRequest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;Reservation&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;reservation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;CreateReservationResponse&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;Reservation&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;reservation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;GetReservationRequest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ListReservationsRequest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;venue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;room&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;Attendees&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;attendees&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Attendees&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;repeated&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lastName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;DeleteReservationRequest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šå¸¸çš„åšæ³•æ˜¯å°†æ“ä½œçš„å…¥å‚å°è£…åœ¨è¯·æ±‚å¯¹è±¡ä¸­ã€‚è¿™ä¼šåœ¨ä»¥åçš„æ“ä½œä¸­æ·»åŠ é¢å¤–çš„å­—æ®µæˆ–é€‰é¡¹æ—¶æ›´åŠ å®¹æ˜“ã€‚ListReservations æ“ä½œè¿”å›ä¸€ä¸ª Reservations åˆ—è¡¨ã€‚åœ¨ Java ä¸­ï¼Œè¿™æ„å‘³ç€ä½ å°†å¾—åˆ° Reservations å¯¹è±¡çš„ä¸€ä¸ªè¿­ä»£ï¼ˆIteratorï¼‰ã€‚å®¢æˆ·ç«¯ç”šè‡³å¯ä»¥åœ¨æœåŠ¡å™¨å‘é€å®Œå“åº”ä¹‹å‰å°±å¼€å§‹å¤„ç†å®ƒä»¬ï¼Œéå¸¸æ£’ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æƒ³çŸ¥é“è¿™ä¸ª gRPC æœåŠ¡åœ¨ Java ä¸­æ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ï¼Œè¯·æŸ¥çœ‹ &lt;a href=&#34;https://github.com/toefel18/transcoding-grpc-to-http-json/blob/master/src/main/java/nl/toefel/server/ServerMain.java&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ServerMain.java&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/toefel18/transcoding-grpc-to-http-json/blob/master/src/main/java/nl/toefel/client/ClientMain.java&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ClientMain.java&lt;/a&gt;å®ç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-http-é€‰é¡¹æ ‡æ³¨æœåŠ¡è¿›è¡Œè½¬ç &#34;&gt;&lt;strong&gt;ä½¿ç”¨ HTTP é€‰é¡¹æ ‡æ³¨æœåŠ¡è¿›è¡Œè½¬ç &lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;åœ¨æ¯ä¸ª rpc æ“ä½œçš„èŠ±æ‹¬å·ä¸­å¯ä»¥æ·»åŠ é€‰é¡¹ã€‚Google å®šä¹‰äº†ä¸€ä¸ª java optionï¼Œå…è®¸ä½ æŒ‡å®šå¦‚ä½•å°†æ“ä½œè½¬æ¢åˆ° HTTP è¯·æ±‚ï¼ˆendpointï¼‰ã€‚åœ¨&lt;em&gt;reservation_service.proto&lt;/em&gt;ä¸­å¼•å…¥â€˜**google/api/annotations.protoâ€™**å³å¯ä½¿ç”¨è¯¥é€‰é¡¹ã€‚é»˜è®¤æƒ…å†µä¸‹è¿™ä¸ª import æ˜¯ä¸å¯ç”¨çš„ï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡å‘&lt;em&gt;build.gradle&lt;/em&gt;æ·»åŠ ä»¥ä¸‹ç¼–è¯‘ä¾èµ–æ¥å®ç°å®ƒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;compile &lt;span class=&#34;s2&#34;&gt;&amp;#34;com.google.api.grpc:proto-google-common-protos:1.13.0-pre2&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªä¾èµ–å°†ç”± protobuf è§£å‹å¹¶ç”Ÿæˆå‡ ä¸ª.proto æ–‡ä»¶æ”¾å…¥æ„å»ºç›®å½•ä¸­ã€‚ç°åœ¨å¯ä»¥æŠŠ&lt;strong&gt;google/api/annotations.proto&lt;/strong&gt;å¼•å…¥ä½ çš„.proto æ–‡ä»¶ä¸­å¹¶å¼€å§‹è¯´æ˜å¦‚ä½•è½¬æ¢ APIã€‚&lt;/p&gt;
&lt;h2 id=&#34;è½¬ç -getreservation-æ“ä½œä¸º-get-æ–¹æ³•&#34;&gt;&lt;strong&gt;è½¬ç  GetReservation æ“ä½œä¸º GET æ–¹æ³•&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;è®©æˆ‘ä»¬ä» GetReservation æ“ä½œå¼€å§‹ï¼Œæˆ‘å·²ç»æ·»åŠ äº† GetReservationRequest åˆ°ä»£ç ç¤ºä¾‹ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-protobuf&#34; data-lang=&#34;protobuf&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;GetReservationRequest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GetReservation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetReservationRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Reservation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;option&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;google.api.http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;           &lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/v1/reservations/{id}&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨é€‰é¡¹å®šä¹‰ä¸­æœ‰ä¸€ä¸ªåä¸ºâ€œgetâ€çš„å­—æ®µï¼Œè®¾ç½®ä¸ºâ€œ/v1/reservation /{id}â€ã€‚å­—æ®µåå¯¹åº”äº HTTP å®¢æˆ·ç«¯åº”è¯¥ä½¿ç”¨çš„ HTTP è¯·æ±‚æ–¹æ³•ã€‚get çš„å€¼å¯¹åº”äºè¯·æ±‚ URLã€‚åœ¨ URL ä¸­æœ‰ä¸€ä¸ªåä¸º id çš„è·¯å¾„å˜é‡ï¼Œè¿™ä¸ªå˜é‡ä¼šè‡ªåŠ¨æ˜ å°„åˆ°è¾“å…¥æ“ä½œä¸­åŒåçš„å­—æ®µã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒå°†æ˜¯ GetReservationRequest.idã€‚&lt;/p&gt;
&lt;p&gt;å‘é€ &lt;strong&gt;GET /v1/reservations/1234&lt;/strong&gt; åˆ°ä»£ç†å°†è½¬ç åˆ°ä¸‹é¢çš„ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;request&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GetReservationRequest&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;builder&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setId&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â€œ&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1234&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â€&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;reservation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;reservationServiceClient&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;GetReservation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;toJson&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;reservation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;HTTP å“åº”ä½“ï¼ˆresponse bodyï¼‰å°†è¿”å›é¢„è®¢çš„æ‰€æœ‰éç©ºå­—æ®µçš„ JSON å½¢å¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è®°ä½ï¼šè½¬ç ä¸æ˜¯ç”± gRPC æœåŠ¡å®Œæˆçš„ã€‚å•ç‹¬è¿è¡Œè¿™ä¸ªç¤ºä¾‹ä¸ä¼šå°†å…¶å‘å¸ƒä¸º HTTP JSON APIã€‚å‰ç«¯çš„ä»£ç†è´Ÿè´£è½¬ç ã€‚æˆ‘ä»¬ç¨åå°†å¯¹æ­¤è¿›è¡Œé…ç½®ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;è½¬ç -createreservation-æ“ä½œä¸º-post-æ–¹æ³•&#34;&gt;è½¬ç  CreateReservation æ“ä½œä¸º POST æ–¹æ³•&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æ¥è€ƒè™‘ CreateReservation æ“ä½œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-protobuf&#34; data-lang=&#34;protobuf&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;CreateReservationRequest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;n&#34;&gt;Reservation&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;reservation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CreateReservation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreateReservationRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Reservation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;k&#34;&gt;option&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;google.api.http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;post&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/v1/reservations&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;reservation&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªæ“ä½œè¢«è½¬ä¸º POST è¯·æ±‚*/v1/reservation*ã€‚é€‰é¡¹ä¸­çš„ body å­—æ®µå‘Šè¯‰è½¬ç å™¨å°†è¯·æ±‚ä½“è½¬æˆ CreateReservationRequest ä¸­çš„å­—æ®µã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ curl è°ƒç”¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -X POST &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    http://localhost:51051/v1/reservations &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;    &amp;#34;title&amp;#34;: &amp;#34;Lunchmeeting&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;    &amp;#34;venue&amp;#34;: &amp;#34;JDriven Coltbaan 3&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;    &amp;#34;room&amp;#34;: &amp;#34;atrium&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;    &amp;#34;timestamp&amp;#34;: &amp;#34;2018-10-10T11:12:13&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;    &amp;#34;attendees&amp;#34;: [
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;       {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;           &amp;#34;ssn&amp;#34;: &amp;#34;1234567890&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;           &amp;#34;firstName&amp;#34;: &amp;#34;Jimmy&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;           &amp;#34;lastName&amp;#34;: &amp;#34;Jones&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;       },
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;       {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;           &amp;#34;ssn&amp;#34;: &amp;#34;9999999999&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;           &amp;#34;firstName&amp;#34;: &amp;#34;Dennis&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;           &amp;#34;lastName&amp;#34;: &amp;#34;Richie&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;    ]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å“åº”åŒ…å«åŒæ ·çš„å¯¹è±¡ï¼Œåªä¸è¿‡å¤šäº†ä¸€ä¸ªç”Ÿæˆçš„ id å­—æ®µã€‚&lt;/p&gt;
&lt;h2 id=&#34;è½¬ç å¸¦æŸ¥è¯¢å‚æ•°è¿‡æ»¤çš„-listreservations&#34;&gt;&lt;strong&gt;è½¬ç å¸¦æŸ¥è¯¢å‚æ•°è¿‡æ»¤çš„ ListReservations&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;æŸ¥è¯¢é›†åˆèµ„æºçš„ä¸€ç§å¸¸è§æ–¹æ³•æ˜¯æä¾›æŸ¥è¯¢å‚æ•°ä½œä¸ºè¿‡æ»¤å™¨ã€‚ListReservations çš„ gRPC æœåŠ¡å°±æœ‰æ­¤åŠŸèƒ½ã€‚å®ƒæ¥æ”¶åˆ°ä¸€ä¸ªåŒ…å«å¯é€‰å­—æ®µçš„ ListReservationRequestï¼Œç”¨äºè¿‡æ»¤é¢„è®¢é›†åˆã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-protobuf&#34; data-lang=&#34;protobuf&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ListReservationsRequest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;venue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;room&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;Attendees&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;attendees&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Attendees&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;repeated&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lastName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ListReservations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ListReservationsRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Reservation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;k&#34;&gt;option&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;google.api.http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;       &lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/v1/reservations&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™é‡Œï¼Œè½¬ç å™¨å°†è‡ªåŠ¨åˆ›å»º ListReservationsRequestï¼Œå¹¶å°†æŸ¥è¯¢å‚æ•°æ˜ å°„åˆ° ListReservationRequest çš„å†…éƒ¨å­—æ®µã€‚æ²¡æœ‰æŒ‡å®šçš„å­—æ®µéƒ½å–é»˜è®¤å€¼ï¼Œå¯¹äºå­—ç¬¦ä¸²æ¥è¯´æ˜¯&amp;quot;&amp;quot;ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://localhost:51051/v1/reservations?room&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;atrium
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å­—æ®µ room è®¾ç½®ä¸º atrium å¹¶æ˜ å°„åˆ° ListReservationRequest é‡Œï¼Œå…¶ä½™å­—æ®µè®¾ç½®ä¸ºé»˜è®¤å€¼ã€‚è¿˜å¯ä»¥æä¾›ä»¥ä¸‹å­æ¶ˆæ¯å­—æ®µï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://localhost:51051/v1/reservations?attendees.lastName=Richie&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;attendees.lastName æ˜¯ä¸€ä¸ª repeated çš„å­—æ®µï¼Œå¯ä»¥è¢«è®¾ç½®å¤šæ¬¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl  &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://localhost:51051/v1/reservations?attendees.lastName=Richie&amp;amp;attendees.lastName=Kruger&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;gRPC æœåŠ¡å°†ä¼šçŸ¥é“ ListReservationRequest.attendees.lastName æ˜¯ä¸€ä¸ªæœ‰ä¸¤ä¸ªå…ƒç´ çš„åˆ—è¡¨ï¼šRichie å’Œ Kruger. Superniceã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿è¡Œè½¬ç å™¨&#34;&gt;&lt;strong&gt;è¿è¡Œè½¬ç å™¨&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;æ˜¯æ—¶å€™è®©è¿™äº›è¿è¡Œèµ·æ¥äº†ã€‚Google cloud æ”¯æŒè½¬ç ï¼Œå³ä½¿è¿è¡Œåœ¨ Kubernetes (incl GKE) æˆ–è®¡ç®—å¼•æ“ä¸­ã€‚æ›´å¤šä¿¡æ¯è¯·å‚çœ‹&lt;a href=&#34;https://cloud.google.com/endpoints/docs/grpc/tutorials&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cloud.google.com/endpoints/docs/grpc/tutorials&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ ä¸åœ¨ Google cloud ä¸­è¿è¡Œï¼Œæˆ–è€…æ˜¯åœ¨æœ¬åœ°è¿è¡Œï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ Envoyã€‚å®ƒæ˜¯ä¸€ä¸ªç”± Lyft åˆ›å»ºçš„éå¸¸çµæ´»çš„ä»£ç†ã€‚å®ƒä¹Ÿæ˜¯&lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;istio.io&lt;/a&gt;ä¸­çš„ä¸»è¦ç»„ä»¶ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å°†ä½¿ç”¨å®ƒã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è½¬ç æˆ‘ä»¬éœ€è¦ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸€ä¸ª gRPC æœåŠ¡çš„é¡¹ç›®ï¼Œåœ¨.proto æ–‡ä»¶ä¸­åŒ…å«è½¬ç é€‰é¡¹ã€‚&lt;/li&gt;
&lt;li&gt;ä».proto æ–‡ä»¶ä¸­ç”Ÿæˆçš„.pd æ–‡ä»¶åŒ…å« gRPC æœåŠ¡æè¿°ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨è¯¥å®šä¹‰ï¼Œé…ç½® Envoy ä½œä¸º gRPC æœåŠ¡çš„ HTTP è¯·æ±‚ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ docker è¿è¡Œ Envoyã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;æ­¥éª¤-1&#34;&gt;&lt;strong&gt;æ­¥éª¤ 1&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;æˆ‘å·²ç»åˆ›å»ºäº†å¦‚ä¸Šæè¿°çš„é¡¹ç›®å¹¶å‘å¸ƒåœ¨ github ä¸Šã€‚ä½ å¯ä»¥ä»è¿™é‡Œ cloneï¼š &lt;a href=&#34;https://github.com/toefel18/transcoding-grpc-to-http-json&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github.com/toefel18/transcoding-grpc-to-http-json&lt;/a&gt;ã€‚ç„¶åæ„å»ºå®ƒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Script will download gradle if itâ€™s not installed, no need to install it :)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./gradlew.sh clean build    &lt;span class=&#34;c1&#34;&gt;# windows: ./gradlew.bat clean build&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æç¤ºï¼šæˆ‘åˆ›å»ºäº†è„šæœ¬è‡ªåŠ¨æ‰§è¡Œæ­¥éª¤ 2 åˆ° 4ï¼Œè„šæœ¬åœ¨é¡¹ç›®&lt;a href=&#34;github.com/toefel18/transcoding-grpc-to-http-json&#34;&gt;github.com/toefel18/transcoding-grpc-to-http-json&lt;/a&gt;çš„æ ¹ç›®å½•ä¸‹ã€‚è¿™å°†èŠ‚çœä½ çš„å¼€å‘æ—¶é—´ã€‚æ­¥éª¤ 2 åˆ° 4 è¯¦ç»†çš„è§£é‡Šäº†å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./start-envoy.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ­¥éª¤-2&#34;&gt;&lt;strong&gt;æ­¥éª¤ 2&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;ç„¶åæˆ‘ä»¬éœ€è¦åˆ›å»º.pb æ–‡ä»¶ã€‚æˆ‘ä»¬éœ€è¦å…ˆä¸‹è½½é¢„ç¼–è¯‘çš„ protoc å¯æ‰§è¡Œæ–‡ä»¶ï¼š&lt;a href=&#34;https://github.com/protocolbuffers/protobuf/releases/latest&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github.com/protocolbuffers/protobuf/releases/latest&lt;/a&gt;ï¼ˆä¸ºä½ çš„å¹³å°é€‰æ‹©æ­£ç¡®çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚é’ˆå¯¹ Mac çš„&lt;em&gt;protoc-3.6.1-osx-x86_64.zip&lt;/em&gt;ï¼‰ï¼Œç„¶åè§£å‹åˆ°ä½ çš„è·¯å¾„ï¼Œå¾ˆç®€å•ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;https://github.com/toefel18/transcoding-grpc-to-http-json&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transcoding-grpc-to-http-json&lt;/a&gt;ç›®å½•ä¸‹è¿è¡Œä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆ Envoy å¯ä»¥ç†è§£çš„æ–‡ä»¶ &lt;em&gt;reservation_service_definition.pb&lt;/em&gt; ï¼ˆåˆ«å¿˜äº†å…ˆæ„å»ºé¡¹ç›®å¹¶å¯¼å…¥ &lt;em&gt;reservation_service.proto&lt;/em&gt;éœ€è¦çš„.proto æ–‡ä»¶ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;protoc -I. -Ibuild/extracted-include-protos/main --include_imports &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;               --include_source_info &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;               --descriptor_set_out&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;reservation_service_definition.pb &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;               src/main/proto/reservation_service.proto
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªå‘½ä»¤å¯èƒ½çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†å®é™…ä¸Šéå¸¸ç®€å•ã€‚-I ä»£è¡¨ includeï¼Œprotoc å¯»æ‰¾.proto æ–‡ä»¶çš„ç›®å½•ã€‚&lt;em&gt;â€“descriptor_set_out&lt;/em&gt;è¡¨ç¤ºåŒ…å«å®šä¹‰çš„è¾“å‡ºæ–‡ä»¶ï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬è¦å¤„ç†çš„åŸå§‹æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­¥éª¤-3&#34;&gt;&lt;strong&gt;æ­¥éª¤ 3&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å¿«è¦å®Œæˆäº†ï¼Œåœ¨è¿è¡Œ Envoy ä¹‹å‰ï¼Œæœ€åä¸€ä»¶äº‹æ˜¯åˆ›å»ºé…ç½®æ–‡ä»¶ã€‚Envoy çš„é…ç½®æ–‡ä»¶ä»¥ yaml æè¿°ã€‚ä½ å¯ä»¥ä½¿ç”¨ Envoy åšå¾ˆå¤šäº‹æƒ…ï¼Œä½†æ˜¯ç°åœ¨è®©æˆ‘ä»¬ä¸“æ³¨äºè½¬ç æˆ‘ä»¬çš„æœåŠ¡ã€‚æˆ‘ä»[Envoy çš„ç½‘ç«™](&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http_filters/grpc_json_transcoder_filter#config-http-filters-grpc-json-&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.envoyproxy.io/docs/envoy/latest/configuration/http_filters/grpc_json_transcoder_filter#config-http-filters-grpc-json-&lt;/a&gt; transcocoder)ä¸­è·å–äº†ä¸€ä¸ªåŸºæœ¬çš„é…ç½®ç¤ºä¾‹ï¼Œå¹¶ä½¿ç”¨#æ ‡è®°äº†æ„Ÿå…´è¶£çš„éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;admin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;access_log_path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/tmp/admin_access.log&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address: 0.0.0.0, port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9901&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;static_resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;main-listener&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address: 0.0.0.0, port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;51051&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.http_connection_manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc_json&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;codec_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AUTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;local_route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;local_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;, grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#3 see next line!&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster: grpc-backend-services, timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;seconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;60&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.grpc_json_transcoder&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;proto_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/data/reservation_service_definition.pb&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;services&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;reservations.v1.ReservationService&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;print_options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;add_whitespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;always_print_primitive_fields&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;always_print_enums_as_ints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;preserve_proto_field_names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.router&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-backend-services                 &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1.&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;25s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;logical_dns&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;round_robin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;dns_lookup_family&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;V4_ONLY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http2_protocol_options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;127.0.0.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                       &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;53000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘å·²ç»åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ äº†ä¸€äº›æ ‡è®°æ¥å¼ºè°ƒæˆ‘ä»¬æ„Ÿå…´è¶£çš„éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;#1 admin æ¥å£çš„åœ°å€ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œè·å– prometheus çš„æµ‹é‡æ•°æ®å»æŸ¥è¯¢æœåŠ¡æ˜¯æ€æ ·æ‰§è¡Œçš„ã€‚&lt;/li&gt;
&lt;li&gt;#2 HTTP API çš„å¯ç”¨åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;#3 å°†è¯·æ±‚è·¯ç”±åˆ°åç«¯æœåŠ¡çš„åç§°ã€‚æ­¥éª¤ #7 å®šä¹‰è¿™ä¸ªåå­—ã€‚&lt;/li&gt;
&lt;li&gt;#4 æˆ‘ä»¬ä¹‹å‰ç”Ÿæˆçš„.pb æè¿°ç¬¦æ–‡ä»¶çš„è·¯å¾„ã€‚&lt;/li&gt;
&lt;li&gt;#5 è½¬ç çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;#6 Protobuf å­—æ®µåé€šå¸¸åŒ…å«ä¸‹åˆ’çº¿ã€‚è®¾ç½®è¯¥é€‰é¡¹ä¸º false ä¼šå°†å­—æ®µåè½¬æ¢ä¸ºé©¼å³°å¼ã€‚&lt;/li&gt;
&lt;li&gt;#7 é›†ç¾¤å®šä¹‰äº†ä¸Šæ¸¸æœåŠ¡ï¼ˆåœ¨æ­¥éª¤#3 ä¸­ Envoy ä»£ç†çš„æœåŠ¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;#8 å¯è¿æ¥åç«¯æœåŠ¡çš„åœ°å€å’Œç«¯å£ã€‚æˆ‘ä½¿ç”¨äº† 127.0.0.1/localhostã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ­¥éª¤-4&#34;&gt;&lt;strong&gt;æ­¥éª¤ 4&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬ç°åœ¨å‡†å¤‡è¿è¡Œ Envoyã€‚æœ€ç®€å•çš„æ–¹å¼æ˜¯é€šè¿‡ Docker é•œåƒã€‚è¿™éœ€è¦å…ˆå®‰è£… Dockerã€‚å¦‚æœä½ è¿˜æ²¡æœ‰ï¼Œè¯·å…ˆ&lt;a href=&#34;https://docs.docker.com/install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£… docker&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ä¸¤ä¸ª Envoy éœ€è¦çš„èµ„æºï¼Œé…ç½®æ–‡ä»¶å’Œ.pb æè¿°æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥å…ˆæŠŠæ–‡ä»¶å¯¼å…¥å®¹å™¨ä»¥ä¾¿ Envoy å¯åŠ¨æ—¶æ‰¾åˆ°ä»–ä»¬ã€‚è¿è¡Œä¸‹é¢ github ä»£ç åº“æ ¹ç›®å½•çš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo docker run -it --rm --name envoy --network&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;host&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -v &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;pwd&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/reservation_service_definition.pb:/data/reservation_service_definition.pb:ro&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -v &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;pwd&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/envoy-config.yml:/etc/envoy/envoy.yaml:ro&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  envoyproxy/envoy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœ Envoy æˆåŠŸå¯åŠ¨å°†ä¼šçœ‹åˆ°ä¸‹é¢çš„æ—¥å¿—ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[2018-11-10 14:55:02.058][000009][info][main] [source/server/server.cc:454] starting main dispatch loop
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ³¨æ„ï¼Œæˆ‘åœ¨ docker run å‘½ä»¤ä¸­å°†-network è®¾ç½®ä¸ºâ€œhostâ€ã€‚è¿™æ„å‘³ç€åœ¨æœ¬åœ°å¯ä»¥è®¿é—®æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œè€Œä¸éœ€è¦é¢å¤–çš„ç½‘ç»œé…ç½®ã€‚æ ¹æ®é¡µé¢ &lt;a href=&#34;https://docs.docker.com/docker-for-mac/networking/#i-want-to-connect-from-a-container-to-a-service-on-the-host&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;docs.docker.com/docker-for-mac/networking/&lt;/a&gt;çš„å»ºè®®ï¼Œåº”è¯¥æ›´æ”¹æ­¥éª¤#8 ä¸­ Envoy é…ç½®çš„ IP åœ°å€ä¸º host.docker.internal æˆ– gateway.docker.internalã€‚&lt;/p&gt;
&lt;h2 id=&#34;é€šè¿‡-http-è®¿é—®æœåŠ¡&#34;&gt;&lt;strong&gt;é€šè¿‡ HTTP è®¿é—®æœåŠ¡&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ ç°åœ¨å¯ä»¥ä½¿ç”¨ curl å‘½ä»¤æ¥è®¿é—®æœåŠ¡ã€‚Linux ä¸‹ä½ å¯ä»¥ç›´æ¥è¿æ¥ localhostï¼Œä½†æ˜¯åœ¨ windows æˆ–è€… Mac ä¸‹ä½ å¯èƒ½éœ€è¦é€šè¿‡è™šæ‹Ÿæœºæˆ– docker å®¹å™¨çš„ IP åœ°å€è¿æ¥ã€‚æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥é…ç½® dockerï¼Œè¿™é‡Œä½¿ç”¨ localhostã€‚&lt;/p&gt;
&lt;h4 id=&#34;é€šè¿‡-http-åˆ›å»ºé¢„è®¢&#34;&gt;é€šè¿‡ HTTP åˆ›å»ºé¢„è®¢&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -X POST http://localhost:51051/v1/reservations &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;          -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;          -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;            &amp;#34;title&amp;#34;: &amp;#34;Lunchmeeting2&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;            &amp;#34;venue&amp;#34;: &amp;#34;JDriven Coltbaan 3&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;            &amp;#34;room&amp;#34;: &amp;#34;atrium&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;            &amp;#34;timestamp&amp;#34;: &amp;#34;2018-10-10T11:12:13&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;            &amp;#34;attendees&amp;#34;: [
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;                {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;                    &amp;#34;ssn&amp;#34;: &amp;#34;1234567890&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;                    &amp;#34;firstName&amp;#34;: &amp;#34;Jimmy&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;                    &amp;#34;lastName&amp;#34;: &amp;#34;Jones&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;                },
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;                {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;                    &amp;#34;ssn&amp;#34;: &amp;#34;9999999999&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;                    &amp;#34;firstName&amp;#34;: &amp;#34;Dennis&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;                    &amp;#34;lastName&amp;#34;: &amp;#34;Richie&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;            ]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;        }&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2cec91a7-d2d6-4600-8cc3-4ebf5417ac4b&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Lunchmeeting2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;venue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;JDriven Coltbaan 3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;é€šè¿‡-http-è·å–é¢„è®¢&#34;&gt;é€šè¿‡ HTTP è·å–é¢„è®¢&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„ IDï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://localhost:51051/v1/reservations/ENTER-ID-HERE!
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¾“å‡ºåº”è¯¥å’Œåˆ›å»ºç»“æœä¸€è‡´ã€‚&lt;/p&gt;
&lt;h4 id=&#34;é€šè¿‡-http-è·å–é¢„è®¢åˆ—è¡¨&#34;&gt;é€šè¿‡ HTTP è·å–é¢„è®¢åˆ—è¡¨&lt;/h4&gt;
&lt;p&gt;å¯¹äºè¿™ä¸ªä¾‹å­å¯èƒ½éœ€è¦ä»¥ä¸åŒçš„å­—æ®µå¤šæ¬¡æ‰§è¡Œ CreateReservation æ¥éªŒè¯è¿‡æ»¤å™¨çš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://localhost:51051/v1/reservations&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://localhost:51051/v1/reservations?room=atrium&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://localhost:51051/v1/reservations?room=atrium&amp;amp;attendees.lastName=Jones&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å“åº”ç»“æœæ˜¯ Reservations çš„æ•°ç»„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åˆ é™¤é¢„è®¢&#34;&gt;åˆ é™¤é¢„è®¢&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -X DELETE http://localhost:51051/v1/reservations/ENTER-ID-HERE!
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;è¿”å›å¤´&#34;&gt;è¿”å›å¤´&lt;/h2&gt;
&lt;p&gt;gRPC ä¼šè¿”å›ä¸€äº› HTTP å¤´ã€‚æœ‰äº›å¯ä»¥åœ¨è°ƒè¯•çš„æ—¶å€™å¸®åˆ°ä½ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;grpc-statusï¼šè¿™ä¸ªå€¼æ˜¯ io.grpc.Status.Code çš„åºæ•°ï¼Œå®ƒèƒ½å¸®åŠ©æŸ¥çœ‹ gRPC çš„è¿”å›çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;grpc-messageï¼šä¸€æ—¦å‡ºç°é—®é¢˜è¿”å›çš„é”™è¯¯ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹&lt;a href=&#34;https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-HTTP2.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github.com/grpc/grpc/blob/master/doc/PROTOCOL-HTTP2.md&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç¼ºé™·&#34;&gt;&lt;strong&gt;ç¼ºé™·&lt;/strong&gt;&lt;/h2&gt;
&lt;h4 id=&#34;1-å¦‚æœè·¯å¾„ä¸å­˜åœ¨å“åº”å¾ˆå¥‡æ€ª&#34;&gt;1. å¦‚æœè·¯å¾„ä¸å­˜åœ¨å“åº”å¾ˆå¥‡æ€ª&lt;/h4&gt;
&lt;p&gt;Envoy å·¥ä½œçš„å¾ˆå¥½ï¼Œä½†åœ¨æˆ‘çœ‹æ¥æœ‰æ—¶å€™ä¼šè¿”å›ä¸æ­£ç¡®çš„çŠ¶æ€ç ã€‚æ¯”å¦‚å½“æˆ‘è·å–ä¸€ä¸ªåˆæ³•çš„é¢„è®¢ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://localhost:51051/v1/reservations/ENTER-ID-HERE!
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿”å›çŠ¶æ€ç  200ï¼Œæ²¡é”™ï¼Œä½†å¦‚æœæˆ‘è¿™æ ·åšï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://localhost:51051/v1/reservations/ENTER-ID-HERE!/blabla
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Envoy ä¼šè¿”å›ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;415 Unsupported Media Type
Content-Type is missing from the request
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘æœŸæœ›è¿”å› 404 è€Œä¸æ˜¯ä¸Šé¢è§£é‡Šçš„é”™è¯¯ä¿¡æ¯ã€‚è¿™æœ‰ä¸€ä¸ªç›¸å…³çš„é—®é¢˜ï¼š&lt;a href=&#34;https://github.com/envoyproxy/envoy/issues/5010&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github.com/envoyproxy/envoy/issues/5010&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;: Envoy å°†æ‰€æœ‰è¯·æ±‚è·¯ç”±åˆ° gRPC æœåŠ¡ï¼Œå¦‚æœæœåŠ¡ä¸­ä¸å­˜åœ¨è¯¥è·¯å¾„ï¼ŒgRPC æœåŠ¡æœ¬èº«å°±ä¼šå“åº”è¯¥é”™è¯¯ã€‚è§£å†³æ–¹æ¡ˆæ˜¯åœ¨ Envoy çš„é…ç½®ä¸­æ·»åŠ &amp;rsquo; gRPC:{} &amp;lsquo;ï¼Œä½¿å…¶ä»…è½¬å‘åœ¨ gRPC æœåŠ¡ä¸­å®ç°äº†çš„è¯·æ±‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;local_route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;local_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;, grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}}&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# &amp;lt;--- this fixes it&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster: grpc-backend-services, timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;seconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;60&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;2-æœ‰æ—¶å€™åœ¨æŸ¥è¯¢é›†åˆæ—¶å³ä½¿æœåŠ¡å™¨æœ‰é”™è¯¯å“åº”ä¾ç„¶ä¼šè¿”å›ç©ºèµ„æº&#34;&gt;2. æœ‰æ—¶å€™åœ¨æŸ¥è¯¢é›†åˆæ—¶ï¼Œå³ä½¿æœåŠ¡å™¨æœ‰é”™è¯¯å“åº”ï¼Œä¾ç„¶ä¼šè¿”å›ç©ºèµ„æºâ€˜[]â€™&lt;/h4&gt;
&lt;p&gt;æˆ‘æäº¤äº†è¿™ä¸€é—®é¢˜ç»™ Envoy å¼€å‘è€…ï¼š &lt;a href=&#34;https://github.com/envoyproxy/envoy/issues/5011&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github.com/envoyproxy/envoy/issues/5011&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éƒ¨åˆ†è§£å†³æ–¹æ¡ˆï¼š&lt;/strong&gt; å…¶ä¸­ä¸€éƒ¨åˆ†æ˜¯å·²çŸ¥çš„è½¬ç é™åˆ¶ï¼Œå› ä¸ºçŠ¶æ€å’Œå¤´æ˜¯å…ˆå‘é€çš„ã€‚åœ¨ä¸€ä¸ªå“åº”ä¸­è½¬æ¢å™¨é¦–å…ˆå‘é€ä¸€ä¸ª 200 çŠ¶æ€ç ï¼Œç„¶åå¯¹æµè¿›è¡Œè½¬ç ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å³å°†åˆ°æ¥çš„ç‰¹æ€§&#34;&gt;å³å°†åˆ°æ¥çš„ç‰¹æ€§&lt;/h2&gt;
&lt;p&gt;å°†æ¥è¿˜å¯ä»¥åœ¨å“åº”ä½“ä¸­è¿”å›å“åº”æ¶ˆæ¯çš„å­å­—æ®µï¼Œä»¥ä¾¿ä½ ä¸æƒ³è¿”å›å®Œæ•´çš„å“åº”ä½“ã€‚è¿™å¯ä»¥é€šè¿‡ HTTP é€‰é¡¹ä¸­çš„â€œresponse_bodyâ€å­—æ®µå®Œæˆã€‚å¦‚æœä½ æƒ³åœ¨ HTTP API ä¸­è£å‰ªåŒ…è£…çš„å¯¹è±¡è¿™æ˜¯éå¸¸åˆé€‚çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;
&lt;p&gt;æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹å°† gRPC APIè½¬ç HTTP/JSONæä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„æ¦‚è¿°ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Envoy service meshã€Prometheus å’Œ Grafana ä¸‹çš„å¾®æœåŠ¡ç›‘æ§</title>
      <link>https://cloudnative.to/blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/</link>
      <pubDate>Tue, 20 Nov 2018 11:40:46 +0800</pubDate>
      <guid>https://cloudnative.to/blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://medium.com/@dnivra26/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana-a1c26a8595fc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ åˆšæ¥è§¦â€œService Meshâ€œå’Œâ€œEnvoyâ€ï¼Œæˆ‘&lt;a href=&#34;https://medium.com/@dnivra26/service-mesh-with-envoy-101-e6b2131ee30b&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;æœ‰ä¸€ç¯‡æ–‡ç« å¯ä»¥å¸®ä½ å…¥é—¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯&lt;strong&gt;Envoy service mesh ä¸‹çš„å¯è§‚æµ‹æ€§&lt;/strong&gt;ç³»åˆ—çš„ç¬¬äºŒç¯‡æ–‡ç« ï¼Œä½ å¯ä»¥åœ¨&lt;a href=&#34;https://medium.com/@dnivra26/distributed-tracing-with-envoy-service-mesh-jaeger-c365b6191592&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;é˜…è¯»ç¬¬ä¸€ç¯‡å…³äºåˆ†å¸ƒå¼è¿½è¸ªçš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¾®æœåŠ¡ä¸­è°ˆåŠç›‘æ§æ—¶ï¼Œä½ å¯ä¸èƒ½è¢«è’™åœ¨é¼“é‡Œï¼Œè‡³å°‘è¦çŸ¥é“é—®é¢˜å‡ºåœ¨å“ªå„¿äº†ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹ Envoy æ˜¯æ€æ ·å¸®åŠ©æˆ‘ä»¬äº†è§£æˆ‘ä»¬çš„æœåŠ¡è¿è¡ŒçŠ¶å†µçš„ã€‚åœ¨ service mesh ä¸‹ï¼Œæ‰€æœ‰çš„é€šä¿¡éƒ½ä¼šé€šè¿‡ meshï¼Œè¿™æ„å‘³ç€æ²¡æœ‰ä»»ä½•æœåŠ¡ä¼šä¸å…¶å®ƒæœåŠ¡ç›´æ¥é€šä¿¡ï¼ŒæœåŠ¡å‘ Envoy å‘èµ·è°ƒç”¨è¯·æ±‚ï¼Œç„¶å Envoy å°†è°ƒç”¨è¯·æ±‚è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡ï¼Œæ‰€ä»¥ Envoy å°†æŒæœ‰ä¼ å…¥å’Œä¼ å‡ºæµé‡çš„ä¸Šä¸‹æ–‡ã€‚Envoy é€šå¸¸æä¾›å…³äº&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http_conn_man/stats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¼ å…¥&lt;/a&gt;è¯·æ±‚ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/cluster_manager/cluster_stats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¼ å‡º&lt;/a&gt;è¯·æ±‚å’Œ&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/statistics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy å®ä¾‹çŠ¶æ€&lt;/a&gt;çš„æŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‡†å¤‡&#34;&gt;å‡†å¤‡&lt;/h2&gt;
&lt;p&gt;è¿™æ˜¯æˆ‘ä»¬å°†è¦æ„å»ºçš„ç³»ç»Ÿæ¦‚è§ˆã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-overall-setup&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;overall setup&#34; srcset=&#34;
               /blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwx6wg1dscj30m90cg0sy_hu1a8f6e9c47f32b6e4bd46c5294382cc1_20286_a27979c80841fcf2cbe2ad90d243361b.webp 400w,
               /blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwx6wg1dscj30m90cg0sy_hu1a8f6e9c47f32b6e4bd46c5294382cc1_20286_1c415934c64a528c218e8f56c73aabf7.webp 760w,
               /blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwx6wg1dscj30m90cg0sy_hu1a8f6e9c47f32b6e4bd46c5294382cc1_20286_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwx6wg1dscj30m90cg0sy_hu1a8f6e9c47f32b6e4bd46c5294382cc1_20286_a27979c80841fcf2cbe2ad90d243361b.webp&#34;
               width=&#34;760&#34;
               height=&#34;425&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      overall setup
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;statsd&#34;&gt;Statsd&lt;/h2&gt;
&lt;p&gt;Envoy æ”¯æŒé€šè¿‡ä¸¤åˆ°ä¸‰ç§æ ¼å¼æ¥æš´éœ²æŒ‡æ ‡ï¼Œä½†æœ¬æ–‡ä¸­æˆ‘ä»¬å°†ä½¿ç”¨&lt;a href=&#34;https://github.com/b/statsd_spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;statsd&lt;/a&gt;æ ¼å¼ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æµç¨‹å°†æ˜¯è¿™æ ·ï¼Œé¦–å…ˆ Envoy æ¨é€æŒ‡æ ‡åˆ° statsdï¼Œç„¶åæˆ‘ä»¬ç”¨&lt;a href=&#34;https://github.com/prometheus&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;prometheus&lt;/a&gt;ï¼ˆä¸€ä¸ªæ—¶åºæ•°æ®åº“ï¼‰ä» statsd æ‹‰å–æŒ‡æ ‡ï¼Œæœ€åé€šè¿‡&lt;a href=&#34;https://github.com/grafana/grafana&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;grafana&lt;/a&gt;å¯è§†åŒ–è¿™äº›æŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å‡†å¤‡æ¦‚è§ˆå›¾ä¸­ï¼Œæˆ‘æåˆ°äº† statsd exporter è€Œä¸æ˜¯ statsdï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¹¶ä¸ä¼šç›´æ¥ä½¿ç”¨ statsdï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªæ¥æ”¶ statsd æ ¼å¼æ•°æ®ï¼Œå¹¶å°†å…¶ä»¥ prometheus æ ¼å¼è¾“å‡ºçš„è½¬æ¢å™¨ï¼ˆæœåŠ¡ï¼‰ã€‚ä¸‹é¢è®©æˆ‘ä»¬æ¥æå®šå®ƒå§ã€‚&lt;/p&gt;
&lt;p&gt;Envoy çš„æŒ‡æ ‡ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Counterï¼ˆè®¡æ•°å™¨ï¼‰ï¼šä¸€ä¸ªåªå¢ä¸å‡çš„æŒ‡æ ‡ã€‚å¦‚ï¼šè¯·æ±‚æ€»æ•°&lt;/li&gt;
&lt;li&gt;Gaugeï¼ˆé‡è¡¨ï¼‰ï¼šä¸€ä¸ªå¯å¢å¯å‡çš„æŒ‡æ ‡ï¼Œç±»ä¼¼äºä¸€ä¸ªç¬æ—¶å€¼ã€‚å¦‚ï¼šå½“å‰ CPU ä½¿ç”¨é‡&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªåŒ…å« stats sink çš„ Envoy é…ç½®&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;admin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;access_log_path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/tmp/admin_access.log&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9901&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stats_sinks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.statsd&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tcp_cluster_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;statsd-exporter&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;front-envoy    &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;static_resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http_listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;use_remote_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;add_user_agent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;access_log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.file_access_log&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/dev/stdout&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[ACCESS_LOG][%START_TIME%] \&amp;#34;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&amp;#34; %RESPONSE_CODE% %RESPONSE_FLAGS% %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&amp;#34;%REQ(X-FORWARDED-FOR)%\&amp;#34; \&amp;#34;%REQ(USER-AGENT)%\&amp;#34; \&amp;#34;%REQ(X-REQUEST-ID)%\&amp;#34; \&amp;#34;%REQ(:AUTHORITY)%\&amp;#34; \&amp;#34;%UPSTREAM_HOST%\&amp;#34; \&amp;#34;%DOWNSTREAM_REMOTE_ADDRESS_WITHOUT_PORT%\&amp;#34;\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ingress_443&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;codec_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;AUTO&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;generate_request_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;local_route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_a&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.router&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;statsd&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.25s&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;strict_dns&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ROUND_ROBIN&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;-&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;statsd_exporter&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9125&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_a&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.25s&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;strict_dns&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ROUND_ROBIN&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_a_envoy&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8786&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¬¬ 8-13 è¡Œå‘Šè¯‰ Envoy æˆ‘ä»¬éœ€è¦ statsd æ ¼å¼çš„æŒ‡æ ‡ã€æˆ‘ä»¬çš„ç»Ÿè®¡ä¿¡æ¯å‰ç¼€ï¼ˆé€šå¸¸æ˜¯ä½ çš„æœåŠ¡åï¼‰æ˜¯ä»€ä¹ˆå’Œ statsd sink çš„åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ 55-63 è¡Œé…ç½®äº†æˆ‘ä»¬çš„ç¯å¢ƒä¸­çš„ statsd sinkã€‚&lt;/p&gt;
&lt;p&gt;è¿™å°±æ˜¯è®© Envoy è¾“å‡ºç»Ÿè®¡ä¿¡æ¯æ‰€éœ€è¦çš„æ‰€æœ‰é…ç½®ã€‚ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹ç¬¬ 2-7 è¡Œåšäº†å“ªäº›äº‹æƒ…ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Envoy åœ¨ 9901 ç«¯å£æš´éœ²äº†ä¸€ä¸ªç®¡ç†ç«¯ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒåŠ¨æ€åœ°æ”¹å˜æ—¥å¿—çº§åˆ«ï¼ŒæŸ¥çœ‹å½“å‰é…ç½®ã€ç»Ÿè®¡æ•°æ®ç­‰&lt;/li&gt;
&lt;li&gt;Envoy ä¹Ÿå¯ä»¥ç”Ÿæˆä¸ nginx ç±»ä¼¼çš„è®¿é—®æ—¥å¿—ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒäº†è§£æœåŠ¡é—´çš„é€šä¿¡çŠ¶å†µã€‚è®¿é—®æ—¥å¿—çš„æ ¼å¼ä¹Ÿæ˜¯å¯é…ç½®çš„ï¼Œå¦‚ç¬¬ 29-33 è¡Œ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä½ éœ€è¦å°†ç›¸åŒçš„é…ç½®æ·»åŠ åˆ°ç³»ç»Ÿä¸­çš„å…¶å®ƒ Envoy sidecar ä¸Šï¼ˆæ˜¯çš„ï¼Œæ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„ Envoy sidecarï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›æœåŠ¡æœ¬èº«æ˜¯ç”¨ go å†™çš„ï¼Œå®ƒä»¬åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œä»…ä»…æ˜¯é€šè¿‡ Envoy è°ƒç”¨å…¶å®ƒæœåŠ¡ã€‚ä½ å¯ä»¥åœ¨&lt;a href=&#34;https://github.com/dnivra26/envoy_monitoring&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;æŸ¥çœ‹æœåŠ¡å’Œ Envoy çš„é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œè™½ç„¶æˆ‘ä»¬åªæœ‰å›¾ä¸­çš„ statsd exporterï¼Œä½†æœ‰äº†å®ƒï¼Œå¦‚æœæˆ‘ä»¬è¿è¡Œ docker å®¹å™¨ï¼ˆdocker-compose build &amp;amp; docker-compose upï¼‰ï¼Œç„¶åå‘ Front Envoyï¼ˆlocalhost:8080ï¼‰å‘é€ä¸€äº›æµé‡ï¼ŒEnvoy å°†æŠŠè¿™äº›æµé‡çš„æŒ‡æ ‡å‘é€åˆ° statsd exporterï¼Œéšå statsd exporter ä¼šæŠŠè¿™äº›æŒ‡æ ‡è½¬æ¢æˆ prometheus æ ¼å¼ï¼Œå¹¶å°†å…¶æš´éœ²åœ¨ 9102 ç«¯å£ã€‚&lt;/p&gt;
&lt;p&gt;Statsd exporter ä¸­çš„ç»Ÿè®¡ä¿¡æ¯æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤º&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ¥è‡ª-statsd-exporter-çš„-prometheus-æ ¼å¼çš„æŒ‡æ ‡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ¥è‡ª statsd exporter çš„ prometheus æ ¼å¼çš„æŒ‡æ ‡&#34; srcset=&#34;
               /blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwxf9t7t5bj318g0azgof_hu41ff2ee5810d69b56f9da0c514a4d8c7_85429_ea4fa309ae0a7c9c2d9fb417a9db0b32.webp 400w,
               /blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwxf9t7t5bj318g0azgof_hu41ff2ee5810d69b56f9da0c514a4d8c7_85429_2ff12d8658affe3a7b63b0d7f3a2e478.webp 760w,
               /blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwxf9t7t5bj318g0azgof_hu41ff2ee5810d69b56f9da0c514a4d8c7_85429_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwxf9t7t5bj318g0azgof_hu41ff2ee5810d69b56f9da0c514a4d8c7_85429_ea4fa309ae0a7c9c2d9fb417a9db0b32.webp&#34;
               width=&#34;760&#34;
               height=&#34;188&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ¥è‡ª statsd exporter çš„ prometheus æ ¼å¼çš„æŒ‡æ ‡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™é‡Œè¾¹å°†æœ‰ä¸Šç™¾ä¸ªæŒ‡æ ‡ï¼ŒåŒæ—¶ï¼Œåœ¨ä¸Šé¢çš„æˆªå›¾ä¸­æˆ‘ä»¬èƒ½çœ‹åˆ° Service A å’Œ Service B ä¹‹é—´çš„é€šä¿¡å»¶è¿ŸæŒ‡æ ‡ã€‚ä¸Šå›¾çš„æŒ‡æ ‡æ˜¯éµå¾ª prometheus æ ¼å¼çš„&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;metric_name [&amp;#34;{&amp;#34; label_name &amp;#34;=&amp;#34; `&amp;#34;` label_value `&amp;#34;` { &amp;#34;,&amp;#34; label_name &amp;#34;=&amp;#34; `&amp;#34;` label_value `&amp;#34;` } [ &amp;#34;,&amp;#34; ] &amp;#34;}&amp;#34;] value [ timestamp ]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½ å¯ä»¥åœ¨&lt;a href=&#34;https://github.com/prometheus/docs/blob/master/content/docs/instrumenting/exposition_formats.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;äº†è§£æ›´å¤šã€‚&lt;/p&gt;
&lt;h2 id=&#34;prometheus&#34;&gt;Prometheus&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨&lt;a href=&#34;https://prometheus.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus&lt;/a&gt;ä½œä¸ºæ—¶åºæ•°æ®åº“æ¥ä¿å­˜æˆ‘ä»¬çš„æŒ‡æ ‡ã€‚Prometheus ä¸ä»…æ˜¯ä¸€ä¸ªæ—¶åºæ•°æ®åº“ï¼Œå®ƒæœ¬èº«è¿˜æ˜¯ä¸€ä¸ªç›‘æ§ç³»ç»Ÿï¼Œä½†æœ¬æ–‡æˆ‘ä»¬åªç”¨å®ƒæ¥å­˜å‚¨æŒ‡æ ‡æ•°æ®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œprometheus æ˜¯ä¸€ä¸ªé€šè¿‡ä¸»åŠ¨æ‹‰å–æ¥è·å–æŒ‡æ ‡çš„ç³»ç»Ÿï¼Œè¿™æ„å‘³ç€ä½ å¿…é¡»å‘Šè¯‰ prometheus ä»ä½•å¤„æ‹‰å–æŒ‡æ ‡ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ä» statsd exporter å¤„æ‹‰å–ã€‚&lt;/p&gt;
&lt;p&gt;å°† Prometheus æ·»åŠ åˆ°ç³»ç»Ÿä¸­éå¸¸ç®€å•è€Œåˆç›´æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ‹‰å–ç›®æ ‡ï¼ˆstatsd exporterï¼‰ä½œä¸ºé…ç½®æ–‡ä»¶ä¼ é€’ç»™ Prometheus å°±å¯ä»¥äº†ã€‚é…ç½®çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;global&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;scrape_interval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;15s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;scrape_configs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;job_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;statsd&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;scrape_interval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;5s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;static_configs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;targets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;statsd_exporter:9102&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;services&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;scrape_interval çš„å€¼è¡¨ç¤º Prometheus ä»ç›®æ ‡å¤„æ‹‰å–é…ç½®çš„é¢‘ç‡ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨å¯åŠ¨ Prometheusï¼Œé‡Œé¢åº”è¯¥æœ‰ä¸€äº›æ•°æ®äº†ã€‚è®©æˆ‘ä»¬æ‰“å¼€ localhost:9090 æ¥çœ‹ä¸€çœ‹&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-prometheus-æŸ¥è¯¢é¡µé¢&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;prometheus æŸ¥è¯¢é¡µé¢&#34; srcset=&#34;
               /blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwy55z3klmj31jk0f6gmd_hu4ef9a9c5e6eda6fe39ac7592dcc0c8e3_20731_1a555e7f4109e1ec9acbcaa4210b866c.webp 400w,
               /blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwy55z3klmj31jk0f6gmd_hu4ef9a9c5e6eda6fe39ac7592dcc0c8e3_20731_3c7eb08b7848f9c7b5118c147a493ff4.webp 760w,
               /blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwy55z3klmj31jk0f6gmd_hu4ef9a9c5e6eda6fe39ac7592dcc0c8e3_20731_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwy55z3klmj31jk0f6gmd_hu4ef9a9c5e6eda6fe39ac7592dcc0c8e3_20731_1a555e7f4109e1ec9acbcaa4210b866c.webp&#34;
               width=&#34;760&#34;
               height=&#34;207&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      prometheus æŸ¥è¯¢é¡µé¢
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æŒ‡æ ‡ã€‚ä½ èƒ½åšçš„å¯ä¸ä»…ä»…æ˜¯é€‰æ‹©å·²æœ‰çš„æŒ‡æ ‡ï¼Œä»&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/basics/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;å¯ä»¥é˜…è¯»å…³äº prometheus æŸ¥è¯¢è¯­è¨€çš„æ›´å¤šä¿¡æ¯ã€‚å®ƒè¿˜å¯ä»¥åŸºäºæŸ¥è¯¢ç»“æœç»˜åˆ¶å›¾è¡¨ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€ä¸ªæŠ¥è­¦ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬æ‰“å¼€ prometheus çš„ targets é¡µé¢ï¼Œå°†èƒ½çœ‹åˆ°æ‰€æœ‰çš„æ‹‰å–ç›®æ ‡å’Œå®ƒä»¬çš„å¥åº·çŠ¶æ€&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-prometheus-ç›®æ ‡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;prometheus ç›®æ ‡&#34; srcset=&#34;
               /blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwy5occy0pj31jk0gbjs6_huc8980fa15c2d942fba64d233899fc6a8_24181_6cba581dc20efb7b95dc21d179cccb85.webp 400w,
               /blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwy5occy0pj31jk0gbjs6_huc8980fa15c2d942fba64d233899fc6a8_24181_edfb46142141ef3ff712a8f8583b059f.webp 760w,
               /blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwy5occy0pj31jk0gbjs6_huc8980fa15c2d942fba64d233899fc6a8_24181_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwgy1fwy5occy0pj31jk0gbjs6_huc8980fa15c2d942fba64d233899fc6a8_24181_6cba581dc20efb7b95dc21d179cccb85.webp&#34;
               width=&#34;760&#34;
               height=&#34;223&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      prometheus ç›®æ ‡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;grafana&#34;&gt;Grafana&lt;/h2&gt;
&lt;p&gt;Grafana æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„ç›‘æ§å¯è§†åŒ–è§£å†³æ–¹æ¡ˆï¼Œå®ƒæ”¯æŒ Prometheusï¼ŒGraphiteï¼ŒInfluxDBï¼ŒElasticSearch ç­‰å¤šç§åç«¯ã€‚&lt;/p&gt;
&lt;p&gt;Grafana æœ‰ä¸¤å¤§ä¸»è¦ç»„ä»¶éœ€è¦æˆ‘ä»¬é…ç½®&lt;/p&gt;
&lt;p&gt;(1). æ•°æ®æºï¼ˆDatasourceï¼‰ï¼šæŒ‡å®š grafana ä»å“ªä¸ªåç«¯è·å–æŒ‡æ ‡ã€‚ä½ å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥é…ç½®æ•°æ®æºï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤º&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;datasources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;prometheus&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;prometheus&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;access&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http://prometheus:9090&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;editable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;(2). ä»ªè¡¨ç›˜ï¼ˆDashboardï¼‰ï¼šä½ å¯ä»¥ä»ä»ªè¡¨ç›˜æŸ¥çœ‹æ¥è‡ªæ•°æ®æºçš„æŒ‡æ ‡ã€‚Grafana æ”¯æŒå¤šç§å¯è§†åŒ–å…ƒç´ ï¼Œå¦‚ Graphsï¼ŒSingle Statsï¼ŒHeatmapsâ€¦â€¦ä½ å¯ä»¥ç»§æ‰¿è¿™äº›å…ƒç´ å¹¶ä½¿ç”¨æ’ä»¶æ¥æ„é€ è‡ªå·±çš„å…ƒç´ ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘åœ¨ä½¿ç”¨ Grafana æ—¶é‡åˆ°çš„å”¯ä¸€ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œç¼ºå°‘ä¸€ç§æ ‡å‡†çš„æ–¹æ³•æ¥ç”¨ä»£ç å¼€å‘é‚£äº›ä»ªè¡¨ç›˜ã€‚æ‰€å¹¸æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹çš„åº“æä¾›äº†æ”¯æŒï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¥è‡ª weaveworks çš„&lt;a href=&#34;https://github.com/weaveworks/grafanalib&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;grafanalib&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æˆ‘ä»¬é€šè¿‡ python ä»£ç å°è¯•æ„å»ºçš„ä¸€ä¸ªä»ªè¡¨ç›˜&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;grafanalib.core&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;os&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;dashboard&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Dashboard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;title&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Services Dashboard&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;templating&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Templating&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;Template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;source&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;dataSource&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;prometheus&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;metrics(.*_cluster_.*_upstream_rq_2xx)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/(.*)_cluster_.*_upstream_rq_2xx/&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_a&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;Template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;destination&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;dataSource&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;prometheus&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;metrics(.*_cluster_.*_upstream_rq_2xx)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/.*_cluster_(.*)_upstream_rq_2xx/&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;service_b&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;panels&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;Graph&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;title&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2XX&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;transparent&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;dataSource&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;prometheus&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;targets&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;n&#34;&gt;Target&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;n&#34;&gt;expr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[[source]]_cluster_[[destination]]_upstream_rq_2xx - [[source]]_cluster_[[destination]]_upstream_rq_2xx offset $__interval&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;n&#34;&gt;legendFormat&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2xx&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;Graph&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;title&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;5XX&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;transparent&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;dataSource&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;prometheus&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;targets&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;n&#34;&gt;Target&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;n&#34;&gt;expr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[[source]]_cluster_[[destination]]_upstream_rq_5xx - [[source]]_cluster_[[destination]]_upstream_rq_5xx offset $__interval&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;n&#34;&gt;legendFormat&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;5xx&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;Graph&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;title&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Latency&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;transparent&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;dataSource&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;prometheus&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;targets&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;n&#34;&gt;Target&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;n&#34;&gt;expr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[[source]]_cluster_[[destination]]_upstream_rq_time&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;n&#34;&gt;legendFormat&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{{quantile}}&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;auto_panel_ids&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸º 2xxï¼Œ5xx å’Œå»¶è¿Ÿæ•°æ®æ„å»ºäº†å›¾è¡¨ã€‚å…¶ä¸­ç¬¬ 5-22 è¡Œå¾ˆé‡è¦ï¼Œå®ƒä»æˆ‘ä»¬çš„è®¾ç½®ä¸­æå–å¯ç”¨çš„ service names ä½œä¸º grafana çš„å˜é‡ï¼Œä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŠ¨æ€çš„ä»ªè¡¨ç›˜ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬èƒ½å¤Ÿé€‰æ‹©æ€§åœ°æŸ¥çœ‹ç‰¹å®šæºæœåŠ¡å’Œç›®æ ‡æœåŠ¡çš„ç»Ÿè®¡æ•°æ®ã€‚å¦‚æœæƒ³äº†è§£æ›´å¤šå…³äºå˜é‡çš„å†…å®¹è¯·å‚è€ƒ&lt;a href=&#34;http://docs.grafana.org/reference/templating/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä½ éœ€è¦é€šè¿‡ grafanalib å‘½ä»¤æ¥ä»ä¸Šè¿° python æ–‡ä»¶ç”Ÿæˆä»ªè¡¨ç›˜&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     generate-dashboard -o dashboard.json service-dashboard.py
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„è¿™é‡Œç”Ÿæˆçš„ dashboard.json å¯ä¸å®¹æ˜“é˜…è¯»ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œå¯åŠ¨ Grafana æ—¶æˆ‘ä»¬åªéœ€è¦ä¼ é€’ä»ªè¡¨ç›˜å’Œæ•°æ®æºå°±å¥½äº†ã€‚å½“è®¿é—® http:localhost:3000 æ—¶ï¼Œä½ å°†çœ‹åˆ°ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-grafana-ä»ªè¡¨ç›˜&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;grafana ä»ªè¡¨ç›˜&#34; srcset=&#34;
               /blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwly1fx6n732mrdj31jk0h7jsc_hu3e0ed3d14a7a0ba1de654e0e575e9d49_28385_e037be81a4461c4392ac8f7b2acf0d83.webp 400w,
               /blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwly1fx6n732mrdj31jk0h7jsc_hu3e0ed3d14a7a0ba1de654e0e575e9d49_28385_e7c988f1bcad84ad1394b47670dd78b5.webp 760w,
               /blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwly1fx6n732mrdj31jk0h7jsc_hu3e0ed3d14a7a0ba1de654e0e575e9d49_28385_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/microservices-monitoring-with-envoy-service-mesh-prometheus-grafana/006tNbRwly1fx6n732mrdj31jk0h7jsc_hu3e0ed3d14a7a0ba1de654e0e575e9d49_28385_e037be81a4461c4392ac8f7b2acf0d83.webp&#34;
               width=&#34;760&#34;
               height=&#34;236&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      grafana ä»ªè¡¨ç›˜
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç°åœ¨ä½ åº”è¯¥èƒ½çœ‹åˆ° 2xxï¼Œ5xx å’Œå»¶è¿Ÿçš„å›¾è¡¨ï¼ŒåŒæ—¶è¿˜èƒ½çœ‹åˆ°ä¸€ä¸ªä¸‹æ‹‰èœå•ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒé€‰æ‹©æºæœåŠ¡å’Œç›®æ ‡æœåŠ¡ã€‚å…³äº Grafana è¿˜æœ‰è®¸å¤šå†…å®¹æˆ‘ä»¬æ²¡æœ‰è®¨è®ºåˆ°ï¼ŒåŒ…æ‹¬å¼ºå¤§çš„æŸ¥è¯¢ç¼–è¾‘å™¨å’Œå‘Šè­¦ç³»ç»Ÿã€‚æ›´é‡è¦çš„æ˜¯ï¼Œè¿™ä¸€åˆ‡éƒ½æ˜¯å¯ä»¥é€šè¿‡æ’ä»¶å’Œåº”ç”¨æ‰©å±•çš„ï¼Œå¯ä»¥å‚è€ƒ&lt;a href=&#34;https://github.com/grafana/kubernetes-app&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;çš„ä¾‹å­ã€‚å¦‚æœä½ æ­£æƒ³å¯è§†åŒ–å¸¸è§æœåŠ¡å¦‚ redisï¼Œrabbitmq ç­‰çš„æŒ‡æ ‡ï¼Œgrafana æœ‰ä¸€ä¸ª&lt;a href=&#34;https://grafana.com/dashboards&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¬å…±ä»ªè¡¨ç›˜&lt;/a&gt;åº“ï¼Œä½ åªéœ€è¦å¯¼å…¥å®ƒä»¬å°±å¯ä»¥ä½¿ç”¨äº†ã€‚ä½¿ç”¨ Grafana è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œä½ å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å’Œä»£ç åˆ›å»ºå’Œç®¡ç†æ‰€æœ‰ä¸œè¥¿ï¼Œè€Œä¸éœ€è¦è¿‡å¤šåœ°é€šè¿‡ UI æ¥æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å»ºè®®ä½ è¯•ç”¨ä¸€ä¸‹ prometheus å’Œ grafana ä»¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœ‰å»ºè®®å’Œæ„è§ï¼Œè¯·å†™åœ¨è¯„è®ºä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;https://github.com/dnivra26/envoy_monitoring/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;å¯ä»¥æ‰¾åˆ°æ‰€æœ‰ä»£ç å’Œé…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Envoyï¼ŒgRPC å’Œé€Ÿç‡é™åˆ¶</title>
      <link>https://cloudnative.to/blog/envoy-grpc-and-rate-limiting/</link>
      <pubDate>Thu, 15 Nov 2018 13:20:46 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-grpc-and-rate-limiting/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://venilnoronha.io/envoy-grpc-and-rate-limiting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;æ˜¯ä¸“ä¸º Cloud Native åº”ç”¨è®¾è®¡çš„è½»é‡çº§æœåŠ¡ä»£ç†ï¼Œä¹Ÿæ˜¯ä¸ºæ•°ä¸å¤šçš„æ”¯æŒ&lt;a href=&#34;https://grpc.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC&lt;/a&gt;çš„ä»£ç†ä¹‹ä¸€ã€‚gRPC æ˜¯ä¸€ä¸ªåŸºäº&lt;a href=&#34;https://en.wikipedia.org/wiki/HTTP/2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP/2&lt;/a&gt;çš„é«˜æ€§èƒ½ RPCï¼ˆ&lt;a href=&#34;https://en.wikipedia.org/wiki/Remote_procedure_call&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿œç¨‹è¿‡ç¨‹è°ƒç”¨&lt;/a&gt;ï¼‰æ¡†æ¶ï¼Œæ”¯æŒå¤šç§è¯­è¨€ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy&#34; srcset=&#34;
               /blog/envoy-grpc-and-rate-limiting/006tNbRwly1fx4iq37avnj31kw0j1ju5_hu0d13c6884cc981587c6010a9318039c6_29557_5626d41d3a90fd3cb24c375640da59a5.webp 400w,
               /blog/envoy-grpc-and-rate-limiting/006tNbRwly1fx4iq37avnj31kw0j1ju5_hu0d13c6884cc981587c6010a9318039c6_29557_364aeb41e2a252717d215d2ef3542e21.webp 760w,
               /blog/envoy-grpc-and-rate-limiting/006tNbRwly1fx4iq37avnj31kw0j1ju5_hu0d13c6884cc981587c6010a9318039c6_29557_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-grpc-and-rate-limiting/006tNbRwly1fx4iq37avnj31kw0j1ju5_hu0d13c6884cc981587c6010a9318039c6_29557_5626d41d3a90fd3cb24c375640da59a5.webp&#34;
               width=&#34;760&#34;
               height=&#34;254&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ gRPC å’Œ&lt;a href=&#34;https://developers.google.com/protocol-buffers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Protocol Buffers&lt;/a&gt;æ„å»º C++è¯­è¨€ç‰ˆæœ¬çš„&lt;a href=&#34;https://grpc.io/docs/quickstart/cpp.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Greeter åº”ç”¨&lt;/a&gt;ï¼Œä½¿ç”¨&lt;a href=&#34;https://golang.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Go&lt;/a&gt;è¯­è¨€æ„å»ºå¦ä¸€ä¸ª gRPC åº”ç”¨ï¼Œå®ç° Envoy çš„&lt;a href=&#34;https://github.com/envoyproxy/envoy/blob/71152b710e3543732464fca57c8f07b7395de68d/api/envoy/service/ratelimit/v2/rls.proto#L11-L15&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RateLimitService&lt;/a&gt;æ¥å£ã€‚æœ€åï¼Œå°† Envoy éƒ¨ç½²ä¸º Greeter åº”ç”¨çš„ä»£ç†ï¼Œä½¿ç”¨æˆ‘ä»¬çš„é€Ÿç‡é™åˆ¶æœåŠ¡å®ç°&lt;a href=&#34;https://www.learnenvoy.io/articles/backpressure.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åå‹æœºåˆ¶&lt;/a&gt;ï¼ˆbackpressureï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;grpc-greeter-åº”ç”¨&#34;&gt;gRPC Greeter åº”ç”¨&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬é¦–å…ˆå®‰è£…&lt;a href=&#34;https://grpc.io/docs/quickstart/cpp.html#install-grpc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC&lt;/a&gt;å’Œ&lt;a href=&#34;https://grpc.io/docs/quickstart/cpp.html#install-protocol-buffers-v3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Protobuf&lt;/a&gt;ï¼Œç„¶å&lt;a href=&#34;https://grpc.io/docs/quickstart/cpp.html#build-the-example&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ„å»º C++è¯­è¨€ç‰ˆæœ¬çš„ Greeter åº”ç”¨&lt;/a&gt;ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡é€‰æ‹©&lt;a href=&#34;https://grpc.io/docs/quickstart/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡æ¡£ä¸­åˆ—å‡ºçš„å…¶ä»–è¯­è¨€&lt;/a&gt;æ¥æ„å»ºæ­¤åº”ç”¨ç¨‹åº; ä½†æ˜¯ï¼Œæˆ‘å°†åœ¨æœ¬æ–‡ä¸­ä½¿ç”¨ C++ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ Greeter åº”ç”¨çš„ç¤ºæ„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-greeter&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Greeter&#34; srcset=&#34;
               /blog/envoy-grpc-and-rate-limiting/006tNbRwly1fx4knp84toj30ex03p0sx_hua02eb78b7158e8961c92789d4c261d0e_9345_8a5baad66aba5f419dfe114baa924438.webp 400w,
               /blog/envoy-grpc-and-rate-limiting/006tNbRwly1fx4knp84toj30ex03p0sx_hua02eb78b7158e8961c92789d4c261d0e_9345_c2ec0f53af9a1751ea1dfed63e5944ec.webp 760w,
               /blog/envoy-grpc-and-rate-limiting/006tNbRwly1fx4knp84toj30ex03p0sx_hua02eb78b7158e8961c92789d4c261d0e_9345_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-grpc-and-rate-limiting/006tNbRwly1fx4knp84toj30ex03p0sx_hua02eb78b7158e8961c92789d4c261d0e_9345_8a5baad66aba5f419dfe114baa924438.webp&#34;
               width=&#34;537&#34;
               height=&#34;133&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Greeter
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿è¡Œ Greeter åº”ç”¨æ—¶ï¼Œç»ˆç«¯ä¸­ä¼šæœ‰ä»¥ä¸‹è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ./greeter_server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Server listening on 0.0.0.0:50051
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ./greeter_client
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Greeter received: Hello world
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å‡çº§-grpc-greeter-åº”ç”¨&#34;&gt;å‡çº§ gRPC Greeter åº”ç”¨&lt;/h2&gt;
&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨å¸¦æœ‰è¯·æ±‚è®¡æ•°å‰ç¼€çš„è¿”å›å€¼æ›¿ä»£é™æ€çš„â€œHelloâ€å‰ç¼€ï¼Œæ¥å¢å¼º Greeter åº”ç”¨ã€‚åªéœ€æ›´æ–°&lt;code&gt;greeter_server.cc&lt;/code&gt;æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; // Logic and data behind the server&amp;#39;s behavior.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; class GreeterServiceImpl final : public Greeter::Service {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gi&#34;&gt;+  int counter = 0;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   Status SayHello(ServerContext* context, const HelloRequest* request,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   HelloReply* reply) override {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gd&#34;&gt;-    std::string prefix(&amp;#34;Hello &amp;#34;);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    std::string prefix(std::to_string(++counter) + &amp;#34; &amp;#34;);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;     reply-&amp;gt;set_message(prefix + request-&amp;gt;name());
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     return Status::OK;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åé‡æ–°æ„å»ºå’Œè¿è¡Œ&lt;code&gt;greeter_server&lt;/code&gt;ï¼Œé€šè¿‡&lt;code&gt;greeter_client&lt;/code&gt;å‘é€è¯·æ±‚æ—¶ä½ å°±èƒ½çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;1..3&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; ./greeter_client&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; sleep 1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Greeter received: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; world
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Greeter received: &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; world
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Greeter received: &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; world
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç®€å•é€Ÿç‡é™åˆ¶æœåŠ¡&#34;&gt;ç®€å•é€Ÿç‡é™åˆ¶æœåŠ¡&lt;/h2&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡æ‰©å±• Envoy çš„&lt;a href=&#34;https://github.com/envoyproxy/envoy/blob/71152b710e3543732464fca57c8f07b7395de68d/api/envoy/service/ratelimit/v2/rls.proto#L11-L15&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RateLimitService&lt;/a&gt;åŸå‹æ¥å£ï¼Œç”¨ Go è¯­è¨€å®ç°ä¸€ä¸ªç®€å•çš„é€Ÿç‡é™åˆ¶æœåŠ¡ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º&lt;code&gt;rate-limit-service&lt;/code&gt;çš„ Go é¡¹ç›®ï¼Œå¹¶å¼•å…¥ Envoy çš„&lt;a href=&#34;https://github.com/envoyproxy/go-control-plane&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;go-control-plane&lt;/a&gt;å’Œå…¶å®ƒç›¸å…³ä¾èµ–ã€‚&lt;code&gt;go-control-plane&lt;/code&gt;é¡¹ç›®ä¸º Envoy åŸå‹æä¾›äº† Go è¯­è¨€ç»‘å®šã€‚ä¸ºäº†åç»­å®ç°é€Ÿç‡é™åˆ¶æœåŠ¡ï¼Œæˆ‘ä»¬è¿˜éœ€åˆ›å»º&lt;code&gt;cmd/server/main.go&lt;/code&gt;å’Œ&lt;code&gt;cmd/client/main.go&lt;/code&gt;ä¸¤ä¸ªæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ mkdir -p &lt;span class=&#34;nv&#34;&gt;$GOPATH&lt;/span&gt;/src/github.com/venilnoronha/rate-limit-service/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$GOPATH&lt;/span&gt;/src/github.com/venilnoronha/rate-limit-service/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ mkdir -p cmd/server/ &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; touch cmd/server/main.go
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ mkdir cmd/client/ &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; touch cmd/client/main.go
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¼•å…¥äº†æ‰€æœ‰ä¾èµ–ä¹‹åï¼Œä½ å°†è·å¾—ä¸€ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„é¡¹ç›®ç»“æ„ã€‚æ³¨æ„æˆ‘åªçªå‡ºåˆ—å‡ºäº†è¿™ä¸ªå®éªŒç›¸å…³çš„åŒ…ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;â”€â”€ rate-limit-service
   â”œâ”€â”€ cmd
   â”‚   â”œâ”€â”€ client
   â”‚   â”‚   â””â”€â”€ main.go
   â”‚   â””â”€â”€ server
   â”‚       â””â”€â”€ main.go
   â””â”€â”€ vendor
       â”œâ”€â”€ github.com
       â”‚   â”œâ”€â”€ envoyproxy
       â”‚   â”‚   â”œâ”€â”€ data-plane-api
       â”‚   â”‚   â””â”€â”€ go-control-plane
       â”‚   â”œâ”€â”€ gogo
       â”‚   â”‚   â”œâ”€â”€ googleapis
       â”‚   â”‚   â””â”€â”€ protobuf
       â”‚   â””â”€â”€ lyft
       â”‚       â””â”€â”€ protoc-gen-validate
       â””â”€â”€ google.golang.org
           â”œâ”€â”€ genproto
           â””â”€â”€ grpc
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;é€Ÿç‡é™åˆ¶æœåŠ¡ç«¯&#34;&gt;é€Ÿç‡é™åˆ¶æœåŠ¡ç«¯&lt;/h3&gt;
&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„ gRPC é€Ÿç‡é™åˆ¶æœåŠ¡ï¼Œæ¥é™åˆ¶æ¯ç§’çš„è¯·æ±‚æ•°ï¼ˆè¯‘è€…æ³¨ï¼šä¾‹å­å®ç°æ˜¯äº¤æ›¿é™åˆ¶è¯·æ±‚ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;google.golang.org/grpc/reflection&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;rls&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/envoyproxy/go-control-plane/envoy/service/ratelimit/v2&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// server is used to implement rls.RateLimitService
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// limit specifies if the next request is to be rate limited
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;limit&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ShouldRateLimit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;request&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RateLimitRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RateLimitResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;request: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// logic to rate limit every second request
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;overallCode&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RateLimitResponse_Code&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;limit&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;overallCode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RateLimitResponse_OVER_LIMIT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;limit&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;overallCode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RateLimitResponse_OK&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;limit&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RateLimitResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;OverallCode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;overallCode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;response: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// create a TCP listener on port 50052
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;lis&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Listen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;:50052&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to listen: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;listening on %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lis&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// create a gRPC server and register the RateLimitService server
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;rls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterRateLimitServiceServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;limit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;reflection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Register&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Serve&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lis&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to serve: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯åŠ¨&lt;code&gt;RateLimitService&lt;/code&gt;æœåŠ¡ä¹‹åï¼Œç»ˆç«¯è¾“å‡ºå¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ go run cmd/server/main.go
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018/10/27 00:35:28 listening on &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;::&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:50052
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;é€Ÿç‡é™åˆ¶å®¢æˆ·ç«¯&#34;&gt;é€Ÿç‡é™åˆ¶å®¢æˆ·ç«¯&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬åŒæ ·åˆ›å»ºä¸€ä¸ª&lt;code&gt;RateLimitService&lt;/code&gt;çš„å®¢æˆ·ç«¯æ¥éªŒè¯æœåŠ¡ç«¯çš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;rls&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/envoyproxy/go-control-plane/envoy/service/ratelimit/v2&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Set up a connection to the server
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Dial&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;localhost:50052&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithInsecure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;could not connect: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewRateLimitServiceClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Send a request to the server
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cancel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Background&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ShouldRateLimit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RateLimitRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Domain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;envoy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;could not call service: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;response: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨è®©æˆ‘ä»¬é€šè¿‡å¯åŠ¨å®¢æˆ·ç«¯æ¥æµ‹è¯•æœåŠ¡ç«¯/å®¢æˆ·ç«¯çš„äº¤äº’ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;1..4&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; go run cmd/client/main.go&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; sleep 1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018/10/27 17:32:23 response: overall_code:OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018/10/27 17:32:25 response: overall_code:OVER_LIMIT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018/10/27 17:32:26 response: overall_code:OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018/10/27 17:32:28 response: overall_code:OVER_LIMIT
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœåŠ¡ç«¯çš„ç›¸å…³æ—¥å¿—ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018/10/27 17:32:23 request: domain:&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018/10/27 17:32:23 response: overall_code:OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018/10/27 17:32:25 request: domain:&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018/10/27 17:32:25 response: overall_code:OVER_LIMIT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018/10/27 17:32:26 request: domain:&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018/10/27 17:32:26 response: overall_code:OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018/10/27 17:32:28 request: domain:&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018/10/27 17:32:28 response: overall_code:OVER_LIMIT
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;envoy-ä»£ç†&#34;&gt;Envoy ä»£ç†&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å¼•å…¥ Envoy ä»£ç†ï¼Œå®ƒå°†æ¥è‡ª Greeter å®¢æˆ·ç«¯çš„è¯·æ±‚è·¯ç”±åˆ° Greeter æœåŠ¡ç«¯ï¼ŒåŒæ—¶ä½¿ç”¨æˆ‘ä»¬çš„é€Ÿç‡é™åˆ¶æœåŠ¡æ£€æŸ¥é€Ÿç‡ã€‚ä¸‹å›¾æè¿°äº†æˆ‘ä»¬æœ€ç»ˆçš„éƒ¨ç½²ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy-proxy&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;envoy proxy&#34; srcset=&#34;
               /blog/envoy-grpc-and-rate-limiting/006tNbRwly1fx4mz6gav7j30m008zmy0_hud4deb38ea26d25f512d9c67470be8933_26765_a9068c14a5134745c68777f9c3a8eac3.webp 400w,
               /blog/envoy-grpc-and-rate-limiting/006tNbRwly1fx4mz6gav7j30m008zmy0_hud4deb38ea26d25f512d9c67470be8933_26765_86205410459ddd7bbb2fe469813086fa.webp 760w,
               /blog/envoy-grpc-and-rate-limiting/006tNbRwly1fx4mz6gav7j30m008zmy0_hud4deb38ea26d25f512d9c67470be8933_26765_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-grpc-and-rate-limiting/006tNbRwly1fx4mz6gav7j30m008zmy0_hud4deb38ea26d25f512d9c67470be8933_26765_a9068c14a5134745c68777f9c3a8eac3.webp&#34;
               width=&#34;760&#34;
               height=&#34;310&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      envoy proxy
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;ä»£ç†é…ç½®&#34;&gt;ä»£ç†é…ç½®&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹ Envoy é…ç½®æ¥æ³¨å†Œ Greeter å’Œ RateLimitService æœåŠ¡å¹¶å¯ç”¨é™é€Ÿæ£€æŸ¥ã€‚æ³¨æ„ï¼Œç”±äºæˆ‘ä»¬æ˜¯å°† Envoy éƒ¨ç½²åœ¨&lt;a href=&#34;https://docs.docker.com/docker-for-mac/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Docker for Mac&lt;/a&gt;ä¸Šï¼Œæœ¬åœ°éƒ¨ç½²çš„æœåŠ¡æ˜¯é€šè¿‡&lt;code&gt;docker.for.mac.localhost&lt;/code&gt;åœ°å€å¼•ç”¨çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;static_resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.0.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9211&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# expose proxy on port 9211&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.http_connection_manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;codec_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;auto&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress_http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;access_log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# configure logging&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.file_access_log&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/dev/stdout&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;greeter_route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# configure the greeter service routes&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;greeter_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rate_limits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# enable rate limit checks for the greeter service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination_cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.rate_limit&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# enable the Rate Limit filter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.router&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# enable the Router filter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;greeter_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# register the Greeter server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;strict_dns&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;round_robin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http2_protocol_options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# enable H2 protocol&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker.for.mac.localhost&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;50051&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rate_limit_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# register the RateLimitService server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;strict_dns&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;round_robin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http2_protocol_options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# enable H2 protocol&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker.for.mac.localhost&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;50052&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rate_limit_service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# define the global rate limit service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;use_data_plane_proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;grpc_service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;envoy_grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rate_limit_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éƒ¨ç½²-envoy-ä»£ç†&#34;&gt;éƒ¨ç½² Envoy ä»£ç†&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†éƒ¨ç½² Envoy ä»£ç†ï¼Œæˆ‘ä»¬å°†ä¸Šè¿°é…ç½®æ‹·è´åˆ°&lt;code&gt;envoy.yaml&lt;/code&gt;æ–‡ä»¶ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹çš„&lt;code&gt;Dockerfile&lt;/code&gt;æ„å»º Docker é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-dockerfile&#34; data-lang=&#34;dockerfile&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; envoyproxy/envoy:latest&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; envoy.yaml /etc/envoy/envoy.yaml&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ„å»ºé•œåƒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker build -t envoy:grpc .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Sending build context to Docker daemon  74.75kB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Step 1/2 : FROM envoyproxy/envoy:latest
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ---&amp;gt; 51fc619e4dc5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Step 2/2 : COPY envoy.yaml /etc/envoy/envoy.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ---&amp;gt; c766ba3d7d09
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Successfully built c766ba3d7d09
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Successfully tagged envoy:grpc
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åè¿è¡Œä»£ç†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker run -p 9211:9211 envoy:grpc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2018-10-28 02:59:20.469&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;000008&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;info&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;main&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;source/server/server.cc:456&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; starting main dispatch loop
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2018-10-28 02:59:20.553&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;000008&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;info&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;upstream&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;source/common/upstream/cluster_manager_impl.cc:135&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; cm init: all clusters initialized
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2018-10-28 02:59:20.554&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;000008&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;info&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;main&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;source/server/server.cc:425&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; all clusters initialized. initializing init manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2018-10-28 02:59:20.554&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;000008&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;info&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;config&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;source/server/listener_manager_impl.cc:908&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; all dependencies initialized. starting workers
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ›´æ–°-greeter-å®¢æˆ·ç«¯&#34;&gt;æ›´æ–° Greeter å®¢æˆ·ç«¯&lt;/h3&gt;
&lt;p&gt;ç”±äºè¦ä½¿ç”¨ Envoy è·¯ç”± Greeter å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæˆ‘ä»¬å°†å®¢æˆ·ç«¯ä»£ç ä¸­çš„æœåŠ¡ç«¯ç«¯å£ä»&lt;code&gt;50051&lt;/code&gt;æ”¹ä¸º&lt;code&gt;9211&lt;/code&gt;ï¼Œå¹¶é‡æ–° buildã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   GreeterClient greeter(grpc::CreateChannel(
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gd&#34;&gt;-      &amp;#34;localhost:50051&amp;#34;, grpc::InsecureChannelCredentials()));
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;localhost:9211&amp;#34;, grpc::InsecureChannelCredentials()));
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   std::string user(&amp;#34;world&amp;#34;);
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   std::string reply = greeter.SayHello(user);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æœ€ç»ˆæµ‹è¯•&#34;&gt;æœ€ç»ˆæµ‹è¯•&lt;/h2&gt;
&lt;p&gt;æ­¤æ—¶ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº† Greeter æœåŠ¡ç«¯ã€RateLimitService æœåŠ¡å’Œä¸€ä¸ª Envoy ä»£ç†ï¼Œæ˜¯æ—¶å€™éªŒè¯æ•´ä¸ªéƒ¨ç½²äº†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨æ›´æ–°åçš„ Greeter å®¢æˆ·ç«¯å‘é€å‡ ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„è¯·æ±‚ï¼ˆè¯‘è€…æ³¨ï¼šå‰é¢ Greeter æœåŠ¡ç«¯æ²¡æœ‰åœï¼Œcounter å·²ç»åˆ°äº† 3ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;1..10&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; ./greeter_client&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; sleep 1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Greeter received: &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; world
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;14:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Greeter received: RPC failed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Greeter received: &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; world
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;14:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Greeter received: RPC failed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Greeter received: &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; world
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;14:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Greeter received: RPC failed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Greeter received: &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt; world
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;14:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Greeter received: RPC failed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Greeter received: &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; world
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;14:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Greeter received: RPC failed
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä½ æ‰€è§ï¼Œ10 ä¸ªè¯·æ±‚ä¸­çš„ 5 ä¸ªæ˜¯æˆåŠŸçš„ï¼Œäº¤æ›¿å‡ºç° gRPC çŠ¶æ€ç ä¸º&lt;code&gt;14&lt;/code&gt;çš„&lt;code&gt;RPC failed&lt;/code&gt;å¤±è´¥è¯·æ±‚ã€‚è¿™è¡¨æ˜é€Ÿç‡é™åˆ¶æœåŠ¡æŒ‰ç…§è®¾è®¡é™åˆ¶äº†è¯·æ±‚ï¼ŒEnvoy æ­£ç¡®åœ°ç»ˆæ­¢äº†ä¹‹åçš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« è®©ä½ å¯¹å¦‚ä½•ä½¿ç”¨ Envoy ä½œä¸ºåº”ç”¨ä»£ç†æœ‰äº†ä¸€ä¸ªé«˜å±‚æ¬¡çš„è®¤è¯†ï¼Œä¹Ÿèƒ½å¸®åŠ©ä½ ç†è§£ Envoy çš„é™é€Ÿè¿‡æ»¤å™¨å¦‚ä½•è·Ÿ gRPC åè®®ååŒå·¥ä½œã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Cilium 1.3ï¼šæ”¯æŒ Envoyã€Cassandra å’Œ Memcached çš„ Go è¯­è¨€æ‰©å±•</title>
      <link>https://cloudnative.to/blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/</link>
      <pubDate>Tue, 06 Nov 2018 12:20:51 +0800</pubDate>
      <guid>https://cloudnative.to/blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/</guid>
      <description>&lt;p&gt;















&lt;figure  id=&#34;figure-cilium-kubernetes&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Cilium Kubernetes&#34; srcset=&#34;
               /blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwqjul334zj30je07p0t1_hu8927cc2bd94d87da94805321119c1a29_21818_c623a4cc26b25c537dc0a07694b69fd2.webp 400w,
               /blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwqjul334zj30je07p0t1_hu8927cc2bd94d87da94805321119c1a29_21818_29ce53db41a0a0cf82e9bdc3eb8a97f2.webp 760w,
               /blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwqjul334zj30je07p0t1_hu8927cc2bd94d87da94805321119c1a29_21818_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwqjul334zj30je07p0t1_hu8927cc2bd94d87da94805321119c1a29_21818_c623a4cc26b25c537dc0a07694b69fd2.webp&#34;
               width=&#34;698&#34;
               height=&#34;277&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Cilium Kubernetes
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://cilium.io/blog/2018/10/23/cilium-13-envoy-go/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¾ˆé«˜å…´åœ°å®£å¸ƒ Cilium 1.3 å‘å¸ƒäº†ã€‚è¿™ä¸ªç‰ˆæœ¬åŠ å…¥äº†å‡ ä¸ªæ–°ç‰¹æ€§ã€‚ä¸»è¦çš„äº®ç‚¹æ˜¯å®ç°äº† Cassandra å’Œå¸¦æœ‰ç­–ç•¥æ‰§è¡Œèƒ½åŠ›çš„ Memcached åè®®è§£æå™¨ï¼Œä½œä¸º&lt;a href=&#34;https://github.com/envoyproxy/envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;çš„ Go è¯­è¨€æ‰©å±•åŒ…ã€‚&lt;/p&gt;
&lt;p&gt;å’Œå¾€å¸¸ä¸€æ ·ï¼Œæ•´ä¸ª Cilium ç¤¾åŒºçš„å¼€å‘è€…è´¡çŒ®å·¨å¤§ï¼Œä»–ä»¬åœ¨ 1.2 åˆ° 1.3 ç‰ˆæœ¬çš„è¿™æ®µæ—¶é—´è´¡çŒ®äº† 785 ä¸ªæäº¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-envoy-çš„-go-è¯­è¨€æ‰©å±•&#34;&gt;ä»€ä¹ˆæ˜¯ Envoy çš„ Go è¯­è¨€æ‰©å±•ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä» 1.0 ç‰ˆæœ¬å¼€å§‹ï¼Œæˆ‘ä»¬ä¸€ç›´ä¾èµ–&lt;a href=&#34;https://github.com/envoyproxy/envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;å¤„ç†æ‰€æœ‰çš„ HTTPã€gRPC ä»¥åŠ HTTP çš„æ´¾ç”Ÿå¦‚ Elasticsearch çš„è¯·æ±‚ã€‚ç¤¾åŒºè®¨è®ºå¦‚ä½•æ‰©å¤§æ”¯æŒ 7 å±‚åè®®çš„èŒƒå›´ï¼ŒEnvoy ä½œä¸ºæ¨åŠ¨æœªæ¥åè®®è¡¥å……çš„é¦–é€‰å¹³å°æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚ç„¦ç‚¹è¿…é€Ÿè½¬ç§»åˆ°å¯»æ‰¾ç®€åŒ– Envoy å¯æ‰©å±•æ€§çš„æ–¹æ³•ï¼Œå¹¶ä¸”å…è®¸é‡ç”¨ç°æœ‰çš„å¼€æºé¡¹ç›®ï¼Œå¦‚ CNCF é¡¹ç›®&lt;a href=&#34;https://vitess.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Vitess&lt;/a&gt;ã€‚äºæ˜¯å®ç° Envoy çš„ Go æ‰©å±•çš„æƒ³æ³•å°±è¯ç”Ÿäº†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Cilium 1.3 ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº† Envoy çš„ Go æ‰©å±•ä½œä¸ºå…¶ Beta ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy-golang-extension-architecture&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy Golang Extension Architecture&#34; srcset=&#34;
               /blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwql07xp02j30lp0buaay_huf05ead5c8973182e89d3d74e94fdf282_40716_462a96612ed76edb1df81a1a449d1b12.webp 400w,
               /blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwql07xp02j30lp0buaay_huf05ead5c8973182e89d3d74e94fdf282_40716_161114a896a05db10634dbb722a585f1.webp 760w,
               /blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwql07xp02j30lp0buaay_huf05ead5c8973182e89d3d74e94fdf282_40716_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwql07xp02j30lp0buaay_huf05ead5c8973182e89d3d74e94fdf282_40716_462a96612ed76edb1df81a1a449d1b12.webp&#34;
               width=&#34;760&#34;
               height=&#34;415&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy Golang Extension Architecture
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;**æ‰©å±•çš„é€æ˜æ³¨å…¥ï¼š**åœ¨ Cilium çš„å¸®åŠ©ä¸‹ï¼Œè¿æ¥è¢«é€æ˜åœ°é‡å®šå‘åˆ° Envoyï¼Œè€Œä¸éœ€è¦ä¿®æ”¹åº”ç”¨ç¨‹åºæˆ– podã€‚é‡å®šå‘åŸºäºç›®æ ‡ç«¯å£é…ç½®ï¼Œå¯ä»¥æ ¹æ® labelsã€IPsã€DNS ä»¥åŠ ingress å’Œ egress è¿æ¥çš„æœåŠ¡åç§°é™å®šåˆ°æºæˆ–ç›®æ ‡æœåŠ¡ï¼Œå¹¶é€šè¿‡æ‰©å±•çš„åç§°å°†è¿æ¥æ˜ å°„åˆ°æ‰©å±•ã€‚é‡å®šå‘æ˜¯é€šè¿‡ CiliumNetworkPolicy CRD æˆ– REST API é…ç½®çš„ã€‚Envoy å¯ä»¥è¢«é…ç½®ä¸ºåœ¨æ¯ä¸ª pod ä¸­ä½œä¸º sidecar æˆ–ä½œä¸ºæ¯ä¸ª node çš„ç‹¬ç«‹ä»£ç†è¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;**å®Œå…¨åˆ†å¸ƒå¼ï¼š**Go æ‰©å±•å®Œå…¨åˆ†å¸ƒåœ¨æ¯ä¸ª Envoy èŠ‚ç‚¹æˆ– pod å†…éƒ¨ï¼Œä¸éœ€è¦ä¸ºä¸€ä¸ªæ•°æ®å¤„ç†çš„é›†ä¸­åŒ–æ§åˆ¶é¢æ¿ã€‚å½“ç„¶ï¼Œgo æ‰©å±•æœ¬èº«å¯ä»¥è°ƒç”¨ä»»æ„çš„å¤–éƒ¨æ§åˆ¶é¢æ¿ç»„ä»¶æ¥æŠ¥å‘Šé¥æµ‹æ•°æ®æˆ–éªŒè¯è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;**åŠ¨æ€æ‰©å±•æ˜ å°„ï¼š**Go æ‰©å±•è¢«è®¾è®¡ä¸ºå…±äº«åº“æä¾›ç»™ Envoyã€‚Cilium å¯ä»¥æ ¹æ®è®¾ç½®å¥½çš„é‡å®šå‘è‡ªåŠ¨åŠ è½½ç›¸åº”çš„ Go æ‰©å±•æ¥é…ç½® Envoyï¼Œå¹¶åœ¨è¿æ¥æ•°æ®æ—¶è°ƒç”¨å®ƒã€‚æœªæ¥çš„ç‰ˆæœ¬å°†æ”¯æŒåœ¨è¿è¡Œæ—¶æ›´æ–°å’Œé‡æ–°åŠ è½½æ‰©å±•ï¼Œè€Œæ— éœ€é‡å¯ Envoy å¹¶ä¸”ä¹Ÿä¸ä¼šä¸¢å¤±è¿æ¥çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;**é€šè¿‡ CRD é…ç½®æ‰©å±•ï¼š**é€šè¿‡ CRD æˆ– REST API ä½¿ç”¨é€šç”¨é”®å€¼å¯¹é…ç½® Go æ‰©å±•ã€‚è¿™å…è®¸ä¼ é€’å¦‚å®‰å…¨ç­–ç•¥ã€å®‰å…¨ä»¤ç‰Œæˆ–å…¶ä»–çš„é…ç½®ï¼Œè€Œæ— éœ€è®© Envoy çŸ¥é“ã€‚&lt;/li&gt;
&lt;li&gt;**é€šç”¨è®¿é—®æ—¥å¿—ï¼š**ä¸é…ç½®ç±»ä¼¼ï¼Œæ‰©å±•å¯ä»¥è¿”å›é€šç”¨é”®å€¼å¯¹ï¼Œè¿™äº›é”®å€¼å¯¹å°†æå–çš„å¯è§æ€§ä¼ é€’åˆ°è®¿é—®æ—¥å¿—å±‚ã€‚&lt;/li&gt;
&lt;li&gt;**æ²™ç›’åŒ–ï¼š**æ²™ç›’ç¡®ä¿ä»»ä½•è§£æå™¨çš„ä¸ç¨³å®šæ€§éƒ½ä¸ä¼šç ´å Envoy çš„æ ¸å¿ƒã€‚å— Matt Klein å‘è¡¨çš„æ–‡ç« &lt;a href=&#34;https://medium.com/@mattklein123/exceptional-go-1dd1488a6a47&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Exceptional Go&lt;/a&gt;å¯å‘ï¼Œè§£æå™¨è¢«å®¹è®¸ panic æˆ–æŠ›å‡ºå¼‚å¸¸ã€‚å½“ panic å‘ç”Ÿæ—¶ï¼Œä¿¡æ¯è¢«è®°å½•åˆ°è®¿é—®æ—¥å¿—ä¸­ï¼ŒTCP è¿æ¥ä¸è¢«å…³é—­çš„è¯·æ±‚å…³è”ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;cilium-æ˜¯ä»€ä¹ˆ&#34;&gt;Cilium æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Cilium æ˜¯ä¸€ä¸ªå¼€æºè½¯ä»¶ï¼Œå¯ä»¥é€æ˜åœ°æä¾›å’Œä¿æŠ¤éƒ¨ç½²åœ¨è¯¸å¦‚ Kubernetesã€Docker å’Œ Mesos ç­‰ Linux å®¹å™¨ç®¡ç†å¹³å°çš„åº”ç”¨ç¨‹æœåŠ¡ä¹‹é—´çš„ç½‘ç»œå’Œ API è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;Cilium çš„åŸºç¡€æ˜¯ä¸€ç§æ–°çš„ Linux å†…æ ¸æŠ€æœ¯ BPFï¼Œå®ƒæ”¯æŒåœ¨ Linux å†…éƒ¨åŠ¨æ€çš„æ³¨å…¥å®‰å…¨ã€å¯è§æ€§å’Œç½‘ç»œæ§åˆ¶é€»è¾‘ã€‚é™¤äº†æä¾›ä¼ ç»Ÿçš„ç½‘ç»œå±‚å®‰å…¨ï¼ŒBPF çš„çµæ´»æ€§è¿˜è®© API å’Œæµç¨‹çº§åˆ«çš„å®‰å…¨ï¼Œä¿æŠ¤å®¹å™¨æˆ– pod é—´é€šä¿¡æˆä¸ºäº†å¯èƒ½ã€‚å› ä¸º BPF åœ¨ Linux å†…æ ¸ä¸­è¿è¡Œï¼ŒCilium çš„å®‰å…¨ç­–ç•¥å¯ä»¥åœ¨ä¸ä¿®æ”¹ç¨‹åºä»£ç æˆ–å®¹å™¨é…ç½®çš„æƒ…å†µä¸‹ä½¿ç”¨å’Œæ›´æ–°ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å…³ Cilium æ›´è¯¦ç»†çš„ä»‹ç»è¯·å‚è§**&lt;a href=&#34;https://cilium.readthedocs.io/en/v1.3/intro/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Introduction to Cilium&lt;/a&gt;**&lt;/p&gt;
&lt;h2 id=&#34;envoy-æ˜¯ä»€ä¹ˆ&#34;&gt;Envoy æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Envoy æ˜¯ä¸€ä¸ª 7 å±‚ä»£ç†å’Œé€šä¿¡æ€»çº¿ï¼Œè¢«è®¾è®¡ç”¨äºå¤§å‹çš„é¢å‘æœåŠ¡çš„æ¶æ„ã€‚è¿™ä¸ªé¡¹ç›®è¯ç”Ÿäºä»¥ä¸‹ç†å¿µï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç½‘ç»œåº”è¯¥å¯¹åº”ç”¨ç¨‹åºé€æ˜ã€‚å½“ç½‘ç»œå’Œåº”ç”¨ç¨‹åºå‡ºç°é—®é¢˜æ—¶ï¼Œåº”è¯¥å¾ˆå®¹æ˜“ç¡®å®šé—®é¢˜çš„æ ¹æºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½ å¯ä»¥é€šè¿‡ Envoy çš„æ–‡æ¡£ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/what_is_envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;What is Envoy&lt;/a&gt;äº†è§£æ›´å¤šå…³äº Envoy çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ€æ ·ç¼–å†™-envoy-çš„-go-è¯­è¨€æ‰©å±•&#34;&gt;æ€æ ·ç¼–å†™ Envoy çš„ Go è¯­è¨€æ‰©å±•&lt;/h1&gt;
&lt;p&gt;ç¼–å†™ Envoy çš„ Go æ‰©å±•å¾ˆç®€å•ã€‚ä¸ºè¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä¸º R2-D2 æ§åˆ¶åè®®å®ç°ä¸€ä¸ªåŸºæœ¬çš„åè®®è§£æå™¨ï¼Œå¹¶å®ç°è¿‡æ»¤é€»è¾‘ç”¨æ¥æ’é™¤ä»»ä½•åŒ…å«å­—ç¬¦ä¸²â€C-3POâ€çš„æ§åˆ¶è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy-golang-extension-architecture&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy Golang Extension Architecture&#34; srcset=&#34;
               /blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwvz4inau1j30kg09waal_hu97114ae48a52a816f5620d5d3457241c_28551_0c2ad15ae5886cb75022562039cfbfb2.webp 400w,
               /blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwvz4inau1j30kg09waal_hu97114ae48a52a816f5620d5d3457241c_28551_69fb463ea257605e293f31dfa8e481cf.webp 760w,
               /blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwvz4inau1j30kg09waal_hu97114ae48a52a816f5620d5d3457241c_28551_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwvz4inau1j30kg09waal_hu97114ae48a52a816f5620d5d3457241c_28551_0c2ad15ae5886cb75022562039cfbfb2.webp&#34;
               width=&#34;736&#34;
               height=&#34;356&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy Golang Extension Architecture
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¦å®ç°æ‰©å±•çš„ä¸»è¦ API æ˜¯&lt;code&gt;OnData()&lt;/code&gt;å‡½æ•°ï¼Œå½“ Envoy æ”¶åˆ°é€šè¿‡&lt;code&gt;CiliumNetworkPolicy&lt;/code&gt;æ˜ å°„åˆ°æ‰©å±•è¿æ¥çš„æ•°æ®æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚å‡½æ•°å¿…é¡»è§£ææ•°æ®å¹¶è¿”å›ä¸‹é¢çš„æ–­è¨€ä¹‹ä¸€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MORE&lt;/strong&gt;ï¼šè§£æå™¨éœ€è¦æ›´å¤šçš„å­—èŠ‚æ¥ç»§ç»­è§£æã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PASS&lt;/strong&gt;ï¼šä¼ é€’&lt;em&gt;n&lt;/em&gt;å­—èŠ‚æ•°æ®æµã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DROP&lt;/strong&gt;ï¼šåˆ é™¤&lt;em&gt;n&lt;/em&gt;å­—èŠ‚æ•°æ®æµã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;INJECT&lt;/strong&gt;ï¼šå‘æŒ‡å®šçš„æ–¹å‘æ³¨å…¥&lt;em&gt;n&lt;/em&gt;å­—èŠ‚çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ERROR&lt;/strong&gt;ï¼šå‘ç”Ÿäº†è§£æé”™è¯¯ï¼Œè¿æ¥å¿…é¡»å…³é—­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;NOP&lt;/strong&gt;ï¼šä»€ä¹ˆä¹Ÿæ²¡å‘ç”Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†æ³¨å†Œæ‰©å±•ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªå¿…é¡»å®ç°&lt;code&gt;Create()&lt;/code&gt;å‡½æ•°çš„è§£æå™¨å·¥å‚ã€‚å½“ Envoy å»ºç«‹äº†ä¸€ä¸ªæ–°çš„è¿æ¥å¹¶ä½¿ç”¨è§£æå™¨æ—¶å°±ä¼šè°ƒç”¨è¯¥å‡½æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/cilium/cilium/proxylib/proxylib&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parser&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;connection&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;proxylib&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Connection&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parser&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;OnData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reply&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;endStream&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dataArray&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[][]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;proxylib&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;OpType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dataArray&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;msgLen&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\r\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;msgLen&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxylib&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MORE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// No delimiter, request more data
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;msgStr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;msgLen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;msgLen&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Inlcude the &amp;#34;\r\n&amp;#34; in the request
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reply&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxylib&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PASS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;msgLen&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Pass responses without additional parsing
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Contains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;msgStr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;C-3PO&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxylib&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DROP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;msgLen&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxylib&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PASS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;msgLen&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;factory&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;connection&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;proxylib&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxylib&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Parser&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parser&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;init&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;proxylib&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterParserFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;r2d2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åï¼Œå°†æ–°çš„è§£æå™¨å¯¼å…¥åˆ° proxylib åŒ…ä¸­ã€‚&lt;code&gt;libcilium.so&lt;/code&gt;å°†åŒ…å«è§£æå™¨å¹¶è¢« Envoy åŠ è½½ã€‚ç¼–è¾‘æ–‡ä»¶&lt;code&gt;proxylib/proxylib.go&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/cilium/cilium/proxylib/r2d2&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢çš„ç¤ºä¾‹çœç•¥äº†æ‰©å±•é…ç½®ã€é›†æˆåˆ°ç­–ç•¥ä»£ç åº“ä»¥åŠè®¿é—®æ—¥å¿—ç­‰å†…å®¹ã€‚å­¦ä¹ å¦‚ä½•ç¼–å†™ Go æ‰©å±•ï¼Œè¯·å‚é˜…æŒ‡å—&lt;a href=&#34;https://cilium.readthedocs.io/en/v1.3/envoy/extensions/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Go Extensions&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h1 id=&#34;cassandra-æ”¯æŒbeta&#34;&gt;Cassandra æ”¯æŒï¼ˆBetaï¼‰&lt;/h1&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-cassandra-logo&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Cassandra Logo&#34; srcset=&#34;
               /blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwxc47hgkbj30io07edgp_hu77121d70581001ee81a80228e08f3b22_27568_e4a63e46f573b2ab89d5a5afaa63374e.webp 400w,
               /blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwxc47hgkbj30io07edgp_hu77121d70581001ee81a80228e08f3b22_27568_25def539110fa253d028863cc3b1ae18.webp 760w,
               /blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwxc47hgkbj30io07edgp_hu77121d70581001ee81a80228e08f3b22_27568_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwxc47hgkbj30io07edgp_hu77121d70581001ee81a80228e08f3b22_27568_e4a63e46f573b2ab89d5a5afaa63374e.webp&#34;
               width=&#34;672&#34;
               height=&#34;266&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Cassandra Logo
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/apache/cassandra&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cassandra&lt;/a&gt; æ˜¯ä¸€ä¸ªæµè¡Œçš„ NoSQL æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚å®ƒé€šå¸¸è¢«å¤šä¸ªæœåŠ¡å¤§è§„æ¨¡çš„è®¿é—®å¹¶åœ¨å›¢é˜Ÿé—´å…±äº«ã€‚Cilium 1.3 å¼•å…¥äº†å¯¹ Apache &lt;a href=&#34;https://github.com/apache/cassandra&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cassandra&lt;/a&gt; åè®®çš„æ”¯æŒï¼Œå¹¶æä¾›äº†å¯è§æ€§å’Œç­–ç•¥æ‰§è¡Œèƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;Cassandra çš„ Go æ‰©å±•èƒ½å¤Ÿåœ¨ä»¥ä¸‹åè®®å­—æ®µä¸Šæä¾›å¯è§æ€§å’Œæ‰§è¡Œèƒ½åŠ›ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;query_action&lt;/strong&gt;ï¼šè¿™ä¸ªè¡Œä¸ºåœ¨æ•°æ®åº“çš„&lt;code&gt;SELECT&lt;/code&gt;ï¼Œ &lt;code&gt;INSERT&lt;/code&gt;ï¼Œ &lt;code&gt;UPDATE&lt;/code&gt;ç­‰æ“ä½œä¸Šæ‰§è¡Œï¼Œå­—æ®µæ€»æ˜¯ç²¾ç¡®åŒ¹é…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;query_table&lt;/strong&gt;ï¼šæŸ¥è¯¢æ‰§è¡Œçš„è¡¨ï¼Œä»¥æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä¾‹å­empire-å¦‚ä½•é€šè¿‡è¡¨é™åˆ¶-cassandra-è®¿é—®&#34;&gt;ä¾‹å­ï¼šEmpire å¦‚ä½•é€šè¿‡è¡¨é™åˆ¶ Cassandra è®¿é—®&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº† Empire å¦‚ä½•æš´éœ²æœ‰é™çš„è®¿é—®ç»™è¿è¡Œåœ¨ç«¯å£ 9042 çš„ Empire Cassandra é›†ç¾¤ã€‚Outposts è¢«æ ‡ç­¾&lt;code&gt;app=empire-outpost&lt;/code&gt;æ ‡è¯†ï¼Œå¹¶å…·æœ‰ä»¥ä¸‹æƒé™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;SELECT&lt;/code&gt; æ“ä½œåœ¨è¡¨&amp;quot;system.&lt;em&gt;â€å’Œâ€system_schema.&lt;/em&gt;â€œä¸Šæ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;INSERT&lt;/code&gt;æ“ä½œåœ¨è¡¨&amp;quot;attendance.daily_records&amp;quot;ä¸Šæ‰§è¡Œã€‚æ³¨æ„ outposts ä¸èƒ½ä»è¿™äº›è¡¨è¯»å–ï¼Œå› æ­¤ä¸èƒ½ä»å…¶ä»– outposts è¯»å–æ¯æ—¥è®°å½•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cilium.io/v2&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CiliumNetworkPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;summary&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Allow only permitted requests to empire Cassandra server&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;secure-empire-cassandra&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;specs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;endpointSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cass-server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;fromEndpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;empire-outpost&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;toPorts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;9042&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;l7proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cassandra&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;l7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;query_action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;query_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;system\\..*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;query_action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;query_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;system_schema\\..*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;query_action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;insert&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;query_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;attendance.daily_records&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ›´å¤šå¤æ‚ç¤ºä¾‹è¯·å‚é˜… &lt;a href=&#34;https://cilium.readthedocs.io/en/v1.3/gettingstarted/cassandra/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cassandra getting started guide &lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h1 id=&#34;memcached-æ”¯æŒbeta&#34;&gt;Memcached æ”¯æŒï¼ˆBetaï¼‰&lt;/h1&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-memcached-logo&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Memcached Logo&#34; srcset=&#34;
               /blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwxc9b9qp7j30g607gt97_hu1439491928f289d7198cace2b4e837ea_17102_6f14f4a5c6663843d0ffc53586fca2f7.webp 400w,
               /blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwxc9b9qp7j30g607gt97_hu1439491928f289d7198cace2b4e837ea_17102_f9145b8d8cb597412a8d371fad0964ae.webp 760w,
               /blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwxc9b9qp7j30g607gt97_hu1439491928f289d7198cace2b4e837ea_17102_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/cilium-13-go-extensions-for-envoy-cassandra-memcached-support/006tNbRwly1fwxc9b9qp7j30g607gt97_hu1439491928f289d7198cace2b4e837ea_17102_6f14f4a5c6663843d0ffc53586fca2f7.webp&#34;
               width=&#34;582&#34;
               height=&#34;268&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Memcached Logo
    &lt;/figcaption&gt;&lt;/figure&gt;

Memcached æ˜¯ä¸€ç§æµè¡Œçš„åŸºäºå†…å­˜çš„åˆ†å¸ƒå¼ç¼“å­˜ï¼Œé€šå¸¸ç”¨äºç¼“å­˜æˆ–åœ¨æœåŠ¡ä¹‹é—´å…±äº«æ•°æ®ã€‚éšç€ memcached è§£æå™¨çš„ golang æ‰©å±•åŠ å…¥ Envoyï¼ŒCilium ç°åœ¨å¯ä»¥æ‰§è¡Œå®‰å…¨è§„åˆ™å»é™åˆ¶ memcached å®¢æˆ·ç«¯çš„æŸäº›å‘½ä»¤ï¼Œæ¯”å¦‚è¯»å†™ï¼Œä¹Ÿå¯ä»¥æ ¹æ® key å‰ç¼€è¿›è¡Œé™åˆ¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¾‹å­rebels-å¦‚ä½•ä¿æŠ¤å…±äº«çš„-memcached-æœåŠ¡&#34;&gt;ä¾‹å­ï¼šRebels å¦‚ä½•ä¿æŠ¤å…±äº«çš„ memcached æœåŠ¡&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼ŒRebels è¿è¡Œäº†ä¸€ä¸ªæ ‡ç­¾ä¸º&lt;code&gt;app=memcached&lt;/code&gt;çš„ memcached æœåŠ¡ï¼Œå‡ ä¸ªæœåŠ¡ä¸ memcached äº¤äº’å¹¶åº”ç”¨ä¸åŒçš„è§„åˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;function=fleet-maintenance&lt;/code&gt; æ ‡è¯†çš„ç»´æŠ¤æœåŠ¡è¢«æˆäºˆå¯¹å‰ç¼€ä¸º&lt;code&gt;alliance/fleet&lt;/code&gt;çš„æ‰€æœ‰ key çš„è¯»å†™æƒé™ã€‚ç¦æ­¢è®¿é—®ä»»ä½•å…¶ä»– keyã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;function=fleet-monitoring&lt;/code&gt;æ ‡è¯†çš„ç›‘æ§æœåŠ¡ä»…å¯¹å‰ç¼€ä¸º&lt;code&gt;alliance/fleet&lt;/code&gt;çš„ key æˆäºˆè¯»æƒé™ã€‚ç¦æ­¢å¯¹å‰ç¼€ä¸­çš„ key è¿›è¡Œå†™å…¥è®¿é—®æˆ–è®¿é—®å‰ç¼€ä¹‹å¤–çš„ä»»ä½• keyã€‚&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰ Jedis è¢«æ ‡ç­¾&lt;code&gt;role=jedi&lt;/code&gt;æ ‡è¯†ï¼Œæ‹¥æœ‰å®Œæ•´çš„ Memcached æœåŠ¡ï¼Œå¯ä»¥è®¿é—®æ‰€æœ‰çš„ keyã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cilium.io/v2&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CiliumNetworkPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;summary&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Secure the Rebel memcached service&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;secure-rebel-alliance-memcache&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;specs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;endpointSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;memcached&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;fromEndpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;fleet-maintanence&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;toPorts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;11211&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;l7proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;memcache&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;l7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;writeGroup&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;keyPrefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;alliance/fleet/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;get&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;keyPrefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;alliance/fleet/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;fromEndpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;fleet-monitoring&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;toPorts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;11211&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;l7proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;memcache&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;l7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;get&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;keyPrefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;alliance/fleet/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;fromEndpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;role&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;jedi&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;toPorts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;11211&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;l7proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;memcache&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;l7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ memcached çš„å®Œæ•´ç¤ºä¾‹ï¼Œè¯·å‚é˜… &lt;a href=&#34;https://cilium.readthedocs.io/en/v1.3/gettingstarted/memcached/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Memcached getting started guide&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ç¤¾åŒº&#34;&gt;ç¤¾åŒº&lt;/h1&gt;
&lt;h2 id=&#34;linux-åŸºé‡‘ä¼šcore-infrastructure-initiativeæœ€ä½³å®è·µ&#34;&gt;Linux åŸºé‡‘ä¼š&amp;quot;Core Infrastructure Initiative&amp;quot;æœ€ä½³å®è·µ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬è‡´åŠ›äºåœ¨å¼€æ”¾å’Œæœ€å¥½çš„å¼€æºå®è·µä¸­å¼€å‘ Ciliumï¼ŒåŒ…æ‹¬å¯¹å®‰å…¨çš„åšå®šæ‰¿è¯ºã€‚æˆ‘ä»¬å¾ˆé«˜å…´åœ°å®£å¸ƒï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†æ‰€æœ‰å·¥ä½œï¼Œè·å¾—äº† Linux åŸºé‡‘ä¼š &lt;a href=&#34;https://www.coreinfrastructure.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Core Infrastructure Initiative&lt;/a&gt;çš„ &lt;a href=&#34;https://bestpractices.coreinfrastructure.org/en&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CII Best Practices&lt;/a&gt;æ®Šè£ã€‚åœ¨ &lt;a href=&#34;https://www.coreinfrastructure.org/programs/badge-program/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;äº†è§£æ›´å¤šå…³äºå¥–ç« çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç‰¹åˆ«å…´è¶£ç»„sigä»‹ç»&#34;&gt;ç‰¹åˆ«å…´è¶£ç»„ï¼ˆSIGï¼‰ä»‹ç»&lt;/h2&gt;
&lt;p&gt;ç¤¾åŒºçš„å…³æ³¨ç‚¹è¶Šæ¥è¶Šå¤šæ ·åŒ–ã€‚ä¸ºäº†ç¡®ä¿é¡¹ç›®çš„å¯ä¼¸ç¼©æ€§ï¼Œæˆ‘ä»¬æ­£å¼å¼•å…¥äº†ç‰¹æ®Šå…´è¶£ç»„ï¼ˆSIGsï¼‰æ¥å¸®åŠ©æä¾›ä¸€äº›ç»„ç»‡ç»“æ„ã€‚å·²ç»åˆ›å»ºäº†ä»¥ä¸‹çš„ SIGsï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Datapath&lt;/strong&gt;ï¼š (#sig-datapath) æ‰€æœ‰ BPF å’Œ Linux å†…æ ¸ç›¸å…³çš„æ•°æ®é€šè·¯ä»£ç æ‹¥æœ‰è€…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Documentation&lt;/strong&gt;ï¼š (#sig-docs) æ‰€æœ‰æ–‡æ¡£ç›¸å…³çš„è®¨è®ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Envoy&lt;/strong&gt;ï¼š (#sig-envoy) Envoyï¼ŒIstio å’Œæ‰€æœ‰ 7 å±‚åè®®è§£æå™¨çš„ç»´æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Policy&lt;/strong&gt;ï¼š (#sig-policy) æ‰€æœ‰ç­–ç•¥ç›¸å…³çš„ä¸»é¢˜ã€‚è¿™ä¸ª SIG è´Ÿè´£æ‰€æœ‰ä¸å®‰å…¨ç›¸å…³çš„ API å’Œå®ç°é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Release Management&lt;/strong&gt;ï¼š (#launchpad) è´Ÿè´£å‘å¸ƒç®¡ç†å’Œå‘åç§»æ¤çš„è¿‡ç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»»ä½•äººéƒ½å¯ä»¥å»ºç«‹é¢å¤–çš„ SIGsã€‚è¿™ä¸ªè¿‡ç¨‹å¾ˆç®€å•æœ‰&lt;a href=&#34;https://cilium.readthedocs.io/en/v1.3/community/#how-to-create-a-sig&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡æ¡£è¯´æ˜&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;13-ç‰ˆæœ¬æ–°ç‰¹æ€§&#34;&gt;1.3 ç‰ˆæœ¬æ–°ç‰¹æ€§&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Envoy çš„ Go è¯­è¨€æ‰©å±•&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä»¤äººå…´å¥‹çš„å…¨æ–°çš„ Envoy Go æ‰©å±• APIï¼ŒåŒ…æ‹¬é€šç”¨é…ç½®å’Œè®¿é—®æ—¥å¿— APIï¼ˆBeta ç‰ˆæœ¬ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Cassandra å’Œ Memcached åè®®æ”¯æŒ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨æ–°çš„ Envoy Go æ‰©å±•å®ç°äº† Cassandra å’Œ Memcached çš„æ–°åè®®è§£æå™¨ã€‚è¿™ä¸¤ä¸ªè§£æå™¨éƒ½ä½¿ç”¨ç²¾ç¡®åŒ¹é…ã€å‰ç¼€åŒ¹é…å’Œæ­£åˆ™è¡¨è¾¾å¼ä¸ºæ“ä½œç±»å‹å’Œé”®/è¡¨åæä¾›å¯è§æ€§å’Œå¼ºåˆ¶å®‰å…¨ç­–ç•¥ã€‚ï¼ˆBetaï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºDNS/FQDNç­–ç•¥è§„åˆ™æä¾›TTLsæ”¯æŒã€‚&lt;/li&gt;
&lt;li&gt;å¼•å…¥ kube-dnsã€coredns å’Œ etcd æ“ä½œç¬¦çš„æ ‡è¯†ã€‚&lt;/li&gt;
&lt;li&gt;æ–°çš„å®‰å…¨æ ‡è¯†&amp;quot;unmanaged&amp;quot;ä»£è¡¨æ²¡æœ‰è¢« Cilium ç®¡ç†çš„ podã€‚&lt;/li&gt;
&lt;li&gt;æ”¹è¿›çš„å®‰å…¨å®ä½“â€œé›†ç¾¤â€ï¼Œå…è®¸ä¸ºé›†ç¾¤ä¸­çš„æ‰€æœ‰ pod å®šä¹‰ç­–ç•¥ï¼ˆå·²ç®¡ç†ã€æœªç®¡ç†å’Œä¸»æœºç½‘ç»œçš„ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¢å¤–çš„é¥æµ‹æŒ‡æ ‡å’Œç›‘æ§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ–°çš„&amp;quot;cilium metrics list&amp;quot;å‘½ä»¤é€šè¿‡ CLI æŸ¥çœ‹ metrics åˆ—è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;è®¸å¤šé¢å¤–çš„ metricsï¼šè¿æ¥è·Ÿè¸ªåƒåœ¾å›æ”¶ï¼ŒKubernetes èµ„æºäº‹ä»¶ï¼ŒIPAMï¼Œå†ç”ŸèŠ‚ç‚¹ï¼ŒæœåŠ¡ï¼Œé”™è¯¯å’Œè­¦å‘Šè®¡æ•°å™¨ã€‚&lt;/li&gt;
&lt;li&gt;å…·æœ‰æ›´é«˜æ•ˆçš„ç¼–è§£ç åè®®çš„æ–°ç›‘æ§æ¥å£ã€‚é»˜è®¤æƒ…å†µä¸‹ç”¨äºè¾ƒè€çš„å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œæ”¹è¿›&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å°†è¿æ¥è·Ÿè¸ªè¡¨åˆ’åˆ†ä¸º TCP å’Œé TCPï¼Œä»¥æ›´å¥½åœ°å¤„ç†æ¯ä¸ªåè®®çš„é•¿çŸ­è¿æ¥çš„æ··åˆã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ ConfigMap æè¿°è¿æ¥è¡¨å¤§å°çš„èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ NodePort å’Œ HostPort æ›´å¥½çš„ä¼ªè£…æµé‡è¡Œä¸ºï¼Œå®¹è®¸ pods å¯ä»¥æŸ¥çœ‹åŸå§‹æº IPã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨é”®å€¼å­˜å‚¨å¼¹æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¼•å…¥äº†åœ¨ä»»ä½•çŠ¶æ€ä¸¢å¤±åç«‹å³é‡æ–°æ„é€ é”®å€¼å­˜å‚¨å†…å®¹çš„èƒ½åŠ›ã€‚å…è®¸ä»å¤‡ä»½ä¸­æ¢å¤ etcdï¼Œæˆ–è€…åœ¨è¿è¡Œçš„é›†ç¾¤ä¸­å®Œå…¨åˆ é™¤å®ƒï¼Œå¹¶å½±å“æœ€å°ã€‚(Beta)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•ˆç‡å’Œæ‰©å±•&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨è®¡ç®—ç‹¬ç«‹ endpoint ç­–ç•¥çš„æˆæœ¬æ–¹é¢æœ‰é‡å¤§æ”¹è¿›ã€‚å…³äºè¿™æ–¹é¢çš„å·¥ä½œè¿˜åœ¨ç»§ç»­ã€‚&lt;/li&gt;
&lt;li&gt;æ–°çš„å®½é™æœŸï¼Œé€šè¿‡å·¥ä½œè´Ÿè½½æ›´æ”¹èº«ä»½æœ€å°åŒ–è¿æ¥å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;æ›´é«˜æ•ˆçš„å®‰å…¨èº«ä»½åˆ†é…ç®—æ³•ã€‚&lt;/li&gt;
&lt;li&gt;æ–°çš„é€šç”¨æ¡†æ¶æ£€æµ‹å’Œå¿½ç•¥ Kubernetes äº‹ä»¶é€šçŸ¥ï¼ŒCilium ä¸éœ€è¦åŠ¨ä½œã€‚&lt;/li&gt;
&lt;li&gt;åœ¨é¿å…ä¸å¿…è¦çš„ BPF ç¼–è¯‘æ–¹é¢çš„æ”¹è¿›ï¼Œä»¥å‡å°‘ç”±æ­¤å¯¼è‡´çš„ CPU è´Ÿè½½ã€‚åˆå§‹åŒ– BPF æ¨¡æ¿ä»¥é¿å…å…¨ç¼–è¯‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¢åŠ å¯¹ Kubernetes 1.12 çš„æ”¯æŒ&lt;/li&gt;
&lt;li&gt;ä¸º CiliumEndpoints CRD è‡ªå®šä¹‰åˆ—ï¼ˆéœ€è¦ Kubernetes 1.11 æ”¯æŒï¼‰&lt;/li&gt;
&lt;li&gt;ä¸º ulibc çš„å…¼å®¹æ€§ä» cilium-cni ç§»é™¤ cgo&lt;/li&gt;
&lt;li&gt;ç§»é™¤å¯¹ Kubernetes 1.7 çš„æ”¯æŒ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–‡æ¡£&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ–°çš„ Ubuntu 18.04 æ‰‹å†Œ&lt;/li&gt;
&lt;li&gt;å¯¹æœ€æ–°çš„ BPF è¿è¡Œæ—¶ç‰¹æ€§çš„è¦†ç›–ï¼Œä¾‹å¦‚ BTFï¼ˆBPF Type Formatï¼‰&lt;/li&gt;
&lt;li&gt;é’ˆå¯¹è¿è¡Œå¤šä¸»æœºç½‘ç»œçš„è™šæ‹Ÿæœº/ä¸»æœºé˜²ç«å¢™éœ€æ±‚çš„æ–‡æ¡£&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é•¿æœŸç¨³å®šç‰ˆæœ¬ (LTS)&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;1.3 å·²ç»å£°æ˜ä¸º LTS ç‰ˆæœ¬ï¼Œåœ¨åç»­çš„ 6 ä¸ªæœˆå°†ä½œä¸ºå‘åç§»æ¤çš„ç‰ˆæœ¬ç»§ç»­æ”¯æŒ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ›´æ–°æŒ‡å¯¼&#34;&gt;æ›´æ–°æŒ‡å¯¼&lt;/h2&gt;
&lt;p&gt;è¯·æŸ¥é˜…&lt;a href=&#34;https://cilium.readthedocs.io/en/v1.3/install/upgrade/#upgrading-minor-versions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;upgrade guide&lt;/a&gt;å»æ›´æ–°ä½ çš„ Cilium éƒ¨ç½²ï¼Œå¯ä»¥éšæ—¶åœ¨&lt;a href=&#34;http://cilium.io/slack&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slack&lt;/a&gt;ä¸Šè”ç³»æˆ‘ä»¬ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‘å¸ƒ&#34;&gt;å‘å¸ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å‘å¸ƒè®°å½•å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ &lt;a href=&#34;https://github.com/cilium/cilium/releases/tag/1.3.0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;1.3.0&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å®¹å™¨é•œåƒï¼š &lt;code&gt;docker.io/cilium/cilium:v1.3.0&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>SRE å¼¹æ€§èƒ½åŠ›ï¼šä½¿ç”¨ Envoy å¯¹åº”ç”¨è¿›è¡Œé€Ÿç‡é™åˆ¶</title>
      <link>https://cloudnative.to/blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/</link>
      <pubDate>Sun, 04 Nov 2018 12:00:46 +0800</pubDate>
      <guid>https://cloudnative.to/blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://medium.com/dm03514-tech-blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar-5381bd4a1137&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é€Ÿç‡é™åˆ¶æ˜¯ç¼“è§£çº§è”æ•…éšœå’Œé˜²æ­¢è€—å°½å…±äº«èµ„æºçš„ä¸€ç§ç®€å•æœ‰æ•ˆçš„æ–¹æ³•ã€‚&lt;code&gt;Envoy&lt;/code&gt; æ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„ä»£ç†ï¼Œå¯ä»¥ä¸ºä»»ä½•æœåŠ¡è½»æ¾æ·»åŠ é€Ÿç‡é™åˆ¶çš„åŠŸèƒ½ã€‚æœ¬æ–‡å°†ä»‹ç»åœ¨ä¸æ›´æ”¹åº”ç”¨ç¨‹åºæœ¬èº«é…ç½®çš„å‰æä¸‹å¦‚ä½•é…ç½® &lt;code&gt;Envoy&lt;/code&gt; æ¥å¼ºåˆ¶å¯¹åº”ç”¨è¿›è¡Œé€Ÿç‡é™åˆ¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é—®é¢˜&#34;&gt;é—®é¢˜&lt;/h2&gt;
&lt;p&gt;ä½ æ˜¯å¦é‡åˆ°è¿‡èµ„æºè¢«å¤§é‡çš„è¯·æ±‚æ·¹æ²¡æˆ–è€—å°½çš„æƒ…å†µï¼Ÿä½ çš„å®¢æˆ·ç«¯æ˜¯å¦å…·æœ‰å›é€€é‡è¯•æˆ–é€Ÿç‡é™åˆ¶çš„é€»è¾‘ï¼Ÿåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸å¯¹å…¶ä½¿ç”¨é‡è¿›è¡Œé™åˆ¶çš„èµ„æºå¾ˆå®¹æ˜“è¢«å®¢æˆ·ç«¯å‘å‡ºçš„å¤§é‡è¯·æ±‚æ‰€æ·¹æ²¡ã€‚å½“ç„¶å¯èƒ½å­˜åœ¨ä¸€å®šæ•°é‡çš„å®¢æˆ·ç«¯ï¼Œè¿™äº›å®¢æˆ·ç«¯æœ¬èº«å°±å·²ç»å®ç°äº†å„ç§é‡è¯•/å›é€€å’Œé€Ÿç‡é™åˆ¶çš„ç­–ç•¥ã€‚ä¸å¯¹è®¿é—®é‡è¿›è¡Œé™åˆ¶çš„å®¢æˆ·ç«¯ä¼šè€—å°½æœåŠ¡ç«¯çš„èµ„æºï¼Œä»è€Œä½¿å…¶ä»–å®¢æˆ·ç«¯æ— æ³•è®¿é—®æœåŠ¡ï¼Œç”šè‡³æœ‰äº›å®¢æˆ·ç«¯ä¼šä¸€ç›´å‘èµ·è¯·æ±‚ï¼Œç›´åˆ°ä½¿æœåŠ¡å®Œå…¨ä¸å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹ &lt;code&gt;API&lt;/code&gt; çš„ä½¿ç”¨è¿›è¡Œçº¦æŸçš„å¸¸ç”¨æ–¹æ³•æ˜¯å¯ç”¨é€Ÿç‡é™åˆ¶ã€‚ä¸åŸºäº IP çš„é€Ÿç‡é™åˆ¶æˆ–è€… web æ¡†æ¶æä¾›çš„åº”ç”¨çº§åˆ«é€Ÿç‡é™åˆ¶ä¸åŒï¼ŒEnvoy å…è®¸åœ¨ &lt;code&gt;HTTP&lt;/code&gt; å±‚å®ç°å¿«é€Ÿï¼Œé«˜æ€§èƒ½å’Œå¯é çš„å…¨å±€é€Ÿç‡é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwrjjnhj5rj30am0b1aa7_hucc3f900664f1d8ecb78c056c86fd2889_20980_03965e01e595919b43f077636bae73fa.webp 400w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwrjjnhj5rj30am0b1aa7_hucc3f900664f1d8ecb78c056c86fd2889_20980_8ac4117f6c7dae002e0e27507b716410.webp 760w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwrjjnhj5rj30am0b1aa7_hucc3f900664f1d8ecb78c056c86fd2889_20980_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwrjjnhj5rj30am0b1aa7_hucc3f900664f1d8ecb78c056c86fd2889_20980_03965e01e595919b43f077636bae73fa.webp&#34;
               width=&#34;382&#34;
               height=&#34;397&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸­å·¦ä¾§çš„ &lt;code&gt;Service Client&lt;/code&gt; ä»£è¡¨ä½¿ç”¨ç‡ç‰¹åˆ«é«˜çš„å®¢æˆ·ç«¯ã€‚åœ¨è¿è¡ŒæœŸé—´ï¼Œå®ƒå¯ä»¥ä½¿è´Ÿè½½å‡è¡¡åç«¯çš„æ‰€æœ‰æœåŠ¡å®ä¾‹æµé‡é¥±å’Œï¼Œå¹¶ä½¿å…¶ä»–æ›´é«˜ä¼˜å…ˆçº§çš„å®¢æˆ·ç«¯ä¸¢å¼ƒå…¶è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;Envoy èƒ½å¤Ÿå¯¹ç½‘ç»œçº§åˆ«çš„ä»»ä½•æœåŠ¡è¿›è¡Œé€Ÿç‡é™åˆ¶ï¼Œè€Œæ— éœ€å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚æ­¤å¤–ï¼Œç”±äº Envoy å·¥ä½œåœ¨ 7 å±‚ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨ç¨‹åºçº§åˆ«ï¼Œæ‰€ä»¥å®ƒå¯ä»¥æ£€æŸ¥ HTTP é€Ÿç‡ä¿¡æ¯å¹¶å¯¹å…¶è¿›è¡Œé€Ÿç‡é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œ&lt;a href=&#34;https://github.com/tsenart/vegeta&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vegata&lt;/a&gt; è´Ÿè½½æµ‹è¯•å·¥å…·ç”¨äºæ¨¡æ‹Ÿä¸Šè¿°ç¤ºä¾‹ä¸­çš„æ‰¹å¤„ç†ä½œä¸šã€‚ä¸‹å›¾æ˜¾ç¤ºäº†è¯·æ±‚é€Ÿç‡å¤§çº¦ä¸º &lt;code&gt;500æ¬¡/ç§’&lt;/code&gt; çš„ç¨³å®šçŠ¶æ€ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯‘è€…æ³¨ï¼šé¦–å…ˆå…‹éš† &lt;a href=&#34;https://github.com/dm03514/grokking-go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;grokking-go&lt;/a&gt; é¡¹ç›®ï¼Œç„¶åè¿›å…¥ &lt;code&gt;bolt-on-out-of-process-rate-limits&lt;/code&gt; ç›®å½•&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ make load-test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GET http://localhost:8080/slow&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; vegeta attack -rate&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;500&lt;/span&gt; -duration&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; tee results.bin &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; vegeta report
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwrjy191ohj30lr07jq34_hue153f076ea8ac7fcfb45a7b5203f8aa7_21755_1248d3716abf306787dde42f81f37604.webp 400w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwrjy191ohj30lr07jq34_hue153f076ea8ac7fcfb45a7b5203f8aa7_21755_cdfe14561a1f1ae5ff953d6e7a2387cb.webp 760w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwrjy191ohj30lr07jq34_hue153f076ea8ac7fcfb45a7b5203f8aa7_21755_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwrjy191ohj30lr07jq34_hue153f076ea8ac7fcfb45a7b5203f8aa7_21755_1248d3716abf306787dde42f81f37604.webp&#34;
               width=&#34;760&#34;
               height=&#34;263&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æ¨¡æ‹Ÿåå°ä½œä¸šæœŸé—´ï¼Œå¯¹ API èµ„æº &lt;code&gt;/slow&lt;/code&gt; çš„è®¿é—®é€Ÿç‡è¾¾åˆ°äº†æ¯ç§’ &lt;code&gt;3500&lt;/code&gt; ä¸ªè¯·æ±‚ï¼Œå½±å“åˆ°äº†å…¶ä»–ç«¯ç‚¹å’Œå®¢æˆ·ç«¯ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwrk228etaj30nd07m74v_hu9455341384b375f40c90d1248a8224c6_18577_56b5960cbdb970eba98124d84b2c6d95.webp 400w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwrk228etaj30nd07m74v_hu9455341384b375f40c90d1248a8224c6_18577_8a4e7bca949af756d35b434422e00930.webp 760w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwrk228etaj30nd07m74v_hu9455341384b375f40c90d1248a8224c6_18577_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwrk228etaj30nd07m74v_hu9455341384b375f40c90d1248a8224c6_18577_56b5960cbdb970eba98124d84b2c6d95.webp&#34;
               width=&#34;760&#34;
               height=&#34;248&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸‹é¢çš„è§£å†³æ–¹æ¡ˆå°†ä½¿ç”¨ Envoy å¼ºåˆ¶é™åˆ¶è¯·æ±‚é€Ÿç‡ä¸º &lt;code&gt;500ä¸ªè¯·æ±‚/ç§’&lt;/code&gt;ã€‚ä½†é¦–å…ˆ&amp;hellip;&lt;/p&gt;
&lt;h2 id=&#34;envoy-æ˜¯ä»€ä¹ˆ&#34;&gt;Envoy æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Envoy æ˜¯ä¸€ä¸ªè½»é‡çº§ä»£ç†æœåŠ¡å™¨ï¼Œèƒ½å¤Ÿå¤„ç†ä»»ä½• &lt;code&gt;TCP/IP/HTTP/GRPC/HTTP2&lt;/code&gt; ç­‰åè®®çš„è¿æ¥ã€‚å®ƒå…·æœ‰é«˜åº¦å¯é…ç½®æ€§ï¼Œå¹¶æ”¯æŒè®¸å¤šä¸åŒçš„æ’ä»¶ã€‚å®ƒè¿˜ä½¿å¯è§‚å¯Ÿæ€§æˆä¸ºä¸€ç­‰å…¬æ°‘ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Envoy æ¨ªç©ºå‡ºä¸–ä¹‹å‰ï¼Œåº”ç”¨ç¨‹åºçº§åˆ«çš„é‡è¯•ã€å»¶è¿Ÿæ³¨å…¥ã€é€Ÿç‡é™åˆ¶å’Œç†”æ–­éƒ½è¦é€šè¿‡åº”ç”¨ç¨‹åºæœ¬èº«çš„ä»£ç é€»è¾‘æ¥å®ç°ã€‚Envoy å°†è¿™äº›åŠŸèƒ½ä»åº”ç”¨ç¨‹åºä¸­å‰¥ç¦»å‡ºæ¥ï¼Œå¹¶è®©è¿ç»´ç®¡ç†äººå‘˜èƒ½å¤Ÿé…ç½®å’Œå¯ç”¨è¿™äº›åŠŸèƒ½ï¼Œæ— éœ€å¯¹åº”ç”¨ç¨‹åºæœ¬èº«ä½œä»»ä½•ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;Envoy çš„ &lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt; å’Œ &lt;code&gt; Matt Klein&lt;/code&gt; çš„æ–‡ç« æä¾›äº†ä¸€ä¸ªæ¯”æˆ‘æ›´å¥½çš„å¯¹ Envoy çš„ä»‹ç»ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Envoy æ˜¯ä¸€æ¬¾ç”± &lt;code&gt; Lyft&lt;/code&gt; å¼€æºçš„ï¼Œä½¿ç”¨ C++ ç¼–å†™çš„é«˜æ€§èƒ½åˆ†å¸ƒå¼ä»£ç†ï¼Œä¸“ä¸ºå•ä½“æœåŠ¡å’Œåº”ç”¨è€Œè®¾è®¡ã€‚å®ƒä¹Ÿè¢«ä½œä¸ºå¤§å‹å¾®æœåŠ¡æ¡†æ¶ &lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt; service mesh çš„é€šä¿¡æ€»çº¿å’Œé€šç”¨æ•°æ®å¹³é¢ã€‚é€šè¿‡å€Ÿé‰´ NGINXã€HAProxyã€ç¡¬ä»¶è´Ÿè½½å‡è¡¡å™¨å’Œäº‘è´Ÿè½½å‡è¡¡å™¨ç­‰è§£å†³æ–¹æ¡ˆï¼ŒEnvoy ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ä¸åº”ç”¨ç¨‹åºä¸€èµ·è¿è¡Œï¼Œå¹¶é€šè¿‡ä¸å¹³å°æ— å…³çš„æ–¹å¼æä¾›ä¸€äº›é«˜çº§ç‰¹æ€§ï¼Œä»è€Œå½¢æˆä¸€ä¸ªå¯¹åº”ç”¨é€æ˜çš„é€šä¿¡ç½‘æ ¼ã€‚å½“åŸºç¡€è®¾æ–½ä¸­çš„æ‰€æœ‰æœåŠ¡æµé‡é€šè¿‡ Envoy ç½‘æ ¼æµåŠ¨æ—¶ï¼Œé€šè¿‡ä¸€è‡´çš„å¯è§‚å¯Ÿæ€§ï¼Œè°ƒæ•´æ•´ä½“æ€§èƒ½å’Œæ·»åŠ æ›´å¤šåº•å±‚ç‰¹æ€§ï¼Œä¸€æ—¦å‘ç”Ÿç½‘ç»œå’Œåº”ç”¨ç¨‹åºæ•…éšœï¼Œèƒ½å¤Ÿå¾ˆå®¹æ˜“å®šä½å‡ºé—®é¢˜çš„æ ¹æºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;è§£å†³æ–¹æ¡ˆ&#34;&gt;è§£å†³æ–¹æ¡ˆ&lt;/h2&gt;
&lt;p&gt;æ‰€æœ‰ä»£ç å’Œç¤ºä¾‹éƒ½å¯ä»¥åœ¨ &lt;a href=&#34;https://github.com/dm03514/grokking-go/tree/master/bolt-on-out-of-process-rate-limits&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitHub&lt;/a&gt; ä¸Šæ‰¾åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ç»™å‡ºå…·ä½“çš„è§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°† Envoy é…ç½®ä¸º API è´Ÿè½½å‡è¡¡å™¨çš„å‰ç«¯ä»£ç†ï¼›ä»ç„¶å…è®¸æ‰€æœ‰æµé‡é€šè¿‡ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®å¹¶è¿è¡Œå…¨å±€é€Ÿç‡é™åˆ¶æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½® Envoy ä½¿ç”¨å…¨å±€é€Ÿç‡é™åˆ¶æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥é™åˆ¶åŒä¸€æ—¶é—´å‘å‡ºçš„è¯·æ±‚æ•°é‡ï¼Œä»¥ä¾¿å°† API è´Ÿè½½å‡è¡¡å™¨ä¸è¯·æ±‚è¾¾åˆ°é«˜å³°çš„å®¢æˆ·ç«¯éš”ç¦»ï¼Œå¹¶ç¡®ä¿å…¶ä»–å®¢æˆ·ç«¯åœ¨æ‰§è¡Œè¿™äº›æ‰¹å¤„ç†ä½œä¸šï¼ˆé€šè¿‡ &lt;code&gt;vegeta&lt;/code&gt; æ¥æ¨¡æ‹Ÿï¼‰æœŸé—´å¯ä»¥ç»§ç»­è®¿é—® APIã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬å°† Envoy ä»£ç†å’Œæ‰¹å¤„ç†å®¢æˆ·ç«¯ &lt;code&gt;vegeta&lt;/code&gt; éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡å°† Envoy ä½œä¸º &lt;code&gt;Sidecar&lt;/code&gt; ä¸æ‰¹å¤„ç†å®¢æˆ·ç«¯ä¸€èµ·è¿è¡Œï¼Œåœ¨è¯·æ±‚è¾¾åˆ°è´Ÿè½½å‡è¡¡ä¹‹å‰å°±å¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œé€Ÿç‡é™åˆ¶ã€‚ä½¿ç”¨ Envoy æ˜¯ä¸€ä¸ªå¾ˆæ˜æ™ºçš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒå…·æœ‰é«˜åº¦å¯é…ç½®æ€§ï¼Œé«˜æ€§èƒ½ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆå¥½åœ°å¤„ç† HTTP è¯·æ±‚ä¹‹é—´çš„å¹³è¡¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å°†-envoy-é…ç½®ä¸º-api-è´Ÿè½½å‡è¡¡å™¨çš„å‰ç«¯ä»£ç†&#34;&gt;å°† Envoy é…ç½®ä¸º API è´Ÿè½½å‡è¡¡å™¨çš„å‰ç«¯ä»£ç†&lt;/h3&gt;
&lt;p&gt;ç¬¬ä¸€æ­¥æ˜¯å°† Envoy é…ç½®ä¸ºå¤„äºæ‰¹å¤„ç†ä½œä¸šå®¢æˆ·ç«¯å’Œ API è´Ÿè½½å‡è¡¡å™¨ä¹‹é—´ï¼Œå®¢æˆ·ç«¯å‘ API å‘èµ·çš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šé¦–å…ˆç»è¿‡ Envoy çš„å¤„ç†ã€‚é¦–å…ˆéœ€è¦è®© Envoy çŸ¥é“å¦‚ä½•è¿æ¥ APIï¼Œç„¶åå†æ›´æ–°æ‰¹å¤„ç†ä½œä¸šçš„é…ç½®ï¼Œä½¿è¯¥å®¢æˆ·ç«¯å‘ Envoy å‘å‡ºè¯·èµ·ï¼Œè€Œä¸æ˜¯ç›´æ¥å‘ API å‘å‡ºè¯·æ±‚ã€‚é…ç½®å®Œä¹‹åçš„æœ€ç»ˆçŠ¶æ€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwskywz0cqj30ct0dywf6_hu1a06626278354b1634b4f945c26ff454_22049_7ae2c1f80b5a28038792564382d7b43c.webp 400w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwskywz0cqj30ct0dywf6_hu1a06626278354b1634b4f945c26ff454_22049_cc258b9ce028766638b2acdd0cc3191c.webp 760w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwskywz0cqj30ct0dywf6_hu1a06626278354b1634b4f945c26ff454_22049_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwskywz0cqj30ct0dywf6_hu1a06626278354b1634b4f945c26ff454_22049_7ae2c1f80b5a28038792564382d7b43c.webp&#34;
               width=&#34;461&#34;
               height=&#34;502&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ­¤æ­¥éª¤ä»…é€šè¿‡ Envoy æ¥å¯¹ API æµé‡è¿›è¡Œè·¯ç”±ï¼Œå°šæœªå¯¹åº”ç”¨è¿›è¡Œé€Ÿç‡é™åˆ¶ã€‚ä¸ºäº†è¾¾åˆ°é™é€Ÿçš„ç›®çš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åšä¸€äº›é¢å¤–çš„é…ç½®ï¼š&lt;/p&gt;
&lt;h4 id=&#34;clusterhttpswwwenvoyproxyiodocsenvoylatestintroarch_overviewcluster_manager&#34;&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/cluster_manager&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cluster&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;Cluster&lt;/code&gt; è¡¨ç¤º Envoy è¿æ¥åˆ°çš„ä¸€ç»„é€»è¾‘ä¸Šç›¸ä¼¼çš„ä¸Šæ¸¸ä¸»æœºï¼ˆåœ¨æœ¬ç¤ºä¾‹ä¸­è¡¨ç¤º API è´Ÿè½½å‡è¡¡å™¨ï¼‰ã€‚Cluster çš„é…ç½®éå¸¸ç®€å•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;strict_dns&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;round_robin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;localhost&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿è¡Œäº†ä¸€ä¸ªç›‘å¬åœ¨ &lt;code&gt;localhost:8080&lt;/code&gt; ä¸Šçš„ fakapi æ¥æ¨¡æ‹Ÿä¸Šå›¾ä¸­çš„è´Ÿè½½å‡è¡¡å™¨ã€‚é€šè¿‡ Envoy å‘ API å‘å‡ºçš„ä»»ä½•è¯·æ±‚éƒ½ä¼šè¢«å‘é€åˆ° &lt;code&gt;localhost:8080&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;virtual_hosthttpswwwenvoyproxyiodocsenvoylatestapi-v1route_configvhost&#34;&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v1/route_config/vhost&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;virtual_host&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;virtual_host&lt;/code&gt; éƒ¨åˆ†çš„é…ç½®ç”¨æ¥ç¡®ä¿æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè·¯ç”±åˆ°ä¸Šé¢å®šä¹‰çš„ API é›†ç¾¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä½™çš„é…ç½®æ–‡ä»¶ç”¨æ¥ç¡®å®š Envoy æœ¬èº«ç›‘å¬åœ¨å“ªä¸ªåœ°å€ä»¥åŠ Envoy ä¸å…¶ä»–æœåŠ¡ä¹‹é—´çš„è¿æ¥è§„åˆ™ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;static_resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;listener_0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address: 0.0.0.0, port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10000&lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.http_connection_manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress_http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;codec_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AUTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;remote_api&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.router&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;strict_dns&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;round_robin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;localhost&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;admin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;access_log_path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/dev/null&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.0.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9901&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ›´æ–°è´Ÿè½½æµ‹è¯•å·¥å…·çš„å‚æ•°ï¼Œç›´æ¥è®¿é—®æœ¬åœ°çš„ Envoy ä»£ç†ï¼Œé€šè¿‡ä»ªè¡¨æ¿å¯ä»¥è§‚å¯Ÿåˆ° Envoy æ­£åœ¨æ¥æ”¶æµé‡ã€‚ä¸‹å›¾çš„ Envoy ä»ªè¡¨æ¿æ¥è‡ª &lt;a href=&#34;https://grafana.com/dashboards/7250&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grafana å®˜æ–¹ä»ªè¡¨æ¿ä»“åº“&lt;/a&gt;ï¼ˆ&lt;a href=&#34;https://blog.envoyproxy.io/lyfts-envoy-dashboards-5c91738816b1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Lyft ä¹Ÿæä¾›äº†ä¸€ä»½ Envoy ä»ªè¡¨æ¿&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ make load-test &lt;span class=&#34;nv&#34;&gt;LOAD_TEST_TARGET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;http://localhost:10000 &lt;span class=&#34;nv&#34;&gt;LOAD_TEST_RATE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;500&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GET http://localhost:10000/slow&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; vegeta attack -rate&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;500&lt;/span&gt; -duration&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; tee results.bin &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; vegeta report
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmozv3daj30nr07lgm9_hu21832102c3ac8b0ab56cc04e88392be7_20440_b440a325eb3a1b6d62d1a72f2470a35b.webp 400w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmozv3daj30nr07lgm9_hu21832102c3ac8b0ab56cc04e88392be7_20440_64d5f0094a193fe9e4cf6e6706af7bfe.webp 760w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmozv3daj30nr07lgm9_hu21832102c3ac8b0ab56cc04e88392be7_20440_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmozv3daj30nr07lgm9_hu21832102c3ac8b0ab56cc04e88392be7_20440_b440a325eb3a1b6d62d1a72f2470a35b.webp&#34;
               width=&#34;760&#34;
               height=&#34;243&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmprdwh2j30br07hq3b_hub72ada145f0948f5c31e5e1470e30ab6_14153_1f04801058e6367a104f69d2cc64b25e.webp 400w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmprdwh2j30br07hq3b_hub72ada145f0948f5c31e5e1470e30ab6_14153_3b008c18defd3eaa1129e9b58759ef9e.webp 760w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmprdwh2j30br07hq3b_hub72ada145f0948f5c31e5e1470e30ab6_14153_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmprdwh2j30br07hq3b_hub72ada145f0948f5c31e5e1470e30ab6_14153_1f04801058e6367a104f69d2cc64b25e.webp&#34;
               width=&#34;423&#34;
               height=&#34;269&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmq2wanfj30nr07kgm6_hu5d8961ad8f5c205c52107f747280ffeb_18509_0629a5a6435a84b24e715600bd194010.webp 400w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmq2wanfj30nr07kgm6_hu5d8961ad8f5c205c52107f747280ffeb_18509_ef516bfb9e198ce6fdc95c8947474934.webp 760w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmq2wanfj30nr07kgm6_hu5d8961ad8f5c205c52107f747280ffeb_18509_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmq2wanfj30nr07kgm6_hu5d8961ad8f5c205c52107f747280ffeb_18509_0629a5a6435a84b24e715600bd194010.webp&#34;
               width=&#34;760&#34;
               height=&#34;242&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ˜¾ç¤º Envoy ç°åœ¨æ­£åœ¨æ¥æ”¶å®¢æˆ·ç«¯å‘é€ç»™ API çš„æ‰€æœ‰è¯·æ±‚ï¼Œå¹¶å°†å®ƒä»¬å‘é€åˆ°ä¸Šæ¸¸çš„è´Ÿè½½å‡è¡¡å™¨ï¼&lt;/p&gt;
&lt;h3 id=&#34;é…ç½®å¹¶è¿è¡Œå…¨å±€é€Ÿç‡é™åˆ¶æœåŠ¡&#34;&gt;é…ç½®å¹¶è¿è¡Œå…¨å±€é€Ÿç‡é™åˆ¶æœåŠ¡&lt;/h3&gt;
&lt;p&gt;æ­¤æ­¥éª¤å°†é…ç½®è¿è¡Œ Lyft å¼€æºçš„å…¨å±€ &lt;a href=&#34;https://github.com/lyft/ratelimit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€Ÿç‡é™åˆ¶&lt;/a&gt; æœåŠ¡ã€‚è¿è¡Œè¯¥æœåŠ¡éå¸¸ç®€å•ï¼Œåªéœ€è¦å…‹éš†å®ƒçš„ä»£ç ä»“åº“ï¼Œä¿®æ”¹ä¸€éƒ¨åˆ†é…ç½®æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ &lt;code&gt;docker-compose&lt;/code&gt; å¯åŠ¨å°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmxzrlsmj30hk0dyaav_hud078028e69e8951f2a7870f94e497b73_25081_906e9a49c2122e061ef70dfcb4baab02.webp 400w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmxzrlsmj30hk0dyaav_hud078028e69e8951f2a7870f94e497b73_25081_b5c653dcb6588d380ff78e978c23f262.webp 760w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmxzrlsmj30hk0dyaav_hud078028e69e8951f2a7870f94e497b73_25081_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsmxzrlsmj30hk0dyaav_hud078028e69e8951f2a7870f94e497b73_25081_906e9a49c2122e061ef70dfcb4baab02.webp&#34;
               width=&#34;632&#34;
               height=&#34;502&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é¦–å…ˆå…‹éš† &lt;a href=&#34;https://github.com/lyft/ratelimit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ratelimit ä»£ç ä»“åº“&lt;/a&gt;å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ›´æ–° &lt;code&gt;domain&lt;/code&gt; å­—æ®µä»¥åŠ &lt;code&gt;descriptor&lt;/code&gt; å­—æ®µçš„ &lt;code&gt;key&lt;/code&gt; å’Œ &lt;code&gt;value&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat examples/ratelimit/config/config.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apis&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;descriptors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;generic_key&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rate_limit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;unit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;second&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requests_per_unit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;500&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ä½¿ç”¨ docker-compose çš„é…ç½®æ–‡ä»¶ï¼ˆ&lt;code&gt;docker-compose.yml&lt;/code&gt;ï¼‰æ¥å¯åŠ¨å…¨å±€é€Ÿç‡é™åˆ¶æœåŠ¡ï¼ˆè¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ &lt;a href=&#34;https://github.com/lyft/ratelimit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;README&lt;/a&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker-compose down &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; docker-compose up
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;é…ç½®-envoy-ä½¿ç”¨å…¨å±€é€Ÿç‡é™åˆ¶æœåŠ¡&#34;&gt;é…ç½® Envoy ä½¿ç”¨å…¨å±€é€Ÿç‡é™åˆ¶æœåŠ¡&lt;/h3&gt;
&lt;p&gt;æœ€åä¸€æ­¥æ˜¯é…ç½® Envoy ä½¿ç”¨å…¨å±€é€Ÿç‡é™åˆ¶æœåŠ¡ï¼Œä»¥å¼ºåˆ¶æ‰§è¡Œé€Ÿç‡é™åˆ¶å¹¶é™ä½å¯¹ API çš„è¯·æ±‚é€Ÿç‡ã€‚é…ç½®ç”Ÿæ•ˆåï¼ŒEnvoy å°†ä¼šæ£€æŸ¥æ¯ä¸ªä¼ å…¥è¿æ¥çš„é€Ÿç‡é™åˆ¶ï¼Œå¹¶æ ¹æ®ä¸Šé¢çš„é…ç½®è¿‡æ»¤æ‰ä¸€éƒ¨åˆ†è¯·æ±‚ï¼ˆé™åˆ¶æœ€å¤š 500 ä¸ªè¯·æ±‚/ç§’ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsnt0oi5gj30hk0de3zb_hu8fa1237cef67adffad7a86c9b63fdbca_24850_76bd4fbfb69f87b7fef7dd2109c07798.webp 400w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsnt0oi5gj30hk0de3zb_hu8fa1237cef67adffad7a86c9b63fdbca_24850_abecbcf263ac4fb16dea62f474ef2388.webp 760w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsnt0oi5gj30hk0de3zb_hu8fa1237cef67adffad7a86c9b63fdbca_24850_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsnt0oi5gj30hk0de3zb_hu8fa1237cef67adffad7a86c9b63fdbca_24850_76bd4fbfb69f87b7fef7dd2109c07798.webp&#34;
               width=&#34;632&#34;
               height=&#34;482&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¼€å¯äº†é€Ÿç‡é™åˆ¶çš„ Envoy é…ç½®æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;static_resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;listener_0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address: 0.0.0.0, port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10000&lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.http_connection_manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;use_remote_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress_http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;codec_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AUTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;remote_api&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rate_limits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;stage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;- {&lt;span class=&#34;nt&#34;&gt;generic_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;nt&#34;&gt;descriptor_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;}}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.rate_limit&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apis&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.router&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;strict_dns&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;round_robin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;localhost&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rate_limit_cluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;strict_dns&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;25s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;round_robin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http2_protocol_options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;localhost&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8081&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rate_limit_service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;grpc_service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;envoy_grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rate_limit_cluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;25s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;admin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;access_log_path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/dev/null&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.0.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9901&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åï¼Œæˆ‘ä»¬ä»¥ &lt;code&gt;1000ä¸ªè¯·æ±‚/ç§’&lt;/code&gt; çš„é€Ÿç‡ï¼ˆé€Ÿç‡é™åˆ¶çš„ 2 å€ï¼‰è¿è¡Œè´Ÿè½½æµ‹è¯•å·¥å…·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ make load-test &lt;span class=&#34;nv&#34;&gt;LOAD_TEST_TARGET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;http://localhost:10000 &lt;span class=&#34;nv&#34;&gt;LOAD_TEST_RATE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GET http://localhost:10000/slow&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; vegeta attack -rate&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt; -duration&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; tee results.bin &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; vegeta report
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ ratelimiter æœåŠ¡çš„æ—¥å¿—ï¼Œæ—¥å¿—ä¸­æ˜¾ç¤ºäº†å®ƒæ¥æ”¶çš„è¯·æ±‚å’Œå®ƒè¿›è¡Œé€Ÿç‡é™åˆ¶æ£€æŸ¥çš„è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cache key: apis_generic_key_default_1540829538 current: 35&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ratelimit_1        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2018-10-29T16:12:18Z&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;debug &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cache key: apis_generic_key_default_1540829538 current: 34&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ratelimit_1        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2018-10-29T16:12:18Z&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;debug &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cache key: apis_generic_key_default_1540829538 current: 33&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ratelimit_1        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2018-10-29T16:12:18Z&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;debug &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cache key: apis_generic_key_default_1540829538 current: 31&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ratelimit_1        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2018-10-29T16:12:18Z&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;debug &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cache key: apis_generic_key_default_1540829538 current: 32&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ratelimit_1        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2018-10-29T16:12:18Z&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;debug &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cache key: apis_generic_key_default_1540829538 current: 42&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ratelimit_1        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2018-10-29T16:12:18Z&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;debug &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;starting get limit lookup&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ratelimit_1        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2018-10-29T16:12:18Z&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;debug &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cache key: apis_generic_key_default_1540829538 current: 46&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ratelimit_1        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2018-10-29T16:12:18Z&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;debug &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;looking up key: generic_key_default&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ratelimit_1        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2018-10-29T16:12:18Z&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;debug &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;looking up key: generic_key_default&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ratelimit_1        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2018-10-29T16:12:18Z&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;debug &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;looking up key: generic_key_default&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ratelimit_1        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2018-10-29T16:12:18Z&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;debug &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;looking up key: generic_key_default&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ratelimit_1        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2018-10-29T16:12:18Z&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;debug &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;looking up key: generic_key_default&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å¦‚æœé€Ÿç‡é™åˆ¶åŠŸèƒ½æ— æ³•ç”Ÿæ•ˆï¼Œå¯ä»¥å‚è€ƒè¯¥ &lt;a href=&#34;https://github.com/envoyproxy/envoy/issues/3388&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;issue&lt;/a&gt; ä¸­çš„è®¨è®ºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œåœæ­¢è´Ÿè½½æµ‹è¯•æ‰“å°å‡ºæµ‹è¯•æŠ¥å‘Šï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­ &lt;code&gt;1/2&lt;/code&gt; çš„è¯·æ±‚è¢« Envoy é™åˆ¶äº†ï¼Œè¢«é™åˆ¶çš„è¯·æ±‚çš„çŠ¶æ€ç ä¸º &lt;code&gt;429&lt;/code&gt; ï¼ï¼ï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ make load-test &lt;span class=&#34;nv&#34;&gt;LOAD_TEST_TARGET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;http://localhost:10000 &lt;span class=&#34;nv&#34;&gt;LOAD_TEST_RATE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GET http://localhost:10000/slow&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; vegeta attack -rate&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt; -duration&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; tee results.bin &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; vegeta report
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Requests      &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;total, rate&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;            128093, 1000.02
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Duration      &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;total, attack, wait&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;    2m8.102168403s, 2m8.090470728s, 11.697675ms
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Latencies     &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mean, 50, 95, 99, max&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  10.294365ms, 11.553135ms, 33.428287ms, 52.678127ms, 177.709494ms
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Bytes In      &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;total, mean&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;            1207354, 9.43
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Bytes Out     &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;total, mean&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;            0, 0.00
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Success       &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ratio&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;                  52.69%
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Status Codes  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;code:count&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;             200:67494  429:60599
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Error Set:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;429&lt;/span&gt; Too Many Requests
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡ Envoy æš´éœ²çš„é€Ÿç‡é™åˆ¶æŒ‡æ ‡ï¼ˆ&lt;code&gt;envoy_cluster_ratelimit_over_limit&lt;/code&gt;ï¼‰æˆ–ï¼ˆ&lt;code&gt;4xx&lt;/code&gt; å“åº”ï¼‰çš„é€Ÿç‡æ¥ç»˜åˆ¶ä»ªè¡¨æ¿ï¼Œå¯ä»¥çœ‹åˆ°ç›¸åº”çš„å¯è§†åŒ–å›¾è¡¨ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsohfxmscj30m107iq3k_hu93ad2fd32640a8b1cc92a362fe2bceed_20390_77a279352d6426fdad08bdde8b8ad2b0.webp 400w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsohfxmscj30m107iq3k_hu93ad2fd32640a8b1cc92a362fe2bceed_20390_17bbfbaa2847b071188798f251607c18.webp 760w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsohfxmscj30m107iq3k_hu93ad2fd32640a8b1cc92a362fe2bceed_20390_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsohfxmscj30m107iq3k_hu93ad2fd32640a8b1cc92a362fe2bceed_20390_77a279352d6426fdad08bdde8b8ad2b0.webp&#34;
               width=&#34;760&#34;
               height=&#34;259&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é€šè¿‡å¯è§†åŒ– API æœåŠ¡å®é™…çœ‹åˆ°çš„è¯·æ±‚æ•°é‡ï¼Œå¯ä»¥è¯æ˜è¯·æ±‚é€Ÿç‡åœ¨ &lt;code&gt;500ä¸ªè¯·æ±‚/ç§’&lt;/code&gt; ä¸Šä¸‹æ³¢åŠ¨ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ï¼&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsongr2zhj30jw07ejrr_hu95d553b76310634482124f14ee1b9866_13508_ccd23aebd996427dac510109c9c18e5e.webp 400w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsongr2zhj30jw07ejrr_hu95d553b76310634482124f14ee1b9866_13508_92d724b467e605cf2fa6a913abe5937c.webp 760w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsongr2zhj30jw07ejrr_hu95d553b76310634482124f14ee1b9866_13508_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsongr2zhj30jw07ejrr_hu95d553b76310634482124f14ee1b9866_13508_ccd23aebd996427dac510109c9c18e5e.webp&#34;
               width=&#34;716&#34;
               height=&#34;266&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å†æŸ¥çœ‹ä¸€ä¸‹ Envoy ä¼ å‡ºçš„ API è¿æ¥ï¼Œå¯ä»¥çœ‹åˆ°ä¼ å‡ºè¯·æ±‚é€Ÿç‡ä¹Ÿåœ¨ &lt;code&gt;500ä¸ªè¯·æ±‚/ç§’&lt;/code&gt; ä¸Šä¸‹æ³¢åŠ¨ï¼&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsopzl2uhj30l707ijry_hu61b9463646a86e5bfd7b11ae9f55e64f_18399_da3af76d8e5b273abf2a50a607c5ff75.webp 400w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsopzl2uhj30l707ijry_hu61b9463646a86e5bfd7b11ae9f55e64f_18399_ca5bd170f527a4dabbebaeb3bc674432.webp 760w,
               /blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsopzl2uhj30l707ijry_hu61b9463646a86e5bfd7b11ae9f55e64f_18399_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/sre-resiliency-bolt-on-sidecar-rate-limiting-with-envoy-sidecar/006tNbRwgy1fwsopzl2uhj30l707ijry_hu61b9463646a86e5bfd7b11ae9f55e64f_18399_da3af76d8e5b273abf2a50a607c5ff75.webp&#34;
               width=&#34;760&#34;
               height=&#34;269&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å®éªŒæˆåŠŸï¼&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å¸Œæœ›é€šè¿‡æœ¬æ–‡çš„è®²è§£èƒ½è®©ä½ æ˜ç™½é…ç½® Envoy ä»¥å‡è½»è´ªå©ªå®¢æˆ·ç«¯å¯¹ API èµ„æºçš„æ¶ˆè€—æ˜¯å¤šä¹ˆç®€å•ã€‚æˆ‘å‘ç°è¿™ç§æ¨¡å¼éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå¼¹æ€§èƒ½åŠ›æ˜¯ä¸ºåº”ç”¨å¼€å‘æ›´å¤šåŠŸèƒ½çš„åŸºç¡€ã€‚åœ¨ Envoy æ¨ªç©ºå‡ºä¸–ä¹‹å‰ï¼Œåº”ç”¨ç¨‹åºçº§åˆ«çš„é‡è¯•ã€å»¶è¿Ÿæ³¨å…¥ã€é€Ÿç‡é™åˆ¶å’Œç†”æ–­éƒ½è¦é€šè¿‡åº”ç”¨ç¨‹åºæœ¬èº«çš„ä»£ç é€»è¾‘æ¥å®ç°ã€‚Envoy å°†è¿™äº›åŠŸèƒ½ä»åº”ç”¨ç¨‹åºä¸­å‰¥ç¦»å‡ºæ¥ï¼Œå¹¶è®©è¿ç»´ç®¡ç†äººå‘˜èƒ½å¤Ÿé…ç½®å’Œå¯ç”¨è¿™äº›åŠŸèƒ½ï¼Œæ— éœ€å¯¹åº”ç”¨ç¨‹åºæœ¬èº«ä½œä»»ä½•ä¿®æ”¹ã€‚Envoy å®Œå…¨é¢ è¦†äº†æˆ‘ä»¬å¯¹æœåŠ¡å¼¹æ€§èƒ½åŠ›çš„è®¤çŸ¥ï¼Œå¸Œæœ›ä½ è¯»è¿™ç¯‡æ–‡ç« æ—¶èƒ½å’Œæˆ‘å†™è¿™ç¯‡æ–‡ç« æ—¶ä¸€æ ·å…´å¥‹ï¼&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒèµ„æ–™&#34;&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.datawire.io/envoyproxy/getting-started-lyft-envoy-microservices-resilience/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.datawire.io/envoyproxy/getting-started-lyft-envoy-microservices-resilience/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.envoyproxy.io/docs/envoy/latest/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.turbinelabs.io/deploying-envoy-as-a-front-proxy-5b7e0a453f65&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://blog.turbinelabs.io/deploying-envoy-as-a-front-proxy-5b7e0a453f65&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.christianposta.com/microservices/00-microservices-patterns-with-envoy-proxy-series/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://blog.christianposta.com/microservices/00-microservices-patterns-with-envoy-proxy-series/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.envoyproxy.io/introduction-to-modern-network-load-balancing-and-proxying-a57f6ff80236&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://blog.envoyproxy.io/introduction-to-modern-network-load-balancing-and-proxying-a57f6ff80236&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://eng.lyft.com/announcing-ratelimit-c2e8f3182555&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://eng.lyft.com/announcing-ratelimit-c2e8f3182555&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/dm03514/grokking-go/compare/blog/bolt-on-rate-limits?expand=1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/dm03514/grokking-go/compare/blog/bolt-on-rate-limits?expand=1&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Envoy ä¸­çš„ xDS REST å’Œ gRPC åè®®è¯¦è§£</title>
      <link>https://cloudnative.to/blog/envoy-xds-protocol/</link>
      <pubDate>Fri, 28 Sep 2018 19:07:20 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-xds-protocol/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-docs/xds_protocol&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Envoy é€šè¿‡æŸ¥è¯¢æ–‡ä»¶æˆ–ç®¡ç†æœåŠ¡å™¨æ¥åŠ¨æ€å‘ç°èµ„æºã€‚æ¦‚æ‹¬åœ°è®²ï¼Œå¯¹åº”çš„å‘ç°æœåŠ¡åŠå…¶ç›¸åº”çš„ API è¢«ç§°ä½œ  &lt;em&gt;xDS&lt;/em&gt;ã€‚Envoy é€šè¿‡è®¢é˜…ï¼ˆ&lt;em&gt;subscription&lt;/em&gt;ï¼‰æ–¹å¼æ¥è·å–èµ„æºï¼Œå¦‚ç›‘æ§æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ã€å¯åŠ¨ gRPC æµæˆ–è½®è¯¢ REST-JSON URLã€‚åä¸¤ç§æ–¹å¼ä¼šå‘é€ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/discovery.proto#discoveryrequest&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;DiscoveryRequest&lt;/code&gt;&lt;/a&gt; è¯·æ±‚æ¶ˆæ¯ï¼Œå‘ç°çš„å¯¹åº”èµ„æºåˆ™åŒ…å«åœ¨å“åº”æ¶ˆæ¯ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/discovery.proto#discoveryresponse&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;DiscoveryResponse&lt;/code&gt;&lt;/a&gt; ä¸­ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†å…·ä½“è®¨è®ºæ¯ç§è®¢é˜…ç±»å‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ–‡ä»¶è®¢é˜…&#34;&gt;æ–‡ä»¶è®¢é˜…&lt;/h2&gt;
&lt;p&gt;å‘ç°åŠ¨æ€èµ„æºçš„æœ€ç®€å•æ–¹å¼å°±æ˜¯å°†å…¶ä¿å­˜äºæ–‡ä»¶ï¼Œå¹¶å°†è·¯å¾„é…ç½®åœ¨ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/core/config_source.proto#core-configsource&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ConfigSource&lt;/a&gt; ä¸­çš„ &lt;code&gt;path&lt;/code&gt; å‚æ•°ä¸­ã€‚Envoy ä½¿ç”¨ &lt;code&gt;inotify&lt;/code&gt;ï¼ˆMac OS X ä¸Šä¸º &lt;code&gt;kqueue&lt;/code&gt;ï¼‰æ¥ç›‘æ§æ–‡ä»¶çš„å˜åŒ–ï¼Œåœ¨æ–‡ä»¶è¢«æ›´æ–°æ—¶ï¼ŒEnvoy è¯»å–ä¿å­˜çš„ &lt;code&gt;DiscoveryResponse&lt;/code&gt; æ•°æ®è¿›è¡Œè§£æï¼Œæ•°æ®æ ¼å¼å¯ä»¥ä¸ºäºŒè¿›åˆ¶ protobufã€JSONã€YAML å’Œåè®®æ–‡æœ¬ç­‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯‘è€…æ³¨ï¼šcore.ConfigSource é…ç½®æ ¼å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_config_source&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;ads&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ–‡ä»¶è®¢é˜…æ–¹å¼å¯æä¾›ç»Ÿè®¡æ•°æ®å’Œæ—¥å¿—ä¿¡æ¯ï¼Œä½†æ˜¯ç¼ºå°‘ ACK/NACK æ›´æ–°çš„æœºåˆ¶ã€‚å¦‚æœæ›´æ–°çš„é…ç½®è¢«æ‹’ç»ï¼ŒxDS API åˆ™ç»§ç»­ä½¿ç”¨æœ€åä¸€ä¸ªçš„æœ‰æ•ˆé…ç½®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;grpc-æµå¼è®¢é˜…&#34;&gt;gRPC æµå¼è®¢é˜…&lt;/h2&gt;
&lt;h3 id=&#34;å•èµ„æºç±»å‹å‘ç°&#34;&gt;å•èµ„æºç±»å‹å‘ç°&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ª xDS API å¯ä»¥å•ç‹¬é…ç½® &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/core/config_source.proto#core-apiconfigsource&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;ApiConfigSource&lt;/code&gt;&lt;/a&gt;ï¼ŒæŒ‡å‘å¯¹åº”çš„ä¸Šæ¸¸ç®¡ç†æœåŠ¡å™¨çš„é›†ç¾¤åœ°å€ã€‚æ¯ä¸ª xDS èµ„æºç±»å‹ä¼šå¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„åŒå‘ gRPC æµï¼Œå¯èƒ½å¯¹åº”ä¸åŒçš„ç®¡ç†æœåŠ¡å™¨ã€‚API äº¤ä»˜æ–¹å¼é‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§ã€‚å¯ä»¥å‚è€ƒåç»­èšåˆæœåŠ¡å‘ç°ï¼ˆADSï¼‰ç« èŠ‚æ¥äº†è§£å¿…è¦çš„æ˜¾å¼æ§åˆ¶åºåˆ—ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯‘è€…æ³¨ï¼šcore.ApiConfigSource é…ç½®æ ¼å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_names&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc_services&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;refresh_delay&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;request_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;ç±»å‹-url&#34;&gt;ç±»å‹ URL&lt;/h4&gt;
&lt;p&gt;æ¯ä¸ª xDS API éƒ½ä¸ç»™å®šçš„èµ„æºçš„ç±»å‹å­˜åœ¨ 1:1 å¯¹åº”ã€‚å…³ç³»å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/lds.proto&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;LDS: &lt;code&gt;envoy.api.v2.Listener&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/rds.proto&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RDS: &lt;code&gt;envoy.api.v2.RouteConfiguration&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/cds.proto&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CDS: &lt;code&gt;envoy.api.v2.Cluster&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/eds.proto&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EDS: &lt;code&gt;envoy.api.v2.ClusterLoadAssignment&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/auth/cert.proto&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SDS:&lt;code&gt;envoy.api.v2.Auth.Secret&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://developers.google.com/protocol-buffers/docs/proto3#any&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;em&gt;ç±»å‹ URL&lt;/em&gt;&lt;/a&gt; çš„æ¦‚å¿µå¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶é‡‡ç”¨ &lt;code&gt;type.googleapis.com/&amp;lt;resource type&amp;gt;&lt;/code&gt; çš„å½¢å¼ï¼Œä¾‹å¦‚ CDS å¯¹åº”äº  &lt;code&gt;type.googleapis.com/envoy.api.v2.Cluster&lt;/code&gt;ã€‚åœ¨ Envoy çš„è¯·æ±‚å’Œç®¡ç†æœåŠ¡å™¨çš„å“åº”ä¸­ï¼Œéƒ½åŒ…æ‹¬äº†èµ„æºç±»å‹ URLã€‚&lt;/p&gt;
&lt;h4 id=&#34;acknack-å’Œç‰ˆæœ¬&#34;&gt;ACK/NACK å’Œç‰ˆæœ¬&lt;/h4&gt;
&lt;p&gt;æ¯ä¸ª Envoy æµä»¥  &lt;code&gt;DiscoveryRequest&lt;/code&gt; å¼€å§‹ï¼ŒåŒ…æ‹¬äº†åˆ—è¡¨è®¢é˜…çš„èµ„æºã€è®¢é˜…èµ„æºå¯¹åº”çš„ç±»å‹ URLã€èŠ‚ç‚¹æ ‡è¯†ç¬¦å’Œç©ºçš„ &lt;code&gt;version_info&lt;/code&gt;ã€‚EDS è¯·æ±‚ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;version_info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy }&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resource_names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type_url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.api.v2.ClusterLoadAssignment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;response_nonce&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç®¡ç†æœåŠ¡å™¨å¯ç«‹åˆ»æˆ–ç­‰å¾…èµ„æºå°±ç»ªæ—¶å‘é€ &lt;code&gt;DiscoveryResponse &lt;/code&gt;ä½œä¸ºå“åº”ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;version_info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;X&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;foo ClusterLoadAssignment proto encoding&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;bar ClusterLoadAssignment proto encoding&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type_url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.api.v2.ClusterLoadAssignment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;nonce&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Envoy åœ¨å¤„ç† &lt;code&gt;DiscoveryResponse&lt;/code&gt; å“åº”åï¼Œå°†é€šè¿‡æµå‘é€ä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼Œè¯·æ±‚åŒ…å«åº”ç”¨æˆåŠŸçš„æœ€åä¸€ä¸ªç‰ˆæœ¬å·å’Œç®¡ç†æœåŠ¡å™¨æä¾›çš„ &lt;code&gt;nonce&lt;/code&gt;ã€‚å¦‚æœæœ¬æ¬¡æ›´æ–°å·²æˆåŠŸåº”ç”¨ï¼Œåˆ™ &lt;code&gt;version_info&lt;/code&gt; çš„å€¼è®¾ç½®ä¸º &lt;strong&gt;X&lt;/strong&gt;ï¼Œå¦‚ä¸‹åºåˆ—å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-version-update-after-ack&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/envoy-xds-protocol/7e0ee03agy1fvmxs5aod1j20cc06y74c.jpg&#34; alt=&#34;Version update after ACK&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Version update after ACK
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤åºåˆ—å›¾åŠåç»­ä¸­ï¼Œå°†ç»Ÿä¸€ä½¿ç”¨ä»¥ä¸‹ç¼©å†™æ ¼å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;DiscoveryRequest&lt;/code&gt;ï¼š (V=&lt;code&gt;version_info&lt;/code&gt;ï¼ŒR=&lt;code&gt;resource_names&lt;/code&gt;ï¼ŒN=&lt;code&gt;response_nonce&lt;/code&gt;ï¼ŒT=&lt;code&gt;type_url&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DiscoveryResponse&lt;/code&gt;ï¼š (V=&lt;code&gt;version_info&lt;/code&gt;ï¼ŒR=&lt;code&gt;resources&lt;/code&gt;ï¼ŒN=&lt;code&gt;nonce&lt;/code&gt;ï¼ŒT=&lt;code&gt;type_url&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯‘è€…æ³¨ï¼šåœ¨&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E8%B3%87%E8%A8%8A%E5%AE%89%E5%85%A8&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¿¡æ¯å®‰å…¨&lt;/a&gt;ä¸­ï¼Œ&lt;strong&gt;Nonce&lt;/strong&gt;æ˜¯ä¸€ä¸ªåœ¨åŠ å¯†é€šä¿¡åªèƒ½ä½¿ç”¨ä¸€æ¬¡çš„æ•°å­—ã€‚åœ¨è®¤è¯åè®®ä¸­ï¼Œå®ƒå¾€å¾€æ˜¯ä¸€ä¸ª&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E9%9A%8F%E6%9C%BA&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éšæœº&lt;/a&gt;æˆ–&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E4%BC%AA%E9%9A%8F%E6%9C%BA&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¼ªéšæœº&lt;/a&gt;æ•°ï¼Œä»¥é¿å…&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é‡æ”¾æ”»å‡»&lt;/a&gt;ã€‚Nonce ä¹Ÿç”¨äº&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E6%B5%81%E5%AF%86%E7%A0%81&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æµå¯†ç &lt;/a&gt;ä»¥ç¡®ä¿å®‰å…¨ã€‚å¦‚æœéœ€è¦ä½¿ç”¨ç›¸åŒçš„å¯†é’¥åŠ å¯†ä¸€ä¸ªä»¥ä¸Šçš„æ¶ˆæ¯ï¼Œå°±éœ€è¦ Nonce æ¥ç¡®ä¿ä¸åŒçš„æ¶ˆæ¯ä¸è¯¥å¯†é’¥åŠ å¯†çš„å¯†é’¥æµä¸åŒã€‚ï¼ˆå¼•ç”¨è‡ª&lt;a href=&#34;https://zh.wikipedia.org/wiki/Nonce&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç»´åŸºç™¾ç§‘&lt;/a&gt;ï¼‰åœ¨æœ¬æ–‡ä¸­&lt;code&gt;nonce&lt;/code&gt;æ˜¯æ¯æ¬¡æ›´æ–°çš„æ•°æ®åŒ…çš„å”¯ä¸€æ ‡è¯†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç‰ˆæœ¬ä¸º Envoy å’Œç®¡ç†æœåŠ¡å™¨æä¾›äº†å…±äº«å½“å‰åº”ç”¨é…ç½®çš„æ¦‚å¿µå’Œé€šè¿‡ ACK/NACK æ¥è¿›è¡Œé…ç½®æ›´æ–°çš„æœºåˆ¶ã€‚å¦‚æœ Envoy æ‹’ç»é…ç½®æ›´æ–° &lt;strong&gt;X&lt;/strong&gt;ï¼Œåˆ™å›å¤ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/discovery.proto#envoy-api-field-discoveryrequest-error-detail&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;error_detail&lt;/code&gt;&lt;/a&gt; åŠå‰ä¸€ä¸ªçš„ç‰ˆæœ¬å·ï¼Œåœ¨å½“å‰æƒ…å†µä¸‹ä¸ºç©ºçš„åˆå§‹ç‰ˆæœ¬å·ï¼Œ&lt;code&gt;error_detail&lt;/code&gt; åŒ…å«äº†æœ‰å…³é”™è¯¯çš„æ›´åŠ è¯¦ç»†çš„ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-no-version-update-after-nack&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/envoy-xds-protocol/7e0ee03agy1fvmxtjqtcsj20cc06y0ss.jpg&#34; alt=&#34;No version update after NACK&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      No version update after NACK
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åç»­ï¼ŒAPI æ›´æ–°å¯èƒ½ä¼šåœ¨æ–°ç‰ˆæœ¬ &lt;strong&gt;Y&lt;/strong&gt; ä¸ŠæˆåŠŸï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ack-after-nack&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/envoy-xds-protocol/7e0ee03agy1fvmxtwzc96j20cc0923yp.jpg&#34; alt=&#34;ACK after NACK&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      ACK after NACK
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªæµéƒ½æœ‰è‡ªå·±çš„ç‰ˆæœ¬æ¦‚å¿µï¼Œä½†ä¸å­˜åœ¨è·¨èµ„æºç±»å‹çš„å…±äº«ç‰ˆæœ¬ã€‚åœ¨ä¸ä½¿ç”¨ ADS çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªèµ„æºç±»å‹å¯èƒ½å…·æœ‰ä¸åŒçš„ç‰ˆæœ¬ï¼Œå› ä¸º Envoy API å…è®¸æŒ‡å‘ä¸åŒçš„ EDS/RDS èµ„æºé…ç½®å¹¶å¯¹åº”ä¸åŒçš„ &lt;code&gt;ConfigSources&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ä½•æ—¶å‘é€æ›´æ–°&#34;&gt;ä½•æ—¶å‘é€æ›´æ–°&lt;/h4&gt;
&lt;p&gt;ç®¡ç†æœåŠ¡å™¨åº”è¯¥åªå‘ Envoy å®¢æˆ·ç«¯å‘é€ä¸Šæ¬¡ &lt;code&gt;DiscoveryResponse&lt;/code&gt; åæ›´æ–°è¿‡çš„èµ„æºã€‚Envoy åˆ™ä¼šæ ¹æ®æ¥å—æˆ–æ‹’ç» &lt;code&gt;DiscoveryResponse&lt;/code&gt; çš„æƒ…å†µï¼Œç«‹å³å›å¤åŒ…å« ACK/NACK çš„  &lt;code&gt;DiscoveryRequest&lt;/code&gt; è¯·æ±‚ã€‚å¦‚æœç®¡ç†æœåŠ¡å™¨æ¯æ¬¡å‘é€ç›¸åŒçš„èµ„æºé›†ç»“æœï¼Œè€Œä¸æ˜¯æ ¹æ®å…¶æ›´æ–°æƒ…å†µï¼Œåˆ™ä¼šå¯¼è‡´ Envoy å’Œç®¡ç†æœåŠ¡å™¨é€šè®¯æ•ˆç‡å¤§æ‰“æŠ˜æ‰£ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åŒä¸€ä¸ªæµä¸­ï¼Œæ–°çš„ &lt;code&gt;DiscoveryRequests&lt;/code&gt; å°†å–ä»£æ­¤å‰å…·æœ‰ç›¸åŒçš„èµ„æºç±»å‹ &lt;code&gt;DiscoveryRequest&lt;/code&gt; è¯·æ±‚ã€‚&lt;strong&gt;è¿™æ„å‘³ç€ç®¡ç†æœåŠ¡å™¨åªéœ€è¦å“åº”ç»™å®šèµ„æºç±»å‹æœ€æ–°çš„ &lt;code&gt;DiscoveryRequest&lt;/code&gt; è¯·æ±‚å³å¯ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;èµ„æºæç¤º&#34;&gt;èµ„æºæç¤º&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;DiscoveryRequest&lt;/code&gt; ä¸­çš„ &lt;code&gt;resource_names&lt;/code&gt; ä¿¡æ¯ä½œä¸ºèµ„æºæç¤ºå‡ºç°ã€‚ä¸€äº›èµ„æºç±»å‹ï¼Œä¾‹å¦‚ &lt;code&gt;Cluster&lt;/code&gt; å’Œ &lt;code&gt;Listener&lt;/code&gt; å°†ä½¿ç”¨ä¸€ä¸ªç©ºçš„ &lt;code&gt;resource_names&lt;/code&gt;ï¼Œå› ä¸º Envoy éœ€è¦è·å–ç®¡ç†æœåŠ¡å™¨å¯¹åº”äºèŠ‚ç‚¹æ ‡è¯†çš„æ‰€æœ‰ &lt;code&gt;Cluster&lt;/code&gt;ï¼ˆCDSï¼‰å’Œ  &lt;code&gt;Listener&lt;/code&gt;ï¼ˆLDSï¼‰ã€‚å¯¹äºå…¶ä»–èµ„æºç±»å‹ï¼Œå¦‚ &lt;code&gt;RouteConfigurations&lt;/code&gt;ï¼ˆRDSï¼‰å’Œ &lt;code&gt;ClusterLoadAssignments&lt;/code&gt;ï¼ˆEDSï¼‰ï¼Œåˆ™éµå¾ªæ­¤å‰çš„ CDS/LDS æ›´æ–°ï¼ŒEnvoy èƒ½å¤Ÿæ˜ç¡®åœ°æšä¸¾è¿™äº›èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;LDS/CDS èµ„æºæç¤ºä¿¡æ¯å°†å§‹ç»ˆä¸ºç©ºï¼Œå¹¶ä¸”æœŸæœ›ç®¡ç†æœåŠ¡å™¨çš„æ¯ä¸ªå“åº”éƒ½æä¾› &lt;code&gt;LDS/CDS&lt;/code&gt; èµ„æºçš„å®Œæ•´çŠ¶æ€ã€‚ç¼ºå¸­çš„ &lt;code&gt;Listener&lt;/code&gt; æˆ– &lt;code&gt;Cluster&lt;/code&gt; å°†è¢«åˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº EDS/RDSï¼Œç®¡ç†æœåŠ¡å™¨å¹¶ä¸éœ€è¦ä¸ºæ¯ä¸ªè¯·æ±‚çš„èµ„æºè¿›è¡Œå“åº”ï¼Œè€Œä¸”è¿˜å¯èƒ½æä¾›é¢å¤–æœªè¯·æ±‚çš„èµ„æºã€‚&lt;code&gt;resource_names&lt;/code&gt; åªæ˜¯ä¸€ä¸ªæç¤ºã€‚Envoy å°†é»˜é»˜åœ°å¿½ç•¥è¿”å›çš„å¤šä½™èµ„æºã€‚å¦‚æœè¯·æ±‚çš„èµ„æºä¸­ç¼ºå°‘ç›¸åº”çš„ RDS æˆ– EDS æ›´æ–°ï¼ŒEnvoy å°†ä¿ç•™å¯¹åº”èµ„æºçš„æœ€åçš„å€¼ã€‚ç®¡ç†æœåŠ¡å™¨å¯èƒ½ä¼šä¾æ®  &lt;code&gt;DiscoveryRequest&lt;/code&gt; ä¸­ &lt;code&gt;node&lt;/code&gt; æ ‡è¯†æ¨æ–­å…¶æ‰€éœ€çš„ EDS/RDS èµ„æºï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæç¤ºä¿¡æ¯å¯èƒ½ä¼šè¢«ä¸¢å¼ƒã€‚ä»ç›¸åº”çš„è§’åº¦æ¥çœ‹ï¼Œç©ºçš„ EDS/RDS &lt;code&gt;DiscoveryResponse&lt;/code&gt; å“åº”å®é™…ä¸Šæ˜¯è¡¨æ˜åœ¨ Envoy ä¸­ä¸ºä¸€ä¸ªç©ºçš„èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;å½“ &lt;code&gt;Listener&lt;/code&gt; æˆ– &lt;code&gt;Cluster&lt;/code&gt; è¢«åˆ é™¤æ—¶ï¼Œå…¶å¯¹åº”çš„ EDS å’Œ RDS èµ„æºä¹Ÿéœ€è¦åœ¨ Envoy å®ä¾‹ä¸­åˆ é™¤ã€‚ä¸ºä½¿ EDS èµ„æºè¢« Envoy å·²çŸ¥æˆ–è·Ÿè¸ªï¼Œå°±å¿…é¡»å­˜åœ¨åº”ç”¨è¿‡çš„ &lt;code&gt;Cluster&lt;/code&gt; å®šä¹‰ï¼ˆå¦‚é€šè¿‡ CDS è·å–ï¼‰ã€‚RDS å’Œ &lt;code&gt;Listeners&lt;/code&gt; ä¹‹é—´å­˜åœ¨ç±»ä¼¼çš„å…³ç³»ï¼ˆå¦‚é€šè¿‡ LDS è·å–ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº EDS/RDSï¼ŒEnvoy å¯ä»¥ä¸ºæ¯ä¸ªç»™å®šç±»å‹çš„èµ„æºç”Ÿæˆä¸åŒçš„æµï¼ˆå¦‚æ¯ä¸ª &lt;code&gt;ConfigSource&lt;/code&gt; éƒ½æœ‰è‡ªå·±çš„ä¸Šæ¸¸ç®¡ç†æœåŠ¡å™¨çš„é›†ç¾¤ï¼‰æˆ–å½“æŒ‡å®šèµ„æºç±»å‹çš„è¯·æ±‚å‘é€åˆ°åŒä¸€ä¸ªç®¡ç†æœåŠ¡å™¨çš„æ—¶å€™ï¼Œå…è®¸å°†å¤šä¸ªèµ„æºè¯·æ±‚ç»„åˆåœ¨ä¸€èµ·å‘é€ã€‚è™½ç„¶å¯ä»¥å•ä¸ªå®ç°ï¼Œä½†ç®¡ç†æœåŠ¡å™¨åº”å…·å¤‡å¤„ç†æ¯ä¸ªç»™å®šèµ„æºç±»å‹ä¸­å¯¹å•ä¸ªæˆ–å¤šä¸ª &lt;code&gt;resource_names&lt;/code&gt;  è¯·æ±‚çš„èƒ½åŠ›ã€‚ä¸‹é¢çš„ä¸¤ä¸ªåºåˆ—å›¾å¯¹äºè·å–ä¸¤ä¸ª EDS èµ„æºéƒ½æ˜¯æœ‰æ•ˆçš„ &lt;code&gt;{fooï¼Œbar}&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-multiple-eds-requests-on-the-same-stream&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/envoy-xds-protocol/7e0ee03agy1fvmxuviiqsj20eh06ymx9.jpg&#34; alt=&#34;Multiple EDS requests on the same stream&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Multiple EDS requests on the same stream
    &lt;/figcaption&gt;&lt;/figure&gt;

















&lt;figure  id=&#34;figure-multiple-eds-requests-on-distinct-streams&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/envoy-xds-protocol/7e0ee03agy1fvmxv7cv21j20j20a4wet.jpg&#34; alt=&#34;Multiple EDS requests on distinct streams&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Multiple EDS requests on distinct streams
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;èµ„æºæ›´æ–°&#34;&gt;èµ„æºæ›´æ–°&lt;/h4&gt;
&lt;p&gt;å¦‚ä¸Šæ‰€è¿°ï¼ŒEnvoy å¯èƒ½ä¼šæ›´æ–°  &lt;code&gt;DiscoveryRequest&lt;/code&gt; ä¸­å‡ºç°çš„ &lt;code&gt;resource_names&lt;/code&gt; åˆ—è¡¨ï¼Œå…¶ä¸­ &lt;code&gt;DiscoveryRequest&lt;/code&gt;  æ˜¯ç”¨æ¥ ACK/NACK ç®¡ç†æœåŠ¡å™¨çš„ç‰¹å®šçš„ &lt;code&gt;DiscoveryResponse&lt;/code&gt; ã€‚æ­¤å¤–ï¼ŒEnvoy åç»­å¯èƒ½ä¼šå‘é€é¢å¤–çš„ &lt;code&gt;DiscoveryRequests&lt;/code&gt; ï¼Œç”¨äºåœ¨ç‰¹å®š &lt;code&gt;version_info&lt;/code&gt; ä¸Šä½¿ç”¨æ–°çš„èµ„æºæç¤ºæ¥æ›´æ–°ç®¡ç†æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ Envoy åœ¨ EDS ç‰ˆæœ¬ &lt;strong&gt;X&lt;/strong&gt; æ—¶ä»…çŸ¥é“é›†ç¾¤ &lt;code&gt;foo&lt;/code&gt;ï¼Œä½†åœ¨éšåæ”¶åˆ°çš„ CDS æ›´æ–°æ—¶é¢å¤–è·å–äº†é›†ç¾¤ &lt;code&gt;bar&lt;/code&gt; ï¼Œå®ƒå¯èƒ½ä¼šä¸ºç‰ˆæœ¬ &lt;strong&gt;X&lt;/strong&gt; å‘å‡ºé¢å¤–çš„ &lt;code&gt;DiscoveryRequest&lt;/code&gt; è¯·æ±‚ï¼Œå¹¶å°† &lt;code&gt;{fooï¼Œbar}&lt;/code&gt; ä½œä¸ºè¯·æ±‚çš„ &lt;code&gt;resource_names&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-cds-response-leads-to-eds-resource-hint-update&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/envoy-xds-protocol/006tNc79ly1fvph0p7u8zj31fm0lq0ve.jpg&#34; alt=&#34;CDS response leads to EDS resource hint update&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      CDS response leads to EDS resource hint update
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™é‡Œå¯èƒ½ä¼šå‡ºç°ç«äº‰çŠ¶å†µï¼›å¦‚æœ Envoy åœ¨ç‰ˆæœ¬ &lt;strong&gt;X&lt;/strong&gt; ä¸Šå‘å¸ƒäº†èµ„æºæç¤ºæ›´æ–°è¯·æ±‚ï¼Œä½†åœ¨ç®¡ç†æœåŠ¡å™¨å¤„ç†è¯¥è¯·æ±‚ä¹‹å‰å‘é€äº†æ–°çš„ç‰ˆæœ¬å·ä¸º &lt;strong&gt;Y&lt;/strong&gt;  çš„å“åº”ï¼Œé’ˆå¯¹ &lt;code&gt;version_info&lt;/code&gt; ä¸º &lt;strong&gt;X&lt;/strong&gt; çš„ç‰ˆæœ¬ï¼Œèµ„æºæç¤ºæ›´æ–°å¯èƒ½ä¼šè¢«è§£é‡Šä¸ºæ‹’ç»  &lt;strong&gt;Y&lt;/strong&gt;ã€‚ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œé€šè¿‡ä½¿ç”¨ç®¡ç†æœåŠ¡å™¨æä¾›çš„ &lt;code&gt;nonce&lt;/code&gt;ï¼ŒEnvoy å¯ç”¨æ¥ä¿è¯æ¯ä¸ª &lt;code&gt;DiscoveryRequest&lt;/code&gt; å¯¹åº”åˆ°ç›¸åº”çš„ &lt;code&gt;DiscoveryResponse&lt;/code&gt; ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-eds-update-race-motivates-nonces&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/envoy-xds-protocol/006tNc79ly1fvph04ln3fj31kw0rogqc.jpg&#34; alt=&#34;EDS update race motivates nonces&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      EDS update race motivates nonces
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç®¡ç†æœåŠ¡å™¨ä¸åº”è¯¥ä¸ºå«æœ‰è¿‡æœŸ &lt;code&gt;nonce&lt;/code&gt; çš„ &lt;code&gt;DiscoveryRequest&lt;/code&gt; å‘é€ &lt;code&gt;DiscoveryResponse&lt;/code&gt; å“åº”ã€‚åœ¨å‘ Envoy å‘é€çš„ &lt;code&gt;DiscoveryResponse&lt;/code&gt;  ä¸­åŒ…å«äº†çš„æ–° &lt;code&gt;nonce&lt;/code&gt; ï¼Œåˆ™æ­¤å‰çš„ &lt;code&gt;nonce&lt;/code&gt; å°†è¿‡æœŸã€‚åœ¨èµ„æºæ–°ç‰ˆæœ¬å°±ç»ªä¹‹å‰ï¼Œç®¡ç†æœåŠ¡å™¨ä¸éœ€è¦å‘ Envoy å‘é€æ›´æ–°ã€‚åŒç‰ˆæœ¬çš„æ—©æœŸè¯·æ±‚å°†ä¼šè¿‡æœŸã€‚åœ¨æ–°ç‰ˆæœ¬å°±ç»ªæ—¶ï¼Œç®¡ç†æœåŠ¡å™¨å¯èƒ½ä¼šå¤„ç†åŒä¸€ä¸ªç‰ˆæœ¬å·çš„å¤šä¸ª &lt;code&gt;DiscoveryRequests&lt;/code&gt;è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-requests-become-stale&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/envoy-xds-protocol/006tNc79ly1fvpgy6xewrj31b415ctcy.jpg&#34; alt=&#34;Requests become stale&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Requests become stale
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šè¿°èµ„æºæ›´æ–°åºåˆ—è¡¨æ˜ Envoy å¹¶ä¸èƒ½æœŸå¾…å…¶å‘å‡ºçš„æ¯ä¸ª &lt;code&gt;DiscoveryRequest&lt;/code&gt; éƒ½å¾—åˆ° &lt;code&gt;DiscoveryResponse&lt;/code&gt; å“åº”ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æœ€ç»ˆä¸€è‡´æ€§è€ƒè™‘&#34;&gt;æœ€ç»ˆä¸€è‡´æ€§è€ƒè™‘&lt;/h4&gt;
&lt;p&gt;ç”±äº Envoy çš„ xDS API é‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§ï¼Œå› æ­¤åœ¨æ›´æ–°æœŸé—´å¯èƒ½å¯¼è‡´æµé‡è¢«ä¸¢å¼ƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœé€šè¿‡ CDS/EDS ä»…è·å–åˆ°äº†é›†ç¾¤ &lt;strong&gt;X&lt;/strong&gt;ï¼Œè€Œä¸” &lt;code&gt;RouteConfiguration&lt;/code&gt; å¼•ç”¨äº†é›†ç¾¤  &lt;strong&gt;X&lt;/strong&gt;ï¼›åœ¨ CDS/EDS æ›´æ–°é›†ç¾¤  &lt;strong&gt;Y&lt;/strong&gt;  é…ç½®ä¹‹å‰ï¼Œå¦‚æœå°† &lt;code&gt;RouteConfiguration&lt;/code&gt; å°†å¼•ç”¨çš„é›†ç¾¤è°ƒæ•´ä¸º &lt;strong&gt;Y&lt;/strong&gt;ï¼Œé‚£ä¹ˆæµé‡å°†è¢«å¸å…¥é»‘æ´è€Œä¸¢å¼ƒï¼Œç›´è‡³é›†ç¾¤ &lt;strong&gt;Y&lt;/strong&gt; è¢« Envoy å®ä¾‹è·å–ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹æŸäº›åº”ç”¨ç¨‹åºï¼Œå¯æ¥å—ä¸´æ—¶çš„æµé‡ä¸¢å¼ƒï¼Œå®¢æˆ·ç«¯é‡è¯•æˆ–å…¶ä»– Envoy sidecar ä¼šæ©ç›–æµé‡ä¸¢å¼ƒã€‚é‚£äº›å¯¹æµé‡ä¸¢å¼ƒä¸èƒ½å®¹å¿çš„åœºæ™¯ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼é¿å…æµé‡ä¸¢å¤±ï¼ŒCDS/EDS æ›´æ–°åŒæ—¶æºå¸¦ &lt;strong&gt;X&lt;/strong&gt; å’Œ &lt;strong&gt;Y&lt;/strong&gt;ï¼Œç„¶åå‘é€ RDS æ›´æ–°ä» &lt;strong&gt;X&lt;/strong&gt; åˆ‡æ¢åˆ° &lt;strong&gt;Y&lt;/strong&gt;ï¼Œæ­¤åå‘é€ä¸¢å¼ƒ &lt;strong&gt;X&lt;/strong&gt; çš„ CDS/EDS æ›´æ–°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œä¸ºé¿å…æµé‡ä¸¢å¼ƒï¼Œæ›´æ–°çš„é¡ºåºåº”è¯¥éµå¾ª &lt;code&gt;make before break&lt;/code&gt; æ¨¡å‹ï¼Œå…¶ä¸­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¿…é¡»å§‹ç»ˆå…ˆæ¨é€ CDS æ›´æ–°ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;EDS æ›´æ–°ï¼ˆå¦‚æœæœ‰ï¼‰å¿…é¡»åœ¨ç›¸åº”é›†ç¾¤çš„ CDS æ›´æ–°ååˆ°è¾¾ã€‚&lt;/li&gt;
&lt;li&gt;LDS æ›´æ–°å¿…é¡»åœ¨ç›¸åº”çš„ CDS/EDS æ›´æ–°ååˆ°è¾¾ã€‚&lt;/li&gt;
&lt;li&gt;ä¸æ–°æ·»åŠ çš„ç›‘å¬å™¨ç›¸å…³çš„ RDS æ›´æ–°å¿…é¡»åœ¨æœ€ååˆ°è¾¾ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œåˆ é™¤è¿‡æœŸçš„ CDS é›†ç¾¤å’Œç›¸å…³çš„ EDS ç«¯ç‚¹ï¼ˆä¸å†è¢«å¼•ç”¨çš„ç«¯ç‚¹ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰æ–°çš„é›†ç¾¤/è·¯ç”±/ç›‘å¬å™¨æˆ–è€…å…è®¸æ›´æ–°æ—¶ä¸´æ—¶æµé‡ä¸¢å¤±çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç‹¬ç«‹æ¨é€ xDS æ›´æ–°ã€‚è¯·æ³¨æ„ï¼Œåœ¨ LDS æ›´æ–°çš„æƒ…å†µä¸‹ï¼Œç›‘å¬å™¨é¡»åœ¨æ¥æ”¶æµé‡ä¹‹å‰è¢«é¢„çƒ­ï¼Œä¾‹å¦‚å¦‚å…¶é…ç½®äº†ä¾èµ–çš„è·¯ç”±ï¼Œåˆ™å…ˆéœ€å…ˆä» RDS è¿›è¡Œè·å–ã€‚æ·»åŠ /åˆ é™¤/æ›´æ–°é›†ç¾¤ä¿¡æ¯æ—¶ï¼Œé›†ç¾¤ä¹Ÿéœ€è¦è¿›è¡Œé¢„çƒ­ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœç®¡ç†å¹³é¢ç¡®ä¿è·¯ç”±æ›´æ–°æ—¶æ‰€å¼•ç”¨çš„é›†ç¾¤å·²ç»å‡†å¤‡å°±ç»ªï¼Œè·¯ç”±å¯ä»¥ä¸ç”¨é¢„çƒ­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;èšåˆæœåŠ¡å‘ç°ads&#34;&gt;èšåˆæœåŠ¡å‘ç°ï¼ˆADSï¼‰&lt;/h3&gt;
&lt;p&gt;å½“ç®¡ç†æœåŠ¡å™¨è¿›è¡Œèµ„æºåˆ†å‘æ—¶ï¼Œé€šè¿‡ä¸Šè¿°ä¿è¯äº¤äº’é¡ºåºçš„æ–¹å¼æ¥é¿å…æµé‡ä¸¢å¼ƒæ˜¯ä¸€é¡¹å¾ˆæœ‰æŒ‘æˆ˜çš„å·¥ä½œã€‚ADS å…è®¸å•ä¸€ç®¡ç†æœåŠ¡å™¨é€šè¿‡å•ä¸ª gRPC æµï¼Œæä¾›æ‰€æœ‰çš„ API æ›´æ–°ã€‚é…åˆä»”ç»†è§„åˆ’çš„æ›´æ–°é¡ºåºï¼ŒADS å¯è§„é¿æ›´æ–°è¿‡ç¨‹ä¸­æµé‡ä¸¢å¤±ã€‚ä½¿ç”¨ ADSï¼Œåœ¨å•ä¸ªæµä¸Šå¯é€šè¿‡ç±»å‹ URL æ¥è¿›è¡Œå¤ç”¨å¤šä¸ªç‹¬ç«‹çš„ &lt;code&gt;DiscoveryRequest&lt;/code&gt;/&lt;code&gt;DiscoveryResponse&lt;/code&gt; åºåˆ—ã€‚å¯¹äºä»»ä½•ç»™å®šç±»å‹çš„ URLï¼Œä»¥ä¸Š &lt;code&gt;DiscoveryRequest&lt;/code&gt; å’Œ &lt;code&gt;DiscoveryResponse&lt;/code&gt; æ¶ˆæ¯åºåˆ—éƒ½é€‚ç”¨ã€‚æ›´æ–°åºåˆ—å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-edscds-multiplexed-on-an-ads-stream&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/envoy-xds-protocol/006tNc79ly1fvpgxnl947j313q0wgq62.jpg&#34; alt=&#34;EDS/CDS multiplexed on an ADS stream&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      EDS/CDS multiplexed on an ADS stream
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ¯ä¸ª Envoy å®ä¾‹å¯ä½¿ç”¨å•ç‹¬çš„ ADS æµã€‚&lt;/p&gt;
&lt;p&gt;æœ€å°åŒ– ADS é…ç½®çš„ &lt;code&gt;bootstrap.yaml&lt;/code&gt; ç‰‡æ®µç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;node identifier&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;dynamic_resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cds_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;nt&#34;&gt;ads&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lds_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;nt&#34;&gt;ads&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ads_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;api_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;GRPC&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;grpc_services&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;envoy_grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ads_cluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;static_resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ads_cluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;seconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;STATIC&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;ADS management server IP address&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;ADS management server port&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ROUND_ROBIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http2_protocol_options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;admin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¢é‡-xds&#34;&gt;å¢é‡ xDS&lt;/h3&gt;
&lt;p&gt;å¢é‡ xDS æ˜¯å¯ç”¨äºå…è®¸çš„ ADSã€CDS å’Œ RDS å•ç‹¬ xDS ç«¯ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;xDS å®¢æˆ·ç«¯å¯¹è·Ÿè¸ªèµ„æºåˆ—è¡¨è¿›è¡Œå¢é‡æ›´æ–°ã€‚è¿™æ”¯æŒ Envoy æŒ‰éœ€/æƒ°æ€§åœ°è¯·æ±‚é¢å¤–èµ„æºã€‚ä¾‹å¦‚ï¼Œå½“ä¸æœªçŸ¥é›†ç¾¤ç›¸å¯¹åº”çš„è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚&lt;/li&gt;
&lt;li&gt;xDS æœåŠ¡å™¨å¯ä»¥å¢é‡æ›´æ–°å®¢æˆ·ç«¯ä¸Šçš„èµ„æºã€‚è¿™æ”¯æŒ xDS èµ„æºå¯ä¼¸ç¼©æ€§çš„ç›®æ ‡ã€‚ç®¡ç†æœåŠ¡å™¨åªéœ€äº¤ä»˜æ›´æ”¹çš„å•ä¸ªé›†ç¾¤ï¼Œè€Œä¸æ˜¯åœ¨ä¿®æ”¹å•ä¸ªé›†ç¾¤æ—¶äº¤ä»˜æ‰€æœ‰ä¸Šä¸‡ä¸ªé›†ç¾¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;xDS å¢é‡ä¼šè¯å§‹ç»ˆä½äº gRPC åŒå‘æµçš„ä¸Šä¸‹æ–‡ä¸­ã€‚è¿™å…è®¸ xDS æœåŠ¡å™¨èƒ½å¤Ÿè·Ÿè¸ªåˆ°è¿æ¥çš„ xDS å®¢æˆ·ç«¯çš„çŠ¶æ€ã€‚xDS REST ç‰ˆæœ¬ä¸æ”¯æŒå¢é‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¢é‡ xDS ä¸­ï¼Œnonce å­—æ®µæ˜¯å¿…éœ€çš„ï¼Œç”¨äºåŒ¹é…  &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/discovery.proto#discoveryrequest&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;IncrementalDiscoveryResponse&lt;/code&gt;&lt;/a&gt; å…³è”çš„ ACK æˆ– NACK &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/discovery.proto#discoveryrequest&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;IncrementalDiscoveryRequest&lt;/code&gt;&lt;/a&gt;ã€‚å¯é€‰åœ°ï¼Œå­˜åœ¨å“åº”æ¶ˆæ¯çº§åˆ«çš„ system_version_infoï¼Œä½†ä»…ç”¨äºè°ƒè¯•ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;IncrementalDiscoveryRequest&lt;/code&gt; å¯åœ¨ä»¥ä¸‹ 3 ç§æƒ…å†µä¸‹å‘é€ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;xDS åŒå‘ gRPC æµçš„åˆå§‹æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;ä½œä¸ºå¯¹å…ˆå‰çš„ &lt;code&gt;IncrementalDiscoveryResponse&lt;/code&gt; çš„ ACK æˆ– NACK å“åº”ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ&lt;code&gt;response_nonce&lt;/code&gt; è¢«è®¾ç½®ä¸ºå“åº”ä¸­çš„ nonce å€¼ã€‚ACK æˆ– NACK ç”±å¯ç”± &lt;code&gt;error_detail&lt;/code&gt; å­—æ®µæ˜¯å¦å‡ºç°æ¥åŒºåˆ†ã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯è‡ªå‘çš„ &lt;code&gt;IncrementalDiscoveryRequest&lt;/code&gt;ã€‚æ­¤åœºæ™¯ä¸‹å¯ä»¥é‡‡ç”¨åŠ¨æ€æ·»åŠ æˆ–åˆ é™¤è¢«è·Ÿè¸ªçš„ &lt;code&gt;resource_names&lt;/code&gt; é›†ã€‚è¿™ç§åœºæ™¯ä¸‹ï¼Œå¿…é¡»å¿½ç•¥ &lt;code&gt;response_nonce&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œå®¢æˆ·ç«¯è¿æ¥å¹¶æ¥æ”¶å®ƒçš„ç¬¬ä¸€ä¸ªæ›´æ–°å¹¶ ACKã€‚ç¬¬äºŒæ¬¡æ›´æ–°å¤±è´¥ï¼Œå®¢æˆ·ç«¯å‘é€ NACK æ‹’ç»æ›´æ–°ã€‚xDS å®¢æˆ·ç«¯åç»­ä¼šè‡ªå‘åœ°è¯·æ±‚â€œwcâ€ç›¸å…³èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-incremental-session-example&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/envoy-xds-protocol/006tNc79ly1fvpgwfbep7j31kw0vldli.jpg&#34; alt=&#34;Incremental session example&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Incremental session example
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨é‡æ–°è¿æ¥æ—¶ï¼Œæ”¯æŒå¢é‡çš„ xDS å®¢æˆ·ç«¯å¯èƒ½ä¼šå‘Šè¯‰æœåŠ¡å™¨å…¶å·²çŸ¥èµ„æºä»è€Œé¿å…é€šè¿‡ç½‘ç»œé‡æ–°å‘é€å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-incremental-reconnect-example&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/envoy-xds-protocol/006tNc79ly1fvpgx05z3kj31kw0phwif.jpg&#34; alt=&#34;Incremental reconnect example&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Incremental reconnect example
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;rest-json-è½®è¯¢è®¢é˜…&#34;&gt;REST-JSON è½®è¯¢è®¢é˜…&lt;/h2&gt;
&lt;p&gt;å•ä¸ª xDS  API å¯å¯¹ REST ç«¯ç‚¹è¿›è¡Œçš„åŒæ­¥ï¼ˆé•¿ï¼‰è½®è¯¢ã€‚é™¤äº†æ— æŒä¹…æµä¸ç®¡ç†æœåŠ¡å™¨äº¤äº’å¤–ï¼Œæ¶ˆæ¯é¡ºåºä¸ä¸Šè¿°ç›¸ä¼¼ã€‚åœ¨ä»»ä½•æ—¶é—´ç‚¹ï¼Œåªå­˜åœ¨ä¸€ä¸ªæœªå®Œæˆçš„è¯·æ±‚ï¼Œå› æ­¤å“åº”æ¶ˆæ¯ä¸­çš„ &lt;code&gt;nonce&lt;/code&gt; åœ¨ REST-JSON ä¸­æ˜¯å¯é€‰çš„ã€‚&lt;code&gt;DiscoveryRequest&lt;/code&gt; å’Œ &lt;code&gt;DiscoveryResponse&lt;/code&gt; çš„æ¶ˆæ¯ç¼–ç éµå¾ª &lt;a href=&#34;https://developers.google.com/protocol-buffers/docs/proto3#json&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;JSON å˜æ¢ proto3&lt;/a&gt; è§„èŒƒã€‚ADS ä¸æ”¯æŒ REST-JSON è½®è¯¢ã€‚&lt;/p&gt;
&lt;p&gt;å½“è½®è¯¢æœŸé—´è®¾ç½®ä¸ºè¾ƒå°çš„å€¼æ—¶ï¼Œåˆ™å¯ä»¥ç­‰åŒäºé•¿è½®è¯¢ï¼Œè¿™æ—¶è¦æ±‚é¿å…å‘é€ &lt;code&gt;DiscoveryResponse&lt;/code&gt;ï¼Œ&lt;a href=&#34;#%e4%bd%95%e6%97%b6%e5%8f%91%e9%80%81%e6%9b%b4%e6%96%b0&#34;&gt;é™¤éå¯¹è¯·æ±‚çš„èµ„æºå‘ç”Ÿäº†æ›´æ”¹&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æœåŠ¡ç½‘æ ¼çš„æ§åˆ¶å¹³é¢å’Œè¾¹ç¼˜ä»£ç†çš„é‡è¦æ€§</title>
      <link>https://cloudnative.to/blog/the-importance-of-control-planes-with-service-mesh/</link>
      <pubDate>Wed, 12 Sep 2018 12:38:52 +0800</pubDate>
      <guid>https://cloudnative.to/blog/the-importance-of-control-planes-with-service-mesh/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://dzone.com/articles/the-importance-of-control-planes-with-service-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°†å¸¦æ‚¨äº†è§£ä¸ºä»€ä¹ˆæœåŠ¡ç½‘æ ¼å’Œè¾¹ç¼˜ä»£ç†å¦‚æ­¤é‡è¦ä»¥åŠå®ƒä»¬ä¸æŒç»­äº¤ä»˜çš„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;äº†è§£ç°ä»£äº‘æ¶æ„å¦‚ä½•ä½¿ç”¨å¾®æœåŠ¡å…·æœ‰çš„è®¸å¤šä¼˜åŠ¿ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿä»¥ CI/CD æ–¹å¼äº¤ä»˜ä¸šåŠ¡è½¯ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å»å¹´ï¼ŒMatt Klein å†™äº†ä¸€ç¯‡ç²¾å½©çš„åšå®¢â€œ&lt;a href=&#34;https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼ä¸­çš„æ•°æ®å¹³é¢ä¸æ§åˆ¶å¹³é¢&lt;/a&gt;â€ã€‚å°½ç®¡æˆ‘å·²ç»å¾ˆç†Ÿæ‚‰â€œæ§åˆ¶é¢æ¿â€è¿™ä¸ªæœ¯è¯­ï¼ŒMatt å†æ¬¡åŠ æ·±äº†æˆ‘å¯¹è¿™ä¸ªæ¦‚å¿µçš„ç†è§£ä»¥åŠä¸è½¯ä»¶æŒç»­äº¤ä»˜æœ‰å…³çš„é‡è¦æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨å…¥å£/è¾¹ç¼˜ç½‘å…³å’ŒæœåŠ¡ç½‘æ ¼å‘¨å›´çš„éƒ¨ç½²æ§åˆ¶ï¼ˆå’Œç»†å¾®å·®åˆ«ï¼‰æ–¹é¢ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä¹‹å‰å†™è¿‡å…³äºè¾¹ç¼˜ä»£ç†å’Œ API ç½‘å…³åœ¨è½¯ä»¶äº¤ä»˜ä¸­å¯ä»¥å‘æŒ¥çš„ä½œç”¨ï¼ŒæŒç»­äº¤ä»˜ï¼šAPI ç½‘å…³æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿåƒ Envoy è¿™æ ·çš„ç°ä»£ä»£ç†åœ¨â€œäº‘åŸç”Ÿâ€åº”ç”¨ç¨‹åºæ“ä½œä¸­æ‰€äº§ç”Ÿçš„å½±å“ï¼Œæˆ‘ä»¬è¿›è¡Œäº†å‡ æ¬¡è®¨è®ºã€‚æˆ‘å¾—å‡ºçš„ç»“è®ºæ˜¯ï¼Œå°½ç®¡å¾®æœåŠ¡ä¸ºå…·æœ‰åŠ¨æ€ç¼–æ’çš„å®¹å™¨å’Œäº‘æŠ€æœ¯çš„ä½¿ç”¨æä¾›äº†æ–°çš„æœºä¼šï¼Œä½†æ˜¯å‰©ä¸‹çš„æ ¸å¿ƒæŒ‘æˆ˜å°±æ˜¯æ§åˆ¶å¹³é¢å¿…é¡»è¿›è¡Œè°ƒæ•´æ‰èƒ½è·Ÿä¸Šå˜åŒ–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ§åˆ¶å¹³é¢å’Œè§’è‰²&#34;&gt;æ§åˆ¶å¹³é¢å’Œè§’è‰²&lt;/h2&gt;
&lt;p&gt;åœ¨ Matt çš„æ–‡ç« ä¸­ï¼Œä»–æŒ‡å‡ºæœåŠ¡ç½‘æ ¼æ§åˆ¶å¹³é¢â€œä¸ºç½‘æ ¼ä¸­æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„æ•°æ®å¹³é¢æä¾›ç­–ç•¥å’Œé…ç½®â€ï¼Œå¹¶ä¸”â€œæ§åˆ¶å¹³é¢å°†æ‰€æœ‰æ•°æ®å¹³é¢è½¬å˜ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿã€‚â€æœ€ç»ˆï¼Œæ§åˆ¶å¹³é¢çš„ç›®æ ‡æ˜¯è®¾ç½®å°†ç”±æ•°æ®å¹³é¢åˆ¶å®šçš„ç­–ç•¥ã€‚æ§åˆ¶å¹³é¢å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ï¼ŒAPI è°ƒç”¨å’Œç”¨æˆ·ç•Œé¢æ¥å®ç°ã€‚é€‰æ‹©çš„å®ç°æ–¹æ³•é€šå¸¸å–å†³äºç”¨æˆ·çš„è§’è‰²ï¼Œä»¥åŠä»–ä»¬çš„ç›®æ ‡å’ŒæŠ€æœ¯èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œäº§å“æ‰€æœ‰è€…å¯èƒ½æƒ³è¦åœ¨åº”ç”¨ç¨‹åºä¸­å‘å¸ƒæ–°åŠŸèƒ½ï¼Œè¿™é‡Œ UI é€šå¸¸æ˜¯æœ€åˆé€‚çš„æ§åˆ¶å¹³é¢ï¼Œå› ä¸ºè¿™å¯ä»¥æ˜¾ç¤ºç³»ç»Ÿçš„å¯ç†è§£è§†å›¾å¹¶ä¸”è¿˜æä¾›ä¸€äº›å¯¼è½¨ã€‚ä½†æ˜¯ï¼Œå¯¹äºæƒ³è¦é…ç½®ä¸€ç³»åˆ—ä½çº§é˜²ç«å¢™è§„åˆ™çš„ç½‘ç»œè¿ç»´äººå‘˜ï¼Œä½¿ç”¨ CLI æˆ–é…ç½®æ–‡ä»¶å°†æä¾›æ›´ç»†ç²’åº¦ï¼ˆé«˜çº§ç”¨æˆ·é£æ ¼ï¼‰æ§åˆ¶ï¼Œå¹¶ä¸”è¿˜ä¾¿äºè‡ªåŠ¨åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;æ§åˆ¶å¹³é¢çš„é€‰æ‹©ä¹Ÿå¯èƒ½å—æ‰€éœ€æ§åˆ¶èŒƒå›´çš„å½±å“ã€‚æˆ‘çš„åŒäº‹&lt;a href=&#34;https://www.infoq.com/news/2017/11/service-oriented-development&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Rafi ä¹‹å‰åœ¨ QCon SF è®¨è®ºè¿‡è¿™ä¸ªé—®é¢˜&lt;/a&gt;ï¼Œé›†ä¸­æˆ–åˆ†æ•£è¿ç»´çš„è¦æ±‚è‚¯å®šä¼šå½±å“æ§åˆ¶å¹³é¢çš„å®æ–½ã€‚è¿™ä¹Ÿç›´æ¥å…³ç³»åˆ°æ§åˆ¶å½±å“åº”è¯¥æ˜¯æœ¬åœ°çš„è¿˜æ˜¯å…¨å±€çš„ã€‚ä¾‹å¦‚ï¼Œè¿ç»´å›¢é˜Ÿå¯èƒ½å¸Œæœ›æŒ‡å®šå…¨å±€åˆç†çš„é»˜è®¤å€¼å’Œå®‰å…¨æªæ–½ã€‚ä½†æ˜¯ï¼Œåœ¨å‰çº¿å·¥ä½œçš„å¼€å‘å›¢é˜Ÿéœ€è¦å¯¹å…¶æœ¬åœ°æœåŠ¡è¿›è¡Œç»†ç²’åº¦æ§åˆ¶ï¼Œå¹¶ä¸”å¯èƒ½ï¼ˆå¦‚æœä»–ä»¬æ­£åœ¨æ¥å—â€œè‡ªç”±å’Œè´£ä»»â€æ¨¡å¼ï¼‰è¦†ç›–å®‰å…¨æªæ–½çš„èƒ½åŠ›ã€‚Matt è¿˜åœ¨æœ€è¿‘çš„&lt;a href=&#34;https://www.infoq.com/news/2018/07/qcon-klein-service-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;QCon çº½çº¦æ¼”è®²&lt;/a&gt;ä¸­è°ˆåˆ°äº†æœ¬åœ°/å…¨å±€äº’åŠ¨ï¼Œå¹¶å±•ç¤ºäº†Lyftå›¢é˜Ÿä¸ºæœåŠ¡åˆ°æœåŠ¡å’Œè¾¹ç¼˜/å…¥å£ä»£ç†åˆ›å»ºçš„ä»ªè¡¨æ¿ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/the-importance-of-control-planes-with-service-mesh/006tNbRwgy1fv6sw7u1sxj30m80p577s_hue93806e6243b47c11bf7c67b62fcd7ee_94151_7664f5cc97c379c6f8947347a5b718b2.webp 400w,
               /blog/the-importance-of-control-planes-with-service-mesh/006tNbRwgy1fv6sw7u1sxj30m80p577s_hue93806e6243b47c11bf7c67b62fcd7ee_94151_08ccba45c8a44a4d25b4d2fde042ed84.webp 760w,
               /blog/the-importance-of-control-planes-with-service-mesh/006tNbRwgy1fv6sw7u1sxj30m80p577s_hue93806e6243b47c11bf7c67b62fcd7ee_94151_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/the-importance-of-control-planes-with-service-mesh/006tNbRwgy1fv6sw7u1sxj30m80p577s_hue93806e6243b47c11bf7c67b62fcd7ee_94151_7664f5cc97c379c6f8947347a5b718b2.webp&#34;
               width=&#34;672&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ä¸œè¥¿å‘æµé‡ä¸å—åŒ—å‘æµé‡&#34;&gt;ä¸œè¥¿å‘æµé‡ä¸å—åŒ—å‘æµé‡&lt;/h2&gt;
&lt;p&gt;è½¯ä»¶åº”ç”¨ä¸­æµé‡æœ‰ä¸¤ç§å…¸å‹åˆ†ç±»ï¼Œå…¶ä¸­ä¹‹ä¸€æ˜¯å—åŒ—å‘æµé‡ï¼Œé€šå¸¸ç§°ä¸ºå…¥å£æµé‡ï¼Œæµé‡æµå‘å¤–éƒ¨ç³»ç»Ÿæˆ–è€…å¤–éƒ¨æœåŠ¡è°ƒç”¨å†…éƒ¨ç³»ç»Ÿã€‚å¦å¤–ä¸€ä¸ªæ˜¯ä¸œè¥¿å‘æµé‡ï¼Œé€šå¸¸ç§°ä¸ºæ•°æ®ä¸­å¿ƒå†…éƒ¨æµé‡ï¼Œè¿™æ˜¯åœ¨ï¼ˆå¯èƒ½æ˜¯è™šæ‹ŸåŒ–çš„ï¼‰å†…éƒ¨ç½‘ç»œè¾¹ç•Œå†…æµåŠ¨çš„æµé‡&lt;/p&gt;
&lt;p&gt;æ‰€è°“ä¸œè¥¿å‘ï¼Œå¤§å®¶èƒ½ç†è§£å§ï¼Ÿä¸œè¥¿å‘æŒ‡æœåŠ¡é—´é€šè®¯ï¼Œä¹Ÿå°±æ˜¯ A æœåŠ¡è°ƒç”¨ B æœåŠ¡ã€‚å¯¹åº”çš„è¿˜æœ‰å—åŒ—å‘ï¼Œå—åŒ—å‘é€šå¸¸æ˜¯æŒ‡ä»å¤–éƒ¨ç½‘ç»œè¿›æ¥è°ƒç”¨æœåŠ¡ï¼Œå¦‚èµ° API Gateway è°ƒç”¨æœåŠ¡ã€‚åœ¨ä¸œè¥¿å‘é€šè®¯ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶ä¼šéœ€è¦ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„é€”å¾„ï¼Œæ¯”å¦‚è¯´åœ¨è¿™ä¸ªå›¾ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªé›†ç¾¤ï¼Œä¸¤ä¸ªé›†ç¾¤å„æœ‰å„è‡ªçš„æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚æˆ‘ä»¬é€šè¿‡å¢å¼º Pilot çš„æ–¹å¼æ‰“é€šä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œå¯ä»¥çŸ¥é“å¯¹æ–¹æœ‰ä»€ä¹ˆæœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/the-importance-of-control-planes-with-service-mesh/00704eQkgy1fsy0kakg35j30qo0f0dpi_huda81314663064cc0e01f4d9721dba08c_100771_5bc2e6905e485456be5f31ec9a4b54de.webp 400w,
               /blog/the-importance-of-control-planes-with-service-mesh/00704eQkgy1fsy0kakg35j30qo0f0dpi_huda81314663064cc0e01f4d9721dba08c_100771_1165d2020628bbbf4c58f16b26195d5e.webp 760w,
               /blog/the-importance-of-control-planes-with-service-mesh/00704eQkgy1fsy0kakg35j30qo0f0dpi_huda81314663064cc0e01f4d9721dba08c_100771_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/the-importance-of-control-planes-with-service-mesh/00704eQkgy1fsy0kakg35j30qo0f0dpi_huda81314663064cc0e01f4d9721dba08c_100771_5bc2e6905e485456be5f31ec9a4b54de.webp&#34;
               width=&#34;760&#34;
               height=&#34;428&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å›¾ç‰‡æ¥è‡ªæ•–å°å‰‘çš„åˆ†äº«&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ç°ä»£äº‘åŸç”Ÿåº”ç”¨ç¨‹åºä¸­ï¼Œä¸¤ä¸ªç‹¬ç«‹çš„ç»„ä»¶é€šå¸¸æ§åˆ¶è¿™äº›æµé‡ï¼šAPI ç½‘å…³æˆ–è¾¹ç¼˜ä»£ç†å¤„ç†å—åŒ—æµé‡ï¼Œç›¸å¯¹çš„ service mesh å¤„ç†ä¸œè¥¿å‘æµé‡ã€‚åœ¨ Kubernetes åŸŸå†…ï¼ŒAmbassador å¼€æº API ç½‘å…³å¯ä»¥å¤„ç†å…¥å£æµé‡ï¼Œè€Œ&lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;å¼€æ”¾å¹³å°å¯ä»¥å¤„ç†è·¨æœåŠ¡æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºå—åŒ—å‘å’Œä¸œè¥¿å‘ä»£ç†ç»„ä»¶ï¼Œåº•å±‚ç½‘ç»œæŠ€æœ¯å¯ä»¥æ˜¯ç›¸åŒçš„ï¼ˆä¾‹å¦‚ä½¿ç”¨&lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;ï¼‰ã€‚ä½†æ˜¯ï¼Œæ§åˆ¶å¹³é¢é€šå¸¸æ˜¯ä¸åŒçš„ï¼ŒåŸºäºä¸ç³»ç»Ÿäº¤äº’çš„è§’è‰²ã€‚&lt;/p&gt;
&lt;p&gt;Ambassador æ§åˆ¶é¢æ¿çš„ä¸»è¦ç›®æ ‡æ˜¯å¼€å‘äººå‘˜ï¼Œå¹¶å…è®¸å°†ç®€å•çš„æ³¨é‡Šæ·»åŠ åˆ° Kubernetes é…ç½®ä¸­ä»¥æ§åˆ¶æ ¸å¿ƒéƒ¨ç½²åŠŸèƒ½ï¼Œå¦‚è·¯ç”±ã€é‡‘ä¸é›€å‘å¸ƒã€é€Ÿç‡é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;Istio å…³æ³¨çš„ä¸»è¦è§’è‰²æ˜¯è¿ç»´äººå‘˜ï¼Œå¹¶ä¸”æ§åˆ¶å¹³é¢å…è®¸æŒ‡å®šé¢å¤–çš„ Kubernetes èµ„æºä»¥ä¿ƒè¿›æµé‡ç®¡ç†ï¼ˆåŒ…æ‹¬æ•…éšœæ³¨å…¥ï¼‰ã€å®‰å…¨ï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶å’Œè®¤è¯å®‰å…¨ï¼‰å’Œé¥æµ‹ï¼ˆåŒ…æ‹¬åˆ†å¸ƒå¼è¿½è¸ªå’Œå„ç›‘æ§æŒ‡æ ‡ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®ºåˆ†æ­§æˆ–è¶‹åŒ&#34;&gt;ç»“è®ºï¼šåˆ†æ­§æˆ–è¶‹åŒ&lt;/h2&gt;
&lt;p&gt;Lyft ä½¿ç”¨ Envoy ä½œä¸ºè¾¹ç¼˜ä»£ç†å’Œ service meshï¼Œæˆ‘è¿˜å¬åˆ°æœ‰å·¥ç¨‹å¸ˆä½¿ç”¨ Ambassador æ¥ç®¡ç†æœåŠ¡é—´ï¼ˆä¸œè¥¿å‘ï¼‰é€šä¿¡çš„æŠ¥é“ï¼Œä»¥åŠ Istio å¤„ç†å…¥å£æµé‡ï¼ˆç”šè‡³åœ¨&lt;a href=&#34;https://www.infoq.com/news/2018/08/istio-1.0-service-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;v1.0 å‘å¸ƒ&lt;/a&gt;çš„æ–°ç½‘å…³åŠŸèƒ½ä¹‹å‰ï¼‰ï¼Œç„¶è€Œï¼Œç›®å‰ Ambassador å’Œ Istio æ‰€ä»£è¡¨çš„ä»£ç†æŠ€æœ¯æ§åˆ¶å¹³é¢çš„ä¸¤ç§æ–¹æ³•ä¼¼ä¹ä¸ºå¼€å‘å’Œè¿ç»´å„è‡ªçš„è§’è‰²æä¾›äº†å¥½å¤„ã€‚é‰´äºæˆ‘ä»¬å¯¹ç°ä»£å®¹å™¨ç½‘ç»œçš„æ•´ä½“çŸ¥è¯†å’Œç»éªŒçŠ¶å†µï¼Œæˆ‘è¿˜ä¸ç¡®ä¿¡æœ‰ä¸€ä¸ªç®€å•çš„ä¸€åˆ€åˆ‡è§£å†³æ–¹æ¡ˆã€‚å› æ­¤ï¼Œæˆ‘è®¤ä¸ºåœ¨ç”¨äºç®¡ç†å—åŒ—å’Œä¸œè¥¿æµé‡çš„ç»Ÿä¸€æ§åˆ¶å¹³é¢ç»ˆæè§£å†³æ–¹æ¡ˆå‡ºç°ä¹‹å‰å¯èƒ½å‡ºç°åˆ†æ­§ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ç†è§£ Istio Service Mesh ä¸­ Envoy ä»£ç† Sidecar æ³¨å…¥åŠæµé‡åŠ«æŒ</title>
      <link>https://cloudnative.to/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/</link>
      <pubDate>Tue, 11 Sep 2018 14:48:53 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;ä»¥å¾€æœ‰å¾ˆå¤šæ–‡ç« è®²è§£ Istio æ˜¯å¦‚ä½•åš Sidecar æ³¨å…¥çš„ï¼Œä½†æ˜¯æ²¡æœ‰è®²è§£æ³¨å…¥ä¹‹å Sidecar å·¥ä½œçš„ç»†èŠ‚ã€‚æœ¬æ–‡å°†å¸¦å¤§å®¶è¯¦ç»†äº†è§£ Istio æ˜¯å¦‚ä½•å°† Envoy ä½œä¸º Sidecar çš„æ–¹å¼æ³¨å…¥åˆ°åº”ç”¨ç¨‹åº Pod ä¸­ï¼ŒåŠ Sidecar æ˜¯å¦‚ä½•åšåŠ«æŒæµé‡çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨è®²è§£ Istio å¦‚ä½•å°† Envoy ä»£ç†æ³¨å…¥åˆ°åº”ç”¨ç¨‹åº Pod ä¸­ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sidecar æ¨¡å¼ï¼šå®¹å™¨åº”ç”¨æ¨¡å¼ä¹‹ä¸€ï¼ŒService Mesh æ¶æ„çš„ä¸€ç§å®ç°æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;Init å®¹å™¨ï¼šPod ä¸­çš„ä¸€ç§ä¸“ç”¨çš„å®¹å™¨ï¼Œåœ¨åº”ç”¨ç¨‹åºå®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œï¼Œç”¨æ¥åŒ…å«ä¸€äº›åº”ç”¨é•œåƒä¸­ä¸å­˜åœ¨çš„å®ç”¨å·¥å…·æˆ–å®‰è£…è„šæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;iptablesï¼šæµé‡åŠ«æŒæ˜¯é€šè¿‡ iptables è½¬å‘å®ç°çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æŸ¥çœ‹ç›®å‰ &lt;code&gt;productpage-v1-745ffc55b7-2l2lw&lt;/code&gt; Pod ä¸­è¿è¡Œçš„å®¹å™¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n default get pod productpage-v1-745ffc55b7-2l2lw -o&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{..spec.containers[*].name}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;productpage istio-proxy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;productpage&lt;/code&gt; å³åº”ç”¨å®¹å™¨ï¼Œ&lt;code&gt;istio-proxy&lt;/code&gt; å³ Envoy ä»£ç†çš„ sidecar å®¹å™¨ã€‚å¦å¤–è¯¥ Pod ä¸­å®é™…ä¸Šè¿˜è¿è¡Œè¿‡ä¸€ä¸ª Init å®¹å™¨ï¼Œå› ä¸ºå®ƒæ‰§è¡Œç»“æŸå°±è‡ªåŠ¨ç»ˆæ­¢äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹ä¸åˆ°è¯¥å®¹å™¨çš„å­˜åœ¨ã€‚å…³æ³¨ &lt;code&gt;jsonpath&lt;/code&gt; çš„ç”¨æ³•è¯·å‚è€ƒ &lt;a href=&#34;https://kubernetes.io/docs/reference/kubectl/jsonpath/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;JSONPath Support&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-æ¨¡å¼&#34;&gt;Sidecar æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;åœ¨äº†è§£ Istio ä½¿ç”¨ Sidecar æ³¨å…¥ä¹‹å‰ï¼Œéœ€è¦å…ˆè¯´æ˜ä¸‹ä»€ä¹ˆæ˜¯ Sidecar æ¨¡å¼ã€‚Sidecar æ˜¯å®¹å™¨åº”ç”¨æ¨¡å¼çš„ä¸€ç§ï¼Œä¹Ÿæ˜¯åœ¨ Service Mesh ä¸­å‘æ‰¬å…‰å¤§çš„ä¸€ç§æ¨¡å¼ï¼Œè¯¦è§ &lt;a href=&#34;http://www.servicemesher.com/blog/service-mesh-architectures/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh æ¶æ„è§£æ&lt;/a&gt;ï¼Œå…¶ä¸­è¯¦ç»†æè¿°äº†&lt;strong&gt;èŠ‚ç‚¹ä»£ç†&lt;/strong&gt;å’Œ &lt;strong&gt;Sidecar&lt;/strong&gt; æ¨¡å¼çš„ Service Mesh æ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Sidecar æ¨¡å¼éƒ¨ç½²æœåŠ¡ç½‘æ ¼æ—¶ï¼Œæ— éœ€åœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œä»£ç†ï¼ˆå› æ­¤æ‚¨ä¸éœ€è¦åŸºç¡€ç»“æ„çš„åä½œï¼‰ï¼Œä½†æ˜¯é›†ç¾¤ä¸­å°†è¿è¡Œå¤šä¸ªç›¸åŒçš„ Sidecar å‰¯æœ¬ã€‚ä»å¦ä¸€ä¸ªè§’åº¦çœ‹ï¼šæˆ‘å¯ä»¥ä¸ºä¸€ç»„å¾®æœåŠ¡éƒ¨ç½²åˆ°ä¸€ä¸ªæœåŠ¡ç½‘æ ¼ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥éƒ¨ç½²ä¸€ä¸ªæœ‰ç‰¹å®šå®ç°çš„æœåŠ¡ç½‘æ ¼ã€‚åœ¨ Sidecar éƒ¨ç½²æ–¹å¼ä¸­ï¼Œä½ ä¼šä¸ºæ¯ä¸ªåº”ç”¨çš„å®¹å™¨éƒ¨ç½²ä¸€ä¸ªä¼´ç”Ÿå®¹å™¨ã€‚Sidecar æ¥ç®¡è¿›å‡ºåº”ç”¨å®¹å™¨çš„æ‰€æœ‰æµé‡ã€‚åœ¨ Kubernetes çš„ Pod ä¸­ï¼Œåœ¨åŸæœ‰çš„åº”ç”¨å®¹å™¨æ—è¾¹è¿è¡Œä¸€ä¸ª Sidecar å®¹å™¨ï¼Œå¯ä»¥ç†è§£ä¸ºä¸¤ä¸ªå®¹å™¨å…±äº«å­˜å‚¨ã€ç½‘ç»œç­‰èµ„æºï¼Œå¯ä»¥å¹¿ä¹‰çš„å°†è¿™ä¸ªæ³¨å…¥äº† Sidecar å®¹å™¨çš„ Pod ç†è§£ä¸ºä¸€å°ä¸»æœºï¼Œä¸¤ä¸ªå®¹å™¨å…±äº«ä¸»æœºèµ„æºã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ä¸‹å›¾ &lt;a href=&#34;https://jimmysong.io/posts/sofamesh-and-mosn-proxy-sidecar-service-mesh-by-ant-financial/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SOFAMesh &amp;amp; MOSNâ€”åŸºäº Istio æ„å»ºçš„ç”¨äºåº”å¯¹å¤§è§„æ¨¡æµé‡çš„ Service Mesh è§£å†³æ–¹æ¡ˆ&lt;/a&gt;çš„æ¶æ„å›¾ä¸­æè¿°çš„ï¼ŒMOSN ä½œä¸º Sidecar çš„æ–¹å¼å’Œåº”ç”¨è¿è¡Œåœ¨åŒä¸€ä¸ª Pod ä¸­ï¼Œæ‹¦æˆªæ‰€æœ‰è¿›å‡ºåº”ç”¨å®¹å™¨çš„æµé‡ï¼Œ&lt;a href=&#34;https://github.com/sofastack/sofa-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SOFAMesh&lt;/a&gt; å…¼å®¹ Istioï¼Œå…¶ä¸­ä½¿ç”¨ Go è¯­è¨€å¼€å‘çš„ &lt;a href=&#34;https://github.com/sofastack/mosn&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MOSN&lt;/a&gt; æ›¿æ¢äº† Envoyã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-sofamesh-æ¶æ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;SOFAMesh æ¶æ„å›¾&#34; srcset=&#34;
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/006tNbRwgy1fuyr4vizzwj31kw1biq98_hu5ed9d781bc088d3bf2bc991c95faf112_82817_0644990de72eedf37ef58fab25bcefcb.webp 400w,
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/006tNbRwgy1fuyr4vizzwj31kw1biq98_hu5ed9d781bc088d3bf2bc991c95faf112_82817_3608dc35f1fcfae25ff539428df0932b.webp 760w,
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/006tNbRwgy1fuyr4vizzwj31kw1biq98_hu5ed9d781bc088d3bf2bc991c95faf112_82817_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/006tNbRwgy1fuyr4vizzwj31kw1biq98_hu5ed9d781bc088d3bf2bc991c95faf112_82817_0644990de72eedf37ef58fab25bcefcb.webp&#34;
               width=&#34;760&#34;
               height=&#34;635&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      SOFAMesh æ¶æ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šä¸‹æ–‡ä¸­æ‰€æŒ‡çš„ Sidecar éƒ½æ˜¯æŒ‡çš„ Envoy ä»£ç†å®¹å™¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;init-å®¹å™¨&#34;&gt;Init å®¹å™¨&lt;/h2&gt;
&lt;p&gt;Init å®¹å™¨æ˜¯ä¸€ç§ä¸“ç”¨å®¹å™¨ï¼Œå®ƒåœ¨åº”ç”¨ç¨‹åºå®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œï¼Œç”¨æ¥åŒ…å«ä¸€äº›åº”ç”¨é•œåƒä¸­ä¸å­˜åœ¨çš„å®ç”¨å·¥å…·æˆ–å®‰è£…è„šæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ª Pod ä¸­å¯ä»¥æŒ‡å®šå¤šä¸ª Init å®¹å™¨ï¼Œå¦‚æœæŒ‡å®šäº†å¤šä¸ªï¼Œé‚£ä¹ˆ Init å®¹å™¨å°†ä¼šæŒ‰é¡ºåºä¾æ¬¡è¿è¡Œã€‚åªæœ‰å½“å‰é¢çš„ Init å®¹å™¨å¿…é¡»è¿è¡ŒæˆåŠŸåï¼Œæ‰å¯ä»¥è¿è¡Œä¸‹ä¸€ä¸ª Init å®¹å™¨ã€‚å½“æ‰€æœ‰çš„ Init å®¹å™¨è¿è¡Œå®Œæˆåï¼ŒKubernetes æ‰åˆå§‹åŒ– Pod å’Œè¿è¡Œåº”ç”¨å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;Init å®¹å™¨ä½¿ç”¨ Linux Namespaceï¼Œæ‰€ä»¥ç›¸å¯¹åº”ç”¨ç¨‹åºå®¹å™¨æ¥è¯´å…·æœ‰ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾ã€‚å› æ­¤ï¼Œå®ƒä»¬èƒ½å¤Ÿå…·æœ‰è®¿é—® Secret çš„æƒé™ï¼Œè€Œåº”ç”¨ç¨‹åºå®¹å™¨åˆ™ä¸èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Pod å¯åŠ¨è¿‡ç¨‹ä¸­ï¼ŒInit å®¹å™¨ä¼šæŒ‰é¡ºåºåœ¨ç½‘ç»œå’Œæ•°æ®å·åˆå§‹åŒ–ä¹‹åå¯åŠ¨ã€‚æ¯ä¸ªå®¹å™¨å¿…é¡»åœ¨ä¸‹ä¸€ä¸ªå®¹å™¨å¯åŠ¨ä¹‹å‰æˆåŠŸé€€å‡ºã€‚å¦‚æœç”±äºè¿è¡Œæ—¶æˆ–å¤±è´¥é€€å‡ºï¼Œå°†å¯¼è‡´å®¹å™¨å¯åŠ¨å¤±è´¥ï¼Œå®ƒä¼šæ ¹æ® Pod çš„ &lt;code&gt;restartPolicy&lt;/code&gt; æŒ‡å®šçš„ç­–ç•¥è¿›è¡Œé‡è¯•ã€‚ç„¶è€Œï¼Œå¦‚æœ Pod çš„ &lt;code&gt;restartPolicy&lt;/code&gt; è®¾ç½®ä¸º Alwaysï¼ŒInit å®¹å™¨å¤±è´¥æ—¶ä¼šä½¿ç”¨ &lt;code&gt;RestartPolicy&lt;/code&gt; ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ‰€æœ‰çš„ Init å®¹å™¨æ²¡æœ‰æˆåŠŸä¹‹å‰ï¼ŒPod å°†ä¸ä¼šå˜æˆ &lt;code&gt;Ready&lt;/code&gt; çŠ¶æ€ã€‚Init å®¹å™¨çš„ç«¯å£å°†ä¸ä¼šåœ¨ Service ä¸­è¿›è¡Œèšé›†ã€‚æ­£åœ¨åˆå§‹åŒ–ä¸­çš„ Pod å¤„äº &lt;code&gt;Pending&lt;/code&gt; çŠ¶æ€ï¼Œä½†åº”è¯¥ä¼šå°† &lt;code&gt;Initializing&lt;/code&gt; çŠ¶æ€è®¾ç½®ä¸º trueã€‚Init å®¹å™¨è¿è¡Œå®Œæˆä»¥åå°±ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;å…³äº Init å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ &lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/init-containers.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Init å®¹å™¨ - Kubernetes ä¸­æ–‡æŒ‡å—/äº‘åŸç”Ÿåº”ç”¨æ¶æ„å®è·µæ‰‹å†Œ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-æ³¨å…¥ç¤ºä¾‹åˆ†æ&#34;&gt;Sidecar æ³¨å…¥ç¤ºä¾‹åˆ†æ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹ä¸‹ Istio å®˜æ–¹ç¤ºä¾‹ &lt;code&gt;bookinfo&lt;/code&gt; ä¸­ &lt;code&gt;productpage&lt;/code&gt;  çš„ YAML é…ç½®ï¼Œå…³äº &lt;code&gt;bookinfo&lt;/code&gt; åº”ç”¨çš„è¯¦ç»† YAML é…ç½®è¯·å‚è€ƒ &lt;a href=&#34;https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster/blob/master/yaml/istio-bookinfo/bookinfo.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bookinfo.yaml&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio/examples-bookinfo-productpage-v1:1.8.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æŸ¥çœ‹ä¸‹ &lt;code&gt;productpage&lt;/code&gt; å®¹å™¨çš„ &lt;a href=&#34;https://github.com/istio/istio/blob/master/samples/bookinfo/src/productpage/Dockerfile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Dockerfile&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-dockerfile&#34; data-lang=&#34;dockerfile&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; python:2.7-slim&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; requirements.txt ./&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RUN&lt;/span&gt; pip install --no-cache-dir -r requirements.txt&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; productpage.py /opt/microservices/&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; templates /opt/microservices/templates&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; requirements.txt /opt/microservices/&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXPOSE&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; 9080&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WORKDIR&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; /opt/microservices&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CMD&lt;/span&gt; python productpage.py &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ° &lt;code&gt;Dockerfile&lt;/code&gt; ä¸­æ²¡æœ‰é…ç½® &lt;code&gt;ENTRYPOINT&lt;/code&gt;ï¼Œæ‰€ä»¥ &lt;code&gt;CMD&lt;/code&gt; çš„é…ç½® &lt;code&gt;python productpage.py 9080&lt;/code&gt;  å°†ä½œä¸ºé»˜è®¤çš„ &lt;code&gt;ENTRYPOINT&lt;/code&gt;ï¼Œè®°ä½è¿™ä¸€ç‚¹ï¼Œå†çœ‹ä¸‹æ³¨å…¥ sidecar ä¹‹åçš„é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl kube-inject -f yaml/istio-bookinfo/bookinfo.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬åªæˆªå–å…¶ä¸­ä¸ &lt;code&gt;productpage&lt;/code&gt; ç›¸å…³çš„ &lt;code&gt;Service&lt;/code&gt; å’Œ &lt;code&gt;Deployment&lt;/code&gt; é…ç½®éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;creationTimestamp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;strategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sidecar.istio.io/status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;version&amp;#34;:&amp;#34;fde14299e2ae804b95be08e0f2d171d466f47983391c00519bbf01392d9ad6bb&amp;#34;,&amp;#34;initContainers&amp;#34;:[&amp;#34;istio-init&amp;#34;],&amp;#34;containers&amp;#34;:[&amp;#34;istio-proxy&amp;#34;],&amp;#34;volumes&amp;#34;:[&amp;#34;istio-envoy&amp;#34;,&amp;#34;istio-certs&amp;#34;],&amp;#34;imagePullSecrets&amp;#34;:null}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;creationTimestamp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio/examples-bookinfo-productpage-v1:1.8.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;sidecar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;configPath&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/etc/istio/proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;binaryPath&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/usr/local/bin/envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;serviceCluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;drainDuration&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;45s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;parentShutdownDuration&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;1m0s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;discoveryAddress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;istio-pilot.istio-system:15007&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;discoveryRefreshDelay&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;1s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;zipkinAddress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;zipkin.istio-system:9411&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;connectTimeout&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;10s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;statsdUdpAddress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;istio-statsd-prom-bridge.istio-system:9125&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;proxyAdminPort&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;15000&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;controlPlaneAuthPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;NONE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;POD_NAME&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;valueFrom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;metadata.name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;POD_NAMESPACE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;valueFrom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;metadata.namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;INSTANCE_IP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;valueFrom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;status.podIP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ISTIO_META_POD_NAME&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;valueFrom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;metadata.name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ISTIO_META_INTERCEPTION_MODE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;REDIRECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;jimmysong/istio-release-proxyv2:1.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;10m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;securityContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;privileged&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnlyRootFilesystem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runAsUser&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/etc/istio/proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/etc/certs/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-certs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;initContainers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;15001&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;1337&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;REDIRECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;jimmysong/istio-release-proxy_init:1.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-init&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;securityContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;capabilities&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;NET_ADMIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;privileged&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;emptyDir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;medium&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Memory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-certs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;optional&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio.default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ° Service çš„é…ç½®æ²¡æœ‰å˜åŒ–ï¼Œæ‰€æœ‰çš„å˜åŒ–éƒ½åœ¨ &lt;code&gt;Deployment&lt;/code&gt; é‡Œï¼ŒIstio ç»™åº”ç”¨ Pod æ³¨å…¥çš„é…ç½®ä¸»è¦åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Init å®¹å™¨ &lt;code&gt;istio-init&lt;/code&gt;ï¼šç”¨äºç»™ Sidecar å®¹å™¨å³ Envoy ä»£ç†åšåˆå§‹åŒ–ï¼Œè®¾ç½® iptables ç«¯å£è½¬å‘&lt;/li&gt;
&lt;li&gt;Envoy sidecar å®¹å™¨ &lt;code&gt;istio-proxy&lt;/code&gt;ï¼šè¿è¡Œ Envoy ä»£ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°†åˆ†åˆ«è§£æä¸‹è¿™ä¸¤ä¸ªå®¹å™¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;init-å®¹å™¨è§£æ&#34;&gt;Init å®¹å™¨è§£æ&lt;/h3&gt;
&lt;p&gt;Istio åœ¨ Pod ä¸­æ³¨å…¥çš„ Init å®¹å™¨åä¸º &lt;code&gt;istio-init&lt;/code&gt;ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢ Istio æ³¨å…¥å®Œæˆåçš„ YAML æ–‡ä»¶ä¸­çœ‹åˆ°äº†è¯¥å®¹å™¨çš„å¯åŠ¨å‚æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-p &lt;span class=&#34;m&#34;&gt;15001&lt;/span&gt; -u &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; -m REDIRECT -i &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt; -x &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; -b &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt; -d &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å†æ£€æŸ¥ä¸‹è¯¥å®¹å™¨çš„ &lt;a href=&#34;https://github.com/istio/istio/blob/master/pilot/docker/Dockerfile.proxy_init&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Dockerfile&lt;/a&gt; çœ‹çœ‹ &lt;code&gt;ENTRYPOINT&lt;/code&gt; æ˜¯ä»€ä¹ˆä»¥ç¡®å®šå¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-dockerfile&#34; data-lang=&#34;dockerfile&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; ubuntu:xenial&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RUN&lt;/span&gt; apt-get update &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt-get install -y &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    iproute2 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    iptables &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; rm -rf /var/lib/apt/lists/*&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ADD&lt;/span&gt; istio-iptables.sh /usr/local/bin/&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ENTRYPOINT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/usr/local/bin/istio-iptables.sh&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ° &lt;code&gt;istio-init&lt;/code&gt; å®¹å™¨çš„å…¥å£æ˜¯ &lt;code&gt;/usr/local/bin/istio-iptables.sh&lt;/code&gt; è„šæœ¬ï¼Œå†æŒ‰å›¾ç´¢éª¥çœ‹çœ‹è¿™ä¸ªè„šæœ¬é‡Œåˆ°åº•å†™çš„ä»€ä¹ˆï¼Œè¯¥è„šæœ¬çš„ä½ç½®åœ¨ Istio æºç ä»“åº“çš„ &lt;a href=&#34;https://github.com/istio/istio/blob/master/tools/deb/istio-iptables.sh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tools/deb/istio-iptables.sh&lt;/a&gt;ï¼Œä¸€å…± 300 å¤šè¡Œï¼Œå°±ä¸è´´åœ¨è¿™é‡Œäº†ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥è§£æä¸‹è¿™ä¸ªå¯åŠ¨è„šæœ¬ã€‚&lt;/p&gt;
&lt;h3 id=&#34;init-å®¹å™¨å¯åŠ¨å…¥å£&#34;&gt;Init å®¹å™¨å¯åŠ¨å…¥å£&lt;/h3&gt;
&lt;p&gt;Init å®¹å™¨çš„å¯åŠ¨å…¥å£æ˜¯ &lt;code&gt;/usr/local/bin/istio-iptables.sh&lt;/code&gt; è„šæœ¬ï¼Œè¯¥è„šæœ¬çš„ç”¨æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istio-iptables.sh -p PORT -u UID -g GID &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-m mode&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-b ports&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-d ports&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-i CIDR&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-x CIDR&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-h&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -p: æŒ‡å®šé‡å®šå‘æ‰€æœ‰ TCP æµé‡çš„ Envoy ç«¯å£ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ENVOY_PORT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 15001ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -u: æŒ‡å®šæœªåº”ç”¨é‡å®šå‘çš„ç”¨æˆ·çš„ UIDã€‚é€šå¸¸ï¼Œè¿™æ˜¯ä»£ç†å®¹å™¨çš„ UIDï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ENVOY_USER&lt;/span&gt; çš„ uidï¼Œistio_proxy çš„ uid æˆ– 1337ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -g: æŒ‡å®šæœªåº”ç”¨é‡å®šå‘çš„ç”¨æˆ·çš„ GIDã€‚ï¼ˆä¸ -u param ç›¸åŒçš„é»˜è®¤å€¼ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -m: æŒ‡å®šå…¥ç«™è¿æ¥é‡å®šå‘åˆ° Envoy çš„æ¨¡å¼ï¼Œâ€œREDIRECTâ€ æˆ– â€œTPROXYâ€ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_INBOUND_INTERCEPTION_MODE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -b: é€—å·åˆ†éš”çš„å…¥ç«™ç«¯å£åˆ—è¡¨ï¼Œå…¶æµé‡å°†é‡å®šå‘åˆ° Envoyï¼ˆå¯é€‰ï¼‰ã€‚ä½¿ç”¨é€šé…ç¬¦ â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰ç«¯å£ã€‚ä¸ºç©ºæ—¶è¡¨ç¤ºç¦ç”¨æ‰€æœ‰å…¥ç«™é‡å®šå‘ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_INBOUND_PORTS&lt;/span&gt;ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -d: æŒ‡å®šè¦ä»é‡å®šå‘åˆ° Envoy ä¸­æ’é™¤ï¼ˆå¯é€‰ï¼‰çš„å…¥ç«™ç«¯å£åˆ—è¡¨ï¼Œä»¥é€—å·æ ¼å¼åˆ†éš”ã€‚ä½¿ç”¨é€šé…ç¬¦â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰å…¥ç«™æµé‡ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_LOCAL_EXCLUDE_PORTS&lt;/span&gt;ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -i: æŒ‡å®šé‡å®šå‘åˆ° Envoyï¼ˆå¯é€‰ï¼‰çš„ IP åœ°å€èŒƒå›´ï¼Œä»¥é€—å·åˆ†éš”çš„ CIDR æ ¼å¼åˆ—è¡¨ã€‚ä½¿ç”¨é€šé…ç¬¦ â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰å‡ºç«™æµé‡ã€‚ç©ºåˆ—è¡¨å°†ç¦ç”¨æ‰€æœ‰å‡ºç«™é‡å®šå‘ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_SERVICE_CIDR&lt;/span&gt;ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -x: æŒ‡å®šå°†ä»é‡å®šå‘ä¸­æ’é™¤çš„ IP åœ°å€èŒƒå›´ï¼Œä»¥é€—å·åˆ†éš”çš„ CIDR æ ¼å¼åˆ—è¡¨ã€‚ä½¿ç”¨é€šé…ç¬¦ â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰å‡ºç«™æµé‡ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_SERVICE_EXCLUDE_CIDR&lt;/span&gt;ï¼‰ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ç¯å¢ƒå˜é‡ä½äº &lt;span class=&#34;nv&#34;&gt;$ISTIO_SIDECAR_CONFIG&lt;/span&gt;ï¼ˆé»˜è®¤åœ¨ï¼š/var/lib/istio/envoy/sidecar.envï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡æŸ¥çœ‹è¯¥è„šæœ¬ä½ å°†çœ‹åˆ°ï¼Œä»¥ä¸Šä¼ å…¥çš„å‚æ•°éƒ½ä¼šé‡æ–°ç»„è£…æˆ &lt;a href=&#34;https://wangchujiang.com/linux-command/c/iptables.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;iptables&lt;/code&gt; å‘½ä»¤&lt;/a&gt;çš„å‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;å†å‚è€ƒ &lt;code&gt;istio-init&lt;/code&gt; å®¹å™¨çš„å¯åŠ¨å‚æ•°ï¼Œå®Œæ•´çš„å¯åŠ¨å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ /usr/local/bin/istio-iptables.sh -p &lt;span class=&#34;m&#34;&gt;15001&lt;/span&gt; -u &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; -m REDIRECT -i &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt; -x &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; -b &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt; -d &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥å®¹å™¨å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯è®© Envoy ä»£ç†å¯ä»¥æ‹¦æˆªæ‰€æœ‰çš„è¿›å‡º Pod çš„æµé‡ï¼Œå³å°†å…¥ç«™æµé‡é‡å®šå‘åˆ° Sidecarï¼Œå†æ‹¦æˆªåº”ç”¨å®¹å™¨çš„å‡ºç«™æµé‡ç»è¿‡ Sidecar å¤„ç†åå†å‡ºç«™ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å‘½ä»¤è§£æ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ¡å¯åŠ¨å‘½ä»¤çš„ä½œç”¨æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†åº”ç”¨å®¹å™¨çš„æ‰€æœ‰æµé‡éƒ½è½¬å‘åˆ° Envoy çš„ 15001 ç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;istio-proxy&lt;/code&gt; ç”¨æˆ·èº«ä»½è¿è¡Œï¼ŒUID ä¸º 1337ï¼Œå³ Envoy æ‰€å¤„çš„ç”¨æˆ·ç©ºé—´ï¼Œè¿™ä¹Ÿæ˜¯ &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨é»˜è®¤ä½¿ç”¨çš„ç”¨æˆ·ï¼Œè§ YAML é…ç½®ä¸­çš„ &lt;code&gt;runAsUser&lt;/code&gt; å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨é»˜è®¤çš„ &lt;code&gt;REDIRECT&lt;/code&gt; æ¨¡å¼æ¥é‡å®šå‘æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;å°†æ‰€æœ‰å‡ºç«™æµé‡éƒ½é‡å®šå‘åˆ° Envoy ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;å°†æ‰€æœ‰è®¿é—® 9080 ç«¯å£ï¼ˆå³åº”ç”¨å®¹å™¨ &lt;code&gt;productpage&lt;/code&gt; çš„ç«¯å£ï¼‰çš„æµé‡é‡å®šå‘åˆ° Envoy ä»£ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› ä¸º Init å®¹å™¨åˆå§‹åŒ–å®Œæ¯•åå°±ä¼šè‡ªåŠ¨ç»ˆæ­¢ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ç™»é™†åˆ°å®¹å™¨ä¸­æŸ¥çœ‹ iptables ä¿¡æ¯ï¼Œä½†æ˜¯ Init å®¹å™¨åˆå§‹åŒ–ç»“æœä¼šä¿ç•™åˆ°åº”ç”¨å®¹å™¨å’Œ Sidecar å®¹å™¨ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;istio-proxy-å®¹å™¨è§£æ&#34;&gt;istio-proxy å®¹å™¨è§£æ&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†æŸ¥çœ‹ iptables é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦ç™»é™†åˆ° Sidecar å®¹å™¨ä¸­ä½¿ç”¨ root ç”¨æˆ·æ¥æŸ¥çœ‹ï¼Œå› ä¸º &lt;code&gt;kubectl&lt;/code&gt; æ— æ³•ä½¿ç”¨ç‰¹æƒæ¨¡å¼æ¥è¿œç¨‹æ“ä½œ docker å®¹å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç™»é™†åˆ° &lt;code&gt;productpage&lt;/code&gt; Pod æ‰€åœ¨çš„ä¸»æœºä¸Šä½¿ç”¨ &lt;code&gt;docker&lt;/code&gt; å‘½ä»¤ç™»é™†å®¹å™¨ä¸­æŸ¥çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;productpage&lt;/code&gt; Pod æ‰€åœ¨çš„ä¸»æœºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n default get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;productpage -o wide
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                              READY     STATUS    RESTARTS   AGE       IP             NODE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;productpage-v1-745ffc55b7-2l2lw   2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          1d        172.33.78.10   node3
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»è¾“å‡ºç»“æœä¸­å¯ä»¥çœ‹åˆ°è¯¥ Pod è¿è¡Œåœ¨ &lt;code&gt;node3&lt;/code&gt; ä¸Šï¼Œä½¿ç”¨ &lt;code&gt;vagrant&lt;/code&gt; å‘½ä»¤ç™»é™†åˆ° &lt;code&gt;node3&lt;/code&gt; ä¸»æœºä¸­å¹¶åˆ‡æ¢ä¸º root ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ vagrant ssh node3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo -i
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹ iptables é…ç½®ï¼Œåˆ—å‡º NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰è¡¨çš„æ‰€æœ‰è§„åˆ™ï¼Œå› ä¸ºåœ¨ Init å®¹å™¨å¯åŠ¨çš„æ—¶å€™é€‰æ‹©ç»™  &lt;code&gt;istio-iptables.sh&lt;/code&gt; ä¼ é€’çš„å‚æ•°ä¸­æŒ‡å®šå°†å…¥ç«™æµé‡é‡å®šå‘åˆ° Envoy çš„æ¨¡å¼ä¸ºâ€œREDIRECTâ€ï¼Œå› æ­¤åœ¨ iptables ä¸­å°†åªæœ‰ NAT è¡¨çš„è§„æ ¼é…ç½®ï¼Œå¦‚æœé€‰æ‹© &lt;code&gt;TPROXY&lt;/code&gt; è¿˜ä¼šæœ‰ &lt;code&gt;mangle&lt;/code&gt; è¡¨é…ç½®ã€‚&lt;code&gt;iptables&lt;/code&gt; å‘½ä»¤çš„è¯¦ç»†ç”¨æ³•è¯·å‚è€ƒ &lt;a href=&#34;https://wangchujiang.com/linux-command/c/iptables.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iptables&lt;/a&gt;ï¼Œè§„åˆ™é…ç½®è¯·å‚è€ƒ &lt;a href=&#34;http://www.zsythink.net/archives/1517&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iptables è§„åˆ™é…ç½®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç†è§£-iptables&#34;&gt;ç†è§£ iptables&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;iptables&lt;/code&gt; æ˜¯ Linux å†…æ ¸ä¸­çš„é˜²ç«å¢™è½¯ä»¶ netfilter çš„ç®¡ç†å·¥å…·ï¼Œä½äºç”¨æˆ·ç©ºé—´ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ netfilter çš„ä¸€éƒ¨åˆ†ã€‚Netfilter ä½äºå†…æ ¸ç©ºé—´ï¼Œä¸ä»…æœ‰ç½‘ç»œåœ°å€è½¬æ¢çš„åŠŸèƒ½ï¼Œä¹Ÿå…·å¤‡æ•°æ®åŒ…å†…å®¹ä¿®æ”¹ã€ä»¥åŠæ•°æ®åŒ…è¿‡æ»¤ç­‰é˜²ç«å¢™åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨äº†è§£ Init å®¹å™¨åˆå§‹åŒ–çš„ iptables ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹ iptables å’Œè§„åˆ™é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº† iptables è°ƒç”¨é“¾ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-iptables-è°ƒç”¨é“¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;iptables è°ƒç”¨é“¾&#34; srcset=&#34;
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdly1fv5hukl647j30k6145gnt_hu3f994bae225bb7b1522ce12049b4ce9b_98273_d5825c2c45eade0533c09962b2e3ec41.webp 400w,
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdly1fv5hukl647j30k6145gnt_hu3f994bae225bb7b1522ce12049b4ce9b_98273_a5761eb8b14672c9f1426dd8a44b80f2.webp 760w,
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdly1fv5hukl647j30k6145gnt_hu3f994bae225bb7b1522ce12049b4ce9b_98273_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdly1fv5hukl647j30k6145gnt_hu3f994bae225bb7b1522ce12049b4ce9b_98273_d5825c2c45eade0533c09962b2e3ec41.webp&#34;
               width=&#34;382&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      iptables è°ƒç”¨é“¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;iptables-ä¸­çš„è¡¨&#34;&gt;iptables ä¸­çš„è¡¨&lt;/h3&gt;
&lt;p&gt;Init å®¹å™¨ä¸­ä½¿ç”¨çš„çš„ iptables ç‰ˆæœ¬æ˜¯ &lt;code&gt;v1.6.0&lt;/code&gt;ï¼Œå…±åŒ…å« 5 å¼ è¡¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;raw&lt;/code&gt; ç”¨äºé…ç½®æ•°æ®åŒ…ï¼Œ&lt;code&gt;raw&lt;/code&gt; ä¸­çš„æ•°æ®åŒ…ä¸ä¼šè¢«ç³»ç»Ÿè·Ÿè¸ªã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;filter&lt;/code&gt; æ˜¯ç”¨äºå­˜æ”¾æ‰€æœ‰ä¸é˜²ç«å¢™ç›¸å…³æ“ä½œçš„é»˜è®¤è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nat&lt;/code&gt; ç”¨äº &lt;a href=&#34;https://en.wikipedia.org/wiki/Network_address_translation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘ç»œåœ°å€è½¬æ¢&lt;/a&gt;ï¼ˆä¾‹å¦‚ï¼šç«¯å£è½¬å‘ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mangle&lt;/code&gt; ç”¨äºå¯¹ç‰¹å®šæ•°æ®åŒ…çš„ä¿®æ”¹ï¼ˆå‚è€ƒ&lt;a href=&#34;https://en.wikipedia.org/wiki/Mangled_packet&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŸåæ•°æ®åŒ…&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;security&lt;/code&gt; ç”¨äº&lt;a href=&#34;https://wiki.archlinux.org/index.php/Security#Mandatory_access_control&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼ºåˆ¶è®¿é—®æ§åˆ¶&lt;/a&gt; ç½‘ç»œè§„åˆ™ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šåœ¨æœ¬ç¤ºä¾‹ä¸­åªç”¨åˆ°äº† &lt;code&gt;nat&lt;/code&gt; è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸åŒçš„è¡¨ä¸­çš„å…·æœ‰çš„é“¾ç±»å‹å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è§„åˆ™åç§°&lt;/th&gt;
&lt;th&gt;raw&lt;/th&gt;
&lt;th&gt;filter&lt;/th&gt;
&lt;th&gt;nat&lt;/th&gt;
&lt;th&gt;mangle&lt;/th&gt;
&lt;th&gt;security&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;PREROUTING&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;INPUT&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OUTPUT&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;POSTROUTING&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;FORWARD&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸‹å›¾æ˜¯ iptables çš„è°ƒç”¨é“¾é¡ºåºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-iptables-è°ƒç”¨é“¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;iptables è°ƒç”¨é“¾&#34; srcset=&#34;
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5dq2bptdj31110begnl_hu0abd4321a803c4604a315c5d5217185e_40086_337d8d2a9d0288e01bb126c9a82eed61.webp 400w,
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5dq2bptdj31110begnl_hu0abd4321a803c4604a315c5d5217185e_40086_596fa83850eaae89898ee6230b90125e.webp 760w,
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5dq2bptdj31110begnl_hu0abd4321a803c4604a315c5d5217185e_40086_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5dq2bptdj31110begnl_hu0abd4321a803c4604a315c5d5217185e_40086_337d8d2a9d0288e01bb126c9a82eed61.webp&#34;
               width=&#34;760&#34;
               height=&#34;234&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      iptables è°ƒç”¨é“¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…³äº iptables çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ&lt;a href=&#34;https://www.aliang.org/Linux/iptables.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¸¸è§ iptables ä½¿ç”¨è§„åˆ™åœºæ™¯æ•´ç†&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;iptables-å‘½ä»¤&#34;&gt;iptables å‘½ä»¤&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;iptables&lt;/code&gt; å‘½ä»¤çš„ä¸»è¦ç”¨é€”æ˜¯ä¿®æ”¹è¿™äº›è¡¨ä¸­çš„è§„åˆ™ã€‚&lt;code&gt;iptables&lt;/code&gt; å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-t è¡¨å&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; å‘½ä»¤é€‰é¡¹ï¼»é“¾å&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;ï¼»æ¡ä»¶åŒ¹é…ï¼½&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-j ç›®æ ‡åŠ¨ä½œæˆ–è·³è½¬ï¼½
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Init å®¹å™¨ä¸­çš„ &lt;code&gt;/istio-iptables.sh&lt;/code&gt; å¯åŠ¨å…¥å£è„šæœ¬å°±æ˜¯æ‰§è¡Œ iptables åˆå§‹åŒ–çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç†è§£-iptables-è§„åˆ™&#34;&gt;ç†è§£ iptables è§„åˆ™&lt;/h3&gt;
&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨ä¸­çš„é»˜è®¤çš„ iptables è§„åˆ™ï¼Œé»˜è®¤æŸ¥çœ‹çš„æ˜¯ filter è¡¨ä¸­çš„è§„åˆ™ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -L -v
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT 350K packets, 63M bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain FORWARD &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; packets, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT 18M packets, 1916M bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°ä¸‰ä¸ªé»˜è®¤çš„é“¾ï¼Œåˆ†åˆ«æ˜¯ INPUTã€FORWARD å’Œ OUTPUTï¼Œæ¯ä¸ªé“¾ä¸­çš„ç¬¬ä¸€è¡Œè¾“å‡ºè¡¨ç¤ºé“¾åç§°ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º INPUT/FORWARD/OUTPUTï¼‰ï¼Œåè·Ÿé»˜è®¤ç­–ç•¥ï¼ˆACCEPTï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾æ˜¯ iptables çš„å»ºè®®ç»“æ„å›¾ï¼Œæµé‡åœ¨ç»è¿‡ INPUT é“¾ä¹‹åå°±è¿›å…¥äº†ä¸Šå±‚åè®®æ ˆï¼Œæ¯”å¦‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-iptables-ç»“æ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;iptables ç»“æ„å›¾&#34; srcset=&#34;
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5dm4a9ygj30w50czdi3_hu60ea2fd68c31c07200ca8bf416e7479d_58365_a2a6921d15ae916cc7d296bd609c382b.webp 400w,
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5dm4a9ygj30w50czdi3_hu60ea2fd68c31c07200ca8bf416e7479d_58365_36567d3fc916ca04520714f3161dff82.webp 760w,
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5dm4a9ygj30w50czdi3_hu60ea2fd68c31c07200ca8bf416e7479d_58365_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5dm4a9ygj30w50czdi3_hu60ea2fd68c31c07200ca8bf416e7479d_58365_a2a6921d15ae916cc7d296bd609c382b.webp&#34;
               width=&#34;760&#34;
               height=&#34;307&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      iptables ç»“æ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ç‰‡æ¥è‡ª&lt;a href=&#34;https://www.aliang.org/Linux/iptables.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¸¸è§ iptables ä½¿ç”¨è§„åˆ™åœºæ™¯æ•´ç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ¯æ¡é“¾ä¸­éƒ½å¯ä»¥æ·»åŠ å¤šæ¡è§„åˆ™ï¼Œè§„åˆ™æ˜¯æŒ‰ç…§é¡ºåºä»å‰åˆ°åæ‰§è¡Œçš„ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹è§„åˆ™çš„è¡¨å¤´å®šä¹‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;pkts&lt;/strong&gt;ï¼šå¤„ç†è¿‡çš„åŒ¹é…çš„æŠ¥æ–‡æ•°é‡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;bytes&lt;/strong&gt;ï¼šç´¯è®¡å¤„ç†çš„æŠ¥æ–‡å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;target&lt;/strong&gt;ï¼šå¦‚æœæŠ¥æ–‡ä¸è§„åˆ™åŒ¹é…ï¼ŒæŒ‡å®šç›®æ ‡å°±ä¼šè¢«æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;prot&lt;/strong&gt;ï¼šåè®®ï¼Œä¾‹å¦‚ &lt;code&gt;tdp&lt;/code&gt;ã€&lt;code&gt;udp&lt;/code&gt;ã€&lt;code&gt;icmp&lt;/code&gt; å’Œ &lt;code&gt;all&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;opt&lt;/strong&gt;ï¼šå¾ˆå°‘ä½¿ç”¨ï¼Œè¿™ä¸€åˆ—ç”¨äºæ˜¾ç¤º IP é€‰é¡¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;in&lt;/strong&gt;ï¼šå…¥ç«™ç½‘å¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;out&lt;/strong&gt;ï¼šå‡ºç«™ç½‘å¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;source&lt;/strong&gt;ï¼šæµé‡çš„æº IP åœ°å€æˆ–å­ç½‘ï¼Œåè€…æ˜¯ &lt;code&gt;anywhere&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;destination&lt;/strong&gt;ï¼šæµé‡çš„ç›®çš„åœ° IP åœ°å€æˆ–å­ç½‘ï¼Œæˆ–è€…æ˜¯ &lt;code&gt;anywhere&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿˜æœ‰ä¸€åˆ—æ²¡æœ‰è¡¨å¤´ï¼Œæ˜¾ç¤ºåœ¨æœ€åï¼Œè¡¨ç¤ºè§„åˆ™çš„é€‰é¡¹ï¼Œä½œä¸ºè§„åˆ™çš„æ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œç”¨æ¥è¡¥å……å‰é¢çš„å‡ åˆ—ä¸­çš„é…ç½®ã€‚&lt;code&gt;prot&lt;/code&gt;ã€&lt;code&gt;opt&lt;/code&gt;ã€&lt;code&gt;in&lt;/code&gt;ã€&lt;code&gt;out&lt;/code&gt;ã€&lt;code&gt;source&lt;/code&gt; å’Œ &lt;code&gt;destination&lt;/code&gt; å’Œæ˜¾ç¤ºåœ¨ &lt;code&gt;destination&lt;/code&gt; åé¢çš„æ²¡æœ‰è¡¨å¤´çš„ä¸€åˆ—æ‰©å±•æ¡ä»¶å…±åŒç»„æˆåŒ¹é…è§„åˆ™ã€‚å½“æµé‡åŒ¹é…è¿™äº›è§„åˆ™åå°±ä¼šæ‰§è¡Œ &lt;code&gt;target&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å…³äº iptables è§„åˆ™è¯·å‚è€ƒ&lt;a href=&#34;https://www.aliang.org/Linux/iptables.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¸¸è§ iptables ä½¿ç”¨è§„åˆ™åœºæ™¯æ•´ç†&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;target æ”¯æŒçš„ç±»å‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;target&lt;/code&gt; ç±»å‹åŒ…æ‹¬ ACCEPT&lt;code&gt;ã€REJECT&lt;/code&gt;ã€&lt;code&gt;DROP&lt;/code&gt;ã€&lt;code&gt;LOG&lt;/code&gt; ã€&lt;code&gt;SNAT&lt;/code&gt;ã€&lt;code&gt;MASQUERADE&lt;/code&gt;ã€&lt;code&gt;DNAT&lt;/code&gt;ã€&lt;code&gt;REDIRECT&lt;/code&gt;ã€&lt;code&gt;RETURN&lt;/code&gt; æˆ–è€…è·³è½¬åˆ°å…¶ä»–è§„åˆ™ç­‰ã€‚åªè¦æ‰§è¡Œåˆ°æŸä¸€æ¡é“¾ä¸­åªæœ‰æŒ‰ç…§é¡ºåºæœ‰ä¸€æ¡è§„åˆ™åŒ¹é…åå°±å¯ä»¥ç¡®å®šæŠ¥æ–‡çš„å»å‘äº†ï¼Œé™¤äº† &lt;code&gt;RETURN&lt;/code&gt; ç±»å‹ï¼Œç±»ä¼¼ç¼–ç¨‹è¯­è¨€ä¸­çš„ &lt;code&gt;return&lt;/code&gt; è¯­å¥ï¼Œè¿”å›åˆ°å®ƒçš„è°ƒç”¨ç‚¹ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡è§„åˆ™ã€‚&lt;code&gt;target&lt;/code&gt; æ”¯æŒçš„é…ç½®è¯¦è§£è¯·å‚è€ƒ &lt;a href=&#34;http://www.zsythink.net/archives/1199&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iptables è¯¦è§£ï¼ˆ1ï¼‰ï¼šiptables æ¦‚å¿µ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»è¾“å‡ºç»“æœä¸­å¯ä»¥çœ‹åˆ° Init å®¹å™¨æ²¡æœ‰åœ¨ iptables çš„é»˜è®¤é“¾è·¯ä¸­åˆ›å»ºä»»ä½•è§„åˆ™ï¼Œè€Œæ˜¯åˆ›å»ºäº†æ–°çš„é“¾è·¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æŸ¥çœ‹-iptables-nat-è¡¨ä¸­æ³¨å…¥çš„è§„åˆ™&#34;&gt;æŸ¥çœ‹ iptables nat è¡¨ä¸­æ³¨å…¥çš„è§„åˆ™&lt;/h2&gt;
&lt;p&gt;Init å®¹å™¨é€šè¿‡å‘ iptables nat è¡¨ä¸­æ³¨å…¥è½¬å‘è§„åˆ™æ¥åŠ«æŒæµé‡çš„ï¼Œä¸‹å›¾æ˜¾ç¤ºçš„æ˜¯ productpage æœåŠ¡ä¸­çš„ iptables æµé‡åŠ«æŒçš„è¯¦ç»†è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy-sidecar-æµé‡åŠ«æŒ-istio-iptables-å®‹å‡€è¶…-jimmy-song-æœåŠ¡ç½‘æ ¼-service-mesh&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy sidecar æµé‡åŠ«æŒ Istio iptables å®‹å‡€è¶… Jimmy Song æœåŠ¡ç½‘æ ¼ Service Mesh&#34; srcset=&#34;
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5doj8fuij31kw0ytn7h_hud9f0490caf19c3d388beb2ece3b67605_127683_b2e5ce2d8ae693a715b87af3e218f7d9.webp 400w,
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5doj8fuij31kw0ytn7h_hud9f0490caf19c3d388beb2ece3b67605_127683_465fb56f877f36d85a5560320dd0c4cd.webp 760w,
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5doj8fuij31kw0ytn7h_hud9f0490caf19c3d388beb2ece3b67605_127683_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5doj8fuij31kw0ytn7h_hud9f0490caf19c3d388beb2ece3b67605_127683_b2e5ce2d8ae693a715b87af3e218f7d9.webp&#34;
               width=&#34;760&#34;
               height=&#34;465&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy sidecar æµé‡åŠ«æŒ Istio iptables å®‹å‡€è¶… Jimmy Song æœåŠ¡ç½‘æ ¼ Service Mesh
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Init å®¹å™¨å¯åŠ¨æ—¶å‘½ä»¤è¡Œå‚æ•°ä¸­æŒ‡å®šäº† &lt;code&gt;REDIRECT&lt;/code&gt; æ¨¡å¼ï¼Œå› æ­¤åªåˆ›å»ºäº† NAT è¡¨è§„åˆ™ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŸ¥çœ‹ä¸‹ NAT è¡¨ä¸­åˆ›å»ºçš„è§„åˆ™ï¼Œè¿™æ˜¯å…¨æ–‡ä¸­çš„&lt;strong&gt;é‡ç‚¹éƒ¨åˆ†&lt;/strong&gt;ï¼Œå‰é¢è®²äº†é‚£ä¹ˆå¤šéƒ½æ˜¯ä¸ºå®ƒåšé“ºå«çš„ã€‚ä¸‹é¢æ˜¯æŸ¥çœ‹ nat è¡¨ä¸­çš„è§„åˆ™ï¼Œå…¶ä¸­é“¾çš„åå­—ä¸­åŒ…å« &lt;code&gt;ISTIO&lt;/code&gt; å‰ç¼€çš„æ˜¯ç”± Init å®¹å™¨æ³¨å…¥çš„ï¼Œè§„åˆ™åŒ¹é…æ˜¯æ ¹æ®ä¸‹é¢æ˜¾ç¤ºçš„é¡ºåºæ¥æ‰§è¡Œçš„ï¼Œå…¶ä¸­ä¼šæœ‰å¤šæ¬¡è·³è½¬ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æŸ¥çœ‹ NAT è¡¨ä¸­è§„åˆ™é…ç½®çš„è¯¦ç»†ä¿¡æ¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -L -v
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# PREROUTING é“¾ï¼šç”¨äºç›®æ ‡åœ°å€è½¬æ¢ï¼ˆDNATï¼‰ï¼Œå°†æ‰€æœ‰å…¥ç«™ TCP æµé‡è·³è½¬åˆ° ISTIO_INBOUND é“¾ä¸Š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain PREROUTING &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; packets, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; ISTIO_INBOUND  tcp  --  any    any     anywhere             anywhere
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# INPUT é“¾ï¼šå¤„ç†è¾“å…¥æ•°æ®åŒ…ï¼Œé TCP æµé‡å°†ç»§ç»­ OUTPUT é“¾&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; packets, &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# OUTPUT é“¾ï¼šå°†æ‰€æœ‰å‡ºç«™æ•°æ®åŒ…è·³è½¬åˆ° ISTIO_OUTPUT é“¾ä¸Š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;41146&lt;/span&gt; packets, 3845K bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;93&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;5580&lt;/span&gt; ISTIO_OUTPUT  tcp  --  any    any     anywhere             anywhere
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# POSTROUTING é“¾ï¼šæ‰€æœ‰æ•°æ®åŒ…æµå‡ºç½‘å¡æ—¶éƒ½è¦å…ˆè¿›å…¥POSTROUTING é“¾ï¼Œå†…æ ¸æ ¹æ®æ•°æ®åŒ…ç›®çš„åœ°åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬å‘å‡ºå»ï¼Œæˆ‘ä»¬çœ‹åˆ°æ­¤å¤„æœªåšä»»ä½•å¤„ç†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain POSTROUTING &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT &lt;span class=&#34;m&#34;&gt;41199&lt;/span&gt; packets, 3848K bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ISTIO_INBOUND é“¾ï¼šå°†æ‰€æœ‰ç›®çš„åœ°ä¸º 9080 ç«¯å£çš„å…¥ç«™æµé‡é‡å®šå‘åˆ° ISTIO_IN_REDIRECT é“¾ä¸Š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain ISTIO_INBOUND &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; ISTIO_IN_REDIRECT  tcp  --  any    any     anywhere             anywhere             tcp dpt:9080
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ISTIO_IN_REDIRECT é“¾ï¼šå°†æ‰€æœ‰çš„å…¥ç«™æµé‡è·³è½¬åˆ°æœ¬åœ°çš„ 15001 ç«¯å£ï¼Œè‡³æ­¤æˆåŠŸçš„æ‹¦æˆªäº†æµé‡æ‡‚å•Š Envoy &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain ISTIO_IN_REDIRECT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports &lt;span class=&#34;m&#34;&gt;15001&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ISTIO_OUTPUT é“¾ï¼šé€‰æ‹©éœ€è¦é‡å®šå‘åˆ° Envoyï¼ˆå³æœ¬åœ°ï¼‰ çš„å‡ºç«™æµé‡ï¼Œæ‰€æœ‰é localhost çš„æµé‡å…¨éƒ¨è½¬å‘åˆ° ISTIO_REDIRECTã€‚ä¸ºäº†é¿å…æµé‡åœ¨è¯¥ Pod ä¸­æ— é™å¾ªç¯ï¼Œæ‰€æœ‰åˆ° istio-proxy ç”¨æˆ·ç©ºé—´çš„æµé‡éƒ½è¿”å›åˆ°å®ƒçš„è°ƒç”¨ç‚¹ä¸­çš„ä¸‹ä¸€æ¡è§„åˆ™ï¼Œæœ¬ä¾‹ä¸­å³ OUTPUT é“¾ï¼Œå› ä¸ºè·³å‡º ISTIO_OUTPUT è§„åˆ™ä¹‹åå°±è¿›å…¥ä¸‹ä¸€æ¡é“¾ POSTROUTINGã€‚å¦‚æœç›®çš„åœ°é localhost å°±è·³è½¬åˆ° ISTIO_REDIRECTï¼›å¦‚æœæµé‡æ˜¯æ¥è‡ª istio-proxy ç”¨æˆ·ç©ºé—´çš„ï¼Œé‚£ä¹ˆå°±è·³å‡ºè¯¥é“¾ï¼Œè¿”å›å®ƒçš„è°ƒç”¨é“¾ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡è§„åˆ™ï¼ˆOUPT çš„ä¸‹ä¸€æ¡è§„åˆ™ï¼Œæ— éœ€å¯¹æµé‡è¿›è¡Œå¤„ç†ï¼‰ï¼›æ‰€æœ‰çš„é istio-proxy ç”¨æˆ·ç©ºé—´çš„ç›®çš„åœ°æ˜¯ localhost çš„æµé‡å°±è·³è½¬åˆ° ISTIO_REDIRECT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain ISTIO_OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; ISTIO_REDIRECT  all  --  any    lo      anywhere            !localhost
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;40&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2400&lt;/span&gt; RETURN     all  --  any    any     anywhere             anywhere             owner UID match istio-proxy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; RETURN     all  --  any    any     anywhere             anywhere             owner GID match istio-proxy	
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; RETURN     all  --  any    any     anywhere             localhost
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;3180&lt;/span&gt; ISTIO_REDIRECT  all  --  any    any     anywhere             anywhere
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ISTIO_REDIRECT é“¾ï¼šå°†æ‰€æœ‰æµé‡é‡å®šå‘åˆ° Envoyï¼ˆå³æœ¬åœ°ï¼‰ çš„ 15001 ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain ISTIO_REDIRECT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; pkts bytes target     prot opt in     out     &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;3180&lt;/span&gt; REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports &lt;span class=&#34;m&#34;&gt;15001&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;iptables&lt;/code&gt; æ˜¾ç¤ºçš„é“¾çš„é¡ºåºï¼Œå³æµé‡è§„åˆ™åŒ¹é…çš„é¡ºåºã€‚å…¶ä¸­è¦ç‰¹åˆ«æ³¨æ„ &lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; é“¾ä¸­çš„è§„åˆ™é…ç½®ã€‚ä¸ºäº†é¿å…æµé‡ä¸€ç›´åœ¨ Pod ä¸­æ— é™å¾ªç¯ï¼Œæ‰€æœ‰åˆ° istio-proxy ç”¨æˆ·ç©ºé—´çš„æµé‡éƒ½è¿”å›åˆ°å®ƒçš„è°ƒç”¨ç‚¹ä¸­çš„ä¸‹ä¸€æ¡è§„åˆ™ï¼Œæœ¬ä¾‹ä¸­å³ OUTPUT é“¾ï¼Œå› ä¸ºè·³å‡º &lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; è§„åˆ™ä¹‹åå°±è¿›å…¥ä¸‹ä¸€æ¡é“¾ &lt;code&gt;POSTROUTING&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ISTIO_OUTPUT&lt;/code&gt; é“¾è§„åˆ™åŒ¹é…çš„è¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœç›®çš„åœ°é localhost å°±è·³è½¬åˆ° ISTIO_REDIRECT é“¾&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰æ¥è‡ª istio-proxy ç”¨æˆ·ç©ºé—´çš„é localhost æµé‡è·³è½¬åˆ°å®ƒçš„è°ƒç”¨ç‚¹ &lt;code&gt;OUTPUT&lt;/code&gt; ç»§ç»­æ‰§è¡Œ &lt;code&gt;OUTPUT&lt;/code&gt; é“¾çš„ä¸‹ä¸€æ¡è§„åˆ™ï¼Œå› ä¸º &lt;code&gt;OUTPUT&lt;/code&gt; é“¾ä¸­æ²¡æœ‰ä¸‹ä¸€æ¡è§„åˆ™äº†ï¼Œæ‰€ä»¥ä¼šç»§ç»­æ‰§è¡Œ &lt;code&gt;POSTROUTING&lt;/code&gt; é“¾ç„¶åè·³å‡º iptablesï¼Œç›´æ¥è®¿é—®ç›®çš„åœ°&lt;/li&gt;
&lt;li&gt;å¦‚æœæµé‡ä¸æ˜¯æ¥è‡ª istio-proxy ç”¨æˆ·ç©ºé—´ï¼Œåˆæ˜¯å¯¹ localhost çš„è®¿é—®ï¼Œé‚£ä¹ˆå°±è·³å‡º iptablesï¼Œç›´æ¥è®¿é—®ç›®çš„åœ°&lt;/li&gt;
&lt;li&gt;å…¶å®ƒæ‰€æœ‰ d æƒ…å†µéƒ½è·³è½¬åˆ° &lt;code&gt;ISTIO_REDIRECT&lt;/code&gt; é“¾&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶å®åœ¨æœ€åè¿™æ¡è§„åˆ™å‰è¿˜å¯ä»¥å¢åŠ  IP åœ°å€è¿‡æ»¤ï¼Œè®©æŸäº› IP åœ°å€æ®µä¸é€šè¿‡ Envoy ä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-sidecar-iptables-æ³¨å…¥&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;istio sidecar iptables æ³¨å…¥&#34; srcset=&#34;
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/006tNbRwly1fv92uvxu4dj31320giq6u_hu0670e1998368153a679fbed1769a9b12_70760_b846e9969098e1cf2d42f8792d529357.webp 400w,
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/006tNbRwly1fv92uvxu4dj31320giq6u_hu0670e1998368153a679fbed1769a9b12_70760_68f68c3a2e5e2ed97d54530f3b293617.webp 760w,
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/006tNbRwly1fv92uvxu4dj31320giq6u_hu0670e1998368153a679fbed1769a9b12_70760_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/006tNbRwly1fv92uvxu4dj31320giq6u_hu0670e1998368153a679fbed1769a9b12_70760_b846e9969098e1cf2d42f8792d529357.webp&#34;
               width=&#34;760&#34;
               height=&#34;321&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      istio sidecar iptables æ³¨å…¥
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Š iptables è§„åˆ™éƒ½æ˜¯ Init å®¹å™¨å¯åŠ¨çš„æ—¶ä½¿ç”¨ &lt;a href=&#34;https://github.com/istio/istio/blob/master/tools/deb/istio-iptables.sh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;istio-iptables.sh&lt;/a&gt; è„šæœ¬ç”Ÿæˆçš„ï¼Œè¯¦ç»†è¿‡ç¨‹å¯ä»¥æŸ¥çœ‹è¯¥è„šæœ¬ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æŸ¥çœ‹-envoy-è¿è¡ŒçŠ¶æ€&#34;&gt;æŸ¥çœ‹ Envoy è¿è¡ŒçŠ¶æ€&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆæŸ¥çœ‹ &lt;code&gt;proxyv2&lt;/code&gt; é•œåƒçš„ &lt;a href=&#34;https://github.com/istio/istio/blob/master/pilot/docker/Dockerfile.proxyv2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Dockerfile&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-dockerfile&#34; data-lang=&#34;dockerfile&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; istionightly/base_debug&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ARG&lt;/span&gt; proxy_version&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ARG&lt;/span&gt; istio_version&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å®‰è£… Envoy&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ADD&lt;/span&gt; envoy /usr/local/bin/envoy&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ä½¿ç”¨ç¯å¢ƒå˜é‡çš„æ–¹å¼æ˜æ–‡æŒ‡å®š proxy çš„ç‰ˆæœ¬/åŠŸèƒ½&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ENV&lt;/span&gt; ISTIO_META_ISTIO_PROXY_VERSION &lt;span class=&#34;s2&#34;&gt;&amp;#34;1.1.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ä½¿ç”¨ç¯å¢ƒå˜é‡çš„æ–¹å¼æ˜æ–‡æŒ‡å®š proxy æ˜ç¡®çš„ shaï¼Œç”¨äºæŒ‡å®šç‰ˆæœ¬çš„é…ç½®å’Œè°ƒè¯•&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ENV&lt;/span&gt; ISTIO_META_ISTIO_PROXY_SHA &lt;span class=&#34;nv&#34;&gt;$proxy_version&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ç¯å¢ƒå˜é‡ï¼ŒæŒ‡å®šæ˜ç¡®çš„æ„å»ºå·ï¼Œç”¨äºè°ƒè¯•&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ENV&lt;/span&gt; ISTIO_META_ISTIO_VERSION &lt;span class=&#34;nv&#34;&gt;$istio_version&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ADD&lt;/span&gt; pilot-agent /usr/local/bin/pilot-agent&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ADD&lt;/span&gt; envoy_pilot.yaml.tmpl /etc/istio/proxy/envoy_pilot.yaml.tmpl&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ADD&lt;/span&gt; envoy_policy.yaml.tmpl /etc/istio/proxy/envoy_policy.yaml.tmpl&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ADD&lt;/span&gt; envoy_telemetry.yaml.tmpl /etc/istio/proxy/envoy_telemetry.yaml.tmpl&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ADD&lt;/span&gt; istio-iptables.sh /usr/local/bin/istio-iptables.sh&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; envoy_bootstrap_v2.json /var/lib/istio/envoy/envoy_bootstrap_tmpl.json&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RUN&lt;/span&gt; chmod &lt;span class=&#34;m&#34;&gt;755&lt;/span&gt; /usr/local/bin/envoy /usr/local/bin/pilot-agent&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å°† istio-proxy ç”¨æˆ·åŠ å…¥ sudo æƒé™ä»¥å…è®¸æ‰§è¡Œ tcpdump å’Œå…¶ä»–è°ƒè¯•å‘½ä»¤&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RUN&lt;/span&gt; useradd -m --uid &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; istio-proxy &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio-proxy ALL=NOPASSWD: ALL&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; /etc/sudoers &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    chown -R istio-proxy /var/lib/istio&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ä½¿ç”¨ pilot-agent æ¥å¯åŠ¨ Envoy&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ENTRYPOINT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/usr/local/bin/pilot-agent&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥å®¹å™¨çš„å¯åŠ¨å…¥å£æ˜¯ &lt;code&gt;pilot-agent&lt;/code&gt; å‘½ä»¤ï¼Œæ ¹æ® YAML é…ç½®ä¸­ä¼ é€’çš„å‚æ•°ï¼Œè¯¦ç»†çš„å¯åŠ¨å‘½ä»¤å…¥ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/local/bin/pilot-agent proxy sidecar --configPath /etc/istio/proxy --binaryPath /usr/local/bin/envoy --serviceCluster productpage --drainDuration 45s --parentShutdownDuration 1m0s --discoveryAddress istio-pilot.istio-system:15007 --discoveryRefreshDelay 1s --zipkinAddress zipkin.istio-system:9411 --connectTimeout 10s --statsdUdpAddress istio-statsd-prom-bridge.istio-system:9125 --proxyAdminPort &lt;span class=&#34;m&#34;&gt;15000&lt;/span&gt; --controlPlaneAuthPolicy NONE
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸»è¦é…ç½®äº† Envoy äºŒè¿›åˆ¶æ–‡ä»¶çš„ä½ç½®ã€æœåŠ¡å‘ç°åœ°å€ã€æœåŠ¡é›†ç¾¤åã€ç›‘æ§æŒ‡æ ‡ä¸ŠæŠ¥åœ°å€ã€Envoy çš„ç®¡ç†ç«¯å£ã€çƒ­é‡å¯æ—¶é—´ç­‰ï¼Œè¯¦ç»†ç”¨æ³•è¯·å‚è€ƒ &lt;a href=&#34;https://istio.io/docs/reference/commands/pilot-agent/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜æ–¹æ–‡æ¡£ pilot-agent çš„ç”¨æ³•&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;pilot-agent&lt;/code&gt; æ˜¯å®¹å™¨ä¸­ PID ä¸º 1 çš„å¯åŠ¨è¿›ç¨‹ï¼Œå®ƒå¯åŠ¨æ—¶åˆåˆ›å»ºäº†ä¸€ä¸ª Envoy è¿›ç¨‹ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/local/bin/envoy -c /etc/istio/proxy/envoy-rev0.json --restart-epoch &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; --drain-time-s &lt;span class=&#34;m&#34;&gt;45&lt;/span&gt; --parent-shutdown-time-s &lt;span class=&#34;m&#34;&gt;60&lt;/span&gt; --service-cluster productpage --service-node sidecar~172.33.78.10~productpage-v1-745ffc55b7-2l2lw.default~default.svc.cluster.local --max-obj-name-len &lt;span class=&#34;m&#34;&gt;189&lt;/span&gt; -l warn --v2-config-only
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬åˆ†åˆ«è§£é‡Šä¸‹ä»¥ä¸Šé…ç½®çš„æ„ä¹‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-c /etc/istio/proxy/envoy-rev0.json&lt;/code&gt;ï¼šé…ç½®æ–‡ä»¶ï¼Œæ”¯æŒ &lt;code&gt;.json&lt;/code&gt;ã€&lt;code&gt;.yaml&lt;/code&gt;ã€&lt;code&gt;.pb&lt;/code&gt; å’Œ &lt;code&gt;.pb_text&lt;/code&gt; æ ¼å¼ï¼Œ&lt;code&gt;pilot-agent&lt;/code&gt; å¯åŠ¨çš„æ—¶å€™è¯»å–äº†å®¹å™¨çš„ç¯å¢ƒå˜é‡ååˆ›å»ºçš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--restart-epoch 0&lt;/code&gt;ï¼šEnvoy çƒ­é‡å¯å‘¨æœŸï¼Œç¬¬ä¸€æ¬¡å¯åŠ¨é»˜è®¤ä¸º 0ï¼Œæ¯çƒ­é‡å¯ä¸€æ¬¡è¯¥å€¼åŠ  1ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--drain-time-s 45&lt;/code&gt;ï¼šçƒ­é‡å¯æœŸé—´ Envoy å°†è€—å°½è¿æ¥çš„æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--parent-shutdown-time-s 60&lt;/code&gt;ï¼šEnvoy åœ¨çƒ­é‡å¯æ—¶å…³é—­çˆ¶è¿›ç¨‹ä¹‹å‰ç­‰å¾…çš„æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--service-cluster productpage&lt;/code&gt;ï¼šEnvoy è¿è¡Œçš„æœ¬åœ°æœåŠ¡é›†ç¾¤çš„åå­—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--service-node sidecar~172.33.78.10~productpage-v1-745ffc55b7-2l2lw.default~default.svc.cluster.local&lt;/code&gt;ï¼šå®šä¹‰ Envoy è¿è¡Œçš„æœ¬åœ°æœåŠ¡èŠ‚ç‚¹åç§°ï¼Œå…¶ä¸­åŒ…å«äº†è¯¥ Pod çš„åç§°ã€IPã€DNS åŸŸç­‰ä¿¡æ¯ï¼Œæ ¹æ®å®¹å™¨çš„ç¯å¢ƒå˜é‡æ‹¼å‡ºæ¥çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-max-obj-name-len 189&lt;/code&gt;ï¼šcluster/route_config/listener ä¸­åç§°å­—æ®µçš„æœ€å¤§é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-l warn&lt;/code&gt;ï¼šæ—¥å¿—çº§åˆ«&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--v2-config-only&lt;/code&gt;ï¼šåªè§£æ v2 å¼•å¯¼é…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯¦ç»†é…ç½®è¯·å‚è€ƒ &lt;a href=&#34;http://www.servicemesher.com/envoy/operations/cli.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy çš„å‘½ä»¤è¡Œé€‰é¡¹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ Envoy çš„é…ç½®æ–‡ä»¶ &lt;code&gt;/etc/istio/proxy/envoy-rev0.json&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;node&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sidecar~172.33.78.10~productpage-v1-745ffc55b7-2l2lw.default~default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;INTERCEPTION_MODE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;REDIRECT&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;ISTIO_PROXY_SHA&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio-proxy:6166ae7ebac7f630206b2fe4e6767516bf198313&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;ISTIO_PROXY_VERSION&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;1.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;ISTIO_VERSION&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;1.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;POD_NAME&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage-v1-745ffc55b7-2l2lw&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;istio&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sidecar&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;stats_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;use_all_default_tags&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;admin&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;access_log_path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/dev/stdout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;dynamic_resources&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;lds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;ads&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;cds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;ads&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;ads_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GRPC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;refresh_delay&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;seconds&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;nanos&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc_services&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy_grpc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;xds-grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;static_resources&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;xds-grpc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;STRICT_DNS&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;seconds&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;nanos&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_policy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ROUND_ROBIN&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio-pilot.istio-system&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15010&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;circuit_breakers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;thresholds&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;priority&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_connections&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;100000&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_pending_requests&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;100000&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_requests&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;100000&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;priority&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;high&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_connections&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;100000&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_pending_requests&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;100000&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_requests&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;100000&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;upstream_connection_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;tcp_keepalive&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;keepalive_time&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;300&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;http2_protocol_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;zipkin&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;STRICT_DNS&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;seconds&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_policy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ROUND_ROBIN&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;zipkin.istio-system&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9411&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;tracing&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;http&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.zipkin&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;collector_cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;zipkin&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;stats_sinks&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.statsd&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.254.109.175&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9125&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹å›¾æ˜¯ä½¿ç”¨ Istio ç®¡ç†çš„ bookinfo ç¤ºä¾‹çš„è®¿é—®è¯·æ±‚è·¯å¾„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-bookinfo&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio bookinfo&#34; srcset=&#34;
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5df9lq1aj317o0o6wia_hu2fe4dd380b4d6a083f0d59c18e54988c_62576_7987b47cf7dfc4422044323337fa8015.webp 400w,
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5df9lq1aj317o0o6wia_hu2fe4dd380b4d6a083f0d59c18e54988c_62576_6113d1c54f3cecc3eafe1396dc71843d.webp 760w,
               /blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5df9lq1aj317o0o6wia_hu2fe4dd380b4d6a083f0d59c18e54988c_62576_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/0069RVTdgy1fv5df9lq1aj317o0o6wia_hu2fe4dd380b4d6a083f0d59c18e54988c_62576_7987b47cf7dfc4422044323337fa8015.webp&#34;
               width=&#34;760&#34;
               height=&#34;420&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio bookinfo
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ç‰‡æ¥è‡ª &lt;a href=&#34;https://istio.io/zh/docs/examples/bookinfo/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜æ–¹ç½‘ç«™&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¯¹ç…§ bookinfo ç¤ºä¾‹çš„ productpage çš„æŸ¥çœ‹å»ºç«‹çš„è¿æ¥ã€‚åœ¨ &lt;code&gt;productpage-v1-745ffc55b7-2l2lw&lt;/code&gt; Pod çš„ &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨ä¸­ä½¿ç”¨ root ç”¨æˆ·æŸ¥çœ‹æ‰“å¼€çš„ç«¯å£ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ lsof -i
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;COMMAND PID        USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy    &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; istio-proxy    9u  IPv4  &lt;span class=&#34;m&#34;&gt;73951&lt;/span&gt;      0t0  TCP localhost:15000 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;LISTEN&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# Envoy admin ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy    &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; istio-proxy   17u  IPv4  &lt;span class=&#34;m&#34;&gt;74320&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:46862-&amp;gt;istio-pilot.istio-system.svc.cluster.local:15010 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 15010ï¼šistio-pilot çš„ grcp-xds ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy    &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; istio-proxy   18u  IPv4  &lt;span class=&#34;m&#34;&gt;73986&lt;/span&gt;      0t0  UDP productpage-v1-745ffc55b7-2l2lw:44332-&amp;gt;istio-statsd-prom-bridge.istio-system.svc.cluster.local:9125 &lt;span class=&#34;c1&#34;&gt;# ç»™ Promethues å‘é€ metric çš„ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy    &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; istio-proxy   52u  IPv4  &lt;span class=&#34;m&#34;&gt;74599&lt;/span&gt;      0t0  TCP *:15001 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;LISTEN&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# Envoy çš„ç›‘å¬ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy    &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; istio-proxy   53u  IPv4  &lt;span class=&#34;m&#34;&gt;74600&lt;/span&gt;      0t0  UDP productpage-v1-745ffc55b7-2l2lw:48011-&amp;gt;istio-statsd-prom-bridge.istio-system.svc.cluster.local:9125 &lt;span class=&#34;c1&#34;&gt;# ç»™ Promethues å‘é€ metric ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy    &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; istio-proxy   54u  IPv4 &lt;span class=&#34;m&#34;&gt;338551&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:15001-&amp;gt;172.17.8.102:52670 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 52670ï¼šIngress gateway ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy    &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; istio-proxy   55u  IPv4 &lt;span class=&#34;m&#34;&gt;338364&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:44046-&amp;gt;172.33.78.9:9091 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 9091ï¼šistio-telemetry æœåŠ¡çš„ grpc-mixer ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy    &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; istio-proxy   56u  IPv4 &lt;span class=&#34;m&#34;&gt;338473&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:47210-&amp;gt;zipkin.istio-system.svc.cluster.local:9411 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 9411: zipkin ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy    &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; istio-proxy   58u  IPv4 &lt;span class=&#34;m&#34;&gt;338383&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:41564-&amp;gt;172.33.84.8:9080 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 9080ï¼šdetails-v1 çš„ http ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy    &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; istio-proxy   59u  IPv4 &lt;span class=&#34;m&#34;&gt;338390&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:54410-&amp;gt;172.33.78.5:9080 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 9080ï¼šreivews-v2 çš„ http ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy    &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; istio-proxy   60u  IPv4 &lt;span class=&#34;m&#34;&gt;338411&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:35200-&amp;gt;172.33.84.5:9091 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 9091:istio-telemetry æœåŠ¡çš„ grpc-mixer ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy    &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; istio-proxy   62u  IPv4 &lt;span class=&#34;m&#34;&gt;338497&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:34402-&amp;gt;172.33.84.9:9080 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# reviews-v1 çš„ http ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy    &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; istio-proxy   63u  IPv4 &lt;span class=&#34;m&#34;&gt;338525&lt;/span&gt;      0t0  TCP productpage-v1-745ffc55b7-2l2lw:50592-&amp;gt;172.33.71.5:9080 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ESTABLISHED&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# reviews-v3 çš„ http ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»è¾“å‡ºçº§è¿‡ä¸Šå¯ä»¥éªŒè¯ Sidecar æ˜¯å¦‚ä½•æ¥ç®¡æµé‡å’Œä¸ istio-pilot é€šä¿¡ï¼ŒåŠå‘ Mixer åšé¥æµ‹æ•°æ®æ±‡èšçš„ã€‚æ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å†å»çœ‹çœ‹å…¶ä»–å‡ ä¸ªæœåŠ¡çš„ istio-proxy å®¹å™¨ä¸­çš„ iptables å’Œç«¯å£ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;[SOFAMesh &amp;amp; SOFA MOSNâ€”åŸºäº Istio æ„å»ºçš„ç”¨äºåº”å¯¹å¤§è§„æ¨¡æµé‡çš„ Service Mesh è§£å†³æ–¹æ¡ˆ - jimmysong.io](&lt;a href=&#34;https://jimmysong.io/posts/sofamesh-and-mosn-proxy-sidecar-service-mesh-by-ant-financial/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://jimmysong.io/posts/sofamesh-and-mosn-proxy-sidecar-service-mesh-by-ant-financial/&lt;/a&gt; - jimmysong.io)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/concepts/init-containers.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Init å®¹å™¨ - Kubernetes ä¸­æ–‡æŒ‡å—/äº‘åŸç”Ÿåº”ç”¨æ¶æ„å®è·µæ‰‹å†Œ - jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/reference/kubectl/jsonpath/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;JSONPath Support - kubernetes.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wangchujiang.com/linux-command/c/iptables.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;iptables å‘½ä»¤ä½¿ç”¨è¯´æ˜ - wangchujiang.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.digitalocean.com/community/tutorials/how-to-list-and-delete-iptables-firewall-rules&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How To List and Delete Iptables Firewall Rules - digitalocean.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/fhefh/archive/2011/04/04/2005249.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€å¥ä¸€å¥è§£è¯´ iptables çš„è¯¦ç»†ä¸­æ–‡æ‰‹å†Œ - cnblog.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.aliang.org/Linux/iptables.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¸¸è§ iptables ä½¿ç”¨è§„åˆ™åœºæ™¯æ•´ç† - aliang.org&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Envoy æœåŠ¡ç½‘æ ¼åœ¨ Lyft çš„å®è·µåŠæœªæ¥è·¯çº¿å›¾</title>
      <link>https://cloudnative.to/blog/envoy-service-mesh-cascading-failure/</link>
      <pubDate>Sun, 02 Sep 2018 13:48:47 +0800</pubDate>
      <guid>https://cloudnative.to/blog/envoy-service-mesh-cascading-failure/</guid>
      <description>&lt;p&gt;















&lt;figure  id=&#34;figure-envoy-lyft&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy Lyft&#34; srcset=&#34;
               /blog/envoy-service-mesh-cascading-failure/006tNbRwgy1fuv5nathu3j318g0ii0uc_huaad6bee6af304cd99e0c3d8c26bcd3a5_23960_e1ddad31dabe285c97f0cafd74c37af8.webp 400w,
               /blog/envoy-service-mesh-cascading-failure/006tNbRwgy1fuv5nathu3j318g0ii0uc_huaad6bee6af304cd99e0c3d8c26bcd3a5_23960_d2a65a9018d7d0cc75c10c3b6f62ae89.webp 760w,
               /blog/envoy-service-mesh-cascading-failure/006tNbRwgy1fuv5nathu3j318g0ii0uc_huaad6bee6af304cd99e0c3d8c26bcd3a5_23960_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-service-mesh-cascading-failure/006tNbRwgy1fuv5nathu3j318g0ii0uc_huaad6bee6af304cd99e0c3d8c26bcd3a5_23960_e1ddad31dabe285c97f0cafd74c37af8.webp&#34;
               width=&#34;760&#34;
               height=&#34;316&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy Lyft
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://www.infoq.com/articles/envoy-service-mesh-cascading-failure&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³é”®è¦ç‚¹&#34;&gt;å…³é”®è¦ç‚¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨è¿‡å»çš„å››å¹´ä¸­ï¼ŒLyft å·²ä»å•ä½“æ¶æ„è½¬å˜ä¸ºæ•°ç™¾ä¸ªå¾®æœåŠ¡ã€‚éšç€å¾®æœåŠ¡æ•°é‡çš„å¢åŠ ï¼Œç”±äºçº§è”æ•…éšœæˆ–æ„å¤–å†…éƒ¨æ‹’ç»æœåŠ¡å¯¼è‡´çš„ä¸­æ–­æ¬¡æ•°ä¹Ÿåœ¨å¢åŠ ã€‚&lt;/li&gt;
&lt;li&gt;ä»Šå¤©ï¼Œè¿™äº›æ•…éšœæƒ…å†µåœ¨ Lyft åŸºç¡€è®¾æ–½ä¸­å·²ç»åŸºæœ¬è§£å†³ã€‚Lyft éƒ¨ç½²çš„æ¯é¡¹æœåŠ¡éƒ½é€šè¿‡ä½¿ç”¨ Envoy ä»£ç†è‡ªåŠ¨è·å¾—ååé‡å’Œå¹¶å‘ä¿æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;Envoy å¯ä»¥ä½œä¸ºä¸­é—´ä»¶éƒ¨ç½²æˆ–ä»…åœ¨è¯·æ±‚å…¥å£å¤„éƒ¨ç½²ï¼Œä½†æœ€å¤§çš„å¥½å¤„æ¥è‡ªäºåœ¨åº”ç”¨ç¨‹åºæœ¬åœ°çš„å…¥å£å’Œå‡ºå£éƒ¨ç½²å®ƒã€‚åœ¨è¯·æ±‚çš„ä¸¤ç«¯éƒ¨ç½² Envoy å…è®¸å®ƒå……å½“æœåŠ¡å™¨çš„æ™ºèƒ½å®¢æˆ·ç«¯å’Œåå‘ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªæœˆé‡Œï¼ŒLyft å°†ä¸ Netflix çš„å¹¶å‘é™åˆ¶åº“èƒŒåçš„å›¢é˜Ÿåˆä½œï¼Œå°†åŸºäºå…¶åº“çš„ç³»ç»Ÿå¸¦å…¥ Envoy L7 è¿‡æ»¤å™¨ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çº§è”æ•…éšœæ˜¯é«˜ååé‡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸å¯ç”¨çš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚åœ¨è¿‡å»çš„å››å¹´ä¸­ï¼ŒLyft å·²ä»å•ä½“æ¶æ„è½¬å˜ä¸ºæ•°ç™¾ç§å¾®æœåŠ¡ã€‚éšç€å¾®æœåŠ¡æ•°é‡çš„å¢åŠ ï¼Œç”±äºçº§è”æ•…éšœæˆ–æ„å¤–å†…éƒ¨æ‹’ç»æœåŠ¡å¯¼è‡´çš„ä¸­æ–­æ¬¡æ•°ä¹Ÿåœ¨å¢åŠ ã€‚ä»Šå¤©ï¼Œè¿™äº›æ•…éšœæƒ…å†µåœ¨ Lyft åŸºç¡€è®¾æ–½ä¸­åŸºæœ¬ä¸Šå·²ç»è§£å†³ã€‚Lyft éƒ¨ç½²çš„æ¯é¡¹æœåŠ¡éƒ½ä¼šè‡ªåŠ¨è·å¾—ååé‡å’Œå¹¶å‘ä¿æŠ¤ã€‚é€šè¿‡å¯¹æˆ‘ä»¬æœ€å…³é”®çš„æœåŠ¡è¿›è¡Œä¸€äº›æœ‰é’ˆå¯¹æ€§çš„é…ç½®æ›´æ”¹ï¼ŒåŸºäºè´Ÿè½½çš„äº‹ä»¶å‡å°‘äº† 95ï¼…ï¼Œä»è€Œå½±å“äº†ç”¨æˆ·ä½“éªŒã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬æ£€æŸ¥ç‰¹å®šçš„æ•…éšœæƒ…å†µå’Œç›¸åº”çš„ä¿æŠ¤æœºåˆ¶ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆäº†è§£å¦‚ä½•åœ¨ Lyft éƒ¨ç½²ç½‘ç»œé˜²å¾¡ã€‚&lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt; æ˜¯ä¸€ä¸ª &lt;a href=&#34;https://eng.lyft.com/announcing-envoy-c-l7-proxy-and-communication-bus-92520b6c8191&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æºè‡ª Lyft&lt;/a&gt; çš„ä»£ç†ï¼Œåæ¥å¼€æºå¹¶æèµ ç»™ &lt;a href=&#34;https://www.cncf.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cloud Native Computing Foundation&lt;/a&gt; ã€‚Envoy ä¸è®¸å¤šå…¶ä»–è´Ÿè½½å‡è¡¡è§£å†³æ–¹æ¡ˆçš„åŒºåˆ«åœ¨äºå®ƒè¢«è®¾è®¡ä¸ºä»¥â€œç½‘æ ¼â€é…ç½®éƒ¨ç½²ã€‚Envoy å¯ä»¥ä½œä¸ºä¸­é—´ä»¶éƒ¨ç½²æˆ–ä»…åœ¨è¯·æ±‚å…¥å£æ—¶éƒ¨ç½²ï¼Œä½†æœ€å¤§çš„å¥½å¤„æ¥è‡ªäºåœ¨åº”ç”¨ç¨‹åºæœ¬åœ°çš„å…¥å£å’Œå‡ºå£éƒ¨ç½²å®ƒã€‚åœ¨è¯·æ±‚çš„ä¸¤ç«¯éƒ¨ç½² Envoy å…è®¸å®ƒå……å½“æœåŠ¡å™¨çš„æ™ºèƒ½å®¢æˆ·ç«¯å’Œåå‘ä»£ç†ã€‚åœ¨åŒæ–¹ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©é‡‡ç”¨é€Ÿç‡é™åˆ¶å’Œæ–­è·¯æ¥ä¿æŠ¤æœåŠ¡å™¨å…å—å„ç§æƒ…å†µä¸‹çš„è¿‡è½½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ ¸å¿ƒæ¦‚å¿µ&#34;&gt;æ ¸å¿ƒæ¦‚å¿µ&lt;/h2&gt;
&lt;h3 id=&#34;å¹¶å‘å’Œé€Ÿç‡é™åˆ¶&#34;&gt;å¹¶å‘å’Œé€Ÿç‡é™åˆ¶&lt;/h3&gt;
&lt;p&gt;å¹¶å‘å’Œé€Ÿç‡é™åˆ¶æ˜¯ç›¸å…³çš„ï¼Œä½†ä¸åŒçš„æ¦‚å¿µ; åŒä¸€æšç¡¬å¸çš„ä¸¤é¢ã€‚åœ¨è€ƒè™‘é™åˆ¶ç³»ç»Ÿè´Ÿè½½æ—¶ï¼Œè¿ç»´äººå‘˜ä¼ ç»Ÿä¸Šä¼šè€ƒè™‘æ¯ç§’çš„è¯·æ±‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;é€Ÿç‡é™åˆ¶å¯ä»¥é™åˆ¶å‘é€åˆ°ç³»ç»Ÿçš„è¯·æ±‚çš„é€Ÿç‡ã€‚é€šå¸¸è¿›è¡Œå‹åŠ›æµ‹è¯•ä»¥ç¡®å®šæœåŠ¡å°†å˜ä¸ºè¿‡è½½çš„è¯·æ±‚ç‡ï¼Œç„¶åå°†é™åˆ¶è®¾ç½®åœ¨ä½äºè¯¥ç‚¹çš„æŸå¤„ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸šåŠ¡é€»è¾‘å†³å®šäº†é€Ÿç‡é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç¡¬å¸çš„å¦ä¸€é¢ï¼Œæˆ‘ä»¬æœ‰å¹¶å‘æ€§ï¼Œå³åŒæ—¶ä½¿ç”¨å¤šå°‘ä¸ªå•å…ƒã€‚è¿™äº›å•ä½å¯ä»¥æ˜¯è¯·æ±‚ã€è¿æ¥ç­‰ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘æŸä¸ªæ—¶é—´ç‚¹çš„å¹¶å‘è¯·æ±‚æ•°ï¼Œè€Œä¸æ˜¯è€ƒè™‘è¯·æ±‚ç‡ã€‚å½“æˆ‘ä»¬è€ƒè™‘å¹¶å‘è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åº”ç”¨æ’é˜Ÿç†è®ºæ¥ç¡®å®šæœåŠ¡åœ¨é˜Ÿåˆ—å¼€å§‹æ„å»ºä¹‹å‰å¯ä»¥å¤„ç†çš„å¹¶å‘è¯·æ±‚æ•°ã€è¯·æ±‚å»¶è¿Ÿå¢åŠ ä»¥åŠæœåŠ¡å› èµ„æºè€—å°½è€Œå¤±è´¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…¨å±€ä¸æœ¬åœ°å†³ç­–&#34;&gt;å…¨å±€ä¸æœ¬åœ°å†³ç­–&lt;/h3&gt;
&lt;p&gt;Envoy ä¸­çš„æ–­è·¯å™¨æ˜¯æ ¹æ®æœ¬æœºä¿¡æ¯è®¡ç®—çš„ã€‚æ¯ä¸ª Envoy å®ä¾‹éƒ½ä¼šè·Ÿè¸ªè‡ªå·±çš„ç»Ÿè®¡æ•°æ®å¹¶åˆ¶å®šè‡ªå·±çš„æ–­è·¯å†³ç­–ã€‚ä¸å…¨å±€ç³»ç»Ÿç›¸æ¯”ï¼Œè¯¥æ¨¡å‹å…·æœ‰ä¸€äº›ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªä¼˜åŠ¿æ˜¯å¯ä»¥åœ¨å†…å­˜ä¸­è®¡ç®—é™åˆ¶ï¼Œè€Œæ— éœ€å¯¹ä¸­å¤®ç³»ç»Ÿè¿›è¡Œç½‘ç»œè°ƒç”¨ã€‚ç¬¬äºŒä¸ªæ˜¯é™åˆ¶ä¼šéšç€é›†ç¾¤çš„å¤§å°è€Œæ‰©å±•ã€‚ç¬¬ä¸‰ï¼Œé™åˆ¶è€ƒè™‘äº†æœºå™¨ä¹‹é—´çš„å·®å¼‚ï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦æ”¶åˆ°ä¸åŒçš„æŸ¥è¯¢ç»„åˆæˆ–è€…åœ¨æ€§èƒ½ä¸Šçš„å·®å¼‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¸¸è§çš„æ•…éšœæƒ…å†µ&#34;&gt;å¸¸è§çš„æ•…éšœæƒ…å†µ&lt;/h3&gt;
&lt;p&gt;åœ¨å¼•å…¥é˜²å¾¡æœºåˆ¶ä¹‹å‰ï¼Œäº†è§£ä¸€äº›å¸¸è§çš„æ•…éšœæ¨¡å¼æ˜¯æœ‰å¸®åŠ©çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é‡è¯•æ”¾å¤§&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¾èµ–å¼€å§‹å¤±è´¥ã€‚å¦‚æœæœåŠ¡æ‰§è¡Œä¸€æ¬¡é‡è¯•æ‰€æœ‰å¯¹è¯¥ä¾èµ–é¡¹çš„è¯·æ±‚ï¼Œåˆ™æ•´ä¸ªè°ƒç”¨é‡å°†åŠ å€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºåŒ®ä¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªæœåŠ¡éƒ½å—æŸäº›èµ„æºçº¦æŸï¼Œé€šå¸¸æ˜¯ CPUã€ç½‘ç»œæˆ–å†…å­˜ã€‚å¹¶å‘è¯·æ±‚é€šå¸¸ä¸æ¶ˆè€—çš„èµ„æºé‡ç›´æ¥ç›¸å…³ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä»èµ„æºåŒ®ä¹ä¸­æ¢å¤è¿‡æ¥&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å³ä½¿èµ„æºæ¶ˆè€—å¢åŠ çš„åŸå› é™ä½åˆ°æ­£å¸¸æ°´å¹³ï¼ŒæœåŠ¡ä¹Ÿå¯èƒ½å› èµ„æºäº‰ç”¨è€Œæ— æ³•æ¢å¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åç«¯å‡é€Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¾èµ–é¡¹ï¼ˆæ•°æ®åº“æˆ–å…¶ä»–æœåŠ¡ï¼‰é€Ÿåº¦å˜æ…¢ï¼Œå¯¼è‡´æœåŠ¡èŠ±è´¹æ›´é•¿æ—¶é—´æ¥å®Œæˆè¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;çˆ†å‘å’Œæ¬ é‡‡æ ·&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è¿›è¡Œé«˜çº§å®¹é‡è§„åˆ’æˆ–å¼¹æ€§æ‰©å±•æœåŠ¡æ—¶ï¼Œé€šå¸¸çš„åšæ³•æ˜¯è€ƒè™‘æ•´ä¸ªé›†ç¾¤ä¸­æ¶ˆè€—çš„å¹³å‡èµ„æºã€‚ä½†æ˜¯ï¼ŒæœåŠ¡çš„è°ƒç”¨è€…å¯ä»¥é€‰æ‹©åŒæ—¶å‘é€å¤§é‡è¯·æ±‚ã€‚è¿™å¯èƒ½ä¼šæš‚æ—¶ä½¿å•ä¸ªæœåŠ¡å™¨é¥±å’Œã€‚æ”¶é›†æŒ‡æ ‡æ—¶ï¼Œæ¯åˆ†é’Ÿæˆ–æ›´é«˜çš„æ•°æ®å‡ ä¹è‚¯å®šä¼šæ©ç›–è¿™äº›çˆ†å‘ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç°åœ¨-lyft-çš„ä¸€å¤©&#34;&gt;ç°åœ¨ Lyft çš„ä¸€å¤©&lt;/h2&gt;
&lt;h3 id=&#34;æˆ‘ä»¬å¦‚ä½•é™åˆ¶é€Ÿç‡&#34;&gt;æˆ‘ä»¬å¦‚ä½•é™åˆ¶é€Ÿç‡ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/lyft/ratelimit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;lyft/ratelimit&lt;/a&gt; Â æ˜¯ä¸€ç§å¼€æº Go/gRPC æœåŠ¡ï¼Œæ—¨åœ¨ä¸ºå„ç§åº”ç”¨ç¨‹åºå¯ç”¨é€šç”¨é€Ÿç‡é™åˆ¶æ–¹æ¡ˆã€‚
é€Ÿç‡é™åˆ¶é€‚ç”¨äºåŸŸã€‚åŸŸçš„ç¤ºä¾‹å¯ä»¥æ˜¯æ¯ IP é€Ÿç‡é™åˆ¶ï¼Œæˆ–æ¯ç§’å¯¹æ•°æ®åº“çš„è¿æ¥æ•°ã€‚Ratelimit åœ¨ Lyft æŠ•å…¥ç”Ÿäº§ï¼Œæ¯ç§’å¤„ç†æ•°åä¸‡ä¸ªé€Ÿç‡é™åˆ¶è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨è¾¹ç¼˜ä»£ç†å’Œå†…éƒ¨æœåŠ¡ç½‘æ ¼ä¸­ä½¿ç”¨ Ratelimitã€‚&lt;/p&gt;
&lt;p&gt;å¼€æºæœåŠ¡æ˜¯ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/global_rate_limiting#arch-overview-rate-limit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy é€Ÿç‡é™åˆ¶ API&lt;/a&gt; çš„å‚è€ƒå®ç°ã€‚Envoy æä¾›ä»¥ä¸‹é›†æˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œçº§åˆ«é€Ÿç‡é™åˆ¶è¿‡æ»¤å™¨&lt;/strong&gt; ï¼šEnvoy å¯ä»¥ä¸ºå®‰è£…è¿‡æ»¤å™¨çš„ä¾¦å¬å™¨ä¸Šçš„æ¯ä¸ªæ–°è¿æ¥è°ƒç”¨é€Ÿç‡é™åˆ¶æœåŠ¡ã€‚é…ç½®æŒ‡å®šç‰¹å®šåŸŸå’Œæè¿°ç¬¦è®¾ç½®ä¸ºé€Ÿç‡é™åˆ¶ã€‚è¿™å…·æœ‰é™åˆ¶æ¯ç§’é€šè¿‡æ”¶å¬è€…çš„è¿æ¥çš„é€Ÿç‡çš„æœ€ç»ˆæ•ˆæœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HTTP çº§åˆ«é€Ÿç‡é™åˆ¶è¿‡æ»¤å™¨&lt;/strong&gt; ï¼šEnvoy å¯ä»¥ä¸ºå®‰è£…è¿‡æ»¤å™¨çš„ä¾¦å¬å™¨ä¸Šçš„æ¯ä¸ªæ–°è¯·æ±‚è°ƒç”¨é€Ÿç‡é™åˆ¶æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨ Lyftï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨é€Ÿç‡é™åˆ¶æ¥æŠµå¾¡åŸºç¡€è®¾æ–½è¾¹ç¼˜çš„è´Ÿè½½ã€‚ä¾‹å¦‚ï¼Œæ¯ä¸ªç”¨æˆ· ID å…è®¸çš„è¯·æ±‚ç‡ã€‚è¿™æ ·å¯ä»¥ä¿æŠ¤ Lyft çš„æœåŠ¡ å…å—å¤–éƒ¨å®¢æˆ·ç«¯æ„å¤–æˆ–æ¶æ„è´Ÿè½½é€ æˆçš„ èµ„æºåŒ®ä¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç›‘æ§&#34;&gt;ç›‘æ§&lt;/h3&gt;
&lt;p&gt;Lyft çš„ç½‘ç»œå›¢é˜Ÿä¸ºæ‰€æœ‰é…ç½®çš„é€Ÿç‡é™åˆ¶æä¾›æŒ‡æ ‡ã€‚å½“æœåŠ¡æ‰€æœ‰è€…åˆ›å»ºæ–°çš„é€Ÿç‡é™åˆ¶ä»¥åœ¨è¾¹ç¼˜ã€æœåŠ¡ä¹‹é—´æˆ–æ•°æ®åº“ä¸­å¼ºåˆ¶æ‰§è¡Œæ—¶ï¼Œå¯ä»¥ç«‹å³æ”¶é›†ä¸é˜²å¾¡æœºåˆ¶æœ‰å…³çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furr8zvymaj20h4029wf0_hu3194088a86c675cdecb5510ea402edbb_13739_f88d44a7f4c09833a1081eca1f7cab01.webp 400w,
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furr8zvymaj20h4029wf0_hu3194088a86c675cdecb5510ea402edbb_13739_0c709b3451b0de175b8c81f2ed8e5d73.webp 760w,
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furr8zvymaj20h4029wf0_hu3194088a86c675cdecb5510ea402edbb_13739_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-service-mesh-cascading-failure/61411417ly1furr8zvymaj20h4029wf0_hu3194088a86c675cdecb5510ea402edbb_13739_f88d44a7f4c09833a1081eca1f7cab01.webp&#34;
               width=&#34;616&#34;
               height=&#34;81&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ˜¯ ratelimit æœåŠ¡ä»ªè¡¨æ¿çš„ä¸€ä¸ªç‰‡æ®µï¼Œå…¶ä¸­æ˜¾ç¤ºäº†ä¸‰ä¸ªé¢æ¿ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ¯åˆ†é’Ÿæ€»å‘½ä¸­æ•°&lt;/strong&gt; ï¼šæ­¤é¢æ¿æ˜¾ç¤ºæ—¶é—´åºåˆ—ï¼Œå…¶ä¸­é…ç½®äº†æ¯ä¸ªé€Ÿç‡é™åˆ¶çš„æ€»å‘½ä¸­æ•°ã€‚åœ¨æ­¤é¢æ¿ä¸­ï¼ŒæœåŠ¡æ‰€æœ‰è€…å¯ä»¥éšæ—¶æŸ¥çœ‹è¶‹åŠ¿ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¯åˆ†é’Ÿè¶…é™&lt;/strong&gt; ï¼šæ­¤é¢æ¿æ˜¾ç¤ºè¶…å‡ºé…ç½®é™åˆ¶çš„æŒ‡æ ‡ã€‚è¯¥é¢æ¿å…è®¸æœåŠ¡æ‰€æœ‰è€…æ‹¥æœ‰å¯é‡åŒ–çš„æ•°æ®ï¼Œç”¨äºè¿”å›å…¶æœåŠ¡å¹¶è¯„ä¼°è°ƒç”¨æ¨¡å¼ï¼Œå¹¶ä¸ºé«˜è´Ÿè½½äº‹ä»¶è¿›è¡Œå®¹é‡è§„åˆ’ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¯åˆ†é’Ÿæ¥è¿‘é™åˆ¶&lt;/strong&gt; ï¼šæ­¤é¢æ¿æ˜¾ç¤ºæŒ‡æ ‡ä½•æ—¶è¾¾åˆ°é…ç½®é™åˆ¶çš„ 80ï¼…ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æˆ‘ä»¬å¦‚ä½•ç®¡ç†å¹¶å‘&#34;&gt;æˆ‘ä»¬å¦‚ä½•ç®¡ç†å¹¶å‘ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Envoy çš„ä¸»è¦ä¼˜ç‚¹ä¹‹ä¸€æ˜¯å®ƒé€šè¿‡&lt;strong&gt;ç½‘ç»œçº§åˆ«&lt;/strong&gt;çš„æ–­è·¯ç³»ç»Ÿå¼ºåˆ¶æ‰§è¡Œå¹¶å‘é™åˆ¶ï¼Œè€Œä¸å¿…ç‹¬ç«‹åœ°åœ¨æ¯ä¸ªåº”ç”¨ç¨‹åºä¸­é…ç½®å’Œå®ç°è¿™äº›æ¨¡å¼ã€‚Envoy æ”¯æŒå„ç§ç±»å‹çš„å…¨åˆ†å¸ƒå¼æ–­è·¯å™¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æœ€å¤§è¿æ¥&lt;/strong&gt; æ•°ï¼šEnvoy å°†ä¸ºä¸Šæ¸¸é›†ç¾¤ä¸­çš„æ‰€æœ‰ä¸»æœºå»ºç«‹çš„&lt;strong&gt;æœ€å¤§è¿æ¥&lt;/strong&gt; æ•°ã€‚å®é™…ä¸Šï¼Œè¿™é€šå¸¸ç”¨äºä¿æŠ¤ HTTP/1 é›†ç¾¤ï¼Œå› ä¸º HTTP/2 å¯ä»¥é€šè¿‡å•ä¸ªè¿æ¥å¤ç”¨è¯·æ±‚ï¼Œå› æ­¤é™åˆ¶äº†å‡é€ŸæœŸé—´çš„è¿æ¥å¢é•¿ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€å¤§æŒ‚èµ·è¯·æ±‚æ•°&lt;/strong&gt; ï¼šç­‰å¾…æ± ä¸­å¯ç”¨è¿æ¥æ—¶å°†æ’é˜Ÿçš„æœ€å¤§è¯·æ±‚æ•°ã€‚å®é™…ä¸Šï¼Œè¿™ä»…é€‚ç”¨äº HTTP/1é›†ç¾¤ï¼Œå› ä¸º HTTP/2 è¿æ¥æ± ä»ä¸å¯¹è¯·æ±‚è¿›è¡Œæ’é˜Ÿã€‚HTTP/2 è¯·æ±‚ç«‹å³è¢«å¤šè·¯å¤ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€å¤§è¯·æ±‚æ•°&lt;/strong&gt; ï¼šåœ¨ä»»ä½•ç»™å®šæ—¶é—´ï¼Œé›†ç¾¤ä¸­æ‰€æœ‰ä¸»æœºå¯èƒ½æœªå®Œæˆçš„&lt;strong&gt;æœ€å¤§è¯·æ±‚&lt;/strong&gt; æ•°ã€‚å®é™…ä¸Šï¼Œè¿™ä¸»è¦ç”¨äº HTTP/2ï¼Œå› ä¸º HTTP/1 é€šå¸¸æ¯ä¸ªè¿æ¥æœ‰ä¸€ä¸ªè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€å¤§æ´»åŠ¨é‡è¯•æ¬¡æ•°&lt;/strong&gt; ï¼šåœ¨ä»»ä½•ç»™å®šæ—¶é—´ï¼Œé›†ç¾¤ä¸­æ‰€æœ‰ä¸»æœºå¯ä»¥æ‰§è¡Œçš„æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å»ºè®®ç§¯æåœ°è¿›è¡Œæ–­è·¯é‡è¯•ï¼Œä»¥ä¾¿å…è®¸é‡è¯•æ•…éšœï¼Œä½†æ•´ä½“é‡è¯•é‡ä¸ä¼šçˆ†ç‚¸å¹¶å¯¼è‡´å¤§è§„æ¨¡çº§è”æ•…éšœã€‚æ­¤è®¾ç½®å¯é˜²æ­¢é‡è¯•æ”¾å¤§ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨ Lyftï¼Œæˆ‘ä»¬ä¸“æ³¨äºä¸¤ç§ç®¡ç†æœåŠ¡ç½‘æ ¼ä¸­å¹¶å‘æ€§çš„æœºåˆ¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é™åˆ¶å…¥å£å±‚çš„å¹¶å‘è¿æ¥æ•°&lt;/strong&gt; ã€‚é‰´äº Lyft çš„æ¯é¡¹æœåŠ¡éƒ½è¿è¡Œä¸€ä¸ª Envoy sidecar æ¥ç®¡ç†è¿›å…¥æœåŠ¡çš„å…¥å£è¯·æ±‚ï¼ˆå…¥å£ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½® sidecar å¯¹åº”ç”¨ç¨‹åºçš„å¹¶å‘è¿æ¥æ•°ï¼Œä»è€Œé™åˆ¶å…¥å£å¹¶å‘è¿›å…¥åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬æä¾›åˆç†çš„å€¼ä½œä¸ºé»˜è®¤å€¼ï¼Œä½†é¼“åŠ±æœåŠ¡æ‰€æœ‰è€…åˆ†æå…¶å¹¶å‘æ¨¡å¼å¹¶æ”¶ç´§è®¾ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é™åˆ¶å‡ºå£å±‚çš„å¹¶å‘è¯·æ±‚æ•°&lt;/strong&gt; ã€‚è¿è¡Œ sidecar æ¥ç®¡ç†æ¥è‡ªæœåŠ¡çš„å‡ºå£æµé‡çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ç®¡ç†ä»æœåŠ¡ï¼ˆå‡ºå£ï¼‰åˆ° Lyft çš„ä»»ä½•å…¶ä»–æœåŠ¡çš„ä¼ å‡ºå¹¶å‘è¯·æ±‚ã€‚è¿™æ„å‘³ç€â€œä½ç½®â€æœåŠ¡çš„æ‰€æœ‰è€…å¯ä»¥æœ‰é€‰æ‹©åœ°é…ç½®ä»–ä»¬æƒ³è¦æ”¯æŒ Lyft çš„æ¯ä¸ªå…¶ä»–æœåŠ¡çš„å¹¶å‘çº§åˆ«ï¼Œä¾‹å¦‚ï¼Œä»–ä»¬å¯ä»¥å†³å®šå¹¶é…ç½®â€œæ¸¸ä¹è®¾æ–½â€æœåŠ¡å¯ä»¥å‘â€œä½ç½®â€å‘å‡º 100 ä¸ªå¹¶å‘è¯·æ±‚â€œï¼Œä½†â€ç”¨æˆ·â€œæœåŠ¡åªèƒ½å‘â€ä½ç½®â€œå‘å‡º 50 ä¸ªå¹¶å‘è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯¹ Lyft çš„æ¯ä¸ªæœåŠ¡çš„å‡ºå£å’Œå…¥å£è¿è¡Œå¹¶å‘é™åˆ¶çš„ä¸€ä¸ªæœ‰è¶£ç»“æœæ˜¯ï¼Œæ›´å®¹æ˜“è·Ÿè¸ªä¸éœ€è¦çš„è¡Œä¸ºã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œæ‰€è§çš„å¸¸è§æ•…éšœæƒ…å½¢æ˜¯çªå‘æ€§ï¼Œ Â ç”±äºåº¦é‡åˆ†è¾¨ç‡è€Œå¯èƒ½ &lt;a href=&#34;https://docs.google.com/document/d/1qeHbXa5DULJMeSwMZIddrM0It3xVI5MwdyoH-8kU9K8/edit?disco=AAAACERmNZQ&amp;amp;ts=5b4fd7d3#heading=h.kctltbvispjy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éš¾ä»¥è¯Šæ–­&lt;/a&gt; ã€‚å‡ºå£å’Œå…¥å£çš„å¹¶å‘é™åˆ¶å¯ä»¥é€šè¿‡æŸ¥çœ‹è¯·æ±‚è·¯å¾„ä¸­å¹¶å‘æº¢å‡ºçš„ä½ç½®ï¼Œå¯ä»¥è½»æ¾æŸ¥æ˜æ•´ä¸ªç³»ç»Ÿçš„çªå‘è¡Œä¸ºã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç›‘æ§-1&#34;&gt;ç›‘æ§&lt;/h3&gt;
&lt;p&gt;æ­£å¦‚æˆ‘ä»¬æ‰€æåˆ°çš„ï¼Œå¹¶å‘å¹¶ä¸æ€»æ˜¯ä¸€ä¸ªç›´è§‚çš„æ¦‚å¿µã€‚ä¸ºäº†å¢å¼ºå¯è§‚å¯Ÿæ€§ï¼Œç½‘ç»œå›¢é˜Ÿæä¾›äº†ä¸åŒçš„å¯è§†åŒ–ï¼Œä»¥ä¾¿æœåŠ¡æ‰€æœ‰è€…å¯ä»¥é…ç½®å…¶å¹¶å‘é™åˆ¶ï¼Œç„¶åç›‘æ§è¿™äº›é™åˆ¶å¦‚ä½•å½±å“ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;h4 id=&#34;è®¾ç½®é™åˆ¶&#34;&gt;&lt;strong&gt;è®¾ç½®é™åˆ¶&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furr903c8uj20go03l764_huc82e39fdbac6205d1fa336eac1971eb6_24361_aa8062004ee2344d04d9f25f9fe9e70d.webp 400w,
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furr903c8uj20go03l764_huc82e39fdbac6205d1fa336eac1971eb6_24361_f9986e00b7dbaa5616ecf97c923599cd.webp 760w,
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furr903c8uj20go03l764_huc82e39fdbac6205d1fa336eac1971eb6_24361_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-service-mesh-cascading-failure/61411417ly1furr903c8uj20go03l764_huc82e39fdbac6205d1fa336eac1971eb6_24361_aa8062004ee2344d04d9f25f9fe9e70d.webp&#34;
               width=&#34;600&#34;
               height=&#34;129&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šé¢çš„ä»ªè¡¨æ¿æ˜¯ä¸€ä¸ªäº¤äº’å¼ä»ªè¡¨æ¿ï¼ŒæœåŠ¡æ‰€æœ‰è€…å¯ä»¥å¯¹ Lyft çš„æ‰€æœ‰æœåŠ¡å…è®¸çš„æœ€å¤§å¹¶å‘è¯·æ±‚æ•°é‡è¿›è¡Œè¯•éªŒï¼Œä»¥æ»¡è¶³å…¶ç‰¹å®šæœåŠ¡ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œâ€œä½ç½®â€æœåŠ¡çš„æ‰€æœ‰è€…å¯ä»¥çœ‹åˆ°ï¼Œé™¤â€œviewportâ€æœåŠ¡ä¹‹å¤–ï¼Œå¤§å¤šæ•°è°ƒç”¨æœåŠ¡çš„ 60 ä¸ªå¹¶å‘è¯·æ±‚çš„é™åˆ¶å°±è¶³å¤Ÿäº†ã€‚ä½¿ç”¨æ­¤ä»ªè¡¨æ¿ï¼ŒæœåŠ¡æ‰€æœ‰è€…å¯ä»¥æŸ¥çœ‹å¹¶å‘é…ç½®ä¸­çš„é€‰æ‹©æ€§æ›´æ”¹åœ¨å½“å‰ç½‘ç»œæ‹“æ‰‘ä¸­çš„å¤–è§‚ï¼Œå¹¶å¯ä»¥æ”¾å¿ƒåœ°è¿›è¡Œè¿™äº›æ›´æ”¹ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç›‘æ§é™åˆ¶&#34;&gt;&lt;strong&gt;ç›‘æ§é™åˆ¶&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;å¦‚ä¸Šæ‰€è¿°ï¼Œè®© Envoy ä½œä¸ºä¸€ä¸ª sidecar è¿è¡Œï¼Œå¤„ç†æ¥è‡ªæ¯ä¸ªæœåŠ¡çš„å…¥å£å’Œå‡ºå£æµé‡ï¼Œå…è®¸æœåŠ¡æ‰€æœ‰è€…ä¿æŠ¤ä»–ä»¬çš„æœåŠ¡å…å—å…¥å£å¹¶å‘å’Œå‡ºå£å¹¶å‘ã€‚ç½‘ç»œå›¢é˜Ÿè‡ªåŠ¨åˆ›å»ºå¦‚ä¸‹æ‰€ç¤ºçš„ä»ªè¡¨æ¿ï¼Œä»¥å¸®åŠ©æœåŠ¡æ‰€æœ‰è€…å¯è§†åŒ–å¹¶å‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å…¥å£å¹¶å‘&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furr901sd6j20h103hjrw_hub5036ba482ebec6d19dab9458ba32e0f_12754_6db0b4c859f70966b557211999a7107f.webp 400w,
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furr901sd6j20h103hjrw_hub5036ba482ebec6d19dab9458ba32e0f_12754_05ab61a36e02827809ea68a1c780cb3a.webp 760w,
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furr901sd6j20h103hjrw_hub5036ba482ebec6d19dab9458ba32e0f_12754_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-service-mesh-cascading-failure/61411417ly1furr901sd6j20h103hjrw_hub5036ba482ebec6d19dab9458ba32e0f_12754_6db0b4c859f70966b557211999a7107f.webp&#34;
               width=&#34;613&#34;
               height=&#34;125&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸Šé¢çš„ä¸¤ä¸ªé¢æ¿ï¼ŒæœåŠ¡æ‰€æœ‰è€…å¯ä»¥çœ‹åˆ°ä»ä»–ä»¬çš„ sidecar Envoy åˆ°ä»–ä»¬çš„æœåŠ¡çš„å¹¶å‘è¿æ¥æ•°ï¼ˆä½¿ç”¨å·¦è¾¹çš„é¢æ¿ï¼‰ï¼Œå¹¶æŸ¥çœ‹æ˜¯å¦æ­£è§¦å‘å¹¶å‘é™åˆ¶ï¼ˆä½¿ç”¨å³ä¾§çš„é¢æ¿ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å‡ºå£å¹¶å‘&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furrb4gp54j20go03g0tc_hub44ddc5e57b89ab1d632647afcb426c0_15349_9030b5d63bead814e3000c04d5e14d78.webp 400w,
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furrb4gp54j20go03g0tc_hub44ddc5e57b89ab1d632647afcb426c0_15349_04723276da341ede41d2829a948cc2ec.webp 760w,
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furrb4gp54j20go03g0tc_hub44ddc5e57b89ab1d632647afcb426c0_15349_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-service-mesh-cascading-failure/61411417ly1furrb4gp54j20go03g0tc_hub44ddc5e57b89ab1d632647afcb426c0_15349_9030b5d63bead814e3000c04d5e14d78.webp&#34;
               width=&#34;600&#34;
               height=&#34;124&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸Šé¢çš„ä¸¤ä¸ªé¢æ¿ï¼ŒæœåŠ¡æ‰€æœ‰è€…å¯ä»¥åœ¨ä»»ä½•æ—¶é—´ç‚¹ï¼ˆä»å·¦ä¾§çš„é¢æ¿ï¼‰å¯è§†åŒ–ä»ä»»ä½•æœåŠ¡åˆ°å…¶æœåŠ¡çš„å¹¶å‘è¯·æ±‚æ•°ã€‚æ­¤å¤–ï¼Œä»–ä»¬å¯ä»¥å¯è§†åŒ–è¶…å‡ºé…ç½®é™åˆ¶çš„æœåŠ¡ï¼ˆä½¿ç”¨å³ä¾§é¢æ¿ï¼‰ï¼Œç„¶åç»§ç»­ä½¿ç”¨å…·ä½“æ•°æ®è§£å†³é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœ‰ä»€ä¹ˆç¼ºç‚¹&#34;&gt;æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä¸å¹¸çš„æ˜¯ï¼Œä¸ä»»ä½•é™æ€å€¼ä¸€æ ·ï¼Œå¾ˆéš¾é€‰æ‹©åä¹‰ä¸Šçš„é™åˆ¶ã€‚å¯¹äºé€Ÿç‡é™åˆ¶æ¥è¯´æ˜¯è¿™æ ·çš„ï¼Œä½†å¯¹äºå¹¶å‘é™åˆ¶å°¤å…¶å¦‚æ­¤ã€‚å¿…é¡»è€ƒè™‘å‡ ä¸ªé‡è¦å› ç´ ã€‚å¹¶å‘é™åˆ¶æ˜¯æœ¬åœ°çš„ï¼Œå¿…é¡»è€ƒè™‘æœ€å¤§å¯èƒ½çš„å¹¶å‘æ€§è€Œä¸æ˜¯å¹³å‡å€¼ã€‚å·¥ç¨‹å¸ˆä¹Ÿä¸ä¹ æƒ¯åœ¨æœ¬åœ°æ€è€ƒï¼Œä¸»è¦è€ƒè™‘è¯·æ±‚ç‡è€Œä¸æ˜¯å¹¶å‘æ€§ã€‚å€ŸåŠ©ä¸€äº›å¯è§†åŒ–å’Œç»Ÿè®¡æ•°æ®ï¼ŒæœåŠ¡æ‰€æœ‰è€…é€šå¸¸å¯ä»¥æŒæ¡å¹¶å‘æ€§å¹¶é€‰æ‹©åä¹‰å€¼ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†éš¾ä»¥æ¨æ–­å–å€¼ä¹‹å¤–ï¼ŒLyft çš„ä¸€ä¸ªå¸¸è§ç°è±¡å°±æ˜¯å˜åŒ–ã€‚æ•´ä¸ªæœåŠ¡ç½‘ç»œä¸­æ¯å¤©æœ‰æ•°ç™¾ä¸ªéƒ¨ç½²ã€‚å¯¹æœåŠ¡åŠå…¶ä¾èµ–é¡¹çš„ä»»ä½•æ›´æ”¹éƒ½å¯ä»¥æ›´æ”¹èµ„æºå’Œè´Ÿè½½é…ç½®æ–‡ä»¶ã€‚ä¸€æ—¦é€‰æ‹©äº†å€¼ï¼Œç”±äºè¿™äº›å˜åŒ–ï¼Œå®ƒå¯èƒ½è¿‡æ—¶ã€‚ä¾‹å¦‚ï¼ŒLyft çš„å‡ ä¹æ‰€æœ‰æœåŠ¡éƒ½å— CPU é™åˆ¶ã€‚å¦‚æœ CPU ç»‘å®šæœåŠ¡çš„ç›´æ¥ä¾èµ–æ€§å‡æ…¢ 25ï¼…ï¼Œåˆ™è¯¥æœåŠ¡å¯ä»¥å¤„ç†é¢å¤–çš„å¹¶å‘æ€§ï¼Œå› ä¸ºä¹‹å‰ä½¿ç”¨ CPU çš„ç©ºé—²è¯·æ±‚ç°åœ¨ç­‰å¾…ç½‘ç»œ I/O å®Œæˆå°†ç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚å› æ­¤ï¼Œå»ºè®®æ¯”æ ‡ç§°å€¼å¢åŠ  25% è‡³ 50ï¼…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è·¯çº¿å›¾&#34;&gt;è·¯çº¿å›¾&lt;/h2&gt;
&lt;h3 id=&#34;çŸ­æœŸ&#34;&gt;çŸ­æœŸ&lt;/h3&gt;
&lt;p&gt;Lyft çš„ç½‘ç»œå›¢é˜Ÿä¸“æ³¨äºä¸ºæœåŠ¡å¼€å‘äººå‘˜æ„å»ºæ˜“äºä½¿ç”¨çš„ç³»ç»Ÿï¼Œä»¥æˆåŠŸé…ç½®ã€æ“ä½œå’Œè°ƒè¯• Envoy åŠç›¸å…³ç³»ç»Ÿã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ç« ç¨‹ä¸­ä¸ä»…è¦è®¾è®¡ã€å®æ–½å’Œéƒ¨ç½²ä¸Šé¢å±•ç¤ºçš„ç³»ç»Ÿï¼Œè¿˜è¦ä¸ºæˆ‘ä»¬çš„ç”¨æˆ·æä¾›æŒç»­çš„æ”¯æŒã€‚åœ¨ Lyftï¼ŒåŸºç¡€è®¾æ–½ç»„ç»‡çš„ä¸€ä¸ªä¸»è¦åŸåˆ™æ˜¯æˆ‘ä»¬ä¸ºæœåŠ¡æ‰€æœ‰è€…æä¾›çš„æŠ½è±¡åº”è¯¥æ˜¯è‡ªåŠ©æœåŠ¡ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦åœ¨è®°å½•ç”¨ä¾‹ã€æä¾›è°ƒè¯•å·¥å…·å’Œæä¾›æ”¯æŒæ¸ é“æ–¹é¢æŠ•å…¥å·¨èµ„ã€‚&lt;/p&gt;
&lt;p&gt;é‰´äºéç›´è§‚å¹¶å‘æ€§ï¼Œç½‘ç»œå›¢é˜Ÿå°†åœ¨çŸ­æœŸå†…å›´ç»•æ­¤æ–¹é¢æŠ•å…¥é¢å¤–çš„æ–‡æ¡£å’Œå·¥ç¨‹æ•™è‚²ã€‚åœ¨è¿‡å»ï¼Œé€šè¿‡ç›¸å…³ç³»ç»Ÿï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä»¥ä¸‹æ–¹å¼çš„æˆåŠŸï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¸¸è§é—®é¢˜è§£ç­”ï¼šå¸¸è§é—®é¢˜åˆ—è¡¨å¯¹äºå®¢æˆ·æ¥è¯´æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æ­¤å¤–ï¼Œå®ƒå‡å°‘äº†ç›´æ¥å›ç­”é—®é¢˜çš„æ”¯æŒè´Ÿæ‹…ï¼ˆä¾‹å¦‚ï¼Œåœ¨ Slack ä¸Šï¼Œé€šè¿‡ç”µå­é‚®ä»¶ï¼Œç”šè‡³æ˜¯äº²è‡ªå›ç­”ï¼ï¼‰ã€‚å®ƒå…è®¸æ‚¨è½»æ¾åœ°å°†æŸäººæŒ‡å‘æŸä¸ªé“¾æ¥ï¼›è¿™ç§åšæ³•æ¯”äººä»¬åå¤å›ç­”ç›¸åŒçš„é—®é¢˜è¦å¥½å¾—å¤šã€‚ä¸è¿‡è¿™é‡Œå¯èƒ½æœ‰ä¸ªå¼Šç«¯æ˜¯è¿™äº›åˆ—è¡¨å¯èƒ½ä¼šå˜å¾—å†—é•¿è€Œéš¾ä»¥è§£æã€‚è¿™å¯ä»¥é€šè¿‡å°†å†…å®¹åˆ†æˆåˆ†ç±»å¸¸è§é—®é¢˜è§£ç­”æ¥è§£å†³ã€‚&lt;/li&gt;
&lt;li&gt;é€‰æ‹©è‡ªå·±çš„å†’é™©ï¼šæœåŠ¡æ‰€æœ‰è€…æ˜¯ä¸»è§’ï¼Œä»–ä»¬å¯ä»¥é€‰æ‹©å†’é™©çš„ç»“æœã€‚åœ¨ä¸Šé¢æè¿°çš„å¹¶å‘ç©ºé—´ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°å‡ ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥ä¿®æ”¹å‡ ä¸ªå¯ä»¥è§£å†³é—®é¢˜çš„è®¾ç½®ã€‚è¿™æ„å‘³ç€è¿™ç§æ”¯æŒè´Ÿæ‹…éå¸¸é€‚åˆæœåŠ¡æ‰€æœ‰è€…å¯ä»¥ä»ä»–ä»¬é‡åˆ°çš„é—®é¢˜å¼€å§‹çš„æ ¼å¼ï¼Œå¹¶å¯¼èˆªæµç¨‹å›¾ä»¥è·å¾—ä»–ä»¬éœ€è¦åˆ†æçš„æŒ‡æ ‡ä»¥è·å¾—æ­£ç¡®çš„è®¾ç½®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ–‡æ¡£å’Œå·¥ç¨‹æ•™è‚²çš„è¿‘æœŸæŠ•èµ„ç¼“è§£äº†å½“å‰å¹¶å‘é—®é¢˜çš„ä¸€ä¸ªæ–¹é¢ï¼šç³»ç»Ÿçš„éç›´è§‚æ€§ã€‚ä½†æ˜¯ï¼Œä»–ä»¬æ²¡æœ‰è§£å†³å…¶ä»–é—®é¢˜ï¼šé™ˆæ—§æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ›´é•¿æœŸ&#34;&gt;æ›´é•¿æœŸ&lt;/h3&gt;
&lt;p&gt;å¹¶å‘é™åˆ¶å¾ˆå®¹æ˜“å®æ–½ï¼Œå› ä¸º Envoy å­˜åœ¨äºç½‘ç»œçš„æ¯ä¸€è·³ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œé™åˆ¶å¾ˆéš¾ç¡®å®šï¼Œå› ä¸ºå®ƒéœ€è¦æœåŠ¡æ‰€æœ‰è€…å®Œå…¨ç†è§£ç³»ç»Ÿçš„æ‰€æœ‰çº¦æŸã€‚æ­¤å¤–ï¼Œç”±äºç½‘ç»œæ‹“æ‰‘ç»“æ„çš„ä¸æ–­å‘å±•å’Œå¼¹æ€§ï¼Œå½“ä»Šçš„äº’è”ç½‘è§„æ¨¡å…¬å¸ï¼Œå°¤å…¶æ˜¯é‚£äº›å¤„äºæˆé•¿é˜¶æ®µçš„å…¬å¸ï¼Œé™æ€é™åˆ¶è¿…é€Ÿå¢é•¿ã€‚&lt;/p&gt;
&lt;p&gt;Netflix åœ¨è¿™ä¸ªé—®é¢˜ä¸ŠæŠ•å…¥äº†å¤§é‡èµ„é‡‘ï¼Œæœ€è¿‘ &lt;a href=&#34;https://github.com/Netflix/concurrency-limits&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼€æºäº†ä¸€ä¸ªåº“ï¼Œ&lt;/a&gt; Â ç”¨äºè¡¡é‡æˆ–ä¼°ç®—ç½‘ç»œä¸­æ¯ä¸ªç‚¹çš„å¹¶å‘é™åˆ¶ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œéšç€ç³»ç»Ÿè§„æ¨¡å’Œå‘½ä¸­é™åˆ¶ï¼Œç³»ç»Ÿä¸­æ¯ä¸ªèŠ‚ç‚¹å°†è°ƒæ•´å¹¶å¼ºåˆ¶æ‰§è¡Œå…¶å±€éƒ¨æé™è§†å›¾ã€‚ä»–ä»¬é€šè¿‡å°†ç³»ç»Ÿçš„å¹¶å‘çº¦æŸç­‰åŒäº TCP æ‹¥å¡çª—å£ï¼Œå€Ÿç”¨äº†å¸¸è§çš„ TCP æ‹¥å¡æ§åˆ¶ç®—æ³•ã€‚&lt;/p&gt;
&lt;p&gt;Envoy çš„è®¾è®¡åŸåˆ™ä¹‹ä¸€åŒ…æ‹¬ä¸°å¯Œä¸”åŠŸèƒ½å¼ºå¤§çš„è¿‡æ»¤å™¨å †æ ˆï¼Œä»¥æä¾›å¯æ‰©å±•æ€§ã€‚Envoy å…·æœ‰ L3/L4ï¼ˆTCP çº§åˆ«ï¼‰å’Œ L7ï¼ˆHTTP çº§åˆ«ï¼‰è¿‡æ»¤å™¨å †æ ˆã€‚å¯ä»¥ç¼–å†™ HTTP è¿‡æ»¤å™¨ä»¥å¯¹ HTTP çº§åˆ«æ¶ˆæ¯è¿›è¡Œæ“ä½œã€‚HTTP è¿‡æ»¤å™¨å¯ä»¥åœæ­¢å¹¶ç»§ç»­è¿­ä»£åˆ°åç»­è¿‡æ»¤å™¨ã€‚è¿™ç§ä¸°å¯Œçš„è¿‡æ»¤å™¨æ¶æ„å…è®¸å¤æ‚çš„åœºæ™¯ï¼Œä¾‹å¦‚è¿è¡ŒçŠ¶å†µæ£€æŸ¥å¤„ç†ã€è°ƒç”¨é€Ÿç‡é™åˆ¶æœåŠ¡ã€ç¼“å†²ã€è·¯ç”±ã€ç”Ÿæˆåº”ç”¨ç¨‹åºæµé‡ç»Ÿè®¡æ•°æ®ï¼Œå¦‚ DynamoDB ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªæœˆé‡Œï¼ŒLyft å°†ä¸ Netflix çš„å¹¶å‘é™åˆ¶åº“èƒŒåçš„å›¢é˜Ÿåˆä½œï¼Œå°†åŸºäºå…¶åº“çš„ç³»ç»Ÿå¸¦å…¥ Envoy L7 è¿‡æ»¤å™¨ã€‚è¿™æ„å‘³ç€åœ¨ Lyft ä»¥åŠä½¿ç”¨ Envoy çš„ä»»ä½•å…¶ä»–å…¬å¸æˆ‘ä»¬å°†è¿ç§»åˆ°è‡ªåŠ¨åŒ–ç³»ç»Ÿï¼Œæˆ‘ä»¬çš„æœåŠ¡å·¥ç¨‹å¸ˆä¸å¿…é™æ€é…ç½®å¹¶å‘é™åˆ¶ã€‚è¿™æ„å‘³ç€ï¼Œä¾‹å¦‚ï¼Œå¦‚æœç”±äºæ„å¤–æƒ…å†µå¯¼è‡´æœåŠ¡å‡é€Ÿï¼Œåˆ™è‡ªé€‚åº”é™åˆ¶ç³»ç»Ÿå¯ä»¥è‡ªåŠ¨æŠ‘åˆ¶æ£€æµ‹åˆ°çš„é™åˆ¶ï¼Œä»è€Œé˜²æ­¢ç”±äºä¸å¯é¢„è§çš„å‡é€Ÿè€Œå¯¼è‡´çš„æ•…éšœã€‚ä¸€èˆ¬è€Œè¨€ï¼Œè‡ªé€‚åº”ç³»ç»Ÿæ¶ˆé™¤äº†æˆ‘ä»¬è¿‡å»é‡åˆ°çš„ä¸¤ä¸ªé—®é¢˜ï¼šç¡®å®šé€‚å½“çš„é™åˆ¶æ˜¯éç›´è§‚çš„ï¼Œå¹¶ä¸”é™æ€é™åˆ¶åœ¨å¼¹æ€§åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¿«é€Ÿå¢é•¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœ€åçš„æƒ³æ³•&#34;&gt;æœ€åçš„æƒ³æ³•&lt;/h2&gt;
&lt;p&gt;è¦äº†è§£æœ‰å…³ Envoy æ–­è·¯å™¨å®ç°çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… Â Envoy æ–‡æ¡£ä¸­çš„æ–­è·¯å™¨ &lt;a href=&#34;http://www.servicemesher.com/envoy/intro/arch_overview/circuit_breaking.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ¶æ„æ¦‚è¿°&lt;/a&gt;ã€‚ä½œä¸ºä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ŒEnvoy å¯¹ä»£ç è´¡çŒ®æŒå¼€æ”¾æ€åº¦ã€‚æˆ‘ä»¬ä¹Ÿæ¬¢è¿æ–°çš„æƒ³æ³•ã€‚å³ä½¿ä»£ç æ²¡æœ‰åˆ°ä½ï¼Œä¹Ÿå¯ä»¥éšæ„æ‰“å¼€ä¸€ä¸ªå»ºè®®çš„æ–­è·¯å™¨æ”¹è¿› issueã€‚åœ¨å†™ä½œæœ¬æ–‡æ—¶å°šæœªå®ç°çš„èƒ½åŠ›çš„ä¸€ä¸ªç¤ºä¾‹æ˜¯ &lt;a href=&#34;https://github.com/envoyproxy/envoy/issues/3332&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸºäºç³»ç»Ÿèµ„æºçš„æ–­è·¯&lt;/a&gt; ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å¤„ç†å…¥å£æµé‡æ—¶ç›´æ¥æ–­è·¯ï¼Œè€Œä¸æ˜¯æ ¹æ® CPU é…ç½®æ–‡ä»¶é€¼è¿‘å¹¶å‘è¯·æ±‚é˜ˆå€¼ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶æ–­è·¯å™¨å¯ä»¥æ”¹å–„ç³»ç»Ÿåœ¨è´Ÿè½½ä¸‹çš„è¡Œä¸ºï¼Œä½†é‡è¦çš„æ˜¯ä¸è¦å¿˜è®°å¯ä»¥åœ¨ç³»ç»Ÿæœ¬èº«ä¸­è¿›è¡Œçš„æ”¹è¿›ã€‚æ–­è·¯å™¨åº”è¢«è§†ä¸ºæ•…éšœä¿æŠ¤ï¼Œè€Œä¸æ˜¯ä¸»è¦çš„çº¦æŸæ‰‹æ®µã€‚æœåŠ¡æ‰€æœ‰è€…åº”è¯¥ä½¿ç”¨æ–­è·¯å™¨çŸ¥è¯†æ¥æ”¹è¿›è‡ªå·±çš„ä»£ç åº“ã€‚é™åˆ¶æœ‰é™æ± çš„å¹¶å‘æ€§æ˜¯è§£å†³å¹¶å‘é—®é¢˜çš„æœ€å¸¸ç”¨æ–¹æ³•ã€‚å¦‚æœä»åŒä¸€ä¸Šä¸‹æ–‡ç”Ÿæˆå¤§é‡è¯·æ±‚ï¼Œåˆ™è°ƒç”¨è€…å¯ä»¥é€‰æ‹©ä½¿ç”¨æ‰¹å¤„ç† APIã€‚å¦‚æœæ‰¹å¤„ç† API ä¸å­˜åœ¨ï¼Œåˆ™å¯èƒ½ç¬¦åˆæ¥æ”¶è°ƒç”¨çš„æœåŠ¡çš„æœ€ä½³åˆ©ç›Šã€‚è¿™äº›æ¨¡å¼å¾€å¾€æ˜¯æ•™è‚²è¿‡ç¨‹çš„è¿›ä¸€æ­¥å»¶ä¼¸ã€‚åœ¨ Lyftï¼Œç½‘ç»œå›¢é˜Ÿä¸å…¶ä»–å›¢é˜Ÿåˆä½œï¼Œå¯¹æ‰€æœ‰æœåŠ¡è¿›è¡Œæ•™è‚²å’Œæ”¹è¿›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äºä½œè€…&#34;&gt;å…³äºä½œè€…&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furr8ztt97j202d02sweb_hu10097cdcdd941cd4b15375ee7159ef1b_2579_a1284e92d78e5bef418d4382c378aa3a.webp 400w,
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furr8ztt97j202d02sweb_hu10097cdcdd941cd4b15375ee7159ef1b_2579_6ce93839474d7f742b4da83d4c498ada.webp 760w,
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furr8ztt97j202d02sweb_hu10097cdcdd941cd4b15375ee7159ef1b_2579_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-service-mesh-cascading-failure/61411417ly1furr8ztt97j202d02sweb_hu10097cdcdd941cd4b15375ee7159ef1b_2579_a1284e92d78e5bef418d4382c378aa3a.webp&#34;
               width=&#34;85&#34;
               height=&#34;100&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Jose Nino&lt;/strong&gt; æ˜¯ Lyft ç½‘ç»œå›¢é˜Ÿå¼€å‘å·¥å…·å’Œé…ç½®çš„è´Ÿè´£äººã€‚åœ¨è¿‘ä¸¤å¹´çš„æ—¶é—´é‡Œï¼Œä»–ä¸€ç›´åœ¨ Lyft å·¥ä½œï¼ŒJose ä¸€ç›´åœ¨åˆ›å»ºç³»ç»Ÿæ¥æ‰©å±• Lyft Envoy ç”Ÿäº§ç¯å¢ƒçš„é…ç½®ï¼Œä»¥é€‚åº”æ—¥ç›Šåºå¤§çš„éƒ¨ç½²å’Œå·¥ç¨‹ç»„ç»‡ã€‚ä»–æ›¾æ‹…ä»»å¼€æº Envoy ç»´æŠ¤äººå‘˜ï¼Œå¹¶åŸ¹å…»äº† Envoy ä¸æ–­å‘å±•çš„ç¤¾åŒºã€‚æœ€è¿‘ï¼ŒJose ç»§ç»­æ‰©å±• Lyft çš„ç½‘ç»œè´Ÿè½½å®¹å¿ç³»ç»Ÿã€‚ä½•å¡åœ¨å‡ ä¸ªåœºåœ°è°ˆåˆ°äº† Envoy å’Œå…¶ä»–ç›¸å…³è¯é¢˜ï¼Œæœ€è¿‘ä¸€æ¬¡æ˜¯åœ¨ Kubecon EU 2018ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furr8zquv6j202d02sdfo_hu2a4146e67b5bf4290841a5c81c6dca8e_2925_4ceb366b52966b8ba21d1b3f01afe26d.webp 400w,
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furr8zquv6j202d02sdfo_hu2a4146e67b5bf4290841a5c81c6dca8e_2925_3958b2f4c0de07de3f9208962ee391bc.webp 760w,
               /blog/envoy-service-mesh-cascading-failure/61411417ly1furr8zquv6j202d02sdfo_hu2a4146e67b5bf4290841a5c81c6dca8e_2925_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/envoy-service-mesh-cascading-failure/61411417ly1furr8zquv6j202d02sdfo_hu2a4146e67b5bf4290841a5c81c6dca8e_2925_4ceb366b52966b8ba21d1b3f01afe26d.webp&#34;
               width=&#34;85&#34;
               height=&#34;100&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Daniel Hochman&lt;/strong&gt; æ˜¯ Lyft çš„é«˜çº§åŸºç¡€è®¾æ–½å·¥ç¨‹å¸ˆã€‚ä»–çƒ­è¡·äºæ‰©å±•åˆ›æ–°äº§å“å’Œæµç¨‹ï¼Œä»¥æ”¹å–„å…¬å¸å†…å¤–çš„ç”Ÿæ´»è´¨é‡ã€‚åœ¨ Lyft å·¥ä½œæœŸé—´ï¼Œä»–æˆåŠŸåœ°æŒ‡å¯¼äº†å¹³å°äº§å“å’Œç»„ç»‡å‘å±•çš„çˆ†ç‚¸å¼å¢é•¿ã€‚ä»–ç¼–å†™äº†ååé‡æœ€é«˜çš„å¾®æœåŠ¡ä¹‹ä¸€ï¼Œå¹¶ä»‹ç»äº†å‡ ç§å…³é”®å­˜å‚¨æŠ€æœ¯ã€‚Daniel ç›®å‰è´Ÿè´£ Lyft çš„äº¤é€šç½‘ç»œï¼Œå¹¶è´Ÿè´£åœ¨å†…éƒ¨å’Œè¾¹ç¼˜æ‰©å±• Lyft çš„ç½‘ç»œåŸºç¡€è®¾æ–½ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åˆ©ç”¨ Let&#39;s Encrypt ä¸º Istioï¼ˆEnvoyï¼‰æ·»åŠ  TLS æ”¯æŒ</title>
      <link>https://cloudnative.to/blog/istio-envoy-cert-manager-lets-encrypt-for-tls/</link>
      <pubDate>Mon, 25 Jun 2018 20:30:52 +0800</pubDate>
      <guid>https://cloudnative.to/blog/istio-envoy-cert-manager-lets-encrypt-for-tls/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://medium.com/@prune998/istio-envoy-cert-manager-lets-encrypt-for-tls-14b6a098f289&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ›´æ–°&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ„Ÿè°¢ Laurent Demailly çš„è¯„è®ºï¼Œè¿™é‡Œæœ‰ä¸€äº›æ›´æ–°ã€‚è¿™ç¯‡æ–‡ç« å·²ç»å¾—åˆ°äº†æ›´æ–°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç°åœ¨æœ‰ä¸€ä¸ª &lt;a href=&#34;https://github.com/kubernetes/charts/tree/master/stable/cert-manager&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cert-Manager å®˜æ–¹ Helm chart&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Istio Ingress ä¹Ÿæ”¯æŒåŸºäº HTTP/2 çš„ GRPC&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;istio&#34;&gt;Istio&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt; æ˜¯ç®¡ç†å¾®æœåŠ¡ä¸–ç•Œä¸­æ•°æ®æµçš„ä¸€ç§æ–°æ–¹å¼ã€‚äº‹å®ä¸Šï¼Œè¿™å¯¹æˆ‘æ¥è¯´æ›´æ˜¯å¦‚æ­¤ã€‚äººä»¬ä¸åœçš„è°ˆè®ºå¾®æœåŠ¡ä¸å•ä½“åº”ç”¨ï¼Œè¯´å¾®æœåŠ¡æ›´å¥½å¼€å‘ï¼Œæ˜“äºç»´æŠ¤ï¼Œéƒ¨ç½²æ›´å¿«ã€‚ã€‚ã€‚å‘ƒï¼Œä»–ä»¬æ˜¯å¯¹çš„ï¼Œä½†å¾®æœåŠ¡ä¸åº”è¯¥ä»…ä»…æ˜¯å°åº”ç”¨ç¨‹åºä¹‹é—´äº’ç›¸é€šä¿¡ã€‚å¾®æœåŠ¡åº”è¯¥è€ƒè™‘æ²‰æ·€ä¸ºä½ çš„åŸºç¡€è®¾æ–½çš„è¿™ç§æ–¹å¼ã€‚è€ƒè™‘å¦‚ä½•å†³å®šæ‚¨çš„â€œç®€å•â€åº”ç”¨ç¨‹åºå…¬å¼€æŒ‡æ ‡å’Œæ—¥å¿—çš„æ–¹å¼ï¼Œè€ƒè™‘æ‚¨å¦‚ä½•è·Ÿè¸ªçŠ¶æ€ï¼Œè€ƒè™‘å¦‚ä½•æ§åˆ¶æœåŠ¡ä¹‹é—´çš„æµç¨‹ä»¥åŠå¦‚ä½•ç®¡ç†é”™è¯¯ï¼Œè¿™äº›é—®é¢˜åº”è¯¥æ˜¯åšå¾®æœåŠ¡åº”è¯¥è€ƒè™‘çš„ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆ Istio èƒ½å¤Ÿåœ¨è¿™ä¸ªå¾®æœåŠ¡ä¸–ç•Œä¸­å¢åŠ ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;Istio æ˜¯ä¸€ä¸ªæœåŠ¡ç½‘æ ¼çš„å®ç°ï¼&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»€ä¹ˆï¼ŸæœåŠ¡ç½‘æ ¼ï¼Ÿæˆ‘ä»¬å·²ç»æœ‰äº† Kubernetes APIï¼Œæˆ‘ä»¬éœ€è¦â€œç½‘æ ¼â€å—ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œæ˜¯çš„ï¼Œä½ éœ€è¦æœåŠ¡ç½‘æ ¼ã€‚æˆ‘ä¸ä¼šè§£é‡Šä½¿ç”¨å®ƒçš„æ‰€æœ‰å¥½å¤„ï¼Œä½ ä¼šåœ¨ç½‘ä¸Šæ‰¾åˆ°è¶³å¤Ÿçš„æ–‡æ¡£ã€‚ä½†æ˜¯ç”¨ä¸€å¥è¯æ¥è¯´ï¼ŒæœåŠ¡ç½‘æ ¼å°±æ˜¯å°†æ‚¨æ‰€æœ‰çš„æœåŠ¡æä¾›ç»™å…¶ä»–æœåŠ¡çš„æŠ€æœ¯ã€‚äº‹å®ä¸Šï¼Œå®ƒè¿˜å¼ºåˆ¶æ‰§è¡Œæ‰€æœ‰â€œå¾®æœåŠ¡â€æœ€ä½³å®è·µï¼Œä¾‹å¦‚æ·»åŠ æµé‡å’Œé”™è¯¯æŒ‡æ ‡ï¼Œæ·»åŠ å¯¹ OpenTracingï¼ˆZipkin å’Œ Jaeggerï¼‰çš„æ”¯æŒï¼Œå…è®¸æ§åˆ¶é‡è¯•ï¼Œé‡‘ä¸é›€éƒ¨ç½²ã€‚ã€‚ã€‚é˜…è¯» &lt;a href=&#34;https://istio.io/docs/concepts/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio doc&lt;/a&gt; ï¼&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œå›åˆ°æœ¬è¯é¢˜&amp;hellip;&lt;/p&gt;
&lt;h3 id=&#34;å¿…è¦æ¡ä»¶&#34;&gt;å¿…è¦æ¡ä»¶&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å»ºè®®è¿è¡Œåœ¨ Kubernetes1.7 åŠä»¥ä¸Šçš„é›†ç¾¤ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªæˆ–å¤šä¸ª DNS åŸŸå&lt;/li&gt;
&lt;li&gt;è®© Istio åˆ©ç”¨ Ingress Controller åœ¨ä½ çš„é›†ç¾¤ä¸­å·¥ä½œ&lt;/li&gt;
&lt;li&gt;å°†ä¸Šé¢çš„ DNS åŸŸåé…ç½®ä¸ºæŒ‡å‘ Istio Ingress IP&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ssl&#34;&gt;SSL&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;SSL&lt;/strong&gt; æ˜¯å®‰å…¨çš„ï¼ˆå¾ˆå¥½ï¼‰ï¼Œä½†å®ƒé€šå¸¸æ˜¯è½¯ä»¶ä¸­å®ç°çš„æœ€åä¸€ä»¶äº‹ã€‚ä¸ºä»€ä¹ˆï¼Ÿä¹‹å‰å®ƒå®ç°èµ·æ¥æ˜¯â€œå¾ˆå›°éš¾çš„â€ï¼Œä½†æˆ‘ç°åœ¨çœ‹ä¸å‡ºä»»ä½•ç†ç”±ã€‚&lt;a href=&#34;https://letsencrypt.org/how-it-works/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Let&amp;rsquo;s Encrypt&lt;/a&gt; åˆ›å»ºä¸€ä¸ªæ–°çš„èŒƒä¾‹ï¼Œå®ƒçš„ DAMN å¾ˆå®¹æ˜“ä½¿ç”¨ API è°ƒç”¨åˆ›å»º Valide SSL è¯ä¹¦ï¼ˆåè®®è¢«ç§°ä¸º ACME &amp;hellip;ï¼‰ã€‚å®ƒä¸ºæ‚¨æä¾› 3 ç§éªŒè¯æ‚¨æ˜¯åŸŸåæ‰€æœ‰è€…çš„æ–¹æ³•ã€‚ä½¿ç”¨ DNSï¼Œä½¿ç”¨ HTTP æˆ–ç¬¬ä¸‰ç§è§£å†³æ–¹æ¡ˆçš„â€œç§˜å¯†ä»¤ç‰Œâ€ä¸å†å¯ç”¨ï¼Œå› ä¸ºå®ƒè¯æ˜æ˜¯ä¸å®‰å…¨çš„ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Let&amp;rsquo;s Encrypt æä¾›ç»™æ‚¨çš„ç‰¹æ®Š TXT è®°å½•è®¾ç½®æ‚¨çš„ DNSï¼Œæˆ–è€…å°†å…¶æ”¾å…¥ Web æ ¹è·¯å¾„ï¼ˆå¦‚ &lt;code&gt;/.well-known/acme-challenge/xxx&lt;/code&gt;ï¼‰ä¸­ï¼Œç„¶åè®©æˆ‘ä»¬çš„åŠ å¯†éªŒè¯å®ƒã€‚è¿™çœŸçš„å¾ˆç®€å•ï¼Œä½†å·®ä¸å¤šåªèƒ½è¿™æ ·ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€äº›å¼€å‘è€…å†³å®šç›´æ¥åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨å®ç° ACME åè®®ã€‚è¿™æ˜¯æ¥è‡ª &lt;a href=&#34;https://traefik.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Traefik&lt;/a&gt; çš„äººçš„å†³å®šã€‚&lt;a href=&#34;https://caddyserver.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Caddy&lt;/a&gt; ä¹Ÿåšäº†ä¸€äº›ç±»ä¼¼çš„â€œæ’ä»¶â€ã€‚è¿™å¾ˆé…·ï¼Œå› ä¸ºæ‚¨åªéœ€å®šä¹‰è™šæ‹Ÿä¸»æœºï¼Œåº”ç”¨ç¨‹åºè´Ÿè´£æ”¶é›†å’Œæ›´æ–°è¯ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;å¯æ‚²çš„æ˜¯ï¼ŒIstioï¼ˆå’Œåº•å±‚çš„ Envoy ä»£ç†ï¼‰æ²¡æœ‰ã€‚è¿™å°±æ˜¯è¿™ç¯‡åšæ–‡çš„è¦ç‚¹ï¼&lt;/p&gt;
&lt;h3 id=&#34;cert-manager&#34;&gt;CERT-Manager&lt;/h3&gt;
&lt;p&gt;è®¸å¤šäººè®¤è¯†åˆ°ï¼Œå¦‚æœä¸æ˜¯æ‰€æœ‰è½¯ä»¶éƒ½å¯ä»¥å®ç° ACME åè®®ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ä¸€ä¸ªå·¥å…·æ¥ç®¡ç†ï¼ˆå¦‚è¯·æ±‚ï¼Œæ›´æ–°ï¼ŒåºŸå¼ƒï¼‰SSL è¯ä¹¦ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ LEGO æˆç«‹çš„åŸå› ã€‚ç„¶å Kubernetes çš„ Kube-LEGOï¼Œç„¶å&amp;hellip;&amp;hellip;å¹¶ä¸”æœ€ç»ˆï¼Œä»–ä»¬å‡ ä¹éƒ½åŒæ„å°†æ‰€æœ‰å†…å®¹æ”¾å…¥ &lt;a href=&#34;https://github.com/jetstack/cert-manager&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cert-Manager&lt;/a&gt; ï¼&lt;/p&gt;
&lt;p&gt;Cert-Manager é™„å¸¦ helm chartï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“éƒ¨ç½²ï¼Œåªéœ€æŒ‰ç…§æ–‡æ¡£æ‰§è¡Œå‘½ä»¤å³å¯ï¼Œå°±åƒä¸‹é¢ä»‹ç»çš„è¿™æ ·ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ›´æ–°&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨æœ‰ä¸€ä¸ª &lt;a href=&#34;https://github.com/kubernetes/charts/tree/master/stable/cert-manager&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cert-Manager&lt;/a&gt; çš„&lt;a href=&#34;https://github.com/kubernetes/charts/tree/master/stable/cert-manager&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹ Helm å›¾è¡¨&lt;/a&gt;ï¼Œä½ ä¸éœ€è¦ &lt;code&gt;git clone&lt;/code&gt;Â ï¼Œåªéœ€è¦åš &lt;code&gt;helm install&lt;/code&gt;Â ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/jetstack/cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# check out the latest release tag to ensure we use a supported version of cert-manager&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git checkout v0.2.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm install &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--name cert-manager &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--namespace kube-system &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--set ingressShim.extraArgs&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{--default-issuer-name=letsencrypt-prod,--default-issuer-kind=ClusterIssuer}&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;contrib/charts/cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥å‘½ä»¤å°†å¯åŠ¨ kube-system å‘½åç©ºé—´ä¸­çš„ Cert-Manager podã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä½¿ç”¨è¿™ä¸€è¡Œé…ç½®&lt;code&gt;--default-issuer-kind=ClusterIssuer&lt;/code&gt; æ‰€ä»¥æˆ‘åªèƒ½åˆ›å»ºä¸€æ¬¡æˆ‘çš„ Issuerã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯ issuerï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯å®ƒçš„å·¥ä½œåŸç†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½ åˆ›å»ºä¸€ä¸ª Issuer é…ç½®ï¼Œå®ƒå°†å‘Šè¯‰ Cert-Manager å¦‚ä½•ä½¿ç”¨ ACME APIï¼ˆä½ é€šå¸¸åªæœ‰ 2 ä¸ªï¼Œstaging å’Œ prodï¼‰&lt;/li&gt;
&lt;li&gt;æ‚¨åˆ›å»ºä¸€ä¸ªè¯ä¹¦å®šä¹‰ï¼Œå‘Šè¯‰å“ªäº›åŸŸéœ€è¦ SSL&lt;/li&gt;
&lt;li&gt;Cert-Manager ä¸ºæ‚¨ç”³è¯·è¯ä¹¦&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œæˆ‘ä»¬æ¥åˆ›å»º Issuerã€‚åœ¨åˆ›å»º ClusterIssuers æ—¶ï¼Œæˆ‘ä¸å…³å¿ƒç‰¹å®šçš„å‘½åç©ºé—´ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;certmanager.k8s.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterIssuer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;letsencrypt-prod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;acme&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#The ACME server URL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;srver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https://acme-v01.api.letsencrypt.org/directory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#ç”¨äºæ³¨å†Œ ACME çš„ç”µå­é‚®ä»¶åœ°å€&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;me@domain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#ç”¨äºå­˜å‚¨ ACME å¸æˆ·ç§é’¥çš„ç§˜å¯†åç§°&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;privateKeySecretRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;letsencrypt-prod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#å¯ç”¨ HTTP-01 è´¨è¯¢æä¾›ç¨‹åº&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http01&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;certmanager.k8s.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterIssuer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;letsencrypt -staging&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;acme &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ACME çš„æœåŠ¡å™¨ URL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https://acme-staging.api.letsencrypt.org/directory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ç”¨äº ACME æ³¨å†Œçš„ç”µå­é‚®ä»¶åœ°å€&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;staging + me@domain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ç”¨äºå­˜å‚¨ ACME å¸æˆ·ç§é’¥çš„å¯†é’¥çš„ åç§°&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;privateKeySecretRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;letsencrypt-staging&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å¯ç”¨ HTTP-01 è´¨è¯¢æä¾›ç¨‹åº&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http01&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶å&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kubectl apply -f certificate-issuer.yml&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨ä½ åº”è¯¥æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„ Cert-Managerã€‚æ‚¨éœ€è¦ä¸ºæ‚¨çš„åŸŸ/æœåŠ¡åˆ›å»ºé…ç½®ï¼Œä»¥ä¾¿ Istio Ingress å¯ä»¥é€‰æ‹©æ­£ç¡®çš„è¯ä¹¦ã€‚&lt;/p&gt;
&lt;h3 id=&#34;istio-ingress&#34;&gt;Istio Ingress&lt;/h3&gt;
&lt;p&gt;Ingress æ˜¯æ‚¨å…¬å¼€æœåŠ¡çš„å‰ç«¯ Web ä»£ç†ï¼ˆè¿™æ˜¯ä½ çš„ä¼˜åŠ¿&amp;hellip;&amp;hellip;æˆ‘è¯´ WEB ä»£ç†ï¼Œå› ä¸ºå®ƒç°åœ¨åªæ”¯æŒ HTTP/HTTPSï¼‰ã€‚ä½†è®©æˆ‘ä»¬å‡è®¾ä½ çŸ¥é“å…³äº Ingress çš„ä¸€åˆ‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ›´æ–°&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ›´æ–°ï¼Œè€Œæ˜¯ä¸€ä¸ªæ›´ç²¾ç¡®çš„æè¿°ï¼ŒIngress ä¹Ÿæ”¯æŒ GRPCï¼Œå½“ç„¶è¿™æ˜¯ HTTP/2ã€‚&lt;/p&gt;
&lt;p&gt;Ingress çš„ç¥å¥‡ä¹‹å¤„åœ¨äºå®ƒåœ¨ Kubernetes API ä¸­çš„å®ç°ã€‚æ‚¨åˆ›å»ºä¸€ä¸ª Ingress Manifestï¼Œå¹¶å°†æ‚¨çš„æ‰€æœ‰æµé‡å¼•å¯¼è‡³æ­£ç¡®çš„ Podï¼å‘Šè¯‰ä½ è¿™ç§æ–¹å¼å°±æ˜¯ç¥å¥‡çš„é­”æ³•ï¼ˆå› ä¸ºä½ å¹¶ä¸çŸ¥é“å®ƒå¦‚ä½•å¼•å¯¼çš„æµé‡ï¼‰ ï¼&lt;/p&gt;
&lt;p&gt;å¾ˆå¥½ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™å°±æ˜¯ä»¤äººç¥å¥‡çš„é»‘é­”æ³•ï¼&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼ŒTraefik Ingress ç»‘å®šç«¯å£ 80 å’Œ 443ï¼Œç®¡ç†è¯ä¹¦ï¼Œå› æ­¤æ‚¨ä¸º &lt;a href=&#34;http://www.mydomain.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;www.mydomain.com&lt;/a&gt; åˆ›å»ºå…¥å£ï¼Œå¹¶ä¸”å®ƒæ­£å¸¸å·¥ä½œï¼Œå› ä¸ºå®ƒæ­£åœ¨åšæ‰€æœ‰äº‹æƒ…ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº Istioï¼Œå½“æ‚¨ä½¿ç”¨ Cert-Manager æ—¶ï¼Œè¿˜æœ‰ä¸€äº›æ­¥éª¤ã€‚è¦å¿«ç‚¹ï¼Œåœ¨è¿™é‡Œä»–ä»¬ï¼ˆæˆªè‡³ 2018/01ï¼Œå®ƒå¯èƒ½å¾ˆå¿«å°±ä¼šæ”¹å˜ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºåŸŸ &lt;a href=&#34;http://www.mydomain.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;www.mydomain.com&lt;/a&gt; åˆ›å»ºè¯ä¹¦è¯·æ±‚&lt;/li&gt;
&lt;li&gt;Cert-Manager å°†é€‰æ‹©è¿™ä¸ªå®šä¹‰å¹¶åˆ›å»ºä¸€ä¸ª podï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¯ä»¥å›ç­” ACME é—®é¢˜çš„ Web æœåŠ¡å™¨ï¼ˆ&lt;a href=&#34;https://github.com/jetstack/cert-manager/blob/master/docs/user-guides/ingress-shim.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress-Shim&lt;/a&gt;ï¼‰å®ƒè¿˜å°†åˆ›å»ºä¸€ä¸ªæœåŠ¡å’Œä¸€ä¸ª HTTP Ingressï¼Œä»¥ä¾¿å®ƒå¯ä»¥é€šè¿‡ Lets Encrypt æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;ä»¥å‰çš„è§‚ç‚¹ä¸é€‚ç”¨äºæ‚¨ä½¿ç”¨ Istio Ingressï¼Œå› æ­¤æ‚¨å¿…é¡»åˆ é™¤ &lt;code&gt;Service&lt;/code&gt; å’Œ&lt;code&gt;Ingress&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ›å»ºæŒ‡å‘ Pod çš„è‡ªå·±çš„æœåŠ¡&lt;/li&gt;
&lt;li&gt;åˆ›å»ºæ‚¨è‡ªå·±çš„ Istio Ingressï¼Œä»¥ä¾¿å¯ä»¥è®¿é—® pod&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¬èµ·æ¥å¾ˆç–¯ç‹‚ï¼Ÿé‚£ä¹ˆï¼Œç°åœ¨å‘¢ã€‚å®ƒç”šè‡³æ˜¯æ¶æ¢¦ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨ Istio ä¸­ä½¿ç”¨ Cert-Manager æ—¶ï¼Œæ‚¨åªèƒ½æ‹¥æœ‰ä¸€ä¸ªå¤–éƒ¨æœåŠ¡è¯ä¹¦ï¼æ‰€ä»¥ä½ å¿…é¡»æ·»åŠ æ‰€æœ‰å…¬å…± DNS åç§°åˆ°è¿™ä¸ªè¯ä¹¦ï¼&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æˆ‘ä»¬æ¥å®ç°å®ƒ&amp;hellip;&lt;/p&gt;
&lt;h4 id=&#34;è¯ä¹¦&#34;&gt;è¯ä¹¦&lt;/h4&gt;
&lt;p&gt;æŠŠè¿™ä¸ªæ¸…å•æ”¾åœ¨ä¸€ä¸ªåƒ &lt;em&gt;certificate-istio.yml&lt;/em&gt; è¿™æ ·çš„æ–‡ä»¶ä¸­Â ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;certmanager.k8s.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Certificate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meteadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingress-certs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingress-certs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;issuerRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; 	&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;letsencrypt-staging&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; 	&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterIssuer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;commonName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;www.mydomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;dnsNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;www.mydomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;mobile.mydomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;acme&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;http01&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingressClass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;none&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;www.mydomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; 	  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;mobile.mydomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘ä»¬æƒ³è¦ä¸€ä¸ªè¯ä¹¦&lt;/li&gt;
&lt;li&gt;å®ƒå°†æ”¯æŒ 2 ä¸ªåŸŸå &lt;em&gt;&lt;a href=&#34;https://www.mydomain.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;www.mydomain.com&lt;/a&gt;&lt;/em&gt; å’Œ &lt;em&gt;mobile.mydomain.com&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;æ­¤è¯ä¹¦è¯·æ±‚ä¸ Istio Ingressï¼ˆistio-systemï¼‰ä½äºåŒä¸€ä¸ªå‘½åç©ºé—´ä¸­ï¼Œ&lt;/li&gt;
&lt;li&gt;å®ƒå°†ä½¿ç”¨ HTTP-01 å›ç­” ACME çš„é—®é¢˜&lt;/li&gt;
&lt;li&gt;Istio Ingressï¼ˆEnvoy ä»£ç†ï¼‰æœŸæœ›è¯¥è¯ä¹¦å°†è¢«å¤åˆ¶åˆ°ä¸€ä¸ªåä¸º &lt;em&gt;istio-ingress-certs&lt;/em&gt; çš„  K8s  Secret ä¸­ï¼ˆè¿™æ˜¯è¶…çº§é‡è¦ï¼Œæœ€å¥½ä¸è¦ä¿®æ”¹è¿™ä¸ªåå­—ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶åï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kubectl apply -f certificate-istio.yml&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å®Œæˆä¹‹åï¼Œæ‚¨é€šè¿‡ cert-manager pod å°†å¯ä»¥çœ‹åˆ° Istio Ingress çš„æ—¥å¿—æƒ…å†µï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-ingress-7f8468bb7b-pxl94 istio-ingress &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2018-01-23T21:01:53.341Z&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GET /.well-known/acme-challenge/xxxxxxx HTTP/1.1&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; UH &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;19&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; - &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.20.5.1&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Go-http-client/1.1&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;xxx&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;www.domain.com&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-ingress-7f8468bb7b-pxl94 istio-ingress &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2018-01-23T21:01:58.287Z&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GET /.well-known/acme-challenge/xxxxxx HTTP/1.1&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt; UH &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;19&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; - &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.20.5.1&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Go-http-client/1.1&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;xxxx&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;mobile.domain.com&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ˜¯å› ä¸º Let&amp;rsquo;s Encrypt æœåŠ¡å™¨æ­£åœ¨è½®è¯¢éªŒè¯ä»¤ç‰Œï¼Œå¹¶ä¸”æ‚¨çš„è®¾ç½®å°šæœªè¿è¡Œã€‚æˆªè‡³ç›®å‰ä½ çš„è®¾ç½®çœ‹èµ·æ¥åƒè¿™æ ·ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/istio-envoy-cert-manager-lets-encrypt-for-tls/61411417ly1fshj4soh0mj20m80j3mzg.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç°åœ¨æ˜¯åˆ é™¤ç”± Cert-Manager åˆ›å»ºçš„ä¸éœ€è¦çš„ä¸œè¥¿çš„æ—¶å€™äº†ã€‚ä½¿ç”¨æ‚¨æœ€æ“…é•¿çš„ K8s å·¥å…·ï¼Œå¦‚ä»ªè¡¨æ¿æˆ– kubectlï¼Œå¹¶ä» &lt;em&gt;istio-system&lt;/em&gt; å‘½åç©ºé—´ä¸­åˆ é™¤ Service å’Œ Ingressã€‚å®ƒä»¬å°†è¢«å‘½åä¸º &lt;strong&gt;cm-istio-ingress-certs-xxxx&lt;/strong&gt;ã€‚å¦‚æœæ‚¨çš„è¯ä¹¦ç”³è¯·ä¸­æœ‰è®¸å¤šåŸŸåï¼Œä½ åº”è¯¥åˆ é™¤å¤šä½™çš„åŸŸåã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œä¸è¦åˆ  podï¼ï¼ˆå¦‚æœæœ‰é”™è¯¯ï¼Œå®ƒä»¬å°†è¢«é‡æ–°åˆ›å»ºï¼‰&lt;/p&gt;
&lt;p&gt;ï¼ˆä½œä¸ºæé†’ï¼š&lt;code&gt;kubectl -n istio-system delete cm-istio-ingress-certs-xxxx&lt;/code&gt;ï¼‰&lt;/p&gt;
&lt;h4 id=&#34;æœåŠ¡&#34;&gt;æœåŠ¡&lt;/h4&gt;
&lt;p&gt;æ—¢ç„¶æ‚¨çš„è®¾ç½®å¾ˆå¹²å‡€ï¼Œæ‚¨å¯ä»¥ç»§ç»­å¹¶é‡æ–°åˆ›å»ºæ‰€éœ€çš„ Service å’Œ ingressã€‚&lt;/p&gt;
&lt;p&gt;æ‚¨éœ€è¦å°½å¯èƒ½å¤šçš„ Serviceï¼Œå› ä¸ºæ‚¨æ‹¥æœ‰ä¸åŒçš„åŸŸåã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œ2.è¿™æ˜¯æ¸…å•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager-ingress-www&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;auth.istio.io/8089&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NONE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8089&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-certingr&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;certmanager.k8s.io/domain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;www.mydomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager-ingress-mobile&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;auth.istio.io/8089&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NONE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8089&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-certingr&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;certmanager.k8s.io/domain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mobile.mydomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶å&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kubectl apply -f certificate-services.yml&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åä½ å¯ä»¥æ£€æŸ¥ä½ çš„ Serviceã€‚æ¯ä¸ª Service éƒ½åº”è¯¥æœ‰ä¸€ä¸ªæŒ‡å®šçš„ç›®æ ‡ podã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼ŒService åç§°æ— å…³ç´§è¦ã€‚è¿™å–å†³äºä½ ç»™å‡ºä¸€ä¸ªç‰¹å®šçš„åç§°ï¼Œæ‰€ä»¥ä½ ä¸ä¼šæ··æ·†ä½ æ‰€æœ‰çš„åŸŸåã€‚&lt;/p&gt;
&lt;h4 id=&#34;ingress&#34;&gt;Ingress&lt;/h4&gt;
&lt;p&gt;ç°åœ¨æ˜¯åˆ›å»º Ingress çš„æ—¶å€™äº†ï¼Œå› æ­¤æ‚¨çš„â€œACME Token Podsâ€å¯ä»¥ä»å¤–éƒ¨è®¿é—®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kubernetes.io/ingress.class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;certmanager.k8s.io/acme-challenge-type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;certmanager.k8s.io/cluster-issuer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;letsencrypt-staging&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingress-certs-mgr&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/.well-known/acme-challenge/.*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager-ingress-www&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-certingr&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;www.mydomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/.well-known/acme-challenge/.*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager-ingress-mobile&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-certingr&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mobile.mydomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æ¬¡ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œéœ€è¦æ³¨æ„ä¸€äº›äº‹æƒ…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¯ä¹¦ï¼ŒService å’Œ Ingress éœ€è¦åœ¨åŒä¸€ä¸ªå‘½åç©ºé—´ä¸­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ingress class  æ˜¯ &lt;em&gt;Istio&lt;/em&gt;ï¼ˆæ˜¾ç„¶ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ &lt;em&gt;staging&lt;/em&gt; Issuerï¼ˆè®°ä½æˆ‘ä»¬ç¬¬ä¸€æ­¥åˆ›å»ºçš„ Issuerï¼‰ã€‚
æ‚¨å¿…é¡»æ ¹æ®åˆ›å»ºçš„&lt;code&gt;Issuer&lt;/code&gt;æˆ–&lt;code&gt;ClusterIssuer&lt;/code&gt;ä½¿ç”¨æ­£ç¡®çš„ annotationã€‚æ–‡æ¡£ä½äº &lt;a href=&#34;https://github.com/jetstack/cert-manager/blob/master/docs/user-guides/ingress-shim.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress-Shim&lt;/a&gt; é¡¹ç›®ä¸­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æˆ‘ä»¬å¿…é¡»ä¸ºæ¯ä¸ªåŸŸåˆ›å»ºä¸€ä¸ª HTTP è§„åˆ™&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ &lt;em&gt;backend/srvice&lt;/em&gt; å¿…é¡»æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥ä¸­åˆ›å»ºçš„æœåŠ¡ï¼Œä»¥åŠåŸŸååŒ¹é…ï¼Œæ‰€ä»¥ï¼š&lt;/p&gt;
&lt;p&gt;ç”¨ &lt;em&gt;&lt;a href=&#34;https://www.mydomain.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;www.mydomain.com&lt;/a&gt;&lt;/em&gt; â†’serviceName cert-manager-ingress-wwwâ†’pod cm-istio-ingress-certs-xxxï¼Œå…¶ä¸­ label &lt;em&gt;certmanager.k8s.io/domain =&lt;/em&gt; &lt;em&gt;&lt;a href=&#34;https://www.mydomain.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;www.mydomain.com&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å†æ¬¡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kubectl apply -f certificate-ingress.yml&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å°±æ˜¯è¿™æ ·ï¼&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥ Istio-Ingress æ—¥å¿—ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°å‡ ä¸ª*â€œGET /.well-known/acme-challenge/xxx HTTP / 1.1â€200*&lt;/p&gt;
&lt;h3 id=&#34;ç¤ºä¾‹åº”ç”¨ç¨‹åº&#34;&gt;ç¤ºä¾‹åº”ç”¨ç¨‹åº&lt;/h3&gt;
&lt;p&gt;æˆ‘ä½¿ç”¨äº†ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºæ¥éªŒè¯æˆ‘çš„è®¾ç½®æ­£åœ¨å·¥ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld-v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kubernetes.io/ingress.class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kubernetes.io/ingress.allow-http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;false&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingress-https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingress-certs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/.*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;www.mydomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/.*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld-v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mobile.mydomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kubernetes.io/ingress.class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingress-http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/.*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;www.mydomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/.*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld-v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mobile.mydomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ReplicationController&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;kelseyhightower/helloworld:v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ReplicationController&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld-v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;kelseyhightower/helloworld:v2&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¿…é¡»å†æ¬¡æ„Ÿè°¢ Kelsey Hightower æ˜¯ä»–æä¾›çš„ HelloWorld ç¤ºä¾‹åº”ç”¨ç¨‹åºğŸ™&lt;/p&gt;
&lt;p&gt;ç„¶åï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n default apply -f helloworld.yml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦ä¸ºæ‰€æœ‰ HTTPS åŸŸåä½¿ç”¨ä¸€ä¸ª Ingressï¼Œè€Œä¸º HTTP ä½¿ç”¨ä¸€ä¸ª Ingress  &amp;hellip;è¿™é‡Œä»…æ˜¾ç¤º HTTPSï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/istio-envoy-cert-manager-lets-encrypt-for-tls/61411417ly1fshj4vatnoj20m80j376n.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;éªŒè¯å®Œæˆåï¼ŒCert-Manager åº”è¯¥åˆ é™¤ istio-system å‘½åç©ºé—´ä¸­çš„ Token-Exchange podã€‚æ˜¯çš„ï¼Œä¸€æ—¦ Cert-Manager ä¸ Let&amp;rsquo;s Encrypt æœåŠ¡å™¨è¾¾æˆä¸€è‡´ï¼Œä»–ä»¬å°†äº¤æ¢ç”¨äºç»­è®¢çš„æ°¸ä¹…å¯†é’¥ã€‚æ— éœ€ä½¿ç”¨ podï¼Œç”šè‡³ Services å’Œ Ingressï¼Œè‡³å°‘å¦‚æœä½ ç¡®å®šä½ ä¸éœ€è¦æ·»åŠ æˆ–æ”¹å˜è¯ä¹¦ä¸­çš„æŸäº›ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ›´æ–°è¯ä¹¦&#34;&gt;æ›´æ–°è¯ä¹¦&lt;/h3&gt;
&lt;p&gt;åœ¨æ›´æ–°è¯ä¹¦æ—¶ï¼Œæˆ‘å»ºè®®å…ˆä¸ºå…¶åˆ›å»ºæ­£ç¡®çš„ &lt;code&gt;Service&lt;/code&gt;ã€‚ç„¶åæ›´æ–° &lt;code&gt;Ingress&lt;/code&gt; ä»¥å°†æµé‡å‘é€åˆ°æ­£ç¡®çš„æœåŠ¡ã€‚æœ€åï¼Œæ›´æ–°æ‚¨çš„ &lt;code&gt;Certificate&lt;/code&gt; å®šä¹‰å¹¶æ·»åŠ æ–°çš„åŸŸåã€‚&lt;/p&gt;
&lt;p&gt;è¯ä¹¦ç®¡ç†å™¨å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ &lt;code&gt;ingress&lt;/code&gt; å’Œ &lt;code&gt;service&lt;/code&gt; ä½ å°†ä¸å¾—ä¸åˆ é™¤ã€‚å…¶ä»–ä¸€åˆ‡éƒ½å°†è‡ªè¡Œå‘ç”Ÿã€‚ç­‰å¾…å‡ ç§’é’Ÿ &lt;code&gt;Istio-Ingress&lt;/code&gt; é‡æ–°åŠ è½½å®ƒçš„è¯ä¹¦ï¼Œä½ å¾ˆå¥½ &lt;code&gt;curl&lt;/code&gt;Â ï¼&lt;/p&gt;
&lt;h3 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h3&gt;
&lt;p&gt;å°½ç®¡æˆ‘ç°åœ¨è§‰å¾—å®ƒéå¸¸ä»¤äººç ”å‘ï¼Œä½†å®ƒæœ€èµ·ç å¯ä»¥æ­£å¸¸å·¥ä½œã€‚å¦‚æœæ‚¨éœ€è¦æ›´æ–°è¯ä¹¦æˆ–æ·»åŠ æ–°çš„åŸŸåï¼Œåˆ™å¿…é¡»æ›´æ–°è¯ä¹¦å®šä¹‰ï¼Œæ•´ä¸ªè¿‡ç¨‹å°†è¦é‡æ–°å†æ¥ä¸€éã€‚è¿™å®åœ¨æ˜¯ä¸€ç§ç—›è‹¦ï¼Œå½“ç„¶æ¯”èµ·ä¸ Traefik æˆ– Caddy å®Œå…¨æ•´åˆæ›´åŠ å›°éš¾ã€‚ä¸è¿‡æˆ‘ç›¸ä¿¡è¿™å°†ä¼šå¾ˆå¿«æ”¹å˜ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘æƒ³æ„Ÿè°¢ &lt;a href=&#34;https://github.com/ldemailly&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Laurent Demailly&lt;/a&gt; åœ¨è¿™æ–¹é¢çš„å·¥ä½œã€‚æœ‰å…³æ›´å¤šè¯¦æƒ…å’Œè®¨è®ºï¼Œè¯·å‚é˜… Istio  &lt;a href=&#34;https://github.com/istio/istio.github.io/issues/868&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;issue #868&lt;/a&gt;ã€‚ä»–æ­£åœ¨ä½¿ç”¨ Istio + TLS å¼€å‘ç¤ºä¾‹åº”ç”¨ç¨‹åºéƒ¨ç½² Fortioï¼Œä»–æ˜¯å¯å‘å¹¶å¸®åŠ©æˆ‘å®Œæˆæ‰€æœ‰å·¥ä½œçš„äººã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å®¹å™¨ã€æœåŠ¡ç½‘æ ¼å’Œ API ç½‘å…³ï¼šä»è¾¹ç¼˜å¼€å§‹</title>
      <link>https://cloudnative.to/blog/containers-service-mesh-and-api-gateways-it-starts-at-the-edge/</link>
      <pubDate>Thu, 21 Jun 2018 18:00:58 +0800</pubDate>
      <guid>https://cloudnative.to/blog/containers-service-mesh-and-api-gateways-it-starts-at-the-edge/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://devops.com/containers-service-mesh-and-api-gateways-it-starts-at-the-edge/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.docker.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Docker&lt;/a&gt; å’Œ &lt;a href=&#34;https://kubernetes.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes&lt;/a&gt; ä¸ºä»£è¡¨çš„å®¹å™¨æŠ€æœ¯ç‚™æ‰‹å¯çƒ­ï¼Œç†ŸçŸ¥è¿™ä¸€æŠ€æœ¯é¢†åŸŸçš„ç”¨æˆ·ï¼Œä¸€å®šéƒ½çŸ¥é“ä¸‹ä¸€ä¸ªçƒ­ç‚¹ï¼šService Meshï¼Œå®ƒæ‰¿è¯ºå°†å¾®æœåŠ¡ä¹‹é—´çš„å†…éƒ¨ç½‘ç»œé€šä¿¡å‡ä¸€åŒ–ï¼Œå¹¶è§£å†³ä¸€ç³»åˆ—ç›‘æ§ã€æ•…éšœéš”ç¦»ç­‰é€šç”¨éåŠŸèƒ½æ€§éœ€æ±‚ã€‚åº•å±‚çš„ä»£ç†æœåŠ¡å™¨æŠ€æœ¯æ˜¯ Service Mesh çš„ç«‹èº«ä¹‹æœ¬ï¼Œè¿™ç§æŠ€æœ¯åœ¨ Service Mesh ä¹‹å¤–ï¼Œè¿˜èƒ½ä»¥ API ç½‘å…³çš„å½¢å¼åœ¨è¾¹ç¼˜ä¸ºä¸šåŠ¡ç³»ç»Ÿæä¾›ä¸€ç³»åˆ—çš„å¢å¼ºã€‚&lt;/p&gt;
&lt;p&gt;è™½è¯´ Service Mesh çš„çˆ†å‘ä¹‹åŠ¿è®©äººè¯¯ä»¥ä¸ºç½—é©¬æ˜¯ä¸€æ—¥å»ºæˆçš„ï¼Œäº‹å®ä¸Šï¼Œåœ¨è¿™ä¸€çƒ­ç‚¹æµ®å‡ºæ°´é¢ä¹‹å‰ï¼ŒåŒ…æ‹¬ &lt;a href=&#34;https://getnelson.github.io/nelson/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Verizon&lt;/a&gt;ã€&lt;a href=&#34;https://fabiolb.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;eBday&lt;/a&gt; ä»¥åŠ &lt;a href=&#34;https://code.facebook.com/posts/1906146702752923/open-sourcing-katran-a-scalable-network-load-balancer/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Facebook&lt;/a&gt; åœ¨å†…çš„å¾ˆå¤šç»„ç»‡å·²ç»åœ¨åº”ç”¨åæ¥è¢«æˆ‘ä»¬ç§°ä¹‹ä¸º Service Mesh çš„æŠ€æœ¯äº†ã€‚è¿™äº›æ—©æœŸåº”ç”¨ Service Mesh çš„ç»„ç»‡ä¹‹ä¸€å°±æ˜¯ &lt;a href=&#34;https://www.microservices.com/talks/lyfts-envoy-monolith-service-mesh-matt-klein/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Lyft&lt;/a&gt;ï¼Œè¿™æ˜¯ä¸€å®¶å¹´æ”¶å…¥è¶…è¿‡åäº¿ç¾å…ƒçš„ç¾å›½ç½‘çº¦è½¦å·¨å¤´ã€‚Lyft è¿˜æ˜¯å¼€æºè½¯ä»¶ &lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Proxy&lt;/a&gt; çš„è¯ç”Ÿåœ°ï¼ŒEnvoy åœ¨ Service Mesh ä¸–ç•Œä¸­ä¸¾è¶³è½»é‡ï¼ŒKubernetes åŸç”Ÿçš„ &lt;a href=&#34;https://istio.io/docs/concepts/what-is-istio/overview/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ§åˆ¶é¢&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.getambassador.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambassador API ç½‘å…³&lt;/a&gt; ä¹Ÿéƒ½å»ºç­‘åœ¨ Lyft çš„åŸºç¡€ä¹‹ä¸Šã€‚&lt;/p&gt;
&lt;h2 id=&#34;soa-ç½‘ç»œçš„çƒ¦æ¼&#34;&gt;SOA ç½‘ç»œçš„çƒ¦æ¼&lt;/h2&gt;
&lt;p&gt;Matt Klein æ˜¯ Envoy Proxy çš„ä½œè€…ä¹‹ä¸€ï¼Œä»–å»å¹´çš„ä¸€æ¬¡è°ˆè¯ä¸­è¯´åˆ°ï¼ŒSOAï¼ˆé¢å‘æœåŠ¡çš„æ¶æ„ï¼‰å’Œå¾®æœåŠ¡ç½‘ç»œæ˜¯â€œ&lt;a href=&#34;https://www.microservices.com/talks/lyfts-envoy-monolith-service-mesh-matt-klein/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ··ä¹±çš„åºç„¶å¤§ç‰©&lt;/a&gt;â€ã€‚èº«å¤„å…¶ä¸­çš„æ¯ä¸ªåº”ç”¨éƒ½è¾“å‡ºäº†ä¸åŒçš„ç»Ÿè®¡å’Œæ—¥å¿—ï¼Œæ•´ä¸ªæœåŠ¡å †æ ˆå¦‚ä½•å¤„ç†è¯·æ±‚ç”Ÿæˆå“åº”çš„è¿‡ç¨‹ä¹Ÿæ˜¯æ— æ³•è·Ÿè¸ªçš„ï¼Œåœ¨è¿™æ ·çš„æƒ…å†µä¸‹è¿›è¡Œ Debug çš„å·¨å¤§éš¾åº¦ä¹Ÿå°±å¯ä»¥æƒ³è±¡äº†ã€‚åŒæ—¶å¯¹ç±»ä¼¼è´Ÿè½½å‡è¡¡å™¨ã€ç¼“å­˜ä»¥åŠç½‘ç»œæ‹“æ‰‘è¿™æ ·çš„åŸºç¡€è®¾æ–½ç»„ä»¶çš„ç›‘æ§èƒ½åŠ›ä¹Ÿæ˜¯å¾ˆæœ‰é™çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä»–è§‰å¾—ï¼šâ€œè¿™å¾ˆç—›è‹¦ï¼Œæˆ‘è®¤ä¸ºå¤šæ•°å…¬å¸éƒ½èµåŒ SOAï¼ˆå¾®æœåŠ¡ï¼‰æ˜¯ä¸ªå¯è§è¶‹åŠ¿ï¼Œåœ¨è¿™ä¸€è¶‹åŠ¿çš„è·µè¡Œè¿‡ç¨‹ä¸­ä¼šæ”¶è·å¾ˆå¤šï¼Œä½†æ˜¯å…¶ä¸­ä¹Ÿæ»¡æ˜¯ç—›è‹¦ã€‚ä¸»è¦çš„ç—›è‹¦æ¥æºå°±æ˜¯ Debugâ€ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºå¤§è§„æ¨¡ç»„ç»‡æ¥è¯´ï¼Œåˆ†å¸ƒå¼ Web åº”ç”¨çš„å¯é æ€§å’Œé«˜å¯ç”¨æ”¯æŒæ˜¯ä¸€ä¸ªæ ¸å¿ƒæŒ‘æˆ˜ã€‚è¿™ç§æŒ‘æˆ˜çš„åº”å¯¹æ–¹å¼ä¸­ï¼Œæ™®éåŒ…å«åŒ…å«é‡è¯•ã€è¶…æ—¶ã€é¢‘ç‡æ§åˆ¶å’Œç†”æ–­ç­‰åŠŸèƒ½é€»è¾‘çš„å„ç§å®ç°ã€‚å¾ˆå¤šç³»ç»Ÿï¼Œä¸è®ºå¼€æºä¸å¦ï¼Œéƒ½ä¼šä½¿ç”¨é”å®šç‰¹å®šè¯­è¨€ï¼ˆç”šè‡³é”å®šæ¡†æ¶ï¼‰çš„å½¢å¼æ¥å®ç°è¿™ç§æ–¹æ¡ˆï¼Œè¿™å°±æ„å‘³ç€å¼€å‘äººå‘˜ä¹ŸåŒæ—¶è¢«è¿›è¡Œé”å®šã€‚Klein å’Œä»–åœ¨ Lyft çš„å›¢é˜Ÿè®¤ä¸ºï¼Œä¸€å®šæœ‰æ›´å¥½çš„åŠæ³•ã€‚æœ€ç»ˆ Envoy é¡¹ç›®è¯ç”Ÿäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¤–éƒ¨å¹²é¢„è¾¹ç¼˜ä»£ç†çš„ä¼˜åŠ¿&#34;&gt;å¤–éƒ¨å¹²é¢„ï¼šè¾¹ç¼˜ä»£ç†çš„ä¼˜åŠ¿&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://eng.lyft.com/announcing-envoy-c-l7-proxy-and-communication-bus-92520b6c8191&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2016 å¹´ 9 æœˆ&lt;/a&gt; ä»¥å¼€æºå½¢å¼å‘å¸ƒäº† Envoy Proxyï¼ŒKlein å’Œ Lyft å·¥ç¨‹å¸ˆå›¢é˜Ÿä¸€å¤•æˆåï¼Œä½†è¿™å¹¶éä¸€è¹´è€Œå°±ï¼ŒLyft æ¶æ„ä»æœ€åˆçš„æ··åˆ SOA æ¶æ„èµ·æ­¥ï¼ŒèŠ±è´¹äº†å››å¹´ï¼Œçªç ´å±‚å±‚é™©é˜»å‡çº§ä¸ºæœåŠ¡ç½‘æ ¼æ²»ç†ä¹‹ä¸‹çš„å¾®æœåŠ¡ä½“ç³»ã€‚2017 å¹´çš„&lt;a href=&#34;https://www.microservices.com/talks/mechanics-deploying-envoy-lyft-matt-klein/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¾®æœåŠ¡å®è·µè€…è™šæ‹Ÿå³°ä¼š&lt;/a&gt;ä¸Šï¼ŒKlein è®²è¿°äº†å‘æœåŠ¡ç½‘æ ¼è¿›è¡ŒæŠ€æœ¯è¿ç§»çš„è¿‡ç¨‹ä¸­é¢å¯¹åŸºæœ¬éœ€æ±‚å’Œç›¸å…³æŒ‘æˆ˜ï¼ŒåŠå…¶å•†ä¸šä»·å€¼ã€‚&lt;/p&gt;
&lt;p&gt;Klein çš„ç¬¬ä¸€æ¬¡è‰°è‹¦å–èƒœæ˜¯â€œä»è¾¹ç¼˜ä»£ç†å¼€å§‹â€çš„ã€‚å¾®æœåŠ¡ä¸ºåŸºç¡€çš„ Web åº”ç”¨éœ€è¦åœ¨è¾¹ç¼˜æä¾›åå‘ä»£ç†ï¼Œä¸€æ–¹é¢å¯ä»¥é˜²æ­¢æš´éœ²å†…éƒ¨ä¸šåŠ¡æœåŠ¡æ¥å£ï¼ˆä¼šè¿åæ¾è€¦åˆåŸåˆ™ï¼‰ï¼Œå¦ä¸€æ–¹é¢ï¼Œæš´éœ²å¤§é‡æœåŠ¡ä¹Ÿæ„å‘³ç€å¤§é‡çš„ç‹¬ç«‹ URI ä»¥åŠ RPC ç«¯ç‚¹ï¼Œè¿™ä¼šæ¶ˆè€—å¤§é‡çš„è¿ç»´èµ„æºã€‚ç°å­˜çš„äº‘æ‰€æä¾›çš„è¾¹ç¼˜ä»£ç†æœåŠ¡å™¨æˆ–è€…ç½‘å…³éƒ½ä¸å¾ˆå¥½ï¼Œä¸åŒäº§å“å‘ˆç°ç»™å·¥ç¨‹å¸ˆçš„æ˜¯ä¸åŒçš„ã€æ˜“æ··æ·†çš„å·¥ä½œç•Œé¢ã€‚Klein å€¡è®®åœ¨è¾¹ç¼˜å®ç°ä¸€ä¸ªç°ä»£åŒ–çš„ä»£ç†æœåŠ¡ï¼Œåœ¨å…¶ä¸­æä¾›æ”¹è¿›çš„ç›‘æ§ã€è´Ÿè½½å‡è¡¡ä»¥åŠåŠ¨æ€è·¯ç”±èƒ½åŠ›ï¼Œä»¥æ­¤æ¥äº§ç”Ÿå•†ä¸šä»·å€¼ã€‚å·¥ç¨‹å¸ˆå›¢é˜Ÿç†è§£å’ŒæŒæ¡äº†è¾¹ç¼˜ä»£ç†çš„è¿ç»´ä¹‹åï¼Œå°±å¯ä»¥å‘å†…éƒ¨å›¢é˜Ÿè¿›è¡Œæ¨å¹¿ï¼Œæœ€ç»ˆå½¢æˆå†…éƒ¨çš„æœåŠ¡ç½‘æ ¼äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¾¹ç¼˜è¿›åŒ–ä»ä»£ç†åˆ°-api-ç½‘å…³&#34;&gt;è¾¹ç¼˜è¿›åŒ–ï¼šä»ä»£ç†åˆ° API ç½‘å…³&lt;/h2&gt;
&lt;p&gt;AppDirect æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯æä¾›äº‘ç«¯äº§å“å’ŒæœåŠ¡ç®¡ç†çš„å•†ä¸šå¹³å°ï¼Œé¢„è®¡å¹´æ”¶å…¥ 5000 ä¸‡ç¾å…ƒã€‚åœ¨ AppDirect æœ€è¿‘çš„åšå®¢ &lt;a href=&#34;https://www.appdirect.com/blog/evolution-of-the-appdirect-kubernetes-network-infrastructure&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Evolution of the AppDirect Kubernetes Network Infrastructure&lt;/a&gt; ä¸­ï¼Œä»–ä»¬ç€é‡ä»‹ç»äº†å’Œ Lyft ç±»ä¼¼çš„ç»å†ã€‚äº‘æŠ€æœ¯å’Œ Kubernetes ä¹‹ç±»çš„ç¼–æ’å¹³å°å¸¦æ¥çš„ä¸åªæ˜¯æœ‰è§„æ¨¡ã€å¼¹æ€§ä¹‹ç±»çš„å¥½å¤„ï¼Œè¿˜å› ä¸ºä¸ç”Ÿä¿±æ¥çš„æ˜“å˜å’ŒåŠ¨æ€ç‰¹æ€§ï¼Œæå‡ºäº†æ–°çš„æŒ‘æˆ˜ï¼šå¾®æœåŠ¡æ„å»ºçš„å•†ä¸šåŠŸèƒ½å¦‚ä½•åˆé€‚çš„åœ¨å…¬å…±ç«¯ç‚¹ä¸Šæä¾›æœåŠ¡ï¼Ÿ&lt;/p&gt;
&lt;p&gt;AppDirect å·¥ç¨‹å¸ˆå›¢é˜Ÿé‡‡ç”¨äº†ä¸€ç§å¯é çš„æ–¹æ³•æ¥åº”å¯¹æŒ‘æˆ˜ï¼Œé¦–å…ˆæŠŠé…ç½®çš„æ ¸å¿ƒéƒ¨åˆ†ï¼ˆä¾‹å¦‚æš´éœ²çš„æœåŠ¡ç«¯å£ï¼‰é™æ€åŒ–ï¼Œç„¶ååœ¨æ¯ä¸ªåº”ç”¨ä¹‹å‰éƒ¨ç½²è´Ÿè½½å‡è¡¡å™¨ã€‚æ¥ä¸‹æ¥çš„è¿­ä»£å°±æ˜¯ä½¿ç”¨ HashiCorp çš„åˆ†å¸ƒå¼é”®å€¼åº“ &lt;a href=&#34;https://www.consul.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Consul&lt;/a&gt; ç»“åˆæ”¯æŒçƒ­é‡è½½çš„ HAProxy åå‘ä»£ç†æ¥æä¾›æ›´å¥½çš„åŠ¨æ€ç®¡ç†èƒ½åŠ›ã€‚å›¢é˜Ÿçš„ç»ˆæç›®æ ‡æ˜¯ç”¨æ›´ä¸°å¯ŒåŠŸèƒ½çš„ API ç½‘å…³æ¥æä¾›æ›´ä¸°å¯Œçš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æ–‡ä¸­è¯´åˆ°ï¼šâ€œAPI ç½‘å…³çš„ç›®æ ‡æ˜¯åœ¨ä¸å˜æ›´å·²å…¬å¼€ API çš„è®¿é—®æ€§çš„æƒ…å†µä¸‹ï¼ˆè¿™ç§ä¸ç»å˜æ›´çš„å¯è®¿é—®æ€§ä¹ŸåŒ…å«äº†æ—§æœ‰çš„ URL ä»¥åŠå‹å•†çš„å®šåˆ¶åŸŸåç­‰ï¼‰ï¼Œé€šè¿‡æ³¨å…¥å’Œæ›¿æ¢çš„æ–¹å¼é€ä¸ªå®ç°è½¬æ¢è¿‡ç¨‹ã€‚â€&lt;/p&gt;
&lt;p&gt;åœ¨å¯¹ä¸€ç³»åˆ—çš„å¼€æºå’Œå•†ä¸šäº§å“è¿›è¡Œè¯„ä¼°ä¹‹åï¼ŒAppDirect å›¢é˜Ÿé€‰æ‹©äº†æ„å»ºåœ¨ Envoy proxy ä¹‹ä¸Šçš„ Kubernetes åŸç”Ÿçš„ Ambassador API ç½‘å…³äº§å“ï¼š&lt;/p&gt;
&lt;p&gt;â€œæ„å»ºäºæˆ‘ä»¬äº†è§£å’Œå–œçˆ±çš„ Kubernetes API ä¹‹ä¸Šçš„ Ambassadorï¼Œæ˜¯ä¸€ä¸ªè½»é‡ã€ç¨³å®šä»¥åŠæ²¡æœ‰å¤–éƒ¨æ•°æ®åº“ä¾èµ–çš„äº§å“ã€‚Ambassador å¾ˆç‹¬ç‰¹ï¼Œä½¿ç”¨ Kubernetes å¯¹è±¡æ ‡æ³¨åŠŸèƒ½æ¥å®šä¹‰è·¯ç”±é…ç½®ï¼ˆä¹Ÿå°±æ˜¯ä»¥æ­¤å®ç° &lt;a href=&#34;https://blog.envoyproxy.io/the-universal-data-plane-api-d15cec7a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy æ•°æ®é¢&lt;/a&gt;çš„æ§åˆ¶å¹³é¢ï¼‰â€â€”â€”å›¢é˜Ÿåšå®¢å¦‚æ˜¯è¯´ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶ AppDirect è¿˜æ²¡æœ‰å®Œå…¨å®ç°å†…éƒ¨é€šä¿¡çš„ç½‘æ ¼åŒ–ï¼Œä½†æ˜¯å·²ç»æ„Ÿå—åˆ°äº† Envoy Proxy è¿™æ ·çš„æŠ€æœ¯æ‰€å¸¦æ¥çš„å¥½å¤„ï¼Œæ›´å­¦åˆ°äº†åœ¨äº§å“ä¸­åº”ç”¨è¿™äº›æŠ€æœ¯çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ˜Ÿç«ç‡åŸ&#34;&gt;æ˜Ÿç«ç‡åŸ&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼æŠ€æœ¯çš„å®ç°å’Œè¿ç§»è¿‡ç¨‹æ‰åˆšåˆšå¼€å§‹ï¼Œä½†æ˜¯å·²ç»å¯ä»¥è‚¯å®šï¼Œè¿™ä¸€æŠ€æœ¯å¼¥åˆäº† Kubernetes è¿™æ ·çš„ç°ä»£å®¹å™¨åŒ–å¹³å°ä¸­åº”ç”¨ä¹‹é—´çš„é¸¿æ²Ÿã€‚æœåŠ¡ç½‘æ ¼å¸¦æ¥çš„ï¼ŒåŒ…æ‹¬é¢‘ç‡æ§åˆ¶ã€æ–­è·¯å™¨ä»¥åŠç›‘æ§æ€§ç­‰åœ¨å†…çš„æ‰€æœ‰å¥½å¤„ï¼Œéƒ½å¯ä»¥ä»æœåŠ¡è¾¹ç¼˜å¼€å§‹äº«ç”¨ã€‚å¦‚æœæƒ³è¦å¯¹è¿™ä¸€æŠ€æœ¯è¿›è¡Œè¿›ä¸€æ­¥çš„æ¢ç´¢å’Œå­¦ä¹ ï¼Œåœ¨ç³»ç»Ÿè¾¹ç¼˜å¼€å§‹ï¼Œå†œæ‘åŒ…å›´åŸå¸‚æ˜¯ä¸€ç§è¡Œä¹‹æœ‰æ•ˆçš„ç­–ç•¥ã€‚è¿™ç§ç­–ç•¥æ— éœ€å…¨é¢éƒ¨ç½²ï¼Œå°±èƒ½è¿…é€Ÿçš„åœ¨ç›‘æ§ã€å¼¹æ€§ç­‰æ–¹é¢å±•ç¤ºå‡ºç‰¹æœ‰çš„å•†ä¸šä»·å€¼ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Service Mesh ä¸­çš„é€šç”¨æ•°æ®å¹³é¢ API è®¾è®¡</title>
      <link>https://cloudnative.to/blog/the-universal-data-plane-api/</link>
      <pubDate>Thu, 21 Jun 2018 16:11:03 +0800</pubDate>
      <guid>https://cloudnative.to/blog/the-universal-data-plane-api/</guid>
      <description>&lt;p&gt;æ­£å¦‚æˆ‘ä¹‹å‰æ‰€è¯´çš„ï¼Œåœ¨å¦‚æ­¤çŸ­çš„æ—¶é—´å†…ï¼Œ&lt;a href=&#34;https://lyft.github.io/envoy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt; å¸¦æ¥çš„å…´å¥‹æ—¢ç¥å¥‡åˆéœ‡æ’¼äººå¿ƒã€‚æˆ‘ç»å¸¸é—®è‡ªå·±ï¼šenvoy çš„å“ªäº›æ–¹é¢å¯¼è‡´äº†æˆ‘ä»¬æ‰€çœ‹åˆ°çš„å¼‚å¸¸çš„ç¤¾åŒºå¢é•¿ï¼Ÿè™½ç„¶ Envoy å…·æœ‰å¾ˆå¤šå¼•äººæ³¨ç›®çš„ç‰¹å¾ï¼Œä½†æœ€ç»ˆæˆ‘è®¤ä¸ºæœ‰ä¸‰ä¸ªä¸»è¦ç‰¹å¾åœ¨å…±åŒæ¨åŠ¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;ï¼šåœ¨å…·å¤‡å¤§é‡ç‰¹æ€§çš„åŒæ—¶ï¼ŒEnvoy æä¾›æé«˜çš„ååé‡å’Œä½å°¾éƒ¨å»¶è¿Ÿå·®å¼‚ï¼Œè€Œ CPU å’Œ RAM æ¶ˆè€—å´ç›¸å¯¹è¾ƒå°‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯æ‰©å±•æ€§&lt;/strong&gt;ï¼šEnvoy åœ¨ L4 å’Œ L7 éƒ½æä¾›äº†ä¸°å¯Œçš„å¯æ’æ‹”è¿‡æ»¤å™¨èƒ½åŠ›ï¼Œä½¿ç”¨æˆ·å¯ä»¥è½»æ¾æ·»åŠ  å¼€æºç‰ˆæœ¬ä¸­æ²¡æœ‰çš„åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;API å¯é…ç½®æ€§&lt;/strong&gt;ï¼šæˆ–è®¸æœ€é‡è¦çš„æ˜¯ï¼ŒEnvoy æä¾›äº†ä¸€ç»„å¯ä»¥é€šè¿‡æ§åˆ¶å¹³é¢æœåŠ¡å®ç°çš„&lt;a href=&#34;https://lyft.github.io/envoy/docs/intro/arch_overview/dynamic_configuration.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç®¡ç† API&lt;/a&gt; ã€‚å¦‚æœæ§åˆ¶å¹³é¢å®ç°æ‰€æœ‰çš„ APIï¼Œåˆ™å¯ä»¥ä½¿ç”¨é€šç”¨å¼•å¯¼é…ç½®åœ¨æ•´ä¸ªåŸºç¡€æ¶æ„ä¸Šè¿è¡Œ Envoyã€‚æ‰€æœ‰è¿›ä¸€æ­¥çš„é…ç½®æ›´æ”¹é€šè¿‡ç®¡ç†æœåŠ¡å™¨ä»¥æ— ç¼æ–¹å¼åŠ¨æ€ä¼ é€ï¼Œå› æ­¤ Envoy ä»ä¸éœ€è¦é‡æ–°å¯åŠ¨ã€‚è¿™ä½¿å¾— Envoy æˆä¸ºé€šç”¨æ•°æ®å¹³é¢ï¼Œå½“å®ƒä¸ä¸€ä¸ªè¶³å¤Ÿå¤æ‚çš„æ§åˆ¶å¹³é¢ç›¸ç»“åˆæ—¶ï¼Œä¼šæå¤§çš„é™ä½æ•´ä½“è¿ç»´çš„å¤æ‚æ€§ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ‰ä»£ç†å…·å¤‡è¶…é«˜æ€§èƒ½ã€‚ä¹Ÿæœ‰ä»£ç†å…·å¤‡é«˜åº¦çš„å¯æ‰©å±•æ€§å’ŒåŠ¨æ€å¯é…ç½®æ€§ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œæ€§èƒ½ã€å¯æ‰©å±•æ€§å’ŒåŠ¨æ€å¯é…ç½®æ€§çš„&lt;em&gt;ç»“åˆ&lt;/em&gt; æ‰ä½¿å¾— Envoy å¦‚æ­¤çš„å¼•äººæ³¨ç›®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†æ¦‚è¿° Envoy åŠ¨æ€é…ç½® API èƒŒåçš„å†å²å’ŒåŠ¨æœºï¼Œè®¨è®ºä» v1 åˆ° v2 çš„æ¼”å˜ï¼Œæœ€åï¼Œé¼“åŠ±æ›´å¤šçš„è´Ÿè½½å‡è¡¡ï¼Œä»£ç†å’Œæ§åˆ¶å¹³é¢ç¤¾åŒºæ¥è€ƒè™‘åœ¨å…¶äº§å“ä¸­æ”¯æŒè¿™äº› APIã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-api-v1-çš„å†å²&#34;&gt;Envoy API v1 çš„å†å²&lt;/h2&gt;
&lt;p&gt;Envoy æœ€åˆçš„è®¾è®¡ç›®æ ‡ä¹‹ä¸€æ˜¯å®ç°&lt;a href=&#34;https://lyft.github.io/envoy/docs/intro/arch_overview/service_discovery.html#on-eventually-consistent-service-discovery&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ€ç»ˆä¸€è‡´çš„æœåŠ¡å‘ç°&lt;/a&gt;ç³»ç»Ÿã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¼€å‘äº†ä¸€ä¸ªéå¸¸ç®€å•çš„&lt;a href=&#34;https://github.com/lyft/discovery&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘ç°æœåŠ¡&lt;/a&gt;å’Œ &lt;a href=&#34;https://lyft.github.io/envoy/docs/configuration/cluster_manager/sds_api.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Discovery Service (SDS) REST API&lt;/a&gt;ï¼Œç”¨æ¥è¿”å›ä¸Šæ¸¸é›†ç¾¤æˆå‘˜ã€‚è¯¥ API å…‹æœäº†åŸºäº DNS çš„æœåŠ¡å‘ç°çš„ä¸€äº›é™åˆ¶ï¼ˆè®°å½•é™åˆ¶ã€ç¼ºå°‘é¢å¤–å…ƒæ•°æ®ç­‰ï¼‰ï¼Œå¹¶ä½¿æˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿå®ç°é«˜å¯é æ€§ã€‚&lt;/p&gt;
&lt;p&gt;Envoy å¼€æºåˆæœŸï¼Œæˆ‘ä»¬æ”¶åˆ°äº†å¾ˆå¤šå…³äºæ”¯æŒå…¶ä»–æœåŠ¡å‘ç°ç³»ç»Ÿçš„è¦æ±‚ï¼Œå¦‚ Consulã€Kubernetesã€Marathonã€DNS SRV ç­‰ã€‚æˆ‘æ‹…å¿ƒæˆ‘ä»¬å¯¹è¿™äº›ç³»ç»Ÿç›´æ¥æ”¯æŒçš„ç¼ºå¤±ä¼šé™åˆ¶ Envoy çš„ä½¿ç”¨èŒƒå›´è€Œä¸è¢«äººæ‰€æ¥çº³ã€‚æ·»åŠ æ–°çš„å‘ç°é€‚é…å™¨çš„ä»£ç ç¼–å†™å¹¶ä¸å›°éš¾ï¼Œæˆ‘å¸Œæœ›æœ‰å…³æ–¹é¢èƒ½å¤Ÿå®æ–½æ–°çš„é€‚é…å™¨ã€‚è€Œè¿‡å»ä¸€å¹´å®é™…å‘ç”Ÿæ˜¯ä»€ä¹ˆï¼Ÿæ²¡æœ‰ä¸€ä¸ªæ–°çš„é€‚é…å™¨è¢«è´¡çŒ®åˆ°ä»£ç ä¸­ï¼Œä½†æˆ‘ä»¬çœ‹åˆ°äº†ä»¤äººéš¾ä»¥ç½®ä¿¡çš„æ¥å—åº¦ã€‚ä¸ºä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;äº‹å®è¯æ˜ï¼Œå‡ ä¹æ¯ä¸ªäººéƒ½ä»¥è‡ªå·±çš„æ–¹å¼æ¥å®ç° SDS APIã€‚API æœ¬èº«æ˜¯å¾®ä¸è¶³é“çš„ï¼Œä½†æˆ‘ä¸è®¤ä¸ºè¿™æ˜¯äººä»¬å®ç°å®ƒçš„å”¯ä¸€åŸå› ã€‚å¦ä¸€ä¸ªåŸå› æ˜¯ï¼Œç¦»æ•°æ®å¹³é¢è¶Šè¿œï¼Œäº‹æƒ…è‡ªç„¶å°±ä¼šå¼€å§‹å˜å¾—æ›´ç‰¢å›ºã€‚Envoy çš„æ¶ˆè´¹è€…é€šå¸¸å¸Œæœ›æœ€ç»ˆæœåŠ¡å‘ç°èƒ½å¤Ÿé›†æˆåˆ°ç‰¹å®šçš„å·¥ä½œæµç¨‹ä¸­ã€‚API çš„ç®€å•æ€§ä½¿å¾—å…¶å¯ä»¥è½»æ¾é›†æˆåˆ°å‡ ä¹ä»»ä½•æ§åˆ¶å¹³é¢ç³»ç»Ÿä¸­ã€‚ç”šè‡³åƒ Consul ç³»ç»Ÿçš„ç”¨æˆ·ï¼ˆå‚è§ç¤ºä¾‹ &lt;a href=&#34;https://verizon.github.io/nelson/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Nelson&lt;/a&gt;ï¼‰ä¹Ÿå‘ç°ä¸­é—´ API å¯ä»¥å¯¹æˆå‘˜å’Œå‘½ååšæ›´æ™ºèƒ½çš„å¤„ç†ã€‚å› æ­¤ï¼Œå³ä½¿åœ¨å¦‚æ­¤æ—©æœŸçš„é˜¶æ®µï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†å¯¹&lt;em&gt;é€šç”¨æ•°æ®å¹³é¢ API&lt;/em&gt; çš„æ¸´æœ›ï¼šä¸€ä¸ªç®€å•çš„ APIï¼Œä»æ§åˆ¶å¹³é¢ä¸­æŠ½è±¡å‡ºæ•°æ®å¹³é¢ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿‡å»çš„ä¸€å¹´ä¸­ï¼ŒEnvoy æ·»åŠ äº†å¤šä¸ª v1/REST ç®¡ç† APIã€‚ä»–ä»¬åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://lyft.github.io/envoy/docs/configuration/cluster_manager/cds.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›†ç¾¤å‘ç°æœåŠ¡ï¼ˆCDSï¼‰&lt;/a&gt;ï¼šä½¿ç”¨æ­¤ APIï¼ŒEnvoy å¯ä»¥åŠ¨æ€åœ°æ·»åŠ /æ›´æ–°/åˆ é™¤æ‰€æœ‰ä¸Šæ¸¸é›†ç¾¤ï¼ˆæ¯ä¸ªé›†ç¾¤æœ¬èº«éƒ½æœ‰è‡ªå·±çš„æœåŠ¡/ç«¯ç‚¹å‘ç°ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lyft.github.io/envoy/docs/configuration/http_conn_man/rds.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯ç”±å‘ç°æœåŠ¡ï¼ˆRDSï¼‰&lt;/a&gt;ï¼šä½¿ç”¨æ­¤ APIï¼ŒEnvoy å¯ä»¥åŠ¨æ€åœ°æ·»åŠ /æ›´æ–° HTTP è·¯ç”±è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lyft.github.io/envoy/docs/configuration/listeners/lds.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç›‘å¬å™¨å‘ç°æœåŠ¡ï¼ˆLDSï¼‰&lt;/a&gt;ï¼šä½¿ç”¨æ­¤ APIï¼ŒEnvoy å¯ä»¥åŠ¨æ€åœ°æ·»åŠ /æ›´æ–°/åˆ é™¤å…¨ä½“ç›‘å¬å™¨ï¼ŒåŒ…æ‹¬å…¶å®Œæ•´çš„ L4 å’Œ L7 è¿‡æ»¤å™¨å †æ ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“æ§åˆ¶å¹³é¢å®ç° SDS/CDS/RDS/LDS æ—¶ï¼Œå‡ ä¹ Envoy çš„æ‰€æœ‰æ–¹é¢éƒ½å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€é…ç½®ã€‚&lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt; å’Œ &lt;a href=&#34;https://verizon.github.io/nelson/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Nelson&lt;/a&gt; éƒ½æ˜¯æ§åˆ¶å¹³é¢çš„ä¾‹å­ï¼Œä»–ä»¬åœ¨ V1 API ä¸Šæ„å»ºï¼Œå…·å¤‡æå…¶ä¸°å¯Œçš„åŠŸèƒ½ã€‚é€šè¿‡ä½¿ç”¨ç›¸å¯¹ç®€å•çš„ REST APIï¼ŒEnvoy å¯ä»¥å¿«é€Ÿè¿­ä»£æ€§èƒ½å’Œæ•°æ®å¹³é¢åŠŸèƒ½ï¼ŒåŒæ—¶ä»æ”¯æŒå„ç§ä¸åŒçš„æ§åˆ¶å¹³é¢æ–¹æ¡ˆã€‚æ­¤æ—¶ï¼Œé€šç”¨æ•°æ®å¹³é¢æ¦‚å¿µæ­£æˆä¸ºç°å®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;v1-api-çš„ç¼ºç‚¹å’Œ-v2-çš„å¼•å…¥&#34;&gt;v1 API çš„ç¼ºç‚¹å’Œ v2 çš„å¼•å…¥&lt;/h2&gt;
&lt;p&gt;v1 API ä»…ä½¿ç”¨ JSON/RESTï¼Œæœ¬è´¨ä¸Šæ˜¯è½®è¯¢ã€‚è¿™æœ‰å‡ ä¸ªç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°½ç®¡ Envoy åœ¨å†…éƒ¨ä½¿ç”¨çš„æ˜¯ JSON æ¨¡å¼ï¼Œä½† API æœ¬èº«å¹¶ä¸æ˜¯å¼ºç±»å‹ï¼Œè€Œä¸”å®‰å…¨å®ç°å®ƒä»¬çš„é€šç”¨æœåŠ¡å™¨ä¹Ÿå¾ˆéš¾ã€‚&lt;/li&gt;
&lt;li&gt;è™½ç„¶è½®è¯¢å·¥ä½œåœ¨å®è·µä¸­æ˜¯å¾ˆæ­£å¸¸çš„ç”¨æ³•ï¼Œä½†æ›´å¼ºå¤§çš„æ§åˆ¶å¹³é¢æ›´å–œæ¬¢ streaming APIï¼Œå½“å…¶å°±ç»ªåï¼Œå¯ä»¥å°†æ›´æ–°æ¨é€ç»™æ¯ä¸ª Envoyã€‚è¿™å¯ä»¥å°†æ›´æ–°ä¼ æ’­æ—¶é—´ä» 30-60 ç§’é™ä½åˆ° 250-500 æ¯«ç§’ï¼Œå³ä½¿åœ¨æå…¶åºå¤§çš„éƒ¨ç½²ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨è¿‡å»å‡ ä¸ªæœˆä¸ Google çš„ç´§å¯†åˆä½œä¸­ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨åŠªåŠ›ç ”ç©¶ä¸€ç»„æˆ‘ä»¬ç§°ä¹‹ä¸º v2 çš„æ–° APIã€‚v2 API å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–°çš„ API æ¨¡å¼ä½¿ç”¨ &lt;a href=&#34;https://developers.google.com/protocol-buffers/docs/proto3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;proto3&lt;/a&gt; æŒ‡å®šï¼Œå¹¶åŒæ—¶ä»¥ gRPC å’Œ REST + JSON/YAML ç«¯ç‚¹å®ç°ã€‚å¦å¤–ï¼Œå®ƒä»¬è¢«å®šä¹‰åœ¨ä¸€ä¸ªåä¸º &lt;a href=&#34;https://github.com/lyft/envoy-api&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;envoy-api&lt;/a&gt; çš„æ–°çš„ä¸“ç”¨æºä»£ç ä»“åº“ä¸­ã€‚proto3 çš„ä½¿ç”¨æ„å‘³ç€è¿™äº› API æ˜¯å¼ºç±»å‹çš„ï¼ŒåŒæ—¶ä»ç„¶é€šè¿‡ proto3 çš„ JSON/YAML è¡¨ç¤ºæ¥æ”¯æŒ JSON/YAML å˜ä½“ã€‚ä¸“ç”¨å­˜å‚¨ä»“åº“çš„ä½¿ç”¨æ„å‘³ç€é¡¹ç›®å¯ä»¥æ›´å®¹æ˜“çš„ä½¿ç”¨ API å¹¶ç”¨ gRPC æ”¯æŒçš„æ‰€æœ‰è¯­è¨€ç”Ÿæˆå­˜æ ¹ï¼ˆå®é™…ä¸Šï¼Œå¯¹äºå¸Œæœ›ä½¿ç”¨å®ƒçš„ç”¨æˆ·ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ”¯æŒåŸºäº REST çš„ JSON/YAML å˜ä½“ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯‘è€…æ³¨ï¼š&lt;a href=&#34;https://github.com/lyft/envoy-api&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;envoy-api&lt;/a&gt; ä»“åº“åœ¨ Envoy åŠ å…¥ CNCF åæ”¹ä¸º &lt;a href=&#34;https://github.com/envoyproxy/data-plane-api&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;envoyproxy/data-plane-api&lt;/a&gt; ä»“åº“ï¼Œé—®é¢˜åé¢æœ‰æåˆ°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;v2 API æ˜¯ v1 çš„æ¼”è¿›ï¼Œè€Œä¸æ˜¯é©å‘½ï¼Œå®ƒæ˜¯ v1 åŠŸèƒ½çš„è¶…é›†ã€‚v1 ç”¨æˆ·ä¼šå‘ç° v2 éå¸¸æ¥è¿‘ä»–ä»¬å·²ç»åœ¨ä½¿ç”¨çš„ APIã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¸€ç›´ä»¥å¯ä»¥ç»§ç»­æ°¸ä¹…æ”¯æŒ v1ï¼ˆå°½ç®¡æ˜¯æœ€ç»ˆè¢«å†»ç»“çš„åŠŸèƒ½é›†ï¼‰çš„æ–¹å¼åœ¨ Envoy ä¸­å®ç° v2ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸é€æ˜çš„å…ƒæ•°æ®å·²è¢«æ·»åŠ åˆ°å„ç§ API å“åº”ä¸­ï¼Œè¿™å°†æå¤§çš„å¢å¼ºå¯æ‰©å±•æ€§ã€‚ä¾‹å¦‚ï¼ŒHTTP è·¯ç”±ä¸­çš„å…ƒæ•°æ®ï¼Œé™„åŠ åˆ°ä¸Šæ¸¸ç«¯ç‚¹å’Œè‡ªå®šä¹‰è´Ÿè½½å‡è¡¡å™¨çš„å…ƒæ•°æ®ï¼Œä»¥ç”¨æ¥æ„å»ºç«™ç‚¹ç‰¹æœ‰çš„åŸºäºæ ‡ç­¾çš„è·¯ç”±ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¯ä»¥åœ¨é»˜è®¤çš„ OSS å‘è¡Œç‰ˆä¹‹ä¸Š&lt;a href=&#34;https://github.com/lyft/envoy-filter-example&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è½»æ¾æ’å…¥ä¸°å¯Œçš„åŠŸèƒ½&lt;/a&gt;ã€‚æœªæ¥å°†æœ‰æ›´å¼ºå¤§çš„å…³äºç¼–å†™ Envoy æ‰©å±•çš„æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºä½¿ç”¨ v2 gRPCï¼ˆvs. JSON/RESTï¼‰çš„ API æ¶ˆè´¹è€…ï¼ŒåŒå‘æµä¼šæœ‰ä¸€äº›æœ‰è¶£çš„å¢å¼ºï¼Œæˆ‘å°†åœ¨ä¸‹é¢è¿›è¡Œæ›´å¤šè®¨è®ºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;v2 API ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Endpoint Discovery Service (EDS)ï¼šè¿™æ˜¯ v1 SDS API çš„æ›¿ä»£å“ã€‚SDS æ˜¯ä¸€ä¸ªä¸å¹¸çš„åå­—é€‰æ‹©ï¼Œæ‰€ä»¥æˆ‘ä»¬æ­£åœ¨ v2 ä¸­ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚æ­¤å¤–ï¼ŒgRPC çš„åŒå‘æµæ€§è´¨å°†å…è®¸å°†è´Ÿè½½/å¥åº·ä¿¡æ¯æŠ¥å‘Šå›ç®¡ç†æœåŠ¡å™¨ï¼Œä¸ºå°†æ¥çš„å…¨å±€è´Ÿè½½å‡è¡¡åŠŸèƒ½å¼€å¯å¤§é—¨ã€‚&lt;/li&gt;
&lt;li&gt;Cluster Discovery Service (CDS)ï¼šå’Œ v1 æ²¡æœ‰å®è´¨æ€§å˜åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;Route Discovery Service (RDS)ï¼šå’Œ v1 æ²¡æœ‰å®è´¨æ€§å˜åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;Listener Discovery Service (LDS)ï¼šå’Œ v1 çš„å”¯ä¸€ä¸»è¦å˜åŒ–æ˜¯ï¼šæˆ‘ä»¬ç°åœ¨å…è®¸ç›‘å¬å™¨å®šä¹‰å¤šä¸ªå¹¶å‘è¿‡æ»¤æ ˆï¼Œè¿™äº›è¿‡æ»¤æ ˆå¯ä»¥åŸºäºä¸€ç»„ç›‘å¬å™¨è·¯ç”±è§„åˆ™ï¼ˆä¾‹å¦‚ï¼ŒSNIï¼Œæº/ç›®çš„åœ° IP åŒ¹é…ç­‰ï¼‰æ¥é€‰æ‹©ã€‚è¿™æ˜¯å¤„ç†â€œåŸå§‹ç›®çš„åœ°â€ç­–ç•¥è·¯ç”±çš„æ›´ç®€æ´çš„æ–¹å¼ï¼Œè¿™ç§è·¯ç”±æ˜¯é€æ˜æ•°æ®å¹³é¢è§£å†³æ–¹æ¡ˆï¼ˆå¦‚ Istioï¼‰æ‰€éœ€è¦çš„ã€‚&lt;/li&gt;
&lt;li&gt;Health Discovery Service (HDS)ï¼šè¯¥ API å°†å…è®¸ Envoy æˆä¸ºåˆ†å¸ƒå¼å¥åº·æ£€æŸ¥ç½‘ç»œçš„æˆå‘˜ã€‚ä¸­å¤®å¥åº·æ£€æŸ¥æœåŠ¡å¯ä»¥ä½¿ç”¨ä¸€ç»„ Envoy ä½œä¸ºå¥åº·æ£€æŸ¥ç»ˆç‚¹å¹¶å°†çŠ¶æ€æŠ¥å‘Šå›æ¥ï¼Œä»è€Œç¼“è§£ NÂ²å¥åº·æ£€æŸ¥é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜æŒ‡çš„æ˜¯å…¶é—´çš„æ¯ä¸ª Envoy éƒ½å¯èƒ½éœ€è¦å¯¹æ¯ä¸ªå…¶ä»– Envoy è¿›è¡Œå¥åº·æ£€æŸ¥ã€‚&lt;/li&gt;
&lt;li&gt;Aggregated Discovery Service (ADS)ï¼šæ€»çš„æ¥è¯´ï¼ŒEnvoy çš„è®¾è®¡æ˜¯æœ€ç»ˆä¸€è‡´çš„ã€‚è¿™æ„å‘³ç€é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªç®¡ç† API éƒ½å¹¶å‘è¿è¡Œï¼Œå¹¶ä¸”ä¸ä¼šç›¸äº’äº¤äº’ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€æ¬¡ä¸€ä¸ªç®¡ç†æœåŠ¡å™¨å¤„ç†å•ä¸ª Envoy çš„æ‰€æœ‰æ›´æ–°æ˜¯æœ‰ç›Šçš„ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœéœ€è¦å¯¹æ›´æ–°è¿›è¡Œæ’åºä»¥é¿å…æµé‡ä¸‹é™ï¼‰ã€‚æ­¤ API å…è®¸é€šè¿‡å•ä¸ªç®¡ç†æœåŠ¡å™¨çš„å•ä¸ª gRPC åŒå‘æµå¯¹æ‰€æœ‰å…¶ä»– API è¿›è¡Œç¼–ç»„ï¼Œä»è€Œå®ç°ç¡®å®šæ€§æ’åºã€‚&lt;/li&gt;
&lt;li&gt;Key Discovery Service (KDS)ï¼šè¯¥ API å°šæœªå®šä¹‰ï¼Œä½†æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªä¸“ç”¨çš„ API æ¥ä¼ é€’ TLS å¯†é’¥ææ–™ã€‚è¿™å°†è§£è€¦é€šè¿‡ LDS/CDS å‘é€ä¸»è¦ç›‘å¬å™¨ã€é›†ç¾¤é…ç½®å’Œé€šè¿‡ä¸“ç”¨å¯†é’¥ç®¡ç†ç³»ç»Ÿå‘é€ç§˜é’¥ç´ æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯‘è€…æ³¨ï¼šç›®å‰ xds ä¸­æ²¡æœ‰ kds çš„å®šä¹‰ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ª Secret Discovery Serviceï¼Œåº”è¯¥æ˜¯è¿™ä¸ª kds çš„æ”¹åã€‚ä»¥ä¸Š API è¯·å‚è€ƒ &lt;a href=&#34;https://github.com/envoyproxy/data-plane-api/tree/master/envoy/api/v2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/envoyproxy/data-plane-api/tree/master/envoy/api/v2&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬ç§°æ‰€æœ‰ä¸Šè¿° API ä¸º &lt;code&gt;xDS&lt;/code&gt;ã€‚ä» JSON/REST åˆ° proto3 API çš„è¿‡æ¸¡éå¸¸ä»¤äººå…´å¥‹ï¼Œè‰¯å¥½ç±»å‹çš„ proto3 API å¯ä»¥æ›´å®¹æ˜“ä½¿ç”¨ï¼Œæˆ‘è®¤ä¸ºè¿™å°†è¿›ä¸€æ­¥æé«˜ API æœ¬èº«ä»¥åŠ Envoy çš„æ¥å—åº¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¤šä»£ç†å¤šæ§åˆ¶å¹³é¢çš„-api&#34;&gt;å¤šä»£ç†å¤šæ§åˆ¶å¹³é¢çš„ APIï¼Ÿ&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼/è´Ÿè½½å‡è¡¡é¢†åŸŸç°åœ¨éå¸¸æ´»è·ƒã€‚ä»£ç†åŒ…æ‹¬ Envoyã€&lt;a href=&#34;https://linkerd.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd&lt;/a&gt;ã€&lt;a href=&#34;https://www.nginx.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NGINX&lt;/a&gt;ã€&lt;a href=&#34;https://www.haproxy.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HAProxy&lt;/a&gt;ã€&lt;a href=&#34;https://traefik.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Traefik&lt;/a&gt;ï¼Œæ¥è‡ªæ‰€æœ‰ä¸»è¦äº‘æä¾›å•†çš„è½¯ä»¶è´Ÿè½½å‡è¡¡å™¨ï¼Œä»¥åŠä¼ ç»Ÿç¡¬ä»¶ä¾›åº”å•†ï¼ˆå¦‚ F5 å’Œæ€ç§‘ï¼‰çš„ç‰©ç†è®¾å¤‡ã€‚éšç€ä¼—å¤šè§£å†³æ–¹æ¡ˆçš„å‡ºç°ï¼Œå¦‚ &lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;ã€&lt;a href=&#34;https://verizon.github.io/nelson/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Nelson&lt;/a&gt;ï¼Œé›†æˆäº‘è§£å†³æ–¹æ¡ˆä»¥åŠè®¸å¤šä¾›åº”å•†å³å°†æ¨å‡ºçš„äº§å“ç­‰ï¼Œæ§åˆ¶å¹³é¢é¢†åŸŸä¹Ÿåœ¨ä¸æ–­å‡æ¸©ã€‚&lt;/p&gt;
&lt;p&gt;ç‰¹åˆ«è®¨è®ºä¸€ä¸‹ Istioï¼ŒLinkerd å·²ç»å®£å¸ƒå¯¹å®ƒçš„æ”¯æŒï¼Œè¿™æ„å‘³ç€è‡³å°‘åœ¨æŸç§ç¨‹åº¦ä¸Šå®ƒå·²ç»å®ç°äº† v1 Envoy APIã€‚å…¶ä»–äººå¯èƒ½ä¼šè·Ÿéšã€‚åœ¨è¿™ä¸ªæ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢å¿«é€Ÿå‘å±•çš„æ–°ä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ç»„ä»¶çš„æ··åˆå’ŒåŒ¹é…ï¼›æ•°æ®å¹³é¢å°†ä¸è®¸å¤šæ§åˆ¶å¹³é¢ä¸€èµ·å·¥ä½œï¼Œåä¹‹äº¦ç„¶ã€‚æˆ‘ä»¬æ˜¯å¦å¯ä»¥è®©ä¸šç•Œå—ç›Šäºä¸€ç§é€šç”¨ APIï¼Œè®©è¿™ç§æ··åˆå’ŒåŒ¹é…æ›´å®¹æ˜“å®ç°ï¼Ÿè¿™ä¼šæœ‰ä»€ä¹ˆå¸®åŠ©ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘çœ‹æ¥ï¼Œåœ¨æ¥ä¸‹æ¥çš„å‡ å¹´ä¸­ï¼Œæ•°æ®å¹³é¢æœ¬èº«å°†å¤§éƒ¨åˆ†å•†å“åŒ–ã€‚å¤§éƒ¨åˆ†åˆ›æ–°ï¼ˆå’Œå•†ä¸šæœºä¼šæ‰©å±•ï¼‰å®é™…ä¸Šå°†æˆä¸ºæ§åˆ¶å¹³é¢çš„ä¸€éƒ¨åˆ†ã€‚ä½¿ç”¨ v2 Envoy APIï¼Œæ§åˆ¶å¹³é¢åŠŸèƒ½çš„èŒƒå›´å¯ä»¥ä¼šä»ä½¿ç”¨ NÂ² å¥åº·æ£€æŸ¥çš„æ‰å¹³ç«¯ç‚¹å‘½åç©ºé—´æ‰©å±•åˆ°ä¸€ä¸ªéå¸¸ä¸°å¯Œçš„å…¨å±€è´Ÿè½½å‡è¡¡ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿå¯è¿›è¡Œè‡ªåŠ¨æ„é€ å­é›†ã€è´Ÿè½½è£…å¸å’Œå‡è¡¡ã€åˆ†å¸ƒå¼å±€éƒ¨å¥åº·æ£€æŸ¥ã€åŒºåŸŸæ„ŸçŸ¥è·¯ç”±ã€åŸºäºç™¾åˆ†æ¯”çš„è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»šç­‰ã€‚ä¾›åº”å•†å°†åœ¨æä¾›æ— ç¼çš„å¾®æœåŠ¡è¿ç»´ç¯å¢ƒæ–¹é¢å±•å¼€ç«äº‰ï¼Œè€Œå¯¹è·¯ç”±çš„è‡ªåŠ¨åŒ–æ§åˆ¶å°†æ˜¯å…¶ç«äº‰ä¸­çš„ä¸»è¦éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªæ–°çš„ä¸–ç•Œä¸­ï¼Œæ•°æ®å¹³å°å¯ä»¥ç”¨æ¥ä¸æ§åˆ¶å¹³é¢è¿›è¡Œé€šè®¯çš„é€šç”¨ API å¯¹æ¯ä¸ªå‚ä¸è€…éƒ½æ˜¯ä¸€ä¸ªèƒœåˆ©ã€‚æ§åˆ¶å¹³é¢æä¾›å•†å¯ä»¥å°†å®ƒä»¬çš„æœåŠ¡æä¾›ç»™å®ç°è¯¥ API çš„ä»»ä½•æ•°æ®å¹³é¢ã€‚æ•°æ®å¹³é¢å¯ä»¥åœ¨åŠŸèƒ½ï¼Œæ€§èƒ½ï¼Œè§„æ¨¡å’Œå¥å£®æ€§æ–¹é¢å±•å¼€ç«äº‰ã€‚æ­¤å¤–ï¼Œè§£è€¦å…è®¸æ§åˆ¶å¹³é¢æä¾›å•†æä¾› SaaS è§£å†³æ–¹æ¡ˆï¼Œè€Œä¸éœ€è¦åŒæ—¶æ‹¥æœ‰æ•°æ®å¹³é¢éƒ¨ç½²ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸»è¦çš„ç—›ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-api-åˆä½œé‚€è¯·&#34;&gt;Envoy API åˆä½œé‚€è¯·&lt;/h2&gt;
&lt;p&gt;è™½ç„¶å¾ˆéš¾çŸ¥é“æœªæ¥å‡ å¹´ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œä½†æˆ‘ä»¬å¯¹ Envoy åŠå…¶ç›¸å…³ API çš„é‡‡ç”¨æ„Ÿåˆ°éå¸¸å…´å¥‹ã€‚æˆ‘ä»¬çœ‹åˆ°äº†é€šç”¨çš„æ•°æ®å¹³é¢ API çš„ä»·å€¼æ‰€åœ¨ï¼šå¯ä»¥æ¡¥æ¥ä¸åŒç³»ç»Ÿã€‚æ ¹æ®è¿™äº›åŸåˆ™ï¼Œæˆ‘ä»¬é‚€è¯·æ›´å¤§çš„æ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢ä¾›åº”å•†ä»¥åŠç”¨æˆ·ä¸æˆ‘ä»¬åœ¨ &lt;a href=&#34;https://github.com/envoyproxy/data-plane-api&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;em&gt;envoy-api&lt;/em&gt;&lt;/a&gt; å­˜å‚¨ä»“åº“ä¸­è¿›è¡Œåä½œï¼ˆè¯·æ³¨æ„ï¼Œå½“ Envoy è¿›å…¥ CNCF å¹¶è½¬æ¢åˆ°ä¸“ç”¨çš„ envoyproxy GitHub ç»„ç»‡æ—¶ï¼Œæˆ‘ä»¬å°†é‡å‘½åè¯¥å­˜å‚¨ä»“åº“ä¸º data-plane-apiï¼‰ã€‚æˆ‘ä»¬ä¸ä¿è¯æˆ‘ä»¬å°†æ·»åŠ æ‰€æœ‰å¯èƒ½çš„åŠŸèƒ½ï¼Œä½†æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°å…¶ä»–ç³»ç»Ÿä½¿ç”¨è¿™äº› API å¹¶å¸®åŠ©æˆ‘ä»¬æ”¹è¿›å®ƒä»¬ä»¥æ»¡è¶³ä»–ä»¬è‡ªå·±çš„éœ€æ±‚ã€‚æˆ‘ä»¬çš„è§‚ç‚¹æ˜¯ï¼Œæ•°æ®å¹³é¢çš„å•†å“åŒ–å°†ä¸ºæœ€ç»ˆç”¨æˆ·å¸¦æ¥å·¨å¤§æ”¶ç›Šï¼Œè¿™æœ‰åŠ©äºæ§åˆ¶å¹³é¢é¢†åŸŸæé«˜è¿­ä»£å’Œç«äº‰é€Ÿåº¦ï¼Œæœªæ¥å‡ å¹´å¤§éƒ¨åˆ†åˆ›æ–°å°†ä¼šå‘ç”Ÿåœ¨æ§åˆ¶å¹³é¢ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;è‹±æ–‡åŸæ–‡å‘å¸ƒäº 2017 å¹´ 9 æœˆ 6 æ—¥ï¼Œæœ¬æ–‡å‘å‡ºæ—¶ Envoy å·²ç»è¿›å…¥äº† CNCFï¼Œæˆä¸ºäº†å®˜æ–¹é¡¹ç›®ï¼ŒEnvoy åŸæ¥çš„ä»£ç éƒ½å·²ç»è¢«é‡æ„å’Œè¿ç§»ï¼Œæœ¬æ–‡ä¸­æåˆ°çš„å¾ˆå¤šé“¾æ¥éƒ½å·²è¿‡æ—¶ï¼Œè¯·å¤§å®¶å‚è€ƒ Envoy å®˜ç½‘ &lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.envoyproxy.io/&lt;/a&gt;ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹ Envoy å®˜æ–¹æ–‡æ¡£ä¸­æ–‡ç‰ˆ &lt;a href=&#34;https://servicemesher.github.io/envoy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://servicemesher.github.io/envoy/&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æœåŠ¡ç½‘æ ¼åœ¨ Cookpad ç½‘ç«™ä¸­çš„å®è·µ</title>
      <link>https://cloudnative.to/blog/service-mesh-in-cookpad/</link>
      <pubDate>Tue, 19 Jun 2018 15:54:19 +0800</pubDate>
      <guid>https://cloudnative.to/blog/service-mesh-in-cookpad/</guid>
      <description>&lt;p&gt;è¿™ä¸ªåŸæ–‡æ˜¯ 5 æœˆåˆå‘è¡¨çš„&lt;a href=&#34;http://techlife.cookpad.com/entry/2018/05/08/080000&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ—¥æ–‡åŸæ–‡&lt;/a&gt;çš„ç¿»è¯‘ã€‚è¡¥å……ä¸€ä¸‹è¿™ç¯‡æ–‡ç« çš„èƒŒæ™¯ï¼ŒCookpad æ˜¯ä¸€å®¶æ‹¥æœ‰ 200 å¤šç§äº§å“å¼€å‘çš„ä¸­å‹ç§‘æŠ€å…¬å¸ï¼Œæ‹¥æœ‰ 10 å¤šæ”¯å›¢é˜Ÿï¼Œæ¯æœˆå¹³å‡ç”¨æˆ·æ•°é‡è¾¾åˆ° 9000 ä¸‡ã€‚&lt;a href=&#34;https://www.cookpadteam.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.cookpadteam.com/&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä½ å¥½ï¼Œæˆ‘æ˜¯æ¥è‡ªç”Ÿäº§å›¢é˜Ÿçš„å¼€å‘äººå‘˜&lt;a href=&#34;https://github.com/taiki45/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Taiki&lt;/a&gt;ã€‚ç›®å‰ï¼Œæˆ‘æƒ³ä»‹ç»ä¸€ä¸‹åœ¨ Cookpad ä¸Šæ„å»ºå’Œä½¿ç”¨æœåŠ¡ç½‘æ ¼æ‰€è·å¾—çš„çŸ¥è¯†ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæœåŠ¡ç½‘æ ¼æœ¬èº«ï¼Œæˆ‘è®¤ä¸ºæ‚¨å°†å¯¹ä»¥ä¸‹æ–‡ç« ï¼Œå…¬å‘Šå’Œæ•™ç¨‹æœ‰å®Œæ•´çš„äº†è§£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://speakerdeck.com/taiki45/observability-service-mesh-and-microservices&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://speakerdeck.com/taiki45/observability-service-mesh-and-microservices&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://buoyant.io/2017/04/25/whats-a-service-mesh-and-why-do-i-need-one/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://buoyant.io/2017/04/25/whats-a-service-mesh-and-why-do-i-need-one/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istioio.io/docs/setup/kubernetes/quick-start.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istioio.io/docs/setup/kubernetes/quick-start.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/playlist?list=PLj6h78yzYM2P-3-xqvmWaZbbI1sW-ulZb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.youtube.com/playlist?list=PLj6h78yzYM2P-3-xqvmWaZbbI1sW-ulZb&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æˆ‘ä»¬çš„ç›®æ ‡&#34;&gt;æˆ‘ä»¬çš„ç›®æ ‡&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªæœåŠ¡ç½‘æ ¼æ¥è§£å†³æ•…éšœæ’é™¤ï¼Œå®¹é‡è§„åˆ’å’Œä¿æŒç³»ç»Ÿå¯é æ€§ç­‰æ“ä½œé—®é¢˜ã€‚å°¤å…¶æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é™ä½æœåŠ¡ç»„çš„ç®¡ç†æˆæœ¬&lt;/li&gt;
&lt;li&gt;å¯è§‚å¯Ÿæ€§çš„æ”¹è¿› (åˆ†åˆ«å‚è€ƒäº† &lt;a href=&#34;https://blog.twitter.com/engineering/en_us/a/2013/observability-at-twitter.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt; Twitter &lt;/a&gt; å’Œ &lt;a href=&#34;https://medium.com/@copyconstruct/monitoring-and-observability-8417d1952e1c&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Medium çš„åšå®¢&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;å»ºç«‹æ›´å¥½çš„æ•…éšœéš”ç¦»æœºåˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å°±ç¬¬ä¸€ä¸ªé—®é¢˜è€Œè¨€ï¼Œéšç€è§„æ¨¡çš„æ‰©å¤§ï¼Œå­˜åœ¨éš¾ä»¥æŒæ¡å“ªä¸ªæœåŠ¡å’Œå“ªä¸ªæœåŠ¡æ­£åœ¨è¿›è¡Œé€šä¿¡ï¼ŒæŸä¸ªæœåŠ¡çš„å¤±è´¥æ˜¯å“ªé‡Œä¼ æ’­å¯¼è‡´çš„é—®é¢˜ã€‚æˆ‘è®¤ä¸ºè¿™ä¸ªé—®é¢˜åº”è¯¥é€šè¿‡ç»¼åˆç®¡ç†æœåŠ¡åœ¨å“ªé‡Œå’ŒæœåŠ¡åœ¨å“ªé‡Œè¿æ¥çš„ç›¸å…³ä¿¡æ¯æ¥è§£å†³ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºç¬¬äºŒä¸ªé—®é¢˜è€Œè¨€ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥æ·±ç©¶äº†ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å‘ç°æˆ‘ä»¬ä¸çŸ¥é“ä¸€ä¸ªæœåŠ¡ä¸å¦ä¸€ä¸ªæœåŠ¡ä¹‹é—´çš„é€šä¿¡çŠ¶æ€ã€‚ä¾‹å¦‚ï¼ŒRPSã€å“åº”æ—¶é—´ã€æˆåŠŸ/å¤±è´¥çŠ¶æ€çš„æ•°é‡ã€è¶…æ—¶ã€æ–­è·¯å™¨çš„æ¿€æ´»çŠ¶æ€ç­‰ã€‚åœ¨ä¸¤ä¸ªæˆ–æ›´å¤šä¸ªæœåŠ¡å¼•ç”¨æŸä¸ªåç«¯æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œå› ä¸ºå®ƒä»¬æœªè¢«è¯·æ±‚æºæœåŠ¡æ ‡è®°ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´åç«¯æœåŠ¡çš„ä»£ç†è§£ææˆ–è´Ÿè½½å‡è¡¡å™¨çš„åº¦é‡æ ‡å‡†ä¿¡æ¯ä¸è¶³ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œâ€œæ•…éšœéš”ç¦»å°šæœªæˆåŠŸè®¾ç½®â€ã€‚æ­¤æ—¶ï¼Œåœ¨å„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨åº“ï¼Œè¶…æ—¶/é‡è¯•Â·æ–­è·¯å™¨çš„è®¾ç½®å®Œæˆäº†ã€‚ä½†æ˜¯éœ€è¦ä»€ä¹ˆæ ·çš„è®¾ç½®ï¼Œå¿…éœ€å•ç‹¬æŸ¥çœ‹åº”ç”¨ç¨‹åºä»£ç ã€‚ç”±äºæ²¡æœ‰é…ç½®æ¸…å•ï¼Œä¼šå¯¼è‡´éš¾ä»¥æŒç»­æ”¹è¿›è¿™äº›è®¾ç½®ã€‚å¦å¤–ï¼Œå› ä¸ºä¸æ•…éšœéš”ç¦»æœ‰å…³çš„è®¾ç½®åº”è¯¥ä¸æ–­æ”¹è¿›ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯å¯æµ‹è¯•çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦è¿™æ ·ä¸€ä¸ªåŸºç¡€å¹³å°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³æ›´é«˜çº§çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜æ„å»ºäº† gRPC åŸºç¡€è®¾æ–½å»ºè®¾ï¼Œé…é€è·Ÿè¸ªå¤„ç†å§”æ‰˜ï¼Œæµé‡æ§åˆ¶éƒ¨ç½²æ–¹å¼å¤šæ ·åŒ–ï¼Œè®¤è¯æˆæƒç½‘å…³ç­‰åŠŸèƒ½ã€‚è¿™éƒ¨åˆ†å°†åœ¨ç¨åè®¨è®ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;å½“å‰çŠ¶æ€&#34;&gt;å½“å‰çŠ¶æ€&lt;/h2&gt;
&lt;p&gt;Cookpad ä¸­çš„æœåŠ¡ç½‘æ ¼ä½¿ç”¨ Envoy ä½œä¸º data-planeï¼Œå¹¶åˆ›å»ºäº†æˆ‘ä»¬è‡ªå·±çš„ control-planeã€‚å°½ç®¡æˆ‘ä»¬æœ€åˆè€ƒè™‘å®‰è£…å·²ç»ä½œä¸ºæœåŠ¡ç½‘æ ¼å®ç°çš„ &lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;ï¼Œä½† &lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cookpad&lt;/a&gt; ä¸­çš„åº”ç”¨ç¨‹åºå¤§å¤šæ•°éƒ½ä½¿ç”¨åä¸º AWS ECS çš„å®¹å™¨ç®¡ç†æœåŠ¡è¿›è¡Œæ“ä½œï¼Œå› æ­¤ä¸ Kubernetes åˆä½œçš„ä¼˜ç‚¹æ˜¯æœ‰é™çš„ã€‚è€ƒè™‘åˆ°æˆ‘ä»¬æƒ³å®ç°çš„ç›®æ ‡ä»¥åŠ Istio è½¯ä»¶æœ¬èº«çš„å¤æ‚æ€§ï¼Œæˆ‘ä»¬é€‰æ‹©äº†æˆ‘ä»¬è‡ªå·±çš„ control-plane çš„è·¯å¾„ï¼Œè¯¥å¹³é¢å¯ä»¥ä»å°å‹èµ·æ­¥ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤æ¬¡å®æ–½çš„æœåŠ¡ç½‘æ ¼çš„ control-plane åˆ†ç”±å‡ ä¸ªç»„ä»¶ç»„æˆã€‚æˆ‘å°†è§£é‡Šæ¯ä¸ªç»„ä»¶çš„è§’è‰²å’Œæ“ä½œæµç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é›†ä¸­ç®¡ç†æœåŠ¡ç½‘æ ¼é…ç½®çš„å­˜å‚¨åº“ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨åä¸º &lt;a href=&#34;https://github.com/taiki45/kumonos&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kumonos&lt;/a&gt; çš„ gem ä»ä¸Šé¢çš„è®¾ç½®æ–‡ä»¶ç”Ÿæˆ &lt;a href=&#34;https://github.com/envoyproxy/data-plane-api/blob/5ea10b04a950260e1af0572aa244846b6599a38f/API_OVERVIEW.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy xDS API&lt;/a&gt; å“åº” JSON&lt;/li&gt;
&lt;li&gt;å°†ç”Ÿæˆçš„å“åº” JSON æ”¾ç½®åœ¨ Amazon S3 ä¸Šï¼Œå¹¶å°†å…¶ç”¨ä½œ Envoy çš„ xDS API&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ä¸­å¤®å­˜å‚¨åº“ä¸­ç®¡ç†è¯¥è®¾ç½®çš„åŸå› æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘ä»¬å¸Œæœ›éšæ—¶è·Ÿè¸ªæ›´æ”¹å†å²è®°å½•å¹¶åœ¨ç¨åè·Ÿè¸ªè®°å½•å®ƒ&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿé€šè¿‡è·¨ç»„ç»‡å›¢é˜Ÿï¼ˆå¦‚ SRE å›¢é˜Ÿï¼‰æ¥æŸ¥çœ‹è®¾ç½®æ›´æ”¹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äºè´Ÿè½½å‡è¡¡ï¼Œæˆ‘æœ€åˆæ˜¯ä¸º Internal ELB è®¾è®¡çš„ï¼Œä½† gRPC åº”ç”¨ç¨‹åºçš„åŸºç¡€æ¶æ„ä¹Ÿç¬¦åˆè¦æ±‚ï¼ˆæˆ‘ä»¬çš„ gRPC åº”ç”¨ç¨‹åºå·²ç»åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ­¤æœºåˆ¶ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ SDSï¼ˆService Discovery Serviceï¼‰APIï¼ˆç®€å•åœ°ä½¿ç”¨å†…éƒ¨ ELBï¼ˆNLB æˆ– TCP æ¨¡å¼ CLBï¼‰çš„ æœåŠ¡ç«¯ä¾§è´Ÿè½½å‡è¡¡ä¸å‡è¡¡è€Œåœ¨æ€§èƒ½æ–¹é¢å…·æœ‰ç¼ºé™·ï¼Œå¹¶ä¸”åœ¨å¯è·å¾—çš„åº¦é‡æ–¹é¢ä¹Ÿæ˜¯ä¸å¤Ÿçš„ï¼‰å‡†å¤‡äº†å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€‚æˆ‘ä»¬åœ¨ ECS ä»»åŠ¡ä¸­éƒ¨ç½²äº†ä¸€ä¸ª sidecar å®¹å™¨ï¼Œç”¨äºå¯¹åº”ç”¨ç¨‹åºå®¹å™¨æ‰§è¡Œå¥åº·æ£€æŸ¥å¹¶åœ¨ SDS API ä¸­æ³¨å†Œè¿æ¥ç›®æ ‡ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/service-mesh-in-cookpad/61411417ly1fs7pzdtqd9j20n60dq40a_hu97d0d0d8eee9da3899ea7c34c6f536bf_41949_580eca8265d98bf995a16293a6ef2b69.webp 400w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pzdtqd9j20n60dq40a_hu97d0d0d8eee9da3899ea7c34c6f536bf_41949_a79b14d2013582d23861d6aea88065ed.webp 760w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pzdtqd9j20n60dq40a_hu97d0d0d8eee9da3899ea7c34c6f536bf_41949_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-in-cookpad/61411417ly1fs7pzdtqd9j20n60dq40a_hu97d0d0d8eee9da3899ea7c34c6f536bf_41949_580eca8265d98bf995a16293a6ef2b69.webp&#34;
               width=&#34;760&#34;
               height=&#34;450&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åº¦é‡æŒ‡æ ‡ï¼ˆmetricï¼‰çš„é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†æ‰€æœ‰æŒ‡æ ‡å­˜å‚¨åˆ° Prometheus&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.6.0/api-v2/config/metrics/v2/stats.proto#config-metrics-v2-dogstatsdsink&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;dog_statsd&lt;/a&gt; å°†æ ‡è®°çš„åº¦é‡æ ‡å‡†å‘é€åˆ° ECS å®¹å™¨ä¸»æœºå®ä¾‹ä¸Šè¿è¡Œçš„ &lt;a href=&#34;https://github.com/prometheus/statsd_exporter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;statsd_exporter&lt;/a&gt; ï¼ˆèµ·åˆæˆ‘å°†å®ƒä½œä¸ºæˆ‘ä»¬è‡ªå·±çš„æ‰©å±•å®ç°ï¼Œä½†åæ¥æˆ‘æŠŠè¿™ä¸ªä¿®æ”¹ä½œä¸º&lt;a href=&#34;https://github.com/envoyproxy/envoy/pull/2158&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¡¥ä¸&lt;/a&gt;æäº¤äº†ï¼‰&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰æŒ‡æ ‡éƒ½åŒ…å«é€šè¿‡ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.6.0/api-v2/config/metrics/v2/stats.proto#config-metrics-v2-statsconfig&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å›ºå®šå­—ç¬¦ä¸²æ ‡ç­¾&lt;/a&gt; çš„åº”ç”¨ç¨‹åº ID æ¥æ ‡è¯†æ¯ä¸ªèŠ‚ç‚¹ (è¿™ä¸ªæ˜¯æˆ‘ä»¬çš„å¦ä¸€ä¸ª&lt;a href=&#34;https://github.com/envoyproxy/envoy/pull/2357&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¡¥ä¸&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Prometheus ä½¿ç”¨ &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/configuration/configuration/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EC2 SD&lt;/a&gt; æ¥æå– statsd_exporter æŒ‡æ ‡&lt;/li&gt;
&lt;li&gt;è¦ç®¡ç† Prometheus çš„ç«¯å£ï¼Œæˆ‘ä»¬åœ¨ statsd_exporter å’Œ Prometheus ä¹‹é—´ä½¿ç”¨ &lt;a href=&#34;https://github.com/rrreeeyyy/exporter_proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;exporter_proxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Grafana å’Œ &lt;a href=&#34;https://medium.com/netflix-techblog/vizceral-open-source-acc0c32113fe&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Vizceral&lt;/a&gt; è¿›è¡Œåº¦é‡æŒ‡æ ‡çš„å¯è§†åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæ‚¨åœ¨ä¸ä½¿ç”¨ ECS æˆ– Docker çš„æƒ…å†µä¸‹ç›´æ¥åœ¨ EC2 å®ä¾‹ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºè¿›ç¨‹ï¼Œåˆ™ Envoy è¿›ç¨‹ä½œä¸ºå®ˆæŠ¤è¿›ç¨‹ç›´æ¥åœ¨å®ä¾‹ä¸­è¿è¡Œï¼Œä½†æ¶æ„å‡ ä¹ç›¸åŒã€‚æœ‰ä¸€ä¸ªåŸå› æ˜¯æ²¡æœ‰å°† Prometheus ç›´æ¥è®¾ç½®ä¸º Envoyï¼Œå› ä¸ºæˆ‘ä»¬ä»ç„¶æ— æ³•ä» Envoy çš„ Prometheus å…¼å®¹ç«¯ç‚¹ä¸­æå–&lt;a href=&#34;https://github.com/envoyproxy/envoy/issues/1947&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç›´æ–¹å›¾åº¦é‡&lt;/a&gt;ã€‚ç”±äºè¿™å°†åœ¨æœªæ¥å¾—åˆ°æ”¹å–„ï¼Œæˆ‘ä»¬è®¡åˆ’åœ¨å½“æ—¶æ¶ˆé™¤ stasd_exporterã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv3rapdj20sg0qvgpb_hud7fded0d5d16f1e967cae3b32e748e21_70018_bb780124554847512a5dd004d2fb79b5.webp 400w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv3rapdj20sg0qvgpb_hud7fded0d5d16f1e967cae3b32e748e21_70018_4fac789117db32ffb225d0089781f1e2.webp 760w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv3rapdj20sg0qvgpb_hud7fded0d5d16f1e967cae3b32e748e21_70018_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-in-cookpad/61411417ly1fs7pv3rapdj20sg0qvgpb_hud7fded0d5d16f1e967cae3b32e748e21_70018_bb780124554847512a5dd004d2fb79b5.webp&#34;
               width=&#34;760&#34;
               height=&#34;717&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ Grafana ä¸Šï¼Œä»ªè¡¨æ¿å’Œ Envoy çš„æ•´ä¸ªä»ªè¡¨æ¿éƒ½ä¸ºæ¯é¡¹æœåŠ¡åšå¥½å‡†å¤‡ï¼Œä¾‹å¦‚ä¸Šæ¸¸ RPS å’Œè¶…æ—¶å‘ç”Ÿã€‚æˆ‘ä»¬è¿˜å°†å‡†å¤‡ä¸€ä¸ªæœåŠ¡å¤§å°å’ŒæœåŠ¡ç²’åº¦çš„ä»ªè¡¨æ¿ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªæœåŠ¡çš„ä»ªè¡¨æ¿ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv4dqikj20sg0mp11e_huace5460cf2779fd633c582675de37918_117987_32dc954152eaa53021b2689555d68cca.webp 400w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv4dqikj20sg0mp11e_huace5460cf2779fd633c582675de37918_117987_3d43b77e2b74677f4a9510a82e0d0672.webp 760w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv4dqikj20sg0mp11e_huace5460cf2779fd633c582675de37918_117987_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-in-cookpad/61411417ly1fs7pv4dqikj20sg0mp11e_huace5460cf2779fd633c582675de37918_117987_32dc954152eaa53021b2689555d68cca.webp&#34;
               width=&#34;760&#34;
               height=&#34;606&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œä¸Šæ¸¸æ•…éšœæ—¶çš„æ–­è·¯å™¨ç›¸å…³æŒ‡æ ‡ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv4kw6vj20i40d9q41_hu44a9c3dd8d355890747e6c30c0e619de_41913_2b64d860b73932d2974f72b02f8f8c18.webp 400w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv4kw6vj20i40d9q41_hu44a9c3dd8d355890747e6c30c0e619de_41913_228305d558275cc2a2cce9cb2cd46194.webp 760w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv4kw6vj20i40d9q41_hu44a9c3dd8d355890747e6c30c0e619de_41913_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-in-cookpad/61411417ly1fs7pv4kw6vj20i40d9q41_hu44a9c3dd8d355890747e6c30c0e619de_41913_2b64d860b73932d2974f72b02f8f8c18.webp&#34;
               width=&#34;652&#34;
               height=&#34;477&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Envoy çš„ä»ªè¡¨æ¿ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv4rqrij20sg0qa49n_huc0090687b62ec73540b59c8b12e0f6c1_161258_d6b1ce30e87aa6f0be355d69ab8211c1.webp 400w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv4rqrij20sg0qa49n_huc0090687b62ec73540b59c8b12e0f6c1_161258_6bdbbecfb41b998183570e77e0e9c93c.webp 760w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv4rqrij20sg0qa49n_huc0090687b62ec73540b59c8b12e0f6c1_161258_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-in-cookpad/61411417ly1fs7pv4rqrij20sg0qa49n_huc0090687b62ec73540b59c8b12e0f6c1_161258_d6b1ce30e87aa6f0be355d69ab8211c1.webp&#34;
               width=&#34;760&#34;
               height=&#34;702&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Netflix å¼€å‘çš„ Vizceral å¯è§†åŒ–æœåŠ¡é…ç½®ã€‚ä¸ºäº†å®ç°ï¼Œæˆ‘ä»¬å¼€å‘äº† &lt;a href=&#34;https://github.com/nghialv/promviz&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;promviz&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/mjhd-devlion/promviz-front&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;promviz-front&lt;/a&gt; çš„ forkï¼ˆä¸ºäº†æ–¹ä¾¿ç”¨ nginx äº¤ä»˜å¹¶ç¬¦åˆ Cookpad ä¸­çš„æœåŠ¡ç»„åˆï¼‰ã€‚ç”±äºæˆ‘ä»¬ä»…åœ¨æŸäº›æœåŠ¡ä¸­å¼•å…¥ï¼Œå› æ­¤å½“å‰æ˜¾ç¤ºçš„èŠ‚ç‚¹æ•°é‡å¾ˆå°‘ï¼Œä½†æˆ‘ä»¬æä¾›äº†ä»¥ä¸‹ä»ªè¡¨æ¿ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ª region çš„æœåŠ¡é…ç½®å›¾ã€RPSã€é”™è¯¯ç‡ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv47xzjj20sg0gxdjd_hu20a734b7fd6b9eb09d1bfab3d1fb7335_47789_f670a26015f9104f808e5c7b4029b3c1.webp 400w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv47xzjj20sg0gxdjd_hu20a734b7fd6b9eb09d1bfab3d1fb7335_47789_e1e623e1cb4fddc9b270635fcb7269bb.webp 760w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv47xzjj20sg0gxdjd_hu20a734b7fd6b9eb09d1bfab3d1fb7335_47789_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-in-cookpad/61411417ly1fs7pv47xzjj20sg0gxdjd_hu20a734b7fd6b9eb09d1bfab3d1fb7335_47789_f670a26015f9104f808e5c7b4029b3c1.webp&#34;
               width=&#34;760&#34;
               height=&#34;452&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç‰¹å®šæœåŠ¡çš„ downstream/upstreamï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv3xymcj20sg0i2acs_hu2002807103766e474ecb5659f97686f5_45364_85a75784486cbe45b6222e7a3041110b.webp 400w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv3xymcj20sg0i2acs_hu2002807103766e474ecb5659f97686f5_45364_475110bd8781c09ff47dc2be54436988.webp 760w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv3xymcj20sg0i2acs_hu2002807103766e474ecb5659f97686f5_45364_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-in-cookpad/61411417ly1fs7pv3xymcj20sg0i2acs_hu2002807103766e474ecb5659f97686f5_45364_85a75784486cbe45b6222e7a3041110b.webp&#34;
               width=&#34;760&#34;
               height=&#34;483&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œä½œä¸ºæœåŠ¡ç½‘æ ¼çš„ä¸€ä¸ªå­ç³»ç»Ÿï¼Œä½ å¿…é¡»éƒ¨ç½²ç½‘å…³ä»å¼€å‘å•†æ‰‹ä¸­è·å¾— staging ç¯å¢ƒçš„ gRPC æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼ˆå‡è®¾ä½¿ç”¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡è¿›è¡Œè®¿é—®ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç»„ä»¶æ¥è§£å†³å®ƒï¼‰ã€‚å®ƒæ˜¯é€šè¿‡å°† SDS API å’Œ Envoy ä¸ç®¡ç†ç§°ä¸º &lt;a href=&#34;http://techlife.cookpad.com/entry/2018/04/02/140846&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;hako-console&lt;/a&gt; çš„å†…éƒ¨åº”ç”¨ç¨‹åºçš„è½¯ä»¶ç›¸ç»“åˆè€Œæ„å»ºçš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Gateway appï¼ˆEnvoyï¼‰å‘ gateway controller å‘é€ xDS API è¯·æ±‚&lt;/li&gt;
&lt;li&gt;Gateway controller ä» hako-console è·å– staging ç¯å¢ƒä¸­çš„ gRPC åº”ç”¨ç¨‹åºåˆ—è¡¨ï¼Œå¹¶åŸºäºè¯¥å“åº”è¿”å› Route Discovery Service/Cluster Discovery Service API å“åº”&lt;/li&gt;
&lt;li&gt;Gateway app æ ¹æ®å“åº”ä» SDS API è·å–å®é™…è¿æ¥ç›®çš„åœ°&lt;/li&gt;
&lt;li&gt;ä»å¼€å‘äººå‘˜æ‰‹ä¸­å¼•ç”¨ AWS ELB Network Load Balancerï¼ŒGateway app æ‰§è¡Œè·¯ç”±&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv42jzej20sg0mmtaz_hu91e49d3aca189bea0560e1dd05d424fd_48289_fc03be13ec4479eeb91f1bf8b7c5a54b.webp 400w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv42jzej20sg0mmtaz_hu91e49d3aca189bea0560e1dd05d424fd_48289_76a25b4092732f150a2e8463def719cc.webp 760w,
               /blog/service-mesh-in-cookpad/61411417ly1fs7pv42jzej20sg0mmtaz_hu91e49d3aca189bea0560e1dd05d424fd_48289_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/service-mesh-in-cookpad/61411417ly1fs7pv42jzej20sg0mmtaz_hu91e49d3aca189bea0560e1dd05d424fd_48289_fc03be13ec4479eeb91f1bf8b7c5a54b.webp&#34;
               width=&#34;760&#34;
               height=&#34;604&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æ•ˆæœ&#34;&gt;æ•ˆæœ&lt;/h2&gt;
&lt;p&gt;å¼•å…¥æœåŠ¡ç½‘æ ¼æœ€æ˜¾ç€çš„æ˜¯å®ƒèƒ½å¤ŸæŠ‘åˆ¶ä¸´æ—¶æ•…éšœçš„å½±å“ã€‚æœ‰è®¸å¤šæµé‡çš„æœåŠ¡ä¹‹å‰æœ‰å¤šä¸ªåä½œéƒ¨åˆ†ï¼Œåˆ°ç°åœ¨ä¸ºæ­¢ï¼Œ200 å¤šä¸ªä¸ç½‘ç»œç›¸å…³çš„çç¢é”™è¯¯ï¼ˆä¸æµé‡ç›¸æ¯”ï¼Œè¿™ä¸ªæ•°å­—éå¸¸å°ï¼‰åœ¨ä¸€å°æ—¶å†…ä¸€ç›´åœ¨ä¸æ–­åœ°å‘ç”Ÿçš„ï¼ˆè¿™æ˜¯å› ä¸ºæœ‰äº›åœ°æ–¹è®¾ç½®äº†é‡è¯•ï¼‰ï¼Œå®ƒä»¬æ˜¯ç”±æœåŠ¡ç½‘æ ¼æ ¹æ®æƒ…å†µé€‚å½“è®¾ç½®çš„çš„é‡è¯•è®¾ç½®ï¼Œä»–å·²ç»ä¸‹é™åˆ°æ¯å‘¨ 1 ä¾‹å·¦å³ã€‚&lt;/p&gt;
&lt;p&gt;ä»ç›‘æµ‹çš„è§’åº¦æ¥çœ‹ï¼Œå„ç§æŒ‡æ ‡å·²ç»å‡ºç°ï¼Œä½†ç”±äºæˆ‘ä»¬åªæ˜¯é’ˆå¯¹æŸäº›æœåŠ¡å¼•å…¥äº†è¿™äº›æŒ‡æ ‡ï¼Œå¹¶ä¸”ç”±äºæ¨å‡ºæ—¥æœŸæˆ‘ä»¬è¿˜æ²¡æœ‰è¾¾åˆ°å…¨é¢ä½¿ç”¨ï¼Œæˆ‘ä»¬é¢„è®¡å°†æ¥ä¼šä½¿ç”¨å®ƒã€‚åœ¨ç®¡ç†æ–¹é¢ï¼Œå› ä¸ºæœåŠ¡ä¹‹é—´çš„è¿æ¥å·²ç»æˆä¸ºä¸€ä¸ªå®¹æ˜“ç†è§£å’Œå¯è§†åŒ–ï¼Œå› æ­¤æˆ‘ä»¬å¸Œæœ›é€šè¿‡å°†æœåŠ¡ç½‘æ ¼å¼•å…¥æ‰€æœ‰çš„åº”ç”¨æœåŠ¡æ¥é¿å…å¿½è§†å’Œå¿½ç•¥å¯¹è±¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å°†æ¥çš„è®¡åˆ’&#34;&gt;å°†æ¥çš„è®¡åˆ’&lt;/h2&gt;
&lt;h4 id=&#34;è¿ç§»åˆ°-v2-apiè½¬æ¢åˆ°-istio&#34;&gt;è¿ç§»åˆ° v2 APIï¼Œè½¬æ¢åˆ° Istio&lt;/h4&gt;
&lt;p&gt;ç”±äº xDS API çš„åˆå§‹è®¾è®¡æƒ…å†µå’Œä½¿ç”¨ S3 ä½œä¸ºåç«¯äº¤ä»˜çš„è¦æ±‚ï¼ŒxDS API ä¸€ç›´åœ¨ä½¿ç”¨ v1ï¼Œä½†ç”±äº v1 API å·²è¢«å¼ƒç”¨ï¼Œå› æ­¤æˆ‘ä»¬è®¡åˆ’å°†å…¶ç§»è‡³ v2ã€‚ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬æ­£åœ¨è€ƒè™‘å°† control-plane ç§»è‡³ Istioã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬è¦æ„å»ºæˆ‘ä»¬è‡ªå·±çš„ control-planeï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ &lt;a href=&#34;https://github.com/envoyproxy/go-control-plane&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;go-control-plane&lt;/a&gt; æ¥æ„å»º &lt;a href=&#34;https%ef%bc%9a//github.com/envoyproxy/data-plane-api/blob/5ea10b04a950260e1af0572aa244846b6599a38f/API_OVERVIEW.md#apis&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;LDS/RDS/CDS/EDS API&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ›¿æ¢åå‘ä»£ç†&#34;&gt;æ›¿æ¢åå‘ä»£ç†&lt;/h4&gt;
&lt;p&gt;åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒCookpad ä½¿ç”¨ nginx ä½œä¸ºåå‘ä»£ç†ï¼Œä½†æ˜¯æˆ‘ä»¬è€ƒè™‘åˆ° nginx å’Œ Envoy åœ¨å†…éƒ¨æŠ€æœ¯å®ç°ã€gRPC é€šä¿¡å’Œé‡‡é›†åº¦é‡æ–¹é¢çš„å·®å¼‚ï¼Œæˆ‘ä»¬å°†è€ƒè™‘ç”¨ Envoy æ›¿æ¢ nginx çš„åå‘ä»£ç†å’Œè¾¹ç¼˜ä»£ç†ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æµé‡æ§åˆ¶&#34;&gt;æµé‡æ§åˆ¶&lt;/h4&gt;
&lt;p&gt;éšç€æˆ‘ä»¬è½¬å‘å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å¹¶å–ä»£åå‘ä»£ç†ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿé€šè¿‡æ“ä½œ Envoy æ›´æ–¹ä¾¿çš„å¤„ç†æµé‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†èƒ½å¤Ÿå®ç°é‡‘ä¸é›€éƒ¨ç½²ã€æµé‡è½¬ç§»å’Œè¯·æ±‚é•œåƒã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ•…éšœæ³¨å…¥&#34;&gt;æ•…éšœæ³¨å…¥&lt;/h4&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªæ•…æ„åœ¨æ­£ç¡®ç®¡ç†çš„ç¯å¢ƒä¸­æ³¨å…¥å»¶è¿Ÿå’Œæ•…éšœçš„æœºåˆ¶ï¼Œå¹¶æµ‹è¯•å®é™…æœåŠ¡ç»„æ˜¯å¦å¯ä»¥æ­£å¸¸å·¥ä½œã€‚Envoy æœ‰å„ç§&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/v1.6.0/configuration/http_filters/fault_filter.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠŸèƒ½&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åœ¨-data-plane-å±‚ä¸Šæ‰§è¡Œåˆ†å¸ƒå¼è·Ÿè¸ª&#34;&gt;åœ¨ data-plane å±‚ä¸Šæ‰§è¡Œåˆ†å¸ƒå¼è·Ÿè¸ª&lt;/h4&gt;
&lt;p&gt;åœ¨ Cookpad é‡Œï¼ŒAWS X-Ray è¢«ç”¨ä½œ&lt;a href=&#34;http://techlife.cookpad.com/entry/2017/09/06/115710&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿ&lt;/a&gt;ã€‚ç›®å‰ï¼Œæˆ‘ä»¬å°†åˆ†å¸ƒå¼è·Ÿè¸ªåŠŸèƒ½ä½œä¸ºä¸€ä¸ªåº“æ¥å®ç°ï¼Œä½†æˆ‘ä»¬è®¡åˆ’å°†å…¶ç§»è‡³ data-plane å¹¶åœ¨æœåŠ¡ç½‘æ ¼å±‚å®ç°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;èº«ä»½éªŒè¯æˆæƒç½‘å…³&#34;&gt;èº«ä»½éªŒè¯æˆæƒç½‘å…³&lt;/h4&gt;
&lt;p&gt;è¿™æ˜¯ä¸ºäº†ä»…åœ¨æ¥æ”¶ç”¨æˆ·è¯·æ±‚çš„æœ€å‰ç«¯æœåŠ¡å™¨è¿›è¡Œè®¤è¯å’Œæˆæƒå¤„ç†ï¼Œéšåçš„æœåŠ¡å™¨å°†ä½¿ç”¨ç»“æœã€‚ä»¥å‰ï¼Œå®ƒä¸å®Œå…¨æ˜¯ä½œä¸ºä¸€ä¸ªåº“æ¥å®æ–½çš„ï¼Œä½†æ˜¯é€šè¿‡è½¬å‘ data-planeï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—è¿‡ç¨‹æ¨¡å‹çš„ä¼˜ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœ€å&#34;&gt;æœ€å&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»ä»‹ç»äº† Cookpad ä¸­æœåŠ¡ç½‘æ ¼çš„ç°çŠ¶å’Œæœªæ¥è®¡åˆ’ã€‚è®¸å¤šåŠŸèƒ½å·²ç»å¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç°ï¼Œå¹¶ä¸”ç”±äºæœªæ¥æœåŠ¡ç½‘æ ¼å±‚å¯ä»¥å®Œæˆæ›´å¤šçš„å·¥ä½œï¼Œå› æ­¤å¼ºçƒˆå»ºè®®æ¯ä¸ªå¾®æœåŠ¡ç³»ç»Ÿéƒ½é‡‡ç”¨æœåŠ¡ç½‘æ ¼ã€‚&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
