<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Ambient | äº‘åŸç”Ÿç¤¾åŒºï¼ˆä¸­å›½ï¼‰</title>
    <link>https://cloudnativecn.com/tag/ambient/</link>
      <atom:link href="https://cloudnativecn.com/tag/ambient/index.xml" rel="self" type="application/rss+xml" />
    <description>Ambient</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><lastBuildDate>Fri, 09 May 2025 10:35:46 +0800</lastBuildDate>
    <image>
      <url>https://cloudnativecn.com/media/sharing.png</url>
      <title>Ambient</title>
      <link>https://cloudnativecn.com/tag/ambient/</link>
    </image>
    
    <item>
      <title>Istio 1.26 å‘å¸ƒï¼šå¢å¼º Gateway API æ”¯æŒï¼Œæ‹¥æŠ± Kubernetes æœªæ¥ â€”â€” åŒæ—¶å‘Šåˆ« 1.23 ç‰ˆæœ¬</title>
      <link>https://cloudnativecn.com/blog/istio-1-26-release-and-1-23-eol/</link>
      <pubDate>Fri, 09 May 2025 10:35:46 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-1-26-release-and-1-23-eol/</guid>
      <description>&lt;p&gt;2025å¹´5æœˆ8æ—¥ï¼ŒIstio ç¤¾åŒºæ­£å¼å‘å¸ƒäº† &lt;strong&gt;Istio 1.26&lt;/strong&gt;ã€‚è¿™æ˜¯ä¸€æ¬¡åœ¨åŠŸèƒ½ã€å¯æ‰©å±•æ€§ã€å®‰å…¨æ€§ä¸å¹³å°é€‚é…æ€§æ–¹é¢å…¨é¢æå‡çš„é‡è¦æ›´æ–°ã€‚ä¸æ­¤åŒæ—¶ï¼ŒIstio 1.23 ä¹Ÿæ­£å¼åœæ­¢ç»´æŠ¤ï¼Œæ ‡å¿—ç€è¿™ä¸€ä¸»æµç‰ˆæœ¬çš„ç”Ÿå‘½å‘¨æœŸæ­£å¼ç»“æŸã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸€istio-126-æ–°ç‰¹æ€§é€Ÿè§ˆ&#34;&gt;ä¸€ã€Istio 1.26 æ–°ç‰¹æ€§é€Ÿè§ˆ&lt;/h2&gt;
&lt;h3 id=&#34;1-gateway-api-è‡ªåŠ¨èµ„æºæ”¯æŒå…¨é¢å¯é…ç½®&#34;&gt;1. Gateway API è‡ªåŠ¨èµ„æºæ”¯æŒå…¨é¢å¯é…ç½®&lt;/h3&gt;
&lt;p&gt;åœ¨ Istio 1.26 ä¸­ï¼Œç”¨æˆ·ç»ˆäºå¯ä»¥é€šè¿‡ ConfigMap è‡ªå®šä¹‰ç”± Gateway API è‡ªåŠ¨ç”Ÿæˆçš„èµ„æºï¼Œä¾‹å¦‚ &lt;code&gt;Service&lt;/code&gt;ã€&lt;code&gt;Deployment&lt;/code&gt;ã€&lt;code&gt;HorizontalPodAutoscaler&lt;/code&gt; å’Œ &lt;code&gt;PodDisruptionBudget&lt;/code&gt;ã€‚è¿™ä½¿å¾—è¿ç»´å’Œç½‘å…³éƒ¨ç½²ç­–ç•¥æ›´çµæ´»ï¼Œæ˜¾è‘—æå‡äº†ç”Ÿäº§å¯ç”¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;è¯¦è§æ–‡æ¡£ï¼š&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/ingress/gateway-api/#automated-deployment&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚ä½•è‡ªå®šä¹‰ Gateway è‡ªåŠ¨éƒ¨ç½²çš„èµ„æº&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;2-ambient-æ¨¡å¼ä¸‹æ”¯æŒ-tcproute&#34;&gt;2. Ambient æ¨¡å¼ä¸‹æ”¯æŒ TCPRoute&lt;/h3&gt;
&lt;p&gt;Ambient æ¨¡å¼ä¸‹çš„ Waypoint ä»£ç†ç°åœ¨æ”¯æŒ &lt;a href=&#34;https://gateway-api.sigs.k8s.io/guides/tcp/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway API çš„ &lt;code&gt;TCPRoute&lt;/code&gt;&lt;/a&gt;ï¼Œè®© TCP å±‚æµé‡çš„ç²¾ç»†æ§åˆ¶æˆä¸ºå¯èƒ½ï¼Œè¿›ä¸€æ­¥æå‡äº† L4 å±‚é¢çš„å¯è§‚æµ‹ä¸æ§åˆ¶èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼ŒIstio è¿˜å¼•å…¥äº† Gateway API v1.3 çš„å®éªŒæ€§ç‰¹æ€§ &lt;a href=&#34;https://gateway-api.sigs.k8s.io/api-types/backendtlspolicy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;BackendTLSPolicy&lt;/code&gt;&lt;/a&gt; ä¸ &lt;a href=&#34;https://gateway-api.sigs.k8s.io/api-types/backendtrafficpolicy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;BackendTrafficPolicy&lt;/code&gt;&lt;/a&gt;ï¼Œä¸ºæœªæ¥çš„é‡è¯•ã€åç«¯è®¤è¯æ§åˆ¶é“ºå¹³é“è·¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;3-æ”¯æŒ-kubernetes-æ–°ç‰¹æ€§-clustertrustbundle&#34;&gt;3. æ”¯æŒ Kubernetes æ–°ç‰¹æ€§ ClusterTrustBundle&lt;/h3&gt;
&lt;p&gt;Istio 1.26 å¢åŠ äº†å¯¹ Kubernetes å®éªŒæ€§ç‰¹æ€§ &lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/#cluster-trust-bundles&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;ClusterTrustBundle&lt;/code&gt;&lt;/a&gt; çš„æ”¯æŒï¼Œè¿™æ˜¯é›†ç¾¤é—´ä¿¡ä»»ç®¡ç†çš„é‡è¦ä¸€æ­¥ï¼Œæœªæ¥æœ‰æœ›æ›¿ä»£ä¼ ç»Ÿ CA æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;4-istioctl-å·¥å…·å¢å¼º&#34;&gt;4. istioctl å·¥å…·å¢å¼º&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;istioctl analyze&lt;/code&gt; ç°åœ¨æ”¯æŒæŒ‡å®šæŸä¸ªæ£€æŸ¥é¡¹ï¼Œä¾¿äºé›†æˆè‡ªåŠ¨åŒ–æ£€æµ‹ã€‚&lt;/li&gt;
&lt;li&gt;å¢åŠ  &lt;code&gt;--tls-server-name&lt;/code&gt; æ”¯æŒï¼Œä¾¿äºç”Ÿæˆå¯ç”¨äºç‰¹å®šç½‘å…³åŸŸåçš„ kubeconfigã€‚&lt;/li&gt;
&lt;li&gt;å¤šé¡¹ CLI å‘½ä»¤ä¿®å¤ä¸å¢å¼ºï¼Œæå‡å®‰è£…ä¸è°ƒè¯•ä½“éªŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;5-å®‰è£…ä¸å¹³å°é€‚é…æ”¹è¿›&#34;&gt;5. å®‰è£…ä¸å¹³å°é€‚é…æ”¹è¿›&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ GKE ä¸­è‡ªåŠ¨é…ç½® &lt;code&gt;ResourceQuota&lt;/code&gt; ä¸ &lt;code&gt;cniBinDir&lt;/code&gt;ï¼Œæå‡å…¼å®¹æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;istio-cni&lt;/code&gt; ä¸å†é»˜è®¤ä½¿ç”¨ &lt;code&gt;hostNetwork&lt;/code&gt;ï¼Œé™ä½ç«¯å£å†²çªé£é™©ã€‚&lt;/li&gt;
&lt;li&gt;Helm Chart ä¸­æ–°å¢æ”¯æŒè®¾ç½® &lt;code&gt;loadBalancerClass&lt;/code&gt;ã€&lt;code&gt;updateStrategy&lt;/code&gt;ã€&lt;code&gt;ConfigMap&lt;/code&gt; ç­‰å…³é”®å‚æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;6-envoyfilter-å’Œ-retry-ç­–ç•¥å¢å¼º&#34;&gt;6. EnvoyFilter å’Œ Retry ç­–ç•¥å¢å¼º&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;EnvoyFilter&lt;/code&gt; ç°å¯åŸºäº &lt;code&gt;VirtualHost&lt;/code&gt; çš„åŸŸåè¿›è¡ŒåŒ¹é…ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒé…ç½®é‡è¯•çš„ backoff é—´éš”ä¸ host predicateã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯¦ç»†æ”¹åŠ¨è¯·å‚è€ƒå®˜æ–¹&lt;a href=&#34;https://istio.io/latest/news/releases/1.26.x/announcing-1.26/change-notes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®Œæ•´å˜æ›´æ—¥å¿—&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;äºŒistio-123-æ­£å¼åœæ­¢æ”¯æŒ&#34;&gt;äºŒã€Istio 1.23 æ­£å¼åœæ­¢æ”¯æŒ&lt;/h2&gt;
&lt;p&gt;æ ¹æ® &lt;a href=&#34;https://istio.io/latest/news/support/announcing-1.23-eol-final/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹å…¬å‘Š&lt;/a&gt;ï¼Œè‡ª 2025 å¹´ 4 æœˆ 16 æ—¥èµ·ï¼ŒIstio 1.23 ç‰ˆæœ¬å·²åœæ­¢ç»´æŠ¤ï¼Œä¸å†æ¥æ”¶å®‰å…¨æ¼æ´ä¸å…³é”® Bug ä¿®å¤ã€‚å»ºè®®ä»åœ¨ä½¿ç”¨è¯¥ç‰ˆæœ¬çš„ç”¨æˆ·å°½å¿«å‡çº§è‡³ Istio 1.26 æˆ–æ›´æ–°ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸‰æ¨èå…³æ³¨çš„ç¤¾åŒºå†…å®¹&#34;&gt;ä¸‰ã€æ¨èå…³æ³¨çš„ç¤¾åŒºå†…å®¹&lt;/h2&gt;
&lt;p&gt;è‹¥ä½ å¸Œæœ›æ·±å…¥äº†è§£ Ambient æ¨¡å¼åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­çš„è¡¨ç°ã€å®‰å…¨æ€§ä¸æ€§èƒ½æ¯”è¾ƒï¼Œå»ºè®®é˜…è¯»ä»¥ä¸‹ Istio å®˜æ–¹åšå®¢ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/blog/2025/ztunnel-security-assessment/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ztunnel å®‰å…¨æ€§è¯„ä¼°æŠ¥å‘Š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/blog/2025/ambient-performance/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambient æ¨¡å¼ vs å†…æ ¸æ—è·¯æ€§èƒ½å¯¹æ¯”&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/blog/2025/istio-at-kubecon-eu/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åœ¨ KubeCon EU çš„æŠ€æœ¯åˆ†äº«&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å››å‡çº§å»ºè®®ä¸åé¦ˆé€šé“&#34;&gt;å››ã€å‡çº§å»ºè®®ä¸åé¦ˆé€šé“&lt;/h2&gt;
&lt;p&gt;æœ¬æ¬¡å‘å¸ƒæ”¯æŒ Kubernetes 1.29 è‡³ 1.32ï¼ˆé¢„è®¡å…¼å®¹ 1.33ï¼‰ï¼Œå¦‚è®¡åˆ’å‡çº§è‡³ 1.26ï¼Œè¯·æå‰å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/news/releases/1.26.x/announcing-1.26/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‡çº§æŒ‡å—&lt;/a&gt;ã€‚å¦‚é‡é—®é¢˜æˆ–å¸Œæœ›æä¾›åé¦ˆï¼Œå¯åŠ å…¥ &lt;a href=&#34;https://slack.istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Slack ç¤¾åŒº&lt;/a&gt;ï¼Œè¿›å…¥ &lt;code&gt;#release-1.26&lt;/code&gt; é¢‘é“å‚ä¸è®¨è®ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;äº”å†™åœ¨æœ€å&#34;&gt;äº”ã€å†™åœ¨æœ€å&lt;/h2&gt;
&lt;p&gt;Istio 1.26 æ ‡å¿—ç€ Ambient æ¨¡å¼ä»â€œå®éªŒæ€§â€èµ°å‘æ›´æˆç†Ÿé˜¶æ®µï¼Œä¹Ÿæ˜¯ Istio ä¸ Kubernetes æ·±åº¦é›†æˆçš„åˆä¸€é‡Œç¨‹ç¢‘ã€‚ä½œä¸ºäº‘åŸç”Ÿç½‘ç»œçš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ŒIstio å°†æŒç»­æ¨åŠ¨é¢å‘æœåŠ¡çš„æµé‡æ²»ç†ã€å®‰å…¨ä¸å¯è§‚æµ‹æ€§æ¼”è¿›ã€‚&lt;/p&gt;
&lt;p&gt;æ¬¢è¿å¤§å®¶å‚ä¸æµ‹è¯•ã€åé¦ˆä½“éªŒï¼Œè´¡çŒ®ä»£ç æˆ–æ–‡æ¡£ï¼Œä¸ºå¼€æºä¸–ç•Œæ·»ç –åŠ ç“¦ï¼&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ğŸ‘‰ å»¶ä¼¸é˜…è¯»ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/news/releases/1.26.x/announcing-1.26/change-notes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ğŸ“ƒ Istio 1.26 å˜æ›´æ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/news/releases/1.26.x/announcing-1.26/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;âš™ï¸ Istio 1.26 å‡çº§æŒ‡å—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/news/support/announcing-1.23-eol-final/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ğŸ“Œ Istio 1.23 EOL æœ€ç»ˆå…¬å‘Š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>äº‘åŸç”Ÿå¯¹æ¯”ï¼šIstio Ambient æ¨¡å¼ä¸ Cilium çš„æ‰©å±•æ€§èƒ½åˆ†æ</title>
      <link>https://cloudnativecn.com/blog/ambient-vs-cilium/</link>
      <pubDate>Tue, 22 Oct 2024 10:49:22 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/ambient-vs-cilium/</guid>
      <description>&lt;p&gt;æ½œåœ¨çš„ Istio ç”¨æˆ·ç»å¸¸ä¼šé—®ï¼šâ€œIstio ä¸ Cilium ç›¸æ¯”å¦‚ä½•ï¼Ÿâ€è™½ç„¶ Cilium æœ€åˆä»…æä¾› L3/L4 åŠŸèƒ½ï¼ˆå¦‚ç½‘ç»œç­–ç•¥ï¼‰ï¼Œä½†è¿‘æ¥çš„ç‰ˆæœ¬å¢åŠ äº†åŸºäº Envoy çš„æœåŠ¡ç½‘æ ¼åŠŸèƒ½ä»¥åŠ WireGuard åŠ å¯†ã€‚ä¸ Istio ä¸€æ ·ï¼ŒCilium ä¹Ÿæ˜¯ CNCF è®¤è¯çš„æ¯•ä¸šé¡¹ç›®ï¼Œå¹¶åœ¨ç¤¾åŒºä¸­å­˜åœ¨å¤šå¹´ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡è¡¨é¢ä¸Šçœ‹è¿™ä¸¤ä¸ªé¡¹ç›®æä¾›çš„åŠŸèƒ½ç›¸ä¼¼ï¼Œä½†å®ƒä»¬çš„æ¶æ„å´æœ‰ç€æ˜¾è‘—ä¸åŒï¼Œå°¤å…¶æ˜¯ Cilium ä½¿ç”¨ eBPF å’Œ WireGuard åœ¨å†…æ ¸ä¸­å¤„ç†å’ŒåŠ å¯† L4 æµé‡ï¼Œè€Œ Istio åœ¨ç”¨æˆ·ç©ºé—´é€šè¿‡å…¶ ztunnel ç»„ä»¶å¤„ç† L4 æµé‡ã€‚è¿™äº›å·®å¼‚å¯¼è‡´äº†å…³äº Istio ä¸ Cilium åœ¨å¤§è§„æ¨¡ä¸‹æ€§èƒ½çš„å¹¿æ³›è®¨è®ºã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡å·²æœ‰å…³äºç§Ÿæˆ·æ¨¡å‹ã€å®‰å…¨åè®®å’ŒåŸºæœ¬æ€§èƒ½çš„æ¯”è¾ƒï¼Œä½†å°šæœªæœ‰å…¨é¢çš„ä¼ä¸šçº§è¯„ä¼°æŠ¥å‘Šã€‚ä¸å…¶å¼ºè°ƒç†è®ºæ€§èƒ½ï¼Œæˆ‘ä»¬å¯¹ Istio çš„ Ambient æ¨¡å¼å’Œ Cilium è¿›è¡Œäº†æµ‹è¯•ï¼Œèšç„¦äºå»¶è¿Ÿã€ååé‡å’Œèµ„æºæ¶ˆè€—ç­‰å…³é”®æŒ‡æ ‡ã€‚é€šè¿‡æ¨¡æ‹Ÿä¸€ä¸ªç¹å¿™çš„ Kubernetes ç¯å¢ƒï¼Œæˆ‘ä»¬æ–½åŠ äº†é«˜è´Ÿè½½åœºæ™¯ï¼Œæœ€åå°† AKS é›†ç¾¤çš„è§„æ¨¡æ‰©å±•åˆ° 1000 ä¸ªèŠ‚ç‚¹ã€11000 ä¸ªæ ¸å¿ƒï¼Œä»¥äº†è§£è¿™äº›é¡¹ç›®åœ¨å¤§è§„æ¨¡ä¸‹çš„è¡¨ç°ã€‚ç»“æœæ˜¾ç¤ºï¼Œä¸¤è€…å„æœ‰éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œä½† Istio æ˜æ˜¾è¡¨ç°æ›´ä½³ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æµ‹è¯•åœºæ™¯&#34;&gt;æµ‹è¯•åœºæ™¯&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†å°† Istio å’Œ Cilium æ¨å‘æé™ï¼Œæˆ‘ä»¬åˆ›å»ºäº† 500 ä¸ªä¸åŒçš„æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡æ”¯æŒ 100 ä¸ª Podã€‚æ¯ä¸ªæœåŠ¡ä½äºå•ç‹¬çš„å‘½åç©ºé—´ä¸­ï¼Œä¸”åŒ…å«ä¸€ä¸ª&lt;a href=&#34;https://fortio.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fortio&lt;/a&gt;è´Ÿè½½ç”Ÿæˆå®¢æˆ·ç«¯ã€‚æˆ‘ä»¬å°†å®¢æˆ·ç«¯é™åˆ¶åœ¨ä¸€ä¸ªç”± 100 å° 32 æ ¸æœºå™¨ç»„æˆçš„èŠ‚ç‚¹æ± ä¸­ï¼Œä»¥æ¶ˆé™¤å…±åŒå®šä½çš„å®¢æˆ·ç«¯çš„å¹²æ‰°ï¼Œå¹¶ä¸ºæœåŠ¡åˆ†é…äº†å‰©ä½™çš„ 900 å° 8 æ ¸å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æµ‹è¯•åœºæ™¯&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æµ‹è¯•åœºæ™¯&#34; srcset=&#34;
               /blog/ambient-vs-cilium/scale-scenario_hu_6c696a9d03a74239.webp 400w,
               /blog/ambient-vs-cilium/scale-scenario_hu_b4833e715bfc3df3.webp 760w,
               /blog/ambient-vs-cilium/scale-scenario_hu_953ffb62d23288d4.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/ambient-vs-cilium/scale-scenario_hu_6c696a9d03a74239.webp&#34;
               width=&#34;760&#34;
               height=&#34;598&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æµ‹è¯•åœºæ™¯
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ Istio æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Ambient æ¨¡å¼ï¼Œåœ¨æ¯ä¸ªæœåŠ¡å‘½åç©ºé—´ä¸­éƒ¨ç½²äº†&lt;a href=&#34;https://istio.io/latest/docs/ambient/usage/waypoint/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;waypoint ä»£ç†&lt;/a&gt;ï¼Œå¹¶ä½¿ç”¨é»˜è®¤çš„å®‰è£…å‚æ•°ã€‚ä¸ºäº†ä½¿æµ‹è¯•åœºæ™¯å°½å¯èƒ½ç›¸ä¼¼ï¼Œæˆ‘ä»¬åœ¨ Cilium ä¸­å¯ç”¨äº†å‡ ä¸ªéé»˜è®¤åŠŸèƒ½ï¼ŒåŒ…æ‹¬ WireGuard åŠ å¯†ã€L7 ä»£ç†å’ŒèŠ‚ç‚¹åˆå§‹åŒ–ã€‚æˆ‘ä»¬è¿˜åœ¨æ¯ä¸ªå‘½åç©ºé—´ä¸­åˆ›å»ºäº†ä¸€ä¸ª Cilium ç½‘ç»œç­–ç•¥ï¼Œå¸¦æœ‰åŸºäº HTTP è·¯å¾„çš„è§„åˆ™ã€‚åœ¨ä¸¤ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡éšæœºåœ°å°†ä¸€ä¸ªæœåŠ¡æ‰©å±•åˆ° 85 è‡³ 115 ä¸ªå®ä¾‹å¹¶æ¯åˆ†é’Ÿé‡æ–°æ ‡è®°ä¸€ä¸ªå‘½åç©ºé—´ï¼Œç”Ÿæˆäº†å˜åŒ–ã€‚è¦æŸ¥çœ‹æˆ‘ä»¬ä½¿ç”¨çš„ç²¾ç¡®è®¾ç½®å¹¶é‡ç°ç»“æœï¼Œè¯·å‚é˜…&lt;a href=&#34;https://github.com/therealmitchconnors/tools/blob/2384dc26f114300687b21f921581a158f27dc9e1/perf/load/many-svc-scenario/README.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘çš„ç¬”è®°&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯æ‰©å±•æ€§è¯„åˆ†&#34;&gt;å¯æ‰©å±•æ€§è¯„åˆ†&lt;/h2&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å¯æ‰©å±•æ€§è¯„åˆ†&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å¯æ‰©å±•æ€§è¯„åˆ†&#34; srcset=&#34;
               /blog/ambient-vs-cilium/scale-scorecard_hu_e47ea34005b0f0b8.webp 400w,
               /blog/ambient-vs-cilium/scale-scorecard_hu_cfc88e69e45db0b7.webp 760w,
               /blog/ambient-vs-cilium/scale-scorecard_hu_ac79307207b1a796.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/ambient-vs-cilium/scale-scorecard_hu_e47ea34005b0f0b8.webp&#34;
               width=&#34;760&#34;
               height=&#34;426&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å¯æ‰©å±•æ€§è¯„åˆ†
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio èƒ½å¤Ÿä»¥ 20% çš„è¾ƒä½å°¾å»¶è¿Ÿæä¾› 56% æ›´å¤šçš„æŸ¥è¯¢ã€‚Cilium çš„ CPU ä½¿ç”¨ç‡ä½ 30%ï¼Œä½†æˆ‘ä»¬çš„æµ‹é‡å¹¶ä¸åŒ…æ‹¬ Cilium ç”¨äºåŠ å¯†çš„å†…æ ¸æ ¸å¿ƒã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘åˆ°èµ„æºä½¿ç”¨æƒ…å†µï¼ŒIstio æ¯æ ¸å¿ƒå¤„ç† 2178 ä¸ªæŸ¥è¯¢ï¼Œè€Œ Cilium åˆ™æ˜¯ 1815 ä¸ªï¼Œæå‡äº† 20%ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Cilium å‡é€Ÿï¼š&lt;/strong&gt; Cilium åœ¨é»˜è®¤å®‰è£…å‚æ•°ä¸‹å±•ç¤ºäº†ä»¤äººå°è±¡æ·±åˆ»çš„ä½å»¶è¿Ÿï¼Œä½†å½“å¯ç”¨ Istio çš„åŸºå‡†åŠŸèƒ½ï¼ˆå¦‚ L7 ç­–ç•¥å’ŒåŠ å¯†ï¼‰æ—¶ï¼Œå…¶é€Ÿåº¦å¤§å¹…ä¸‹é™ã€‚æ­¤å¤–ï¼Œå³ä½¿ç½‘æ ¼ä¸­æ²¡æœ‰æµé‡æµåŠ¨ï¼ŒCilium çš„å†…å­˜å’Œ CPU åˆ©ç”¨ç‡ä»ç„¶è¾ƒé«˜ï¼Œè¿™å¯èƒ½ä¼šå½±å“é›†ç¾¤çš„æ•´ä½“ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œå°¤å…¶æ˜¯åœ¨æ‰©å±•æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Istio ç¨³å¥è¡¨ç°ï¼š&lt;/strong&gt; ç›¸æ¯”ä¹‹ä¸‹ï¼ŒIstio çš„ Ambient æ¨¡å¼åœ¨ç¨³å®šæ€§æ–¹é¢å±•ç¤ºäº†å…¶ä¼˜åŠ¿ï¼Œå³ä½¿å¢åŠ äº†åŠ å¯†çš„å¼€é”€ï¼Œä¹Ÿèƒ½ä¿æŒä¸é”™çš„ååé‡ã€‚åœ¨æµ‹è¯•ä¸­ï¼ŒIstio ç¡®å®æ¯” Cilium æ¶ˆè€—äº†æ›´å¤šçš„å†…å­˜å’Œ CPUï¼Œä½†åœ¨æ²¡æœ‰è´Ÿè½½æ—¶å…¶ CPU åˆ©ç”¨ç‡ä¸‹é™åˆ° Cilium çš„ä¸€å°éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¹•ååŸå› ä¸ºä½•è¡¨ç°å·®å¼‚&#34;&gt;å¹•ååŸå› ï¼šä¸ºä½•è¡¨ç°å·®å¼‚ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;è¦ç†è§£è¿™äº›æ€§èƒ½å·®å¼‚çš„å…³é”®åœ¨äºå„å·¥å…·çš„æ¶æ„å’Œè®¾è®¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Cilium çš„æ§åˆ¶å¹³é¢éš¾é¢˜ï¼š&lt;/strong&gt; Cilium åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ªæ§åˆ¶å¹³é¢å®ä¾‹ï¼Œéšç€é›†ç¾¤æ‰©å±•ï¼Œè¿™å¯¼è‡´ API æœåŠ¡å™¨å‹åŠ›å¢åŠ å’Œé…ç½®å¼€é”€å¢åŠ ã€‚è¿™ç»å¸¸å¯¼è‡´æˆ‘ä»¬çš„ API æœåŠ¡å™¨å´©æºƒï¼Œæ¥ç€ Cilium å˜å¾—ä¸å¯ç”¨ï¼Œæ•´ä¸ªé›†ç¾¤é™·å…¥ä¸å“åº”çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Istio çš„æ•ˆç‡ä¼˜åŠ¿ï¼š&lt;/strong&gt; Istio é€šè¿‡é›†ä¸­æ§åˆ¶å¹³é¢å’ŒåŸºäºèº«ä»½çš„æ–¹å¼ç®€åŒ–äº†é…ç½®ï¼Œå‡å°‘äº† API æœåŠ¡å™¨å’ŒèŠ‚ç‚¹çš„è´Ÿæ‹…ï¼Œå°†å…³é”®èµ„æºç”¨äºå¤„ç†å’Œä¿æŠ¤æµé‡ï¼Œè€Œä¸æ˜¯å¤„ç†é…ç½®ã€‚Istio é€šè¿‡è¿è¡Œå°½å¯èƒ½å¤šçš„ Envoy å®ä¾‹æ¥è¿›ä¸€æ­¥åˆ©ç”¨æœªåœ¨æ§åˆ¶å¹³é¢ä¸­ä½¿ç”¨çš„èµ„æºï¼Œè€Œ Cilium åˆ™é™åˆ¶ä¸ºæ¯ä¸ªèŠ‚ç‚¹å…±äº«ä¸€ä¸ª Envoy å®ä¾‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ›´æ·±å…¥æ¢è®¨&#34;&gt;æ›´æ·±å…¥æ¢è®¨&lt;/h3&gt;
&lt;p&gt;è™½ç„¶è¿™ä¸ªé¡¹ç›®çš„ç›®æ ‡æ˜¯æ¯”è¾ƒ Istio å’Œ Cilium çš„å¯æ‰©å±•æ€§ï¼Œä½†ä¸€äº›é™åˆ¶ä½¿å¾—ç›´æ¥æ¯”è¾ƒå˜å¾—å›°éš¾ã€‚&lt;/p&gt;
&lt;h3 id=&#34;l4-ä¸æ€»æ˜¯-l4&#34;&gt;L4 ä¸æ€»æ˜¯ L4&lt;/h3&gt;
&lt;p&gt;å°½ç®¡ Istio å’Œ Cilium éƒ½æä¾› L4 ç­–ç•¥å¼ºåˆ¶ï¼Œä½†å®ƒä»¬çš„ API å’Œå®ç°å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚Cilium å®ç°äº† Kubernetes NetworkPolicyï¼Œå®ƒä½¿ç”¨æ ‡ç­¾å’Œå‘½åç©ºé—´æ¥é˜»æ­¢æˆ–å…è®¸ IP åœ°å€çš„è®¿é—®ã€‚Istio æä¾›äº†ä¸€ä¸ª AuthorizationPolicy APIï¼Œå¹¶æ ¹æ®ç­¾ç½²æ¯ä¸ªè¯·æ±‚çš„ TLS èº«ä»½åšå‡ºå…è®¸å’Œæ‹’ç»å†³å®šã€‚å¤§å¤šæ•°æ·±åº¦é˜²å¾¡ç­–ç•¥éœ€è¦åŒæ—¶ä½¿ç”¨ NetworkPolicy å’ŒåŸºäº TLS çš„ç­–ç•¥æ¥å®ç°å…¨é¢çš„å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŠ å¯†çš„å·®å¼‚&#34;&gt;åŠ å¯†çš„å·®å¼‚&lt;/h3&gt;
&lt;p&gt;Cilium æä¾›äº†ç”¨äº FIPS å…¼å®¹åŠ å¯†çš„ IPsecï¼Œä½†å¤§å¤šæ•° Cilium åŠŸèƒ½ï¼ˆå¦‚ L7 ç­–ç•¥å’Œè´Ÿè½½å‡è¡¡ï¼‰ä¸ IPsec ä¸å…¼å®¹ã€‚Cilium åœ¨ä½¿ç”¨ WireGuard åŠ å¯†æ—¶å…·æœ‰æ›´å¥½çš„åŠŸèƒ½å…¼å®¹æ€§ï¼Œä½† WireGuard æ— æ³•åœ¨ FIPS åˆè§„çš„ç¯å¢ƒä¸­ä½¿ç”¨ã€‚å¦ä¸€æ–¹é¢ï¼ŒIstio ä¸¥æ ¼éµå®ˆ TLS åè®®æ ‡å‡†ï¼Œé»˜è®¤æƒ…å†µä¸‹å§‹ç»ˆä½¿ç”¨ FIPS å…¼å®¹çš„ mTLSã€‚&lt;/p&gt;
&lt;h3 id=&#34;éšè—çš„æˆæœ¬&#34;&gt;éšè—çš„æˆæœ¬&lt;/h3&gt;
&lt;p&gt;è™½ç„¶ Istio å®Œå…¨åœ¨ç”¨æˆ·ç©ºé—´ä¸­è¿è¡Œï¼Œä½† Cilium çš„ L4 æ•°æ®å¹³é¢åœ¨ Linux å†…æ ¸ä¸­ä½¿ç”¨ eBPFã€‚Prometheus çš„èµ„æºæ¶ˆè€—æŒ‡æ ‡ä»…æµ‹é‡ç”¨æˆ·ç©ºé—´èµ„æºï¼Œè¿™æ„å‘³ç€ Cilium ä½¿ç”¨çš„æ‰€æœ‰å†…æ ¸èµ„æºåœ¨æ­¤æµ‹è¯•ä¸­éƒ½æœªè®¡å…¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å»ºè®®é€‰æ‹©åˆé€‚çš„å·¥å…·&#34;&gt;å»ºè®®ï¼šé€‰æ‹©åˆé€‚çš„å·¥å…·&lt;/h2&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œæœ€ç»ˆç»“è®ºæ˜¯ä»€ä¹ˆï¼Ÿè¿™å–å†³äºæ‚¨çš„å…·ä½“éœ€æ±‚å’Œä¼˜å…ˆäº‹é¡¹ã€‚å¯¹äºå°å‹é›†ç¾¤ä»¥åŠçº¯ L3/L4 ç”¨ä¾‹ä¸”æ— éœ€åŠ å¯†çš„æƒ…å†µï¼ŒCilium æä¾›äº†ä¸€ä¸ªç»æµé«˜æ•ˆä¸”æ€§èƒ½è‰¯å¥½çš„è§£å†³æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œå¯¹äºå¤§å‹é›†ç¾¤ï¼Œä»¥åŠæ³¨é‡ç¨³å®šæ€§ã€å¯æ‰©å±•æ€§å’Œé«˜çº§åŠŸèƒ½çš„æƒ…å†µï¼ŒIstio çš„ Ambient æ¨¡å¼é…åˆæ›¿ä»£çš„ NetworkPolicy å®ç°æ‰æ˜¯é¦–é€‰ã€‚è®¸å¤šå®¢æˆ·é€‰æ‹©å°† Cilium çš„ L3/L4 åŠŸèƒ½ä¸ Istio çš„ L4/L7 å’ŒåŠ å¯†åŠŸèƒ½ç»“åˆï¼Œä»¥å®ç°æ·±åº¦é˜²å¾¡ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;è¯·è®°ä½ï¼Œäº‘åŸç”Ÿç½‘ç»œçš„ä¸–ç•Œåœ¨ä¸æ–­å‘å±•ã€‚å¯†åˆ‡å…³æ³¨ Istio å’Œ Cilium çš„è¿›å±•ï¼Œå®ƒä»¬å°†ç»§ç»­æ”¹è¿›å’Œåº”å¯¹è¿™äº›æŒ‘æˆ˜ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Istio çš„ç¯å¢ƒæ¨¡å¼ â€”â€” ç”¨æ›´å°‘çš„èµ„æºåšæ›´å¤šçš„äº‹ï¼</title>
      <link>https://cloudnativecn.com/blog/istio-more-for-less/</link>
      <pubDate>Wed, 28 Aug 2024 17:35:23 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-more-for-less/</guid>
      <description>&lt;p&gt;éšç€ Istio çš„ç¯å¢ƒæ•°æ®å¹³é¢æ¨¡å¼çš„æ¨å‡ºï¼Œå¹³å°å›¢é˜Ÿå¯ä»¥é«˜æ•ˆåœ°é‡‡ç”¨æœåŠ¡ç½‘æ ¼åŠŸèƒ½ï¼Œå¹¶ä»¥æœ€å°çš„èµ„æºå’Œå¼€é”€å½±å“ä¸ºç»ˆç«¯ç”¨æˆ·æä¾›å¢å¼ºåŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-istio-ç¯å¢ƒæ¨¡å¼&#34;&gt;ä»€ä¹ˆæ˜¯ Istio ç¯å¢ƒæ¨¡å¼ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Istio çš„&lt;a href=&#34;https://www.solo.io/blog/istio-ambient-mesh-evolution-service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¯å¢ƒæ¨¡å¼&lt;/a&gt;æœ€åˆäº 2022 å¹´ 9 æœˆå‘å¸ƒã€‚å®ƒæ˜¯ä¸€ç§æ–°çš„æ•°æ®å¹³é¢æ¨¡å¼ â€”â€” æ— éœ€ sidecar â€”â€” æ—¨åœ¨ç®€åŒ–æ“ä½œã€æ‰©å¤§åº”ç”¨å…¼å®¹æ€§å’Œé™ä½åŸºç¡€è®¾æ–½æˆæœ¬ã€‚ç¯å¢ƒæ¨¡å¼å°† Istio çš„åŠŸèƒ½åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„å±‚ï¼šé›¶ä¿¡ä»»å®‰å…¨è¦†ç›–å±‚ï¼ˆ&lt;em&gt;ztunnel&lt;/em&gt;ï¼‰å’Œå¯é€‰çš„ç¬¬ 7 å±‚å¤„ç†å±‚ï¼ˆ&lt;em&gt;waypoint&lt;/em&gt;ï¼‰ã€‚ä¸ sidecar ç›¸æ¯”ï¼Œåˆ†å±‚æ–¹æ³•å…è®¸ç”¨æˆ·ä»æ— ç½‘æ ¼é€æ¸é‡‡ç”¨åˆ°åŸºäº mTLS çš„é›¶ä¿¡ä»»è¦†ç›–ï¼Œå†åˆ°å®Œæ•´çš„ç¬¬ 7 å±‚å¤„ç†ï¼Œæ ¹æ®éœ€è¦è¿›è¡Œã€‚è¿™ä¸ºæœåŠ¡ç½‘æ ¼ç”¨æˆ·æä¾›äº†æ¥è‡ªåŒä¸€ä¸“ç”¨ç¤¾åŒºçš„ä¸¤ä¸ªå‡ºè‰²é€‰æ‹©ï¼šä¼ ç»Ÿçš„ sidecar æ–¹æ³•çš„ Istio æˆ–æ—  sidecar çš„ç¯å¢ƒæ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-ç¯å¢ƒæ¨¡å¼&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio ç¯å¢ƒæ¨¡å¼&#34; srcset=&#34;
               /blog/istio-more-for-less/f1_hu_fbe003605aab01db.webp 400w,
               /blog/istio-more-for-less/f1_hu_1b3b1235c2d2cd89.webp 760w,
               /blog/istio-more-for-less/f1_hu_1639fb26de3909e8.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-more-for-less/f1_hu_fbe003605aab01db.webp&#34;
               width=&#34;760&#34;
               height=&#34;327&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio ç¯å¢ƒæ¨¡å¼
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ä¸èµ„æºæˆæœ¬å’Œæ“ä½œæŒ‘æˆ˜ç›¸å…³çš„ä¸€äº›ç¤ºä¾‹åœºæ™¯ï¼Œè¿™äº›åœºæ™¯åœ¨é‡‡ç”¨æœåŠ¡ç½‘æ ¼æ—¶å¸¸å¸¸ä¼šå¼•èµ·ç´§å¼ ã€‚æˆ‘ä»¬è¿˜å°†è®¨è®ºå¦‚ä½•é‡‡ç”¨ç¯å¢ƒæ¨¡å¼æ¥åº”å¯¹è¿™äº›æŒ‘æˆ˜ï¼Œå¹¶æ”¹å–„å¹³å°çš„æ€»æ‹¥æœ‰æˆæœ¬ï¼ˆTCOï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-çš„ç¯å¢ƒæ¨¡å¼é™ä½èµ„æºæˆæœ¬&#34;&gt;Istio çš„ç¯å¢ƒæ¨¡å¼é™ä½èµ„æºæˆæœ¬&lt;/h2&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio å»ºè®®ä¸ºæ¯ä¸ª sidecar åˆ†é… 0.1 CPU æ ¸å¿ƒå’Œ 128MB çš„å†…å­˜ã€‚è™½ç„¶æœåŠ¡ç½‘æ ¼çš„ä¼˜åŠ¿ä¼—æ‰€å‘¨çŸ¥ï¼Œä½†åœ¨çœŸå®ç”Ÿäº§å·¥ä½œè´Ÿè½½ä¸­ï¼Œèµ„æºéœ€æ±‚å¾ˆå¿«å°±ä¼šç´¯ç§¯èµ·æ¥ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºé¢„ç®—ç´§å¼ çš„å›¢é˜Ÿæ¥è¯´ï¼Œéµå®ˆè¿™ä¸€è¦æ±‚å¸¦æ¥äº†æ˜¾è‘—çš„æœºä¼šæˆæœ¬ã€‚ä»–ä»¬é¢ä¸´çš„æŠ‰æ‹©åŒ…æ‹¬åœ¨æ‹›è˜é¢å¤–äººå‘˜æˆ–æŠ•èµ„äºä¸šåŠ¡çš„å…¶ä»–é¢†åŸŸä¸æ‰¿æ‹…åº”ç”¨å¢åŠ çš„èµ„æºæˆæœ¬ä¹‹é—´åšå‡ºå†³å®šï¼Œè¿™æˆä¸ºä¸€ä¸ªå…³é”®è€ƒé‡ã€‚&lt;/p&gt;
&lt;p&gt;åŠ¡ç½‘æ ¼æœ‰ä¸€ç³»åˆ— 7 å±‚ç½‘ç»œåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é«˜çº§æµé‡ç®¡ç†å’Œè·¯ç”±æ§åˆ¶&lt;/li&gt;
&lt;li&gt;åœ¨åº”ç”¨å±‚çš„ç»†ç²’åº¦å®‰å…¨ç­–ç•¥&lt;/li&gt;
&lt;li&gt;é«˜æ•ˆå¤„ç†æ–­è·¯å™¨å’Œå®¹é”™æœºåˆ¶&lt;/li&gt;
&lt;li&gt;ä¿ƒè¿›æœåŠ¡å‘ç°å’ŒåŠ¨æ€æœåŠ¡è·¯ç”±çš„å®æ–½&lt;/li&gt;
&lt;li&gt;ç®€åŒ– A/B æµ‹è¯•å’Œé‡‘ä¸é›€å‘å¸ƒç­–ç•¥çš„éƒ¨ç½²&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶è€Œï¼Œå¦‚æœä½ è¿‘æœŸä¸éœ€è¦è¿™äº›åŠŸèƒ½ï¼Œæˆ–è€…ä¸æ˜¯æ¯ä¸ªæœåŠ¡éƒ½éœ€è¦ï¼Ÿè¿™äº›åŠŸèƒ½å¯èƒ½è¢«è§†ä¸ºé™„åŠ ä»·å€¼ï¼Œå¹¶å¯èƒ½ä¸ç¬¦åˆä½ çš„ç»„ç»‡éœ€æ±‚æˆ–æˆç†Ÿåº¦æ°´å¹³ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬è€ƒè™‘ä¸€äº›ä¸å®æ–½æœåŠ¡ç½‘æ ¼æˆæœ¬ç›¸å…³çš„æŒ‘æˆ˜åœºæ™¯ï¼š&lt;/p&gt;
&lt;h4 id=&#34;åœºæ™¯-1-æ§åˆ¶èºæ—‹å‡é«˜çš„-sidecar-æˆæœ¬&#34;&gt;åœºæ™¯ 1: æ§åˆ¶èºæ—‹å‡é«˜çš„ sidecar æˆæœ¬&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;â€œæˆ‘ä»¬çš„å®‰å…¨å›¢é˜Ÿè¦æ±‚æ•´ä¸ªç»„ç»‡é‡‡å–é›¶ä¿¡ä»»å§¿æ€ï¼Œå› æ­¤æˆ‘ä»¬æ­£åœ¨è€ƒè™‘é‡‡ç”¨æœåŠ¡ç½‘æ ¼ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å‘ç°é‡‡ç”¨ sidecar æ–¹æ³•å°†äº§ç”Ÿé¢å¤–çš„æˆæœ¬ï¼ˆåœ¨æ¯ä¸ªåº”ç”¨çš„èµ„æºé¢„ç•™ä¸­ï¼‰ã€‚â€&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºäº†éµå®ˆå®‰å…¨å›¢é˜Ÿçš„é›¶ä¿¡ä»»è¦æ±‚ï¼Œä½¿ç”¨ Istio çš„ç¯å¢ƒæ¨¡å¼ï¼Œä½ æ— éœ€ä¸ºæ¯ä¸ªåº”ç”¨é‡‡ç”¨ä¸€ä¸ª sidecarã€‚ç›¸åï¼Œä½ å¯ä»¥åˆ©ç”¨å…±äº«çš„ã€æ¯èŠ‚ç‚¹ ztunnel ç»„ä»¶ï¼Œå®ƒå¤„ç†é›¶ä¿¡ä»»ç½‘ç»œçš„èŒè´£ã€‚ç„¶åï¼Œå½“ä½ å‡†å¤‡å¥½æ—¶ï¼Œæˆ–åªé’ˆå¯¹éœ€è¦çš„æœåŠ¡ï¼Œå¯ä»¥é€‰æ‹©å®‰å…¨åœ°ã€æŒ‰å‘½åç©ºé—´å¤„ç†ç¬¬ 7 å±‚ç­–ç•¥ã€‚è¿™ç§é€‰æ‹©æ–¹æ³•æ„å‘³ç€ä»é mTLS åˆ°é‡‡ç”¨ mTLS çš„å¢é‡æˆæœ¬ç°åœ¨å¤§å¤§é™ä½äº†ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åœºæ™¯-2-å‡å°‘é‡å¤çš„èµ„æºæˆæœ¬&#34;&gt;åœºæ™¯ 2: å‡å°‘é‡å¤çš„èµ„æºæˆæœ¬&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;â€œæˆ‘ä»¬çš„ç»„ç»‡è¦æ±‚å¼€å‘ã€æµ‹è¯•å’Œåˆ†å±‚ç¯å¢ƒå¤åˆ¶ç”Ÿäº§è®¾ç½®ï¼Œä»¥ä¾¿åŠæ—©å‘ç°é—®é¢˜å¹¶ç»´æŒé«˜è´¨é‡çš„å‘å¸ƒã€‚é‡‡ç”¨æœåŠ¡ç½‘æ ¼æ„å‘³ç€æ¯ä¸ªç¯å¢ƒéƒ½ä¼šäº§ç”Ÿé¢å¤–çš„èµ„æºå’Œæ“ä½œå¼€é”€ï¼Œå¯¼è‡´æ•´ä½“æˆæœ¬æ€¥å‰§ä¸Šå‡ã€‚â€&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç»å¸¸çœ‹åˆ°å®¢æˆ·ç¯å¢ƒå¤åˆ¶å…¶ç”Ÿäº§è®¾ç½®ï¼Œå…¶ä¸­è¾ƒä½çº§åˆ«çš„ç¯å¢ƒåªæ¥æ”¶å°‘é‡çš„åˆæˆæµé‡ â€”â€” æˆ–åœ¨æŸäº›æƒ…å†µä¸‹æ ¹æœ¬æ²¡æœ‰æµé‡ã€‚è¿™å¯¹ç¯å¢ƒæ‰€æœ‰è€…æ¥è¯´æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ï¼Œä»–ä»¬éœ€è¦è¯æ˜åœ¨è¿™äº›æµé‡ä½æˆ–æ— æµé‡çš„ç¯å¢ƒä¸­è¿è¡ŒæœåŠ¡ç½‘æ ¼çš„ä»·å€¼ã€‚åˆ†é…ç»™ sidecar ä»£ç†çš„èµ„æºå¾ˆå¤§ç¨‹åº¦ä¸Šè¢«æµªè´¹ï¼Œå¯¼è‡´åˆ©ç”¨æ•ˆç‡ä½ä¸‹å’Œæ›´é«˜çš„æ”¯å‡ºã€‚é€šè¿‡ç§»é™¤ sidecar çš„è¦æ±‚ï¼Œç¯å¢ƒæ¨¡å¼é™ä½äº†åŸºç¡€èµ„æºéœ€æ±‚ï¼Œä½¿å¾—åœ¨å¤åˆ¶ç”Ÿäº§ç¯å¢ƒçš„æ ‡å‡†ä¸‹å®æ–½é›¶ä¿¡ä»»æ›´å…·æˆæœ¬æ•ˆç›Šã€‚&lt;/p&gt;
&lt;h4 id=&#34;åœºæ™¯-3-åœ¨ä¸åŒæ¶æ„ä¸­é©¾é©­å˜åŒ–çš„é€Ÿç‡æ¨¡å¼&#34;&gt;åœºæ™¯ 3: åœ¨ä¸åŒæ¶æ„ä¸­é©¾é©­å˜åŒ–çš„é€Ÿç‡æ¨¡å¼&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;â€œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¤æ‚çš„å¾®æœåŠ¡æ¶æ„ï¼Œä¸åŒçš„æœåŠ¡ç»å†å¹¿æ³›ä¸åŒçš„æµé‡æ¨¡å¼ã€‚ä¸€äº›æœåŠ¡æ¯ç§’å¤„ç†æ•°åƒä¸ªè¯·æ±‚ï¼Œè€Œå…¶ä»–æœåŠ¡åªå¤„ç†å‡ ç™¾ä¸ªã€‚å°½ç®¡å¦‚æ­¤ï¼Œsidecar ä»£ç†é€šå¸¸åœ¨æ‰€æœ‰æœåŠ¡ä¸­åˆ†é…ç›¸åŒçš„èµ„æºï¼Œå¯¼è‡´èµ„æºåˆ©ç‡ä¸é«˜ã€‚é«˜æµé‡æœåŠ¡é­å—æ€§èƒ½ç“¶é¢ˆï¼Œè€Œä½æµé‡æœåŠ¡åˆ™æµªè´¹èµ„æºã€‚â€&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°çš„å¦ä¸€ä¸ªå¸¸è§åœºæ™¯æ˜¯ï¼Œsidecar ä»£ç†é€šå¸¸é‡‡ç”¨ä¸€åˆ€åˆ‡çš„æ–¹æ³•è¿›è¡Œé…ç½®ï¼Œå¯¼è‡´èµ„æºåˆ©ç”¨ä¸æ•ˆç‡ã€‚åœ¨ç¼ºä¹æœºåˆ¶ï¼ˆä¾‹å¦‚ï¼Œåœ¨åº”ç”¨çš„ Helm chartä¸­æš´éœ² Istio pod æ³¨è§£ï¼‰æ¥è¦†ç›–é»˜è®¤ä»£ç†èµ„æºé¢„ç•™è¯·æ±‚çš„æƒ…å†µä¸‹ï¼Œä»¥åŠå¼€å‘å›¢é˜Ÿç¼ºä¹ä½¿ç”¨å¯è§‚å¯Ÿæ€§æ•°æ®æ¥é…ç½®å’Œè°ƒæ•´è¿™äº›èµ„æºé¢„ç•™çš„ç»éªŒçš„æƒ…å†µä¸‹ï¼Œåº”ç”¨å¼€å‘å›¢é˜Ÿèƒ½å¦æˆåŠŸå–å†³äºä»–ä»¬çš„åº”ç”¨ç‰¹å¾ã€‚å½»åº•ç§»é™¤ sidecar æ¶ˆé™¤äº†ç”±èµ„æºåˆ©ç”¨ä¸è¶³é€ æˆçš„ä½æ•ˆã€‚æ­¤å¤–ï¼Œç”±äº ztunnel æ˜¯ç”¨ Rust æ„å»ºçš„é«˜æ€§èƒ½ç»„ä»¶ï¼Œå®ƒä»ç„¶å¯ä»¥å¤„ç†é«˜ååé‡çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;h4 id=&#34;åœºæ™¯-4-å®æ–½æœåŠ¡ç½‘æ ¼ä»¥åœ¨è¾¹ç¼˜ç¯å¢ƒä¸­å®ç°é›¶ä¿¡ä»»&#34;&gt;åœºæ™¯ 4: å®æ–½æœåŠ¡ç½‘æ ¼ä»¥åœ¨è¾¹ç¼˜ç¯å¢ƒä¸­å®ç°é›¶ä¿¡ä»»&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;â€œåœ¨èµ„æºæœ‰é™çš„è¾¹ç¼˜ç¯å¢ƒä¸­éƒ¨ç½²æœåŠ¡ç½‘æ ¼å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œå› ä¸º sidecar å¸¦æ¥é¢å¤–çš„å¼€é”€ã€‚â€&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;è¾¹ç¼˜è®¡ç®—å°†æ•°æ®å¤„ç†æ›´é è¿‘æ•°æ®æºï¼Œé€šå¸¸åœ¨è¾ƒä¸å®‰å…¨æˆ–ä¸å—ä¿¡ä»»çš„ç½‘ç»œä¸­ï¼Œä¸”èµ„æºæœ‰é™ã€‚å®ç°é›¶ä¿¡ä»»ç¡®ä¿æ¯æ¬¡äº’åŠ¨éƒ½ç»è¿‡èº«ä»½éªŒè¯å’Œæˆæƒï¼Œæ˜¾è‘—é™ä½äº†è¿è§„çš„é£é™©ï¼Œä½†åœ¨èµ„æºæœ‰é™çš„ç¯å¢ƒä¸­å¯èƒ½å¾ˆå›°éš¾ã€‚é€šè¿‡åˆ©ç”¨ä¸éœ€è¦ sidecar çš„èµ„æºå¼€é”€çš„ Istio ç¯å¢ƒæ¨¡å¼æœåŠ¡ç½‘æ ¼ï¼ŒIoTã€é›¶å”®å’ŒåŒ»ç–—ä¿å¥ç­‰è¾¹ç¼˜è®¡ç®—ç”¨ä¾‹å¯ä»¥çœŸå®åœ°è€ƒè™‘å®ç°é›¶ä¿¡ä»»åŸåˆ™å¹¶è¾¾æˆåˆè§„ï¼Œä»¥å¢å¼ºå…¶è¾¹ç¼˜ç¯å¢ƒçš„å®‰å…¨ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›åªæ˜¯ Istio çš„ç¯å¢ƒæ¨¡å¼å¯ä»¥å¸®åŠ©è§£å†³çš„ä¸€äº›å¸¸è§ sidecar æŒ‘æˆ˜ã€‚Istio çš„ç¯å¢ƒæ¨¡å¼è¿˜å¯ä»¥å¸®åŠ©é©¾é©­çš„å…¶ä»–èµ„æºéšœç¢åŒ…æ‹¬å‡å°‘ sidecar éƒ¨ç½²ç»å†çš„åº”ç”¨ç¨‹åºåœæœºæ—¶é—´å’Œè§£å†³å‡ºå£é…ç½®çš„å¤æ‚æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-çš„ç¯å¢ƒæ¨¡å¼æœ‰åŠ©äºç®€åŒ–åº”ç”¨æ“ä½œ&#34;&gt;Istio çš„ç¯å¢ƒæ¨¡å¼æœ‰åŠ©äºç®€åŒ–åº”ç”¨æ“ä½œ&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-more-for-less/f2_hu_134f5975cbce2f40.webp 400w,
               /blog/istio-more-for-less/f2_hu_458f76de5d0f991a.webp 760w,
               /blog/istio-more-for-less/f2_hu_d9075ab05c3b5341.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-more-for-less/f2_hu_134f5975cbce2f40.webp&#34;
               width=&#34;760&#34;
               height=&#34;220&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å®‰å…¨åœ°é‡å¯æœåŠ¡ä»¥å‡çº§ sidecar ç‰ˆæœ¬æ¶‰åŠä¸‰ç§ä¸åŒçš„è®¾ç½®ï¼šæ§åˆ¶ Envoy æ’å‡ºå’Œæ‹’ç»æ–°è¿æ¥ï¼Œä¸ºæ´»åŠ¨è¿æ¥å…³é—­æä¾›å®½é™æ—¶é—´ï¼Œä»¥åŠåœ¨æ‰€æœ‰æ´»åŠ¨è¿æ¥å…³é—­æ—¶ç»ˆæ­¢ podã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°çš„æœåŠ¡ç½‘æ ¼é‡‡ç”¨ä¸­æœ€å¸¸è§çš„æŒ‘æˆ˜ä¹‹ä¸€æ˜¯åº”ç”¨æ‰€æœ‰è€…ç®¡ç† sidecar ç”Ÿå‘½å‘¨æœŸçš„æ“ä½œå¼€é”€å¢åŠ ã€‚ä¾‹å¦‚ï¼Œåœ¨ä» Istio 1.19 å‡çº§åˆ° 1.20 æ—¶ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸ªåº”ç”¨ pod éƒ½å¿…é¡»é‡æ–°å¯åŠ¨ä»¥åº”ç”¨æ–°çš„ä»£ç†ç‰ˆæœ¬ã€‚ä½ å¿…é¡»è€ƒè™‘ä»å·¥ä½œè´Ÿè½½ä¸­æ’å‡ºæµé‡ã€ç»ˆæ­¢è¿æ¥ä»¥åŠå¦‚æœ pod å› æš‚æ—¶ä¸å¯ç”¨çš„ä¾èµ–è€Œæ— æ³•é‡æ–°å¯åŠ¨ä¼šå‘ç”Ÿä»€ä¹ˆã€‚&lt;/p&gt;
&lt;p&gt;é‡‡ç”¨æ—  sidecar çš„æœåŠ¡ç½‘æ ¼æ¶æ„æ—¶ï¼Œæ‰€æœ‰è¿™äº›è€ƒè™‘éƒ½æ¶ˆå¤±äº†ï¼ç¯å¢ƒæ¨¡å¼æ˜¾è‘—å‡å°‘äº†æ“ä½œè´Ÿæ‹…ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›äº†æ›´å¤šæ—¶é—´ä¸“æ³¨äºå¼€å‘åº”ç”¨åŠŸèƒ½ï¼Œè€Œä¸æ˜¯ç®¡ç†å¤§è§„æ¨¡ä»£ç†çš„åŸºç¡€è®¾æ–½ç›¸å…³é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¸®åŠ©å…·ä½“åŒ–è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä¸€äº›ä¸æ“ä½œæœåŠ¡ç½‘æ ¼ç›¸å…³çš„æŒ‘æˆ˜åœºæ™¯ï¼š&lt;/p&gt;
&lt;h4 id=&#34;åœºæ™¯-1-é€šè¿‡å‡çº§-istio-éƒ¨ç½²è§£å†³å¤æ‚æ€§&#34;&gt;åœºæ™¯ 1: é€šè¿‡å‡çº§ Istio éƒ¨ç½²è§£å†³å¤æ‚æ€§&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;â€œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¤æ‚çš„ Istio éƒ¨ç½²ï¼Œå…¶ä¸­åŒ…å«è®¸å¤šè‡ªå®šä¹‰è®¾ç½®ï¼Œå‡çº§åˆ°æ–°ç‰ˆæœ¬ä¸€ç›´æ˜¯ä¸€ä¸ªä¸»è¦çš„ç—›ç‚¹ã€‚å‡çº§è¿‡ç¨‹ç»å¸¸å¯¼è‡´åœæœºã€é…ç½®åç§»å’Œæ„å¤–é—®é¢˜ï¼Œè¿™äº›éƒ½ä¼šæ‰°ä¹±æˆ‘ä»¬çš„æ“ä½œã€‚â€&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Istio ç¤¾åŒºçš„æ”¯æŒæ—¶é—´è¡¨ç›®å‰éµå¾ª N-1 æ”¯æŒçŠ¶æ€ï¼Œè¿™ç›¸å½“äºå¤§çº¦æ¯ 7-9 ä¸ªæœˆå‡çº§ä¸€æ¬¡ Istioã€‚Istio çš„é¢‘ç¹å‡çº§å¯èƒ½æ¶‰åŠé«˜åº¦å‚ä¸ï¼Œæ¶ˆé™¤ sidecar å¤§å¤§å‡å°‘äº†ä»…å› å°‘æ•°ç»„ä»¶å‡çº§å’Œç®¡ç†è€Œæ‰°ä¹±ä¸šåŠ¡æ“ä½œçš„é£é™©ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä¸“æ³¨äºèŠ‚ç‚¹çº§ç®¡ç†è€Œä¸æ˜¯æœåŠ¡çº§ sidecarï¼Œæ“ä½œå›¢é˜Ÿå¯ä»¥æ›´é«˜æ•ˆåœ°æ‰§è¡Œå‡çº§ï¼Œå¹¶ä¸”æ— éœ€ä¾èµ–æˆ–åè°ƒåº”ç”¨å›¢é˜Ÿå°±æ›´æœ‰ä¿¡å¿ƒã€‚å€¼å¾—è€ƒè™‘çš„æ˜¯ï¼Œæ“ä½œæˆæœ¬èŠ‚çœå¯èƒ½çœŸçš„å¾ˆå¯è§‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸¤åå·¥ç¨‹å¸ˆå®Œæˆ Istio å‡çº§æ‰€éœ€çš„æ—¶é—´ä» 16 å°æ—¶å‡å°‘åˆ°ä»… 2 å°æ—¶ï¼Œæ—¶é—´å’Œæˆæœ¬çš„èŠ‚çœå¯èƒ½æ˜¯å®è´¨æ€§çš„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åœºæ™¯-2-ç®¡ç†-sidecar-çš„äººæ‰å’Œèµ„æºæœ‰é™&#34;&gt;åœºæ™¯ 2: ç®¡ç† sidecar çš„äººæ‰å’Œèµ„æºæœ‰é™&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;â€œè®©æ–°çš„å¼€å‘å›¢é˜Ÿä½¿ç”¨æœåŠ¡ç½‘æ ¼è€—æ—¶ä¸”éœ€è¦å¹¿æ³›åŸ¹è®­ sidecar ç®¡ç†ã€‚â€&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;å¼€å‘äººå‘˜ç»å¸¸è¡¨è¾¾å¯¹ç®¡ç† sidecar çš„æŒ«è´¥æ„Ÿï¼Œå¤šå¹´æ¥çš„ä¼—å¤šç¤¾åŒºè°ƒæŸ¥å·²è¯æ˜è¿™ä¸€ç‚¹ã€‚Istio çš„ç¯å¢ƒæ¨¡å¼ç›´æ¥è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼›é€šè¿‡å®Œå…¨æ¶ˆé™¤ sidecarï¼Œä¸å†éœ€è¦å¯¹ sidecar ç®¡ç†è¿›è¡Œå¹¿æ³›åŸ¹è®­ã€‚ä½¿ç”¨æ—  sidecar çš„æœåŠ¡ç½‘æ ¼çš„ç”¨æˆ·å¯ä»¥ä¿¡ä»»ï¼Œå¦‚æœåº”ç”¨éƒ¨ç½²åœ¨é›†ç¾¤ä¸Šï¼Œå…¶æµé‡é»˜è®¤åŠ å¯†ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åœºæ™¯-3-é›†æˆé—ç•™åº”ç”¨å¯¼è‡´ä¸­æ–­&#34;&gt;åœºæ™¯ 3: é›†æˆé—ç•™åº”ç”¨å¯¼è‡´ä¸­æ–­&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;â€œæˆ‘ä»¬æœ‰å¤§é‡å¯¹ä¸šåŠ¡è¿è¥è‡³å…³é‡è¦çš„é—ç•™åº”ç”¨ã€‚å¼•å…¥åŸºäº sidecar çš„æœåŠ¡ç½‘æ ¼ä¼šæ‰°ä¹±è¿™äº›åº”ç”¨å¹¶éœ€è¦å¹¿æ³›çš„ä¿®æ”¹ã€‚â€&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Istio çš„ç¯å¢ƒæ¨¡å¼ï¼Œå°†æœåŠ¡æ·»åŠ åˆ°ç½‘æ ¼ç°åœ¨åªéœ€è¦åœ¨å‘½åç©ºé—´æˆ– pod ä¸Šåº”ç”¨ä¸€ä¸ªæ ‡ç­¾ã€‚ç„¶åï¼Œztunnel ä¼šæ‹¦æˆªæµé‡ï¼Œè€Œæ— éœ€é‡å¯åº”ç”¨ã€‚è¿™å¤§å¤§ç®€åŒ–äº†å¯¹å®¹å¿ä¸­æ–­æˆ–ä¿®æ”¹ç¨‹åº¦ä½çš„å…³é”®åº”ç”¨çš„å¼•å¯¼ï¼Œè¿™äº›åº”ç”¨æ­¤å‰å¹¶æœªè¢«è§†ä¸ºç½‘æ ¼çš„å¼ºæœ‰åŠ›å€™é€‰è€…ã€‚åº”ç”¨æ‰€æœ‰è€…ä¸å†éœ€è¦å…³å¿ƒå…¶å·¥ä½œè´Ÿè½½ä¸­çš„ sidecar çš„å­˜åœ¨ã€sidecar çš„ç”Ÿå‘½å‘¨æœŸæˆ– sidecar èµ„æºçš„æˆæœ¬ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¯”è¾ƒç¯å¢ƒæ¨¡å¼çš„ä½¿ç”¨æˆæœ¬&#34;&gt;æ¯”è¾ƒç¯å¢ƒæ¨¡å¼çš„ä½¿ç”¨æˆæœ¬&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†è¯„ä¼°æœåŠ¡ç½‘æ ¼çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œæˆ‘ä»¬å°†åœ¨è§„æ¨¡ä¸Šéƒ¨ç½²ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ã€‚è¿™ä»£è¡¨äº†ç”¨æˆ·åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®é™…ä½¿ç”¨æœåŠ¡ç½‘æ ¼çš„æ–¹å¼ï¼Œå¹¶åŸºäºæˆ‘ä»¬ä¸å®¢æˆ·å…³äºä»–ä»¬å¦‚ä½•ä½¿ç”¨ Istio å’Œ Gloo Mesh çš„è®¨è®ºã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„æµ‹è¯•å·¥ä½œè´Ÿè½½ä»£è¡¨äº†ä¸€ä¸ªåœ¨ Namespace-Per-Tenant æ¨¡å¼ä¸‹é…ç½®çš„åº”ç”¨ï¼Œå…¶ä¸­æ¯ä¸ªç§Ÿæˆ·åœ¨ä¸€ä¸ªéš”ç¦»çš„å‘½åç©ºé—´ä¸­æ“ä½œï¼Œä»¥ç¡®ä¿èµ„æºå’Œå®‰å…¨åˆ†ç¦»ã€‚è¯¥åº”ç”¨è®¾è®¡ä¸ºç»å…¸çš„ 3 å±‚æ‰‡å‡ºæ¶æ„ï¼Œå…¶ä¸­ä¸€ä¸ªåˆå§‹æœåŠ¡å‘å¤šä¸ªä¸‹æ¸¸æœåŠ¡å‘é€è¯·æ±‚ï¼Œä¸å®¢æˆ·ç«¯é’ˆå¯¹å•ä¸ªæœåŠ¡çš„ç®€å•åŸºå‡†ç›¸æ¯”ï¼Œæä¾›äº†æ›´å…·ä»£è¡¨æ€§çš„é¢„æœŸæ€§èƒ½è¯„ä¼°ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-more-for-less/f3_hu_21ef559d5d5064b1.webp 400w,
               /blog/istio-more-for-less/f3_hu_856f16a0651caa9c.webp 760w,
               /blog/istio-more-for-less/f3_hu_45f414b2cc189f9a.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-more-for-less/f3_hu_21ef559d5d5064b1.webp&#34;
               width=&#34;760&#34;
               height=&#34;597&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨æ¯ä¸ªç§Ÿæˆ·ä¸­éƒ¨ç½²äº† 8 ä¸ªå®¹å™¨ï¼Œåˆ†ä¸ºä¸¤ä¸ªâ€œåº”ç”¨â€ï¼Œæ¯ä¸ªåº”ç”¨æœ‰å››ä¸ª podï¼Œå®‰æ’åœ¨ä¸‰å±‚ä¸­ã€‚åœ¨é›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬æ€»å…±æœ‰ 200 ä¸ªå¾®æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-more-for-less/f4_hu_bc69560e7cda007a.webp 400w,
               /blog/istio-more-for-less/f4_hu_63c5977b07748f89.webp 760w,
               /blog/istio-more-for-less/f4_hu_45646223a4009556.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-more-for-less/f4_hu_bc69560e7cda007a.webp&#34;
               width=&#34;760&#34;
               height=&#34;596&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç¡®ä¿â€œä¿è¯â€çš„æœåŠ¡è´¨é‡ç±»åˆ«ï¼Œæ¯ä¸ªåº”ç”¨éƒ½é…ç½®ä¸ºå…·æœ‰ç›¸åŒçš„ pod è¯·æ±‚å’Œé™åˆ¶ï¼š0.7 CPU æ ¸å¿ƒå’Œ 500MB å†…å­˜ã€‚ï¼ˆæˆ‘ä»¬ä½¿ç”¨çš„åº”ç”¨æ˜¯ &lt;a href=&#34;https://github.com/nicholasjackson/fake-service&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;fake-service&lt;/a&gt;ï¼Œä¸€ä¸ªç”± CNCF TAG Network è”åˆä¸»å¸­ Nic Jackson æ„å»ºçš„ç”¨äºæµ‹è¯•æœåŠ¡ç½‘æ ¼çš„ç¤ºä¾‹åº”ç”¨ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;è€ƒè™‘åˆ°ç”¨æˆ·å€¾å‘äºä»¥ä¸­ç­‰åˆ©ç”¨ç‡è¿è¡Œä»–ä»¬çš„é›†ç¾¤ï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬åŸºçº¿åº”ç”¨åœ¨è´Ÿè½½ä¸‹çš„ç›®æ ‡ CPU åˆ©ç”¨ç‡è®¾ä¸º &amp;lt; 30%ï¼Œè¿™ç›¸å½“äºä¸€ä¸ªæ‹¥æœ‰ n2-standard-8 å®ä¾‹çš„ 21 èŠ‚ç‚¹é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç”Ÿæˆåˆæˆè´Ÿè½½ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;a href=&#34;https://github.com/tsenart/vegeta&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Vegeta&lt;/a&gt;ï¼Œæ¯ä¸ªåº”ç”¨æœ‰ä¸€ä¸ªå®ä¾‹ï¼ˆæ¯ä¸ªå‘½åç©ºé—´ä¸¤ä¸ªï¼‰ã€‚è¿˜æœ‰å››ä¸ªèŠ‚ç‚¹ç”¨äºè´Ÿè½½ç”Ÿæˆå™¨ï¼Œå‘æ¯ä¸ªç¬¬ 1 å±‚å‰¯æœ¬æ¯ç§’å‘é€ 200 ä¸ªè¯·æ±‚ã€‚è¿™äº›è¯·æ±‚åœ¨æ˜¾ç¤ºçš„è¾¹ç¼˜ç”Ÿæˆåç»­è¯·æ±‚åˆ°ç¬¬ 2 å±‚å’Œç¬¬ 3 å±‚ï¼Œç»™æ¯ä¸ªç§Ÿæˆ·å¸¦æ¥ 2000 RPS çš„è´Ÿè½½ï¼Œæ•´ä¸ªé›†ç¾¤æ€»å…± 50000 RPSã€‚æˆ‘ä»¬ç¡®ä¿æˆ‘ä»¬åœ¨æµ‹è¯•ä¸­çœ‹åˆ°çš„å»¶è¿Ÿç»“æœç¬¦åˆæˆ‘ä»¬å®šä¹‰çš„é¢„æœŸï¼Œæ²¡æœ‰è¯·æ±‚åœ¨ p50 è¶…è¿‡ 10ms æˆ–åœ¨ p95 è¶…è¿‡ 15msã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯¹æˆ‘ä»¬çš„åº”ç”¨è¿›è¡Œäº†åŸºçº¿è¯»æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä»ç½‘æ ¼æ•°å­—ä¸­å‡å»ï¼Œä»¥äº†è§£æ¯ä¸ªé€‰é¡¹çš„æˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åï¼Œæˆ‘ä»¬åˆ†åˆ«åœ¨ Istio sidecar å’Œç¯å¢ƒæ¨¡å¼ä¸‹éƒ¨ç½²äº†æˆ‘ä»¬çš„åº”ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/solo-io/doing-more-for-less&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½ å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°æˆ‘ä»¬çš„è„šæœ¬å’Œè¾“å‡º&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-çš„ç¯å¢ƒæ¨¡å¼æ¯”-sidecar-èŠ‚çœè¶…è¿‡-70&#34;&gt;Istio çš„ç¯å¢ƒæ¨¡å¼æ¯” Sidecar èŠ‚çœè¶…è¿‡ 70%&lt;/h2&gt;
&lt;p&gt;é™¤äº†æˆ‘ä»¬ä¸Šé¢åˆ—å‡ºçš„æ‰€æœ‰æ“ä½œèŠ‚çœä¹‹å¤–ï¼Œ&lt;strong&gt;åœ¨ç¯å¢ƒæ¨¡å¼ä¸‹è¿è¡Œçš„ Istio æ˜¾è‘—åœ°æ¯”åœ¨ sidecar æ¨¡å¼ä¸‹è¿è¡Œçš„ Istio æ›´ä¾¿å®œ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-more-for-less/f5_hu_cfb3808eb64dd11c.webp 400w,
               /blog/istio-more-for-less/f5_hu_f4b5d268848f7193.webp 760w,
               /blog/istio-more-for-less/f5_hu_1d341382d9ab2242.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-more-for-less/f5_hu_cfb3808eb64dd11c.webp&#34;
               width=&#34;600&#34;
               height=&#34;371&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å³ä½¿åœ¨ä¸€ä¸ªè´Ÿè½½é‡çš„ã€é…ç½®è‰¯å¥½çš„é›†ç¾¤ä¸­ï¼ŒL4 ä¸‹çš„ç¯å¢ƒæ¨¡å¼ä½¿ç”¨çš„ CPU &lt;strong&gt;æ¯” sidecar æ¨¡å¼å°‘ 73%&lt;/strong&gt;ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹é›†ç¾¤ä¸­ï¼ŒIstio çš„ç¯å¢ƒæ¨¡å¼æ¯ä¸ªå‘½åç©ºé—´å‡å°‘äº† 1.28 ä¸ªæ ¸å¿ƒã€‚é‰´äºæˆ‘ä»¬ 25 ä¸ªå‘½åç©ºé—´çš„ç¯å¢ƒï¼Œè¿™ç›¸å½“äºèŠ‚çœ 32 ä¸ªæ ¸å¿ƒï¼Œæˆ–ç›¸å½“äº 4 å° 8 æ ¸æœºå™¨ã€‚é‚£æ˜¯æ¯ä¸ªæœˆèŠ‚çœ 1100 ç¾å…ƒï¼&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-more-for-less/f6_hu_c47993c77af70823.webp 400w,
               /blog/istio-more-for-less/f6_hu_2f21f2644ca7e18.webp 760w,
               /blog/istio-more-for-less/f6_hu_2b812e7647f63277.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-more-for-less/f6_hu_c47993c77af70823.webp&#34;
               width=&#34;600&#34;
               height=&#34;371&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è€Œä¸”ï¼ŒCPU åˆ©ç”¨ç‡æä½ï¼šä»…å¢åŠ  4.78% çš„ CPU ä»¥åœ¨æˆ‘ä»¬çš„å·¥ä½œè´Ÿè½½ä¸­æ·»åŠ  mTLSï¼Œè€Œæ·»åŠ  sidecar ç›¸æ¯”å¢åŠ äº† 24.3%ã€‚å‡è®¾ä½ çš„é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½è‡³å°‘æœ‰ 5% çš„ç©ºé—²å¼€é”€ï¼Œ&lt;strong&gt;ä½ å¯ä»¥åœ¨ä¸å¢åŠ ä»»ä½•é¢å¤–èŠ‚ç‚¹çš„æƒ…å†µä¸‹å®‰è£… Istio çš„ç¯å¢ƒæ¨¡å¼ï¼Œä»è€Œä½¿å…¶å®é™…ä¸Šå…è´¹è¿è¡Œã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·å¸Œæœ›åœ¨ Istio çš„ç¯å¢ƒæ¨¡å¼ä¸‹å®æ–½å®Œæ•´çš„ç¬¬ 7 å±‚åŠŸèƒ½å’Œç‰¹æ€§ï¼Œå¯ä»¥æ”¾å¿ƒåœ°è¿›è¡Œã€‚ä½ å¯ä»¥æŒ‰å‘½åç©ºé—´é€‰æ‹©åŠ å…¥ï¼Œä½†å³ä½¿æˆ‘ä»¬ä¸ºæ‰€æœ‰ç§Ÿæˆ·è¿è¡Œäº†ä¸€ä¸ª waypoint â€”â€” ä¸å®Œæ•´çš„ sidecar éƒ¨ç½²çš„ç‰¹æ€§ç›¸å½“ â€”â€” æˆ‘ä»¬ä»ç„¶çœ‹åˆ°äº†å®è´¨æ€§çš„ CPU èŠ‚çœã€‚è¯·ç•™æ„æˆ‘ä»¬å³å°†å‘å¸ƒçš„åšå®¢ï¼Œå®ƒå°†æ›´æ·±å…¥åœ°è®¨è®ºç¬¬ 7 å±‚çš„æˆæœ¬å’Œä»·å€¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çš„ç ”ç©¶éªŒè¯äº†æ„å»ºç¯å¢ƒæ•°æ®å¹³é¢çš„ç›®æ ‡ï¼šç®€åŒ–æœåŠ¡ç½‘æ ¼çš„æ“ä½œï¼ˆæ—  sidecarï¼‰ï¼Œä»¥åŠé™ä½åŸºç¡€è®¾æ–½æˆæœ¬ï¼ˆä¸ sidecars ç›¸æ¯”çš„æ˜¾è‘—æˆæœ¬èŠ‚çœï¼Œä»åŸºçº¿ä¸Šæ»¡è¶³ mTLS è¦æ±‚çš„é¢å¤–æˆæœ¬å¾ˆå°‘ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœç”¨æˆ·å†³å®šé€šè¿‡é‡‡ç”¨ waypoint ä»£ç†é‡‡ç”¨å®Œæ•´çš„ç¬¬ 7 å±‚åŠŸèƒ½é›†ï¼Œèµ„æºæˆæœ¬å°†è¿œä½äº Istio çš„ä¼ ç»Ÿ sidecar éƒ¨ç½²ï¼Œæ›´ä¸ç”¨è¯´æ›´æ˜“äºç®¡ç†å’Œæ”¹å–„å¼€å‘äººå‘˜çš„ä½“éªŒäº†ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æ— éœ€ Kubernetes æµ‹è¯• Kubernetes ç½‘ç»œå®ç°</title>
      <link>https://cloudnativecn.com/blog/ztunnel-testing/</link>
      <pubDate>Mon, 22 Jul 2024 18:46:32 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/ztunnel-testing/</guid>
      <description>&lt;p&gt;ç”±äºåœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ‘&lt;a href=&#34;https://blog.howardjohn.info/posts/ideal-ci/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çœŸçš„ä¸å–œæ¬¢ç­‰å¾…&lt;/a&gt;ï¼Œæ‰€ä»¥åœ¨æ„å»º Ztunnelï¼ˆä¸€ä¸ªä¸º Istio çš„æ–°&lt;a href=&#34;https://istio.io/latest/blog/2022/introducing-ambient-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambient æ¨¡å¼&lt;/a&gt;è®¾è®¡çš„åº•å±‚ç½‘ç»œä»£ç†ï¼‰æ—¶ï¼Œæˆ‘çš„é¦–è¦ä»»åŠ¡ä¹‹ä¸€ä¾¿æ˜¯ç¡®ä¿æµ‹è¯•çš„å¿«é€Ÿè¿›è¡Œï¼ˆåŒ…æ‹¬è¿è¡Œå’Œç¼–å†™æµ‹è¯•ï¼‰ï¼Œå¹¶ä¸”æ˜“äºè°ƒè¯•ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸€ä»»åŠ¡é¢‡ä¸ºæ£˜æ‰‹ï¼Œå› ä¸ºåœ¨å¤§å¤šæ•°çœŸå®åœºæ™¯ä¸­ï¼ŒZtunnel é«˜åº¦ä¾èµ– Kubernetesã€‚è™½ç„¶å®ƒèƒ½å¤Ÿå®Œå…¨ç‹¬ç«‹äº Kubernetes è¿è¡Œï¼Œä½†è®¸å¤šå…³é”®ä»£ç è·¯å¾„çš„è¡Œä¸ºå®Œå…¨ä¸åŒï¼Œä½¿å¾—ä»…é€šè¿‡è¿™ç§æ–¹å¼è¿›è¡Œæµ‹è¯•å˜å¾—ä¸å¯è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾ä¸ºå…¸å‹çš„ Ztunnel éƒ¨ç½²æ¶æ„ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ztunnel-æ¶æ„æ¦‚è§ˆ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Ztunnel æ¶æ„æ¦‚è§ˆ&#34;
           src=&#34;https://cloudnativecn.com/blog/ztunnel-testing/ztunnel-architecture.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Ztunnel æ¶æ„æ¦‚è§ˆ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤æ¶æ„ä¸­ï¼Œç”¨æˆ·å°†è¿è¡Œä¸€ä¸ªåŒ…å«å¤šä¸ªèŠ‚ç‚¹çš„ Kubernetes é›†ç¾¤ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œç€ä¸€ä¸ª Ztunnelï¼Œé…ç½®äº†å®¿ä¸»æœºå’Œæ¯ä¸ª pod çš„ç½‘ç»œæ ˆã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼ŒZtunnel å®é™…ä¸Šè¿›å…¥äº†æ¯ä¸ª pod çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œå¹¶ä»£è¡¨å…¶å‘é€/æ¥æ”¶æµé‡ã€‚è¿™ä¸€ç‚¹éå¸¸å¥‡ç‰¹ä¸”é…·ç‚«ï¼Œä½†ä¹Ÿå¤§å¤§å¢åŠ äº†æµ‹è¯•çš„éš¾åº¦ï¼ï¼ˆ&lt;a href=&#34;https://www.youtube.com/watch?v=cuMeEhpyH5s&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯¦ç»†ä¿¡æ¯&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;åŠ é€Ÿæµ‹è¯•&#34;&gt;åŠ é€Ÿæµ‹è¯•&lt;/h2&gt;
&lt;p&gt;å¯åŠ¨å®Œæ•´çš„ Kubernetes ç¯å¢ƒã€é‡å»ºé•œåƒã€éƒ¨ç½²åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„è¿‡ç¨‹éå¸¸ç¼“æ…¢ä¸”éš¾ä»¥è°ƒè¯•ã€‚&lt;/p&gt;
&lt;p&gt;é»„é‡‘æ ‡å‡†åº”è¯¥æ˜¯å°†æ‰€æœ‰æ“ä½œè¿è¡Œåœ¨ä¸€ä¸ªç®€å•çš„å•ä¸€äºŒè¿›åˆ¶æ–‡ä»¶ä¸­â€”â€”ä»…éœ€æ‰§è¡Œ &lt;code&gt;cargo test&lt;/code&gt;ã€‚è¿™ç§æ–¹å¼é¿å¼€äº†å¤æ‚çš„è®¾ç½®å’Œç¼“æ…¢çš„é‡å»ºï¼Œå¹¶ä½¿è°ƒè¯•å˜å¾—è½»è€Œæ˜“ä¸¾ï¼ˆå½“ç„¶ï¼Œä½ å¯ä»¥å°†è°ƒè¯•å™¨è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„ podï¼Œä½†è¿™å¾ˆéº»çƒ¦ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è®¾ç½®ç½‘ç»œ&#34;&gt;è®¾ç½®ç½‘ç»œ&lt;/h2&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬å»é™¤æ— å°½çš„æŠ½è±¡å±‚ï¼ŒKubernetes pods å®é™…ä¸Šåªæ˜¯å‡ ä¸ª Linux å‘½åç©ºé—´å’ŒæŒ‚è½½çš„ç»„åˆã€‚Docker åœ¨è¿™æ–¹é¢ç®¡ç†å¾—å¾ˆå¥½ï¼Œ&lt;a href=&#34;https://github.com/p8952/bocker&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bash&lt;/a&gt;ä¹Ÿå¯ä»¥ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç‰¹åˆ«å…³æ³¨çš„æ˜¯&lt;a href=&#34;https://man7.org/linux/man-pages/man7/network_namespaces.7.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘ç»œå‘½åç©ºé—´&lt;/a&gt;ï¼Œå®ƒå¯ä»¥å®ç°ç½‘ç»œæ ˆçš„éš”ç¦»ã€‚æ¯ä¸ª pod éƒ½æœ‰è‡ªå·±çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œé€šè¿‡å„ç§æœºåˆ¶è¿æ¥ï¼Œå…è®¸ä¸åŒä¸€èŠ‚ç‚¹ä¸Šçš„å…¶ä»– podã€å…¶ä»–èŠ‚ç‚¹ä»¥åŠå¤–éƒ¨ç›®çš„åœ°é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;å¥½æ¶ˆæ¯æ˜¯åˆ›å»ºç½‘ç»œå‘½åç©ºé—´éå¸¸ç®€å•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo ip netns add testing
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡æ˜¯è®¾ç½®ä¸€ç³»åˆ—çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œå¤–è§‚ä¸æˆ‘ä»¬åœ¨ Kubernetes ä¸Šçš„çœŸå®æ¶æ„ç±»ä¼¼ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ‰€éœ€çš„ç½‘ç»œå‘½åç©ºé—´è®¾ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ‰€éœ€çš„ç½‘ç»œå‘½åç©ºé—´è®¾ç½®&#34;
           src=&#34;https://cloudnativecn.com/blog/ztunnel-testing/ztunnel-network-namespaces.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ‰€éœ€çš„ç½‘ç»œå‘½åç©ºé—´è®¾ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ç½‘ç»œå‘½åç©ºé—´ä¹‹é—´å»ºç«‹è¿æ¥ç¨å¾®å¤æ‚ä¸€äº›ã€‚åƒ &lt;a href=&#34;https://www.cni.dev/docs/cnitool/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;cnitool&lt;/code&gt;&lt;/a&gt; è¿™æ ·çš„å·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆï¼ˆå®ƒå®é™…ä¸Šæ‰§è¡Œäº†ä¸€äº› Kubernetes ç¯å¢ƒä¸­ç”¨äºè®¾ç½®ç½‘ç»œçš„ç›¸åŒé€»è¾‘ï¼Œä½†ä½œä¸º CLI å·¥å…·ï¼‰ï¼Œä½†ä½ ä¹Ÿå¯ä»¥å®Œå…¨æ‰‹åŠ¨æ“ä½œã€‚æˆ‘ä»¬é€‰æ‹©äº†åè€…ã€‚&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆï¼Œæˆ‘ä»¬çš„è®¾ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ªæµ‹è¯•éƒ½æ‹¥æœ‰è‡ªå·±çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œé€šè¿‡ä¸€ä¸ªæ¡¥æ¥è®¾å¤‡ï¼ˆ&lt;code&gt;br0&lt;/code&gt;ï¼‰æ¥ä¿ƒè¿›èŠ‚ç‚¹ä¹‹é—´çš„æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªèŠ‚ç‚¹é…ç½®äº†ä¸€ä¸ª &lt;code&gt;veth&lt;/code&gt; è®¾å¤‡ã€‚ä¸€ç«¯æˆä¸ºèŠ‚ç‚¹ä¸Šçš„ &lt;code&gt;eth0&lt;/code&gt;ï¼Œå¦ä¸€ç«¯è¿æ¥åˆ°æ ¹å‘½åç©ºé—´ä¸­çš„ &lt;code&gt;br0&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ª pod éƒ½é…ç½®äº†ä¸€ä¸ª &lt;code&gt;veth&lt;/code&gt; è®¾å¤‡ã€‚ä¸€ç«¯æˆä¸º pod ä¸Šçš„ &lt;code&gt;eth0&lt;/code&gt;ï¼Œå¦ä¸€ç«¯ä½äºèŠ‚ç‚¹ç½‘ç»œå‘½åç©ºé—´ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºæ¯ä¸ª pod è®¾ç½®è·¯ç”±ä»¥å°†æµé‡å‘é€åˆ°èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºæ¯å¯¹èŠ‚ç‚¹è®¾ç½®è·¯ç”±ï¼Œä»¥å®ç°è·¨èŠ‚ç‚¹æµé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ‰€éœ€çš„ç½‘ç»œè¿æ¥è®¾ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ‰€éœ€çš„ç½‘ç»œè¿æ¥è®¾ç½®&#34;
           src=&#34;https://cloudnativecn.com/blog/ztunnel-testing/ztunnel-network-devices.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ‰€éœ€çš„ç½‘ç»œè¿æ¥è®¾ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é™¤äº†æ ¹å‘½åç©ºé—´/æ¡¥æ¥è®¾å¤‡å¤–ï¼Œè¿™ä¸è®¸å¤šç°å®ä¸–ç•Œä¸­çš„ Kubernetes é›†ç¾¤çš„è¿è¡Œæ–¹å¼ç›¸åŒï¼ˆåœ¨ç°å®ä¸–ç•Œä¸­ï¼Œæ ¹å‘½åç©ºé—´æ˜¯ä¸¤å°æœºå™¨ä¹‹é—´çš„ç‰©ç†ç½‘ç»œï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥åœ¨&lt;a href=&#34;https://github.com/istio/ztunnel/blob/34fce85a6a2b2a85eb170a04096731e2ea4e0e9f/src/test_helpers/netns.rs#L194&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ°æ‰€æœ‰ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿è¡Œæµ‹è¯•&#34;&gt;è¿è¡Œæµ‹è¯•&lt;/h2&gt;
&lt;p&gt;ä¸€æ—¦æˆ‘ä»¬æœ‰äº†è¿™äº›å‘½åç©ºé—´ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ä¸€ç§å®é™…ä½¿ç”¨å®ƒä»¬çš„æ–¹æ³•ã€‚å¹¸è¿çš„æ˜¯ï¼ŒLinux å…è®¸åœ¨è¿è¡Œæ—¶æ›´æ”¹å½“å‰å‘½åç©ºé—´çº¿ç¨‹ï¼ˆè¿™æ˜¯æ¥ä¸‹æ¥é‡è¦çš„å†…å®¹ï¼‰ã€‚è¿™è®©æˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªåŸºæœ¬çš„å¸®åŠ©å‡½æ•°ï¼ˆçœŸå®çš„ä»£ç ç¨å¾®æ›´å¤æ‚ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;run_in_namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;namespace&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;Fn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;original_namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_current_namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;enter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;original_namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;enter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ä»ä»»æ„çš„â€œpodsâ€æˆ–â€œnodesâ€æ‰§è¡Œä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œæˆ‘ä»¬ä»ç„¶é¢ä¸´ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬çš„æ‰€æœ‰ä»£ç éƒ½è¿è¡Œåœ¨ &lt;a href=&#34;https://tokio.rs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tokio&lt;/a&gt; å¼‚æ­¥è¿è¡Œæ—¶ä¸­ï¼Œå®ƒä¼šæ ¹æ®éœ€è¦å°†æˆ‘ä»¬çš„å„ç§ä»»åŠ¡å®‰æ’åˆ°ç‰©ç†æ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸Šï¼ˆç±»ä¼¼äº Go è¿è¡Œæ—¶çš„å·¥ä½œæ–¹å¼ï¼‰ã€‚ç”±äºç½‘ç»œå‘½åç©ºé—´æ˜¯çº¿ç¨‹ç›¸å…³çš„ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬çš„ä»»åŠ¡åœ¨çº¿ç¨‹ä¹‹é—´è·³è½¬æ—¶ï¼Œè¿™ä¸€åˆ‡éƒ½ä¼šå´©æºƒã€‚&lt;/p&gt;
&lt;p&gt;å¹¸è¿çš„æ˜¯ï¼ŒRust ç»™äº†æˆ‘ä»¬æ¯” Go æ›´å¤šçš„å…³äºå¼‚æ­¥è¿è¡Œæ—¶çš„çµæ´»æ€§â€”â€”æˆ‘ä»¬å¯ä»¥åŒæ—¶æ‹¥æœ‰å¤šä¸ªï¼å€Ÿæ­¤ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ„å»ºä¸€ä¸ªèƒ½å¤Ÿå¼‚æ­¥æ‰§è¡Œ &lt;code&gt;run_in_namespace&lt;/code&gt;ã€‚å¯¹äºæˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„æ¯ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹å¹¶æ„å»ºä¸€ä¸ªä¸“ç”¨çš„å•çº¿ç¨‹å¼‚æ­¥è¿è¡Œæ—¶æ¥å¤„ç†å®ƒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;async&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;async_run_in_namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;namespace&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;async&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Fn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;thread&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;spawn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;move&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;run_in_namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rt&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tokio&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;runtime&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;Builder&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;new_current_thread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;enable_all&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;block_on&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä¸ºæ¯ä¸ªå‘½åç©ºé—´è¿è¡Œä¸€æ¬¡è¿™ä¸ªå‡½æ•°ï¼Œå› æ­¤è¿™é‡Œçš„å¼€é”€æ˜¯æœ€å°çš„ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦è¿è¡Œè®¸å¤šå°å‡½æ•°ï¼Œå¯ä»¥åœ¨é¡¶å±‚æ„å»ºä¸€ä¸ªæŠ½è±¡æ¥å‘é€å·¥ä½œåˆ°çº¿ç¨‹ä»¥æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦çš„æœ€åä¸€ä»¶äº‹æ˜¯ä¸€ç§åˆç†çš„æ–¹æ³•æ¥è¯†åˆ«å¦‚ä½•è°ƒç”¨æ¯ä¸ªç›®çš„åœ°ã€‚è™½ç„¶å®ƒä»¬éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ª IPï¼ˆåŸºäºæˆ‘ä»¬ä»£ç ä¸­çš„ç®€å• IPAM ç­–ç•¥ï¼‰ï¼Œä½†æˆ‘ä»¬ä¸å¸Œæœ›æ¯ä¸ªæµ‹è¯•éƒ½å¿…é¡»çŒœæµ‹ IPã€‚ä¸ºäº†å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªç®€å•çš„åç§°è§£æå™¨ã€‚è¿™å°±åƒ DNSï¼Œä½†ç®€å•å¾—å¤šï¼šå¯¹äºæˆ‘ä»¬åˆ›å»ºçš„æ¯ä¸ªâ€œpodâ€ï¼Œæˆ‘ä»¬è®°å½•ä¸€ä¸ª&lt;code&gt;name -&amp;gt; IP&lt;/code&gt;çš„æ˜ å°„ï¼Œå¹¶å…è®¸æŸ¥æ‰¾ IPã€‚&lt;/p&gt;
&lt;p&gt;å°†æ‰€æœ‰è¿™äº›æ”¾åœ¨ä¸€èµ·ï¼Œä¸€ä¸ªç®€å•çš„æµ‹è¯•å¯åŠ¨äº†3ä¸ª podsï¼ˆå®¢æˆ·ç«¯ã€æœåŠ¡å™¨å’Œ ztunnelï¼‰åœ¨ä¸€ä¸ªå•ä¸€èŠ‚ç‚¹ä¸Šçœ‹èµ·æ¥åƒè¿™æ ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#[tokio::test]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;async&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;simple_test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ztunnel&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;deploy_ztunnel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;DEFAULT_NODE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;await&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;workload_builder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;server&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;DEFAULT_NODE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;register&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;await&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;run_tcp_server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;workload_builder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;client&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;DEFAULT_NODE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;register&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;await&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;run_tcp_client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;resolve&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;server&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// ... some assertions here }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ”¾å¼ƒæƒé™&#34;&gt;æ”¾å¼ƒæƒé™&lt;/h2&gt;
&lt;p&gt;ä¸Šè¿°è®¾ç½®æ•ˆæœå¾ˆå¥½ï¼Œä½†ä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;åŸºæœ¬ä¸Šè®¾ç½®çš„æ¯ä¸€æ­¥éƒ½éœ€è¦æå‡çš„ root æƒé™ï¼›è¿™è®©ç®€å•çš„ &lt;code&gt;cargo test&lt;/code&gt; æ¡ˆä¾‹çš„å¼€ç®±å³ç”¨å˜å¾—ä¹å‘³ï¼Œé€šå¸¸ä¹Ÿä¸å¯å–ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œè¿™ä¼šåœ¨ä¸»æœºç¯å¢ƒä¸­æ±¡æŸ“å¤§é‡çš„å‘½åç©ºé—´ã€‚è™½ç„¶æˆ‘ä»¬æœ‰ä¸€äº›æ¸…ç†è¿‡ç¨‹ï¼Œä½†è¿™äº›å¹¶ä¸æ˜¯100%å¯é ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ‚¬æŒ‚çš„å‘½åç©ºé—´é˜»ç¢æœªæ¥çš„æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³æ‹¥æœ‰å¤ªå¤šå‘½åç©ºé—´çš„é—®é¢˜çš„æ–¹æ³•ï¼Ÿæ›´å¤šçš„å‘½åç©ºé—´ï¼ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦çš„ä¸ä»…ä»…æ˜¯ç½‘ç»œå‘½åç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://man7.org/linux/man-pages/man7/user_namespaces.7.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç”¨æˆ·å‘½åç©ºé—´&lt;/a&gt; å…è®¸æˆ‘ä»¬å®è´¨ä¸Šå‡è£…æ˜¯ UID 0 (root)ï¼ŒåŒæ—¶å®é™…ä¸Šå°†å…¶æ˜ å°„å›æˆ‘ä»¬åŸå§‹çš„ UIDã€‚è¿™é‡Œçš„åŠ›é‡åœ¨äºï¼Œåœ¨è¯¥å‘½åç©ºé—´ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›æœ¬æ¥éœ€è¦ root æƒé™çš„äº‹æƒ…â€”â€”ç‰¹åˆ«æ˜¯åˆ›å»ºæ–°çš„ç½‘ç»œå‘½åç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œæˆ‘ä»¬ä¸èƒ½åšçš„ä¸€ä»¶äº‹æ˜¯ä¿®æ”¹ä¸»æœº-root æ‹¥æœ‰çš„æ–‡ä»¶ï¼ˆè¿™å°†æ˜¯æ˜æ˜¾çš„æƒé™è¿è§„ï¼‰ã€‚å°½ç®¡æˆ‘ä»¬å¯èƒ½å¯ä»¥ç»•è¿‡å®ƒä»¬ï¼Œä½†æˆ‘ä»¬åœ¨æµ‹è¯•ä¸­ä½¿ç”¨çš„å¾ˆå¤šå·¥å…·å–œæ¬¢è§¦æ‘¸ root æ–‡ä»¶ã€‚è¿™å†æ¬¡å¯ä»¥é€šè¿‡ &lt;a href=&#34;https://man7.org/linux/man-pages/man7/mount_namespaces.7.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mount å‘½åç©ºé—´&lt;/a&gt; è§£å†³ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†æˆ‘ä»¬æ‹¥æœ‰çš„æ–‡ä»¶ç»‘å®šæŒ‚è½½åˆ°ä¸»æœº-root æ‹¥æœ‰çš„æ–‡ä»¶ä¸Šï¼Œè€Œä¸ä¼šå½±å“å‘½åç©ºé—´å¤–çš„äº‹ç‰©ã€‚&lt;/p&gt;
&lt;p&gt;å°†æ‰€æœ‰è¿™äº›æ”¾åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬æœ‰è¿™æ ·çš„ä¸œè¥¿ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;original_uid&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_uid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// é¦–å…ˆï¼Œè¿›å…¥ä¸€ä¸ªæ–°çš„ç”¨æˆ·å‘½åç©ºé—´ã€‚ unshare(CloneFlags::CLONE_NEWUSER).unwrap(); // å°†ç”¨æˆ·å‘½åç©ºé—´ä¸­çš„ root æ˜ å°„åˆ°æˆ‘ä»¬åŸå§‹çš„ UID File::create(&amp;#34;/proc/self/uid_map&amp;#34;).write(format!(&amp;#34;0 {original_uid} 1&amp;#34;)); // è®¾ç½®ä¸€ä¸ªæ–°çš„ç½‘ç»œå‘½åç©ºé—´ unshare(CloneFlags::CLONE_NEWNET).unwrap(); // è®¾ç½®ä¸€ä¸ªæ–°çš„æŒ‚è½½å‘½åç©ºé—´ unshare(CloneFlags::CLONE_NEWNS).unwrap(); // å°†ä¸€ä¸ªæ–‡ä»¶å¤¹åœ¨æˆ‘ä»¬çš„æ¯ä¸ªæµ‹è¯•ç›®å½•ä¸­æŒ‚è½½åˆ° /var/run/netns mount(tmp_dir.join(&amp;#34;netns&amp;#34;), &amp;#34;/var/run/netns&amp;#34;, MS_BIND); // ä¸€ä¸ªæ–¹ä¾¿æ‰‹åŠ¨è°ƒè¯•çš„å¥½å¸®æ‰‹ä¿¡æ¯ï¼Œå¦‚æœéœ€è¦çš„è¯ã€‚ let pid = get_pid(); eprintln!(&amp;#34;Starting test in {tmp_dir}. Debug with `sudo nsenter --mount --net -t {pid}`&amp;#34;);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸Šæ‰€è¿°ï¼Œä¸€ä¸ªæŠ€å·§æ˜¯ï¼Œè¿›å…¥å‘½åç©ºé—´æ˜¯æŒ‰çº¿ç¨‹è¿›è¡Œçš„ã€‚æˆ‘ä»¬éœ€è¦åœ¨ç”Ÿæˆä»»ä½•é¢å¤–çº¿ç¨‹ä¹‹å‰è®¾ç½®è¿™ä¸€ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;Rust å®é™…ä¸Šä¸ºæˆ‘ä»¬æä¾›äº†è¿™æ ·åšçš„èƒ½åŠ›ï¼Œä½†è¿™æ„å‘³ç€æˆ‘ä»¬å¤±å»äº† &lt;code&gt;#[tokio::test]&lt;/code&gt; å®å¸®åŠ©ã€‚æˆ‘ä»¬å¯ä»¥å†™è‡ªå·±çš„å®ï¼Œä½†è¿™æœ‰ç‚¹ç—›è‹¦ã€‚å¹¸è¿çš„æ˜¯ï¼Œé€šè¿‡ &lt;a href=&#34;https://crates.io/crates/ctor&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é“¾æ¥å™¨çš„èŠ±æ‹›&lt;/a&gt; æˆ‘ä»¬å¯ä»¥è¿«ä½¿æˆ‘ä»¬çš„ä»£ç åœ¨è¿›ç¨‹æ‰§è¡Œçš„éå¸¸æ—©æœŸè¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;Go ä¸­çš„ç±»ä¼¼æ–¹æ³•ä¹Ÿæœ‰æ•ˆï¼ˆè¯·å‚è§ &lt;a href=&#34;https://github.com/howardjohn/unshare-go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘å†™çš„å¸®åŠ©åº“&lt;/a&gt;ï¼‰ï¼Œå®é™…ä¸Šåœ¨é‚£é‡Œæ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºè®¾ç½®å¿…é¡»åœ¨ Go è¿è¡Œæ—¶å¯åŠ¨ä¹‹å‰å®Œæˆï¼ˆè¿™é€šå¸¸åœ¨ä»»ä½•ç”¨æˆ·ä»£ç è¿è¡Œä¹‹å‰å¾ˆä¹…ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æœ‰äº†æ‰€æœ‰è¿™äº›è®¾å¤‡ï¼Œä¸€ä¸ªå®Œæ•´çš„æµ‹è¯•åªéœ€è¦å¤§çº¦ 200 æ¯«ç§’ã€‚ä¸€åˆ‡éƒ½åœ¨ä¸€ä¸ªå•ä¸€è¿›ç¨‹ä¸­è¿è¡Œï¼Œä½¿è°ƒè¯•å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚æ‰€æœ‰çš„æµ‹è¯•ä¹Ÿéƒ½æ˜¯å®Œå…¨éš”ç¦»çš„ï¼Œå› æ­¤å¯ä»¥å®Œå…¨å¹¶è¡Œè¿è¡Œæµ‹è¯•ï¼ˆåŒ…æ‹¬ç›¸åŒçš„æµ‹è¯•ï¼Œç”¨äºå‹åŠ›æµ‹è¯•ä»¥æ¶ˆé™¤æµ‹è¯•ç¼ºé™·ï¼‰ã€‚&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
