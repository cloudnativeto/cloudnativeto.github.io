<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Rinor Maloku | äº‘åŸç”Ÿç¤¾åŒºï¼ˆä¸­å›½ï¼‰</title>
    <link>https://cloudnative.to/author/rinor-maloku/</link>
      <atom:link href="https://cloudnative.to/author/rinor-maloku/index.xml" rel="self" type="application/rss+xml" />
    <description>Rinor Maloku</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language>
    <image>
      <url>https://cloudnative.to/author/rinor-maloku/avatar_hue38add62c87b7486d80c9f3fda25dfc1_12220_270x270_fill_q75_lanczos_center.jpg</url>
      <title>Rinor Maloku</title>
      <link>https://cloudnative.to/author/rinor-maloku/</link>
    </image>
    
    <item>
      <title>ä½¿ç”¨ Istio æ‰“é€ å¾®æœåŠ¡ï¼ˆç¬¬ 2 éƒ¨åˆ†ï¼‰â€”â€”è®¤è¯å’Œæˆæƒ</title>
      <link>https://cloudnative.to/blog/back-to-microservices-with-istio-part-2-authentication-authorization/</link>
      <pubDate>Mon, 25 Mar 2019 10:58:41 +0800</pubDate>
      <guid>https://cloudnative.to/blog/back-to-microservices-with-istio-part-2-authentication-authorization/</guid>
      <description>&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bke0q1bnj20m80bqwm6_hu5cd10a131c02288057d9de5af42edf77_179134_cb5160cdf96a9d8e60e79e523e211f64.webp 400w,
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bke0q1bnj20m80bqwm6_hu5cd10a131c02288057d9de5af42edf77_179134_39b71e1eee444fe59bb51b2a23008927.webp 760w,
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bke0q1bnj20m80bqwm6_hu5cd10a131c02288057d9de5af42edf77_179134_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bke0q1bnj20m80bqwm6_hu5cd10a131c02288057d9de5af42edf77_179134_cb5160cdf96a9d8e60e79e523e211f64.webp&#34;
               width=&#34;760&#34;
               height=&#34;401&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://medium.com/google-cloud/back-to-microservices-with-istio-part-2-authentication-authorization-b079f77358ac&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;è¿™ç¯‡æ–‡ç« æ˜¯ä½¿ç”¨ Istio æ‰“é€ å¾®æœåŠ¡&lt;/em&gt;çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œå¦‚æœæ²¡æœ‰çœ‹ç¬¬ä¸€ç¯‡çš„è¯ï¼Œè¯·å…ˆçœ‹&lt;a href=&#34;http://www.servicemesher.com/blog/back-to-microservices-with-istio-p1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¬¬ä¸€éƒ¨åˆ†å†…å®¹&lt;/a&gt;ï¼Œå› ä¸ºè¿™ç¯‡åšå®¢æ˜¯ä»¥ç¬¬ä¸€ç¯‡åšå®¢ä¸ºåŸºç¡€è¿›è¡Œè¿›ä¸€æ­¥æ·±å…¥çš„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ª Kubernetes é›†ç¾¤ï¼Œå¹¶ä¸”åœ¨ä¸Šé¢éƒ¨ç½²äº† &lt;strong&gt;Istio&lt;/strong&gt; å’Œç¤ºä¾‹å¾®æœåŠ¡åº”ç”¨ç¨‹åºâ€œSentiment Analysisâ€ï¼Œç”¨æ¥å±•ç¤º Istio çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Istio åï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåº”ç”¨å±‚ä¸­çš„é‡è¯•ã€è¶…æ—¶ã€æ–­è·¯å™¨ã€è·Ÿè¸ªã€ç›‘æ§å†…å®¹æŠ›å¼ƒï¼Œä»¥ä¿æŒæˆ‘ä»¬çš„æœåŠ¡åº”ç”¨ä¿æŒåœ¨ä¸€ä¸ªç®€å•ä¸“æ³¨çš„å¾®å‹çŠ¶æ€ï¼Œï¼ˆå¦‚å›¾ 1 æ‰€ç¤ºï¼‰ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ç”¨äº†é«˜çº§æµ‹è¯•å’Œéƒ¨ç½²æŠ€æœ¯ï¼Œå¦‚ A/B æµ‹è¯•ï¼Œé•œåƒå’Œé‡‘ä¸é›€éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-1å¾®æœåŠ¡çš„å½¢å¼æ„æˆ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1.å¾®æœåŠ¡çš„å½¢å¼æ„æˆ&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkei4aehj20aj082wf1_hufcbc8729df9d7a760dabbcd6f5084bfc_57753_c64407f555e8723af76f91a5d7ba74ed.webp 400w,
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkei4aehj20aj082wf1_hufcbc8729df9d7a760dabbcd6f5084bfc_57753_b84c1e77ae67d018e3544304720913e5.webp 760w,
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkei4aehj20aj082wf1_hufcbc8729df9d7a760dabbcd6f5084bfc_57753_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkei4aehj20aj082wf1_hufcbc8729df9d7a760dabbcd6f5084bfc_57753_c64407f555e8723af76f91a5d7ba74ed.webp&#34;
               width=&#34;379&#34;
               height=&#34;290&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1.å¾®æœåŠ¡çš„å½¢å¼æ„æˆ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å¸¦é¢†è¯»è€…ä½¿ç”¨ Istio æ¥å¤„ç†èº«ä»½éªŒè¯å’Œæˆæƒï¼&lt;/p&gt;
&lt;h2 id=&#34;istio-ä¸­çš„è®¤è¯å’Œæˆæƒ&#34;&gt;Istio ä¸­çš„è®¤è¯å’Œæˆæƒ&lt;/h2&gt;
&lt;p&gt;æˆ‘æ°¸è¿œä¸ä¼šç›¸ä¿¡è®¤è¯å’Œæˆæƒä¼šè®©æˆ‘æ„Ÿåˆ°å…´å¥‹ï¼ä½†æ˜¯ Istio å¯ä»¥è®©è¿™ä¸ªè¯é¢˜å˜å¾—æœ‰è¶£ï¼Œè¿™ç§æƒ…å†µä¸‹éš¾é“ä½ ä¸æ„Ÿåˆ°å…´å¥‹ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç­”æ¡ˆå¾ˆç®€å•&lt;/strong&gt;ï¼šIstio å°†è¿™äº›èŒè´£ä»æˆ‘ä»¬çš„æœåŠ¡ä¸‹æ²‰åˆ° Envoy ä»£ç†ï¼Œå½“è¯·æ±‚åˆ°è¾¾æˆ‘ä»¬çš„æœåŠ¡æ—¶ï¼Œå®ƒä»¬å·²ç»ç»è¿‡èº«ä»½éªŒè¯å’Œæˆæƒï¼Œæˆ‘ä»¬åªéœ€ç¼–å†™æä¾›ä¸šåŠ¡ä»·å€¼çš„ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;å¬èµ·æ¥ä¸é”™ï¼Ÿè®©æˆ‘ä»¬å»ç§ç§å§ï¼&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-auth0-è¿›è¡Œèº«ä»½éªŒè¯&#34;&gt;ä½¿ç”¨ Auth0 è¿›è¡Œèº«ä»½éªŒè¯&lt;/h2&gt;
&lt;p&gt;ä½œä¸ºèº«ä»½å’Œè®¿é—®ç®¡ç†æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Auth0ï¼Œå®ƒæœ‰ä¸€ä¸ªè¯•ç”¨é€‰é¡¹ï¼Œç›´è§‚æ˜“ç”¨ï¼Œæˆ‘åªæ˜¯å–œæ¬¢å®ƒï¼ä¹Ÿå°±æ˜¯è¯´ï¼Œç›¸åŒçš„åŸåˆ™å¯ä»¥ç”¨äºä»»ä½• &lt;a href=&#34;https://openid.net/developers/certified/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenID Connect å®ç°&lt;/a&gt;ï¼Œå¦‚ KeyCloakã€IdentityServer ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;è¦å¼€å§‹ä½¿ç”¨ï¼Œè¯·ä½¿ç”¨æ‚¨çš„å¸æˆ·å¯¼èˆªåˆ°&lt;a href=&#34;https://manage.auth0.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Auth0 Portal&lt;/a&gt;ï¼Œåœ¨ Applications&amp;gt; Default App ä¸‹åˆ›å»ºç§Ÿæˆ·å¹¶é€‰æ‹© Domainï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-2-auth0-ç®¡ç†é—¨æˆ·ä¸­çš„é»˜è®¤åº”ç”¨ç¨‹åº&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 2. Auth0 ç®¡ç†é—¨æˆ·ä¸­çš„é»˜è®¤åº”ç”¨ç¨‹åº&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkeum2wwj20m80exmzl_hu5b9ca142752aa3b0d83f0d6b6656efd4_182068_ab10f34ab548af3cb87df37536e81f8a.webp 400w,
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkeum2wwj20m80exmzl_hu5b9ca142752aa3b0d83f0d6b6656efd4_182068_5bfd6c57486e2f15220b7c4fe88d2a8e.webp 760w,
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkeum2wwj20m80exmzl_hu5b9ca142752aa3b0d83f0d6b6656efd4_182068_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkeum2wwj20m80exmzl_hu5b9ca142752aa3b0d83f0d6b6656efd4_182068_ab10f34ab548af3cb87df37536e81f8a.webp&#34;
               width=&#34;760&#34;
               height=&#34;510&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 2. Auth0 ç®¡ç†é—¨æˆ·ä¸­çš„é»˜è®¤åº”ç”¨ç¨‹åº
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ›´æ–°æ–‡ä»¶ &lt;code&gt;resource-manifests/istio/security/auth-policy.yaml&lt;/code&gt; ä»¥ä½¿ç”¨æ‚¨çš„åŸŸåï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;authentication.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Policy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;auth-policy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-web-app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-feedback&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;origins&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;jwt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;issuer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https://{YOUR_DOMAIN}/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;jwksUri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https://{YOUR_DOMAIN}/.well-known/jwks.json&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;principalBinding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;USE_ORIGIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰äº†è¿™ä¸ªèµ„æºï¼Œpilot ä¼šé…ç½® envoy åœ¨å°†è¯·æ±‚è½¬å‘ç»™æœåŠ¡&lt;code&gt;sa-web-app&lt;/code&gt; å’Œ &lt;code&gt;sa-feedback&lt;/code&gt;ä¹‹å‰å¯¹å…¶è¿›è¡Œèº«ä»½éªŒè¯ã€‚åŒæ—¶ï¼Œè¿™ä¸ªç­–ç•¥ä¸ä¼šåº”ç”¨åˆ°è¿è¡Œ&lt;code&gt;sa-frontend&lt;/code&gt;æœåŠ¡çš„ envoy ä¸Šï¼Œè¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿæœªç»è®¤è¯å°±è®¿é—®å‰ç«¯æœåŠ¡ã€‚è¦åº”ç”¨è¿™äº›ç­–ç•¥ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/security/auth-policy.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;policy.authentication.istio.io &lt;span class=&#34;s2&#34;&gt;&amp;#34;auth-policy&amp;#34;&lt;/span&gt; created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿”å›é¡µé¢å¹¶å‘å‡ºè¯·æ±‚ï¼Œæ‚¨å°†çœ‹åˆ°å®ƒå°†ä»¥ 401 Unauthorized ç»“æŸï¼Œç°åœ¨è®©æˆ‘ä»¬ä»å‰ç«¯è½¬å‘ç”¨æˆ·ä»¥ä½¿ç”¨ Auth0 è¿›è¡Œèº«ä»½éªŒè¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-auth0-éªŒè¯è¯·æ±‚&#34;&gt;ä½¿ç”¨ Auth0 éªŒè¯è¯·æ±‚&lt;/h2&gt;
&lt;p&gt;è¦éªŒè¯æœ€ç»ˆç”¨æˆ·çš„è¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Auth0 ä¸­åˆ›å»ºä¸€ä¸ª APIï¼Œè¡¨ç¤ºç»è¿‡èº«ä»½éªŒè¯çš„æœåŠ¡ï¼Œå³ï¼šè¯„è®ºï¼Œè¯¦ç»†ä¿¡æ¯å’Œè¯„çº§ã€‚è¦åˆ›å»º APIï¼Œè¯·å¯¼èˆªåˆ° &lt;strong&gt;Auth0 Portal&lt;/strong&gt; &amp;gt; &lt;strong&gt;API&lt;/strong&gt; &amp;gt; &lt;strong&gt;Create API&lt;/strong&gt; ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-3åœ¨-auth0-ä¸­åˆ›å»ºæ–°-api&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 3.åœ¨ Auth0 ä¸­åˆ›å»ºæ–° API&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkg16se5j20m80ivq56_hubc388dc8bdfec50a7a0aafdaa4b3e4f2_116222_48f3d7dd181257018f4475ffa8b65eeb.webp 400w,
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkg16se5j20m80ivq56_hubc388dc8bdfec50a7a0aafdaa4b3e4f2_116222_a400f3bb5fa5a838587527a08704c9de.webp 760w,
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkg16se5j20m80ivq56_hubc388dc8bdfec50a7a0aafdaa4b3e4f2_116222_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkg16se5j20m80ivq56_hubc388dc8bdfec50a7a0aafdaa4b3e4f2_116222_48f3d7dd181257018f4475ffa8b65eeb.webp&#34;
               width=&#34;760&#34;
               height=&#34;645&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 3.åœ¨ Auth0 ä¸­åˆ›å»ºæ–° API
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™é‡Œçš„é‡è¦ä¿¡æ¯æ˜¯ç¨ååœ¨è„šæœ¬ä¸­ä½¿ç”¨çš„æ ‡è¯†ç¬¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è§‚ä¼—ï¼š&lt;/strong&gt; {YOUR_AUDIENCE}&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä½™æ‰€éœ€çš„è¯¦ç»†ä¿¡æ¯ä½äº Auth0 Portal ä¸­çš„ &lt;strong&gt;Applications&lt;/strong&gt; ä¸‹ï¼Œç„¶åé€‰æ‹©è‡ªåŠ¨åˆ›å»ºçš„ä¸ API åŒåçš„ &lt;strong&gt;Test Application&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¯·è®°ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸŸåï¼š&lt;/strong&gt; {YOUR_DOMAIN}&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¢æˆ· IDï¼š&lt;/strong&gt; {YOUR_CLIENT_ID}&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ Test Application ä¸­å‘ä¸‹æ»šåŠ¨åˆ°&lt;strong&gt;Allowed Callback URLs&lt;/strong&gt;æ–‡æœ¬ä½ç½®ï¼Œåœ¨æ­¤å­—æ®µä¸­æˆ‘ä»¬æŒ‡å®šè¯·æ±‚åœ¨å®Œæˆèº«ä»½éªŒè¯ååº”è¢«è½¬å‘åˆ°çš„ç›®çš„ URLã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå®ƒæ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[http://{EXTERNAL_IP}/callback](http://%7BEXTERNAL_IP%7D/callback)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å‘&lt;strong&gt;Allowed Logout URLs&lt;/strong&gt;æ·»åŠ ä»¥ä¸‹ URLï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[http://{EXTERNAL_IP}/logout](http://%7BEXTERNAL_IP%7D/logout)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥è®©æˆ‘ä»¬å¼€å§‹å¤„ç†å‰ç«¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ›´æ–°å‰ç«¯&#34;&gt;æ›´æ–°å‰ç«¯&lt;/h2&gt;
&lt;p&gt;æ£€å‡º &lt;code&gt;[istio-mastery]&lt;/code&gt; å­˜å‚¨åº“ä¸­çš„&lt;strong&gt;auth0&lt;/strong&gt; åˆ†æ”¯ã€‚åœ¨æ­¤åˆ†æ”¯ä¸­ï¼Œå‰ç«¯åŒ…å«ä»£ç æ›´æ”¹ä»¥å°†ç”¨æˆ·è½¬å‘åˆ° Auth0 è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¹¶åœ¨å¯¹å…¶ä»–æœåŠ¡çš„è¯·æ±‚ä¸­ä½¿ç”¨ JWT ä»¤ç‰Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;analyzeSentence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;fetch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;/sentiment&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;POST&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;application/json&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Authorization&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;sb&#34;&gt;`Bearer &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;auth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;getAccessToken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Access Token
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;JSON&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stringify&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;({&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sentence&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;textField&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;getValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;then&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;json&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;then&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;setState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†æ›´æ–°å‰ç«¯ä»¥ä½¿ç”¨ä½ çš„ç§Ÿæˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å¯¼èˆªåˆ°è¯¥æ–‡ä»¶ &lt;code&gt;sa-frontend/src/services/Auth.js&lt;/code&gt; å¹¶ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰è®°ä¸‹çš„å€¼æ›¿æ¢ä»¥ä¸‹å€¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kr&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Config&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;clientID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;{YOUR_CLIENT_ID}&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;domain&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{YOUR_DOMAIN}&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;audience&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;{YOUR_AUDIENCE}&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ingressIP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;{EXTERNAL_IP}&amp;#39;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Used to redirect after authentication
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”ç”¨ç¨‹åºå·²å‡†å¤‡å°±ç»ªï¼Œè¯·åœ¨ä¸‹é¢çš„å‘½ä»¤ä¸­æŒ‡å®š docker ç”¨æˆ· IDï¼Œç„¶åæ„å»ºå¹¶éƒ¨ç½²ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker build -f sa-frontend/Dockerfile &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; -t &lt;span class=&#34;nv&#34;&gt;$DOCKER_USER_ID&lt;/span&gt;/sentiment-analysis-frontend:istio-auth0 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; sa-frontend
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker push &lt;span class=&#34;nv&#34;&gt;$DOCKER_USER_ID&lt;/span&gt;/sentiment-analysis-frontend:istio-auth0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; image deployment/sa-frontend &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; sa-frontend&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$DOCKER_USER_ID&lt;/span&gt;/sentiment-analysis-frontend:istio-auth0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯•ä¸€è¯•åº”ç”¨å§ï¼æ‚¨å°†è¢«è½¬å‘åˆ° Auth0ï¼Œåœ¨é‚£é‡Œæ‚¨å¿…é¡»ç™»å½•ï¼ˆæˆ–æ³¨å†Œï¼‰ï¼Œç„¶åè·³è½¬å›åŸé¡µé¢ï¼Œä»¥åå°±å¯ä»¥å‘å‡ºç»è¿‡èº«ä»½éªŒè¯çš„è¯·æ±‚äº†ã€‚åŒæ—¶ï¼Œå¦‚æœæ‚¨å°è¯•ä½¿ç”¨æ—©æœŸçš„ curl å‘½ä»¤ï¼Œæ‚¨å°†è·å¾— 401 çŠ¶æ€ä»£ç ï¼Œè¡¨æ˜è¯¥è¯·æ±‚æ˜¯æœªæˆæƒçš„ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œæˆæƒè¯·æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-auth0-æˆæƒ&#34;&gt;ä½¿ç”¨ Auth0 æˆæƒ&lt;/h2&gt;
&lt;p&gt;èº«ä»½éªŒè¯ä½¿æˆ‘ä»¬èƒ½å¤ŸçŸ¥é“ç”¨æˆ·æ˜¯è°ï¼Œä½†æˆ‘ä»¬éœ€è¦æˆæƒæ‰èƒ½çŸ¥é“ä»–ä»¬å¯ä»¥è®¿é—®çš„å†…å®¹ã€‚Istio ä¹Ÿä¸ºæ­¤æä¾›äº†å·¥å…·ï¼&lt;/p&gt;
&lt;p&gt;ä½œä¸ºç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸¤ç»„ç”¨æˆ·ï¼ˆå¦‚å›¾ 24 æ‰€ç¤ºï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”¨æˆ·&lt;/strong&gt; ï¼šåªèƒ½è®¿é—® SA-WebApp å’Œ SA-Frontend æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰ˆä¸»&lt;/strong&gt; ï¼šå¯ä»¥è®¿é—®æ‰€æœ‰ä¸‰é¡¹æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-4æˆæƒæ¦‚å¿µ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 4.æˆæƒæ¦‚å¿µ&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bki3dbfij20m80dcdhb_huae68aa1198e9aa6abe91f4e2d019eec9_131695_96c777c8782149a40dbfa483494d5339.webp 400w,
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bki3dbfij20m80dcdhb_huae68aa1198e9aa6abe91f4e2d019eec9_131695_c6c15acad7a3f3a1a146dd3391e0622b.webp 760w,
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bki3dbfij20m80dcdhb_huae68aa1198e9aa6abe91f4e2d019eec9_131695_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bki3dbfij20m80dcdhb_huae68aa1198e9aa6abe91f4e2d019eec9_131695_96c777c8782149a40dbfa483494d5339.webp&#34;
               width=&#34;760&#34;
               height=&#34;456&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 4.æˆæƒæ¦‚å¿µ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¦åˆ›å»ºç”¨æˆ·ç»„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Auth0 æˆæƒæ‰©å±•ï¼Œç„¶åä½¿ç”¨ Istioï¼Œæˆ‘ä»¬å°†ä¸ºä»–ä»¬æä¾›ä¸åŒçº§åˆ«çš„è®¿é—®æƒé™ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…å’Œé…ç½®-auth0-æˆæƒ&#34;&gt;å®‰è£…å’Œé…ç½® Auth0 æˆæƒ&lt;/h2&gt;
&lt;p&gt;åœ¨ Auth0 é—¨æˆ·ä¸­ï¼Œå¯¼èˆªåˆ° Extensions å¹¶å®‰è£…â€œAuth0 Authorizationâ€æ‰©å±•ã€‚å®‰è£…å®Œæˆåï¼Œå¯¼èˆªåˆ°æˆæƒæ‰©å±•å¹¶é€šè¿‡å•å‡»å³ä¸Šè§’çš„ç§Ÿæˆ·å¹¶é€‰æ‹©èœå•é€‰é¡¹â€œé…ç½®â€è¿›è¡Œé…ç½®ã€‚å¯ç”¨ç»„ï¼Œç„¶åå•å‡» &lt;strong&gt;å‘å¸ƒè§„åˆ™&lt;/strong&gt; æŒ‰é’®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-5æ¿€æ´»ä»¤ç‰Œå†…å®¹ä¸­çš„ç»„&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 5.æ¿€æ´»ä»¤ç‰Œå†…å®¹ä¸­çš„ç»„&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkiopfw9j20m807ndhc_hua301405e3a56328d6e9117a1edcc919d_99440_97a477b184479ac7652aee014a078ff2.webp 400w,
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkiopfw9j20m807ndhc_hua301405e3a56328d6e9117a1edcc919d_99440_55c48d5fc5b6fafc2dc0aaadacc5d871.webp 760w,
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkiopfw9j20m807ndhc_hua301405e3a56328d6e9117a1edcc919d_99440_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkiopfw9j20m807ndhc_hua301405e3a56328d6e9117a1edcc919d_99440_97a477b184479ac7652aee014a078ff2.webp&#34;
               width=&#34;760&#34;
               height=&#34;261&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 5.æ¿€æ´»ä»¤ç‰Œå†…å®¹ä¸­çš„ç»„
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;åˆ›å»ºç»„&#34;&gt;åˆ›å»ºç»„&lt;/h2&gt;
&lt;p&gt;åœ¨æˆæƒæ‰©å±•ä¸­ï¼Œå¯¼èˆªåˆ° &lt;strong&gt;Groups&lt;/strong&gt; å¹¶åˆ›å»º&lt;code&gt;Moderators&lt;/code&gt;ç»„ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¼šå°†æ‰€æœ‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·è§†ä¸ºå¸¸è§„ç”¨æˆ·ï¼Œå› æ­¤æ— éœ€åˆ›å»ºå…¶ä»–ç»„ã€‚&lt;/p&gt;
&lt;p&gt;é€‰æ‹© Moderators ç»„ï¼Œç„¶åå•å‡»æ·»åŠ æˆå‘˜ï¼Œæ·»åŠ æ‚¨çš„ä¸»å¸æˆ·ã€‚ä¿ç•™ä¸€äº›æ²¡æœ‰ä»»ä½•ç»„çš„ç”¨æˆ·ï¼Œä»¥éªŒè¯æ˜¯å¦ç¦æ­¢è®¿é—®ã€‚ï¼ˆæ‚¨å¯ä»¥åœ¨ Auth0 Portal&amp;gt;ç”¨æˆ·&amp;gt;åˆ›å»ºç”¨æˆ·ä¸­æ‰‹åŠ¨æ³¨å†Œæ–°ç”¨æˆ·ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;å°†ç»„å£°æ˜æ·»åŠ åˆ°è®¿é—®ä»¤ç‰Œ&#34;&gt;å°†ç»„å£°æ˜æ·»åŠ åˆ°è®¿é—®ä»¤ç‰Œ&lt;/h2&gt;
&lt;p&gt;ç”¨æˆ·å°†æ·»åŠ åˆ°ç»„ä¸­ï¼Œä½†æ­¤ä¿¡æ¯ä¸ä¼šåæ˜ åœ¨è®¿é—®ä»¤ç‰Œä¸­ã€‚ä¸ºäº†ä¿æŒ OpenID Connect ç¬¦åˆè¦æ±‚å¹¶åŒæ—¶è¿”å›ç»„ï¼Œæˆ‘ä»¬éœ€è¦å‘ä»¤ç‰Œ&lt;a href=&#34;https://auth0.com/docs/tokens/access-token#add-custom-claims&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·»åŠ è‡ªå®šä¹‰å‘½åç©ºé—´å£°æ˜&lt;/a&gt;ã€‚è¿™å¯ä»¥ä½¿ç”¨ Auth0 è§„åˆ™æ¥å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;è¦åœ¨ Auth0 Portal ä¸­åˆ›å»ºè§„åˆ™ï¼Œè¯·å¯¼èˆªåˆ°è§„åˆ™ï¼Œå•å‡»â€œåˆ›å»ºè§„åˆ™â€å¹¶ ä»æ¨¡æ¿ä¸­ é€‰æ‹©ä¸€ä¸ª &lt;strong&gt;ç©ºè§„åˆ™&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-6åˆ›å»ºæ–°è§„åˆ™&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 6.åˆ›å»ºæ–°è§„åˆ™&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkizxe7vj20m80c2wga_hu18bddce38823221539766bf58a479d9d_151240_078f2531e4ae5ea8d6159e65f2a3a4da.webp 400w,
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkizxe7vj20m80c2wga_hu18bddce38823221539766bf58a479d9d_151240_fdefa4f62238b4d9bc256ad7b1300e53.webp 760w,
               /blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkizxe7vj20m80c2wga_hu18bddce38823221539766bf58a479d9d_151240_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-part-2-authentication-authorization/61411417ly1g1bkizxe7vj20m80c2wga_hu18bddce38823221539766bf58a479d9d_151240_078f2531e4ae5ea8d6159e65f2a3a4da.webp&#34;
               width=&#34;760&#34;
               height=&#34;412&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 6.åˆ›å»ºæ–°è§„åˆ™
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç²˜è´´ä¸‹é¢çš„ä»£ç å¹¶ä¿å­˜åä¸ºâ€œæ·»åŠ ç»„å£°æ˜â€çš„æ–°è§„åˆ™ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;callback&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;accessToken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;https://sa.io/group&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;groups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;callback&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼š&lt;/strong&gt; æ­¤ä»£ç é€‰æ‹©æˆæƒæ‰©å±•ä¸­å®šä¹‰çš„ç¬¬ä¸€ä¸ªç”¨æˆ·ç»„ï¼Œå¹¶å°†å…¶ä½œä¸ºè‡ªå®šä¹‰å‘½åç©ºé—´å£°æ˜æ·»åŠ åˆ°è®¿é—®ä»¤ç‰Œä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿”å› &lt;strong&gt;è§„åˆ™é¡µé¢&lt;/strong&gt; ï¼Œç¡®è®¤æ‚¨æŒ‰æ­¤é¡ºåºæ‹¥æœ‰ä¸¤ä¸ªè§’è‰²ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;auth0 æˆæƒæ‰©å±•&lt;/li&gt;
&lt;li&gt;æ·»åŠ ç»„å£°æ˜&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¡ºåºå¾ˆé‡è¦ï¼Œå› ä¸º &lt;code&gt;**auth0-authorization-extension**&lt;/code&gt; è§„åˆ™ä¼šå¼‚æ­¥æ£€ç´¢ç»„å­—æ®µï¼Œç„¶åç”±ç¬¬äºŒä¸ªè§„åˆ™å°†å…¶æ·»åŠ ä¸ºå‘½åç©ºé—´å£°æ˜ï¼Œä»è€Œäº§ç”Ÿä»¥ä¸‹è®¿é—®ä»¤ç‰Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;https://sa.io/group&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Moderators&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;iss&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://sentiment-analysis.eu.auth0.com/&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;sub&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;google-oauth2|196405271625531691872&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;c1&#34;&gt;// [shortened for brevity]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡ä»&lt;code&gt;https://sa.io/group&lt;/code&gt;è¿”å›çš„è®¿é—®ä»¤ç‰Œä¸­çš„å£°æ˜ä¸­æå–ç»„æ¥é…ç½® Envoy ä»£ç†ä»¥éªŒè¯ç”¨æˆ·è®¿é—®æƒé™ã€‚è¿™æ˜¯ä¸‹ä¸€èŠ‚çš„ä¸»é¢˜ï¼Œè®©æˆ‘ä»¬ç»§ç»­å‰è¿›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åœ¨-istio-ä¸­é…ç½®æˆæƒ&#34;&gt;åœ¨ Istio ä¸­é…ç½®æˆæƒ&lt;/h2&gt;
&lt;p&gt;è¦è·å¾—æˆæƒï¼Œæˆ‘ä»¬éœ€è¦ä¸º Istio å¯ç”¨ RBACã€‚ä¸ºæ­¤ï¼Œè¯·å°†ä»¥ä¸‹é…ç½®åº”ç”¨äº Meshï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;rbac.istio.io/v1alpha1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;RbacConfig&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;ON_WITH_INCLUSION&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                     &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;inclusion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;services&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                   &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;sa-frontend.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;sa-web-app.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;sa-feedback.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;ä»…ä¸ºâ€œåŒ…å«â€å­—æ®µä¸­æŒ‡å®šçš„æœåŠ¡å’Œ/æˆ–å‘½åç©ºé—´å¯ç”¨ RBACã€‚&lt;/li&gt;
&lt;li&gt;åŒ…æ‹¬æŒ‡å®šçš„æœåŠ¡åˆ—è¡¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åº”ç”¨é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/security/enable-rbac.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rbacconfig.rbac.istio.io/default created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œæ‰€æœ‰æœåŠ¡éƒ½éœ€è¦åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œæ¢å¥è¯è¯´ï¼Œå¯¹æ‰€æœ‰æœåŠ¡çš„è®¿é—®éƒ½ä¼šè¢«æ‹’ç»ï¼Œå¹¶å“åº”â€œRBAC: access deniedâ€ã€‚å¯ç”¨å¯¹æˆæƒç”¨æˆ·çš„è®¿é—®æƒé™å°†æˆä¸ºä¸‹ä¸€èŠ‚çš„ä¸»é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é…ç½®å¸¸è§„ç”¨æˆ·è®¿é—®&#34;&gt;é…ç½®å¸¸è§„ç”¨æˆ·è®¿é—®&lt;/h2&gt;
&lt;p&gt;æ‰€æœ‰ç”¨æˆ·éƒ½åº”è¯¥èƒ½å¤Ÿè®¿é—® &lt;strong&gt;SA-Frontend&lt;/strong&gt; å’Œ &lt;strong&gt;SA-WebApp&lt;/strong&gt; æœåŠ¡ï¼Œè¿™æ˜¯é€šè¿‡ä»¥ä¸‹ Istio çš„èµ„æºå®ç°çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ServiceRoleï¼š&lt;/strong&gt; æŒ‡å®šç”¨æˆ·æ‹¥æœ‰çš„æƒé™&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ServiceRoleBindingï¼š&lt;/strong&gt; æŒ‡å®š ServiceRole åº”ç”¨äºè°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºæ™®é€šç”¨æˆ·ï¼Œæˆ‘ä»¬å°†å…è®¸è®¿é—®æŒ‡å®šçš„æœåŠ¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;rbac.istio.io/v1alpha1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceRole&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;regular-user&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;services&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;sa-frontend.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;sa-web-app.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;methods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ &lt;strong&gt;å¸¸è§„ç”¨æˆ·ç»‘å®š&lt;/strong&gt;ï¼Œæˆ‘ä»¬å°† ServiceRole åº”ç”¨äºæˆ‘ä»¬é¡µé¢çš„æ‰€æœ‰è®¿é—®è€…ï¼š&lt;/p&gt;
&lt;p&gt;å“¦ï¼æ‰€æœ‰ç”¨æˆ·è¿™æ„å‘³ç€æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨ SA WebApp å—ï¼Ÿä¸ï¼Œè¯¥ç­–ç•¥ä»å°†æ£€æŸ¥ JWT ä»¤ç‰Œçš„æœ‰æ•ˆæ€§ã€‚ğŸ˜‰&lt;/p&gt;
&lt;p&gt;åº”ç”¨é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/security/user-role.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;servicerole.rbac.istio.io/regular-user created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;servicerolebinding.rbac.istio.io/regular-user-binding created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;é…ç½®ç‰ˆä¸»ç”¨æˆ·è®¿é—®æƒé™&#34;&gt;é…ç½®ç‰ˆä¸»ç”¨æˆ·è®¿é—®æƒé™&lt;/h2&gt;
&lt;p&gt;å¯¹äºæˆ‘ä»¬çš„ç‰ˆä¸»ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ç”¨å¯¹æ‰€æœ‰æœåŠ¡çš„è®¿é—®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;rbac.istio.io/v1alpha1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceRole&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mod-user&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;services&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;methods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½†æˆ‘ä»¬åªæƒ³å°†å…¶ç»‘å®šåˆ° Access Token å£°æ˜ &lt;code&gt;https://sa.io/group&lt;/code&gt; ç­‰äº Moderators å€¼çš„ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;rbac.istio.io/v1alpha1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceRoleBinding&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mod-user-binding&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subjects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;properties&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;request.auth.claims[https://sa.io/group]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Moderators&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;roleRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceRole&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;mod-user&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¦åº”ç”¨é…ç½®ï¼Œè¯·æ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/security/mod-role.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;servicerole.rbac.istio.io/mod-user created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;servicerolebinding.rbac.istio.io/mod-user-binding created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”±äº Envoy ä¸­çš„ç¼“å­˜ï¼Œæˆæƒè§„åˆ™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ‰èƒ½ç”Ÿæ•ˆï¼Œä½†åœ¨æ­¤ä¹‹åï¼Œæ‚¨å°†èƒ½å¤ŸéªŒè¯ç”¨æˆ·å’Œç‰ˆä¸»å…·æœ‰ä¸åŒçš„è®¿é—®çº§åˆ«ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬-2-éƒ¨åˆ†---æ‘˜è¦&#34;&gt;ç¬¬ 2 éƒ¨åˆ† - æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;æ‚¨æ˜¯å¦çœŸçš„è§è¿‡ä»»ä½•æ›´ç®€å•ï¼Œé›¶å·¥ä½œçš„å¯æ‰©å±•å’Œå®‰å…¨çš„èº«ä»½éªŒè¯å’Œæˆæƒæ¦‚å¿µï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä»…ä½¿ç”¨ä¸‰ä¸ª Istio èµ„æºï¼ˆRbacConfigï¼ŒServiceRole å’Œ ServiceRoleBindingï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»†ç²’åº¦æ§åˆ¶å¯¹æœ€ç»ˆç”¨æˆ·è®¿é—®æˆ‘ä»¬æœåŠ¡è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œæˆ‘ä»¬å°†è¿™äº›é—®é¢˜ä»æˆ‘ä»¬çš„æœåŠ¡ä¸­è½¬ç§»åˆ°æˆ‘ä»¬çš„ Envoyï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘å¯èƒ½å‡ºç°å®‰å…¨é—®é¢˜å’Œæ¼æ´çš„æ ·æ¿ä»£ç ï¼Œ&lt;/li&gt;
&lt;li&gt;å‡å°‘å› ä¸ºå¿˜è®°æ ‡è®°æ³¨è§£è€Œæš´éœ²æœåŠ¡ç«¯ç‚¹çš„æ„šè ¢çŠ¶å†µã€‚&lt;/li&gt;
&lt;li&gt;æ¯æ¬¡æ·»åŠ æ–°è§’è‰²æˆ–æƒé™æ—¶ï¼Œéƒ½ä¼šæ¶ˆé™¤æ›´æ–°æ‰€æœ‰æœåŠ¡çš„è¿é”æ•ˆåº”ã€‚&lt;/li&gt;
&lt;li&gt;ä¿æŒç®€å•ï¼Œå®‰å…¨å’Œå¿«é€Ÿåœ°æ·»åŠ æ–°æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Istio&lt;/strong&gt; ä½¿æ‚¨çš„å›¢é˜Ÿèƒ½å¤Ÿå†æ¬¡å°†èµ„æºé›†ä¸­åœ¨æä¾›å•†ä¸šä»·å€¼ä¸Šï¼Œè€Œä¸éœ€è¦ä¸ºæœåŠ¡çš„å‘¨è¾¹ä»»åŠ¡è¿›è¡Œå¤„ç†ï¼Œè®©å¾®æœåŠ¡å›å½’â€œå¾®å‹â€çš„æœ¬è´¨ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸ºæ‚¨æä¾›äº†åœ¨å®é™…é¡¹ç›®ä¸­å¼€å§‹ä½¿ç”¨ Istio çš„çŸ¥è¯†å’Œå®è·µã€‚&lt;/p&gt;
&lt;p&gt;å€Ÿæ­¤æœºä¼šï¼Œæˆ‘å¾ˆæ„Ÿè°¢ä½ åŠ å…¥æˆ‘çš„è¿™æ¬¡ Istio æ¢ç´¢ä¹‹æ—…ï¼Œè¿™è‚¯å®šä¸å®¹æ˜“ï¼Œä½ åšæŒä¸‹å»å°±å·²ç»å¾ˆæ£’äº†ã€‚æˆ‘ååˆ†å¸Œæœ›åœ¨ä¸‹é¢çš„è¯„è®ºä¸­çœ‹åˆ°æ‚¨çš„æƒ³æ³•ï¼Œä½ å¯ä»¥éšæ—¶åœ¨ &lt;a href=&#34;https://twitter.com/rinormaloku&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Twitter&lt;/a&gt; æˆ–æˆ‘çš„ä¸»é¡µ &lt;a href=&#34;https://rinormaloku.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rinormaloku.com&lt;/a&gt; ä¸Šä¸æˆ‘è”ç³»ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Istio æ‰“é€ å¾®æœåŠ¡ï¼ˆç¬¬ 1 éƒ¨åˆ†ï¼‰</title>
      <link>https://cloudnative.to/blog/back-to-microservices-with-istio-p1/</link>
      <pubDate>Wed, 27 Feb 2019 11:35:38 +0800</pubDate>
      <guid>https://cloudnative.to/blog/back-to-microservices-with-istio-p1/</guid>
      <description>&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1gyo9j20m80bq754_hud064d27f03f62f22911a8a40db59ea86_41186_fdd875a1e660ae6194736c2b36993fe2.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1gyo9j20m80bq754_hud064d27f03f62f22911a8a40db59ea86_41186_e662dc79dc05de6649be6e1a85ce5320.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1gyo9j20m80bq754_hud064d27f03f62f22911a8a40db59ea86_41186_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1gyo9j20m80bq754_hud064d27f03f62f22911a8a40db59ea86_41186_fdd875a1e660ae6194736c2b36993fe2.webp&#34;
               width=&#34;760&#34;
               height=&#34;401&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Istio&lt;/strong&gt; æ˜¯ä¸€ä¸ªç”± Googleï¼ŒIBM å’Œ Lyft å›¢é˜Ÿåˆä½œå¼€å‘çš„å¼€æºé¡¹ç›®ï¼Œå®ƒæä¾›äº†åŸºäºå¾®æœåŠ¡çš„åº”ç”¨ç¨‹åºå¤æ‚æ€§çš„è§£å†³æ–¹æ¡ˆï¼Œä»…ä¸¾å‡ ä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æµé‡ç®¡ç†&lt;/strong&gt; ï¼šè¶…æ—¶ï¼Œé‡è¯•ï¼Œè´Ÿè½½å‡è¡¡ï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§ï¼š&lt;/strong&gt; æœ€ç»ˆç”¨æˆ·èº«ä»½éªŒè¯å’Œæˆæƒï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯è§‚å¯Ÿæ€§ï¼š&lt;/strong&gt; è·Ÿè¸ªï¼Œç›‘æ§å’Œè®°å½•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€æœ‰è¿™äº›éƒ½å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå±‚ä¸­è§£å†³ï¼Œä½†æ˜¯æ‚¨çš„æœåŠ¡ä¸å†æ˜¯â€œå¾®å‹â€ï¼Œç›¸å¯¹äºæä¾›ä¸šåŠ¡ä»·å€¼çš„èµ„æºï¼Œå®ç°è¿™äº›çš„æ‰€æœ‰é¢å¤–å·¥ä½œéƒ½æ˜¯å…¬å¸èµ„æºçš„å‹åŠ›ã€‚æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;PMï¼šæ·»åŠ åé¦ˆåŠŸèƒ½éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;å¼€å‘ï¼šä¸¤ä¸ªå†²åˆºï¼ˆæ•æ·å¼€å‘ä¸­çš„æœ¯è¯­ï¼Œä¸€èˆ¬ä¸€ä¸ªå†²åˆºå‘¨æœŸ 30 å¤©ï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;PMï¼šä»€ä¹ˆ&amp;hellip;&amp;hellip;ï¼Ÿé‚£åªæ˜¯ä¸€ä¸ª CRUDï¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;å¼€å‘ï¼šåˆ›å»º CRUD å¾ˆå®¹æ˜“ï¼Œä½†æˆ‘ä»¬éœ€è¦å¯¹ç”¨æˆ·å’ŒæœåŠ¡è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒã€‚è€Œä¸”ç”±äºç½‘ç»œä¸å¯é ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å®¢æˆ·ç«¯å®æ–½é‡è¯•å’Œç†”æ–­å™¨ï¼Œå¹¶ç¡®ä¿æˆ‘ä»¬ä¸ä¼šå ç”¨æ•´ä¸ªç³»ç»Ÿï¼Œæˆ‘ä»¬éœ€è¦ Timeout å’Œ Bulkheadsï¼Œå¦å¤–è¿˜è¦æ£€æµ‹æˆ‘ä»¬éœ€è¦ç›‘æ§çš„é—®é¢˜ï¼Œè·Ÿè¸ª[&amp;hellip; ]&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;PMï¼šé‚£ä¹ˆæˆ‘ä»¬å°±æŠŠå®ƒæ”¾åœ¨äº§å“æœåŠ¡ä¸­å§ã€‚å“å‘€ï¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½ æ˜ç™½äº†ï¼Œå¿…é¡»æ»¡è¶³æ‰€æœ‰å½¢å¼æ‰å¯ä»¥ä¸ºæˆ‘ä»¬æ·»åŠ ä¸€é¡¹å·¨å¤§çš„æœåŠ¡ï¼ˆæœ‰å¾ˆå¤šä¸æ˜¯ä¸šåŠ¡åŠŸèƒ½çš„ä»£ç ï¼‰ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤º Istio å¦‚ä½•ä»æˆ‘ä»¬çš„æœåŠ¡ä¸­åˆ é™¤æ‰€æœ‰ä¸Šè¿°äº¤å‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-1å¾®æœåŠ¡çš„å½¢å¼æ„æˆ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1.å¾®æœåŠ¡çš„å½¢å¼æ„æˆ&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1x75cj20ai081t8l_hu8fd55e73c69a4011507428cf46d909f0_48903_30da67b7775499cffe03cdb6de3190df.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1x75cj20ai081t8l_hu8fd55e73c69a4011507428cf46d909f0_48903_f92e23803ad959c5a5b341a8116d0e0a.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1x75cj20ai081t8l_hu8fd55e73c69a4011507428cf46d909f0_48903_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1x75cj20ai081t8l_hu8fd55e73c69a4011507428cf46d909f0_48903_30da67b7775499cffe03cdb6de3190df.webp&#34;
               width=&#34;378&#34;
               height=&#34;289&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1.å¾®æœåŠ¡çš„å½¢å¼æ„æˆ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šæœ¬æ–‡å‡è®¾æ‚¨å…·æœ‰ Kubernetes çš„çŸ¥è¯†ã€‚å¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼Œæˆ‘å»ºè®®æ‚¨é˜…è¯» &lt;a href=&#34;https://medium.freecodecamp.org/learn-kubernetes-in-under-3-hours-a-detailed-guide-to-orchestrating-containers-114ff420e882&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘å¯¹ Kubernetes çš„ä»‹ç»&lt;/a&gt;ï¼Œç„¶åç»§ç»­é˜…è¯»æœ¬æ–‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äº-istio&#34;&gt;å…³äº Istio&lt;/h2&gt;
&lt;p&gt;åœ¨æ²¡æœ‰ Istio çš„ä¸–ç•Œä¸­ï¼Œä¸€ä¸ªæœåŠ¡å‘å¦ä¸€ä¸ªæœåŠ¡ç›´æ¥å‘å‡ºè¯·æ±‚ï¼Œå¹¶ä¸”åœ¨å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡éœ€è¦é€šè¿‡é‡è¯•ï¼Œè¶…æ—¶ï¼Œæ‰“å¼€ç†”æ–­å™¨ç­‰æ¥å¤„ç†å®ƒã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-2-kubernetes-ä¸­çš„ç½‘ç»œæµé‡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 2. Kubernetes ä¸­çš„ç½‘ç»œæµé‡&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1eu2vj20m8054dg4_hu444214816e05611c4dc41d7ae9dc2e43_42654_765e518fb3f8f881fdf72312efc34753.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1eu2vj20m8054dg4_hu444214816e05611c4dc41d7ae9dc2e43_42654_7ca47a4930c4fe1228750072632bc4df.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1eu2vj20m8054dg4_hu444214816e05611c4dc41d7ae9dc2e43_42654_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1eu2vj20m8054dg4_hu444214816e05611c4dc41d7ae9dc2e43_42654_765e518fb3f8f881fdf72312efc34753.webp&#34;
               width=&#34;760&#34;
               height=&#34;175&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 2. Kubernetes ä¸­çš„ç½‘ç»œæµé‡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒIstio é€šè¿‡ä¸æœåŠ¡å®Œå…¨åˆ†ç¦»ï¼Œå¹¶é€šè¿‡æ‹¦æˆªæ‰€æœ‰ç½‘ç»œé€šä¿¡æ¥æä¾›ä¸€ç§å·§å¦™çš„è§£å†³æ–¹æ¡ˆã€‚è¿™æ ·åšå¯ä»¥å®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Fault Tolerance&lt;/strong&gt; â€Š- ä½¿ç”¨å“åº”çŠ¶æ€ä»£ç ï¼Œå®ƒå¯ä»¥åœ¨è¯·æ±‚å¤±è´¥å¹¶é‡è¯•æ—¶ç†è§£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Canary Rollouts&lt;/strong&gt; â€Š- ä»…å°†æŒ‡å®šç™¾åˆ†æ¯”çš„è¯·æ±‚è½¬å‘åˆ°æ–°ç‰ˆæœ¬çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§å’ŒæŒ‡æ ‡&lt;/strong&gt; â€Š- æœåŠ¡å“åº”æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·Ÿè¸ªå’Œå¯è§‚å¯Ÿæ€§&lt;/strong&gt; â€Š- å®ƒåœ¨æ¯ä¸ªè¯·æ±‚ä¸­æ·»åŠ ç‰¹æ®Š headerï¼Œå¹¶åœ¨é›†ç¾¤ä¸­è·Ÿè¸ªå®ƒä»¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt; â€Š- æå– JWT ä»¤ç‰Œå¹¶å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»…ä¸¾å‡ ä¾‹ï¼ˆä»…ä¸¾å‡ ä¾‹ï¼‰ï¼Œè®©æ‚¨æ„Ÿå…´è¶£ï¼æˆ‘ä»¬æ¥çœ‹ä¸€äº›æŠ€æœ¯ç»†èŠ‚å§ï¼&lt;/p&gt;
&lt;h2 id=&#34;istio-çš„æ¶æ„&#34;&gt;Istio çš„æ¶æ„&lt;/h2&gt;
&lt;p&gt;Istio æ‹¦æˆªæ‰€æœ‰ç½‘ç»œæµé‡ï¼Œå¹¶é€šè¿‡åœ¨æ¯ä¸ª pod ä¸­æ³¨å…¥æ™ºèƒ½ä»£ç†ä½œä¸º sidecar æ¥åº”ç”¨ä¸€ç»„è§„åˆ™ã€‚å¯ç”¨æ‰€æœ‰åŠŸèƒ½çš„ä»£ç†åŒ…æ‹¬ &lt;strong&gt;æ•°æ®å¹³é¢&lt;/strong&gt;ï¼Œå¹¶ä¸”è¿™äº›ä»£ç†å¯ç”±&lt;strong&gt;æ§åˆ¶å¹³é¢&lt;/strong&gt; åŠ¨æ€é…ç½®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ•°æ®å¹³é¢&#34;&gt;æ•°æ®å¹³é¢&lt;/h2&gt;
&lt;p&gt;æ³¨å…¥çš„ä»£ç†ä½¿ Istio èƒ½å¤Ÿè½»æ¾æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹é‡è¯•å’Œç†”æ–­å™¨åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-3envoy-å¦‚ä½•å®ç°-retries-å’Œ-circuitbreaking&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 3.Envoy å¦‚ä½•å®ç° Retries å’Œ CircuitBreaking&#34;
           src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu34d0gg20m808a1kx.gif&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 3.Envoy å¦‚ä½•å®ç° Retries å’Œ CircuitBreaking
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ€»ç»“ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Envoy å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡ B çš„ç¬¬ä¸€ä¸ªå®ä¾‹ï¼Œä½†å®ƒå¤±è´¥äº†ã€‚&lt;/li&gt;
&lt;li&gt;Envoy sidecar é‡è¯•ã€‚ï¼ˆ1ï¼‰&lt;/li&gt;
&lt;li&gt;è¿”å›å¯¹è°ƒç”¨ä»£ç†çš„å¤±è´¥è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;è¿™å°†æ‰“å¼€ç†”æ–­å™¨å¹¶åœ¨åç»­è¯·æ±‚ä¸­è°ƒç”¨ä¸‹ä¸€ä¸ªæœåŠ¡ã€‚ï¼ˆ2ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™æ„å‘³ç€æ‚¨ä¸å¿…ä½¿ç”¨å¦ä¸€ä¸ªé‡è¯•åº“ï¼Œæ‚¨ä¸å¿…åœ¨ç¼–ç¨‹è¯­è¨€ Xï¼ŒY æˆ– Z ä¸­å¼€å‘è‡ªå·±çš„ Circuit Breaking å’Œ Service Discovery å®ç°ã€‚æ‰€æœ‰è¿™äº›éƒ½æ˜¯å¼€ç®±å³ç”¨çš„ã€‚è¿™äº›åŠŸèƒ½éƒ½æ˜¯é€šè¿‡ Istio æ¥å®ç°ï¼Œä½ ä¸éœ€è¦æ›´æ”¹ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;å¾ˆå¥½ï¼ç°åœ¨ä½ æƒ³åŠ å…¥ Istio çš„èˆªè¡Œï¼Œä½†ä½ ä»ç„¶æœ‰ä¸€äº›ç–‘è™‘ï¼Œä¸€äº›æ‚¬è€Œæœªå†³çš„é—®é¢˜ã€‚è¿™æ˜¯ä¸€ä¸ªä¸€åˆ€åˆ‡çš„æ–¹æ¡ˆï¼Œä½ å¯¹å®ƒæŒæ€€ç–‘æ€åº¦ï¼Œå› ä¸ºå®ƒæ€»æ˜¯æœ€ç»ˆæˆä¸ºä¸€åˆ€åˆ‡çš„æ— è§£æ–¹æ¡ˆï¼&lt;/p&gt;
&lt;p&gt;ä½ æœ€ç»ˆä½å£°è¯´äº†è¿™ä¸ªé—®é¢˜ï¼šâ€œè¿™æ˜¯å¯é…ç½®çš„å—ï¼Ÿâ€&lt;/p&gt;
&lt;p&gt;æ¬¢è¿æˆ‘çš„æœ‹å‹æ¥å·¡èˆªï¼Œæˆ‘ä»¬å°†ä¸ºå¤§å®¶ä»‹ç»ä¸€ä¸‹æ§åˆ¶å¹³é¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ§åˆ¶å¹³é¢&#34;&gt;æ§åˆ¶å¹³é¢&lt;/h2&gt;
&lt;p&gt;ç”±ä¸‰ä¸ªç»„ä»¶ç»„æˆï¼š &lt;strong&gt;Pilot&lt;/strong&gt;ã€ &lt;strong&gt;Mixer&lt;/strong&gt; å’Œ &lt;strong&gt;Citadel&lt;/strong&gt;ï¼Œå®ƒä»¬ç»„åˆä½¿ç”¨ Envoys æ¥è·¯ç”±æµé‡ï¼Œå®æ–½ç­–ç•¥å’Œæ”¶é›†é¥æµ‹æ•°æ®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-4ä¸æ•°æ®å¹³é¢ç›¸å…³çš„æ§åˆ¶å¹³é¢&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 4.ä¸æ•°æ®å¹³é¢ç›¸å…³çš„æ§åˆ¶å¹³é¢&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2b2mqj20m80eogn9_hu9e28e46a31fd0ffb46071af86319aba8_128097_e201ff76b8cc722be83937d46260b08a.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2b2mqj20m80eogn9_hu9e28e46a31fd0ffb46071af86319aba8_128097_272df493c601fd32951e3a51535dec01.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2b2mqj20m80eogn9_hu9e28e46a31fd0ffb46071af86319aba8_128097_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2b2mqj20m80eogn9_hu9e28e46a31fd0ffb46071af86319aba8_128097_e201ff76b8cc722be83937d46260b08a.webp&#34;
               width=&#34;760&#34;
               height=&#34;502&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 4.ä¸æ•°æ®å¹³é¢ç›¸å…³çš„æ§åˆ¶å¹³é¢
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Envoyï¼ˆå³æ•°æ®å¹³é¢ï¼‰ä½¿ç”¨ç”± Istio å®šä¹‰çš„ &lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes è‡ªå®šä¹‰èµ„æºå®šä¹‰&lt;/a&gt; è¿›è¡Œé…ç½®ã€‚è¿™æ„å‘³ç€å¯¹ä½ è€Œè¨€ï¼Œå®ƒåªæ˜¯å¦ä¸€ä¸ªå…·æœ‰ç†Ÿæ‚‰è¯­æ³•çš„ Kubernetes èµ„æºã€‚åˆ›å»ºåå°†ç”±&lt;strong&gt;æ§åˆ¶å¹³é¢&lt;/strong&gt;è·å–ï¼Œå¹¶å°†å…¶åº”ç”¨äº Envoyã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ä¸-istio-çš„å…³ç³»&#34;&gt;æœåŠ¡ä¸ Istio çš„å…³ç³»&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬æè¿°äº† Istio ä¸æˆ‘ä»¬æœåŠ¡çš„å…³ç³»ï¼Œä½†æˆ‘ä»¬åè¿‡æ¥æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„æœåŠ¡ä¸ Istio çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¦ç‡åœ°è¯´ï¼Œæˆ‘ä»¬çš„æœåŠ¡å¯¹ Istio çš„å­˜åœ¨æœ‰ç€å°½å¯èƒ½å¤šçš„äº†è§£ï¼Œå°±åƒé±¼å¯¹æ°´ä¸€æ ·ï¼Œä»–ä»¬ä¼šé—®è‡ªå·±â€œè¿™åˆ°åº•æ˜¯ä»€ä¹ˆæ°´ï¼Ÿâ€ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-victoria-dimitrakopoulos&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Victoria Dimitrakopoulos&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1l39rj20m809tqd9_hu80ea33cb2da3cdd450240be261f69650_250452_edf73a9139e81b765f5df3d3d8312fde.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1l39rj20m809tqd9_hu80ea33cb2da3cdd450240be261f69650_250452_6620debf540f07f24240cd8faa51fb28.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1l39rj20m809tqd9_hu80ea33cb2da3cdd450240be261f69650_250452_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1l39rj20m809tqd9_hu80ea33cb2da3cdd450240be261f69650_250452_edf73a9139e81b765f5df3d3d8312fde.webp&#34;
               width=&#34;760&#34;
               height=&#34;335&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Victoria Dimitrakopoulos
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™æ„å‘³ç€æ‚¨å¯ä»¥é€‰æ‹©ä¸€ä¸ªå·¥ä½œé›†ç¾¤ï¼Œåœ¨éƒ¨ç½²äº† Istio çš„ç»„ä»¶åï¼Œå…¶ä¸­çš„æœåŠ¡å°†ç»§ç»­å·¥ä½œï¼Œå¹¶ä¸”ä»¥ç›¸åŒçš„æ–¹å¼ï¼Œæ‚¨å¯ä»¥åˆ é™¤ç»„ä»¶ï¼Œä¸€åˆ‡éƒ½ä¼šå¾ˆå¥½ã€‚å¯ä»¥ç†è§£çš„æ˜¯ï¼Œæ‚¨å°†å¤±å» Istio æä¾›çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»æœ‰è¶³å¤Ÿçš„ç†è®ºï¼Œä¸‹é¢è®©æˆ‘ä»¬æŠŠè¿™äº›ç†è®ºä»˜è¯¸å®è·µï¼&lt;/p&gt;
&lt;h2 id=&#34;istio-å®è·µ&#34;&gt;Istio å®è·µ&lt;/h2&gt;
&lt;p&gt;Istio è‡³å°‘éœ€è¦ä¸€ä¸ªå…·æœ‰ 4 ä¸ª vCPU å’Œ 8 GB RAM çš„ Kubernetes é›†ç¾¤ã€‚è¦å¿«é€Ÿè®¾ç½®é›†ç¾¤å¹¶è·Ÿè¿›æœ¬æ–‡ï¼Œæˆ‘å»ºè®®ä½¿ç”¨ Google äº‘ç«¯å¹³å°ï¼Œå®ƒä¸ºæ–°ç”¨æˆ·æä¾› &lt;a href=&#34;https://console.developers.google.com/billing/freetrial?hl=en&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;300 ç¾å…ƒçš„å…è´¹è¯•ç”¨ç‰ˆ&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Kubernetes å‘½ä»¤è¡Œå·¥å…·åˆ›å»ºé›†ç¾¤å¹¶é…ç½®è®¿é—®åï¼Œæˆ‘ä»¬å·²å‡†å¤‡å¥½ä½¿ç”¨ Helm Package ç®¡ç†å™¨å®‰è£… Istioã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…-helm&#34;&gt;å®‰è£… Helm&lt;/h2&gt;
&lt;p&gt;æŒ‰ç…§&lt;a href=&#34;https://docs.helm.sh/using_helm/#installing-the-helm-client&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ä¸­çš„è¯´æ˜åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šå®‰è£… Helm å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­ä½¿ç”¨å®ƒæ¥ç”Ÿæˆ Istio å®‰è£…æ¨¡æ¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…-istio&#34;&gt;å®‰è£… Istio&lt;/h2&gt;
&lt;p&gt;ä»&lt;a href=&#34;https://github.com/istio/istio/releases/tag/1.0.5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ€æ–°ç‰ˆæœ¬&lt;/a&gt;ä¸‹è½½ Istio çš„èµ„æºï¼Œå°†å†…å®¹æå–åˆ°ä¸€ä¸ªæˆ‘ä»¬å°†ç§°ä¹‹ä¸ºçš„ç›®å½•ä¸­&lt;code&gt;[istio-resources]&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;è¦è½»æ¾è¯†åˆ« Istio èµ„æº &lt;code&gt;istio-system&lt;/code&gt;ï¼Œè¯·åœ¨ Kubernetes é›†ç¾¤ä¸­åˆ›å»ºå‘½åç©ºé—´ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl create namespace istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åè¿›å…¥åˆ° &lt;code&gt;[istio-resources]&lt;/code&gt; ç›®å½•å¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®Œæˆå®‰è£…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ helm template install/kubernetes/helm/istio &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; --set global.mtls.enabled &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; --set tracing.enabled &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; --set kiali.enabled &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; --set grafana.enabled &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; --namespace istio-system &amp;gt; istio.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢çš„å‘½ä»¤å°† Istio çš„æ ¸å¿ƒç»„ä»¶è¾“å‡ºåˆ°æ–‡ä»¶ &lt;code&gt;istio.yaml&lt;/code&gt; ä¸­ã€‚æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‚æ•°è‡ªå®šä¹‰æ¨¡æ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;global.mtls.enabled&lt;/strong&gt; è®¾ç½®ä¸º false ä»¥ä¿æŒå¼•å…¥çš„é‡ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;tracing.enabled&lt;/strong&gt; å…è®¸ä½¿ç”¨ jaeger è·Ÿè¸ªè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;kiali.enabled&lt;/strong&gt; åœ¨æˆ‘ä»¬çš„é›†ç¾¤ä¸­å®‰è£… Kiali ä»¥å®ç°æœåŠ¡å’Œæµé‡çš„å¯è§†åŒ–&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;grafana.enabled&lt;/strong&gt; å®‰è£… Grafanaï¼Œä¸ºäº†æ”¶é›†æŒ‡æ ‡çš„å¯è§†åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åº”ç”¨ç”Ÿæˆçš„èµ„æº&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f istio.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ ‡å¿—ç€æˆ‘ä»¬é›†ç¾¤ä¸­ Istio å®‰è£…çš„å®Œæˆï¼ç­‰åˆ°&lt;code&gt;istio-system&lt;/code&gt;å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰ pod éƒ½å¤„äº Running æˆ– Completed çŠ¶æ€ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬å·²å‡†å¤‡å¥½ç»§ç»­ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­å¯åŠ¨å¹¶è¿è¡Œç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;h2 id=&#34;sentiment-analysis-åº”ç”¨æ¶æ„&#34;&gt;Sentiment Analysis åº”ç”¨æ¶æ„&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨&lt;a href=&#34;https://medium.freecodecamp.org/learn-kubernetes-in-under-3-hours-a-detailed-guide-to-orchestrating-containers-114ff420e882&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes ç®€ä»‹æ–‡ç« &lt;/a&gt;ä¸­ä½¿ç”¨çš„ç›¸åŒå¾®æœåŠ¡åº”ç”¨ç¨‹åºï¼Œå®ƒè¶³ä»¥åœ¨å®è·µä¸­å±•ç¤º Istio çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥åº”ç”¨ç¨‹åºç”±å››ä¸ªå¾®æœåŠ¡ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SA-Frontend æœåŠ¡&lt;/strong&gt; ï¼šæä¾›å‰ç«¯ Reactjs åº”ç”¨ç¨‹åºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SA-WebApp æœåŠ¡&lt;/strong&gt; ï¼šå¤„ç†å¯¹ Sentiment Analysis çš„è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SA-Logic æœåŠ¡&lt;/strong&gt; ï¼šæ‰§è¡Œ sentiment Analysisã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SA åé¦ˆæœåŠ¡&lt;/strong&gt; ï¼šæ¥æ”¶ç”¨æˆ·å…³äºåˆ†æå‡†ç¡®æ€§çš„åé¦ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-6-æƒ…æ„Ÿåˆ†æå¾®æœåŠ¡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 6 æƒ…æ„Ÿåˆ†æå¾®æœåŠ¡&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2q2ppj20m80apmxy_huc1611d6892c8118b78e52c82afc82497_79774_f04e564e9b93cbde7ced2c0dca29c71f.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2q2ppj20m80apmxy_huc1611d6892c8118b78e52c82afc82497_79774_4a7581cbc943b0994f31fa545aaa31eb.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2q2ppj20m80apmxy_huc1611d6892c8118b78e52c82afc82497_79774_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2q2ppj20m80apmxy_huc1611d6892c8118b78e52c82afc82497_79774_f04e564e9b93cbde7ced2c0dca29c71f.webp&#34;
               width=&#34;760&#34;
               height=&#34;366&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 6 æƒ…æ„Ÿåˆ†æå¾®æœåŠ¡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨å›¾ 6 ä¸­ï¼Œé™¤äº†æœåŠ¡ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜çœ‹åˆ° Ingress Controller åœ¨ Kubernetes ä¸­å°†ä¼ å…¥çš„è¯·æ±‚è·¯ç”±åˆ°é€‚å½“çš„æœåŠ¡ï¼ŒIstio ä½¿ç”¨äº†ä¸€ä¸ªåä¸º Ingress Gateway çš„ç±»ä¼¼æ¦‚å¿µï¼Œå°†åœ¨æœ¬æ–‡çš„åç»­éƒ¨åˆ†ä¸­ä»‹ç»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-istio-proxies-è¿è¡Œåº”ç”¨ç¨‹åº&#34;&gt;ä½¿ç”¨ Istio Proxies è¿è¡Œåº”ç”¨ç¨‹åº&lt;/h2&gt;
&lt;p&gt;è¦è·Ÿè¿›æœ¬æ–‡ï¼Œè¯·å…‹éš†å­˜å‚¨åº“ istio-masteryï¼ˆ &lt;a href=&#34;https://github.com/rinormaloku/istio-mastery&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/rinormaloku/istio-mastery&lt;/a&gt; ï¼‰ï¼Œå…¶ä¸­åŒ…å« Kubernetes å’Œ Istio çš„åº”ç”¨ç¨‹åºå’Œæ¸…å•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;sidecar-injection&#34;&gt;Sidecar Injection&lt;/h3&gt;
&lt;p&gt;æ³¨å…¥æ˜¯ &lt;strong&gt;è‡ªåŠ¨&lt;/strong&gt; æˆ– &lt;strong&gt;æ‰‹åŠ¨&lt;/strong&gt; å®Œæˆçš„ã€‚è¦å¯ç”¨è‡ªåŠ¨ sidecar æ³¨å…¥ï¼Œæˆ‘ä»¬éœ€è¦ &lt;code&gt;istio-injection=enabled&lt;/code&gt; é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ æ¥æ ‡è®°å‘½åç©ºé—´ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl label namespace default istio-injection&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;enabled
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;namespace/default labeled
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»ç°åœ¨å¼€å§‹ï¼Œéƒ¨ç½²åˆ°é»˜è®¤å‘½åç©ºé—´çš„æ¯ä¸ª pod éƒ½å°†è·å¾—æ³¨å…¥çš„ sidecarã€‚ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬é€šè¿‡è¿›å…¥åˆ° &lt;code&gt;[istio-mastery]&lt;/code&gt; å­˜å‚¨åº“çš„æ ¹æ–‡ä»¶å¤¹ å¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ æ¥éƒ¨ç½²ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/kube
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;persistentvolumeclaim/sqlite-pvc created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions/sa-feedback created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/sa-feedback created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions/sa-frontend created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/sa-frontend created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions/sa-logic created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/sa-logic created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions/sa-web-app created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/sa-web-app created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨éƒ¨ç½²çš„æœåŠ¡ä¸­ï¼Œé€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ &lt;code&gt;kubectl get pods&lt;/code&gt; éªŒè¯ pod æœ‰ä¸¤ä¸ªå®¹å™¨ï¼ˆservice å’Œ sidecarï¼‰ï¼Œå¹¶ç¡®ä¿å‡†å¤‡å¥½åï¼Œæˆ‘ä»¬çœ‹åˆ°å€¼â€œ &lt;strong&gt;2/2&lt;/strong&gt; â€è¡¨ç¤ºä¸¤ä¸ªå®¹å™¨éƒ½åœ¨è¿è¡Œã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                           READY     STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-feedback-55f5dc4d9c-c9wfv   2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          12m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-frontend-558f8986-hhkj9     2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          12m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-logic-568498cb4d-2sjwj      2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          12m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-logic-568498cb4d-p4f8c      2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          12m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-web-app-599cf47c7c-s7cvd    2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          12m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§†è§‰å‘ˆç°åœ¨å›¾ 7 ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-7å…¶ä¸­ä¸€ä¸ª-pod-ä¸­çš„-envoy-ä»£ç†&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 7.å…¶ä¸­ä¸€ä¸ª Pod ä¸­çš„ Envoy ä»£ç†&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ti9mj209n0dtwf8_hu77c5a8e5e3e2f4f4fa790010f4b3914e_76143_7713ac113448a37bf7655c03338c1598.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ti9mj209n0dtwf8_hu77c5a8e5e3e2f4f4fa790010f4b3914e_76143_f2c3f097107b3ce47499f87ddf25422c.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ti9mj209n0dtwf8_hu77c5a8e5e3e2f4f4fa790010f4b3914e_76143_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ti9mj209n0dtwf8_hu77c5a8e5e3e2f4f4fa790010f4b3914e_76143_7713ac113448a37bf7655c03338c1598.webp&#34;
               width=&#34;347&#34;
               height=&#34;497&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 7.å…¶ä¸­ä¸€ä¸ª Pod ä¸­çš„ Envoy ä»£ç†
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œåº”ç”¨ç¨‹åºå¯åŠ¨å¹¶è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦å…è®¸ä¼ å…¥æµé‡åˆ°è¾¾æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…¥å£ç½‘å…³&#34;&gt;å…¥å£ç½‘å…³&lt;/h2&gt;
&lt;p&gt;å…è®¸æµé‡è¿›å…¥é›†ç¾¤çš„æœ€ä½³åšæ³•æ˜¯é€šè¿‡ Istio çš„ &lt;strong&gt;å…¥å£ç½‘å…³&lt;/strong&gt; å°†å…¶è‡ªèº«ç½®äºé›†ç¾¤çš„è¾¹ç¼˜ï¼Œå¹¶åœ¨ä¼ å…¥æµé‡ä¸Šå®ç° Istio çš„åŠŸèƒ½ï¼Œå¦‚è·¯ç”±ï¼Œè´Ÿè½½å‡è¡¡ï¼Œå®‰å…¨æ€§å’Œç›‘æ§ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio çš„å®‰è£…è¿‡ç¨‹ä¸­ï¼Œ &lt;code&gt;Ingress Gateway&lt;/code&gt; ç»„ä»¶å’Œåœ¨å¤–éƒ¨å…¬å¼€å®ƒçš„æœåŠ¡å·²å®‰è£…åˆ°é›†ç¾¤ä¸­ã€‚è¦è·å–æœåŠ¡å¤–éƒ¨ IPï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get svc -n istio-system -l &lt;span class=&#34;nv&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ingressgateway
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                   TYPE           CLUSTER-IP     EXTERNAL-IP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-ingressgateway   LoadBalancer   10.0.132.127   13.93.30.120
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æœ¬æ–‡çš„åç»­éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®¿é—®æ­¤ IP ä¸Šçš„åº”ç”¨ç¨‹åºï¼ˆç§°ä¸º EXTERNAL-IPï¼‰ï¼Œä¸ºæ–¹ä¾¿èµ·è§ï¼Œé€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†å…¶ä¿å­˜åœ¨å˜é‡ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;EXTERNAL_IP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get svc -n istio-system &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istio-ingressgateway &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].status.loadBalancer.ingress[0].ip}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæ‚¨åœ¨æµè§ˆå™¨ä¸­è®¿é—®æ­¤ IP å¹¶ä¸”æ‚¨å°†æ”¶åˆ°æœåŠ¡ä¸å¯ç”¨é”™è¯¯ï¼Œåˆ™ &lt;strong&gt;é»˜è®¤æƒ…å†µä¸‹ Istio å°†é˜»æ­¢ä»»ä½•ä¼ å…¥æµé‡&lt;/strong&gt;ï¼Œç›´åˆ°æˆ‘ä»¬å®šä¹‰ç½‘å…³ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç½‘å…³èµ„æº&#34;&gt;ç½‘å…³èµ„æº&lt;/h2&gt;
&lt;p&gt;ç½‘å…³æ˜¯åœ¨æˆ‘ä»¬çš„é›†ç¾¤ä¸­å®‰è£… Istio æ—¶å®šä¹‰çš„ Kubernetes è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼Œä½¿æˆ‘ä»¬èƒ½å¤ŸæŒ‡å®šæˆ‘ä»¬å¸Œæœ›å…è®¸ä¼ å…¥æµé‡çš„ç«¯å£ï¼Œåè®®å’Œä¸»æœºã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å…è®¸æ‰€æœ‰ä¸»æœºåœ¨ç«¯å£ 80 ä¸Šä½¿ç”¨ HTTP æµé‡ã€‚è¾¾åˆ°ä»¥ä¸‹å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é™¤äº†é€‰æ‹©å™¨&lt;code&gt;istioï¼šingressgateway&lt;/code&gt;ä¹‹å¤–ï¼Œæ‰€æœ‰é…ç½®éƒ½æ˜¯ä¸éœ€è¦è¯´æ˜çš„ã€‚ä½¿ç”¨æ­¤é€‰æ‹©å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šåº”ç”¨é…ç½®çš„ Ingress Gatewayï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå®ƒæ˜¯å®‰è£…åœ¨ Istio è®¾ç½®ä¸Šçš„é»˜è®¤å…¥å£ç½‘å…³æ§åˆ¶å™¨ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åº”ç”¨é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/http-gateway.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gateway.networking.istio.io/http-gateway created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç½‘å…³ç°åœ¨å…è®¸åœ¨ç«¯å£ 80 ä¸­è¿›è¡Œè®¿é—®ï¼Œä½†å®ƒä¸çŸ¥é“åœ¨ä½•å¤„è·¯ç”±è¯·æ±‚ã€‚è¿™éœ€è¦ä½¿ç”¨&lt;strong&gt;Virtual Service&lt;/strong&gt;æ¥å®ç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;virtualservice-èµ„æº&#34;&gt;VirtualService èµ„æº&lt;/h2&gt;
&lt;p&gt;VirtualService æŒ‡ç¤º Ingress Gateway å¦‚ä½•è·¯ç”±å…è®¸è¿›å…¥é›†ç¾¤çš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæˆ‘ä»¬åº¦è¿‡å³å°†åˆ°æ¥çš„åº”ç”¨ç¨‹åºè¯·æ±‚ &lt;strong&gt;HTTP ç½‘å…³&lt;/strong&gt; å¿…é¡»è¢«è·¯ç”±åˆ° &lt;code&gt;sa-frontend&lt;/code&gt;ï¼Œ&lt;code&gt;sa-web-app&lt;/code&gt; å’Œ&lt;code&gt;sa-feedback&lt;/code&gt; æœåŠ¡ï¼ˆå‡ºäº†å¦‚å›¾ 8ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-8ä½¿ç”¨-virtualservices-é…ç½®çš„è·¯ç”±&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 8.ä½¿ç”¨ VirtualServices é…ç½®çš„è·¯ç”±&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2n39aj20m80gk75x_hub509a0a5f67f5ebf52d062c28f44f9e0_114931_c41431a1ae385578058bcc7ea5404ace.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2n39aj20m80gk75x_hub509a0a5f67f5ebf52d062c28f44f9e0_114931_68f6e8430621301aeb4548d185f0a310.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2n39aj20m80gk75x_hub509a0a5f67f5ebf52d062c28f44f9e0_114931_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2n39aj20m80gk75x_hub509a0a5f67f5ebf52d062c28f44f9e0_114931_c41431a1ae385578058bcc7ea5404ace.webp&#34;
               width=&#34;760&#34;
               height=&#34;566&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 8.ä½¿ç”¨ VirtualServices é…ç½®çš„è·¯ç”±
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬åˆ†è§£ä»¥ä¸‹è·¯ç”±åˆ° SA-Frontend çš„è¯·æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;**/**&lt;/code&gt; åº”å°†&lt;strong&gt;ç²¾ç¡®è·¯å¾„&lt;/strong&gt; è·¯ç”±åˆ° SA-Frontend ä»¥è·å– Index.html&lt;/li&gt;
&lt;li&gt;&lt;code&gt;**/static/***&lt;/code&gt; åº”å°†&lt;strong&gt;å‰ç¼€è·¯å¾„&lt;/strong&gt; è·¯ç”±åˆ° SA-Frontend ä»¥è·å–å‰ç«¯æ‰€éœ€çš„ä»»ä½•é™æ€æ–‡ä»¶ï¼Œå¦‚ Css å’Œ JavaScript æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„è·¯å¾„&lt;/strong&gt;&lt;code&gt;&#39;^.*\.(ico|png|jpg)$&#39;&lt;/code&gt; åº”è¯¥è·¯ç”±åˆ° SA-Frontendï¼Œæˆ‘ä»¬åº”è¯¥æŠŠå›¾åƒèµ„æºè·¯ç”±åˆ°å‰ç«¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™æ˜¯é€šè¿‡ä»¥ä¸‹é…ç½®å®ç°çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-external-services&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;http-gateway                     &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/callback&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/static&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;^.*\.(ico|png|jpg)$&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-frontend            &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œçš„é‡ç‚¹æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ­¤ VirtualService é€‚ç”¨äºé€šè¿‡&lt;strong&gt;http ç½‘å…³&lt;/strong&gt; å‘å‡ºçš„è¯·æ±‚&lt;/li&gt;
&lt;li&gt;Destination å®šä¹‰è¯·æ±‚è·¯ç”±åˆ°çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šä¸Šé¢çš„é…ç½®ä½äºæ–‡ä»¶ä¸­ &lt;code&gt;sa-virtualservice-external.yaml&lt;/code&gt;ï¼Œå®ƒè¿˜åŒ…å«ç”¨äºè·¯ç”±åˆ° SA-WebApp å’Œ SA-Feedback çš„é…ç½®ï¼Œä½†ä¸ºç®€æ´èµ·è§ï¼Œå·²ç¼©çŸ­ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åº”ç”¨ VirtualServiceï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/sa-virtualservice-external.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;virtualservice.networking.istio.io/sa-external-services created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šå½“æˆ‘ä»¬åº”ç”¨ Istio èµ„æºæ—¶ï¼ŒKubernetes API æœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ªç”± Istio æ§åˆ¶å¹³é¢æ¥æ”¶çš„äº‹ä»¶ï¼Œç„¶åå°†æ–°é…ç½®åº”ç”¨äºæ¯ä¸ª pod çš„ Envoy ä»£ç†ã€‚Ingress Gateway æ§åˆ¶å™¨æ˜¯å¦ä¸€ä¸ªç”±æ§åˆ¶å¹³é¢é…ç½®çš„ Envoyï¼Œå¦‚å›¾ 9 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-9é…ç½®-istio-ingressgateway-æ¥è·¯ç”±è¯·æ±‚&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 9.é…ç½® &amp;lt;strong&amp;gt;Istio-IngressGateway&amp;lt;/strong&amp;gt; æ¥è·¯ç”±è¯·æ±‚&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1t95sj20m80i2jt1_hu61ca71da704e1daab9b67ab5c6b5ed4a_168046_ac8be1d0ab5cff8779d57e33ffae3054.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1t95sj20m80i2jt1_hu61ca71da704e1daab9b67ab5c6b5ed4a_168046_a7398b5084576093b48fd4931a188c47.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1t95sj20m80i2jt1_hu61ca71da704e1daab9b67ab5c6b5ed4a_168046_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1t95sj20m80i2jt1_hu61ca71da704e1daab9b67ab5c6b5ed4a_168046_ac8be1d0ab5cff8779d57e33ffae3054.webp&#34;
               width=&#34;760&#34;
               height=&#34;618&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 9.é…ç½® &amp;lt;strong&amp;gt;Istio-IngressGateway&amp;lt;/strong&amp;gt; æ¥è·¯ç”±è¯·æ±‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç°åœ¨å¯ä»¥è®¿é—® Sentiment Analysis åº”ç”¨ç¨‹åºäº† &lt;code&gt;http://{EXTERNAL-IP}/&lt;/code&gt; ã€‚å¦‚æœæ‚¨è·å¾— Not Found çŠ¶æ€ï¼Œè¯·ä¸è¦æ‹…å¿ƒ &lt;em&gt;æœ‰æ—¶éœ€è¦é…ç½®ç”Ÿæ•ˆæ‰èƒ½æ›´æ–° envoy çš„ç¼“å­˜&lt;/em&gt; ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è½¬åˆ°ä¸‹ä¸€éƒ¨åˆ†ä¹‹å‰ï¼Œè¯·ä½¿ç”¨è¯¥åº”ç”¨ç¨‹åºç”Ÿæˆä¸€äº›æµé‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kiali---å¯è§‚å¯Ÿæ€§&#34;&gt;Kiali - å¯è§‚å¯Ÿæ€§&lt;/h2&gt;
&lt;p&gt;è¦è®¿é—® Kiali çš„ Admin UIï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl port-forward &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -n istio-system -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kiali &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -n istio-system &lt;span class=&#34;m&#34;&gt;20001&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¹¶ &lt;a href=&#34;http://localhost:20001/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:20001/&lt;/a&gt; ä½¿ç”¨â€œadminâ€ï¼ˆä¸å«å¼•å·ï¼‰ä¸ºç”¨æˆ·å’Œå¯†ç æ‰“å¼€ç™»å½•ã€‚æœ‰å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ£€æŸ¥ Istio ç»„ä»¶çš„é…ç½®ï¼Œæ ¹æ®æ‹¦æˆªç½‘ç»œè¯·æ±‚å’Œå›ç­”æ”¶é›†çš„ä¿¡æ¯å¯è§†åŒ–æœåŠ¡ï¼Œâ€œè°åœ¨è°ƒç”¨è°ï¼Ÿâ€ï¼Œâ€œå“ªä¸ªç‰ˆæœ¬çš„æœåŠ¡æœ‰æ•…éšœï¼Ÿâ€ç­‰ç­‰ï¼ŒèŠ±ä¸€äº›æ—¶é—´æ£€éªŒ Kiali çš„åŠŸèƒ½ï¼Œç„¶åå†è½¬åˆ°ä¸‹ä¸€èŠ‚ï¼Œç”¨ Grafana å¯è§†åŒ–æŒ‡æ ‡ï¼&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-10-kiali---æœåŠ¡å¯è§‚å¯Ÿæ€§&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 10. Kiali - æœåŠ¡å¯è§‚å¯Ÿæ€§&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu28njyj20m80c7mye_hu53203e07e08d7db54e60dd016145dad8_105933_4f6b6af1439b21e31b5bb81b684b3429.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu28njyj20m80c7mye_hu53203e07e08d7db54e60dd016145dad8_105933_45523755960b3c6beecabe5f90ba3bed.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu28njyj20m80c7mye_hu53203e07e08d7db54e60dd016145dad8_105933_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu28njyj20m80c7mye_hu53203e07e08d7db54e60dd016145dad8_105933_4f6b6af1439b21e31b5bb81b684b3429.webp&#34;
               width=&#34;760&#34;
               height=&#34;417&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 10. Kiali - æœåŠ¡å¯è§‚å¯Ÿæ€§
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;grafana---åº¦é‡å¯è§†åŒ–&#34;&gt;Grafana - åº¦é‡å¯è§†åŒ–&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ Grafana å°† Istio æ”¶é›†çš„æŒ‡æ ‡åˆ’åˆ†ä¸º Prometheus å’Œ Visualizedã€‚è¦è®¿é—® Grafana çš„ Admin UIï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¹¶æ‰“å¼€&lt;a href=&#34;http://localhost:3000&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:3000&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n istio-system port-forward &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl -n istio-system get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;grafana &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;={&lt;/span&gt;.items&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.metadata.name&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;3000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨å·¦ä¸Šè§’å•å‡»èœå•&lt;strong&gt;Home&lt;/strong&gt; å¹¶é€‰æ‹© &lt;strong&gt;Istio Service Dashboard&lt;/strong&gt; å¹¶åœ¨å·¦ä¸Šè§’é€‰æ‹©ä»¥&lt;strong&gt;sa-web-app&lt;/strong&gt;å¼€å¤´çš„æœåŠ¡ï¼Œæ‚¨å°†çœ‹åˆ°æ”¶é›†çš„æŒ‡æ ‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1z8vbj20m80cnabv_hu4b2d7ddc524bf6041faa8e77d7a7a076_121116_7e0b3e3a6d2dfa2c772e42610579740b.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1z8vbj20m80cnabv_hu4b2d7ddc524bf6041faa8e77d7a7a076_121116_8b9d662936dd275fec7783c73fc712a4.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1z8vbj20m80cnabv_hu4b2d7ddc524bf6041faa8e77d7a7a076_121116_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1z8vbj20m80cnabv_hu4b2d7ddc524bf6041faa8e77d7a7a076_121116_7e0b3e3a6d2dfa2c772e42610579740b.webp&#34;
               width=&#34;760&#34;
               height=&#34;432&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘çš„å¦ˆå‘€ï¼Œè¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰ä»»ä½•æ•°æ®çš„è§†å›¾ï¼Œç®¡ç†å±‚æ°¸è¿œä¸ä¼šèµåŒè¿™ä¸€ç‚¹ã€‚è®©æˆ‘ä»¬é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆä¸€äº›è´Ÿè½½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; true&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    curl -i http://&lt;span class=&#34;nv&#34;&gt;$EXTERNAL_IP&lt;/span&gt;/sentiment &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -H &lt;span class=&#34;s2&#34;&gt;&amp;#34;Content-type: application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;sentence&amp;#34;: &amp;#34;I love yogobella&amp;#34;}&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    sleep .8&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰æ›´æ¼‚äº®çš„å›¾è¡¨ï¼Œæ­¤å¤–ï¼Œæˆ‘ä»¬æ‹¥æœ‰ Prometheus ç”¨äºç›‘æ§å’Œ Grafana ç”¨äºå¯è§†åŒ–æŒ‡æ ‡è¿™äº›ä»¤äººæƒŠè®¶çš„å·¥å…·ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿéšæ—¶äº†è§£æœåŠ¡çš„æ€§èƒ½ï¼Œå¥åº·çŠ¶å†µï¼Œå‡çº§æˆ–é™çº§ï¼&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬å°†ç ”ç©¶æ•´ä¸ªæœåŠ¡ä¸­çš„è·Ÿè¸ªè¯·æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;jaeger---è¿½è¸ª&#34;&gt;Jaeger - è¿½è¸ª&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦è·Ÿè¸ªï¼Œå› ä¸ºæˆ‘ä»¬æ‰€æ‹¥æœ‰çš„æœåŠ¡è¶Šå¤šï¼Œå°±è¶Šéš¾æ‰¾å‡ºå¤±è´¥çš„åŸå› ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹é¢å›¾ç‰‡ä¸­çš„ç®€å•æ¡ˆä¾‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-12é€šå¸¸éšæœºå¤±è´¥çš„è¯·æ±‚&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 12.é€šå¸¸éšæœºå¤±è´¥çš„è¯·æ±‚&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ht7hj20m804fjrw_hufeb3be4509712d3ef4cee337b2b46afd_48453_efe676da6fab581e60254ffb3c21d594.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ht7hj20m804fjrw_hufeb3be4509712d3ef4cee337b2b46afd_48453_2a5298549e0f1512a44a1542bcd6988b.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ht7hj20m804fjrw_hufeb3be4509712d3ef4cee337b2b46afd_48453_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ht7hj20m804fjrw_hufeb3be4509712d3ef4cee337b2b46afd_48453_efe676da6fab581e60254ffb3c21d594.webp&#34;
               width=&#34;760&#34;
               height=&#34;151&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 12.é€šå¸¸éšæœºå¤±è´¥çš„è¯·æ±‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¯·æ±‚è¿›å…¥ï¼Œå¤±è´¥ï¼Œ&lt;em&gt;åŸå› æ˜¯ä»€ä¹ˆ&lt;/em&gt;ï¼Ÿ&lt;em&gt;ç¬¬ä¸€æ¬¡æœåŠ¡&lt;/em&gt;ï¼Ÿ&lt;em&gt;è¿˜æ˜¯ç¬¬äºŒä¸ª&lt;/em&gt;ï¼Ÿä¸¤è€…éƒ½æœ‰ä¾‹å¤–æƒ…å†µï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æ¯ä¸ªæ—¥å¿—ã€‚ä½ å‘ç°è‡ªå·±è¿™ä¹ˆåšäº†å¤šå°‘æ¬¡ï¼Ÿæˆ‘ä»¬çš„å·¥ä½œæ›´åƒæ˜¯è½¯ä»¶ä¾¦æ¢è€Œä¸æ˜¯å¼€å‘äººå‘˜ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯å¾®æœåŠ¡ä¸­çš„ä¸€ä¸ªæ™®éé—®é¢˜ï¼Œå®ƒä½¿ç”¨åˆ†å¸ƒå¼è·Ÿè¸ªç³»ç»Ÿè§£å†³ï¼Œå…¶ä¸­æœåŠ¡å°†å”¯ä¸€çš„ header ç›¸äº’ä¼ é€’ï¼Œç„¶åå°†æ­¤ä¿¡æ¯è½¬å‘åˆ°è¯·æ±‚è·Ÿè¸ªæ”¾åœ¨ä¸€èµ·çš„åˆ†å¸ƒå¼è·Ÿè¸ªç³»ç»Ÿã€‚ä¸€ä¸ªä¾‹å­å¦‚å›¾ 13 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-13ç”¨äºæ ‡è¯†è¯·æ±‚èŒƒå›´çš„-traceid&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 13.ç”¨äºæ ‡è¯†è¯·æ±‚èŒƒå›´çš„ TraceId&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2k4zsj20rs06uwfz_hu57540032efbe04467ccd71e670c716de_87299_e7bfb3516ba93512f243a779c70df762.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2k4zsj20rs06uwfz_hu57540032efbe04467ccd71e670c716de_87299_125bcb4ef1d4197bb5dcc931c8c5baa5.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2k4zsj20rs06uwfz_hu57540032efbe04467ccd71e670c716de_87299_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2k4zsj20rs06uwfz_hu57540032efbe04467ccd71e670c716de_87299_e7bfb3516ba93512f243a779c70df762.webp&#34;
               width=&#34;760&#34;
               height=&#34;187&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 13.ç”¨äºæ ‡è¯†è¯·æ±‚èŒƒå›´çš„ TraceId
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio ä½¿ç”¨ Jaeger Tracer å®ç° OpenTracing APIï¼Œè¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹äºä¾›åº”å•†çš„æ¡†æ¶ã€‚è¦è®¿é—® Jaegers UIï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl port-forward -n istio-system &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -n istio-system -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;jaeger &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;16686&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶ååœ¨ &lt;a href=&#34;http://localhost:16686/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:16686&lt;/a&gt; ä¸­æ‰“å¼€ UIï¼Œé€‰æ‹© &lt;strong&gt;sa-web-app&lt;/strong&gt; æœåŠ¡ï¼Œ &lt;em&gt;å¦‚æœä¸‹æ‹‰åˆ—è¡¨ä¸­æœªæ˜¾ç¤ºè¯¥&lt;/em&gt;æœåŠ¡ï¼Œ&lt;em&gt;åˆ™åœ¨é¡µé¢ä¸Šç”Ÿæˆä¸€äº›æ´»åŠ¨å¹¶ç‚¹å‡»åˆ·æ–°&lt;/em&gt; ã€‚éšåå•å‡»è¯¥æŒ‰é’® &lt;strong&gt;æŸ¥æ‰¾ç—•è¿¹&lt;/strong&gt;ï¼Œè¿™æ˜¾ç¤ºæœ€è¿‘çš„ç—•è¿¹ï¼Œé€‰æ‹©ä»»ä½•å’Œæ‰€æœ‰çš„ç—•è¿¹çš„è¯¦ç»†åˆ†ç±»å°†ä¼šæ˜¾ç¤ºï¼Œå¦‚å›¾ 14 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-14-jaeger---è¯·æ±‚è·Ÿè¸ª&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 14. Jaeger - è¯·æ±‚è·Ÿè¸ª&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1ca17j20rs0bsgnr_hue99f4998151e31a13a008801aa511890_174066_f5d0bf3a53af4f5e27d9dd55c9f3a8f7.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1ca17j20rs0bsgnr_hue99f4998151e31a13a008801aa511890_174066_09ecd51c89a64393dca850c7852ba075.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1ca17j20rs0bsgnr_hue99f4998151e31a13a008801aa511890_174066_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1ca17j20rs0bsgnr_hue99f4998151e31a13a008801aa511890_174066_f5d0bf3a53af4f5e27d9dd55c9f3a8f7.webp&#34;
               width=&#34;760&#34;
               height=&#34;322&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 14. Jaeger - è¯·æ±‚è·Ÿè¸ª
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è·Ÿè¸ªæ˜¾ç¤ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¯·æ±‚æ¥åˆ° &lt;strong&gt;istio-ingressgateway&lt;/strong&gt; ï¼ˆå®ƒæ˜¯ç¬¬ä¸€æ¬¡ä¸å…¶ä¸­ä¸€ä¸ªæœåŠ¡è”ç³»ï¼Œå› æ­¤å¯¹äºç”Ÿæˆè·Ÿè¸ª ID çš„è¯·æ±‚ï¼‰ç„¶åç½‘å…³å°†è¯·æ±‚è½¬å‘ç»™ &lt;code&gt;sa-web-app&lt;/code&gt; æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ &lt;code&gt;sa-web-app&lt;/code&gt; æœåŠ¡ä¸­ï¼Œè¯·æ±‚ç”± Envoysidecar æ‹¾å–å¹¶åˆ›å»ºä¸€ä¸ª spanï¼ˆè¿™å°±æ˜¯æˆ‘ä»¬åœ¨è·Ÿè¸ªä¸­çœ‹åˆ°å®ƒçš„åŸå› ï¼‰å¹¶è½¬å‘åˆ° &lt;code&gt;sa-web-app&lt;/code&gt; å®¹å™¨å®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;è¿™é‡Œæ–¹æ³• &lt;strong&gt;sentimentAnalysis&lt;/strong&gt; å¤„ç†è¯·æ±‚ã€‚è¿™äº›è·Ÿè¸ªç”±åº”ç”¨ç¨‹åºç”Ÿæˆï¼Œè¿™æ„å‘³ç€éœ€è¦æ›´æ”¹ä»£ç ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä» POST è¯·æ±‚&lt;code&gt;sa-logic&lt;/code&gt;å¼€å§‹çš„ä½ç½®ã€‚è·Ÿè¸ª ID éœ€è¦&lt;code&gt;sa-web-app&lt;/code&gt;ä¼ é€’ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;5. &amp;hellip;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt; ï¼šåœ¨ç¬¬ 4 ç‚¹ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéœ€è¦è·å– Istio ç”Ÿæˆçš„ headerï¼Œå¹¶åœ¨ä¸‹ä¸€ä¸ªè¯·æ±‚æ—¶å°†å…¶ä¼ é€’ä¸‹æ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1odduj20m8055q3r_hu6ced28e2a63f92eb42044ea119c9e44e_77417_887afe8a56e2aca784dcd82135707c70.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1odduj20m8055q3r_hu6ced28e2a63f92eb42044ea119c9e44e_77417_fd0d377f80470a0a3eb450e1ac5a2d47.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1odduj20m8055q3r_hu6ced28e2a63f92eb42044ea119c9e44e_77417_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1odduj20m8055q3r_hu6ced28e2a63f92eb42044ea119c9e44e_77417_887afe8a56e2aca784dcd82135707c70.webp&#34;
               width=&#34;760&#34;
               height=&#34;176&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio åšä¸»è¦çš„ç¹é‡å·¥ä½œï¼Œå› ä¸ºå®ƒåœ¨ä¼ å…¥çš„è¯·æ±‚ä¸Šç”Ÿæˆ headerï¼Œåœ¨æ¯ä¸ª sidecar ä¸Šåˆ›å»ºæ–°çš„ spanï¼Œä¼ é€’å®ƒä»¬ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰æˆ‘ä»¬çš„æœåŠ¡ä¼ é€’ headerï¼Œæˆ‘ä»¬å°†å¤±å»è¯·æ±‚çš„å®Œæ•´è·Ÿè¸ªã€‚&lt;/p&gt;
&lt;p&gt;è¦ä¼ é€’çš„ header æ˜¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-request-id
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-b3-traceid
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-b3-spanid
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-b3-parentspanid
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-b3-sampled
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-b3-flags
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-ot-span-context
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°½ç®¡è¿™æ˜¯ä¸€é¡¹ç®€å•çš„ä»»åŠ¡ï¼Œä½†å·²ç»æœ‰&lt;a href=&#34;https://github.com/opentracing-contrib&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¸å¤šåº“&lt;/a&gt; å¯ä»¥ç®€åŒ–è¿™ä¸€è¿‡ç¨‹ï¼Œä¾‹å¦‚åœ¨ &lt;code&gt;sa-web-app&lt;/code&gt;æœåŠ¡ä¸­ï¼Œ &lt;strong&gt;RestTemplate&lt;/strong&gt; å®¢æˆ·ç«¯é€šè¿‡ç®€å•åœ°&lt;a href=&#34;https://github.com/rinormaloku/istio-mastery/blob/master/sa-webapp/pom.xml#L36-L47&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¾èµ–é¡¹ä¸­&lt;/a&gt; æ·»åŠ  Jaeger å’Œ OpenTracing åº“æ¥ä¼ é€’ headerã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;æ³¨æ„ï¼šSentiment Analysis åº”ç”¨ç¨‹åºå±•ç¤ºäº† Flaskï¼ŒSpring å’Œ ASP.NET Core çš„å®ç°ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œåœ¨è°ƒæŸ¥æˆ‘ä»¬å¼€ç®±å³ç”¨ï¼ˆæˆ–éƒ¨åˆ†å¼€ç®±å³ç”¨ï¼‰ä¹‹åï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™é‡Œçš„ä¸»é¢˜ï¼Œç»†ç²’åº¦è·¯ç”±ï¼Œç®¡ç†ç½‘ç»œæµé‡ï¼Œå®‰å…¨æ€§ç­‰ç­‰ï¼&lt;/p&gt;
&lt;h2 id=&#34;æµé‡ç®¡ç†&#34;&gt;æµé‡ç®¡ç†&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ Envoy çš„ Istio ä¸ºæ‚¨çš„é›†ç¾¤æä¾›äº†è®¸å¤šæ–°åŠŸèƒ½ï¼Œä»è€Œå®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€è¯·æ±‚è·¯ç”±&lt;/strong&gt; ï¼šCanary éƒ¨ç½²ï¼ŒA/B æµ‹è¯•ï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡ï¼š&lt;/strong&gt; ç®€å•å’Œä¸€è‡´çš„å“ˆå¸Œå¹³è¡¡ï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•…éšœæ¢å¤&lt;/strong&gt; ï¼šè¶…æ—¶ï¼Œé‡è¯•ï¼Œç†”æ–­å™¨ï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•…éšœæ³¨å…¥&lt;/strong&gt; ï¼šå»¶è¿Ÿï¼Œä¸­æ­¢è¯·æ±‚ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨æœ¬æ–‡çš„åºåˆ—ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­å±•ç¤ºè¿™äº›åŠŸèƒ½ï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­ä»‹ç»ä¸€äº›æ–°æ¦‚å¿µã€‚æˆ‘ä»¬å°†ç ”ç©¶çš„ç¬¬ä¸€ä¸ªæ¦‚å¿µæ˜¯ DestinationRulesï¼Œå¹¶ä½¿ç”¨é‚£äº›æˆ‘ä»¬å°†å¯ç”¨ A/B æµ‹è¯•çš„æ¦‚å¿µã€‚&lt;/p&gt;
&lt;h2 id=&#34;abæµ‹è¯•---å®è·µä¸­çš„ç›®çš„åœ°è§„åˆ™&#34;&gt;A/Bæµ‹è¯• - å®è·µä¸­çš„ç›®çš„åœ°è§„åˆ™&lt;/h2&gt;
&lt;p&gt;å½“æˆ‘ä»¬æœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºï¼ˆé€šå¸¸ç‰ˆæœ¬è§†è§‰ä¸Šæœ‰æ‰€ä¸åŒï¼‰æ—¶ä½¿ç”¨ A/B æµ‹è¯•ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸æ˜¯ 100ï¼…è‚¯å®šä¼šå¢åŠ ç”¨æˆ·äº¤äº’ï¼Œå› æ­¤æˆ‘ä»¬åŒæ—¶å°è¯•ä¸¤ä¸ªç‰ˆæœ¬å¹¶æ”¶é›†æŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥éƒ¨ç½²æ¼”ç¤ºA/Bæµ‹è¯•æ‰€éœ€çš„å‰ç«¯çš„ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/kube/ab-testing/sa-frontend-green-deployment.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions/sa-frontend-green created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»¿è‰²ç‰ˆæœ¬çš„éƒ¨ç½²æ¸…å•æœ‰ä¸¤ç‚¹ä¸åŒï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¯¥ image åŸºäºä¸åŒçš„æ ‡ç­¾ï¼š &lt;code&gt;istio-green&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;pod æ ‡æœ‰ &lt;code&gt;version: green&lt;/code&gt; ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è€Œä½œä¸ºåŒæ–¹éƒ¨ç½²åœ¨æ ‡ç­¾ &lt;code&gt;app: sa-frontend&lt;/code&gt; é€šè¿‡è™šæ‹ŸæœåŠ¡è·¯ç”±çš„è¯·æ±‚ &lt;code&gt;sa-external-services&lt;/code&gt;  çš„æœåŠ¡ &lt;code&gt;sa-frontend&lt;/code&gt; ä¼šè¢«è½¬å‘åˆ°æ‰€æœ‰çš„å®ä¾‹ï¼Œå¹¶å°†äºè´Ÿè½½é‡‡ç”¨å¾ªç¯ç®—æ³•ï¼Œè¿™å°†å¯¼è‡´åœ¨å›¾ 16 ä¸­æå‡ºçš„è´Ÿè½½å‡è¡¡é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-16æ‰¾ä¸åˆ°è¯·æ±‚çš„æ–‡ä»¶&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 16.æ‰¾ä¸åˆ°è¯·æ±‚çš„æ–‡ä»¶&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu30v6lj20m80do761_hu9a34d7f21ebb3b738fffa099c3064611_136022_2af8814cafca8db2e74b32b19fdcb24f.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu30v6lj20m80do761_hu9a34d7f21ebb3b738fffa099c3064611_136022_066e89aa6e33e987c90f622fd5277825.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu30v6lj20m80do761_hu9a34d7f21ebb3b738fffa099c3064611_136022_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu30v6lj20m80do761_hu9a34d7f21ebb3b738fffa099c3064611_136022_2af8814cafca8db2e74b32b19fdcb24f.webp&#34;
               width=&#34;760&#34;
               height=&#34;467&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 16.æ‰¾ä¸åˆ°è¯·æ±‚çš„æ–‡ä»¶
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ‰¾ä¸åˆ°è¿™äº›æ–‡ä»¶ï¼Œå› ä¸ºå®ƒä»¬åœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒç‰ˆæœ¬ä¸­çš„å‘½åæ–¹å¼ä¸åŒã€‚è®©æˆ‘ä»¬éªŒè¯ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl --silent http://&lt;span class=&#34;nv&#34;&gt;$EXTERNAL_IP&lt;/span&gt;/ &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; tr &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#34;&amp;#39;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep main
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/static/css/main.c7071b22.css
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/static/js/main.059f8e9c.js
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl --silent http://&lt;span class=&#34;nv&#34;&gt;$EXTERNAL_IP&lt;/span&gt;/ &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; tr &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#34;&amp;#39;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep main
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/static/css/main.f87cd8c9.css
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/static/js/main.f7659dbb.js
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ„å‘³ç€è¯·æ±‚ä¸€ä¸ªç‰ˆæœ¬çš„é™æ€æ–‡ä»¶çš„&lt;code&gt;index.html&lt;/code&gt;å¯ä»¥è¢«è´Ÿè½½å‡è¡¡åˆ°æä¾›å¦ä¸€ä¸ªç‰ˆæœ¬çš„ podï¼Œå…¶ä¸­å¯ä»¥ç†è§£çš„æ˜¯å…¶ä»–æ–‡ä»¶ä¸å­˜åœ¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ„å‘³ç€ï¼Œä¸ºäº†è®©æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥é™åˆ¶â€œä¸º index.html æœåŠ¡çš„åº”ç”¨ç¨‹åºçš„ç‰ˆæœ¬ï¼Œå¿…é¡»ä¸ºåç»­è¯·æ±‚æä¾›æœåŠ¡â€ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨ Consistent Hash Loadbalancing æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè¿™ &lt;strong&gt;æ˜¯&lt;/strong&gt; ä½¿ç”¨é¢„å®šä¹‰å±æ€§ï¼ˆä¾‹å¦‚ HTTP headerï¼‰&lt;strong&gt;å°†æ¥è‡ªåŒä¸€å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘åˆ°åŒä¸€åç«¯å®ä¾‹çš„è¿‡ç¨‹&lt;/strong&gt;ã€‚ç”± DestionatioRules æä¾›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;destinationrules&#34;&gt;DestinationRules&lt;/h2&gt;
&lt;p&gt;åœ¨ &lt;strong&gt;VirtualService&lt;/strong&gt; å°†è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„æœåŠ¡ä¹‹åï¼Œç„¶åä½¿ç”¨ &lt;strong&gt;DestinationRules&lt;/strong&gt;ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šé€‚ç”¨äºæ­¤æœåŠ¡å®ä¾‹çš„æµé‡çš„ç­–ç•¥ï¼Œå¦‚å›¾ 17 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-17ä½¿ç”¨-istio-èµ„æºçš„æµé‡ç®¡ç†&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 17.ä½¿ç”¨ Istio èµ„æºçš„æµé‡ç®¡ç†&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2yjsuj20rs09e75i_hub973b075210a5364025902e0934480e1_131002_7a8e3942555ca94197d7a98b8c96fe33.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2yjsuj20rs09e75i_hub973b075210a5364025902e0934480e1_131002_1295106d4c933312b5ad4528c369fa5f.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2yjsuj20rs09e75i_hub973b075210a5364025902e0934480e1_131002_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2yjsuj20rs09e75i_hub973b075210a5364025902e0934480e1_131002_7a8e3942555ca94197d7a98b8c96fe33.webp&#34;
               width=&#34;760&#34;
               height=&#34;257&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 17.ä½¿ç”¨ Istio èµ„æºçš„æµé‡ç®¡ç†
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šå›¾ 17 ä»¥æ˜“äºç†è§£çš„æ–¹å¼å¯è§†åŒ– Istio èµ„æºå¦‚ä½•å½±å“ç½‘ç»œæµé‡ã€‚ä½†æ˜¯ï¼Œå‡†ç¡®åœ°è¯´ï¼Œå†³å®šå°†è¯·æ±‚è½¬å‘åˆ°å“ªä¸ªå®ä¾‹æ˜¯ç”± CRD é…ç½®çš„ Ingress Gateway çš„ Envoy åšå‡ºçš„ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ç›®æ ‡è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å°†è´Ÿè½½å‡è¡¡é…ç½®ä¸ºå…·æœ‰ä¸€è‡´æ€§å“ˆå¸Œï¼Œå¹¶ç¡®ä¿åŒä¸€ç”¨æˆ·ç”±åŒä¸€æœåŠ¡å®ä¾‹å“åº”ã€‚é€šè¿‡ä»¥ä¸‹é…ç½®å®ç°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-frontend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-frontend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;loadBalancer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;consistentHash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;httpHeaderName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;version  &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;æ ¹æ®â€œversionâ€æ ‡å¤´çš„å†…å®¹ç”Ÿæˆä¸€è‡´çš„å“ˆå¸Œã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åº”ç”¨é…ç½®å¹¶å°è¯•ä¸€ä¸‹ï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/ab-testing/destinationrule-sa-frontend.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destinationrule.networking.istio.io/sa-frontend created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¹¶éªŒè¯åœ¨æŒ‡å®šç‰ˆæœ¬ header æ—¶æ˜¯å¦è·å¾—ç›¸åŒçš„æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl --silent -H &lt;span class=&#34;s2&#34;&gt;&amp;#34;version: yogo&amp;#34;&lt;/span&gt; http://&lt;span class=&#34;nv&#34;&gt;$EXTERNAL_IP&lt;/span&gt;/ &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; tr &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#34;&amp;#39;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep main
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šä¸ºäº†æ–¹ä¾¿åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œæµ‹è¯•ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤ &lt;a href=&#34;https://chrome.google.com/webstore/detail/modheader/idgpnmonknjnojddfkpgkljpfnnfcklj&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Chrome æ‰©å±•ç¨‹åº&lt;/a&gt; å‘ç‰ˆæœ¬ header æ·»åŠ ä¸åŒçš„å€¼ï¼Œã€‚&lt;/p&gt;
&lt;p&gt;DestinationRules å…·æœ‰æ›´å¤š LoadBalancing åŠŸèƒ½ï¼Œæ‰€æœ‰è¯¦ç»†ä¿¡æ¯éƒ½å¯ä»¥æŸ¥çœ‹ &lt;a href=&#34;https://preliminary.istio.io/docs/reference/config/istio.networking.v1alpha3.html#LoadBalancerSettings&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç»§ç»­æ›´è¯¦ç»†åœ°æ¢ç´¢ VirtualService ä¹‹å‰ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåˆ é™¤åº”ç”¨ç¨‹åºçš„ç»¿è‰²ç‰ˆæœ¬å’Œç›®æ ‡è§„åˆ™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -f resource-manifests/kube/ab-testing/sa-frontend-green-deployment.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions &lt;span class=&#34;s2&#34;&gt;&amp;#34;sa-frontend-green&amp;#34;&lt;/span&gt; deleted
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -f resource-manifests/istio/ab-testing/destinationrule-sa-frontend.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destinationrule.networking.istio.io â€œsa-frontendâ€ deleted
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;é•œåƒæœåŠ¡---å®è·µä¸­çš„è™šæ‹ŸæœåŠ¡&#34;&gt;é•œåƒæœåŠ¡ - å®è·µä¸­çš„è™šæ‹ŸæœåŠ¡&lt;/h2&gt;
&lt;p&gt;å½“æˆ‘ä»¬æƒ³è¦æµ‹è¯•ç”Ÿäº§ä¸­çš„æ›´æ”¹ä½†ä¸å½±å“æœ€ç»ˆç”¨æˆ·æ—¶ï¼Œä¼šä½¿ç”¨å½±å­æˆ–é•œåƒï¼Œå› æ­¤æˆ‘ä»¬å°†è¯·æ±‚é•œåƒåˆ°å…·æœ‰æ›´æ”¹å¹¶è¯„ä¼°å®ƒçš„ç¬¬äºŒä¸ªå®ä¾‹ä¸­ã€‚ &lt;em&gt;æ›´ç®€å•çš„æ˜¯ï¼Œå½“ä½ çš„ä¸€ä¸ªåŒäº‹é€‰æ‹©æœ€å…³é”®çš„é—®é¢˜å¹¶åˆ¶ä½œä¸€ä¸ªè¶…å¤§çš„åˆå¹¶è¯·æ±‚ï¼Œå¹¶ä¸”æ²¡äººèƒ½çœŸæ­£å®¡æŸ¥ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;è¦æµ‹è¯•æ­¤åŠŸèƒ½ï¼Œå¯ä»¥ é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ åˆ›å»º SA-Logic çš„ç¬¬äºŒä¸ªå®ä¾‹ï¼ˆ &lt;em&gt;è¿™æ˜¯ buggy çš„&lt;/em&gt; ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/kube/shadowing/sa-logic-service-buggy.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions/sa-logic-buggy created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¹¶éªŒè¯æ‰€æœ‰å®ä¾‹éƒ½æ ‡æœ‰ç›¸åº”çš„ç‰ˆæœ¬ï¼Œå¦å¤–è¿˜æœ‰&lt;code&gt;app=sa-logic&lt;/code&gt;æ ‡è®°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sa-logic --show-labels
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                              READY   LABELS
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-logic-568498cb4d-2sjwj         2/2     &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sa-logic,version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-logic-568498cb4d-p4f8c         2/2     &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sa-logic,version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-logic-buggy-76dff55847-2fl66   2/2     &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sa-logic,version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-logic-buggy-76dff55847-kx8zz   2/2     &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sa-logic,version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“ &lt;code&gt;sa-logic&lt;/code&gt; æœåŠ¡ç›®æ ‡ pod æ ‡è®°ä¸º &lt;code&gt;app=sa-logic&lt;/code&gt;æ—¶ï¼Œä»»ä½•ä¼ å…¥è¯·æ±‚å°†åœ¨æ‰€æœ‰å®ä¾‹ä¹‹é—´è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå¦‚å›¾ 18 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-18-round-robin-è´Ÿè½½å‡è¡¡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 18. Round Robin è´Ÿè½½å‡è¡¡&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu199gtj20m80f5wgc_hu9807c05403cf459333b4e86795132b18_122694_680c257f452f51a54fd3970698f77873.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu199gtj20m80f5wgc_hu9807c05403cf459333b4e86795132b18_122694_7a42a26338f9201650f278cf78759391.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu199gtj20m80f5wgc_hu9807c05403cf459333b4e86795132b18_122694_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu199gtj20m80f5wgc_hu9807c05403cf459333b4e86795132b18_122694_680c257f452f51a54fd3970698f77873.webp&#34;
               width=&#34;760&#34;
               height=&#34;518&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 18. Round Robin è´Ÿè½½å‡è¡¡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½†æˆ‘ä»¬å¸Œæœ›å°†è¯·æ±‚è·¯ç”±åˆ°ç‰ˆæœ¬ä¸º v1 çš„å®ä¾‹ï¼Œå¹¶é•œåƒåˆ°ç‰ˆæœ¬ä¸º v2 çš„å®ä¾‹ï¼Œå¦‚å›¾ 19 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-19è·¯ç”±åˆ°-v1-å’Œé•œåƒåˆ°-v2&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 19.è·¯ç”±åˆ° v1 å’Œé•œåƒåˆ° v2&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2f7y4j20m80b8q3y_hu342881a13cd2db999a82d45e2177d54d_98573_bc77f8534ddb02a1939d7a6ec3d1b500.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2f7y4j20m80b8q3y_hu342881a13cd2db999a82d45e2177d54d_98573_438e284689808f079e28d25e69f32b08.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2f7y4j20m80b8q3y_hu342881a13cd2db999a82d45e2177d54d_98573_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2f7y4j20m80b8q3y_hu342881a13cd2db999a82d45e2177d54d_98573_bc77f8534ddb02a1939d7a6ec3d1b500.webp&#34;
               width=&#34;760&#34;
               height=&#34;384&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 19.è·¯ç”±åˆ° v1 å’Œé•œåƒåˆ° v2
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä½¿ç”¨ VirtualService ä¸ DestinationRule ç»“åˆå®ç°çš„ï¼Œå…¶ä¸­ç›®æ ‡è§„åˆ™æŒ‡å®šåˆ°ç‰¹å®šå­é›†çš„å­é›†å’Œ VirtualService è·¯ç”±ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨ç›®æ ‡è§„åˆ™æŒ‡å®šå­é›†&#34;&gt;ä½¿ç”¨ç›®æ ‡è§„åˆ™æŒ‡å®šå­é›†&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹é…ç½®å®šä¹‰å­é›†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic   &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subsets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1       &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1  &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2  &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;ä¸»æœºå®šä¹‰æ­¤è§„åˆ™ä»…åœ¨å‘ &lt;code&gt;sa-logic&lt;/code&gt; æœåŠ¡å‘ç”Ÿè·¯ç”±æ—¶é€‚ç”¨&lt;/li&gt;
&lt;li&gt;è·¯ç”±åˆ°å­é›†å®ä¾‹æ—¶ä½¿ç”¨çš„å­é›†åç§°ã€‚&lt;/li&gt;
&lt;li&gt;Label å®šä¹‰äº†éœ€è¦åŒ¹é…çš„é”®å€¼å¯¹ï¼Œä»¥ä½¿å®ä¾‹æˆä¸ºå­é›†çš„ä¸€éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åº”ç”¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤çš„é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/shadowing/sa-logic-subsets-destinationrule.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; destinationrule.networking.istio.io/sa-logic created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡å®šä¹‰å­é›†ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­å¹¶é…ç½® VirtualService ä»¥åº”ç”¨äºè¯·æ±‚ &lt;code&gt;sa-logic&lt;/code&gt; æ‰€åœ¨çš„è¯·æ±‚ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è·¯ç”±åˆ°åä¸º v1 çš„å­é›†ï¼Œ&lt;/li&gt;
&lt;li&gt;é•œåƒåˆ°åä¸º v2 çš„å­é›†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™æ˜¯é€šè¿‡ä»¥ä¸‹æ¸…å•å®ç°çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;sa-logic          &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic  &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1      &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mirror&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;             
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic     &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”±äºä¸€åˆ‡é…ç½®éƒ½æ˜¯ä¸è¨€è‡ªæ˜çš„ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒçš„æ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/shadowing/sa-logic-subsets-shadowing-vs.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;virtualservice.networking.istio.io/sa-logic created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ·»åŠ ä¸€äº›è´Ÿè½½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; true&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; curl -v http://&lt;span class=&#34;nv&#34;&gt;$EXTERNAL_IP&lt;/span&gt;/sentiment &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -H &lt;span class=&#34;s2&#34;&gt;&amp;#34;Content-type: application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;sentence&amp;#34;: &amp;#34;I love yogobella&amp;#34;}&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    sleep .8&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ£€æŸ¥ Grafana ä¸­çš„ç»“æœï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰é”™è¯¯çš„ç‰ˆæœ¬å¤§çº¦æœ‰ 60ï¼…çš„è¯·æ±‚å¤±è´¥ï¼Œä½†æ²¡æœ‰ä¸€ä¸ªå¤±è´¥å½±å“æœ€ç»ˆç”¨æˆ·ï¼Œå› ä¸ºå®ƒä»¬è¢«å½“å‰æ´»åŠ¨çš„æœåŠ¡å“åº”ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-20-sa-é€»è¾‘æœåŠ¡ç‰ˆæœ¬çš„æˆåŠŸç‡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 20. sa é€»è¾‘æœåŠ¡ç‰ˆæœ¬çš„æˆåŠŸç‡&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2vr8gj20m80b0t9z_hu50b069e5fd4b109ba3dbaa3150c4714a_83890_e3dd87c8b9b56c3c5aec62e8dcca4a04.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2vr8gj20m80b0t9z_hu50b069e5fd4b109ba3dbaa3150c4714a_83890_cb47a68700ac6cd6bf41e162da9edb37.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2vr8gj20m80b0t9z_hu50b069e5fd4b109ba3dbaa3150c4714a_83890_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2vr8gj20m80b0t9z_hu50b069e5fd4b109ba3dbaa3150c4714a_83890_e3dd87c8b9b56c3c5aec62e8dcca4a04.webp&#34;
               width=&#34;760&#34;
               height=&#34;376&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 20. sa é€»è¾‘æœåŠ¡ç‰ˆæœ¬çš„æˆåŠŸç‡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡çœ‹åˆ°åº”ç”¨äºæˆ‘ä»¬æœåŠ¡çš„ envoy çš„ VirtualServiceï¼Œå½“å¯¹æ­¤ &lt;code&gt;sa-web-app&lt;/code&gt; æå‡ºè¯·æ±‚æ—¶ï¼Œ &lt;code&gt;sa-logic&lt;/code&gt;  é€šè¿‡ sidecar Envoyï¼Œé€šè¿‡ VirtualService é…ç½®ä¸ºè·¯ç”±åˆ°å­é›† v1 å¹¶é•œåƒåˆ°æœåŠ¡çš„å­é›† v2 &lt;code&gt;sa-logic&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å¯ä»¥çœ‹åˆ°ä½ åœ¨æƒ³â€œDarn man Virtual Services å¾ˆç®€å•ï¼â€ï¼Œåœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠå¥å­æ‰©å±•ä¸ºâ€œSimply Amazingï¼â€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é‡‘ä¸é›€éƒ¨ç½²&#34;&gt;é‡‘ä¸é›€éƒ¨ç½²&lt;/h2&gt;
&lt;p&gt;Canary Deployment æ˜¯å‘å°‘æ•°ç”¨æˆ·æ¨å‡ºæ–°ç‰ˆæœ¬åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ï¼Œä½œä¸ºéªŒè¯ç¼ºå°‘é—®é¢˜çš„ä¸€ä¸ªæ­¥éª¤ï¼Œç„¶åå‘æ›´å¹¿æ³›çš„å—ä¼—æä¾›æ›´é«˜è´¨é‡çš„å‘å¸ƒä¿è¯ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨ç›¸åŒçš„ buggy å­é›† &lt;code&gt;sa-logic&lt;/code&gt; æ¥æ¼”ç¤º canary éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬å¤§èƒ†åœ°å¼€å§‹ï¼Œé€šè¿‡åº”ç”¨ä¸‹é¢çš„ VirtualServiceï¼Œå°† 20ï¼…çš„ç”¨æˆ·å‘é€åˆ°æœ‰ç¼ºé™·çš„ç‰ˆæœ¬ï¼ˆè¿™ä»£è¡¨é‡‘ä¸é›€éƒ¨ç½²ï¼‰å’Œ 80ï¼…çš„å¥åº·æœåŠ¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;sa-logic    &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;æƒé‡æŒ‡å®šè¦è½¬å‘åˆ°ç›®æ ‡æˆ–ç›®æ ‡å­é›†çš„è¯·æ±‚çš„ç™¾åˆ†æ¯”ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;sa-logic&lt;/code&gt; ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ æ›´æ–°ä»¥å‰çš„ è™šæ‹ŸæœåŠ¡é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/canary/sa-logic-subsets-canary-versusyaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; virtualservice.networking.istio.io/sa-logic configured
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ç«‹å³çœ‹åˆ°æˆ‘ä»¬çš„ä¸€äº›è¯·æ±‚å¤±è´¥äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; true&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   curl -i http://&lt;span class=&#34;nv&#34;&gt;$EXTERNAL_IP&lt;/span&gt;/sentiment &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   -H â€œContent-type: application/jsonâ€ &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;sentence&amp;#34;: &amp;#34;I love yogobella&amp;#34;}&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   --silent -w &lt;span class=&#34;s2&#34;&gt;&amp;#34;Time: %{time_total}s \t Status: %{http_code}\n&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   -o /dev/null&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; sleep .1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Time: 0.153075s Status: &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Time: 0.137581s Status: &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Time: 0.139345s Status: &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Time: 30.291806s Status: &lt;span class=&#34;m&#34;&gt;500&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;VirtualServices å¯ç”¨äº† Canary Deploymentsï¼Œé€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°†æ½œåœ¨çš„æŸå®³å‡å°‘åˆ°äº† 20ï¼…çš„ç”¨æˆ·ç¾¤ã€‚æ¼‚äº®ï¼ç°åœ¨ï¼Œæ¯å½“æˆ‘ä»¬å¯¹ä»£ç ä¸å®‰å…¨æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ Shadowing å’Œ Canary Deploymentsï¼Œæ¢å¥è¯è¯´ï¼Œæ€»æ˜¯å¦‚æ­¤ã€‚ğŸ˜œ&lt;/p&gt;
&lt;h2 id=&#34;è¶…æ—¶å’Œé‡è¯•&#34;&gt;è¶…æ—¶å’Œé‡è¯•&lt;/h2&gt;
&lt;p&gt;ä»£ç å¹¶ä¸æ€»æ˜¯é”™è¯¯çš„ã€‚åœ¨â€œ &lt;a href=&#34;https://en.wikipedia.org/wiki/Fallacies_of_distributed_computing#The_fallacies&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆ†å¸ƒå¼è®¡ç®—çš„ 8 ä¸ªè°¬è¯¯&lt;/a&gt; â€åˆ—è¡¨ä¸­ï¼Œç¬¬ä¸€ä¸ªè°¬è®ºæ˜¯â€œç½‘ç»œå¯é â€ã€‚ç½‘ç»œä¸å¯é ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦è¶…æ—¶å’Œé‡è¯•çš„åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;å‡ºäºæ¼”ç¤ºç›®çš„ï¼Œæˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨æœ‰ç¼ºé™·çš„ç‰ˆæœ¬ &lt;code&gt;sa-logic&lt;/code&gt;ï¼Œå…¶ä¸­éšæœºæ•…éšœæ¨¡æ‹Ÿç½‘ç»œçš„ä¸å¯é æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ç¼ºé™·çš„æœåŠ¡æœ‰ä¸‰åˆ†ä¹‹ä¸€çš„æœºä¼šèŠ±è´¹å¤ªé•¿æ—¶é—´æ¥å“åº”ï¼Œä¸‰åˆ†ä¹‹ä¸€çš„æœºä¼šä»¥å†…éƒ¨æœåŠ¡å™¨é”™è¯¯ç»“æŸï¼Œå…¶ä½™çš„æˆåŠŸå®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç¼“è§£è¿™äº›é—®é¢˜å¹¶æ”¹å–„ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬å¯ä»¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœæœåŠ¡æ—¶é—´è¶…è¿‡ 8 ç§’ï¼Œåˆ™è¶…æ—¶&lt;/li&gt;
&lt;li&gt;é‡è¯•å¤±è´¥çš„è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™æ˜¯é€šè¿‡ä»¥ä¸‹èµ„æºå®šä¹‰å®ç°çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;8s          &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;retries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;attempts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;perTryTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;3s  &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ä¸º 8 ç§’ï¼Œ&lt;/li&gt;
&lt;li&gt;å®ƒå°è¯•äº† 3 æ¬¡ï¼Œ&lt;/li&gt;
&lt;li&gt;å¦‚æœå°è¯•æ—¶é—´è¶…è¿‡ 3 ç§’ï¼Œåˆ™å°è¯•å°†è¯·æ±‚æ ‡è®°ä¸ºå¤±è´¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ç§ä¼˜åŒ–ï¼Œå› ä¸ºç”¨æˆ·ä¸ä¼šç­‰å¾…è¶…è¿‡ 8 ç§’ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨å‘ç”Ÿæ•…éšœæ—¶é‡è¯•ä¸‰æ¬¡ï¼Œä»è€Œå¢åŠ äº†å¯¼è‡´å“åº”æˆåŠŸçš„æœºä¼šã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åº”ç”¨æ›´æ–°çš„é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/retries/sa-logic-retries-timeouts-vs.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;virtualservice.networking.istio.io/sa-logic configured
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¹¶æŸ¥çœ‹ Grafana å›¾è¡¨ï¼Œäº†è§£æˆåŠŸç‡çš„æ”¹å–„æƒ…å†µï¼ˆå¦‚å›¾ 21 æ‰€ç¤ºï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-21ä½¿ç”¨è¶…æ—¶å’Œé‡è¯•åçš„æ”¹è¿›&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 21.ä½¿ç”¨è¶…æ—¶å’Œé‡è¯•åçš„æ”¹è¿›&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1qjtxj20m80b63zk_hu08561a5de2fe5f3cccac09e1fefb947c_68253_b7aff203f90f541cfa81589369b55db3.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1qjtxj20m80b63zk_hu08561a5de2fe5f3cccac09e1fefb947c_68253_0e7fd72b57cbf100368a1405ab627e2f.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1qjtxj20m80b63zk_hu08561a5de2fe5f3cccac09e1fefb947c_68253_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://cloudnative.to/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1qjtxj20m80b63zk_hu08561a5de2fe5f3cccac09e1fefb947c_68253_b7aff203f90f541cfa81589369b55db3.webp&#34;
               width=&#34;760&#34;
               height=&#34;382&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 21.ä½¿ç”¨è¶…æ—¶å’Œé‡è¯•åçš„æ”¹è¿›
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;code&gt;sa-logic-buggy&lt;/code&gt; é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ è¿›å…¥ä¸‹ä¸€éƒ¨åˆ† delete å’Œ VirtualService ä¹‹å‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete deployment sa-logic-buggy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions &lt;span class=&#34;s2&#34;&gt;&amp;#34;sa-logic-buggy&amp;#34;&lt;/span&gt; deleted
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete virtualservice sa-logic
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;virtualservice.networking.istio.io â€œsa-logicâ€ deleted
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç†”æ–­å™¨å’Œéš”ç¦»æ¨¡å¼&#34;&gt;ç†”æ–­å™¨å’Œéš”ç¦»æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;å¾®æœåŠ¡æ¶æ„ä¸­çš„ä¸¤ä¸ªé‡è¦æ¨¡å¼ï¼Œå¯ä»¥å®ç°æœåŠ¡çš„è‡ªæˆ‘ä¿®å¤ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥ &lt;strong&gt;ç†”æ–­å™¨&lt;/strong&gt; æ˜¯ç”¨æ¥é˜»æ­¢è¯·æ±‚å°†è§†ä¸ºä¸å¥åº·æœåŠ¡çš„ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä½¿å®ƒèƒ½å¤Ÿæ¢å¤ï¼Œåœ¨æ­¤æœŸé—´å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘åˆ°è¯¥æœåŠ¡çš„å¥åº·æƒ…å†µï¼ˆå¢åŠ æˆåŠŸç‡ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥ &lt;strong&gt;éš”ç¦»æ¨¡å¼&lt;/strong&gt; æ•´ä¸ªç³»ç»Ÿé™çº§æ¥éš”ç¦»é”™è¯¯ï¼Œé˜²æ­¢é”™è¯¯ä¼ æ’­ï¼Œä¸¾ä¸€ä¸ªéš”ç¦»æ•…éšœä¾‹å­ï¼ŒæœåŠ¡ B å¤„äºæŸåçŠ¶æ€å’Œå…¶å®ƒæœåŠ¡ï¼ˆæœåŠ¡ B çš„å®¢æˆ·ç«¯ï¼‰å‘å‡ºè¯·æ±‚åˆ°æœåŠ¡ Bï¼Œè¿™å°†å¯¼è‡´è¯¥å®¢æˆ·ç«¯å°†ä½¿ç”¨äº†è‡ªå·±çš„çº¿ç¨‹æ± ï¼Œå°†æ— æ³•æä¾›å…¶ä»–è¯·æ±‚ï¼ˆå³ä½¿è¿™äº›è¯·æ±‚ä¸æœåŠ¡ B æ— å…³ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å°†è·³è¿‡è¿™äº›æ¨¡å¼çš„å®ç°ï¼Œå› ä¸ºæ‚¨å¯ä»¥æŸ¥çœ‹ &lt;a href=&#34;https://istio.io/docs/tasks/traffic-management/circuit-breaking/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡æ¡£ä¸­çš„å®ç°&lt;/a&gt;ï¼Œæˆ‘å¾ˆå…´å¥‹åœ°å±•ç¤ºèº«ä»½éªŒè¯å’Œæˆæƒï¼Œè¿™å°†æ˜¯ä¸‹ä¸€ç¯‡æ–‡ç« çš„ä¸»é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬ä¸€éƒ¨åˆ†---æ‘˜è¦&#34;&gt;ç¬¬ä¸€éƒ¨åˆ† - æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬åœ¨ Kubernetes é›†ç¾¤ä¸­éƒ¨ç½²äº† Istioï¼Œå¹¶ä½¿ç”¨å…¶è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆå¦‚ &lt;strong&gt;ç½‘å…³&lt;/strong&gt;ï¼Œ &lt;strong&gt;VirtualServices&lt;/strong&gt;ï¼Œ &lt;strong&gt;DestinationRules&lt;/strong&gt; åŠå…¶ç»„ä»¶ï¼‰å¯ç”¨äº†ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;strong&gt;Kiali&lt;/strong&gt;ï¼Œé€šè¿‡æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„æœåŠ¡ï¼Œå®ƒä»¬å¦‚ä½•æ‰§è¡Œï¼Œä»¥åŠå®ƒä»¬å…³ç³»ï¼Œæ¥è§‚å¯Ÿæˆ‘ä»¬çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;strong&gt;Prometheus&lt;/strong&gt; å’Œ &lt;strong&gt;Grafana&lt;/strong&gt; è¿›è¡Œæ”¶é›†å’Œå¯è§†åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;è¯·æ±‚ &lt;strong&gt;Jaeger&lt;/strong&gt; è·Ÿè¸ªï¼ˆHunter çš„å¾·è¯­ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹ç½‘ç»œæµé‡è¿›è¡Œå…¨é¢ç»†ç²’åº¦æ§åˆ¶ï¼Œå®ç° &lt;strong&gt;Canary Deployments&lt;/strong&gt;ï¼Œ &lt;strong&gt;A/Bæµ‹è¯•å’ŒShadowing&lt;/strong&gt; ã€‚&lt;/li&gt;
&lt;li&gt;è½»æ¾å®ç° &lt;strong&gt;é‡è¯•ï¼Œè¶…æ—¶å’Œ CircuitBreakers&lt;/strong&gt; ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€æœ‰è¿™äº›éƒ½å¯ä»¥åœ¨æ²¡æœ‰ä»£ç æ›´æ”¹æˆ–ä»»ä½•å…¶ä»–ä¾èµ–æ€§çš„æƒ…å†µä¸‹å®ç°ï¼Œä»è€Œä½¿æ‚¨çš„æœåŠ¡ä¿æŒå°å·§ï¼Œæ˜“äºæ“ä½œå’Œç»´æŠ¤&lt;/p&gt;
&lt;p&gt;å¯¹äºæ‚¨çš„å¼€å‘å›¢é˜Ÿæ¥è¯´ï¼Œæ¶ˆé™¤è¿™äº›è·¨é¢†åŸŸçš„é—®é¢˜å¹¶å°†å®ƒä»¬é›†ä¸­åˆ° Istio çš„æ§åˆ¶å¹³é¢ï¼Œæ„å‘³ç€æ–°æœåŠ¡å¾ˆå®¹æ˜“å¼•å…¥ï¼Œå®ƒä»¬ä¸ä¼šå ç”¨å¤§é‡èµ„æºï¼Œå› ä¸ºå¼€å‘äººå‘˜å¯ä»¥ä¸“æ³¨äºè§£å†³ä¸šåŠ¡é—®é¢˜ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ²¡æœ‰ä»»ä½•å¼€å‘äººå‘˜æŠ±æ€¨â€œå¿…é¡»è§£å†³æœ‰è¶£çš„ä¸šåŠ¡é—®é¢˜ï¼â€ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å¾ˆä¹æ„åœ¨ä¸‹é¢çš„è¯„è®ºä¸­å¬åˆ°æ‚¨çš„æƒ³æ³•ï¼Œå¹¶éšæ—¶åœ¨ &lt;a href=&#34;https://twitter.com/rinormaloku&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Twitter&lt;/a&gt; æˆ–æˆ‘çš„é¡µé¢ &lt;a href=&#34;https://rinormaloku.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rinormaloku.com&lt;/a&gt; ä¸Šä¸æˆ‘ &lt;a href=&#34;https://rinormaloku.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è”ç³»&lt;/a&gt;ï¼Œå¹¶ç»§ç»­å…³æ³¨ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†è§£å†³æœ€åä¸€å±‚è®¤è¯å’Œæˆæƒé—®é¢˜ï¼&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
