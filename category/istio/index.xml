<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Istio | äº‘åŸç”Ÿç¤¾åŒºï¼ˆä¸­å›½ï¼‰</title>
    <link>https://cloudnativecn.com/category/istio/</link>
      <atom:link href="https://cloudnativecn.com/category/istio/index.xml" rel="self" type="application/rss+xml" />
    <description>Istio</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><lastBuildDate>Fri, 09 May 2025 10:35:46 +0800</lastBuildDate>
    <image>
      <url>https://cloudnativecn.com/media/sharing.png</url>
      <title>Istio</title>
      <link>https://cloudnativecn.com/category/istio/</link>
    </image>
    
    <item>
      <title>Istio 1.26 å‘å¸ƒï¼šå¢å¼º Gateway API æ”¯æŒï¼Œæ‹¥æŠ± Kubernetes æœªæ¥ â€”â€” åŒæ—¶å‘Šåˆ« 1.23 ç‰ˆæœ¬</title>
      <link>https://cloudnativecn.com/blog/istio-1-26-release-and-1-23-eol/</link>
      <pubDate>Fri, 09 May 2025 10:35:46 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-1-26-release-and-1-23-eol/</guid>
      <description>&lt;p&gt;2025å¹´5æœˆ8æ—¥ï¼ŒIstio ç¤¾åŒºæ­£å¼å‘å¸ƒäº† &lt;strong&gt;Istio 1.26&lt;/strong&gt;ã€‚è¿™æ˜¯ä¸€æ¬¡åœ¨åŠŸèƒ½ã€å¯æ‰©å±•æ€§ã€å®‰å…¨æ€§ä¸å¹³å°é€‚é…æ€§æ–¹é¢å…¨é¢æå‡çš„é‡è¦æ›´æ–°ã€‚ä¸æ­¤åŒæ—¶ï¼ŒIstio 1.23 ä¹Ÿæ­£å¼åœæ­¢ç»´æŠ¤ï¼Œæ ‡å¿—ç€è¿™ä¸€ä¸»æµç‰ˆæœ¬çš„ç”Ÿå‘½å‘¨æœŸæ­£å¼ç»“æŸã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸€istio-126-æ–°ç‰¹æ€§é€Ÿè§ˆ&#34;&gt;ä¸€ã€Istio 1.26 æ–°ç‰¹æ€§é€Ÿè§ˆ&lt;/h2&gt;
&lt;h3 id=&#34;1-gateway-api-è‡ªåŠ¨èµ„æºæ”¯æŒå…¨é¢å¯é…ç½®&#34;&gt;1. Gateway API è‡ªåŠ¨èµ„æºæ”¯æŒå…¨é¢å¯é…ç½®&lt;/h3&gt;
&lt;p&gt;åœ¨ Istio 1.26 ä¸­ï¼Œç”¨æˆ·ç»ˆäºå¯ä»¥é€šè¿‡ ConfigMap è‡ªå®šä¹‰ç”± Gateway API è‡ªåŠ¨ç”Ÿæˆçš„èµ„æºï¼Œä¾‹å¦‚ &lt;code&gt;Service&lt;/code&gt;ã€&lt;code&gt;Deployment&lt;/code&gt;ã€&lt;code&gt;HorizontalPodAutoscaler&lt;/code&gt; å’Œ &lt;code&gt;PodDisruptionBudget&lt;/code&gt;ã€‚è¿™ä½¿å¾—è¿ç»´å’Œç½‘å…³éƒ¨ç½²ç­–ç•¥æ›´çµæ´»ï¼Œæ˜¾è‘—æå‡äº†ç”Ÿäº§å¯ç”¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;è¯¦è§æ–‡æ¡£ï¼š&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/ingress/gateway-api/#automated-deployment&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚ä½•è‡ªå®šä¹‰ Gateway è‡ªåŠ¨éƒ¨ç½²çš„èµ„æº&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;2-ambient-æ¨¡å¼ä¸‹æ”¯æŒ-tcproute&#34;&gt;2. Ambient æ¨¡å¼ä¸‹æ”¯æŒ TCPRoute&lt;/h3&gt;
&lt;p&gt;Ambient æ¨¡å¼ä¸‹çš„ Waypoint ä»£ç†ç°åœ¨æ”¯æŒ &lt;a href=&#34;https://gateway-api.sigs.k8s.io/guides/tcp/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway API çš„ &lt;code&gt;TCPRoute&lt;/code&gt;&lt;/a&gt;ï¼Œè®© TCP å±‚æµé‡çš„ç²¾ç»†æ§åˆ¶æˆä¸ºå¯èƒ½ï¼Œè¿›ä¸€æ­¥æå‡äº† L4 å±‚é¢çš„å¯è§‚æµ‹ä¸æ§åˆ¶èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼ŒIstio è¿˜å¼•å…¥äº† Gateway API v1.3 çš„å®éªŒæ€§ç‰¹æ€§ &lt;a href=&#34;https://gateway-api.sigs.k8s.io/api-types/backendtlspolicy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;BackendTLSPolicy&lt;/code&gt;&lt;/a&gt; ä¸ &lt;a href=&#34;https://gateway-api.sigs.k8s.io/api-types/backendtrafficpolicy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;BackendTrafficPolicy&lt;/code&gt;&lt;/a&gt;ï¼Œä¸ºæœªæ¥çš„é‡è¯•ã€åç«¯è®¤è¯æ§åˆ¶é“ºå¹³é“è·¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;3-æ”¯æŒ-kubernetes-æ–°ç‰¹æ€§-clustertrustbundle&#34;&gt;3. æ”¯æŒ Kubernetes æ–°ç‰¹æ€§ ClusterTrustBundle&lt;/h3&gt;
&lt;p&gt;Istio 1.26 å¢åŠ äº†å¯¹ Kubernetes å®éªŒæ€§ç‰¹æ€§ &lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/#cluster-trust-bundles&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;ClusterTrustBundle&lt;/code&gt;&lt;/a&gt; çš„æ”¯æŒï¼Œè¿™æ˜¯é›†ç¾¤é—´ä¿¡ä»»ç®¡ç†çš„é‡è¦ä¸€æ­¥ï¼Œæœªæ¥æœ‰æœ›æ›¿ä»£ä¼ ç»Ÿ CA æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;4-istioctl-å·¥å…·å¢å¼º&#34;&gt;4. istioctl å·¥å…·å¢å¼º&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;istioctl analyze&lt;/code&gt; ç°åœ¨æ”¯æŒæŒ‡å®šæŸä¸ªæ£€æŸ¥é¡¹ï¼Œä¾¿äºé›†æˆè‡ªåŠ¨åŒ–æ£€æµ‹ã€‚&lt;/li&gt;
&lt;li&gt;å¢åŠ  &lt;code&gt;--tls-server-name&lt;/code&gt; æ”¯æŒï¼Œä¾¿äºç”Ÿæˆå¯ç”¨äºç‰¹å®šç½‘å…³åŸŸåçš„ kubeconfigã€‚&lt;/li&gt;
&lt;li&gt;å¤šé¡¹ CLI å‘½ä»¤ä¿®å¤ä¸å¢å¼ºï¼Œæå‡å®‰è£…ä¸è°ƒè¯•ä½“éªŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;5-å®‰è£…ä¸å¹³å°é€‚é…æ”¹è¿›&#34;&gt;5. å®‰è£…ä¸å¹³å°é€‚é…æ”¹è¿›&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ GKE ä¸­è‡ªåŠ¨é…ç½® &lt;code&gt;ResourceQuota&lt;/code&gt; ä¸ &lt;code&gt;cniBinDir&lt;/code&gt;ï¼Œæå‡å…¼å®¹æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;istio-cni&lt;/code&gt; ä¸å†é»˜è®¤ä½¿ç”¨ &lt;code&gt;hostNetwork&lt;/code&gt;ï¼Œé™ä½ç«¯å£å†²çªé£é™©ã€‚&lt;/li&gt;
&lt;li&gt;Helm Chart ä¸­æ–°å¢æ”¯æŒè®¾ç½® &lt;code&gt;loadBalancerClass&lt;/code&gt;ã€&lt;code&gt;updateStrategy&lt;/code&gt;ã€&lt;code&gt;ConfigMap&lt;/code&gt; ç­‰å…³é”®å‚æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;6-envoyfilter-å’Œ-retry-ç­–ç•¥å¢å¼º&#34;&gt;6. EnvoyFilter å’Œ Retry ç­–ç•¥å¢å¼º&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;EnvoyFilter&lt;/code&gt; ç°å¯åŸºäº &lt;code&gt;VirtualHost&lt;/code&gt; çš„åŸŸåè¿›è¡ŒåŒ¹é…ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒé…ç½®é‡è¯•çš„ backoff é—´éš”ä¸ host predicateã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯¦ç»†æ”¹åŠ¨è¯·å‚è€ƒå®˜æ–¹&lt;a href=&#34;https://istio.io/latest/news/releases/1.26.x/announcing-1.26/change-notes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®Œæ•´å˜æ›´æ—¥å¿—&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;äºŒistio-123-æ­£å¼åœæ­¢æ”¯æŒ&#34;&gt;äºŒã€Istio 1.23 æ­£å¼åœæ­¢æ”¯æŒ&lt;/h2&gt;
&lt;p&gt;æ ¹æ® &lt;a href=&#34;https://istio.io/latest/news/support/announcing-1.23-eol-final/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹å…¬å‘Š&lt;/a&gt;ï¼Œè‡ª 2025 å¹´ 4 æœˆ 16 æ—¥èµ·ï¼ŒIstio 1.23 ç‰ˆæœ¬å·²åœæ­¢ç»´æŠ¤ï¼Œä¸å†æ¥æ”¶å®‰å…¨æ¼æ´ä¸å…³é”® Bug ä¿®å¤ã€‚å»ºè®®ä»åœ¨ä½¿ç”¨è¯¥ç‰ˆæœ¬çš„ç”¨æˆ·å°½å¿«å‡çº§è‡³ Istio 1.26 æˆ–æ›´æ–°ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸‰æ¨èå…³æ³¨çš„ç¤¾åŒºå†…å®¹&#34;&gt;ä¸‰ã€æ¨èå…³æ³¨çš„ç¤¾åŒºå†…å®¹&lt;/h2&gt;
&lt;p&gt;è‹¥ä½ å¸Œæœ›æ·±å…¥äº†è§£ Ambient æ¨¡å¼åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­çš„è¡¨ç°ã€å®‰å…¨æ€§ä¸æ€§èƒ½æ¯”è¾ƒï¼Œå»ºè®®é˜…è¯»ä»¥ä¸‹ Istio å®˜æ–¹åšå®¢ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/blog/2025/ztunnel-security-assessment/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ztunnel å®‰å…¨æ€§è¯„ä¼°æŠ¥å‘Š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/blog/2025/ambient-performance/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambient æ¨¡å¼ vs å†…æ ¸æ—è·¯æ€§èƒ½å¯¹æ¯”&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/blog/2025/istio-at-kubecon-eu/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åœ¨ KubeCon EU çš„æŠ€æœ¯åˆ†äº«&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å››å‡çº§å»ºè®®ä¸åé¦ˆé€šé“&#34;&gt;å››ã€å‡çº§å»ºè®®ä¸åé¦ˆé€šé“&lt;/h2&gt;
&lt;p&gt;æœ¬æ¬¡å‘å¸ƒæ”¯æŒ Kubernetes 1.29 è‡³ 1.32ï¼ˆé¢„è®¡å…¼å®¹ 1.33ï¼‰ï¼Œå¦‚è®¡åˆ’å‡çº§è‡³ 1.26ï¼Œè¯·æå‰å‚è€ƒ &lt;a href=&#34;https://istio.io/latest/news/releases/1.26.x/announcing-1.26/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‡çº§æŒ‡å—&lt;/a&gt;ã€‚å¦‚é‡é—®é¢˜æˆ–å¸Œæœ›æä¾›åé¦ˆï¼Œå¯åŠ å…¥ &lt;a href=&#34;https://slack.istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Slack ç¤¾åŒº&lt;/a&gt;ï¼Œè¿›å…¥ &lt;code&gt;#release-1.26&lt;/code&gt; é¢‘é“å‚ä¸è®¨è®ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;äº”å†™åœ¨æœ€å&#34;&gt;äº”ã€å†™åœ¨æœ€å&lt;/h2&gt;
&lt;p&gt;Istio 1.26 æ ‡å¿—ç€ Ambient æ¨¡å¼ä»â€œå®éªŒæ€§â€èµ°å‘æ›´æˆç†Ÿé˜¶æ®µï¼Œä¹Ÿæ˜¯ Istio ä¸ Kubernetes æ·±åº¦é›†æˆçš„åˆä¸€é‡Œç¨‹ç¢‘ã€‚ä½œä¸ºäº‘åŸç”Ÿç½‘ç»œçš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ŒIstio å°†æŒç»­æ¨åŠ¨é¢å‘æœåŠ¡çš„æµé‡æ²»ç†ã€å®‰å…¨ä¸å¯è§‚æµ‹æ€§æ¼”è¿›ã€‚&lt;/p&gt;
&lt;p&gt;æ¬¢è¿å¤§å®¶å‚ä¸æµ‹è¯•ã€åé¦ˆä½“éªŒï¼Œè´¡çŒ®ä»£ç æˆ–æ–‡æ¡£ï¼Œä¸ºå¼€æºä¸–ç•Œæ·»ç –åŠ ç“¦ï¼&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ğŸ‘‰ å»¶ä¼¸é˜…è¯»ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/news/releases/1.26.x/announcing-1.26/change-notes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ğŸ“ƒ Istio 1.26 å˜æ›´æ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/news/releases/1.26.x/announcing-1.26/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;âš™ï¸ Istio 1.26 å‡çº§æŒ‡å—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/news/support/announcing-1.23-eol-final/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ğŸ“Œ Istio 1.23 EOL æœ€ç»ˆå…¬å‘Š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Ambient Mesh ä¸­çš„æˆæƒç­–ç•¥æŒ‡å—</title>
      <link>https://cloudnativecn.com/blog/ambient-mesh-authorization-policy/</link>
      <pubDate>Thu, 24 Apr 2025 18:09:59 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/ambient-mesh-authorization-policy/</guid>
      <description>&lt;p&gt;æœåŠ¡ç½‘æ ¼æœ€å—æ¬¢è¿çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œå°±æ˜¯èƒ½å¤Ÿå¯¹ç½‘ç»œæµé‡å¼ºåˆ¶æ‰§è¡Œè®¿é—®æ§åˆ¶ç­–ç•¥ã€‚ç”±äºæ‰€æœ‰æµé‡éƒ½ç»è¿‡ä»£ç†æœåŠ¡å™¨ï¼Œå› æ­¤ä½ å¯ä»¥ç¡®ä¿æ²¡æœ‰äººèƒ½å¤Ÿç»•è¿‡æŸä¸ªå¼ºåˆ¶ç‚¹ç›´æ¥è®¿é—®æœåŠ¡ï¼Œè€Œä¸”è¿™äº›å¼ºåˆ¶ç‚¹å¯ä»¥ä½äºæ¯ä¸ªæœåŠ¡å‰ï¼Œè€Œä¸æ˜¯ä»…åœ¨ç½‘ç»œè¾¹ç¼˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ä¼ ç»Ÿçš„é˜²ç«å¢™æˆ– Kubernetes çš„ NetworkPolicy åŠŸèƒ½ä¸åŒï¼ŒæœåŠ¡ç½‘æ ¼è¿˜å¯ä»¥è®¿é—®åº”ç”¨å±‚ï¼ˆç¬¬ä¸ƒå±‚ï¼ŒL7ï¼‰ä¿¡æ¯ï¼Œä¾‹å¦‚è¯·æ±‚æ˜¯ HTTP çš„ GET è¿˜æ˜¯ POSTï¼Œä»¥åŠè¯·æ±‚ä¸­æºå¸¦çš„ cookie ä¸­çš„ç”¨æˆ·èº«ä»½ã€‚&lt;/p&gt;
&lt;p&gt;Ambient Meshï¼ˆç”± Istio çš„ Ambient æ¨¡å¼å’Œ Gloo Mesh å®ç°ï¼‰æå¤§åœ°ç®€åŒ–äº†æœåŠ¡ç½‘æ ¼çš„äº¤ä»˜æ–¹å¼ï¼Œå¹¶æ˜¾è‘—é™ä½äº†æˆæœ¬ã€‚å®ƒçš„åšæ³•æ˜¯&lt;a href=&#34;https://ambientmesh.io/docs/about/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å°† L4 å’Œ L7 çš„å¤„ç†æ‹†åˆ†ä¸ºä¸¤ä¸ªä¸åŒçš„ä»£ç†ç»„ä»¶&lt;/a&gt;ã€‚ä½†è¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬å¿…é¡»æ”¹å˜å¯¹è®¿é—®æ§åˆ¶çš„é»˜è®¤å‡è®¾ï¼šæˆ‘ä»¬ä¸å†é»˜è®¤æ¯ä¸ªå·¥ä½œè´Ÿè½½å‰éƒ½æœ‰ä¸€ä¸ª L7 æ„ŸçŸ¥çš„å¼ºåˆ¶æ‰§è¡Œç‚¹ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸éœ€è¦å®ƒï¼Œå¦‚æœç¡®å®éœ€è¦ï¼Œä¹Ÿå¯ä»¥æŒ‰éœ€éƒ¨ç½²ï¼Œä»…ä½œç”¨äºéœ€è¦ä¿æŠ¤çš„å·¥ä½œè´Ÿè½½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ambient-mesh-ä¸­çš„èº«ä»½è®¤è¯ä¸æˆæƒ&#34;&gt;Ambient Mesh ä¸­çš„èº«ä»½è®¤è¯ä¸æˆæƒ&lt;/h3&gt;
&lt;p&gt;è¿è¡Œåœ¨æœåŠ¡ç½‘æ ¼ä¸­çš„æ¯ä¸ªå·¥ä½œè´Ÿè½½éƒ½æœ‰ä¸€ä¸ªåŸºäºå‘½åç©ºé—´å’Œ ServiceAccount çš„èº«ä»½ã€‚è¿™äº›èº«ä»½åœ¨ç½‘æ ¼å†…ä¼šè¢«è‡ªåŠ¨éªŒè¯ï¼šè¿™æ˜¯ mTLS æä¾›çš„ç‰¹æ€§ï¼ŒAmbient æ¨¡å¼é»˜è®¤å¯ç”¨ mTLSã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ &lt;code&gt;AuthorizationPolicy&lt;/code&gt; æ¥æ§åˆ¶æµé‡ã€‚æ­¤ç±»ç­–ç•¥æŒ‡å®šç½‘æ ¼ä¸­çš„ç›®æ ‡ï¼Œå¹¶åŒ…å«è§„åˆ™ï¼Œç”¨äºåŸºäºæ¥æºï¼ˆfromï¼‰ã€æ“ä½œï¼ˆtoï¼‰ä»¥åŠæ¡ä»¶ï¼ˆwhenï¼‰æ¥å…è®¸æˆ–æ‹’ç»è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ztunnel&lt;/code&gt; ä»£ç†å§‹ç»ˆå¯ä»¥å¼ºåˆ¶æ‰§è¡Œç­–ç•¥ï¼Œä½†å®ƒåªäº†è§£ L3/L4 å±‚çš„ä¿¡æ¯ï¼ˆå¦‚ä¸»æœºä¸ç«¯å£ï¼‰ï¼›è€Œ &lt;code&gt;waypoint&lt;/code&gt; ä»£ç†è¿˜å¯æ„ŸçŸ¥ L7 ä¿¡æ¯ï¼ˆå¦‚è·¯å¾„ä¸æ–¹æ³•ï¼‰ï¼Œä½†ä¸æ˜¯é»˜è®¤éƒ¨ç½²çš„ã€‚ä¸ºäº†å…¼é¡¾ Ambient æ¨¡å¼çš„ä¼˜åŠ¿ä¸å®‰å…¨æ€§ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºè¿™ä¸¤ç±»ä»£ç†åˆ†åˆ«å®šä¹‰ä¸åŒç²’åº¦çš„ç­–ç•¥ã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿™å¹¶ä¸å¤æ‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸¤ç±»ä¸åŒçš„æˆæƒç­–ç•¥&#34;&gt;ä¸¤ç±»ä¸åŒçš„æˆæƒç­–ç•¥&lt;/h3&gt;
&lt;p&gt;è€ƒè™‘æŸä¸ªéƒ¨ç½²åœ¨ Ambient Mesh ä¸­çš„å·¥ä½œè´Ÿè½½ï¼Œæ²¡æœ‰ä½¿ç”¨ Waypointã€‚è¿™æ—¶ç­–ç•¥åªèƒ½åœ¨æœåŠ¡ç«¯çš„ ztunnel ä¸Šå¼ºåˆ¶æ‰§è¡Œã€‚è€Œ ztunnel æ— æ³•è¯†åˆ« L7 ä¿¡æ¯ï¼Œå› æ­¤åªèƒ½å¼ºåˆ¶ L4 å±‚çš„ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/ambient-mesh-authorization-policy/f1_hu_f3f250e26fe4f503.webp 400w,
               /blog/ambient-mesh-authorization-policy/f1_hu_47cda3e656a287dc.webp 760w,
               /blog/ambient-mesh-authorization-policy/f1_hu_77fdf6cb978db31a.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/ambient-mesh-authorization-policy/f1_hu_f3f250e26fe4f503.webp&#34;
               width=&#34;760&#34;
               height=&#34;316&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“ä½ ä¸ºè¯¥å·¥ä½œè´Ÿè½½&lt;a href=&#34;https://ambientmesh.io/docs/setup/configure-waypoints/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼•å…¥ Waypoint&lt;/a&gt; æ—¶ï¼Œç­–ç•¥å°±å¯ä»¥åœ¨ä¸¤ä¸ªä½ç½®è¢«æ‰§è¡Œï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/ambient-mesh-authorization-policy/f2_hu_42b4867cc14f936e.webp 400w,
               /blog/ambient-mesh-authorization-policy/f2_hu_ee3f68c15aa45293.webp 760w,
               /blog/ambient-mesh-authorization-policy/f2_hu_26d72b1a87811898.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/ambient-mesh-authorization-policy/f2_hu_42b4867cc14f936e.webp&#34;
               width=&#34;760&#34;
               height=&#34;316&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“ç³»ç»Ÿå­˜åœ¨å¤šä¸ªç­–ç•¥æ‰§è¡Œç‚¹æ—¶ï¼Œåº”è¯¥&lt;strong&gt;å§‹ç»ˆåœ¨æœ€æ—©çš„æ‰§è¡Œç‚¹&lt;/strong&gt;ä¸Šåº”ç”¨ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œè‹¥å°†æ‰€æœ‰ç­–ç•¥éƒ½è®¾ç½®åœ¨ Waypoint ä¸Šï¼Œåˆ™ç›´æ¥è®¿é—®å·¥ä½œè´Ÿè½½çš„æµé‡å°†ç»•è¿‡ç­–ç•¥ã€‚è€Œå¯¹äºå…¬å¼€è®¿é—®çš„æœåŠ¡ï¼Œç­–ç•¥å¯èƒ½å·²åœ¨ç½‘å…³å¤„æ‰§è¡Œã€‚ä¸ºäº†é¿å…é‡å¤å¤„ç†ï¼Œ&lt;a href=&#34;https://ambientmesh.io/docs/traffic/gateways/#gateways-and-waypoints&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é»˜è®¤æƒ…å†µä¸‹ Gateway ä¼šç›´æ¥å°†æµé‡è½¬å‘ç»™æœåŠ¡&lt;/a&gt;ï¼Œç»•è¿‡ Waypointã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œæ¨èçš„åšæ³•æ˜¯ï¼šåœ¨ ztunnel ä¸Šå®šä¹‰â€œåŸºç¡€è®¾æ–½ç­–ç•¥â€ï¼Œå¼ºåˆ¶ä½¿ç”¨ Waypointï¼Œç„¶ååœ¨ Waypoint æˆ– Gateway ä¸Šå®šä¹‰â€œåº”ç”¨å±‚ç­–ç•¥â€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç­–ç•¥çš„ä½œç”¨ç›®æ ‡ä¸ç»‘å®š&#34;&gt;ç­–ç•¥çš„ä½œç”¨ç›®æ ‡ä¸ç»‘å®š&lt;/h3&gt;
&lt;p&gt;ä¸Šé¢çš„ç¤ºæ„å›¾æœªæ¶‰åŠå®é™…åœºæ™¯ä¸­å·¥ä½œè´Ÿè½½ä¸ waypoint å®ä¾‹çš„å¤šå‰¯æœ¬æƒ…å†µã€‚æˆ‘ä»¬åœ¨å†™ç­–ç•¥æ—¶ï¼Œéœ€è¦æ˜ç¡®å®ƒçš„ä½œç”¨ç›®æ ‡ï¼šå³å®ƒæ˜¯å¯¹å“ªä¸ªæœåŠ¡æˆ–å·¥ä½œè´Ÿè½½ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;p&gt;Istio ä¼šè‡ªåŠ¨å°†ç­–ç•¥ç»‘å®šåˆ°æ­£ç¡®çš„ä»£ç†ä¸Šï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/ambient-mesh-authorization-policy/f3_hu_72aaf51948e34e94.webp 400w,
               /blog/ambient-mesh-authorization-policy/f3_hu_bc5544521b8c41dc.webp 760w,
               /blog/ambient-mesh-authorization-policy/f3_hu_e1317dbbf2760728.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/ambient-mesh-authorization-policy/f3_hu_72aaf51948e34e94.webp&#34;
               width=&#34;760&#34;
               height=&#34;431&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚æœç­–ç•¥ç”± ztunnel æ‰§è¡Œï¼Œä½ å¯ä»¥é€šè¿‡æŒ‡å®š &lt;code&gt;AuthorizationPolicy&lt;/code&gt; æ‰€åœ¨çš„ namespace å’Œ label selector é€‰æ‹©å…¶ä½œç”¨çš„å·¥ä½œè´Ÿè½½ã€‚è¿™ç±»ä¼¼äº Kubernetes çš„ NetworkPolicyï¼Œæˆ– Istio sidecar æ¨¡å¼ä¸‹çš„ç­–ç•¥ç»‘å®šæ–¹å¼ï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;åº”ç”¨å¯¹è±¡&lt;/th&gt;
          &lt;th&gt;Namespace&lt;/th&gt;
          &lt;th&gt;Selector&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;ç½‘æ ¼ä¸­æ‰€æœ‰å·¥ä½œè´Ÿè½½&lt;/td&gt;
          &lt;td&gt;istio-system&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;default å‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰å·¥ä½œè´Ÿè½½&lt;/td&gt;
          &lt;td&gt;default&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;åŒ¹é…ç‰¹å®šæ ‡ç­¾çš„å·¥ä½œè´Ÿè½½&lt;/td&gt;
          &lt;td&gt;ä»»æ„å‘½åç©ºé—´&lt;/td&gt;
          &lt;td&gt;matchLabels&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è€Œ Waypoint ä½¿ç”¨ Kubernetes Gateway API é…ç½®ï¼Œç­–ç•¥é€šè¿‡ &lt;code&gt;targetRefs&lt;/code&gt; å­—æ®µ&lt;a href=&#34;https://ambientmesh.io/docs/setup/configure-waypoints/#attach-policies-and-routes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç»‘å®šåˆ° Gateway&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆ Waypoint ä½¿ç”¨ä¸åŒçš„ç»‘å®šæ–¹å¼ï¼Ÿ&lt;/strong&gt;
ä½¿ç”¨ä¸åŒçš„ç»‘å®šæ–¹å¼å¯ä»¥æ˜ç¡®åŒºåˆ†ä¸åŒå±‚çº§çš„ç­–ç•¥å«ä¹‰ï¼Œè€Œ &lt;code&gt;targetRefs&lt;/code&gt; éµå¾ªäº† Kubernetes Gateway API çš„è¯­ä¹‰ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å¹¶æœªç›´æ¥ä½¿ç”¨â€œL4 ç­–ç•¥â€æˆ–â€œL7 ç­–ç•¥â€çš„è¯´æ³•ï¼Œå› ä¸º Waypoint ä¹Ÿå¯ä»¥æ‰§è¡Œ L4 ç­–ç•¥ã€‚åæ–‡å°†è¯´æ˜ä¸ºä»€ä¹ˆä½ å¯èƒ½å¸Œæœ›è¿™ä¹ˆåšã€‚&lt;/p&gt;
&lt;h3 id=&#34;è®¿é—®æ§åˆ¶çš„åŸºç¡€&#34;&gt;è®¿é—®æ§åˆ¶çš„åŸºç¡€&lt;/h3&gt;
&lt;p&gt;å¦‚æœæŸä¸ªå·¥ä½œè´Ÿè½½æ²¡æœ‰é…ç½®ä»»ä½•æˆæƒç­–ç•¥ï¼Œåˆ™é»˜è®¤å…è®¸æ‰€æœ‰è®¿é—®ã€‚ä¸€æ—¦å­˜åœ¨è‡³å°‘ä¸€ä¸ªåŒ…å« &lt;code&gt;ALLOW&lt;/code&gt; æ“ä½œçš„ç­–ç•¥ï¼Œåˆ™&lt;strong&gt;æ‰€æœ‰æœªåŒ¹é…ä»»ä½• &lt;code&gt;ALLOW&lt;/code&gt; çš„æµé‡éƒ½ä¼šè¢«æ‹’ç»&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç‚¹éå¸¸é‡è¦ã€‚ä¾‹å¦‚ï¼Œä½ å…è®¸æ¥è‡ª Gateway çš„æµé‡è®¿é—®æŸå·¥ä½œè´Ÿè½½ï¼Œåæ¥å¼•å…¥äº† Waypointï¼Œåˆ™æ¥è‡ª Waypoint çš„æµé‡å°†ä¼šè¢«æ‹’ç»ï¼Œé™¤éä½ æ›´æ–°ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-ztunnel-å¼ºåˆ¶æ‰§è¡Œç­–ç•¥&#34;&gt;ä½¿ç”¨ ztunnel å¼ºåˆ¶æ‰§è¡Œç­–ç•¥&lt;/h3&gt;
&lt;p&gt;åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œä¸éƒ¨ç½² Waypointï¼Œä»…ä½¿ç”¨ Ambient Mesh çš„ &lt;em&gt;å®‰å…¨å åŠ å±‚ï¼ˆsecure overlay layerï¼‰&lt;/em&gt; æ˜¯åˆç†çš„é€‰æ‹©ã€‚Istio çš„ L4 å±æ€§ï¼ˆIPã€ç«¯å£ã€å‘½åç©ºé—´ã€èº«ä»½ä¸»ä½“ï¼‰å³å¯ç”¨äºæˆæƒç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä½¿å¾—æˆ‘ä»¬èƒ½å®ç°æœ€å°æƒé™çš„å¾®åˆ†æ®µï¼šå³ä»…å…è®¸å¿…è¦çš„æœåŠ¡ä¹‹é—´äº’ç›¸é€šä¿¡ã€‚å½“æŸä¸ªæœåŠ¡è¢«æ”»ç ´æ—¶ï¼Œæ”»å‡»æµé‡ä¹Ÿä¼šæºå¸¦å…¶çœŸå®èº«ä»½ã€‚ä¾‹å¦‚ï¼Œå›¾åƒå¤„ç†æœåŠ¡æ— æƒè®¿é—®æ”¯ä»˜æœåŠ¡åç«¯ï¼Œå¯ä»¥è½»æ¾é€šè¿‡ç­–ç•¥é™åˆ¶è¿™ç§è®¿é—®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;éæ³•ç­–ç•¥å±æ€§ä¸æ‹’ç»æµé‡&#34;&gt;éæ³•ç­–ç•¥å±æ€§ä¸æ‹’ç»æµé‡&lt;/h3&gt;
&lt;p&gt;å‰é¢æåˆ°ï¼ŒL4 ç­–ç•¥å±æ€§å¯ä»¥ç”¨äº ztunnel ç»‘å®šçš„ç­–ç•¥ã€‚ä½ ç”šè‡³å¯ä»¥å¤ç”¨ Istio sidecar æ¨¡å¼ä¸‹çš„ç­–ç•¥åˆ° ambient æ¨¡å¼ä¸­ï¼Œå…¶ä¸­å¯èƒ½åŒ…å« L7 å±æ€§ï¼ˆå¦‚ HTTP æ–¹æ³•æˆ–è·¯å¾„ï¼‰ã€‚ä½†ç”±äº ztunnel æ— æ³•è¯†åˆ« L7 å±æ€§ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼š&lt;strong&gt;ztunnel ä¼šå®‰å…¨å¤±è´¥ï¼ˆfail-safeï¼‰&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºåŒ…å« L7 å±æ€§çš„ &lt;code&gt;DENY&lt;/code&gt; ç­–ç•¥ï¼šå¿½ç•¥ L7 éƒ¨åˆ†ï¼Œä»…ä¿ç•™å…¶ä½™éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºåŒ…å« L7 å±æ€§çš„ &lt;code&gt;ALLOW&lt;/code&gt; ç­–ç•¥ï¼šL7 åŒ¹é…è§„åˆ™ä¼šè¢«ç§»é™¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™æ ·åšçš„ç»“æœæ¯”åŸç­–ç•¥æ›´ä¸¥æ ¼ã€‚å› ä¸ºåªè¦æœ‰ &lt;code&gt;ALLOW&lt;/code&gt; ç­–ç•¥å­˜åœ¨ï¼Œæœªè¢«åŒ¹é…çš„æµé‡å°±ä¼šè¢«é»˜è®¤æ‹’ç»ã€‚æ‰€ä»¥æœ€ç»ˆç»“æœæ˜¯ï¼Œæ‰€æœ‰æµé‡éƒ½åŒ¹é…é»˜è®¤æ‹’ç»è§„åˆ™ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¼•å…¥-waypoint-çš„ç­–ç•¥æ‰§è¡Œ&#34;&gt;å¼•å…¥ Waypoint çš„ç­–ç•¥æ‰§è¡Œ&lt;/h3&gt;
&lt;p&gt;ç»‘å®šåœ¨ Waypoint ä¸ ztunnel ä¸Šçš„ç­–ç•¥å­˜åœ¨ä¸¤ä¸ªä¸»è¦åŒºåˆ«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;targetRefs&lt;/code&gt; æ›¿ä»£ selectorï¼›&lt;/li&gt;
&lt;li&gt;æ”¯æŒ L7 å±æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“ä½ å°†æŸä¸ªå·¥ä½œè´Ÿè½½é…ç½®ä¸ºä½¿ç”¨ Waypoint åï¼Œå®ƒå°±æˆä¸ºäº†è¯¥å·¥ä½œè´Ÿè½½æœ€åˆé€‚çš„ç­–ç•¥æ‰§è¡Œä½ç½®ï¼Œå³ä½¿ä»…æ˜¯æ‰§è¡Œ L4 ç­–ç•¥ã€‚åŸå› åœ¨äº Ambient æ¨¡å¼ä¸‹çš„èº«ä»½å·¥ä½œæœºåˆ¶ï¼š&lt;/p&gt;
&lt;p&gt;å·¥ä½œè´Ÿè½½é—´çš„ mTLS é€šä¿¡æ˜¯ç”±ä¸¤ç«¯çš„ ztunnel ç®¡ç†çš„ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/ambient-mesh-authorization-policy/f4_hu_b31bb5181e403d4f.webp 400w,
               /blog/ambient-mesh-authorization-policy/f4_hu_b9a8b9e01cea2b70.webp 760w,
               /blog/ambient-mesh-authorization-policy/f4_hu_5ef274a3335ee58a.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/ambient-mesh-authorization-policy/f4_hu_b31bb5181e403d4f.webp&#34;
               width=&#34;760&#34;
               height=&#34;161&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®© Waypoint èƒ½å¤Ÿè§£å¯†å’Œæ£€æŸ¥æµé‡ï¼Œå®ƒå¿…é¡»ç»ˆæ­¢åŸæœ‰çš„ mTLSï¼Œé‡æ–°å‘èµ·ä¸€æ¬¡è¿æ¥ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/ambient-mesh-authorization-policy/f5_hu_bddfcbe26157fcf.webp 400w,
               /blog/ambient-mesh-authorization-policy/f5_hu_393ba6007e31457f.webp 760w,
               /blog/ambient-mesh-authorization-policy/f5_hu_800904b04429a1ce.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/ambient-mesh-authorization-policy/f5_hu_bddfcbe26157fcf.webp&#34;
               width=&#34;760&#34;
               height=&#34;161&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™æ„å‘³ç€ï¼ŒæœåŠ¡å™¨ç«¯ ztunnel æ‰€è§åˆ°çš„æºèº«ä»½æ˜¯ &lt;strong&gt;Waypoint çš„èº«ä»½&lt;/strong&gt;ï¼Œè€ŒéåŸå§‹å®¢æˆ·ç«¯ã€‚å¦‚æœä½ å¸Œæœ›æ ¹æ®çœŸå®æºèº«ä»½åšå‡ºç­–ç•¥åˆ¤æ–­ï¼Œç­–ç•¥åº”éƒ¨ç½²åœ¨ Waypoint ä¸Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;åªå…è®¸æ¥è‡ª-waypoint-çš„è¿æ¥&#34;&gt;åªå…è®¸æ¥è‡ª Waypoint çš„è¿æ¥&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†ç¡®ä¿ç­–ç•¥çœŸæ­£é€šè¿‡ Waypoint æ‰§è¡Œï¼Œå¿…é¡»é˜²æ­¢æµé‡ç»•è¿‡ Waypointã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒAmbient Mesh ä¼šè‡ªåŠ¨å°†æœåŠ¡æµé‡è·¯ç”±åˆ° Waypointï¼Œä½†æœåŠ¡ç«¯çš„ ztunnel ä»æ¥å—æ¥è‡ªä»»ä½•å®¢æˆ·ç«¯çš„è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;æŸäº›åœºæ™¯ä¸‹è¿™æ²¡é—®é¢˜ï¼Œæ¯”å¦‚ Prometheus é‡‡é›†æŸä¸ª Pod çš„ metricsï¼Œé€šå¸¸æ˜¯ç›´æ¥è¿æ¥ï¼Œè€Œä¸ç»è¿‡ Waypointã€‚&lt;/p&gt;
&lt;p&gt;è‹¥ä½ éœ€è¦é˜»æ­¢å…¶ä»–æµé‡ï¼Œåº”åœ¨ ztunnel ä¸Šå®šä¹‰ç­–ç•¥ï¼Œåª&lt;a href=&#34;https://ambientmesh.io/docs/security/waypoint-authz/#restricting-workloads-to-only-accept-traffic-from-waypoints&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…è®¸æ¥è‡ªæŒ‡å®š Waypoint çš„è¿æ¥&lt;/a&gt;ã€‚å¿…è¦æ—¶å¯&lt;a href=&#34;https://ambientmesh.io/docs/security/waypoint-authz/#exceptions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·»åŠ ä¾‹å¤–&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio ç¤¾åŒºå…¬å¸ƒ ztunnel å®‰å…¨å®¡è®¡ç»“æœï¼Œé›¶ä¿¡ä»»é€šé“é€šè¿‡ä¸¥æ ¼è€ƒéªŒ</title>
      <link>https://cloudnativecn.com/blog/ztunnel-security-audit/</link>
      <pubDate>Mon, 21 Apr 2025 10:31:26 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/ztunnel-security-audit/</guid>
      <description>&lt;p&gt;è¿‘æ—¥ï¼ŒIstio é¡¹ç›®å®‰å…¨å·¥ä½œç»„æ­£å¼å‘å¸ƒäº†å…¶ Ambient æ¨¡å¼æ ¸å¿ƒç»„ä»¶ &lt;a href=&#34;https://istio.io/latest/blog/2025/ztunnel-security-assessment/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ztunnel çš„å®‰å…¨å®¡è®¡æŠ¥å‘Š&lt;/a&gt;ï¼Œç»“æœä»¤äººæŒ¯å¥‹ï¼š&lt;strong&gt;ä»£ç æœªå‘ç°ä»»ä½•æ¼æ´ï¼Œå®¡è®¡ç»“æœä¸ºâ€œé«˜åº¦å¯ä¿¡â€&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ztunnel æ˜¯ Istio åœ¨ Ambient æ¨¡å¼ä¸‹ç”¨äºæ„å»ºé›¶ä¿¡ä»»ç½‘ç»œçš„æ–°å‹è½»é‡çº§æ•°æ®å¹³é¢ç»„ä»¶ï¼Œç”± Rust ç¼–å†™ï¼Œæ—¨åœ¨æä¾›æ›´é«˜æ€§èƒ½ã€æ›´æ˜“éƒ¨ç½²çš„ L4 è¿æ¥å®‰å…¨èƒ½åŠ›ã€‚æ­¤å‰ï¼ŒIstio å·²å±•ç¤ºäº† ztunnel åœ¨æ€§èƒ½æ–¹é¢çš„å“è¶Šè¡¨ç°ï¼Œ&lt;strong&gt;å…¶ TCP ååé‡ç”šè‡³è¶…è¿‡å†…æ ¸çº§æ–¹æ¡ˆ IPsec å’Œ WireGuard&lt;/strong&gt;ï¼Œå¹¶åœ¨è¿‡å»å››ä¸ªç‰ˆæœ¬ä¸­æ€§èƒ½æå‡é«˜è¾¾ 75%ã€‚è€Œæœ¬æ¬¡å®‰å…¨å®¡è®¡ï¼Œåˆ™è¿›ä¸€æ­¥å°è¯äº†å…¶åœ¨å®‰å…¨æ€§æ–¹é¢çš„å¯ç”¨æ€§ä¸ç¨³å®šæ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸‰æ–¹å®¡è®¡æœºæ„ç¡®è®¤ä»£ç å®‰å…¨å¯é &#34;&gt;ä¸‰æ–¹å®¡è®¡æœºæ„ç¡®è®¤ä»£ç å®‰å…¨å¯é &lt;/h2&gt;
&lt;p&gt;æ­¤æ¬¡å®¡è®¡ç”±çŸ¥åå®‰å…¨å…¬å¸ &lt;a href=&#34;https://www.trailofbits.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Trail of Bits&lt;/a&gt; æ‰§è¡Œï¼Œå®¡è®¡å†…å®¹è¦†ç›–äº† ztunnel çš„ L4 æˆæƒã€TLS ä¼ è¾“å®‰å…¨ã€è¯ä¹¦ç®¡ç†ã€å…¥ç«™ä»£ç†ç­‰å…³é”®è·¯å¾„ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ¬¡å®¡è®¡èšç„¦äº Ambient æ¨¡å¼ä¸­æ–°å¼•å…¥çš„ Rust ä»£ç ï¼Œå¹¶æœªé‡å¤å®¡æŸ¥å·²æ¥å—è¿‡å¤šæ¬¡å®¡è®¡çš„ Envoy æœ¬ä½“éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;å®¡è®¡æŠ¥å‘Šæ˜ç¡®æŒ‡å‡ºï¼š&lt;strong&gt;â€œztunnel ä»£ç ç»“æ„è‰¯å¥½ï¼Œæœªå‘ç°ä»»ä½•æ¼æ´ã€‚â€&lt;/strong&gt; ä¸‰é¡¹å®¡è®¡æ„è§ä¸­ï¼Œä»…æœ‰ä¸€é¡¹ä¸­ç­‰çº§åˆ«é—®é¢˜ï¼Œå…¶ä»–ä¸ºä¿¡æ¯ç±»å»ºè®®ï¼Œä¸”å‡ä¸ä¾èµ–é¡¹ç®¡ç†å’Œæµ‹è¯•ç­–ç•¥ç›¸å…³ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡å®¡è®¡å·¥ä½œç”± &lt;a href=&#34;https://www.cncf.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNCF åŸºé‡‘ä¼š&lt;/a&gt; æä¾›èµ„åŠ©ï¼Œ&lt;a href=&#34;https://ostif.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OSTIF&lt;/a&gt; åè°ƒæ‰§è¡Œã€‚è¿™ä¹Ÿä½“ç°å‡º Istio ç¤¾åŒºåœ¨å®‰å…¨æ–¹é¢çš„å¼€æ”¾æ€åº¦å’ŒæŒç»­æŠ•å…¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰å…¨å»ºè®®ä¸æ”¹è¿›æªæ–½&#34;&gt;å®‰å…¨å»ºè®®ä¸æ”¹è¿›æªæ–½&lt;/h2&gt;
&lt;h3 id=&#34;å¼•å…¥è‡ªåŠ¨åŒ–ä¾èµ–ç®¡ç†å·¥å…·&#34;&gt;å¼•å…¥è‡ªåŠ¨åŒ–ä¾èµ–ç®¡ç†å·¥å…·&lt;/h3&gt;
&lt;p&gt;å®¡è®¡æœŸé—´ï¼Œztunnel çš„ä¾èµ–é¡¹ä¸­å­˜åœ¨ä¸‰é¡¹å·²çŸ¥å®‰å…¨é€šæŠ¥çš„åº“ç‰ˆæœ¬ï¼Œå°½ç®¡ä¸ä¼šç›´æ¥è§¦å‘æ¼æ´ï¼Œä½†ç¤¾åŒºä»é‡‡å–ä¸»åŠ¨å“åº”ï¼Œ&lt;strong&gt;å¼•å…¥ GitHub Dependabot è‡ªåŠ¨æ›´æ–°ä¾èµ–é¡¹&lt;/strong&gt;ï¼Œå¹¶æ›¿æ¢äº†ä¸¤é¡¹ç»´æŠ¤çŠ¶æ€ä¸ä½³çš„ Rust cratesã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŠ å¼ºå¼‚å¸¸è·¯å¾„æµ‹è¯•è¦†ç›–&#34;&gt;åŠ å¼ºå¼‚å¸¸è·¯å¾„æµ‹è¯•è¦†ç›–&lt;/h3&gt;
&lt;p&gt;Trail of Bits æŒ‡å‡ºéƒ¨åˆ†å¼‚å¸¸å¤„ç†è·¯å¾„æœªæ¶µç›–åœ¨ç°æœ‰æµ‹è¯•ä¸­ã€‚Istio ç¤¾åŒºå›åº”ç§°ï¼Œè¿™äº›è·¯å¾„å¤šä¸ºéå…³é”®é€»è¾‘ï¼Œå¦‚æ—¥å¿—è¡Œä¸ºæˆ–æ€§èƒ½è·¯å¾„ï¼Œ&lt;strong&gt;å°†é€šè¿‡ mutation testing ä¸æ–°å‹æµ‹è¯•æœºåˆ¶æŒç»­å®Œå–„æµ‹è¯•è¦†ç›–&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è‡ªç ”-header-è§£æå™¨æå‡å¥å£®æ€§&#34;&gt;è‡ªç ” Header è§£æå™¨æå‡å¥å£®æ€§&lt;/h3&gt;
&lt;p&gt;ztunnel åŸå…ˆä½¿ç”¨çš„ HTTP &lt;code&gt;Forwarded&lt;/code&gt; header è§£æåº“æœªç»è¿‡ fuzz æµ‹è¯•ã€‚ç¤¾åŒºä¸ºæ­¤ &lt;strong&gt;ä¸“é—¨å¼€å‘äº†å®šåˆ¶åŒ–è§£æå™¨ï¼Œå¹¶å¼•å…¥ fuzzing æµ‹è¯•æœºåˆ¶&lt;/strong&gt;ï¼Œç¡®ä¿ Header è§£æçš„å®‰å…¨æ€§ä¸ç¨³å®šæ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼è¿ˆå…¥æ›´å®‰å…¨çš„æœªæ¥&#34;&gt;äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼è¿ˆå…¥æ›´å®‰å…¨çš„æœªæ¥&lt;/h2&gt;
&lt;p&gt;ztunnel æ˜¯ Istio ç¤¾åŒºæ‹¥æŠ± Rust å®‰å…¨ç”Ÿæ€ã€æ„å»ºå¯æ’æ‹”æ•°æ®é¢æ¶æ„çš„é‡è¦ä¸€æ­¥ã€‚å…¶ç®€åŒ–çš„éƒ¨ç½²æ¨¡å¼ã€å“è¶Šçš„æ€§èƒ½è¡¨ç°ï¼Œä»¥åŠç»å—å®¡è®¡éªŒè¯çš„å®‰å…¨æ€§ï¼Œæ­£åœ¨ä¸º Istio Ambient æ¨¡å¼é“ºè®¾åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;éšç€ç¤¾åŒºå¯¹é›¶ä¿¡ä»»æ¶æ„ã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨å¯è§‚æµ‹ç­‰ç»´åº¦çš„æŒç»­æ‰“ç£¨ï¼Œ&lt;strong&gt;ztunnel å°†æˆä¸º Kubernetes äº‘åŸç”Ÿç½‘ç»œä¸­å€¼å¾—ä¿¡èµ–çš„é€šç”¨å®‰å…¨å…¥å£ç»„ä»¶&lt;/strong&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio åœ¨ GKE ä¸Šçš„æ— ç¼ TLS ä½“éªŒï¼šä½¿ç”¨è‡ªå®šä¹‰ Admission Controller è‡ªåŠ¨ç­¾å‘è¯ä¹¦</title>
      <link>https://cloudnativecn.com/blog/seamless-tls-istio-gke-auto-provision-certificates/</link>
      <pubDate>Thu, 10 Apr 2025 20:54:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/seamless-tls-istio-gke-auto-provision-certificates/</guid>
      <description>&lt;p&gt;Istio å·²ç»æˆä¸º Kubernetes ä¸­æœåŠ¡é—´é€šä¿¡ç®¡ç†çš„äº‹å®æ ‡å‡†ï¼Œæä¾›äº†å¼ºå¤§çš„æµé‡æ²»ç†ã€å®‰å…¨é˜²æŠ¤å’Œå¯è§‚æµ‹æ€§èƒ½åŠ›ã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬åœ¨ &lt;strong&gt;Google Kubernetes Engine (GKE)&lt;/strong&gt; ä¸Šé€šè¿‡ Istio Gateway æš´éœ²æœåŠ¡æ—¶ï¼ŒTLS è¯ä¹¦çš„ç®¡ç†ä»ç„¶æ˜¯ä¸€é¡¹æŒ‘æˆ˜ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡ &lt;strong&gt;cert-manager&lt;/strong&gt; åœ¨ Kubernetes ä¸­ç®€åŒ–äº†è¯ä¹¦çš„ç­¾å‘è¿‡ç¨‹ï¼Œä½†ç›®å‰å®ƒå¹¶ä¸æ”¯æŒåŸºäºæ³¨è§£è‡ªåŠ¨ä¸º Istio Gateway ç­¾å‘è¯ä¹¦ã€‚è¿™ä½¿å¾—ç”¨æˆ·éœ€è¦æ‰‹åŠ¨åˆ›å»º &lt;code&gt;Certificate&lt;/code&gt; å’Œ &lt;code&gt;Issuer&lt;/code&gt; ç­‰èµ„æºï¼Œä¸ä»…ç¹çï¼Œè¿˜å®¹æ˜“äº§ç”Ÿé…ç½®ä¸ä¸€è‡´ï¼Œå¢åŠ äº†è¿ç»´è´Ÿæ‹…ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¡«è¡¥è¿™ä¸€ç©ºç¼ºï¼Œæœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäº &lt;strong&gt;Kubernetes Admission Controller&lt;/strong&gt; çš„è‡ªåŠ¨åŒ–æ–¹æ¡ˆï¼Œå®ç°è¯ä¹¦çš„è‡ªåŠ¨ç­¾å‘ä¸æ³¨å…¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;gke-ç”¨æˆ·ä¸ºä½•éœ€è¦å…³æ³¨&#34;&gt;GKE ç”¨æˆ·ä¸ºä½•éœ€è¦å…³æ³¨ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å¯¹äºåœ¨ GKE ä¸Šè¿è¡Œ Istio çš„å›¢é˜Ÿè€Œè¨€ï¼Œå°¤å…¶æ˜¯åœ¨å¤§è§„æ¨¡å¤šå¾®æœåŠ¡åœºæ™¯ä¸‹ï¼Œæ‰‹åŠ¨ç®¡ç†è¯ä¹¦æ•ˆç‡ä½ä¸‹ã€‚è™½ç„¶ GKE æ”¯æŒ Google æ‰˜ç®¡è¯ä¹¦ï¼Œä½†å‡ºäºçµæ´»æ€§å’Œå¯¹å¤šç§ CA æ”¯æŒçš„è€ƒè™‘ï¼Œè®¸å¤šå›¢é˜Ÿä¾ç„¶å€¾å‘äºä½¿ç”¨ &lt;strong&gt;cert-manager&lt;/strong&gt;ã€‚æœ¬æ–‡ä»‹ç»çš„è§£å†³æ–¹æ¡ˆï¼Œæ­£æ˜¯ä¸ºäº†è®© cert-manager èƒ½æ— ç¼ä¸ Istio Gateway é›†æˆï¼Œåœ¨ä¿æŒå®‰å…¨æ€§ä¸å¯é æ€§çš„å‰æä¸‹ï¼Œå®ç°è‡ªåŠ¨åŒ–è¯ä¹¦ç®¡ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æŠ€æœ¯æ ˆ&#34;&gt;æŠ€æœ¯æ ˆ&lt;/h2&gt;
&lt;p&gt;Admission Controller é‡‡ç”¨ä»¥ä¸‹æŠ€æœ¯å®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;FastAPI&lt;/strong&gt;ï¼šé«˜æ€§èƒ½ Python Web æ¡†æ¶ï¼Œä½œä¸º Webhook æœåŠ¡çš„ä¸»å¹²ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Uvicorn&lt;/strong&gt;ï¼šè½»é‡çº§ ASGI æœåŠ¡å™¨ï¼Œç”¨äºéƒ¨ç½² FastAPI åº”ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kubernetes Python SDK&lt;/strong&gt;ï¼šç”¨äºä¸ K8s API äº¤äº’ï¼ŒåŠ¨æ€åˆ›å»ºè¯ä¹¦èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Docker&lt;/strong&gt;ï¼šç”¨äºå®¹å™¨åŒ– webhook æœåŠ¡ï¼Œæ–¹ä¾¿éƒ¨ç½²ä¸äº¤ä»˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Google Kubernetes Engine (GKE)&lt;/strong&gt;ï¼šæ§åˆ¶å™¨çš„è¿è¡Œå¹³å°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¡¹ç›®åœ°å€ï¼š&lt;a href=&#34;https://github.com/Sayed-Imran/istio-cert-manager-webhook&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio-Cert Admission Controller&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è¿›å…¥å…·ä½“å®ç°å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ Kubernetes ä¸­çš„ webhook æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-admission-webhookéªŒè¯ä¸ä¿®æ”¹&#34;&gt;Kubernetes Admission Webhookï¼šéªŒè¯ä¸ä¿®æ”¹&lt;/h2&gt;
&lt;p&gt;Admission Webhook å¯æ‹¦æˆª Kubernetes API è¯·æ±‚ï¼Œåœ¨èµ„æºè½åº“å‰è¿›è¡Œæ ¡éªŒæˆ–ä¿®æ”¹ï¼Œæ˜¯å®ç°ç­–ç•¥æ§åˆ¶ä¸è‡ªåŠ¨åŒ–çš„å…³é”®æœºåˆ¶ã€‚Kubernetes æ”¯æŒä¸¤ç§ä¸»è¦ç±»å‹çš„ Webhookï¼š&lt;/p&gt;
&lt;h3 id=&#34;1-validating-webhookéªŒè¯å‹&#34;&gt;1. Validating Webhookï¼ˆéªŒè¯å‹ï¼‰&lt;/h3&gt;
&lt;p&gt;ç”¨äºåœ¨èµ„æºåˆ›å»ºæˆ–ä¿®æ”¹å‰è¿›è¡Œæ ¡éªŒï¼Œè‹¥ä¸ç¬¦åˆé¢„æœŸè§„èŒƒå¯ç›´æ¥æ‹’ç»è¯¥è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;ï¼šæ ¡éªŒæ¯ä¸ª Istio Gateway æ˜¯å¦åŒ…å«åˆæ³•çš„ &lt;code&gt;host&lt;/code&gt; å­—æ®µã€‚&lt;/p&gt;
&lt;h3 id=&#34;2-mutating-webhookå˜æ›´å‹&#34;&gt;2. Mutating Webhookï¼ˆå˜æ›´å‹ï¼‰&lt;/h3&gt;
&lt;p&gt;å¯å¯¹èµ„æºè¿›è¡Œä¿®æ”¹ï¼Œå¦‚æ³¨å…¥é»˜è®¤å€¼æˆ–è‡ªåŠ¨æ·»åŠ æ³¨è§£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;ï¼šä¸º Istio Gateway è‡ªåŠ¨æ·»åŠ  &lt;code&gt;cert-manager.io/issuer&lt;/code&gt; æ³¨è§£ï¼Œè§¦å‘è¯ä¹¦è‡ªåŠ¨ç­¾å‘ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å®ç°çš„æ˜¯ä¸€ä¸ª &lt;strong&gt;Validating Webhook&lt;/strong&gt;ï¼Œå®ƒä¸ä»…æ ¡éªŒ &lt;code&gt;issuer&lt;/code&gt; æ˜¯å¦å­˜åœ¨ï¼Œè¿˜åœ¨æ¡ä»¶æ»¡è¶³æ—¶è‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„ &lt;code&gt;Certificate&lt;/code&gt; èµ„æºï¼›è‹¥ &lt;code&gt;issuer&lt;/code&gt; ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥æ‹’ç»è¯·æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¶æ„è®¾è®¡æ¦‚è§ˆ&#34;&gt;æ¶æ„è®¾è®¡æ¦‚è§ˆ&lt;/h2&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ¶æ„è®¾è®¡æ¦‚è§ˆ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ¶æ„è®¾è®¡æ¦‚è§ˆ&#34; srcset=&#34;
               /blog/seamless-tls-istio-gke-auto-provision-certificates/f1_hu_255245216eca8bdd.webp 400w,
               /blog/seamless-tls-istio-gke-auto-provision-certificates/f1_hu_31571d28025b985d.webp 760w,
               /blog/seamless-tls-istio-gke-auto-provision-certificates/f1_hu_88319f3b00eedee8.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/seamless-tls-istio-gke-auto-provision-certificates/f1_hu_255245216eca8bdd.webp&#34;
               width=&#34;760&#34;
               height=&#34;124&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ¶æ„è®¾è®¡æ¦‚è§ˆ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Admission Controller ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªå±‚æ¬¡ï¼š&lt;/p&gt;
&lt;h3 id=&#34;api-å±‚&#34;&gt;&lt;strong&gt;API å±‚&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;è´Ÿè´£æ¥æ”¶æ¥è‡ª K8s API Server çš„ AdmissionReview è¯·æ±‚ï¼Œæå– JSON Payload å¹¶è½¬äº¤ç»™ Handler å±‚è¿›è¡Œå¤„ç†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;handler-å±‚&#34;&gt;&lt;strong&gt;Handler å±‚&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;æ ¸å¿ƒæ ¡éªŒé€»è¾‘æ‰€åœ¨ï¼Œåˆ¤æ–­ Istio Gateway æ˜¯å¦åŒ…å«ä»¥ä¸‹æ³¨è§£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;cert-manager.io/issuer&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cert-manager.io/cluster-issuer&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;åœºæ™¯-1æœªåŒ…å«æ³¨è§£&#34;&gt;åœºæ™¯ 1ï¼šæœªåŒ…å«æ³¨è§£&lt;/h4&gt;
&lt;p&gt;ç›´æ¥è¿”å›å…è®¸å“åº”ï¼ˆ&lt;code&gt;allowed: true&lt;/code&gt;ï¼‰ï¼Œè·³è¿‡è¿›ä¸€æ­¥å¤„ç†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;apiVersion&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;admission.k8s.io/v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;kind&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;AdmissionReview&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;response&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;allowed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;uid&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;xxx-xxx&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;message&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Validation passed&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼šè¿”å›å“åº”çš„ &lt;code&gt;uid&lt;/code&gt; å­—æ®µå¿…é¡»ä¸è¯·æ±‚ä¸­çš„å®Œå…¨ä¸€è‡´ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h4 id=&#34;åœºæ™¯-2åŒ…å«æ³¨è§£&#34;&gt;åœºæ™¯ 2ï¼šåŒ…å«æ³¨è§£&lt;/h4&gt;
&lt;p&gt;Webhook ä¼šè¿›ä¸€æ­¥æŸ¥è¯¢æŒ‡å®šçš„ &lt;code&gt;Issuer&lt;/code&gt; æˆ– &lt;code&gt;ClusterIssuer&lt;/code&gt; æ˜¯å¦å­˜åœ¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥å­˜åœ¨ï¼šæ”¾è¡Œè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥ä¸å­˜åœ¨ï¼šè¿”å› &lt;code&gt;allowed: false&lt;/code&gt;ï¼Œå¹¶æç¤ºè¯¥ Issuer ä¸å­˜åœ¨ï¼Œé˜²æ­¢é”™è¯¯å¼•ç”¨å¯¼è‡´è¯ä¹¦æ— æ³•ç”Ÿæˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸€æœºåˆ¶ç¡®ä¿äº† Gateway ä¸ä¼šå¼•ç”¨ä¸å­˜åœ¨çš„ CAï¼Œæé«˜é…ç½®å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-å·¥å…·å±‚å®ç°è¯ä¹¦è‡ªåŠ¨åˆ›å»º&#34;&gt;Kubernetes å·¥å…·å±‚ï¼šå®ç°è¯ä¹¦è‡ªåŠ¨åˆ›å»º&lt;/h2&gt;
&lt;p&gt;ä¸åŒäºä¼ ç»Ÿ webhook ä»…éªŒè¯è¯·æ±‚ï¼Œè¯¥å±‚è¿›ä¸€æ­¥å®ç°äº† &lt;strong&gt;èµ„æºåˆ›å»ºåŠŸèƒ½&lt;/strong&gt;ã€‚ä¸€æ—¦æ ¡éªŒé€šè¿‡ï¼Œå°†è‡ªåŠ¨åˆ›å»º &lt;code&gt;Certificate&lt;/code&gt; èµ„æºï¼Œå¹¶é…ç½®ä»¥ä¸‹ç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æ®æ³¨è§£è®¾å®š &lt;code&gt;issuerRef&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒæ³¨è§£é…ç½®æœ‰æ•ˆæœŸï¼ˆ&lt;code&gt;duration&lt;/code&gt;ï¼‰ã€ç»­æœŸæ—¶é—´ï¼ˆ&lt;code&gt;renewBefore&lt;/code&gt;ï¼‰ç­‰å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨æ³¨å…¥ &lt;code&gt;ownerReference&lt;/code&gt;ï¼Œç»‘å®šåˆ°åŸå§‹ Gateway å¯¹è±¡ä¸Šï¼Œå®ç°ç”Ÿå‘½å‘¨æœŸè”åŠ¨ï¼Œå½“ Gateway åˆ é™¤æ—¶è‡ªåŠ¨æ¸…ç†è¯ä¹¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡è¿™ä¸€æœºåˆ¶ï¼ŒåŸæœ¬ç¹ççš„è¯ä¹¦é…ç½®è¿‡ç¨‹è¢«è‡ªåŠ¨åŒ–å¤„ç†ï¼Œæå¤§å‡å°‘äººä¸ºé”™è¯¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ— éœ€æ‰‹åŠ¨åˆ›å»º Gateway åå†æ‰‹åŠ¨ç”Ÿæˆè¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;ä¸éœ€æ‰‹åŠ¨å¡«å†™å„ç§å…ƒæ•°æ®æˆ–ç»´æŠ¤å¼•ç”¨å…³ç³»ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ä¸-kubernetes-å¯¹æ¥æ³¨å†Œ-validatingwebhookconfiguration&#34;&gt;ä¸ Kubernetes å¯¹æ¥ï¼šæ³¨å†Œ ValidatingWebhookConfiguration&lt;/h2&gt;
&lt;p&gt;æœ€åä¸€æ­¥æ˜¯å°† Admission Controller æ³¨å†Œä¸º Kubernetes çš„ Validating Webhookï¼Œé…ç½®æ‹¦æˆªå“ªäº›æ“ä½œã€‚å…·ä½“è®¾ç½®ä¸ºç›‘å¬å¯¹ Istio Gateway çš„ &lt;code&gt;CREATE&lt;/code&gt; ä¸ &lt;code&gt;UPDATE&lt;/code&gt; æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;ç¤ºæ„é…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ç¤ºæ„é…ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;ç¤ºæ„é…ç½®&#34; srcset=&#34;
               /blog/seamless-tls-istio-gke-auto-provision-certificates/f2_hu_f7a7c4060929076b.webp 400w,
               /blog/seamless-tls-istio-gke-auto-provision-certificates/f2_hu_d5b9a636b9ca349a.webp 760w,
               /blog/seamless-tls-istio-gke-auto-provision-certificates/f2_hu_b055a87c55dad578.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/seamless-tls-istio-gke-auto-provision-certificates/f2_hu_f7a7c4060929076b.webp&#34;
               width=&#34;523&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      ç¤ºæ„é…ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼šWebhook æœåŠ¡å¿…é¡»é€šè¿‡ HTTPS æä¾›æœåŠ¡ï¼ŒK8s API Server ä»…æ”¯æŒåŠ å¯†é€šä¿¡ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;é€šè¿‡æ‰©å±•ä¼ ç»Ÿ Admission Controller çš„åŠŸèƒ½ï¼Œå®ç°äº†ä¸ Istio Gateway ç´§å¯†é›†æˆçš„ TLS è‡ªåŠ¨ç­¾å‘æ–¹æ¡ˆã€‚å®ƒå…¼å…·è‡ªåŠ¨åŒ–ä¸ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ï¼Œä¸ä»…æå‡äº†é…ç½®ä¸€è‡´æ€§ï¼Œä¹Ÿå‡å°‘äº†è¯ä¹¦ç®¡ç†çš„å¤æ‚æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡æ­¤æ–¹æ¡ˆä¸»è¦é¢å‘ Istio + cert-managerï¼Œä½†è¯¥æ¨¡å¼ä¹Ÿé€‚ç”¨äºå…¶ä»–èµ„æºçš„è‡ªåŠ¨åˆ›å»ºä¸æ²»ç†åœºæ™¯ã€‚åªéœ€ç»“åˆåˆç†çš„æ ¡éªŒé€»è¾‘ã€èµ„æºç»‘å®šç­–ç•¥ä¸å®‰å…¨æœºåˆ¶ï¼ŒAdmission Controller å°±èƒ½æˆä¸º Kubernetes ä¸­å¼ºå¤§çš„è‡ªåŠ¨åŒ–åˆ©å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ å¯¹äº‘åŸç”Ÿå®‰å…¨æ²»ç†ã€è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†æˆ– Istio Gateway çš„è‡ªåŠ¨åŒ–æ„Ÿå…´è¶£ï¼Œå¯ä»¥è¿›ä¸€æ­¥å‚è€ƒé¡¹ç›®ä»£ç å¹¶è¿›è¡Œå®è·µéƒ¨ç½²ï¼šhttps://github.com/Sayed-Imran/istio-cert-manager-webhook&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio Egress Gateway ç®€åŒ–æŒ‡å—</title>
      <link>https://cloudnativecn.com/blog/egress-gateway-made-easy/</link>
      <pubDate>Wed, 09 Apr 2025 11:15:24 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/egress-gateway-made-easy/</guid>
      <description>&lt;p&gt;å¤šå¹´æ¥ï¼ŒIstio ä¸€ç›´æä¾›ä¸€ç§å¯é€‰æ–¹æ¡ˆæ¥éƒ¨ç½² â€œ&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/egress/egress-gateway/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Egress Gateway&lt;/a&gt;â€ï¼Œè¿™æ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§çš„æœºåˆ¶ï¼Œå¯å°†å‡ºç«™æµé‡ç»ç”±ä¸€ä¸ª Gateway ç»Ÿä¸€è½¬å‘ï¼Œä»¥ä¾¿å¯¹å…¶å®æ–½å„ç±»ç­–ç•¥ï¼ŒåŒ…æ‹¬æˆæƒã€å®¡è®¡ã€å¯è§‚æµ‹æ€§ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡åŠŸèƒ½å¼ºå¤§ï¼Œä½†é•¿æœŸä»¥æ¥ï¼Œè®¾ç½® egress gateway ä¸€ç›´ç›¸å½“å¤æ‚ã€‚å³ä¾¿åªæ˜¯æœ€åŸºæœ¬çš„åœºæ™¯ï¼šå°†æ¥è‡ªç‰¹å®šåŸŸåçš„æµé‡é€šè¿‡ egress gateway è½¬å‘ï¼Œéƒ½éœ€è¦å…ˆåé…ç½® 5 ä¸ªä¸åŒçš„ Istio å¯¹è±¡ï¼ˆå‚è§ &lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/egress/egress-gateway/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ï¼‰ï¼Œæ›´ä¸ç”¨è¯´åç»­è¿˜è¦ä¸ºæµé‡æ·»åŠ å„ç§é«˜çº§ç­–ç•¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;å‡­å€Ÿ Istio çš„ Ambient æ¨¡å¼ä¸ Gloo Meshï¼Œç°åœ¨é…ç½® egress gateway çš„è¿‡ç¨‹å˜å¾—æ›´åŠ è½»æ¾ï¼ŒåŒæ—¶è¿˜èƒ½ä¸ºç½‘æ ¼ä¸­çš„æµé‡æä¾›æ›´ä¼˜çš„åŠŸèƒ½ä¸ç®¡ç†ã€‚è®©æˆ‘ä»¬åœ¨è¿™ç¯‡åšå®¢ä¸­æ·±å…¥æ¢è®¨ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾ç‰‡-1ä¸ºæ¯ä¸ªç›®çš„åœ°é…ç½®-egress-gateway-æ‰€éœ€çš„å¯¹è±¡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ç‰‡ 1ï¼šä¸ºæ¯ä¸ªç›®çš„åœ°é…ç½® Egress Gateway æ‰€éœ€çš„å¯¹è±¡&#34; srcset=&#34;
               /blog/egress-gateway-made-easy/6724f6a4cde1d33ee0765206_Egress-1-2048x548_hu_8eba11926a05a3a5.webp 400w,
               /blog/egress-gateway-made-easy/6724f6a4cde1d33ee0765206_Egress-1-2048x548_hu_1cc2b3daa610be01.webp 760w,
               /blog/egress-gateway-made-easy/6724f6a4cde1d33ee0765206_Egress-1-2048x548_hu_28536b1e89091148.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/egress-gateway-made-easy/6724f6a4cde1d33ee0765206_Egress-1-2048x548_hu_8eba11926a05a3a5.webp&#34;
               width=&#34;760&#34;
               height=&#34;203&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ç‰‡ 1ï¼šä¸ºæ¯ä¸ªç›®çš„åœ°é…ç½® Egress Gateway æ‰€éœ€çš„å¯¹è±¡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;istio-ambient-æ¨¡å¼ä¸-gloo-mesh-å¸¦æ¥çš„ç®€åŒ–&#34;&gt;Istio Ambient æ¨¡å¼ä¸ Gloo Mesh å¸¦æ¥çš„ç®€åŒ–&lt;/h2&gt;
&lt;p&gt;å€ŸåŠ© &lt;a href=&#34;https://www.solo.io/blog/istio-ambient-revolution/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambient æ¨¡å¼&lt;/a&gt;ï¼Œç®¡ç† egress æµé‡å˜å¾—éå¸¸è½»æ¾ã€‚åœ¨ Ambient æ¨¡å¼ä¸‹ï¼Œä¸å†ä½¿ç”¨ä¼ ç»Ÿçš„ Sidecar ä»£ç†ï¼Œè€Œæ˜¯ä½¿ç”¨ç‹¬ç«‹éƒ¨ç½²çš„ â€œwaypointâ€ ä»£ç†æ¥ä»£ç†æœåŠ¡çš„æµé‡ã€‚æ•´ä½“ç¤ºæ„å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-wayproxy&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Wayproxy&#34; srcset=&#34;
               /blog/egress-gateway-made-easy/6724f6cb94d57f82bf0548d5_Egress-2_hu_1177a52740960df4.webp 400w,
               /blog/egress-gateway-made-easy/6724f6cb94d57f82bf0548d5_Egress-2_hu_29ca7a452b5c2e0b.webp 760w,
               /blog/egress-gateway-made-easy/6724f6cb94d57f82bf0548d5_Egress-2_hu_f5688967e07b09ef.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/egress-gateway-made-easy/6724f6cb94d57f82bf0548d5_Egress-2_hu_1177a52740960df4.webp&#34;
               width=&#34;760&#34;
               height=&#34;316&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Wayproxy
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å„ä¸ªæœåŠ¡å¯ä»¥ç»‘å®šåˆ°ä¸€ä¸ª waypoint ä¸Šï¼Œç„¶å Istio ä¼šè‡ªåŠ¨å°†è®¿é—®è¿™äº›æœåŠ¡çš„æµé‡éƒ½é€šè¿‡è¯¥ waypointã€‚&lt;/p&gt;
&lt;p&gt;æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åƒå¯¹å¾…å†…éƒ¨æœåŠ¡ä¸€æ ·ï¼ŒæŠŠ &lt;em&gt;å¤–éƒ¨åŸŸå&lt;/em&gt;ï¼ˆé€šè¿‡ ServiceEntry å®šä¹‰ï¼‰ç»‘å®šåˆ°æŸä¸ª waypointã€‚åªè¦åƒå¯¹å¾… Service é‚£æ ·ï¼Œå°†è¿™äº›åŸŸåæ˜ å°„åˆ° waypointï¼Œè®¿é—®è¿™äº›åŸŸåçš„æµé‡ä¹Ÿèƒ½è‡ªåŠ¨ç»ç”±è¯¥ waypoint ä»£ç†è½¬å‘ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-2åœ¨-istio-ambient-æ¨¡å¼ä¸‹ä¸ºæ¯ä¸ªç›®çš„åœ°é…ç½®-egress-gateway-æ‰€éœ€çš„å¯¹è±¡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 2ï¼šåœ¨ Istio Ambient æ¨¡å¼ä¸‹ä¸ºæ¯ä¸ªç›®çš„åœ°é…ç½® Egress Gateway æ‰€éœ€çš„å¯¹è±¡&#34; srcset=&#34;
               /blog/egress-gateway-made-easy/6724f6ebe547d443658fd5d1_Egress-3-2048x727_hu_5c453830cc6b608d.webp 400w,
               /blog/egress-gateway-made-easy/6724f6ebe547d443658fd5d1_Egress-3-2048x727_hu_dc704405026c26f3.webp 760w,
               /blog/egress-gateway-made-easy/6724f6ebe547d443658fd5d1_Egress-3-2048x727_hu_ed5fcfa7e7a9b74a.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/egress-gateway-made-easy/6724f6ebe547d443658fd5d1_Egress-3-2048x727_hu_5c453830cc6b608d.webp&#34;
               width=&#34;760&#34;
               height=&#34;270&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 2ï¼šåœ¨ Istio Ambient æ¨¡å¼ä¸‹ä¸ºæ¯ä¸ªç›®çš„åœ°é…ç½® Egress Gateway æ‰€éœ€çš„å¯¹è±¡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå³ä½¿ä¿æŒåŒæ ·çš„ä¸°å¯ŒåŠŸèƒ½ï¼Œé…ç½® egress gateway çš„è¿‡ç¨‹ä¹Ÿè¢«æå¤§ç®€åŒ–ã€‚æ­¤åï¼Œæµé‡å¯è§‚æµ‹æ€§è¿˜å¯ä»¥é€šè¿‡ Gloo Mesh è¿›è¡Œå¯è§†åŒ–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®è·µä½“éªŒ&#34;&gt;å®è·µä½“éªŒ&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆï¼Œåœ¨å·²å®‰è£… Istio Ambient æ¨¡å¼çš„é›†ç¾¤ä¸Šï¼Œæˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªæµ‹è¯•åº”ç”¨å¹¶å°†å…¶æ‰€åœ¨çš„ Namespace åŠ å…¥ Ambient ç½‘æ ¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f shell.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl label namespace default istio.io/dataplane-mode&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ambient
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯æµ‹è¯•åº”ç”¨ä¾ç„¶å¯ä»¥æ­£å¸¸å‘é€å‡ºç«™æµé‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl httpbin.org/get
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;headers&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;Host&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;httpbin.org&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;url&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://httpbin.org/get&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©è¿™éƒ¨åˆ†æµé‡èµ°è¿‡ä¸€ä¸ª egress gatewayï¼Œä»è€Œç»Ÿä¸€å¯¹å…¶è¿›è¡Œç­–ç•¥å’Œè®¿é—®æ§åˆ¶ã€‚åœ¨ Istio Ambient æ¨¡å¼ä¸­ï¼Œè¿™æ¯”åœ¨ Sidecar æ¨¡å¼è¦ç®€å•å¾—å¤šã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦éƒ¨ç½²ä¸€ä¸ª waypoint ä»£ç†æ¥å……å½“ egress gatewayã€‚åªéœ€éƒ¨ç½²ä¸€æ¬¡å³å¯ï¼Œåç»­å¯ä»¥å…±äº«ç»™è¦æ•è·æµé‡çš„å…¶ä»–åŸŸåã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl create namespace istio-egress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl waypoint apply --enroll-namespace --namespace istio-egress
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œä¸º &lt;strong&gt;httpbin.org&lt;/strong&gt; åˆ›å»ºä¸€ä¸ª &lt;strong&gt;ServiceEntry&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceEntry&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin.org&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-egress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;httpbin.org&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resolution&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DNS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°±æ˜¯å…¨éƒ¨æ‰€éœ€ï¼å› ä¸ºéƒ¨ç½² waypoint æ—¶ä½¿ç”¨äº† &lt;strong&gt;&amp;ndash;enroll-namespace&lt;/strong&gt; å‚æ•°ï¼Œè¯¥å‘½åç©ºé—´ï¼ˆ&lt;code&gt;istio-egress&lt;/code&gt;ï¼‰ä¸­çš„æ‰€æœ‰æœåŠ¡éƒ½ä¼šè‡ªåŠ¨ç»‘å®šåˆ°æ­¤ waypointã€‚å¦‚æœæˆ‘ä»¬åªæƒ³åœ¨å•ä¸ª Service/ServiceEntry çº§åˆ«è¿›è¡Œç»‘å®šï¼Œä¹Ÿå¯ä»¥åœ¨æ¯ä¸ªå¯¹è±¡ä¸Šæ˜¾å¼æ·»åŠ æ ‡ç­¾ &lt;strong&gt;istio.io/use-waypoint: waypoint&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œè¿™ä¸ª ServiceEntry å·²ç»ç»‘å®šåˆ°æˆ‘ä»¬ä¹‹å‰éƒ¨ç½²çš„ waypoint ä»£ç†ä¸Šï¼ŒåŸå…ˆçš„è¯·æ±‚æ— éœ€ä»»ä½•æ”¹åŠ¨å°±ä¼šè‡ªåŠ¨ç©¿è¿‡è¯¥ waypointï¼Œå¹¶ç”± Istio è‡ªåŠ¨è¿›è¡Œ mTLS åŠ å¯†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$curl&lt;/span&gt; httpbin.org/get -v
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* Request completely sent off
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt; server: istio-envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä» waypoint ä¸­æ”¶é›†æ—¥å¿—ã€è¿½è¸ªä¿¡æ¯ä»¥åŠæŒ‡æ ‡æ¥è§‚å¯Ÿæµé‡ã€‚ä¾‹å¦‚ï¼Œä» waypoint çš„æ—¥å¿—å°±èƒ½çœ‹åˆ°åˆšåˆšå‘å‡ºçš„è¯·æ±‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl logs waypoint-6c6b888f4f-wmnr2 --tail&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2024-07-18T16:13:58.198Z&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GET /get HTTP/1.1&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; - via_upstream - &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;252&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;260&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;259&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;curl/8.7.1&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;8d80cec6-8fc1-40de-8bc7-19716f173bbd&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;httpbin.org&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;3.234.9.11:80&amp;#34;&lt;/span&gt; inbound-vip&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;80&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;http&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;httpbin.org&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; 10.244.0.24:41160 240.240.0.2:80 10.244.0.18:41548 - default
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç­–ç•¥ç®¡ç†&#34;&gt;ç­–ç•¥ç®¡ç†&lt;/h2&gt;
&lt;p&gt;Egress gateway æœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€å°±æ˜¯èƒ½å¤Ÿå¯¹æ‰€æœ‰å‡ºç«™æµé‡å¼ºåˆ¶æ‰§è¡Œè®¿é—®æ§åˆ¶ç­–ç•¥ã€‚ç­–ç•¥èŒƒå›´å¯ä»¥å¾ˆç®€å•â€”â€”æ¯”å¦‚åŸºäºåŸŸåçš„ç™½åå•ï¼Œä¹Ÿå¯ä»¥éå¸¸å¤æ‚ï¼Œæ¯”å¦‚ &lt;a href=&#34;https://docs.solo.io/gloo-mesh-gateway/main/security/dlp/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ•°æ®ä¸¢å¤±é˜²æŠ¤ï¼ˆDLPï¼‰&lt;/a&gt; ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥é™åˆ¶ä½æƒé™åº”ç”¨åªèƒ½è®¿é—® &lt;code&gt;/get&lt;/code&gt; æ¥å£ï¼Œè€Œé«˜æƒé™åº”ç”¨å¯ä»¥è®¿é—® httpbin.org çš„æ‰€æœ‰æ¥å£ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œåªéœ€åœ¨æˆ‘ä»¬åˆ›å»ºçš„ ServiceEntry ä¸Šé™„åŠ ä¸€æ¡ AuthorizationPolicy å³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;security.istio.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AuthorizationPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-egress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetRefs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceEntry&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin.org&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ALLOW&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# admin åº”ç”¨å¯ä»¥è®¿é—®ä»»æ„æ¥å£&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;principals&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cluster.local/ns/default/sa/admin&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å…¶ä»–åº”ç”¨åªå…è®¸è®¿é—® /get&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;methods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/get&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶ï¼Œä»ä½æƒé™åº”ç”¨å‘å‡ºçš„ POST è¯·æ±‚å°±ä¼šè¢«æ‹’ç»ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl httpbin.org/get
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;headers&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;Host&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;httpbin.org&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;url&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://httpbin.org/get&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl -X POST httpbin.org/post
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;RBAC: access denied
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è€Œåœ¨é«˜æƒé™åº”ç”¨ï¼ˆadminï¼‰ä¸­ï¼ŒPOST è¯·æ±‚å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl httpbin.org/post -X POST
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;headers&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;Host&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;httpbin.org&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;url&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://httpbin.org/post&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;tls-origination&#34;&gt;TLS Origination&lt;/h2&gt;
&lt;p&gt;å¦ä¸€ä¸ªåœ¨ egress gateway ä¸Šç»å¸¸ä½¿ç”¨çš„ç­–ç•¥æ˜¯è¿›è¡Œ TLS Originationã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è™½ç„¶åœ¨ç½‘æ ¼ &lt;em&gt;å†…éƒ¨&lt;/em&gt; ä½¿ç”¨äº† Istio è‡ªåŠ¨åŠ å¯†ï¼Œä½†æµé‡ä¸€æ—¦ç¦»å¼€é›†ç¾¤ï¼Œå°±ä¼šä»¥æ˜æ–‡å½¢å¼é€šè¿‡å…¬å…±ç½‘ç»œä¼ è¾“â€”â€”è¿™æ˜¾ç„¶å­˜åœ¨ä¸¥é‡çš„å®‰å…¨é£é™©ã€‚&lt;/p&gt;
&lt;p&gt;å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ egress waypoint ä¸­ä¸ºè¯·æ±‚å¯ç”¨ TLSï¼Œè®©è¯·æ±‚åœ¨ç¦»å¼€é›†ç¾¤å‰å°±è¢«åŠ å¯†ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨å¯¹éœ€è¦å®¢æˆ·ç«¯èº«ä»½è®¤è¯çš„æœåŠ¡è¿›è¡Œè®¿é—®æ—¶å°¤ä¸ºæœ‰ç”¨ï¼Œå¯ä»¥é›†ä¸­åœ°å¯¹è®¿é—®è¿›è¡Œæ§åˆ¶ï¼›ä½†åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä»…æ¼”ç¤ºæœ€ç®€å•çš„ TLSã€‚&lt;/p&gt;
&lt;p&gt;å¯¹æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ ServiceEntry ä¸­åšä¸€ç‚¹å°æ”¹åŠ¨ï¼Œå¹¶æ·»åŠ ä¸€ä¸ª DestinationRuleï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceEntry&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin.org&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-egress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;httpbin.org&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ–°å¢ï¼šæŠŠå‘å¾€ 80 ç«¯å£çš„æµé‡è½¬å‘åˆ° 443 ç«¯å£&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resolution&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DNS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ–°å¢ï¼šä¸ºå‘å¾€ `httpbin.org` çš„è¯·æ±‚å¯ç”¨ TLS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin.org-tls&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-egress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin.org&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SIMPLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ ·ä¸€æ¥ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šè¢«è‡ªåŠ¨å‡çº§ä¸º HTTPSï¼Œè€Œåº”ç”¨è‡ªèº«æ— éœ€åšä»»ä½•æ”¹åŠ¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl httpbin.org/get
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;headers&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;Host&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;httpbin.org&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;url&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://httpbin.org/get&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Istio 1.25.0 æ­£å¼å‘å¸ƒï¼šå…¨é¢å¢å¼º Ambient æ¨¡å¼ä¸æµé‡ç®¡ç†</title>
      <link>https://cloudnativecn.com/blog/istio-1-25-release/</link>
      <pubDate>Tue, 04 Mar 2025 10:22:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-1-25-release/</guid>
      <description>&lt;p&gt;Istio 1.25.0 ç°å·²æ­£å¼å‘å¸ƒï¼Œå¹¶å…¨é¢æ”¯æŒ Kubernetes &lt;code&gt;1.29&lt;/code&gt; è‡³ &lt;code&gt;1.32&lt;/code&gt; ç‰ˆæœ¬ã€‚æ­¤æ¬¡æ›´æ–°å¸¦æ¥äº†å¤šä¸ªå…³é”®æ”¹è¿›ï¼Œç‰¹åˆ«æ˜¯åœ¨ Ambient æ¨¡å¼ã€æµé‡ç®¡ç†å’Œ DNS ä»£ç†ç­‰æ–¹é¢ã€‚ä½ å¯ä»¥åœ¨ &lt;a href=&#34;https://istio.io/latest/news/releases/1.25.x/announcing-1.25/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜ç½‘&lt;/a&gt;æŸ¥çœ‹è¯¦æƒ…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸»è¦æ›´æ–°äº®ç‚¹&#34;&gt;ä¸»è¦æ›´æ–°äº®ç‚¹&lt;/h2&gt;
&lt;h3 id=&#34;1-é»˜è®¤å¯ç”¨-dns-ä»£ç†å¢å¼º-ambient-æ¨¡å¼æ”¯æŒ&#34;&gt;1. é»˜è®¤å¯ç”¨ DNS ä»£ç†ï¼Œå¢å¼º Ambient æ¨¡å¼æ”¯æŒ&lt;/h3&gt;
&lt;p&gt;Istio ä¼ ç»Ÿä¸Šä¾èµ– HTTP å¤´è¿›è¡Œæµé‡è·¯ç”±ã€‚ç„¶è€Œï¼Œåœ¨ Ambient æ¨¡å¼ä¸‹ï¼Œztunnel ä»…èƒ½å¤„ç†å››å±‚ï¼ˆL4ï¼‰æµé‡ï¼Œè€Œæ— æ³•è®¿é—® HTTP å¤´éƒ¨ä¿¡æ¯ã€‚å› æ­¤ï¼ŒDNS ä»£ç†å¯¹äºè§£æ &lt;code&gt;ServiceEntry&lt;/code&gt; åœ°å€è‡³å…³é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨&lt;a href=&#34;https://github.com/istio/istio/wiki/Troubleshooting-Istio-Ambient#scenario-ztunnel-is-not-sending-egress-traffic-to-waypoints&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘é€å‡ºå£æµé‡åˆ° Waypoint&lt;/a&gt; çš„åœºæ™¯ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio 1.25 ç‰ˆæœ¬ä¸­ï¼ŒAmbient æ¨¡å¼é»˜è®¤å¼€å¯ DNS ä»£ç†ï¼Œå¹¶æ”¯æŒå·¥ä½œè´Ÿè½½é€šè¿‡æ³¨è§£é€‰æ‹©é€€å‡ºè¯¥åŠŸèƒ½ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ&lt;a href=&#34;https://istio.io/latest/news/releases/1.25.x/announcing-1.25/upgrade-notes/#ambient-mode-dns-capture-on-by-default&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‡çº§è¯´æ˜&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;2-waypoint-ä»£ç†æ”¯æŒé»˜è®¤æ‹’ç»ç­–ç•¥default-deny&#34;&gt;2. Waypoint ä»£ç†æ”¯æŒé»˜è®¤æ‹’ç»ç­–ç•¥ï¼ˆdefault denyï¼‰&lt;/h3&gt;
&lt;p&gt;åœ¨ Sidecar æ¨¡å¼ä¸‹ï¼Œæˆæƒç­–ç•¥ï¼ˆAuthorization Policyï¼‰é€šå¸¸é€šè¿‡ &lt;code&gt;selector&lt;/code&gt; ç»‘å®šåˆ°ç‰¹å®šå·¥ä½œè´Ÿè½½ã€‚åœ¨ Ambient æ¨¡å¼ä¸­ï¼ŒåŸå…ˆ &lt;code&gt;selector&lt;/code&gt; ç»‘å®šçš„ç­–ç•¥ä»…åœ¨ ztunnel å±‚æ‰§è¡Œï¼Œè€Œ Waypoint ä»£ç†åˆ™ä½¿ç”¨ &lt;code&gt;targetRef&lt;/code&gt; è¿›è¡Œç»‘å®šã€‚è¿™å¯èƒ½å¯¼è‡´æŸäº›æƒ…å†µä¸‹ï¼Œé»˜è®¤è¢«æ‹’ç»è®¿é—®æŸä¸ªç«¯ç‚¹çš„å·¥ä½œè´Ÿè½½ï¼Œèƒ½å¤Ÿé€šè¿‡è¿æ¥åˆ° Waypoint ç»•è¿‡è¯¥é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;Istio 1.25 ç‰ˆæœ¬å¢åŠ äº†å¯¹ &lt;code&gt;GatewayClass&lt;/code&gt; å’Œ &lt;code&gt;Gateway&lt;/code&gt; ç›®æ ‡ç­–ç•¥çš„æ”¯æŒï¼Œä½¿ç®¡ç†å‘˜èƒ½å¤Ÿåœ¨ &lt;code&gt;istio-waypoint&lt;/code&gt; çº§åˆ«å®šä¹‰ç­–ç•¥ï¼Œä»è€Œé€‚ç”¨äºæ‰€æœ‰ Waypoint å®ä¾‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;3-å¢å¼ºåŒºåŸŸzonalè·¯ç”±èƒ½åŠ›&#34;&gt;3. å¢å¼ºåŒºåŸŸï¼ˆZonalï¼‰è·¯ç”±èƒ½åŠ›&lt;/h3&gt;
&lt;p&gt;è·¨åŒºåŸŸï¼ˆzoneï¼‰å’Œè·¨åœ°åŸŸï¼ˆregionï¼‰çš„æµé‡æ§åˆ¶å¯¹äºä¼ä¸šçº§ç”¨æˆ·è‡³å…³é‡è¦ï¼Œå°¤å…¶æ˜¯å‡ºäºå¯é æ€§ã€æ€§èƒ½å’Œæˆæœ¬çš„è€ƒè™‘ã€‚Istio 1.25 ç‰ˆæœ¬å¢å¼ºäº†åŒºåŸŸè·¯ç”±èƒ½åŠ›ï¼Œæä¾›äº†æ›´ç®€å•çš„æµé‡æ§åˆ¶é€‰é¡¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…¨é¢æ”¯æŒ Kubernetes åŸç”Ÿæµé‡åˆ†å‘æœºåˆ¶&lt;/strong&gt;ï¼Œæä¾›æ›´ç®€æ´çš„æ¥å£ä»¥ä¿æŒæµé‡æœ¬åœ°åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¢å¼º Istio æœ¬åœ°è´Ÿè½½å‡è¡¡ï¼ˆLocality Load Balancingï¼‰&lt;/strong&gt;ï¼Œé€‚ç”¨äºæ›´å¤æ‚çš„æµé‡åˆ†å‘åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åœ¨ Ambient æ¨¡å¼ä¸‹ï¼Œztunnel ç°æ”¯æŒ &lt;code&gt;source_zone&lt;/code&gt;ã€&lt;code&gt;source_region&lt;/code&gt;ã€&lt;code&gt;destination_zone&lt;/code&gt; å’Œ &lt;code&gt;destination_region&lt;/code&gt; é¢å¤–æŒ‡æ ‡&lt;/strong&gt;ï¼Œä½¿è·¨åŒºåŸŸæµé‡çš„å¯è§‚æµ‹æ€§æ›´æ¸…æ™°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;4-å…¶ä»–æ–°å¢ç‰¹æ€§ä¸ä¼˜åŒ–&#34;&gt;4. å…¶ä»–æ–°å¢ç‰¹æ€§ä¸ä¼˜åŒ–&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–°å¢æ”¯æŒè™šæ‹Ÿæ¥å£æµé‡è½¬å‘&lt;/strong&gt;ï¼šå…è®¸å·¥ä½œè´Ÿè½½æŒ‡å®šä¸€ç»„è™šæ‹Ÿæ¥å£ï¼Œä½¿å…¶å…¥ç«™æµé‡è¢«è§†ä¸ºå‡ºç«™æµé‡ã€‚è¿™å¯¹äº KubeVirtã€VMs åŠ Docker-in-Docker åœºæ™¯å°¤ä¸ºé‡è¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;istio-cni DaemonSet æ”¯æŒåŸåœ°å‡çº§&lt;/strong&gt;ï¼šå‡çº§ &lt;code&gt;istio-cni&lt;/code&gt; DaemonSet æ—¶ï¼Œä¸å†éœ€è¦å¯¹èŠ‚ç‚¹è¿›è¡Œ Cordon æ“ä½œï¼Œä»¥é˜²æ­¢æ–°åˆ›å»ºçš„ Pod é€ƒé¿ Ambient æ¨¡å¼çš„æµé‡æ•è·ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å…¼å®¹æ€§ä¸å‡çº§æŒ‡å—&#34;&gt;å…¼å®¹æ€§ä¸å‡çº§æŒ‡å—&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ è®¡åˆ’ä» Istio 1.24.x å‡çº§è‡³ Istio 1.25.xï¼Œè¯·æ³¨æ„ä»¥ä¸‹å…³é”®å˜æ›´ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Ambient æ¨¡å¼çš„ Pod éœ€è¦æ‰‹åŠ¨é‡å¯æˆ–å¯ç”¨ &lt;code&gt;istio-cni&lt;/code&gt; è§„åˆ™åŒæ­¥&lt;/strong&gt;ï¼Œä»¥ç¡®ä¿ DNS ä»£ç†æ­£å¸¸ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DNS ä»£ç†é»˜è®¤å¯ç”¨&lt;/strong&gt;ï¼Œè‹¥æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå¯åœ¨ Pod çº§åˆ«ä½¿ç”¨ &lt;code&gt;ambient.istio.io/dns-capture=false&lt;/code&gt; æ³¨è§£é€‰æ‹©é€€å‡ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Grafana ç›‘æ§é¢æ¿å‡çº§è‡³ 7.2 ä»¥ä¸Šç‰ˆæœ¬&lt;/strong&gt;ï¼Œä»¥æ”¯æŒæ–°çš„æŒ‡æ ‡å±•ç¤ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç§»é™¤ OpenCensus æ”¯æŒ&lt;/strong&gt;ï¼Œå»ºè®®è¿ç§»è‡³ OpenTelemetryã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ›´å¤šå‡çº§ç»†èŠ‚è¯·å‚è€ƒ&lt;a href=&#34;https://istio.io/latest/news/releases/1.25.x/announcing-1.25/upgrade-notes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹å‡çº§è¯´æ˜&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;
&lt;p&gt;Istio 1.25 ç‰ˆæœ¬åœ¨ Ambient æ¨¡å¼ã€æµé‡ç®¡ç†ã€DNS ä»£ç†ç­‰å¤šä¸ªæ–¹é¢è¿›è¡Œäº†é‡è¦å¢å¼ºï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–äº†æœåŠ¡ç½‘æ ¼çš„å¯ç”¨æ€§å’Œæ˜“ç”¨æ€§ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio å¯è§æ€§ä¸æ•…éšœæ’æŸ¥ï¼šç›‘æ§æ§åˆ¶å¹³é¢çš„å…³é”®æŒ‡æ ‡</title>
      <link>https://cloudnativecn.com/blog/istio-visibility-troubleshooting/</link>
      <pubDate>Fri, 10 Jan 2025 11:53:24 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-visibility-troubleshooting/</guid>
      <description>&lt;p&gt;Istio æœåŠ¡ç½‘æ ¼æ‹¥æœ‰ä¸°å¯Œçš„åŠŸèƒ½ï¼Œä¸ºæ•°ç™¾å®¶å…¬å¸çš„ Kubernetes ç¯å¢ƒæä¾›äº†æ›´é«˜çš„å®‰å…¨æ€§ã€æ•æ·æ€§å’Œå¼¹æ€§ã€‚è¿™äº›åŠŸèƒ½éƒ½ç”±ä¸€ä¸ªå¯æ‰©å±•ã€æ— çŠ¶æ€ä¸”æ¾è€¦åˆçš„ç»„ä»¶â€”â€”&lt;strong&gt;Istiod&lt;/strong&gt; æ¥åè°ƒã€‚Istiod æ˜¯ Istio çš„æ ¸å¿ƒè½¯ä»¶ç»„ä»¶ï¼ŒæŒç»­æ¥æ”¶ Kubernetes API çš„æ›´æ–°ï¼Œå°†é…ç½®å’Œæ›´æ–°ä¼ é€’ç»™ sidecarï¼ŒåŒæ—¶è¿˜å……å½“å®ƒä»¬çš„ CA æˆæƒä¸­å¿ƒã€‚æ­¤å¤–ï¼Œå®ƒè¿˜ç”Ÿæˆäº†å¤§é‡çš„æŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡ &lt;strong&gt;Istiod&lt;/strong&gt; åœ¨å¼€ç®±å³ç”¨çš„æƒ…å†µä¸‹è¡¨ç°ä¼˜å¼‚ï¼Œä½†å¦‚æœæ²¡æœ‰é€‚å½“çš„ç»´æŠ¤ï¼Œå…¶æ€§èƒ½å¯èƒ½æ— æ³•é•¿ä¹…ä¿æŒæœ€ä½³çŠ¶æ€ï¼›å°¤å…¶æ˜¯å½“ç½‘æ ¼æ‰©å±•åˆ°ç»„ç»‡å†…çš„å¤šä¸ªå›¢é˜Ÿæ—¶ï¼Œå…¶æ‰¿æ‹…çš„è´£ä»»åŠ é‡ï¼Œæ›´éœ€è¦å°å¿ƒç»´æŠ¤ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼ŒæœåŠ¡ç½‘æ ¼è¿ç»´äººå‘˜å¿…é¡»å¯†åˆ‡å…³æ³¨ &lt;strong&gt;Istiod&lt;/strong&gt; ç”Ÿæˆçš„å…³é”®æŒ‡æ ‡ã€‚è¿™äº›æŒ‡æ ‡ä¸ä»…èƒ½å¸®åŠ©é¢„é˜²é—®é¢˜ï¼Œè¿˜èƒ½åœ¨å‘ç”Ÿé—®é¢˜æ—¶å¿«é€Ÿè¯Šæ–­æ˜¯å¦ä¸ç½‘æ ¼ç›¸å…³ã€‚å› ä¸ºä½œä¸ºä¸€ä¸ªé¢å¤–çš„ç½‘ç»œå±‚ï¼ŒIstio å‚ä¸äº†æ•°æ®è·¯å¾„çš„æ¯ä¸€æ­¥æ“ä½œï¼Œè€Œä½ éœ€è¦å·¥å…·å’Œä¿¡æ¯æ¥å›ç­”è¿™æ ·çš„é—®é¢˜ï¼šâ€œ&lt;strong&gt;æˆ‘é‡åˆ°çš„é—®é¢˜æ˜¯å¦ä¸æœåŠ¡ç½‘æ ¼æœ‰å…³ï¼Ÿ&lt;/strong&gt;â€&lt;/p&gt;
&lt;p&gt;é™¤äº†æ§åˆ¶å¹³é¢ï¼ŒIstio è¿˜åŒ…æ‹¬ä¸€ä¸ªç”±æ³¨å…¥åˆ° Pod å’Œç½‘å…³ä¸­çš„ Envoy sidecar ç»„æˆçš„æ•°æ®å¹³é¢ã€‚æˆ‘å°†åœ¨åç»­æ–‡ç« ä¸­è®¨è®º Istio æ•°æ®å¹³é¢çš„å…³é”®æŒ‡æ ‡ï¼ˆæ•¬è¯·æœŸå¾…ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åº”å…³æ³¨çš„æŒ‡æ ‡istio-é»„é‡‘æŒ‡æ ‡&#34;&gt;åº”å…³æ³¨çš„æŒ‡æ ‡ï¼šIstio é»„é‡‘æŒ‡æ ‡&lt;/h2&gt;
&lt;p&gt;å¿«é€Ÿç¡®å®šâ€œ&lt;strong&gt;åœ¨ Istiod ä¸­åº”è¯¥è§‚å¯Ÿä»€ä¹ˆï¼Ÿ&lt;/strong&gt;â€è¿™ä¸€é—®é¢˜èŒƒå›´çš„ä¸€ç§æ–¹æ³•æ˜¯è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get po -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istiod -oname&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; -- curl localhost:15014/metrics &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep -P &lt;span class=&#34;s1&#34;&gt;&amp;#39;^(?!#).*?&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; awk -F&lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#39;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sort &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; uniq &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; wc -l
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;87&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªå‘½ä»¤æ˜¾ç¤ºäº†è¶…è¿‡ 87 ä¸ªç‹¬ç‰¹æŒ‡æ ‡â€”â€”è¿˜ä¸åŒ…æ‹¬ä¸€äº›å› æˆ‘çš„é›†ç¾¤ä¸­å€¼ä¸º null è€Œæœªç»Ÿè®¡çš„é¥±å’Œåº¦å’Œå…¶ä»–ç‰¹å®šæŒ‡æ ‡ã€‚å»ºè®®é‡ç‚¹å…³æ³¨ä¸&lt;strong&gt;å»¶è¿Ÿã€æµé‡ã€é”™è¯¯å’Œé¥±å’Œåº¦&lt;/strong&gt;ç›¸å…³çš„æŒ‡æ ‡ã€‚è¿™ç»„æŒ‡æ ‡è¢«ç§°ä¸ºé»„é‡‘æŒ‡æ ‡ï¼ˆGolden Metricsï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-å»¶è¿ŸæŒ‡æ ‡&#34;&gt;Istio å»¶è¿ŸæŒ‡æ ‡&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Istiod&lt;/strong&gt; çš„å»¶è¿ŸæŒ‡çš„æ˜¯å°†æ¶ˆæ¯ä¼ é€’ç»™ sidecar å¹¶è¢«å…¶å¤„ç†æ‰€éœ€çš„æ—¶é—´ã€‚è¿™äº›æ¶ˆæ¯åŒ…æ‹¬ Istio è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆCRDï¼‰é…ç½®ã€æ–° Pod çš„ IP åœ°å€ã€Kubernetes æœåŠ¡çš„åˆ é™¤é€šçŸ¥ï¼Œä»¥åŠä¸ºæ–°åˆ›å»ºçš„ sidecar æä¾›çš„å¯åŠ¨é…ç½®æ‰¹é‡æ•°æ®ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªå¿…é¡»å…³æ³¨çš„æŒ‡æ ‡æ˜¯ &lt;code&gt;pilot_proxy_convergence_time_bucket&lt;/code&gt;ï¼Œå®ƒè¡¨æ˜ &lt;strong&gt;Istiod&lt;/strong&gt; é…ç½®åœ¨ sidecar ä¸­ç”Ÿæ•ˆæ‰€éœ€çš„æ—¶é—´ã€‚æ­¤æŒ‡æ ‡å¸®åŠ©æˆ‘ä»¬å®¢æˆ·åœ¨æ§åˆ¶å¹³é¢æ€§èƒ½é—®é¢˜å½±å“åº”ç”¨ä¹‹å‰è¿›è¡Œè°ƒæ•´ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€ä¸ªæ¨èçš„æŒ‡æ ‡æ˜¯ &lt;code&gt;pilot_xds_push_time_bucket&lt;/code&gt;ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ EDSï¼ˆç«¯ç‚¹å‘ç°æœåŠ¡ï¼‰ç»´åº¦ï¼Œå› ä¸ºæ­¤é…ç½®æµè´Ÿè´£ä¼ é€’ Pod IP çš„å˜æ›´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ª Pod è¢«åˆ é™¤ï¼Œè€Œå…¶ä»–æ­£åœ¨è¿è¡Œçš„ sidecar æ›´æ–°éœ€è¦ 5 ç§’ï¼Œè¿™å°†å½±å“åˆ°å¯¹æœªç›‘å¬çš„ IP: ç«¯å£å‘é€çš„è¯·æ±‚ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé€šè¿‡äº†è§£æ­¤æŒ‡æ ‡ï¼Œå¯ä»¥è§£å†³ç¬æ—¶è¶…æ—¶å’Œå°¾éƒ¨å»¶è¿Ÿå¢åŠ çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-æµé‡æŒ‡æ ‡&#34;&gt;Istio æµé‡æŒ‡æ ‡&lt;/h2&gt;
&lt;p&gt;æµé‡æŒ‡æ ‡åæ˜ äº† &lt;strong&gt;Istiod&lt;/strong&gt; å¤„ç†çš„æ´»åŠ¨é‡ã€‚å®ƒå¯ä»¥ç”¨æ¥è§‚å¯ŸæœåŠ¡ç½‘æ ¼ç”¨æˆ·æ›´æ”¹é…ç½®çš„é¢‘ç‡ï¼Œä¾‹å¦‚æ·»åŠ æ–°è·¯ç”±ï¼Œä»¥åŠé›†ç¾¤ä¸­å˜æ›´çš„å¼ºåº¦ï¼ˆä¾‹å¦‚ Pod å’Œ Kubernetes æœåŠ¡å˜æ›´ï¼‰ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé›†ä¸­ç‚¹ï¼Œæ¥è¡¡é‡æŸäº›é›†ç¾¤å˜æ›´åœ¨æœåŠ¡å’Œ Istio é…ç½®å±‚é¢çš„å½±å“ï¼Œå¹¶ç»“åˆå…¶ä»–ç›¸å…³æ•°æ®è¿›è¡Œåˆ†æï¼Œä¸ºæœªæ¥è§„åˆ’æä¾›ä¾æ®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªå…³é”®æŒ‡æ ‡æ˜¯ &lt;code&gt;pilot_xds_pushes&lt;/code&gt;ï¼Œå®ƒé»˜è®¤åŒ…å«ä¸€ä¸ª &lt;code&gt;type&lt;/code&gt; ç»´åº¦ï¼Œæ˜ å°„åˆ° CDSã€LDSã€RDS å’Œ EDSã€‚å‰ä¸‰è€…ä¸ Istio é…ç½®ï¼ˆå¦‚è™šæ‹ŸæœåŠ¡ã€ç½‘å…³æˆ–ç›®æ ‡è§„åˆ™ï¼‰ç›¸å…³ï¼Œè€Œæœ€åä¸€ä¸ªå¯†åˆ‡è·Ÿè¸ª Pod IP æˆ–ç«¯ç‚¹çš„å˜æ›´ã€‚æ­¤æŒ‡æ ‡éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©ä½ äº†è§£ &lt;strong&gt;Istiod&lt;/strong&gt; å¤„ç†çš„å˜æ›´å†…å®¹åŠå…¶å¼ºåº¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-é”™è¯¯æŒ‡æ ‡&#34;&gt;Istio é”™è¯¯æŒ‡æ ‡&lt;/h2&gt;
&lt;p&gt;è¿™ä¸€ç±»æŒ‡æ ‡è‡³å…³é‡è¦ã€‚&lt;strong&gt;Istiod&lt;/strong&gt; ä¸­çš„ä»»ä½•é”™è¯¯éƒ½éœ€è¦ç«‹å³å¤„ç†ã€‚è™½ç„¶ç”±äºæ¾è€¦åˆæ¶æ„ï¼Œå³ä½¿ sidecar ä¸ Istiod çš„è¿æ¥ä¸¢å¤±ï¼Œåªè¦æ²¡æœ‰ Pod æˆ– CRD çš„å˜æ›´ï¼Œsidecar ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä¸¤ä¸ªéœ€è¦æ³¨æ„çš„æŒ‡æ ‡æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;sidecar_injection_failure_total&lt;/code&gt;ï¼šæ­¤æŒ‡æ ‡è·Ÿè¸ª &lt;strong&gt;Istiod&lt;/strong&gt; çš„ä¸€ä¸ªåŠŸèƒ½â€”â€”ä¸€ä¸ªåœ¨ Pod åˆ›å»ºæ—¶æ”¹å˜å…¶è§„èŒƒçš„å˜å¼‚ Webhookï¼Œç”¨äºæ’å…¥ Istio çš„ç»„ä»¶ï¼ˆå¦‚ sidecar å’Œ init å®¹å™¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pilot_xds_write_timeout&lt;/code&gt;ï¼šæ­¤æŒ‡æ ‡è¡¨æ˜ &lt;strong&gt;Istiod&lt;/strong&gt; åˆ° sidecar çš„æ¨é€æœªèƒ½åœ¨åŒæ–¹è§„å®šçš„æ—¶é—´å†…å¤„ç†å®Œæˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;istio-é¥±å’Œåº¦æŒ‡æ ‡&#34;&gt;Istio é¥±å’Œåº¦æŒ‡æ ‡&lt;/h2&gt;
&lt;p&gt;æœ€åä½†åŒæ ·é‡è¦çš„æ˜¯ï¼Œè‹¥æœªè¿›è¡Œé€‚å½“çš„ç›‘æ§ï¼Œ&lt;strong&gt;Istiod&lt;/strong&gt; å¯èƒ½å› èµ„æºä¸è¶³è€Œå¼•å‘é—®é¢˜ã€‚CPU å’Œå†…å­˜åˆ†é…ä»¥åŠæ°´å¹³ Pod è‡ªåŠ¨ä¼¸ç¼©ï¼ˆHPAï¼‰åº”æ ¹æ®å†å²æ¨¡å¼ï¼ˆå¦‚æ–°åº”ç”¨ç‰ˆæœ¬å‘å¸ƒã€èŠ‚ç‚¹å‡çº§å¼•å‘çš„å¤§è§„æ¨¡é©±é€ä»¥åŠè¿‡å»å‡ å¹´çš„æµé‡é«˜å³°ï¼‰è¿›è¡Œç›‘æ§å’Œè°ƒæ•´ã€‚&lt;/p&gt;
&lt;p&gt;æ›¾ç»æœ‰ä¸€ä½å®¢æˆ·åœ¨å‘å¸ƒæ–°åº”ç”¨ç‰ˆæœ¬æ—¶æµé‡ä¸­æ–­ï¼Œè¿™åœ¨ä»¥å‰ä»æœªå‘ç”Ÿè¿‡ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªä»¤äººå›°æƒ‘ä¸”æ„å¤–çš„æƒ…å†µã€‚é€šè¿‡æ£€æŸ¥ &lt;code&gt;container_cpu_usage_seconds_total&lt;/code&gt;ï¼Œæˆ‘ä»¬å‘ç°æ§åˆ¶å¹³é¢ CPU ä½¿ç”¨ç‡è¿‡é«˜å¯èƒ½å¯¼è‡´äº†é—®é¢˜ã€‚è¿›ä¸€æ­¥åˆ†æåï¼Œå‘ç° HPA çš„æœŸæœ›å‰¯æœ¬æ•°è¾¾åˆ°äº†å…è®¸çš„æœ€å¤§å€¼ã€‚é€šè¿‡å¿«é€Ÿè°ƒæ•´ï¼Œé›†ç¾¤æ¢å¤åˆ°äº†æ­£å¸¸çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Istiod&lt;/strong&gt; çš„æŒ‡æ ‡å¦‚ &lt;code&gt;process_virtual_memory_bytes&lt;/code&gt; éœ€è¦ä¸ kube-state-metrics ç»“åˆä½¿ç”¨ï¼Œæ‰èƒ½ç›´è§‚åœ°åæ˜ å½“å‰ &lt;strong&gt;Istiod&lt;/strong&gt; çš„å†…å­˜é¥±å’Œæƒ…å†µã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ä¸€æ—¦ä½ æ‹¥æœ‰é€‚å½“çš„ä»ªè¡¨ç›˜æ¥è§‚å¯Ÿä¸Šè¿°æŒ‡æ ‡ï¼Œå¹¶è®©å›¢é˜Ÿç†è§£å…¶é‡è¦æ€§ï¼Œä½ å°†è·å¾—æ›´é«˜çš„è¯Šæ–­å‡†ç¡®æ€§å’Œé€Ÿåº¦ã€æ›´å¥½çš„å¼¹æ€§ï¼Œä»¥åŠæ›´æ»¡æ„çš„ç»ˆç«¯ç”¨æˆ·ä½“éªŒã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>äº‘åŸç”Ÿå¯¹æ¯”ï¼šIstio Ambient æ¨¡å¼ä¸ Cilium çš„æ‰©å±•æ€§èƒ½åˆ†æ</title>
      <link>https://cloudnativecn.com/blog/ambient-vs-cilium/</link>
      <pubDate>Tue, 22 Oct 2024 10:49:22 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/ambient-vs-cilium/</guid>
      <description>&lt;p&gt;æ½œåœ¨çš„ Istio ç”¨æˆ·ç»å¸¸ä¼šé—®ï¼šâ€œIstio ä¸ Cilium ç›¸æ¯”å¦‚ä½•ï¼Ÿâ€è™½ç„¶ Cilium æœ€åˆä»…æä¾› L3/L4 åŠŸèƒ½ï¼ˆå¦‚ç½‘ç»œç­–ç•¥ï¼‰ï¼Œä½†è¿‘æ¥çš„ç‰ˆæœ¬å¢åŠ äº†åŸºäº Envoy çš„æœåŠ¡ç½‘æ ¼åŠŸèƒ½ä»¥åŠ WireGuard åŠ å¯†ã€‚ä¸ Istio ä¸€æ ·ï¼ŒCilium ä¹Ÿæ˜¯ CNCF è®¤è¯çš„æ¯•ä¸šé¡¹ç›®ï¼Œå¹¶åœ¨ç¤¾åŒºä¸­å­˜åœ¨å¤šå¹´ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡è¡¨é¢ä¸Šçœ‹è¿™ä¸¤ä¸ªé¡¹ç›®æä¾›çš„åŠŸèƒ½ç›¸ä¼¼ï¼Œä½†å®ƒä»¬çš„æ¶æ„å´æœ‰ç€æ˜¾è‘—ä¸åŒï¼Œå°¤å…¶æ˜¯ Cilium ä½¿ç”¨ eBPF å’Œ WireGuard åœ¨å†…æ ¸ä¸­å¤„ç†å’ŒåŠ å¯† L4 æµé‡ï¼Œè€Œ Istio åœ¨ç”¨æˆ·ç©ºé—´é€šè¿‡å…¶ ztunnel ç»„ä»¶å¤„ç† L4 æµé‡ã€‚è¿™äº›å·®å¼‚å¯¼è‡´äº†å…³äº Istio ä¸ Cilium åœ¨å¤§è§„æ¨¡ä¸‹æ€§èƒ½çš„å¹¿æ³›è®¨è®ºã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡å·²æœ‰å…³äºç§Ÿæˆ·æ¨¡å‹ã€å®‰å…¨åè®®å’ŒåŸºæœ¬æ€§èƒ½çš„æ¯”è¾ƒï¼Œä½†å°šæœªæœ‰å…¨é¢çš„ä¼ä¸šçº§è¯„ä¼°æŠ¥å‘Šã€‚ä¸å…¶å¼ºè°ƒç†è®ºæ€§èƒ½ï¼Œæˆ‘ä»¬å¯¹ Istio çš„ Ambient æ¨¡å¼å’Œ Cilium è¿›è¡Œäº†æµ‹è¯•ï¼Œèšç„¦äºå»¶è¿Ÿã€ååé‡å’Œèµ„æºæ¶ˆè€—ç­‰å…³é”®æŒ‡æ ‡ã€‚é€šè¿‡æ¨¡æ‹Ÿä¸€ä¸ªç¹å¿™çš„ Kubernetes ç¯å¢ƒï¼Œæˆ‘ä»¬æ–½åŠ äº†é«˜è´Ÿè½½åœºæ™¯ï¼Œæœ€åå°† AKS é›†ç¾¤çš„è§„æ¨¡æ‰©å±•åˆ° 1000 ä¸ªèŠ‚ç‚¹ã€11000 ä¸ªæ ¸å¿ƒï¼Œä»¥äº†è§£è¿™äº›é¡¹ç›®åœ¨å¤§è§„æ¨¡ä¸‹çš„è¡¨ç°ã€‚ç»“æœæ˜¾ç¤ºï¼Œä¸¤è€…å„æœ‰éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œä½† Istio æ˜æ˜¾è¡¨ç°æ›´ä½³ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æµ‹è¯•åœºæ™¯&#34;&gt;æµ‹è¯•åœºæ™¯&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†å°† Istio å’Œ Cilium æ¨å‘æé™ï¼Œæˆ‘ä»¬åˆ›å»ºäº† 500 ä¸ªä¸åŒçš„æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡æ”¯æŒ 100 ä¸ª Podã€‚æ¯ä¸ªæœåŠ¡ä½äºå•ç‹¬çš„å‘½åç©ºé—´ä¸­ï¼Œä¸”åŒ…å«ä¸€ä¸ª&lt;a href=&#34;https://fortio.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fortio&lt;/a&gt;è´Ÿè½½ç”Ÿæˆå®¢æˆ·ç«¯ã€‚æˆ‘ä»¬å°†å®¢æˆ·ç«¯é™åˆ¶åœ¨ä¸€ä¸ªç”± 100 å° 32 æ ¸æœºå™¨ç»„æˆçš„èŠ‚ç‚¹æ± ä¸­ï¼Œä»¥æ¶ˆé™¤å…±åŒå®šä½çš„å®¢æˆ·ç«¯çš„å¹²æ‰°ï¼Œå¹¶ä¸ºæœåŠ¡åˆ†é…äº†å‰©ä½™çš„ 900 å° 8 æ ¸å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æµ‹è¯•åœºæ™¯&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æµ‹è¯•åœºæ™¯&#34; srcset=&#34;
               /blog/ambient-vs-cilium/scale-scenario_hu_6c696a9d03a74239.webp 400w,
               /blog/ambient-vs-cilium/scale-scenario_hu_b4833e715bfc3df3.webp 760w,
               /blog/ambient-vs-cilium/scale-scenario_hu_953ffb62d23288d4.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/ambient-vs-cilium/scale-scenario_hu_6c696a9d03a74239.webp&#34;
               width=&#34;760&#34;
               height=&#34;598&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æµ‹è¯•åœºæ™¯
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ Istio æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Ambient æ¨¡å¼ï¼Œåœ¨æ¯ä¸ªæœåŠ¡å‘½åç©ºé—´ä¸­éƒ¨ç½²äº†&lt;a href=&#34;https://istio.io/latest/docs/ambient/usage/waypoint/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;waypoint ä»£ç†&lt;/a&gt;ï¼Œå¹¶ä½¿ç”¨é»˜è®¤çš„å®‰è£…å‚æ•°ã€‚ä¸ºäº†ä½¿æµ‹è¯•åœºæ™¯å°½å¯èƒ½ç›¸ä¼¼ï¼Œæˆ‘ä»¬åœ¨ Cilium ä¸­å¯ç”¨äº†å‡ ä¸ªéé»˜è®¤åŠŸèƒ½ï¼ŒåŒ…æ‹¬ WireGuard åŠ å¯†ã€L7 ä»£ç†å’ŒèŠ‚ç‚¹åˆå§‹åŒ–ã€‚æˆ‘ä»¬è¿˜åœ¨æ¯ä¸ªå‘½åç©ºé—´ä¸­åˆ›å»ºäº†ä¸€ä¸ª Cilium ç½‘ç»œç­–ç•¥ï¼Œå¸¦æœ‰åŸºäº HTTP è·¯å¾„çš„è§„åˆ™ã€‚åœ¨ä¸¤ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡éšæœºåœ°å°†ä¸€ä¸ªæœåŠ¡æ‰©å±•åˆ° 85 è‡³ 115 ä¸ªå®ä¾‹å¹¶æ¯åˆ†é’Ÿé‡æ–°æ ‡è®°ä¸€ä¸ªå‘½åç©ºé—´ï¼Œç”Ÿæˆäº†å˜åŒ–ã€‚è¦æŸ¥çœ‹æˆ‘ä»¬ä½¿ç”¨çš„ç²¾ç¡®è®¾ç½®å¹¶é‡ç°ç»“æœï¼Œè¯·å‚é˜…&lt;a href=&#34;https://github.com/therealmitchconnors/tools/blob/2384dc26f114300687b21f921581a158f27dc9e1/perf/load/many-svc-scenario/README.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘çš„ç¬”è®°&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯æ‰©å±•æ€§è¯„åˆ†&#34;&gt;å¯æ‰©å±•æ€§è¯„åˆ†&lt;/h2&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å¯æ‰©å±•æ€§è¯„åˆ†&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å¯æ‰©å±•æ€§è¯„åˆ†&#34; srcset=&#34;
               /blog/ambient-vs-cilium/scale-scorecard_hu_e47ea34005b0f0b8.webp 400w,
               /blog/ambient-vs-cilium/scale-scorecard_hu_cfc88e69e45db0b7.webp 760w,
               /blog/ambient-vs-cilium/scale-scorecard_hu_ac79307207b1a796.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/ambient-vs-cilium/scale-scorecard_hu_e47ea34005b0f0b8.webp&#34;
               width=&#34;760&#34;
               height=&#34;426&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å¯æ‰©å±•æ€§è¯„åˆ†
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio èƒ½å¤Ÿä»¥ 20% çš„è¾ƒä½å°¾å»¶è¿Ÿæä¾› 56% æ›´å¤šçš„æŸ¥è¯¢ã€‚Cilium çš„ CPU ä½¿ç”¨ç‡ä½ 30%ï¼Œä½†æˆ‘ä»¬çš„æµ‹é‡å¹¶ä¸åŒ…æ‹¬ Cilium ç”¨äºåŠ å¯†çš„å†…æ ¸æ ¸å¿ƒã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘åˆ°èµ„æºä½¿ç”¨æƒ…å†µï¼ŒIstio æ¯æ ¸å¿ƒå¤„ç† 2178 ä¸ªæŸ¥è¯¢ï¼Œè€Œ Cilium åˆ™æ˜¯ 1815 ä¸ªï¼Œæå‡äº† 20%ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Cilium å‡é€Ÿï¼š&lt;/strong&gt; Cilium åœ¨é»˜è®¤å®‰è£…å‚æ•°ä¸‹å±•ç¤ºäº†ä»¤äººå°è±¡æ·±åˆ»çš„ä½å»¶è¿Ÿï¼Œä½†å½“å¯ç”¨ Istio çš„åŸºå‡†åŠŸèƒ½ï¼ˆå¦‚ L7 ç­–ç•¥å’ŒåŠ å¯†ï¼‰æ—¶ï¼Œå…¶é€Ÿåº¦å¤§å¹…ä¸‹é™ã€‚æ­¤å¤–ï¼Œå³ä½¿ç½‘æ ¼ä¸­æ²¡æœ‰æµé‡æµåŠ¨ï¼ŒCilium çš„å†…å­˜å’Œ CPU åˆ©ç”¨ç‡ä»ç„¶è¾ƒé«˜ï¼Œè¿™å¯èƒ½ä¼šå½±å“é›†ç¾¤çš„æ•´ä½“ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œå°¤å…¶æ˜¯åœ¨æ‰©å±•æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Istio ç¨³å¥è¡¨ç°ï¼š&lt;/strong&gt; ç›¸æ¯”ä¹‹ä¸‹ï¼ŒIstio çš„ Ambient æ¨¡å¼åœ¨ç¨³å®šæ€§æ–¹é¢å±•ç¤ºäº†å…¶ä¼˜åŠ¿ï¼Œå³ä½¿å¢åŠ äº†åŠ å¯†çš„å¼€é”€ï¼Œä¹Ÿèƒ½ä¿æŒä¸é”™çš„ååé‡ã€‚åœ¨æµ‹è¯•ä¸­ï¼ŒIstio ç¡®å®æ¯” Cilium æ¶ˆè€—äº†æ›´å¤šçš„å†…å­˜å’Œ CPUï¼Œä½†åœ¨æ²¡æœ‰è´Ÿè½½æ—¶å…¶ CPU åˆ©ç”¨ç‡ä¸‹é™åˆ° Cilium çš„ä¸€å°éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¹•ååŸå› ä¸ºä½•è¡¨ç°å·®å¼‚&#34;&gt;å¹•ååŸå› ï¼šä¸ºä½•è¡¨ç°å·®å¼‚ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;è¦ç†è§£è¿™äº›æ€§èƒ½å·®å¼‚çš„å…³é”®åœ¨äºå„å·¥å…·çš„æ¶æ„å’Œè®¾è®¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Cilium çš„æ§åˆ¶å¹³é¢éš¾é¢˜ï¼š&lt;/strong&gt; Cilium åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ªæ§åˆ¶å¹³é¢å®ä¾‹ï¼Œéšç€é›†ç¾¤æ‰©å±•ï¼Œè¿™å¯¼è‡´ API æœåŠ¡å™¨å‹åŠ›å¢åŠ å’Œé…ç½®å¼€é”€å¢åŠ ã€‚è¿™ç»å¸¸å¯¼è‡´æˆ‘ä»¬çš„ API æœåŠ¡å™¨å´©æºƒï¼Œæ¥ç€ Cilium å˜å¾—ä¸å¯ç”¨ï¼Œæ•´ä¸ªé›†ç¾¤é™·å…¥ä¸å“åº”çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Istio çš„æ•ˆç‡ä¼˜åŠ¿ï¼š&lt;/strong&gt; Istio é€šè¿‡é›†ä¸­æ§åˆ¶å¹³é¢å’ŒåŸºäºèº«ä»½çš„æ–¹å¼ç®€åŒ–äº†é…ç½®ï¼Œå‡å°‘äº† API æœåŠ¡å™¨å’ŒèŠ‚ç‚¹çš„è´Ÿæ‹…ï¼Œå°†å…³é”®èµ„æºç”¨äºå¤„ç†å’Œä¿æŠ¤æµé‡ï¼Œè€Œä¸æ˜¯å¤„ç†é…ç½®ã€‚Istio é€šè¿‡è¿è¡Œå°½å¯èƒ½å¤šçš„ Envoy å®ä¾‹æ¥è¿›ä¸€æ­¥åˆ©ç”¨æœªåœ¨æ§åˆ¶å¹³é¢ä¸­ä½¿ç”¨çš„èµ„æºï¼Œè€Œ Cilium åˆ™é™åˆ¶ä¸ºæ¯ä¸ªèŠ‚ç‚¹å…±äº«ä¸€ä¸ª Envoy å®ä¾‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ›´æ·±å…¥æ¢è®¨&#34;&gt;æ›´æ·±å…¥æ¢è®¨&lt;/h3&gt;
&lt;p&gt;è™½ç„¶è¿™ä¸ªé¡¹ç›®çš„ç›®æ ‡æ˜¯æ¯”è¾ƒ Istio å’Œ Cilium çš„å¯æ‰©å±•æ€§ï¼Œä½†ä¸€äº›é™åˆ¶ä½¿å¾—ç›´æ¥æ¯”è¾ƒå˜å¾—å›°éš¾ã€‚&lt;/p&gt;
&lt;h3 id=&#34;l4-ä¸æ€»æ˜¯-l4&#34;&gt;L4 ä¸æ€»æ˜¯ L4&lt;/h3&gt;
&lt;p&gt;å°½ç®¡ Istio å’Œ Cilium éƒ½æä¾› L4 ç­–ç•¥å¼ºåˆ¶ï¼Œä½†å®ƒä»¬çš„ API å’Œå®ç°å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚Cilium å®ç°äº† Kubernetes NetworkPolicyï¼Œå®ƒä½¿ç”¨æ ‡ç­¾å’Œå‘½åç©ºé—´æ¥é˜»æ­¢æˆ–å…è®¸ IP åœ°å€çš„è®¿é—®ã€‚Istio æä¾›äº†ä¸€ä¸ª AuthorizationPolicy APIï¼Œå¹¶æ ¹æ®ç­¾ç½²æ¯ä¸ªè¯·æ±‚çš„ TLS èº«ä»½åšå‡ºå…è®¸å’Œæ‹’ç»å†³å®šã€‚å¤§å¤šæ•°æ·±åº¦é˜²å¾¡ç­–ç•¥éœ€è¦åŒæ—¶ä½¿ç”¨ NetworkPolicy å’ŒåŸºäº TLS çš„ç­–ç•¥æ¥å®ç°å…¨é¢çš„å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŠ å¯†çš„å·®å¼‚&#34;&gt;åŠ å¯†çš„å·®å¼‚&lt;/h3&gt;
&lt;p&gt;Cilium æä¾›äº†ç”¨äº FIPS å…¼å®¹åŠ å¯†çš„ IPsecï¼Œä½†å¤§å¤šæ•° Cilium åŠŸèƒ½ï¼ˆå¦‚ L7 ç­–ç•¥å’Œè´Ÿè½½å‡è¡¡ï¼‰ä¸ IPsec ä¸å…¼å®¹ã€‚Cilium åœ¨ä½¿ç”¨ WireGuard åŠ å¯†æ—¶å…·æœ‰æ›´å¥½çš„åŠŸèƒ½å…¼å®¹æ€§ï¼Œä½† WireGuard æ— æ³•åœ¨ FIPS åˆè§„çš„ç¯å¢ƒä¸­ä½¿ç”¨ã€‚å¦ä¸€æ–¹é¢ï¼ŒIstio ä¸¥æ ¼éµå®ˆ TLS åè®®æ ‡å‡†ï¼Œé»˜è®¤æƒ…å†µä¸‹å§‹ç»ˆä½¿ç”¨ FIPS å…¼å®¹çš„ mTLSã€‚&lt;/p&gt;
&lt;h3 id=&#34;éšè—çš„æˆæœ¬&#34;&gt;éšè—çš„æˆæœ¬&lt;/h3&gt;
&lt;p&gt;è™½ç„¶ Istio å®Œå…¨åœ¨ç”¨æˆ·ç©ºé—´ä¸­è¿è¡Œï¼Œä½† Cilium çš„ L4 æ•°æ®å¹³é¢åœ¨ Linux å†…æ ¸ä¸­ä½¿ç”¨ eBPFã€‚Prometheus çš„èµ„æºæ¶ˆè€—æŒ‡æ ‡ä»…æµ‹é‡ç”¨æˆ·ç©ºé—´èµ„æºï¼Œè¿™æ„å‘³ç€ Cilium ä½¿ç”¨çš„æ‰€æœ‰å†…æ ¸èµ„æºåœ¨æ­¤æµ‹è¯•ä¸­éƒ½æœªè®¡å…¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å»ºè®®é€‰æ‹©åˆé€‚çš„å·¥å…·&#34;&gt;å»ºè®®ï¼šé€‰æ‹©åˆé€‚çš„å·¥å…·&lt;/h2&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œæœ€ç»ˆç»“è®ºæ˜¯ä»€ä¹ˆï¼Ÿè¿™å–å†³äºæ‚¨çš„å…·ä½“éœ€æ±‚å’Œä¼˜å…ˆäº‹é¡¹ã€‚å¯¹äºå°å‹é›†ç¾¤ä»¥åŠçº¯ L3/L4 ç”¨ä¾‹ä¸”æ— éœ€åŠ å¯†çš„æƒ…å†µï¼ŒCilium æä¾›äº†ä¸€ä¸ªç»æµé«˜æ•ˆä¸”æ€§èƒ½è‰¯å¥½çš„è§£å†³æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œå¯¹äºå¤§å‹é›†ç¾¤ï¼Œä»¥åŠæ³¨é‡ç¨³å®šæ€§ã€å¯æ‰©å±•æ€§å’Œé«˜çº§åŠŸèƒ½çš„æƒ…å†µï¼ŒIstio çš„ Ambient æ¨¡å¼é…åˆæ›¿ä»£çš„ NetworkPolicy å®ç°æ‰æ˜¯é¦–é€‰ã€‚è®¸å¤šå®¢æˆ·é€‰æ‹©å°† Cilium çš„ L3/L4 åŠŸèƒ½ä¸ Istio çš„ L4/L7 å’ŒåŠ å¯†åŠŸèƒ½ç»“åˆï¼Œä»¥å®ç°æ·±åº¦é˜²å¾¡ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;è¯·è®°ä½ï¼Œäº‘åŸç”Ÿç½‘ç»œçš„ä¸–ç•Œåœ¨ä¸æ–­å‘å±•ã€‚å¯†åˆ‡å…³æ³¨ Istio å’Œ Cilium çš„è¿›å±•ï¼Œå®ƒä»¬å°†ç»§ç»­æ”¹è¿›å’Œåº”å¯¹è¿™äº›æŒ‘æˆ˜ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å¦‚ä½•å°† Istio ä¸ AWS ç§æœ‰è¯ä¹¦é¢å‘æœºæ„ï¼ˆPrivate CAï¼‰æ— ç¼é›†æˆ</title>
      <link>https://cloudnativecn.com/blog/istio-aws-private-ca/</link>
      <pubDate>Tue, 24 Sep 2024 16:19:19 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-aws-private-ca/</guid>
      <description>&lt;p&gt;å½“ç”¨æˆ·å®‰è£… Istio æ—¶ï¼Œé»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ªè¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ï¼Œå¹¶ä¸” CA è¯ä¹¦æ˜¯è‡ªç­¾åçš„ã€‚ç„¶åï¼ŒCA è¯ä¹¦ç”¨äºç®¡ç†è¿è¡Œåœ¨ Istio æœåŠ¡ç½‘æ ¼ä¸Šçš„åº”ç”¨ç¨‹åºçš„è¯ä¹¦ç”Ÿå‘½å‘¨æœŸã€‚è¿™ä½¿å¾—åœ¨ Istio æœåŠ¡ç½‘æ ¼ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºä¹‹é—´è½»æ¾è®¾ç½®å¼€ç®±å³ç”¨çš„ mTLS é€šä¿¡æˆä¸ºå¯èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;éšç€æˆ‘ä»¬å‘ç”Ÿäº§ç¯å¢ƒçš„å®æ–½è¿ˆè¿›ï¼ŒIstio è¿˜æä¾›äº†ä¸€ä¸ªé€‰é¡¹ï¼Œå¯ä»¥ä½¿ç”¨ä½ è‡ªå·±çš„ CA è¯ä¹¦ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„è‡ªç­¾å CA è¯ä¹¦ã€‚ä¼ä¸šå€¾å‘äºè‡ªåŠ¨åŒ–å…¶å…¬é’¥/ç§é’¥åŸºç¡€è®¾æ–½ï¼ˆPKIï¼‰ï¼Œä»¥ç¡®ä¿ã€ç®¡ç†å’Œåˆ›å»ºè¯ä¹¦ã€‚ä½œä¸ºä¸€èˆ¬å®è·µï¼Œä¼ä¸šä¼šä½¿ç”¨ç”±å…¶æ ¹è¯ä¹¦æˆ–å…¶ä»–ä¸­é—´è¯ä¹¦ç­¾åçš„ç§æœ‰ CA è¯ä¹¦æ¥è®¾ç½®å…¶æœåŠ¡ç½‘æ ¼çš„è¯ä¹¦é¢å‘æœºæ„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¼—å¤šå¯ç”¨é€‰é¡¹ä¸­ï¼Œ&lt;a href=&#34;https://aws.amazon.com/private-ca/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS ç§æœ‰ CA&lt;/a&gt; æ˜¯ä¸€ä¸ªæ‰˜ç®¡çš„ CAï¼Œå¸®åŠ©ç»„ç»‡ä½¿ç”¨ AWS ä¸­çš„ç§æœ‰è¯ä¹¦æ¥ä¿æŠ¤å…¶åº”ç”¨ç¨‹åºå’Œè®¾å¤‡ã€‚æ­¤å¤–ï¼Œ&lt;a href=&#34;https://cert-manager.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cert Manager&lt;/a&gt; æ˜¯å¦ä¸€ä¸ªæµè¡Œçš„é€‰æ‹©ï¼Œç”¨äºç®€åŒ–è·å–ã€ç»­è®¢å’Œä½¿ç”¨è¿™äº›è¯ä¹¦çš„è¿‡ç¨‹ã€‚Cert Manager å’Œ &lt;a href=&#34;https://github.com/cert-manager/aws-privateca-issuer&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS Private CA issuer&lt;/a&gt; æ’ä»¶é€šå¸¸ä¸€èµ·ä½¿ç”¨ï¼Œä»¥è®¾ç½® Istio æœåŠ¡ç½‘æ ¼çš„è‡ªå®šä¹‰ CAã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§é›†æˆçš„ä¸€äº›ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„è‡ªåŠ¨åŒ–&lt;/strong&gt;ï¼Œç¡®ä¿åœ¨è¯ä¹¦åˆ°æœŸå‰ç»­è®¢ï¼Œä»¥é¿å…ä»»ä½•åœæœºæ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç§é’¥åŸºç¡€è®¾æ–½çš„æ˜“å®¡è®¡æ€§&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šè¿‡ Certificate CRD æä¾›çš„çµæ´»é…ç½®é€‰é¡¹&lt;/strong&gt;ï¼Œä»¥æ»¡è¶³æ›´å¹¿æ³›å—ä¼—çš„éœ€æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ¶‰åŠçš„ä¸åŒç»„ä»¶çš„å¯è§†åŒ–è¡¨ç¤º&#34;&gt;æ¶‰åŠçš„ä¸åŒç»„ä»¶çš„å¯è§†åŒ–è¡¨ç¤º&lt;/h2&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-aws-ç§æœ‰-ca---é›†ç¾¤---aws-iam&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;AWS ç§æœ‰ CA - é›†ç¾¤ - AWS IAM&#34; srcset=&#34;
               /blog/istio-aws-private-ca/f1_hu_67cd28327d057506.webp 400w,
               /blog/istio-aws-private-ca/f1_hu_307aaa7616b76f4.webp 760w,
               /blog/istio-aws-private-ca/f1_hu_4b6be963a36ac1f.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-aws-private-ca/f1_hu_67cd28327d057506.webp&#34;
               width=&#34;760&#34;
               height=&#34;603&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      AWS ç§æœ‰ CA - é›†ç¾¤ - AWS IAM
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ä»¥ä¸‹ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†åˆ†äº«å¦‚ä½•ä¸ºä½ çš„ Istio æœåŠ¡ç½‘æ ¼è®¾ç½®è‡ªå®šä¹‰ CA çš„æ­¥éª¤ï¼Œä½¿ç”¨ AWS ç§æœ‰ CA ä½œä¸ºç§é’¥åŸºç¡€è®¾æ–½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…-cert-manager&#34;&gt;å®‰è£… Cert Manager&lt;/h2&gt;
&lt;p&gt;Cert Manager ç®€åŒ–äº†è·å–ã€ç»­è®¢å’Œä½¿ç”¨è¯ä¹¦çš„è¿‡ç¨‹ã€‚å®ƒæ”¯æŒä¸åŒ…æ‹¬ AWS ç§æœ‰ CA åœ¨å†…çš„å¹¿æ³›ç§é’¥åŸºç¡€è®¾æ–½çš„é›†æˆã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Helm å®‰è£… Cert Managerã€‚å…¶ä»–å®‰è£…é€‰é¡¹è¯·å‚è§ &lt;a href=&#34;https://cert-manager.io/docs/installation/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;CERT_MANAGER_VERSION&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1.11.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo add jetstack https://charts.jetstack.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo update
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm install cert-manager jetstack/cert-manager &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --namespace cert-manager &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --create-namespace &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --version &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;CERT_MANAGER_VERSION&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --set &lt;span class=&#34;nv&#34;&gt;installCRDs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --wait&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# éªŒè¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n cert-manager rollout status deploy/cert-manager&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n cert-manager rollout status deploy/cert-manager-cainjector&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n cert-manager rollout status deploy/cert-manager-webhook&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;åœ¨-aws-ä¸­åˆ›å»º-ca-å±‚çº§ç»“æ„&#34;&gt;åœ¨ AWS ä¸­åˆ›å»º CA å±‚çº§ç»“æ„&lt;/h2&gt;
&lt;p&gt;åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬åœ¨ AWS ç§æœ‰ CA ä¸­åˆ›å»ºä¸€ä¸ªæ ¹è¯ä¹¦é¢å‘æœºæ„å’Œä¸€ä¸ªä¸‹çº§è¯ä¹¦é¢å‘æœºæ„ã€‚ç›¸å…³çš„ &lt;a href=&#34;https://docs.aws.amazon.com/privateca/latest/userguide/ca-hierarchy.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS æ–‡æ¡£&lt;/a&gt; è®¨è®ºäº†å¦‚ä½•è®¾è®¡ CA å±‚çº§ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-aws-ç§æœ‰-ca&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;AWS ç§æœ‰ CA&#34; srcset=&#34;
               /blog/istio-aws-private-ca/f2_hu_c39dcd6b3a78e884.webp 400w,
               /blog/istio-aws-private-ca/f2_hu_942612091ee8c888.webp 760w,
               /blog/istio-aws-private-ca/f2_hu_56f3f63ede8f232e.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-aws-private-ca/f2_hu_c39dcd6b3a78e884.webp&#34;
               width=&#34;300&#34;
               height=&#34;297&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      AWS ç§æœ‰ CA
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¯·æ³¨æ„ï¼š&lt;/strong&gt; ä»¥ä¸‹è„šæœ¬å°†åœ¨ AWS ç§æœ‰ CA ä¸­åˆ›å»ºä¸€ä¸ªæ ¹ CA å’Œä¸€ä¸ªä¸‹çº§ CAã€‚å¦‚æœä½ å·²ç»åœ¨ AWS ç§æœ‰ CA ä¸­å­˜åœ¨ CA å±‚çº§ç»“æ„ï¼Œå¹¶å¸Œæœ›é‡ç”¨è¯¥å±‚çº§ç»“æ„ï¼Œè€Œä¸æ˜¯ä»æ ¹ CA åˆ›å»ºæ–°çš„ä¸‹çº§ CAï¼Œåˆ™å¯ä»¥è·³è¿‡è¿è¡Œä»¥ä¸‹è„šæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ å¸Œæœ›é‡ç”¨ç°æœ‰çš„ AWS ç§æœ‰ CA å¯¹è±¡ï¼Œè¯·å°†å…¶ ARN ä¿å­˜åœ¨ç¯å¢ƒå˜é‡ &lt;strong&gt;&lt;code&gt;ISTIO_CA_ARN&lt;/code&gt;&lt;/strong&gt; ä¸­ã€‚æˆ‘ä»¬å°†åœ¨åç»­æ­¥éª¤ä¸­ä½¿ç”¨æ­¤å˜é‡ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼Œå¦‚æœä½ å¸Œæœ›ä½¿ç”¨æ­¤è„šæœ¬åˆ›å»ºç§æœ‰ CA å±‚çº§ç»“æ„ï¼Œè¯·æ ¹æ®ä½ çš„éœ€æ±‚ç¼–è¾‘ &lt;code&gt;COUNTRY, ORGANIZATION, ORGANIZATIONAL_UNIT, STATE, LOCALITY&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿è¡Œä¸Šè¿°è„šæœ¬åï¼Œè¯·å°† ARN ä¿å­˜åœ¨ &lt;em&gt;&lt;strong&gt;&lt;code&gt;ISTIO_CA_ARN&lt;/code&gt;&lt;/strong&gt;&lt;/em&gt; ä¸­ä»¥ä¾›åç»­æ­¥éª¤ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;ISTIO_CA_ARN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;arn:aws:acm-pca:[REGION]:[REDACTED]:certificate-authority/[REDACTED]&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;åˆ›å»º-iam-ç­–ç•¥å’Œè§’è‰²&#34;&gt;åˆ›å»º IAM ç­–ç•¥å’Œè§’è‰²&lt;/h2&gt;
&lt;p&gt;è¦è®¿é—®ä»»ä½• AWS èµ„æºï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰æ­£ç¡®çº§åˆ«çš„æƒé™ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªæ–°çš„ IAM ç­–ç•¥ï¼Œä»…æˆäºˆæ‰€éœ€çš„è®¿é—®çº§åˆ«ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF &amp;gt; AWSPCAIssuerPolicy.json
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  &amp;#34;Version&amp;#34;: &amp;#34;2012-10-17&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  &amp;#34;Statement&amp;#34;: [
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      &amp;#34;Sid&amp;#34;: &amp;#34;awspcaissuer&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      &amp;#34;Action&amp;#34;: [
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        &amp;#34;acm-pca:DescribeCertificateAuthority&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        &amp;#34;acm-pca:GetCertificate&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        &amp;#34;acm-pca:IssueCertificate&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      ],
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      &amp;#34;Effect&amp;#34;: &amp;#34;Allow&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      &amp;#34;Resource&amp;#34;: [
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        &amp;#34;${ISTIO_CA_ARN}&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        ]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  ]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;POLICY_ARN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;aws iam create-policy &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --policy-name AWSPCAIssuerPolicy &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --policy-document file://AWSPCAIssuerPolicy.json &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --output json &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;s1&#34;&gt;&amp;#39;.Policy.Arn&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;POLICY_ARN = &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;POLICY_ARN&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;åˆ›å»ºå¸¦æœ‰-iam-oidc-æä¾›å•†çš„-iam-è§’è‰²&#34;&gt;åˆ›å»ºå¸¦æœ‰ IAM OIDC æä¾›å•†çš„ IAM è§’è‰²&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ â€œaws-privateca-issuerâ€ Cert Manager æ’ä»¶ä¸ AWS ç§æœ‰ CA äº¤äº’ã€‚è¯¥æ’ä»¶éœ€è¦æ­£ç¡®çš„è®¿é—®æƒé™æ¥ä¸ AWS ç§æœ‰ CA äº¤äº’ã€‚å®ƒéœ€è¦ä½¿ç”¨æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥åˆ›å»ºçš„ IAM ç­–ç•¥ã€‚åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬ä¸º â€œaws-privateca-issuerâ€ æ’ä»¶åˆ›å»ºä¸€ä¸ª ServiceAccountï¼Œå¹¶å°†å…¶ä¸æ–°åˆ›å»ºçš„ IAM è§’è‰²å…³è”ï¼Œè¯¥è§’è‰²å·²é™„åŠ  IAM ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;EKS é›†ç¾¤æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„ &lt;a href=&#34;https://openid.net/connect/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenID Connect&lt;/a&gt; (OIDC) å‘è¡Œè€… URLã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒIAM OIDC æä¾›å•†æœªå¯ç”¨ã€‚è¦ä½¿ç”¨å®ƒï¼Œ&lt;a href=&#34;https://docs.aws.amazon.com/eks/latest/userguide/enable-iam-roles-for-service-accounts.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘ä»¬éœ€è¦å…ˆå¯ç”¨å®ƒ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¯·ç¡®ä¿ IAM ç­–ç•¥ ARN å·²è®¾ç½®åœ¨ &lt;strong&gt;&lt;code&gt;POLICY_ARN&lt;/code&gt;&lt;/strong&gt; ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# è¯·åœ¨ä¸‹æ–¹ç¼–è¾‘é›†ç¾¤åç§°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;CURRENT_CLUSTER&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ä¸ºé›†ç¾¤å¯ç”¨ IAM OIDC æä¾›å•†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;eksctl utils associate-iam-oidc-provider &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --cluster&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;CURRENT_CLUSTER&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --approve&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# åˆ›å»ºç»‘å®šåˆ°æœåŠ¡è´¦æˆ·çš„ IAM è§’è‰²&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;eksctl create iamserviceaccount --cluster&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;CURRENT_CLUSTER&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;PCA_NAMESPACE&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --attach-policy-arn&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;POLICY_ARN&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --override-existing-serviceaccounts &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --name&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;aws-pca-issuer&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --role-name &lt;span class=&#34;s2&#34;&gt;&amp;#34;ServiceAccountRolePrivateCA-&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;CURRENT_CLUSTER&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --approve&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†åˆ›å»ºä¸€ä¸ªç»‘å®šåˆ° Kubernetes ServiceAccount çš„ IAM è§’è‰²ï¼šâ€œ&lt;code&gt;aws-pca-issuer&lt;/code&gt;â€œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;IAM è§’è‰²å°†é™„åŠ  IAM ç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;Service Account &lt;code&gt;aws-pca-issuer&lt;/code&gt; å°†ç”± AWS Private CA Issuer ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å®‰è£…-aws-privateca-issuer-æ’ä»¶å¹¶ä½¿ç”¨-serviceaccount-aws-pca-issuer&#34;&gt;å®‰è£… &lt;code&gt;aws-privateca-issuer&lt;/code&gt; æ’ä»¶å¹¶ä½¿ç”¨ ServiceAccount: &lt;code&gt;aws-pca-issuer&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ Helm å®‰è£…æ’ä»¶ï¼Œå¹¶ä½¿ç”¨ä¸Šä¸€æ­¥ä¸­åˆ›å»ºçš„ Kubernetes ServiceAccountã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-aws-ç§æœ‰-ca---é›†ç¾¤---aws-iam&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;AWS ç§æœ‰ CA - é›†ç¾¤ - AWS IAM&#34; srcset=&#34;
               /blog/istio-aws-private-ca/f3_hu_8e41ef29e9f0736d.webp 400w,
               /blog/istio-aws-private-ca/f3_hu_21e554b5e589ff1e.webp 760w,
               /blog/istio-aws-private-ca/f3_hu_2221a9b57d9fbe31.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-aws-private-ca/f3_hu_8e41ef29e9f0736d.webp&#34;
               width=&#34;760&#34;
               height=&#34;413&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      AWS ç§æœ‰ CA - é›†ç¾¤ - AWS IAM
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;PCA_NAMESPACE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬ https://github.com/cert-manager/aws-privateca-issuer/releases&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;AWSPCA_ISSUER_TAG&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1.2.2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å®‰è£… AWS ç§æœ‰ CA Issuer æ’ä»¶ &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# https://github.com/cert-manager/aws-privateca-issuer/#setup&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo add awspca https://cert-manager.github.io/aws-privateca-issuer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo update
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm upgrade --install aws-pca-issuer awspca/aws-privateca-issuer &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --namespace &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;PCA_NAMESPACE&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --set image.tag&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;AWSPCA_ISSUER_TAG&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --set serviceAccount.create&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --set serviceAccount.name&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;aws-pca-issuer&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --wait&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# éªŒè¯éƒ¨ç½²çŠ¶æ€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;PCA_NAMESPACE&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    rollout status deploy/aws-pca-issuer-aws-privateca-issuer&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;åˆ›å»º-issuer&#34;&gt;åˆ›å»º Issuer&lt;/h2&gt;
&lt;p&gt;AWSPCAIssuer æ˜¯ä¸€ä¸ª CRDï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­å®šä¹‰äº†ä¸¤ä¸ªå…³é”®å‚æ•°ã€‚å³æˆ‘ä»¬åœ¨æ­¥éª¤ 2 ä¸­åˆ›å»ºçš„ CA çš„ ARN ä»¥åŠè¯¥ CA æ‰€åœ¨çš„ AWS åŒºåŸŸã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šè¯·åœ¨ **&lt;code&gt;CA_REGION&lt;/code&gt;**ç¯å¢ƒå˜é‡ä¸­è®¾ç½® AWS åŒºåŸŸï¼Œå³ä½ çš„ç§æœ‰ CA æ‰€åˆ›å»ºçš„åŒºåŸŸã€‚ä¾‹å¦‚ï¼š&lt;code&gt;export CA_REGION=us-east-1&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt; EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: awspca.cert-manager.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: AWSPCAIssuer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt; name: aws-pca-issuer-istio
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt; namespace: istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  arn: ${ISTIO_CA_ARN}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  region: ${CA_REGION}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ä¸º-istio-åˆ›å»º-ca-è¯ä¹¦cacerts-å¯†é’¥&#34;&gt;ä¸º Istio åˆ›å»º CA è¯ä¹¦ï¼ˆ&lt;code&gt;cacerts&lt;/code&gt; å¯†é’¥ï¼‰&lt;/h2&gt;
&lt;p&gt;åœ¨æ­¤è‡ªå®šä¹‰èµ„æºä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†æ‰€éœ€çš„ Istio CA è¯ä¹¦è¯¦ç»†ä¿¡æ¯ï¼Œå³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯ä¹¦çš„æŒç»­æ—¶é—´ï¼ˆTTLï¼‰ï¼Œ&lt;/li&gt;
&lt;li&gt;è¯ä¹¦åº”è‡ªåŠ¨ç»­è®¢çš„æ—¶é—´ï¼Œ&lt;/li&gt;
&lt;li&gt;ä¸»é¢˜å¤‡ç”¨åç§°ï¼ˆSANï¼‰ï¼Œ&lt;/li&gt;
&lt;li&gt;æ­¤è¯ä¹¦çš„åŸºæœ¬çº¦æŸï¼ˆisCA: trueï¼‰ï¼Œ&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆçš„è¯ä¹¦åº”å­˜å‚¨çš„ Kubernetes å¯†é’¥åç§°ï¼ˆ&lt;strong&gt;cacerts&lt;/strong&gt;ï¼‰ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;CRD çš„å‚è€ƒæ–‡æ¡£ &lt;a href=&#34;https://cert-manager.io/docs/reference/api-docs/#cert-manager.io/v1.Certificate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨æ­¤&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ä½¿ç”¨ cert-manager å’Œ aws-pca-issuer æ’ä»¶ä» AWS PCA é¢å‘ CA è¯ä¹¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt; EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: cert-manager.io/v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Certificate
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: istio-ca
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  isCA: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  duration: 720h #30å¤©
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  renewBefore: 360h #15å¤©
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  secretName: cacerts
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  commonName: istio-ca
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  dnsNames:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - &amp;#34;*.istiod-${ISTIO_REVISION}&amp;#34; # Istiod èº«ä»½
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  subject:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    organizations:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  issuerRef:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;# ---------------- Istio CA çš„ Issuer ---------------------------
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    group: awspca.cert-manager.io
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    kind: AWSPCAIssuer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    name: aws-pca-issuer-istio
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;# ---------------- Istio CA çš„ Issuer ---------------------------
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç­‰å¾…å‡ ç§’é’ŸåéªŒè¯è¯ä¹¦åˆ›å»ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system get certificate istio-ca
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system get secret cacerts
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å®‰è£…-istio&#34;&gt;å®‰è£… Istio&lt;/h2&gt;
&lt;p&gt;ä¸€æ—¦ Kubernetes å¯†é’¥ &lt;strong&gt;cacerts&lt;/strong&gt; è¢«åˆ›å»ºï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ä½¿ç”¨è¯¥è¯ä¹¦ä½œä¸º Istio çš„è‡ªå®šä¹‰ CA è¯ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;Istio å®‰è£…æ–‡æ¡£ &lt;a href=&#34;https://istio.io/latest/docs/setup/install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨æ­¤&lt;/a&gt;ã€‚å¦‚æœä½ æ˜¯ç°æœ‰çš„ Gloo Mesh ç”¨æˆ·ï¼Œå¯ä»¥æŒ‰ç…§æ­¥éª¤ä½¿ç”¨ &lt;a href=&#34;https://docs.solo.io/gloo-mesh-enterprise/latest/setup/installation/istio/gm_managed_istio/gloo_mesh_managed/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IstioLifeCycleManager å®‰è£… Istio&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²ç¤ºä¾‹åº”ç”¨ç¨‹åº&#34;&gt;éƒ¨ç½²ç¤ºä¾‹åº”ç”¨ç¨‹åº&lt;/h2&gt;
&lt;p&gt;éƒ¨ç½² &lt;a href=&#34;https://istio.io/latest/docs/examples/bookinfo/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio ç¤ºä¾‹ Bookinfo åº”ç”¨ç¨‹åº&lt;/a&gt; å¹¶éªŒè¯æ‰€ä½¿ç”¨çš„å¶å­è¯ä¹¦ç¡®å®æ¥è‡ª AWS ç§æœ‰ CA ä¸­å­˜åœ¨çš„æ ¹ CAã€‚&lt;/p&gt;
&lt;h2 id=&#34;éªŒè¯è¯ä¹¦é“¾å¹¶åŒ¹é…åºåˆ—å·&#34;&gt;éªŒè¯è¯ä¹¦é“¾å¹¶åŒ¹é…åºåˆ—å·&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl pc secrets -n bookinfo-frontends deploy/productpage-v1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  id=&#34;figure-istio-åºåˆ—å·&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio åºåˆ—å·&#34; srcset=&#34;
               /blog/istio-aws-private-ca/f4_hu_270ab66e85a57a83.webp 400w,
               /blog/istio-aws-private-ca/f4_hu_4886a10ac08b52d1.webp 760w,
               /blog/istio-aws-private-ca/f4_hu_8b196fb83209e196.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-aws-private-ca/f4_hu_270ab66e85a57a83.webp&#34;
               width=&#34;760&#34;
               height=&#34;54&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio åºåˆ—å·
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ AWS ç§æœ‰ CA æ§åˆ¶å°ä¸­ï¼Œæ ¹ CA å°†å…·æœ‰åŒ¹é…çš„åºåˆ—å·ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-aws-ç§æœ‰-ca-æ§åˆ¶å°ä¸åŒ¹é…çš„åºåˆ—å·&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;AWS ç§æœ‰ CA æ§åˆ¶å°ä¸åŒ¹é…çš„åºåˆ—å·&#34; srcset=&#34;
               /blog/istio-aws-private-ca/f5_hu_c4a6394ffc80a46e.webp 400w,
               /blog/istio-aws-private-ca/f5_hu_e68837411b707817.webp 760w,
               /blog/istio-aws-private-ca/f5_hu_58b8c9b1bfad935e.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-aws-private-ca/f5_hu_c4a6394ffc80a46e.webp&#34;
               width=&#34;760&#34;
               height=&#34;287&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      AWS ç§æœ‰ CA æ§åˆ¶å°ä¸åŒ¹é…çš„åºåˆ—å·
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½ è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥å¶å­è¯ä¹¦çš„è¯¦ç»†ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl pc secret &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -n &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;NAMESPACE&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; deploy/DEPLOYMENT_NAME -o json &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    jq &lt;span class=&#34;s1&#34;&gt;&amp;#39;[.dynamicActiveSecrets[] | select(.name == &amp;#34;default&amp;#34;)][0].secret.tlsCertificate.certificateChain.inlineBytes&amp;#39;&lt;/span&gt; -r &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    base64 -d &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    openssl x509 -noout -text
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;è°ƒè¯•å»ºè®®&#34;&gt;è°ƒè¯•å»ºè®®&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šå°½ç®¡åˆ›å»ºäº†æ‰€éœ€çš„è‡ªå®šä¹‰èµ„æºï¼Œä½† Kubernetes å¯†é’¥ cacerts æœªè¢«åˆ›å»ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ£€æŸ¥ AWSPCAIssuer å¯¹è±¡çš„çŠ¶æ€åº”è¯¥ä¼šæœ‰æ‰€å¸®åŠ©ã€‚&lt;/li&gt;
&lt;li&gt;å»ºè®®å®¡æŸ¥ AWSPCAIssuer è§„èŒƒã€‚&lt;/li&gt;
&lt;li&gt;å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ Certificate å¯¹è±¡æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªç›¸å…³çš„ CertificateRequest å¯¹è±¡ã€‚CertificateRequest å¯¹è±¡çš„çŠ¶æ€åŒ…å«æœ‰ç”¨çš„è°ƒè¯•ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;è¿˜å»ºè®®æ£€æŸ¥ cert manager å’Œ AWS PCA Issuer æ’ä»¶çš„æ—¥å¿—ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Istio 1.23 å‘å¸ƒï¼šç¯å¢ƒæ¨¡å¼å‡çº§ä¸é‡è¦åŠŸèƒ½æ›´æ–°</title>
      <link>https://cloudnativecn.com/blog/istio-1-23-release/</link>
      <pubDate>Fri, 16 Aug 2024 07:52:21 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-1-23-release/</guid>
      <description>&lt;p&gt;2024 å¹´ 8 æœˆ 16 æ—¥ï¼ŒIstio 1.23 å‘å¸ƒã€‚è¯¥ç‰ˆæœ¬å¸¦æ¥äº†ç¯å¢ƒæ¨¡å¼çš„é‡å¤§æ”¹è¿›ï¼ŒåŒ…æ‹¬æ€§èƒ½æå‡ã€åŠŸèƒ½å¢å¼ºä»¥åŠ DNS è‡ªåŠ¨åˆ†é…å’Œé‡è¯•ç­–ç•¥çš„ä¼˜åŒ–ï¼ŒåŒæ—¶å®£å¸ƒé›†ç¾¤å†… Operator å°†è¢«å¼ƒç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¯å¢ƒæ¨¡å¼&#34;&gt;ç¯å¢ƒæ¨¡å¼&lt;/h2&gt;
&lt;p&gt;ç´§éšæœ€è¿‘å°† &lt;a href=&#34;https://istio.io/latest/blog/2024/ambient-reaches-beta/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¯å¢ƒæ¨¡å¼å‡çº§åˆ° Istio 1.22 çš„ Beta ç‰ˆ&lt;/a&gt;ä¹‹åï¼ŒIstio 1.23 å¸¦æ¥äº†ä¸€ç³»åˆ—é‡å¤§æ”¹è¿›ã€‚åœ¨ä¸ä¼—å¤šé‡‡ç”¨ç¯å¢ƒæ¨¡å¼çš„ç”¨æˆ·ç´§å¯†åˆä½œçš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨åŠªåŠ›è§£å†³æ”¶åˆ°çš„æ‰€æœ‰åé¦ˆã€‚è¿™äº›æ”¹è¿›åŒ…æ‹¬æ›´å¹¿æ³›çš„å¹³å°æ”¯æŒã€æ–°å¢åŠŸèƒ½ã€é”™è¯¯ä¿®å¤å’Œæ€§èƒ½æ”¹å–„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€å°éƒ¨åˆ†äº®ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ waypoint ä»£ç†ä¸­æ”¯æŒ &lt;code&gt;DestinationRule&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ waypoint å’Œ ztunnel ä¸­æ”¯æŒ DNS &lt;code&gt;ServiceEntries&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒè·¨å‘½åç©ºé—´å…±äº« waypointã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒæ–°çš„ &lt;code&gt;Service&lt;/code&gt; å­—æ®µ &lt;code&gt;trafficDistribution&lt;/code&gt;ï¼Œå…è®¸ä¿æŒæµé‡åœ¨æœ¬åœ°åŒºåŸŸ/åœ°åŒºã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒåŒæ ˆå’Œ IPv6 é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;ä¸º ztunnel æä¾›ä¸€ä¸ªæ–°çš„ Grafana ä»ªè¡¨æ¿ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ª Helm chartï¼Œç”¨äºä¸€æ¬¡æ€§å®‰è£…æ‰€æœ‰ç¯å¢ƒæ¨¡å¼ç»„ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;æ€§èƒ½æ”¹è¿›ï¼šæˆ‘ä»¬çš„æµ‹è¯•æ˜¾ç¤ºä¸ Istio 1.22 ç›¸æ¯”ï¼Œååé‡æé«˜äº†é«˜è¾¾ 50%ã€‚&lt;/li&gt;
&lt;li&gt;å¤§é‡çš„é”™è¯¯ä¿®å¤ï¼šæ”¹å–„ pod å¯åŠ¨ã€æ”¯æŒæ— é€‰æ‹©å™¨çš„ Servicesã€æ”¹å–„æ—¥å¿—è®°å½•ç­‰ï¼&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;dns-è‡ªåŠ¨åˆ†é…æ”¹è¿›&#34;&gt;DNS è‡ªåŠ¨åˆ†é…æ”¹è¿›&lt;/h3&gt;
&lt;p&gt;å¤šå¹´æ¥ï¼ŒIstio ä¸€ç›´æœ‰ä¸€ä¸ª &lt;a href=&#34;https://istio.io/latest/docs/ops/configuration/traffic-management/dns-proxy/#address-auto-allocation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ°å€åˆ†é…é€‰é¡¹&lt;/a&gt;ç”¨äº DNS ä»£ç†æ¨¡å¼ã€‚è¿™è§£å†³äº†ä¸€äº›æœåŠ¡è·¯ç”±çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio 1.23 ä¸­ï¼Œæ–°å¢äº†è¿™ä¸ªåŠŸèƒ½çš„å®ç°æ–¹å¼ã€‚åœ¨æ–°çš„æ–¹æ³•ä¸­ï¼Œåˆ†é…çš„ IP åœ°å€ä¼šæŒä¹…ä¿å­˜åœ¨ &lt;code&gt;ServiceEntry&lt;/code&gt; çš„ &lt;code&gt;status&lt;/code&gt; å­—æ®µä¸­ï¼Œç¡®ä¿å®ƒä»¬ä¸ä¼šæ”¹å˜ã€‚è¿™è§£å†³äº†æ—§æ–¹æ³•çš„é•¿æœŸå¯é æ€§é—®é¢˜ï¼Œå…¶ä¸­åˆ†é…æœ‰æ—¶ä¼šéšæœºæ›´æ¢å¹¶å¯¼è‡´é—®é¢˜ã€‚æ­¤å¤–ï¼Œè¿™ç§æ–¹æ³•æ›´æ ‡å‡†ï¼Œæ›´æ˜“äºè°ƒè¯•ï¼Œå¹¶ä½¿è¯¥åŠŸèƒ½ä¸ç¯å¢ƒæ¨¡å¼å…¼å®¹ï¼&lt;/p&gt;
&lt;p&gt;åœ¨ 1.23 ç‰ˆæœ¬ä¸­ï¼Œæ­¤æ¨¡å¼é»˜è®¤å…³é—­ï¼Œä½†å¯ä»¥é€šè¿‡ &lt;code&gt;PILOT_ENABLE_IP_AUTOALLOCATE=true&lt;/code&gt; å¯ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é‡è¯•æ”¹è¿›é¢„è§ˆ&#34;&gt;é‡è¯•æ”¹è¿›é¢„è§ˆ&lt;/h3&gt;
&lt;p&gt;åœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œå®ç°äº†å¯¹é»˜è®¤é‡è¯•ç­–ç•¥çš„æ”¹è¿›çš„åŠŸèƒ½é¢„è§ˆã€‚å†å²ä¸Šï¼Œé‡è¯•ä»…åœ¨ &lt;em&gt;å‡ºç«™&lt;/em&gt; æµé‡ä¸Šè¿›è¡Œã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä½ æƒ³è¦çš„ï¼šè¯·æ±‚å¯ä»¥é‡è¯•åˆ°ä¸åŒçš„ podï¼Œè¿™æœ‰æ›´å¥½çš„æˆåŠŸæœºä¼šã€‚ç„¶è€Œï¼Œè¿™ç•™ä¸‹äº†ä¸€ä¸ªç¼ºå£ï¼šç»å¸¸åœ°ï¼Œä¸€ä¸ªè¯·æ±‚ä¼šå¤±è´¥ï¼Œä»…ä»…å› ä¸ºåº”ç”¨ç¨‹åºå·²ç»å…³é—­äº†æˆ‘ä»¬ä¿æŒæ´»åŠ¨çš„å¹¶å°è¯•é‡ç”¨çš„è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»æ·»åŠ äº†æ£€æµ‹è¿™ç§æƒ…å†µï¼Œå¹¶é‡è¯•çš„åŠŸèƒ½ã€‚è¿™é¢„è®¡ä¼šå‡å°‘ç½‘æ ¼ä¸­å¸¸è§çš„ 503 é”™è¯¯çš„æ¥æºã€‚&lt;/p&gt;
&lt;p&gt;è¿™å¯ä»¥é€šè¿‡ &lt;code&gt;ENABLE_INBOUND_RETRY_POLICY=true&lt;/code&gt; å¯ç”¨ã€‚é¢„è®¡åœ¨æœªæ¥ç‰ˆæœ¬ä¸­é»˜è®¤å¯ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;bookinfo-çš„æ–°æ¶‚è£…&#34;&gt;Bookinfo çš„æ–°æ¶‚è£…&lt;/h3&gt;
&lt;p&gt;1.23 ç‰ˆæœ¬çš„æ”¹è¿›ä¸ä»…é™äº Istio æœ¬èº«ï¼šåœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œå¤§å®¶å–œçˆ±çš„ç¤ºä¾‹åº”ç”¨ Bookinfo ä¹Ÿè¿›è¡Œäº†ç¿»æ–°ï¼&lt;/p&gt;
&lt;p&gt;æ–°çš„åº”ç”¨ç‰¹æ€§æ›´ç°ä»£çš„è®¾è®¡ï¼Œå¹¶ä¸”æ€§èƒ½æ”¹è¿›è§£å†³äº† &lt;code&gt;productpage&lt;/code&gt; å’Œ &lt;code&gt;details&lt;/code&gt; æœåŠ¡ä¸­çš„ä¸€äº›æ„å¤–ç¼“æ…¢é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ”¹è¿›åçš„-bookinfo-åº”ç”¨&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ”¹è¿›åçš„ Bookinfo åº”ç”¨&#34; srcset=&#34;
               /blog/istio-1-23-release/bookinfo-browser_hu_430cc8fbc261f93a.webp 400w,
               /blog/istio-1-23-release/bookinfo-browser_hu_8582d644ea10da1c.webp 760w,
               /blog/istio-1-23-release/bookinfo-browser_hu_68d458f55eacb060.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-1-23-release/bookinfo-browser_hu_430cc8fbc261f93a.webp&#34;
               width=&#34;760&#34;
               height=&#34;462&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ”¹è¿›åçš„ Bookinfo åº”ç”¨
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;å…¶ä»–äº®ç‚¹&#34;&gt;å…¶ä»–äº®ç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;a href=&#34;https://github.com/wolfi-dev&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Wolfi&lt;/a&gt; å®¹å™¨åŸºç¡€ OS å‡çº§äº†æ— å‘è¡Œç‰ˆé•œåƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;istioctl proxy-status&lt;/code&gt; å‘½ä»¤è¿›è¡Œäº†æ”¹è¿›ï¼ŒåŒ…æ‹¬è‡ªæœ€åæ›´æ”¹ä»¥æ¥çš„æ—¶é—´ï¼Œä»¥åŠæ›´å¤šç›¸å…³çš„çŠ¶æ€å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¼ƒç”¨é›†ç¾¤å†…-operator&#34;&gt;å¼ƒç”¨é›†ç¾¤å†… Operator&lt;/h2&gt;
&lt;p&gt;ä¸‰å¹´å‰ï¼Œæˆ‘ä»¬ &lt;a href=&#34;https://istio.io/latest/docs/setup/install/operator/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ›´æ–°äº†æˆ‘ä»¬çš„æ–‡æ¡£&lt;/a&gt;ï¼Œä¸é¼“åŠ±åœ¨æ–°çš„ Istio å®‰è£…ä¸­ä½¿ç”¨é›†ç¾¤å†… operatorã€‚æˆ‘ä»¬ç°åœ¨å‡†å¤‡åœ¨ Istio 1.23 ä¸­æ­£å¼æ ‡è®°å®ƒä¸ºå·²å¼ƒç”¨ã€‚åˆ©ç”¨ operator çš„ç”¨æˆ· â€” æˆ‘ä»¬ä¼°è®¡ä¸åˆ°æˆ‘ä»¬ç”¨æˆ·åŸºç¡€çš„ 10% â€” å°†éœ€è¦è¿ç§»åˆ°å…¶ä»–å®‰è£…å’Œå‡çº§æœºåˆ¶ï¼Œä»¥ä¾¿å‡çº§åˆ° Istio 1.24 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚1.24 ç‰ˆæœ¬çš„é¢„è®¡å‘å¸ƒæ—¥æœŸä¸º 2024 å¹´ 11 æœˆã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å»ºè®®ç”¨æˆ·è½¬ç§»åˆ° Helm å’Œ istioctlï¼Œè¿™äº›ä»ç„¶å¾—åˆ° Istio é¡¹ç›®çš„æ”¯æŒã€‚è¿ç§»åˆ° istioctl æ˜¯å¾®ä¸è¶³é“çš„ï¼›è¿ç§»åˆ° Helm å°†éœ€è¦å·¥å…·ï¼Œæˆ‘ä»¬å°†åœ¨ 1.24 å‘å¸ƒæ—¶å‘å¸ƒã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›ç»§ç»­ä½¿ç”¨ operator æ¨¡å¼çš„ç”¨æˆ·åœ¨ &lt;a href=&#34;https://github.com/istio-ecosystem/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;istio-ecosystem&lt;/a&gt; ç»„ç»‡ä¸­æœ‰ä¸¤ä¸ªç¬¬ä¸‰æ–¹é€‰é¡¹ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æŸ¥çœ‹ &lt;a href=&#34;https://istio.io/latest/blog/2024/in-cluster-operator-deprecation-announcement/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘ä»¬çš„å¼ƒç”¨å…¬å‘Šåšå®¢æ–‡ç« &lt;/a&gt;ï¼Œä»¥è·å–æ›´å¤šå…³äºå˜æ›´çš„è¯¦æƒ…ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºæœ¬æ¬¡å‘å¸ƒçš„è¯¦æƒ…è¯·è§ &lt;a href=&#34;https://istio.io/latest/news/releases/1.23.x/announcing-1.23/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åšå®¢&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æ— éœ€ Kubernetes æµ‹è¯• Kubernetes ç½‘ç»œå®ç°</title>
      <link>https://cloudnativecn.com/blog/ztunnel-testing/</link>
      <pubDate>Mon, 22 Jul 2024 18:46:32 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/ztunnel-testing/</guid>
      <description>&lt;p&gt;ç”±äºåœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ‘&lt;a href=&#34;https://blog.howardjohn.info/posts/ideal-ci/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çœŸçš„ä¸å–œæ¬¢ç­‰å¾…&lt;/a&gt;ï¼Œæ‰€ä»¥åœ¨æ„å»º Ztunnelï¼ˆä¸€ä¸ªä¸º Istio çš„æ–°&lt;a href=&#34;https://istio.io/latest/blog/2022/introducing-ambient-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambient æ¨¡å¼&lt;/a&gt;è®¾è®¡çš„åº•å±‚ç½‘ç»œä»£ç†ï¼‰æ—¶ï¼Œæˆ‘çš„é¦–è¦ä»»åŠ¡ä¹‹ä¸€ä¾¿æ˜¯ç¡®ä¿æµ‹è¯•çš„å¿«é€Ÿè¿›è¡Œï¼ˆåŒ…æ‹¬è¿è¡Œå’Œç¼–å†™æµ‹è¯•ï¼‰ï¼Œå¹¶ä¸”æ˜“äºè°ƒè¯•ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸€ä»»åŠ¡é¢‡ä¸ºæ£˜æ‰‹ï¼Œå› ä¸ºåœ¨å¤§å¤šæ•°çœŸå®åœºæ™¯ä¸­ï¼ŒZtunnel é«˜åº¦ä¾èµ– Kubernetesã€‚è™½ç„¶å®ƒèƒ½å¤Ÿå®Œå…¨ç‹¬ç«‹äº Kubernetes è¿è¡Œï¼Œä½†è®¸å¤šå…³é”®ä»£ç è·¯å¾„çš„è¡Œä¸ºå®Œå…¨ä¸åŒï¼Œä½¿å¾—ä»…é€šè¿‡è¿™ç§æ–¹å¼è¿›è¡Œæµ‹è¯•å˜å¾—ä¸å¯è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾ä¸ºå…¸å‹çš„ Ztunnel éƒ¨ç½²æ¶æ„ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ztunnel-æ¶æ„æ¦‚è§ˆ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Ztunnel æ¶æ„æ¦‚è§ˆ&#34;
           src=&#34;https://cloudnativecn.com/blog/ztunnel-testing/ztunnel-architecture.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Ztunnel æ¶æ„æ¦‚è§ˆ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤æ¶æ„ä¸­ï¼Œç”¨æˆ·å°†è¿è¡Œä¸€ä¸ªåŒ…å«å¤šä¸ªèŠ‚ç‚¹çš„ Kubernetes é›†ç¾¤ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œç€ä¸€ä¸ª Ztunnelï¼Œé…ç½®äº†å®¿ä¸»æœºå’Œæ¯ä¸ª pod çš„ç½‘ç»œæ ˆã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼ŒZtunnel å®é™…ä¸Šè¿›å…¥äº†æ¯ä¸ª pod çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œå¹¶ä»£è¡¨å…¶å‘é€/æ¥æ”¶æµé‡ã€‚è¿™ä¸€ç‚¹éå¸¸å¥‡ç‰¹ä¸”é…·ç‚«ï¼Œä½†ä¹Ÿå¤§å¤§å¢åŠ äº†æµ‹è¯•çš„éš¾åº¦ï¼ï¼ˆ&lt;a href=&#34;https://www.youtube.com/watch?v=cuMeEhpyH5s&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯¦ç»†ä¿¡æ¯&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;åŠ é€Ÿæµ‹è¯•&#34;&gt;åŠ é€Ÿæµ‹è¯•&lt;/h2&gt;
&lt;p&gt;å¯åŠ¨å®Œæ•´çš„ Kubernetes ç¯å¢ƒã€é‡å»ºé•œåƒã€éƒ¨ç½²åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„è¿‡ç¨‹éå¸¸ç¼“æ…¢ä¸”éš¾ä»¥è°ƒè¯•ã€‚&lt;/p&gt;
&lt;p&gt;é»„é‡‘æ ‡å‡†åº”è¯¥æ˜¯å°†æ‰€æœ‰æ“ä½œè¿è¡Œåœ¨ä¸€ä¸ªç®€å•çš„å•ä¸€äºŒè¿›åˆ¶æ–‡ä»¶ä¸­â€”â€”ä»…éœ€æ‰§è¡Œ &lt;code&gt;cargo test&lt;/code&gt;ã€‚è¿™ç§æ–¹å¼é¿å¼€äº†å¤æ‚çš„è®¾ç½®å’Œç¼“æ…¢çš„é‡å»ºï¼Œå¹¶ä½¿è°ƒè¯•å˜å¾—è½»è€Œæ˜“ä¸¾ï¼ˆå½“ç„¶ï¼Œä½ å¯ä»¥å°†è°ƒè¯•å™¨è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„ podï¼Œä½†è¿™å¾ˆéº»çƒ¦ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è®¾ç½®ç½‘ç»œ&#34;&gt;è®¾ç½®ç½‘ç»œ&lt;/h2&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬å»é™¤æ— å°½çš„æŠ½è±¡å±‚ï¼ŒKubernetes pods å®é™…ä¸Šåªæ˜¯å‡ ä¸ª Linux å‘½åç©ºé—´å’ŒæŒ‚è½½çš„ç»„åˆã€‚Docker åœ¨è¿™æ–¹é¢ç®¡ç†å¾—å¾ˆå¥½ï¼Œ&lt;a href=&#34;https://github.com/p8952/bocker&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bash&lt;/a&gt;ä¹Ÿå¯ä»¥ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç‰¹åˆ«å…³æ³¨çš„æ˜¯&lt;a href=&#34;https://man7.org/linux/man-pages/man7/network_namespaces.7.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘ç»œå‘½åç©ºé—´&lt;/a&gt;ï¼Œå®ƒå¯ä»¥å®ç°ç½‘ç»œæ ˆçš„éš”ç¦»ã€‚æ¯ä¸ª pod éƒ½æœ‰è‡ªå·±çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œé€šè¿‡å„ç§æœºåˆ¶è¿æ¥ï¼Œå…è®¸ä¸åŒä¸€èŠ‚ç‚¹ä¸Šçš„å…¶ä»– podã€å…¶ä»–èŠ‚ç‚¹ä»¥åŠå¤–éƒ¨ç›®çš„åœ°é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;å¥½æ¶ˆæ¯æ˜¯åˆ›å»ºç½‘ç»œå‘½åç©ºé—´éå¸¸ç®€å•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo ip netns add testing
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡æ˜¯è®¾ç½®ä¸€ç³»åˆ—çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œå¤–è§‚ä¸æˆ‘ä»¬åœ¨ Kubernetes ä¸Šçš„çœŸå®æ¶æ„ç±»ä¼¼ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ‰€éœ€çš„ç½‘ç»œå‘½åç©ºé—´è®¾ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ‰€éœ€çš„ç½‘ç»œå‘½åç©ºé—´è®¾ç½®&#34;
           src=&#34;https://cloudnativecn.com/blog/ztunnel-testing/ztunnel-network-namespaces.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ‰€éœ€çš„ç½‘ç»œå‘½åç©ºé—´è®¾ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ç½‘ç»œå‘½åç©ºé—´ä¹‹é—´å»ºç«‹è¿æ¥ç¨å¾®å¤æ‚ä¸€äº›ã€‚åƒ &lt;a href=&#34;https://www.cni.dev/docs/cnitool/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;cnitool&lt;/code&gt;&lt;/a&gt; è¿™æ ·çš„å·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆï¼ˆå®ƒå®é™…ä¸Šæ‰§è¡Œäº†ä¸€äº› Kubernetes ç¯å¢ƒä¸­ç”¨äºè®¾ç½®ç½‘ç»œçš„ç›¸åŒé€»è¾‘ï¼Œä½†ä½œä¸º CLI å·¥å…·ï¼‰ï¼Œä½†ä½ ä¹Ÿå¯ä»¥å®Œå…¨æ‰‹åŠ¨æ“ä½œã€‚æˆ‘ä»¬é€‰æ‹©äº†åè€…ã€‚&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆï¼Œæˆ‘ä»¬çš„è®¾ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ªæµ‹è¯•éƒ½æ‹¥æœ‰è‡ªå·±çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œé€šè¿‡ä¸€ä¸ªæ¡¥æ¥è®¾å¤‡ï¼ˆ&lt;code&gt;br0&lt;/code&gt;ï¼‰æ¥ä¿ƒè¿›èŠ‚ç‚¹ä¹‹é—´çš„æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªèŠ‚ç‚¹é…ç½®äº†ä¸€ä¸ª &lt;code&gt;veth&lt;/code&gt; è®¾å¤‡ã€‚ä¸€ç«¯æˆä¸ºèŠ‚ç‚¹ä¸Šçš„ &lt;code&gt;eth0&lt;/code&gt;ï¼Œå¦ä¸€ç«¯è¿æ¥åˆ°æ ¹å‘½åç©ºé—´ä¸­çš„ &lt;code&gt;br0&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ª pod éƒ½é…ç½®äº†ä¸€ä¸ª &lt;code&gt;veth&lt;/code&gt; è®¾å¤‡ã€‚ä¸€ç«¯æˆä¸º pod ä¸Šçš„ &lt;code&gt;eth0&lt;/code&gt;ï¼Œå¦ä¸€ç«¯ä½äºèŠ‚ç‚¹ç½‘ç»œå‘½åç©ºé—´ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºæ¯ä¸ª pod è®¾ç½®è·¯ç”±ä»¥å°†æµé‡å‘é€åˆ°èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºæ¯å¯¹èŠ‚ç‚¹è®¾ç½®è·¯ç”±ï¼Œä»¥å®ç°è·¨èŠ‚ç‚¹æµé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ‰€éœ€çš„ç½‘ç»œè¿æ¥è®¾ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ‰€éœ€çš„ç½‘ç»œè¿æ¥è®¾ç½®&#34;
           src=&#34;https://cloudnativecn.com/blog/ztunnel-testing/ztunnel-network-devices.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ‰€éœ€çš„ç½‘ç»œè¿æ¥è®¾ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é™¤äº†æ ¹å‘½åç©ºé—´/æ¡¥æ¥è®¾å¤‡å¤–ï¼Œè¿™ä¸è®¸å¤šç°å®ä¸–ç•Œä¸­çš„ Kubernetes é›†ç¾¤çš„è¿è¡Œæ–¹å¼ç›¸åŒï¼ˆåœ¨ç°å®ä¸–ç•Œä¸­ï¼Œæ ¹å‘½åç©ºé—´æ˜¯ä¸¤å°æœºå™¨ä¹‹é—´çš„ç‰©ç†ç½‘ç»œï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥åœ¨&lt;a href=&#34;https://github.com/istio/ztunnel/blob/34fce85a6a2b2a85eb170a04096731e2ea4e0e9f/src/test_helpers/netns.rs#L194&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ°æ‰€æœ‰ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿è¡Œæµ‹è¯•&#34;&gt;è¿è¡Œæµ‹è¯•&lt;/h2&gt;
&lt;p&gt;ä¸€æ—¦æˆ‘ä»¬æœ‰äº†è¿™äº›å‘½åç©ºé—´ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ä¸€ç§å®é™…ä½¿ç”¨å®ƒä»¬çš„æ–¹æ³•ã€‚å¹¸è¿çš„æ˜¯ï¼ŒLinux å…è®¸åœ¨è¿è¡Œæ—¶æ›´æ”¹å½“å‰å‘½åç©ºé—´çº¿ç¨‹ï¼ˆè¿™æ˜¯æ¥ä¸‹æ¥é‡è¦çš„å†…å®¹ï¼‰ã€‚è¿™è®©æˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªåŸºæœ¬çš„å¸®åŠ©å‡½æ•°ï¼ˆçœŸå®çš„ä»£ç ç¨å¾®æ›´å¤æ‚ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;run_in_namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;namespace&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;Fn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;original_namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_current_namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;enter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;original_namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;enter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ä»ä»»æ„çš„â€œpodsâ€æˆ–â€œnodesâ€æ‰§è¡Œä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œæˆ‘ä»¬ä»ç„¶é¢ä¸´ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬çš„æ‰€æœ‰ä»£ç éƒ½è¿è¡Œåœ¨ &lt;a href=&#34;https://tokio.rs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tokio&lt;/a&gt; å¼‚æ­¥è¿è¡Œæ—¶ä¸­ï¼Œå®ƒä¼šæ ¹æ®éœ€è¦å°†æˆ‘ä»¬çš„å„ç§ä»»åŠ¡å®‰æ’åˆ°ç‰©ç†æ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸Šï¼ˆç±»ä¼¼äº Go è¿è¡Œæ—¶çš„å·¥ä½œæ–¹å¼ï¼‰ã€‚ç”±äºç½‘ç»œå‘½åç©ºé—´æ˜¯çº¿ç¨‹ç›¸å…³çš„ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬çš„ä»»åŠ¡åœ¨çº¿ç¨‹ä¹‹é—´è·³è½¬æ—¶ï¼Œè¿™ä¸€åˆ‡éƒ½ä¼šå´©æºƒã€‚&lt;/p&gt;
&lt;p&gt;å¹¸è¿çš„æ˜¯ï¼ŒRust ç»™äº†æˆ‘ä»¬æ¯” Go æ›´å¤šçš„å…³äºå¼‚æ­¥è¿è¡Œæ—¶çš„çµæ´»æ€§â€”â€”æˆ‘ä»¬å¯ä»¥åŒæ—¶æ‹¥æœ‰å¤šä¸ªï¼å€Ÿæ­¤ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ„å»ºä¸€ä¸ªèƒ½å¤Ÿå¼‚æ­¥æ‰§è¡Œ &lt;code&gt;run_in_namespace&lt;/code&gt;ã€‚å¯¹äºæˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„æ¯ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹å¹¶æ„å»ºä¸€ä¸ªä¸“ç”¨çš„å•çº¿ç¨‹å¼‚æ­¥è¿è¡Œæ—¶æ¥å¤„ç†å®ƒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;async&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;async_run_in_namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;namespace&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;: &lt;span class=&#34;nc&#34;&gt;async&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Fn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;thread&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;spawn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;move&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;run_in_namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rt&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tokio&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;runtime&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;Builder&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;new_current_thread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;enable_all&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;block_on&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä¸ºæ¯ä¸ªå‘½åç©ºé—´è¿è¡Œä¸€æ¬¡è¿™ä¸ªå‡½æ•°ï¼Œå› æ­¤è¿™é‡Œçš„å¼€é”€æ˜¯æœ€å°çš„ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦è¿è¡Œè®¸å¤šå°å‡½æ•°ï¼Œå¯ä»¥åœ¨é¡¶å±‚æ„å»ºä¸€ä¸ªæŠ½è±¡æ¥å‘é€å·¥ä½œåˆ°çº¿ç¨‹ä»¥æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦çš„æœ€åä¸€ä»¶äº‹æ˜¯ä¸€ç§åˆç†çš„æ–¹æ³•æ¥è¯†åˆ«å¦‚ä½•è°ƒç”¨æ¯ä¸ªç›®çš„åœ°ã€‚è™½ç„¶å®ƒä»¬éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ª IPï¼ˆåŸºäºæˆ‘ä»¬ä»£ç ä¸­çš„ç®€å• IPAM ç­–ç•¥ï¼‰ï¼Œä½†æˆ‘ä»¬ä¸å¸Œæœ›æ¯ä¸ªæµ‹è¯•éƒ½å¿…é¡»çŒœæµ‹ IPã€‚ä¸ºäº†å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªç®€å•çš„åç§°è§£æå™¨ã€‚è¿™å°±åƒ DNSï¼Œä½†ç®€å•å¾—å¤šï¼šå¯¹äºæˆ‘ä»¬åˆ›å»ºçš„æ¯ä¸ªâ€œpodâ€ï¼Œæˆ‘ä»¬è®°å½•ä¸€ä¸ª&lt;code&gt;name -&amp;gt; IP&lt;/code&gt;çš„æ˜ å°„ï¼Œå¹¶å…è®¸æŸ¥æ‰¾ IPã€‚&lt;/p&gt;
&lt;p&gt;å°†æ‰€æœ‰è¿™äº›æ”¾åœ¨ä¸€èµ·ï¼Œä¸€ä¸ªç®€å•çš„æµ‹è¯•å¯åŠ¨äº†3ä¸ª podsï¼ˆå®¢æˆ·ç«¯ã€æœåŠ¡å™¨å’Œ ztunnelï¼‰åœ¨ä¸€ä¸ªå•ä¸€èŠ‚ç‚¹ä¸Šçœ‹èµ·æ¥åƒè¿™æ ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#[tokio::test]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;async&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;fn&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;simple_test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ztunnel&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;deploy_ztunnel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;DEFAULT_NODE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;await&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;workload_builder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;server&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;DEFAULT_NODE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;register&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;await&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;run_tcp_server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;workload_builder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;client&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;DEFAULT_NODE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;register&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;await&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;run_tcp_client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;resolve&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;server&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// ... some assertions here }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ”¾å¼ƒæƒé™&#34;&gt;æ”¾å¼ƒæƒé™&lt;/h2&gt;
&lt;p&gt;ä¸Šè¿°è®¾ç½®æ•ˆæœå¾ˆå¥½ï¼Œä½†ä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;åŸºæœ¬ä¸Šè®¾ç½®çš„æ¯ä¸€æ­¥éƒ½éœ€è¦æå‡çš„ root æƒé™ï¼›è¿™è®©ç®€å•çš„ &lt;code&gt;cargo test&lt;/code&gt; æ¡ˆä¾‹çš„å¼€ç®±å³ç”¨å˜å¾—ä¹å‘³ï¼Œé€šå¸¸ä¹Ÿä¸å¯å–ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œè¿™ä¼šåœ¨ä¸»æœºç¯å¢ƒä¸­æ±¡æŸ“å¤§é‡çš„å‘½åç©ºé—´ã€‚è™½ç„¶æˆ‘ä»¬æœ‰ä¸€äº›æ¸…ç†è¿‡ç¨‹ï¼Œä½†è¿™äº›å¹¶ä¸æ˜¯100%å¯é ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ‚¬æŒ‚çš„å‘½åç©ºé—´é˜»ç¢æœªæ¥çš„æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³æ‹¥æœ‰å¤ªå¤šå‘½åç©ºé—´çš„é—®é¢˜çš„æ–¹æ³•ï¼Ÿæ›´å¤šçš„å‘½åç©ºé—´ï¼ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦çš„ä¸ä»…ä»…æ˜¯ç½‘ç»œå‘½åç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://man7.org/linux/man-pages/man7/user_namespaces.7.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç”¨æˆ·å‘½åç©ºé—´&lt;/a&gt; å…è®¸æˆ‘ä»¬å®è´¨ä¸Šå‡è£…æ˜¯ UID 0 (root)ï¼ŒåŒæ—¶å®é™…ä¸Šå°†å…¶æ˜ å°„å›æˆ‘ä»¬åŸå§‹çš„ UIDã€‚è¿™é‡Œçš„åŠ›é‡åœ¨äºï¼Œåœ¨è¯¥å‘½åç©ºé—´ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›æœ¬æ¥éœ€è¦ root æƒé™çš„äº‹æƒ…â€”â€”ç‰¹åˆ«æ˜¯åˆ›å»ºæ–°çš„ç½‘ç»œå‘½åç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œæˆ‘ä»¬ä¸èƒ½åšçš„ä¸€ä»¶äº‹æ˜¯ä¿®æ”¹ä¸»æœº-root æ‹¥æœ‰çš„æ–‡ä»¶ï¼ˆè¿™å°†æ˜¯æ˜æ˜¾çš„æƒé™è¿è§„ï¼‰ã€‚å°½ç®¡æˆ‘ä»¬å¯èƒ½å¯ä»¥ç»•è¿‡å®ƒä»¬ï¼Œä½†æˆ‘ä»¬åœ¨æµ‹è¯•ä¸­ä½¿ç”¨çš„å¾ˆå¤šå·¥å…·å–œæ¬¢è§¦æ‘¸ root æ–‡ä»¶ã€‚è¿™å†æ¬¡å¯ä»¥é€šè¿‡ &lt;a href=&#34;https://man7.org/linux/man-pages/man7/mount_namespaces.7.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mount å‘½åç©ºé—´&lt;/a&gt; è§£å†³ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†æˆ‘ä»¬æ‹¥æœ‰çš„æ–‡ä»¶ç»‘å®šæŒ‚è½½åˆ°ä¸»æœº-root æ‹¥æœ‰çš„æ–‡ä»¶ä¸Šï¼Œè€Œä¸ä¼šå½±å“å‘½åç©ºé—´å¤–çš„äº‹ç‰©ã€‚&lt;/p&gt;
&lt;p&gt;å°†æ‰€æœ‰è¿™äº›æ”¾åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬æœ‰è¿™æ ·çš„ä¸œè¥¿ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;original_uid&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_uid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// é¦–å…ˆï¼Œè¿›å…¥ä¸€ä¸ªæ–°çš„ç”¨æˆ·å‘½åç©ºé—´ã€‚ unshare(CloneFlags::CLONE_NEWUSER).unwrap(); // å°†ç”¨æˆ·å‘½åç©ºé—´ä¸­çš„ root æ˜ å°„åˆ°æˆ‘ä»¬åŸå§‹çš„ UID File::create(&amp;#34;/proc/self/uid_map&amp;#34;).write(format!(&amp;#34;0 {original_uid} 1&amp;#34;)); // è®¾ç½®ä¸€ä¸ªæ–°çš„ç½‘ç»œå‘½åç©ºé—´ unshare(CloneFlags::CLONE_NEWNET).unwrap(); // è®¾ç½®ä¸€ä¸ªæ–°çš„æŒ‚è½½å‘½åç©ºé—´ unshare(CloneFlags::CLONE_NEWNS).unwrap(); // å°†ä¸€ä¸ªæ–‡ä»¶å¤¹åœ¨æˆ‘ä»¬çš„æ¯ä¸ªæµ‹è¯•ç›®å½•ä¸­æŒ‚è½½åˆ° /var/run/netns mount(tmp_dir.join(&amp;#34;netns&amp;#34;), &amp;#34;/var/run/netns&amp;#34;, MS_BIND); // ä¸€ä¸ªæ–¹ä¾¿æ‰‹åŠ¨è°ƒè¯•çš„å¥½å¸®æ‰‹ä¿¡æ¯ï¼Œå¦‚æœéœ€è¦çš„è¯ã€‚ let pid = get_pid(); eprintln!(&amp;#34;Starting test in {tmp_dir}. Debug with `sudo nsenter --mount --net -t {pid}`&amp;#34;);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸Šæ‰€è¿°ï¼Œä¸€ä¸ªæŠ€å·§æ˜¯ï¼Œè¿›å…¥å‘½åç©ºé—´æ˜¯æŒ‰çº¿ç¨‹è¿›è¡Œçš„ã€‚æˆ‘ä»¬éœ€è¦åœ¨ç”Ÿæˆä»»ä½•é¢å¤–çº¿ç¨‹ä¹‹å‰è®¾ç½®è¿™ä¸€ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;Rust å®é™…ä¸Šä¸ºæˆ‘ä»¬æä¾›äº†è¿™æ ·åšçš„èƒ½åŠ›ï¼Œä½†è¿™æ„å‘³ç€æˆ‘ä»¬å¤±å»äº† &lt;code&gt;#[tokio::test]&lt;/code&gt; å®å¸®åŠ©ã€‚æˆ‘ä»¬å¯ä»¥å†™è‡ªå·±çš„å®ï¼Œä½†è¿™æœ‰ç‚¹ç—›è‹¦ã€‚å¹¸è¿çš„æ˜¯ï¼Œé€šè¿‡ &lt;a href=&#34;https://crates.io/crates/ctor&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é“¾æ¥å™¨çš„èŠ±æ‹›&lt;/a&gt; æˆ‘ä»¬å¯ä»¥è¿«ä½¿æˆ‘ä»¬çš„ä»£ç åœ¨è¿›ç¨‹æ‰§è¡Œçš„éå¸¸æ—©æœŸè¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;Go ä¸­çš„ç±»ä¼¼æ–¹æ³•ä¹Ÿæœ‰æ•ˆï¼ˆè¯·å‚è§ &lt;a href=&#34;https://github.com/howardjohn/unshare-go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘å†™çš„å¸®åŠ©åº“&lt;/a&gt;ï¼‰ï¼Œå®é™…ä¸Šåœ¨é‚£é‡Œæ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºè®¾ç½®å¿…é¡»åœ¨ Go è¿è¡Œæ—¶å¯åŠ¨ä¹‹å‰å®Œæˆï¼ˆè¿™é€šå¸¸åœ¨ä»»ä½•ç”¨æˆ·ä»£ç è¿è¡Œä¹‹å‰å¾ˆä¹…ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æœ‰äº†æ‰€æœ‰è¿™äº›è®¾å¤‡ï¼Œä¸€ä¸ªå®Œæ•´çš„æµ‹è¯•åªéœ€è¦å¤§çº¦ 200 æ¯«ç§’ã€‚ä¸€åˆ‡éƒ½åœ¨ä¸€ä¸ªå•ä¸€è¿›ç¨‹ä¸­è¿è¡Œï¼Œä½¿è°ƒè¯•å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚æ‰€æœ‰çš„æµ‹è¯•ä¹Ÿéƒ½æ˜¯å®Œå…¨éš”ç¦»çš„ï¼Œå› æ­¤å¯ä»¥å®Œå…¨å¹¶è¡Œè¿è¡Œæµ‹è¯•ï¼ˆåŒ…æ‹¬ç›¸åŒçš„æµ‹è¯•ï¼Œç”¨äºå‹åŠ›æµ‹è¯•ä»¥æ¶ˆé™¤æµ‹è¯•ç¼ºé™·ï¼‰ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>SAPwnedï¼šSAP AI æ¼æ´æš´éœ²å®¢æˆ·äº‘ç¯å¢ƒå’Œç§æœ‰ AI å·¥ä»¶</title>
      <link>https://cloudnativecn.com/blog/sapwned-sap-ai-vulnerabilities-ai-security/</link>
      <pubDate>Thu, 18 Jul 2024 19:23:50 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/sapwned-sap-ai-vulnerabilities-ai-security/</guid>
      <description>&lt;h2 id=&#34;ai-æ˜¯å¦å­˜åœ¨éš”ç¦»é—®é¢˜&#34;&gt;AI æ˜¯å¦å­˜åœ¨éš”ç¦»é—®é¢˜ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;åœ¨è¿‡å»çš„å‡ ä¸ªæœˆé‡Œï¼Œæˆ‘ä»¬ Wiz ç ”ç©¶å›¢é˜Ÿå¯¹å¤šä¸ª AI æœåŠ¡æä¾›å•†è¿›è¡Œäº†å¹¿æ³›çš„ç§Ÿæˆ·éš”ç¦»ç ”ç©¶ã€‚æˆ‘ä»¬è®¤ä¸ºè¿™äº›æœåŠ¡æ›´å®¹æ˜“å—åˆ°ç§Ÿæˆ·éš”ç¦»æ¼æ´çš„å½±å“ï¼Œå› ä¸ºå®ƒä»¬å…è®¸ç”¨æˆ·è¿è¡Œ AI æ¨¡å‹å’Œåº”ç”¨ç¨‹åºï¼Œè¿™ç­‰åŒäºæ‰§è¡Œä»»æ„ä»£ç ã€‚éšç€ AI åŸºç¡€è®¾æ–½è¶Šæ¥è¶Šæˆä¸ºè®¸å¤šå•†ä¸šç¯å¢ƒçš„æ ‡é…ï¼Œè¿™äº›æ”»å‡»çš„å½±å“æ­£å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†åœ¨å³å°†ä¸¾è¡Œçš„ Black Hat ä¼šè®®ä¸Šå±•ç¤ºè¿™ä¸ªç ”ç©¶é¡¹ç›®çš„å‘ç°ï¼Œåœ¨æˆ‘ä»¬çš„ä¼šè®®â€œéš”ç¦»è¿˜æ˜¯å¹»è§‰ï¼Ÿä¸ºä¹è¶£å’Œæƒé‡é»‘å®¢æ”»å‡» AI åŸºç¡€è®¾æ–½æä¾›å•†â€ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªé¡¹ç›®çš„æœ€æ–°ä¸€æœŸä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº† SAP çš„ AI äº§å“ï¼Œæ°å½“åœ°å‘½åä¸ºâ€œSAP AI Coreâ€ã€‚è¿™æ˜¯æˆ‘ä»¬ç³»åˆ—ä¸­çš„ç¬¬ä¸‰ä»½æŠ¥å‘Šï¼Œç»§æˆ‘ä»¬å¯¹ Hugging Face å’Œ Replicate å¹³å°çš„ç ”ç©¶ä¹‹åã€‚æœ¬åšå®¢å°†æ¢ç´¢æ¼æ´é“¾å¹¶è¯¦ç»†ä»‹ç»æˆ‘ä»¬çš„å‘ç°ï¼Œç§°ä¸ºâ€œSAPwnedâ€ï¼ŒåŒæ—¶ä¹Ÿå°†è§‚å¯Ÿåˆ°ç¡®ä¿ç®¡ç† AI å¹³å°å®‰å…¨çš„æ½œåœ¨å½±å“å’Œæ›´å¹¿æ³›çš„å¯ç¤ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ‰§è¡Œæ‘˜è¦&#34;&gt;æ‰§è¡Œæ‘˜è¦&lt;/h2&gt;
&lt;p&gt;AI è®­ç»ƒè¿‡ç¨‹éœ€è¦è®¿é—®å¤§é‡æ•æ„Ÿå®¢æˆ·æ•°æ®ï¼Œè¿™ä½¿ AI è®­ç»ƒæœåŠ¡æˆä¸ºæ”»å‡»è€…çš„è¯±äººç›®æ ‡ã€‚SAP AI Core æä¾›ä¸ HANA åŠå…¶ä»–äº‘æœåŠ¡çš„é›†æˆï¼Œé€šè¿‡äº‘è®¿é—®å¯†é’¥è®¿é—®å®¢æˆ·çš„å†…éƒ¨æ•°æ®ã€‚è¿™äº›å‡­æ®éå¸¸æ•æ„Ÿï¼Œæˆ‘ä»¬çš„ç ”ç©¶ç›®æ ‡æ˜¯ç¡®å®šæ½œåœ¨çš„æ¶æ„è¡Œä¸ºè€…æ˜¯å¦èƒ½å¤Ÿè®¿é—®è¿™äº›å®¢æˆ·ç§˜å¯†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯¹ SAP AI Core çš„ç ”ç©¶å§‹äºä½¿ç”¨ SAP çš„åŸºç¡€è®¾æ–½æ‰§è¡Œåˆæ³•çš„ AI è®­ç»ƒç¨‹åºã€‚é€šè¿‡æ‰§è¡Œä»»æ„ä»£ç ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ¨ªå‘ç§»åŠ¨å¹¶æ¥ç®¡æœåŠ¡â€”â€”è·å–å®¢æˆ·çš„ç§æœ‰æ–‡ä»¶ä»¥åŠå®¢æˆ·äº‘ç¯å¢ƒçš„å‡­æ®ï¼šAWSã€Azureã€SAP HANA Cloud ç­‰ã€‚æˆ‘ä»¬å‘ç°çš„æ¼æ´å¯èƒ½å…è®¸æ”»å‡»è€…è®¿é—®å®¢æˆ·æ•°æ®å¹¶æ±¡æŸ“å†…éƒ¨å·¥ä»¶â€”â€”è”“å»¶åˆ°ç›¸å…³æœåŠ¡å’Œå…¶ä»–å®¢æˆ·ç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬è·å¾—çš„è®¿é—®æƒé™å…è®¸æˆ‘ä»¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ SAP çš„å†…éƒ¨å®¹å™¨æ³¨å†Œè¡¨ä¸Šè¯»å–å’Œä¿®æ”¹ Docker é•œåƒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ Google å®¹å™¨æ³¨å†Œè¡¨ä¸Šè¯»å–å’Œä¿®æ”¹ SAP çš„ Docker é•œåƒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ SAP çš„å†…éƒ¨ Artifactory æœåŠ¡å™¨ä¸Šè¯»å–å’Œä¿®æ”¹å·¥ä»¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·å¾— SAP AI Core çš„ Kubernetes é›†ç¾¤çš„é›†ç¾¤ç®¡ç†å‘˜æƒé™&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è®¿é—®å®¢æˆ·çš„äº‘å‡­è¯å’Œç§æœ‰ AI å·¥ä»¶&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æˆ‘ä»¬ç ”ç©¶å‘ç°çš„é€æ­¥æ’å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æˆ‘ä»¬ç ”ç©¶å‘ç°çš„é€æ­¥æ’å›¾&#34; srcset=&#34;
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f1_hu_3b2338a89fb51726.webp 400w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f1_hu_55b5c6de9775ffbc.webp 760w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f1_hu_ac7974a653d1b34d.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/sapwned-sap-ai-vulnerabilities-ai-security/f1_hu_3b2338a89fb51726.webp&#34;
               width=&#34;760&#34;
               height=&#34;428&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æˆ‘ä»¬ç ”ç©¶å‘ç°çš„é€æ­¥æ’å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å‘ç°è¿™äº›é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯æ”»å‡»è€…å¯ä»¥è¿è¡Œæ¶æ„ AI æ¨¡å‹å’Œè®­ç»ƒç¨‹åºï¼Œè¿™æœ¬è´¨ä¸Šæ˜¯ä»£ç ã€‚åœ¨å®¡æŸ¥äº†å‡ ä¸ªä¸»è¦ AI æœåŠ¡ä¹‹åï¼Œæˆ‘ä»¬è®¤ä¸ºè¡Œä¸šå¿…é¡»æ”¹è¿›å…¶åœ¨è¿è¡Œ AI æ¨¡å‹æ—¶çš„éš”ç¦»å’Œæ²™ç®±æ ‡å‡†ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰æ¼æ´å·²æŠ¥å‘Šç»™ SAP çš„å®‰å…¨å›¢é˜Ÿï¼Œå¹¶ç”± SAP ä¿®å¤ï¼Œå¦‚å…¶ç½‘ç«™æ‰€ç¡®è®¤ã€‚æˆ‘ä»¬æ„Ÿè°¢ä»–ä»¬çš„åˆä½œã€‚æ²¡æœ‰å®¢æˆ·æ•°æ®å—åˆ°æ³„éœ²ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»‹ç»ç ”ç©¶å¼€å§‹&#34;&gt;ä»‹ç»ï¼šç ”ç©¶å¼€å§‹&lt;/h2&gt;
&lt;p&gt;SAP AI Core æ˜¯ä¸€é¡¹æœåŠ¡ï¼Œå…è®¸ç”¨æˆ·ä»¥å¯æ‰©å±•å’Œç®¡ç†çš„æ–¹å¼åœ¨ SAP çš„åºå¤§äº‘èµ„æºä¸Šå¼€å‘ã€è®­ç»ƒå’Œè¿è¡Œ AI æœåŠ¡ã€‚ç±»ä¼¼äºå…¶ä»–äº‘æä¾›å•†ï¼ˆå’Œ AI åŸºç¡€è®¾æ–½æä¾›å•†ï¼‰ï¼Œå®¢æˆ·çš„ä»£ç åœ¨ SAP çš„å…±äº«ç¯å¢ƒä¸­è¿è¡Œâ€”â€”æ„æˆè·¨ç§Ÿæˆ·è®¿é—®çš„é£é™©ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„ç ”ç©¶å§‹äºä½œä¸º SAP å®¢æˆ·ï¼ŒåŸºæœ¬æƒé™å…è®¸æˆ‘ä»¬åˆ›å»º AI é¡¹ç›®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨ SAP AI Core ä¸Šåˆ›å»ºäº†ä¸€ä¸ªå¸¸è§„ AI åº”ç”¨ç¨‹åºã€‚SAP çš„å¹³å°å…è®¸æˆ‘ä»¬æä¾›ä¸€ä¸ª Argo Workflow æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åè¿‡æ¥ç”Ÿæˆäº†ä¸€ä¸ªæ ¹æ®æˆ‘ä»¬çš„é…ç½®çš„æ–° Kubernetes Podã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-sap-ai-core-ä¸Šçš„-argo-å·¥ä½œæµé…ç½®ç¤ºä¾‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;SAP AI Core ä¸Šçš„ Argo å·¥ä½œæµé…ç½®ç¤ºä¾‹&#34; srcset=&#34;
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f2_hu_f6895bbeeeccfc31.webp 400w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f2_hu_4ec3f086b32f894b.webp 760w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f2_hu_abe31627232f4d42.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/sapwned-sap-ai-vulnerabilities-ai-security/f2_hu_f6895bbeeeccfc31.webp&#34;
               width=&#34;760&#34;
               height=&#34;516&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      SAP AI Core ä¸Šçš„ Argo å·¥ä½œæµé…ç½®ç¤ºä¾‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™å…è®¸æˆ‘ä»¬åœ¨ Pod ä¸­æŒ‰è®¾è®¡è¿è¡Œæˆ‘ä»¬è‡ªå·±çš„ä»»æ„ä»£ç â€”â€”ä¸éœ€è¦ä»»ä½•æ¼æ´ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬çš„ç¯å¢ƒå—åˆ°äº†ç›¸å½“å¤§çš„é™åˆ¶ã€‚æˆ‘ä»¬å¾ˆå¿«æ„è¯†åˆ°ï¼Œæˆ‘ä»¬çš„ Pod çš„ç½‘ç»œè®¿é—®éå¸¸æœ‰é™ï¼Œè¿™æ˜¯ç”± Istio ä»£ç† sidecar å¼ºåˆ¶æ‰§è¡Œçš„â€”â€”å› æ­¤ï¼Œæ‰«æå†…éƒ¨ç½‘ç»œå¯¹æˆ‘ä»¬æ¥è¯´ä¸æ˜¯ä¸€ä¸ªé€‰é¡¹ã€‚è‡³å°‘ç°åœ¨ä¸æ˜¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;bug-1-é€šè¿‡-1337-çš„åŠ›é‡ç»•è¿‡ç½‘ç»œé™åˆ¶&#34;&gt;Bug #1: é€šè¿‡ 1337 çš„åŠ›é‡ç»•è¿‡ç½‘ç»œé™åˆ¶&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬é¦–å…ˆå°è¯•çš„æ˜¯ä¸ºæˆ‘ä»¬çš„ Pod é…ç½®â€œæœ‰è¶£â€çš„æƒé™ã€‚ç„¶è€Œï¼ŒSAP çš„å‡†å…¥æ§åˆ¶å™¨é˜»æ­¢äº†æˆ‘ä»¬å°è¯•çš„æ‰€æœ‰å±é™©å®‰å…¨é€‰é¡¹â€”â€”ä¾‹å¦‚ï¼Œä»¥&lt;code&gt;root&lt;/code&gt;èº«ä»½è¿è¡Œæˆ‘ä»¬çš„å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬å‘ç°å‡†å…¥æ§åˆ¶å™¨æœªèƒ½é˜»æ­¢ä¸¤ç§æœ‰è¶£çš„é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªæ˜¯&lt;code&gt;shareProcessNamespace&lt;/code&gt;ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä¸æˆ‘ä»¬çš„ sidecar å®¹å™¨å…±äº«è¿›ç¨‹å‘½åç©ºé—´ã€‚ç”±äºæˆ‘ä»¬çš„ sidecar æ˜¯ Istio ä»£ç†ï¼Œæˆ‘ä»¬è·å¾—äº†å¯¹ Istio çš„é…ç½®çš„è®¿é—®æƒé™ï¼ŒåŒ…æ‹¬å¯¹é›†ç¾¤çš„é›†ä¸­å¼ Istiod æœåŠ¡å™¨çš„è®¿é—®ä»¤ç‰Œã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-é€šè¿‡æˆ‘ä»¬çš„-sidecar-å®¹å™¨è®¿é—®-istio-ä»¤ç‰Œ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;é€šè¿‡æˆ‘ä»¬çš„ sidecar å®¹å™¨è®¿é—® Istio ä»¤ç‰Œ&#34; srcset=&#34;
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f3_hu_13da236be9f6678e.webp 400w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f3_hu_5a1dae290ea4989a.webp 760w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f3_hu_b64228911e246efc.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/sapwned-sap-ai-vulnerabilities-ai-security/f3_hu_13da236be9f6678e.webp&#34;
               width=&#34;760&#34;
               height=&#34;279&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      é€šè¿‡æˆ‘ä»¬çš„ sidecar å®¹å™¨è®¿é—® Istio ä»¤ç‰Œ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦ä¸€ä¸ªæ˜¯&lt;code&gt;runAsUser&lt;/code&gt;ï¼ˆå’Œ&lt;code&gt;runAsGroup&lt;/code&gt;ï¼‰ã€‚è™½ç„¶æˆ‘ä»¬ä¸èƒ½æˆä¸º rootï¼Œä½†æ‰€æœ‰å…¶ä»– UID éƒ½æ˜¯å…è®¸çš„â€”â€”åŒ…æ‹¬ Istio çš„ UIDï¼Œè®½åˆºçš„æ˜¯ï¼Œè¿™ä¸ª UID æ˜¯&lt;code&gt;1337&lt;/code&gt;ï¼ˆæ˜¯çš„ï¼ŒçœŸçš„ï¼‰ã€‚æˆ‘ä»¬å°†æˆ‘ä»¬çš„ UID è®¾ç½®ä¸º 1337ï¼Œå¹¶æˆåŠŸåœ°ä»¥ Istio ç”¨æˆ·çš„èº«ä»½è¿è¡Œã€‚ç”±äº Istio æœ¬èº«æ˜¯&lt;a href=&#34;https://istio.io/latest/docs/reference/config/analysis/ist0144/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä» Istio çš„ iptables è§„åˆ™ä¸­æ’é™¤çš„&lt;/a&gt;â€”â€”æˆ‘ä»¬ç°åœ¨è¿è¡Œæ—¶æ²¡æœ‰ä»»ä½•æµé‡é™åˆ¶ï¼&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å‘é€è¯·æ±‚åˆ°å†…éƒ¨ç½‘ç»œåœ¨-uid-1337-ä¹‹å‰å’Œä¹‹å&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å‘é€è¯·æ±‚åˆ°å†…éƒ¨ç½‘ç»œâ€”â€”åœ¨ UID 1337 ä¹‹å‰å’Œä¹‹å&#34; srcset=&#34;
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f4_hu_64e277d4ae668d27.webp 400w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f4_hu_b959a394f5fb112.webp 760w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f4_hu_43a9bcce0b43021a.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/sapwned-sap-ai-vulnerabilities-ai-security/f4_hu_64e277d4ae668d27.webp&#34;
               width=&#34;760&#34;
               height=&#34;241&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å‘é€è¯·æ±‚åˆ°å†…éƒ¨ç½‘ç»œâ€”â€”åœ¨ UID 1337 ä¹‹å‰å’Œä¹‹å
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ‘†è„±äº†æµé‡æŸç¼šï¼Œå¼€å§‹æ‰«ææˆ‘ä»¬ Pod çš„å†…éƒ¨ç½‘ç»œã€‚ä½¿ç”¨æˆ‘ä»¬çš„ Istio ä»¤ç‰Œï¼Œæˆ‘ä»¬èƒ½å¤Ÿä» Istiod æœåŠ¡å™¨è¯»å–é…ç½®å¹¶äº†è§£å†…éƒ¨ç¯å¢ƒâ€”â€”è¿™å¼•å¯¼æˆ‘ä»¬è¿›è¡Œäº†ä»¥ä¸‹å‘ç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;bug-2-loki-æ³„éœ²-aws-ä»¤ç‰Œ&#34;&gt;Bug #2: Loki æ³„éœ² AWS ä»¤ç‰Œ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨é›†ç¾¤ä¸­æ‰¾åˆ°äº†ä¸€ä¸ª Grafana Loki çš„å®ä¾‹ï¼Œå› æ­¤æˆ‘ä»¬è¯·æ±‚äº†&lt;code&gt;/config&lt;/code&gt;ç«¯ç‚¹ä»¥æŸ¥çœ‹ Loki çš„é…ç½®ã€‚API å“åº”äº†å®Œæ•´çš„é…ç½®ï¼ŒåŒ…æ‹¬ Loki ç”¨æ¥è®¿é—® S3 çš„ AWS å¯†é’¥ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ¥è‡ª-sap-çš„-loki-æœåŠ¡å™¨çš„é…ç½®æ‘˜å½•&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ¥è‡ª SAP çš„ Loki æœåŠ¡å™¨çš„é…ç½®æ‘˜å½•&#34; srcset=&#34;
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f5_hu_b8eb70ed95c55ae6.webp 400w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f5_hu_4d24e3f9c8c0a852.webp 760w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f5_hu_a16093eb036b25a5.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/sapwned-sap-ai-vulnerabilities-ai-security/f5_hu_b8eb70ed95c55ae6.webp&#34;
               width=&#34;760&#34;
               height=&#34;312&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ¥è‡ª SAP çš„ Loki æœåŠ¡å™¨çš„é…ç½®æ‘˜å½•
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™äº›å¯†é’¥æˆäºˆè®¿é—® Loki çš„ S3 å­˜å‚¨æ¡¶çš„æƒé™ï¼Œå…¶ä¸­åŒ…å« AI Core æœåŠ¡ï¼ˆSAP ç§°å…¶ä¸æ•æ„Ÿï¼‰å’Œå®¢æˆ· Pods çš„å¤§é‡æ—¥å¿—ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-loki-çš„-s3-å­˜å‚¨æ¡¶ä¸­çš„éƒ¨åˆ†æ–‡ä»¶åˆ—è¡¨&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Loki çš„ S3 å­˜å‚¨æ¡¶ä¸­çš„éƒ¨åˆ†æ–‡ä»¶åˆ—è¡¨&#34; srcset=&#34;
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f6_hu_ccf2a048dba3be20.webp 400w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f6_hu_1edc6bffc4962eae.webp 760w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f6_hu_953c027aa4433ab0.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/sapwned-sap-ai-vulnerabilities-ai-security/f6_hu_ccf2a048dba3be20.webp&#34;
               width=&#34;760&#34;
               height=&#34;379&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Loki çš„ S3 å­˜å‚¨æ¡¶ä¸­çš„éƒ¨åˆ†æ–‡ä»¶åˆ—è¡¨
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;bug-3-æœªç»èº«ä»½éªŒè¯çš„-efs-å…±äº«æš´éœ²ç”¨æˆ·æ–‡ä»¶&#34;&gt;Bug #3: æœªç»èº«ä»½éªŒè¯çš„ EFS å…±äº«æš´éœ²ç”¨æˆ·æ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;åœ¨å†…éƒ¨ç½‘ç»œä¸­ï¼Œæˆ‘ä»¬å‘ç°äº† 6 ä¸ª AWS Elastic File Systemï¼ˆEFSï¼‰å®ä¾‹ï¼Œç›‘å¬ç«¯å£ 2049ã€‚EFS å®ä¾‹çš„ä¸€ä¸ª&lt;a href=&#34;https://youtu.be/HcNmkCRXFdE&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¸¸è§é—®é¢˜&lt;/a&gt;æ˜¯å®ƒä»¬é»˜è®¤é…ç½®ä¸ºå…¬å…±çš„â€”â€”è¿™æ„å‘³ç€åªè¦æ‚¨å¯ä»¥è®¿é—®å…¶ NFS ç«¯å£ï¼Œå°±ä¸éœ€è¦å‡­æ®å³å¯æŸ¥çœ‹æˆ–ç¼–è¾‘æ–‡ä»¶ã€‚è¿™äº›å®ä¾‹ä¹Ÿä¸ä¾‹å¤–ï¼Œæˆ‘ä»¬ä½¿ç”¨ç®€å•çš„å¼€æº NFS å·¥å…·ï¼Œå¯ä»¥è‡ªç”±è®¿é—®å…±äº«çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;åˆ—å‡ºè¿™äº› EFS å®ä¾‹ä¸Šå­˜å‚¨çš„æ–‡ä»¶ï¼Œæ­ç¤ºäº†å¤§é‡ AI æ•°æ®ï¼ŒåŒ…æ‹¬ä»£ç å’Œè®­ç»ƒæ•°æ®é›†ï¼ŒæŒ‰å®¢æˆ· ID åˆ†ç±»ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f7_hu_c900eb89dabeb24.webp 400w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f7_hu_bb98a788f2a482e0.webp 760w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f7_hu_8e91fa3f8abda0e7.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/sapwned-sap-ai-vulnerabilities-ai-security/f7_hu_c900eb89dabeb24.webp&#34;
               width=&#34;760&#34;
               height=&#34;385&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ä¸¤ä¸ª-efs-å…±äº«çš„éƒ¨åˆ†æ–‡ä»¶åˆ—è¡¨æ¯ä¸ªæ–‡ä»¶å¤¹ä»£è¡¨ä¸€ä¸ªä¸åŒçš„å®¢æˆ·-id&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;ä¸¤ä¸ª EFS å…±äº«çš„éƒ¨åˆ†æ–‡ä»¶åˆ—è¡¨ï¼›æ¯ä¸ªæ–‡ä»¶å¤¹ä»£è¡¨ä¸€ä¸ªä¸åŒçš„å®¢æˆ· ID&#34; srcset=&#34;
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f8_hu_f3781be98cf5fe4c.webp 400w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f8_hu_35897d7208961ed1.webp 760w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f8_hu_23e40e9b64c29e05.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/sapwned-sap-ai-vulnerabilities-ai-security/f8_hu_f3781be98cf5fe4c.webp&#34;
               width=&#34;760&#34;
               height=&#34;466&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      ä¸¤ä¸ª EFS å…±äº«çš„éƒ¨åˆ†æ–‡ä»¶åˆ—è¡¨ï¼›æ¯ä¸ªæ–‡ä»¶å¤¹ä»£è¡¨ä¸€ä¸ªä¸åŒçš„å®¢æˆ· ID
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;bug-4-æœªç»èº«ä»½éªŒè¯çš„-helm-æœåŠ¡å™¨å±åŠå†…éƒ¨-docker-æ³¨å†Œè¡¨å’Œ-artifactory&#34;&gt;Bug #4: æœªç»èº«ä»½éªŒè¯çš„ Helm æœåŠ¡å™¨å±åŠå†…éƒ¨ Docker æ³¨å†Œè¡¨å’Œ Artifactory&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨ç½‘ç»œä¸Šæœ€æœ‰è¶£çš„å‘ç°æ˜¯ä¸€ä¸ªåä¸º Tiller çš„æœåŠ¡ï¼Œè¿™æ˜¯ Helm åŒ…ç®¡ç†å™¨çš„æœåŠ¡å™¨ç»„ä»¶ï¼ˆç‰ˆæœ¬ 2ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ Tiller çš„é€šä¿¡æ˜¯é€šè¿‡å…¶ gRPC æ¥å£åœ¨ç«¯å£ 44134 è¿›è¡Œçš„ï¼Œè¯¥ç«¯å£é»˜è®¤æ˜¯æœªç»èº«ä»½éªŒè¯çš„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„å†…éƒ¨ç½‘ç»œä¸ŠæŸ¥è¯¢è¿™ä¸ªæœåŠ¡å™¨ï¼Œæ­ç¤ºäº†å¯¹ SAP çš„ Docker æ³¨å†Œè¡¨ä»¥åŠå…¶ Artifactory æœåŠ¡å™¨çš„é«˜æƒé™å¯†é’¥ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-é€šè¿‡-helm-æœåŠ¡å™¨æŸ¥è¯¢æš´éœ²çš„å®¹å™¨æ³¨å†Œè¡¨å’Œ-artifactory-å‡­æ®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;é€šè¿‡ Helm æœåŠ¡å™¨æŸ¥è¯¢æš´éœ²çš„å®¹å™¨æ³¨å†Œè¡¨å’Œ Artifactory å‡­æ®&#34; srcset=&#34;
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f9_hu_8ef188e2bf80f37.webp 400w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f9_hu_6b1b89e9239c2e8e.webp 760w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f9_hu_a4c80298e8470e92.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/sapwned-sap-ai-vulnerabilities-ai-security/f9_hu_8ef188e2bf80f37.webp&#34;
               width=&#34;760&#34;
               height=&#34;659&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      é€šè¿‡ Helm æœåŠ¡å™¨æŸ¥è¯¢æš´éœ²çš„å®¹å™¨æ³¨å†Œè¡¨å’Œ Artifactory å‡­æ®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨è¿™äº›å¯†é’¥çš„è¯»å–æƒé™ï¼Œæ½œåœ¨çš„æ”»å‡»è€…å¯ä»¥è¯»å–å†…éƒ¨å›¾åƒå’Œæ„å»ºï¼Œæå–å•†ä¸šç§˜å¯†ï¼Œå¯èƒ½è¿˜åŒ…æ‹¬å®¢æˆ·æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨è¿™äº›å¯†é’¥çš„å†™æƒé™ï¼Œæ”»å‡»è€…å¯ä»¥ç¯¡æ”¹å›¾åƒå’Œæ„å»ºï¼Œå¯¹ SAP AI Core æœåŠ¡è¿›è¡Œä¾›åº”é“¾æ”»å‡»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;bug-5-æœªç»èº«ä»½éªŒè¯çš„-helm-æœåŠ¡å™¨å±åŠ-k8s-é›†ç¾¤æš´éœ²-google-è®¿é—®ä»¤ç‰Œå’Œå®¢æˆ·ç§˜å¯†&#34;&gt;Bug #5: æœªç»èº«ä»½éªŒè¯çš„ Helm æœåŠ¡å™¨å±åŠ K8s é›†ç¾¤ï¼Œæš´éœ² Google è®¿é—®ä»¤ç‰Œå’Œå®¢æˆ·ç§˜å¯†&lt;/h2&gt;
&lt;p&gt;Helm æœåŠ¡å™¨æš´éœ²äº†è¯»å†™æ“ä½œã€‚å°½ç®¡è¯»å–æƒé™æš´éœ²äº†æ•æ„Ÿçš„ç§˜å¯†ï¼ˆå¦‚ä¸Šæ‰€ç¤ºï¼‰ï¼Œä½†æœåŠ¡å™¨çš„å†™æƒé™å…è®¸å®Œå…¨æ¥ç®¡é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;Tiller çš„&lt;code&gt;install&lt;/code&gt;å‘½ä»¤æ¥å—ä¸€ä¸ª Helm åŒ…å¹¶å°†å…¶éƒ¨ç½²åˆ° K8s é›†ç¾¤ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ¶æ„ Helm åŒ…ï¼Œç”Ÿæˆäº†ä¸€ä¸ªå…·æœ‰&lt;code&gt;cluster-admin&lt;/code&gt;æƒé™çš„æ–° Podï¼Œå¹¶è¿è¡Œäº†å®‰è£…å‘½ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬åœ¨é›†ç¾¤ä¸Šè¿è¡Œå…·æœ‰å®Œå…¨æƒé™ï¼&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-é€šè¿‡-helm-è·å¾—çš„-k8s-æƒé™çš„éƒ¨åˆ†åˆ—è¡¨&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;é€šè¿‡ Helm è·å¾—çš„ K8s æƒé™çš„éƒ¨åˆ†åˆ—è¡¨&#34; srcset=&#34;
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f10_hu_f13f6be806b2ec54.webp 400w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f10_hu_4b3dc137b687c591.webp 760w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f10_hu_a03d2387c5cba62f.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/sapwned-sap-ai-vulnerabilities-ai-security/f10_hu_f13f6be806b2ec54.webp&#34;
               width=&#34;760&#34;
               height=&#34;429&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      é€šè¿‡ Helm è·å¾—çš„ K8s æƒé™çš„éƒ¨åˆ†åˆ—è¡¨
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨è¿™ç§è®¿é—®çº§åˆ«ï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥è®¿é—®å…¶ä»–å®¢æˆ·çš„ Pods å¹¶çªƒå–æ•æ„Ÿæ•°æ®ï¼Œå¦‚æ¨¡å‹ã€æ•°æ®é›†å’Œä»£ç ã€‚è¿™ç§è®¿é—®è¿˜å…è®¸æ”»å‡»è€…å¹²æ‰°å®¢æˆ·çš„ Podsï¼Œæ±¡æŸ“ AI æ•°æ®å¹¶æ“çºµæ¨¡å‹çš„æ¨ç†ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œè¿™ç§è®¿é—®çº§åˆ«è¿˜å°†å…è®¸æˆ‘ä»¬æŸ¥çœ‹å®¢æˆ·è‡ªå·±çš„ç§˜å¯†â€”â€”ç”šè‡³è¶…å‡º SAP AI Core èŒƒå›´çš„ç§˜å¯†ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„ AI Core è´¦æˆ·åŒ…å«äº†æˆ‘ä»¬çš„ AWS è´¦æˆ·ï¼ˆç”¨äº S3 æ•°æ®è®¿é—®ï¼‰ã€æˆ‘ä»¬çš„ SAP HANA è´¦æˆ·ï¼ˆç”¨äº Data Lake è®¿é—®ï¼‰å’Œæˆ‘ä»¬çš„ Docker Hub è´¦æˆ·ï¼ˆç”¨äºæ‹‰å–æˆ‘ä»¬çš„é•œåƒï¼‰çš„ç§˜å¯†ã€‚ä½¿ç”¨æˆ‘ä»¬æ–°è·å¾—çš„è®¿é—®çº§åˆ«ï¼Œæˆ‘ä»¬æŸ¥è¯¢äº†è¿™äº›ç§˜å¯†ï¼Œå¹¶è®¾æ³•ä»¥çº¯æ–‡æœ¬å½¢å¼è®¿é—®å®ƒä»¬æ‰€æœ‰ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ä½¿ç”¨æˆ‘ä»¬çš„-k8s-æƒé™è®¿é—®å®¢æˆ·ç§˜å¯†&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;ä½¿ç”¨æˆ‘ä»¬çš„ K8s æƒé™è®¿é—®å®¢æˆ·ç§˜å¯†&#34; srcset=&#34;
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f11_hu_aea22afe235b01fc.webp 400w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f11_hu_26c46cdcdbdbdf40.webp 760w,
               /blog/sapwned-sap-ai-vulnerabilities-ai-security/f11_hu_e2b60b5ed1e655cf.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/sapwned-sap-ai-vulnerabilities-ai-security/f11_hu_aea22afe235b01fc.webp&#34;
               width=&#34;760&#34;
               height=&#34;513&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      ä½¿ç”¨æˆ‘ä»¬çš„ K8s æƒé™è®¿é—®å®¢æˆ·ç§˜å¯†
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åŒæ ·çš„æŸ¥è¯¢è¿˜æ­ç¤ºäº†ä¸€ä¸ªåä¸º&lt;code&gt;sap-docker-registry-secret&lt;/code&gt;çš„ SAP è®¿é—® Google å®¹å™¨æ³¨å†Œè¡¨çš„å¯†é’¥ã€‚æˆ‘ä»¬å·²ç»ç¡®è®¤è¿™ä¸ªå¯†é’¥æˆäºˆäº†è¯»å†™æƒé™â€”â€”è¿›ä¸€æ­¥æ‰©å¤§äº†æ½œåœ¨ä¾›åº”é“¾æ”»å‡»çš„èŒƒå›´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯ç¤º&#34;&gt;å¯ç¤º&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¯¹ SAP AI Core çš„ç ”ç©¶è¡¨æ˜ï¼Œæ·±åº¦é˜²å¾¡çš„é‡è¦æ€§ã€‚æˆ‘ä»¬é¢ä¸´çš„ä¸»è¦å®‰å…¨éšœç¢æ˜¯ Istio é˜»æ­¢æˆ‘ä»¬çš„æµé‡åˆ°è¾¾å†…éƒ¨ç½‘ç»œã€‚ä¸€æ—¦æˆ‘ä»¬èƒ½å¤Ÿç»•è¿‡è¿™ä¸ªéšœç¢ï¼Œæˆ‘ä»¬å°±è·å¾—äº†å¯¹å‡ ä¸ªå†…éƒ¨èµ„äº§çš„è®¿é—®æƒé™ï¼Œè¿™äº›èµ„äº§ä¸éœ€è¦ä»»ä½•å…¶ä»–èº«ä»½éªŒè¯â€”â€”è¿™æ„å‘³ç€å†…éƒ¨ç½‘ç»œè¢«è§†ä¸ºå¯ä¿¡çš„ã€‚åŠ å›ºè¿™äº›å†…éƒ¨æœåŠ¡æœ¬å¯ä»¥å°†è¿™æ¬¡æ”»å‡»çš„å½±å“é™è‡³æœ€ä½ï¼Œå°†å…¶ä»å®Œå…¨æœåŠ¡æ¥ç®¡é™çº§ä¸ºè½»å¾®çš„å®‰å…¨äº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¦åˆæˆ‘ä»¬ä¹‹å‰ä¸ K8s ç›¸å…³çš„æ¼æ´ï¼Œè¿™é¡¹ç ”ç©¶è¿˜å±•ç¤ºäº†åœ¨ç®¡ç†æœåŠ¡ä¸­ä½¿ç”¨ K8s çš„ç§Ÿæˆ·éš”ç¦»é™·é˜±ã€‚æ§åˆ¶å¹³é¢ï¼ˆæœåŠ¡é€»è¾‘ï¼‰å’Œæ•°æ®å¹³é¢ï¼ˆå®¢æˆ·è®¡ç®—ï¼‰ä¹‹é—´çš„å…³é”®åˆ†ç¦»å—åˆ°äº† K8s æ¶æ„çš„å½±å“ï¼Œè¯¥æ¶æ„é€šè¿‡ APIã€èº«ä»½ã€å…±äº«è®¡ç®—å’Œè½¯ä»¶åˆ†æ®µç½‘ç»œå…è®¸å®ƒä»¬ä¹‹é—´çš„é€»è¾‘è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œè¿™é¡¹ç ”ç©¶è¡¨æ˜ï¼ŒAI R&amp;amp;D è¿‡ç¨‹å¼•å…¥çš„ç‹¬ç‰¹æŒ‘æˆ˜ã€‚AI åŸ¹è®­æœ¬è´¨ä¸Šéœ€è¦è¿è¡Œä»»æ„ä»£ç ï¼›å› æ­¤ï¼Œåº”è¯¥æœ‰é€‚å½“çš„ä¿æŠ¤æªæ–½ï¼Œç¡®ä¿ä¸å—ä¿¡ä»»çš„ä»£ç ä¸å†…éƒ¨èµ„äº§å’Œå…¶ä»–ç§Ÿæˆ·æ­£ç¡®åˆ†ç¦»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æŠ«éœ²æ—¶é—´çº¿&#34;&gt;æŠ«éœ²æ—¶é—´çº¿&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;2024 å¹´ 1 æœˆ 25 æ—¥&lt;/strong&gt; â€“ Wiz ç ”ç©¶æŠ¥å‘Šå®‰å…¨å‘ç°ç»™ SAP&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;2024 å¹´ 1 æœˆ 27 æ—¥&lt;/strong&gt; â€“ SAP å›å¤å¹¶åˆ†é…äº†ä¸€ä¸ªæ¡ˆä»¶ç¼–å·&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;2024 å¹´ 2 æœˆ 16 æ—¥&lt;/strong&gt; â€“ SAP ä¿®å¤äº†ç¬¬ä¸€ä¸ªæ¼æ´å¹¶æ—‹è½¬äº†ç›¸å…³çš„ç§˜å¯†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;2024 å¹´ 2 æœˆ 28 æ—¥&lt;/strong&gt; â€“ Wiz ç ”ç©¶ç»•è¿‡è¡¥ä¸ä½¿ç”¨ 2 ä¸ªæ–°æ¼æ´ï¼ŒæŠ¥å‘Šç»™ SAP&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;2024 å¹´ 5 æœˆ 15 æ—¥&lt;/strong&gt; â€“ SAP éƒ¨ç½²ä¿®å¤äº†æ‰€æœ‰æŠ¥å‘Šçš„æ¼æ´&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;2024 å¹´ 7 æœˆ 17 æ—¥&lt;/strong&gt; â€“ å…¬å¼€æŠ«éœ²&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä¿æŒè”ç³»&#34;&gt;ä¿æŒè”ç³»ï¼&lt;/h2&gt;
&lt;p&gt;å—¨ï¼Œæˆ‘ä»¬æ˜¯ Wiz ç ”ç©¶å›¢é˜Ÿçš„ Hillai Ben-Sassonï¼ˆ&lt;a href=&#34;https://twitter.com/hillai&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@hillai&lt;/a&gt;ï¼‰ï¼ŒShir Tamariï¼ˆ&lt;a href=&#34;https://twitter.com/shirtamari&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@shirtamari&lt;/a&gt;ï¼‰ï¼ŒNir Ohfeldï¼ˆ&lt;a href=&#34;https://twitter.com/nirohfeld&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@nirohfeld&lt;/a&gt;ï¼‰ï¼ŒSagi Tzadikï¼ˆ&lt;a href=&#34;https://twitter.com/sagitz_&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@sagitz_&lt;/a&gt;) å’Œ Ronen Shustinï¼ˆ&lt;a href=&#34;https://twitter.com/ronenshh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@ronenshh&lt;/a&gt;ï¼‰ã€‚æˆ‘ä»¬æ˜¯ä¸€ç¾¤èµ„æ·±ç™½å¸½é»‘å®¢ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©äº‘æˆä¸ºæ¯ä¸ªäººæ›´å®‰å…¨çš„åœ°æ–¹ã€‚æˆ‘ä»¬ä¸»è¦å…³æ³¨åœ¨äº‘ä¸­æ‰¾åˆ°æ–°çš„æ”»å‡»å‘é‡å¹¶æ­éœ²äº‘ä¾›åº”å•†çš„éš”ç¦»é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¾ˆæƒ³å¬å¬æ‚¨çš„æ„è§ï¼æ¬¢è¿é€šè¿‡ Twitter æˆ–ç”µå­é‚®ä»¶ä¸æˆ‘ä»¬è”ç³»ï¼š&lt;a href=&#34;mailto:research@wiz.io&#34;&gt;research@wiz.io&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Istio å’Œ Keycloak å®ç°èº«ä»½éªŒè¯å’Œæˆæƒ</title>
      <link>https://cloudnativecn.com/blog/istio-keycloak-authentication-authorization/</link>
      <pubDate>Tue, 16 Jul 2024 12:11:10 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-keycloak-authentication-authorization/</guid>
      <description>&lt;p&gt;åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•åˆ©ç”¨ Istio å’Œ Keycloak å®ç°èº«ä»½éªŒè¯å’Œæˆæƒã€‚ç›®æ ‡æ˜¯ç®€åŒ–å¼€å‘æµç¨‹ï¼Œä½¿å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºæ ¸å¿ƒä»»åŠ¡ï¼Œè€Œä¸éœ€è¦æ‹…å¿ƒèº«ä»½éªŒè¯å’Œæˆæƒé—®é¢˜ã€‚æˆ‘ä»¬å°†é€šè¿‡å®é™…ç¤ºä¾‹å’Œæœ‰æ•ˆçš„ç¤ºä¾‹ä»£ç ï¼Œé€æ­¥è®²è§£æ­¤è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ç½‘æ ¼&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;ç½‘æ ¼&#34; srcset=&#34;
               /blog/istio-keycloak-authentication-authorization/auth_hu_db0d8f1b0e0ee7f0.webp 400w,
               /blog/istio-keycloak-authentication-authorization/auth_hu_baba024ad359a5f0.webp 760w,
               /blog/istio-keycloak-authentication-authorization/auth_hu_c038c440bdc36dbf.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-keycloak-authentication-authorization/auth_hu_db0d8f1b0e0ee7f0.webp&#34;
               width=&#34;760&#34;
               height=&#34;340&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      ç½‘æ ¼
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;keycloak-ä»‹ç»&#34;&gt;Keycloak ä»‹ç»&lt;/h2&gt;
&lt;p&gt;Keycloak æ˜¯ä¸€ä¸ªå¼€æºçš„èº«ä»½åŠè®¿é—®ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œæä¾›å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·ä¸€æ¬¡è®¤è¯åï¼Œä½¿ç”¨å•ä¸€å‡­è¯è®¿é—®å¤šä¸ªåº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚æˆ‘ç‰¹åˆ«å°è±¡æ·±åˆ»çš„ä¸€ä¸ªåŠŸèƒ½æ˜¯ Keycloak çš„å¼€å‘æµç¨‹ç®€åŒ–èƒ½åŠ›ï¼Œå®ƒæ”¯æŒé›†æˆè‡ªå®šä¹‰ä¸»é¢˜ï¼Œä¾‹å¦‚ç™»å½•é¡µé¢ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å·²å°† Keycloak éƒ¨ç½²åœ¨åŒä¸€ä¸ª Kubernetes é›†ç¾¤å†…ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯æˆ‘ä»¬ç”¨äºæ„å»ºè‡ªå®šä¹‰ Keycloak é•œåƒçš„ Dockerfileã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;FROM quay.io/keycloak/keycloak:24.0.3
COPY ./ex-offenders-theme /opt/keycloak/themes/ex-offenders-theme
COPY ./providers/create-account-custom-spi.jar /opt/keycloak/providers/create-account-custom-spi.jar
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹éƒ¨ç½²æ¸…å•æ¥éƒ¨ç½² Keycloakã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;keycloak&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;keycloak&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;keycloak&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;keycloak&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;keycloak&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;keycloak&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;automountServiceAccountToken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;keycloak&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;eocontainerregistry.azurecr.io/keycloak:v1.8.6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# {&amp;#34;$imagepolicy&amp;#34;: &amp;#34;flux-system:keycloak&amp;#34;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;start&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;KEYCLOAK_ADMIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;admin&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;KEYCLOAK_ADMIN_PASSWORD&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;valueFrom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretKeyRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;keycloak&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;admin-password&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;KC_HOSTNAME&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;auth.ex-offenders.co.uk&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;KC_PROXY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;edge&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;KC_DB&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mysql&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;KC_DB_URL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;jdbc:mysql://keycloakdb-keycloakdb-mysql.keycloakdb.svc.cluster.local:3306/keycloakdb&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;KC_DB_USERNAME&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;keycloak-user&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;jgroups.dns.query&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;keycloak&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;KC_DB_PASSWORD&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;valueFrom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretKeyRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;keycloak&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;db-password&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;jgroups&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;7600&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullSecrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;acr-secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯·æ³¨æ„ï¼Œåœ¨æ¸…å•æ–‡ä»¶ä¸­æåˆ°çš„ FluxCD &lt;code&gt;imagepolicy&lt;/code&gt; å¼•ç”¨ã€‚å€ŸåŠ©æ­¤åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é•œåƒåº“ä¸­æœ‰æ–°é•œåƒå¯ç”¨æ—¶è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-ä»‹ç»&#34;&gt;Istio ä»‹ç»&lt;/h2&gt;
&lt;p&gt;Istio æ˜¯ä¸€ä¸ªå¼€æºçš„æœåŠ¡ç½‘æ ¼å¹³å°ï¼Œæ—¨åœ¨ç®¡ç†å¾®æœåŠ¡çš„é€šä¿¡å’Œæ•°æ®å…±äº«ã€‚å®ƒæä¾›äº†å¤šç§åŠŸèƒ½ï¼Œä»¥æå‡å¾®æœåŠ¡åº”ç”¨çš„å¯è§‚å¯Ÿæ€§ã€å®‰å…¨æ€§å’Œç®¡ç†èƒ½åŠ›ã€‚æˆ‘ä»¬å°†å¾ˆå¿«è®¨è®ºå¦‚ä½•é…ç½® Istioã€‚&lt;/p&gt;
&lt;h2 id=&#34;fastapi-ä»‹ç»&#34;&gt;FastAPI ä»‹ç»&lt;/h2&gt;
&lt;p&gt;FastAPI æ˜¯ä¸€ä¸ªç°ä»£çš„ Python æ¡†æ¶ï¼Œè¿…é€Ÿè·å¾—äº†å¹¿æ³›çš„æµè¡Œã€‚å®ƒè®¾è®¡ç”¨äºå¿«é€Ÿå¼€å‘å¹¶æœ€å¤§åŒ–å¼€å‘è€…ä½“éªŒã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ä¸ªç‰ˆæœ¬çš„ job APIï¼ˆ&lt;a href=&#34;https://github.com/ex-offenders/job-service-v1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;V1&lt;/a&gt;, &lt;a href=&#34;https://github.com/ex-offenders/job-service-v2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;V2&lt;/a&gt;ï¼‰ç¼–å†™äº FastAPIã€‚è¿™ä¸ª API ä½¿ç”¨ SQLModel åº“ä¸åç«¯æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œç»“åˆäº† SQLAlchemy å’Œ Pydantic çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;SQLModel æ˜¯ç”±ä¸ FastAPI ç›¸åŒçš„ä½œè€…å¼€å‘çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²æ— è®¤è¯ä¸æˆæƒçš„-job-service-å¾®æœåŠ¡&#34;&gt;éƒ¨ç½²æ— è®¤è¯ä¸æˆæƒçš„ job-service å¾®æœåŠ¡&lt;/h2&gt;
&lt;p&gt;è®©æˆ‘ä»¬ä»æ›´ç®€å•çš„äº‹æƒ…å¼€å§‹ï¼šä¸€ä¸ªæ²¡æœ‰ä»»ä½•è®¤è¯å’Œæˆæƒçš„jobå¾®æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ job-service v1 å’Œ job-service v2 çš„éƒ¨ç½²æ¸…å•ï¼Œå‡åœ¨â€œjob-serviceâ€å‘½åç©ºé—´è¿è¡Œã€‚æ³¨æ„æ¯ä¸ªéƒ¨ç½²æ¸…å•ä¸­çš„ç‰ˆæœ¬æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;automountServiceAccountToken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;eocontainerregistry.azurecr.io/job-service:v1.0.3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# {&amp;#34;$imagepolicy&amp;#34;: &amp;#34;flux-system:job-service-v1&amp;#34;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DB_HOST&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;keycloakdb-keycloakdb-mysql.keycloakdb.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DB_PASSWORD&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;valueFrom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretKeyRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;db-password&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DB_PORT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;3306&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DB_USER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;job-service&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DB_NAME&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;job-service&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;64Mi&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;50m&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullSecrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;acr-secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service-v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;automountServiceAccountToken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;eocontainerregistry.azurecr.io/job-service-v2:v1.1.3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# {&amp;#34;$imagepolicy&amp;#34;: &amp;#34;flux-system:job-service-v2&amp;#34;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DB_HOST&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;keycloakdb-keycloakdb-mysql.keycloakdb.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DB_PASSWORD&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;valueFrom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretKeyRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;db-password&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DB_PORT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;3306&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DB_USER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;job-service&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DB_NAME&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;job-service&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;64Mi&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;50m&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullSecrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;acr-secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ª ClusterIP æœåŠ¡ï¼Œé€‰æ‹©å™¨ä¸ºâ€œapp=job-serviceâ€ã€‚è¿™ä¸ªé…ç½®ç¡®ä¿äº† job-service v1 å’Œ job-service v2 éƒ½è¢«æ·»åŠ ä¸ºè¿™ä¸ªæœåŠ¡çš„ç«¯ç‚¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kustomize.toolkit.fluxcd.io/name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;flux-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kustomize.toolkit.fluxcd.io/namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;flux-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterIP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®åº“å®ä¾‹ä¸º Keycloak å’Œä¸åŒç‰ˆæœ¬çš„ job-serviceã€‚ç„¶è€Œï¼Œå„è‡ªçš„ç”¨æˆ·è¢«é™åˆ¶ä¸å¾—è®¿é—®å¯¹æ–¹çš„æ•°æ®åº“ã€‚å°½ç®¡å…±äº«åŒä¸€ä¸ªå®ä¾‹ï¼Œè¿™ç§è®¾ç½®æœ‰æ•ˆåœ°æ¨¡æ‹Ÿäº†å¾®æœåŠ¡æ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬å¸Œæœ›å°†æ‰€æœ‰æµé‡ç‹¬å è·¯ç”±åˆ° v1 éƒ¨ç½²ã€‚ï¼ˆå¦‚æœä½ æŸ¥çœ‹ job-service v1ï¼Œä½ ä¼šçœ‹åˆ°å®ƒç¼–å†™æ—¶æ²¡æœ‰åŒ…æ‹¬ä»»ä½•è®¤è¯æˆ–æˆæƒä»£ç ã€‚æˆ‘ä»¬è®¡åˆ’åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­ä½¿ç”¨ Istio å®ç°è¿™äº›åŠŸèƒ½ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†å¦‚ä¸‹çš„è™šæ‹ŸæœåŠ¡å’Œç›®æ ‡è§„åˆ™ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;www.ex-offenders.co.uk&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;ex-offenders.co.uk&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;job-service.job-service.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;istio-system/gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;mesh&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/api/jobs&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/api/jobcategories&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service.job-service.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service.job-service.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: job-service
  namespace: job-service
spec:
  host: job-service.job-service.svc.cluster.local
  subsets:
  - name: v1
    labels:
      version: v1
  - name: v2
    labels:
      version: v2
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ³¨æ„ï¼Œåœ¨ç½‘å…³éƒ¨åˆ†ä¸‹ï¼Œæˆ‘ä»¬æŒ‡å®šäº†æˆ‘ä»¬çš„å…¥å£ç½‘å…³å’Œâ€œmeshâ€ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æœŸæœ›æ¥è‡ªå¤–éƒ¨ç½‘å…³å’Œé›†ç¾¤å†…å…¶ä»–å¾®æœåŠ¡çš„æµé‡ã€‚è§‚å¯Ÿæˆ‘ä»¬å¦‚ä½•å°†100%çš„æµé‡å®šå‘åˆ° v1 éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ Istio ç½‘å…³èµ„æºã€‚å®ƒå¤„ç†ç›®æ ‡ä¸º ex-offenders.co.uk åŸŸçš„æµé‡ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä½¿ç”¨ cert-manager å°† Let&amp;rsquo;s Encrypt TLS è¯ä¹¦é™„åŠ åˆ°ç½‘å…³ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SIMPLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;credentialName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ex-offenders-tls&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;www.ex-offenders.co.uk&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;ex-offenders.co.uk&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;auth.ex-offenders.co.uk&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Kiali ä»ªè¡¨æ¿æ¥éªŒè¯æˆ‘ä»¬çš„è·¯ç”±é…ç½®ã€‚æ³¨æ„ï¼Œ&lt;code&gt;job-service&lt;/code&gt; è¿æ¥åˆ°åŒä¸€ä¸ª &lt;code&gt;keycloakdb&lt;/code&gt; MySQL å®ä¾‹ã€‚ä½†å®é™…ä¸Šï¼Œ&lt;code&gt;job-service&lt;/code&gt; åªèƒ½è®¿é—®å®ä¾‹å†…çš„ç‰¹å®š &lt;code&gt;job-service&lt;/code&gt; æ•°æ®åº“ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-è·¯ç”±&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;è·¯ç”±&#34; srcset=&#34;
               /blog/istio-keycloak-authentication-authorization/kiali_hu_4e49aab135379ef4.webp 400w,
               /blog/istio-keycloak-authentication-authorization/kiali_hu_1d577dd078eabc48.webp 760w,
               /blog/istio-keycloak-authentication-authorization/kiali_hu_c375891ec28a44cc.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-keycloak-authentication-authorization/kiali_hu_4e49aab135379ef4.webp&#34;
               width=&#34;760&#34;
               height=&#34;254&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      è·¯ç”±
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å‡†å¤‡è¿›è¡Œä¸€äº›æµ‹è¯•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ›å»ºæ–°çš„jobç±»åˆ«&#34;&gt;åˆ›å»ºæ–°çš„jobç±»åˆ«&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --location &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://ex-offenders.co.uk/api/jobcategories/&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--header &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--data &lt;span class=&#34;s1&#34;&gt;&amp;#39;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;    &amp;#34;name&amp;#34;: &amp;#34;Information Technology&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;Information Technology&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;:17&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åˆ›å»ºæ–°-job&#34;&gt;åˆ›å»ºæ–° job&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --location &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://ex-offenders.co.uk/api/jobs/&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--header &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--data &lt;span class=&#34;s1&#34;&gt;&amp;#39;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  &amp;#34;title&amp;#34;: &amp;#34;Software Engineer&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  &amp;#34;description&amp;#34;: &amp;#34;Software Engineer with 2 years of experience&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  &amp;#34;owner_id&amp;#34;: &amp;#34;5690cc29-5008-4a81-8f08-db92e01d6d44&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  &amp;#34;category_id&amp;#34;: 17
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;Software Engineer&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;Software Engineer with 2 years of experience&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;owner_id&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;5690cc29-5008-4a81-8f08-db92e01d6d44&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;category_id&amp;#34;&lt;/span&gt;:17,&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;f19e68da-e40a-4954-9dbf-6dfaf1f7f4d4&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;é€šè¿‡-id-è·å–-job-ç±»åˆ«&#34;&gt;é€šè¿‡ ID è·å– job ç±»åˆ«&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --location &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://ex-offenders.co.uk/api/jobcategories/17&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;Information Technology&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;:17&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;é€šè¿‡-id-è·å–-job&#34;&gt;é€šè¿‡ ID è·å– job&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --location &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://ex-offenders.co.uk/api/jobs/bff285f6-34f6-4c5f-9619-2e860bec2d87&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;Software Engineer&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;Software Engineer with 2 years of experience&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;owner_id&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;5690cc29-5008-4a81-8f08-db92e01d6d44&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;category_id&amp;#34;&lt;/span&gt;:17,&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;bff285f6-34f6-4c5f-9619-2e860bec2d87&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æ‚¨æ‰€è§ï¼Œè¿™äº›ç«¯ç‚¹æ²¡æœ‰èº«ä»½éªŒè¯æˆ–æˆæƒã€‚ä»»ä½•äººéƒ½å¯ä»¥åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æˆ–æ£€ç´¢jobå’Œjobç±»åˆ«ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œæˆ‘ä½¿ç”¨ä¸ FastAPI é›†æˆçš„ Swagger ç”Ÿæˆäº†æ ·æœ¬ curl è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;å¦è¯·æ³¨æ„ï¼Œå½“åˆ›å»ºæ–°jobæ—¶ï¼Œæˆ‘ä»¬æ‰‹åŠ¨ä¼ é€’äº† &lt;code&gt;owner_id&lt;/code&gt;ã€‚ç†æƒ³&lt;/p&gt;
&lt;p&gt;æƒ…å†µä¸‹ï¼Œè¿™åº”è¯¥æ˜¯å·²ç™»å½•ç”¨æˆ·çš„ç”¨æˆ· IDã€‚æˆ‘ä»¬å°†åœ¨è®¨è®º job-service v2 æ—¶è¿›ä¸€æ­¥æ·±å…¥æ¢è®¨è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-istio-å®ç°è®¤è¯&#34;&gt;ä½¿ç”¨ Istio å®ç°è®¤è¯&lt;/h2&gt;
&lt;p&gt;è®©æˆ‘ä»¬å¼€å§‹ä¿æŠ¤æˆ‘ä»¬çš„ç«¯ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬æ·»åŠ  RequestAuthentication èµ„æºï¼Œå®šä¹‰å¯¹jobè´Ÿè½½æ”¯æŒçš„è¯·æ±‚è®¤è¯ã€‚è¿™ä¸ªé…ç½®ç¡®ä¿ Istio æ‹’ç»ä»»ä½•å…·æœ‰æ— æ•ˆè®¤è¯ä¿¡æ¯çš„è¯·æ±‚ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å®šä¹‰äº†æˆ‘ä»¬çš„ Keycloak å‘è¡Œè€… URL å’Œå…¬å¼€è¯ä¹¦ URLï¼Œä»¥ä¾¿ Istio éªŒè¯ä»¤ç‰Œç­¾åã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;security.istio.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;RequestAuthentication&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;jwtRules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;issuer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https://auth.ex-offenders.co.uk/realms/ex-offenders&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;jwksUri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https://auth.ex-offenders.co.uk/realms/ex-offenders/protocol/openid-connect/certs&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;forwardOriginalToken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤å¤–ï¼Œæˆ‘ä»¬è®¾å®šäº†â€œforwardOriginalTokenâ€: trueï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ä»¥â€œAuthorization: Bearerâ€æ ¼å¼å°†ä»¤ç‰Œä¼ é€’ç»™åç«¯æœåŠ¡ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ç‰‡æ®µå°†ä»¤ç‰Œä½œä¸ºâ€œjwt_parsedâ€é”®çš„å€¼ä¼ é€’ç»™åç«¯æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;jwtRules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;issuer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https://auth.ex-offenders.co.uk/realms/ex-offenders&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;jwksUri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https://auth.ex-offenders.co.uk/realms/ex-offenders/protocol/openid-connect/certs&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;outputPayloadToHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;jwt-parsed&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼ŒRequestAuthentication å°†æ‹’ç»ä»»ä½•å¸¦æœ‰æ— æ•ˆä»¤ç‰Œçš„è¯·æ±‚ã€‚ç„¶è€Œï¼Œæ²¡æœ‰ä»»ä½•è®¤è¯ä¿¡æ¯çš„è¯·æ±‚ä»ç„¶ä¼šè¢«æ¥å—ï¼Œä½†å®ƒä»¬ä¸ä¼šæœ‰ä¸€ä¸ªç»è¿‡è®¤è¯çš„èº«ä»½ã€‚ä¸ºäº†å¤„ç†è¿™äº›æƒ…å†µï¼Œé™¤äº† RequestAuthentication å¤–ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ æˆæƒæ”¿ç­–æ¥æ‹’ç»ç¼ºå°‘è®¤è¯èº«ä»½çš„è¯·æ±‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æŒ‰å¦‚ä¸‹æ–¹å¼æ·»åŠ ä¸€ä¸ªæˆæƒç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;security.istio.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AuthorizationPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;methods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requestPrincipals&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;methods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;DELETE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;PATCH&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/api/jobs*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;methods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;DELETE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;PATCH&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/api/jobcategories*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› æ­¤ï¼Œä¸Šè¿° AuthorizationPolicy å…è®¸ä»»ä½•äººæ— é™åˆ¶åœ°è®¿é—® GET æ–¹æ³•ã€‚ç„¶è€Œï¼Œå¯¹ job å’Œ jobcategory ç«¯ç‚¹çš„ä»»ä½•å…¶ä»–æ–¹æ³•éƒ½éœ€è¦è®¤è¯ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æµ‹è¯•ä¸€äº›ç«¯ç‚¹ï¼š&lt;/p&gt;
&lt;h3 id=&#34;åˆ›å»ºæ–°job&#34;&gt;åˆ›å»ºæ–°job&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --location &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://ex-offenders.co.uk/api/jobs/&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--header &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--data &lt;span class=&#34;s1&#34;&gt;&amp;#39;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  &amp;#34;title&amp;#34;: &amp;#34;Software Engineer II&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  &amp;#34;description&amp;#34;: &amp;#34;Software Engineer with 2 years of experience&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  &amp;#34;owner_id&amp;#34;: &amp;#34;5690cc29-5008-4a81-8f08-db92e01d6d44&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  &amp;#34;category_id&amp;#34;: 17
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;RBAC: access denied
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;é€šè¿‡-id-è·å–-job-1&#34;&gt;é€šè¿‡ ID è·å– job&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --location &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://ex-offenders.co.uk/api/jobs/bff285f6-34f6-4c5f-9619-2e860bec2d87&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;Software Engineer&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;Software Engineer with 2 years of experience&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;owner_id&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;5690cc29-5008-4a81-8f08-db92e01d6d44&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;category_id&amp;#34;&lt;/span&gt;:17,&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;bff285f6-34f6-4c5f-9619-2e860bec2d87&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åˆ›å»ºæ–°çš„-job-ç±»åˆ«&#34;&gt;åˆ›å»ºæ–°çš„ job ç±»åˆ«&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --location &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://ex-offenders.co.uk/api/jobcategories/&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--header &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--data &lt;span class=&#34;s1&#34;&gt;&amp;#39;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;    &amp;#34;name&amp;#34;: &amp;#34;Computer Science&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;RBAC: access denied
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;é€šè¿‡-id-è·å–-job-ç±»åˆ«-1&#34;&gt;é€šè¿‡ ID è·å– job ç±»åˆ«&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --location &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://ex-offenders.co.uk/api/jobcategories/17&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;Information Technology&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;:17&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­£å¦‚è§‚å¯Ÿåˆ°çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ²¡æœ‰è®¤è¯çš„æƒ…å†µä¸‹æ£€ç´¢ä¿¡æ¯ã€‚ç„¶è€Œï¼Œæ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤æ¡ç›®éœ€è¦è®¤è¯ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬é€šè¿‡è°ƒç”¨ Keycloak ä»¤ç‰Œ URL ç”Ÿæˆä»¤ç‰Œï¼Œå¹¶ä½¿ç”¨å®ƒæ¥æ‰§è¡Œæ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤æ“ä½œï¼š&lt;/p&gt;
&lt;h3 id=&#34;ç”Ÿæˆä»¤ç‰Œ&#34;&gt;ç”Ÿæˆä»¤ç‰Œ&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --location &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://auth.ex-offenders.co.uk/realms/ex-offenders/protocol/openid-connect/token&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--header &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/x-www-form-urlencoded&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--data-urlencode &lt;span class=&#34;s1&#34;&gt;&amp;#39;grant_type=password&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--data-urlencode &lt;span class=&#34;s1&#34;&gt;&amp;#39;client_id=ex-offenders-platform&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--data-urlencode &lt;span class=&#34;s1&#34;&gt;&amp;#39;username=&amp;lt;username&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--data-urlencode &lt;span class=&#34;s1&#34;&gt;&amp;#39;password=&amp;lt;password&amp;gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†è¿”å›ä¸€ä¸ªè®¿é—®ä»¤ç‰Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒè¿›è¡Œåç»­è¯·æ±‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ›å»ºæ–°job-1&#34;&gt;åˆ›å»ºæ–°job&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --location &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://ex-offenders.co.uk/api/jobs/&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--header &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--header &lt;span class=&#34;s1&#34;&gt;&amp;#39;Authorization: Bearer &amp;lt;token&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--data &lt;span class=&#34;s1&#34;&gt;&amp;#39;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  &amp;#34;title&amp;#34;: &amp;#34;Software Engineer II&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  &amp;#34;description&amp;#34;: &amp;#34;Software Engineer with 2 years of experience&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  &amp;#34;owner_id&amp;#34;: &amp;#34;5690cc29-5008-4a81-8f08-db92e01d6d44&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  &amp;#34;category_id&amp;#34;: 17
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;Software Engineer II&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;Software Engineer with 2 years of experience&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;owner_id&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;5690cc29-5008-4a81-8f08-db92e01d6d44&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;category_id&amp;#34;&lt;/span&gt;: 17,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;571c9ce6-566f-4e57-a780-9af5275ce5ef&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æ‰€ç¤ºï¼Œç»è¿‡è®¤è¯çš„ç”¨æˆ·èƒ½å¤ŸæˆåŠŸåœ°æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤jobå’Œjobç±»åˆ«ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-istio-å®ç°æˆæƒ&#34;&gt;ä½¿ç”¨ Istio å®ç°æˆæƒ&lt;/h2&gt;
&lt;p&gt;åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å·²ç»é…ç½®äº†è®¤è¯ã€‚å°±jobç±»åˆ«è€Œè¨€ï¼Œæˆ‘ä»¬ä¸é¢„æœŸæ•°æ®åº“ä¸­å­˜åœ¨å¤§é‡ç±»åˆ«ã€‚æœ‰ç†ç”±ç»´æŒæœ‰é™æ•°é‡çš„jobç±»åˆ«ï¼Œå¹¶å°†åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤æƒé™é™åˆ¶ç»™ç®¡ç†å‘˜ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;p&gt;å½“å‰ï¼Œä»»ä½•å…·æœ‰æœ‰æ•ˆè®¤è¯çš„ç”¨æˆ·éƒ½å¯ä»¥ä¿®æ”¹jobç±»åˆ«ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å®ç°æˆæƒã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä¿®æ”¹æˆæƒæ”¿ç­–ï¼Œä»¥ç¡®ä¿åªæœ‰æ‹¥æœ‰ç®¡ç†å‘˜è§’è‰²çš„ç”¨æˆ·å¯ä»¥ä¿®æ”¹jobç±»åˆ«ã€‚æˆ–è€…ï¼Œå¦‚æœæ‚¨æœ‰æ›´å¤æ‚çš„ç”¨æˆ·å±‚æ¬¡ç»“æ„ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨â€œç»„â€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;security.istio.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AuthorizationPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;methods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requestPrincipals&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;methods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;DELETE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;PATCH&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/api/jobs*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requestPrincipals&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;when&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;request.auth.claims[realm_access][roles]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;admin&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;methods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;DELETE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;PATCH&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/api/jobcategories*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¼èˆªåˆ°æˆ‘ä»¬ä½¿ç”¨çš„ Keycloak é¢†åŸŸä¸‹çš„â€œRealm Rolesâ€æ¥åˆ›å»ºç®¡ç†å‘˜è§’è‰²ã€‚ä¹‹åï¼Œæˆ‘ä»¬å‰å¾€è¦åˆ†é…ç®¡ç†å‘˜è§’è‰²çš„ç›¸åº”ç”¨æˆ·ï¼Œç‚¹å‡»â€œRole Mappingâ€æ ‡ç­¾ï¼Œå¹¶å°†ç”¨æˆ·æ·»åŠ åˆ°æ–°åˆ›å»ºçš„â€œadminâ€è§’è‰²ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-é¢†åŸŸè§’è‰²&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;é¢†åŸŸè§’è‰²&#34; srcset=&#34;
               /blog/istio-keycloak-authentication-authorization/realm-roles_hu_99e7070ce4372cb2.webp 400w,
               /blog/istio-keycloak-authentication-authorization/realm-roles_hu_7927ee14967226a9.webp 760w,
               /blog/istio-keycloak-authentication-authorization/realm-roles_hu_b1786ac901dcf668.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-keycloak-authentication-authorization/realm-roles_hu_99e7070ce4372cb2.webp&#34;
               width=&#34;760&#34;
               height=&#34;132&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      é¢†åŸŸè§’è‰²
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-è§’è‰²æ˜ å°„&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;è§’è‰²æ˜ å°„&#34; srcset=&#34;
               /blog/istio-keycloak-authentication-authorization/role-mapping_hu_e1e88acb7d997761.webp 400w,
               /blog/istio-keycloak-authentication-authorization/role-mapping_hu_5aa015911c0b7625.webp 760w,
               /blog/istio-keycloak-authentication-authorization/role-mapping_hu_ddc2a59ae20ae368.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-keycloak-authentication-authorization/role-mapping_hu_e1e88acb7d997761.webp&#34;
               width=&#34;760&#34;
               height=&#34;159&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      è§’è‰²æ˜ å°„
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;åˆ›å»ºjobç±»åˆ«---æ™®é€šç”¨æˆ·&#34;&gt;åˆ›å»ºjobç±»åˆ« - æ™®é€šç”¨æˆ·&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --location &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://ex-offenders.co.uk/api/jobcategories/&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--header &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--header &lt;span class=&#34;s1&#34;&gt;&amp;#39;Authorization: Bearer &amp;lt;token&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--data &lt;span class=&#34;s1&#34;&gt;&amp;#39;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;    &amp;#34;name&amp;#34;: &amp;#34;Research&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;RBAC: access denied
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åˆ›å»ºjobç±»åˆ«---ç®¡ç†å‘˜ç”¨æˆ·&#34;&gt;åˆ›å»ºjobç±»åˆ« - ç®¡ç†å‘˜ç”¨æˆ·&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --location &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://ex-offenders.co.uk/api/jobcategories/&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--header &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--header &lt;span class=&#34;s1&#34;&gt;&amp;#39;Authorization: Bearer &amp;lt;token&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--data &lt;span class=&#34;s1&#34;&gt;&amp;#39;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;    &amp;#34;name&amp;#34;: &amp;#34;Research&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;Research&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;:20&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æˆ‘ä»¬æ‰€è§ï¼Œç°åœ¨åªæœ‰ç®¡ç†å‘˜ç”¨æˆ·å¯ä»¥åˆ›å»º/æ›´æ–°/åˆ é™¤jobç±»åˆ«ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¾®æœåŠ¡é—´çš„æˆæƒå®æ–½&#34;&gt;å¾®æœåŠ¡é—´çš„æˆæƒå®æ–½&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å¢åŠ å¦ä¸€ä¸ªåä¸ºâ€œjob-notification-serviceâ€çš„å¾®æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-jobé€šçŸ¥æœåŠ¡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;jobé€šçŸ¥æœåŠ¡&#34; srcset=&#34;
               /blog/istio-keycloak-authentication-authorization/job-notification-service_hu_f96134278f8e611.webp 400w,
               /blog/istio-keycloak-authentication-authorization/job-notification-service_hu_30187004b9e0b3d0.webp 760w,
               /blog/istio-keycloak-authentication-authorization/job-notification-service_hu_4efbb41153b7ba2e.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-keycloak-authentication-authorization/job-notification-service_hu_f96134278f8e611.webp&#34;
               width=&#34;760&#34;
               height=&#34;301&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      jobé€šçŸ¥æœåŠ¡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæœåŠ¡ä¸é€šè¿‡ç½‘å…³æš´éœ²ï¼Œå¹¶ä¸”åº”ä»…è¢«â€œjob-serviceâ€è®¿é—®ã€‚ä¸ºå®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä»¥ä¸‹æˆæƒæ”¿ç­–ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;security.istio.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AuthorizationPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-notification-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-notification-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;job-notification-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;job-service&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;principals&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cluster.local/ns/job-service/sa/job-service&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;æ€»ç»“æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨ Istio å’Œ Keycloak å®ç°äº†å¯¹æˆ‘ä»¬çš„å¾®æœåŠ¡çš„è®¤è¯å’Œæˆæƒï¼Œç¡®ä¿äº†èµ„æºçš„å®‰å…¨è®¿é—®ã€‚æˆ‘ä»¬é…ç½®äº†åŸºäºè§’è‰²å’Œç”¨æˆ·èº«ä»½çš„è®¿é—®æ§åˆ¶æ”¿ç­–ï¼Œå¢å¼ºäº†æˆ‘ä»¬åº”ç”¨çš„æ•´ä½“å®‰å…¨å§¿æ€ã€‚&lt;/p&gt;
&lt;p&gt;æ¬¢è¿æ‚¨æä¾›ä»»ä½•æ”¹è¿›å»ºè®®ã€å¯èƒ½å¿½ç•¥çš„æ–¹é¢æˆ–å¢å¼ºæœ¬æ–‡æ¡£çš„å»ºè®®ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨ï¼šæœ¬é¡µé¢æ˜¯ Cloud Agnostic Platform æŒ‡å—çš„ä¸€éƒ¨åˆ†ã€‚ç‚¹å‡»&lt;a href=&#34;https://github.com/ex-offenders/Cloud-Agnostic-Startup-Platform/tree/main&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;è®¿é—®ä¸»é¡µã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istiod æ¶æ„è¯¦è§£</title>
      <link>https://cloudnativecn.com/blog/istiod-architecture/</link>
      <pubDate>Fri, 14 Jun 2024 11:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istiod-architecture/</guid>
      <description>&lt;p&gt;æœ¬æ–‡æ¡£æè¿°äº† Istio æ§åˆ¶å¹³é¢â€”â€”Istiod çš„é«˜å±‚æ¶æ„ã€‚Istiod æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„å•ä½“åº”ç”¨ï¼Œæ¶µç›–äº†ä»è¯ä¹¦ç­¾åã€ä»£ç†é…ç½®ï¼ˆXDSï¼‰ã€ä¼ ç»Ÿçš„ Kubernetes æ§åˆ¶å™¨ç­‰å¤šç§åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;proxy-configuration&#34;&gt;ä»£ç†é…ç½®&lt;/h2&gt;
&lt;p&gt;Istiod çš„ä¸»è¦è§’è‰²â€”â€”ä»¥åŠå¤§éƒ¨åˆ†ä»£ç â€”â€”æ˜¯åŠ¨æ€é…ç½®ä»£ç†ï¼ˆEnvoy sidecarã€å…¥å£ã€gRPCã€ztunnel ç­‰ï¼‰ã€‚è¿™å¤§è‡´åŒ…æ‹¬ 3 ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é…ç½®æ‘„å–ï¼ˆç³»ç»Ÿçš„è¾“å…¥ï¼‰&lt;/li&gt;
&lt;li&gt;é…ç½®ç¿»è¯‘&lt;/li&gt;
&lt;li&gt;é…ç½®æœåŠ¡ï¼ˆXDSï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;é…ç½®æ‘„å–&#34;&gt;é…ç½®æ‘„å–&lt;/h3&gt;
&lt;p&gt;Istio ä»è¶…è¿‡ 20 ç§ä¸åŒçš„èµ„æºç±»å‹è¯»å–ï¼Œå¹¶å°†å®ƒä»¬èšåˆåœ¨ä¸€èµ·æ„å»ºä»£ç†é…ç½®ã€‚è¿™äº›èµ„æºå¯ä»¥æ¥è‡ª Kubernetesï¼ˆé€šè¿‡è§‚å¯Ÿï¼‰ã€æ–‡ä»¶æˆ–é€šè¿‡ xDSï¼›å°½ç®¡å¦‚æ­¤ï¼ŒKubernetes æ˜¯æœ€å¸¸ç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»è¦å‡ºäºå†å²åŸå› ï¼Œæ‘„å–åˆ†ä¸ºå‡ ä¸ªç»„ä»¶ã€‚&lt;/p&gt;
&lt;h4 id=&#34;configstore&#34;&gt;ConfigStore&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;ConfigStore&lt;/code&gt; è¯»å–å¤šç§èµ„æºï¼Œå¹¶é€šè¿‡æ ‡å‡†æ¥å£ï¼ˆGetã€List ç­‰ï¼‰æš´éœ²å®ƒä»¬ã€‚è¿™äº›ç±»å‹è¢«åŒ…è£…åœ¨é€šç”¨çš„ &lt;code&gt;config.Config&lt;/code&gt; ç»“æ„ä¸­ï¼Œä¸é€šå¸¸ä½¿ç”¨æ¯ç§èµ„æºç±»å‹çš„ Kubernetes å®¢æˆ·ç«¯å½¢æˆå¯¹æ¯”ã€‚æœ€å¸¸è§çš„æ˜¯é€šè¿‡ &lt;code&gt;crdclient&lt;/code&gt; åŒ…ä» Kubernetes è¯»å–ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./output-1.svg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;ServiceDiscovery&#34;&gt;æœåŠ¡å‘ç°&lt;/h4&gt;
&lt;p&gt;å¦ä¸€ä¸ªä¸»è¦æ¥å£æ˜¯ ServiceDiscoveryã€‚ç±»ä¼¼äº ConfigStoreï¼Œå®ƒä¹Ÿæ˜¯å¯¹å¤šç§èµ„æºè¿›è¡Œèšåˆã€‚ç„¶è€Œï¼Œå®ƒä¸æä¾›é€šç”¨èµ„æºè®¿é—®ï¼Œè€Œæ˜¯é¢„è®¡ç®—äº†å¤šç§æœåŠ¡å¯¼å‘çš„å†…éƒ¨èµ„æºï¼Œå¦‚ &lt;code&gt;model.Service&lt;/code&gt; å’Œ &lt;code&gt;model.ServiceInstance&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç”±ä¸¤ä¸ªæ§åˆ¶å™¨ç»„æˆâ€”â€”ä¸€ä¸ªç”±æ ¸å¿ƒ Kubernetes ç±»å‹é©±åŠ¨ï¼ˆâ€œKube Controllerâ€ï¼‰ï¼Œä¸€ä¸ªç”± Istio ç±»å‹é©±åŠ¨ï¼ˆâ€œServiceEntry æ§åˆ¶å™¨â€ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./output-2.svg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿™æ˜¯ç›¸å½“ç›´æ¥çš„ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬æ”¯æŒ &lt;code&gt;ServiceEntry&lt;/code&gt; é€‰æ‹© &lt;code&gt;Pod&lt;/code&gt;ï¼Œä»¥åŠ &lt;code&gt;Service&lt;/code&gt; é€‰æ‹© &lt;code&gt;WorkloadEntry&lt;/code&gt;ï¼Œè¿™å¯¼è‡´è·¨æ§åˆ¶å™¨é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼š&lt;code&gt;Pods&lt;/code&gt; ä¸è´¡çŒ®ç»™ Kube æ§åˆ¶å™¨çš„ &lt;code&gt;ServiceInstances&lt;/code&gt; æ˜¯å› ä¸ºä½¿ç”¨äº† &lt;code&gt;Endpoints&lt;/code&gt;ï¼Œå®ƒæœ¬èº«æ˜¯ä» Kubernetes æ ¸å¿ƒçš„ &lt;code&gt;Pod&lt;/code&gt; æ´¾ç”Ÿçš„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;pushcontext&#34;&gt;PushContext&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;PushContext&lt;/code&gt; æ˜¯å½“å‰å…¨å±€çŠ¶æ€ï¼ˆSotWï¼‰çš„ä¸€ä¸ªä¸å¯å˜å¿«ç…§ã€‚å®ƒåœ¨æ¯æ¬¡é…ç½®æ¨é€æ—¶ï¼ˆä¸‹é¢ä¼šè¯¦ç»†è®¨è®ºï¼‰é€šå¸¸æ˜¯éƒ¨åˆ†åœ°é‡æ–°ç”Ÿæˆçš„ã€‚ç”±äºæ˜¯å¿«ç…§ï¼Œå¤§å¤šæ•°æŸ¥æ‰¾éƒ½æ˜¯æ— é”çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;PushContext&lt;/code&gt; æ˜¯é€šè¿‡æŸ¥è¯¢ä¸Šè¿°å±‚æ„å»ºçš„ã€‚å¯¹äºä¸€äº›ç®€å•çš„ç”¨ä¾‹ï¼Œè¿™å’Œå­˜å‚¨ç±»ä¼¼äº &lt;code&gt;configstore.List(SomeType)&lt;/code&gt; çš„ä¸œè¥¿ä¸€æ ·ç®€å•ï¼›åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ç›´æ¥æš´éœ² configstore çš„å”¯ä¸€åŒºåˆ«æ˜¯è¦å¿«ç…§å½“å‰çŠ¶æ€ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œä¸€äº›é¢„è®¡ç®—å’Œç´¢å¼•è¢«è®¡ç®—å‡ºæ¥ï¼Œä»¥ä¾¿åç»­è®¿é—®æ•ˆç‡ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç«¯ç‚¹&#34;&gt;ç«¯ç‚¹&lt;/h4&gt;
&lt;p&gt;ç«¯ç‚¹æœ‰ä¸€ä¸ªä¼˜åŒ–çš„ä»£ç è·¯å¾„ï¼Œå› ä¸ºå®ƒä»¬æ˜¯è¿„ä»Šä¸ºæ­¢æ›´æ–°æœ€é¢‘ç¹çš„èµ„æºâ€”â€”åœ¨ä¸€ä¸ªç¨³å®šçš„é›†ç¾¤ä¸­ï¼Œè¿™é€šå¸¸æ˜¯&lt;em&gt;å”¯ä¸€&lt;/em&gt;çš„å˜åŒ–ï¼Œç”±æ‰©ç¼©å®¹å¼•èµ·ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå®ƒä»¬ä¸ç»è¿‡ &lt;code&gt;PushContext&lt;/code&gt;ï¼Œå˜åŒ–ä¹Ÿä¸ä¼šè§¦å‘ &lt;code&gt;PushContext&lt;/code&gt; çš„é‡æ–°è®¡ç®—ã€‚ç›¸åï¼Œå½“å‰çŠ¶æ€æ˜¯åŸºäºæ¥è‡ª &lt;code&gt;ServiceDiscovery&lt;/code&gt; çš„äº‹ä»¶å¢é‡è®¡ç®—çš„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h4&gt;
&lt;p&gt;æ€»ä½“è€Œè¨€ï¼Œé…ç½®æ‘„å–æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./output-3.svg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;é…ç½®ç¿»è¯‘&#34;&gt;é…ç½®ç¿»è¯‘&lt;/h3&gt;
&lt;p&gt;é…ç½®ç¿»è¯‘å°†ä¸Šè¿°è¾“å…¥è½¬æ¢ä¸ºè¿æ¥çš„ XDS å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯ Envoyï¼‰æ¶ˆè´¹çš„å®é™…ç±»å‹ã€‚è¿™é€šè¿‡ &lt;code&gt;Generators&lt;/code&gt; å®Œæˆï¼Œè¿™äº›ç”Ÿæˆå™¨æ³¨å†Œä¸€ä¸ªå‡½æ•°æ¥æ„å»ºç»™å®šç±»å‹ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ª &lt;code&gt;RouteGenerator&lt;/code&gt; è´Ÿè´£æ„å»º &lt;code&gt;Routes&lt;/code&gt;ã€‚é™¤äº†æ ¸å¿ƒ Envoy XDS ç±»å‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›è‡ªå®šä¹‰çš„ Istio ç±»å‹ï¼Œä¾‹å¦‚æˆ‘ä»¬ç”¨äº DNS çš„ &lt;code&gt;NameTable&lt;/code&gt; ç±»å‹ï¼Œä»¥åŠè°ƒè¯•æ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Generators&lt;/code&gt; çš„è¾“å…¥æ˜¯ &lt;code&gt;Proxy&lt;/code&gt;ï¼ˆå½“å‰å®¢æˆ·ç«¯çš„è¡¨ç¤ºï¼‰ã€å½“å‰çš„ &lt;code&gt;PushContext&lt;/code&gt; å¿«ç…§ä»¥åŠå¯¼è‡´æ›´æ”¹çš„é…ç½®æ›´æ–°åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;å°† &lt;code&gt;Proxy&lt;/code&gt; ä½œä¸ºè¾“å…¥å‚æ•°æ˜¯é‡è¦çš„ï¼Œå¹¶ä¸”ä¸å…¶ä»–ä¸€äº› XDS å®ç°çš„ä¸»è¦åŒºåˆ«ã€‚æˆ‘ä»¬æ— æ³•åœ¨æ²¡æœ‰æ¯ä¸ªå®¢æˆ·ç«¯ä¿¡æ¯çš„æƒ…å†µä¸‹é™æ€ç¿»è¯‘è¾“å…¥åˆ° XDSã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¾èµ–äºå®¢æˆ·ç«¯çš„æ ‡ç­¾æ¥ç¡®å®šåº”ç”¨çš„æ”¿ç­–é›†ã€‚è™½ç„¶è¿™æ˜¯å®ç° Istio API çš„å¿…è¦æ¡ä»¶ï¼Œä½†å®ƒç¡®å®å¤§å¤§é™åˆ¶äº†æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç¼“å­˜&#34;&gt;ç¼“å­˜&lt;/h4&gt;
&lt;p&gt;é…ç½®ç¿»è¯‘é€šå¸¸å ç”¨äº† Istiod çš„ç»å¤§éƒ¨åˆ†èµ„æºä½¿ç”¨ï¼Œå°¤å…¶æ˜¯ protobuf ç¼–ç ã€‚å› æ­¤ï¼Œå¼•å…¥äº†ç¼“å­˜ï¼Œå­˜å‚¨ç»™å®šèµ„æºçš„å·²ç¼–ç  &lt;code&gt;protobuf.Any&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§ç¼“å­˜ä¾èµ–äºå£°æ˜æ‰€æœ‰è¾“å…¥åˆ°ç»™å®šç”Ÿæˆå™¨ä½œä¸ºç¼“å­˜é”®çš„ä¸€éƒ¨åˆ†ã€‚è¿™æå…¶å®¹æ˜“å‡ºé”™ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•ä¸œè¥¿é˜»æ­¢ç”Ÿæˆå™¨ä½¿ç”¨&lt;em&gt;ä¸&lt;/em&gt;æ˜¯é”®éƒ¨åˆ†çš„è¾“å…¥ã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œä¸åŒçš„å®¢æˆ·ç«¯å°†ä¸ç¡®å®šåœ°è·å¾—é”™è¯¯çš„é…ç½®ã€‚è¿™ç§ç±»å‹çš„é”™è¯¯åœ¨å†å²ä¸Šå¯¼è‡´äº† CVEã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å‡ ç§æ–¹æ³•å¯ä»¥é˜²æ­¢è¿™äº›é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªå°†ç¼“å­˜é”®æœ¬èº«ä¼ å…¥åˆ°ç”Ÿæˆé€»è¾‘ä¸­ï¼Œè¿™æ ·å°±ä¸èƒ½ä½¿ç”¨å…¶ä»–æœªè®¡å…¥çš„è¾“å…¥ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä»Šå¤©è¿˜æ²¡æœ‰ä»»ä½•ç”Ÿæˆå™¨è¿™æ ·åšã€‚&lt;/li&gt;
&lt;li&gt;éå¸¸éå¸¸å°å¿ƒã€‚&lt;/li&gt;
&lt;li&gt;ç¼“å­˜æœ‰ä¸€ä¸ªå†…ç½®æµ‹è¯•ï¼Œé€šè¿‡è®¾ç½® &lt;code&gt;UNSAFE_PILOT_ENABLE_RUNTIME_ASSERTIONS=true&lt;/code&gt; å¯ç”¨ï¼Œè¯¥æµ‹è¯•åœ¨ CI ä¸­è¿è¡Œã€‚å¦‚æœä»»ä½•é”®ä»¥ä¸åŒçš„å€¼å†™å…¥ï¼Œè¿™å°†å¼•å‘ panicã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;éƒ¨åˆ†è®¡ç®—&#34;&gt;éƒ¨åˆ†è®¡ç®—&lt;/h4&gt;
&lt;p&gt;ä¸ç¼“å­˜ä¸€æ ·ï¼Œéƒ¨åˆ†è®¡ç®—æ˜¯ç¡®ä¿æˆ‘ä»¬ä¸éœ€è¦åœ¨æ¯æ¬¡æ›´æ”¹æ—¶ä¸ºæ¯ä¸ªä»£ç†æ„å»ºï¼ˆæˆ–å‘é€ï¼‰æ¯ä¸ªèµ„æºçš„å…³é”®æ€§èƒ½ä¼˜åŒ–ã€‚è¿™å°†åœ¨é…ç½®æœåŠ¡éƒ¨åˆ†ä¸­æ›´è¯¦ç»†è®¨è®ºã€‚&lt;/p&gt;
&lt;h3 id=&#34;é…ç½®æœåŠ¡&#34;&gt;é…ç½®æœåŠ¡&lt;/h3&gt;
&lt;p&gt;é…ç½®æœåŠ¡æ˜¯å®é™…æ¥å—ä»£ç†å®¢æˆ·ç«¯çš„å±‚ï¼Œè¿™äº›å®¢æˆ·ç«¯é€šè¿‡åŒå‘ gRPC æµè¿æ¥ï¼Œå¹¶ä¸ºå®ƒä»¬æä¾›æ‰€éœ€çš„é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†æœ‰ä¸¤ç§è§¦å‘å‘é€é…ç½®çš„æ–¹å¼â€”â€”è¯·æ±‚å’Œæ¨é€ã€‚&lt;/p&gt;
&lt;h4 id=&#34;è¯·æ±‚&#34;&gt;è¯·æ±‚&lt;/h4&gt;
&lt;p&gt;æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ç‰¹åˆ«è¦æ±‚ä¸€ç»„èµ„æºã€‚è¿™å¯èƒ½æ˜¯åœ¨æ–°è¿æ¥ä¸Šè¯·æ±‚åˆå§‹èµ„æºé›†ï¼Œæˆ–è€…æ¥è‡ªæ–°çš„ä¾èµ–ã€‚ä¾‹å¦‚ï¼Œ&lt;code&gt;Cluster X&lt;/code&gt; çš„æ¨é€å¼•ç”¨ &lt;code&gt;Endpoint Y&lt;/code&gt; å¯èƒ½å¯¼è‡´è¯·æ±‚ &lt;code&gt;Endpoint Y&lt;/code&gt;ï¼ˆå¦‚æœå®¢æˆ·ç«¯å°šæœªçŸ¥é“çš„è¯ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„å®¢æˆ·ç«¯å®é™…ä¸Šå¯ä»¥å‘é€ä¸‰ç§ç±»å‹çš„æ¶ˆæ¯â€”â€”è¯·æ±‚ã€å¯¹å…ˆå‰æ¨é€çš„ ACKs å’Œå¯¹å…ˆå‰æ¨é€çš„ NACKsã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™äº›åœ¨ API ä¸­æ²¡æœ‰æ¸…æ™°åœ°åŒºåˆ†ï¼Œå› æ­¤æœ‰ä¸€äº›é€»è¾‘æ¥åˆ†è§£è¿™äº›ï¼ˆ&lt;code&gt;shouldRespond&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ¨é€&#34;&gt;æ¨é€&lt;/h4&gt;
&lt;p&gt;å½“ Istiod æ£€æµ‹åˆ°éœ€è¦æŸäº›é…ç½®æ›´æ–°æ—¶ï¼Œä¼šå‘ç”Ÿæ¨é€ã€‚è¿™å¤§è‡´ä¸è¯·æ±‚çš„ç»“æœç›¸åŒï¼ˆæ–°é…ç½®æ¨é€åˆ°å®¢æˆ·ç«¯ï¼‰ï¼Œåªæ˜¯ç”±ä¸åŒçš„æ¥æºè§¦å‘ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é…ç½®æ‘„å–ä¸­æè¿°çš„å„ç§ç»„ä»¶å¯ä»¥è§¦å‘é…ç½®æ›´æ–°ã€‚è¿™äº›è¢«æ‰¹é‡å¤„ç†ï¼ˆ&amp;ldquo;debounced&amp;rdquo;ï¼‰ï¼Œä»¥é¿å…åœ¨è¿ç»­å¤šæ¬¡æ›´æ”¹æ—¶æ´»åŠ¨è¿‡åº¦ï¼Œå¹¶æœ€ç»ˆæ’é˜Ÿåœ¨æ¨é€é˜Ÿåˆ—ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;æ¨é€é˜Ÿåˆ—å¤§éƒ¨åˆ†æ˜¯ä¸€ä¸ªæ­£å¸¸çš„é˜Ÿåˆ—ï¼Œä½†å®ƒæœ‰ä¸€äº›ç‰¹æ®Šé€»è¾‘æ¥åˆå¹¶æ¯ä¸ªç»™å®šä»£ç†çš„æ¨é€è¯·æ±‚ã€‚è¿™å¯¼è‡´æ¯ä¸ªä»£ç†æœ‰ 0 æˆ– 1 ä¸ªæœªå®Œæˆçš„æ¨é€è¯·æ±‚ï¼›å¦‚æœæœ‰æ›´å¤šæ›´æ–°è¿›æ¥ï¼Œç°æœ‰çš„æ¨é€è¯·æ±‚å°±ä¼šæ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€ä¸ªä»»åŠ¡è½®è¯¢è¿™ä¸ªé˜Ÿåˆ—å¹¶è§¦å‘æ¯ä¸ªå®¢æˆ·ç«¯å¼€å§‹æ¨é€ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./output-4.svg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨é«˜å±‚æ¬¡ä¸Šï¼Œæ¯ä¸ªå®¢æˆ·ç«¯ä»»åŠ¡å°†æ‰¾åˆ°æ­£ç¡®çš„ç”Ÿæˆå™¨æ¥å¤„ç†è¯·æ±‚ï¼Œç”Ÿæˆæ‰€éœ€çš„é…ç½®ï¼Œå¹¶å‘é€ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ä¼˜åŒ–&#34;&gt;ä¼˜åŒ–&lt;/h4&gt;
&lt;p&gt;ä¸€ä¸ªç®€å•çš„å®ç°å°†ç®€å•åœ°é‡æ–°ç”Ÿæˆæ¯ä¸ªå®¢æˆ·ç«¯çš„æ‰€æœ‰è®¢é˜…ç±»å‹çš„æ‰€æœ‰èµ„æºï¼Œæ— è®ºé…ç½®æ˜¯å¦æ›´æ”¹ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹å¼æ‰©å±•æ€§å¾ˆå·®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æœ‰è®¸å¤šçº§åˆ«çš„ä¼˜åŒ–ä»¥é¿å…åšè¿™äº›å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª &lt;code&gt;Full&lt;/code&gt; æ¨é€çš„æ¦‚å¿µã€‚åªæœ‰åœ¨æ›´æ”¹æ—¶ &lt;code&gt;Full&lt;/code&gt; æ¨é€ä¼šé‡æ–°è®¡ç®— &lt;code&gt;PushContext&lt;/code&gt;ï¼›å¦åˆ™ï¼Œè¿™å°†è¢«è·³è¿‡ï¼Œé‡ç”¨æœ€åä¸€ä¸ª &lt;code&gt;PushContext&lt;/code&gt;ã€‚æ³¨æ„ï¼šå³ä½¿æ˜¯ &lt;code&gt;Full&lt;/code&gt;ï¼Œæˆ‘ä»¬ä¹Ÿå°½å¯èƒ½ä»ä¸Šä¸€ä¸ª &lt;code&gt;PushContext&lt;/code&gt; å¤åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ª &lt;code&gt;WasmPlugin&lt;/code&gt; å‘ç”Ÿäº†å˜åŒ–ï¼Œæˆ‘ä»¬ä¸ä¼šé‡æ–°è®¡ç®—æœåŠ¡ç´¢å¼•ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼š&lt;code&gt;Full&lt;/code&gt; åªæ˜¯æŒ‡æ˜¯å¦éœ€è¦é‡æ–°è®¡ç®— &lt;code&gt;PushContext&lt;/code&gt;ã€‚å³ä½¿åœ¨ &lt;code&gt;Full&lt;/code&gt; æ¨é€ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¼šè·Ÿè¸ªè§¦å‘æ­¤çš„é…ç½®æ›´æ–°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æœ‰ &amp;ldquo;Config X çš„å®Œæ•´æ›´æ–°&amp;rdquo; æˆ– &amp;ldquo;æ‰€æœ‰é…ç½®çš„å®Œæ•´æ›´æ–°&amp;rdquo;ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œå¯¹äºå•ä¸ªä»£ç†ï¼Œæˆ‘ä»¬å°†æ£€æŸ¥å®ƒæ˜¯å¦å¯èƒ½å—åˆ°æ›´æ”¹çš„å½±å“ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€ä¸ª sidecar ä»ä¸å— &lt;code&gt;Gateway&lt;/code&gt; æ›´æ–°çš„å½±å“ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æŸ¥çœ‹é™åˆ¶æ›´æ–°èŒƒå›´çš„åˆ†æµï¼ˆæ¥è‡ª &lt;code&gt;Sidecar.egress.hosts&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦æˆ‘ä»¬ç¡®å®šä»£ç†å¯èƒ½å—åˆ°å½±å“ï¼Œæˆ‘ä»¬å°†ç¡®å®šå“ªäº›&lt;em&gt;ç±»å‹&lt;/em&gt;å¯èƒ½å—åˆ°å½±å“ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çŸ¥é“ &lt;code&gt;WasmPlugin&lt;/code&gt; ä¸å½±å“ &lt;code&gt;Cluster&lt;/code&gt; ç±»å‹ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥è·³è¿‡ç”Ÿæˆ &lt;code&gt;Cluster&lt;/code&gt;ã€‚è­¦å‘Šï¼šEnvoy å½“å‰æœ‰ä¸€ä¸ªé”™è¯¯ï¼Œ&lt;em&gt;è¦æ±‚&lt;/em&gt; æ¯å½“æ¨é€å¯¹åº”çš„ &lt;code&gt;Cluster&lt;/code&gt; æ—¶å¿…é¡»æ¨é€ &lt;code&gt;Endpoints&lt;/code&gt;ï¼Œå› æ­¤è¿™ä¸ªä¼˜åŒ–åœ¨è¿™ä¸ªç‰¹å®šæƒ…å†µä¸‹æ•…æ„å…³é—­äº†ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬ç¡®å®šæˆ‘ä»¬éœ€è¦ç”Ÿæˆç±»å‹çš„å“ªä¸ªå­é›†ã€‚XDS æœ‰ä¸¤ç§æ¨¡å¼ - &amp;ldquo;State of the World (SotW)&amp;rdquo; å’Œ &amp;ldquo;Delta&amp;rdquo;ã€‚åœ¨ SotW ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦ç”Ÿæˆç±»å‹çš„æ‰€æœ‰èµ„æºï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªå‘ç”Ÿäº†å˜åŒ–ã€‚æ³¨æ„æˆ‘ä»¬å®é™…ä¸Šéœ€è¦&lt;em&gt;ç”Ÿæˆ&lt;/em&gt;æ‰€æœ‰è¿™äº›ï¼Œé€šå¸¸æ˜¯å› ä¸ºæˆ‘ä»¬ä¸å­˜å‚¨å…ˆå‰ç”Ÿæˆçš„èµ„æºï¼ˆä¸»è¦å› ä¸ºå®ƒä»¬æ˜¯æ¯ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆçš„ï¼‰ã€‚è¿™ä¹Ÿæ„å‘³ç€æ¯å½“æˆ‘ä»¬ç¡®å®šæ˜¯å¦éœ€è¦æ›´æ”¹æ—¶ï¼Œæˆ‘ä»¬éƒ½æ˜¯åŸºäºä»”ç»†çš„ä»£ç åˆ†æï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡åœ¨ SotW ä¸­æœ‰è¿™æ ·çš„æœŸæœ›ï¼Œç”±äºåè®®çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥å¯ç”¨æˆ‘ä»¬æœ€é‡è¦çš„ä¼˜åŒ–ä¹‹ä¸€ã€‚XDS ç±»å‹å½¢æˆä¸€æ£µæ ‘ï¼ŒCDS å’Œ LDS æ˜¯ Envoy çš„æ ‘æ ¹ã€‚å¯¹äºæ ¹ç±»å‹ï¼Œæˆ‘ä»¬&lt;em&gt;å¿…é¡»&lt;/em&gt;æ€»æ˜¯ç”Ÿæˆå®Œæ•´çš„èµ„æºé›†â€”â€”ç¼ºå¤±çš„èµ„æºè¢«è§†ä¸ºåˆ é™¤ã€‚
ç„¶è€Œï¼Œæ‰€æœ‰å…¶ä»–ç±»å‹&lt;em&gt;ä¸èƒ½&lt;/em&gt;æ˜¾å¼åˆ é™¤ï¼Œè€Œæ˜¯åœ¨æ‰€æœ‰å¼•ç”¨è¢«ç§»é™¤æ—¶æ¸…ç†ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä¸ºéæ ¹ç±»å‹å‘é€éƒ¨åˆ†æ›´æ–°ï¼Œè€Œä¸åˆ é™¤æœªå‘é€çš„èµ„æºã€‚è¿™æœ‰æ•ˆåœ°å…è®¸åœ¨ SotW ä¸Šè¿›è¡Œ delta æ›´æ–°ã€‚è¿™ä¸ªä¼˜åŒ–å¯¹æˆ‘ä»¬çš„ç«¯ç‚¹ç”Ÿæˆå™¨è‡³å…³é‡è¦ï¼Œç¡®ä¿å½“ä¸€ä¸ª pod æ‰©å±•æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ–°è¯¥ pod å†…çš„ç«¯ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ§åˆ¶å™¨&#34;&gt;æ§åˆ¶å™¨&lt;/h2&gt;
&lt;p&gt;Istiod ç”±ä¸€ç³»åˆ—æ§åˆ¶å™¨ç»„æˆã€‚æŒ‰ Kubernetes çš„è¯´æ³•ï¼Œ&amp;ldquo;æ§åˆ¶å™¨æ˜¯è§‚å¯Ÿä½ çš„é›†ç¾¤çŠ¶æ€çš„æ§åˆ¶å¾ªç¯ï¼Œç„¶ååœ¨éœ€è¦æ—¶è¿›è¡Œæˆ–è¯·æ±‚æ›´æ”¹ã€‚&amp;rdquo;&lt;/p&gt;
&lt;p&gt;åœ¨ Istio ä¸­ï¼Œæˆ‘ä»¬æ›´è‡ªç”±åœ°ä½¿ç”¨è¿™ä¸ªæœ¯è¯­ã€‚Istio çš„æ§åˆ¶å™¨ä¸ä»…ä»…è§‚å¯Ÿä¸€ä¸ªé›†ç¾¤çš„çŠ¶æ€â€”â€”è®¸å¤šæ§åˆ¶å™¨ä»å¤šä¸ªé›†ç¾¤è¯»å–ï¼Œç”šè‡³ä»å¤–éƒ¨æ¥æºï¼ˆæ–‡ä»¶å’Œ XDSï¼‰è¯»å–ã€‚é€šå¸¸ï¼ŒKubernetes æ§åˆ¶å™¨ç„¶åå°†çŠ¶æ€å†™å›åˆ°é›†ç¾¤ï¼›Istio ç¡®å®æœ‰å‡ ä¸ªè¿™æ ·çš„æ§åˆ¶å™¨ï¼Œä½†å¤§å¤šæ•°æ§åˆ¶å™¨éƒ½é›†ä¸­åœ¨æ¨åŠ¨&lt;a href=&#34;#proxy-configuration&#34;&gt;ä»£ç†é…ç½®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¼–å†™æ§åˆ¶å™¨&#34;&gt;ç¼–å†™æ§åˆ¶å™¨&lt;/h3&gt;
&lt;p&gt;Istio æä¾›äº†ä¸€äº›å¸®åŠ©åº“æ¥å¼€å§‹ç¼–å†™æ§åˆ¶å™¨ã€‚è™½ç„¶è¿™äº›åº“æœ‰å¸®åŠ©ï¼Œä½†æ­£ç¡®ç¼–å†™ï¼ˆå’Œæµ‹è¯•ï¼ï¼‰ä¸€ä¸ªæ§åˆ¶å™¨ä»ç„¶æœ‰å¾ˆå¤šç»†å¾®ä¹‹å¤„ã€‚&lt;/p&gt;
&lt;p&gt;è¦å¼€å§‹ç¼–å†™æ§åˆ¶å™¨ï¼Œè¯·æŸ¥çœ‹&lt;a href=&#34;https://github.com/istio/istio/blob/master/pkg/kube/controllers/example_test.go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¤ºä¾‹æ§åˆ¶å™¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ§åˆ¶å™¨æ¦‚è§ˆ&#34;&gt;æ§åˆ¶å™¨æ¦‚è§ˆ&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢æä¾›äº† Istiod ä¸­æ§åˆ¶å™¨çš„é«˜çº§æ¦‚è§ˆã€‚æœ‰å…³æ¯ä¸ªæ§åˆ¶å™¨çš„æ›´å¤šä¿¡æ¯ï¼Œå»ºè®®å’¨è¯¢æ§åˆ¶å™¨çš„ Go æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./output-5.svg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œç›®å‰æ§åˆ¶å™¨çš„æ™¯è§‚ç›¸å½“å¹¿æ³›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;#ServiceDiscovery&#34;&gt;æœåŠ¡å‘ç°&lt;/a&gt; å’Œ &lt;a href=&#34;#ConfigStore&#34;&gt;Config Store&lt;/a&gt; å·²åœ¨ä¸Šæ–‡è®¨è®ºï¼Œå› æ­¤è¿™é‡Œä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç½‘æ ¼é…ç½®&#34;&gt;ç½‘æ ¼é…ç½®&lt;/h4&gt;
&lt;p&gt;ç½‘æ ¼é…ç½®æ§åˆ¶å™¨æ˜¯ä¸€ä¸ªç›¸å½“ç®€å•çš„æ§åˆ¶å™¨ï¼Œä» &lt;code&gt;ConfigMap&lt;/code&gt;ï¼ˆå¦‚æœä½¿ç”¨ &lt;code&gt;SHARED_MESH_CONFIG&lt;/code&gt; åˆ™ä¸ºå¤šä¸ªï¼‰è¯»å–ï¼Œå¤„ç†å¹¶åˆå¹¶è¿™äº›åˆ°ç±»å‹åŒ–çš„ &lt;code&gt;MeshConfig&lt;/code&gt; ä¸­ã€‚ç„¶åå®ƒé€šè¿‡ä¸€ä¸ªç®€å•çš„ &lt;code&gt;mesh.Watcher&lt;/code&gt; æš´éœ²è¿™ä¸ªï¼Œè¿™åªæ˜¯æš´éœ²ä¸€ç§è®¿é—®å½“å‰ &lt;code&gt;MeshConfig&lt;/code&gt; çš„æ–¹å¼å¹¶åœ¨å®ƒæ”¹å˜æ—¶è·å¾—é€šçŸ¥ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ingress&#34;&gt;Ingress&lt;/h4&gt;
&lt;p&gt;é™¤äº† &lt;code&gt;VirtualService&lt;/code&gt; å’Œ &lt;code&gt;Gateway&lt;/code&gt;ï¼ŒIstio ä¹Ÿæ”¯æŒ &lt;code&gt;Ingress&lt;/code&gt; æ ¸å¿ƒèµ„æºç±»å‹ã€‚åƒ CRD ä¸€æ ·ï¼Œ&lt;code&gt;Ingress&lt;/code&gt; æ§åˆ¶å™¨å®ç° &lt;code&gt;ConfigStore&lt;/code&gt;ï¼Œä½†æœ‰äº›ä¸åŒã€‚&lt;code&gt;Ingress&lt;/code&gt; èµ„æºåœ¨å³æ—¶è½¬æ¢ä¸º &lt;code&gt;VirtualService&lt;/code&gt; å’Œ &lt;code&gt;Gateway&lt;/code&gt;ï¼Œæ‰€ä»¥è™½ç„¶æ§åˆ¶å™¨è¯»å– &lt;code&gt;Ingress&lt;/code&gt; èµ„æºï¼ˆå’Œä¸€äº›ç›¸å…³ç±»å‹å¦‚ &lt;code&gt;IngressClass&lt;/code&gt;ï¼‰ï¼Œå®ƒå‘å‡ºå…¶ä»–ç±»å‹ã€‚è¿™å…è®¸å…¶ä»–ä»£ç ä¸ç”¨å…³å¿ƒ Ingressï¼Œåªå…³æ³¨æ ¸å¿ƒç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†è¿™ç§è½¬æ¢å¤–ï¼Œ&lt;code&gt;Ingress&lt;/code&gt; è¿˜éœ€è¦åœ¨çŠ¶æ€ä¸­å†™å…¥å®ƒå¯ä»¥è®¿é—®çš„åœ°å€ã€‚è¿™ç”± Ingress çŠ¶æ€æ§åˆ¶å™¨å®Œæˆã€‚&lt;/p&gt;
&lt;h4 id=&#34;gateway&#34;&gt;Gateway&lt;/h4&gt;
&lt;p&gt;Gatewayï¼ˆæŒ‡çš„æ˜¯ &lt;a href=&#34;http://gateway-api.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes API&lt;/a&gt;ï¼Œä¸æ˜¯åŒåçš„ Istio ç±»å‹ï¼‰çš„å·¥ä½œæ–¹å¼ä¸ &lt;a href=&#34;#ingress&#34;&gt;Ingress&lt;/a&gt; éå¸¸ç›¸ä¼¼ã€‚ç½‘å…³æ§åˆ¶å™¨ä¹Ÿå°†ç½‘å…³ API ç±»å‹è½¬æ¢ä¸º &lt;code&gt;VirtualService&lt;/code&gt; å’Œ &lt;code&gt;Gateway&lt;/code&gt;ï¼Œå®ç° &lt;code&gt;ConfigStore&lt;/code&gt; æ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œè¿˜æœ‰ä¸€äº›é¢å¤–çš„é€»è¾‘ã€‚ç½‘å…³ç±»å‹æœ‰å¹¿æ³›çš„çŠ¶æ€æŠ¥å‘Šã€‚ä¸ Ingress ä¸åŒï¼Œè¿™æ˜¯çŠ¶æ€æŠ¥å‘Šæ˜¯åœ¨ä¸»æ§åˆ¶å™¨ä¸­ç›´æ¥å®Œæˆçš„ï¼Œå…è®¸åœ¨å¤„ç†èµ„æºçš„é€»è¾‘ä¸­ç›´æ¥ç”ŸæˆçŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼ŒGateway æ¶‰åŠä¸¤ä¸ªç»„ä»¶å†™å…¥åˆ°é›†ç¾¤ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘å…³ç±»æ§åˆ¶å™¨æ˜¯ä¸€ä¸ªç®€å•çš„æ§åˆ¶å™¨ï¼Œåªæ˜¯å†™ä¸€ä¸ªæè¿°æˆ‘ä»¬å®ç°çš„é»˜è®¤ &lt;code&gt;GatewayClass&lt;/code&gt; å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;ç½‘å…³éƒ¨ç½²æ§åˆ¶å™¨ä½¿ç”¨æˆ·èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªå®é™…é…ç½®åº•å±‚èµ„æºï¼ˆéƒ¨ç½²å’ŒæœåŠ¡ï¼‰çš„ç½‘å…³ã€‚è¿™æ›´åƒæ˜¯ä¸€ä¸ªä¼ ç»Ÿçš„â€œOperatorâ€ã€‚è¿™éƒ¨åˆ†é€»è¾‘æ˜¯ç¡®å®šåŸºäº &lt;code&gt;istio.io/rev&lt;/code&gt; æ ‡ç­¾å“ªä¸ª Istiod ä¿®è®¢åº”è¯¥å¤„ç†èµ„æºï¼ˆåæ˜  sidecar æ³¨å…¥ï¼‰ï¼›å› æ­¤ï¼Œè¿™éœ€è¦ä¾èµ–â€œæ ‡ç­¾è§‚å¯Ÿè€…â€æ§åˆ¶å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;crd-è§‚å¯Ÿè€…&#34;&gt;CRD è§‚å¯Ÿè€…&lt;/h4&gt;
&lt;p&gt;å¯¹äºé’ˆå¯¹è‡ªå®šä¹‰ç±»å‹ï¼ˆCRDï¼‰çš„è§‚å¯Ÿï¼Œæˆ‘ä»¬å¸Œæœ›ä¼˜é›…åœ°å¤„ç†ç¼ºå¤±çš„ CRDã€‚å¦‚æœå¯¹ç¼ºå¤±ç±»å‹å¯åŠ¨ informersï¼Œåˆ™ä¼šå¯¼è‡´é”™è¯¯å¹¶é˜»å¡å¯åŠ¨ã€‚ç›¸åï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªâ€œCRD è§‚å¯Ÿè€…â€ç»„ä»¶ï¼Œè§‚å¯Ÿé›†ç¾¤ä¸­çš„ CRD ä»¥ç¡®å®šå®ƒä»¬æ˜¯å¦å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€äº›ç»„ä»¶åªæ˜¯åœ¨åšéœ€è¦çš„å·¥ä½œä¹‹å‰é˜»å¡ &lt;code&gt;watcher.WaitForCRD(...)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kclient.NewDelayedInformer&lt;/code&gt; ä¹Ÿå¯ä»¥å®Œå…¨æŠ½è±¡è¿™ä¸€ç‚¹ï¼Œé€šè¿‡æä¾›ä¸€ä¸ªåœ¨å¹•åå¤„ç†è¿™ä¸€ç‚¹çš„å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;credentials-controller&#34;&gt;Credentials Controller&lt;/h4&gt;
&lt;p&gt;å‡­è¯æ§åˆ¶å™¨æš´éœ²è®¿é—® TLS è¯ä¹¦ä¿¡æ¯çš„é€”å¾„ï¼Œè¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨é›†ç¾¤çš„ &lt;code&gt;Secrets&lt;/code&gt; ä¸­ã€‚é™¤äº†ç®€å•åœ°è®¿é—®è¯ä¹¦å¤–ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªæˆæƒç»„ä»¶ï¼Œå¯ä»¥éªŒè¯è¯·æ±‚è€…æ˜¯å¦æœ‰æƒè¯»å–å…¶å‘½åç©ºé—´ä¸­çš„ &lt;code&gt;Secrets&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;discovery-filter&#34;&gt;Discovery Filter&lt;/h4&gt;
&lt;p&gt;å‘ç°è¿‡æ»¤å™¨æ§åˆ¶å™¨ç”¨äºå®ç° &lt;code&gt;MeshConfig&lt;/code&gt; çš„ &lt;code&gt;discoverySelectors&lt;/code&gt; å­—æ®µã€‚è¿™ä¸ªæ§åˆ¶å™¨è¯»å–é›†ç¾¤ä¸­çš„ &lt;code&gt;Namespace&lt;/code&gt; ä»¥ç¡®å®šå®ƒä»¬æ˜¯å¦åº”è¯¥è¢«â€œé€‰ä¸­â€ã€‚è®¸å¤šæ§åˆ¶å™¨ä½¿ç”¨è¿™ä¸ªè¿‡æ»¤å™¨æ¥åªå¤„ç†é…ç½®çš„ä¸€ä¸ªå­é›†ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å¤šé›†ç¾¤&#34;&gt;å¤šé›†ç¾¤&lt;/h4&gt;
&lt;p&gt;å„ç§æ§åˆ¶å™¨ä»å¤šä¸ªé›†ç¾¤è¯»å–ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å§‹äºå¤šé›†ç¾¤å¯†é’¥æ§åˆ¶å™¨ï¼Œè¯¥æ§åˆ¶å™¨è¯»å– &lt;code&gt;kubeconfig&lt;/code&gt; æ–‡ä»¶ï¼ˆå­˜å‚¨ä¸º &lt;code&gt;Secrets&lt;/code&gt;ï¼‰ï¼Œå¹¶ä¸ºæ¯ä¸ªåˆ›å»º Kubernetes å®¢æˆ·ç«¯ã€‚æ§åˆ¶å™¨å…è®¸æ³¨å†Œå¤„ç†ç¨‹åºï¼Œè¿™äº›å¤„ç†ç¨‹åºå¯ä»¥å¤„ç†é›†ç¾¤çš„æ·»åŠ /æ›´æ–°/åˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æœ‰ä¸¤ä¸ªå®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡­è¯æ§åˆ¶å™¨è´Ÿè´£è¯»å–å­˜å‚¨ä¸º Secrets çš„ TLS è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes æœåŠ¡å‘ç°æ§åˆ¶å™¨æœ‰ç‚¹åƒä¸€ä¸ªå¤§å—å¤´ï¼Œé™¤äº†æ ¸å¿ƒæœåŠ¡å‘ç°æ§åˆ¶å™¨ä¹‹å¤–ï¼Œè¿˜å¯åŠ¨äº†ä¸€å †å…¶ä»–å­æ§åˆ¶å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±äºæ•´ä½“å¤æ‚æ€§ï¼Œçœ‹çœ‹è¿™ä¸ªæ”¾å¤§ä¸€ç‚¹ä¼šæœ‰å¸®åŠ©ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./output-6.svg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;è™šæ‹Ÿæœº&#34;&gt;è™šæ‹Ÿæœº&lt;/h4&gt;
&lt;p&gt;è™šæ‹Ÿæœºæ”¯æŒç”±ä¸¤ä¸ªæ§åˆ¶å™¨ç»„æˆã€‚&lt;/p&gt;
&lt;p&gt;è‡ªåŠ¨æ³¨å†Œæ§åˆ¶å™¨æ˜¯ä¸€ä¸ªç›¸å½“ç‹¬ç‰¹çš„æ§åˆ¶å™¨â€”â€”æ§åˆ¶å™¨çš„è¾“å…¥æ˜¯ XDS è¿æ¥ã€‚å¯¹æ¯ä¸ª XDS è¿æ¥ï¼Œåˆ›å»ºä¸€ä¸ª &lt;code&gt;WorkloadEntry&lt;/code&gt; æ¥æ³¨å†Œ XDS å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯åœ¨ VM ä¸Šè¿è¡Œçš„ &lt;code&gt;istio-proxy&lt;/code&gt;ï¼‰åˆ°ç½‘æ ¼ä¸­ã€‚è¿™ä¸ª &lt;code&gt;WorkloadEntry&lt;/code&gt; ä¸è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œæœ‰ä¸€äº›é€»è¾‘ç¡®ä¿ä¸´æ—¶çš„åœæœºï¼ˆé‡æ–°è¿æ¥ç­‰ï¼‰ä¸ä¼šç§»é™¤ &lt;code&gt;WorkloadEntry&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¥åº·æ£€æŸ¥æ§åˆ¶å™¨è¿˜æ§åˆ¶ &lt;code&gt;WorkloadEntry&lt;/code&gt; çš„å¥åº·çŠ¶æ€ã€‚å¥åº·çŠ¶æ€é€šè¿‡ XDS å®¢æˆ·ç«¯æŠ¥å‘Šå¹¶ä¸ &lt;code&gt;WorkloadEntry&lt;/code&gt; åŒæ­¥ã€‚&lt;/p&gt;
&lt;h4 id=&#34;webhook&#34;&gt;Webhook&lt;/h4&gt;
&lt;p&gt;Istio åŒ…å«éªŒè¯å’Œå˜æ›´ webhook é…ç½®ã€‚è¿™äº›éœ€è¦åœ¨ &lt;code&gt;caBundle&lt;/code&gt; ä¸­æŒ‡å®šä»¥é…ç½® TLS ä¿¡ä»»ã€‚å› ä¸º Istiod çš„ CA è¯ä¹¦æœ‰äº›åŠ¨æ€æ€§ï¼Œè¿™åœ¨è¿è¡Œæ—¶è¿›è¡Œä¿®è¡¥ï¼ˆè€Œä¸æ˜¯ä½œä¸ºå®‰è£…çš„ä¸€éƒ¨åˆ†ï¼‰ã€‚webhook æ§åˆ¶å™¨å¤„ç†è¿™ç§ä¿®è¡¥ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›æ§åˆ¶å™¨éå¸¸ç›¸ä¼¼ï¼Œä½†ç”±äºå„ç§åŸå› æ˜¯ä¸åŒçš„ç»„ä»¶ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Kyverno æ›´è½»æ¾åœ°ä¿æŠ¤æœåŠ¡ç½‘æ ¼</title>
      <link>https://cloudnativecn.com/blog/securing-services-meshes-easier-with-kyverno/</link>
      <pubDate>Fri, 08 Mar 2024 13:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/securing-services-meshes-easier-with-kyverno/</guid>
      <description>&lt;p&gt;å¦‚ä»Šåœ¨ Kubernetes ä¸­ï¼ŒæœåŠ¡ç½‘æ ¼å·²ç»å˜å¾—å¸ç©ºè§æƒ¯ï¼Œæœ‰äº›å¹³å°ç”šè‡³é»˜è®¤å°†å…¶æ„å»ºåˆ°é›†ç¾¤ä¸­ã€‚æœåŠ¡ç½‘æ ¼æ— ç–‘åœ¨å¤šç§æ–¹é¢æä¾›äº†è¯¸å¤šå¥½å¤„ï¼Œè¿™äº›å¥½å¤„ä¼—æ‰€å‘¨çŸ¥ï¼Œä½†ä¹Ÿä¼—æ‰€å‘¨çŸ¥ï¼Œå®ƒä»¬æ˜¾è‘—å¢åŠ äº†é›†ç¾¤çš„å¤æ‚æ€§ã€‚é™¤äº†å¢åŠ äº†å¤æ‚æ€§ä¹‹å¤–ï¼ŒæœåŠ¡ç½‘æ ¼åœ¨å¼ºåˆ¶æ‰§è¡Œ Pod å®‰å…¨æ€§æ–¹é¢ä¹Ÿå¸¦æ¥äº†ï¼ˆè‡­åæ˜­è‘—çš„ï¼‰é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦æå‡çš„æƒé™å¯èƒ½å¯¹å…¶ä»–å‡†å…¥æ§åˆ¶å™¨é€ æˆéš¾ä»¥å¤„ç†çš„å›°æ‰°ï¼Œä¾‹å¦‚ Kubernetes è‡ªèº«çš„ Pod å®‰å…¨å‡†å…¥æ§åˆ¶å™¨ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ›´è¯¦ç»†åœ°è§£é‡Šè¿™ä¸ªé—®é¢˜ä»¥åŠåœ¨ä½¿ç”¨æœåŠ¡ç½‘æ ¼æ—¶ Kyverno å¦‚ä½•æˆä¸ºçœŸæ­£çš„æ•‘æ˜Ÿï¼ŒåŒæ—¶ä¸ºä½ é¢„è§ˆä¸€ä¸‹å³å°†åˆ°æ¥çš„ Kyverno 1.12 ç‰ˆæœ¬ä¸­çš„ä¸€äº›ä¸œè¥¿ï¼Œè¿™å°†ä½¿å®‰å…¨æœåŠ¡ç½‘æ ¼å˜å¾—è½»è€Œæ˜“ä¸¾ï¼&lt;/p&gt;
&lt;h2 id=&#34;ä»‹ç»&#34;&gt;ä»‹ç»&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼&lt;a href=&#34;https://konghq.com/learning-center/service-mesh/what-is-a-service-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸º Kubernetes åº”ç”¨ç¨‹åºæä¾›äº†è®¸å¤šå¥½å¤„&lt;/a&gt;ï¼ŒåŒ…æ‹¬æ›´å¥½çš„è´Ÿè½½å‡è¡¡ã€åŒå‘ TLSã€å¯è§‚å¯Ÿæ€§ç­‰ã€‚å¾ˆå¯èƒ½ä½ ç°åœ¨å°±åœ¨ä½ çš„æŸä¸ªé›†ç¾¤ä¸­ä½¿ç”¨äº†æœåŠ¡ç½‘æ ¼ã€‚æœ€æµè¡Œçš„å¼€æºæœåŠ¡ç½‘æ ¼åŒ…æ‹¬ &lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt; å’Œ &lt;a href=&#34;https://linkerd.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd&lt;/a&gt;ã€‚æ‰€æœ‰æœåŠ¡ç½‘æ ¼çš„å·¥ä½œæ–¹å¼åŸºæœ¬ç›¸åŒï¼Œæˆ‘ä»¬ä¸ä¼šåœ¨è¿™ç¯‡åšæ–‡ä¸­æ·±å…¥æ¢è®¨ã€‚ä¸€ä¸ªæ˜¾è‘—çš„ç‚¹æ˜¯ï¼Œä¸ºäº†å°†æµé‡å®šå‘åˆ°å…¶â€œæ—è·¯â€ä»£ç†å¹¶ä»å…¶â€œæ—è·¯â€ä»£ç†ï¼Œéœ€è¦å¯¹åº•å±‚ Linux èŠ‚ç‚¹çš„ iptables è§„åˆ™è¿›è¡Œä¸€äº›è°ƒæ•´ã€‚è¿™äº›è°ƒæ•´æˆ–é…ç½®ä¿®æ”¹æ˜¯æœåŠ¡ç½‘æ ¼é‡å†™ç½‘ç»œå †æ ˆè·¯ç”±è§„åˆ™çš„ç»“æœã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œåƒ Istio å’Œ Linkerd è¿™æ ·çš„ç½‘æ ¼ä½¿ç”¨ä¸€ä¸ª &lt;a href=&#34;https://kubernetes.io/docs/concepts/workloads/pods/init-containers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;initContainer&lt;/a&gt; åœ¨ä»»ä½•å…¶ä»–å®¹å™¨å¯åŠ¨ä¹‹å‰æ‰§è¡Œæ­¤æ“ä½œã€‚ä¸ºäº†ä½¿è¯¥ initContainer èµ·ä½œç”¨ï¼Œå®ƒéœ€è¦ä¸€äº›æƒé™ï¼Œè¿™å¾€å¾€åœ¨æ³¨é‡å®‰å…¨çš„é›†ç¾¤ä¸­æ˜¯å›°éš¾çš„ã€‚è‡³å°‘ï¼Œè¿™äº› initContainer å¿…é¡»æ·»åŠ ä¸¤ä¸ª&lt;a href=&#34;https://man7.org/linux/man-pages/man7/capabilities.7.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linux æƒé™&lt;/a&gt;ï¼Œä»¥å…è®¸å®ƒä»¬å¯¹ç½‘ç»œå †æ ˆè¿›è¡Œä¿®æ”¹ï¼š&lt;code&gt;NET_ADMIN&lt;/code&gt; å’Œ &lt;code&gt;NET_RAW&lt;/code&gt;ã€‚è¿™äº› initContainer ç”šè‡³å¯èƒ½ä»¥ root ç”¨æˆ·èº«ä»½è¿è¡Œï¼Œè¿™åœ¨å®¹å™¨ä¸–ç•Œæ˜¯ç»å¯¹ä¸å…è®¸çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼ŒLinkerd 2.14 å°†åœ¨åº”è¯¥æˆä¸ºå…¶ç½‘æ ¼çš„ä»»ä½• Pod ä¸­æ³¨å…¥ç±»ä¼¼ä»¥ä¸‹çš„ initContainerï¼ˆä¸ºç®€æ´èµ·è§ï¼Œçœç•¥äº†ä¸€äº›å­—æ®µï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;initContainers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cr.l5d.io/linkerd/proxy-init:v2.2.3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;linkerd-init&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;securityContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;allowPrivilegeEscalation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;capabilities&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;NET_ADMIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;NET_RAW&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;privileged&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnlyRootFilesystem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runAsNonRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runAsUser&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;65534&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;seccompProfile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;RuntimeDefault&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;äº‹å®ä¸Šï¼Œè¿™äº›æœåŠ¡ç½‘æ ¼ initContainer éœ€è¦çš„é¢å¤–æƒé™è¢« Kubernetes å®˜æ–¹çš„ &lt;a href=&#34;https://kubernetes.io/docs/concepts/security/pod-security-standards/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pod å®‰å…¨æ ‡å‡†&lt;/a&gt; æ‰€ç¦æ­¢ã€‚è¿™ä¸ªäº‹å®æœ¬èº«å¹¶ä¸æ˜¯ä¸»è¦é—®é¢˜ï¼Œè€Œæ˜¯æ ¹æ®ä½¿ç”¨çš„ç­–ç•¥å¼•æ“ï¼Œä¸ºè¿™äº›ç‰¹æ®Šçš„ initContainer æä¾›è®¸å¯æ˜¯éå¸¸å›°éš¾ç”šè‡³æ ¹æœ¬ä¸å¯èƒ½çš„ã€‚æˆ‘ä»¬æ¯å‘¨éƒ½åœ¨ &lt;a href=&#34;https://kyverno.io/community/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kyverno ç¤¾åŒº&lt;/a&gt;å¬åˆ°ç”¨æˆ·çš„ç—›è‹¦ï¼Œä¼¼ä¹é‚£äº›æœ€ä¸¥é‡å—åˆ°å½±å“çš„ç”¨æˆ·æ˜¯é‚£äº›ä½¿ç”¨ &lt;a href=&#34;https://kubernetes.io/docs/concepts/security/pod-security-admission/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pod å®‰å…¨å‡†å…¥&lt;/a&gt; çš„äººï¼Œè¿™æ˜¯å®ç° Pod å®‰å…¨æ ‡å‡†çš„è¿›ç¨‹ä¸­çš„å‡†å…¥æ§åˆ¶å™¨ã€‚è¿™å·²ç»æˆä¸ºä¸€ä¸ªæ˜¾è‘—çš„é—®é¢˜ï¼Œä»¥è‡³äº Istio å’Œ Linkerd &lt;a href=&#34;https://istio.io/latest/docs/setup/additional-setup/cni/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éƒ½å°è¯•è¿‡&lt;/a&gt; è§£å†³å®ƒï¼ˆæˆ–è€…æ›´å‡†ç¡®åœ°è¯´ï¼Œè§£å†³å®ƒçš„æ–¹æ³•ï¼‰ ï¼Œé€šè¿‡æä¾›å¦ä¸€ç§é€‰æ‹©ï¼šä¸€ä¸ªè‡ªå®šä¹‰çš„ CNI æ’ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;cni-æ’ä»¶&#34;&gt;CNI æ’ä»¶&lt;/h2&gt;
&lt;p&gt;è¿™äº› CNI æ’ä»¶é€‚ç”¨äºè®¸å¤šæƒ…å†µï¼Œä½†æ€»çš„æ¥è¯´ï¼Œå®ƒä»¬å¤§éƒ½æ˜¯ä»¥ç‰ºç‰²ä¸€ä¸ªé—®é¢˜æ¥è§£å†³å¦ä¸€ä¸ªé—®é¢˜ã€‚æ¯•ç«Ÿï¼Œiptables è§„åˆ™ä»ç„¶ &lt;strong&gt;å¿…é¡»&lt;/strong&gt; è¢«é‡å†™ï¼Œè€Œç½‘æ ¼ä¸­çš„æŸäº›ä¸œè¥¿ä»ç„¶ &lt;strong&gt;å¿…é¡»&lt;/strong&gt; è´Ÿè´£æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼ŒCNI æ’ä»¶å®ç°äº†ä¸€ä¸ª DaemonSetï¼Œè¯¥ DaemonSet è¿è¡Œä¸€ä¸ªç‰¹æƒå®¹å™¨ï¼Œä»¥åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œè¿™äº›ä¿®æ”¹ï¼Œä»è€Œé¿å…äº†åœ¨æ¯ä¸ª Pod ä¸­éƒ½éœ€è¦ä¸€ä¸ª initContainer çš„éœ€æ±‚ã€‚è¿™ç¡®å®æœ‰å®ƒçš„ä¼˜ç‚¹ï¼Œä½†ä¹Ÿæœ‰ç¼ºç‚¹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DaemonSet æ›´å…·ç‰¹æƒï¼Œå› ä¸ºå®ƒéœ€è¦ hostPath å·ï¼Œå¹¶å°†é…ç½®æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶å¤åˆ¶åˆ°æ¯ä¸ªèŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;å®ƒéœ€è¦äº†è§£ CNI æ’ä»¶ï¼Œè¿™æ˜¯ä¸“é—¨çš„çŸ¥è¯†ã€‚&lt;/li&gt;
&lt;li&gt;å¢åŠ äº†æ›´å¤šçš„æ“ä½œå’Œè‡ªåŠ¨åŒ–å¤æ‚æ€§ã€‚&lt;/li&gt;
&lt;li&gt;ä¸å…¶ä»– CNI æ’ä»¶å¯èƒ½å‘ç”Ÿå†²çªï¼Œå› ä¸ºå®ƒä»¬å½¼æ­¤ä¸çŸ¥é“ï¼Œå¹¶ä¸”ç¡®å®šå¦‚ä½•é“¾æ¥å¤šä¸ªæ’ä»¶ä¸æ˜¯æ ‡å‡†åŒ–çš„ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æ°´å¹³é›†ç¾¤ç¼©æ”¾æˆ–èŠ‚ç‚¹é‡å¯æœŸé—´å¯èƒ½ä¼šå‡ºç°æ½œåœ¨çš„ç«äº‰æ¡ä»¶ï¼Œå› ä¸º DaemonSet Pod å¯èƒ½åœ¨å·¥ä½œè´Ÿè½½ Pod ä¹‹å‰å¯åŠ¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é—®é¢˜çš„å…³é”®&#34;&gt;é—®é¢˜çš„å…³é”®&lt;/h2&gt;
&lt;p&gt;ä½†æ˜¯ä¸ºä»€ä¹ˆè§£å†³ initContainer é—®é¢˜ä¼šæ˜¯ä¸€ä¸ªçœŸæ­£çš„é—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆåœ¨äºæ’é™¤ã€‚æ’é™¤ï¼Œæˆ–è€…ä½ å¦‚ä½•å…é™¤æŸäº›èµ„æºä¸é€‚ç”¨äºç­–ç•¥ï¼Œè¿™æ˜¯åŒºåˆ†è‰¯å¥½çš„å‡†å…¥æ§åˆ¶å™¨å’Œä¼˜ç§€å‡†å…¥æ§åˆ¶å™¨çš„å…³é”®ä¹‹ä¸€ã€‚ç›®æ ‡æ˜¯åœ¨å°½å¯èƒ½ä¸å½±å“ä½ ç¡®å®éœ€è¦çš„äº‹ç‰©çš„åŒæ—¶ï¼Œæä¾›å°½å¯èƒ½å¼ºå¤§çš„ Pod å®‰å…¨å§¿æ€ã€‚ä½ å¸Œæœ›èƒ½å¤Ÿå°†â€œå¥½â€ä¸â€œåâ€åˆ†å¼€ï¼Œè€Œä½ çš„æœåŠ¡ç½‘æ ¼ç»å¯¹å±äºâ€œå¥½â€çš„èŒƒç•´ã€‚ä½†å°±åƒç­›å­ç­›æ²™å­ä¸€æ ·ï¼Œä½ å¿…é¡»å°å¿ƒè¿‡æ»¤æ‰â€œåâ€çš„éƒ¨åˆ†ï¼Œä½¿ä½ åªå‰©ä¸‹â€œå¥½â€çš„éƒ¨åˆ†ã€‚åœ¨ä¸Šè¿° initContainer ç¤ºä¾‹ä¸­ï¼Œä½ ç»å¯¹ä¸å¸Œæœ›éæœåŠ¡ç½‘æ ¼ Pod æ·»åŠ  &lt;code&gt;NET_ADMIN&lt;/code&gt; æƒé™ï¼Œå› ä¸ºé‚£æ ·ä¼šç»™äºˆå®ƒä»¬å¯¹ç½‘ç»œå †æ ˆçš„ä¸å—é™åˆ¶çš„è®¿é—®ï¼Œä»è€Œå¯èƒ½å¯¼è‡´çª¥æ¢å’Œä¼ªè£…ç­‰é—®é¢˜ã€‚å‡å°‘æ¼æ–—å¤§å°çš„é€‰é¡¹å¦‚ä¸‹ï¼Œä»å¤§åˆ°å°æ’åºã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æ•´ä¸ªé›†ç¾¤ä¸­ç¦ç”¨ Pod å®‰å…¨
&lt;ul&gt;
&lt;li&gt;è¿™æ˜¾ç„¶æ˜¯ä¸€ä¸ªä¸å¯è¡Œçš„æ–¹æ¡ˆï¼Œæ‰€ä»¥ä¸éœ€è¦è¿›ä¸€æ­¥è®¨è®ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœ¨å—å½±å“çš„ Namespace ä¸­ç¦ç”¨ Pod å®‰å…¨
&lt;ul&gt;
&lt;li&gt;å› ä¸ºæˆ‘ä»¬è°ˆè®ºçš„æ˜¯æ¯ä¸ªå¿…é¡»å‚ä¸ç½‘æ ¼çš„ Pod ä¸­éƒ½æœ‰ä¸€ä¸ª initContainerï¼Œè¿™åŸºæœ¬ä¸Šæ„å‘³ç€ä½ å¿…é¡»åœ¨é›†ç¾¤çš„å¤§å¤šæ•° Namespace ä¸­ç¦ç”¨ Pod å®‰å…¨ï¼Œè¿™å®é™…ä¸Šå°±åƒç¬¬ä¸€ç§é€‰é¡¹ä¸€æ ·â€”â€”è¡Œä¸é€šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœ¨åŒ…å«æ­¤æ£€æŸ¥çš„é…ç½®æ–‡ä»¶ä¸­ç¦ç”¨æ­¤é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
&lt;ul&gt;
&lt;li&gt;Pod å®‰å…¨æ ‡å‡†ç»„ç»‡æˆç§°ä¸ºé…ç½®æ–‡ä»¶çš„é›†åˆï¼Œæ¯ä¸ªé…ç½®æ–‡ä»¶åŒ…å«å¤šä¸ªæ§åˆ¶ã€‚æ§åˆ¶æ˜¯å…³äº&lt;em&gt;åº”è¯¥&lt;/em&gt;æ£€æŸ¥å“ªäº›å­—æ®µä»¥åŠå…è®¸æˆ–ä¸å…è®¸å“ªäº›å€¼çš„å‘½ä»¤ã€‚ä½ å¯ä»¥æ‰¾åˆ°åŒ…å«æ­¤æ§åˆ¶çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶ç¦ç”¨æ•´ä¸ªé…ç½®æ–‡ä»¶ï¼Œä½†è¿™æ˜¾ç„¶ä¼šç¦ç”¨åŒä¸€é…ç½®æ–‡ä»¶ä¸­çš„å…¶ä»–æ§åˆ¶ã€‚è¿™ä¹Ÿä¸æ˜¯å¾ˆå¥½ã€‚å¹¶éæ‰€æœ‰ç­–ç•¥å‡†å…¥æ§åˆ¶å™¨éƒ½æä¾›æ­¤åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœ¨ Pod ä¸Šç¦ç”¨æ­¤æ§åˆ¶
&lt;ul&gt;
&lt;li&gt;è¯·æ±‚ &lt;code&gt;NET_ADMIN&lt;/code&gt; å’Œ &lt;code&gt;NET_RAW&lt;/code&gt; çš„è¿™äº› initContainer è¿åäº†&lt;a href=&#34;https://kubernetes.io/docs/concepts/security/pod-security-standards/#baseline&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pod å®‰å…¨æ ‡å‡†çš„åŸºçº¿é…ç½®æ–‡ä»¶ä¸­çš„â€œCapabilitiesâ€æ§åˆ¶&lt;/a&gt;ï¼Œè¿™æ˜¯ Pod å®‰å…¨çš„åŸºæœ¬é…ç½®æ–‡ä»¶ï¼ˆå—é™åˆ¶é…ç½®æ–‡ä»¶å»ºç«‹åœ¨åŸºçº¿é…ç½®æ–‡ä»¶ä¹‹ä¸Šï¼‰ã€‚ä½ å¯ä»¥ç®€å•åœ°ä¸åœ¨ä½¿ç”¨è¿™ç§ initContainer çš„ä»»ä½• Pod ä¸­æ£€æŸ¥æ­¤æ§åˆ¶ï¼Œä½†è¿™ä¹Ÿä¸å¥½ï¼Œå› ä¸ºé‚£æ ·ä¸€ä¸ªæ¶æ„å®¹å™¨ä¹Ÿå¯ä»¥æ·»åŠ  &lt;code&gt;NET_ADMIN&lt;/code&gt;ã€‚ä½ å¯èƒ½æ­£åœ¨æ‰§è¡Œæ‰€æœ‰å…¶ä»–æ§åˆ¶ï¼Œä½†æ˜¯ç®€å•åœ°å…³é—­ä¸€ä¸ªæ§åˆ¶è¿˜æ˜¯å¤ªå¤šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœ¨ä¸€ä¸ªé•œåƒä¸Šç¦ç”¨æ­¤æ§åˆ¶
&lt;ul&gt;
&lt;li&gt;å¦‚æœä½ å·²ç»è¾¾åˆ°äº†è¿™ä¸ªçº§åˆ«ï¼Œé‚£ä¹ˆä½ åšå¾—å¾ˆå¥½ã€‚ä½ å¯ä»¥ç®€å•åœ°ä¸åœ¨ä¸æŸç§æ¨¡å¼åŒ¹é…çš„é•œåƒä¸Šæ£€æŸ¥è¿™äº›ç‰¹æƒèƒ½åŠ›ã€‚ä½†æˆ‘ä»¬è¿˜å¯ä»¥åšå¾—æ›´å¥½ã€‚ï¼ˆé¡ºä¾¿è¯´ä¸€å¥ï¼ŒåŸºäº initContainer çš„åç§°è¿™æ ·åšå¹¶ä¸å®Œå…¨å®‰å…¨ï¼Œå› ä¸ºä¸€äº›æ¶æ„ç”¨æˆ·å¯èƒ½åˆ›å»ºä¸€ä¸ªåä¸º &lt;code&gt;istio-init&lt;/code&gt; çš„ initContainerï¼Œè¯¥ initContainer ä½¿ç”¨äº†ä¸€ä¸ªåä¸º &lt;code&gt;ubuntu:latest&lt;/code&gt; çš„é•œåƒã€‚ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœ¨ä¸€ä¸ªé•œåƒä¸Šä»¥åŠåœ¨ Pod ä¸­çš„ä¸€ä¸ªä½ç½®ä¸Šç¦ç”¨æ­¤æ§åˆ¶
&lt;ul&gt;
&lt;li&gt;ç°åœ¨æˆ‘ä»¬æ¥è°ˆè°ˆã€‚æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªè±å…éš”ç¦»åˆ°ä»…é™äºç‰¹å®šçš„é•œåƒå’Œ Pod ä¸­çš„ç‰¹å®šä½ç½®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ &lt;code&gt;initContainers[]&lt;/code&gt; æ•°ç»„ä¸­å‘ç° &lt;code&gt;istio/proxyv2&lt;/code&gt; é•œåƒæ—¶ï¼Œè±å… &lt;code&gt;NET_ADMIN&lt;/code&gt; å’Œ &lt;code&gt;NET_RAW&lt;/code&gt; æƒé™æ£€æŸ¥ã€‚å¦‚æœåŒä¸€é•œåƒåœ¨ä¸»è¦çš„ &lt;code&gt;containers[]&lt;/code&gt; åˆ—è¡¨ä¸­ä½¿ç”¨ï¼Œå®ƒå°†å¯¼è‡´æ•´ä¸ª Pod è¢«æ‹’ç»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è®¸å¤šäººé‡åˆ°æ­¤é—®é¢˜çš„åŸå› ä¹‹ä¸€æ˜¯ Pod å®‰å…¨å‡†å…¥ï¼ˆPSAï¼‰ã€‚ä½¿ç”¨ PSAï¼Œä½ å¯ä»¥å®ç°çš„æœ€ç²¾ç»†çš„ç²’åº¦æ˜¯ä»é¡¶éƒ¨çš„ç¬¬ä¸‰ä¸ªé¡¹ç›®ï¼šç¦ç”¨åŒ…å«æ­¤æ£€æŸ¥çš„é…ç½®æ–‡ä»¶ã€‚ç”±äºå—é™åˆ¶çš„é…ç½®æ–‡ä»¶åŒ…å«åŸºçº¿é…ç½®æ–‡ä»¶ï¼Œå› æ­¤åœ¨ Namespace ä¸Šç¦ç”¨åŸºçº¿é…ç½®æ–‡ä»¶æœ¬è´¨ä¸Šç­‰åŒäºä¸æ‰§è¡Œ Pod å®‰å…¨æ£€æŸ¥ã€‚è¿™ä¸ªé™åˆ¶æ˜¯åˆ›å»º CNI æ’ä»¶è§£å†³æ–¹æ¡ˆçš„ä¸»è¦åŸå› ã€‚å¦‚æœæœåŠ¡ç½‘æ ¼å¯ä»¥å°†å¯¹è¿™äº›æå‡æƒé™çš„éœ€æ±‚åˆ†ç¦»åˆ°åªæœ‰ä¸€ä¸ªæ§åˆ¶å™¨ï¼ˆä¸€ä¸ª DaemonSetï¼‰ä¸­ï¼Œå¹¶ä¸”è¯¥æ§åˆ¶å™¨ä»…åœ¨ä¸€ä¸ª Namespace ä¸­è¿è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬åŸºæœ¬ä¸Šå¯ä»¥å°†è¯¥ Namespace éš”ç¦»ä¸ºä¸€ä¸ªè±å…åŒºåŸŸã€‚&lt;/p&gt;
&lt;h2 id=&#34;kyverno-ä¸­çš„ç­–ç•¥&#34;&gt;Kyverno ä¸­çš„ç­–ç•¥&lt;/h2&gt;
&lt;p&gt;åœ¨ Kyverno ä¸­ï¼Œæ‚¨æœ‰å‡ ç§é€‰é¡¹æ¥å®æ–½ Pod å®‰å…¨æ ‡å‡†ã€‚ç¬¬ä¸€ç§å’Œâ€œåŸå§‹â€çš„æ–¹æ³•æ˜¯é’ˆå¯¹ Pod å®‰å…¨æ ‡å‡†ä¸­çš„æ¯ä¸ªæ§åˆ¶ç¼–å†™ä¸€ä¸ª &lt;code&gt;validate&lt;/code&gt; è§„åˆ™ã€‚Kyverno å·²ç»æä¾›äº†å®Œæ•´çš„è¿™äº›ç­–ç•¥ï¼Œæ‰“åŒ…ä¸ºä¸€ä¸ª &lt;a href=&#34;https://github.com/kyverno/kyverno/tree/main/charts/kyverno-policies&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm å›¾è¡¨&lt;/a&gt;ï¼Œè¿™äº›ç­–ç•¥ä¹Ÿå¯ä»¥ä½œä¸º &lt;a href=&#34;https://kyverno.io/policies/?policytypes=Pod%20Security%20Standards%20%28Baseline%29%2BPod%20Security%20Standards%20%28Restricted%29&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å•ç‹¬çš„ç­–ç•¥&lt;/a&gt; ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼ŒåŸºçº¿é…ç½®æ–‡ä»¶ä¸­çš„ â€œCapabilitiesâ€ æ§åˆ¶å¯ä»¥åœ¨&lt;a href=&#34;https://kyverno.io/policies/pod-security/baseline/disallow-capabilities/disallow-capabilities/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt;æ‰¾åˆ°ã€‚åœ¨è¿™ç§ç­–ç•¥æ ·å¼ä¸­ï¼Œæ‚¨å¯ä»¥å°½å¯èƒ½åœ°ç»†åŒ–ã€‚ç¨å¾®çš„ç¼ºç‚¹æ˜¯ï¼Œå½“æ¶‰åŠåˆ°é¢„æ„å»ºçš„ Pod å®‰å…¨æ ‡å‡†æ—¶ï¼Œå®ƒä»¬éœ€è¦åœ¨è¿™äº›æœåŠ¡ç½‘æ ¼ initContainers ä¸Šè¿›è¡Œä¸€äº›ä¿®æ”¹ã€‚è™½ç„¶å…¶ä¸­ä¸€äº›ä¿®æ”¹ç›¸å½“æ¸©å’Œï¼Œä½†å…¶ä»–å¯èƒ½éœ€è¦æ›´æç«¯çš„ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ä¸ºäº†å…è®¸è¿™äº›æœåŠ¡ç½‘æ ¼ initContainers è€Œè¿›è¡Œçš„ç›¸åŒ â€œCapabilitiesâ€ æ£€æŸ¥å¯èƒ½çš„æ ·å­ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç”±äº Kyverno åœ¨ç­–ç•¥ç¼–å†™æ–¹é¢éå¸¸çµæ´»ï¼Œå‡ ä¹æ€»ä¼šæœ‰å¤šç§ç¼–å†™ç›¸åŒå£°æ˜çš„æ–¹å¼ï¼Œæ‰€ä»¥å¦‚æœæ‚¨å·²ç»è¿™æ ·åšäº†è€Œç»“æœæœ‰æ‰€ä¸åŒï¼Œè¯·ä¸ç”¨æ‹…å¿ƒã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kyverno.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;disallow-capabilities&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;validationFailureAction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Enforce&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;background&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;adding-capabilities-service-mesh&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;any&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kinds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;preconditions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;all&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{{ request.operation || &amp;#39;BACKGROUND&amp;#39; }}&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NotEquals&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DELETE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;validate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;-&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          Any capabilities added beyond the allowed list (AUDIT_WRITE, CHOWN, DAC_OVERRIDE, FOWNER,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          FSETID, KILL, MKNOD, NET_BIND_SERVICE, SETFCAP, SETGID, SETPCAP, SETUID, SYS_CHROOT)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          are disallowed. Service mesh initContainers may only add NET_ADMIN and NET_RAW to this list.     &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;foreach&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;request.object.spec.initContainers[]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;preconditions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;all&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{{ element.image }}&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AnyIn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*/istio/proxyv2*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*/linkerd/proxy-init*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{{ element.securityContext.capabilities.add[] || `[]` }}&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AnyNotIn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;NET_ADMIN&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;NET_RAW&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;AUDIT_WRITE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;CHOWN&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;DAC_OVERRIDE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;FOWNER&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;FSETID&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;KILL&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;MKNOD&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;NET_BIND_SERVICE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SETFCAP&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SETGID&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SETPCAP&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SETUID&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SYS_CHROOT&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;deny&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;conditions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;all&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{{ element.securityContext.capabilities.add[] || `[]` }}&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AnyNotIn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;AUDIT_WRITE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;CHOWN&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;DAC_OVERRIDE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;FOWNER&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;FSETID&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;KILL&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;MKNOD&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;NET_BIND_SERVICE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SETFCAP&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SETGID&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SETPCAP&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SETUID&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SYS_CHROOT&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;request.object.spec.[ephemeralContainers, containers][]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;deny&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;conditions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;all&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{{ element.securityContext.capabilities.add[] || `[]` }}&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AnyNotIn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;AUDIT_WRITE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;CHOWN&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;DAC_OVERRIDE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;FOWNER&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;FSETID&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;KILL&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;MKNOD&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;NET_BIND_SERVICE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SETFCAP&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SETGID&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SETPCAP&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SETUID&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;SYS_CHROOT&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯·éšæ—¶åœ¨ &lt;a href=&#34;https://playground.kyverno.io/#/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kyverno Playground&lt;/a&gt; ä¸­è¯•ç”¨ä¸€ä¸‹ï¼Œçœ‹çœ‹æ•ˆæœã€‚é‡Œé¢åŒ…å«äº† Istio å’Œ Linkerd çš„ç¤ºä¾‹ Podï¼Œæ‰€ä»¥å°è¯•å–æ¶ˆæ³¨é‡Šå¹¶å¤åˆ¶å…ƒç´ æ¥æµ‹è¯•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äº Istio çš„ initContainer éœ€è¦æ¯” Linkerd çš„æ›´å¤šæƒé™ï¼Œå› æ­¤è¿˜éœ€è¦å¯¹ä¸€äº›å…¶ä»–ç­–ç•¥è¿›è¡Œä¸€äº›è½»å¾®çš„ä¿®æ”¹ï¼Œè¿™äº›ä¿®æ”¹å¯ä»¥åœ¨&lt;a href=&#34;https://kubernetes.io/docs/concepts/security/pod-security-standards/#restricted&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å—é™é…ç½®æ–‡ä»¶&lt;/a&gt; ä¸­æ‰¾åˆ°ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ª &lt;a href=&#34;https://playground.kyverno.io/#/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kyverno Playground é“¾æ¥&lt;/a&gt;ï¼Œå±•ç¤ºäº†å¦‚ä½•ä¿®æ”¹ &lt;a href=&#34;https://kyverno.io/policies/pod-security/restricted/require-run-as-nonroot/require-run-as-nonroot/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;require-run-as-nonroot ç­–ç•¥&lt;/a&gt; æ¥è±å… &lt;code&gt;istio-init&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åƒä¸Šé¢å±•ç¤ºçš„ä¸ªåˆ« Kyverno ç­–ç•¥å…è®¸æœ€å¤§çš„çµæ´»æ€§ï¼Œä½†åœ¨ Kyverno ä¸­å®ç° Pod å®‰å…¨æ ‡å‡†è¿˜æœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹å¼ã€‚å®æ–½è¿™äº›æ ‡å‡†çš„ç¬¬äºŒç§æ–¹å¼æ˜¯ä½¿ç”¨æˆ‘ä»¬ç§°ä¹‹ä¸º â€œå­è§„åˆ™â€ çš„æ–¹å¼æ¥å®ç° &lt;code&gt;validate&lt;/code&gt; æ ·å¼ç­–ç•¥ã€‚&lt;a href=&#34;https://kyverno.io/docs/writing-policies/validate/#pod-security&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨è¿™ç§æ ·å¼&lt;/a&gt; ä¸­ï¼Œ&lt;code&gt;podSecurity&lt;/code&gt; å…ƒç´ ç”¨äºç‰¹æŒ‡è¿™äº› Pod å®‰å…¨æ ‡å‡†ã€‚åœ¨å¹•åï¼ŒKyverno ä½¿ç”¨ä¸ Kubernetes çš„ Pod å®‰å…¨ Admission å®Œå…¨ç›¸åŒçš„åº“ï¼Œä½†ä½¿ç”¨ä¸åŒçš„ â€œåŒ…è£…å™¨â€ ä½¿å…¶åº”ç”¨æ›´åŠ çµæ´»ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œä½¿ç”¨è¿™ç§ç±»å‹çš„å­è§„åˆ™å°†å…è®¸æ‚¨è½»æ¾å®æ–½ Pod å®‰å…¨æ ‡å‡†çš„æ•´ä¸ªåŸºçº¿é…ç½®æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­æ’é™¤è¿™äº›æœåŠ¡ç½‘æ ¼å›¾åƒï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kyverno.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;pod-security-standards&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;background&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;validationFailureAction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Enforce&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;baseline-service-mesh&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;any&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kinds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;validate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;podSecurity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;baseline &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;## å¼ºåˆ¶æ‰§è¡ŒåŸºçº¿é…ç½®æ–‡ä»¶&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;latest &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;## å¼ºåˆ¶æ‰§è¡Œæ­¤é…ç½®æ–‡ä»¶çš„æœ€æ–°ç‰ˆæœ¬&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exclude&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;##&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;æ’é™¤ç‰¹å®šæ§åˆ¶ï¼Œå¯é€‰ç‰¹å®šå›¾åƒ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;controlName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Capabilities&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;images&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*/istio/proxyv2*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*/linkerd/proxy-init*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œçš„ &lt;code&gt;exclude[]&lt;/code&gt; å—å‘½åäº†æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢ä¸€ç›´åœ¨è®¨è®ºçš„ â€œCapabilitiesâ€ æ§åˆ¶ï¼Œ&lt;code&gt;images[]&lt;/code&gt; å­—æ®µå‘½åäº†åº”è¯¥è¢«æ’é™¤çš„ä¸¤ä¸ªç‰¹å®šçš„æœåŠ¡ç½‘æ ¼å›¾åƒã€‚é€šè¿‡è¿™ç§èƒ½åŠ›ï¼Œæ‚¨å¯ä»¥è·å¾—ç±»ä¼¼ PSA çš„è¡Œä¸ºï¼Œä½†æ˜¯å…·æœ‰ç®€å•ä¸å¯èƒ½å®ç°çš„ç»†ç²’åº¦ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªé€‰é¡¹ä¸ºæ‚¨æä¾›äº†ä¸°å¯Œçš„é€‰æ‹©ï¼Œä½†å®ƒä»¬éƒ½æ¶‰åŠç›´æ¥ä¿®æ”¹ç­–ç•¥ã€‚è¿˜æœ‰å¦ä¸€ç§é€‰æ‹©ï¼Œå…è®¸å°†å¼‚å¸¸ä¸ç­–ç•¥æœ¬èº«åˆ†ç¦»ï¼Œè¿™å°±æ˜¯ &lt;a href=&#34;https://kyverno.io/docs/writing-policies/exceptions/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç­–ç•¥å¼‚å¸¸&lt;/a&gt;ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ç¼–å†™ä¸€ä¸ªç­–ç•¥å¼‚å¸¸èµ„æºï¼Œè±å…ç»™å®š Pod åœ¨ç‰¹å®šç­–ç•¥ä¸­çš„ç‰¹å®šè§„åˆ™ã€‚è¿™å¯¹äºå¼€å‘äººå‘˜è‡ªåŠ©æœåŠ¡ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸å…¶ä»–ç”¨æˆ·è¯·æ±‚å¼‚å¸¸ï¼Œè€Œæ— éœ€æŸ¥çœ‹ Kyverno ç­–ç•¥ã€‚ä½†æ˜¯ï¼Œåœ¨ 1.11 ä¸­ï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹è¿˜ä¸å¤Ÿç»†ç²’åº¦ï¼Œå› æ­¤åœ¨ Kyverno 1.12 ä¸­è¿›è¡Œäº†ä¸€äº›å¾ˆå¥½çš„å‡çº§ã€‚æ¥ä¸‹æ¥å°†æ›´å¤šä»‹ç»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;112-ä¸­çš„å¢å¼ºåŠŸèƒ½&#34;&gt;1.12 ä¸­çš„å¢å¼ºåŠŸèƒ½&lt;/h2&gt;
&lt;p&gt;åœ¨å³å°†æ¨å‡ºçš„ Kyverno 1.12 ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨è¿›è¡Œä¸€äº›ä»¤äººå…´å¥‹çš„å¢å¼ºï¼Œè¿™äº›å¢å¼ºå°†ä½¿é’ˆå¯¹è¯¸å¦‚æœåŠ¡ç½‘æ ¼å®¹å™¨ç­‰ç”¨ä¾‹çš„æ’é™¤å˜å¾—æ›´åŠ å®¹æ˜“ã€‚&lt;/p&gt;
&lt;p&gt;1.12 ä¸­çš„ç¬¬ä¸€ä¸ªå¢å¼ºåŠŸèƒ½æ˜¯é€šè¿‡åˆ—å‡ºç‰¹å®šå­—æ®µåŠå…¶å€¼æ¥è¿›ä¸€æ­¥åˆ†ç±» podSecurity å­è§„åˆ™çš„æ’é™¤ã€‚è¿™ä½¿æ‚¨æ—¢å¯ä»¥ä½¿ç”¨ç®€å•çš„ç­–ç•¥è¯­è¨€ï¼Œåˆå¯ä»¥è¾¾åˆ°æœ€ä½çº§åˆ«çš„ç»†ç²’åº¦ã€‚ä¾‹å¦‚ï¼Œè¿™æ˜¯æ‚¨å°†èƒ½å¤Ÿå¼ºåˆ¶æ‰§è¡Œ Pod å®‰å…¨æ ‡å‡†çš„æ•´ä¸ªåŸºçº¿é…ç½®æ–‡ä»¶ï¼Œä½†ä»…ä»ç‰¹å®šçš„ initContainers åˆ—è¡¨ä¸­æ’é™¤ Istio å’Œ Linkerd å›¾åƒçš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;### å³å°†æ¨å‡ºçš„ Kyverno 1.12 ###&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kyverno.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;pod-security-standards&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;background&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;validationFailureAction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Enforce&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;baseline-service-mesh&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;any&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kinds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;validate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;podSecurity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;baseline&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;latest&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exclude&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;controlName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Capabilities&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;images&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*/istio/proxyv2*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*/linkerd/proxy-init*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;restrictedField&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;spec.initContainers[*].securityContext.capabilities.add&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;NET_ADMIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;NET_RAW&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¬¬äºŒä¸ªå¢å¼ºåŠŸèƒ½æ˜¯å¯¹ç­–ç•¥å¼‚å¸¸çš„å¢å¼ºï¼Œä½¿å…¶å…·æœ‰ podSecurity æ„è¯†æ€§ï¼Œå³æ‚¨å°†èƒ½å¤Ÿåœ¨ PolicyException èµ„æºä¸­è±å…ç­–ç•¥å¼‚å¸¸çš„ç‰¹å®šæ§åˆ¶åç§°ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯æ‚¨å°†èƒ½å¤Ÿåœ¨ Kyverno 1.12 ä¸­ä¸ºå…ˆå‰çš„ &lt;code&gt;validate.podSecurity&lt;/code&gt; å­è§„åˆ™åˆ›å»ºçš„ PolicyExceptionï¼Œä½¿æ‚¨å¯ä»¥å°†è¿™äº›æ’é™¤ä¸åªåœ¨ &lt;code&gt;staging&lt;/code&gt; å‘½åç©ºé—´ä¸­åˆ›å»ºçš„ Pod åˆ†ç¦»å¼€æ¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;### å³å°†æ¨å‡ºçš„ Kyverno 1.12 ###&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kyverno.io/v2beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;PolicyException&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;pod-security-exception&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kyverno&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exceptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;policyName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;pod-security-standards&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ruleNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;baseline-service-mesh&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;any&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;staging&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;podSecurity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;controlName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Capabilities&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;images&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*/istio/proxyv2*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*/linkerd/proxy-init*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†åœ¨æœªæ¥è¿›ä¸€æ­¥å¢å¼ºï¼Œé€‚ç”¨äºç‰¹å®šå®¹å™¨ã€‚æŸ¥çœ‹å¹¶å…³æ³¨ &lt;a href=&#34;https://github.com/kyverno/kyverno/issues/8570&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„çš„é—®é¢˜&lt;/a&gt; è·å–è¯¦æƒ…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»äº†ä¸€äº›æœ‰å…³æœåŠ¡ç½‘æ ¼çš„å†…å®¹ï¼Œä»¥åŠä¸ºä»€ä¹ˆä½¿ç”¨ initContainers ä»¥åŠå®ƒä»¬å¸¦æ¥çš„å®‰å…¨é—®é¢˜ã€‚æˆ‘ä»¬ä»‹ç»äº† Kyverno å¦‚ä½•ä»¥æœ€ç²¾ç»†çš„æ–¹å¼è§£å†³è¿™äº›é—®é¢˜ï¼ŒåŒæ—¶æä¾›äº†ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„ä¸€ç¥ï¼Œä»¥åŠå¦‚ä½•ä½¿æ­¤è¿‡ç¨‹æ›´åŠ ç®€å•ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•å…¶ä»–é—®é¢˜æˆ–åé¦ˆï¼Œè¯·ä¸ Kyverno é¡¹ç›® &lt;a href=&#34;https://kyverno.io/community/#get-in-touch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è”ç³»&lt;/a&gt;ï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio ä¸­åŸºäºæ ‡å¤´çš„è·¯ç”±â€”â€”æ— éœ€æ ‡å¤´ä¼ æ’­</title>
      <link>https://cloudnativecn.com/blog/header-based-routing-in-istio-without-header-propagation/</link>
      <pubDate>Wed, 06 Mar 2024 12:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/header-based-routing-in-istio-without-header-propagation/</guid>
      <description>&lt;p&gt;Istio ä½¿ç”¨ Envoy ä»£ç†ä½œä¸º Pod sidecarï¼Œåº”ç”¨ç¨‹åºå°†ç½‘ç»œè´£ä»»ï¼ˆä¾‹å¦‚å…¥ç«™å’Œå‡ºç«™æµé‡ï¼‰å§”æ‰˜ç»™å®ƒï¼Œä½†æœ‰ä¸€ä¸ªè´£ä»»ä»ç„¶å±äºåº”ç”¨ç¨‹åºå®¹å™¨ï¼šæ ‡å¤´ä¼ æ’­ã€‚&lt;/p&gt;
&lt;p&gt;Envoy ä»£ç†æ— æ³•å°†å…¶å‘é€åˆ°åº”ç”¨ç¨‹åºçš„è¯·æ±‚ä¸åº”ç”¨ç¨‹åºå“åº”çš„è¯·æ±‚å…³è”èµ·æ¥ï¼Œå› æ­¤ Istio æ— æ³•è‡ªåŠ¨ä¼ æ’­æ ‡å¤´ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-1å¦‚æœåº”ç”¨ç¨‹åºå®¹å™¨ä¸è½¬å‘å›æ ‡å¤´sidecar-æ— æ³•å°†è¯·æ±‚ä¸å“åº”å…³è”èµ·æ¥&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1ï¼šå¦‚æœåº”ç”¨ç¨‹åºå®¹å™¨ä¸è½¬å‘å›æ ‡å¤´ï¼ŒSidecar æ— æ³•å°†è¯·æ±‚ä¸å“åº”å…³è”èµ·æ¥ã€‚&#34; srcset=&#34;
               /blog/header-based-routing-in-istio-without-header-propagation/f1_hu_11c7fe28d4b3d6be.webp 400w,
               /blog/header-based-routing-in-istio-without-header-propagation/f1_hu_404d5ca17ac1d4e.webp 760w,
               /blog/header-based-routing-in-istio-without-header-propagation/f1_hu_4b6fc29c40f79c5d.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/header-based-routing-in-istio-without-header-propagation/f1_hu_11c7fe28d4b3d6be.webp&#34;
               width=&#34;760&#34;
               height=&#34;299&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1ï¼šå¦‚æœåº”ç”¨ç¨‹åºå®¹å™¨ä¸è½¬å‘å›æ ‡å¤´ï¼ŒSidecar æ— æ³•å°†è¯·æ±‚ä¸å“åº”å…³è”èµ·æ¥ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒåŸºäºæ ‡å¤´çš„è·¯ç”±éœ€è¦åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å®ç°æ ‡å¤´è½¬å‘ã€‚ä¾‹å¦‚ï¼Œåœ¨ Istio çš„ Bookinfo åº”ç”¨ç¨‹åºä¸­ï¼Œ &lt;code&gt;productpage&lt;/code&gt; å¾®æœåŠ¡æ˜¯&lt;a href=&#34;https://github.com/istio/istio/blob/master/samples/bookinfo/src/productpage/productpage.py#L102&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™æ ·&lt;/a&gt;å®ç°çš„ã€‚è¿™è®©æˆ‘ä»¬æƒ³åˆ°ä¸€ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¹³å°ç®¡ç†å‘˜å¦‚ä½•åœ¨ä¸ä¿®æ”¹åº”ç”¨ç¨‹åºå†…éƒ¨çš„æƒ…å†µä¸‹ä½¿ç”¨åŸºäºæ ‡å¤´çš„è·¯ç”±ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;
&lt;h2 id=&#34;æ³³é“æ–¹æ³•&#34;&gt;æ³³é“æ–¹æ³•&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ Bookinfo åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å°†æ ¹æ® &lt;code&gt;x-version&lt;/code&gt; æ ‡å¤´å¯¹è¯·æ±‚è·¯å¾„è¿›è¡Œåˆ†æ®µï¼Œå¦‚ä¸‹å›¾ 2 æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-2æ ¹æ®-x-version-æ ‡å¤´åˆ†æ®µè¯·æ±‚è·¯å¾„&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 2ï¼šæ ¹æ® x-version æ ‡å¤´åˆ†æ®µè¯·æ±‚è·¯å¾„ã€‚&#34; srcset=&#34;
               /blog/header-based-routing-in-istio-without-header-propagation/f2_hu_24684b2bff1a43e.webp 400w,
               /blog/header-based-routing-in-istio-without-header-propagation/f2_hu_5721137ea0529f3.webp 760w,
               /blog/header-based-routing-in-istio-without-header-propagation/f2_hu_2d0b99a7ddbe951c.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/header-based-routing-in-istio-without-header-propagation/f2_hu_24684b2bff1a43e.webp&#34;
               width=&#34;760&#34;
               height=&#34;457&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 2ï¼šæ ¹æ® x-version æ ‡å¤´åˆ†æ®µè¯·æ±‚è·¯å¾„ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ²¡æœ‰ &lt;code&gt;x-version&lt;/code&gt; æ ‡å¤´çš„è¯·æ±‚å¯èƒ½ä¼šè¢«è·¯ç”±åˆ°ä»»æ„åç«¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²å·¥ä½œè´Ÿè½½&#34;&gt;éƒ¨ç½²å·¥ä½œè´Ÿè½½&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨ Istio çš„ Bookinfo &lt;a href=&#34;https://istio.io/latest/docs/examples/bookinfo/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¤ºä¾‹&lt;/a&gt; ï¼Œå¹¶å¯¹ç‰ˆæœ¬æ§åˆ¶åº”ç”¨ç¨‹åºè¿›è¡Œä¸€äº›ç»†å¾®çš„æ›´æ”¹ä½œä¸ºç¤ºä¾‹å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸‰ä¸ª productpage éƒ¨ç½²ï¼Œä»…æ›´æ”¹ &lt;code&gt;version&lt;/code&gt; æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage-v{1,2,3}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v{1,2,3}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v{1,2,3}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v{1,2,3}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºå®ƒä»¬åˆ›å»ºæœåŠ¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åï¼Œä¸º reviews åº”ç”¨ç¨‹åºåˆ›å»ºä¸‰ä¸ªéƒ¨ç½²ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews-v{1,2,3}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v{1,2,3}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v{1,2,3}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v{1,2,3}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;rating å’Œ details åº”ç”¨ç¨‹åºä¸åŸå§‹ç¤ºä¾‹ä¸­çš„å†…å®¹ç›¸åŒã€‚&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²-istio-é…ç½®&#34;&gt;éƒ¨ç½² Istio é…ç½®&lt;/h2&gt;
&lt;p&gt;è¿™å°±æ˜¯ Istio çš„è·¯ç”±åŠŸèƒ½å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚æ¯ä¸ªç‰ˆæœ¬çš„ &lt;code&gt;productpage&lt;/code&gt; çš„ &lt;code&gt;DestinationRule subsets&lt;/code&gt; å®šä¹‰ä¸ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;loadBalancer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;simple&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;RANDOM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subsets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­æœ‰å‡ ä¸ª &lt;code&gt;VirtualService&lt;/code&gt; å®ç°äº†æ³³é“æ ‡å¤´é€»è¾‘çš„å‰åŠéƒ¨åˆ†ã€‚ä»¥ä¸‹è´Ÿè´£å‰ç¼€åŒ¹é…å¹¶ä½¿ç”¨ &lt;code&gt;delegate&lt;/code&gt; åŠŸèƒ½æ¥ä½¿ç”¨ç¬¬äºŒä¸ª &lt;code&gt;VirtualService&lt;/code&gt;ï¼Œå› æ­¤é…ç½®æ˜¯åŸå­çš„å¹¶ä¸” &lt;code&gt;mesh&lt;/code&gt; é¿å…å£°æ˜ç½‘å…³é€‰æ‹©å™¨ï¼ˆå‚è§ä¸‹é¢çš„å¼•ç”¨ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;bookinfo-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/static&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/login&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/logout&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/api/v1/products&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;delegate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage-route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æŒ‡æ´¾ &lt;code&gt;productpage-route&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage-route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage-v1-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;x-version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage-v2-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;x-version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage-v3-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;x-version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage-default-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;withoutHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;x-version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åï¼Œåœ¨ &lt;code&gt;Reviews&lt;/code&gt; çº§åˆ«ï¼Œåœ¨ &lt;code&gt;httpMatchRequest&lt;/code&gt; ä¸­ä½¿ç”¨ &lt;code&gt;sourceLabels&lt;/code&gt; é…ç½®åˆ¶ä½œæ³³é“çš„ååŠéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡ç­¾ï¼Œè¿™äº›æ ‡ç­¾çº¦æŸè§„åˆ™å¯¹å…·æœ‰ç»™å®šæ ‡ç­¾çš„æº (å®¢æˆ·æœº) å·¥ä½œè´Ÿè½½çš„é€‚ç”¨æ€§ã€‚å¦‚æœ VirtualService æœ‰ä¸€ä¸ªåœ¨é¡¶çº§ &lt;code&gt;gateways&lt;/code&gt; å­—æ®µä¸­æŒ‡å®šçš„ç½‘å…³åˆ—è¡¨ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»åŒ…å«è¯¥å­—æ®µé€‚ç”¨çš„ä¿ç•™ç½‘å…³ &lt;code&gt;mesh&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;æ¥æºï¼š&lt;/em&gt; &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/virtual-service/#HTTPMatchRequest&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;em&gt;Istio è™šæ‹ŸæœåŠ¡æ–‡æ¡£&lt;/em&gt;&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;è¿™æ˜¯ &lt;code&gt;VirtualService&lt;/code&gt; ä½¿ç”¨è¯¥ &lt;code&gt;sourceLabels&lt;/code&gt; åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews-route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews-v1-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;sourceLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews-v2-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;sourceLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews-v3-route&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;sourceLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;åœ¨æ²¡æœ‰æ ‡å¤´ä¼ æ’­çš„æƒ…å†µä¸‹æµ‹è¯•æ ‡å¤´è·¯ç”±&#34;&gt;åœ¨æ²¡æœ‰æ ‡å¤´ä¼ æ’­çš„æƒ…å†µä¸‹æµ‹è¯•æ ‡å¤´è·¯ç”±&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆï¼Œä»æ— æ ‡å¤´åœºæ™¯å¼€å§‹ï¼Œæ‚¨å¯ä»¥ä»æ‰€æœ‰é€šé“è·å¾—å“åº”ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; â€”â€”â€”â€”â€”Â»  ns:bookinfo â¯ for i in {1..5}; do curl -s localhost:8080/productpage | grep -A1 &amp;#34;Reviews served by&amp;#34;; done
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v2-955b74755-t4jkb&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v3-797fc48bc9-wsg26&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v1-5cf854487-hjtrg&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v3-797fc48bc9-wsg26&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v2-955b74755-t4jkb&amp;lt;/u&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç„¶åæ£€æŸ¥ &lt;code&gt;x-version: v1&lt;/code&gt; header æ˜¯å¦æœ‰ä½œç”¨ã€‚æ‚¨å¯ä»¥çœ‹åˆ°å·¥ä½œè´Ÿè½½å‘å‡ºçš„æ‰€æœ‰å¯¹ &lt;code&gt;productpage-v1&lt;/code&gt; çš„è°ƒç”¨å‡ç”±  &lt;code&gt;reviews-v1&lt;/code&gt; ä¸“é—¨æä¾›æœåŠ¡ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; â€”â€”â€”â€”â€”Â»  ns:bookinfo â¯ for i in {1..10}; \
do curl -s localhost:8080/productpage -H &amp;#34;x-version: v1&amp;#34; \
| grep -A1 &amp;#34;Reviews served by&amp;#34;; done
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v1-5cf854487-hjtrg&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v1-5cf854487-hjtrg&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v1-5cf854487-hjtrg&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v1-5cf854487-hjtrg&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v1-5cf854487-hjtrg&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v1-5cf854487-hjtrg&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v1-5cf854487-hjtrg&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v1-5cf854487-hjtrg&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v1-5cf854487-hjtrg&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v1-5cf854487-hjtrg&amp;lt;/u&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½¿ç”¨ &lt;code&gt;v3&lt;/code&gt; æ ‡å¤´å€¼å®Œæˆæµ‹è¯•ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  â€”â€”â€”â€”â€”Â»  ns:bookinfo â¯ for i in {1..10}; \
do curl -s localhost:8080/productpage -H &amp;#34;x-version: v3&amp;#34; \
| grep -A1 &amp;#34;Reviews served by&amp;#34;; done
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v3-797fc48bc9-wsg26&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v3-797fc48bc9-wsg26&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v3-797fc48bc9-wsg26&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v3-797fc48bc9-wsg26&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v3-797fc48bc9-wsg26&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v3-797fc48bc9-wsg26&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v3-797fc48bc9-wsg26&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v3-797fc48bc9-wsg26&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v3-797fc48bc9-wsg26&amp;lt;/u&amp;gt;
        &amp;lt;dt&amp;gt;Reviews served by:&amp;lt;/dt&amp;gt;
        &amp;lt;u&amp;gt;reviews-v3-797fc48bc9-wsg26&amp;lt;/u&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬åœ¨æ ‡å¤´ä¸Šä½¿ç”¨ &lt;code&gt;match&lt;/code&gt; ï¼Œåœ¨ Istio ä¸­ä½¿ç”¨ &lt;code&gt;subsets&lt;/code&gt; å’Œ &lt;code&gt;sourceLabels&lt;/code&gt; åŸºäºæ ‡å¤´è¿›è¡Œè·¯ç”±ï¼Œè€Œæ— éœ€æ ‡å¤´ä¼ æ’­ã€‚æ‚¨è¿˜å¯ä»¥æŸ¥çœ‹ &lt;code&gt;delegate&lt;/code&gt; åŠŸèƒ½ä»¥åŠ &lt;code&gt;withoutHeaders&lt;/code&gt; åŒ¹é…çš„ä½¿ç”¨æƒ…å†µã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å¦‚æœæ‚¨æ˜¯æœåŠ¡ç½‘æ ¼æ–°æ‰‹ï¼ŒTetrate&lt;a href=&#34;https://tetr8.io/academy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ Tetrate Academy&lt;/a&gt;æä¾›äº†ä¸€ç³»åˆ—å…è´¹åœ¨çº¿è¯¾ç¨‹ï¼Œå¯å¸®åŠ©æ‚¨å¿«é€Ÿç†Ÿæ‚‰ Istio å’Œ Envoyã€‚å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾ä½¿ç”¨ Istio è¿›è¡Œç”Ÿäº§çš„æœ€å¯é æ–¹æ³•ï¼Œè¯·æŸ¥çœ‹ &lt;a href=&#34;https://tetr8.io/tid&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Istio Subscription&lt;/a&gt;ã€‚Tetrate Istio è®¢é˜…æ‹¥æœ‰åœ¨é«˜åº¦ç›‘ç®¡å’Œä»»åŠ¡å…³é”®å‹ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œ Istio å’Œ Envoy æ‰€éœ€çš„ä¸€åˆ‡ã€‚å®ƒåŒ…æ‹¬ &lt;a href=&#34;https://istio.tetratelabs.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Istio Distro&lt;/a&gt;ï¼Œè¿™æ˜¯ Istio å’Œ Envoy çš„ 100% ä¸Šæ¸¸å‘è¡Œç‰ˆï¼Œç»è¿‡ FIPS éªŒè¯å¹¶å‡†å¤‡å¥½ FedRAMPã€‚å¯¹äºéœ€è¦å¼€æº Istio å’Œ Envoy è€Œæ— éœ€ä¸“æœ‰ä¾›åº”å•†ä¾èµ–çš„å›¢é˜Ÿï¼ŒTetrate æä¾›å”¯ä¸€ 100% ä¸Šæ¸¸ Istio ä¼ä¸šæ”¯æŒäº§å“ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å¦‚ä½•åœ¨ Istio ä¸­æŒ‰è·¯å¾„é…ç½®å…¨å±€é€Ÿç‡é™åˆ¶</title>
      <link>https://cloudnativecn.com/blog/how-to-configure-global-rate-limits-by-path-in-istio/</link>
      <pubDate>Thu, 29 Feb 2024 20:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/how-to-configure-global-rate-limits-by-path-in-istio/</guid>
      <description>&lt;p&gt;æœ¬æ–‡æ˜¯ä¸ºé‚£äº›åˆšå¼€å§‹ä½¿ç”¨ Istio é€Ÿç‡é™åˆ¶åŠŸèƒ½ï¼Œå¸Œæœ›äº†è§£åŸºäºè¯·æ±‚è·¯å¾„çš„é€Ÿç‡é™åˆ¶å¦‚ä½•å·¥ä½œçš„äººè€Œå†™çš„ã€‚å®ƒæºäºæˆ‘çš„å®è·µï¼Œå¹¶æ¾„æ¸…äº†å…³äº&lt;code&gt;rate_limit&lt;/code&gt;æ“ä½œä¸­ AND/OR æ“ä½œçš„å›°æƒ‘ã€‚æˆ‘èŠ±äº†æ¯”é¢„æœŸæ›´å¤šçš„æ—¶é—´æ¥å¼„æ¸…æ¥šæˆ‘å°†åœ¨è¿™é‡Œä¸ºä½ æ€»ç»“çš„å†…å®¹ï¼Œä»¥ä¾¿ä½ åœ¨å‡ åˆ†é’Ÿå†…å­¦ä¹ ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŸºç¡€çŸ¥è¯†&#34;&gt;åŸºç¡€çŸ¥è¯†&lt;/h2&gt;
&lt;p&gt;Istio åœ¨ Envoy ä¹‹ä¸Šè¿è¡Œï¼Œè€Œæˆ‘ä»¬å°†è®¨è®ºçš„ä¸»è¦æŠ€æœ¯æ˜¯ Envoyã€‚Envoy æœ‰åœ¨ä»£ç†æœ¬èº«ä¸Šå®ç°çš„æœ¬åœ°é€Ÿç‡é™åˆ¶å’Œåœ¨ L4 æˆ– L7 ä¸Šè°ƒç”¨å¤–éƒ¨æœåŠ¡çš„å…¨å±€é€Ÿç‡é™åˆ¶çš„é€‰é¡¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¤–éƒ¨é€Ÿç‡é™åˆ¶æœåŠ¡&#34;&gt;å¤–éƒ¨é€Ÿç‡é™åˆ¶æœåŠ¡&lt;/h2&gt;
&lt;p&gt;å¤–éƒ¨é€Ÿç‡é™åˆ¶æœåŠ¡ï¼ˆRLSï¼‰ä¸ Redis æ•°æ®åº“é…åˆä½¿ç”¨ï¼Œé€šè¿‡ gRPC ä¸ envoy å®ä¾‹è¿æ¥ã€‚è¯¥ RLS æ˜¯ç”± &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/rate_limit_filter#rate-limit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;filter&lt;/a&gt; åœ¨ HTTP è·¯ç”±è¿‡æ»¤å™¨ä¹‹å‰çš„ä¾¦å¬å™¨é“¾ä¸­æ·»åŠ è€Œè¢«è°ƒç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå¤–éƒ¨è¿‡æ»¤å™¨å°†æè¿°ç¬¦ç»„ç»‡æˆåŸŸç»„ã€‚æ¯ä¸ªæè¿°ç¬¦éƒ½æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œç”±é€Ÿç‡é™åˆ¶è¿‡æ»¤å™¨å¡«å……ï¼Œå¹¶ä¼ é€’ç»™ RLS ä¾›å…¶åœ¨è§„åˆ™æ‰§è¡Œé€»è¾‘ä¸­ä½¿ç”¨ã€‚è¯·å‚é˜… &lt;a href=&#34;https://github.com/envoyproxy/ratelimit#overview&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/envoyproxy/ratelimit#overview&lt;/a&gt; è¿›è¡Œå®ç°ã€‚&lt;/p&gt;
&lt;p&gt;RLS éœ€è¦ç”±é›†ç¾¤æ“ä½œå‘˜ï¼ˆä½ ï¼‰å®‰è£…å’Œç®¡ç†ï¼Œå¹¶ä¸”ä¸ä¼šéš Istio ä¸€èµ·æä¾›ï¼Œå°½ç®¡å¯ä»¥åœ¨ä½ å®‰è£…æ—¶ä» Istio åŒ…çš„ç¤ºä¾‹ç›®å½•ä¸­æ‰¾åˆ°å®ƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-http-é€Ÿç‡é™åˆ¶è¿‡æ»¤å™¨&#34;&gt;Envoy HTTP é€Ÿç‡é™åˆ¶è¿‡æ»¤å™¨&lt;/h2&gt;
&lt;p&gt;Envoy çš„è®¾ç½®ç”±åº”ç”¨äºå…¥å£ç½‘å…³çš„ä¸¤ä¸ª Envoy é…ç½®ç»„æˆï¼Œä¸€ä¸ªåœ¨ä¾¦å¬å™¨ç»„ä»¶ä¸­æ·»åŠ é€Ÿç‡é™åˆ¶è¿‡æ»¤å™¨ï¼Œå¦ä¸€ä¸ªåœ¨åŠ¨æ€è·¯ç”±ç»„ä»¶ä¸­å®šä¹‰è™šæ‹Ÿä¸»æœºçº§åˆ«çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy-http-é€Ÿç‡é™åˆ¶è¿‡æ»¤å™¨&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy HTTP é€Ÿç‡é™åˆ¶è¿‡æ»¤å™¨&#34; srcset=&#34;
               /blog/how-to-configure-global-rate-limits-by-path-in-istio/f1_hu_8a6565c9529b1688.webp 400w,
               /blog/how-to-configure-global-rate-limits-by-path-in-istio/f1_hu_d7f58167a22f77d9.webp 760w,
               /blog/how-to-configure-global-rate-limits-by-path-in-istio/f1_hu_b0935660dfe619da.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/how-to-configure-global-rate-limits-by-path-in-istio/f1_hu_8a6565c9529b1688.webp&#34;
               width=&#34;760&#34;
               height=&#34;603&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy HTTP é€Ÿç‡é™åˆ¶è¿‡æ»¤å™¨
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¸¦æœ‰é€Ÿç‡é™åˆ¶è¿‡æ»¤å™¨çš„ä¾¦å¬å™¨ç»„ä»¶ filter_chains.filters[] åœ¨è·¯ç”±å™¨ä¹‹å‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-è™šæ‹Ÿä¸»æœºhttpbincom80çš„è·¯ç”±ç»„ä»¶ä¸­çš„é€Ÿç‡é™åˆ¶æ“ä½œ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;è™šæ‹Ÿä¸»æœºâ€œhttpbin.com:80â€çš„è·¯ç”±ç»„ä»¶ä¸­çš„é€Ÿç‡é™åˆ¶æ“ä½œ&#34; srcset=&#34;
               /blog/how-to-configure-global-rate-limits-by-path-in-istio/f2_hu_7817348f90a94e12.webp 400w,
               /blog/how-to-configure-global-rate-limits-by-path-in-istio/f2_hu_97c022e3e10df035.webp 760w,
               /blog/how-to-configure-global-rate-limits-by-path-in-istio/f2_hu_e0c4f1061a66f589.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/how-to-configure-global-rate-limits-by-path-in-istio/f2_hu_7817348f90a94e12.webp&#34;
               width=&#34;760&#34;
               height=&#34;730&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      è™šæ‹Ÿä¸»æœºâ€œhttpbin.com:80â€çš„è·¯ç”±ç»„ä»¶ä¸­çš„é€Ÿç‡é™åˆ¶æ“ä½œ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;em&gt;æ³¨æ„ï¼šä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä»ä»»ä½• envoy ä»£ç†ï¼ˆå½“ç„¶æ˜¯ç½‘å…³ï¼‰è·å–æ­¤è½¬å‚¨ï¼š&lt;/em&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;k exec &amp;lt;POD&amp;gt; -c istio-proxy -- curl &amp;#39;localhost:15000/config_dump&amp;#39; &amp;gt; config_dump.json
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¾¦å¬å™¨è¿‡æ»¤å™¨é…ç½®äº†å¦‚ä½•åˆ°è¾¾ RLSã€å®ƒæ­£åœ¨ç›‘è§†çš„åŸŸä»¥åŠä¸€äº›å…¶ä»–è®¾ç½®ã€‚å½“æ»¡è¶³è·¯ç”±ä¸­å®šä¹‰çš„æ“ä½œæ—¶ï¼Œæ­¤è¿‡æ»¤å™¨å°†è®¿é—®åœ¨è·¯ç”±ä¸­å®šä¹‰çš„æ“ä½œï¼Œå¹¶è§¦å‘åˆ° RLS ä¸Šæ¸¸çš„ gRPC è°ƒç”¨ï¼Œå…¶ä¸­åŒ…æ‹¬åŸŸã€æè¿°ç¬¦é”®å’Œå€¼ï¼Œä»¥ä¾¿å®ƒè¿”å›ä¸€ä¸ªåˆ¤æ–­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-ä¸­æŒ‰è¯·æ±‚è·¯å¾„è®¾ç½®é€Ÿç‡é™åˆ¶çš„ç¤ºä¾‹&#34;&gt;Istio ä¸­æŒ‰è¯·æ±‚è·¯å¾„è®¾ç½®é€Ÿç‡é™åˆ¶çš„ç¤ºä¾‹&lt;/h2&gt;
&lt;p&gt;ä½ éœ€è¦æŒ‰ç…§&lt;a href=&#34;https://istio.io/latest/docs/tasks/policy-enforcement/rate-limit/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤&lt;/a&gt;å¼€å§‹ã€‚èŠ±ç‚¹æ—¶é—´åˆ†æåŸºäºå‰æ–‡ä»‹ç»çš„é…ç½®ã€‚ä¾›ä½ å‚è€ƒï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ä½ ä¹Ÿå¯ä»¥åœ¨ Istio åŒ…çš„ç¤ºä¾‹ç›®å½•ä¸­è®¿é—®çš„ &lt;code&gt;httpbin&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é”™è¯¯çš„æ–¹æ³•&#34;&gt;é”™è¯¯çš„æ–¹æ³•&lt;/h3&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œæˆ‘å¸Œæœ›æ ¹æ®ä¸¤ä¸ªè·¯å¾„ &lt;code&gt;/delay&lt;/code&gt; å’Œ &lt;code&gt;/status&lt;/code&gt; è¿›è¡Œé€Ÿç‡é™åˆ¶ã€‚çœ‹èµ·æ¥å¾ˆå®¹æ˜“ï¼Œæ‰€ä»¥æˆ‘é…ç½®äº†æˆ‘çš„ Envoy Filter å’Œ RLS å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# EnvoyFilter é…ç½®è·¯ç”±æ“ä½œ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;MERGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rate_limits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;header_value_match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;descriptor_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;PATH&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;descriptor_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;yes&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;:path&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;safe_regex_match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;google_re2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;.*delay.*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;header_value_match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;descriptor_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;PATH&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;descriptor_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;no
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;:path&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;safe_regex_match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;google_re2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;.*status.*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# RLS configmap&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config.yaml&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    domain: tetrate-ratelimit
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    descriptors:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      - key: PATH
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        value: &amp;#34;yes&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        rate_limit:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          unit: minute
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          requests_per_unit: 3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      - key: PATH
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        value: &amp;#34;no&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        rate_limit:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          unit: minute
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          requests_per_unit: 1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰äº†è¿™ä¸ªï¼Œæˆ‘æœŸæœ›é€šè¿‡è°ƒç”¨ä»¥ä¸‹å‘½ä»¤æ¥ä½¿å…¶å·¥ä½œï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;curl http://127.0.0.1:8080/delay/1 -H&amp;#34;host: httpbin.com&amp;#34; -v -o /dev/null
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½†æ˜¯ RLS ç”šè‡³æ²¡æœ‰æ³¨æ„åˆ°è¿™ä¸ªè°ƒç”¨ï¼Œæ‰€ä»¥é€Ÿç‡é™åˆ¶æ²¡æœ‰å‘ç”Ÿï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# k logs -n default -f ratelimit-57bf5688c-f8q5k
time=&amp;#34;2023-11-29T17:34:10Z&amp;#34; level=debug msg=&amp;#34;[gostats] Flush() called, all stats would be flushed&amp;#34;
time=&amp;#34;2023-11-29T17:34:20Z&amp;#34; level=debug msg=&amp;#34;[gostats] flushing counter ratelimit.go.mallocs: 460&amp;#34;
time=&amp;#34;2023-11-29T17:34:20Z&amp;#34; level=debug msg=&amp;#34;[gostats] flushing counter ratelimit.go.frees: 26&amp;#34;
time=&amp;#34;2023-11-29T17:34:20Z&amp;#34; level=debug msg=&amp;#34;[gostats] flushing counter ratelimit.go.totalAlloc: 15624&amp;#34;
time=&amp;#34;2023-11-29T17:34:20Z&amp;#34; level=debug msg=&amp;#34;[gostats] flushing gauge ratelimit.go.sys: 0&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;em&gt;ä¸ºäº†è®¾ç½®è°ƒè¯•æ¨¡å¼ï¼Œä½ å¯ä»¥ç¼–è¾‘ ratelimit-server éƒ¨ç½²çš„å®¹å™¨å‚æ•°ã€‚åœ¨é‚£é‡Œï¼Œä½ å°†æ‰¾åˆ°æ—¥å¿—çº§åˆ«æ ‡å¿—ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘å°è¯•äº†æ‰€æœ‰ç§ç±»çš„ç»„åˆåœ¨ &lt;code&gt;rate_limits.actions&lt;/code&gt; è®¾ç½®ä¸­ï¼Œä½¿ç”¨ &lt;code&gt;string_match&lt;/code&gt; å’Œ &lt;code&gt;prefix_match&lt;/code&gt; æ›¿ä»£äº† &lt;code&gt;safe_regex_match&lt;/code&gt;ï¼Œä½†æ²¡æœ‰æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;è¿˜å°è¯•ä½¿ç”¨å•ä¸ª &lt;code&gt;descriptor_key&lt;/code&gt;ï¼Œä¸åŒçš„å€¼ä»¥åŠç”šè‡³ä¸è®¾ç½®å®ƒå¹¶ä½¿ç”¨é»˜è®¤çš„ &lt;code&gt;header_match&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é¡¿æ‚Ÿæ—¶åˆ»&#34;&gt;é¡¿æ‚Ÿæ—¶åˆ»&lt;/h2&gt;
&lt;p&gt;æˆ‘å‘ç°è¿‡æ»¤å™¨æ²¡æœ‰å‘é€ä»»ä½•ä¸œè¥¿åˆ° RLSï¼Œå› ä¸ºå‰è€…åœ¨ä»»ä½•è¯·æ±‚ä¸Šéƒ½ä¿æŒæ²‰é»˜ã€‚ç„¶åï¼Œé€šè¿‡æ–‡æ¡£æˆ‘è¯»åˆ°ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;ldquo;å¦‚æœæ“ä½œä¸èƒ½æ·»åŠ æè¿°ç¬¦æ¡ç›®ï¼Œåˆ™ä¸ä¼šä¸ºé…ç½®ç”Ÿæˆæè¿°ç¬¦&amp;rdquo;ï¼Œè§&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/route/v3/route_components.proto#config-route-v3-ratelimit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ç„¶åï¼Œå‘èµ·è°ƒç”¨ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;curl http://127.0.0.1:8080/status/delay -H&amp;#34;host: httpbin.com&amp;#34; -v -o /dev/null
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç»“æœå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;time=&amp;#34;2023-11-29T16:07:07Z&amp;#34; level=debug msg=&amp;#34;got descriptor: (PATH=yes),(PATH=no)&amp;#34;
time=&amp;#34;2023-11-29T16:07:07Z&amp;#34; level=debug msg=&amp;#34;starting get limit lookup&amp;#34;
time=&amp;#34;2023-11-29T16:07:07Z&amp;#34; level=debug msg=&amp;#34;looking up key: PATH_yes&amp;#34;
time=&amp;#34;2023-11-29T16:07:07Z&amp;#34; level=debug msg=&amp;#34;found rate limit: PATH_yes&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ‰€ä»¥ï¼Œåªæœ‰å½“æˆ‘çš„è·¯å¾„æ»¡è¶³ &lt;em&gt;ä¸¤ä¸ª&lt;/em&gt; &lt;code&gt;header_value_match&lt;/code&gt; æ—¶ï¼Œæè¿°ç¬¦æ‰ä¼šä¼ é€’ç»™ RLSã€‚æˆ‘çš„å½“å‰é…ç½®æ­£å¦‚ä¸€ä¸ª AND è¿ç®—ç¬¦ä¸€æ ·å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åï¼Œä¸€åˆ‡éƒ½å½’ç»“ä¸ºï¼š&lt;em&gt;å¦‚ä½•åœ¨ rate_limit æ“ä½œä¸­è®¾ç½® OR é€»è¾‘è€Œä¸æ˜¯ ANDï¼Ÿ&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&#34;è§£å†³æ–¹æ¡ˆ&#34;&gt;è§£å†³æ–¹æ¡ˆ&lt;/h2&gt;
&lt;p&gt;åŸå§‹é…ç½®ç•¥æœ‰å˜åŒ–ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# EnvoyFilter é…ç½®è·¯ç”±æ“ä½œ   
        value:
          rate_limits:
            - actions: # ä»»ä½•æ“ä½œåœ¨æ­¤å¤„
              - header_value_match:
                  descriptor_key: &amp;#34;PATH_DELAY&amp;#34;
                  descriptor_value: &amp;#34;yes&amp;#34;
                  headers:
                    - name: &amp;#34;:path&amp;#34;
                      safe_regex_match:
                        google_re2: {}
                        regex: &amp;#34;.*delay.*&amp;#34;
            - actions:
              - header_value_match:
                  descriptor_key: &amp;#34;PATH_STATUS&amp;#34;
                  descriptor_value: &amp;#34;yes&amp;#34;
                  headers:
                    - name: &amp;#34;:path&amp;#34;
                      safe_regex_match:
                        google_re2: {}
                        regex: &amp;#34;.*status.*&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;çœ‹èµ·æ¥åƒä¸€ä¸ªæœ‰æ•ˆçš„é…ç½®ï¼Œå°±åƒï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;â¯ curl http://127.0.0.1:8080/delay/1 -H&amp;#34;host: httpbin.com&amp;#34; -v -s -o /dev/null 
*   Trying 127.0.0.1:8080...
* Connected to 127.0.0.1 (127.0.0.1) port 8080 (#0)
&amp;gt; GET /delay/1 HTTP/1.1
&amp;gt; Host: httpbin.com
&amp;gt; User-Agent: curl/7.81.0
&amp;gt; Accept: */*
&amp;gt; 
* Mark bundle as not supporting multiuse
&amp;lt; HTTP/1.1 200 OK
&amp;lt; server: istio-envoy
&amp;lt; date: Wed, 29 Nov 2023 20:17:02 GMT
&amp;lt; content-type: application/json
&amp;lt; content-length: 703
&amp;lt; access-control-allow-origin: *
&amp;lt; access-control-allow-credentials: true
&amp;lt; x-envoy-upstream-service-time: 1005
&amp;lt; 
{ [703 bytes data]
* Connection #0 to host 127.0.0.1 left intact

â¯ curl http://127.0.0.1:8080/delay/1 -H&amp;#34;host: httpbin.com&amp;#34; -v -s -o /dev/null 
*   Trying 127.0.0.1:8080...
* Connected to 127.0.0.1 (127.0.0.1) port 8080 (#0)
&amp;gt; GET /delay/1 HTTP/1.1
&amp;gt; Host: httpbin.com
&amp;gt; User-Agent: curl/7.81.0
&amp;gt; Accept: */*
&amp;gt; 
* Mark bundle as not supporting multiuse
&amp;lt; HTTP/1.1 429 Too Many Requests &amp;lt;---------- å‚è§
&amp;lt; x-envoy-ratelimited: true
&amp;lt; date: Wed, 29 Nov 2023 20:17:06 GMT
&amp;lt; server: istio-envoy
&amp;lt; content-length: 0
&amp;lt; 
* Connection #0 to host 127.0.0.1 left intact
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å’Œ RLS æ—¥å¿—ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;time=&amp;#34;2023-11-29T16:33:57Z&amp;#34; level=debug msg=&amp;#34;starting cache lookup&amp;#34;
time=&amp;#34;2023-11-29T16:33:57Z&amp;#34; level=debug msg=&amp;#34;looking up cache key: tetrate-ratelimit_PATH_DELAY_yes_1701275580&amp;#34;
time=&amp;#34;2023-11-29T16:33:57Z&amp;#34; level=debug msg=&amp;#34;cache key: tetrate-ratelimit_PATH_DELAY_yes_1701275580 current: 1&amp;#34;
time=&amp;#34;2023-11-29T16:33:57Z&amp;#34; level=debug msg=&amp;#34;returning normal response&amp;#34;
time=&amp;#34;2023-11-29T16:33:57Z&amp;#34; level=debug msg=&amp;#34;[gostats] flushing time ratelimit_server.ShouldRateLimit.response_time: 0.000000&amp;#34;
time=&amp;#34;2023-11-29T16:33:59Z&amp;#34; level=debug msg=&amp;#34;got descriptor: (PATH_DELAY=yes)&amp;#34;
time=&amp;#34;2023-11-29T16:33:59Z&amp;#34; level=debug msg=&amp;#34;starting get limit lookup&amp;#34;
time=&amp;#34;2023-11-29T16:33:59Z&amp;#34; level=debug msg=&amp;#34;looking up key: PATH_DELAY_yes&amp;#34;
time=&amp;#34;2023-11-29T16:33:59Z&amp;#34; level=debug msg=&amp;#34;found rate limit: PATH_DELAY_yes&amp;#34;
time=&amp;#34;2023-11-29T16:33:59Z&amp;#34; level=debug msg=&amp;#34;applying limit: 1 requests per MINUTE, shadow_mode: false&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç›¸ä¿¡æˆ‘ï¼Œ&lt;code&gt;/status&lt;/code&gt; çš„é™åˆ¶ä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;AND/ORé€»è¾‘ç”¨äºé€Ÿç‡é™åˆ¶ &lt;code&gt;rate_limits&lt;/code&gt; é…ç½®åœ¨å…¶æ•°ç»„ä¸­æ”¯æŒå¤šä¸ªä½ç½®ï¼Œå› æ­¤ AND/OR é€»è¾‘æ“ä½œå–å†³äºåŠ¨ä½œæ˜¯å¦åµŒå¥—åˆ°ç›¸åŒçš„ &lt;code&gt;actions&lt;/code&gt; å­é›†ä¸­ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šå¯èƒ½æœ‰ä¸€ç§æ›´å®‰å…¨ã€æ›´æœ‰æ•ˆçš„è·¯å¾„åŒ¹é…æ–¹å¼ï¼Œè€Œä¸æ˜¯åƒè¿™ä¸ªä¾‹å­ä¸­é‚£æ ·æ‰“å¼€æ­£åˆ™è¡¨è¾¾å¼ã€‚å®ƒå¾ˆç®€å•ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸“æ³¨äºä¸»é¢˜ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Cilium çš„æ§åˆ¶å¹³é¢å‡çº§ä¹‹è·¯ï¼šxDS API çš„å¼•å…¥ä¸åº”ç”¨</title>
      <link>https://cloudnativecn.com/blog/scaling-cilium-to-new-heights-with-xds/</link>
      <pubDate>Mon, 29 Jan 2024 20:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/scaling-cilium-to-new-heights-with-xds/</guid>
      <description>&lt;p&gt;åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨å½“å‰çš„ Cilium æ§åˆ¶å¹³é¢è®¾è®¡ï¼Œ&lt;a href=&#34;https://github.com/cilium/cilium/issues/30283&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤§è§„æ¨¡éƒ¨ç½²å¯èƒ½å‡ºç°çš„é™åˆ¶çš„ä½ç½®å’ŒåŸå› &lt;/a&gt;ï¼Œä»¥åŠç¤¾åŒºå¦‚ä½•ä½¿ç”¨ CNCF çš„ &lt;a href=&#34;https://github.com/cncf/xds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€šç”¨æ•°æ®å¹³é¢ (xDS) API&lt;/a&gt; æ¨è¿›è¿™ä¸ªæ¶æ„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;äº†è§£-cilium-çš„æ§åˆ¶å¹³é¢æ¶æ„&#34;&gt;äº†è§£ Cilium çš„æ§åˆ¶å¹³é¢æ¶æ„&lt;/h2&gt;
&lt;p&gt;Cilium éµå¾ªåŸºäºâ€œæ•°æ®å¹³é¢â€å’Œâ€œæ§åˆ¶å¹³é¢â€çš„å¸¸è§ç½‘ç»œæ¶æ„ã€‚åœ¨ Cilium ä¸­ï¼Œæ•°æ®å¹³é¢éƒ¨ç½²åœ¨æ¯ä¸ªä¸»æœºï¼ˆæˆ– Kubernetes èŠ‚ç‚¹ï¼‰ä¸Šï¼ŒåŒ…æ‹¬ç”¨äºå¤„ç† L3/L4 è¿æ¥å’Œç­–ç•¥çš„ eBPF ç¨‹åºã€‚ä¸ºäº†ç®€åŒ–èµ·è§ï¼Œå¯¹äºå®Œæ•´æ€§ï¼ŒCilium è¿˜åœ¨å…¶æ•°æ®å¹³é¢ä¸­ä½¿ç”¨ Envoy ä»£ç†å¤„ç† L7 ç­–ç•¥ï¼Œä½†æˆ‘ä»¬å°†çœç•¥è¿™éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-cilium-to-new-heights-with-xds/f1_hu_e85b145e78a6e15c.webp 400w,
               /blog/scaling-cilium-to-new-heights-with-xds/f1_hu_b3469153a1af1bfa.webp 760w,
               /blog/scaling-cilium-to-new-heights-with-xds/f1_hu_3bc5f9732a2287a7.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-cilium-to-new-heights-with-xds/f1_hu_e85b145e78a6e15c.webp&#34;
               width=&#34;523&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Cilium æ§åˆ¶å¹³é¢ä»¥ cilium-agent å®ˆæŠ¤ç¨‹åºçš„å½¢å¼å®ç°ï¼Œéƒ¨ç½²åœ¨æ¯ä¸ª Kubernetes èŠ‚ç‚¹ä¸Šã€‚æ¯ä¸ª cilium-agent éƒ½æ˜¯æ§åˆ¶å¹³é¢çš„å•ç‹¬ã€ç‹¬ç«‹çš„å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;cilium-agent è¿æ¥åˆ° Kubernetes API æœåŠ¡å™¨ï¼Œç›‘è§†é…ç½®æ›´æ”¹ï¼Œç„¶åä½¿ç”¨å®ƒæ¥é…ç½®æ•°æ®å¹³é¢ã€‚cilium-agent è¿˜å°†é…ç½®å†™å…¥ Kubernetes APIï¼Œè¡¨ç¤ºæ­£åœ¨å…¶å„è‡ªèŠ‚ç‚¹ä¸Šåˆ›å»ºçš„ç«¯ç‚¹æˆ–æ ‡è¯†ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå½“åœ¨ Kubernetes èŠ‚ç‚¹ä¸Šå¯åŠ¨ä¸€ä¸ª Pod æ—¶ï¼Œcilium-agent è´Ÿè´£ç¼–å†™ä¸€ä¸ª CiliumEndpoint è‡ªå®šä¹‰èµ„æºï¼ˆCRï¼‰ï¼Œå¹¶å¯èƒ½æ˜¯ä¸€ä¸ªè¡¨ç¤º Pod ç½‘ç»œæ ‡è¯†çš„ CiliumIdentity CRã€‚cilium-agent è¿˜ä¼šæ›´æ–°ä¸æ ‡è¯†å’Œç«¯ç‚¹æ˜ å°„ç›¸å…³çš„èŠ‚ç‚¹ä¸Šçš„ eBPF æ˜ å°„ã€‚å…¶ä»– Kubernetes èŠ‚ç‚¹ä¸Šçš„ cilium-agent ä¹Ÿä¼šç›‘è§†è¿™äº›æ–°çš„ CiliumEndpoint å’Œ CiliumIdentity CR çš„åˆ›å»ºï¼Œå¹¶æ›´æ–°å…¶æœ¬åœ°çš„ eBPF æ•°æ®å¹³é¢ä»¥æ‰§è¡Œç­–ç•¥ã€‚è¿™ç§æœºåˆ¶èƒ½å¤Ÿåè°ƒæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„å…¨å±€ç­–ç•¥æ‰§è¡Œé…ç½®ï¼Œä»¥ä¾¿æ‰€æœ‰èŠ‚ç‚¹çœ‹åˆ°ç›¸åŒçš„æ‰§è¡Œè¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-cilium-to-new-heights-with-xds/f2_hu_64f207ca12a94a57.webp 400w,
               /blog/scaling-cilium-to-new-heights-with-xds/f2_hu_8072c86003c65f56.webp 760w,
               /blog/scaling-cilium-to-new-heights-with-xds/f2_hu_7348ee7681a1e9fc.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-cilium-to-new-heights-with-xds/f2_hu_64f207ca12a94a57.webp&#34;
               width=&#34;760&#34;
               height=&#34;501&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æ„å»ºæ§åˆ¶å¹³é¢çš„æœ€ä½³å®è·µ&#34;&gt;æ„å»ºæ§åˆ¶å¹³é¢çš„æœ€ä½³å®è·µ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä»¥å‰ &lt;a href=&#34;https://www.solo.io/blog/building-a-control-plane-for-envoy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ›¾å¤šæ¬¡åœ¨åšå®¢ä¸­&lt;/a&gt; &lt;a href=&#34;https://www.solo.io/blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¨è®ºè¿‡æ„å»º&lt;/a&gt; &lt;a href=&#34;https://www.solo.io/blog/why-the-control-plane-matters/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯æ‰©å±•ã€å®‰å…¨ã€é«˜æ•ˆçš„æ§åˆ¶å¹³é¢çš„æœ€ä½³å®è·µ&lt;/a&gt;ã€‚åœ¨æ·±å…¥ç ”ç©¶å¦‚ä½•æ‰©å±• Cilium çš„æ§åˆ¶å¹³é¢ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥å›é¡¾ä¸€äº›è¿™äº›æœ€ä½³å®è·µã€‚&lt;/p&gt;
&lt;p&gt;ç½‘ç»œæ¶æ„ä¸­çš„æ•°æ®å¹³é¢åº”è¯¥å°½å¯èƒ½ç®€å•ï¼Œæ€§èƒ½é«˜ï¼Œä»¥åŠé«˜æ•ˆå®Œæˆå®ƒéœ€è¦åšçš„äº‹æƒ…ï¼šåœ¨æœ¬ä¾‹ä¸­ï¼Œæ¥å›ä¼ è¾“å­—èŠ‚ï¼Œå®æ–½ç­–ç•¥ï¼Œå¹¶æ‰§è¡Œå®‰å…¨æ€§ã€‚æ§åˆ¶å¹³é¢çš„ä½œç”¨æ˜¯ä¿æŠ¤æ•°æ®å¹³é¢å…å—å¤æ‚æ€§çš„å¹²æ‰°ï¼Œä»¥åŠä»»ä½•åˆ†æ•£æ•°æ®å¹³é¢æ ¸å¿ƒä»»åŠ¡çš„äº‹ç‰©ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€æ–¹é¢ï¼Œç”¨æˆ·éœ€è¦èƒ½å¤Ÿä»¥æœ€é€‚åˆä»–ä»¬ç”¨æˆ·ä½“éªŒçš„å½¢å¼æŒ‡å®šé…ç½®å’Œç­–ç•¥ã€‚å¾ˆå¤šæ—¶å€™ï¼Œé€šè¿‡æŸç§ &lt;a href=&#34;https://www.solo.io/blog/guidance-for-building-a-control-plane-for-envoy-part-3-domain-specific-configuration/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‰¹å®šé¢†åŸŸçš„é…ç½®æ ¼å¼&lt;/a&gt; æ¥å®ç°ã€‚ç„¶åéœ€è¦å°†è¿™ç§æ›´é«˜çº§åˆ«çš„ç”¨æˆ·é…ç½®ä¸åŸºç¡€è®¾æ–½çŠ¶æ€ç›¸ç»“åˆï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸ºè¾ƒä½çº§åˆ«çš„æ•°æ®å¹³é¢æ ¼å¼ã€‚è½¬è¯‘æ˜¯ä¸€åŠçš„æˆ˜æ–—ã€‚è¿˜éœ€è¦å°†è¾ƒä½çº§åˆ«çš„é…ç½®åˆ†å‘åˆ°æ•°æ®å¹³é¢ï¼Œå¹¶é«˜æ•ˆåœ°æ‰§è¡Œã€‚è¿™å°±æ˜¯æ§åˆ¶å¹³é¢å‡ºç°åœ¨ç”»é¢ä¸­çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-cilium-to-new-heights-with-xds/f3_hu_326cf5101df16a89.webp 400w,
               /blog/scaling-cilium-to-new-heights-with-xds/f3_hu_818d9a1ab05dcb49.webp 760w,
               /blog/scaling-cilium-to-new-heights-with-xds/f3_hu_402334f16257c9b3.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-cilium-to-new-heights-with-xds/f3_hu_326cf5101df16a89.webp&#34;
               width=&#34;529&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ§åˆ¶å¹³é¢å…è®¸é…ç½®è§£è€¦å¹¶ä¸å¹³å°çš„å…¶ä»–éƒ¨åˆ†é›†æˆï¼Œè¿™äº›éƒ¨åˆ†éšåå¯ä»¥é€šçŸ¥æ•°æ®å¹³é¢ã€‚åœ¨è®¸å¤šæ–¹é¢ï¼Œè¿™ä¸ªå›¾è¡¨ä¸æˆ‘ä»¬æ„å»ºåº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨çš„ &lt;a href=&#34;https://learn.microsoft.com/en-us/azure/architecture/guide/architecture-styles/n-tier&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸‰å±‚æ¶æ„&lt;/a&gt; ç±»ä¼¼ï¼šè¡¨ç¤ºå±‚ï¼Œè§£è€¦çš„ä¸šåŠ¡é€»è¾‘å±‚å’Œæ•°æ®å­˜å‚¨ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-cilium-to-new-heights-with-xds/f4_hu_3f0fb52479bcfd4e.webp 400w,
               /blog/scaling-cilium-to-new-heights-with-xds/f4_hu_1c65606fdf2c162b.webp 760w,
               /blog/scaling-cilium-to-new-heights-with-xds/f4_hu_7ce2e12ee58785c6.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-cilium-to-new-heights-with-xds/f4_hu_3f0fb52479bcfd4e.webp&#34;
               width=&#34;533&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ç½‘ç»œæ¶æ„çš„æƒ…å†µä¸‹ï¼Œæ§åˆ¶å¹³é¢å±‚å°†å¤„ç†è¯»å–/å†™å…¥ Kubernetes API å’Œåˆ›å»ºç½‘ç»œæ ‡è¯†ç­‰æ•æ„Ÿæ•°æ®ã€‚ç”±äºå®ƒæ˜¯ä¸€ä¸ªå•ç‹¬çš„å±‚ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œå®‰å…¨å’Œç¡¬åŒ–å¤„ç†ï¼Œå¹¶æ¶ˆé™¤æ•°æ®å¹³é¢éœ€è¦æ‰§è¡Œè¿™äº›ä»»åŠ¡çš„æƒé™ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè™½ç„¶å¼€å§‹æ—¶æ›´ç®€å•ï¼Œä½†åˆå¹¶ä¸€äº›å±‚ä¼šå¯¼è‡´æ•ˆç‡ä½ä¸‹ã€å®‰å…¨é—®é¢˜å’Œæ‰©å±•/è€¦åˆé—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;cilium-æ§åˆ¶å¹³é¢æ¶æ„çš„æ‰©å±•è€ƒè™‘&#34;&gt;Cilium æ§åˆ¶å¹³é¢æ¶æ„çš„æ‰©å±•è€ƒè™‘&lt;/h2&gt;
&lt;p&gt;é›†ç¾¤ä¸­çš„æ¯ä¸ª cilium-agent è´Ÿè´£å°†å…¨å±€é›†ç¾¤é…ç½®æ›´æ–°åˆ°å…¶æœ¬åœ°æ•°æ®å¹³é¢é…ç½®ã€‚æ¯ä¸ª cilium-agent å¯èƒ½ä¼šç›‘è§†å¤šè¾¾ 15 ç§ CRD ç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;éšç€é›†ç¾¤åœ¨èŠ‚ç‚¹ã€Podã€å‘½åç©ºé—´å’Œç½‘ç»œç­–ç•¥æ–¹é¢çš„è§„æ¨¡å¢é•¿ï¼Œæ¯ä¸ª cilium-agent éœ€è¦æ‰§è¡Œçš„å·¥ä½œé‡ä¹Ÿä¼šå¢åŠ ã€‚ä¸ºäº†æœåŠ¡å’Œæ›´æ–°æ‰€æœ‰è¿™äº›çŠ¶æ€ï¼Œä¼šå¯¹ Kubernetes apiserver é€ æˆå‹åŠ›ï¼Œå¯èƒ½å¯¼è‡´ &lt;a href=&#34;https://github.com/cilium/cilium/issues/29127&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é—®é¢˜&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-cilium-to-new-heights-with-xds/f5_hu_3a4c4e660d187d00.webp 400w,
               /blog/scaling-cilium-to-new-heights-with-xds/f5_hu_eba9fd7d2bcc723d.webp 760w,
               /blog/scaling-cilium-to-new-heights-with-xds/f5_hu_2144cb1d45806ffc.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-cilium-to-new-heights-with-xds/f5_hu_3a4c4e660d187d00.webp&#34;
               width=&#34;760&#34;
               height=&#34;478&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨å¤§è§„æ¨¡éƒ¨ç½²ä¸­ï¼Œè¿™ç§å¯¹ Kubernetes API æœåŠ¡å™¨çš„å‹åŠ›å¯èƒ½æœ€ç»ˆä¼šå‡æ…¢ &lt;em&gt;ç”šè‡³å¯¼è‡´&lt;/em&gt; é›†ç¾¤ä¸­çš„æ‰€æœ‰æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æŸ¥çœ‹é›†ç¾¤ä¸­çš„å¸¸è§æ“ä½œä»¥åŠ cilium-agent å¤„ç†å®ƒçš„æ–¹å¼æ—¶ï¼Œå…¨å±€é…ç½®çŠ¶æ€å¯¹æ¯ä¸ªèŠ‚ç‚¹çš„å½±å“ç¡®å®å¼€å§‹æ”¾å¤§ï¼šå·¥ä½œè´Ÿè½½å’Œå‘½åç©ºé—´è¢«æ ‡è®°ã€é‡æ–°æ ‡è®°æˆ–å–æ¶ˆæ ‡è®°ã€‚&lt;/p&gt;
&lt;p&gt;cilium-agent è´Ÿè´£ä¸ºè°ƒåº¦åˆ°å…¶èŠ‚ç‚¹ä¸Šçš„ Pod ç¼–å†™ CiliumEndpoint å’Œ CiliumIdentity èµ„æºã€‚ç”±äºè¿™äº›èµ„æºä¾èµ–äº Pod å’Œå‘½åç©ºé—´æ ‡ç­¾çš„ç»„åˆï¼Œæ ‡ç­¾çš„æ›´æ”¹å°†å¯¼è‡´æ‰€æœ‰ä¾èµ–èµ„æºçš„æ›´æ–°ã€‚è¿™ä¼šå¯¼è‡´å¤§é‡çš„å†™æ“ä½œå’Œç›¸åº”çš„è¯»å–æ“ä½œï¼Œå› ä¸ºæ­¤çŠ¶æ€éšåä¼šä¼ æ’­åˆ°æ‰€æœ‰ cilium-agentï¼Œå®ƒä»¬å¿…é¡»åšå‡ºååº”å¹¶é‡æ–°é…ç½®å…¶æœ¬åœ°æ•°æ®å¹³é¢ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cilium.io/v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CiliumIdentity&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;50568&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;io.cilium.k8s.policy.cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;io.cilium.k8s.policy.serviceaccount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sleep-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;io.kubernetes.pod.namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;security-labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s:app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s:io.cilium.k8s.namespace.labels.team&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;loyalty&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s:io.cilium.k8s.namespace.labels.version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v10.45&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s:io.cilium.k8s.policy.cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s:io.cilium.k8s.policy.serviceaccount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sleep-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s:io.kubernetes.pod.namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s:version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä»£ç æ¸…å• 1ï¼š&lt;code&gt;CiliumIdentity&lt;/code&gt; èµ„æºç»“åˆäº† &lt;em&gt;Pod&lt;/em&gt; å’Œ &lt;em&gt;å‘½åç©ºé—´&lt;/em&gt; æ ‡ç­¾ã€‚å¯¹ä»»ä¸€è€…çš„æ›´æ”¹éƒ½ä¼šå¼ºåˆ¶é‡æ–°è®¡ç®—å¹¶ç”Ÿæˆæ–°çš„ &lt;code&gt;CiliumIdentity&lt;/code&gt;ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯¹é›†ç¾¤ä¸­çš„å‘½åç©ºé—´è¿›è¡Œæ ‡è®°ç­‰æ“ä½œå¯¹äº Cilium å¯èƒ½éå¸¸æ˜‚è´µï¼Œå¹¶ä¸”æœ‰å¯èƒ½å¯¼è‡´ API æœåŠ¡å™¨æ“ä½œå‡æ…¢åˆ°çˆ¬è¡Œçš„ç¨‹åº¦ï¼ˆ&lt;a href=&#34;https://docs.cilium.io/en/stable/operations/performance/scalability/identity-relevant-labels/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯·å‚é˜…ç”¨äºæ ‡è¯†ç›®çš„åŒ…æ‹¬/æ’é™¤æ ‡ç­¾çš„å»ºè®®&lt;/a&gt;ï¼‰ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸­ç­‰è§„æ¨¡é›†ç¾¤ä¸­æ›´æ”¹å‘½åç©ºé—´çš„æ ‡ç­¾å¯èƒ½ä¼šå¯¼è‡´è¶³å¤Ÿå¤šçš„ cilium-agent å¯¼è‡´ Kubernetes API æœåŠ¡å™¨å“åº”å»¶è¿Ÿçº¦ &lt;strong&gt;4 åˆ†é’Ÿ&lt;/strong&gt;ã€‚è¿™å°†æœ‰æ•ˆåœ°ä½¿é›†ç¾¤ä¸Šçš„æ‰€æœ‰æ“ä½œåœæ»ä¸å‰ã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘ä»¥ä¸‹ç¯å¢ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;200 ä¸ªèŠ‚ç‚¹çš„ Kubernetes é›†ç¾¤&lt;/li&gt;
&lt;li&gt;5 ä¸ªå‘½åç©ºé—´&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªå‘½åç©ºé—´æœ‰ 50 ä¸ªéƒ¨ç½²&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªéƒ¨ç½²æœ‰ 80 ä¸ªå‰¯æœ¬ï¼ˆæ€»å…± 20,000 ä¸ª Podï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ä¸€æ¬¡æ›´æ–°è·¨å‘½åç©ºé—´çš„æ ‡ç­¾çš„æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ° CPU åˆ©ç”¨ç‡æ€¥å‰§ä¸Šå‡ï¼Œçº¦ä¸º 150%ï¼Œå¹¶ä¸”å†…å­˜åœ¨æ•´ä¸ªé›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹ä¸Šå‡åˆ°çº¦ 1 GBã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-1æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„-cpu-å’Œå†…å­˜å³°å€¼&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1ï¼šæ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„ CPU å’Œå†…å­˜å³°å€¼&#34; srcset=&#34;
               /blog/scaling-cilium-to-new-heights-with-xds/g1_hu_615248bfbd16ec9a.webp 400w,
               /blog/scaling-cilium-to-new-heights-with-xds/g1_hu_304d58c87aca2dc2.webp 760w,
               /blog/scaling-cilium-to-new-heights-with-xds/g1_hu_631e786dfbd9fc04.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-cilium-to-new-heights-with-xds/g1_hu_615248bfbd16ec9a.webp&#34;
               width=&#34;760&#34;
               height=&#34;210&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1ï¼šæ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„ CPU å’Œå†…å­˜å³°å€¼
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æ•´ä¸ªé›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹ä¸ŠåŒæ—¶æé«˜ CPU å’Œå†…å­˜æ˜¯ä¸å¸Œæœ›çœ‹åˆ°çš„è¡Œä¸ºï¼Œç„¶è€Œæ›´ä¸¥é‡çš„æ˜¯ cilium-agent äº‹ä»¶çš„è¯»å†™å¦‚ä½•å½±å“ Kubernetes API æœåŠ¡å™¨çš„å»¶è¿Ÿã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°å»¶è¿Ÿå¢é•¿åˆ° 3 åˆ° 4 &lt;em&gt;åˆ†é’Ÿ&lt;/em&gt;ã€‚è¿™è‚¯å®šä¼šå¯¼è‡´å„ç§ç±»å‹çš„åœæœºï¼ä¸å¹¸çš„æ˜¯ï¼Œç”±äºè¿™ç§æ§åˆ¶å¹³é¢æ¶æ„ï¼Œé€šè¿‡å¢åŠ å®¹é‡æ¥å¤„ç†æ‰©å±•é—®é¢˜çš„å…¸å‹æ–¹æ³•ä¸èµ·ä½œç”¨ï¼›å®é™…ä¸Šï¼Œæ·»åŠ æ›´å¤šèŠ‚ç‚¹å’Œ/æˆ–æ›´å¤šå·¥ä½œè´Ÿè½½ä¼šæ”¾å¤§è¿™ç§è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-2kubernetes-api-æœåŠ¡å™¨å»¶è¿Ÿå¢åŠ åˆ°-3---4-åˆ†é’Ÿ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 2ï¼šKubernetes API æœåŠ¡å™¨å»¶è¿Ÿå¢åŠ åˆ° 3 - 4 åˆ†é’Ÿ&#34; srcset=&#34;
               /blog/scaling-cilium-to-new-heights-with-xds/g2_hu_6e62b2feb21d20f8.webp 400w,
               /blog/scaling-cilium-to-new-heights-with-xds/g2_hu_55c4ca0df3bc6f01.webp 760w,
               /blog/scaling-cilium-to-new-heights-with-xds/g2_hu_1be1774be4a5cbde.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-cilium-to-new-heights-with-xds/g2_hu_6e62b2feb21d20f8.webp&#34;
               width=&#34;760&#34;
               height=&#34;312&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 2ï¼šKubernetes API æœåŠ¡å™¨å»¶è¿Ÿå¢åŠ åˆ° 3 - 4 åˆ†é’Ÿ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å‡è½»-kubernetes-api-æœåŠ¡å™¨çš„å‹åŠ›&#34;&gt;å‡è½» Kubernetes API æœåŠ¡å™¨çš„å‹åŠ›&lt;/h2&gt;
&lt;p&gt;å¯¹äºè¾ƒå¤§çš„ Cilium é›†ç¾¤ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨&lt;a href=&#34;https://docs.cilium.io/en/latest/kvstore/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸“ç”¨çš„é”®å€¼å­˜å‚¨&lt;/a&gt; æ¥å‡è½» Kubernetes API æœåŠ¡å™¨ä¸Šçš„å‹åŠ›ã€‚é”®å€¼å­˜å‚¨ç”¨äºå­˜å‚¨å·¥ä½œè´Ÿè½½æ ‡è¯†ã€ç«¯ç‚¹å’Œ IP åˆ°æ ‡è¯†æ˜ å°„ç­‰å†…å®¹ã€‚Cilium ä¸å†å°†æ­¤ä¿¡æ¯å­˜å‚¨åœ¨ Kubernetes è‡ªå®šä¹‰èµ„æºï¼ˆCRDï¼‰ä¸­ï¼Œè€Œæ˜¯åœ¨å…¶è‡ªå·±çš„æ•°æ®åº“ä¸­ç›´æ¥ç›‘è§†ã€æ“ä½œå’Œå†™å…¥å¯¹è±¡ã€‚Cilium Helm å›¾è¡¨æ”¯æŒå°† etcd ä½œä¸ºä¸“ç”¨é”®å€¼å­˜å‚¨æ¥è¿›è¡Œå®‰è£…ï¼Œä»¥æ»¡è¶³æ­¤ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;éšç€é›†ç¾¤çš„å¢é•¿ï¼Œä½¿ç”¨ kv-store æ¥å¸è½½ Cilium å¯¹è±¡çš„è¯»/å†™æ“ä½œå¯èƒ½æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œè€Œä¸æ˜¯ç»™ Kubernetes API æœåŠ¡å™¨æ–½åŠ å‹åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šCilium è¿˜è¿›è¡Œäº†å…¶ä»–ä¼˜åŒ–ï¼Œä»¥å‡è½» Kubernetes API æœåŠ¡å™¨çš„å‹åŠ›ï¼Œä¾‹å¦‚ç­–ç•¥çŠ¶æ€æ›´æ–°ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…&lt;a href=&#34;https://docs.cilium.io/en/stable/internals/cilium_operator/#policy-status-update&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;k8s-events-handover æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬åœ¨å­˜åœ¨ kv-store çš„æƒ…å†µä¸‹é‡æ–°è¿è¡Œå…ˆå‰çš„æµ‹è¯•ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å¯¹ Kubernetes API æœåŠ¡å™¨çš„å‹åŠ›å‡è½»ï¼Œå°½ç®¡ CPU å¯èƒ½æ²¡æœ‰å‡è½»ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-3æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„-cpu-å³°å€¼å†…å­˜ä¿æŒåœ¨-300-400-mb-èŒƒå›´å†…&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 3ï¼šæ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„ CPU å³°å€¼ï¼Œå†…å­˜ä¿æŒåœ¨ 300-400 MB èŒƒå›´å†…&#34; srcset=&#34;
               /blog/scaling-cilium-to-new-heights-with-xds/g3_hu_e094f9dd4cdd32ea.webp 400w,
               /blog/scaling-cilium-to-new-heights-with-xds/g3_hu_3b1312df8e2405dd.webp 760w,
               /blog/scaling-cilium-to-new-heights-with-xds/g3_hu_8ab2f07bbd6316d4.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-cilium-to-new-heights-with-xds/g3_hu_e094f9dd4cdd32ea.webp&#34;
               width=&#34;760&#34;
               height=&#34;174&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 3ï¼šæ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„ CPU å³°å€¼ï¼Œå†…å­˜ä¿æŒåœ¨ 300-400 MB èŒƒå›´å†…
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸å…ˆå‰æƒ…å†µä¸‹çš„ 150% CPU æ¶ˆè€—ä¸åŒï¼ŒCPU åœ¨å¤§çº¦ 100% å·¦å³æ³¢åŠ¨ï¼Œè€Œå†…å­˜ä¿æŒåœ¨å¤§çº¦ 300 åˆ° 400 MB çš„èŒƒå›´å†…ã€‚è¿™æ˜¯å› ä¸ºå¯¹æ¯ä¸ª Pod å’Œæ¯ä¸ªæ ‡è¯†ï¼ˆCilium åœ¨æ›´æ”¹æ ‡ç­¾æ—¶åˆ›å»ºæ‰€æœ‰æ–°æ ‡è¯†ï¼Œå¹¶ä¸”å¿…é¡»æ›´æ–°å¼•ç”¨æ—§æ ‡è¯†çš„æ‰€æœ‰ eBPF æ˜ å°„çš„ CiliumEndpoint å’Œ CiliumIdentity å¯¹è±¡çš„é‡æ–°è®¡ç®—å’Œç”Ÿæˆéœ€è¦ CPU è®¡ç®—èµ„æºæ¥å®Œæˆï¼Œæ— è®ºä½¿ç”¨ä½•ç§åå¤‡å­˜å‚¨ï¼ˆCRDã€kv-store ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬è§‚å¯Ÿ kv-storeï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°åœ¨æ­¤å‘½åç©ºé—´æ ‡ç­¾äº‹ä»¶æœŸé—´ï¼Œäº‹ä»¶æ“ä½œ/ç§’å’Œå»¶è¿Ÿä¼šæ€¥å‰§ä¸Šå‡ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-4kv-store-ä¸Šçš„äº‹ä»¶æ“ä½œå’Œå»¶è¿Ÿåœ¨æ­¤å‘½åç©ºé—´æ ‡ç­¾äº‹ä»¶æœŸé—´æ€¥å‰§ä¸Šå‡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 4ï¼škv-store ä¸Šçš„äº‹ä»¶æ“ä½œå’Œå»¶è¿Ÿåœ¨æ­¤å‘½åç©ºé—´æ ‡ç­¾äº‹ä»¶æœŸé—´æ€¥å‰§ä¸Šå‡&#34; srcset=&#34;
               /blog/scaling-cilium-to-new-heights-with-xds/g4_hu_5d3c3f2aeb645b88.webp 400w,
               /blog/scaling-cilium-to-new-heights-with-xds/g4_hu_a1b2c57ef9acb2dd.webp 760w,
               /blog/scaling-cilium-to-new-heights-with-xds/g4_hu_57207f194d2e0dd.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-cilium-to-new-heights-with-xds/g4_hu_5d3c3f2aeb645b88.webp&#34;
               width=&#34;760&#34;
               height=&#34;183&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 4ï¼škv-store ä¸Šçš„äº‹ä»¶æ“ä½œå’Œå»¶è¿Ÿåœ¨æ­¤å‘½åç©ºé—´æ ‡ç­¾äº‹ä»¶æœŸé—´æ€¥å‰§ä¸Šå‡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çœ‹åˆ° kv-store æ‰¿å—äº†ç›¸å½“å¤§çš„è´Ÿè½½ï¼Œé€šè¿‡äº‹ä»¶ IOï¼Œæˆ‘ä»¬çœ‹åˆ° kv-store è°ƒç”¨çš„å»¶è¿Ÿé™ä½åˆ°çº¦ 15 ç§’å·¦å³ã€‚æ€»ä¹‹ï¼Œè¿™å¯¹äºæ•´ä¸ªé›†ç¾¤æ“ä½œè€Œè¨€è¦å¥½å¾—å¤šï¼Œè€Œä¸æ˜¯ç”¨è¯·æ±‚ä½¿ Kubernetes API æœåŠ¡å™¨é¥±å’Œã€‚äº‹å®ä¸Šï¼Œåœ¨å›¾ 5 ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Kubernetes API æœåŠ¡å™¨çš„å»¶è¿Ÿä¿æŒåœ¨ 10 åˆ° 40 æ¯«ç§’çš„å¯æ¥å—èŒƒå›´å†…ï¼Œè€Œåœ¨å…ˆå‰çš„ç¤ºä¾‹ä¸­ï¼Œå»¶è¿Ÿå‡é«˜åˆ° 4 åˆ†é’Ÿã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-5kubernetes-api-server-å»¶è¿Ÿåœ¨-10-åˆ°-40ms-ä¹‹é—´&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 5ï¼šKubernetes API Server å»¶è¿Ÿåœ¨ 10 åˆ° 40ms ä¹‹é—´&#34; srcset=&#34;
               /blog/scaling-cilium-to-new-heights-with-xds/g5_hu_fd927ddd788c12fd.webp 400w,
               /blog/scaling-cilium-to-new-heights-with-xds/g5_hu_d212f8cd78cdec33.webp 760w,
               /blog/scaling-cilium-to-new-heights-with-xds/g5_hu_3ff367fa94d597cd.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-cilium-to-new-heights-with-xds/g5_hu_fd927ddd788c12fd.webp&#34;
               width=&#34;760&#34;
               height=&#34;305&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 5ï¼šKubernetes API Server å»¶è¿Ÿåœ¨ 10 åˆ° 40ms ä¹‹é—´
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ kv-store åç«¯æ¥å­˜å‚¨ Cilium å¯¹è±¡æ˜¯ä¸€ç§ç¼“è§£ Kubernetes API æœåŠ¡å™¨å‹åŠ›çš„å¥½æ–¹æ³•ï¼Œä½†å®ƒä¹Ÿæœ‰å…¶ç¼ºç‚¹ã€‚ç°åœ¨æœ‰ä¸¤ä¸ªæŒä¹…å­˜å‚¨éœ€è¦ç»´æŠ¤ï¼Œè€Œä¸”éšç€è§„æ¨¡çš„å¢åŠ ï¼Œè¿ç»´è´Ÿæ‹…ä¹Ÿå¢åŠ ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œæ•°æ®åº“æˆ–æŒä¹…å­˜å‚¨ï¼ˆæ€»ä½“æ¥è¯´ï¼‰ä»¥æ”¯æŒè§„æ¨¡åŒ–å¹¶éæ˜“äº‹ã€‚å¦‚æœå¤±å»ä¸€è‡´æ€§ï¼Œæ¢å¤è¿‡ç¨‹æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºç°åœ¨æœ‰ä¸¤ä¸ªâ€œçœŸç›¸æºâ€ã€‚è®¸å¤šå¹³å°å®Œå…¨ç®¡ç† Kubernetes API æœåŠ¡å™¨åŠå…¶å­˜å‚¨ï¼Œä½† kv-store å¹¶ä¸æ˜¯å¦‚æ­¤ã€‚ç”±äºç»å¤§å¤šæ•°è´Ÿè½½æ˜¯è¯»å–æ“ä½œï¼Œç¼“å­˜å°†åœ¨å‡å°‘è¿ç»´å¤æ‚æ€§çš„åŒæ—¶äº§ç”Ÿç›¸åŒçš„æ”¹è¿›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-xds-æ”¹è¿›-cilium-çš„æ§åˆ¶å¹³é¢æ‰©å±•å®‰å…¨æ€§å’Œæ•ˆç‡&#34;&gt;ä½¿ç”¨ xDS æ”¹è¿› Cilium çš„æ§åˆ¶å¹³é¢æ‰©å±•ã€å®‰å…¨æ€§å’Œæ•ˆç‡&lt;/h2&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬å¯ä»¥å…¼é¡¾ä¸¤å…¨å‘¢ï¼Ÿæ—¢å‡è½» Kubernetes API æœåŠ¡å™¨çš„å‹åŠ›ï¼Œåˆæ¶ˆé™¤ç»´æŠ¤å•ç‹¬æ•°æ®å­˜å‚¨çš„æ˜‚è´µç”Ÿäº§æ“ä½œçš„éœ€è¦ï¼Ÿç”šè‡³å¯èƒ½è§£å†³ä¸€äº›å…¶ä»–å°šæœªè§£å†³çš„ Cilium æ‰©å±•å’Œå®‰å…¨æ€§é—®é¢˜ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åœ¨ Solo.ioï¼Œæˆ‘ä»¬å¾ˆé«˜å…´ä¸º Cilium ç¤¾åŒºä¸­æ›´å¹¿æ³›çš„ xDS å·¥ä½œä½œå‡ºè´¡çŒ®ï¼Œå¹¶å¸®åŠ©æ¨åŠ¨è¯¥é¡¹ç›®æœç€å¯æ‰©å±•ã€å®‰å…¨å’Œé«˜æ•ˆçš„æ§åˆ¶å¹³é¢è¿ˆè¿›ã€‚ä½¿ç”¨&lt;a href=&#34;https://github.com/cncf/xds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS åè®®&lt;/a&gt;ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨é›†ç¾¤ä¸­æ‰©å±•åˆ°æ•°åƒç”šè‡³æ•°ä¸‡ä¸ªèŠ‚ç‚¹ã€‚è¿™ç§æ–¹æ³•è§£å†³äº†ä¸Šé¢è®¨è®ºçš„è®¸å¤šé—®é¢˜ï¼Œä»¥åŠå…¶ä»–é—®é¢˜ï¼Œå¦‚å•èŠ‚ç‚¹å¦¥åå½±å“èŒƒå›´å’Œè§„æ¨¡ä¸Šçš„ CiliumIdentity é‡å¤ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/cncf/xds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS åè®®&lt;/a&gt;æœ€åˆæ˜¯ä¸€ç§åŠ¨æ€é…ç½®&lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy ä»£ç†&lt;/a&gt;çš„æ–¹å¼ï¼Œä½†æ˜¯å®ƒå»ºç«‹çš„ç†å¿µæ˜¯å¯ä»¥ç”¨æ¥æ”¯æŒâ€œé€šç”¨æ•°æ®å¹³é¢â€ã€‚è¯¥åè®®å·²æˆä¸ºåœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´åŒæ­¥çŠ¶æ€çš„æœ‰æ•ˆæ–¹å¼ï¼Œ&lt;a href=&#34;https://github.com/cncf/xds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç°åœ¨ç”± CNCF å·¥ä½œç»„ç®¡ç†&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆï¼Œæˆ‘ä»¬å¸Œæœ›æ¶ˆé™¤æ¯ä¸ª cilium-agent æ‰€åšçš„å†—ä½™å·¥ä½œï¼Œå°†è¯¸å¦‚æ ‡è¯†åˆ›å»ºä¹‹ç±»çš„å¤æ‚ä¸”æƒé™æ•æ„Ÿçš„æ“ä½œé›†ä¸­åœ¨ä¸€èµ·ï¼Œå¹¶ä»¥é«˜æ•ˆçš„æ–¹å¼ä¸ºä»£ç†æä¾›çŠ¶æ€ï¼ŒåŒæ—¶ä¸æŸå®³ Kubernetes ä½œä¸ºæ•´ä½“çš„å¯é æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä¸å†è®©æ¯ä¸ª cilium-agent å……å½“ç‹¬ç«‹çš„æ§åˆ¶å¹³é¢ï¼Œè€Œæ˜¯è€ƒè™‘è®© cilium-agent å……å½“æ™ºèƒ½é›†ä¸­æ§åˆ¶å¹³é¢çš„ç®€å•åªè¯»å®¢æˆ·ç«¯ã€‚æ§åˆ¶å¹³é¢å°†ä¿æŠ¤ä»£ç†å…å—å¤æ‚å’Œæƒé™æ•æ„Ÿçš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;cilium-agentï¼ˆç°åœ¨å±äºæ•°æ®å¹³é¢çš„ä¸€éƒ¨åˆ†ï¼‰ä¸æ§åˆ¶å¹³é¢ä¹‹é—´çš„é€šä¿¡å°†é‡‡ç”¨&lt;a href=&#34;https://github.com/cncf/xds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS åè®®&lt;/a&gt;ã€‚æ•°æ®å¹³é¢ä¸å…è®¸ä»æ•°æ®å¹³é¢åˆ°æ§åˆ¶å¹³é¢çš„å†™æ“ä½œï¼Œå› æ­¤ cilium-agent ä¸éœ€è¦å¯¹åç«¯å­˜å‚¨ï¼ˆCRD/kv-storeï¼‰å…·æœ‰å†™å…¥è®¿é—®æƒé™ã€‚xDS æ§åˆ¶å¹³é¢æœåŠ¡å¯ä»¥å¾—åˆ°å®‰å…¨åŠ å›ºï¼Œæ˜¯å”¯ä¸€éœ€è¦æ”¯æŒå¯¹ Kubernetes API æœåŠ¡å™¨è¿›è¡Œè¯»/å†™æ“ä½œçš„ç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-cilium-to-new-heights-with-xds/f6_hu_6cc3ad3bae15435.webp 400w,
               /blog/scaling-cilium-to-new-heights-with-xds/f6_hu_92ef934408073349.webp 760w,
               /blog/scaling-cilium-to-new-heights-with-xds/f6_hu_369497425203c15c.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-cilium-to-new-heights-with-xds/f6_hu_6cc3ad3bae15435.webp&#34;
               width=&#34;760&#34;
               height=&#34;562&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™ç§æ¶æ„å‡è½»äº† Kubernetes API æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œå¹¶ä¸”ä¸éœ€è¦ä»»ä½•å¤–éƒ¨ç®¡ç†çš„æ•°æ®å­˜å‚¨ã€‚å®ƒçœ‹èµ·æ¥ä¹Ÿæ›´æ¥è¿‘ä¹‹å‰è®¨è®ºçš„ä¸‰å±‚æ§åˆ¶å¹³é¢æ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-6xds-å®ç°çš„åˆå§‹æµ‹è¯•æ˜¾ç¤º-cpu-å’Œå†…å­˜ä½¿ç”¨çš„é¢„æœŸè¡Œä¸º&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 6ï¼šxDS å®ç°çš„åˆå§‹æµ‹è¯•æ˜¾ç¤º CPU å’Œå†…å­˜ä½¿ç”¨çš„é¢„æœŸè¡Œä¸º&#34; srcset=&#34;
               /blog/scaling-cilium-to-new-heights-with-xds/g6_hu_e99df57e8e3ee45f.webp 400w,
               /blog/scaling-cilium-to-new-heights-with-xds/g6_hu_dbae803dfca4755a.webp 760w,
               /blog/scaling-cilium-to-new-heights-with-xds/g6_hu_5bac9b62c0bdd4df.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-cilium-to-new-heights-with-xds/g6_hu_e99df57e8e3ee45f.webp&#34;
               width=&#34;760&#34;
               height=&#34;385&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 6ï¼šxDS å®ç°çš„åˆå§‹æµ‹è¯•æ˜¾ç¤º CPU å’Œå†…å­˜ä½¿ç”¨çš„é¢„æœŸè¡Œä¸º
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç§æ¶æ„ä¸­ï¼Œæˆ‘ä»¬ç¡®å®çœ‹åˆ°äº† xDS æ§åˆ¶å¹³é¢ pods ä¸­çš„ CPU å’Œå†…å­˜å¼€é”€ï¼Œæ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»ç„¶éœ€è¦å¤„ç† eBPF æ•°æ®å¹³é¢çš„ä¸€äº› CPU/å†…å­˜å¤„ç†å¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æ¨¡å‹å¸¦æ¥çš„å…¶ä»–å¥½å¤„åŒ…æ‹¬åœ¨èŠ‚ç‚¹å—æŸæ—¶æ›´å°çš„å½±å“èŒƒå›´ï¼Œä»¥åŠæ¶ˆé™¤äº† cilium-agent åˆ›å»ºçš„é‡å¤æ ‡è¯†ã€‚åœ¨åŸå§‹æ¶æ„ï¼ˆCRD æˆ– kv-storeï¼‰ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªå®Œæ•´çš„æ§åˆ¶å¹³é¢ï¼Œéœ€è¦ç‰¹æ®Šæƒé™æ¥è¯»å–å’Œå†™å…¥&lt;code&gt;CiliumEndpoints&lt;/code&gt;å’Œ&lt;code&gt;CiliumIdentity&lt;/code&gt;ã€‚å¦‚æœæŸä¸ªèŠ‚ç‚¹ä¸Šçš„ cilium-agent å—åˆ°å¦¥åï¼Œé‚£ä¹ˆæ•´ä¸ªæ§åˆ¶å¹³é¢å°†å—åˆ°å¨èƒï¼Œå¹¶ä½¿æ”»å‡»è€…èƒ½å¤Ÿå½±å“å…¶ä»–èŠ‚ç‚¹ã€‚è¿™å¯èƒ½å¯¼è‡´æ•´ä¸ªé›†ç¾¤å¦¥åã€‚åœ¨ xDS æ¨¡å‹ä¸­ï¼Œcilium-agent è¢«å…è®¸ä»æ§åˆ¶å¹³é¢è¯»å–æ•°æ®ï¼ˆä¸å…è®¸å†™å…¥ï¼‰ï¼Œå•ä¸ª cilium-agent çš„å¦¥åä¸ä¼šç»™äºˆå¯¹æ•´ä¸ªæ§åˆ¶å¹³é¢æˆ–é›†ç¾¤çš„è®¿é—®æƒé™ã€‚æ­£å¦‚å‰é¢æåˆ°çš„ï¼ŒxDS æ§åˆ¶å¹³é¢è¢«è§†ä¸ºç‰¹æƒç»„ä»¶ï¼Œå¯ä»¥è¿›è¡Œé”å®šå’Œå®‰å…¨è®¾ç½®ï¼Œç”šè‡³å¯ä»¥å®Œå…¨åœ¨é›†ç¾¤ä¹‹å¤–è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;xDS æ–¹æ³•çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯é€šè¿‡é›†ä¸­æ ‡è¯†åˆ›å»ºæ¥æ¶ˆé™¤ Cilium ä¸­é‡å¤æ ‡è¯†çš„ç”Ÿæˆã€‚åœ¨ç°æœ‰æ¨¡å‹ä¸­ï¼Œæ¯ä¸ª cilium-agent éƒ½ç‹¬ç«‹å……å½“æ§åˆ¶å¹³é¢ï¼Œä¸å…¶ä»–èŠ‚ç‚¹éš”ç¦»ï¼Œæ­£å¦‚åœ¨ç°æœ‰æ¨¡å‹ä¸­ï¼Œå®ƒè¯•å›¾åšå‡ºå¯èƒ½æ˜¯é‡å¤çš„å†³ç­–ã€‚ä¾‹å¦‚ï¼Œå½“ Pod åˆ†é…åˆ°èŠ‚ç‚¹æ—¶ï¼ŒCNI è´Ÿè´£è®¾ç½®ç½‘ç»œç«¯ç‚¹ï¼Œå½“ cilium-agent è¯†åˆ«åˆ°ä¸€ä¸ªæ–°çš„ç«¯ç‚¹ï¼Œå®ƒæ²¡æœ‰ç°æœ‰çš„&lt;code&gt;CiliumIdentity&lt;/code&gt;æ—¶ï¼Œå®ƒå°†å°è¯•åˆ›å»ºå®ƒã€‚å¦‚æœå‘½åç©ºé—´æ ‡ç­¾å‘ç”Ÿæ›´æ”¹å¹¶ä¸”éœ€è¦é‡æ–°è®¡ç®—æ‰€æœ‰æ ‡è¯†ï¼Œé‚£ä¹ˆä¹Ÿä¼šå‘ç”Ÿç›¸åŒçš„æƒ…å†µã€‚ç”±äºæ ‡è¯†åˆ›å»ºåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šç‹¬ç«‹è¿›è¡Œï¼Œå› æ­¤æœ‰å¾ˆå¤§æœºä¼šä¸ºç›¸åŒæ ‡è¯†åˆ›å»ºå¤šä¸ª&lt;code&gt;CiliumIdentity&lt;/code&gt;ï¼ˆåœ¨æç«¯æƒ…å†µä¸‹ï¼Œ&lt;a href=&#34;https://docs.google.com/document/d/1Hcc_2mB9OOUxrqQgZ-gSYDPnLYE_If_TCzVbUGDOdGM/edit?pli=1#heading=h.yzvq0akbw7z9&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚æ­¤æè¿°çš„æ˜“äºé‡ç°&lt;/a&gt;ï¼‰ã€‚åœ¨ xDS æ–¹æ³•ä¸­ï¼Œ&lt;code&gt;CiliumIdentity&lt;/code&gt;åœ¨é›†ä¸­åˆ›å»ºï¼Œä»è€Œæ¶ˆé™¤äº†è¿™ç§æƒ…å†µã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;Cilium åœ¨ eBPF åŸºç¡€ä¸Šæ„å»ºäº†å¼ºå¤§çš„æ•°æ®å¹³é¢ï¼Œä½†è¦ä½¿ Cilium åœ¨è§„æ¨¡ä¸Šæœ‰æ•ˆè¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ xDS åè®®æ¥æ”¹è¿›æ§åˆ¶å¹³é¢æ¶æ„ã€‚xDS æ˜¯ä¸€ç§é«˜æ•ˆçš„åè®®ï¼Œå…è®¸æˆ‘ä»¬åˆ©ç”¨å¤šå¹´æ¥å­¦åˆ°çš„æ„å»ºæ§åˆ¶å¹³é¢çš„æœ€ä½³å®è·µã€‚äº‹å®ä¸Šï¼Œå¦‚æœæˆ‘ä»¬å°† xDS æ§åˆ¶å¹³é¢ &lt;a href=&#34;https://docs.google.com/document/d/1U4pO_dTaHERKOtrneNA8njW19HSVbq3sBM3x8an4878/edit#heading=h.ghzkbpzc9oea&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç›´æ¥æ„å»ºåˆ° cilium-operator ä¸­&lt;/a&gt;ï¼Œé‚£ä¹ˆä»è¿™ä¸ªå®æ–½ä¸­ä¸ä¼šå¢åŠ æ–°çš„å¤æ‚æ€§ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>DoorDash çš„æœåŠ¡ç½‘æ ¼ä¹‹æ—…ï¼šå¦‚ä½•å®ç°é«˜æ•ˆçš„åŒºåŸŸæ„ŸçŸ¥è·¯ç”±</title>
      <link>https://cloudnativecn.com/blog/doordash-service-mesh/</link>
      <pubDate>Thu, 18 Jan 2024 21:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/doordash-service-mesh/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://doordash.engineering/2024/01/16/staying-in-the-zone-how-doordash-used-a-service-mesh-to-manage-data-transfer-reducing-hops-and-cloud-spend/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Staying in the Zone: How DoorDash used a service mesh to manage data transfer, reducing hops and cloud spend&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‘˜è¦ï¼šæœ¬æ–‡ä»‹ç»äº† DoorDash å¦‚ä½•ä½¿ç”¨æœåŠ¡ç½‘æ ¼æ¥ä¼˜åŒ–å…¶è·¨å¯ç”¨åŒºçš„æ•°æ®ä¼ è¾“ï¼Œé™ä½æˆæœ¬å’Œå»¶è¿Ÿã€‚ä½œè€…åˆ†äº«äº†ä»–ä»¬çš„æµé‡æ¶æ„ã€é—®é¢˜åˆ†æå’Œè§£å†³æ–¹æ¡ˆè®¾è®¡ï¼Œä»¥åŠä½¿ç”¨ Envoy å’Œ Istio å®ç°åŒºåŸŸæ„ŸçŸ¥è·¯ç”±çš„è¿‡ç¨‹å’Œæ•ˆæœã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;DoorDash ä»å•ä½“åº”ç”¨æ¶æ„æ¼”å˜ä¸ºåŸºäº&lt;a href=&#34;https://www.youtube.com/watch?v=ReRrhU-yRjg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å•å…ƒï¼ˆcellsï¼‰&lt;/a&gt;å’Œ&lt;a href=&#34;https://doordash.engineering/2020/12/02/how-doordash-transitioned-from-a-monolith-to-microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¾®æœåŠ¡ï¼ˆmicroservicesï¼‰&lt;/a&gt;æ¶æ„åï¼Œè·å¾—äº†è®¸å¤šå¥½å¤„ã€‚æ–°çš„æ¶æ„é™ä½äº†å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²æ‰€éœ€çš„æ—¶é—´ï¼ŒåŒæ—¶æé«˜äº†å¯ä¼¸ç¼©æ€§å’Œç”¨æˆ·ä½“éªŒï¼ŒåŒ…æ‹¬å•†å®¶ã€é€é¤å‘˜å’Œæ¶ˆè´¹è€…ã€‚ç„¶è€Œï¼Œéšç€å¾®æœåŠ¡å’Œåç«¯æ•°é‡çš„å¢åŠ ï¼ŒDoorDash æ³¨æ„åˆ°äº†è·¨å¯ç”¨åŒºï¼ˆAZï¼‰çš„æ•°æ®ä¼ è¾“æˆæœ¬ä¸Šå‡ã€‚è¿™äº›æ•°æ®ä¼ è¾“æˆæœ¬ â€” &lt;a href=&#34;https://aws.amazon.com/blogs/architecture/overview-of-data-transfer-costs-for-common-architectures/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨å‘é€å’Œæ¥æ”¶æ—¶å‘ç”Ÿ&lt;/a&gt; â€” å…è®¸ DoorDash ä¸ºå…¶æœ€ç»ˆç”¨æˆ·æä¾›é«˜å¯ç”¨æ€§çš„æœåŠ¡ï¼Œå¯ä»¥æŠµå¾¡ä¸€ä¸ªæˆ–å¤šä¸ª AZ çš„é™çº§ã€‚&lt;/p&gt;
&lt;p&gt;æˆæœ¬ä¸Šå‡ä¿ƒä½¿æˆ‘ä»¬çš„å·¥ç¨‹å›¢é˜Ÿè°ƒæŸ¥äº†ä»¥æ›´é«˜æ•ˆçš„æ–¹å¼æä¾›ç›¸åŒçº§åˆ«çš„æœåŠ¡çš„æ›¿ä»£æ–¹æ³•ã€‚åœ¨æœ¬åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æè¿°äº† DoorDash ä½¿ç”¨æœåŠ¡ç½‘æ ¼å®ç°æ•°æ®ä¼ è¾“æˆæœ¬èŠ‚çœè€Œä¸ç‰ºç‰²æœåŠ¡è´¨é‡çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;doordash-æµé‡æ¶æ„&#34;&gt;DoorDash æµé‡æ¶æ„&lt;/h2&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬æ·±å…¥è§£å†³æ–¹æ¡ˆä¹‹å‰ï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ DoorDash çš„æµé‡åŸºç¡€è®¾æ–½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;åŸºäºå•å…ƒçš„æ¶æ„ï¼š&lt;/em&gt; å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬çš„æµé‡æ¶æ„éµå¾ª&lt;a href=&#34;https://www.youtube.com/watch?v=ReRrhU-yRjg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸºäºå•å…ƒçš„è®¾è®¡&lt;/a&gt;ã€‚æ‰€æœ‰å¾®æœåŠ¡ Pod éƒ½éƒ¨ç½²åœ¨å¤šä¸ªéš”ç¦»çš„å•å…ƒä¸­ã€‚æ¯ä¸ªæœåŠ¡åœ¨æ¯ä¸ªå•å…ƒä¸­éƒ½æœ‰ä¸€ä¸ª Kubernetes éƒ¨ç½²ã€‚ä¸ºäº†ç¡®ä¿å•å…ƒä¹‹é—´çš„éš”ç¦»ï¼Œä¸å…è®¸å•å…ƒé—´çš„æµé‡ã€‚è¿™ç§æ–¹æ³•ä½¿æˆ‘ä»¬èƒ½å¤Ÿå‡å°å•ä¸ªå•å…ƒæ•…éšœçš„å½±å“èŒƒå›´ã€‚å¯¹äºå•ä¾‹æœåŠ¡æˆ–å°šæœªè¿ç§»åˆ°å•å…ƒæ¶æ„çš„æœåŠ¡ï¼Œéƒ¨ç½²åœ¨ä¸€ä¸ªå…¨å±€å•å…ƒä¸­ã€‚å†…éƒ¨çš„&lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;è·¯ç”±å™¨å…è®¸å…¨å±€å•å…ƒä¸å¤åˆ¶çš„å•å…ƒä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Kubernetes é›†ç¾¤éƒ¨ç½²ï¼š&lt;/em&gt; æ¯ä¸ªå•å…ƒç”±å¤šä¸ª Kubernetes é›†ç¾¤ç»„æˆï¼›æ¯ä¸ªå¾®æœåŠ¡éƒ½ä¸“é—¨éƒ¨ç½²åœ¨ç»™å®šå•å…ƒå†…çš„ä¸€ä¸ªé›†ç¾¤ä¸­ã€‚è¿™ä¸ªè®¾è®¡ç¡®ä¿äº†å¯ä¼¸ç¼©æ€§å’Œå¯é æ€§ï¼ŒåŒæ—¶ä¸æˆ‘ä»¬çš„åŸºäºå•å…ƒçš„æ¶æ„ä¿æŒä¸€è‡´ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-1åŸºäºå•å…ƒçš„å¤šé›†ç¾¤éƒ¨ç½²&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1ï¼šåŸºäºå•å…ƒçš„å¤šé›†ç¾¤éƒ¨ç½²&#34; srcset=&#34;
               /blog/doordash-service-mesh/f1_hu_7361b02053de74ce.webp 400w,
               /blog/doordash-service-mesh/f1_hu_1f5d79a2a6cfc04b.webp 760w,
               /blog/doordash-service-mesh/f1_hu_a61a6ef44507e357.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/doordash-service-mesh/f1_hu_7361b02053de74ce.webp&#34;
               width=&#34;760&#34;
               height=&#34;357&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1ï¼šåŸºäºå•å…ƒçš„å¤šé›†ç¾¤éƒ¨ç½²
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;em&gt;é«˜å¯ç”¨æ€§ï¼š&lt;/em&gt; ä¸ºäº†å¢å¼ºå¯ç”¨æ€§å’Œå®¹é”™æ€§ï¼Œæ¯ä¸ª Kubernetes é›†ç¾¤éƒ½éƒ¨ç½²åœ¨å¤šä¸ª AZ ä¸­ã€‚è¿™ä¸ªåšæ³•æœ€å¤§ç¨‹åº¦åœ°å‡å°‘äº†ç”±äºä¸€ä¸ªæˆ–å¤šä¸ª AZ ä¸­æ–­å¼•èµ·çš„ä¸­æ–­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å¹³é¢ç½‘ç»œä¸­çš„ç›´æ¥é€šä¿¡ï¼š&lt;/em&gt; åˆ©ç”¨&lt;a href=&#34;https://github.com/aws/amazon-vpc-cni-k8s&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS-CNI&lt;/a&gt;ï¼Œåœ¨ä¸€ä¸ªå•å…ƒä¸­çš„ä¸åŒé›†ç¾¤ä¸­çš„å¾®æœåŠ¡ Pod å¯ä»¥ç›´æ¥é€šä¿¡ã€‚è¿™ç§å¹³é¢ç½‘ç»œæ¶æ„ç®€åŒ–äº†é€šä¿¡è·¯å¾„ï¼Œä¿ƒè¿›äº†å¾®æœåŠ¡ä¹‹é—´çš„é«˜æ•ˆäº¤äº’ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;è‡ªå®šä¹‰å¤šé›†ç¾¤æœåŠ¡å‘ç°ï¼š&lt;/em&gt; æˆ‘ä»¬çš„è‡ªå®šä¹‰æœåŠ¡å‘ç°è§£å†³æ–¹æ¡ˆï¼ŒDoorDash æ•°æ®ä¸­å¿ƒæœåŠ¡å‘ç°ï¼ˆDDSDï¼‰ï¼Œæä¾›äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ DNS åŸŸï¼Œä»¥æ”¯æŒå¤šé›†ç¾¤é€šä¿¡ã€‚å®¢æˆ·ç«¯ä½¿ç”¨ DNS åç§°åŠ¨æ€å‘ç°æ‰€éœ€æœåŠ¡çš„æ‰€æœ‰ Pod IP åœ°å€ã€‚DDSD çš„åŠŸèƒ½ç±»ä¼¼äº Kubernetes çš„&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/service/#headless-services&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ— å¤´æœåŠ¡&lt;/a&gt;ï¼Œä½†å®ƒä¹Ÿé€‚ç”¨äºé›†ç¾¤é—´é€šä¿¡ã€‚ä¾‹å¦‚ï¼Œä¸åŒé›†ç¾¤ä¸­çš„å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨&lt;em&gt;payment-service.service.prod.ddsd&lt;/em&gt;æ¥æ£€ç´¢ä¸æ”¯ä»˜æœåŠ¡ç›¸å…³è”çš„æ‰€æœ‰ Pod IP åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å®¢æˆ·ç«¯è´Ÿè½½å¹³è¡¡ï¼š&lt;/em&gt; æœåŠ¡ç½‘æ ¼è´Ÿè´£å®¢æˆ·ç«¯è´Ÿè½½å¹³è¡¡ã€‚å¯¹äºæœªåŠ å…¥æœåŠ¡ç½‘æ ¼çš„æœåŠ¡ï¼Œè´Ÿè½½å¹³è¡¡å‘ç”Ÿåœ¨å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºç«¯ã€‚&lt;/p&gt;
&lt;p&gt;å›¾ 2 æè¿°äº†ä¸Šè¿°å››ä¸ªç‰¹å¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-2å•å…ƒå†…å’Œè·¨-az-é€šä¿¡æ¨¡å¼&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 2ï¼šå•å…ƒå†…å’Œè·¨ AZ é€šä¿¡æ¨¡å¼&#34; srcset=&#34;
               /blog/doordash-service-mesh/f2_hu_271a0c476868729e.webp 400w,
               /blog/doordash-service-mesh/f2_hu_72c7d1ca69649423.webp 760w,
               /blog/doordash-service-mesh/f2_hu_8e7b60b2095429d1.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/doordash-service-mesh/f2_hu_271a0c476868729e.webp&#34;
               width=&#34;760&#34;
               height=&#34;423&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 2ï¼šå•å…ƒå†…å’Œè·¨ AZ é€šä¿¡æ¨¡å¼
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;em&gt;æœåŠ¡ç½‘æ ¼æ¶æ„ï¼š&lt;/em&gt; å¦‚å›¾ 3 æ‰€ç¤ºï¼ŒDoorDash çš„æœåŠ¡ç½‘æ ¼éƒ¨ç½²åœ¨æ¯ä¸ªå•å…ƒä¸­ï¼Œé‡‡ç”¨äº†ä¸€ç§è¾¹è½¦å®¹å™¨è®¾è®¡æ¨¡å¼ï¼Œåˆ©ç”¨&lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;ä»£ç†ä½œä¸ºæ•°æ®å¹³é¢ã€‚æˆ‘ä»¬å»ºç«‹äº†æˆ‘ä»¬è‡ªå·±çš„åŸºäº&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-docs/xds_protocol&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS çš„&lt;/a&gt;æ§åˆ¶å¹³é¢æ¥ç®¡ç† Envoy é…ç½®ã€‚è¾¹è½¦å®¹å™¨ä½œä¸ºä¸€ç§å³æ’å³ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨ä¸éœ€è¦å¯¹åº”ç”¨ç¨‹åºä»£ç è¿›è¡Œä»»ä½•ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œæ— ç¼åœ°æ‹¦æˆªã€æ§åˆ¶å’Œè½¬æ¢è¿›å‡º DoorDash å¾®æœåŠ¡çš„æ‰€æœ‰ HTTP1/HTTP2/gRPC æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-3æœåŠ¡ç½‘æ ¼é«˜çº§æ¶æ„&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 3ï¼šæœåŠ¡ç½‘æ ¼é«˜çº§æ¶æ„&#34; srcset=&#34;
               /blog/doordash-service-mesh/f3_hu_96d0c2559fafb88.webp 400w,
               /blog/doordash-service-mesh/f3_hu_3c722e488a4785bc.webp 760w,
               /blog/doordash-service-mesh/f3_hu_7752c9f527edb73e.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/doordash-service-mesh/f3_hu_96d0c2559fafb88.webp&#34;
               width=&#34;760&#34;
               height=&#34;422&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 3ï¼šæœåŠ¡ç½‘æ ¼é«˜çº§æ¶æ„
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è™½ç„¶ DoorDash çš„æµé‡æ¶æ„å…·æœ‰ç‹¬ç‰¹çš„ç»„ä»¶ï¼Œä½†æˆ‘ä»¬è®¤ä¸ºæˆ‘ä»¬åœ¨ç½‘ç»œæµé‡æ•ˆç‡æ–¹é¢é‡åˆ°çš„æŒ‘æˆ˜å’Œç»éªŒå¯ä»¥å¹¿æ³›åº”ç”¨äºå…¶ä»–æ¶æ„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;doordash-çš„å¸¸è§æ•°æ®ä¼ è¾“æ¨¡å¼&#34;&gt;DoorDash çš„å¸¸è§æ•°æ®ä¼ è¾“æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;å¯¹äºè·¨å¯ç”¨åŒºçš„æµé‡ï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬çš„æµé‡æ¨¡å¼åˆ†ç±»å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;em&gt;HTTP1/HTTP2/gRPCæµé‡ï¼š&lt;/em&gt; åœ¨åŒä¸€å•å…ƒå†…çš„å¾®æœåŠ¡ä¹‹é—´è¿›è¡Œç›´æ¥çš„ Pod åˆ° Pod é€šä¿¡ï¼›åœ¨å…¨å±€å•å…ƒä¸­çš„å¾®æœåŠ¡ä¸æ¶‰åŠåˆ°è°ƒç”¨è·¯å¾„ä¸­çš„é¢å¤–è·ƒç‚¹çš„å•å…ƒä¹‹é—´çš„æµé‡ â€” ä¾‹å¦‚å†…éƒ¨è·¯ç”±å™¨ â€” å¢åŠ äº†è·¨å¯ç”¨åŒºæµé‡çš„å¯èƒ½æ€§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å­˜å‚¨æµé‡ï¼š&lt;/em&gt; åŒ…æ‹¬æ¥è‡ªå¾®æœåŠ¡åˆ°æœ‰çŠ¶æ€ç³»ç»Ÿï¼ˆå¦‚ Aurora PostgreSQLã€CockroachDBã€Redis å’Œ Kafkaï¼‰çš„æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å†…éƒ¨åŸºç¡€è®¾æ–½æµé‡ï¼š&lt;/em&gt; å†…éƒ¨ Kubernetes æµé‡ï¼Œä¾‹å¦‚&lt;a href=&#34;https://github.com/coredns/coredns&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;coredns&lt;/a&gt;æµé‡æˆ–&lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/components/#control-plane-components&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes æ§åˆ¶å¹³é¢ç»„ä»¶&lt;/a&gt;ä¹‹é—´çš„é€šä¿¡ã€‚è¿™ç§ç±»å‹çš„æµé‡é€šå¸¸ä½¿ç”¨ Kubernetes å†…éƒ¨ DNS è€Œä¸æ˜¯ DDSDã€‚&lt;/p&gt;
&lt;h2 id=&#34;åˆæ­¥å‡è®¾&#34;&gt;åˆæ­¥å‡è®¾&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬è®¤ä¸ºï¼Œç”±äºæˆ‘ä»¬çš„å¾®æœåŠ¡æ¶æ„ï¼ŒåŒä¸€å•å…ƒå†…çš„ HTTP1/HTTP2/gRPC æµé‡æ˜¯è·¨å¯ç”¨åŒºæ•°æ®ä¼ è¾“æˆæœ¬çš„æœ€å¤§æ¥æºã€‚æˆ‘ä»¬è¿˜ç¡®å®šæœåŠ¡ç½‘æ ¼å¯èƒ½é€šè¿‡&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/zone_aware&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy ä¸­çš„è¯¥åŠŸèƒ½&lt;/a&gt;å®ç°æ‰€æœ‰å¾®æœåŠ¡çš„åŒºåŸŸæ„ŸçŸ¥è·¯ç”±ã€‚äº†è§£äº†è¿™ä¸¤ç‚¹åï¼Œæˆ‘ä»¬ä¼˜å…ˆç ”ç©¶å’Œä¼˜åŒ– HTTP1/HTTP2/gRPC æµé‡æ¨¡å¼ï¼Œä»¥æé«˜æ•ˆç‡è€Œä¸é™ä½æœåŠ¡è´¨é‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è§£å†³-http1http2grpc-æµé‡æˆæœ¬é—®é¢˜&#34;&gt;è§£å†³ HTTP1/HTTP2/gRPC æµé‡æˆæœ¬é—®é¢˜&lt;/h2&gt;
&lt;p&gt;æœ€åˆï¼ŒæœåŠ¡ä¹‹é—´çš„æµé‡åœ¨ä¸åŒçš„ AZ ä¹‹é—´å‡åŒ€åˆ†å¸ƒï¼Œå¦‚å›¾ 4 æ‰€ç¤ºã€‚æœ‰äº† Envoy çš„åŒºåŸŸæ„ŸçŸ¥è·¯ç”±åŠŸèƒ½ï¼Œè°ƒç”¨è€…æœåŠ¡ç°åœ¨æ›´å€¾å‘äºå°†æµé‡å¼•å¯¼åˆ°åŒä¸€ AZ ä¸­çš„è¢«è°ƒç”¨è€…æœåŠ¡ï¼Œå¦‚å›¾ 5 æ‰€ç¤ºï¼Œä»è€Œé™ä½äº†è·¨å¯ç”¨åŒºçš„æ•°æ®ä¼ è¾“æˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-4pod-ä¹‹é—´çš„ç®€å•è½®è¯¢è´Ÿè½½å¹³è¡¡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 4ï¼šPod ä¹‹é—´çš„ç®€å•è½®è¯¢è´Ÿè½½å¹³è¡¡&#34; srcset=&#34;
               /blog/doordash-service-mesh/f4_hu_62bca28424b495ca.webp 400w,
               /blog/doordash-service-mesh/f4_hu_41fa77e083c3ac1c.webp 760w,
               /blog/doordash-service-mesh/f4_hu_be2c467afc42d104.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/doordash-service-mesh/f4_hu_62bca28424b495ca.webp&#34;
               width=&#34;760&#34;
               height=&#34;419&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 4ï¼šPod ä¹‹é—´çš„ç®€å•è½®è¯¢è´Ÿè½½å¹³è¡¡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-5åŒºåŸŸæ„ŸçŸ¥è·¯ç”±&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 5ï¼šåŒºåŸŸæ„ŸçŸ¥è·¯ç”±&#34; srcset=&#34;
               /blog/doordash-service-mesh/f5_hu_df21298460287905.webp 400w,
               /blog/doordash-service-mesh/f5_hu_e531e6211cbfa86b.webp 760w,
               /blog/doordash-service-mesh/f5_hu_7396972da72907d0.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/doordash-service-mesh/f5_hu_df21298460287905.webp&#34;
               width=&#34;760&#34;
               height=&#34;425&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 5ï¼šåŒºåŸŸæ„ŸçŸ¥è·¯ç”±
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¯ç”¨ Envoy çš„åŒºåŸŸæ„ŸçŸ¥è·¯ç”±åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡ç½‘æ ¼çš„æ§åˆ¶å¹³é¢ä¸­è¿›è¡Œäº†æ›´æ”¹ï¼Œå°†æœåŠ¡å‘ç°ç±»å‹ä»&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/service_discovery#strict-dns&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;STRICT_DNS&lt;/a&gt;åˆ‡æ¢åˆ°ç»ˆç«¯å‘ç°æœåŠ¡ï¼ˆ&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/service_discovery#endpoint-discovery-service-eds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EDS&lt;/a&gt;ï¼‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯¹äº DDSD åŸŸï¼Œæ§åˆ¶å¹³é¢ç°åœ¨ä¼šåŠ¨æ€åœ°å°†æ¥è‡ªæ¯ä¸ª Envoy é›†ç¾¤çš„ EDS èµ„æºå‘é€å› Envoy è¾¹è½¦å®¹å™¨ã€‚EDS èµ„æºåŒ…æ‹¬ Pod IP åœ°å€åŠå…¶ AZ ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.config.endpoint.v3.ClusterLoadAssignment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;payment-service.service.prod.ddsd&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;endpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;locality&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;zone&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;us-west-2a&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_endpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;               &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                 &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1.1.1.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                 &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;locality&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;zone&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;us-west-2b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_endpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;               &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                 &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2.2.2.2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                 &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;locality&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;zone&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;us-west-2c&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_endpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;               &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                 &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3.3.3.3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                 &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;em&gt;å›¾ 6ï¼šä¸€ä¸ª EDS å“åº”çš„ç¤ºä¾‹&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ EDS å“åº”ä¸­æä¾›çš„æ•°æ®ï¼ŒEnvoy è·å–äº†è°ƒç”¨è€…æœåŠ¡å’Œè¢«è°ƒç”¨è€…æœåŠ¡çš„ AZ åˆ†å¸ƒã€‚è¿™äº›ä¿¡æ¯ä½¿ Envoy èƒ½å¤Ÿ&lt;a href=&#34;https://github.com/envoyproxy/envoy/blob/v1.28.0/source/common/upstream/load_balancer_impl.cc#L520&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¡ç®—&lt;/a&gt;Pod ä¹‹é—´çš„æƒé‡ã€‚å°½ç®¡ä»ç„¶ä¼˜å…ˆé€šè¿‡æœ¬&lt;/p&gt;
&lt;p&gt;åœ° AZ å‘é€æµé‡ï¼Œä½†ä¸ºäº†ç¡®ä¿å‡è¡¡åˆ†å¸ƒå¹¶é¿å…è¿‡è½½ä»»ä½•å•ä¸ª Podï¼Œä¸€äº›æµé‡å¯èƒ½ä»ç„¶ä¼šå¼•å¯¼åˆ°è·¨è¶Š AZï¼Œå¦‚å›¾ 7 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-7ä¼˜å…ˆä½¿ç”¨æœ¬åœ°-azåŒæ—¶ç¡®ä¿æµé‡å‡è¡¡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 7ï¼šä¼˜å…ˆä½¿ç”¨æœ¬åœ° AZï¼ŒåŒæ—¶ç¡®ä¿æµé‡å‡è¡¡&#34; srcset=&#34;
               /blog/doordash-service-mesh/f7_hu_6462866559663a13.webp 400w,
               /blog/doordash-service-mesh/f7_hu_94fe50c553f170cb.webp 760w,
               /blog/doordash-service-mesh/f7_hu_c231cda2f5e610d5.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/doordash-service-mesh/f7_hu_6462866559663a13.webp&#34;
               width=&#34;760&#34;
               height=&#34;422&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 7ï¼šä¼˜å…ˆä½¿ç”¨æœ¬åœ° AZï¼ŒåŒæ—¶ç¡®ä¿æµé‡å‡è¡¡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™ç§è·¯ç”±è§£å†³æ–¹æ¡ˆå…·æœ‰å¤šç§å¥½å¤„ï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æœåŠ¡ä¸å‡åŒ€åˆ†å¸ƒåœ¨ä¸åŒ AZ çš„æƒ…å†µä¸‹ä»ç„¶ä¿æŒæµé‡å¹³è¡¡&lt;/li&gt;
&lt;li&gt;å¯ä»¥åŠ¨æ€è®¾ç½® Pod ä¹‹é—´çš„æµé‡æƒé‡ï¼Œæ¶ˆé™¤æ‰‹åŠ¨æ“ä½œ&lt;/li&gt;
&lt;li&gt;å‡å°‘å•ä¸ªæˆ–å¤šä¸ª AZ ä¸­æ–­çš„å½±å“èŒƒå›´&lt;/li&gt;
&lt;li&gt;å‡å°‘æµé‡å»¶è¿Ÿ â€” è°ƒç”¨è€…æœåŠ¡è¿æ¥åˆ°æ›´è¿‘çš„è¢«è°ƒç”¨è€…æœåŠ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆåœ¨æœåŠ¡ Pod å‡åŒ€éƒ¨ç½²åœ¨å¯ç”¨åŒºæ—¶å˜å¾—æ›´åŠ æœ‰æ•ˆã€‚ä¸ºå®ç°è¿™ä¸€ç›®æ ‡ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†&lt;a href=&#34;https://kubernetes.io/docs/concepts/scheduling-eviction/topology-spread-constraints/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;topologySpreadConstraints&lt;/a&gt;ï¼Œå¹¶å°†&lt;a href=&#34;https://kubernetes.io/docs/concepts/scheduling-eviction/topology-spread-constraints/#spread-constraint-definition&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;maxSkew&lt;/a&gt;è®¾ç½®ä¸º 1ï¼Œå½“ Unsatisfiable æ—¶è®¾ç½®ä¸º ScheduleAnywayï¼Œå¦‚å›¾ 8 æ‰€ç¤ºã€‚è¿™æ„å‘³ç€ Kubernetes è°ƒåº¦å™¨å°†ä»ç„¶è°ƒåº¦ Podï¼Œå³ä½¿æ¡ä»¶æœªæ»¡è¶³ï¼Œä¼˜å…ˆé€‰æ‹©æœ€å°åŒ–åå·®çš„èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹æ³•ç¡®ä¿äº† Pod ä»ç„¶è¢«è°ƒåº¦ï¼›å¦åˆ™å°†ä¼šå‡å°‘è£…ç®±é‡ï¼Œå¢åŠ ç©ºé—²è®¡ç®—é‡ï¼Œå¹¶æœ€ç»ˆå½±å“äº†åŒºåŸŸæ„ŸçŸ¥çš„ä¸æµé‡ç›¸å…³çš„æˆæœ¬å‡å°‘ã€‚åœ¨æˆ‘ä»¬çš„ç”Ÿäº§ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°æœ‰ 10% çš„æµé‡æ˜¯æ ¹æ®è¿™ä¸ª topologySpreadConstraints ç­–ç•¥è·¨å¯ç”¨åŒºå‘é€çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;topologySpreadConstraints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;maxSkew&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;topologyKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;topology.kubernetes.io/zone&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;whenUnsatisfiable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ScheduleAnyway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;em&gt;å›¾ 8ï¼šé…ç½®ä»¥å‡åŒ€éƒ¨ç½² Pod åœ¨å¯ç”¨åŒºä¹‹é—´&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;éšç€æˆ‘ä»¬é€æ¸æ¨å‡ºä¸Šè¿°æ›´æ”¹ï¼Œæˆ‘ä»¬çœ‹åˆ°äº† AWS è·¨å¯ç”¨åŒºä¼ è¾“è´¹ç”¨çš„æ”¹è¿›ã€‚å³ä¾¿å¦‚æ­¤ï¼Œæˆ‘ä»¬é¢„æœŸçš„å‡å°‘è¦æ›´å¤§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ç€æ‰‹è°ƒæŸ¥ä¸ºä»€ä¹ˆæˆ‘ä»¬æ²¡æœ‰èŠ‚çœå¤šå°‘é¢„æœŸçš„è´¹ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¤§æµ·æé’ˆæ›´å¥½åœ°äº†è§£è·¨å¯ç”¨åŒºçš„æµé‡&#34;&gt;å¤§æµ·æé’ˆï¼šæ›´å¥½åœ°äº†è§£è·¨å¯ç”¨åŒºçš„æµé‡&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬é€šè¿‡éªŒè¯&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/upstream/cluster_manager/cluster_stats#config-cluster-manager-cluster-per-az-stats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy åœ¨å¯ç”¨åŒºä¹‹é—´çš„æŒ‡æ ‡&lt;/a&gt;å’Œåº”ç”¨ç¨‹åºæ—¥å¿—ï¼Œç¡®è®¤äº†åŒºåŸŸæ„ŸçŸ¥è·¯ç”±æ­£åœ¨æŒ‰é¢„æœŸå·¥ä½œï¼Œä½†æˆ‘ä»¬éœ€è¦æ›´å¤šçš„å¯è§æ€§æ¥ç¡®å®šæ•°æ®ä¼ è¾“æˆæœ¬é™ä½çš„æ ¹æœ¬åŸå› ä½äºé¢„æœŸã€‚è¿™ä¿ƒä½¿æˆ‘ä»¬ä½¿ç”¨äº†å¤šç§å¯è§‚å¯Ÿæ€§å·¥å…·ï¼ŒåŒ…æ‹¬&lt;a href=&#34;https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VPC æµé‡æ—¥å¿—&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://doordash.engineering/2023/08/15/bpfagent-ebpf-for-monitoring-at-doordash/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ebpf ä»£ç†æŒ‡æ ‡&lt;/a&gt;å’Œ Envoy ç½‘ç»œå­—èŠ‚æŒ‡æ ‡ï¼Œä»¥çº æ­£è¿™ç§æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ VPC æµé‡æ—¥å¿—ï¼Œæˆ‘ä»¬å°†&lt;a href=&#34;https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs.html#flow-logs-fields&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;srcaddr å’Œ dstaddr IP åœ°å€&lt;/a&gt;æ˜ å°„åˆ°éƒ¨ç½²åœ¨æˆ‘ä»¬çš„ AWS å¸æˆ·ç»“æ„ä¸­çš„ç›¸åº”å­ç½‘ã€‚è¿™ä¸ªæ˜ å°„æä¾›äº†ä¸€ä¸ªæ±‡æ€»è§„åˆ™ï¼Œè®©æˆ‘ä»¬ç†è§£æ‰˜ç®¡äº‘è¶³è¿¹çš„ä¸åŒéƒ¨åˆ†ä¹‹é—´çš„å‡ºå£/å…¥å£æµé‡æ¨¡å¼ï¼ŒåŒ…æ‹¬ç”¨äºç”Ÿäº§ Kubernetes é›†ç¾¤ã€å­˜å‚¨è§£å†³æ–¹æ¡ˆã€ç¼“å­˜å’Œæ¶ˆæ¯ä»£ç†çš„å­ç½‘ï¼Œå¦‚è¡¨ 1 æ‰€ç¤ºã€‚æˆ‘ä»¬ç¡®è®¤ï¼Œæˆ‘ä»¬è·¨å¯ç”¨åŒºä¼ è¾“è´¹ç”¨çš„æœ€å¤§æ¥æºæ˜¯æ¯ä¸ªå•å…ƒå†…çš„éå­˜å‚¨æµé‡ã€‚å…¶ä¸­çº¦æœ‰ 20% çš„è´¹ç”¨æ˜¯ç”±äºæµé‡ä¼ è¾“åˆ°ç”¨äºæˆ‘ä»¬äº‹ä»¶æ¥æ”¶æµæ°´çº¿ï¼ˆ&lt;a href=&#34;https://doordash.engineering/2022/08/02/building-scalable-real-time-event-processing-with-kafka-and-flink/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Iguazu&lt;/a&gt;ï¼‰çš„ä¸€ä¸ªå¼¹æ€§è´Ÿè½½å‡è¡¡å™¨ï¼ˆELBï¼‰å¼•èµ·çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-è¡¨-1ä½¿ç”¨-vpc-æµé‡æ—¥å¿—è¿›è¡Œè·¨å¯ç”¨åŒºæµé‡å½’å› &#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;è¡¨ 1ï¼šä½¿ç”¨ VPC æµé‡æ—¥å¿—è¿›è¡Œè·¨å¯ç”¨åŒºæµé‡å½’å› &#34; srcset=&#34;
               /blog/doordash-service-mesh/t1_hu_8a70778d07fdf604.webp 400w,
               /blog/doordash-service-mesh/t1_hu_e9c10feea2b4bcce.webp 760w,
               /blog/doordash-service-mesh/t1_hu_2b9eebd99e6b9999.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/doordash-service-mesh/t1_hu_8a70778d07fdf604.webp&#34;
               width=&#34;752&#34;
               height=&#34;324&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      è¡¨ 1ï¼šä½¿ç”¨ VPC æµé‡æ—¥å¿—è¿›è¡Œè·¨å¯ç”¨åŒºæµé‡å½’å› 
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œæˆ‘ä»¬æ£€æŸ¥äº†æœåŠ¡ç½‘æ ¼ HTTP1/HTTP2/gRPC æŒ‡æ ‡ï¼Œç‰¹åˆ«æ˜¯ç”¨äºæ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„è¿æ¥å­—èŠ‚ï¼ŒåŒ…æ‹¬å…¥å£å’Œå‡ºå£æµé‡ã€‚æ¥è‡ªæœåŠ¡ç½‘æ ¼ Envoy ä»£ç†çš„æœ€é‡è¦çš„æŒ‡æ ‡æ˜¯&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/upstream/cluster_manager/cluster_stats.html#general&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ¥è‡ª Envoy ä¾¦å¬å™¨å’Œé›†ç¾¤çš„ cx_rx_bytes_total å’Œ cx_tx_bytes_total&lt;/a&gt;ã€‚ä½†æ˜¯ï¼Œç”±äºå½“æ—¶å¹¶éæ‰€æœ‰æœåŠ¡éƒ½å·²åŠ å…¥åˆ°æœåŠ¡ç½‘æ ¼ä¸­ï¼Œå› æ­¤æˆ‘ä»¬ä¾èµ–äº BPFAgent çš„æŒ‡æ ‡ï¼Œè¯¥æŒ‡æ ‡åœ¨æ¯ä¸ªç”Ÿäº§ Kubernetes èŠ‚ç‚¹ä¸Šéƒ½å…¨çƒéƒ¨ç½²ï¼Œä»¥å¢åŠ å¯¹æ€»ç½‘ç»œå­—èŠ‚çš„å¯è§æ€§ã€‚ä½¿ç”¨è¿™ä¸¤ä¸ªæ¥æºçš„æŒ‡æ ‡ï¼Œæˆ‘ä»¬å‘ç°äº† 90% çš„æµé‡æ˜¯ HTTP1/HTTP2/gRPC æµé‡ï¼›å…¶ä¸­ 45% çš„æµé‡å·²ç»åŠ å…¥äº†æœåŠ¡ç½‘æ ¼ï¼Œå¹¶ä¸”è¯¥éƒ¨åˆ†æµé‡çš„ 91% è¢«å‘é€åˆ° Iguazuï¼&lt;/p&gt;
&lt;h2 id=&#34;ç¯ç¯ç›¸æ‰£iguazu-çš„æµé‡æµåŠ¨&#34;&gt;ç¯ç¯ç›¸æ‰£ï¼šIguazu çš„æµé‡æµåŠ¨&lt;/h2&gt;
&lt;p&gt;åœ¨åˆ†æäº†å¦‚å›¾ 9 æ‰€ç¤ºçš„ Iguazu æµé‡æµåŠ¨ä¹‹åï¼Œæˆ‘ä»¬æ„è¯†åˆ°åœ¨è°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…æœåŠ¡æˆ– Pod ä¹‹é—´å­˜åœ¨å¤šä¸ªä¸­é—´è·ƒç‚¹ã€‚å½“æµé‡ä»è°ƒç”¨è€…æœåŠ¡ä¼ è¾“åˆ° Iguazu æ—¶ï¼Œå®ƒé¦–å…ˆç»è¿‡ ELBsï¼Œç„¶åç€é™†åœ¨å…¨çƒå•å…ƒä¸­ä¸åŒ Kubernetes é›†ç¾¤ä¸­çš„ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šã€‚å› ä¸º&lt;a href=&#34;https://kubernetes.io/docs/tasks/access-application-cluster/create-external-load-balancer/#preserving-the-client-source-ip&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;externalTrafficPolicy&lt;/a&gt;é…ç½®ä¸ºé›†ç¾¤ï¼Œ&lt;em&gt;iptables&lt;/em&gt;ä¼šå°†æµé‡é‡å®šå‘åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ä»¥ç¡®ä¿è´Ÿè½½å‡è¡¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-9iguazu-çš„åŸå§‹æµé‡æµåŠ¨&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 9ï¼šIguazu çš„åŸå§‹æµé‡æµåŠ¨&#34; srcset=&#34;
               /blog/doordash-service-mesh/f9_hu_cce9659c0ef6a171.webp 400w,
               /blog/doordash-service-mesh/f9_hu_928af880159002a6.webp 760w,
               /blog/doordash-service-mesh/f9_hu_91b45cf2aab7d3a2.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/doordash-service-mesh/f9_hu_cce9659c0ef6a171.webp&#34;
               width=&#34;760&#34;
               height=&#34;223&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 9ï¼šIguazu çš„åŸå§‹æµé‡æµåŠ¨
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è§‚å¯Ÿåˆ°ä»¥ä¸‹æ•°æ®ä¼ è¾“è¡Œä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘ ELBs å‘é€æµé‡çš„å®¢æˆ·ç«¯ä»ç„¶ç›´æ¥ä½¿ç”¨ ELB DNS åç§°ã€‚å› ä¸ºå®¢æˆ·ç«¯æ²¡æœ‰ä½¿ç”¨å†…éƒ¨çš„ DDSD åŸŸï¼Œæ‰€ä»¥ Envoy é›†ç¾¤ä¸­çš„æœåŠ¡å‘ç°ç±»å‹ä»ç„¶æ˜¯ STRICT_DNSï¼Œè€Œä¸æ˜¯ EDSï¼Œè¿™æ˜¯å¯ç”¨åŒºåŸŸæ„ŸçŸ¥è·¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±çš„å…ˆå†³æ¡ä»¶ã€‚è¿™æ„å‘³ç€ Envoy Sidecar å®¹å™¨ä½¿ç”¨ç®€å•çš„è½®è¯¢æ–¹æ³•æ¥å°†æµé‡åˆ†å‘ç»™ ELBsã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ ELBs åˆ° Cluster 2 çš„ Kubernetes å·¥ä½œèŠ‚ç‚¹çš„æµé‡çš„æƒ…å†µä¸‹ï¼Œç¦ç”¨äº†è·¨å¯ç”¨åŒºçš„è´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;li&gt;å½“æµé‡ä» Iguazu ELB åˆ°è¾¾ Kubernetes å·¥ä½œèŠ‚ç‚¹æ—¶ï¼Œ&lt;em&gt;iptables&lt;/em&gt;ä¼šå°†å…¶è¿›ä¸€æ­¥é‡å®šå‘åˆ°éšæœºèŠ‚ç‚¹ï¼Œè¿™ä¹Ÿå¢åŠ äº†è·¨å¯ç”¨åŒºæµé‡çš„æ¦‚ç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è€ƒè™‘åˆ° Iguazu è°ƒç”¨å›¾å†…éƒ¨çš„å¤šä¸ªè·ƒç‚¹çš„å¤æ‚æ€§ï¼Œæˆ‘ä»¬å†³å®šå°† Iguazu æœåŠ¡è¿ç§»åˆ°ä¸å…¶å®¢æˆ·ç«¯éƒ¨ç½²åœ¨åŒä¸€å•å…ƒçš„åœ°æ–¹ã€‚æˆ‘ä»¬è¿˜é…ç½®äº†æ‰€æœ‰å®¢æˆ·ç«¯ Envoy Sidecar çš„&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_conn_man/rds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯ç”±è§„åˆ™&lt;/a&gt;ï¼Œå°†æµé‡è·¯ç”±åˆ°æ–°é›†ç¾¤ä¸­çš„ Iguazu Podï¼Œè€Œä¸éœ€è¦æˆ‘ä»¬çš„å·¥ç¨‹å¸ˆå¯¹å…¶æœåŠ¡è¿›è¡Œä»»ä½•ä»£ç æˆ–é…ç½®æ›´æ”¹ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸º Iguazu æµé‡å¯ç”¨ç›´æ¥çš„ Pod é—´é€šä¿¡ï¼Œå®ç°åŒºåŸŸæ„ŸçŸ¥è·¯ç”±ï¼ŒåŒæ—¶å‡å°‘äº† ELBs å¤„ç†çš„æµé‡é‡ï¼Œå¦‚å›¾ 10 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-10iguazu-çš„æ–°æµé‡æµåŠ¨&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 10ï¼šIguazu çš„æ–°æµé‡æµåŠ¨&#34; srcset=&#34;
               /blog/doordash-service-mesh/f10_hu_9ed1220c1ba9a608.webp 400w,
               /blog/doordash-service-mesh/f10_hu_6b0ab667681ad231.webp 760w,
               /blog/doordash-service-mesh/f10_hu_f3de25e3acc88767.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/doordash-service-mesh/f10_hu_9ed1220c1ba9a608.webp&#34;
               width=&#34;760&#34;
               height=&#34;234&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 10ï¼šIguazu çš„æ–°æµé‡æµåŠ¨
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™äº›æ“ä½œä½¿ DoorDash çš„æ•°æ®ä¼ è¾“æˆæœ¬ä»¥åŠ ELB æˆæœ¬å—åˆ°äº†å¾ˆå¤§çš„æ‰“å‡»ï¼Œä»¥è‡³äºæˆ‘ä»¬çš„äº‘æœåŠ¡æä¾›å•†ä¸æˆ‘ä»¬è”ç³»ï¼Œè¯¢é—®æˆ‘ä»¬æ˜¯å¦é‡åˆ°äº†ä¸ç”Ÿäº§ç›¸å…³çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¸å–çš„æ•™è®­&#34;&gt;å¸å–çš„æ•™è®­&lt;/h2&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„æ—…ç¨‹ä¸­ï¼Œæˆ‘ä»¬è·å¾—äº†ä¸€äº›å…³é”®çš„å‘ç°ï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº‘æœåŠ¡æä¾›å•†çš„æ•°æ®ä¼ è¾“å®šä»·æ¯”èµ·åˆçœ‹èµ·æ¥æ›´åŠ å¤æ‚ã€‚å€¼å¾—æŠ•å…¥æ—¶é—´æ¥ç†è§£å®šä»·æ¨¡å‹ï¼Œä»¥æ„å»ºæ­£ç¡®çš„æ•ˆç‡è§£å†³æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;li&gt;è¦å…¨é¢äº†è§£/æŸ¥çœ‹æ‰€æœ‰è·¨å¯ç”¨åŒºçš„æµé‡æ˜¯å…·æœ‰æŒ‘æˆ˜æ€§çš„ã€‚ç„¶è€Œï¼Œå°†æ¥è‡ªä¸åŒæ¥æºçš„ç½‘ç»œå­—èŠ‚æŒ‡æ ‡ç»“åˆèµ·æ¥ï¼Œè¶³ä»¥è¯†åˆ«çƒ­ç‚¹ï¼Œä¸€æ—¦è§£å†³ï¼Œå¯ä»¥åœ¨ä½¿ç”¨å’Œæˆæœ¬æ–¹é¢äº§ç”Ÿå®è´¨æ€§å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;Envoy çš„åŒºåŸŸæ„ŸçŸ¥è·¯ç”±å¯ä»¥å°†æµé‡å‘é€åˆ°å…¶æœ¬åœ°å¯ç”¨åŒºï¼ŒåŒæ—¶é€šè¿‡å¹³è¡¡æµé‡è‡ªåŠ¨ç¡®ä¿å¼¹æ€§ã€‚&lt;/li&gt;
&lt;li&gt;éšç€å¾®æœåŠ¡è°ƒç”¨å›¾ä¸­è·ƒç‚¹æ•°é‡çš„å¢åŠ ï¼Œæ•°æ®è¢«ä¼ è¾“åˆ°è·¨å¯ç”¨åŒºçš„å¯èƒ½æ€§å¢åŠ ï¼Œå¢åŠ äº†ç¡®ä¿æ‰€æœ‰è·ƒç‚¹æ”¯æŒåŒºåŸŸæ„ŸçŸ¥è·¯ç”±çš„å¤æ‚æ€§ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ è€ƒè™‘ä½¿ç”¨æœåŠ¡ç½‘æ ¼æ¥ç®¡ç†æµé‡ï¼Œä½ ä¹Ÿå¯ä»¥åˆ©ç”¨å®ƒæ¥æé«˜æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;è¦äº†è§£æ›´å¤šå…³äº DoorDash çš„æœåŠ¡ç½‘æ ¼ä¹‹æ—…çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ Hochuen çš„ KubeCon + CloudNativeCon North America 2023&lt;a href=&#34;https://www.youtube.com/watch?v=I6E_7f40YP0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼ä¼šè®®&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æœªæ¥çš„å·¥ä½œ&#34;&gt;æœªæ¥çš„å·¥ä½œ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»åˆ—å‡ºäº†æˆ‘ä»¬å¸Œæœ›å®æ–½çš„è§£å†³æ–¹æ¡ˆå¢å¼ºåŠŸèƒ½çš„åˆ—è¡¨ï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç®€åŒ–ä»ä¸åŒæ¥æºæ”¶é›†æŒ‡æ ‡å¹¶æä¾›æˆæœ¬å’Œä½¿ç”¨æƒ…å†µçš„ç»Ÿä¸€æ¦‚è¿°çš„è¿‡ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;å¯ç”¨å†…éƒ¨ Envoy è·¯ç”±å™¨çš„åŒºåŸŸæ„ŸçŸ¥è·¯ç”±åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿è§£å†³æ–¹æ¡ˆæ›´å…·å¯æ‰©å±•æ€§ï¼Œä»¥æ”¯æŒ DDSD ä¹‹å¤–çš„å…¶ä»–åŸŸçš„ HTTP1/HTTP2/gRPC æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Kubernetes ç½‘ç»œä»£ç† kube-proxy ä¸ºå†…éƒ¨åŸºç¡€è®¾æ–½æµé‡å¯ç”¨&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/topology-aware-routing/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‹“æ‰‘æ„ŸçŸ¥è·¯ç”±&lt;/a&gt;åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;æ¢ç´¢ä¼˜åŒ–çš„è·¯ç”±ï¼Œç”¨äºä¸ DoorDash çš„æœ‰çŠ¶æ€ç³»ç»Ÿï¼ˆä¾‹å¦‚ PostgreSQLã€CRDBã€Redis å’Œ Kafkaï¼‰ä¹‹é—´çš„å¤§æ•°æ®ä¼ è¾“æ“ä½œã€‚è¿™å°†å…è®¸æµé‡åœ¨æœ‰æ„ä¹‰çš„æƒ…å†µä¸‹ä¿æŒåœ¨å•ä¸€ AZ æ³³é“ä¸­ï¼Œè¿›ä¸€æ­¥é™ä½æˆæœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è‡´è°¢&#34;&gt;è‡´è°¢&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬æ„Ÿè°¢&lt;strong&gt;Darshit Gavhane&lt;/strong&gt;å’Œ&lt;strong&gt;Allison Cheng&lt;/strong&gt;å°†æ‰€æœ‰ Iguazu æœåŠ¡è¿ç§»åˆ°å®¢æˆ·ç«¯æ­£åœ¨è¿è¡Œçš„åŒä¸€å•å…ƒï¼Œä»¥åŠ&lt;strong&gt;Steve Hoffman&lt;/strong&gt;å’Œ&lt;strong&gt;Sebastian Yates&lt;/strong&gt;åœ¨æ—…ç¨‹ä¸­çš„å»ºè®®å’ŒæŒ‡å¯¼ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åœ¨ AWS NLB å’Œ Istio Ingress ç½‘å…³ä¸Šå¯ç”¨ä»£ç†åè®®</title>
      <link>https://cloudnativecn.com/blog/show-source-ip/</link>
      <pubDate>Thu, 18 Jan 2024 12:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/show-source-ip/</guid>
      <description>&lt;p&gt;&lt;em&gt;æ³¨ï¼šåŸæ–‡å‘å¸ƒäº 2020 å¹´ 12 æœˆï¼Œä»¥ä¸‹å†…å®¹æœªåœ¨å½“ä¸‹å¾—åˆ°éªŒè¯ï¼Œå¯èƒ½å·²ç»è¿‡æ—¶ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•é…ç½®å¹¶åœ¨ AWS NLB å’Œ Istio Ingress ç½‘å…³çš„å †æ ˆä¸­å¯ç”¨ä»£ç†åè®®çš„æœ€æ–°ç»éªŒã€‚&lt;a href=&#34;https://www.haproxy.com/blog/haproxy/proxy-protocol/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»£ç†åè®®&lt;/a&gt; æ—¨åœ¨åœ¨ä¸ä¸¢å¤±å®¢æˆ·ç«¯ä¿¡æ¯çš„æƒ…å†µä¸‹é“¾æ¥ä»£ç†å’Œåå‘ä»£ç†ã€‚ä»£ç†åè®®é¿å…äº†å¯¹åŸºç¡€æ¶æ„è¿›è¡Œæ›´æ”¹æˆ– &lt;code&gt;NAT&lt;/code&gt; é˜²ç«å¢™çš„éœ€æ±‚ï¼Œå¹¶æä¾›äº†åè®®ä¸å¯çŸ¥æ€§å’Œè‰¯å¥½å¯ä¼¸ç¼©æ€§çš„ä¼˜åŠ¿ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜åœ¨éƒ¨ç½²ä¸­å¯ç”¨äº† &lt;code&gt;X-Forwarded-For&lt;/code&gt; HTTP æ ‡å¤´ï¼Œä»¥ä¾¿è½»æ¾è¯»å–å®¢æˆ·ç«¯ IP åœ°å€ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œå±•ç¤ºäº† Istio Ingress çš„æµé‡ç®¡ç†ï¼Œä½¿ç”¨ç«¯å£ 80 å’Œ 443 ä¸Šçš„ httpbin æœåŠ¡æ¥æ¼”ç¤ºä»£ç†åè®®çš„ä½¿ç”¨ã€‚è¯·æ³¨æ„ï¼Œä»£ç†åè®®çš„ v1 å’Œ v2 éƒ½é€‚ç”¨äºæ­¤ç¤ºä¾‹ï¼Œä½†ç”±äº AWS NLB ç›®å‰ä»…æ”¯æŒ v2ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹åœ¨æœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†ä½¿ç”¨ä»£ç†åè®® v2ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†åœ¨ AWS NLB ä¸­ä½¿ç”¨ä»£ç†åè®® v2ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-aw-nlb-ä¸­å¯ç”¨ä»£ç†åè®®çš„é¡µé¢&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;AW NLB ä¸­å¯ç”¨ä»£ç†åè®®çš„é¡µé¢&#34; srcset=&#34;
               /blog/show-source-ip/aws-proxy-protocol_hu_9d1c2ac0b8e3486.webp 400w,
               /blog/show-source-ip/aws-proxy-protocol_hu_df6ed29a568c145f.webp 760w,
               /blog/show-source-ip/aws-proxy-protocol_hu_acc98bd30723a2c6.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/show-source-ip/aws-proxy-protocol_hu_9d1c2ac0b8e3486.webp&#34;
               width=&#34;760&#34;
               height=&#34;614&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      AW NLB ä¸­å¯ç”¨ä»£ç†åè®®çš„é¡µé¢
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ¥æ”¶å™¨å¯ä»¥é…ç½®ä¸ºæ”¯æŒåè®®çš„ç‰ˆæœ¬ 1 å’Œç‰ˆæœ¬ 2ã€‚è¯†åˆ«åè®®ç‰ˆæœ¬å¾ˆå®¹æ˜“ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœä¼ å…¥çš„å­—èŠ‚è®¡æ•°ä¸º 16 æˆ–æ›´å¤šï¼Œå¹¶ä¸”å‰ 13 ä¸ªå­—èŠ‚ä¸åè®®ç­¾åå— &lt;code&gt;\x0D\x0A\x0D\x0A\x00\x0D\x0A\x51\x55\x49\x54\x0A\x02&lt;/code&gt; åŒ¹é…ï¼Œåˆ™åè®®æ˜¯ç‰ˆæœ¬ 2ã€‚&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼Œå¦‚æœä¼ å…¥çš„å­—èŠ‚è®¡æ•°ä¸º 8 æˆ–æ›´å¤šï¼Œå¹¶ä¸”å‰ 5 ä¸ªå­—ç¬¦ä¸â€œPROXYâ€çš„ &lt;code&gt;US-ASCII&lt;/code&gt; è¡¨ç¤ºï¼ˆ&lt;code&gt;\x50\x52\x4F\x58\x59&lt;/code&gt;ï¼‰åŒ¹é…ï¼Œåˆ™å¿…é¡»è§£æåè®®ä½œä¸ºç‰ˆæœ¬ 1ã€‚&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼Œæ­¤åè®®ä¸åœ¨æ­¤è§„èŒƒèŒƒå›´å†…ï¼Œè¿æ¥å¿…é¡»è¢«å…³é—­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åœ¨-80-å’Œ-443-ä¸Šè¿›è¡Œåˆ†å¼€çš„è®¾ç½®&#34;&gt;åœ¨ 80 å’Œ 443 ä¸Šè¿›è¡Œåˆ†å¼€çš„è®¾ç½®&lt;/h2&gt;
&lt;p&gt;åœ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ä¹‹å‰ï¼Œå‡å®šå·²ç»é…ç½®äº†é€‚å½“çš„ VPCã€IAM å’Œ Kubernetes è®¾ç½®çš„ AWS ç¯å¢ƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­¥éª¤-1ä½¿ç”¨-aws-nlb-å®‰è£…-istio&#34;&gt;æ­¥éª¤ 1ï¼šä½¿ç”¨ AWS NLB å®‰è£… Istio&lt;/h3&gt;
&lt;p&gt;åšå®¢&lt;a href=&#34;https://istio.io/latest/blog/2018/aws-nlb/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ AWS NLB é…ç½® Istio Ingress&lt;/a&gt; æä¾›äº†è®¾ç½® AWS IAM è§’è‰²å’Œé€šè¿‡ Helm å¯ç”¨ AWS NLB ä½¿ç”¨çš„è¯¦ç»†æ­¥éª¤ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–è‡ªåŠ¨åŒ–å·¥å…·ï¼Œä¾‹å¦‚ Terraformï¼Œæ¥å®ç°ç›¸åŒçš„ç›®æ ‡ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œä¸ºäº†åŒæ—¶å¯ç”¨ä»£ç†åè®®å’Œ &lt;code&gt;X-Forwarded-For&lt;/code&gt;ï¼Œæ˜¾ç¤ºäº†æ›´å®Œæ•´çš„é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service.beta.kubernetes.io/aws-load-balancer-proxy-protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service.beta.kubernetes.io/aws-load-balancer-type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;nlb&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;proxy.istio.io/config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;gatewayTopology&amp;#34; : { &amp;#34;numTrustedProxies&amp;#34;: 2 } }&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ­¥éª¤-2åˆ›å»ºä»£ç†åè®®-envoy-è¿‡æ»¤å™¨&#34;&gt;æ­¥éª¤ 2ï¼šåˆ›å»ºä»£ç†åè®® Envoy è¿‡æ»¤å™¨&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EnvoyFilter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;proxy-protocol&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configPatches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;applyTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;LISTENER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;MERGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listener_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.filters.listener.proxy_protocol&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.filters.listener.tls_inspector&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ­¥éª¤-3å¯ç”¨-x-forwarded-for-æ ‡å¤´&#34;&gt;æ­¥éª¤ 3ï¼šå¯ç”¨ &lt;code&gt;X-Forwarded-For&lt;/code&gt; æ ‡å¤´&lt;/h3&gt;
&lt;p&gt;æ­¤&lt;a href=&#34;https://istio.io/latest/docs/ops/configuration/traffic-management/network-topologies/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åšå®¢&lt;/a&gt;åŒ…æ‹¬é…ç½® Gateway Network Topology çš„å‡ ä¸ªç¤ºä¾‹ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæ ¹æ®éœ€è¦è°ƒæ•´é…ç½®ï¼Œä»¥åœ¨æ²¡æœ‰ä¸­é—´ä»£ç†çš„æƒ…å†µä¸‹å¯ç”¨ &lt;code&gt;X-Forwarded-For&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EnvoyFilter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway-settings&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configPatches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;applyTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NETWORK_FILTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filterChain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.http_connection_manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;MERGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.http_connection_manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;skip_xff_append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;use_remote_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;xff_num_trusted_hops&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ­¥éª¤-4åœ¨ç«¯å£-80-å’Œ-443-ä¸Šéƒ¨ç½²-httpbin-çš„å…¥å£ç½‘å…³&#34;&gt;æ­¥éª¤ 4ï¼šåœ¨ç«¯å£ 80 å’Œ 443 ä¸Šéƒ¨ç½² httpbin çš„å…¥å£ç½‘å…³&lt;/h3&gt;
&lt;p&gt;åœ¨æ‰§è¡Œ&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/ingress/secure-ingress/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰å…¨å…¥å£è®¾ç½®&lt;/a&gt;æ—¶ï¼ŒmacOS ç”¨æˆ·å¿…é¡»æ·»åŠ é¢å¤–çš„è¡¥ä¸æ¥ç”Ÿæˆ TLS è¯ä¹¦ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# use Istio default gateway implementation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;a25fa0b4835b.elb.us-west-2.amazonaws.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;a25fa0b4835b.elb.us-west-2.amazonaws.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;httpbin-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/headers&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mygateway2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# use istio default ingress gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SIMPLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;credentialName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin-credential&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# must be the same as secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;a25fa0b4835b.elb.us-west-2.amazonaws.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;a25fa0b4835b.elb.us-west-2.amazonaws.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;mygateway2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/headers&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ­¥éª¤-5æ£€æŸ¥-httpbin-çš„æ ‡å¤´è¾“å‡º&#34;&gt;æ­¥éª¤ 5ï¼šæ£€æŸ¥ httpbin çš„æ ‡å¤´è¾“å‡º&lt;/h3&gt;
&lt;p&gt;æ£€æŸ¥ç«¯å£ 443ï¼ˆ80 ç±»ä¼¼ï¼‰å¹¶æ¯”è¾ƒä½¿ç”¨å’Œä¸ä½¿ç”¨ä»£ç†åè®®çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;//////with proxy_protocal enabled in the stack&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Trying YY.XXX.141.26...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP_NODELAY set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Connection failed&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* connect to YY.XXX.141.26 port 443 failed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Operation timed out&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Trying YY.XXX.205.117...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP_NODELAY set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Connected to a25fa0b4835b.elb.us-west-2.amazonaws.com (XX.YYY.205.117) port 443 (#0)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ALPN, offering h2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ALPN, offering http/1.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* successfully set certificate verify locations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;*   CAfile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;new_certificates/example.com.crt&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;CApath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;none&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (OUT), TLS handshake, Client hello (1)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (IN), TLS handshake, Server hello (2)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (IN), TLS handshake, Certificate (11)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (IN), TLS handshake, Server key exchange (12)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (IN), TLS handshake, Server finished (14)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (OUT), TLS handshake, Client key exchange (16)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (OUT), TLS handshake, Finished (20)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (IN), TLS handshake, Finished (20)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SSL connection using TLSv1.2 / ECDHE-RSA-CHACHA20-POLY1305&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ALPN, server accepted to use h2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* Server certificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;*  subject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CN=a25fa0b4835b.elb.us-west-2.amazonaws.com; O=httpbin organization&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;*  start date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Oct 29 20:39:12 2020 GMT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;*  expire date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Oct 29 20:39:12 2021 GMT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;*  common name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;a25fa0b4835b.elb.us-west-2.amazonaws.com (matched)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;*  issuer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;O=example Inc.; CN=example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SSL certificate verify ok.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Using HTTP2, server supports multi-use&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Connection state changed (HTTP/2 confirmed)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* Copying HTTP/2 data in stream buffer to connection buffer after upgrade&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;len=0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* Using Stream ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;(easy handle 0x7fc6c8810800)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;gt; GET /headers?show_env=1 HTTP/2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt; Host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;a25fa0b4835b.elb.us-west-2.amazonaws.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt; User-Agent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;curl/7.64.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt; Accept&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;*/*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Connection state changed (MAX_CONCURRENT_STREAMS == 2147483647)!&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt; HTTP/2 200&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt; server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt; date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Thu, 29 Oct 2020 21:39:46 GMT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt; content-type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application/json&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt; content-length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;629&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt; access-control-allow-origin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;*&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt; access-control-allow-credentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt; x-envoy-upstream-service-time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;{&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;headers&amp;#34;: &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;Accept&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*/*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;Content-Length&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;Host&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;a25fa0b4835b.elb.us-west-2.amazonaws.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;User-Agent&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;curl/7.64.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-B3-Sampled&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-B3-Spanid&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;74f99a1c6fc29975&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-B3-Traceid&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;85db86fe6aa322a074f99a1c6fc29975&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-Envoy-Attempt-Count&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-Envoy-Decorator-Operation&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;httpbin.default.svc.cluster.local:8000/headers*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-Envoy-External-Address&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;XX.110.54.41&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-Forwarded-For&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;XX.110.54.41&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-Forwarded-Proto&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-Request-Id&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;5c3bc236-0c49-4401-b2fd-2dbfbce506fc&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Connection&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#0 to host a25fa0b4835b.elb.us-west-2.amazonaws.com left intact&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Closing connection 0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;//////////without proxy_protocal&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Trying YY.XXX.141.26...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP_NODELAY set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Connection failed&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* connect to YY.XXX.141.26 port 443 failed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Operation timed out&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Trying YY.XXX.205.117...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP_NODELAY set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Connected to a25fa0b4835b.elb.us-west-2.amazonaws.com (YY.XXX.205.117) port 443 (#0)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ALPN, offering h2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ALPN, offering http/1.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* successfully set certificate verify locations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;*   CAfile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;new_certificates/example.com.crt&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;CApath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;none&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (OUT), TLS handshake, Client hello (1)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (IN), TLS handshake, Server hello (2)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (IN), TLS handshake, Certificate (11)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (IN), TLS handshake, Server key exchange (12)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (IN), TLS handshake, Server finished (14)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (OUT), TLS handshake, Client key exchange (16)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (OUT), TLS handshake, Finished (20)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* TLSv1.2 (IN), TLS handshake, Finished (20)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SSL connection using TLSv1.2 / ECDHE-RSA-CHACHA20-POLY1305&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ALPN, server accepted to use h2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* Server certificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;*  subject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CN=a25fa0b4835b.elb.us-west-2.amazonaws.com; O=httpbin organization&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;*  start date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Oct 29 20:39:12 2020 GMT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;*  expire date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Oct 29 20:39:12 2021 GMT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;*  common name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;a25fa0b4835b.elb.us-west-2.amazonaws.com (matched)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;*  issuer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;O=example Inc.; CN=example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SSL certificate verify ok.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Using HTTP2, server supports multi-use&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Connection state changed (HTTP/2 confirmed)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* Copying HTTP/2 data in stream buffer to connection buffer after upgrade&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;len=0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;* Using Stream ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;(easy handle 0x7fbf8c808200)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;gt; GET /headers?show_env=1 HTTP/2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt; Host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;a25fa0b4835b.elb.us-west-2.amazonaws.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt; User-Agent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;curl/7.64.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt; Accept&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;*/*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Connection state changed (MAX_CONCURRENT_STREAMS == 2147483647)!&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt; HTTP/2 200&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt; server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt; date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Thu, 29 Oct 2020 20:44:01 GMT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt; content-type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;application/json&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt; content-length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;612&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt; access-control-allow-origin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;*&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt; access-control-allow-credentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt; x-envoy-upstream-service-time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;{&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;headers&amp;#34;: &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;Accept&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*/*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;Content-Length&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;Host&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;a25fa0b4835b.elb.us-west-2.amazonaws.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;User-Agent&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;curl/7.64.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-B3-Sampled&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-B3-Spanid&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;69913a6e6e949334&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-B3-Traceid&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;729d5da3618545da69913a6e6e949334&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-Envoy-Attempt-Count&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-Envoy-Decorator-Operation&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;httpbin.default.svc.cluster.local:8000/headers*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-Envoy-Internal&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-Forwarded-For&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;172.16.5.30&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-Forwarded-Proto&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;X-Request-Id&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;299c7f8a-5f89-480a-82c9-028c76d45d84&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Connection&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#0 to host a25fa0b4835b.elb.us-west-2.amazonaws.com left intact&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;*&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Closing connection 0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»äº†éƒ¨ç½²ä¸€ä¸ªç”±å¯ç”¨ä»£ç†åè®®çš„ AWS NLB å’Œ Istio Ingress ç½‘å…³ç»„æˆçš„å †æ ˆã€‚å¦‚æœä½ å¯¹åè®®å¯ç”¨ä»¥ä¸€ç§è½¶äº‹ã€ç»éªŒå’Œæ›´ä¸æ­£å¼çš„æ–¹å¼æ„Ÿå…´è¶£ï¼Œå¸Œæœ›è¿™å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚ä½†è¯·æ³¨æ„ï¼Œ&lt;code&gt;X-Forwarded-For&lt;/code&gt; æ ‡å¤´åº”ä»…ç”¨äºæµ‹è¯•æ—¶æ–¹ä¾¿é˜…è¯»ï¼Œå› ä¸ºå¤„ç†è™šå‡çš„ &lt;code&gt;X-Forwarded-For&lt;/code&gt; æ”»å‡»ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´å†…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒèµ„æ–™&#34;&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.nginx.com/nginx/admin-guide/load-balancer/using-proxy-protocol/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åè®®è®¾ç½®&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.haproxy.com/blog/haproxy/proxy-protocol/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åè®®ä»‹ç»&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Istio Sidecar çš„èµ„æºå’Œæ€§èƒ½ç®¡ç†ï¼šä»ç›‘æ§åˆ°è‡ªåŠ¨æ‰©ç¼©å®¹çš„æœ€ä½³å®è·µ</title>
      <link>https://cloudnativecn.com/blog/scaling-and-sizing-the-sidecar/</link>
      <pubDate>Wed, 03 Jan 2024 08:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/scaling-and-sizing-the-sidecar/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://karlstoney.com/scaling-and-sizing-the-sidecar/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Scaling the Sidecar&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡è®¨è®ºæˆ‘ä»¬å¦‚ä½•åœ¨å·¥ä½œè´Ÿè½½ä¸­æ‰©å±• Istio Sidecarï¼Œä»¥åŠå¦‚ä½•è€ƒè™‘ Sidecar èµ„æºä¸åº”ç”¨ç¨‹åºç´§å¯†è€¦åˆçš„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰æœ‰å¾ˆå¤šå…³äº Istio æ–°çš„ &lt;a href=&#34;https://istio.io/v1.15/blog/2022/introducing-ambient-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambient Mesh&lt;/a&gt; çš„è®¨è®ºã€‚è¿™ç§éƒ¨ç½²æœåŠ¡ç½‘æ ¼çš„æ–°æ–¹æ³•æ”¾å¼ƒäº† Sidecarï¼Œè€Œé‡‡ç”¨äº†ä¸¤ä¸ªæ–°ç»„ä»¶ï¼Œ&lt;code&gt;ztunnel&lt;/code&gt;ï¼Œä¸€ä¸ªç”¨äºå¤„ç†æ ¸å¿ƒ L4 ç½‘ç»œé—®é¢˜çš„æ¯èŠ‚ç‚¹ç»„ä»¶ï¼Œä»¥åŠï¼ˆå¦‚æœéœ€è¦ï¼‰&lt;code&gt;waypoint proxy&lt;/code&gt; æ¥å¤„ç† L7 é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-and-sizing-the-sidecar/image_hu_b0a426983821824b.webp 400w,
               /blog/scaling-and-sizing-the-sidecar/image_hu_f43a66a8154fc7c3.webp 760w,
               /blog/scaling-and-sizing-the-sidecar/image_hu_2e0079e8a6d09b13.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-and-sizing-the-sidecar/image_hu_b0a426983821824b.webp&#34;
               width=&#34;760&#34;
               height=&#34;391&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ¥æºï¼š&lt;a href=&#34;https://istio.io/v1.15/blog/2022/introducing-ambient-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/v1.15/blog/2022/introducing-ambient-mesh&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘å¬åˆ°çš„è¿œç¦» Sidecar çš„ä¸€ä¸ªä¸»è¦åŸå› æ˜¯ï¼Œæ‰©å±• Sidecar å¾ˆå¤æ‚ã€‚å¦‚æœåªä½¿ç”¨ L4 åŠŸèƒ½ï¼Œæˆ‘åŒæ„è¿™ä¸€è§‚ç‚¹ã€‚ç„¶è€Œï¼Œä½œä¸º L7 åŠŸèƒ½çš„é‡åº¦ç”¨æˆ·ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œä¼¼ä¹æˆ‘ä»¬åªæ˜¯åœ¨ç®¡ç† Waypoint ä»£ç†çš„è§„æ¨¡ï¼Œè€Œä¸æ˜¯ Sidecarã€‚å¯¹æˆ‘ä¸ªäººè€Œè¨€ï¼Œä¹Ÿè®¸æœ‰ç‚¹è‡ªç§ï¼Œå®ƒæ„Ÿè§‰åƒæ˜¯ä¸€ä¸ªæ¨ªå‘ï¼ˆå……å…¶é‡ï¼‰çš„æ­¥éª¤ï¼Œè€Œä¸æ˜¯å‰è¿›ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œæˆ‘å¹¶ä¸è§‰å¾—ç®¡ç† Sidecar èµ„æºå¾ˆç—›è‹¦ï¼Œæ‰€ä»¥æˆ‘å¾ˆéš¾äº§ç”Ÿå…±é¸£ã€‚è¿™éƒ¨åˆ†æ˜¯å› ä¸ºæˆ‘ä»æ—©æœŸå°±å¼€å§‹ä½¿ç”¨ Istioï¼Œå¹¶å»ºç«‹äº†æœ‰åŠ©äºè¿™ä¸€è¿‡ç¨‹çš„å·¥å…·å’Œæµç¨‹ã€‚æˆ‘æ„è¯†åˆ°æˆ‘ä»æœªçœŸæ­£åˆ†äº«è¿‡å…³äºæˆ‘ä»¬å¦‚ä½•ç®¡ç†è¿™ä¸€è¿‡ç¨‹çš„ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œåˆ†äº«ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸€äº›èƒŒæ™¯&#34;&gt;ä¸€äº›èƒŒæ™¯&lt;/h3&gt;
&lt;p&gt;èƒŒæ™¯å¾ˆé‡è¦ï¼Œä½ å¦‚ä½•æ€è€ƒç›‘æ§å’Œä¼¸ç¼©å°†å–å†³äºä½ å¦‚ä½•æ„å»ºä½ çš„ Kubernetes è®¾ç½®ï¼Œä»¥åŠä½ çš„ç»„ç»‡ç»“æ„ã€‚ä¹Ÿæ²¡æœ‰ä¸€ç§å¤§å°é€‚åˆæ‰€æœ‰æƒ…å†µï¼Œè¿™åªæ˜¯å¯¹æˆ‘ä»¬æœ‰æ•ˆçš„æ–¹æ³•ã€‚å› æ­¤æˆ‘ç›¸ä¿¡ Ambient æ¨¡å¼å°†å‡å°‘æŸäº› Operator çš„å¤æ‚æ€§ï¼Œä½†å¯èƒ½ä¼šå¢åŠ å…¶ä»– Operator çš„å¤æ‚æ€§ï¼ˆæˆ‘æ‰¿è®¤ï¼Œè¿™å¯èƒ½æ˜¯å°‘æ•°æƒ…å†µï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿è¡Œå¤§çº¦ 700 ä¸ªä¸ªåˆ«æœåŠ¡ï¼ˆâ€œå·¥ä½œè´Ÿè½½â€ï¼‰ã€‚æ¯ä¸ªæœåŠ¡éƒ½æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨è‡ªå·±çš„ &lt;code&gt;Namespace&lt;/code&gt; ä¸­è¿è¡Œ&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨è‡ªå·±çš„ &lt;code&gt;Service Account&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ‹¥æœ‰è‡ªå·±çš„ &lt;code&gt;Service&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç”±è‡ªå·±çš„éš”ç¦» CI/CD æµæ°´çº¿éƒ¨ç½²&lt;/li&gt;
&lt;li&gt;ä» Istio å’Œç½‘ç»œç­–ç•¥çš„è§’åº¦æ¥çœ‹ï¼Œéƒ½åœ¨é»˜è®¤æ‹’ç»çš„è®¾ç½®ä¸­è¿è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-and-sizing-the-sidecar/workload_hu_817cc5b6998a8e25.webp 400w,
               /blog/scaling-and-sizing-the-sidecar/workload_hu_2d2d36a93df2ea9e.webp 760w,
               /blog/scaling-and-sizing-the-sidecar/workload_hu_3a2987f2d8ee0476.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-and-sizing-the-sidecar/workload_hu_817cc5b6998a8e25.webp&#34;
               width=&#34;251&#34;
               height=&#34;191&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œå‘½åç©ºé—´æ˜¯å·¥ä½œè´Ÿè½½çš„è¾¹ç•Œï¼Œè¿™æ˜¯ä¸€ç§ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œè€Œä¸”æ˜¯ä¸€æ¡åšå†³çš„è§„åˆ™ã€‚å› æ­¤ï¼Œæˆ‘ç›¸ä¿¡æˆ‘ä»¬ä¹Ÿä¼šä¸ºæ¯ä¸ªå‘½åç©ºé—´åˆ›å»ºä¸€ä¸ª waypoint ä»£ç†ã€‚æˆ‘ä»¬ä¸ä¼šåœ¨å¤šä¸ªå·¥ä½œè´Ÿè½½ä¹‹é—´å…±äº« waypoint ä»£ç†ï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´è€¦åˆï¼ˆé£é™©/å†²å‡»èŒƒå›´ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ç±»ä¼¼äºè¿™æ ·çš„ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-and-sizing-the-sidecar/waypoint_hu_e6148b59db319ba0.webp 400w,
               /blog/scaling-and-sizing-the-sidecar/waypoint_hu_213908a1de8e56ec.webp 760w,
               /blog/scaling-and-sizing-the-sidecar/waypoint_hu_aee1442287c719b2.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-and-sizing-the-sidecar/waypoint_hu_e6148b59db319ba0.webp&#34;
               width=&#34;361&#34;
               height=&#34;191&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸å…¶æ‰©å±• &lt;code&gt;Sidecar&lt;/code&gt;ï¼Œæˆ‘ä»¬å°†æ‰©å±• &lt;code&gt;Waypoint&lt;/code&gt; - è¿™å°±æ˜¯æˆ‘æ‰€è¯´çš„å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œæ˜¯æ¨ªå‘çš„ã€‚æˆ‘ä»¬ä»ç„¶éœ€è¦è€ƒè™‘æŸç§è§„æ¨¡çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯è§‚æµ‹æ€§åªæ˜¯å¦ä¸€ä¸ªå®¹å™¨&#34;&gt;å¯è§‚æµ‹æ€§ï¼šåªæ˜¯å¦ä¸€ä¸ªå®¹å™¨&lt;/h3&gt;
&lt;p&gt;è¿™åŸºæœ¬ä¸Šæ€»ç»“äº†æˆ‘å¯¹ Sidecar çš„çœ‹æ³•ã€‚å®ƒåªæ˜¯ä½ çš„å·¥ä½œè´Ÿè½½ä¸­çš„å¦ä¸€ä¸ªå®¹å™¨ã€‚ä¸ºäº†&lt;a href=&#34;https://karlstoney.com/managing-your-costs-on-kubernetes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ‰æ•ˆç®¡ç†&lt;/a&gt;æˆæœ¬ï¼ˆ&amp;ldquo;åˆé€‚å¤§å°&amp;rdquo;ï¼‰ï¼Œä½ åº”è¯¥å·²ç»åœ¨ç›‘æ§ä½ çš„å·¥ä½œè´Ÿè½½æ—¶ç›‘æ§å…³é”®æŒ‡æ ‡ï¼Œè¿™äº›æŒ‡æ ‡è‡ªç„¶æ‰©å±•åˆ°æ¶µç›– &lt;code&gt;istio-proxy&lt;/code&gt;ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œè¿™äº›æŒ‡æ ‡åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CPU å’Œå†…å­˜ &lt;strong&gt;è¯·æ±‚&lt;/strong&gt;ï¼ˆä¾‹å¦‚ &lt;code&gt;kube_pod_container_resource_requests&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;CPU å’Œå†…å­˜ &lt;strong&gt;ä½¿ç”¨&lt;/strong&gt;ï¼ˆä¾‹å¦‚ &lt;code&gt;container_memory_working_set_bytes&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;CPU å’Œå†…å­˜ &lt;strong&gt;è®¡ç®—åˆ©ç”¨ç‡&lt;/strong&gt;ï¼ˆUsage / Requestsï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æš‚æ—¶å¿½ç•¥ Istioï¼Œå¦‚æœä½ æ²¡æœ‰åšä¸Šè¿°æ“ä½œï¼Œé‚£ä¹ˆä½ åº”è¯¥å¼€å§‹åšã€‚ä¸ºäº†å¸®åŠ©ä½ ï¼Œè¿™æ˜¯æˆ‘ç”¨äº CPU è®¡ç®—åˆ©ç”¨ç‡çš„æŒ‡æ ‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;record&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;container_cpu_usage_against_request:pod:rate1m&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;expr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    (   
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      count(kube_pod_container_resource_requests{resource=&amp;#34;cpu&amp;#34;, container!=&amp;#34;&amp;#34;}) by (container, pod, namespace)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      *   
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      avg(
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        irate(
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          container_cpu_usage_seconds_total{container!=&amp;#34;&amp;#34;}[1m]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        )   
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      ) by (container, pod, namespace)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    )   
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    /   
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    avg(
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      avg_over_time(
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        kube_pod_container_resource_requests{resource=&amp;#34;cpu&amp;#34;, container!=&amp;#34;&amp;#34;}[1m]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      )   
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    ) by (container, pod, namespace) * 100 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    *   
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    on(pod) group_left(workload) (
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      avg by (pod, workload) (
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        label_replace(kube_pod_info{created_by_kind=~&amp;#34;ReplicaSet|Job&amp;#34;}, &amp;#34;workload&amp;#34;, &amp;#34;$1&amp;#34;, &amp;#34;created_by_name&amp;#34;, &amp;#34;^(.*)-([^-]+)$&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        or  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        label_replace(kube_pod_info{created_by_kind=~&amp;#34;DaemonSet|StatefulSet&amp;#34;}, &amp;#34;workload&amp;#34;, &amp;#34;$1&amp;#34;, &amp;#34;created_by_name&amp;#34;, &amp;#34;(.*)&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        or  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        label_replace(kube_pod_info{created_by_kind=&amp;#34;Node&amp;#34;}, &amp;#34;workload&amp;#34;, &amp;#34;node&amp;#34;, &amp;#34;&amp;#34;, &amp;#34;&amp;#34;) 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        or  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        label_replace(kube_pod_info{created_by_kind=&amp;#34;&amp;#34;}, &amp;#34;workload&amp;#34;, &amp;#34;none&amp;#34;, &amp;#34;&amp;#34;, &amp;#34;&amp;#34;) 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      )   
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    )&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ ä¼šæ³¨æ„åˆ°åœ¨è¿™ä¸ªæŒ‡æ ‡ä¸­ï¼Œæˆ‘è¿˜ä¸ &lt;code&gt;kube_pod_info&lt;/code&gt; è¿›è¡Œäº†å…³è”ï¼Œè¿™ä¸ºæˆ‘çš„æŒ‡æ ‡æä¾›äº†ä¸€äº›é¢å¤–çš„ç»´åº¦ï¼Œç‰¹åˆ«æ˜¯ &lt;code&gt;workload&lt;/code&gt;ã€‚è¿™ä»…åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªéƒ¨ç½²ä¸ä¸€ä¸ªå‘½åç©ºé—´ç›¸å¯¹åº”ï¼Œç­‰äºä¸€ä¸ªå·¥ä½œè´Ÿè½½çš„å…³ç³»æ—¶æ‰æœ‰æ•ˆã€‚è¿™æ˜¯å¯é€‰çš„ï¼Œåªæ˜¯å¸®åŠ©æˆ‘åœ¨å„ä¸ªçº§åˆ«æŸ¥çœ‹è¿™ä¸ªæŒ‡æ ‡ï¼ŒåŒ…æ‹¬ &lt;code&gt;container&lt;/code&gt;ã€&lt;code&gt;pod&lt;/code&gt;ã€&lt;code&gt;node&lt;/code&gt; æˆ– &lt;code&gt;workload&lt;/code&gt;ã€‚è¿™æ ·åšå°†è‡ªç„¶åœ°ä¸ºä½ çš„æ‰€æœ‰å®¹å™¨æä¾›æ•°æ®ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ä½ çš„ Sidecarï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-and-sizing-the-sidecar/Screenshot-2023-10-03-at-08.33.17_hu_c77072b13eab2d0e.webp 400w,
               /blog/scaling-and-sizing-the-sidecar/Screenshot-2023-10-03-at-08.33.17_hu_d14711817dacecef.webp 760w,
               /blog/scaling-and-sizing-the-sidecar/Screenshot-2023-10-03-at-08.33.17_hu_2da93c0c142b21d7.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-and-sizing-the-sidecar/Screenshot-2023-10-03-at-08.33.17_hu_c77072b13eab2d0e.webp&#34;
               width=&#34;760&#34;
               height=&#34;348&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;sidecar-ä¸å·¥ä½œè´Ÿè½½ä¸€èµ·æ‰©å±•&#34;&gt;Sidecar ä¸å·¥ä½œè´Ÿè½½ä¸€èµ·æ‰©å±•&lt;/h3&gt;
&lt;p&gt;å¯¹äº HTTP å·¥ä½œè´Ÿè½½ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ° Sidecar çš„æ‰©å±•æ–¹å¼ä¸åº•å±‚åº”ç”¨ç¨‹åºéå¸¸ç›¸ä¼¼ã€‚ä½ å¯ä»¥åœ¨ä¸Šé¢çš„æˆªå›¾ä¸­çœ‹åˆ° &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨çš„ &amp;ldquo;è®¡ç®—åˆ©ç”¨ç‡&amp;rdquo; å¦‚ä½•ç´§å¯†è·Ÿéš &lt;code&gt;master&lt;/code&gt; å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å°±æ˜¯æˆ‘çœŸæ­£å–œæ¬¢ Sidecar æ¨¡å¼çš„åœ°æ–¹ã€‚ä½ çš„ Sidecar åˆ©ç”¨ç‡ä¸ä½ çš„å·¥ä½œè´Ÿè½½åˆ©ç”¨ç‡ç´§å¯†è€¦åˆï¼Œè€Œå·¥ä½œè´Ÿè½½åˆ©ç”¨ç‡ä¸å·¥ä½œè´Ÿè½½çš„å‰¯æœ¬æ•°é‡ç´§å¯†è€¦åˆã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ°´å¹³æ‰©å±•å·¥ä½œè´Ÿè½½ï¼Œåˆ©ç”¨ç‡å°†ä¿æŒå¤§è‡´ç›¸åŒã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥çœ‹åˆ° &lt;code&gt;master&lt;/code&gt; å®¹å™¨çš„åˆ©ç”¨ç‡å³°å€¼ä¸º 75%ï¼Œè€Œ &lt;code&gt;istio-proxy&lt;/code&gt; çš„åˆ©ç”¨ç‡ä¸º 60%ï¼Œå¦‚æœæˆ‘ä»¬å°†å‰¯æœ¬æ•°é‡åŠ å€ï¼Œè¿™ä¸¤ä¸ªå€¼ä¼šæ¾æ•£å‡åŠï¼Œä½†ä¿æŒå¤§è‡´ä¸€è‡´ã€‚æˆ‘ä»¬åªæ˜¯æ°´å¹³æ‰©å±•ä¸€ä¸ª &lt;code&gt;Deployment&lt;/code&gt; å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªã€‚æˆ‘ä»¬è®¤ä¸ºè¿™æ›´å®¹æ˜“ç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å‘åº”ç”¨ç¨‹åºæ‰€æœ‰è€…æä¾›çš„æŒ‡å¯¼æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›åˆ©ç”¨ç‡åœ¨å³°å€¼æ—¶ä¿æŒåœ¨ 75% å·¦å³ã€‚åœ¨è¿™é‡Œï¼Œäººä»¬è‡ªç„¶ä¼šé—®ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ä½¿ç”¨è‡ªåŠ¨æ‰©å±•ã€‚è‡ªåŠ¨æ‰©å±•ä¾èµ–äºåº•å±‚äº‘æä¾›å•†æä¾›çš„è®¡ç®—èµ„æºã€‚æˆ‘ä»¬æ›¾ç»é‡åˆ°è¿‡å¤šæ¬¡å½±å“å®¢æˆ·çš„äº‹ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•æŒ‰éœ€æ‰©å±•ï¼ŒåŸå› æ˜¯åº•å±‚äº‘æä¾›å•†çš„å®¹é‡å­˜åœ¨é—®é¢˜ã€‚æ­¤å¤–ï¼Œè‡ªåŠ¨æ‰©å±•ä¼šå¸¦æ¥å»¶è¿Ÿï¼Œå¾ˆéš¾å¯¹çªç„¶çš„è´Ÿè½½æ€¥å‰§å¢åŠ åšå‡ºå“åº”ï¼Œå› æ­¤å®ƒåªå¯¹å…·æœ‰æ˜æ˜¾é€æ¸å­£èŠ‚æ€§çš„å·¥ä½œè´Ÿè½½æœ‰æ•ˆï¼Œå°±åƒä¸Šé¢çš„å·¥ä½œè´Ÿè½½ä¸€æ ·ã€‚æˆ‘ä»¬è®¤ä¸ºä¸è‡ªåŠ¨æ‰©å±•ç›¸å…³çš„æˆæœ¬èŠ‚çœä¸å€¼å¾—ä¸ä¸èƒ½å¯¹éœ€æ±‚åšå‡ºååº”çš„é£é™©ç›¸åŒ¹é…ï¼Œå› æ­¤æˆ‘ä»¬ä¼šç•¥å¾®è¿‡åº¦é…ç½®æˆ‘ä»¬çš„å·¥ä½œè´Ÿè½½ï¼ˆå› æ­¤æ˜¯ 75%ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œå¦‚æœä½ å¯¹è‡ªåŠ¨æ‰©å±•æ„Ÿåˆ°æ»¡æ„ï¼Œä½ å¯ä»¥åœ¨è‡ªåŠ¨æ‰©å±•é…ç½®ä¸­è®¾ç½®ç›®æ ‡ CPUï¼Œç„¶åå°±å¯ä»¥äº†ã€‚ä½ æœ‰ä¸€ä¸ªå·¥ä½œè´Ÿè½½ï¼Œä»¥åŠä¸€ä¸ªä¸ä¹‹ç´§å¯†ç›¸å…³çš„ Sidecarï¼Œå®ƒä»¬ä¸€èµ·æ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å°±æ˜¯æˆ‘å¯¹ Waypoint çš„çœ‹æ³•ã€‚å› ä¸ºåœ¨æˆ‘ä»¬çš„è®¾ç½®ä¸­ï¼Œæˆ‘ä»¬æ¯ä¸ªå·¥ä½œè´Ÿè½½éƒ½æœ‰ä¸€ä¸ª waypoint ä»£ç†ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªéœ€è¦ä»¥ä¸åŒæ–¹å¼ä½†åŒæ­¥æ‰©å±•çš„ç‹¬ç«‹éƒ¨ç½²ï¼Œè¿™å°†è§£è€¦äº†æˆ‘ä»¬è‡ªèº«æœ‰æ„å…³è”çš„ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è®¾ç½®æ­£ç¡®çš„-cpu-å’Œå†…å­˜å€¼&#34;&gt;è®¾ç½®æ­£ç¡®çš„ CPU å’Œå†…å­˜å€¼&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æœ‰ä¸€ä¸ªç›¸å¯¹å¥åº·çš„å·¥ä½œè´Ÿè½½ã€‚&lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨è¢«åˆ†é…äº†é€‚åˆå·¥ä½œè´Ÿè½½é…ç½®æ–‡ä»¶çš„ &lt;code&gt;CPU&lt;/code&gt; é‡ï¼Œå…è®¸å…¶åˆ©ç”¨ç‡ç´§å¯†è·Ÿè¸ªåº•å±‚åº”ç”¨ç¨‹åºçš„åˆ©ç”¨ç‡ã€‚ç»éªŒå‘Šè¯‰æˆ‘ï¼Œä¸€æ—¦ä½ å°†è¿™ä¸¤è€…å¯¹é½ï¼Œå®ƒä»¬å°±ä¸ä¼šæ¾æ•£å¯¹é½ã€‚å®ƒä»¬ä¼šæ¼‚ç§»çš„å”¯ä¸€æ—¶é—´æ˜¯å¦‚æœä»»ä¸€å®¹å™¨çš„æ€§èƒ½é…ç½®å‘ç”Ÿäº†æ˜¾è‘—å˜åŒ–ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœå¼€å‘äººå‘˜å°†åº”ç”¨ç¨‹åºæ€§èƒ½æé«˜äº† 2 å€ï¼Œåˆ™ &lt;code&gt;master&lt;/code&gt; çš„åˆ©ç”¨ç‡ä¼šä¸‹é™ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ AutoTraderï¼Œæˆ‘ä»¬çš„å¹³å°å›¢é˜Ÿè´Ÿè´£æ„å»ºâ€œäº¤ä»˜å¹³å°â€ï¼Œå¼€å‘äººå‘˜å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°å…¶ä¸­ï¼Œä½†åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜è´Ÿè´£ç¡®å®šå…¶å·¥ä½œè´Ÿè½½çš„å¤§å°ï¼ˆCPU å’Œ RAMï¼‰ã€‚å¹³å°å›¢é˜Ÿæ„å»ºäº†å¸®åŠ©ä»–ä»¬åšå‡ºæ˜æ™ºå†³ç­–çš„å·¥å…·ï¼Œæ¶‰åŠè¿™äº›å€¼ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ„å‘³ç€ç®€å•çš„æŠ½è±¡ã€‚æˆ‘ä»¬ä¸è®©å¼€å‘äººå‘˜ç¼–å†™ 100 ä¸ª Kubernetes æ¸…å•æ¥éƒ¨ç½²å·¥ä½œè´Ÿè½½ã€‚ä»–ä»¬ä¸éœ€è¦å…³å¿ƒ Istio &lt;code&gt;VirtualServices&lt;/code&gt;ã€&lt;code&gt;Sidecars&lt;/code&gt;ã€Kubernetes &lt;code&gt;Deployments&lt;/code&gt; æˆ–è®°ä½åœ¨å“ªé‡Œæ”¾ç½®æ³¨é‡Šä»¥æ­£ç¡®è®¾ç½® Sidecar çš„è§„æ¨¡ã€‚ç›¸åï¼Œæˆ‘ä»¬è¦æ±‚åœ¨ä»–ä»¬çš„å­˜å‚¨åº“ä¸­æä¾›ä¸€ä¸ª yaml æ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;500m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;80Mi&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;container&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1000m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;956Mi&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› æ­¤ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡çš„æ‰€æœ‰è€…è´Ÿè´£è®¾ç½®å…¶ &lt;code&gt;master&lt;/code&gt; å®¹å™¨å’Œå…¶ &lt;code&gt;istio-proxy&lt;/code&gt; çš„èµ„æºã€‚æˆ‘ä»¬çš„è´£ä»»æ˜¯æ„å»ºå·¥å…·ï¼Œå¸®åŠ©ä»–ä»¬åœ¨é€‰æ‹©è¿™äº›å€¼æ—¶åšå‡ºæ˜æ™ºå†³ç­–ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å·²ç»çœ‹åˆ°äº†æˆ‘ä»¬å¦‚ä½•åœ¨ä¸Šé¢çš„ Grafana ä»ªè¡¨æ¿ä¸­ä½¿ç”¨ &amp;ldquo;Utilisation&amp;rdquo; ç­‰æŒ‡æ ‡æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½†æˆ‘ä»¬è¿˜åšäº†ä¸€äº›ç§°ä¸º &amp;ldquo;å»ºè®®&amp;rdquo; çš„äº‹æƒ…ã€‚è¿™äº›æ˜¯æˆ‘ä»¬å‘åº”ç”¨ç¨‹åºæ‰€æœ‰è€…æä¾›çš„æœ‰å…³ä¼˜åŒ–é…ç½®å…¶æœåŠ¡çš„æç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-and-sizing-the-sidecar/Screenshot-2023-10-03-at-09.19.52_hu_5d4dab2f220435bf.webp 400w,
               /blog/scaling-and-sizing-the-sidecar/Screenshot-2023-10-03-at-09.19.52_hu_9e640c052d434866.webp 760w,
               /blog/scaling-and-sizing-the-sidecar/Screenshot-2023-10-03-at-09.19.52_hu_99d680343c72dfee.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-and-sizing-the-sidecar/Screenshot-2023-10-03-at-09.19.52_hu_5d4dab2f220435bf.webp&#34;
               width=&#34;760&#34;
               height=&#34;422&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º &lt;code&gt;ProxyMasterImbalance&lt;/code&gt; çš„å»ºè®®ã€‚å¦‚æœæˆ‘ä»¬æ£€æµ‹åˆ°ç»™å®šå·¥ä½œè´Ÿè½½å†…çš„ &lt;code&gt;master&lt;/code&gt; å’Œ &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨ä¹‹é—´çš„æ¼‚ç§»è¶…è¿‡ 30%ï¼Œåˆ™æ­¤å»ºè®®å°†å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚ä»¥ä¸‹æ˜¯æ­¤å»ºè®®è§¦å‘çš„ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-and-sizing-the-sidecar/Screenshot-2023-10-03-at-09.44.09_hu_c560697ea23af1e5.webp 400w,
               /blog/scaling-and-sizing-the-sidecar/Screenshot-2023-10-03-at-09.44.09_hu_6c4dee9e209a2684.webp 760w,
               /blog/scaling-and-sizing-the-sidecar/Screenshot-2023-10-03-at-09.44.09_hu_8dda24d47383af4c.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-and-sizing-the-sidecar/Screenshot-2023-10-03-at-09.44.09_hu_c560697ea23af1e5.webp&#34;
               width=&#34;760&#34;
               height=&#34;58&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h3&gt;
&lt;p&gt;å¸Œæœ›ä½ å¯ä»¥çœ‹åˆ°åœ¨å¤§å°è°ƒæ•´ Sidecar æ–¹é¢ï¼Œå®ƒå¦‚ä½•å¯ä»¥è½»æ¾åœ°èå…¥åˆ°ä½ ç°æœ‰çš„ç”¨äºå¤§å°è°ƒæ•´å·¥ä½œè´Ÿè½½çš„ä¸šåŠ¡æµç¨‹ä¸­ã€‚æ— è®ºå¦‚ä½•ï¼Œä½ éƒ½åº”è¯¥è¿™æ ·åšï¼Œä»¥ä¿æŒä½ çš„åŸºç¡€æ¶æ„çš„å¥åº·åˆ©ç”¨ç‡ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»å»ºç«‹äº†ä¸€ç§æ–‡åŒ–ï¼Œå°ç»„å…³å¿ƒå¹¶æ‹¥æœ‰ä»–ä»¬çš„è½¯ä»¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œï¼Œå…¶ä¸­åŒ…æ‹¬å…³é”®çš„ CFRï¼ˆæˆæœ¬ï¼‰ï¼Œä»–ä»¬çŸ¥é“é€šè¿‡æŒæ¡è¿™äº›äº‹ç‰©ï¼Œä»–ä»¬æ­£åœ¨ä¸ºæ›´å¤§çš„ç›®æ ‡åšå‡ºè´¡çŒ®ï¼Œæ€»ä½“è€Œè¨€ï¼Œä»–ä»¬åšåˆ°äº†ã€‚è‡³å…³é‡è¦çš„æ˜¯ï¼Œä»–ä»¬å·²ç»å…³å¿ƒä»–ä»¬çš„ &lt;code&gt;master&lt;/code&gt; å®¹å™¨åˆ©ç”¨ç‡ï¼Œå› æ­¤ &lt;code&gt;istio-proxy&lt;/code&gt; åªæ˜¯ä»–ä»¬éœ€è¦è®¾ç½® 2 ä¸ªå€¼ï¼ˆCPU/å†…å­˜ï¼‰çš„å¦ä¸€ä¸ªå®¹å™¨ï¼Œæˆ‘ä»¬æä¾›äº†ä½¿å…¶å°½å¯èƒ½å®¹æ˜“çš„æ•°æ®ï¼Œè€Œåœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ - è¿™åªæ˜¯ä½ éœ€è¦è°ƒæ•´ä¸€æ¬¡çš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è¿˜æƒ³æŒ‡å‡ºï¼Œè¿™ç¯‡æ–‡ç« ä¸“é—¨æ€è€ƒäº†è§„æ¨¡çš„é—®é¢˜ã€‚å°†ä»£ç†ä¸åº”ç”¨ç¨‹åºåˆ†ç¦»å‡ºæ¥è¿˜å­˜åœ¨å…¶ä»–æ½œåœ¨ä¼˜åŠ¿ï¼ˆä¾‹å¦‚éš”ç¦»å‡çº§ï¼‰ã€‚ä¸è¿‡å†æ¬¡å¼ºè°ƒï¼Œæˆ‘ä¸ªäººè®¤ä¸ºè¿™æœ‰åˆ©æœ‰å¼Šï¼ˆå°±åƒæŠ€æœ¯ä¸­çš„å¤§å¤šæ•°å†³ç­–ä¸€æ ·ï¼‰ï¼Œä½†è¿™æ˜¯å¦ä¸€å¤©çš„åšå®¢æ–‡ç« ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å°†å‡ºå£æµé‡è·¯ç”±åˆ°é€šé…ç¬¦ç›®æ ‡</title>
      <link>https://cloudnativecn.com/blog/istio-egress-sni/</link>
      <pubDate>Fri, 01 Dec 2023 15:33:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-egress-sni/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://istio.io/latest/blog/2023/egress-sni/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/latest/blog/2023/egress-sni/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‘˜è¦ï¼šä¸€ç§é€šç”¨æ–¹æ³•ï¼Œç”¨äºåŠ¨æ€è®¾ç½®å‡ºå£ç½‘å…³ï¼Œå¯ä»¥å°†æµé‡è·¯ç”±åˆ°ä¸€ç»„å—é™åˆ¶çš„ç›®æ ‡è¿œç¨‹ä¸»æœºï¼ŒåŒ…æ‹¬é€šé…ç¬¦åŸŸåã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ Istio å¤„ç†æ¥è‡ªç½‘æ ¼å¤–éƒ¨ç›®æ ‡çš„åº”ç”¨ç¨‹åºå‘èµ·çš„æµé‡ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ç†Ÿæ‚‰å‡ºå£ç½‘å…³çš„æ¦‚å¿µã€‚å‡ºå£ç½‘å…³å¯ç”¨äºç›‘æ§å¹¶è½¬å‘æ¥è‡ªç½‘æ ¼å†…åº”ç”¨ç¨‹åºçš„æµé‡åˆ°ç½‘æ ¼å¤–çš„ä½ç½®ã€‚å¦‚æœæ‚¨çš„ç³»ç»Ÿåœ¨å—é™ç¯å¢ƒä¸­è¿è¡Œï¼Œå¹¶ä¸”å¸Œæœ›æ§åˆ¶ä»ç½‘æ ¼åˆ°å…¬å…±äº’è”ç½‘ä¸Šå¯ä»¥è®¿é—®ä»€ä¹ˆï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;https://archive.istio.io/v1.13/docs/tasks/traffic-management/egress/wildcard-egress-hosts/#wildcard-configuration-for-arbitrary-domains&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹ Istio æ–‡æ¡£&lt;/a&gt;ä¸­ï¼Œç›´åˆ°ç‰ˆæœ¬ 1.13ï¼ŒåŒ…æ‹¬é…ç½®å‡ºå£ç½‘å…³ä»¥å¤„ç†ä»»æ„é€šé…ç¬¦åŸŸåçš„ç”¨ä¾‹ï¼Œä½†éšåè¢«ç§»é™¤ï¼Œå› ä¸ºæ–‡æ¡£ä¸­çš„è§£å†³æ–¹æ¡ˆæ²¡æœ‰å¾—åˆ°å®˜æ–¹æ”¯æŒæˆ–æ¨èï¼Œè€Œä¸”å¯èƒ½åœ¨å°†æ¥çš„ Istio ç‰ˆæœ¬ä¸­å¤±æ•ˆã€‚å°½ç®¡å¦‚æ­¤ï¼Œæ—§çš„è§£å†³æ–¹æ¡ˆä»ç„¶å¯ä»¥åœ¨ 1.20 ä¹‹å‰çš„ Istio ç‰ˆæœ¬ä¸­ä½¿ç”¨ã€‚ç„¶è€Œï¼ŒIstio 1.20 æ”¾å¼ƒäº†ä¸€äº›å¯¹è¯¥æ–¹æ³•å·¥ä½œæ‰€éœ€çš„ Envoy åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡è¯•å›¾æè¿°æˆ‘ä»¬å¦‚ä½•è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶é€šè¿‡ä½¿ç”¨ä¸ Istio ç‰ˆæœ¬æ— å…³çš„ç»„ä»¶å’Œ Envoy åŠŸèƒ½ä»¥åŠæ— éœ€å•ç‹¬çš„ Nginx SNI ä»£ç†æ¥å¡«è¡¥è¿™ä¸ªç©ºç™½ã€‚æˆ‘ä»¬çš„æ–¹æ³•å…è®¸æ—§è§£å†³æ–¹æ¡ˆçš„ç”¨æˆ·åœ¨ç³»ç»Ÿé¢ä¸´ Istio 1.20 çš„é‡å¤§å˜åŒ–ä¹‹å‰æ— ç¼è¿ç§»é…ç½®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éœ€è¦è§£å†³çš„é—®é¢˜&#34;&gt;éœ€è¦è§£å†³çš„é—®é¢˜&lt;/h2&gt;
&lt;p&gt;å½“å‰æ–‡æ¡£è®°å½•çš„å‡ºå£ç½‘å…³ç”¨ä¾‹ä¾èµ–äºæµé‡çš„ç›®æ ‡ï¼ˆä¸»æœºåï¼‰åœ¨ &lt;code&gt;VirtualService&lt;/code&gt; ä¸­é™æ€é…ç½®ï¼Œå‘Šè¯‰å‡ºå£ç½‘å…³ pod ä¸­çš„ Envoy åœ¨å“ªé‡Œ TCP ä»£ç†åŒ¹é…çš„å‡ºç«™è¿æ¥ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å¤šä¸ªï¼Œç”šè‡³æ˜¯é€šé…ç¬¦çš„ DNS åç§°æ¥åŒ¹é…è·¯ç”±æ¡ä»¶ï¼Œä½†æ˜¯æ‚¨æ— æ³•å°†æµé‡è·¯ç”±åˆ°åº”ç”¨ç¨‹åºè¯·æ±‚ä¸­æŒ‡å®šçš„ç¡®åˆ‡ä½ç½®ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åŒ¹é… &lt;code&gt;*.wikipedia.org&lt;/code&gt; çš„ç›®æ ‡æµé‡ï¼Œä½†ç„¶åæ‚¨éœ€è¦å°†æµé‡è½¬å‘åˆ°å•ä¸ªæœ€ç»ˆç›®æ ‡ï¼Œä¾‹å¦‚ &lt;code&gt;en.wikipedia.org&lt;/code&gt;ã€‚å¦‚æœæœ‰å¦ä¸€ä¸ªæœåŠ¡ï¼Œä¾‹å¦‚ &lt;code&gt;anyservice.wikipedia.org&lt;/code&gt;ï¼Œå®ƒä¸æ˜¯ç”±ä¸ &lt;code&gt;en.wikipedia.org&lt;/code&gt; ç›¸åŒçš„æœåŠ¡å™¨æ‰˜ç®¡çš„ï¼Œé‚£ä¹ˆå¯¹è¯¥ä¸»æœºçš„æµé‡å°†å¤±è´¥ã€‚è¿™æ˜¯å› ä¸ºå°½ç®¡ HTTP è´Ÿè½½çš„ TLS æ¡æ‰‹ä¸­çš„ç›®æ ‡ä¸»æœºååŒ…å« &lt;code&gt;anyservice.wikipedia.org&lt;/code&gt;ï¼Œä½† &lt;code&gt;en.wikipedia.org&lt;/code&gt; æœåŠ¡å™¨å°†æ— æ³•ä¸ºè¯¥è¯·æ±‚æä¾›æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é«˜å±‚æ¬¡ä¸Šï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯åœ¨æ¯ä¸ªæ–°çš„ç½‘å…³è¿æ¥ä¸­æ£€æŸ¥åº”ç”¨ç¨‹åº TLS æ¡æ‰‹ä¸­çš„åŸå§‹æœåŠ¡å™¨åç§°ï¼ˆSNI æ‰©å±•ï¼‰ï¼Œå¹¶å°†å…¶ç”¨ä½œåŠ¨æ€ TCP ä»£ç†ç¦»å¼€ç½‘å…³çš„ç›®æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é€šè¿‡å‡ºå£ç½‘å…³é™åˆ¶å‡ºå£æµé‡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦é”å®šå‡ºå£ç½‘å…³ï¼Œä»¥ä¾¿åªèƒ½ç”±ç½‘æ ¼å†…çš„å®¢æˆ·ç«¯ä½¿ç”¨ã€‚è¿™é€šè¿‡åœ¨åº”ç”¨ç¨‹åº sidecar å’Œç½‘å…³ä¹‹é—´å¼ºåˆ¶æ‰§è¡Œ &lt;code&gt;ISTIO_MUTUAL&lt;/code&gt;ï¼ˆmTLS å¯¹ç­‰èº«ä»½éªŒè¯ï¼‰æ¥å®ç°ã€‚è¿™æ„å‘³ç€åº”ç”¨ç¨‹åº L7 è´Ÿè½½ä¸Šå°†æœ‰ä¸¤å±‚ TLSã€‚ä¸€å±‚æ˜¯åº”ç”¨ç¨‹åºå‘èµ·çš„ç«¯åˆ°ç«¯ TLS ä¼šè¯ï¼Œç”±æœ€ç»ˆçš„è¿œç¨‹ç›®æ ‡ç»ˆæ­¢ï¼Œå¦ä¸€å±‚æ˜¯ Istio mTLS ä¼šè¯ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜è¦è®°ä½çš„ä¸€ä»¶äº‹æ˜¯ï¼Œä¸ºäº†å‡è½»ä»»ä½•æ½œåœ¨çš„åº”ç”¨ç¨‹åº pod æŸåï¼Œåº”ç”¨ç¨‹åº sidecar å’Œç½‘å…³éƒ½åº”æ‰§è¡Œä¸»æœºååˆ—è¡¨æ£€æŸ¥ã€‚è¿™æ ·ï¼Œä»»ä½•è¢«å…¥ä¾µçš„åº”ç”¨ç¨‹åº pod ä»ç„¶åªèƒ½è®¿é—®å…è®¸çš„ç›®æ ‡ï¼Œè€Œä¸èƒ½è®¿é—®æ›´å¤šå†…å®¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½çº§åˆ«çš„-envoy-ç¼–ç¨‹æ‹¯æ•‘&#34;&gt;ä½çº§åˆ«çš„ Envoy ç¼–ç¨‹æ‹¯æ•‘&lt;/h2&gt;
&lt;p&gt;æœ€è¿‘çš„ Envoy ç‰ˆæœ¬åŒ…æ‹¬ä¸€ç§åŠ¨æ€ TCP è½¬å‘ä»£ç†è§£å†³æ–¹æ¡ˆï¼Œå®ƒä½¿ç”¨æ¯ä¸ªè¿æ¥çš„ SNI å¤´æ¥ç¡®å®šåº”ç”¨ç¨‹åºè¯·æ±‚çš„ç›®æ ‡ã€‚è™½ç„¶ Istio &lt;code&gt;VirtualService&lt;/code&gt; ä¸èƒ½é…ç½®åƒè¿™æ ·çš„ç›®æ ‡ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code&gt;EnvoyFilter&lt;/code&gt; æ¥æ›´æ”¹ Istio ç”Ÿæˆçš„è·¯ç”±æŒ‡ä»¤ï¼Œä»¥ä¾¿ä½¿ç”¨ SNI å¤´æ¥ç¡®å®šç›®æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;è¦ä½¿æ‰€æœ‰è¿™äº›å·¥ä½œï¼Œæˆ‘ä»¬é¦–å…ˆé…ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„å‡ºå£ç½‘å…³æ¥ç›‘å¬å‡ºç«™æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;DestinationRule&lt;/code&gt; å’Œ &lt;code&gt;VirtualService&lt;/code&gt;ï¼Œæˆ‘ä»¬æŒ‡ç¤ºåº”ç”¨ç¨‹åº sidecar å°†æµé‡ï¼ˆé’ˆå¯¹ä¸€ç»„é€‰å®šçš„ä¸»æœºåï¼‰è·¯ç”±åˆ°è¯¥ç½‘å…³ï¼Œä½¿ç”¨ Istio mTLSã€‚åœ¨ç½‘å…³ pod çš„ä¸€ä¾§ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸Šé¢æåˆ°çš„ &lt;code&gt;EnvoyFilter&lt;/code&gt; æ¥æ„å»º SNI è½¬å‘å™¨ï¼Œå¼•å…¥äº†å†…éƒ¨ Envoy ç›‘å¬å™¨å’Œé›†ç¾¤ï¼Œä»¥ä½¿å…¶å…¨éƒ¨å·¥ä½œã€‚æœ€åï¼Œæˆ‘ä»¬å°†ç½‘å…³å®ç°çš„ TCP ä»£ç†çš„å†…éƒ¨ç›®æ ‡è¡¥ä¸åˆ°å†…éƒ¨ SNI è½¬å‘å™¨ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å›¾è¡¨æ˜¾ç¤ºäº†ç«¯åˆ°ç«¯è¯·æ±‚æµç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å…·æœ‰ä»»æ„åŸŸåçš„å‡ºå£-sni-è·¯ç”±&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å…·æœ‰ä»»æ„åŸŸåçš„å‡ºå£ SNI è·¯ç”±&#34; srcset=&#34;
               /blog/istio-egress-sni/egress-sni-flow_hu_b7450405cb39fbdb.webp 400w,
               /blog/istio-egress-sni/egress-sni-flow_hu_1a3793996c77b596.webp 760w,
               /blog/istio-egress-sni/egress-sni-flow_hu_299eabed56805a9d.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-egress-sni/egress-sni-flow_hu_b7450405cb39fbdb.webp&#34;
               width=&#34;709&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å…·æœ‰ä»»æ„åŸŸåçš„å‡ºå£ SNI è·¯ç”±
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²ç¤ºä¾‹&#34;&gt;éƒ¨ç½²ç¤ºä¾‹&lt;/h2&gt;
&lt;p&gt;è¦éƒ¨ç½²ç¤ºä¾‹é…ç½®ï¼Œé¦–å…ˆåˆ›å»º &lt;code&gt;istio-egress&lt;/code&gt; å‘½åç©ºé—´ï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹ YAML éƒ¨ç½²ä¸€ä¸ªå‡ºå£ç½‘å…³ï¼Œä»¥åŠä¸€äº› RBAC å’Œå…¶ &lt;code&gt;Service&lt;/code&gt;ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç½‘å…³æ³¨å…¥æ–¹æ³•åˆ›å»ºç½‘å…³ã€‚æ ¹æ®æ‚¨çš„å®‰è£…æ–¹æ³•ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä»¥ä¸åŒçš„æ–¹å¼éƒ¨ç½²å®ƒï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ &lt;code&gt;IstioOperator&lt;/code&gt; CR æˆ–ä½¿ç”¨ Helmï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# å°† egressgateway æ”¾å…¥ Service æ³¨å†Œä¸­çš„æ–° k8s é›†ç¾¤æœåŠ¡ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åº sidecar å¯ä»¥åœ¨ç½‘æ ¼å†…å°†æµé‡è·¯ç”±åˆ°å®ƒã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;egressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-egress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterIP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;egressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tls-egress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ä½¿ç”¨æ³¨å…¥æ–¹æ³•éƒ¨ç½²ç½‘å…³&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-egressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-egress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;egressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;inject.istio.io/templates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;egressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sidecar.istio.io/inject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;auto&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ¯æ¬¡ pod å¯åŠ¨æ—¶éƒ½ä¼šè‡ªåŠ¨æ›´æ–°é•œåƒã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;securityContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;capabilities&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;drop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;ALL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runAsUser&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runAsGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# è®¾ç½®è§’è‰²ä»¥å…è®¸è¯»å– TLS å‡­æ®&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Role&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-egressgateway-sds&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-egress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;secrets&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;get&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;watch&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;list&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;security.openshift.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resourceNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;anyuid&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;securitycontextconstraints&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;use&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;RoleBinding&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-egressgateway-sds&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-egress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;roleRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Role&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-egressgateway-sds&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subjects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceAccount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éªŒè¯ &lt;code&gt;istiod&lt;/code&gt; å’Œç½‘å…³æ—¥å¿—æ˜¯å¦å­˜åœ¨ä»»ä½•é”™è¯¯æˆ–è­¦å‘Šã€‚å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ‚¨çš„ç½‘æ ¼ sidecar ç°åœ¨æ­£åœ¨å°† &lt;code&gt;*.wikipedia.org&lt;/code&gt; è¯·æ±‚è·¯ç”±åˆ°æ‚¨çš„ç½‘å…³ podï¼Œè€Œç½‘å…³ pod ç„¶åå°†å®ƒä»¬è½¬å‘åˆ°åº”ç”¨ç¨‹åºè¯·æ±‚ä¸­æŒ‡å®šçš„ç¡®åˆ‡è¿œç¨‹ä¸»æœºã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¯•ä¸€ä¸‹&#34;&gt;è¯•ä¸€ä¸‹&lt;/h2&gt;
&lt;p&gt;ä¸å…¶ä»– Istio å‡ºå£ç¤ºä¾‹ä¸€æ ·ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ &lt;a href=&#34;https://github.com/istio/istio/tree/release-1.20/samples/sleep&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sleep&lt;/a&gt; pod ä½œä¸ºå‘é€è¯·æ±‚çš„æµ‹è¯•æºã€‚å‡è®¾åœ¨æ‚¨çš„é»˜è®¤å‘½åç©ºé—´ä¸­å¯ç”¨äº†è‡ªåŠ¨ sidecar æ³¨å…¥ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éƒ¨ç½²æµ‹è¯•åº”ç”¨ç¨‹åºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.20/samples/sleep/sleep.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è·å–æ‚¨çš„ sleep å’Œç½‘å…³ podsï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;SOURCE_POD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sleep -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;={&lt;/span&gt;.items..metadata.name&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;GATEWAY_POD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -n istio-egress -l &lt;span class=&#34;nv&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;egressgateway -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;={&lt;/span&gt;.items..metadata.name&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥ç¡®è®¤æ‚¨èƒ½å¤Ÿè¿æ¥åˆ° &lt;code&gt;wikipedia.org&lt;/code&gt; ç½‘ç«™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$SOURCE_POD&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; -c sleep -- sh -c &lt;span class=&#34;s1&#34;&gt;&amp;#39;curl -s https://en.wikipedia.org/wiki/Main_Page | grep -o &amp;#34;&amp;lt;title&amp;gt;.*&amp;lt;/title&amp;gt;&amp;#34;; curl -s https://de.wikipedia.org/wiki/Wikipedia:Hauptseite | grep -o &amp;#34;&amp;lt;title&amp;gt;.*&amp;lt;/title&amp;gt;&amp;#34;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;title&amp;gt;Wikipedia, the free encyclopedia&amp;lt;/title&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;title&amp;gt;Wikipedia â€“ Die freie EnzyklopÃ¤die&amp;lt;/title&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥è®¿é—®è‹±è¯­å’Œå¾·è¯­çš„ &lt;code&gt;wikipedia.org&lt;/code&gt; å­åŸŸåï¼Œéå¸¸æ£’ï¼&lt;/p&gt;
&lt;p&gt;é€šå¸¸ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä¼š&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/egress/egress-control/#change-to-the-blocking-by-default-policy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é˜»æ­¢æœªç»é…ç½®çš„å¤–éƒ¨è¯·æ±‚&lt;/a&gt;ï¼Œè¿™äº›è¯·æ±‚æœªç»è¿‡å‡ºå£ç½‘å…³é‡å®šå‘ã€‚ä½†ç”±äºæˆ‘ä»¬åœ¨æµ‹è¯•ç¯å¢ƒä¸­æ²¡æœ‰è¿™æ ·åšï¼Œè®©æˆ‘ä»¬è®¿é—®å¦ä¸€ä¸ªå¤–éƒ¨ç«™ç‚¹è¿›è¡Œæ¯”è¾ƒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$SOURCE_POD&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; -c sleep -- sh -c &lt;span class=&#34;s1&#34;&gt;&amp;#39;curl -s https://cloud.ibm.com/login | grep -o &amp;#34;&amp;lt;title&amp;gt;.*&amp;lt;/title&amp;gt;&amp;#34;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;title&amp;gt;IBM Cloud&amp;lt;/title&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”±äºæˆ‘ä»¬åœ¨æ¸…å•ä¸­å…¨å±€å¯ç”¨äº†è®¿é—®æ—¥å¿—è®°å½•ï¼ˆä½¿ç”¨ &lt;code&gt;Telemetry&lt;/code&gt; CRï¼‰ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ£€æŸ¥æ—¥å¿—ä»¥æŸ¥çœ‹ä»£ç†å¦‚ä½•å¤„ç†ä¸Šè¿°è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæ£€æŸ¥ç½‘å…³æ—¥å¿—ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl logs -n istio-egress &lt;span class=&#34;nv&#34;&gt;$GATEWAY_POD&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;...&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2023-11-24T13:21:52.798Z&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;- - -&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; - - - &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;813&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;111152&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; - &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;185.15.59.224:443&amp;#34;&lt;/span&gt; dynamic_forward_proxy_cluster 172.17.5.170:48262 envoy://sni_listener/ envoy://internal_client_address/ en.wikipedia.org -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2023-11-24T13:21:52.798Z&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;- - -&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; - - - &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1531&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;111950&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; - &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy://sni_listener/&amp;#34;&lt;/span&gt; sni_cluster envoy://internal_client_address/ 172.17.5.170:8443 172.17.34.35:55102 outbound_.443_.wildcard_.egressgateway.istio-egress.svc.cluster.local -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2023-11-24T13:21:53.000Z&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;- - -&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; - - - &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;821&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;92848&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;49&lt;/span&gt; - &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;185.15.59.224:443&amp;#34;&lt;/span&gt; dynamic_forward_proxy_cluster 172.17.5.170:48278 envoy://sni_listener/ envoy://internal_client_address/ de.wikipedia.org -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2023-11-24T13:21:53.000Z&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;- - -&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; - - - &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1539&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;93646&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;50&lt;/span&gt; - &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy://sni_listener/&amp;#34;&lt;/span&gt; sni_cluster envoy://internal_client_address/ 172.17.5.170:8443 172.17.34.35:55108 outbound_.443_.wildcard_.egressgateway.istio-egress.svc.cluster.local -
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæœ‰å››æ¡æ—¥å¿—æ¡ç›®ï¼Œä»£è¡¨æˆ‘ä»¬ä¸‰ä¸ª curl è¯·æ±‚ä¸­çš„ä¸¤ä¸ªã€‚æ¯ä¸€å¯¹æ˜¾ç¤ºäº†å•ä¸ªè¯·æ±‚å¦‚ä½•é€šè¿‡ envoy æµé‡å¤„ç†ç®¡é“æµåŠ¨ã€‚å®ƒä»¬ä»¥ç›¸åçš„é¡ºåºæ‰“å°ï¼Œä½†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¬¬ 2 å’Œç¬¬ 4 è¡Œæ˜¾ç¤ºè¯·æ±‚åˆ°è¾¾äº†ç½‘å…³æœåŠ¡ï¼Œå¹¶é€šè¿‡å†…éƒ¨çš„ &lt;code&gt;sni_cluster&lt;/code&gt; ç›®æ ‡ã€‚ç¬¬ 1 å’Œç¬¬ 3 è¡Œæ˜¾ç¤ºæœ€ç»ˆç›®æ ‡æ˜¯ä»å†…éƒ¨ SNI å¤´ä¸­ç¡®å®šçš„ï¼Œå³åº”ç”¨ç¨‹åºè®¾ç½®çš„ç›®æ ‡ä¸»æœºã€‚è¯·æ±‚å°†è½¬å‘åˆ° &lt;code&gt;dynamic_forward_proxy_cluster&lt;/code&gt;ï¼Œæœ€ç»ˆä» Envoy å‘é€åˆ°è¿œç¨‹ç›®æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;å¾ˆå¥½ï¼Œä½†æ˜¯ç¬¬ä¸‰ä¸ªè¯·æ±‚åˆ° IBM Cloud åœ¨å“ªé‡Œï¼Ÿè®©æˆ‘ä»¬æ£€æŸ¥ sidecar çš„æ—¥å¿—ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl logs &lt;span class=&#34;nv&#34;&gt;$SOURCE_POD&lt;/span&gt; -c istio-proxy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;...&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2023-11-24T13:21:52.793Z&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;- - -&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; - - - &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;813&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;111152&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;61&lt;/span&gt; - &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.17.5.170:8443&amp;#34;&lt;/span&gt; outbound&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;443&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;wildcard&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;egressgateway.istio-egress.svc.cluster.local 172.17.34.35:55102 208.80.153.224:443 172.17.34.35:37020 en.wikipedia.org -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2023-11-24T13:21:52.994Z&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;- - -&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; - - - &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;821&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;92848&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;55&lt;/span&gt; - &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.17.5.170:8443&amp;#34;&lt;/span&gt; outbound&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;443&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;wildcard&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;egressgateway.istio-egress.svc.cluster.local 172.17.34.35:55108 208.80.153.224:443 172.17.34.35:37030 de.wikipedia.org -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2023-11-24T13:21:55.197Z&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;- - -&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; - - - &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;805&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;15199&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;158&lt;/span&gt; - &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;104.102.54.251:443&amp;#34;&lt;/span&gt; PassthroughCluster 172.17.34.35:45584 104.102.54.251:443 172.17.34.35:45582 cloud.ibm.com -
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼ŒWikipedia è¯·æ±‚é€šè¿‡ç½‘å…³å‘é€ï¼Œè€Œå¯¹ IBM Cloud çš„è¯·æ±‚ç›´æ¥ä»åº”ç”¨ç¨‹åº pod å‘é€åˆ°äº’è”ç½‘ï¼Œå¦‚ &lt;code&gt;PassthroughCluster&lt;/code&gt; æ—¥å¿—æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨å‡ºå£ç½‘å…³å®ç°äº†å¯¹ egress HTTPS/TLS æµé‡çš„å—æ§è·¯ç”±ï¼Œæ”¯æŒä»»æ„å’Œé€šé…ç¬¦&lt;/p&gt;
&lt;p&gt;åŸŸåã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ¬æ–‡ä¸­æ˜¾ç¤ºçš„ç¤ºä¾‹å°†æ‰©å±•ä»¥æ”¯æŒé«˜å¯ç”¨æ€§è¦æ±‚ï¼ˆä¾‹å¦‚ï¼Œæ·»åŠ åŒºåŸŸæ„ŸçŸ¥ç½‘å…³ &lt;code&gt;Deployment&lt;/code&gt; ç­‰ï¼‰ï¼Œå¹¶é™åˆ¶æ‚¨çš„åº”ç”¨ç¨‹åºç›´æ¥è®¿é—®å¤–éƒ¨ç½‘ç»œï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºåªèƒ½é€šè¿‡ç½‘å…³è®¿é—®å…¬å…±ç½‘ç»œï¼Œè€Œè¯¥ç½‘å…³ä»…é™äºä¸€ç»„é¢„å®šä¹‰çš„è¿œç¨‹ä¸»æœºåã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªè§£å†³æ–¹æ¡ˆå¾ˆå®¹æ˜“æ‰©å±•ã€‚æ‚¨å¯ä»¥åœ¨é…ç½®ä¸­åŒ…å«å¤šä¸ªåŸŸåï¼Œå¹¶ä¸”ä¸€æ—¦éƒ¨ç½²ï¼Œå®ƒä»¬å°†è¢«åˆ—å…¥å…è®¸åˆ—è¡¨ï¼æ— éœ€ä¸ºæ¯ä¸ªåŸŸåé…ç½® &lt;code&gt;VirtualService&lt;/code&gt; æˆ–å…¶ä»–è·¯ç”±è¯¦ç»†ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼ŒåŸŸååœ¨é…ç½®ä¸­çš„å¤šä¸ªåœ°æ–¹åˆ—å‡ºã€‚å¦‚æœä½¿ç”¨ CI/CD å·¥å…·ï¼ˆä¾‹å¦‚ Kustomizeï¼‰ï¼Œæœ€å¥½å°†åŸŸååˆ—è¡¨æå–åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œä»¥ä»ä¸­å‘ˆç°æ‰€éœ€çš„é…ç½®èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;å°±æ˜¯è¿™æ ·äº†ï¼å¸Œæœ›è¿™å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ã€‚å¦‚æœæ‚¨æ˜¯ä¹‹å‰ä½¿ç”¨ Nginx çš„è§£å†³æ–¹æ¡ˆçš„ç°æœ‰ç”¨æˆ·ï¼Œç°åœ¨å¯ä»¥åœ¨å‡çº§åˆ° Istio 1.20 ä¹‹å‰è¿ç§»åˆ°æ­¤æ–¹æ³•ï¼Œå¦åˆ™ä¼šå½±å“æ‚¨å½“å‰çš„è®¾ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ç¥æ‚¨æ„‰å¿«çš„ SNI è·¯ç”±ï¼&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒèµ„æ–™&#34;&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/listeners/network_filters/sni_dynamic_forward_proxy_filter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy å¯¹äº SNI è½¬å‘å™¨çš„æ–‡æ¡£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://archive.istio.io/v1.13/docs/tasks/traffic-management/egress/wildcard-egress-hosts/#wildcard-configuration-for-arbitrary-domains&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…ˆå‰çš„è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨ Nginx ä½œä¸ºç½‘å…³ä¸­çš„ SNI ä»£ç†å®¹å™¨&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>KubeCon åŒ—ç¾å¤§ä¼šåŒåœºæ´»åŠ¨ IstioCon 2023 å›é¡¾</title>
      <link>https://cloudnativecn.com/blog/istiocon-at-kubecon-na/</link>
      <pubDate>Tue, 21 Nov 2023 15:33:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istiocon-at-kubecon-na/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://istio.io/latest/blog/2023/istio-at-kubecon-na/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/latest/blog/2023/istio-at-kubecon-na/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‘˜è¦ï¼šæœ¬æ–‡ä»‹ç»äº† Istio åœ¨ KubeCon North America 2023 çš„æ´»åŠ¨å®‰æ’ï¼ŒåŒ…æ‹¬ Istio Dayã€ä¸»é¢˜æ¼”è®²ã€ç»´æŠ¤è€…è·Ÿè¸ªå’ŒèµåŠ©å•†ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å¿«é€Ÿå›é¡¾ä¸€ä¸‹ 2023 å¹´ KubeCon åŒ—ç¾å¤§ä¼šåœ¨èŠåŠ å“¥ McCormick Place ä¸¾è¡Œçš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;å¼€æºå’Œäº‘åŸç”Ÿç¤¾åŒºäº 11 æœˆ 6 æ—¥è‡³ 9 æ—¥åœ¨èŠåŠ å“¥é½èšä¸€å ‚ï¼Œå‚åŠ äº† 2023 å¹´çš„æœ€åä¸€åœº KubeConã€‚è¿™å››å¤©çš„ä¼šè®®ç”±äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šç»„ç»‡ï¼Œå¯¹äº Istio æ¥è¯´å¯è°“æ˜¯â€œä¹è¶£ç¿»å€â€ï¼Œå› ä¸ºæˆ‘ä»¬ä» 4 æœˆçš„æ¬§æ´²åŠå¤©æ´»åŠ¨å‘å±•åˆ°äº†å…¨å¤©å…±åŒä¸¾åŠçš„æ´»åŠ¨ã€‚æ›´ä»¤äººå…´å¥‹çš„æ˜¯ï¼ŒIstio Day åŒ—ç¾ä¹Ÿæ ‡å¿—ç€æˆ‘ä»¬ä½œä¸º CNCF æ¯•ä¸šé¡¹ç›®çš„é¦–æ¬¡æ´»åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;éšç€ Istio Day åŒ—ç¾çš„ç»“æŸï¼Œæˆ‘ä»¬ 2023 å¹´ä¸»è¦ç¤¾åŒºæ´»åŠ¨ä¹Ÿå‘Šä¸€æ®µè½ã€‚å¦‚æœä½ é”™è¿‡äº†å®ƒä»¬ï¼Œ&lt;a href=&#34;https://istio.io/latest/blog/2023/istio-at-kubecon-eu/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Day æ¬§æ´²&lt;/a&gt;äº 4 æœˆä¸¾è¡Œï¼Œè€Œä¸æˆ‘ä»¬çš„&lt;a href=&#34;https://events.istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è™šæ‹Ÿ IstioCon 2023&lt;/a&gt;æ´»åŠ¨ä¸€åŒä¸¾è¡Œçš„&lt;a href=&#34;https://istio.io/latest/blog/2023/istiocon-china/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2023 å¹´ IstioCon ä¸­å›½&lt;/a&gt;äº 9 æœˆ 26 æ—¥åœ¨ä¸­å›½ä¸Šæµ·ä¸¾è¡Œã€‚&lt;/p&gt;
&lt;p&gt;Istio Day ä»¥ç”±ç¨‹åºå§”å‘˜ä¼šä¸»å¸­ Faseela K å’Œ Zack Butcher ä¸»æŒçš„å¼€å¹•ä¸»é¢˜æ¼”è®²æ‹‰å¼€å¸·å¹•ã€‚æ¼”è®²å¼ºè°ƒäº†æˆ‘ä»¬çš„è´¡çŒ®è€…ã€ç»´æŠ¤è€…ã€å‘å¸ƒç»ç†å’Œç”¨æˆ·çš„æ—¥å¸¸åŠªåŠ›ï¼Œå¹¶ä¸ºæˆ‘ä»¬çš„é¡¶çº§è´¡çŒ®è€…å’Œç¤¾åŒºåŠ©æ‰‹é¢å‘äº†ä¸€äº›å¥–é¡¹ã€‚Rob Salmond å’Œ Andrea Ma å› åœ¨ Istio ç¤¾åŒºçš„æ— ç§ä»˜å‡ºè€Œå—åˆ°äº†è¡¨å½°ï¼Œå¹¶å¯¹è¿‡å» 6 ä¸ªæœˆå†…çš„å‰ 20 åè´¡çŒ®è€…è¡¨ç¤ºäº†èµèª‰ã€‚&lt;/p&gt;
&lt;p&gt;å¼€å¹•ä¸»é¢˜æ¼”è®²è¿˜å®£å¸ƒäº†&lt;a href=&#34;https://www.cncf.io/blog/2023/11/06/introducing-the-istio-certified-associate-ica-certification-for-microservices-management/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt; Istio è®¤è¯è”åˆï¼ˆICAï¼‰è€ƒè¯•&lt;/a&gt;ä» 11 æœˆ 6 æ—¥å¼€å§‹æ¥å—æŠ¥åã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜è‡ªè±ªåœ°å±•ç¤ºäº†è®¸å¤šè´¡çŒ®è€…ã€ä¾›åº”å•†å’Œç»ˆç«¯ç”¨æˆ·çš„&lt;a href=&#34;https://www.youtube.com/watch?v=c5baPkXZEMU&amp;amp;ab_channel=Istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å°è§†é¢‘&lt;/a&gt;ï¼Œä»–ä»¬ç¥è´ºæˆ‘ä»¬è·å¾— CNCF æ¯•ä¸šèµ„æ ¼ï¼&lt;/p&gt;
&lt;p&gt;éšåï¼Œ&lt;a href=&#34;https://www.youtube.com/watch?v=Uk0k8uhdyaA&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DevRev çš„ Kush Trivedi å’Œ Khushboo Mittal è¿›è¡Œäº†ä¸€åœºç»ˆç«¯ç”¨æˆ·æ¼”è®²&lt;/a&gt;ï¼Œä»‹ç»äº†ä»–ä»¬å¦‚ä½•ä½¿ç”¨ Istioã€‚æˆ‘ä»¬è¿˜è¿›è¡Œäº†ä¸€åœºå¤‡å—æœŸå¾…çš„å…³äº&lt;a href=&#34;https://www.youtube.com/watch?v=S39yo6ZJ4iM&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è§„æ¨¡ç¯å¢ƒæ¶æ„&lt;/a&gt;çš„è®¨è®ºï¼Œç”± John Howard ä¸»è®²ï¼Œå¼•å‘äº†ç¤¾åŒºå†…çš„ä¸€äº›æœ‰è¶£è®¨è®ºã€‚æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªæœ‰è¶£çš„è®²åº§å±•ç¤ºäº† Lilt å’Œ Intel ä¹‹é—´çš„åˆä½œï¼Œä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Istio æ‰©å±• AI é©±åŠ¨çš„ç¿»è¯‘æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿›å…¥äº†æ¥è‡ª Intuit çš„&lt;a href=&#34;https://www.youtube.com/watch?v=Xe38vEygOqk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç»ˆç«¯ç”¨æˆ·æ¼”è®²&lt;/a&gt;ï¼ŒKarim Lakhani è§£é‡Šäº† Intuit çš„ç°ä»£ SaaS å¹³å°ï¼Œå…¶ä¸­åŒ…æ‹¬éƒ¨ç½²å¤šä¸ªäº‘åŸç”Ÿé¡¹ç›®ï¼ŒåŒ…æ‹¬ Istioã€‚å½“ Mitch Connors å’Œ Christian Hernandez åœ¨ç°åœºå…¬å…±ç½‘ç«™ä¸Šè¿›è¡Œäº†&lt;a href=&#34;https://www.youtube.com/watch?v=o71PJAqy4P8&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Argo ä¸Šçš„ Istio ç¯å¢ƒå‡çº§çš„å®æ—¶æ¼”ç¤º&lt;/a&gt;å¹¶æä¾›äº†å…¬å¼€å¯è®¿é—®çš„å¯ç”¨æ€§ç›‘æ§æ—¶ï¼Œè§‚ä¼—æ„Ÿåˆ°å…´å¥‹ã€‚&lt;/p&gt;
&lt;p&gt;äº‹ä»¶åï¼Œå®‰å…¨æ€§æˆä¸ºåç»­æ¼”è®²ä¸­çš„é‡ç‚¹ï¼ŒMicrosoft çš„ Jackie Elliot æ·±å…¥æ¢è®¨äº†&lt;a href=&#34;https://www.youtube.com/watch?v=QjmUDNXyckQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Identity&lt;/a&gt;ï¼Œæ¥ç€ Speedscale çš„ Kush Mansing è¿›è¡Œäº†é—ªç”µæ¼”è®²ï¼Œå±•ç¤ºäº†åœ¨ Istio ä¸Šè¿è¡Œå¸¦æœ‰ä»»æ„ä»£ç çš„æœåŠ¡çš„å½±å“ã€‚æˆ‘ä»¬è¿˜ä¸¾åŠäº†æ¥è‡ªåç››é¡¿å¤§å­¦çš„åšå£«ç”Ÿ Xiangfeng Zhu çš„é—ªç”µæ¼”è®²ï¼Œä»–å±•ç¤ºäº†ä¸€ç§åˆ†æå’Œé¢„æµ‹ Istio æ€§èƒ½å¼€é”€çš„å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;æ¥è‡ª Kiali ç»´æŠ¤äººå‘˜çš„&lt;a href=&#34;https://www.youtube.com/watch?v=MX-Sym2EkGI&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®²è¯&lt;/a&gt;Jay Shaughnessy å’Œ Nick Fox éå¸¸æœ‰è¶£ï¼Œå› ä¸ºå®ƒæ¼”ç¤ºäº†å¦‚ä½•æ›´å¥½åœ°ä½¿ç”¨ Kiali æ¥è°ƒè¯• Istio ç”¨ä¾‹çš„é«˜çº§æ–¹æ³•ã€‚æ¥è‡ª Zeta çš„ Ekansh Gupta å’Œæ¥è‡ª Reskill çš„ Nirupama Singh è¿›è¡Œäº†å¦ä¸€åœº&lt;a href=&#34;https://www.youtube.com/watch?v=dl0sESwwm9c&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç»ˆç«¯ç”¨æˆ·æ¼”è®²ï¼Œè§£é‡Šäº†å‡çº§ Istio æ—¶çš„æœ€ä½³å®è·µ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Istio å¤šé›†ç¾¤å§‹ç»ˆæ˜¯ä¸€ä¸ªçƒ­é—¨è¯é¢˜ï¼ŒAWS çš„ Lukonde Mwila å’Œ Ovidiu åœ¨å…³äº&lt;a href=&#34;https://www.youtube.com/watch?v=FIVmVIJlLVw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¨å¤šé›†ç¾¤ç½‘æ ¼ä¹‹é—´å»ºç«‹ä¿¡ä»»&lt;/a&gt;çš„æ¼”è®²ä¸­è¡¨ç°å‡ºè‰²ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜ä¸¾åŠäº†ä¸ Istio TOC æˆå‘˜çš„&lt;a href=&#34;https://www.youtube.com/watch?v=PEUiL2BPXds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº’åŠ¨å°ç»„è®¨è®º&lt;/a&gt;ï¼Œè§‚ä¼—æå‡ºäº†è®¸å¤šé—®é¢˜ï¼Œè®¨è®ºä¼šçš„çƒ­çƒˆç¨‹åº¦è¯æ˜äº† Istio çš„æŒç»­å—æ¬¢è¿ã€‚Istio Day ä»¥ Christian Posta å’Œ Solo.io çš„ Jim Barton æä¾›çš„&lt;a href=&#34;https://www.youtube.com/watch?v=SyjBSM-3dOY&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…³äºå¦‚ä½•å…¥é—¨ç¯å¢ƒç½‘æ ¼çš„ç²¾å½©ç ”è®¨ä¼š&lt;/a&gt;ç»“æŸï¼Œè¿™ä¹Ÿæ˜¯æ‰€æœ‰è§‚ä¼—éƒ½æœŸå¾…çš„çƒ­é—¨è¯é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰æ¼”è®²çš„å¹»ç¯ç‰‡å¯ä»¥åœ¨&lt;a href=&#34;https://events.linuxfoundation.org/kubecon-cloudnativecon-north-america/co-located-events/istio-day/#thank-you-for-attending&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Day åŒ—ç¾ 2023 æ—¥ç¨‹&lt;/a&gt;ä¸­æ‰¾åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„å­˜åœ¨ä¸ä»…ä»…åœ¨ Istio Day ç»“æŸã€‚KubeCon + CloudNativeCon çš„ç¬¬ä¸€å¤©ä¸»é¢˜æ¼”è®²å§‹äº Mitch Connors çš„é¡¹ç›®æ›´æ–°è§†é¢‘ã€‚å½“ä¸¤ä½æˆ‘ä»¬çš„è´¡çŒ®è€… Lin Sun å’Œ Faseela K åœ¨ç¬¬äºŒå¤©ä¸»é¢˜æ¼”è®²ä¸­ç”± CNCF çš„ CTO Chris Aniszczyk é¢å‘äº†å£°æœ›å¾ˆé«˜çš„ CNCF ç¤¾åŒº&lt;a href=&#34;https://www.cncf.io/announcements/2023/11/08/cloud-native-computing-foundation-announces-2023-community-awards-winners/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;â€œç æŸ´æŒ‘æ°´â€å¥–&lt;/a&gt;æ—¶ï¼Œæˆ‘ä»¬æ„Ÿåˆ°éå¸¸è‡ªè±ªã€‚&lt;/p&gt;
&lt;p&gt;ä¸€äº›æˆ‘ä»¬çš„ç»´æŠ¤è€…å’Œè´¡çŒ®è€…ä¹Ÿå…¥é€‰äº† CNCF 2023 å¹´ç§‹å­£å¤§ä½¿åå•ï¼Œå…¶ä¸­åŒ…æ‹¬ Lin Sunã€Mitch Connors å’Œ Faseela K ç­‰äººã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://sched.co/1R2tA&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;KubeCon ç»´æŠ¤è€…ä¸“åœº&lt;/a&gt;ç”± TOC æˆå‘˜ John Howard å’Œ Louis Ryan ä¸»æŒï¼Œå¸å¼•äº†ä¼—å¤šè§‚ä¼—çš„å…³æ³¨ï¼Œä»–ä»¬è®¨è®ºäº† Istio å½“å‰æ­£åœ¨è¿›è¡Œçš„å·¥ä½œå’Œæœªæ¥çš„è·¯çº¿å›¾ã€‚æ¼”è®²ä¸­æè¿°çš„æŠ€æœ¯ä»¥åŠè§‚ä¼—è§„æ¨¡å‡¸æ˜¾äº† Istio ç»§ç»­æ˜¯è¡Œä¸šä¸­æœ€å—æ¬¢è¿çš„æœåŠ¡ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-kubecon-na-2023-çš„-istio-ç»´æŠ¤è€…ä¸“åœº&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;KubeCon NA 2023 çš„ Istio ç»´æŠ¤è€…ä¸“åœº&#34; srcset=&#34;
               /blog/istiocon-at-kubecon-na/maintainer-track_hu_af3ebdb79eb09094.webp 400w,
               /blog/istiocon-at-kubecon-na/maintainer-track_hu_96f79c205fdb2361.webp 760w,
               /blog/istiocon-at-kubecon-na/maintainer-track_hu_6158c3159f1dea95.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istiocon-at-kubecon-na/maintainer-track_hu_af3ebdb79eb09094.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      KubeCon NA 2023 çš„ Istio ç»´æŠ¤è€…ä¸“åœº
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Lin Sunã€Eric Van Normanã€Steven Landow å’Œ Faseela K ä¸»æŒçš„è´¡çŒ®è€…çš„ &lt;a href=&#34;https://sched.co/1R2q7/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Contribfest å¼€å‘å’Œè´¡çŒ®ç ”è®¨ä¼š&lt;/a&gt;ä¹Ÿå—åˆ°äº†çƒ­çƒˆæ¬¢è¿ã€‚å¾ˆé«˜å…´çœ‹åˆ°è¿™ä¹ˆå¤šäººå¯¹ä¸º Istio åšè´¡çŒ®æ„Ÿå…´è¶£ï¼Œå¹¶åœ¨ç ”è®¨ä¼šç»“æŸæ—¶æäº¤äº†ä»–ä»¬çš„ç¬¬ä¸€ä¸ªæ‹‰å–è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-kubecon-na-2023-çš„-contribfest-istio-ç ”è®¨ä¼š&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;KubeCon NA 2023 çš„ Contribfest Istio ç ”è®¨ä¼š&#34; srcset=&#34;
               /blog/istiocon-at-kubecon-na/contrib-fest_hu_254719ecf575bc96.webp 400w,
               /blog/istiocon-at-kubecon-na/contrib-fest_hu_d087786cb3235b76.webp 760w,
               /blog/istiocon-at-kubecon-na/contrib-fest_hu_952414949ab635e5.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istiocon-at-kubecon-na/contrib-fest_hu_254719ecf575bc96.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      KubeCon NA 2023 çš„ Contribfest Istio ç ”è®¨ä¼š
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç”±ä¸‰ä½ CNCF æœåŠ¡ç½‘æ ¼é¡¹ç›®çš„ç»´æŠ¤äººå‘˜é¢†å¯¼çš„&lt;a href=&#34;https://sched.co/1R2ts&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼æˆ˜æ–—ç—•è¿¹ï¼šæŠ€æœ¯ã€æ—¶æœºå’Œæƒè¡¡&lt;/a&gt;çš„æœŸå¾…å·²ä¹…çš„å°ç»„è®¨è®ºå¸å¼•äº†ä¼—å¤šè§‚ä¼—ï¼Œå¹¶å¼•å‘äº†è®¸å¤šæœ‰è¶£çš„è®¨è®ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-kubecon-na-2023-çš„æœåŠ¡ç½‘æ ¼æˆ˜æ–—ç—•è¿¹å°ç»„è®¨è®º&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;KubeCon NA 2023 çš„æœåŠ¡ç½‘æ ¼æˆ˜æ–—ç—•è¿¹å°ç»„è®¨è®º&#34; srcset=&#34;
               /blog/istiocon-at-kubecon-na/servicemesh-battle-scars-panel_hu_cfde8d427210896f.webp 400w,
               /blog/istiocon-at-kubecon-na/servicemesh-battle-scars-panel_hu_5b19d301ab3cd068.webp 760w,
               /blog/istiocon-at-kubecon-na/servicemesh-battle-scars-panel_hu_28592e130f0645e2.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istiocon-at-kubecon-na/servicemesh-battle-scars-panel_hu_cfde8d427210896f.webp&#34;
               width=&#34;760&#34;
               height=&#34;572&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      KubeCon NA 2023 çš„æœåŠ¡ç½‘æ ¼æˆ˜æ–—ç—•è¿¹å°ç»„è®¨è®º
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio åœ¨ KubeCon çš„å…¶ä»–å‡ ä¸ªæ¼”è®²ä¸­ä¹Ÿæˆä¸ºçƒ­é—¨è¯é¢˜ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬æ³¨æ„åˆ°çš„ä¸€äº›ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://sched.co/1R2o5/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å°†å…¶å¸¦åˆ°è¾¹ç¼˜ï¼šä½¿ç”¨ Istio å’Œ K8gb åˆ›å»ºå…¨çƒåˆ†å¸ƒå¼å…¥å£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://sched.co/1R2uV&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­ç¤º Istio çš„é”äº‰ç”¨å’Œå…¶å¯¹ Expedia è®¡ç®—å¹³å°çš„å½±å“&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://sched.co/1R2v6&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨åŠŸèƒ½é—¨è§£å¼€æœåŠ¡ç½‘æ ¼çš„å¤æ‚æ€§&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://sched.co/1R2wC&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼ä¸­çš„è¯ä¹¦ç±»å‹ï¼šåŸå› å’Œæ–¹æ³•ï¼&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio åœ¨é¡¹ç›®å±•å°ä¸Šè®¾æœ‰ä¸€ä¸ªå±•ä½ï¼Œå¤§å¤šæ•°é—®é¢˜éƒ½é›†ä¸­åœ¨ç¯å¢ƒç½‘æ ¼ä½•æ—¶å‡†å¤‡æŠ•å…¥ç”Ÿäº§ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-å±•å°ä¸Šçš„è®¨è®º&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio å±•å°ä¸Šçš„è®¨è®º&#34; srcset=&#34;
               /blog/istiocon-at-kubecon-na/istio-booth-1_hu_2106253a6d69621e.webp 400w,
               /blog/istiocon-at-kubecon-na/istio-booth-1_hu_2bc51b00f501d020.webp 760w,
               /blog/istiocon-at-kubecon-na/istio-booth-1_hu_a541e964add4e84.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istiocon-at-kubecon-na/istio-booth-1_hu_2106253a6d69621e.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio å±•å°ä¸Šçš„è®¨è®º
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¾ˆé«˜å…´åœ¨æ¬§æ´²çš„ Istio å±•å°ä¸Šæå‡ºçš„ä¸»è¦é—®é¢˜â€”â€”CNCF æ¯•ä¸šæ—¶é—´è¡¨â€”â€”å·²ç»å¾—åˆ°äº†ç­”æ¡ˆï¼Œæˆ‘ä»¬å‘æ¯ä¸ªäººä¿è¯ï¼Œæˆ‘ä»¬æ­£åœ¨ä»¥åŒæ ·çš„è®¤çœŸç¨‹åº¦å¼€å±•ç¯å¢ƒç½‘æ ¼å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„è®¸å¤šæˆå‘˜å’Œç»´æŠ¤è€…åœ¨æˆ‘ä»¬çš„å±•å°ä¸Šæä¾›äº†æ”¯æŒï¼Œå¸®åŠ©æˆ‘ä»¬å›ç­”äº†æ‰€æœ‰ç”¨æˆ·çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-å±•å°ä¸Šçš„æˆå‘˜å’Œç»´æŠ¤è€…&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio å±•å°ä¸Šçš„æˆå‘˜å’Œç»´æŠ¤è€…&#34; srcset=&#34;
               /blog/istiocon-at-kubecon-na/istio-booth-2_hu_69aeb350ec9459ba.webp 400w,
               /blog/istiocon-at-kubecon-na/istio-booth-2_hu_fb7af97046e26fbf.webp 760w,
               /blog/istiocon-at-kubecon-na/istio-booth-2_hu_7d6352ff52919dc8.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istiocon-at-kubecon-na/istio-booth-2_hu_69aeb350ec9459ba.webp&#34;
               width=&#34;760&#34;
               height=&#34;253&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio å±•å°ä¸Šçš„æˆå‘˜å’Œç»´æŠ¤è€…
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å±•å°çš„å¦ä¸€ä¸ªäº®ç‚¹æ˜¯ï¼Œæˆ‘ä»¬æœ‰æ–°çš„ Istio T æ¤ç”± Microsoftã€Solo.ioã€Stackgenie å’Œ Tetrate èµåŠ©ï¼Œä¾›æ¯ä¸ªäººé¢†å–ï¼&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ä¸€æ‰¹æ–°çš„-istio-t-æ¤&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;ä¸€æ‰¹æ–°çš„ Istio T æ¤&#34; srcset=&#34;
               /blog/istiocon-at-kubecon-na/istio-t-shirts_hu_dfa1e86cf3b3fe80.webp 400w,
               /blog/istiocon-at-kubecon-na/istio-t-shirts_hu_5063d1b2be4feaea.webp 760w,
               /blog/istiocon-at-kubecon-na/istio-t-shirts_hu_64b634d40c57947.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istiocon-at-kubecon-na/istio-t-shirts_hu_dfa1e86cf3b3fe80.webp&#34;
               width=&#34;760&#34;
               height=&#34;255&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      ä¸€æ‰¹æ–°çš„ Istio T æ¤
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¦è¡·å¿ƒæ„Ÿè°¢æˆ‘ä»¬çš„ç™½é‡‘èµåŠ©å•† Google Cloudï¼Œä»–ä»¬å¯¹æ”¯æŒ Istio Day åŒ—ç¾è¡¨ç¤ºè¯šæŒšçš„æ„Ÿæ¿€ï¼æœ€åä½†åŒæ ·é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬è¦æ„Ÿè°¢æˆ‘ä»¬çš„ Istio Day è®¡åˆ’å§”å‘˜ä¼šæˆå‘˜ï¼Œæ„Ÿè°¢ä»–ä»¬çš„è¾›å‹¤å·¥ä½œå’Œæ”¯æŒï¼&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://events.linuxfoundation.org/kubecon-cloudnativecon-europe/co-located-events/istio-day/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœŸå¾…åœ¨ 2024 å¹´ 3 æœˆå·´é»è§ï¼&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-day-europe-2024&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio Day Europe 2024&#34; srcset=&#34;
               /blog/istiocon-at-kubecon-na/istio-day-paris_hu_5c601569659f70ef.webp 400w,
               /blog/istiocon-at-kubecon-na/istio-day-paris_hu_cc9e6a14cb82e626.webp 760w,
               /blog/istiocon-at-kubecon-na/istio-day-paris_hu_a0a72b95c3e2544a.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istiocon-at-kubecon-na/istio-day-paris_hu_5c601569659f70ef.webp&#34;
               width=&#34;760&#34;
               height=&#34;380&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio Day Europe 2024
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ç›¸äº’ TLS å’Œ Istio ä¿æŠ¤åº”ç”¨ç¨‹åºé€šä¿¡</title>
      <link>https://cloudnativecn.com/blog/secure-apps-with-istio/</link>
      <pubDate>Mon, 06 Nov 2023 18:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/secure-apps-with-istio/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://istio.io/latest/blog/2023/secure-apps-with-istio/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/latest/blog/2023/secure-apps-with-istio/&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦ï¼šæœ¬æ–‡è®¨è®ºäº†ä½¿ç”¨ç›¸äº’ TLS (mTLS) å’Œ Istio ä¿æŠ¤åº”ç”¨ç¨‹åºé€šä¿¡çš„é‡è¦æ€§ã€‚mTLS æä¾›äº†ç«¯åˆ°ç«¯çš„å®‰å…¨æ€§ï¼Œåªæœ‰æºå’Œç›®æ ‡å¯ä»¥è§£å¯†æ•°æ®ï¼Œä»è€Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚ç„¶è€Œï¼Œå¦‚æœæºæˆ–ç›®æ ‡çš„èº«ä»½æ²¡æœ‰åŠ å¯†ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚Istio ä¸­çš„ mTLS å¯ä»¥ç®€å•åœ°å¯ç”¨ï¼Œå¹¶ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åº pod æä¾›èº«ä»½è¯ä¹¦ã€‚ä¸ºäº†å¼ºåˆ¶æ‰§è¡Œä¸¥æ ¼çš„ mTLSï¼Œå¯ä»¥ä½¿ç”¨ Istio çš„ PeerAuthentication ç­–ç•¥å’Œ AuthorizationPolicyã€‚æœ€åï¼ŒTLS åè®®æ˜¯æœ€å¹¿æ³›å®¡æŸ¥ã€ä¸“å®¶æ‰¹å‡†ã€ç»è¿‡æˆ˜æ–—æµ‹è¯•çš„æ•°æ®å®‰å…¨åè®®ä¹‹ä¸€ï¼ŒIstio é»˜è®¤åœ¨å†…ç½‘åº”ç”¨ç¨‹åºé€šä¿¡ä¸­ä½¿ç”¨ TLS 1.3 ç‰ˆæœ¬ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ç”¨æˆ·é‡‡ç”¨æœåŠ¡ç½‘æ ¼çš„æœ€å¤§åŸå› ä¹‹ä¸€æ˜¯ä½¿ç”¨ç›¸äº’ TLSï¼ˆmTLSï¼‰åŸºäºå¯é€šè¿‡åŠ å¯†éªŒè¯çš„èº«ä»½æ¥å¯ç”¨åº”ç”¨ç¨‹åºä¹‹é—´çš„å®‰å…¨é€šä¿¡ã€‚åœ¨æ­¤åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºåº”ç”¨ç¨‹åºä¹‹é—´å®‰å…¨é€šä¿¡çš„è¦æ±‚ï¼Œä»¥åŠ mTLS å¦‚ä½•å®ç°å¹¶æ»¡è¶³æ‰€æœ‰è¿™äº›è¦æ±‚ï¼Œä»¥åŠä½¿ç”¨ Istio å¯ç”¨åº”ç”¨ç¨‹åºä¹‹é—´ mTLS çš„ç®€å•æ­¥éª¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ‚¨éœ€è¦ä»€ä¹ˆæ¥ä¿æŠ¤åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡&#34;&gt;æ‚¨éœ€è¦ä»€ä¹ˆæ¥ä¿æŠ¤åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ç°ä»£äº‘åŸç”Ÿåº”ç”¨ç¨‹åºç»å¸¸åˆ†å¸ƒåœ¨å¤šä¸ª Kubernetes é›†ç¾¤æˆ–è™šæ‹Ÿæœºä¸­ã€‚æ–°ç‰ˆæœ¬ç»å¸¸è¿›è¡Œé˜¶æ®µæ€§éƒ¨ç½²ï¼Œå®ƒä»¬å¯ä»¥æ ¹æ®ç”¨æˆ·è¯·æ±‚å¿«é€Ÿæ‰©å±•å’Œç¼©å°ã€‚ç”±äºç°ä»£åº”ç”¨ç¨‹åºé€šè¿‡ä¸ä¾èµ–å…±åŒå®šä½æ¥æé«˜èµ„æºåˆ©ç”¨æ•ˆç‡ï¼Œå› æ­¤èƒ½å¤Ÿåº”ç”¨è®¿é—®ç­–ç•¥å¹¶ä¿æŠ¤è¿™äº›åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡è‡³å…³é‡è¦ï¼Œå› ä¸ºå¢åŠ çš„å¤šä¸ªå…¥å£ç‚¹å¯¼è‡´äº†æ›´å¤§çš„æ”»å‡»é¢ã€‚å¿½è§†è¿™ä¸€ç‚¹å°†é‚€è¯·æ•°æ®ä¸¢å¤±ã€æ•°æ®ç›—çªƒã€ä¼ªé€ æ•°æ®æˆ–ç®€å•å¤„ç†ç­‰å·¨å¤§çš„ä¸šåŠ¡é£é™©ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯åº”ç”¨ç¨‹åºä¹‹é—´å®‰å…¨é€šä¿¡çš„å¸¸è§å…³é”®è¦æ±‚ï¼š&lt;/p&gt;
&lt;h3 id=&#34;èº«ä»½&#34;&gt;èº«ä»½&lt;/h3&gt;
&lt;p&gt;èº«ä»½æ˜¯ä»»ä½•å®‰å…¨æ¶æ„çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ã€‚åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥å®‰å…¨åœ°å‘é€æ•°æ®ä¹‹å‰ï¼Œå¿…é¡»ä¸ºåº”ç”¨ç¨‹åºå»ºç«‹&lt;strong&gt;èº«ä»½&lt;/strong&gt;ã€‚è¿™ä¸ªå»ºç«‹èº«ä»½çš„è¿‡ç¨‹è¢«ç§°ä¸º&lt;strong&gt;èº«ä»½éªŒè¯&lt;/strong&gt; - å®ƒæ¶‰åŠç”±æŸä¸ªçŸ¥åçš„ï¼Œå—ä¿¡ä»»çš„&lt;strong&gt;æƒå¨æœºæ„&lt;/strong&gt;å¯¹åº”ç”¨ç¨‹åºå·¥ä½œè´Ÿè½½è¿›è¡Œä¸€æ¬¡æˆ–å¤šæ¬¡æ£€æŸ¥ï¼Œä»¥ç¡®è®¤å®ƒæ˜¯å®ƒæ‰€å£°ç§°çš„é‚£æ ·ã€‚ä¸€æ—¦æƒå¨æœºæ„æ»¡æ„ï¼Œå®ƒå°±ä¼šæˆäºˆå·¥ä½œè´Ÿè½½ä¸€ä¸ªèº«ä»½ã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘å‡ºç¤ºæŠ¤ç…§çš„è¡Œä¸º - ä½ ä¼šå‘æŸä¸ªæƒå¨æœºæ„è¯·æ±‚ä¸€ä¸ªï¼Œé‚£ä¸ªæƒå¨æœºæ„å¯èƒ½ä¼šè¦æ±‚ä½ æä¾›å‡ ä¸ªä¸åŒçš„èº«ä»½éªŒè¯è¯æ˜ä½ æ˜¯ä½ æ‰€è¯´çš„é‚£ä¸ªäºº - å‡ºç”Ÿè¯æ˜ã€ç°ä½å€ã€åŒ»ç–—è®°å½•ç­‰ã€‚ä¸€æ—¦ä½ æ»¡è¶³äº†æ‰€æœ‰çš„èº«ä»½éªŒè¯è¦æ±‚ï¼Œä½ å°†ï¼ˆå¸Œæœ›ï¼‰è¢«æˆäºˆèº«ä»½è¯ä»¶ã€‚ä½ å¯ä»¥å°†é‚£ä¸ªèº«ä»½è¯ä»¶ç»™åˆ«äººä½œä¸ºä½ å·²ç»æ»¡è¶³äº†å‘è¯æœºæ„çš„æ‰€æœ‰èº«ä»½éªŒè¯è¦æ±‚çš„è¯æ®ï¼Œå¦‚æœä»–ä»¬ä¿¡ä»»å‘è¯æœºæ„ï¼ˆå’Œèº«ä»½è¯ä»¶æœ¬èº«ï¼‰ï¼Œä»–ä»¬å°±å¯ä»¥ä¿¡ä»»å…³äºä½ çš„æ‰€æœ‰å†…å®¹ï¼ˆæˆ–è€…ä»–ä»¬å¯ä»¥è”ç³»å—ä¿¡ä»»çš„æƒå¨æœºæ„å¹¶éªŒè¯è¯¥æ–‡ä»¶ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;èº«ä»½å¯ä»¥é‡‡å–ä»»ä½•å½¢å¼ï¼Œä½†æ˜¯ï¼Œå°±åƒä»»ä½•å½¢å¼çš„èº«ä»½è¯æ˜ä¸€æ ·ï¼Œèº«ä»½éªŒè¯è¶Šå¼±ï¼Œä¼ªé€ å°±è¶Šå®¹æ˜“ï¼Œèº«ä»½è¯æ˜å¯¹äºä½¿ç”¨å®ƒè¿›è¡Œå†³ç­–çš„ä»»ä½•äººæ¥è¯´å°±è¶Šæ— ç”¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨è®¡ç®—ä¸­ï¼Œå¯†ç å¯éªŒè¯çš„èº«ä»½éå¸¸é‡è¦ - å®ƒä»¬ç”±å¯éªŒè¯çš„æƒå¨æœºæ„ç­¾ç½²ï¼Œç±»ä¼¼äºæ‚¨çš„æŠ¤ç…§å’Œé©¾é©¶æ‰§ç…§ã€‚åŸºäºä»»ä½•è¾ƒå°‘çš„èº«ä»½éƒ½æ˜¯ä¸€ä¸ªå¯ä»¥ç›¸å¯¹å®¹æ˜“åœ°åˆ©ç”¨çš„å®‰å…¨å¼±ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;æ‚¨çš„ç³»ç»Ÿå¯èƒ½å…·æœ‰æºè‡ªç½‘ç»œå±æ€§ï¼ˆä¾‹å¦‚ IP åœ°å€ï¼‰çš„èº«ä»½ï¼Œå…·æœ‰åˆ†å¸ƒå¼èº«ä»½ç¼“å­˜ï¼Œè·Ÿè¸ªèº«ä»½ä¸è¿™äº›ç½‘ç»œå±æ€§ä¹‹é—´çš„æ˜ å°„ã€‚è¿™äº›èº«ä»½ä¸åƒå¯†ç å¯éªŒè¯çš„èº«ä»½é‚£æ ·å…·æœ‰å¼ºå¤§çš„ä¿è¯ï¼Œå› ä¸º IP åœ°å€å¯èƒ½è¢«é‡æ–°åˆ†é…ç»™ä¸åŒçš„å·¥ä½œè´Ÿè½½ï¼Œå¹¶ä¸”èº«ä»½ç¼“å­˜å¯èƒ½å¹¶ä¸æ€»æ˜¯æ›´æ–°åˆ°æœ€æ–°çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;æ‚¨å¸Œæœ›åº”ç”¨ç¨‹åºä½¿ç”¨å¯†ç å¯éªŒè¯çš„èº«ä»½ï¼Œå› ä¸ºåœ¨å»ºç«‹è¿æ¥æ—¶äº¤æ¢åº”ç”¨ç¨‹åºçš„å¯†ç å¯éªŒè¯èº«ä»½æœ¬è´¨ä¸Šæ¯”ä¾èµ–äºå°† IP åœ°å€æ˜ å°„åˆ°èº«ä»½çš„ç³»ç»Ÿæ›´å¯é ï¼Œæ›´å®‰å…¨ã€‚è¿™äº›ç³»ç»Ÿä¾èµ–äºå…·æœ‰æœ€ç»ˆä¸€è‡´æ€§å’Œè¿‡æ—¶é—®é¢˜çš„åˆ†å¸ƒå¼èº«ä»½ç¼“å­˜ï¼Œè¿™å¯èƒ½åœ¨ Kubernetes ä¸­åˆ›å»ºç»“æ„æ€§å¼±ç‚¹ï¼Œå…¶ä¸­é«˜é¢‘ç‡çš„è‡ªåŠ¨ pod è½¬æ¢æ˜¯å¸¸æ€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœºå¯†æ€§&#34;&gt;æœºå¯†æ€§&lt;/h3&gt;
&lt;p&gt;åŠ å¯†åº”ç”¨ç¨‹åºä¹‹é—´ä¼ è¾“çš„æ•°æ®è‡³å…³é‡è¦ - å› ä¸ºåœ¨ç ´åå¸¸è§ã€æˆæœ¬é«˜æ˜‚å’Œå®é™…ä¸Šå¾®ä¸è¶³é“çš„ä¸–ç•Œä¸­ï¼Œå®Œå…¨ä¾èµ–äº&lt;em&gt;å®‰å…¨çš„&lt;/em&gt;å†…éƒ¨ç¯å¢ƒæˆ–å…¶ä»–å®‰å…¨è¾¹ç•Œæ—©å·²ä¸å†é€‚ç”¨ã€‚ä¸ºäº†é˜²æ­¢&lt;a href=&#34;https://en.wikipedia.org/wiki/Man-in-the-middle_attack&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸­é—´äººæ”»å‡»&lt;/a&gt;ï¼Œä½ éœ€è¦ä¸ºæº - ç›®æ ‡å¯¹åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„åŠ å¯†é€šé“ï¼Œå› ä¸ºä½ å¸Œæœ›æœ‰å¼ºå¤§çš„èº«ä»½å”¯ä¸€æ€§ä¿è¯ä»¥é¿å…&lt;a href=&#34;https://en.wikipedia.org/wiki/Confused_deputy_problem&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ··æ·†å‰¯æ‰‹é—®é¢˜&lt;/a&gt;ã€‚æ¢å¥è¯è¯´ï¼Œä»…ä»…åŠ å¯†é€šé“æ˜¯ä¸å¤Ÿçš„ - å®ƒå¿…é¡»ä½¿ç”¨ç›´æ¥ä»å”¯ä¸€æºå’Œç›®æ ‡èº«ä»½æ´¾ç”Ÿçš„å”¯ä¸€å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œä»¥ä¾¿åªæœ‰æºå’Œç›®æ ‡å¯ä»¥è§£å¯†æ•°æ®ã€‚æ­¤å¤–ï¼Œæ‚¨å¯èƒ½éœ€è¦æ ¹æ®å®‰å…¨å›¢é˜Ÿçš„è¦æ±‚å®šåˆ¶åŠ å¯†ï¼Œä¾‹å¦‚é€šè¿‡é€‰æ‹©ç‰¹å®šçš„å¯†ç ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®Œæ•´æ€§&#34;&gt;å®Œæ•´æ€§&lt;/h3&gt;
&lt;p&gt;ä»æºå‘é€åˆ°ç›®æ ‡çš„åŠ å¯†æ•°æ®åœ¨å‘é€åä¸èƒ½è¢«é™¤æºå’Œç›®æ ‡ä¹‹å¤–çš„ä»»ä½•èº«ä»½ä¿®æ”¹ã€‚æ¢å¥è¯è¯´ï¼Œæ¥æ”¶åˆ°çš„æ•°æ®ä¸å‘é€çš„æ•°æ®ç›¸åŒã€‚å¦‚æœä½ æ²¡æœ‰&lt;a href=&#34;https://en.wikipedia.org/wiki/Data_integrity&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;data integrity&lt;/a&gt;ï¼Œé‚£ä¹ˆä¸­é—´çš„äººå¯èƒ½åœ¨æºå’Œç›®æ ‡ä¹‹é—´çš„é€šä¿¡è¿‡ç¨‹ä¸­ä¿®æ”¹ä¸€äº›ä½æˆ–æ•´ä¸ªæ•°æ®çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è®¿é—®ç­–ç•¥æ‰§è¡Œ&#34;&gt;è®¿é—®ç­–ç•¥æ‰§è¡Œ&lt;/h3&gt;
&lt;p&gt;åº”ç”¨ç¨‹åºæ‰€æœ‰è€…éœ€è¦å¯¹å…¶åº”ç”¨ç¨‹åºåº”ç”¨è®¿é—®ç­–ç•¥ï¼Œå¹¶æ­£ç¡®ã€ä¸€è‡´ä¸”ä¸å«ç³Šåœ°æ‰§è¡Œå®ƒä»¬ã€‚ä¸ºäº†å¯¹é€šä¿¡æ¸ é“çš„ä¸¤ç«¯åº”ç”¨ç­–ç•¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸€ç«¯ç¡®å®šä¸€ä¸ªåº”ç”¨ç¨‹åºèº«ä»½ã€‚ä¸€æ—¦æˆ‘ä»¬ä¸ºå¯èƒ½çš„é€šä¿¡æ¸ é“çš„ä¸¤ç«¯éƒ½æœ‰äº†ä¸€ä¸ªå¯ä»¥é€šè¿‡å¯†ç éªŒè¯çš„èº«ä»½ï¼Œå¹¶ä¸”æ¥æºé“¾æ¡æ˜ç¡®ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ç¡®å®šè°å¯ä»¥ä¸ä½•ç‰©è¿›è¡Œé€šä¿¡çš„ç­–ç•¥ã€‚æ ‡å‡†çš„ TLSï¼Œè¿™æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¯†ç åè®®ï¼Œç”¨äºä¿æŠ¤å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼ŒWeb æµè§ˆå™¨ï¼‰å’ŒæœåŠ¡å™¨ï¼ˆä¾‹å¦‚ï¼ŒWeb æœåŠ¡å™¨ï¼‰ä¹‹é—´çš„é€šä¿¡ï¼ŒåªçœŸæ­£éªŒè¯å¹¶è¦æ±‚ä¸€æ–¹çš„èº«ä»½ - æœåŠ¡å™¨ã€‚ä½†æ˜¯ï¼Œå¯¹äºå…¨é¢çš„ç«¯åˆ°ç«¯ç­–ç•¥æ‰§è¡Œï¼Œå¯¹åŒæ–¹ - å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æœ‰ä¸€ä¸ªå¯é ã€å¯éªŒè¯ã€æ˜ç¡®çš„èº«ä»½è‡³å…³é‡è¦ã€‚è¿™å¯¹å†…éƒ¨åº”ç”¨ç¨‹åºæ¥è¯´æ˜¯ä¸€ä¸ªå…±åŒçš„éœ€æ±‚ - æƒ³è±¡ä¸€ä¸‹ï¼Œåªæœ‰ä¸€ä¸ª &lt;code&gt;frontend&lt;/code&gt; åº”ç”¨ç¨‹åºåº”è¯¥è°ƒç”¨åç«¯ &lt;code&gt;checkout&lt;/code&gt; åº”ç”¨ç¨‹åºçš„ &lt;strong&gt;GET&lt;/strong&gt; æ–¹æ³•ï¼Œä½†æ˜¯ä¸åº”è¯¥è¢«å…è®¸è°ƒç”¨ &lt;code&gt;POST&lt;/code&gt; æˆ– &lt;code&gt;DELETE&lt;/code&gt; æ–¹æ³•ã€‚æˆ–è€…ï¼Œåªæœ‰é‚£äº›ç”±ç‰¹å®š JWT å‘è¡Œè€…å‘å‡º JWT ä»¤ç‰Œçš„åº”ç”¨ç¨‹åºæ‰èƒ½è°ƒç”¨ &lt;code&gt;checkout&lt;/code&gt; åº”ç”¨ç¨‹åºçš„ &lt;code&gt;GET&lt;/code&gt; æ–¹æ³•ã€‚é€šè¿‡åˆ©ç”¨åŒç«¯çš„å¯†ç èº«ä»½ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿å¼ºå¤§çš„è®¿é—®ç­–ç•¥è¢«æ­£ç¡®åœ°ã€å®‰å…¨åœ°ã€å¯é åœ°æ‰§è¡Œï¼Œè€Œä¸”æœ‰å¯éªŒè¯çš„å®¡è®¡è½¨è¿¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;fips-åˆè§„æ€§&#34;&gt;FIPS åˆè§„æ€§&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://www.nist.gov/standardsgov/compliance-faqs-federal-information-processing-standards-fips&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è”é‚¦ä¿¡æ¯å¤„ç†æ ‡å‡† (FIPS)&lt;/a&gt; æ˜¯ç”± &lt;a href=&#34;https://www.nist.gov/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å›½å®¶æ ‡å‡†ä¸æŠ€æœ¯ç ”ç©¶é™¢ (NIST)&lt;/a&gt; åˆ¶å®šçš„è”é‚¦è®¡ç®—æœºç³»ç»Ÿçš„æ ‡å‡†å’ŒæŒ‡å—ã€‚å¹¶éæ¯ä¸ªäººéƒ½éœ€è¦ FIPS åˆè§„æ€§ï¼Œä½† FIPS åˆè§„æ€§æ„å‘³ç€æ»¡è¶³äº†ç¾å›½æ”¿åºœä¸ºä¿æŠ¤æ•æ„Ÿä¿¡æ¯è€Œè®¾ç«‹çš„æ‰€æœ‰å¿…è¦å®‰å…¨è¦æ±‚ã€‚ä¸è”é‚¦æ”¿åºœåˆä½œæ—¶éœ€è¦å®ƒã€‚ä¸ºäº†éµå¾ªç¾å›½æ”¿åºœåˆ¶å®šçš„ä¸ç½‘ç»œå®‰å…¨ç›¸å…³çš„æŒ‡å—ï¼Œè®¸å¤šç§è¥éƒ¨é—¨éƒ½è‡ªæ„¿ä½¿ç”¨è¿™äº› FIPS æ ‡å‡†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è¯´æ˜ä¸Šè¿°å®‰å…¨åº”ç”¨ç¨‹åºè¦æ±‚ï¼ˆèº«ä»½ã€æœºå¯†æ€§å’Œå®Œæ•´æ€§ï¼‰ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ &lt;code&gt;frontend&lt;/code&gt; åº”ç”¨ç¨‹åºè°ƒç”¨ &lt;code&gt;checkout&lt;/code&gt; åº”ç”¨ç¨‹åºçš„ä¾‹å­ã€‚è®°ä½ï¼Œæ‚¨å¯ä»¥æŠŠå›¾ä¸­çš„ &lt;strong&gt;ID&lt;/strong&gt; çœ‹ä½œæ˜¯ä»»ä½•ç±»å‹çš„èº«ä»½è¯æ˜ï¼Œæ¯”å¦‚æ”¿åºœé¢å‘çš„æŠ¤ç…§ã€ç…§ç‰‡è¯†åˆ«å™¨ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å‰ç«¯è°ƒç”¨ç»“è´¦åº”ç”¨ç¨‹åºæ—¶çš„è¦æ±‚&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å‰ç«¯è°ƒç”¨ç»“è´¦åº”ç”¨ç¨‹åºæ—¶çš„è¦æ±‚&#34; srcset=&#34;
               /blog/secure-apps-with-istio/requirements-flow_hu_ef677555eb1cfdf3.webp 400w,
               /blog/secure-apps-with-istio/requirements-flow_hu_cc08f7a3ec690836.webp 760w,
               /blog/secure-apps-with-istio/requirements-flow_hu_dd8c975d8610c352.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/secure-apps-with-istio/requirements-flow_hu_ef677555eb1cfdf3.webp&#34;
               width=&#34;760&#34;
               height=&#34;475&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å‰ç«¯è°ƒç”¨ç»“è´¦åº”ç”¨ç¨‹åºæ—¶çš„è¦æ±‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;mtls-å¦‚ä½•æ»¡è¶³ä¸Šè¿°è¦æ±‚&#34;&gt;mTLS å¦‚ä½•æ»¡è¶³ä¸Šè¿°è¦æ±‚ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;TLS 1.3ï¼ˆåœ¨æ’°å†™æœ¬æ–‡æ—¶çš„æœ€æ–° TLS ç‰ˆæœ¬ï¼‰ &lt;a href=&#34;https://datatracker.ietf.org/doc/html/rfc8446&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è§„èŒƒ&lt;/a&gt; çš„ä¸»è¦ç›®æ ‡æ˜¯åœ¨ä¸¤ä¸ªé€šä¿¡å¯¹ç­‰æ–¹ä¹‹é—´æä¾›ä¸€ä¸ªå®‰å…¨é€šé“ã€‚TLS å®‰å…¨é€šé“å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;éªŒè¯ï¼šé€šé“çš„æœåŠ¡å™¨ç«¯å§‹ç»ˆè¢«éªŒè¯ï¼Œå®¢æˆ·ç«¯å¯é€‰åœ°è¢«éªŒè¯ã€‚å½“å®¢æˆ·ç«¯ä¹Ÿè¢«éªŒè¯æ—¶ï¼Œå®‰å…¨é€šé“æˆä¸ºä¸€ä¸ªç›¸äº’çš„ TLS é€šé“ã€‚&lt;/li&gt;
&lt;li&gt;æœºå¯†æ€§ï¼šæ•°æ®è¢«åŠ å¯†ä¸”åªå¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯è§ã€‚å¿…é¡»ä½¿ç”¨ä¸æºå’Œç›®æ ‡èº«ä»½è¯æ˜æ— æ­§ä¹‰åœ°å¯†ç ç»‘å®šçš„å¯†é’¥æ¥åŠ å¯†æ•°æ®ï¼Œä»¥ä¾¿å¯é åœ°ä¿æŠ¤åº”ç”¨ç¨‹åºå±‚çš„æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;å®Œæ•´æ€§ï¼šé€šè¿‡é€šé“å‘é€çš„æ•°æ®æ— æ³•åœ¨æœªè¢«æ£€æµ‹åˆ°çš„æƒ…å†µä¸‹è¿›è¡Œä¿®æ”¹ã€‚è¿™æ˜¯é€šè¿‡åªæœ‰æºå’Œç›®æ ‡æ‹¥æœ‰ç»™å®šä¼šè¯çš„åŠ å¯†å’Œè§£å¯†å¯†é’¥çš„äº‹å®æ¥ä¿è¯çš„ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;mtls-å†…éƒ¨é€»è¾‘&#34;&gt;mTLS å†…éƒ¨é€»è¾‘&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»ç¡®å®šäº†ï¼Œä½¿ç”¨å¯ä»¥é€šè¿‡åŠ å¯†éªŒè¯çš„èº«ä»½æ ‡è¯†å¯¹äºä¿æŠ¤é€šé“å’Œæ”¯æŒè®¿é—®ç­–ç•¥æ‰§è¡Œè‡³å…³é‡è¦ï¼Œæˆ‘ä»¬ä¹Ÿå·²ç»ç¡®å®šäº†ï¼ŒmTLS æ˜¯ä¸€ç§ç»è¿‡ä¸¥å¯†æµ‹è¯•çš„åè®®ï¼Œå®ƒä¸ºåœ¨é€šé“çš„ä¸¤ç«¯ä½¿ç”¨å¯ä»¥é€šè¿‡åŠ å¯†éªŒè¯çš„èº«ä»½æ ‡è¯†æä¾›äº†ä¸€äº›æå…¶é‡è¦çš„ä¿è¯ - è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹ mTLS åè®®åœ¨å®é™…è¿è¡Œä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¡æ‰‹åè®®&#34;&gt;æ¡æ‰‹åè®®&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://datatracker.ietf.org/doc/html/rfc8446#section-4&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ¡æ‰‹åè®®&lt;/a&gt; éªŒè¯äº†é€šä¿¡åŒæ–¹çš„èº«ä»½ï¼Œåå•†äº†åŠ å¯†æ¨¡å¼å’Œå‚æ•°ï¼Œå¹¶å»ºç«‹äº†å…±äº«çš„å¯†é’¥ææ–™ã€‚æ¢å¥è¯è¯´ï¼Œæ¡æ‰‹çš„è§’è‰²æ˜¯éªŒè¯é€šä¿¡åŒæ–¹çš„èº«ä»½å¹¶åå•†ä¼šè¯å¯†é’¥ï¼Œä»¥ä¾¿è¿æ¥çš„å…¶ä½™éƒ¨åˆ†å¯ä»¥æ ¹æ®ä¼šè¯å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚å½“æ‚¨çš„åº”ç”¨ç¨‹åºå»ºç«‹ mTLS è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åå•†ä¸€ä¸ªå¯†ç å¥—ä»¶ï¼Œè¯¥å¥—ä»¶è§„å®šäº†æ‚¨çš„åº”ç”¨ç¨‹åºå°†ç”¨äºè¿æ¥å…¶ä½™éƒ¨åˆ†çš„åŠ å¯†ç®—æ³•ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºè¿˜åå•†äº†è¦ä½¿ç”¨çš„åŠ å¯†ä¼šè¯å¯†é’¥ã€‚æ•´ä¸ªæ¡æ‰‹è¿‡ç¨‹éƒ½è¢«è®¾è®¡ä¸ºèƒ½æŠµæŠ—ç¯¡æ”¹ - ä»»ä½•æœªæŒæœ‰ä¸æºå’Œ/æˆ–ç›®æ ‡ç›¸åŒçš„ç‹¬ç‰¹ï¼Œèƒ½å¤Ÿé€šè¿‡åŠ å¯†éªŒè¯çš„èº«ä»½æ–‡æ¡£çš„å®ä½“çš„å¹²æ‰°éƒ½ä¼šè¢«æ‹’ç»ã€‚å› æ­¤ï¼Œåœ¨ä»»ä½•é€šä¿¡æ–¹ç»§ç»­è¿›è¡Œåº”ç”¨ç¨‹åºæ•°æ®ä¹‹å‰ï¼Œéƒ½æœ‰å¿…è¦æ£€æŸ¥æ•´ä¸ªæ¡æ‰‹è¿‡ç¨‹å¹¶éªŒè¯å…¶å®Œæ•´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æ¡æ‰‹å¯ä»¥è¢«è®¤ä¸ºæ˜¯æŒ‰ç…§ TLS 1.3 è§„èŒƒä¸­çš„&lt;a href=&#34;https://datatracker.ietf.org/doc/html/rfc8446#section-2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ¡æ‰‹åè®®æ¦‚è¿°&lt;/a&gt;æœ‰ä¸‰ä¸ªé˜¶æ®µ - å†æ¬¡ä½¿ç”¨&lt;code&gt;frontend&lt;/code&gt;åº”ç”¨ç¨‹åºè°ƒç”¨åç«¯&lt;code&gt;checkout&lt;/code&gt;åº”ç”¨ç¨‹åºçš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¬¬ä¸€é˜¶æ®µï¼š&lt;code&gt;frontend&lt;/code&gt;å’Œ&lt;code&gt;checkout&lt;/code&gt;åå•†å¯ä»¥ç”¨æ¥ä¿æŠ¤æ¡æ‰‹å’Œæµé‡æ•°æ®çš„åŠ å¯†å‚æ•°å’Œå¯†é’¥ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒé˜¶æ®µï¼šåœ¨æ­¤é˜¶æ®µå’Œä¹‹åçš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯åŠ å¯†çš„ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œ&lt;code&gt;frontend&lt;/code&gt;å’Œ&lt;code&gt;checkout&lt;/code&gt;å»ºç«‹å…¶ä»–æ¡æ‰‹å‚æ•°ï¼Œå¹¶ç¡®å®šæ˜¯å¦ä¹Ÿå¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½éªŒè¯ - ä¹Ÿå°±æ˜¯è¯´ï¼ŒmTLSã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰é˜¶æ®µï¼š&lt;code&gt;frontend&lt;/code&gt;é€šè¿‡å…¶å¯é€šè¿‡åŠ å¯†éªŒè¯çš„èº«ä»½éªŒè¯&lt;code&gt;checkout&lt;/code&gt;ï¼ˆåœ¨ mTLS ä¸­ï¼Œ&lt;code&gt;checkout&lt;/code&gt;ä»¥ç›¸åŒçš„æ–¹å¼éªŒè¯&lt;code&gt;frontend&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è‡ª TLS 1.2 ä»¥æ¥ï¼Œä¸æ¡æ‰‹ç›¸å…³çš„æœ‰å‡ ä¸ªä¸»è¦åŒºåˆ«ï¼Œæœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒ TLS 1.3 è§„èŒƒï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ‰€æœ‰æ¡æ‰‹æ¶ˆæ¯ï¼ˆç¬¬äºŒé˜¶æ®µå’Œç¬¬ä¸‰é˜¶æ®µï¼‰éƒ½ä½¿ç”¨åœ¨ç¬¬ä¸€é˜¶æ®µåå•†çš„åŠ å¯†å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚&lt;/li&gt;
&lt;li&gt;å·²ç»å‰Šå‡äº†é—ç•™çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚&lt;/li&gt;
&lt;li&gt;æ·»åŠ äº†é›¶å¾€è¿”æ—¶é—´ï¼ˆ0-RTTï¼‰æ¨¡å¼ï¼ŒèŠ‚çœäº†è¿æ¥è®¾ç½®çš„ä¸€ä¸ªå¾€è¿”æ—¶é—´ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;è®°å½•åè®®&#34;&gt;è®°å½•åè®®&lt;/h3&gt;
&lt;p&gt;åœ¨æ¡æ‰‹é˜¶æ®µåå•†äº† TLS åè®®ç‰ˆæœ¬ã€ä¼šè¯å¯†é’¥å’Œ&lt;a href=&#34;https://en.wikipedia.org/wiki/HMAC&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HMAC&lt;/a&gt;åï¼ŒåŒæ–¹ç°åœ¨å¯ä»¥é€šè¿‡&lt;a href=&#34;https://datatracker.ietf.org/doc/html/rfc8446#section-5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®°å½•åè®®&lt;/a&gt;å®‰å…¨åœ°äº¤æ¢è¢«åˆ†å—çš„åŠ å¯†æ•°æ®ã€‚ä½¿ç”¨æ¡æ‰‹ä¸­åå•†çš„å®Œå…¨ç›¸åŒçš„å‚æ•°å¯¹æµé‡è¿›è¡ŒåŠ å¯†æ˜¯è‡³å…³é‡è¦çš„ï¼ˆå¹¶ä¸”æ˜¯è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œä»¥ç¡®ä¿æµé‡çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å°† TLS 1.3 è§„èŒƒä¸­çš„ä¸¤ä¸ªåè®®æ”¾åœ¨ä¸€èµ·ï¼Œå¹¶ä½¿ç”¨&lt;code&gt;frontend&lt;/code&gt;å’Œ&lt;code&gt;checkout&lt;/code&gt;åº”ç”¨ç¨‹åºæ¥è¯´æ˜ä»¥ä¸‹æµç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å½“å‰ç«¯è°ƒç”¨ç»“è´¦åº”ç”¨ç¨‹åºæ—¶çš„-mtls-æµç¨‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å½“å‰ç«¯è°ƒç”¨ç»“è´¦åº”ç”¨ç¨‹åºæ—¶çš„ mTLS æµç¨‹&#34; srcset=&#34;
               /blog/secure-apps-with-istio/mtls-flow_hu_afee4d21b4eb50e6.webp 400w,
               /blog/secure-apps-with-istio/mtls-flow_hu_cd38b85fa362b4b0.webp 760w,
               /blog/secure-apps-with-istio/mtls-flow_hu_7238a7b718a96f0a.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/secure-apps-with-istio/mtls-flow_hu_afee4d21b4eb50e6.webp&#34;
               width=&#34;760&#34;
               height=&#34;453&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å½“å‰ç«¯è°ƒç”¨ç»“è´¦åº”ç”¨ç¨‹åºæ—¶çš„ mTLS æµç¨‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è°ä¸º&lt;code&gt;frontend&lt;/code&gt;å’Œ&lt;code&gt;checkout&lt;/code&gt;å‘å‡ºèº«ä»½è¯ä¹¦ï¼Ÿå®ƒä»¬é€šå¸¸ç”±å…·æœ‰è‡ªå·±çš„&lt;a href=&#34;https://en.wikipedia.org/wiki/Root_certificate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ ¹è¯ä¹¦&lt;/a&gt;æˆ–ä½¿ç”¨å…¶æ ¹ CA çš„ä¸­é—´è¯ä¹¦çš„&lt;a href=&#34;https://en.wikipedia.org/wiki/Certificate_authority&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰&lt;/a&gt;å‘å‡ºã€‚æ ¹è¯ä¹¦åŸºæœ¬ä¸Šæ˜¯ä¸€ä»½æ ‡è¯†æ ¹ CA çš„å…¬é’¥è¯ä¹¦ï¼Œæ‚¨çš„ç»„ç»‡å¯èƒ½å·²ç»æ‹¥æœ‰æ­¤è¯ä¹¦ã€‚æ ¹è¯ä¹¦ä¼šä¸&lt;code&gt;frontend&lt;/code&gt;ï¼ˆæˆ–&lt;code&gt;checkout&lt;/code&gt;ï¼‰çš„è‡ªå·±çš„æ ¹ç­¾åèº«ä»½è¯ä¹¦ä¸€èµ·åˆ†å‘åˆ°&lt;code&gt;frontend&lt;/code&gt;ã€‚è¿™å°±æ˜¯åŸºæœ¬çš„å…¬é’¥åŸºç¡€è®¾æ–½ï¼ˆPKIï¼‰çš„å·¥ä½œæ–¹å¼ - CA è´Ÿè´£éªŒè¯å®ä½“çš„èº«ä»½æ–‡æ¡£ï¼Œç„¶åä»¥è¯ä¹¦çš„å½¢å¼æˆäºˆå®ƒä¸€ä¸ªæ— æ³•ä¼ªé€ çš„èº«ä»½æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p&gt;æ‚¨å¯ä»¥ä¾èµ–æ‚¨çš„ CA å’Œä¸­é—´ CA ä½œä¸ºèº«ä»½&lt;strong&gt;çœŸç†&lt;/strong&gt;çš„æ¥æºï¼Œä»¥ä¸€ç§ç»´æŒé«˜å¯ç”¨æ€§å¹¶æä¾›ç¨³å®šã€æŒä¹…å¯éªŒè¯çš„èº«ä»½ä¿è¯çš„ç»“æ„åŒ–æ–¹å¼ï¼Œè€Œä¸€ä¸ªåºå¤§çš„åˆ†å¸ƒå¼ IP å’Œèº«ä»½æ˜ å°„ç¼“å­˜åˆ™æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚å½“&lt;code&gt;frontend&lt;/code&gt;å’Œ&lt;code&gt;checkout&lt;/code&gt;çš„èº«ä»½è¯ä¹¦ç”±åŒä¸€ä¸ªæ ¹è¯ä¹¦å‘å‡ºæ—¶ï¼Œ&lt;code&gt;frontend&lt;/code&gt;å’Œ&lt;code&gt;checkout&lt;/code&gt;å¯ä»¥å§‹ç»ˆä»¥ä¸€è‡´ä¸”å¯é çš„æ–¹å¼éªŒè¯å…¶å¯¹ç­‰èº«ä»½ï¼Œæ— è®ºå®ƒä»¬è¿è¡Œåœ¨å“ªä¸ªé›†ç¾¤æˆ–èŠ‚ç‚¹æˆ–è§„æ¨¡ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;æ‚¨äº†è§£äº† mTLS å¦‚ä½•æä¾›åŠ å¯†èº«ä»½ã€æœºå¯†æ€§å’Œå®Œæ•´æ€§ï¼Œé‚£ä¹ˆå½“æ‚¨çš„åº”ç”¨ç¨‹åºæ•°é‡å¢é•¿åˆ°æ•°åƒä¸ªæˆ–æ›´å¤šï¼Œå¹¶ä¸”è·¨å¤šä¸ªé›†ç¾¤æ—¶ï¼Œå…¶å¯æ‰©å±•æ€§å¦‚ä½•å‘¢ï¼Ÿå¦‚æœæ‚¨åœ¨å¤šä¸ªé›†ç¾¤ä¸­å»ºç«‹ä¸€ä¸ªå•ä¸€çš„æ ¹è¯ä¹¦ï¼Œé‚£ä¹ˆåªè¦å®ƒè¢«æ ¹è¯ä¹¦ä¿¡ä»»ï¼Œç³»ç»Ÿå°±ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºæ”¶åˆ°æ¥è‡ªå¦ä¸€ä¸ªé›†ç¾¤çš„è¿æ¥è¯·æ±‚æ—¶è¿›è¡Œå¤„ç† - ç³»ç»ŸçŸ¥é“è¿æ¥ä¸Šçš„èº«ä»½å·²ç»é€šè¿‡åŠ å¯†è¿›è¡Œäº†éªŒè¯ã€‚å½“æ‚¨çš„åº”ç”¨ç¨‹åº pod æ›´æ”¹ IP æˆ–è¢«é‡æ–°éƒ¨ç½²åˆ°å¦ä¸€ä¸ªé›†ç¾¤æˆ–ç½‘ç»œæ—¶ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºï¼ˆæˆ–ä»£è¡¨å…¶è¡ŒåŠ¨çš„ç»„ä»¶ï¼‰åªéœ€ä½¿ç”¨å…¶ç”± CA é“¸é€ çš„å—ä¿¡ä»»è¯ä¹¦å‘ç›®æ ‡å‘èµ·æµé‡å³å¯ã€‚æ— è®ºæ˜¯ 500+ç½‘ç»œè·³è½¬è¿˜æ˜¯ç›´æ¥è¿æ¥ï¼Œæ‚¨çš„è®¿é—®ç­–ç•¥éƒ½ä¼šä»¥ç›¸åŒçš„æ–¹å¼æ‰§è¡Œï¼Œæ— éœ€è·Ÿè¸ªèº«ä»½ç¼“å­˜å¹¶è®¡ç®—å“ªä¸ª IP åœ°å€æ˜ å°„åˆ°å“ªä¸ªåº”ç”¨ç¨‹åº podã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå…³äº FIPS åˆè§„æ€§å‘¢ï¼Ÿæ ¹æ® TLS 1.3 è§„èŒƒï¼ŒTLS å…¼å®¹çš„åº”ç”¨ç¨‹åºå¿…é¡»å®ç°&lt;code&gt;TLS_AES_128_GCM_SHA256&lt;/code&gt;å¯†ç å¥—ä»¶ï¼Œå¹¶å»ºè®®å®ç°&lt;code&gt;TLS_AES_256_GCM_SHA384&lt;/code&gt;ï¼Œè¿™ä¸¤è€…éƒ½åœ¨ NIST çš„&lt;a href=&#34;https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-52r2.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TLS æŒ‡å—&lt;/a&gt;ä¸­ã€‚RSA æˆ– ECDSA æœåŠ¡å™¨è¯ä¹¦ä¹Ÿè¢« TLS 1.3 è§„èŒƒå’Œ NIST çš„ TLS æŒ‡å—æ¨èã€‚åªè¦æ‚¨ä¸º mTLS è¿æ¥ä½¿ç”¨ FIPS 140-2 æˆ– 140-3 åˆè§„çš„åŠ å¯†æ¨¡å—ï¼Œæ‚¨å°±ä¼šèµ°ä¸Š&lt;a href=&#34;https://csrc.nist.gov/projects/cryptographic-module-validation-program/validated-modules&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;FIPS 140-2 æˆ– 140-3 éªŒè¯&lt;/a&gt;çš„æ­£ç¡®è·¯å¾„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯èƒ½å‡ºç°çš„é—®é¢˜&#34;&gt;å¯èƒ½å‡ºç°çš„é—®é¢˜&lt;/h2&gt;
&lt;p&gt;æŒ‰ç…§ TLS 1.3 è§„èŒƒæ­£ç¡®å®æ–½ mTLS è‡³å…³é‡è¦ã€‚å¦‚æœä¸æŒ‰ç…§ TLS è§„èŒƒæ­£ç¡®ä½¿ç”¨ mTLSï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½åœ¨æœªè¢«æ£€æµ‹çš„æƒ…å†µä¸‹å‡ºç°çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;h3 id=&#34;å¦‚æœæœ‰äººåœ¨è¿æ¥ä¸­é—´é™é»˜åœ°æ•è·åŠ å¯†æ•°æ®ä¼šæ€ä¹ˆæ ·&#34;&gt;å¦‚æœæœ‰äººåœ¨è¿æ¥ä¸­é—´é™é»˜åœ°æ•è·åŠ å¯†æ•°æ®ä¼šæ€ä¹ˆæ ·ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å¦‚æœè¿æ¥æ²¡æœ‰æŒ‰ç…§ TLS è§„èŒƒä¸­æ¦‚è¿°çš„æ¡æ‰‹å’Œè®°å½•åè®®æ¥è¿›è¡Œï¼Œä¾‹å¦‚ï¼Œè¿æ¥éµå¾ªæ¡æ‰‹åè®®ï¼Œä½†åœ¨è®°å½•åè®®ä¸­æ²¡æœ‰ä½¿ç”¨æ¡æ‰‹ä¸­åå•†çš„ä¼šè¯å¯†é’¥å’Œå‚æ•°ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°æ‚¨çš„è¿æ¥çš„æ¡æ‰‹å’Œè®°å½•åè®®ä¹‹é—´æ²¡æœ‰å…³è”ï¼Œæ¡æ‰‹å’Œè®°å½•åè®®ä¹‹é—´çš„èº«ä»½å¯èƒ½ä¸åŒã€‚TLS è¦æ±‚æ¡æ‰‹å’Œè®°å½•åè®®åœ¨åŒä¸€è¿æ¥ä¸­å…±äº«ï¼Œå› ä¸ºå°†å®ƒä»¬åˆ†å¼€ä¼šå¢åŠ ä¸­é—´äººæ”»å‡»çš„æ”»å‡»é¢ã€‚&lt;/p&gt;
&lt;p&gt;mTLS è¿æ¥ä»æ¡æ‰‹å¼€å§‹åˆ°ç»“æŸéƒ½å…·æœ‰ä¸€è‡´çš„ç«¯åˆ°ç«¯å®‰å…¨æ€§ã€‚åŠ å¯†æ•°æ®æ˜¯ç”¨è¯ä¹¦ä¸­å…¬é’¥åå•†çš„ä¼šè¯å¯†é’¥åŠ å¯†çš„ã€‚åªæœ‰æºå’Œç›®æ ‡å¯ä»¥ä½¿ç”¨ç§é’¥è§£å¯†æ•°æ®ã€‚æ¢å¥è¯è¯´ï¼Œåªæœ‰æ‹¥æœ‰ç§é’¥çš„è¯ä¹¦æ‰€æœ‰è€…æ‰èƒ½è§£å¯†æ•°æ®ã€‚é™¤éé»‘å®¢æ§åˆ¶äº†è¯ä¹¦çš„ç§é’¥ï¼Œå¦åˆ™ä»–æˆ–å¥¹æ²¡æœ‰åŠæ³•æä¹± mTLS è¿æ¥ä»¥æˆåŠŸæ‰§è¡Œä¸­é—´äººæ”»å‡»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¦‚æœæºæˆ–ç›®æ ‡èº«ä»½æ²¡æœ‰åŠ å¯†å®‰å…¨æ€ä¹ˆåŠ&#34;&gt;å¦‚æœæºæˆ–ç›®æ ‡èº«ä»½æ²¡æœ‰åŠ å¯†å®‰å…¨æ€ä¹ˆåŠï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å¦‚æœèº«ä»½åŸºäºç½‘ç»œå±æ€§ï¼Œå¦‚ IP åœ°å€ï¼Œè¿™äº›å±æ€§å¯èƒ½ä¼šé‡æ–°åˆ†é…ç»™å…¶ä»– podï¼Œå°±æ— æ³•ä½¿ç”¨åŠ å¯†æŠ€æœ¯éªŒè¯è¯¥èº«ä»½ã€‚ç”±äºæ­¤ç±»èº«ä»½ä¸åŸºäºåŠ å¯†èº«ä»½ï¼Œå› æ­¤æ‚¨çš„ç³»ç»Ÿå¯èƒ½æœ‰ä¸€ä¸ªèº«ä»½ç¼“å­˜ï¼Œç”¨äºè·Ÿè¸ªèº«ä»½ã€pod çš„ç½‘ç»œæ ‡ç­¾ã€ç›¸åº”çš„ IP åœ°å€å’Œéƒ¨ç½² pod çš„ Kubernetes èŠ‚ç‚¹ä¿¡æ¯ä¹‹é—´çš„æ˜ å°„ã€‚ä½¿ç”¨èº«ä»½ç¼“å­˜ï¼Œæ‚¨å¯èƒ½ä¼šé‡åˆ° pod IP åœ°å€è¢«é‡ç”¨å’Œèº«ä»½é”™è¯¯ï¼Œå½“èº«ä»½ç¼“å­˜åœ¨çŸ­æ—¶é—´å†…åŒæ­¥å‡ºç°é—®é¢˜æ—¶ï¼Œç­–ç•¥å¯èƒ½æ— æ³•æ­£ç¡®æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„è¿æ¥ä¹‹é—´çš„å¯¹ç­‰æ–¹æ²¡æœ‰åŠ å¯†èº«ä»½ï¼Œæ‚¨çš„ç³»ç»Ÿå°†ä¸å¾—ä¸ä»å¯èƒ½è¿‡æ—¶æˆ–ä¸å®Œæ•´çš„èº«ä»½ç¼“å­˜ä¸­è·å–èº«ä»½ã€‚&lt;/p&gt;
&lt;p&gt;å°†èº«ä»½æ˜ å°„åˆ°å·¥ä½œè´Ÿè½½ IP çš„è¿™äº›èº«ä»½ç¼“å­˜ä¸æ˜¯ ACIDï¼ˆåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§ï¼‰ï¼Œæ‚¨å¸Œæœ›æ‚¨çš„å®‰å…¨ç³»ç»Ÿåº”ç”¨äºå…·æœ‰å¼ºä¿è¯çš„äº‹ç‰©ã€‚è€ƒè™‘ä»¥ä¸‹å±æ€§å’Œæ‚¨å¯èƒ½æƒ³è¦é—®è‡ªå·±çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿‡æ—¶ï¼šå¯¹ç­‰æ–¹å¦‚ä½•éªŒè¯ç¼“å­˜ä¸­çš„æ¡ç›®æ˜¯å¦æ˜¯&lt;strong&gt;å½“å‰&lt;/strong&gt;çš„ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä¸å®Œæ•´ï¼šå¦‚æœç¼“å­˜æœªå‘½ä¸­å¹¶ä¸”ç³»ç»Ÿæœªèƒ½å…³é—­è¿æ¥ï¼Œåªæœ‰ç¼“å­˜&lt;strong&gt;åŒæ­¥å™¨&lt;/strong&gt;å¤±è´¥æ—¶ç½‘ç»œæ‰ä¼šå˜å¾—ä¸ç¨³å®šå—ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚æœæŸä¸ªä¸œè¥¿æ ¹æœ¬æ²¡æœ‰ IP æ€ä¹ˆåŠï¼Ÿä¾‹å¦‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒAWS Lambda æœåŠ¡æ²¡æœ‰å…¬å…± IPã€‚&lt;/li&gt;
&lt;li&gt;éäº‹åŠ¡æ€§ï¼šå¦‚æœæ‚¨è¯»å–ä¸¤æ¬¡èº«ä»½ï¼Œä¼šçœ‹åˆ°ç›¸åŒçš„å€¼å—ï¼Ÿå¦‚æœåœ¨è®¿é—®ç­–ç•¥æˆ–å®¡è®¡å®æ–½ä¸­ä¸å°å¿ƒï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´çœŸæ­£çš„é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;è°å°†å®ˆæŠ¤å®ˆæŠ¤è€…è‡ªå·±ï¼Ÿæ˜¯å¦æœ‰æ—¢å®šçš„å®è·µæ¥ä¿æŠ¤ç¼“å­˜ï¼Œå°±åƒ CA æœ‰çš„é‚£æ ·ï¼Ÿæ‚¨æœ‰ä»€ä¹ˆè¯æ®è¯æ˜ç¼“å­˜æ²¡æœ‰è¢«ç¯¡æ”¹å—ï¼Ÿæ‚¨æ˜¯å¦è¢«è¿«å¯¹ä¸€äº›ä¸æ˜¯æ‚¨çš„ CA çš„å¤æ‚åŸºç¡€è®¾æ–½çš„å®‰å…¨æ€§è¿›è¡Œæ¨ç†ï¼ˆå’Œå®¡è®¡ï¼‰ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šé—®é¢˜ä¸­æœ‰äº›æ¯”å…¶ä»–é—®é¢˜æ›´ç³Ÿã€‚æ‚¨å¯ä»¥åº”ç”¨&lt;strong&gt;å¤±è´¥å…³é—­&lt;/strong&gt;åŸåˆ™ï¼Œä½†è¿™å¹¶ä¸èƒ½è§£å†³æ‰€æœ‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;èº«ä»½ä¹Ÿç”¨äºæ‰§è¡Œè®¿é—®ç­–ç•¥ï¼Œä¾‹å¦‚æˆæƒç­–ç•¥ï¼Œè¿™äº›è®¿é—®ç­–ç•¥åœ¨è¯·æ±‚è·¯å¾„ä¸­ï¼Œæ‚¨çš„ç³»ç»Ÿå¿…é¡»å¿«é€Ÿåšå‡ºå†³å®šï¼Œå…è®¸æˆ–æ‹’ç»è®¿é—®ã€‚æ¯å½“èº«ä»½å‡ºç°é”™è¯¯æ—¶ï¼Œè®¿é—®ç­–ç•¥å¯èƒ½ä¼šè¢«ç»•è¿‡ï¼Œè€Œæ— æ³•è¢«æ£€æµ‹æˆ–å®¡è®¡ã€‚ä¾‹å¦‚ï¼Œæ‚¨çš„èº«ä»½ç¼“å­˜å¯èƒ½å°†æ‚¨çš„&lt;code&gt;checkout&lt;/code&gt; pod çš„å…ˆå‰åˆ†é…çš„ IP åœ°å€ä½œä¸º&lt;code&gt;checkout&lt;/code&gt;èº«ä»½ä¹‹ä¸€ã€‚å¦‚æœ&lt;code&gt;checkout&lt;/code&gt; pod è¢«å›æ”¶ï¼ŒåŒä¸€ IP åœ°å€åˆšåˆšè¢«åˆ†é…ç»™ä¸€ä¸ª&lt;code&gt;frontend&lt;/code&gt; podï¼Œé‚£ä¹ˆåœ¨ç¼“å­˜æ›´æ–°ä¹‹å‰ï¼Œè¯¥&lt;code&gt;frontend&lt;/code&gt; pod å¯èƒ½å…·æœ‰&lt;code&gt;checkout&lt;/code&gt;çš„èº«ä»½ï¼Œè¿™å¯èƒ½å¯¼è‡´é”™è¯¯çš„è®¿é—®ç­–ç•¥è¢«æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬å‡è®¾ä»¥ä¸‹å¤§è§„æ¨¡å¤šé›†ç¾¤éƒ¨ç½²ï¼Œè¯´æ˜èº«ä»½ç¼“å­˜è¿‡æ—¶é—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;100 ä¸ªé›†ç¾¤ï¼Œæ¯ä¸ªé›†ç¾¤æœ‰ 100 ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰ 20 ä¸ª podã€‚æ€»çš„ pod æ•°é‡æ˜¯ 200,000ã€‚&lt;/li&gt;
&lt;li&gt;0.25% çš„ pod ä¸€ç›´åœ¨å˜åŠ¨ï¼ˆæ»šåŠ¨æ›´æ–°ï¼Œé‡å¯ï¼Œæ¢å¤ï¼ŒèŠ‚ç‚¹å˜åŠ¨ç­‰ï¼‰ï¼Œæ¯æ¬¡å˜åŠ¨çš„çª—å£æ˜¯ 10 ç§’ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ 10 ç§’æœ‰ 500 ä¸ªæ­£åœ¨å˜åŠ¨çš„ pod åˆ†å¸ƒåˆ° 10,000 ä¸ªèŠ‚ç‚¹ï¼ˆç¼“å­˜ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœç¼“å­˜åŒæ­¥å™¨åœæ»ï¼Œç³»ç»Ÿåœ¨ 5 åˆ†é’Ÿåè¿‡æ—¶çš„%å¯èƒ½é«˜è¾¾&lt;strong&gt;7.5%&lt;/strong&gt;ï¼&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¸Šå‡è®¾ç¼“å­˜åŒæ­¥å™¨å¤„äºç¨³æ€ã€‚å¦‚æœç¼“å­˜åŒæ­¥å™¨å‡ºç°é—®é¢˜ï¼Œä¼šå½±å“å…¶å¥åº·æ£€æŸ¥ï¼Œå¢åŠ å˜åŠ¨ç‡ï¼Œå¯¼è‡´çº§è”ä¸ç¨³å®šã€‚&lt;/p&gt;
&lt;p&gt;CA ä¹Ÿå¯èƒ½è¢«æ”»å‡»è€…&lt;a href=&#34;https://en.wikipedia.org/wiki/Certificate_authority#CA_compromise&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ”»å‡»&lt;/a&gt;ï¼Œæ”»å‡»è€…å‡è£…æ˜¯åˆ«äººï¼Œæ¬ºéª— CA å‘å‡ºè¯ä¹¦ã€‚ç„¶åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥è¯ä¹¦ä¸å…¶ä»–å¯¹ç­‰æ–¹é€šä¿¡ã€‚è¿™æ˜¯&lt;a href=&#34;https://en.wikipedia.org/wiki/Certificate_authority#Certificate_revocation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯ä¹¦æ’¤é”€&lt;/a&gt;å¯ä»¥é€šè¿‡æ’¤é”€è¯ä¹¦ä½¿å…¶æ— æ•ˆæ¥è§£å†³é—®é¢˜ã€‚å¦åˆ™ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¢«æ”»å‡»çš„è¯ä¹¦ç›´åˆ°å…¶è¿‡æœŸã€‚ä¿æŒæ ¹è¯ä¹¦çš„ç§é’¥åœ¨ HSM ä¸­è‡³å…³é‡è¦ï¼Œè¯¥ HSM åº”ä¿æŒ&lt;a href=&#34;https://en.wikipedia.org/wiki/Online_and_offline&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¦»çº¿&lt;/a&gt;ï¼Œå¹¶ä½¿ç”¨ä¸­é—´è¯ä¹¦ç­¾ç½²å·¥ä½œè´Ÿè½½è¯ä¹¦ã€‚åœ¨ CA åœé¡¿æˆ–åœæ» 5 åˆ†é’Ÿçš„æƒ…å†µä¸‹ï¼Œæ‚¨å°†æ— æ³•è·å¾—æ–°çš„æˆ–ç»­æœŸçš„å·¥ä½œè´Ÿè½½è¯ä¹¦ï¼Œä½†ä¹‹å‰å‘å‡ºçš„æœ‰æ•ˆè¯ä¹¦å°†ç»§ç»­ä¸ºæ‚¨çš„å·¥ä½œè´Ÿè½½æä¾›å¼ºå¤§çš„èº«ä»½ä¿è¯ã€‚ä¸ºäº†æé«˜å‘è¡Œçš„å¯é æ€§ï¼Œæ‚¨å¯ä»¥å°†ä¸­é—´ CA éƒ¨ç½²åˆ°ä¸åŒçš„åŒºåŸŸå’Œåœ°åŒºã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-ä¸­çš„-mtls&#34;&gt;Istio ä¸­çš„ mTLS&lt;/h2&gt;
&lt;h3 id=&#34;å¯ç”¨-mtls&#34;&gt;å¯ç”¨ mTLS&lt;/h3&gt;
&lt;p&gt;åœ¨ Istio ä¸­ä¸ºå†…ç½‘åº”ç”¨ç¨‹åºå¯ç”¨ mTLS éå¸¸ç®€å•ã€‚æ‚¨éœ€è¦åšçš„å°±æ˜¯å°†æ‚¨çš„åº”ç”¨ç¨‹åºæ·»åŠ åˆ°ç½‘æ ¼ä¸­ï¼Œè¿™å¯ä»¥é€šè¿‡ä¸ºæ‚¨çš„å‘½åç©ºé—´æ ‡è®°ä¾§è½¦æ³¨å…¥æˆ–ç¯å¢ƒæ¥å®Œæˆã€‚åœ¨ä¾§è½¦çš„æƒ…å†µä¸‹ï¼Œéœ€è¦è¿›è¡Œæ»šåŠ¨é‡å¯ï¼Œä»¥ä¾¿ä¾§è½¦è¢«æ³¨å…¥åˆ°æ‚¨çš„åº”ç”¨ç¨‹åº pod ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŠ å¯†èº«ä»½&#34;&gt;åŠ å¯†èº«ä»½&lt;/h3&gt;
&lt;p&gt;åœ¨ Kubernetes ç¯å¢ƒä¸­ï¼Œ&lt;a href=&#34;https://istio.io/latest/docs/concepts/security/#istio-identity&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;æ ¹æ®å…¶æœåŠ¡å¸æˆ·åˆ›å»ºåº”ç”¨ç¨‹åºçš„èº«ä»½ã€‚å°†åº”ç”¨ç¨‹åºæ·»åŠ åˆ°ç½‘æ ¼åï¼Œå°†å‘ç½‘æ ¼ä¸­çš„æ¯ä¸ªåº”ç”¨ç¨‹åº pod æä¾›èº«ä»½è¯ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨çš„ pod çš„èº«ä»½è¯ä¹¦åœ¨ 24 å°æ—¶åè¿‡æœŸï¼ŒIstio æ¯ 12 å°æ—¶æ—‹è½¬ä¸€æ¬¡ pod èº«ä»½è¯ä¹¦ï¼Œä»¥ä¾¿åœ¨å‡ºç°å¦¨å®³è¡Œä¸ºçš„æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚ï¼Œè¢«æ”»å‡»çš„ CA æˆ–è¢«ç›—çš„ pod çš„ç§é’¥ï¼‰ï¼Œè¢«æ”»å‡»çš„è¯ä¹¦åªèƒ½åœ¨è¯ä¹¦è¿‡æœŸå¹¶å› æ­¤é™åˆ¶å…¶å¯èƒ½é€ æˆçš„æŸå®³çš„éå¸¸æœ‰é™çš„æ—¶é—´å†…å·¥ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¼ºåˆ¶æ‰§è¡Œä¸¥æ ¼çš„-mtls&#34;&gt;å¼ºåˆ¶æ‰§è¡Œä¸¥æ ¼çš„ mTLS&lt;/h3&gt;
&lt;p&gt;é»˜è®¤çš„ mTLS è¡Œä¸ºæ˜¯å°½å¯èƒ½ä½¿ç”¨ mTLSï¼Œä½†å¹¶ä¸å¼ºåˆ¶æ‰§è¡Œã€‚è¦ä¸¥æ ¼å¼ºåˆ¶æ‚¨çš„åº”ç”¨ç¨‹åºåªæ¥å— mTLS æµé‡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Istio çš„&lt;a href=&#34;https://istio.io/latest/docs/reference/config/security/peer_authentication/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PeerAuthentication&lt;/a&gt;ç­–ç•¥ï¼Œå¯¹æ•´ä¸ªç½‘æ ¼æˆ–æ¯ä¸ªå‘½åç©ºé—´æˆ–å·¥ä½œè´Ÿè½½è¿›è¡Œæ“ä½œã€‚æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥åº”ç”¨ Istio çš„&lt;a href=&#34;https://istio.io/latest/docs/reference/config/security/authorization-policy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AuthorizationPolicy&lt;/a&gt;æ¥æ§åˆ¶æ‚¨çš„å·¥ä½œè´Ÿè½½çš„è®¿é—®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;tls-ç‰ˆæœ¬&#34;&gt;TLS ç‰ˆæœ¬&lt;/h3&gt;
&lt;p&gt;TLS ç‰ˆæœ¬ 1.3 æ˜¯ Istio åœ¨å†…ç½‘åº”ç”¨ç¨‹åºé€šä¿¡ä¸­çš„é»˜è®¤è®¾ç½®ï¼Œä½¿ç”¨ Envoy çš„&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/transport_sockets/tls/v3/common.proto&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é»˜è®¤å¯†ç å¥—ä»¶&lt;/a&gt;ï¼ˆä¾‹å¦‚ï¼Œå¯¹äº Istio 1.19.0ï¼Œä¸º&lt;code&gt;TLS_AES_256_GCM_SHA384&lt;/code&gt;ï¼‰ã€‚å¦‚æœæ‚¨éœ€è¦æ—§çš„ TLS ç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥ä¸ºæ‚¨çš„å·¥ä½œè´Ÿè½½&lt;a href=&#34;https://istio.io/latest/docs/tasks/security/tls-configuration/workload-min-tls-version/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é…ç½®ä¸åŒçš„ç½‘æ ¼èŒƒå›´å†…çš„æœ€å° TLS åè®®ç‰ˆæœ¬&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“æŸè¯­&#34;&gt;ç»“æŸè¯­&lt;/h2&gt;
&lt;p&gt;ç”±äº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ï¼ˆIETFï¼‰åˆ¶å®šçš„ TLS åè®®æ˜¯å­˜åœ¨çš„æœ€å¹¿æ³›å®¡æŸ¥ã€ä¸“å®¶æ‰¹å‡†ã€ç»è¿‡æˆ˜æ–—æµ‹è¯•çš„æ•°æ®å®‰å…¨åè®®ä¹‹ä¸€ã€‚TLS ä¹Ÿåœ¨å…¨çƒå¹¿æ³›ä½¿ç”¨ - æ¯å½“æ‚¨è®¿é—®ä»»ä½•å®‰å…¨ç½‘ç«™ï¼Œæ‚¨éƒ½å¯ä»¥æ”¾å¿ƒè´­ç‰©ï¼Œéƒ¨åˆ†åŸå› æ˜¯å› ä¸ºé”å®šå›¾æ ‡è¡¨æ˜æ‚¨æ­£åœ¨ä½¿ç”¨ TLS å®‰å…¨è¿æ¥åˆ°å—ä¿¡ä»»çš„ç½‘ç«™ã€‚TLS 1.3 åè®®è®¾è®¡å…·æœ‰ç«¯åˆ°ç«¯çš„èº«ä»½éªŒè¯ã€ä¿å¯†æ€§å’Œå®Œæ•´æ€§ï¼Œä»¥ç¡®ä¿æ‚¨çš„åº”ç”¨ç¨‹åºçš„èº«ä»½å’Œé€šä¿¡ä¸è¢«ç ´åï¼Œå¹¶é˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼ˆå¹¶è¢«è®¤ä¸ºæ˜¯ç¬¦åˆæ ‡å‡†çš„ TLSï¼‰ï¼Œæ­£ç¡®éªŒè¯é€šä¿¡å¯¹ç­‰æ–¹å¹¶ä½¿ç”¨ä»æ¡æ‰‹åå•†çš„å¯†é’¥åŠ å¯†æµé‡ä¸ä»…é‡è¦ï¼Œè€Œä¸”è‡³å…³é‡è¦ã€‚ç°åœ¨æ‚¨çŸ¥é“ mTLS åœ¨æ»¡è¶³æ‚¨çš„å®‰å…¨åº”ç”¨ç¨‹åºé€šä¿¡è¦æ±‚ï¼ˆåŠ å¯†èº«ä»½ã€ä¿å¯†æ€§ã€å®Œæ•´æ€§å’Œè®¿é—®ç­–ç•¥æ‰§è¡Œï¼‰æ–¹é¢è¡¨ç°ä¼˜ç§€ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°ä½¿ç”¨ Istio å°†æ‚¨çš„å†…ç½‘åº”ç”¨ç¨‹åºé€šä¿¡å‡çº§åˆ° mTLS - é…ç½®éå¸¸å°‘ï¼&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ç‰¹åˆ«æ„Ÿè°¢ Louis Ryanã€Ben Leggettã€John Howardã€Christian Postaã€Justin Pettit èŠ±è´¹å¤§é‡æ—¶é—´å®¡æŸ¥å’Œæå‡ºåšå®¢çš„æ›´æ–°ï¼&lt;/em&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ç†è§£ä½¿ç”¨ Istio åœ¨ Kubernetes ä¸­çš„ gRPC è´Ÿè½½å‡è¡¡</title>
      <link>https://cloudnativecn.com/blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/</link>
      <pubDate>Thu, 12 Oct 2023 17:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://medium.com/@shrishs/understanding-grpc-load-balancing-in-kubernetes-with-istio-c6e71634724c&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://medium.com/@shrishs/understanding-grpc-load-balancing-in-kubernetes-with-istio-c6e71634724c&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦ï¼šæœ¬æ–‡ä»‹ç»äº†åœ¨ Kubernetes å’Œ Istio ä¸­ä½¿ç”¨ gRPC è´Ÿè½½å‡è¡¡çš„è¡Œä¸ºã€‚é¦–å…ˆï¼Œé€šè¿‡åˆ›å»ºå‘½åç©ºé—´ã€éƒ¨ç½²èµ„æºå’Œé…ç½®æ–‡ä»¶æ¥å‡†å¤‡ç¯å¢ƒã€‚ç„¶åï¼Œä»‹ç»äº†æ²¡æœ‰ Istio çš„æƒ…å†µä¸‹ï¼ŒgRPC æœåŠ¡çš„è´Ÿè½½å‡è¡¡è¡Œä¸ºã€‚æ¥ä¸‹æ¥ï¼Œä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Istio åˆ›å»ºè™šæ‹ŸæœåŠ¡å’Œç›®æ ‡è§„åˆ™æ¥å®ç°è´Ÿè½½å‡è¡¡ã€‚è¿˜è®¨è®ºäº† ConnectionPoolSetting å¯¹è´Ÿè½½å‡è¡¡è¡Œä¸ºçš„å½±å“ã€‚æœ€åï¼Œä»‹ç»äº†å¦‚ä½•é€šè¿‡å…¥å£ç½‘å…³è®¿é—® gRPC æœåŠ¡ï¼Œå¹¶æä¾›äº†éªŒè¯æ­¥éª¤ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/GRPC&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC&lt;/a&gt;&lt;/strong&gt;ï¼ˆgRPC è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å¼€æºé«˜æ€§èƒ½è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰æ¡†æ¶ï¼Œä½¿ç”¨ HTTP/2 è¿›è¡Œä¼ è¾“ã€‚gRPC ç›¸å¯¹äºä¼ ç»Ÿçš„ HTTP æœºåˆ¶å…·æœ‰è¯¸å¤šä¼˜åŠ¿ï¼Œä¾‹å¦‚åœ¨ä¸€ä¸ªè¿æ¥ä¸Šå¤šè·¯å¤ç”¨å¤šä¸ªè¯·æ±‚ï¼ˆHTTP/2ï¼‰ã€‚æœ¬æ–‡å°†è§£é‡Šåœ¨ Kubernetesï¼ˆRedHat Openshiftï¼‰å’Œï¼ˆRedhat Openshift Service Meshï¼‰ä¸­ç»“åˆä½¿ç”¨æ—¶çš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¯å¢ƒå‡†å¤‡&#34;&gt;ç¯å¢ƒå‡†å¤‡&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºä¸¤ä¸ªæ–°çš„å‘½åç©ºé—´&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;oc new-project grpc
oc new-project test
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;åœ¨ grpc å‘½åç©ºé—´éƒ¨ç½²æ‰€æœ‰ä¸æœåŠ¡å™¨ç›¸å…³çš„èµ„æºã€‚æœ¬ç¤ºä¾‹åŸºäº Quarkus çš„&lt;a href=&#34;https://quarkus.io/guides/grpc-getting-started&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC å¿«é€Ÿå…¥é—¨&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ª ConfigMapã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ConfigMap&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpcconfig&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;application.properties&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    numrequest: 25
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    quarkus.grpc.clients.hello.host: grpc.grpc.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    teststring: prom&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;åŸºäºä»¥ä¸‹å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„éƒ¨ç½²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;l1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sidecar.istio.io/inject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;true&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sidecar.istio.io/logLevel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;debug&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;quarkus-config-volume&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpcconfig&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;defaultMode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;420&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;custom-grpc-hello&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;quay.io/shrishs/grpc-plain-text-quickstart-jvm&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;quarkus-config-volume&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/deployments/config&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;restartPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Always&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ç›¸åŒçš„é…ç½®åˆ›å»ºå¦å¤–ä¸¤ä¸ªéƒ¨ç½² grpc-v2 å’Œ grpc-v3ï¼Œåªéœ€æä¾›ä¸åŒçš„ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;app.kubernetes.io/version: l2
&amp;amp;
app.kubernetes.io/version: l3
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;åŸºäºä¸Šè¿°éƒ¨ç½²åˆ›å»ºä¸€ä¸ª Kubernetes æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;åœ¨ test å‘½åç©ºé—´ä¸­åˆ›å»ºå¦ä¸€ä¸ª ConfigMapï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼‰å’Œåä¸º grpc-client çš„éƒ¨ç½²ï¼ˆä½¿ç”¨ä¸Šè¿°ç›¸åŒçš„å®šä¹‰ï¼‰ã€‚å®ƒå°†ç”¨äºè°ƒç”¨åä¸º testString çš„ gRPC æœåŠ¡å’Œ numRequest åœ¨ ConfigMap ä¸­å®šä¹‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@GET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@Path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/grpc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;testGRPC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InterruptedException&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MyClient&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MyClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;9000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;try&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;makeMultipleRequests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;testString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;numRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;finally&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;shutdown&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Hello&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;MyClient&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ManagedChannel&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;channel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GreeterGrpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;GreeterBlockingStub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;blockingStub&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;MyClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ManagedChannelBuilder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;forAddress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;usePlaintext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;MyClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ManagedChannel&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;channel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;channel&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;channel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;blockingStub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GreeterGrpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newBlockingStub&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;channel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;shutdown&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InterruptedException&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;channel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;shutdown&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;awaitTermination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TimeUnit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;SECONDS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;makeMultipleRequests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;numRequests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;numRequests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HelloRequest&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HelloRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newBuilder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HelloReply&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;blockingStub&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;sayHello&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getMessage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ²¡æœ‰-istio-çš„-kubernetes-grpc-æœåŠ¡&#34;&gt;æ²¡æœ‰ Istio çš„ Kubernetes gRPC æœåŠ¡&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;éªŒè¯åº”ç”¨ç¨‹åºæ˜¯å¦åœ¨ grpc å‘½åç©ºé—´ä¸­è¿è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;bash-3.2$ oc -n grpc get pods -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;grpc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                       READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc-v1-7cc77c5cfc-tfbhf   1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          9m15s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc-v2-977b698f6-rb9z6    1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          9m14s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc-v3-8679b7f6ff-hxx9c   1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          9m14s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;ä»æµ‹è¯•å‘½åç©ºé—´æµ‹è¯•è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;oc -n test exec deploy/grpc-client -- curl http://localhost:8080/hello/grpc
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;æ£€æŸ¥æ‰€æœ‰ Pod çš„æ—¥å¿—ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°åªæœ‰ä¸€ä¸ª Pod æ”¶åˆ°äº†æ‰€æœ‰çš„è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/1_hu_1edf57dd931bb7d.webp 400w,
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/1_hu_fbc17bb58d96e096.webp 760w,
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/1_hu_ad7250c41890377a.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/1_hu_1edf57dd931bb7d.webp&#34;
               width=&#34;760&#34;
               height=&#34;542&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šè¿°è¡Œä¸ºçš„åŸå› æ˜¯gRPCæ„å»ºåœ¨HTTP/2ä¹‹ä¸Šï¼Œè€ŒHTTP/2è®¾è®¡ä¸ºå…·æœ‰å•ä¸ªæŒä¹…çš„TCPè¿æ¥ï¼Œåœ¨è¯¥è¿æ¥ä¸Šæ‰€æœ‰è¯·æ±‚éƒ½è¢«&lt;em&gt;å¤šè·¯å¤ç”¨&lt;/em&gt;ï¼Œè¿™æ„å‘³ç€å¤šä¸ªè¯·æ±‚å¯ä»¥åŒæ—¶åœ¨åŒä¸€ä¸ªè¿æ¥ä¸Šè¿›è¡Œã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™æ˜¯å¾ˆå¥½çš„ï¼Œå› ä¸ºå®ƒå‡å°‘äº†è¿æ¥ç®¡ç†çš„å¼€é”€ã€‚ç„¶è€Œï¼Œè¿™ä¹Ÿæ„å‘³ç€ï¼ˆå¯ä»¥æƒ³è±¡ï¼‰è¿æ¥çº§åˆ«çš„è´Ÿè½½å‡è¡¡å¹¶ä¸æ˜¯éå¸¸æœ‰ç”¨ã€‚ä¸€æ—¦è¿æ¥å»ºç«‹å®Œæˆï¼Œå°±æ²¡æœ‰æ›´å¤šçš„è´Ÿè½½å‡è¡¡å¯åšäº†ã€‚æ‰€æœ‰è¯·æ±‚å°†è¢«å›ºå®šåˆ°å•ä¸ªç›®æ ‡ Podã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¸¦æœ‰-istio-çš„-kubernetes-grpc-æœåŠ¡&#34;&gt;å¸¦æœ‰ Istio çš„ Kubernetes gRPC æœåŠ¡&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºè™šæ‹ŸæœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-vs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;grpc.grpc.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;åˆ›å»ºç›®æ ‡è§„åˆ™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-dr&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ISTIO_MUTUAL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connectionPool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http1MaxPendingRequests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http2MaxRequests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maxRequestsPerConnection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tcp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maxConnections&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subsets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;l1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;l2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;l3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;åœ¨ ServiceMeshMemberRoll ä¸­æ·»åŠ  grpc å’Œ test å‘½åç©ºé—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;maistra.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceMeshMemberRoll&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;members&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;é‡å¯ grpc å’Œ test å‘½åç©ºé—´ä¸­çš„ Podã€‚ç°åœ¨ Envoy ä»£ç†ä½œä¸º sidecar é™„åŠ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;bash-3.2$ oc -n grpc get pods -l app=grpc
NAME                       READY   STATUS    RESTARTS   AGE
grpc-v1-7cc77c5cfc-fm9m4   2/2     Running   0          33s
grpc-v2-977b698f6-hrmhq    2/2     Running   0          33s
grpc-v3-8679b7f6ff-lw9fp   2/2     Running   0          32s
bash-3.2$ oc -n test get pods -l app=grpc
NAME                           READY   STATUS    RESTARTS   AGE
grpc-client-65bb4d7c64-4ftpz   2/2     Running   0          37s
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å†æ¬¡æµ‹è¯•æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;oc -n test exec deploy/grpc-client -- curl http://localhost:8080/hello/grpc
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;åœ¨ Kiali ä¸­éªŒè¯å›¾è¡¨ã€‚ç°åœ¨å¯ä»¥è§‚å¯Ÿåˆ°è´Ÿè½½å‡è¡¡åœ¨æ‰€æœ‰ 3 ä¸ª Pod ä¹‹é—´è¿›è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/2_hu_fdf2cd24c078f64a.webp 400w,
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/2_hu_a6eb4f513c0d9c8f.webp 760w,
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/2_hu_ab52a9ceb5f1f4b5.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/2_hu_fdf2cd24c078f64a.webp&#34;
               width=&#34;760&#34;
               height=&#34;623&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šè¿°è¡Œä¸ºçš„åŸå› æ˜¯ï¼ŒIstioï¼ˆEnvoy ä»£ç†ï¼‰ä¼šå¯¹æ¯ä¸ªç›®æ ‡ï¼ˆæ‰€æœ‰ 3 ä¸ª Podï¼‰æ‰“å¼€ä¸€ä¸ª HTTP/2 è¿æ¥ï¼Œå¹¶å°†è¯·æ±‚&lt;em&gt;åˆ†æµ&lt;/em&gt;åˆ°è¿™äº›è¿æ¥ä¸Šã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ Jaeger ä¸­è¿›è¡ŒéªŒè¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/3_hu_6103a4e09c827704.webp 400w,
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/3_hu_5099dd755f471fb4.webp 760w,
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/3_hu_c0b706f44fd4fa59.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/3_hu_6103a4e09c827704.webp&#34;
               width=&#34;760&#34;
               height=&#34;519&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;connectionpoolsetting&#34;&gt;ConnectionPoolSetting&lt;/h2&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ DestinationRule ConnectionPool è®¾ç½®æ¥æ”¹å˜è´Ÿè½½å‡è¡¡çš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»ä¸Šè¿°è·Ÿè¸ªä¸­è·å–è¯·æ±‚ IDï¼Œå¹¶åœ¨ Istio ä»£ç†æ—¥å¿—ä¸­æŸ¥æ‰¾ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/4_hu_58148c8d44e05190.webp 400w,
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/4_hu_39e69bc7a0884a83.webp 760w,
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/4_hu_5d31f467fce2fe69.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/4_hu_58148c8d44e05190.webp&#34;
               width=&#34;760&#34;
               height=&#34;474&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è§‚å¯Ÿä¸Šé¢çš„è¡Œï¼ˆåˆ›å»ºæ–°è¿æ¥ï¼‰ã€‚è¿™æ˜¯å› ä¸ºåœ¨ DestinationRule ConnectionPool è®¾ç½®ä¸­ (&lt;strong&gt;http2MaxRequests&lt;/strong&gt;å’Œ&lt;strong&gt;maxRequestPerConnection&lt;/strong&gt;è¢«å®šä¹‰ä¸º 1)ã€‚æ¯ä¸ªè¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œå¹¶åœ¨è¯·æ±‚å®Œæˆåå…³é—­è¿æ¥ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ›´æ”¹ DestinationRule ConnectionPool è®¾ç½® (&lt;strong&gt;http2MaxRequests: 50, maxRequestsPerConnection: 100&lt;/strong&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ISTIO_MUTUAL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connectionPool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http1MaxPendingRequests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http2MaxRequests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maxRequestsPerConnection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tcp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maxConnections&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;å†æ¬¡æµ‹è¯•æœåŠ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;oc -n test exec deploy/grpc-client -- curl http://localhost:8080/hello/grpc
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;ä» Jaeger ä¸­è·å–è¯·æ±‚ IDï¼Œå¹¶æŸ¥çœ‹ Envoy ä»£ç†æ—¥å¿—ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¯ä¸ªè¿æ¥çš„è¯·æ±‚æ•°å¤§äº 1ï¼Œå®ƒå°†ä½¿ç”¨&lt;strong&gt;ç°æœ‰è¿æ¥&lt;/strong&gt;æ¥å¤„ç†è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/5_hu_9108f1b389e989db.webp 400w,
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/5_hu_1aa063519029d4b4.webp 760w,
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/5_hu_6cb28964d8010c84.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/5_hu_9108f1b389e989db.webp&#34;
               width=&#34;760&#34;
               height=&#34;529&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;é€šè¿‡å…¥å£ç½‘å…³è®¿é—®-grpc-æœåŠ¡&#34;&gt;é€šè¿‡å…¥å£ç½‘å…³è®¿é—® gRPC æœåŠ¡&lt;/h2&gt;
&lt;p&gt;Openshift ä½¿ç”¨ HAProxy ä½œä¸ºå…¥å£æ§åˆ¶å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹æœªå¯ç”¨ HTTP2ã€‚å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼&lt;a href=&#34;https://docs.openshift.com/container-platform/4.12/networking/ingress-operator.html#nw-http2-haproxy_configuring-ingress&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯ç”¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;oc annotate ingresses.config/cluster ingress.operator.openshift.io/default-enable-http2=true
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å¯ç”¨HAProxyçš„HTTP/2åï¼Œä½¿ç”¨&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/ingress/secure-ingress/#configure-a-mutual-tls-ingress-gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº’ç›¸ TLS&lt;/a&gt;åˆ›å»ºä¸€ä¸ªç½‘å…³å®šä¹‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;grpc-istio-system.apps.ocp-XXX.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;MUTUAL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;credentialName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway-certs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;Openshift Service Mesh ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªç»è¿‡è·¯ç”±å®šä¹‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;route.openshift.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-grpc-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maistra.io/gateway-name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maistra.io/gateway-namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maistra.io/generated-by&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ior&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maistra.io/original-host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-istio-system.apps.ocp-XXX.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-istio-system.apps.ocp-XXX.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;termination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;passthrough&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;wildcardPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;éªŒè¯ gRPC æœåŠ¡æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ grpcurl --proto helloworld.proto -v  --insecure --cert istio/files/cert/client.example.com.crt --key istio/files/cert/client.example.com.key -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;name&amp;#34;: &amp;#34;test&amp;#34;}&amp;#39;&lt;/span&gt; grpc-istio-system.apps.ocp-XXX.com:443 helloworld.Greeter/SayHello
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Resolved method descriptor:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;// Sends a greeting
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rpc SayHello &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt; .helloworld.HelloRequest &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; returns &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt; .helloworld.HelloReply &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Request metadata to send:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;empty&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Response headers received:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: application/grpc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Fri, &lt;span class=&#34;m&#34;&gt;19&lt;/span&gt; May &lt;span class=&#34;m&#34;&gt;2023&lt;/span&gt; 15:40:14 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc-accept-encoding: gzip
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: istio-envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;12&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Response contents:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;message&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;Hello test&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Response trailers received:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;empty&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Sent &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; request and received &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; response
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šæœ‰æ—¶ç”±äºå®šä¹‰æœªåœ¨ envoy ä»£ç†ä¸­åŒæ­¥ï¼Œå¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·é‡æ–°å¯åŠ¨å…¥å£ç½‘å…³ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;oc -n istio-system delete pod -l app=istio-ingressgateway
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;åœ¨ Kiali ä¸­è¿›è¡ŒéªŒè¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/7_hu_27f7a9904d6a3b2e.webp 400w,
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/7_hu_1f4765a9d6c78de2.webp 760w,
               /blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/7_hu_322530bfb80c5521.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/understanding-grpc-load-balancing-in-kubernetes-with-istio/7_hu_27f7a9904d6a3b2e.webp&#34;
               width=&#34;760&#34;
               height=&#34;629&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio 1.19 å‘å¸ƒâ€”â€”æ”¯æŒ Gateway API å¹¶æ”¹è¿›äº† Ambient Mesh éƒ¨ç½²æ¨¡å‹</title>
      <link>https://cloudnativecn.com/blog/istio-1-19-release/</link>
      <pubDate>Wed, 06 Sep 2023 09:03:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-1-19-release/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://istio.io/latest/news/releases/1.19.x/announcing-1.19/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/latest/news/releases/1.19.x/announcing-1.19/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Istio 1.19 å‘å¸ƒäº†ï¼Œæ”¯æŒ Kubernetes Gateway APIï¼Œå¹¶æ”¹è¿›äº† Ambient Mesh éƒ¨ç½²æ¨¡å‹ã€‚æœ¬æ¬¡å‘å¸ƒè¿˜åŒ…æ‹¬å®‰å…¨é…ç½®å¢å¼ºå’Œè™šæ‹Ÿæœºå’Œå¤šé›†ç¾¤ä½“éªŒçš„ç®€åŒ–ã€‚æ¬¢è¿æä¾›å‡çº§è¿‡ç¨‹ä¸­çš„åé¦ˆã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æˆ‘ä»¬å¾ˆé«˜å…´åœ°å®£å¸ƒ Istio 1.19 çš„å‘å¸ƒã€‚è¿™æ˜¯ 2023 å¹´çš„ç¬¬ä¸‰ä¸ª Istio å‘å¸ƒç‰ˆæœ¬ã€‚æˆ‘ä»¬è¦æ„Ÿè°¢æ•´ä¸ª Istio ç¤¾åŒºå¸®åŠ©å‘å¸ƒ 1.19.0 ç‰ˆæœ¬ã€‚æˆ‘ä»¬è¦æ„Ÿè°¢è¿™ä¸ªç‰ˆæœ¬çš„å‘å¸ƒç»ç†ï¼Œ&lt;code&gt;Microsoft&lt;/code&gt; çš„ &lt;code&gt;Kalya Subramanian&lt;/code&gt;ï¼Œ&lt;code&gt;DaoCloud&lt;/code&gt; çš„ &lt;code&gt;Xiaopeng Han&lt;/code&gt;ï¼Œä»¥åŠ &lt;code&gt;Google&lt;/code&gt; çš„ &lt;code&gt;Aryan Gupta&lt;/code&gt;ã€‚å‘å¸ƒç»ç†ä»¬è¦ç‰¹åˆ«æ„Ÿè°¢æµ‹è¯•å’Œå‘å¸ƒå·¥ä½œç»„è´Ÿè´£äºº Eric Van Norman (IBM) åœ¨æ•´ä¸ªå‘å¸ƒå‘¨æœŸä¸­çš„å¸®åŠ©å’ŒæŒ‡å¯¼ã€‚æˆ‘ä»¬è¿˜è¦æ„Ÿè°¢ Istio å·¥ä½œç»„çš„ç»´æŠ¤è€…å’Œæ›´å¹¿æ³›çš„ Istio ç¤¾åŒºï¼Œåœ¨å‘å¸ƒè¿‡ç¨‹ä¸­åŠæ—¶æä¾›åé¦ˆã€å®¡æŸ¥ã€ç¤¾åŒºæµ‹è¯•ä»¥åŠä¸ºç¡®ä¿åŠæ—¶å‘å¸ƒçš„æ‰€æœ‰æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;Istio å®˜æ–¹æ”¯æŒ Kubernetes ç‰ˆæœ¬ &lt;code&gt;1.25&lt;/code&gt; åˆ° &lt;code&gt;1.28&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ–°åŠŸèƒ½&#34;&gt;æ–°åŠŸèƒ½&lt;/h2&gt;
&lt;h3 id=&#34;gateway-api&#34;&gt;Gateway API&lt;/h3&gt;
&lt;p&gt;Kubernetes &lt;a href=&#34;http://gateway-api.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway API&lt;/a&gt; æ˜¯ä¸€ä¸ªæ—¨åœ¨å°†ä¸€ç»„ä¸°å¯Œçš„æœåŠ¡ç½‘ç»œ APIï¼ˆç±»ä¼¼äº Istio VirtualService å’Œ Gatewayï¼‰å¼•å…¥ Kubernetes çš„å€¡è®®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œä¸ Gateway API v0.8.0 ç‰ˆæœ¬ä¸€èµ·ï¼Œæ­£å¼æ·»åŠ äº† &lt;a href=&#34;https://gateway-api.sigs.k8s.io/blog/2023/0829-mesh-support/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;service mesh æ”¯æŒ&lt;/a&gt;ï¼è¿™æ˜¯ Kubernetes ç”Ÿæ€ç³»ç»Ÿä¸­å¹¿æ³›ç¤¾åŒºåŠªåŠ›çš„ç»“æœï¼Œå¹¶å…·æœ‰å¤šä¸ªç¬¦åˆå®ç°ï¼ˆåŒ…æ‹¬ Istioï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ &lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/ingress/gateway-api/#mesh-traffic&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mesh æ–‡æ¡£&lt;/a&gt; å¼€å§‹ä½¿ç”¨ã€‚ä¸ä»»ä½•å®éªŒæ€§åŠŸèƒ½ä¸€æ ·ï¼Œéå¸¸æ„Ÿè°¢æ‚¨çš„åé¦ˆã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†ç½‘æ ¼æµé‡ä¹‹å¤–ï¼Œä½¿ç”¨è¯¥ API è¿›è¡Œå…¥å£æµé‡çš„ç”¨æ³• &lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/ingress/gateway-api/#configuring-a-gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å·²ç»è¿›å…¥ beta ç‰ˆ&lt;/a&gt;ï¼Œå¹¶ä¸”å°†å¾ˆå¿«æˆä¸º GAã€‚&lt;/p&gt;
&lt;h3 id=&#34;ambient-mesh&#34;&gt;Ambient Mesh&lt;/h3&gt;
&lt;p&gt;åœ¨æ­¤ç‰ˆæœ¬å‘¨æœŸä¸­ï¼Œå›¢é˜Ÿä¸€ç›´åœ¨åŠªåŠ›æ”¹è¿› &lt;a href=&#34;https://istio.io/latest/docs/ops/ambient/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambient Mesh&lt;/a&gt;ï¼Œè¿™æ˜¯ä¸€ç§æ–°çš„ Istio éƒ¨ç½²æ¨¡å‹ï¼Œå¯æ›¿ä»£ä»¥å‰çš„ sidecar æ¨¡å‹ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰å¬è¯´è¿‡ Ambient Meshï¼Œè¯·æŸ¥çœ‹ &lt;a href=&#34;https://istio.io/latest/blog/2022/introducing-ambient-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»‹ç»åšå®¢æ–‡ç« &lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œå·²æ·»åŠ äº†å¯¹ &lt;code&gt;ServiceEntry&lt;/code&gt;ã€&lt;code&gt;WorkloadEntry&lt;/code&gt;ã€&lt;code&gt;PeerAuthentication&lt;/code&gt; å’Œ DNS ä»£ç†çš„æ”¯æŒã€‚æ­¤å¤–ï¼Œè¿˜è¿›è¡Œäº†ä¸€äº›é”™è¯¯ä¿®å¤å’Œå¯é æ€§æ”¹è¿›ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œæœ¬æ¬¡å‘å¸ƒä¸­ï¼ŒAmbient Mesh ä»å¤„äº alpha ç‰¹æ€§é˜¶æ®µã€‚æ‚¨çš„åé¦ˆå¯¹æ¨åŠ¨ Ambient Mesh èµ°å‘ Beta è‡³å…³é‡è¦ï¼Œè¯·å°è¯•å¹¶å‘Šè¯‰æˆ‘ä»¬æ‚¨çš„æƒ³æ³•ï¼&lt;/p&gt;
&lt;h3 id=&#34;å…¶ä»–æ”¹è¿›&#34;&gt;å…¶ä»–æ”¹è¿›&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ– &lt;code&gt;Virtual Machine&lt;/code&gt; å’Œ &lt;code&gt;Multicluster&lt;/code&gt; çš„ä½“éªŒï¼Œç°åœ¨åœ¨ &lt;code&gt;WorkloadEntry&lt;/code&gt; èµ„æºä¸­ï¼Œåœ°å€å­—æ®µæ˜¯å¯é€‰çš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜å¢å¼ºäº†å®‰å…¨é…ç½®ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä¸º Istio å…¥å£ç½‘å…³çš„ TLS è®¾ç½®é…ç½® &lt;code&gt;OPTIONAL_MUTUAL&lt;/code&gt;ï¼Œè¿™å…è®¸å¯é€‰ä½¿ç”¨å’ŒéªŒè¯å®¢æˆ·ç«¯è¯ä¹¦ã€‚æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡ &lt;code&gt;MeshConfig&lt;/code&gt; é…ç½®æ‚¨å–œæ¬¢çš„ç”¨äºé Istio mTLS æµé‡çš„å¯†ç å¥—ä»¶ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio 1.18 æ€§èƒ½æµ‹è¯•ç»“æœ</title>
      <link>https://cloudnativecn.com/blog/performance-and-scalability/</link>
      <pubDate>Mon, 28 Aug 2023 17:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/performance-and-scalability/</guid>
      <description>&lt;p&gt;Istio å¯ä»¥è½»æ¾åˆ›å»ºå…·æœ‰ä¸°å¯Œè·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€æœåŠ¡é—´èº«ä»½éªŒè¯ã€ç›‘æ§ç­‰åŠŸèƒ½çš„å·²éƒ¨ç½²æœåŠ¡ç½‘ç»œ - æ‰€æœ‰è¿™äº›éƒ½æ— éœ€å¯¹åº”ç”¨ç¨‹åºä»£ç è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚Istio è‡´åŠ›äºä»¥æœ€å°çš„èµ„æºå¼€é”€æä¾›è¿™äº›ä¼˜åŠ¿ï¼Œå¹¶æ—¨åœ¨æ”¯æŒå…·æœ‰é«˜è¯·æ±‚ç‡çš„å¤§å‹ç½‘æ ¼ï¼ŒåŒæ—¶å¢åŠ æœ€å°çš„å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;Istio æ•°æ®å¹³é¢ç»„ä»¶ï¼ˆEnvoy ä»£ç†ï¼‰å¤„ç†æµç»ç³»ç»Ÿçš„æ•°æ®ã€‚Istio æ§åˆ¶å¹³é¢ç»„ä»¶ Istiod é…ç½®æ•°æ®å¹³é¢ã€‚æ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢å…·æœ‰ä¸åŒçš„æ€§èƒ½é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-118-çš„æ€§èƒ½æ‘˜è¦&#34;&gt;Istio 1.18 çš„æ€§èƒ½æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/istio/tools/tree/release-1.18/perf/load&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio è´Ÿè½½æµ‹è¯•&lt;/a&gt;ç½‘æ ¼ç”± 1000 ä¸ªæœåŠ¡å’Œ 2000 ä¸ª sidecar ç»„æˆï¼Œæ¯ç§’æœ‰ 70,000 ä¸ªç½‘æ ¼èŒƒå›´çš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ§åˆ¶å¹³é¢æ€§èƒ½&#34;&gt;æ§åˆ¶å¹³é¢æ€§èƒ½&lt;/h2&gt;
&lt;p&gt;Istiod æ ¹æ®ç”¨æˆ·ç¼–å†™çš„é…ç½®æ–‡ä»¶å’Œç³»ç»Ÿçš„å½“å‰çŠ¶æ€æ¥é…ç½® sidecar ä»£ç†ã€‚åœ¨ Kubernetes ç¯å¢ƒä¸­ï¼Œè‡ªå®šä¹‰èµ„æºå®šä¹‰ (CRD) å’Œéƒ¨ç½²æ„æˆäº†ç³»ç»Ÿçš„é…ç½®å’ŒçŠ¶æ€ã€‚Istio é…ç½®å¯¹è±¡ï¼ˆä¾‹å¦‚ Gateway å’Œ VirtualServiceï¼‰æä¾›ç”¨æˆ·ç¼–å†™çš„é…ç½®ã€‚ä¸ºäº†ç”Ÿæˆä»£ç†çš„é…ç½®ï¼ŒIstiod å¤„ç†æ¥è‡ª Kubernetes ç¯å¢ƒçš„ç»„åˆé…ç½®å’Œç³»ç»ŸçŠ¶æ€ä»¥åŠç”¨æˆ·ç¼–å†™çš„é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;æ§åˆ¶å¹³é¢æ”¯æŒæ•°åƒä¸ªæœåŠ¡ï¼Œåˆ†å¸ƒåœ¨æ•°åƒä¸ª Pod ä¸­ï¼Œå…·æœ‰ç±»ä¼¼æ•°é‡çš„ç”¨æˆ·ç¼–å†™çš„ VirtualService å’Œå…¶ä»–é…ç½®å¯¹è±¡ã€‚Istiod çš„ CPU å’Œå†…å­˜éœ€æ±‚éšç€é…ç½®æ•°é‡å’Œå¯èƒ½çš„ç³»ç»ŸçŠ¶æ€è€Œå˜åŒ–ã€‚CPU æ¶ˆè€—ä¸ä»¥ä¸‹å› ç´ ç›¸å…³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éƒ¨ç½²é€Ÿåº¦å‘ç”Ÿå˜åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®æ›´æ”¹çš„é€Ÿç‡ã€‚&lt;/li&gt;
&lt;li&gt;è¿æ¥åˆ° Istiod çš„ä»£ç†æ•°é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶è€Œï¼Œè¿™éƒ¨åˆ†æœ¬è´¨ä¸Šæ˜¯æ°´å¹³å¯æ‰©å±•çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯ç”¨&lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/sidecar/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘½åç©ºé—´éš”ç¦»&lt;/a&gt;åï¼Œå•ä¸ª Istiod å®ä¾‹å¯ä»¥æ”¯æŒ 1000 ä¸ªæœåŠ¡ã€2000 ä¸ª sidecarã€1 ä¸ª vCPU å’Œ 1.5 GB å†…å­˜ã€‚æ‚¨å¯ä»¥å¢åŠ  Istiod å®ä¾‹çš„æ•°é‡ï¼Œä»¥å‡å°‘é…ç½®åˆ°è¾¾æ‰€æœ‰ä»£ç†æ‰€éœ€çš„æ—¶é—´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ•°æ®å¹³é¢æ€§èƒ½&#34;&gt;æ•°æ®å¹³é¢æ€§èƒ½&lt;/h2&gt;
&lt;p&gt;æ•°æ®å¹³é¢æ€§èƒ½å–å†³äºè®¸å¤šå› ç´ ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯è¿æ¥æ•°&lt;/li&gt;
&lt;li&gt;ç›®æ ‡è¯·æ±‚ç‡&lt;/li&gt;
&lt;li&gt;è¯·æ±‚å¤§å°å’Œå“åº”å¤§å°&lt;/li&gt;
&lt;li&gt;ä»£ç†å·¥ä½œçº¿ç¨‹æ•°&lt;/li&gt;
&lt;li&gt;åè®®&lt;/li&gt;
&lt;li&gt;CPU æ ¸å¿ƒæ•°&lt;/li&gt;
&lt;li&gt;ä»£ç†è¿‡æ»¤å™¨çš„æ•°é‡å’Œç±»å‹ï¼Œç‰¹åˆ«æ˜¯ä¸é¥æµ‹ v2 ç›¸å…³çš„è¿‡æ»¤å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å»¶è¿Ÿã€ååé‡ä»¥åŠä»£ç†çš„ CPU å’Œå†…å­˜æ¶ˆè€—æ˜¯æ ¹æ®ä¸Šè¿°å› ç´ è¿›è¡Œæµ‹é‡çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cpu-å’Œå†…å­˜&#34;&gt;CPU å’Œå†…å­˜&lt;/h3&gt;
&lt;p&gt;ç”±äº sidecar ä»£ç†åœ¨æ•°æ®è·¯å¾„ä¸Šæ‰§è¡Œé¢å¤–çš„å·¥ä½œï¼Œå› æ­¤ä¼šæ¶ˆè€— CPU å’Œå†…å­˜ã€‚åœ¨ Istio 1.18 ä¸­ï¼Œä»£ç†æ¯ç§’æ¯ 1000 ä¸ªè¯·æ±‚æ¶ˆè€—å¤§çº¦ 0.5 ä¸ª vCPUã€‚&lt;/p&gt;
&lt;p&gt;ä»£ç†çš„å†…å­˜æ¶ˆè€—å–å†³äºä»£ç†ä¿å­˜çš„æ€»é…ç½®çŠ¶æ€ã€‚å¤§é‡çš„ä¾¦å¬å™¨ã€é›†ç¾¤å’Œè·¯ç”±ä¼šå¢åŠ å†…å­˜ä½¿ç”¨é‡ã€‚åœ¨å¯ç”¨å‘½åç©ºé—´éš”ç¦»çš„å¤§å‹å‘½åç©ºé—´ä¸­ï¼Œä»£ç†æ¶ˆè€—å¤§çº¦ 50 MB å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºä»£ç†é€šå¸¸ä¸ä¼šç¼“å†²é€šè¿‡çš„æ•°æ®ï¼Œå› æ­¤è¯·æ±‚é€Ÿç‡ä¸ä¼šå½±å“å†…å­˜æ¶ˆè€—ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å»¶è¿Ÿ&#34;&gt;å»¶è¿Ÿ&lt;/h3&gt;
&lt;p&gt;ç”±äº Istio åœ¨æ•°æ®è·¯å¾„ä¸Šæ³¨å…¥äº† sidecar ä»£ç†ï¼Œå› æ­¤å»¶è¿Ÿæ˜¯ä¸€ä¸ªé‡è¦çš„è€ƒè™‘å› ç´ ã€‚Istio æ·»åŠ çš„æ¯ä¸ªåŠŸèƒ½ä¹Ÿä¼šå¢åŠ ä»£ç†å†…éƒ¨çš„è·¯å¾„é•¿åº¦ï¼Œå¹¶å¯èƒ½å½±å“å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;Envoy ä»£ç†åœ¨å“åº”å‘é€åˆ°å®¢æˆ·ç«¯åæ”¶é›†åŸå§‹é¥æµ‹æ•°æ®ã€‚æ”¶é›†è¯·æ±‚çš„åŸå§‹é¥æµ‹æ•°æ®æ‰€èŠ±è´¹çš„æ—¶é—´ä¸ä¼šå½±å“å®Œæˆè¯¥è¯·æ±‚æ‰€éœ€çš„æ€»æ—¶é—´ã€‚ä½†æ˜¯ï¼Œç”±äº worker æ­£å¿™äºå¤„ç†è¯·æ±‚ï¼Œå› æ­¤ worker ä¸ä¼šç«‹å³å¼€å§‹å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚æ­¤è¿‡ç¨‹ä¼šå¢åŠ ä¸‹ä¸€ä¸ªè¯·æ±‚çš„é˜Ÿåˆ—ç­‰å¾…æ—¶é—´ï¼Œå¹¶å½±å“å¹³å‡å»¶è¿Ÿå’Œå°¾éƒ¨å»¶è¿Ÿã€‚å®é™…å°¾éƒ¨å»¶è¿Ÿå–å†³äºæµé‡æ¨¡å¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;istio-118-çš„å»¶è¿Ÿ&#34;&gt;Istio 1.18 çš„å»¶è¿Ÿ&lt;/h3&gt;
&lt;p&gt;åœ¨ç½‘æ ¼å†…éƒ¨ï¼Œè¯·æ±‚å…ˆéå†å®¢æˆ·ç«¯ä»£ç†ï¼Œç„¶åéå†æœåŠ¡å™¨ç«¯ä»£ç†ã€‚åœ¨ Istio 1.18.2 çš„é»˜è®¤é…ç½®ä¸­ï¼ˆå³å¸¦æœ‰é¥æµ‹ v2 çš„ Istioï¼‰ï¼Œä¸¤ä¸ªä»£ç†çš„ç¬¬ 90 ä¸ªç™¾åˆ†ä½å»¶è¿Ÿå’Œç¬¬ 99 ä¸ªç™¾åˆ†ä½æ•°å»¶è¿Ÿåˆ†åˆ«æ¯”åŸºå‡†æ•°æ®å¹³é¢å»¶è¿Ÿå¢åŠ äº†çº¦ 1.7 æ¯«ç§’å’Œ 2.7 æ¯«ç§’ã€‚æˆ‘ä»¬ä½¿ç”¨ &lt;code&gt;http/1.1&lt;/code&gt; åè®®çš„ &lt;a href=&#34;https://github.com/istio/tools/tree/release-1.18/perf/benchmark&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åŸºå‡†æµ‹è¯•&lt;/a&gt;è·å¾—äº†è¿™äº›ç»“æœï¼Œä½¿ç”¨ 16 ä¸ªå®¢æˆ·ç«¯è¿æ¥ã€2 ä¸ªä»£ç†å·¥ä½œçº¿ç¨‹å¹¶å¯ç”¨äº†ç›¸äº’ TLSï¼Œè´Ÿè½½ä¸º 1 kBï¼Œæ¯ç§’ 1000 ä¸ªè¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-p90-å»¶è¿Ÿä¸å®¢æˆ·ç«¯è¿æ¥&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;P90 å»¶è¿Ÿä¸å®¢æˆ·ç«¯è¿æ¥&#34;
           src=&#34;https://cloudnativecn.com/blog/performance-and-scalability/latency_p90_fortio_with_jitter.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      P90 å»¶è¿Ÿä¸å®¢æˆ·ç«¯è¿æ¥
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-p99-å»¶è¿Ÿä¸å®¢æˆ·ç«¯è¿æ¥&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;P99 å»¶è¿Ÿä¸å®¢æˆ·ç«¯è¿æ¥&#34;
           src=&#34;https://cloudnativecn.com/blog/performance-and-scalability/latency_p99_fortio_with_jitter.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      P99 å»¶è¿Ÿä¸å®¢æˆ·ç«¯è¿æ¥
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;no_mesh&lt;/code&gt; å®¢æˆ·ç«¯ pod ç›´æ¥è°ƒç”¨æœåŠ¡å™¨ podï¼Œä¸å­˜åœ¨ sidecarã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;istio_with_stats&lt;/code&gt; å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ sidecar å‡é»˜è®¤é…ç½®é¥æµ‹ã€‚è¿™æ˜¯é»˜è®¤çš„ Istio é…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åŸºå‡†æµ‹è¯•å·¥å…·&#34;&gt;åŸºå‡†æµ‹è¯•å·¥å…·&lt;/h3&gt;
&lt;p&gt;Istio ä½¿ç”¨ä»¥ä¸‹å·¥å…·è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;fortio.org&lt;/code&gt; - æ’å®šååé‡è´Ÿè½½æµ‹è¯•å·¥å…·ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nighthawk&lt;/code&gt; - åŸºäº Envoy çš„è´Ÿè½½æµ‹è¯•å·¥å…·ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;isotope&lt;/code&gt; - å…·æœ‰å¯é…ç½®æ‹“æ‰‘çš„ç»¼åˆåº”ç”¨ç¨‹åºã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Istio æˆä¸ºæœ€å¿«çš„ CNCF æ¯•ä¸šé¡¹ç›®</title>
      <link>https://cloudnativecn.com/blog/istio-service-mesh-graduates-cncf/</link>
      <pubDate>Thu, 13 Jul 2023 07:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-service-mesh-graduates-cncf/</guid>
      <description>&lt;p&gt;Istio æˆä¸º CNCF é¡¹ç›®çš„æ¯•ä¸šç”Ÿã€‚è¿™ä¸€å†å²æ€§çš„æ—¶åˆ»ä»£è¡¨ç€ Istio åœ¨äº‘åŸç”Ÿé¢†åŸŸçš„æˆé•¿å’Œæˆç†Ÿï¼Œæ ‡å¿—ç€æœ€å¹¿æ³›éƒ¨ç½²çš„æœåŠ¡ç½‘æ ¼è¿æ¥äº†ä¸€ä¸ªä»¤äººå…´å¥‹çš„æ–°ç¯‡ç« ã€‚Kubernetes æ˜¯ &lt;a href=&#34;https://www.cncf.io/blog/2018/03/06/kubernetes-first-cncf-project-graduate/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¬¬ä¸€ä¸ªè·å¾—æ¯•ä¸šèµ„æ ¼çš„é¡¹ç›®&lt;/a&gt;ï¼Œæ—¶é—´æ˜¯ 2018 å¹´ã€‚ä»Šå¤©ï¼Œè‡ªå®ƒä½œä¸ºä¸€ä¸ªå­µåŒ–é¡¹ç›®è¿›å…¥ CNCF ä¸åˆ°ä¸€å¹´çš„æ—¶é—´ï¼ŒIstio å°±æ¯•ä¸šäº†ï¼Œæˆä¸º CNCF å†å²ä¸Šæœ€å¿«çš„ä¸€ä¸ªã€‚&lt;/p&gt;
&lt;p&gt;Tetrate æ˜¯ç”± Istio åˆ›å§‹å›¢é˜Ÿçš„æˆå‘˜åˆ›ç«‹çš„ï¼Œæ—¨åœ¨æ¨å¹¿å’Œæ‰©å¤§æœåŠ¡ç½‘æ ¼çš„åº”ç”¨ï¼Œå¹¶è‡ªåˆ›ç«‹ä»¥æ¥ä¸€ç›´æ˜¯ Istio æœ€é‡è¦çš„è´¡çŒ®è€…ä¹‹ä¸€ã€‚æˆ‘ä»¬ä¸º Istio åŠå…¶ç¤¾åŒºçš„è¾›å‹¤å·¥ä½œå’Œå¥‰çŒ®å–å¾—äº†è¿™ä¸€é‡Œç¨‹ç¢‘å¼çš„è®¤å¯è€Œæ„Ÿåˆ°è‡ªè±ªå’Œå…´å¥‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-æ¯•ä¸šæ„å‘³ç€ä»€ä¹ˆ&#34;&gt;Istio æ¯•ä¸šæ„å‘³ç€ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;CNCF é¡¹ç›®åˆ†ä¸ºä¸‰ä¸ªç±»åˆ«ï¼Œä½œä¸ºé¡¹ç›®æˆç†Ÿåº¦çš„æ ‡å¿—ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ²™ç›’ã€‚&lt;/strong&gt; CNCFâ€œæ²™ç›’â€æ˜¯ CNCF å†…æ–°é¡¹ç›®çš„å…¥å£ã€‚å®ƒä¸ºæ—©æœŸé˜¶æ®µçš„é¡¹ç›®æä¾›æ”¯æŒã€æŒ‡å¯¼å’Œå¯è§åº¦ï¼Œä»¥ä¾¿ä» CNCF ç¤¾åŒºä¸­è·å¾—æ”¯æŒã€‚æ²™ç›’æ—¨åœ¨ä¸ºè¿™äº›é¡¹ç›®æä¾›ä¸€ä¸ªå®‰å…¨å’Œåä½œçš„ç¯å¢ƒï¼Œä»¥ä¾¿å®ƒä»¬è¿›è¡Œå®éªŒã€åˆ›æ–°å’Œæˆç†Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å­µåŒ–ã€‚&lt;/strong&gt; å­µåŒ–é¡¹ç›®å·²ç»è¶…è¿‡äº†å¼€å‘çš„æ—©æœŸé˜¶æ®µï¼Œå¹¶å±•ç¤ºäº†æˆä¸ºæˆç†Ÿäº‘åŸç”ŸæŠ€æœ¯çš„æ½œåŠ›ã€‚Istio å‡­å€Ÿå…¶å¼ºå¤§çš„ç¤¾åŒºå’Œæ—©æœŸé‡‡ç”¨è€…çš„ä¸æ–­ç”Ÿäº§ä½¿ç”¨è€Œè¢«æ¥çº³ä¸º CNCF çš„å­µåŒ–é¡¹ç›®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¯•ä¸šã€‚&lt;/strong&gt; æ¯•ä¸šé¡¹ç›®åœ¨äº‘åŸç”Ÿç”Ÿæ€ç³»ç»Ÿä¸­å·²ç»å…·æœ‰äº†é«˜åº¦çš„æˆç†Ÿåº¦ã€é‡‡ç”¨ç‡å’Œé‡è¦æ€§ã€‚å®ƒä»¬å·²ç»&lt;a href=&#34;https://github.com/cncf/toc/blob/main/process/graduation_criteria.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ»¡è¶³äº† CNCF æ¯•ä¸šæ ‡å‡†&lt;/a&gt;ï¼Œè¢«è®¤ä¸ºæ˜¯ç¨³å®šã€é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒçš„è§£å†³æ–¹æ¡ˆï¼Œå·²ç»åœ¨ç°å®ä¸–ç•Œçš„éƒ¨ç½²ä¸­è¯æ˜äº†å®ƒä»¬çš„æœ‰æ•ˆæ€§ã€å¯é æ€§å’Œå¯æ‰©å±•æ€§ã€‚Istio ç°åœ¨è¢« CNCF æ­£å¼è®¤å¯ä¸ºè¿™æ ·çš„è§£å†³æ–¹æ¡ˆï¼Œè¯æ˜äº†å®ƒä½œä¸ºç¤¾åŒºå¼ºå¤§ã€å¼€å‘é€Ÿåº¦å¿«ã€åœ¨â€œæ—©æœŸå¤šæ•°â€ä¼ä¸šä¸­çš„é‡‡ç”¨ç‡å¢é•¿å¼ºåŠ²ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-æ¯•ä¸šå¯¹ç”¨æˆ·æ„å‘³ç€ä»€ä¹ˆ&#34;&gt;Istio æ¯•ä¸šå¯¹ç”¨æˆ·æ„å‘³ç€ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å¯¹äºé‚£äº›å·²ç»å°†å…¶ç”¨ä½œåŸºç¡€è®¾æ–½æ ¸å¿ƒéƒ¨åˆ†çš„ç”¨æˆ·ï¼ŒCNCF æ¯•ä¸šæ˜¯å¯¹ä»–ä»¬å°† Istio è§†ä¸ºç°ä»£åº”ç”¨ç¨‹åºç½‘ç»œçš„å…³é”®ç»„ä»¶çš„æ„¿æ™¯çš„éªŒè¯ã€‚å¯¹äºé‚£äº›æ­£åœ¨å¯»æ±‚ç°ä»£åŒ–åŸºç¡€è®¾æ–½çš„ç”¨æˆ·ï¼ŒIstio çš„æ¯•ä¸šåœ°ä½æ˜¯ä¸€ä¸ªå¼ºæœ‰åŠ›çš„ä¿¡å·ï¼Œè¡¨æ˜å®ƒæ˜¯ä¸€ä¸ªç»è¿‡éªŒè¯å’Œå¼ºå¤§çš„é€‰æ‹©ï¼Œå¯ç”¨äºåœ¨ç”Ÿäº§ä¸­æ‰©å±•å…³é”®åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºç”¨æˆ·æ¥è¯´ï¼ŒIstio çš„æ¯•ä¸šåœ°ä½å…·æœ‰å‡ ä¸ªå«ä¹‰å’Œä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¨³å®šæ€§å’Œæˆç†Ÿåº¦ã€‚&lt;/strong&gt; æ½œåœ¨ç”¨æˆ·å¯ä»¥ä¿¡ä»»è¯¥é¡¹ç›®çš„ç¨³å®šæ€§ï¼ŒçŸ¥é“å®ƒå·²ç»æ»¡è¶³äº† CNCF å¯¹æ¯•ä¸šçš„ä¸¥æ ¼æ ‡å‡†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨æ€§ã€‚&lt;/strong&gt; Istio æ‹¥æœ‰é•¿æœŸè€Œå¼ºå¤§çš„ &lt;a href=&#34;https://istio.io/latest/news/security/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘å¸ƒåŠæ—¶çš„å®‰å…¨å…¬å‘Š&lt;/a&gt;ï¼Œä»¥åŠè¡Œä¸šæœ€é‡è¦çš„å®‰å…¨æ€æƒ³é¢†è¢–çš„æˆ˜ç•¥æŒ‡å¯¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç”Ÿäº§å°±ç»ªã€‚&lt;/strong&gt; æ¯•ä¸šåœ°ä½ä¸ºç”¨æˆ·æä¾›äº†å¿…è¦çš„åŠŸèƒ½ã€å¯æ‰©å±•æ€§å’Œå¥å£®æ€§ï¼Œå¯ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é‡‡ç”¨å’Œç”Ÿæ€ç³»ç»Ÿã€‚&lt;/strong&gt; æ¯•ä¸šé¡¹ç›®å·²ç»åœ¨äº‘åŸç”Ÿç”Ÿæ€ç³»ç»Ÿä¸­è·å¾—äº†æ˜¾ç€çš„é‡‡ç”¨ã€‚å®ƒä»¬è¢«å„ç§è§„æ¨¡å’Œè¡Œä¸šçš„ç»„ç»‡å¹¿æ³›è®¤å¯å’Œä½¿ç”¨ã€‚Istio çš„ç”¨æˆ·ä»å…¶ä»–é‡‡ç”¨è€…çš„ç»éªŒä¸­å—ç›Šã€‚æ¯•ä¸šé¡¹ç›®çš„å¹¿æ³›é‡‡ç”¨è¿˜ä¿ƒè¿›äº†å·¥å…·ã€æ‰©å±•å’Œé›†æˆçš„å……æ»¡æ´»åŠ›çš„ç”Ÿæ€ç³»ç»Ÿï¼Œå¯ä»¥è¿›ä¸€æ­¥å¢å¼ºå…¶åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CNCF æ”¯æŒå’Œæ²»ç†ã€‚&lt;/strong&gt; æ¯•ä¸šé¡¹ç›®ä¹Ÿå—ç›Šäº CNCF çš„æ”¯æŒå’Œæ²»ç†ã€‚CNCF æä¾›èµ„æºã€æŒ‡å¯¼å’Œåä½œæ¡†æ¶å’Œç¤¾åŒºå‚ä¸ã€‚ç”¨æˆ·å¯ä»¥ä¿¡ä»»è¯¥é¡¹ç›®çš„é•¿æœŸå¯æŒç»­æ€§å’Œå¼€å‘è·¯çº¿å›¾ï¼Œå› ä¸ºå®ƒæ˜¯ç”±è‡´åŠ›äºæ¨è¿›äº‘åŸç”ŸæŠ€æœ¯çš„å¯ä¿¡ç»„ç»‡æ”¯æŒçš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤¾åŒºå’Œä¼ä¸šæ”¯æŒã€‚&lt;/strong&gt; ç¤¾åŒºæä¾›çš„é›†ä½“çŸ¥è¯†ã€ç»éªŒå’Œæ”¯æŒæä¾›äº†å¹¿æ³›ç”¨æˆ·ç¾¤ä½“çš„åˆ©ç›Šï¼Œå¯ä»¥è·å¾—è¯¸å¦‚æ–‡æ¡£ã€è®ºå›å’Œç”¨æˆ·ç»„ç­‰èµ„æºï¼Œå¹¶åœ¨è§£å†³é—®é¢˜å’Œè§£å†³é—®é¢˜æ–¹é¢æä¾›æ½œåœ¨å¸®åŠ©ã€‚Istio ç”Ÿæ€ç³»ç»Ÿè¿˜äº«æœ‰æ¥è‡ªä¼—å¤šä¾›åº”å•†ï¼ˆåŒ…æ‹¬ Tetrateï¼‰çš„ä¼ä¸šæ”¯æŒï¼Œè¿™äº›ä¾›åº”å•†ä¸ºéœ€è¦åœ¨éœ€è¦æ—¶è·å¾—ä¸“å®¶æ”¯æŒçš„ç»„ç»‡æä¾›äº†ä¿è¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;tetrate-å¯¹-istio-çš„å½±å“&#34;&gt;Tetrate å¯¹ Istio çš„å½±å“&lt;/h2&gt;
&lt;p&gt;Tetrate ä»ä¸€å¼€å§‹å°±æ·±åº¦å‚ä¸äº† Istio çš„å¼€å‘ï¼Œå¹¶åœ¨åƒç¾å›½å›½é˜²éƒ¨ã€Visaã€FICOã€Informaticaã€Freddie Macã€Box ç­‰ç»„ç»‡ä¸­æ¨åŠ¨äº† Istio çš„é‡‡ç”¨ã€‚Tetrate å’Œ Istio åœ¨ä¸€äº›å…³é”®æ–¹é¢å—ç›Šäºäº‘åŸç”Ÿç”Ÿæ€ç³»ç»Ÿï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä»£ç è´¡çŒ®ã€‚&lt;/strong&gt; åœ¨è¿‡å»ä¸€å¹´ä¸­ï¼ŒTetrate å·¥ç¨‹å¸ˆç§¯æä¸º Istio å’Œ Envoy é¡¹ç›®åšå‡ºäº†æ¯”ä»»ä½•å…¶ä»–å…¬å¸éƒ½å¤šçš„ä»£ç è´¡çŒ®ï¼Œè¿™äº›è´¡çŒ®ä¸º Istio æä¾›äº†ä»£ç å’Œæ”¹è¿›ï¼Œå¸®åŠ©å¢å¼ºäº†å…¶åŠŸèƒ½ã€æ€§èƒ½å’Œæ€»ä½“è´¨é‡ï¼Œå¹¶æ¨åŠ¨äº† Istio åœ¨ç¤¾åŒºä¸­çš„å¢é•¿å’Œé‡‡ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å”¯ä¸€çš„çº¯ OSS ä¼ä¸šäº§å“ã€‚&lt;/strong&gt; Tetrate ä¸ Istio çš„åˆä½œä¸ºä¼ä¸šæä¾›äº†ä¸“ä¸šçš„æ”¯æŒæœåŠ¡å’Œæ”¯æŒï¼Œç¡®ä¿ Istio åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„é¡ºåˆ©é‡‡ç”¨å’Œè¿è¡Œã€‚ &lt;a href=&#34;https://istio.tetratelabs.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Istio Distro&lt;/a&gt;æ˜¯ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ª 100% çº¯ä¸Šæ¸¸ Istio å‘è¡Œç‰ˆï¼Œå·²ç»å®ç°äº† FIPS åˆè§„å¹¶ç»è¿‡åŠ å›ºï¼Œé€‚ç”¨äºä¼ä¸šå’Œ FedRAMP ç¯å¢ƒå¦‚&lt;a href=&#34;https://tetrate.io/press/tetrate-chosen-by-united-states-air-force-to-speed-delivery-of-secure-and-compliant-software-applications-in-1-75m-contract/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¾å›½ç©ºå†›&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…±åŒçš„ä¸“ä¸šçŸ¥è¯†ã€‚&lt;/strong&gt; Tetrate çš„å·¥ç¨‹å¸ˆå‚ä¸äº† Istio çš„åˆ›å§‹å’Œå‘å±•ï¼Œæ·±å…¥äº†è§£ Istio çš„å†…éƒ¨ç»“æ„ï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿä¸ºéƒ¨ç½² Istio çš„ç»„ç»‡æä¾›å…¨é¢çš„æ”¯æŒå’ŒæŒ‡å¯¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åˆ¶å®šæ ‡å‡†çš„å®‰å…¨é¢†å¯¼åŠ›ã€‚&lt;/strong&gt; Tetrate æ˜¯å”¯ä¸€ä¸€å®¶ä¸ NISTï¼ˆè´Ÿè´£å®šä¹‰ç¾å›½è”é‚¦æ”¿åºœè§„å®šçš„é›¶ä¿¡ä»»å®‰å…¨è¦æ±‚çš„æœºæ„ï¼‰ä¸€èµ·ç¼–å†™äº†å¾®æœåŠ¡çš„å®‰å…¨æ ‡å‡†å’Œæœ€ä½³å®è·µçš„æœåŠ¡ç½‘æ ¼å…¬å¸ã€‚Tetrate çš„åˆ›å§‹å·¥ç¨‹å¸ˆ Zack Butcher ä¸ NIST åˆä½œï¼Œä½œä¸ºå¾®æœåŠ¡å®‰å…¨æ ‡å‡† SP 800-204 ç³»åˆ—çš„å…±åŒä½œè€…ï¼Œæä¾›äº†æœ‰å…³ä¼ä¸šå¦‚ä½•ä½¿ç”¨ Istio ç¡®ä¿å’Œç®€åŒ–åˆè§„çš„æŒ‡å¯¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤¾åŒºå‚ä¸ã€æ•™è‚²å’ŒåŸ¹è®­ã€‚&lt;/strong&gt; Tetrate ä¸ Istio çš„åˆä½œä¿ƒè¿›äº†ç¤¾åŒºå‚ä¸å’ŒçŸ¥è¯†å…±äº«ï¼ŒTetrate çš„ä¸“å®¶å‚åŠ äº†æ´»åŠ¨å’Œä¼šè®®ï¼Œå¹¶&lt;a href=&#34;https://academy.tetrate.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆ›å»ºäº† Tetrate Academy&lt;/a&gt;ï¼Œä»¥æ•™è‚²å’Œèµ‹æƒ Istio ç”Ÿæ€ç³»ç»Ÿä¸­çš„ç”¨æˆ·å’Œå¼€å‘äººå‘˜ã€‚è¶…è¿‡ 5,000 åå¹³å°è¿è¥å’Œå¼€å‘äººå‘˜å·²ç»å‚åŠ äº† Tetrate çš„å…è´¹åœ¨çº¿ Istio å’Œ Envoy è¯¾ç¨‹ï¼Œè¿˜æœ‰æ•°ç™¾åæˆä¸ºäº†&lt;a href=&#34;https://academy.tetrate.io/courses/certified-istio-administrator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate è®¤è¯çš„ Istio ç®¡ç†å‘˜&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç”Ÿæ€ç³»ç»Ÿæ‰©å±•ã€‚&lt;/strong&gt; Tetrate çš„äº§å“ï¼Œä¾‹å¦‚&lt;a href=&#34;https://www.google.com/search?q=tetrate&amp;#43;service&amp;#43;bridge&amp;amp;oq=tetrate&amp;#43;service&amp;#43;bridge&amp;amp;aqs=chrome.0.69i59j0i22i30l2j69i60j69i61.3546j0j7&amp;amp;sourceid=chrome&amp;amp;ie=UTF-8&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt;ï¼Œæ‰©å±•äº† Istio çš„åŠŸèƒ½ï¼Œè§£å†³äº†å¯»æ±‚å®‰å…¨å’Œé«˜æ•ˆæœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆçš„ç»„ç»‡ä¸æ–­å˜åŒ–çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;Istio å’Œ Tetrate ä¹‹é—´çš„ç´§å¯†åˆä½œä»¥åŠ Tetrate å·¥ç¨‹å¸ˆçš„è´¡çŒ®åœ¨ Istio çš„å¢é•¿ã€å‘å±•å’ŒæˆåŠŸæ¯•ä¸šä½œä¸º CNCF é¡¹ç›®ä¸­å‘æŒ¥äº†å…³é”®ä½œç”¨ï¼Œå°†å…¶ç¡®ç«‹ä¸ºä¸šç•Œé¢†å…ˆçš„æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;tetrate-å’Œ-istio-äº¤ç»‡å†å²çš„ç®€è¦æ—¶é—´çº¿&#34;&gt;Tetrate å’Œ Istio äº¤ç»‡å†å²çš„ç®€è¦æ—¶é—´çº¿&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;2016 å¹´ï¼šIstio è¯ç”Ÿã€‚Lyftã€Google å’Œ IBM çš„ä¸€ç»„å·¥ç¨‹å¸ˆå¼€å‘äº† Istioï¼Œä½œä¸ºç®¡ç†å’Œä¿æŠ¤å¾®æœåŠ¡çš„å¼€æºæœåŠ¡ç½‘æ ¼å¹³å°ã€‚Tetrate çš„è”åˆåˆ›å§‹äºº Varun Talwar æ‹…ä»»äº† Istio çš„åˆ›å§‹äº§å“ç»ç†ã€‚Varun åœ¨åˆå§‹çš„ Istio å›¢é˜Ÿä¸­ä¸ Tetrate åˆ›å§‹å·¥ç¨‹å¸ˆ Zack Butcher ä¸€èµ·å·¥ä½œï¼Œåœ¨ Google æ—¶æä¾›æˆ˜ç•¥æ–¹å‘ï¼Œæ¨åŠ¨äº†è¯¥é¡¹ç›®çš„æ„¿æ™¯å’Œè·¯çº¿å›¾ã€‚&lt;a href=&#34;https://www.youtube.com/watch?v=G1-xOrh-oQE&amp;amp;list=PLm51GPKRAmTnk_VtOxnHe7QXMyFscV0IV&amp;amp;index=5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è§‚çœ‹ Varun Talwar å…³äºé¡¹ç›®æ„¿æ™¯å’Œä½¿å‘½ä»¥åŠå¦‚ä½•ç»å—æ—¶é—´è€ƒéªŒçš„è®²è¯â€º&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;2017 å¹´ï¼šIstio 0.1 å‘å¸ƒã€‚&lt;/li&gt;
&lt;li&gt;2018 å¹´ï¼šæˆç«‹ Tetrate å¹¶å‘å¸ƒ 1.0 ç‰ˆæœ¬å®£å¸ƒ Istio å·²å‡†å¤‡å¥½ç”Ÿäº§ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;2019 å¹´ï¼š&lt;a href=&#34;https://istio.io/latest/news/releases/1.1.x/announcing-1.1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio 1.1 å‘å¸ƒï¼Œå®£å¸ƒå·²ç»å‡†å¤‡å¥½ç”¨äºä¼ä¸šçº§åº”ç”¨&lt;/a&gt;ï¼›Tetrate æ‰©å¤§ Istio ç”Ÿæ€ç³»ç»Ÿï¼Œä¸ºé‡‡ç”¨ Istio çš„ä¼ä¸šæä¾›æ”¯æŒã€å’¨è¯¢å’ŒåŸ¹è®­æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;2020 å¹´ã€‚Tetrate ä¸º Istio è´¡çŒ®äº† VM å·¥ä½œè´Ÿè½½å’Œå¤šé›†ç¾¤æ”¯æŒã€‚&lt;/li&gt;
&lt;li&gt;2021 å¹´ã€‚Tetrate é¢†å¯¼äº† Istio ç”Ÿæ€ç³»ç»Ÿçš„æ‰©å±•ï¼Œæ¨å‡ºäº† Istio çš„&lt;a href=&#34;https://academy.tetrate.io/courses/certified-istio-administrator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯å”¯ä¸€çš„è®¤è¯è€ƒè¯•&lt;/a&gt;è®¤è¯ Istio ç®¡ç†å‘˜ - ä»¥åŠç¬¬ä¸€ä¸ªè‡ªåŠ©å¼ Istio è¯¾ç¨‹ï¼ŒIstio Fundamentals&lt;a href=&#34;https://academy.tetrate.io/courses/istio-fundamentals&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ Tetrate Academy ä¸Šå…è´¹æä¾›&lt;/a&gt;ã€‚è¿™é—¨è¯¾ç¨‹æ˜¯&lt;a href=&#34;https://training.linuxfoundation.org/training/introduction-to-istio-lfs144x/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linux åŸºé‡‘ä¼šå®˜æ–¹çš„ Istio å…¥é—¨è¯¾ç¨‹&lt;/a&gt;çš„åŸºç¡€ï¼Œè¿„ä»Šå·²æœ‰è¶…è¿‡ 5,000 äººæŠ¥åã€‚&lt;/li&gt;
&lt;li&gt;2021 å¹´ã€‚Tetrate è¿˜å‘å¸ƒäº† Tetrate Istio Distroï¼Œ&lt;a href=&#34;https://istio.tetratelabs.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£…ã€ç®¡ç†å’Œå‡çº§ Istio çš„æœ€ç®€å•æ–¹æ³•&lt;/a&gt;ï¼Œä»¥åŠ&lt;a href=&#34;https://tetrate.io/tetrate-service-bridge-general-availability/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¶çªç ´æ€§åº”ç”¨ç¨‹åºå®‰å…¨å’Œè¿æ¥å¹³å°çš„ 1.0 ç‰ˆæœ¬&lt;/a&gt;ï¼ŒTetrate Service Bridgeã€‚&lt;/li&gt;
&lt;li&gt;2022 å¹´ã€‚Tetrate Istio Distro æˆä¸º&lt;a href=&#34;https://tetrate.io/how-tetrate-istio-distro-became-the-first-fips-compliant-istio-distribution/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¬¬ä¸€ä¸ªé€‚ç”¨äº FedRAMP ç¯å¢ƒçš„ FIPS åˆè§„ã€100% ä¸Šæ¸¸ Istio å‘è¡Œç‰ˆ&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;2022 å¹´ã€‚&lt;a href=&#34;https://www.cncf.io/blog/2022/09/28/istio-sails-into-the-cloud-native-computing-foundation/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åŠ å…¥ CNCF&lt;/a&gt;ä½œä¸ºå­µåŒ–å™¨é¡¹ç›®ã€‚&lt;/li&gt;
&lt;li&gt;2023 å¹´ã€‚Tetrate å®£å¸ƒ&lt;a href=&#34;https://tetrate.io/tetrate-service-express/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Express ç®€åŒ– Istio åœ¨ Amazon EKS ä¸Šçš„éƒ¨ç½²&lt;/a&gt;ï¼Œä½¿ç”Ÿäº§ä¸­çš„ Istio éƒ¨ç½²æ›´å¿«ã€‚&lt;/li&gt;
&lt;li&gt;2023 å¹´ã€‚Istio è¢« CNCF æ™‹å‡ä¸ºæ¯•ä¸šé¡¹ç›®ï¼Œæ ‡å¿—ç€å®ƒåœ¨äº‘åŸç”Ÿç”Ÿæ€ç³»ç»Ÿä¸­çš„é‡è¦æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¼€å§‹ä½¿ç”¨-istio&#34;&gt;å¼€å§‹ä½¿ç”¨ Istio&lt;/h2&gt;
&lt;p&gt;å¦‚æœæ‚¨æ˜¯æœåŠ¡ç½‘æ ¼å’Œ Kubernetes å®‰å…¨æ€§æ–¹é¢çš„æ–°æ‰‹ï¼Œæˆ‘ä»¬åœ¨&lt;a href=&#34;https://tetr8.io/academy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Academy&lt;/a&gt;ä¸Šæä¾›äº†è®¸å¤šå…è´¹çš„åœ¨çº¿è¯¾ç¨‹ï¼Œå¯ä»¥å¿«é€Ÿäº†è§£ Istio å’Œ Envoyã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾å¿«é€Ÿè¿›å…¥ Istio ç”Ÿäº§ç¯å¢ƒçš„æ–¹æ³•ï¼Œè¯·æŸ¥çœ‹&lt;a href=&#34;https://tetr8.io/tid&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Istio&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://tetr8.io/tid&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Istio Distroï¼ˆTIDï¼‰&lt;/a&gt;ï¼ŒTetrate çš„ç¡¬åŒ–ã€å®Œå…¨ä¸Šæ¸¸çš„ Istio åˆ†å‘ï¼Œå…·å¤‡ FIPS éªŒè¯æ„å»ºå’Œå¯ç”¨çš„æ”¯æŒã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¼€å§‹ Istio çš„æ–¹å¼ï¼Œæ‚¨å¯ä»¥ä¿¡ä»»ä¸€ä¸ªå¯ä¿¡çš„åˆ†å‘ï¼Œæœ‰ä¸€ä¸ªä¸“ä¸šçš„å›¢é˜Ÿæ”¯æŒæ‚¨ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œè¿˜å¯ä»¥å¿«é€Ÿå®ç° FIPS åˆè§„ã€‚&lt;/p&gt;
&lt;p&gt;éšç€æ‚¨å‘ç½‘æ ¼æ·»åŠ æ›´å¤šçš„åº”ç”¨ç¨‹åºï¼Œæ‚¨éœ€è¦ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼æ¥ç®¡ç†è¿™äº›éƒ¨ç½²ï¼Œå¹¶åè°ƒæ¶‰åŠçš„ä¸åŒå›¢é˜Ÿçš„è¦æ±‚ã€‚è¿™å°±æ˜¯ Tetrate Service Bridge çš„ä½œç”¨ã€‚äº†è§£æœ‰å…³ Tetrate Service Bridge å¦‚ä½•ä½¿æœåŠ¡ç½‘æ ¼æ›´åŠ å®‰å…¨ã€å¯ç®¡ç†å’Œæœ‰å¼¹æ€§çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å•å‡»&lt;a href=&#34;https://tetr8.io/tsb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt;ï¼Œæˆ–&lt;a href=&#34;https://tetr8.io/contact&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è”ç³»æˆ‘ä»¬è¿›è¡Œå¿«é€Ÿæ¼”ç¤º&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio Ambient æ¨¡å¼ä½¿ç”¨ Waypoint ä»£ç†ç®€åŒ– Istio éƒ¨ç½²</title>
      <link>https://cloudnativecn.com/blog/waypoint-proxy-made-simple/</link>
      <pubDate>Tue, 04 Apr 2023 08:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/waypoint-proxy-made-simple/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;è¯‘è€…æ³¨ï¼šæœ¬æ–‡ä»‹ç»äº† Istio çš„æ–°çš„ç›®çš„åœ°å¯¼å‘çš„ waypoint ä»£ç†ï¼Œå®ƒå¯ä»¥ç®€åŒ–å’Œæ‰©å±• Istio çš„åŠŸèƒ½ã€‚æ–‡ç« ä»‹ç»äº† waypoint ä»£ç†çš„æ¶æ„ï¼Œéƒ¨ç½²æ–¹å¼ï¼Œä»¥åŠå¦‚ä½•å°†æºä»£ç†çš„é…ç½®è½¬ç§»åˆ°ç›®çš„åœ°ä»£ç†ï¼Œä»è€Œæé«˜å¯æ‰©å±•æ€§ï¼Œå¯è°ƒè¯•æ€§ï¼Œä¸€è‡´æ€§å’Œå®‰å…¨æ€§ã€‚æ–‡ç« è¿˜å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Istio çš„ç­–ç•¥å’Œé¥æµ‹æ¥ç®¡ç†å’Œç›‘æ§ waypoint ä»£ç†ã€‚æ–‡ç« çš„æ¥æºæ˜¯ Istio å®˜æ–¹åšå®¢ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ambient å°† Istio çš„åŠŸèƒ½åˆ†ä¸ºä¸¤ä¸ªä¸åŒçš„å±‚ï¼Œä¸€ä¸ªå®‰å…¨è¦†ç›–å±‚å’Œä¸€ä¸ªä¸ƒå±‚æµé‡å¤„ç†å±‚ã€‚Waypoint ä»£ç†æ˜¯ä¸€ä¸ªå¯é€‰ç»„ä»¶ï¼Œå®ƒåŸºäº Envoy å¹¶ä¸ºå…¶ç®¡ç†çš„å·¥ä½œè´Ÿè½½è¿›è¡Œä¸ƒå±‚æµé‡å¤„ç†ã€‚è‡ª 2022 å¹´&lt;a href=&#34;https://istio.io/latest/blog/2022/introducing-ambient-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é¦–æ¬¡å¯åŠ¨ Ambient&lt;/a&gt; ä»¥æ¥ï¼Œæˆ‘ä»¬è¿›è¡Œäº†é‡å¤§æ›´æ”¹ä»¥ç®€åŒ–è·¯ç‚¹é…ç½®ã€å¯è°ƒè¯•æ€§å’Œå¯æ‰©å±•æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;waypoint-ä»£ç†çš„æ¶æ„&#34;&gt;Waypoint ä»£ç†çš„æ¶æ„&lt;/h2&gt;
&lt;p&gt;ä¸ sidecar ç±»ä¼¼ï¼Œwaypoint ä»£ç†ä¹Ÿæ˜¯åŸºäº Envoy çš„ï¼Œç”± Istio åŠ¨æ€é…ç½®ä»¥æœåŠ¡äºæ‚¨çš„åº”ç”¨ç¨‹åºã€‚Waypoint ä»£ç†çš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºå®ƒè¿è¡Œæ¯ä¸ªå‘½åç©ºé—´ï¼ˆé»˜è®¤ï¼‰æˆ–æ¯ä¸ªæœåŠ¡è´¦æˆ·ã€‚é€šè¿‡åœ¨åº”ç”¨ç¨‹åº pod ä¹‹å¤–è¿è¡Œï¼Œwaypoint ä»£ç†å¯ä»¥ç‹¬ç«‹äºåº”ç”¨ç¨‹åºå®‰è£…ã€å‡çº§å’Œæ‰©å±•ï¼Œå¹¶é™ä½è¿è¥æˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-waypoint-ä»£ç†æ¶æ„&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Waypoint ä»£ç†æ¶æ„&#34; srcset=&#34;
               /blog/waypoint-proxy-made-simple/waypoint-architecture_hu_c8dcee4b7bddcbd1.webp 400w,
               /blog/waypoint-proxy-made-simple/waypoint-architecture_hu_7e93c705330ffbcd.webp 760w,
               /blog/waypoint-proxy-made-simple/waypoint-architecture_hu_e8d5ef2b6871855b.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/waypoint-proxy-made-simple/waypoint-architecture_hu_c8dcee4b7bddcbd1.webp&#34;
               width=&#34;760&#34;
               height=&#34;333&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Waypoint ä»£ç†æ¶æ„
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Kubernetes Gateway èµ„æºæˆ– &lt;code&gt;istioctl&lt;/code&gt; å‘½ä»¤ä»¥å£°æ˜æ–¹å¼éƒ¨ç½² waypoint ä»£ç†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl experimental waypoint generate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: gateway.networking.k8s.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: Gateway
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: namespace
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  gatewayClassName: istio-waypoint
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  listeners:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - name: mesh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    port: &lt;span class=&#34;m&#34;&gt;15008&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    protocol: HBONE
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Istiod å°†ç›‘æ§è¿™äº›èµ„æºå¹¶è‡ªåŠ¨ä¸ºç”¨æˆ·éƒ¨ç½²å’Œç®¡ç†ç›¸åº”çš„ waypoint éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å°†æºä»£ç†é…ç½®è½¬ç§»åˆ°ç›®æ ‡ä»£ç†&#34;&gt;å°†æºä»£ç†é…ç½®è½¬ç§»åˆ°ç›®æ ‡ä»£ç†&lt;/h2&gt;
&lt;p&gt;åœ¨ç°æœ‰çš„ sidecar æ¶æ„ä¸­ï¼Œå¤§å¤šæ•°æµé‡æ•´å½¢ï¼ˆä¾‹å¦‚&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/request-routing/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯·æ±‚è·¯ç”±&lt;/a&gt;æˆ–&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/traffic-shifting/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æµé‡è½¬ç§»&lt;/a&gt;æˆ–&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/fault-injection/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ•…éšœæ³¨å…¥&lt;/a&gt;ï¼‰ç­–ç•¥ç”±æºï¼ˆå®¢æˆ·ç«¯ï¼‰ä»£ç†å®ç°ï¼Œè€Œå¤§å¤šæ•°å®‰å…¨ç­–ç•¥ç”±ç›®æ ‡ï¼ˆæœåŠ¡å™¨ï¼‰ä»£ç†å®ç°ã€‚è¿™å¯¼è‡´äº†ä¸€äº›æ‹…å¿§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¼©æ”¾ â€”â€” æ¯ä¸ªæº sidecar éƒ½éœ€è¦çŸ¥é“å…³äºç½‘æ ¼ä¸­æ¯ä¸ªå…¶ä»–ç›®çš„åœ°çš„ä¿¡æ¯ã€‚è¿™æ˜¯ä¸€ä¸ªå¤šé¡¹å¼ç¼©æ”¾é—®é¢˜ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå¦‚æœä»»ä½•ç›®æ ‡é…ç½®å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦ç«‹å³é€šçŸ¥æ‰€æœ‰ sidecarã€‚&lt;/li&gt;
&lt;li&gt;è°ƒè¯• â€”â€” å› ä¸ºç­–ç•¥æ‰§è¡Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ sidecar ä¹‹é—´åˆ†å¼€ï¼Œæ‰€ä»¥åœ¨æ•…éšœæ’é™¤æ—¶å¾ˆéš¾ç†è§£ç³»ç»Ÿçš„è¡Œä¸ºã€‚&lt;/li&gt;
&lt;li&gt;æ··åˆç¯å¢ƒ â€”â€” å¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿä¸æ˜¯æ‰€æœ‰å®¢æˆ·ç«¯éƒ½æ˜¯ç½‘æ ¼çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸ä¸€è‡´çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œéç½‘æ ¼å®¢æˆ·ç«¯ä¸ä¼šéµå®ˆé‡‘ä¸é›€éƒ¨ç½²ç­–ç•¥ï¼Œä»è€Œå¯¼è‡´æ„å¤–çš„æµé‡åˆ†é…ã€‚&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰æƒå’Œå½’å± â€”â€” ç†æƒ³æƒ…å†µä¸‹ï¼Œåœ¨ä¸€ä¸ªå‘½åç©ºé—´ä¸­ç¼–å†™çš„ç­–ç•¥åº”è¯¥åªå½±å“åœ¨åŒä¸€å‘½åç©ºé—´ä¸­è¿è¡Œçš„ä»£ç†ã€‚ç„¶è€Œï¼Œåœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œå®ƒæ˜¯ç”±æ¯ä¸ª sidecar åˆ†å‘å’Œæ‰§è¡Œçš„ã€‚å°½ç®¡ Istio å·²å›´ç»•æ­¤çº¦æŸè¿›è¡Œè®¾è®¡ä»¥ç¡®ä¿å…¶å®‰å…¨ï¼Œä½†å®ƒä»ç„¶ä¸æ˜¯æœ€ä½³é€‰æ‹©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ Ambient ä¸­ï¼Œæ‰€æœ‰ç­–ç•¥éƒ½ç”±ç›®çš„åœ° waypoint ä»£ç†å¼ºåˆ¶æ‰§è¡Œã€‚åœ¨è®¸å¤šæ–¹é¢ï¼Œwaypoint å……å½“è¿›å…¥å‘½åç©ºé—´ï¼ˆé»˜è®¤èŒƒå›´ï¼‰æˆ–æœåŠ¡è´¦æˆ·çš„ç½‘å…³ã€‚Istio å¼ºåˆ¶æ‰€æœ‰è¿›å…¥å‘½åç©ºé—´çš„æµé‡éƒ½ç»è¿‡ waypointï¼Œç„¶åè¯¥ waypoint æ‰§è¡Œè¯¥å‘½åç©ºé—´çš„æ‰€æœ‰ç­–ç•¥ã€‚å› æ­¤ï¼Œæ¯ä¸ª waypoint åªéœ€è¦äº†è§£å…¶è‡ªå·±å‘½åç©ºé—´çš„é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;å¯æ‰©å±•æ€§é—®é¢˜å¯¹äºåœ¨å¤§å‹é›†ç¾¤ä¸­è¿è¡Œçš„ç”¨æˆ·æ¥è¯´å°¤å…¶éº»çƒ¦ã€‚å¦‚æœæˆ‘ä»¬å°†å…¶å¯è§†åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–°æ¶æ„çš„æ”¹è¿›æœ‰å¤šå¤§ã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘ä¸€ä¸ªç®€å•çš„éƒ¨ç½²ï¼Œæˆ‘ä»¬æœ‰ 2 ä¸ªå‘½åç©ºé—´ï¼Œæ¯ä¸ªå‘½åç©ºé—´æœ‰ 2 ä¸ªï¼ˆé¢œè‰²ç¼–ç ï¼‰éƒ¨ç½²ã€‚å¯¹ sidecar è¿›è¡Œç¼–ç¨‹æ‰€éœ€çš„ Envoy (XDS) é…ç½®æ˜¾ç¤ºä¸ºåœ†åœˆï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ¯ä¸ª-sidecar-éƒ½æœ‰å…³äºæ‰€æœ‰å…¶ä»–-sidecar-çš„é…ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ¯ä¸ª sidecar éƒ½æœ‰å…³äºæ‰€æœ‰å…¶ä»– sidecar çš„é…ç½®&#34; srcset=&#34;
               /blog/waypoint-proxy-made-simple/sidecar-config_hu_d4af6fdec18b774b.webp 400w,
               /blog/waypoint-proxy-made-simple/sidecar-config_hu_ff96c3579390f163.webp 760w,
               /blog/waypoint-proxy-made-simple/sidecar-config_hu_2d1db116a4b9945c.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/waypoint-proxy-made-simple/sidecar-config_hu_d4af6fdec18b774b.webp&#34;
               width=&#34;753&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ¯ä¸ª sidecar éƒ½æœ‰å…³äºæ‰€æœ‰å…¶ä»– sidecar çš„é…ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ sidecar æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ 4 ä¸ªå·¥ä½œè´Ÿè½½ï¼Œæ¯ä¸ªå·¥ä½œè´Ÿè½½æœ‰ 4 ç»„é…ç½®ã€‚å¦‚æœè¿™äº›é…ç½®ä¸­çš„ä»»ä½•ä¸€ä¸ªå‘ç”Ÿæ›´æ”¹ï¼Œåˆ™æ‰€æœ‰è¿™äº›é…ç½®éƒ½éœ€è¦æ›´æ–°ã€‚æ€»å…±æœ‰ 16 ä¸ªé…ç½®åˆ†å¸ƒã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œåœ¨ waypoint æ¶æ„ä¸­ï¼Œé…ç½®å¾—åˆ°äº†æå¤§çš„ç®€åŒ–ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ¯ä¸ª-waypoint-åªæœ‰è‡ªå·±çš„å‘½åç©ºé—´çš„é…ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ¯ä¸ª waypoint åªæœ‰è‡ªå·±çš„å‘½åç©ºé—´çš„é…ç½®&#34; srcset=&#34;
               /blog/waypoint-proxy-made-simple/waypoint-config_hu_1f0701be3a718e3f.webp 400w,
               /blog/waypoint-proxy-made-simple/waypoint-config_hu_85b207f8fe33452e.webp 760w,
               /blog/waypoint-proxy-made-simple/waypoint-config_hu_3639d77110b334aa.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/waypoint-proxy-made-simple/waypoint-config_hu_1f0701be3a718e3f.webp&#34;
               width=&#34;760&#34;
               height=&#34;456&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ¯ä¸ª waypoint åªæœ‰è‡ªå·±çš„å‘½åç©ºé—´çš„é…ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªæˆªç„¶ä¸åŒçš„æ•…äº‹ã€‚æˆ‘ä»¬åªæœ‰ 2 ä¸ª waypoint ä»£ç†ï¼Œå› ä¸ºæ¯ä¸ªä»£ç†éƒ½èƒ½å¤Ÿä¸ºæ•´ä¸ªå‘½åç©ºé—´æä¾›æœåŠ¡ï¼Œå¹¶ä¸”æ¯ä¸ªä»£ç†åªéœ€è¦ä¸ºè‡ªå·±çš„å‘½åç©ºé—´è¿›è¡Œé…ç½®ã€‚æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬å‘é€äº† 25% çš„é…ç½®ï¼Œå³ä½¿æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬å°†æ¯ä¸ªå‘½åç©ºé—´æ‰©å±•åˆ°æœ€å¤š 25 ä¸ªéƒ¨ç½²ï¼Œæ¯ä¸ªéƒ¨ç½²æœ‰ 10 ä¸ª podï¼Œæ¯ä¸ª waypoint éƒ¨ç½²æœ‰ 2 ä¸ª pod ä»¥å®ç°é«˜å¯ç”¨æ€§ï¼Œè¿™äº›æ•°å­—ä¼šæ›´ä»¤äººå°è±¡æ·±åˆ» â€”â€” waypoint é…ç½®åˆ†å¸ƒåªéœ€è¦ sidecar é…ç½®åˆ†å¸ƒçš„ 0.8%ï¼Œå¦‚è¡¨ä¸‹é¢è¯´æ˜ï¼&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;é…ç½®åˆ†å‘&lt;/th&gt;
          &lt;th&gt;å‘½åç©ºé—´ 1&lt;/th&gt;
          &lt;th&gt;å‘½åç©ºé—´ 2&lt;/th&gt;
          &lt;th&gt;æ€»æ•°&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Sidecar&lt;/td&gt;
          &lt;td&gt;25 ç§é…ç½® * 250 ä¸ª sidecar&lt;/td&gt;
          &lt;td&gt;25 ç§é…ç½® * 250 ä¸ª sidecar&lt;/td&gt;
          &lt;td&gt;12500&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Waypoint&lt;/td&gt;
          &lt;td&gt;25 ç§é…ç½® * 2 ä¸ª waypoint&lt;/td&gt;
          &lt;td&gt;25 ç§é…ç½® * 2 ä¸ª waypoint&lt;/td&gt;
          &lt;td&gt;100&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Waypoint/Sidecar&lt;/td&gt;
          &lt;td&gt;0.8%&lt;/td&gt;
          &lt;td&gt;0.8%&lt;/td&gt;
          &lt;td&gt;0.8%&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è™½ç„¶æˆ‘ä»¬ä½¿ç”¨å‘½åç©ºé—´èŒƒå›´çš„ waypoint ä»£ç†æ¥è¯´æ˜ä¸Šé¢çš„ç®€åŒ–ï¼Œä½†å½“æ‚¨å°†å…¶åº”ç”¨äºæœåŠ¡è´¦æˆ· waypoint ä»£ç†æ—¶ï¼Œç®€åŒ–æ˜¯ç›¸ä¼¼çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§å‡å°‘çš„é…ç½®æ„å‘³ç€æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢çš„èµ„æºä½¿ç”¨ç‡ï¼ˆCPUã€RAM å’Œç½‘ç»œå¸¦å®½ï¼‰è¾ƒä½ã€‚è™½ç„¶ä»Šå¤©çš„ç”¨æˆ·å¯ä»¥é€šè¿‡è°¨æ…ä½¿ç”¨ &lt;code&gt;exportTo&lt;/code&gt; Istio ç½‘ç»œèµ„æºæˆ– &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/sidecar/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sidecar&lt;/a&gt; API çœ‹åˆ°ç±»ä¼¼çš„æ”¹è¿›ï¼Œä½†åœ¨ Ambient æ¨¡å¼ä¸‹ä¸å†éœ€è¦è¿™æ ·åšï¼Œä»è€Œä½¿æ‰©å±•å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¦‚æœæˆ‘çš„ç›®çš„åœ°æ²¡æœ‰-waypoint-ä»£ç†æ€ä¹ˆåŠ&#34;&gt;å¦‚æœæˆ‘çš„ç›®çš„åœ°æ²¡æœ‰ waypoint ä»£ç†æ€ä¹ˆåŠï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Ambient æ¨¡å¼çš„è®¾è®¡å›´ç»•è¿™æ ·ä¸€ä¸ªå‡è®¾ï¼Œå³å¤§å¤šæ•°é…ç½®æœ€å¥½ç”±æœåŠ¡ç”Ÿäº§è€…è€Œä¸æ˜¯æœåŠ¡æ¶ˆè´¹è€…å®æ–½ã€‚ç„¶è€Œï¼Œæƒ…å†µå¹¶éæ€»æ˜¯å¦‚æ­¤ â€”â€” æœ‰æ—¶æˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬æ— æ³•æ§åˆ¶çš„ç›®çš„åœ°é…ç½®æµé‡ç®¡ç†ã€‚ä¸€ä¸ªå¸¸è§çš„ä¾‹å­æ˜¯è¿æ¥åˆ°å…·æœ‰æ›´é«˜å¼¹æ€§çš„å¤–éƒ¨æœåŠ¡ï¼Œä»¥å¤„ç†å¶å°”çš„è¿æ¥é—®é¢˜ï¼ˆä¾‹å¦‚ï¼Œä¸º &lt;code&gt;example.com&lt;/code&gt; è°ƒç”¨æ·»åŠ è¶…æ—¶ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ç¤¾åŒºä¸­æ­£åœ¨ç§¯æå¼€å‘çš„ä¸€ä¸ªé¢†åŸŸï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­è®¾è®¡å¦‚ä½•å°†æµé‡è·¯ç”±åˆ°æ‚¨çš„å‡ºå£ç½‘å…³ï¼Œä»¥åŠæ‚¨å¦‚ä½•ä½¿ç”¨æ‰€éœ€çš„ç­–ç•¥é…ç½®å‡ºå£ç½‘å…³ã€‚ç•™æ„è¿™æ–¹é¢çš„æœªæ¥åšå®¢æ–‡ç« ï¼&lt;/p&gt;
&lt;h2 id=&#34;æ·±å…¥äº†è§£-waypoint-ä»£ç†é…ç½®&#34;&gt;æ·±å…¥äº†è§£ waypoint ä»£ç†é…ç½®&lt;/h2&gt;
&lt;p&gt;å‡è®¾æ‚¨å·²éµå¾ª &lt;a href=&#34;http://preliminary.istio.io/latest/docs/ops/ambient/getting-started/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambient å…¥é—¨æŒ‡å—&lt;/a&gt;ç›´è‡³å¹¶åŒ…æ‹¬&lt;a href=&#34;http://preliminary.istio.io/latest/docs/ops/ambient/getting-started/#control&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ§åˆ¶æµé‡éƒ¨åˆ†&lt;/a&gt;ï¼Œæ‚¨å·²ç»ä¸º bookinfo-reviews æœåŠ¡è´¦æˆ·éƒ¨ç½²äº†ä¸€ä¸ª waypoint ä»£ç†ï¼Œä»¥å°† 90% çš„æµé‡å¼•å¯¼è‡³ reviews v1ï¼Œå°† 10% çš„æµé‡å¼•å¯¼è‡³ reviews v2ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt;æ£€ç´¢ &lt;code&gt;reviews&lt;/code&gt; waypoint ä»£ç†çš„ç›‘å¬å™¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl proxy-config listener deploy/bookinfo-reviews-istio-waypoint --waypoint
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;LISTENER              CHAIN                                                 MATCH                                         DESTINATION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://connect_originate                                                       ALL                                           Cluster: connect_originate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://main_internal inbound-vip&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;9080&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;reviews.default.svc.cluster.local-http  &lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.96.104.108 -&amp;gt; &lt;span class=&#34;nv&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;                 Inline Route: /*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://main_internal direct-tcp                                            &lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.244.2.14 -&amp;gt; ANY                         Cluster: encap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://main_internal direct-tcp                                            &lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.244.1.6 -&amp;gt; ANY                          Cluster: encap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://main_internal direct-tcp                                            &lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.244.2.11 -&amp;gt; ANY                         Cluster: encap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://main_internal direct-http                                           &lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.244.2.11 -&amp;gt; application-protocol&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;h2c&amp;#39;&lt;/span&gt;  Cluster: encap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://main_internal direct-http                                           &lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.244.2.11 -&amp;gt; application-protocol&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http/1.1&amp;#39;&lt;/span&gt; Cluster: encap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://main_internal direct-http                                           &lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.244.2.14 -&amp;gt; application-protocol&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http/1.1&amp;#39;&lt;/span&gt; Cluster: encap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://main_internal direct-http                                           &lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.244.2.14 -&amp;gt; application-protocol&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;h2c&amp;#39;&lt;/span&gt;  Cluster: encap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://main_internal direct-http                                           &lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.244.1.6 -&amp;gt; application-protocol&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;h2c&amp;#39;&lt;/span&gt;   Cluster: encap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://main_internal direct-http                                           &lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.244.1.6 -&amp;gt; application-protocol&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http/1.1&amp;#39;&lt;/span&gt;  Cluster: encap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://connect_terminate default                                               ALL                                           Inline Route:
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯¹äºåˆ°è¾¾ç«¯å£ &lt;code&gt;15008&lt;/code&gt; çš„è¯·æ±‚ï¼Œé»˜è®¤ä¸º Istio çš„å…¥ç«™ HBONE ç«¯å£ï¼Œwaypoint ä»£ç†ç»ˆæ­¢ HBONE è¿æ¥å¹¶å°†è¯·æ±‚è½¬å‘åˆ° &lt;code&gt;main_internal&lt;/code&gt; ç›‘å¬å™¨ä»¥æ‰§è¡Œä»»ä½•å·¥ä½œè´Ÿè½½ç­–ç•¥ï¼Œå¦‚ AuthorizationPolicyã€‚å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/other_features/internal_listener&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å†…éƒ¨ç›‘å¬å™¨&lt;/a&gt;ï¼Œå®ƒä»¬æ˜¯ Envoy ç›‘å¬å™¨ï¼Œå¯ä»¥æ¥å—ç”¨æˆ·ç©ºé—´è¿æ¥ï¼Œè€Œä¸ä½¿ç”¨ç³»ç»Ÿç½‘ç»œ APIã€‚ä»¥ä¸Šæ·»åŠ åˆ° &lt;code&gt;istioctl proxy-config&lt;/code&gt; å‘½ä»¤çš„ &lt;code&gt;--waypoint&lt;/code&gt; æ ‡å¿—æŒ‡ç¤ºå®ƒæ˜¾ç¤º &lt;code&gt;main_internal&lt;/code&gt; ç›‘å¬å™¨çš„è¯¦ç»†ä¿¡æ¯ã€å…¶è¿‡æ»¤å™¨é“¾ã€é“¾åŒ¹é…å’Œç›®æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ &lt;code&gt;10.96.104.108&lt;/code&gt; æ˜¯ reviews æœåŠ¡ VIPï¼Œè€Œ &lt;code&gt;10.244.x.x&lt;/code&gt; æ˜¯ reviews v1/v2/v3 pod IPï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ &lt;code&gt;kubectl get svc,pod -o wide&lt;/code&gt; å‘½ä»¤æŸ¥çœ‹é›†ç¾¤ã€‚å¯¹äºçº¯æ–‡æœ¬æˆ– HBONE ç»ˆæ­¢çš„å…¥ç«™æµé‡ï¼Œå®ƒå°†åŒ¹é…æœåŠ¡ VIP å’Œç«¯å£ 9080 ä»¥ä¾› reviews ä½¿ç”¨ï¼Œæˆ–è€…é€šè¿‡ pod IP åœ°å€å’Œåº”ç”¨ç¨‹åºåè®®ï¼ˆANYã€h2c æˆ– http/1.1ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥ reviews waypoint ä»£ç†çš„é›†ç¾¤ï¼Œæ‚¨ä¼šå¾—åˆ° &lt;code&gt;main_internal&lt;/code&gt; é›†ç¾¤ä»¥åŠä¸€äº›å…¥ç«™é›†ç¾¤ã€‚é™¤äº†åŸºç¡€æ¶æ„çš„é›†ç¾¤ä¹‹å¤–ï¼Œåˆ›å»ºçš„å”¯ä¸€ Envoy é›†ç¾¤æ˜¯è¿è¡Œåœ¨åŒä¸€æœåŠ¡è´¦æˆ·ä¸­çš„æœåŠ¡å’Œ pod çš„é›†ç¾¤ã€‚æ²¡æœ‰ä¸ºå…¶ä»–åœ°æ–¹è¿è¡Œçš„æœåŠ¡æˆ– pod åˆ›å»ºé›†ç¾¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl proxy-config clusters deploy/bookinfo-reviews-istio-waypoint
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SERVICE FQDN                         PORT SUBSET  DIRECTION   TYPE         DESTINATION RULE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;agent                                -    -       -           STATIC
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;connect_originate                    -    -       -           ORIGINAL_DST
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;encap                                -    -       -           STATIC
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubernetes.default.svc.cluster.local &lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;  tcp     inbound-vip EDS
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;main_internal                        -    -       -           STATIC
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus_stats                     -    -       -           STATIC
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reviews.default.svc.cluster.local    &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt; http    inbound-vip EDS
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reviews.default.svc.cluster.local    &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt; http/v1 inbound-vip EDS
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reviews.default.svc.cluster.local    &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt; http/v2 inbound-vip EDS
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reviews.default.svc.cluster.local    &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt; http/v3 inbound-vip EDS
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sds-grpc                             -    -       -           STATIC
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xds-grpc                             -    -       -           STATIC
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;zipkin                               -    -       -           STRICT_DNS
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯·æ³¨æ„åˆ—è¡¨ä¸­æ²¡æœ‰ &lt;code&gt;outbound&lt;/code&gt; é›†ç¾¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ &lt;code&gt;istioctl proxy-config cluster deploy/bookinfo-reviews-istio-waypoint --direction outbound&lt;/code&gt; è¿›è¡Œç¡®è®¤ï¼å¾ˆå¥½çš„ä¸€ç‚¹æ˜¯ï¼Œæ‚¨ä¸éœ€è¦åœ¨ä»»ä½•å…¶ä»– bookinfo æœåŠ¡ï¼ˆä¾‹å¦‚&lt;code&gt;productpage&lt;/code&gt; æˆ– &lt;code&gt;ratings&lt;/code&gt; æœåŠ¡ï¼‰ä¸Šé…ç½® &lt;code&gt;exportTo&lt;/code&gt;ã€‚æ¢å¥è¯è¯´ï¼Œ&lt;code&gt;reviews&lt;/code&gt; waypoint ä¸ä¼šæ„è¯†åˆ°ä»»ä½•ä¸å¿…è¦çš„é›†ç¾¤ï¼Œè€Œæ‚¨ä¸éœ€è¦è¿›è¡Œä»»ä½•é¢å¤–çš„æ‰‹åŠ¨é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;æ˜¾ç¤º &lt;code&gt;reviews&lt;/code&gt; waypoint ä»£ç†çš„è·¯ç”±åˆ—è¡¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl proxy-config routes deploy/bookinfo-reviews-istio-waypoint
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                                    DOMAINS MATCH              VIRTUAL SERVICE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;encap                                                   *       /*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;inbound-vip&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;9080&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;http&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;reviews.default.svc.cluster.local *       /*                 reviews.default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;default
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å›é¡¾ä¸‹ï¼Œæ‚¨æ²¡æœ‰é…ç½®ä»»ä½• sidecar èµ„æºæˆ– Istio ç½‘ç»œèµ„æºä¸Šçš„ &lt;code&gt;exportTo&lt;/code&gt; é…ç½®ã€‚ä½†æ˜¯ï¼Œæ‚¨éƒ¨ç½²äº† &lt;code&gt;bookinfo-productpage&lt;/code&gt; è·¯ç”±æ¥é…ç½®å…¥å£ç½‘å…³ä»¥è·¯ç”±åˆ° productpageï¼Œä½† reviews waypoint æ²¡æœ‰æ„è¯†åˆ°ä»»ä½•æ­¤ç±»ä¸ç›¸å…³çš„è·¯ç”±ã€‚&lt;/p&gt;
&lt;p&gt;æ˜¾ç¤º &lt;code&gt;inbound-vip|9080|http|reviews.default.svc.cluster.local&lt;/code&gt; è·¯ç”±çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ‚¨ä¼šçœ‹åˆ°åŸºäºæƒé‡çš„è·¯ç”±é…ç½®å°† 90ï¼…çš„æµé‡å®šå‘åˆ° &lt;code&gt;reviews&lt;/code&gt; v1ï¼Œå°† 10ï¼…çš„æµé‡å®šå‘åˆ° &lt;code&gt;reviews&lt;/code&gt; v2ï¼Œä»¥åŠä¸€äº› Istio çš„é»˜è®¤é‡è¯•å’Œè¶…æ—¶é…ç½®ã€‚è¿™è¯å®äº†ä¹‹å‰è®¨è®ºçš„æµé‡å’Œå¼¹æ€§ç­–ç•¥ä»æºå¤´è½¬ç§»åˆ°ç›®æ ‡å¯¼å‘çš„ waypointã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl proxy-config routes deploy/bookinfo-reviews-istio-waypoint --name &lt;span class=&#34;s2&#34;&gt;&amp;#34;inbound-vip|9080|http|reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt; -o yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- name: inbound-vip&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;9080&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;http&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;reviews.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; validateClusters: &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; virtualHosts:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; - domains:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   - &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   name: inbound&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;http&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   routes:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   - decorator:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       operation: reviews:9080/*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     match:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       prefix: /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       filterMetadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         istio:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           config: /apis/networking.istio.io/v1alpha3/namespaces/default/virtual-service/reviews
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     route:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       maxGrpcTimeout: 0s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       retryPolicy:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         hostSelectionRetryMaxAttempts: &lt;span class=&#34;s2&#34;&gt;&amp;#34;5&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         numRetries: &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         retriableStatusCodes:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         - &lt;span class=&#34;m&#34;&gt;503&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         retryHostPredicate:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         - name: envoy.retry_host_predicates.previous_hosts
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           typedConfig:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;s1&#34;&gt;&amp;#39;@type&amp;#39;&lt;/span&gt;: type.googleapis.com/envoy.extensions.retry.host.previous_hosts.v3.PreviousHostsPredicate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         retryOn: connect-failure,refused-stream,unavailable,cancelled,retriable-status-codes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       timeout: 0s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       weightedClusters:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         clusters:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         - name: inbound-vip&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;9080&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;http/v1&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;reviews.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           weight: &lt;span class=&#34;m&#34;&gt;90&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         - name: inbound-vip&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;9080&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;http/v2&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;reviews.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           weight: &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ£€æŸ¥&lt;code&gt;reviews&lt;/code&gt; waypoint ä»£ç†çš„ç«¯ç‚¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl proxy-config endpoints deploy/bookinfo-reviews-istio-waypoint
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ENDPOINT                                            STATUS  OUTLIER CHECK CLUSTER
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;127.0.0.1:15000                                     HEALTHY OK            prometheus_stats
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;127.0.0.1:15020                                     HEALTHY OK            agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://connect_originate/                          HEALTHY OK            encap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://connect_originate/10.244.1.6:9080           HEALTHY OK            inbound-vip&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;9080&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;http/v2&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;reviews.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://connect_originate/10.244.1.6:9080           HEALTHY OK            inbound-vip&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;9080&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;http&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;reviews.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://connect_originate/10.244.2.11:9080          HEALTHY OK            inbound-vip&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;9080&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;http/v1&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;reviews.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://connect_originate/10.244.2.11:9080          HEALTHY OK            inbound-vip&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;9080&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;http&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;reviews.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://connect_originate/10.244.2.14:9080          HEALTHY OK            inbound-vip&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;9080&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;http/v3&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;reviews.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://connect_originate/10.244.2.14:9080          HEALTHY OK            inbound-vip&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;9080&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;http&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;reviews.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;envoy://main_internal/                              HEALTHY OK            main_internal
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;unix://./etc/istio/proxy/XDS                        HEALTHY OK            xds-grpc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;unix://./var/run/secrets/workload-spiffe-uds/socket HEALTHY OK            sds-grpc
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯·æ³¨æ„ï¼Œæ‚¨ä¸ä¼šè·å¾—ä¸ reviews ä»¥å¤–çš„ä»»ä½•æœåŠ¡ç›¸å…³çš„ä»»ä½•ç«¯ç‚¹ï¼Œå³ä½¿æ‚¨åœ¨ &lt;code&gt;default&lt;/code&gt; å’Œ &lt;code&gt;istio-system&lt;/code&gt; å‘½åç©ºé—´ä¸­è¿˜æœ‰ä¸€äº›å…¶ä»–æœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¯¹ä¸“æ³¨äºé¢å‘ç›®çš„åœ°çš„ waypoint ä»£ç†çš„ç®€åŒ–æ„Ÿåˆ°éå¸¸å…´å¥‹ã€‚è¿™æ˜¯æœç€ç®€åŒ– Istio çš„å¯ç”¨æ€§ã€å¯æ‰©å±•æ€§å’Œå¯è°ƒè¯•æ€§è¿ˆå‡ºçš„åˆä¸€é‡è¦æ­¥éª¤ï¼Œè¿™äº›æ˜¯ Istio è·¯çº¿å›¾ä¸Šçš„é‡ä¸­ä¹‹é‡ã€‚æŒ‰ç…§æˆ‘ä»¬çš„&lt;a href=&#34;http://preliminary.istio.io/latest/docs/ops/ambient/getting-started/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¥é—¨æŒ‡å—&lt;/a&gt;ç«‹å³å°è¯•ç¯å¢ƒ alpha æ„å»ºå¹¶ä½“éªŒç®€åŒ–çš„ waypoint ä»£ç†ï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio Ambient Mesh ä¸­åŸºäº Rust çš„ Ztunnel ç»„ä»¶ä»‹ç»</title>
      <link>https://cloudnativecn.com/blog/rust-based-ztunnel/</link>
      <pubDate>Tue, 07 Mar 2023 19:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/rust-based-ztunnel/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;è¯‘è€…æ³¨ï¼šè¿™ç¯‡æ–‡ç« ä»‹ç»äº† Istio çš„ Rust-Based Ztunnelï¼Œå®ƒæ˜¯ä¸€ç§åŸºäº Rust è¯­è¨€çš„è½»é‡çº§ä»£ç†ï¼Œç”¨äº Istio çš„ ambient meshã€‚åœ¨æ–‡ç« ä¸­ï¼Œä½œè€…è§£é‡Šäº†ä¸ºä»€ä¹ˆéœ€è¦ä¸€ç§æ–°çš„ä»£ç†ï¼Œä»¥åŠ Rust è¯­è¨€æ˜¯å¦‚ä½•æˆä¸ºæœ€ä½³é€‰æ‹©çš„ã€‚æ–‡ç« è¿˜è®¨è®ºäº†å¦‚ä½•ä½¿ç”¨ workload xDS é…ç½®æ¥ç®¡ç†å·¥ä½œè´Ÿè½½ï¼Œä»¥åŠå¦‚ä½•æŸ¥çœ‹ ztunnel æ—¥å¿—å’Œ L4 æŒ‡æ ‡ã€‚ä½œè€…è¡¨ç¤ºï¼ŒRust-Based Ztunnel æ˜¾è‘—ç®€åŒ–äº† Istio çš„ ambient meshï¼Œå¹¶æé«˜äº†æ€§èƒ½ã€‚æ­¤å¤–ï¼ŒIstio ambient mesh å·²ç»åˆå¹¶åˆ°äº†ä¸Šæ¸¸ä¸»å¹²ï¼Œå¯ä»¥é€šè¿‡éµå¾ªå…¥é—¨æŒ‡å—æ¥å°è¯• Rust-Based Ztunnelã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ztunnelï¼ˆé›¶ä¿¡ä»»éš§é“ï¼‰ç»„ä»¶æ˜¯ä¸º Istio Ambient Mesh ä¸“é—¨æ„å»ºçš„æ¯èŠ‚ç‚¹ä»£ç†ã€‚å®ƒè´Ÿè´£å®‰å…¨åœ°è¿æ¥å’ŒéªŒè¯ Ambient Mesh ä¸­çš„å·¥ä½œè´Ÿè½½ã€‚Ztunnel æ—¨åœ¨ä¸“æ³¨äº Ambient Mesh ä¸­å·¥ä½œè´Ÿè½½çš„ä¸€å°ç»„åŠŸèƒ½ï¼Œä¾‹å¦‚ mTLSã€èº«ä»½éªŒè¯ã€L4 æˆæƒå’Œé¥æµ‹ï¼Œè€Œæ— éœ€ç»ˆæ­¢å·¥ä½œè´Ÿè½½ HTTP æµé‡æˆ–è§£æå·¥ä½œè´Ÿè½½ HTTP æ ‡å¤´ã€‚Ztunnel ç¡®ä¿æµé‡é«˜æ•ˆã€å®‰å…¨åœ°ä¼ è¾“åˆ° Waypoint Proxyï¼ŒIstio çš„å…¨å¥—åŠŸèƒ½ï¼ˆå¦‚ HTTP é¥æµ‹å’Œè´Ÿè½½å¹³è¡¡ï¼‰åœ¨è¿™é‡Œå®ç°ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äº ztunnel è®¾è®¡ä¸ºåœ¨æ‰€æœ‰ Kubernetes å·¥ä½œèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå› æ­¤ä¿æŒå…¶èµ„æºè¶³è¿¹è¾ƒå°è‡³å…³é‡è¦ã€‚Ztunnel è¢«è®¾è®¡ä¸ºæœåŠ¡ç½‘æ ¼çš„ä¸å¯è§ï¼ˆæˆ–â€œAmbientâ€ï¼‰éƒ¨åˆ†ï¼Œå¯¹ä½ çš„å·¥ä½œè´Ÿè½½çš„å½±å“æœ€å°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ztunnel-æ¶æ„&#34;&gt;Ztunnel æ¶æ„&lt;/h2&gt;
&lt;p&gt;ä¸ sidecar ç±»ä¼¼ï¼Œztunnel ä¹Ÿå……å½“ xDS å®¢æˆ·ç«¯å’Œ CA å®¢æˆ·ç«¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨å¯åŠ¨æœŸé—´ï¼Œå®ƒä½¿ç”¨å…¶æœåŠ¡å¸æˆ·ä»¤ç‰Œå®‰å…¨åœ°è¿æ¥åˆ° Istiod æ§åˆ¶å¹³é¢ã€‚ä¸€æ—¦ä½¿ç”¨ TLS å®‰å…¨åœ°å»ºç«‹äº†ä» ztunnel åˆ° Istiod çš„è¿æ¥ï¼Œå®ƒå°±ä¼šå¼€å§‹ä½œä¸º xDS å®¢æˆ·ç«¯è·å– xDS é…ç½®ã€‚è¿™ç±»ä¼¼äº sidecarã€ç½‘å…³æˆ–è·¯ç‚¹ä»£ç†çš„å·¥ä½œæ–¹å¼ï¼Œä¸åŒä¹‹å¤„åœ¨äº Istiod è¯†åˆ«æ¥è‡ª ztunnel çš„è¯·æ±‚å¹¶å‘é€ä¸“ä¸º ztunnel æ„å»ºçš„ xDS é…ç½®ï¼Œç¨åä½ å°†äº†è§£æ›´å¤šä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;å®ƒè¿˜å……å½“ CA å®¢æˆ·ç«¯ï¼Œä»£è¡¨å…¶ç®¡ç†çš„æ‰€æœ‰å¹¶ç½®å·¥ä½œè´Ÿè½½ç®¡ç†å’Œæä¾› mTLS è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;å½“æµé‡ä¼ å…¥æˆ–ä¼ å‡ºæ—¶ï¼Œå®ƒå……å½“æ ¸å¿ƒä»£ç†ï¼Œä¸ºå…¶ç®¡ç†çš„æ‰€æœ‰å¹¶ç½®å·¥ä½œè´Ÿè½½å¤„ç†å…¥ç«™å’Œå‡ºç«™æµé‡ï¼ˆçº¯æ–‡æœ¬ç½‘æ ¼å¤–æˆ– HBONE ç½‘æ ¼å†…ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å®ƒæä¾› L4 é¥æµ‹ï¼ˆæŒ‡æ ‡å’Œæ—¥å¿—ï¼‰å’Œå¸¦æœ‰è°ƒè¯•ä¿¡æ¯çš„ç®¡ç†æœåŠ¡å™¨ï¼Œä»¥å¸®åŠ©ä½ åœ¨éœ€è¦æ—¶è°ƒè¯• ztunnelã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ztunnel-æ¶æ„&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Ztunnel æ¶æ„&#34; srcset=&#34;
               /blog/rust-based-ztunnel/ztunnel-architecture_hu_78579086bd8aa418.webp 400w,
               /blog/rust-based-ztunnel/ztunnel-architecture_hu_2df922f1eb80fced.webp 760w,
               /blog/rust-based-ztunnel/ztunnel-architecture_hu_58b9fde8fe7993ab.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/rust-based-ztunnel/ztunnel-architecture_hu_78579086bd8aa418.webp&#34;
               width=&#34;760&#34;
               height=&#34;515&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Ztunnel æ¶æ„
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆä¸é‡ç”¨-envoy&#34;&gt;ä¸ºä»€ä¹ˆä¸é‡ç”¨ Envoyï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å½“ Istio Ambient Mesh äº 2022 å¹´ 9 æœˆ 7 æ—¥å‘å¸ƒæ—¶ï¼Œztunnel æ˜¯ä½¿ç”¨ Envoy ä»£ç†å®ç°çš„ã€‚é‰´äºæˆ‘ä»¬å°† Envoy ç”¨äº Istio çš„å…¶ä½™éƒ¨åˆ†â€”â€”sidecarã€ç½‘å…³å’Œ Waypoint Proxyâ€”â€”æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ Envoy å®æ–½ ztunnel æ˜¯å¾ˆè‡ªç„¶çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œæˆ‘ä»¬å‘ç°è™½ç„¶ Envoy éå¸¸é€‚åˆå…¶ä»–ç”¨ä¾‹ï¼Œä½†åœ¨ Envoy ä¸­å®ç° ztunnel å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œå› ä¸ºè®¸å¤šæƒè¡¡ã€è¦æ±‚å’Œç”¨ä¾‹ä¸ sidecar ä»£ç†æˆ–å…¥å£ç½‘å…³æœ‰å¾ˆå¤§ä¸åŒã€‚æ­¤å¤–ï¼Œå¤§å¤šæ•°ä½¿ Envoy éå¸¸é€‚åˆå…¶ä»–ç”¨ä¾‹çš„ä¸œè¥¿ï¼Œä¾‹å¦‚å…¶ä¸°å¯Œçš„ L7 åŠŸèƒ½é›†å’Œå¯æ‰©å±•æ€§ï¼Œéƒ½æµªè´¹åœ¨ä¸éœ€è¦è¿™äº›åŠŸèƒ½çš„ ztunnel ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸“é—¨æ„å»ºçš„-ztunnel&#34;&gt;ä¸“é—¨æ„å»ºçš„ ztunnel&lt;/h2&gt;
&lt;p&gt;åœ¨ Envoy å› æˆ‘ä»¬çš„éœ€æ±‚è€Œå¤±è´¥åï¼Œæˆ‘ä»¬å¼€å§‹è€ƒè™‘æ„å»º ztunnel çš„ä¸“ç”¨å®ç°ã€‚æˆ‘ä»¬çš„å‡è®¾æ˜¯ï¼Œé€šè¿‡ä»ä¸€å¼€å§‹å°±è€ƒè™‘ä¸€ä¸ªå•ä¸€çš„é‡ç‚¹ç”¨ä¾‹è¿›è¡Œè®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å‘ä¸€ä¸ªæ¯”å°†é€šç”¨é¡¹ç›®å¡‘é€ æˆè‡ªå®šä¹‰ç”¨ä¾‹æ›´ç®€å•ã€æ€§èƒ½æ›´é«˜çš„è§£å†³æ–¹æ¡ˆã€‚ä½¿ ztunnel ç®€å•åŒ–çš„æ˜ç¡®å†³å®šæ˜¯è¿™ä¸€å‡è®¾çš„å…³é”®ï¼›ä¾‹å¦‚ï¼Œç±»ä¼¼çš„é€»è¾‘ä¸é€‚ç”¨äºå…·æœ‰å¤§é‡æ”¯æŒåŠŸèƒ½å’Œé›†æˆçš„é‡å†™ç½‘å…³ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªä¸“é—¨å»ºé€ çš„ ztunnel æ¶‰åŠä¸¤ä¸ªå…³é”®é¢†åŸŸï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ztunnel ä¸å…¶ Istiod ä¹‹é—´çš„é…ç½®åè®®&lt;/li&gt;
&lt;li&gt;ztunnel çš„è¿è¡Œæ—¶å®ç°&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é…ç½®åè®®&#34;&gt;é…ç½®åè®®&lt;/h3&gt;
&lt;p&gt;Envoy ä»£ç†ä½¿ç”¨ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-docs/xds_protocol&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS åè®®&lt;/a&gt; é…ç½®ã€‚è¿™æ˜¯ä½¿ Istio è‰¯å¥½è¿è¡Œçš„å…³é”®éƒ¨åˆ†ï¼Œæä¾›ä¸°å¯Œä¸”åŠ¨æ€çš„é…ç½®æ›´æ–°ã€‚ç„¶è€Œï¼Œéšç€è§„æ¨¡çš„æ‰©å¤§ï¼Œé…ç½®å˜å¾—è¶Šæ¥è¶Šå®šåˆ¶åŒ–ï¼Œè¿™æ„å‘³ç€ç”Ÿæˆå®ƒæ›´å¤§ã€æ›´æ˜‚è´µã€‚åœ¨ sidecar ä¸­ï¼Œå…·æœ‰ 1 ä¸ª pod çš„å•ä¸ªæœåŠ¡ä¼šç”Ÿæˆå¤§çº¦ 350 è¡Œ xDSï¼ˆåœ¨ YAML ä¸­ï¼‰ï¼Œè¿™å·²ç»å¾ˆéš¾æ‰©å±•ã€‚åŸºäº Envoy çš„ ztunnel ç”šè‡³æ›´ç³Ÿï¼Œå¹¶ä¸”åœ¨æŸäº›åŒºåŸŸå…·æœ‰ N^2 ç¼©æ”¾å±æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä½¿ ztunnel é…ç½®å°½å¯èƒ½å°ï¼Œæˆ‘ä»¬ç ”ç©¶äº†ä½¿ç”¨ä¸€ç§ä¸“é—¨æ„å»ºçš„é…ç½®åè®®ï¼Œè¯¥åè®®ä»¥ä¸€ç§æœ‰æ•ˆçš„æ ¼å¼å‡†ç¡®åŒ…å«æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯ï¼ˆä»…æ­¤è€Œå·²ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç®€æ´åœ°è¡¨ç¤ºå•ä¸ª podï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld-v1-55446d46d8-ntdbk&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceAccount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ambient-worker2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Healthy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;waypointAddresses&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadIp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10.244.2.8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;canonicalName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;canonicalRevision&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;helloworld-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤ä¿¡æ¯é€šè¿‡ xDS ä¼ è¾“ API ä¼ è¾“ï¼Œä½†ä½¿ç”¨ç‰¹å®šäºç¯å¢ƒçš„è‡ªå®šä¹‰ç±»å‹ã€‚è¯·å‚é˜…&lt;a href=&#34;https://preliminary.istio.io/latest/blog/2023/rust-based-ztunnel/#workload-xds-configuration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å·¥ä½œè´Ÿè½½ xDS é…ç½®éƒ¨åˆ†&lt;/a&gt; ä»¥äº†è§£æœ‰å…³é…ç½®è¯¦ç»†ä¿¡æ¯çš„æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸“é—¨æ„å»ºçš„ APIï¼Œæˆ‘ä»¬å¯ä»¥å°†é€»è¾‘æ¨é€åˆ°ä»£ç†ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ Envoy é…ç½®ä¸­ã€‚ä¾‹å¦‚ï¼Œè¦åœ¨ Envoy ä¸­é…ç½® mTLSï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ç›¸åŒçš„å¤§å‹é…ç½®é›†æ¥è°ƒæ•´æ¯ä¸ªæœåŠ¡çš„ç²¾ç¡® TLS è®¾ç½®ï¼›ä½¿ç”¨ ztunnelï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªæšä¸¾æ¥å£°æ˜æ˜¯å¦åº”è¯¥ä½¿ç”¨ mTLSã€‚å…¶ä½™çš„å¤æ‚é€»è¾‘ç›´æ¥åµŒå…¥åˆ° ztunnel ä»£ç ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å€ŸåŠ© Istiod å’Œ ztunnel ä¹‹é—´çš„è¿™ç§é«˜æ•ˆ APIï¼Œæˆ‘ä»¬å‘ç°æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ‰å…³å¤§å‹ç½‘æ ¼ï¼ˆä¾‹å¦‚å…·æœ‰ 100,000 ä¸ª pod çš„ç½‘æ ¼ï¼‰çš„ä¿¡æ¯æ¥é…ç½® ztunnelï¼Œé…ç½®æ•°é‡å‡å°‘å‡ ä¸ªæ•°é‡çº§ï¼Œè¿™æ„å‘³ç€ CPUã€å†…å­˜å’Œç½‘ç»œæˆæœ¬æ›´ä½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¿è¡Œæ—¶å®ç°&#34;&gt;è¿è¡Œæ—¶å®ç°&lt;/h3&gt;
&lt;p&gt;é¡¾åæ€ä¹‰ï¼Œztunnel ä½¿ç”¨ &lt;a href=&#34;https://preliminary.istio.io/latest/blog/2022/introducing-ambient-mesh/#building-an-ambient-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTPS éš§é“&lt;/a&gt; æ‰¿è½½ç”¨æˆ·è¯·æ±‚ã€‚è™½ç„¶ Envoy æ”¯æŒè¿™ç§éš§é“ï¼Œä½†æˆ‘ä»¬å‘ç°é…ç½®æ¨¡å‹é™åˆ¶äº†æˆ‘ä»¬çš„éœ€æ±‚ã€‚ç®€å•åœ°è¯´ï¼ŒEnvoy çš„å·¥ä½œæ–¹å¼æ˜¯é€šè¿‡ä¸€ç³»åˆ—â€œè¿‡æ»¤å™¨â€å‘é€è¯·æ±‚ï¼Œä»æ¥å—è¯·æ±‚å¼€å§‹åˆ°å‘é€ç»“æŸã€‚æ ¹æ®æˆ‘ä»¬çš„è¦æ±‚ï¼Œå®ƒæœ‰å¤šå±‚è¯·æ±‚ï¼ˆéš§é“æœ¬èº«å’Œç”¨æˆ·çš„è¯·æ±‚ï¼‰ï¼Œä»¥åŠè´Ÿè½½å‡è¡¡åéœ€è¦åº”ç”¨ per-pod ç­–ç•¥ï¼Œæˆ‘ä»¬å‘ç°æ¯ä¸ªè¿æ¥éœ€è¦å¾ªç¯é€šè¿‡è¿™äº›è¿‡æ»¤å™¨ 4 æ¬¡æ‰èƒ½å®ç°æˆ‘ä»¬çš„åŸºäºåœ¨ Envoy ä¸Šå½“ ztunnelã€‚è™½ç„¶ Envoy å¯¹å†…å­˜ä¸­çš„â€œå‘è‡ªèº«å‘é€è¯·æ±‚â€è¿›è¡Œäº† &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/other_features/internal_listener&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€äº›ä¼˜åŒ– &lt;/a&gt;ï¼Œä½†è¿™ä»ç„¶éå¸¸å¤æ‚ä¸”æ˜‚è´µã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡æ„å»ºæˆ‘ä»¬è‡ªå·±çš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥ä»å¤´å¼€å§‹å›´ç»•è¿™äº›çº¦æŸè¿›è¡Œè®¾è®¡ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡çš„å„ä¸ªæ–¹é¢éƒ½æœ‰æ›´å¤§çš„çµæ´»æ€§ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è·¨çº¿ç¨‹å…±äº«è¿æ¥æˆ–å›´ç»•æœåŠ¡è´¦æˆ·ä¹‹é—´çš„éš”ç¦»å®ç°æ›´å¤šè‡ªå®šä¹‰éœ€æ±‚ã€‚åœ¨ç¡®å®šä¸“ç”¨ä»£ç†å¯è¡Œåï¼Œæˆ‘ä»¬å¼€å§‹é€‰æ‹©å®ç°ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åŸºäº-rust-çš„-ztunnel&#34;&gt;åŸºäº Rust çš„ ztunnel&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†ä½¿ ztunnel å¿«é€Ÿã€å®‰å…¨å’Œè½»é‡çº§ï¼Œ&lt;a href=&#34;https://www.rust-lang.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Rust&lt;/a&gt; æ˜¯ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„é€‰æ‹©ã€‚ç„¶è€Œï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡ã€‚é‰´äº Istio ç›®å‰å¯¹ Go çš„å¹¿æ³›ä½¿ç”¨ï¼Œæˆ‘ä»¬æ›¾å¸Œæœ›æˆ‘ä»¬å¯ä»¥ä½¿åŸºäº Go çš„å®ç°æ»¡è¶³è¿™äº›ç›®æ ‡ã€‚åœ¨æœ€åˆçš„åŸå‹ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€äº›åŸºäº Go çš„å®ç°å’Œä¸€ä¸ªç®€å•ç‰ˆæœ¬çš„åŸºäº Rust çš„å®ç°ã€‚ä»æˆ‘ä»¬çš„æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å‘ç°åŸºäº Go çš„ç‰ˆæœ¬ä¸æ»¡è¶³æˆ‘ä»¬çš„æ€§èƒ½å’Œå ç”¨ç©ºé—´è¦æ±‚ã€‚è™½ç„¶æˆ‘ä»¬å¯èƒ½ä¼šè¿›ä¸€æ­¥ä¼˜åŒ–å®ƒï¼Œä½†æˆ‘ä»¬è®¤ä¸ºåŸºäº Rust çš„ä»£ç†ä»é•¿è¿œæ¥çœ‹å°†ä¸ºæˆ‘ä»¬æä¾›æœ€ä½³å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜è€ƒè™‘äº† C++ å®ç°â€”â€”å¯èƒ½ä¼šé‡ç”¨ Envoy çš„éƒ¨åˆ†å†…å®¹ã€‚ä½†æ˜¯ï¼Œç”±äºç¼ºä¹å†…å­˜å®‰å…¨ã€å¼€å‘äººå‘˜ä½“éªŒé—®é¢˜ä»¥åŠ Rust çš„ä¸€èˆ¬è¡Œä¸šè¶‹åŠ¿ï¼Œæ­¤é€‰é¡¹æœªè¢«é‡‡ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ·˜æ±°è¿‡ç¨‹ç»™æˆ‘ä»¬ç•™ä¸‹äº† Rustï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œç¾çš„é€‰æ‹©ã€‚Rust åœ¨é«˜æ€§èƒ½ã€ä½èµ„æºåˆ©ç”¨ç‡çš„åº”ç”¨ç¨‹åºæ–¹é¢æœ‰ç€æ‚ ä¹…çš„æˆåŠŸå†å²ï¼Œå°¤å…¶æ˜¯ç½‘ç»œåº”ç”¨ç¨‹åºï¼ŒåŒ…æ‹¬æœåŠ¡ç½‘æ ¼ã€‚æˆ‘ä»¬é€‰æ‹©åœ¨ &lt;a href=&#34;https://tokio.rs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tokio&lt;/a&gt; å’Œ &lt;a href=&#34;https://hyper.rs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Hyper&lt;/a&gt; åº“ä¹‹ä¸Šæ„å»ºï¼Œè¿™ä¸¤ä¸ªç”Ÿæ€ç³»ç»Ÿä¸­çš„äº‹å®æ ‡å‡†å·²ç»ç»å†äº†å¹¿æ³›çš„éªŒè¯â€”â€”ç»è¿‡æµ‹è¯•ä¸”æ˜“äºç¼–å†™é«˜æ€§èƒ½å¼‚æ­¥ä»£ç ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¿«é€Ÿäº†è§£åŸºäº-rust-çš„-ztunnel&#34;&gt;å¿«é€Ÿäº†è§£åŸºäº Rust çš„ ztunnel&lt;/h2&gt;
&lt;h3 id=&#34;å·¥ä½œè´Ÿè½½-xds-é…ç½®&#34;&gt;å·¥ä½œè´Ÿè½½ xDS é…ç½®&lt;/h3&gt;
&lt;p&gt;å·¥ä½œè´Ÿè½½ xDS é…ç½®éå¸¸æ˜“äºç†è§£å’Œè°ƒè¯•ã€‚ä½ å¯ä»¥é€šè¿‡ä»ä½ çš„ä¸€ä¸ª ztunnel pod å‘é€è¯·æ±‚ &lt;code&gt;localhost:15000/config_dump&lt;/code&gt; æˆ–ä½¿ç”¨æ–¹ä¾¿çš„ &lt;code&gt;istioctl pc workload&lt;/code&gt; å‘½ä»¤æ¥æŸ¥çœ‹å®ƒä»¬ã€‚æœ‰ä¸¤ä¸ªå…³é”®çš„å·¥ä½œè´Ÿè½½ xDS é…ç½®ï¼šå·¥ä½œè´Ÿè½½å’Œç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä½ çš„å·¥ä½œè´Ÿè½½åŒ…å«åœ¨ Ambient Mesh ä¸­ä¹‹å‰ï¼Œä½ ä»ç„¶å¯ä»¥åœ¨ ztunnel çš„é…ç½®è½¬å‚¨ä¸­çœ‹åˆ°å®ƒä»¬ï¼Œå› ä¸º ztunnel çŸ¥é“æ‰€æœ‰å·¥ä½œè´Ÿè½½ï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦å¯ç”¨äº† Ambient Meshã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹åŒ…å«æ–°éƒ¨ç½²çš„ helloworld v1 pod çš„ç¤ºä¾‹å·¥ä½œè´Ÿè½½é…ç½®ï¼Œç”± &lt;code&gt;protocol: TCP&lt;/code&gt; æŒ‡ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;workloads&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;10.244.2.8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;workloadIp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.244.2.8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;protocol&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;TCP&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;helloworld-v1-cross-node-55446d46d8-ntdbk&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;namespace&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;serviceAccount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;helloworld&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;workloadName&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;helloworld-v1-cross-node&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;workloadType&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;deployment&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;canonicalName&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;helloworld&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;canonicalRevision&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;node&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ambient-worker2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;authorizationPolicies&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Healthy&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Pod è¢«åŒ…å«åœ¨ ambient ä¸­åï¼ˆé»˜è®¤å°†å‘½åç©ºé—´æ ‡è®°ä¸º &lt;code&gt;istio.io/dataplane-mode=ambient&lt;/code&gt; ï¼‰ï¼Œprotocol å€¼å°†è¢«æ›¿æ¢ä¸º HBONEï¼Œè¡¨ç¤º ztunnel å°†æ¥è‡ªæ‰€æœ‰ helloworld -v1 pod ä¼ å…¥å’Œä¼ å‡ºé€šä¿¡å‡çº§åˆ° HBONEã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;workloads&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;10.244.2.8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;workloadIp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.244.2.8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;protocol&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;HBONE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨éƒ¨ç½²ä»»ä½•å·¥ä½œè´Ÿè½½çº§åˆ«çš„æˆæƒç­–ç•¥åï¼Œç­–ç•¥é…ç½®ä½œä¸º xDS é…ç½®ä» Istiod æ¨é€åˆ° ztunnelï¼Œå¹¶å‡ºç°åœ¨ &lt;code&gt;policies&lt;/code&gt; ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;policies&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;default/hw-viewer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;hw-viewer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;namespace&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;scope&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;WorkloadSelector&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;action&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Allow&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;groups&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[[[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;principals&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;Exact&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;cluster.local/ns/default/sa/sleep&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}]]]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å·¥ä½œè´Ÿè½½çš„é…ç½®å·²å‚è€ƒæˆæƒç­–ç•¥è¿›è¡Œäº†æ›´æ–°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;workloads&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;10.244.2.8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;workloadIp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.244.2.8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;authorizationPolicies&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;default/hw-viewer&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ztunnel-æä¾›çš„-l4-é¥æµ‹&#34;&gt;ztunnel æä¾›çš„ L4 é¥æµ‹&lt;/h3&gt;
&lt;p&gt;ä½ å¯èƒ½ä¼šæƒŠå–œåœ°å‘ç° ztunnel æ—¥å¿—å¾ˆå®¹æ˜“ç†è§£ã€‚ä¾‹å¦‚ï¼Œä½ å°†åœ¨ç›®æ ‡ ztunnel ä¸Šçœ‹åˆ°ä¸€ä¸ª HTTP è¿æ¥è¯·æ±‚ï¼ŒæŒ‡ç¤ºæº pod IP (&lt;code&gt;peer_ip&lt;/code&gt;) å’Œç›®æ ‡ pod IPã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;2023-02-15T20:40:48.628251Z  INFO inbound{id=4399fa68cf25b8ebccd472d320ba733f peer_ip=10.244.2.5 peer_id=spiffe://cluster.local/ns/default/sa/sleep}: ztunnel::proxy::inbound: got CONNECT request to 10.244.2.8:5000
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½ å¯ä»¥é€šè¿‡è®¿é—®ä½äºâ€œlocalhost:15020/metricsâ€çš„ API æŸ¥çœ‹å·¥ä½œè´Ÿè½½çš„ L4 æŒ‡æ ‡ï¼Œå®ƒæä¾›äº†å…¨å¥— TCP &lt;a href=&#34;https://istio.io/latest/docs/reference/config/metrics/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ ‡å‡†æŒ‡æ ‡&lt;/a&gt; é›†ï¼Œå…·æœ‰ä¸ sidecar æš´éœ²çš„ç›¸åŒæ ‡ç­¾ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;istio_tcp_connections_opened_total{
  reporter=&amp;#34;source&amp;#34;,
  source_workload=&amp;#34;sleep&amp;#34;,
  source_workload_namespace=&amp;#34;default&amp;#34;,
  source_principal=&amp;#34;spiffe://cluster.local/ns/default/sa/sleep&amp;#34;,
  destination_workload=&amp;#34;helloworld-v1&amp;#34;,
  destination_workload_namespace=&amp;#34;default&amp;#34;,
  destination_principal=&amp;#34;spiffe://cluster.local/ns/default/sa/helloworld&amp;#34;,
  request_protocol=&amp;#34;tcp&amp;#34;,
  connection_security_policy=&amp;#34;mutual_tls&amp;#34;
  ...
} 1
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¦‚æœä½ å®‰è£…äº† Prometheus å’Œ Kialiï¼Œä½ å¯ä»¥ä» Kiali çš„ UI è½»æ¾æŸ¥çœ‹è¿™äº›æŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-kiali-dashboardç”±-ztunnel-æä¾›çš„-l4-é¥æµ‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Kiali dashboardï¼šç”± ztunnel æä¾›çš„ L4 é¥æµ‹&#34; srcset=&#34;
               /blog/rust-based-ztunnel/kiali-ambient_hu_8e359bfea2a816e2.webp 400w,
               /blog/rust-based-ztunnel/kiali-ambient_hu_7e0514f51ef31e0a.webp 760w,
               /blog/rust-based-ztunnel/kiali-ambient_hu_441520f4fbd58fea.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/rust-based-ztunnel/kiali-ambient_hu_8e359bfea2a816e2.webp&#34;
               width=&#34;760&#34;
               height=&#34;357&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Kiali dashboardï¼šç”± ztunnel æä¾›çš„ L4 é¥æµ‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬æ„Ÿåˆ°éå¸¸å…´å¥‹çš„æ˜¯ï¼Œæ–°çš„ &lt;a href=&#34;https://github.com/istio/ztunnel/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸºäº Rust çš„ ztunnel&lt;/a&gt; æ¯”ä¹‹å‰åŸºäº Envoy çš„ ztunnel æ›´ç®€å•ã€é‡é‡æ›´è½»ä¸”æ€§èƒ½æ›´é«˜ã€‚å€ŸåŠ©ä¸“é—¨ä¸ºåŸºäº Rust çš„ ztunnel è®¾è®¡çš„å·¥ä½œè´Ÿè½½ xDSï¼Œä½ ä¸ä»…å¯ä»¥æ›´è½»æ¾åœ°äº†è§£ xDS é…ç½®ï¼Œè¿˜å¯ä»¥å¤§å¤§é™ä½ Istiod æ§åˆ¶å¹³é¢å’Œ ztunnel ä¹‹é—´çš„ç½‘ç»œæµé‡å’Œæˆæœ¬ã€‚éšç€ Istio ambient ç°åœ¨åˆå¹¶åˆ°ä¸Šæ¸¸ masterï¼Œä½ å¯ä»¥æŒ‰ç…§æˆ‘ä»¬çš„&lt;a href=&#34;http://istio.io/latest/docs/ops/ambient/getting-started/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¥é—¨æŒ‡å—&lt;/a&gt; å°è¯•æ–°çš„åŸºäº Rust çš„ ztunnelã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æœåŠ¡ç½‘æ ¼å®‰å…¨æ€§ä¼˜åŒ–æœ€ä½³å®è·µ</title>
      <link>https://cloudnativecn.com/blog/optimize-traffic-management-and-security-with-these-service-mesh-best-practices/</link>
      <pubDate>Wed, 01 Feb 2023 11:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/optimize-traffic-management-and-security-with-these-service-mesh-best-practices/</guid>
      <description>&lt;p&gt;è¿™æ˜¯ &lt;a href=&#34;https://tetrate.io/blog/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼æœ€ä½³å®è·µç³»åˆ—æ–‡ç« &lt;/a&gt; ä¸­çš„ç¬¬ä¸‰ç¯‡ï¼Œæ‘˜è‡ª Tetrate åˆ›å§‹å·¥ç¨‹å¸ˆ Zack Butcher å³å°†å‡ºç‰ˆçš„æ–°ä¹¦ Istio in Productionã€‚&lt;/p&gt;
&lt;p&gt;Istio å°±åƒä¸€ç»„ä¹é«˜ç§¯æœ¨ï¼šå®ƒå…·æœ‰è®¸å¤šåŠŸèƒ½ï¼Œå¯ä»¥æŒ‰ç…§æ‚¨æƒ³è¦çš„ä»»ä½•æ–¹å¼è¿›è¡Œç»„è£…ã€‚å‡ºç°çš„ç»“æ„å–å†³äºæ‚¨å¦‚ä½•ç»„è£…é›¶ä»¶ã€‚åœ¨ &lt;a href=&#34;../service-mesh-deployment-best-practices-for-security-and-high-availability/&#34;&gt;ä¸Šä¸€ç¯‡ä¸­&lt;/a&gt;ï¼Œæˆ‘ä»¬æè¿°äº†ä¸€ç§è¿è¡Œæ—¶æ‹“æ‰‘ç»“æ„ï¼Œç”¨äºæ„å»ºå¥å£®ã€æœ‰å¼¹æ€§ä¸”å¯é çš„åŸºç¡€æ¶æ„ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æè¿°ä¸€ç»„ç½‘æ ¼é…ç½®ï¼Œä»¥å¸®åŠ©åœ¨è¿è¡Œæ—¶å®ç°ç¨³å¥æ€§ã€å¼¹æ€§ã€å¯é æ€§å’Œå®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;Istio åœ¨å…¶æ‰€è°“çš„ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig-root_namespace&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ ¹å‘½åç©ºé—´&lt;/a&gt; ä¸­æ”¯æŒå…¨å±€é»˜è®¤é…ç½® â€”â€” é»˜è®¤åœ¨ &lt;code&gt;istio-system&lt;/code&gt;ã€‚åœ¨æ ¹å‘½åç©ºé—´ä¸­å‘å¸ƒçš„é…ç½®é»˜è®¤é€‚ç”¨äºæ‰€æœ‰æœåŠ¡ï¼Œä½†åœ¨æœ¬åœ°å‘½åç©ºé—´ä¸­å‘å¸ƒçš„ä»»ä½•é…ç½®éƒ½ä¼šè¦†ç›–å®ƒã€‚å› æ­¤ï¼Œä¸€äº›é…ç½®åº”è¯¥åœ¨æ ¹å‘½åç©ºé—´ä¸­å‘å¸ƒï¼Œå¹¶ä¸”ä¸å…è®¸åœ¨å…¶ä»–ä»»ä½•åœ°æ–¹å‘å¸ƒï¼ˆä¾‹å¦‚ç”¨äºåœ¨ä¼ è¾“ä¸­å¼ºåˆ¶åŠ å¯†çš„ PeerAuthentication ç­–ç•¥ï¼‰ã€‚å…¶ä»–é…ç½®åº”è¯¥åœ¨æ¯ä¸ªæœåŠ¡è‡ªå·±çš„å‘½åç©ºé—´ä¸­ç¼–å†™ï¼ˆä¾‹å¦‚ VirtualService æ§åˆ¶å®ƒçš„å¼¹æ€§è®¾ç½®ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°çš„æœ€æˆåŠŸçš„ç½‘æ ¼é‡‡ç”¨å°†ç½‘æ ¼æœ¬èº«éšè—åœ¨å¦ä¸€ä¸ªç•Œé¢åé¢ï¼šä¾‹å¦‚ Helm æ¨¡æ¿ã€Terraform æˆ–æ›´é«˜çº§çš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚ &lt;a href=&#34;https://tetrate.io/tetrate-service-bridge/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge (TSB)&lt;/a&gt;ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯åªå…¬å¼€åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜åº”è¯¥é…ç½®çš„ä¸€å°éƒ¨åˆ†ç½‘æ ¼åŠŸèƒ½ï¼Œæœ€å¥½æ˜¯ä½¿ç”¨ä»–ä»¬ç†è§£çš„è¯­è¨€ï¼ˆä¾‹å¦‚ï¼ŒTSB å¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://docs.tetrate.io/service-bridge/1.6.x/en-us/quickstart/apps&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¸¦æ³¨é‡Šçš„ OpenAPI è§„èŒƒ&lt;/a&gt; è¿›è¡Œé…ç½®ï¼‰ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬é€šå¸¸åªå‘åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å…¬å¼€æµé‡è®¾ç½®å’Œæˆæƒã€‚èº«ä»½éªŒè¯å’Œé¥æµ‹ç”±å„è‡ªçš„å›¢é˜Ÿæˆ–ä»£è¡¨ä»–ä»¬çš„å¹³å°å›¢é˜Ÿé›†ä¸­æ§åˆ¶ã€‚&lt;a href=&#34;https://tetrate.io/blog/nist-standards-for-zero-trust-the-sp-800-204-series/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NIST SP800-204 ç³»åˆ—&lt;/a&gt;ï¼Œå°¤å…¶æ˜¯ &lt;a href=&#34;https://csrc.nist.gov/publications/detail/sp/800-204a/final&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SP 800-204A&lt;/a&gt; å’Œ &lt;a href=&#34;https://csrc.nist.gov/publications/detail/sp/800-204b/final&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SP 800-204B&lt;/a&gt;ã€‚Istio é¡¹ç›®ç«™ç‚¹ä¹Ÿæœ‰ä¸€ç»„ &lt;a href=&#34;https://istio.io/latest/docs/ops/best-practices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ€ä½³å®è·µ&lt;/a&gt;ï¼Œä¹Ÿå€¼å¾—æ”¶è—ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼å‘½åçº¦å®š&#34;&gt;æœåŠ¡ç½‘æ ¼å‘½åçº¦å®š&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å»ºè®®&lt;/strong&gt;ï¼šä¸º Istio èµ„æºå¼€å‘å’Œç»´æŠ¤ä¸€è‡´çš„å‘½åæ–¹æ¡ˆï¼Œæœ€å¥½åŸºäºå®ƒä»¬é…ç½®çš„æœåŠ¡æˆ–ä¸»æœºã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å»ºè®®&lt;/strong&gt;ï¼šä¸ºè·¨é›†ç¾¤çš„å›¢é˜Ÿä¿æŒä¸€è‡´çš„åç§°ã€‚å‘½åç©ºé—´åº”è¯¥ç”±ä¸€ä¸ªå›¢é˜Ÿæ‹¥æœ‰ã€‚&lt;/p&gt;
&lt;p&gt;Istio èµ„æºåº”è¯¥æ ¹æ®å®ƒä»¬é…ç½®çš„æœåŠ¡æˆ–ä¸»æœºæ¥å‘½åï¼š&lt;code&gt;ServiceEntry&lt;/code&gt; æ·»åŠ  &lt;code&gt;api.example.com&lt;/code&gt; åˆ°ç½‘æ ¼çš„åº”è¯¥å‘½åä¸º &lt;code&gt;external-api-example-com&lt;/code&gt;ï¼›æœåŠ¡çš„ &lt;code&gt;DestinationRule&lt;/code&gt;ã€&lt;code&gt;VirtualService&lt;/code&gt;ã€&lt;code&gt;PeerAuthentication&lt;/code&gt; å’Œ &lt;code&gt;Authorization&lt;/code&gt; ç­–ç•¥ä¹Ÿéƒ½åº”è¯¥æœ‰ç›¸åŒçš„åç§°ã€‚PCI å‘½åç©ºé—´ä¸­çš„å†…éƒ¨æœåŠ¡ Paymentsï¼ˆåº”ç”¨ç¨‹åºä»£ç ä¸­çš„ hostname &lt;code&gt;payments.pci&lt;/code&gt;ï¼‰åº”è¯¥è¢«å‘½åä¸º &lt;code&gt;payment-pci&lt;/code&gt;ï¼Œå…¶æ‰€æœ‰çš„ç½‘æ ¼é…ç½®åç§°ä¹Ÿåº”è¯¥åŒ¹é…ã€‚è¿™äº›å‘½åæ–¹æ¡ˆå¹¶ä¸æ˜¯ç¡¬æ€§è§„å®šï¼Œä½†ä½ åº”è¯¥åœ¨ä½ çš„ç»„ç»‡å†…å»ºç«‹å¹¶åšæŒä¸€ä¸ªä¸€è‡´çš„æƒ¯ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›èµ„æºåº”è¯¥å…¨éƒ¨å‘å¸ƒåœ¨å®ƒä»¬é…ç½®çš„æœåŠ¡çš„å‘½åç©ºé—´ä¸­ï¼Œæˆ–è€…å‘å¸ƒåœ¨ &lt;code&gt;istio-system&lt;/code&gt; å‘½åç©ºé—´ä¸­ä»¥è¿›è¡Œç½‘æ ¼èŒƒå›´çš„é…ç½®ã€‚å¤–éƒ¨æœåŠ¡é€šå¸¸å‘å¸ƒåˆ° &lt;code&gt;istio-system&lt;/code&gt; ä¸­å¹¶ç”±ä¸­å¿ƒå›¢é˜Ÿï¼ˆå¹³å°æˆ–å®‰å…¨å›¢é˜Ÿï¼‰ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å»ºè®®è·¨é›†ç¾¤çš„å›¢é˜Ÿä½¿ç”¨ä¸€è‡´çš„åç§°ï¼šæ— è®ºé›†ç¾¤ç§Ÿæˆ·æ¨¡å‹å¦‚ä½•ï¼Œå‘½åç©ºé—´éƒ½åº”ç”±å•ä¸ªå›¢é˜Ÿæ‹¥æœ‰ï¼ˆè¯·å‚é˜…ä¸‹ä¸€èŠ‚ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼å…¨å±€è®¾ç½®&#34;&gt;æœåŠ¡ç½‘æ ¼å…¨å±€è®¾ç½®&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®å¯è§æ€§&lt;/strong&gt;ã€‚Istio æœ‰ä¸€ä¸ªé…ç½®å¯è§æ€§çš„æƒ³æ³•ï¼šé…ç½®å¯ä»¥é»˜è®¤åº”ç”¨äºæ•´ä¸ªé›†ç¾¤ï¼Œæˆ–è€…å®ƒå¯ä»¥åªåº”ç”¨äºæœ¬åœ°å‘½åç©ºé—´ï¼Œç”šè‡³å¯ä»¥åªåº”ç”¨äºå•ä¸ªæœåŠ¡ï¼ˆé€‰æ‹©å¯¹æ•´ä¸ªé›†ç¾¤å¯è§ï¼Œæˆ–è€…åªæ˜¯ç‰¹å®šçš„å‘½åç©ºé—´ï¼‰ã€‚ä¸ºäº†æ€§èƒ½å’Œå®‰å…¨ï¼Œæ‚¨åº”è¯¥å°†è¯¥å­—æ®µé»˜è®¤ä¸º &lt;code&gt;exportTo&lt;/code&gt; æœ¬åœ°åç§°ç©ºé—´ï¼ˆâ€œ.â€ï¼‰ã€‚æ‚¨åº”è¯¥åœ¨å®‰è£…æ—¶ä¸º &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig-default_service_export_to&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;em&gt;Services&lt;/em&gt;&lt;/a&gt;ã€&lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig-default_virtual_service_export_to&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;em&gt;VirtualServices&lt;/em&gt;&lt;/a&gt; å’Œ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig-default_destination_rule_export_to&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;em&gt;DestinationRules&lt;/em&gt;&lt;/a&gt; è®¾ç½®è¿™ä¸ªé»˜è®¤å€¼ã€‚æŸ¥çœ‹ Istio çš„ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig-default_service_export_to&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¨å±€é…ç½®&lt;/a&gt; æ¥é…ç½®è¿™äº›é»˜è®¤å€¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;controlplane&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# profile: default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meshConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;defaultServiceExportTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# only the namespace the resource is published in&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;defaultVirtualServiceExportTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# equivalent, just different YAML syntax&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;defaultDestinationRuleExportTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹ 1ï¼šé»˜è®¤å…¨å±€è®¾ç½®&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¯ä¸ªå‘½åç©ºé—´çš„ Sidecar èµ„æºé…ç½®&lt;/strong&gt;ã€‚Istio çš„ &lt;code&gt;Sidecar&lt;/code&gt; ï¼ˆAPIï¼‰èµ„æºæ§åˆ¶ Istio å°†å“ªäº›é…ç½®å‘é€åˆ°æ¯ä¸ªå‘½åç©ºé—´ä¸­çš„ Sidecarã€‚ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½å’Œæœ€ä½å¼€é”€ï¼Œæ‚¨åº”è¯¥ä¸ºæ¯ä¸ªå‘½åç©ºé—´ç®¡ç†ä¸€ä¸ªé…ç½®ï¼Œå¹¶ç®¡ç† egress éƒ¨åˆ†ä»¥ä»…åŒ…æ‹¬æœåŠ¡å¿…é¡»ä¸ä¹‹é€šä¿¡çš„ä¸»æœºã€‚è¿™å°†å¯¼è‡´ Istio å‘è¯¥å‘½åç©ºé—´ä¸­çš„ Envoy å®ä¾‹å‘é€æ›´å°‘çš„é…ç½®ï¼Œä»è€Œå‡å°‘å®ƒä»¬çš„å†…å­˜å’Œ CPU æ¶ˆè€—ã€‚ç»“åˆä»…æ³¨å†Œè¡¨å‡ºç«™æµé‡ç­–ç•¥ï¼ˆè§ä¸‹ä¸€æ¡ï¼‰ï¼ŒSidecar èµ„æºè¿˜å¯ä»¥å¸®åŠ©é™åˆ¶æ”»å‡»è€…é€šè¿‡ Envoy çš„è¡¨é¢åŒºåŸŸï¼Œå› ä¸ºä¸åœ¨ Sidecar çš„ egress éƒ¨åˆ†çš„ä¸»æœºå°†æ˜¯è¯¥ Envoy å®ä¾‹çš„ &amp;ldquo;å‡ºç«™æµé‡&amp;rdquo;ã€‚è¿™æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªè¶³å¤Ÿçš„å®‰å…¨ç­–ç•¥ï¼ˆè§ä¸‹é¢çš„å®‰å…¨éƒ¨åˆ†ï¼‰ï¼Œè€Œæ˜¯å¢åŠ äº†ä¸€ä¸ªæ”»å‡»è€…å¿…é¡»ç©¿è¶Šçš„é¢å¤–é˜²å¾¡å±‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼–å†™æ˜ç¡®çš„å‡ºç«™ï¼ˆegressï¼‰æµé‡ç­–ç•¥&lt;/strong&gt;ã€‚Istio æä¾›äº†ä¸€äº›é€‰é¡¹æ¥é…ç½®å®ƒå¦‚ä½•å¤„ç†ç½‘æ ¼ä¸­çš„æœåŠ¡ï¼Œè¯¥æœåŠ¡è¯•å›¾ä¸ Istio æœªçŸ¥çš„ç«¯ç‚¹è¿›è¡Œé€šä¿¡ï¼š&lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig-OutboundTrafficPolicy-Mode&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Outbound Traffic Policy&lt;/a&gt;ã€‚Istio å¯ä»¥å…è®¸æ‰€æœ‰æµé‡ï¼Œä¹Ÿå¯ä»¥å°†æµé‡é™åˆ¶åœ¨ç½‘æ ¼å·²çŸ¥çš„æœåŠ¡ä¸Šã€‚ä½ åº”è¯¥åœ¨å®‰è£…æ—¶é…ç½® Istioï¼Œåªå…è®¸è¿æ¥åˆ°æ³¨å†Œè¡¨ä¸­çš„æœåŠ¡ã€‚æ­¤å¤–ï¼Œä½ åº”è¯¥å°†æ‰€æœ‰éœ€è¦ä¸ä¹‹é€šä¿¡çš„å¤–éƒ¨æœåŠ¡å»ºæ¨¡ä¸º Mesh ä¸­çš„ ServiceEntriesï¼ˆä¾‹å¦‚ï¼ŒSaaS æœåŠ¡çš„ DNS è§£æç­‰ï¼‰ï¼Œä½¿ç”¨ DestinationRules æ¥é…ç½®ä¸å®ƒä»¬é€šä¿¡çš„ TLSã€‚è¿™äº›å¤–éƒ¨æœåŠ¡åº”è¯¥ç”±å®‰å…¨å›¢é˜Ÿé›†ä¸­ç®¡ç†ï¼Œæˆ–è€…ç”±å¹³å°å›¢é˜Ÿä»£è¡¨ä»–ä»¬ç®¡ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿è¡Œæ—¶æµé‡ç®¡ç†é…ç½®&#34;&gt;è¿è¡Œæ—¶æµé‡ç®¡ç†é…ç½®&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;ä¸ºæœåŠ¡ä½¿ç”¨ä¸€è‡´çš„å…¨å±€åç§°ï¼Œå¹¶ä½¿ç”¨ Istio å°†å®ƒä»¬æ˜ å°„åˆ°æœ¬åœ°å®ä¾‹&lt;/strong&gt;ã€‚æ‚¨åº”è¯¥ä½¿ç”¨ä¸€è‡´çš„å…¨å±€åç§°æ¥è®¿é—®æœåŠ¡ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Istio å°†è¿™äº›å…¨å±€åç§°æ˜ å°„åˆ°æœ¬åœ°å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œ&lt;code&gt;payments.tetrate.internal&lt;/code&gt; å¯ä»¥è¢«æ‰€æœ‰å†…éƒ¨åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œè€Œ Istio å¯ä»¥ç”¨æ¥å°†è¯¥åç§°æ˜ å°„åˆ°æœåŠ¡å®ä¾‹ï¼Œä¾‹å¦‚â€œåœ¨ &lt;code&gt;us-east-2&lt;/code&gt; Kubernetes é›†ç¾¤ä¸­çš„ &lt;code&gt;payments.default.svc.cluster.local&lt;/code&gt; æœåŠ¡â€ã€‚è¿™ç§å…¨å±€å‘½åæ–¹æ¡ˆä½¿å¼€å‘äººå‘˜å¯ä»¥åƒ SaaS ä¸€æ ·è€ƒè™‘æ‰€æœ‰æœåŠ¡ï¼Œè€Œæ— éœ€ä»”ç»†è€ƒè™‘è¿è¡Œæ—¶æ‹“æ‰‘çš„ç»†èŠ‚ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾åœ°æ‰§è¡Œæ•…éšœè½¬ç§»ã€é‡‘ä¸é›€å’Œè·¨é›†ç¾¤è·¯ç”±ç­‰æ“ä½œï¼Œä½œä¸ºæ‚¨çš„ç½‘æ ¼ä½¿ç”¨æˆç†Ÿæˆ–ç»„ç»‡éœ€æ±‚æ¼”å˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœ¨æ ¹é…ç½®ä¸­å®šä¹‰ç²—ç•¥çš„é»˜è®¤å¼¹æ€§è®¾ç½®&lt;/strong&gt;ã€‚æ‚¨åº”è¯¥ä¸ºç½‘æ ¼ä¸­çš„æ‰€æœ‰æœåŠ¡å®šä¹‰ç²—ç•¥çš„è¶…æ—¶ã€é‡è¯•ã€ç†”æ–­å’Œå¼‚å¸¸å€¼æ£€æµ‹è®¾ç½®ã€‚æ‚¨å¯ä»¥åœ¨æ ¹é…ç½®å‘½åç©ºé—´ä¸­ä½¿ç”¨ &lt;code&gt;VirtualService&lt;/code&gt; æ¥å®ç°æ­¤ç›®çš„ã€‚å„ä¸ªå›¢é˜Ÿåº”åœ¨å…¶æœ¬åœ°å‘½åç©ºé—´ä¸­æŒ‡å®šè‡ªå·±çš„åç§°ä»¥è¦†ç›–é»˜è®¤å€¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸ºåº”ç”¨ç¨‹åºå›¢é˜Ÿæä¾›ç®€åŒ–çš„â€œä½ / ä¸­ / é«˜â€å¼¹æ€§è®¾ç½®&lt;/strong&gt;ã€‚å°†ç½‘æ ¼çš„åº•å±‚ API éšè—åœ¨æ›´é«˜çº§åˆ«æ¥å£åé¢çš„ç³»ç»Ÿä¸­ï¼Œä¸ºé…ç½®é»˜è®¤æ–­è·¯å’Œå¼‚å¸¸å€¼æ£€æµ‹è®¾ç½®çš„åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æä¾›ç®€åŒ–çš„â€œä½ / ä¸­ / é«˜â€æ—‹é’®å¾ˆæœ‰ä»·å€¼ï¼Œå› ä¸ºå¾ˆå¤šé¢†åŸŸå®¹æ˜“é…ç½®é”™è¯¯ï¼Œå¯¼è‡´è¯¥åº”ç”¨ç¨‹åºæ€§èƒ½ä¸ä½³ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿è¡Œæ—¶å®‰å…¨é…ç½®&#34;&gt;è¿è¡Œæ—¶å®‰å…¨é…ç½®&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸‹å®‰å…¨å»ºè®®æ¥è‡ªæˆ‘ä»¬ä¸ºå¾®æœåŠ¡åº”ç”¨ç¨‹åºå»ºç«‹ç¾å›½å®‰å…¨æ ‡å‡†çš„å·¥ä½œï¼Œè¯¥æ ‡å‡†ç”±ç¾å›½å›½å®¶æ ‡å‡†ä¸æŠ€æœ¯ç ”ç©¶é™¢ï¼ˆNISTï¼‰åœ¨ &lt;a href=&#34;https://tetrate.io/blog/nist-standards-for-zero-trust-the-sp-800-204-series/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SP 800-204 ç³»åˆ—&lt;/a&gt; ä¸­å‘å¸ƒã€‚&lt;a href=&#34;https://tetrate.io/tetrates-guide-to-federal-security-requirements-for-microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‚¨å¯ä»¥åœ¨æˆ‘ä»¬çš„ç»¼åˆæŒ‡å—&lt;/a&gt; ä¸­é˜…è¯» NIST é’ˆå¯¹å¾®æœåŠ¡åº”ç”¨ç¨‹åºçš„æ‰€æœ‰å®‰å…¨å»ºè®®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ€å°æ§åˆ¶&lt;/strong&gt;ã€‚è¿è¡Œæ—¶çš„é›¶ä¿¡ä»»è‡³å°‘éœ€è¦ä»¥ä¸‹äº”ä¸ªæ§åˆ¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åŠ å¯†ä¼ è¾“ä¸­çš„æ‰€æœ‰å†…å®¹&lt;/strong&gt;ï¼šæä¾›æ¶ˆæ¯çœŸå®æ€§å’Œçªƒå¬ä¿æŠ¤ï¼ˆ&lt;a href=&#34;https://tetrate.io/tetrates-guide-to-federal-security-requirements-for-microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SP 800-204ï¼ŒÂ§MS-SS-4&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éªŒè¯æœåŠ¡åˆ°æœåŠ¡çš„é€šä¿¡&lt;/strong&gt;ï¼šæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½åº”éªŒè¯ä¸ä¹‹é€šä¿¡çš„åº”ç”¨ç¨‹åºçš„èº«ä»½ï¼ˆ&lt;a href=&#34;https://tetrate.io/tetrates-guide-to-federal-security-requirements-for-microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SP 800-204Aï¼ŒÂ§SM-DR16ï¼›SP 800-204Bï¼ŒÂ§APE-SR-3&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æˆæƒæœåŠ¡åˆ°æœåŠ¡è®¿é—®&lt;/strong&gt;ï¼šæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½åº”ä½¿ç”¨å…¶è¿è¡Œæ—¶èº«ä»½æˆæƒä¸ä¹‹é€šä¿¡çš„åº”ç”¨ç¨‹åºï¼ˆ&lt;a href=&#34;https://tetrate.io/tetrates-guide-to-federal-security-requirements-for-microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SP 800-204Bï¼ŒÂ§SAUZ-SR-1&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éªŒè¯æœ€ç»ˆç”¨æˆ·èº«ä»½&lt;/strong&gt;ï¼šæ¯ä¸ªè¯·æ±‚éƒ½å¿…é¡»åœ¨æœåŠ¡è°ƒç”¨å›¾ä¸­çš„æ¯ä¸ªè·ƒç‚¹è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆ&lt;a href=&#34;https://tetrate.io/tetrates-guide-to-federal-security-requirements-for-microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SP 800-204Bï¼ŒÂ§EAUN-SR-1ï¼ŒÂ§EUAZ-SR-3&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æˆæƒæœ€ç»ˆç”¨æˆ·è®¿é—®èµ„æº&lt;/strong&gt;ï¼šå¯¹æ¯ç§èµ„æºçš„æ¯æ¬¡è®¿é—®éƒ½åº”è·å¾—æˆæƒï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨å‰é—¨è®¿é—®ä¸€æ¬¡ï¼ˆ&lt;a href=&#34;https://tetrate.io/tetrates-guide-to-federal-security-requirements-for-microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SP 800-204Bï¼ŒÂ§EAUZ-SR-3&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Istio æä¾›ä¼ è¾“ä¸­çš„åŠ å¯†ï¼ˆæˆ‘ä»¬åœ¨ä¸Šé¢è®¨è®ºäº†å…¨å±€å¯ç”¨ï¼‰ï¼Œä»¥åŠå¯éªŒè¯çš„æœåŠ¡èº«ä»½ (&lt;a href=&#34;https://tetrate.io/blog/why-would-you-need-spire-for-authentication-with-istio/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIFFE&lt;/a&gt; ) å’ŒæœåŠ¡åˆ°æœåŠ¡çš„è®¿é—®æ§åˆ¶ (Istio &lt;code&gt;AuthorizationPolicy&lt;/code&gt;)ã€‚æ­¤å¤–ï¼Œå®ƒå¯ä»¥é…ç½®ä¸ºä»£è¡¨åº”ç”¨ç¨‹åºï¼ˆJWTã€OIDC ä»¤ç‰Œï¼‰éªŒè¯æŸäº›å½¢å¼çš„æœ€ç»ˆç”¨æˆ·èº«ä»½ï¼Œæœ€å Istio æ”¯æŒå¯æ’æ‹”æˆæƒç³»ç»Ÿï¼ˆEnvoy çš„ &lt;code&gt;ext_authz&lt;/code&gt;ï¼‰ä»¥å¼ºåˆ¶æœ€ç»ˆç”¨æˆ·è®¿é—®èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®‰è£…é™åˆ¶æ€§é»˜è®¤æˆæƒç­–ç•¥&lt;/strong&gt;ã€‚æ ¹æ® &lt;a href=&#34;https://istio.io/latest/docs/ops/best-practices/security/#use-default-deny-patterns&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æœ€ä½³å®è·µ&lt;/a&gt;ï¼Œæ‚¨åº”è¯¥å®‰è£…ä¸€ä¸ªä¸å…è®¸æµé‡çš„é»˜è®¤æˆæƒç­–ç•¥ï¼Œä¸ºæ¯ä¸ªæœåŠ¡å‘å¸ƒå¯¹è±¡åˆ›å»º &lt;code&gt;AuthorizationPolicy&lt;/code&gt; å¯¹è±¡ä»¥ç®¡ç†å…è®¸å®ƒä»¬ä¸ä¹‹é€šä¿¡çš„å¯¹è±¡ï¼ˆ&lt;a href=&#34;https://tetrate.io/tetrates-guide-to-federal-security-requirements-for-microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SP 800-204Bï¼ŒSAUZ-SR-1&lt;/a&gt;ï¼‰ã€‚æœ‰åŠ©äºå®ç°è¿™ä¸€ç›®æ ‡çš„ä¸¤ä¸ªæˆæƒç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;security.istio.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AuthorizationPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;deny-all-audit&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AUDIT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹ 2ï¼š&lt;code&gt;IstioAuthorizationPolicy&lt;/code&gt;ä¼šæ‹’ç»æ‰€æœ‰æµé‡ï¼Œå¹¶å®¡è®¡è®°å½•å®ƒã€‚æ‚¨å¯èƒ½ä¼šè¿è¡Œè¿™æ ·çš„ç­–ç•¥å‡ å‘¨ï¼Œä»¥äº†è§£åœ¨å¯ç”¨å¼ºåˆ¶æ‰§è¡Œä¹‹å‰æ‚¨éœ€è¦çš„ç­–ç•¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;security.istio.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AuthorizationPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;deny-all&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;{&lt;span class=&#34;nt&#34;&gt;} # or action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ALLOW&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹ 3ï¼šæ‹’ç»æ‰€æœ‰æµé‡çš„ Istio AuthorizationPolicyã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå…è®¸ä½†å…·æœ‰ç©ºè§„åˆ™é›†çš„ç­–ç•¥ï¼Œè¿™ä¸ç©ºä¸»ä½“ç›¸åŒã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é»˜è®¤æƒ…å†µä¸‹éœ€è¦ mTLS è¿›è¡ŒæœåŠ¡åˆ°æœåŠ¡é€šä¿¡&lt;/strong&gt;ã€‚é€šè¿‡åœ¨ç”±å®‰å…¨æˆ–å¹³å°å›¢é˜Ÿç®¡ç†çš„æ ¹å‘½åç©ºé—´ä¸­é…ç½® &lt;code&gt;PeerAuthentication&lt;/code&gt; èµ„æºï¼Œåº”å°†ä¼ è¾“ä¸­çš„åŠ å¯†è®¾ç½®ä¸ºä¸¥æ ¼ï¼ˆå³ &lt;a href=&#34;https://tetrate.io/blog/how-istios-mtls-traffic-encryption-works-as-part-of-a-zero-trust-security-posture/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éœ€è¦ mTLS æ‰èƒ½ä¸æœåŠ¡é€šä¿¡&lt;/a&gt;ï¼‰ã€‚ç½‘æ ¼å¤–éƒ¨çš„æœåŠ¡è°ƒç”¨ç½‘æ ¼ä¸­çš„åº”ç”¨ç¨‹åºåº”è¯¥é€šè¿‡åº”ç”¨ç¨‹åºå…¥å£ç½‘å…³è¿›è¡Œé€šä¿¡ï¼Œå®ƒå¯ä»¥å‘å¤–éƒ¨æœåŠ¡æä¾›ç®€å•çš„ TLSï¼ˆç”šè‡³æ˜æ–‡ï¼‰ï¼Œå› ä¸ºå®ƒä¸å¤ªå¯èƒ½æœ‰è¯ä¹¦æ¥å¯¹ç½‘æ ¼æ‰§è¡Œ mTLSã€‚ç½‘æ ¼å†…éƒ¨çš„æœåŠ¡å‘¼å‡ºåº”é…ç½®ä¸ºä½¿ç”¨ç®€å•çš„ TLS æˆ–æ˜æ–‡ï¼Œå¹¶å¸¦æœ‰ç”¨äºå¤–éƒ¨æœåŠ¡çš„ DestinationRule çš„æ˜æ–‡ (&lt;a href=&#34;https://tetrate.io/tetrates-guide-to-federal-security-requirements-for-microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NIST SP 800-204A, Â§SM-DR8&lt;/a&gt; )ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TLS é…ç½®é»˜è®¤å€¼&lt;/strong&gt;ã€‚Istio å¼€ç®±å³ç”¨ï¼Œå…·æœ‰è‰¯å¥½çš„ TLS è®¾ç½®ï¼ˆ&lt;a href=&#34;https://istio.io/latest/docs/concepts/security/#mutual-tls-authentication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TLS æœ€ä½ç‰ˆæœ¬ 1.2ï¼Œå…·æœ‰ä¸€ç»„æœ‰é™çš„å¯†ç å¥—ä»¶&lt;/a&gt;ï¼‰ï¼Œä½†æ‚¨å¯èƒ½éœ€è¦æ ¹æ®æ‚¨çš„ç¯å¢ƒå¯¹å…¶è¿›è¡Œè°ƒæ•´ï¼ˆä¾‹å¦‚ï¼Œåœ¨ &lt;a href=&#34;https://www.fedramp.gov/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;FedRAMP&lt;/a&gt; ç¯å¢ƒä¸­éµå®ˆ &lt;a href=&#34;https://csrc.nist.gov/publications/detail/fips/140/3/final&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;FIPS 140-3&lt;/a&gt; ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Envoy æ”¯æŒé€šè¿‡é…ç½® &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/gateway/#ServerTLSSettings-cipher_suites&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘å…³&lt;/a&gt; ä¸ºæ¯ä¸ªæœåŠ¡é…ç½®æœ€ä½ TLS ç‰ˆæœ¬å’Œä¸€ç»„å—æ”¯æŒçš„å¯†ç å¥—ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå¯èƒ½ï¼Œæˆ‘ä»¬å»ºè®®å°† &lt;strong&gt;TLS 1.3 ä½œä¸ºæœ€ä½ç‰ˆæœ¬&lt;/strong&gt; æ‰§è¡Œï¼ˆå¦‚æœæ‚¨åªæ‰§è¡Œ mTLS Envoy-to-Envoyï¼‰ï¼Œå¹¶ä¸ºéœ€è¦è¾ƒæ—§æˆ–å®‰å…¨æ€§è¾ƒä½çš„ TLS é…ç½®çš„å¤–éƒ¨æµé‡ä½¿ç”¨ç½‘å…³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ä¸ºæ¯ä¸ªæœåŠ¡åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„è¿è¡Œæ—¶èº«ä»½ï¼Œä»¥ä¿ƒè¿›è¡¨è¾¾æ€§å¼ºã€ç»†ç²’åº¦çš„æˆæƒç­–ç•¥å¹¶é™åˆ¶æš´éœ²äºæ”»å‡»&lt;/strong&gt;ã€‚ä¸ºæ‚¨æ­£åœ¨éƒ¨ç½²çš„æ¯ä¸ªæœåŠ¡åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„è¿è¡Œæ—¶æ ‡è¯†ã€‚åœ¨ Kubernetes ä¸­ï¼Œä¸è¦åœ¨æ¯ä¸ªå‘½åç©ºé—´ä¸­ä½¿ç”¨é»˜è®¤çš„ Kubernetes æœåŠ¡å¸æˆ·ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªå‘½åç©ºé—´ä¸­çš„æ¯ä¸ªæœåŠ¡åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„æœåŠ¡å¸æˆ·ã€‚æˆæƒç­–ç•¥åªèƒ½åœ¨èº«ä»½çš„ç²’åº¦ä¸Šè½»æ¾ç®¡ç†ã€‚å½“å¤šä¸ªè¿è¡Œæ—¶ç»„ä»¶å…±äº«ç›¸åŒçš„èº«ä»½æ—¶ï¼Œå¾ˆéš¾ç®¡ç†ä¸€ä¸ªè®¿é—®æ§åˆ¶ç­–ç•¥æ¥è¡¨è¾¾æ‚¨çš„é¢„æœŸè®¿é—®æƒé™ï¼ŒåŒæ—¶ä¸å…è®¸ä½¿ç”¨å…±äº«èº«ä»½çš„æŸäº›ç»„ä»¶è¿›è¡Œè¿‡äºå¹¿æ³›çš„è®¿é—®ã€‚è¿™å¯¼è‡´æ›´å¤§çš„è¡¨é¢ç§¯æš´éœ²ç»™å¯èƒ½å±åŠç³»ç»Ÿçš„ä¸€ä¸ªç»„ä»¶çš„æ”»å‡»è€…ï¼ˆ&lt;a href=&#34;https://tetrate.io/tetrates-guide-to-federal-security-requirements-for-microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NIST SP 800-204A Â§SM-DR11ï¼ŒÂ§SM-DR18&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å°†æœåŠ¡åˆ°æœåŠ¡çš„é€šä¿¡é™åˆ¶åœ¨æœ¬åœ°å‘½åç©ºé—´&lt;/strong&gt;ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡é—´é€šä¿¡åº”é™åˆ¶åœ¨æœ¬åœ°åç§°ç©ºé—´å†…ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸èƒ½å†™ä¸ºæ ¹é…ç½®å‘½åç©ºé—´ä¸­çš„å•ä¸ª AuthorizationPolicyã€‚ç›¸åï¼Œå¯ä»¥å°†ä»…å…è®¸åœ¨æœ¬åœ°å‘½åç©ºé—´ä¸­è®¿é—®çš„é»˜è®¤ AuthorizationPolicy æ¨¡æ¿åŒ–ä¸ºé»˜è®¤å€¼ï¼Œå¹¶ä¸”åº”å…è®¸åº”ç”¨ç¨‹åºå›¢é˜Ÿç¼–å†™ä»–ä»¬è‡ªå·±çš„æ›´ä¸“ä¸šï¼ˆå—é™ï¼‰çš„ç­–ç•¥ï¼ˆ&lt;a href=&#34;https://tetrate.io/tetrates-guide-to-federal-security-requirements-for-microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NIST SP800-204Bï¼ŒÂ§SAUZ-SR-1&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸‹ä¸€æ­¥&#34;&gt;ä¸‹ä¸€æ­¥&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¸Œæœ›ä»æˆ‘ä»¬å¤šå¹´å¸®åŠ©å®¢æˆ·æ„å»ºæˆåŠŸçš„æœåŠ¡ç½‘æ ¼å®è·µçš„ç»éªŒä¸­è·å¾—çš„è¿™äº›æœ€ä½³å®è·µå°†æœ‰åŠ©äºä¿ƒè¿›æ‚¨çš„éƒ¨ç½²ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰ï¼Œè¯·æŸ¥çœ‹æœåŠ¡ç½‘æ ¼æœ€ä½³å®è·µç³»åˆ—ä¸­çš„å…¶ä»–å¸–å­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://cloudnativecn.com/blog/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely/&#34;&gt;ç¬¬ 1 éƒ¨åˆ†ï¼šå¦‚ä½•å°†æœåŠ¡ç½‘æ ¼ä½œä¸ºå®‰å…¨æ¨¡å‹çš„ä¸€éƒ¨åˆ†ï¼Œä»¥åˆ†å±‚å½¢å¼å°†å¾®æœåŠ¡å®‰å…¨ä¸ä¼ ç»Ÿå®‰å…¨ç»“åˆèµ·æ¥&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloudnativecn.com/blog/service-mesh-deployment-best-practices-for-security-and-high-availability/&#34;&gt;ç¬¬ 2 éƒ¨åˆ†ï¼šæœåŠ¡ç½‘æ ¼å®‰å…¨æ€§å’Œé«˜å¯ç”¨æ€§éƒ¨ç½²æœ€ä½³å®è·µ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚éœ€å…¨é¢äº†è§£ NIST å¾®æœåŠ¡å®‰å…¨æ ‡å‡†ï¼Œè¯· &lt;a href=&#34;https://tetrate.io/tetrates-guide-to-federal-security-requirements-for-microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸‹è½½æˆ‘ä»¬çš„å…è´¹æŒ‡å—&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¥ä¸‹æ¥å¤šç§Ÿæˆ·çš„æœåŠ¡ç½‘æ ¼æœ€ä½³å®è·µ&#34;&gt;æ¥ä¸‹æ¥ï¼šå¤šç§Ÿæˆ·çš„æœåŠ¡ç½‘æ ¼æœ€ä½³å®è·µ&lt;/h3&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬å…³äºæœåŠ¡ç½‘æ ¼æœ€ä½³å®è·µç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºæˆ‘ä»¬çœ‹åˆ°å®¢æˆ·æ­£åœ¨åŠªåŠ›è§£å†³çš„å¸¸è§ç§Ÿèµå†³ç­–ç‚¹ï¼Œå¹¶é‡ç‚¹å…³æ³¨ç½‘æ ¼å¦‚ä½•å¸®åŠ©ä¿ƒè¿›è¿™äº›å†³ç­–ã€‚æˆ‘ä»¬å°†æ¶µç›–çš„ä¸»é¢˜åŒ…æ‹¬ Kubernetes é›†ç¾¤æ‰€æœ‰æƒã€å‘½åç©ºé—´æ‰€æœ‰æƒã€é…ç½®æ‰€æœ‰æƒï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨æœåŠ¡ç½‘æ ¼åº”ç”¨ç¨‹åºç½‘å…³æ¥ç¼“è§£ä¸­æ–­ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æœåŠ¡ç½‘æ ¼å®‰å…¨æ€§å’Œé«˜å¯ç”¨æ€§éƒ¨ç½²æœ€ä½³å®è·µ</title>
      <link>https://cloudnativecn.com/blog/service-mesh-deployment-best-practices-for-security-and-high-availability/</link>
      <pubDate>Mon, 30 Jan 2023 11:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/service-mesh-deployment-best-practices-for-security-and-high-availability/</guid>
      <description>&lt;p&gt;è¿™æ˜¯ &lt;a href=&#34;https://tetrate.io/blog/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼æœ€ä½³å®è·µç³»åˆ—æ–‡ç« &lt;/a&gt; ä¸­çš„ç¬¬äºŒç¯‡ï¼Œæ‘˜è‡ª Tetrate åˆ›å§‹å·¥ç¨‹å¸ˆ Zack Butcher å³å°†å‡ºç‰ˆçš„ä¹¦ç± Istio in Productionã€‚&lt;/p&gt;
&lt;p&gt;å½“æ¶‰åŠåˆ°åœ¨å¤šé›†ç¾¤çš„åŸºç¡€è®¾æ–½ä¸­éƒ¨ç½²æœåŠ¡ç½‘æ ¼æ—¶ï¼Œæœ‰ä¸€äº›å¯ç§»åŠ¨çš„éƒ¨åˆ†ã€‚è¿™é‡Œä¸»è¦æƒ³å¼ºè°ƒçš„æ˜¯æ§åˆ¶å¹³é¢åº”è¯¥å¦‚ä½•éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºé™„è¿‘ï¼Œå…¥å£åº”è¯¥å¦‚ä½•éƒ¨ç½²ä»¥ä¿ƒè¿›å®‰å…¨æ€§å’Œæ•æ·æ€§ï¼Œå¦‚ä½•ä½¿ç”¨ Envoy ä¿ƒè¿›è·¨é›†ç¾¤è´Ÿè½½å‡è¡¡ï¼Œä»¥åŠç½‘æ ¼å†…éƒ¨å¦‚ä½•ä½¿ç”¨è¯ä¹¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿æœåŠ¡ç½‘æ ¼æ§åˆ¶å¹³é¢ä¸æ•…éšœåŸŸä¿æŒä¸€è‡´&#34;&gt;ä½¿æœåŠ¡ç½‘æ ¼æ§åˆ¶å¹³é¢ä¸æ•…éšœåŸŸä¿æŒä¸€è‡´&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å»ºè®®ï¼šå›´ç»•æ•…éšœåŸŸéƒ¨ç½²æ¾æ•£è€¦åˆçš„æ§åˆ¶å¹³é¢ä»¥å®ç°é«˜å¯ç”¨æ€§ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ„å»ºé«˜å¯ç”¨æ€§ç³»ç»Ÿå¯èƒ½å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œè€Œä¸”é€šå¸¸æˆæœ¬å¾ˆé«˜ã€‚æˆ‘ä»¬çŸ¥é“çš„ä¸€ç§ç»è¿‡éªŒè¯çš„æŠ€æœ¯æ˜¯å›´ç»•æ•…éšœåŸŸæ„å»ºã€‚æ•…éšœåŸŸæ˜¯å½“å…³é”®ç³»ç»Ÿå‘ç”Ÿæ•…éšœæ—¶å—å½±å“çš„åŸºç¡€æ¶æ„éƒ¨åˆ†ã€‚æˆ‘ä»¬æ„å»ºå¯é ç³»ç»Ÿçš„åŸºæœ¬æ–¹æ³•æ˜¯å°†ç³»ç»Ÿè·¨è¶Šçš„æ•…éšœåŸŸåˆ†ç»„ä¸ºå¤šä¸ªç‹¬ç«‹çš„å­¤å²›ã€‚æœ€ç»ˆç³»ç»Ÿçš„æ•´ä½“å¯é æ€§å–å†³äºæˆ‘ä»¬å¯ä»¥ä½¿å­¤å²›çš„ç‹¬ç«‹ç¨‹åº¦ã€‚å®é™…ä¸Šï¼Œæ€»æ˜¯å­˜åœ¨ä¸€äº›ç›¸äº’ä¾èµ–æ€§ï¼Œå°†å…¶æœ€å°åŒ–æ€»æ˜¯æˆæœ¬ä¸å¯ç”¨æ€§çš„æƒè¡¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ²¡æœ‰è€¦åˆæ•…éšœåŸŸçš„æƒ…å†µä¸‹åˆ›å»ºéš”ç¦»å­¤å²›çš„æœ€ç®€å•æ–¹æ³•æ˜¯åœ¨æ¯ä¸ªå­¤å²›ä¸­è¿è¡Œå…³é”®æœåŠ¡çš„ç‹¬ç«‹å‰¯æœ¬ã€‚æˆ‘ä»¬å¯ä»¥è¯´è¿™äº›å‰¯æœ¬æ˜¯ç­’ä»“çš„æœ¬åœ°å‰¯æœ¬ â€”â€” å®ƒä»¬å…±äº«ç›¸åŒçš„æ•…éšœåŸŸã€‚åœ¨äº‘åŸç”Ÿæ¶æ„ä¸­ï¼ŒKubernetes é›†ç¾¤å½¢æˆäº†æœ€è‡ªç„¶çš„ç­’ä»“è¾¹ç•Œã€‚Istio æ˜¯ä¸€é¡¹å…³é”®æœåŠ¡ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ¯ä¸ªåº”ç”¨ç¨‹åºé›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ª Istio æ§åˆ¶å¹³é¢å®ä¾‹ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬éƒ¨ç½² Istio ä½¿å…¶æ•…éšœåŸŸä¸æ‚¨çš„åº”ç”¨ç¨‹åºçš„æ•…éšœåŸŸä¿æŒä¸€è‡´ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œæˆ‘ä»¬ç¡®ä¿ Istio æ§åˆ¶å¹³é¢å®ä¾‹æ˜¯æ¾æ•£è€¦åˆçš„ï¼Œä¸éœ€è¦ç›´æ¥ä¸å…¶ä»–é›†ç¾¤é€šä¿¡ï¼Œä»è€Œæœ€å¤§é™åº¦åœ°å‡å°‘å…¶ä¸å­¤å²›å¤–éƒ¨çš„é€šä¿¡ã€‚æœ‰å…³å¦‚ä½•å®ç°æ­¤ç›®çš„çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ä¸‹é¢çš„å¤šé›†ç¾¤éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨åº”ç”¨ç¨‹åºå…¥å£ç½‘å…³éš”ç¦»æ¯ä¸ªåº”ç”¨ç¨‹åºçš„æµé‡&#34;&gt;ä½¿ç”¨åº”ç”¨ç¨‹åºå…¥å£ç½‘å…³éš”ç¦»æ¯ä¸ªåº”ç”¨ç¨‹åºçš„æµé‡&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å»ºè®®ï¼šä»æ¯ä¸ªåº”ç”¨ç¨‹åºæˆ–åº”ç”¨ç¨‹åºå›¢é˜Ÿçš„ç½‘å…³ï¼ˆåº”ç”¨ç¨‹åºå…¥å£ç½‘å…³ï¼‰å¼€å§‹ï¼Œä»¥å¸®åŠ©ç¼“è§£å…±äº«ä¸­æ–­ã€‚éšç€æ—¶é—´çš„æ¨ç§»æ‚¨æ“ä½œç»éªŒçš„å¢åŠ ï¼Œå°†åº”ç”¨ç¨‹åºå…¥å£åˆå¹¶åˆ°å…±äº«ç½‘å…³ä»¥ä¼˜åŒ–æˆæœ¬ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è™½ç„¶ Istio é»˜è®¤é™„å¸¦å…±äº« &lt;code&gt;istio-ingressgateway&lt;/code&gt;ï¼Œä½†æˆ‘ä»¬ä¸å»ºè®®ä½¿ç”¨å…±äº«ç½‘å…³ã€‚å¤§å¤šæ•°é‡‡ç”¨ç½‘æ ¼çš„å›¢é˜Ÿéƒ½éœ€è¦æ—¶é—´æ¥æ„å»ºå®æ–½å…±äº«ç½‘å…³æ¨¡å‹æ‰€éœ€çš„å®¡æŸ¥å®è·µå’Œæ“ä½œï¼Œè€Œæ²¡æœ‰å…±äº«ä¸­æ–­çš„é£é™©ã€‚ç‰¹åˆ«æ˜¯åœ¨ Istio å®æ–½çš„æ—©æœŸï¼Œæˆ‘ä»¬å»ºè®®æ¯ä¸ªå›¢é˜Ÿéƒ¨ç½²ä¸€ä¸ª Envoy ç½‘å…³ã€‚æˆ‘ä»¬ç§°è¿™äº›ä¸ºåº”ç”¨ç¨‹åºå…¥å£ç½‘å…³ã€‚éšç€æ‚¨è·å¾—æ“ä½œç»éªŒï¼Œæ‚¨å¯ä»¥å¼€å§‹å°†åº”ç”¨ç¨‹åºåˆå¹¶åˆ°å…±äº«ç½‘å…³ä¸Šä»¥ä¼˜åŒ–æˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨å…±äº«ç½‘å…³æ¨¡å‹å®ç°æ¯ä¸ªå›¢é˜Ÿéš”ç¦»çš„æ·å¾„æ˜¯ä¸ºæ¯ä¸ªå›¢é˜Ÿåˆ†é…ä¸€ä¸ªå•ç‹¬çš„ä¸»æœºåã€‚æŒ‰ä¸»æœºåéš”ç¦»çš„å›¢é˜Ÿå¯ä»¥æ›´å®‰å…¨åœ°é…ç½®å…±äº«ç½‘å…³å®ä¾‹ã€‚ç„¶è€Œï¼Œå…¶ä»–å…±åŒå‘½è¿çš„ä¸­æ–­é£é™©ä»ç„¶å­˜åœ¨ï¼Œä¾‹å¦‚å…¥å£ä»£ç†éƒ¨ç½²çš„é”™è¯¯é…ç½®ã€å˜ˆæ‚çš„é‚»å±…æ¶ˆè€—èµ„æºå’Œå¢åŠ æ‰€æœ‰åº”ç”¨ç¨‹åºçš„å»¶è¿Ÿç­‰ã€‚æ ¹æ®æˆ‘ä»¬çš„ç»éªŒï¼Œæ¯ä¸ªå›¢é˜Ÿä¸€ä¸ªç½‘å…³çš„æ–¹æ³•ä¼šäº§ç”Ÿæœ€å¿«çš„å½±å“ï¼Œå¹¶ä¸”å¤±è´¥çš„æœºä¼šæœ€å°‘ï¼Œå¹¶ä¸”æ€»ä½“æˆæœ¬ç›¸å¯¹è¾ƒä½ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æœŸæœ›æˆç†Ÿéƒ¨ç½²çš„æœ€ç»ˆçŠ¶æ€æ˜¯ 80-20 çš„æ¯”ä¾‹ï¼šå¤§å¤šæ•°åº”ç”¨ç¨‹åºå°†é€šè¿‡å…±äº«ç½‘å…³æ¥æ”¶æµé‡ï¼Œè€Œä¸€å°éƒ¨åˆ†é«˜åº¦å…³é”®æˆ–æ•æ„Ÿçš„åº”ç”¨ç¨‹åºå°†ä¿ç•™ä¸“ç”¨ç½‘å…³ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨åº”ç”¨ç¨‹åºè¾¹ç¼˜ç½‘å…³åœ¨å¤šä¸ªé›†ç¾¤ä¹‹é—´åˆ†é…å…¥å£æµé‡&#34;&gt;ä½¿ç”¨åº”ç”¨ç¨‹åºè¾¹ç¼˜ç½‘å…³åœ¨å¤šä¸ªé›†ç¾¤ä¹‹é—´åˆ†é…å…¥å£æµé‡&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å»ºè®®ï¼šä½¿ç”¨åº”ç”¨ç¨‹åºè¾¹ç¼˜ç½‘å…³ä¸ºå®¢æˆ·ç«¯æä¾›å•ä¸€åœ°å€ï¼Œä»¥ä¾›å®¢æˆ·ç«¯ä½¿ç”¨å¹¶å°†æµé‡åˆ†é…åˆ°è·¨å¤šä¸ªé›†ç¾¤çš„åº”ç”¨ç¨‹åºå…¥å£ç½‘å…³ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-1åŸºäº-envoy-çš„åº”ç”¨ç¨‹åºè¾¹ç¼˜ç½‘å…³&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1ï¼šåŸºäº Envoy çš„åº”ç”¨ç¨‹åºè¾¹ç¼˜ç½‘å…³ã€‚&#34; srcset=&#34;
               /blog/service-mesh-deployment-best-practices-for-security-and-high-availability/f1_hu_7650a8ec332ec6c1.webp 400w,
               /blog/service-mesh-deployment-best-practices-for-security-and-high-availability/f1_hu_abe13f1949e5c033.webp 760w,
               /blog/service-mesh-deployment-best-practices-for-security-and-high-availability/f1_hu_4b8ca923a2ec64c6.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/service-mesh-deployment-best-practices-for-security-and-high-availability/f1_hu_7650a8ec332ec6c1.webp&#34;
               width=&#34;744&#34;
               height=&#34;680&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1ï¼šåŸºäº Envoy çš„åº”ç”¨ç¨‹åºè¾¹ç¼˜ç½‘å…³ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç»å¸¸çœ‹åˆ°å®¢æˆ·éœ€è¦è·¨å¤šä¸ªé›†ç¾¤åˆ†é…å…¥å£æµé‡ã€‚ä¾‹å¦‚ï¼Œä»–ä»¬å¯èƒ½å¸Œæœ›å¯ç”¨è“ / ç»¿åŸºç¡€è®¾æ–½å‡çº§ï¼Œä»¥ä¿ƒè¿›è·¨åŒºåŸŸæ•…éšœè½¬ç§»ï¼Œæˆ–è€…é€šè¿‡ä½¿ç”¨ Envoy çš„ L7 åŠŸèƒ½å°†æµé‡ä»å•ä½“è¿ç§»åˆ°å¾®æœåŠ¡æ¥å®ç°æ‰¼æ€æ¨¡å¼ã€‚æˆ‘ä»¬ç§°è¿™äº›ä¸ºåº”ç”¨ç¨‹åºè¾¹ç¼˜ç½‘å…³ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å®ç°è¿™ä¸ªç”¨ä¾‹ï¼Œæˆ‘ä»¬å°†éƒ¨ç½² Envoyâ€”â€” åœ¨ä¸“ç”¨çš„ Kubernetes é›†ç¾¤ä¸­æˆ–ä½œä¸ºä¸€ç»„è™šæ‹Ÿæœº â€”â€” æ¥æ¥æ”¶å¤–éƒ¨æµé‡ã€‚è¿™äº› Envoy å®ä¾‹å°†é€šè¿‡å…¶ Kubernetes å…¥å£æˆ– VM VIP å°†æµé‡è½¬å‘åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºã€‚è¿™ä¸ ingress-per-team æ–¹æ³•ååŒå·¥ä½œï¼šå¤šé›†ç¾¤ç½‘å…³ä¸ºå®¢æˆ·ç«¯æä¾›ä¸€ä¸ªå•ä¸€åœ°å€ä»¥ä¾›ä½¿ç”¨ï¼Œæ ¹æ®æ‚¨çš„åŸºç¡€è®¾æ–½éœ€è¦æä¾›å°½å¯èƒ½å¤šçš„åº”ç”¨ç¨‹åºç½‘å…³å’Œé›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶æ­¤ç½‘å…³ç¡®å®å­˜åœ¨å…±äº«æ•…éšœåŸŸï¼Œä½†å…¶é…ç½®è¿œæ¯”æ¯ä¸ªåº”ç”¨ç¨‹åºä¸€ä¸ªå…¥å£ç½‘å…³çš„é…ç½®ç®€å•ã€‚å› æ­¤ï¼Œä½œä¸ºå…±äº«åŸºç¡€æ¶æ„è¿è¡Œèµ·æ¥æ›´å®¹æ˜“ï¼Œä¹Ÿæ›´å®‰å…¨ã€‚æ¯ä¸ªé›†ç¾¤éƒ½æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºå…¥å£ç½‘å…³çš„å…±äº«åº”ç”¨ç¨‹åºè¾¹ç¼˜ç½‘å…³æ˜¯ä¸€ç§å¼ºå¤§è€Œçµæ´»çš„æ¨¡å‹ï¼Œç”¨äºåœ¨ç½‘æ ¼ä¸Šéƒ¨ç½²å’Œæ“ä½œåº”ç”¨ç¨‹åºï¼Œè¿˜å¯ä»¥æ›´è½»æ¾åœ°æ“ä½œåº•å±‚åŸºç¡€è®¾æ–½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¯ä¹¦å’Œå…¬é’¥åŸºç¡€è®¾æ–½-pki-çš„å»ºè®®&#34;&gt;è¯ä¹¦å’Œå…¬é’¥åŸºç¡€è®¾æ–½ (PKI) çš„å»ºè®®&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å»ºè®®ï¼šä»æ‚¨ç°æœ‰çš„ä¼ä¸šæ ¹ç›®å½•ä¸ºç½‘æ ¼ mTLS åˆ›å»ºä¸€ä¸ªä¸­é—´ç­¾åè¯ä¹¦ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Istio ä½¿ç”¨å¸¸è§„ X.509 è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯å¹¶åœ¨ç½‘æ ¼ä¸­å¯ç”¨ä¼ è¾“åŠ å¯†ã€‚æˆ‘ä»¬å»ºè®®ä¸ºç°æœ‰ä¼ä¸šæ ¹ç›®å½•ä¸­çš„æ‰€æœ‰ç½‘æ ¼ mTLS åˆ›å»ºä¸€ä¸ªç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦ã€‚å¦‚æœæ¯ä¸ªç¯å¢ƒéƒ½æœ‰ä¸€ä¸ªæ ¹ï¼Œè¯·ä¸ºæ¯ä¸ªç¯å¢ƒåˆ›å»ºä¸€ä¸ªç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦ã€‚ä½¿ç”¨è¯¥ç½‘æ ¼ä¸­é—´é¢å‘è¯ä¹¦ä¸ºæ¯ä¸ª Istio å®‰è£…åˆ›å»ºä¸€ä¸ªç­¾åè¯ä¹¦ã€‚æˆ‘ä»¬å»ºè®®åˆ›å»ºä¸€ä¸ªç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦ï¼Œä»¥ä¾¿åœ¨ä»»ä½•ç‰¹å®šç¯å¢ƒä¸­ç½‘æ ¼çš„æ•´ä¸ª PKI æ˜¯ä¸€æ£µæ ‘ï¼Œå¦‚æœéœ€è¦å¯ä»¥ä¸€èµ·å¤±æ•ˆã€‚æˆæœ¬æ˜¯ä¸€äº›é¢å¤–çš„è¯ä¹¦ç®¡ç†ï¼Œä¸æ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦ç›¸æ¯”ï¼Œåœ¨ç®¡ç†ç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦çš„ç”Ÿå‘½å‘¨æœŸæ—¶éœ€è¦æ›´åŠ å°å¿ƒã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-2-tetrate-æ¨èçš„å°†ç½‘æ ¼ä¸ç°æœ‰-pki-é›†æˆçš„æ–¹æ³•åœ¨ç¯å¢ƒå¦‚-prodä¸­ä¸º-istio-ç”Ÿæˆä¸­é—´ç­¾åè¯ä¹¦ä½¿ç”¨å®ƒå‘è¯¥ç¯å¢ƒä¸­çš„æ¯ä¸ª-istio-æ§åˆ¶å¹³é¢å®ä¾‹é¢å‘ç­¾åè¯ä¹¦å¹¶è®©-istio-åƒå¾€å¸¸ä¸€æ ·å‘æ¯ä¸ªé›†ç¾¤ä¸­çš„æ‰€æœ‰-pod-é¢å‘å·¥ä½œè´Ÿè½½å¶è¯ä¹¦&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 2. Tetrate æ¨èçš„å°†ç½‘æ ¼ä¸ç°æœ‰ PKI é›†æˆçš„æ–¹æ³•ï¼šåœ¨ç¯å¢ƒï¼ˆå¦‚ prodï¼‰ä¸­ä¸º Istio ç”Ÿæˆä¸­é—´ç­¾åè¯ä¹¦ï¼Œä½¿ç”¨å®ƒå‘è¯¥ç¯å¢ƒä¸­çš„æ¯ä¸ª Istio æ§åˆ¶å¹³é¢å®ä¾‹é¢å‘ç­¾åè¯ä¹¦ï¼Œå¹¶è®© Istio åƒå¾€å¸¸ä¸€æ ·å‘æ¯ä¸ªé›†ç¾¤ä¸­çš„æ‰€æœ‰ pod é¢å‘å·¥ä½œè´Ÿè½½ï¼ˆå¶ï¼‰è¯ä¹¦ã€‚&#34; srcset=&#34;
               /blog/service-mesh-deployment-best-practices-for-security-and-high-availability/f2_hu_c4f59eb41fb49625.webp 400w,
               /blog/service-mesh-deployment-best-practices-for-security-and-high-availability/f2_hu_3207c45de385e880.webp 760w,
               /blog/service-mesh-deployment-best-practices-for-security-and-high-availability/f2_hu_1dd1b8164df9c4bd.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/service-mesh-deployment-best-practices-for-security-and-high-availability/f2_hu_c4f59eb41fb49625.webp&#34;
               width=&#34;760&#34;
               height=&#34;459&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 2. Tetrate æ¨èçš„å°†ç½‘æ ¼ä¸ç°æœ‰ PKI é›†æˆçš„æ–¹æ³•ï¼šåœ¨ç¯å¢ƒï¼ˆå¦‚ prodï¼‰ä¸­ä¸º Istio ç”Ÿæˆä¸­é—´ç­¾åè¯ä¹¦ï¼Œä½¿ç”¨å®ƒå‘è¯¥ç¯å¢ƒä¸­çš„æ¯ä¸ª Istio æ§åˆ¶å¹³é¢å®ä¾‹é¢å‘ç­¾åè¯ä¹¦ï¼Œå¹¶è®© Istio åƒå¾€å¸¸ä¸€æ ·å‘æ¯ä¸ªé›†ç¾¤ä¸­çš„æ‰€æœ‰ pod é¢å‘å·¥ä½œè´Ÿè½½ï¼ˆå¶ï¼‰è¯ä¹¦ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio ç›‘è§†æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨æ£€æµ‹åˆ°æ–‡ä»¶æ›´æ”¹æ—¶é‡æ–°åŠ è½½å…¶ç­¾åè¯ä¹¦ã€‚å› æ­¤ï¼Œåªè¦ä½ æœ‰ä¸€ä¸ªæ‰¹å‡†çš„æœºåˆ¶æ¥å°†ç§˜å¯†åŠ è½½åˆ° &lt;em&gt;istiod&lt;/em&gt; pod çš„æ–‡ä»¶ç³»ç»Ÿä¸­ â€”â€” æ¯”å¦‚ &lt;em&gt;cert-manager&lt;/em&gt;ã€Vault çš„ &lt;em&gt;init-agent&lt;/em&gt; æˆ– sidecarï¼Œæˆ–è€…åªæ˜¯å­˜å‚¨åœ¨åŠ å¯† &lt;em&gt;etcd&lt;/em&gt; ä¸­çš„æ™®é€šæ—§ Kubernetes Secretâ€”â€” é›†æˆ Istio è¿›å…¥æ‚¨çš„ PKI åº”è¯¥å¾ˆå®¹æ˜“ã€‚æ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦çš„è½®æ¢åº”ç”±æ‚¨çš„ PKI è‡ªåŠ¨æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;Istio ä½¿ç”¨ä¼—æ‰€å‘¨çŸ¥çš„å¯†ç å­¦åº“ï¼šIstio çš„å†…éƒ¨ CA ä½¿ç”¨ Golang çš„å¯†ç å­¦å¥—ä»¶ï¼ŒEnvoyï¼ˆsidecar å’Œ ingressï¼‰ä½¿ç”¨ BoringSSL è¿›è¡Œè¯ä¹¦éªŒè¯å’Œä¼ è¾“ä¸­çš„åŠ å¯†ã€‚é€šè¿‡ Tetrate çš„å¼€æº Istio å‘è¡Œç‰ˆ &lt;a href=&#34;https://tetr8.io/tid&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Istio Distro&lt;/a&gt; ï¼Œç»è¿‡ FIPS éªŒè¯çš„æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢æ„å»ºä¹Ÿä½œä¸º &lt;a href=&#34;https://tetr8.io/tis&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Istio è®¢é˜…&lt;/a&gt; çš„ä¸€éƒ¨åˆ†æä¾›ï¼Œå› æ­¤æ‚¨å¯èƒ½æœŸæœ›çš„æ‰€æœ‰ X.509 çº¦æŸï¼ˆåŸºæœ¬çº¦æŸï¼Œå¦‚ CA å’Œæ·±åº¦ï¼Œå¼€ç®±å³ç”¨åœ°æ”¯æŒå’Œå¼ºåˆ¶æ‰§è¡Œå‘½åçº¦æŸã€ç­–ç•¥çº¦æŸç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨æçŸ­å¯¿å‘½çš„å·¥ä½œè´Ÿè½½è¯ä¹¦ä»¥è½»æ¾åŠé”€&#34;&gt;ä½¿ç”¨æçŸ­å¯¿å‘½çš„å·¥ä½œè´Ÿè½½è¯ä¹¦ä»¥è½»æ¾åŠé”€&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å»ºè®®ï¼šä½¿ç”¨ Istio æ¥è‡ªåŠ¨åŒ–è¯ä¹¦ç®¡ç†ï¼Œä»¥ä¾¿è®¾ç½®æçŸ­çš„å·¥ä½œè´Ÿè½½è¯ä¹¦ TTL å˜å¾—åˆ‡å®å¯è¡Œï¼Œä»è€Œä½¿ &lt;a href=&#34;https://csrc.nist.gov/glossary/term/certificate_revocation_list&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯ä¹¦æ’¤é”€åˆ—è¡¨ï¼ˆCRLï¼‰&lt;/a&gt; ä¿æŒç®€çŸ­ä¸”æ˜“äºç®¡ç†ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è¯ä¹¦é¢å‘å’Œè½®æ¢ï¼ˆIstio ä¸ºæ‚¨è‡ªåŠ¨æ‰§è¡Œï¼‰ä¹‹åï¼ŒPKI ä¸­æœ€å¤§çš„æŒ‘æˆ˜æ˜¯è¯ä¹¦åŠé”€ã€‚è¯ä¹¦åŠé”€æ˜¯é€šè¿‡è¯ä¹¦åŠé”€åˆ—è¡¨å®ç°çš„ï¼Œé€šå¸¸ CRL å…·æœ‰ 24 å°æ—¶çš„å¼ºåˆ¶æ‰§è¡Œ SLAï¼šæ·»åŠ åˆ°åˆ—è¡¨ä¸­çš„è¯ä¹¦åœ¨åŠé”€åæœ€å¤š 24 å°æ—¶å†…å¯èƒ½ä¼šè¢«åŸºç¡€è®¾æ–½è§†ä¸ºæœ‰æ•ˆã€‚æ­¤å¤–ï¼Œç”±äºåŠé”€çš„è¯ä¹¦å¿…é¡»åœ¨å…¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ (TTL) å†…ä¿ç•™åœ¨åˆ—è¡¨ä¸­ï¼Œå› æ­¤åŠé”€åˆ—è¡¨ä¼šå˜å¾—åºå¤§è€Œç¬¨æ‹™ã€‚&lt;/p&gt;
&lt;p&gt;Istio æä¾›çš„ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯è‡ªåŠ¨åŒ–è¯ä¹¦ç®¡ç†ï¼Œä»¥ä¾¿è®¾ç½®æçŸ­çš„å·¥ä½œè´Ÿè½½è¯ä¹¦ TTL æ˜¯åˆ‡å®å¯è¡Œçš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio é™„å¸¦ 24 å°æ—¶çš„å·¥ä½œè´Ÿè½½è¯ä¹¦ TTLã€‚è¿™è¶³å¤ŸçŸ­ï¼Œå¤§å¤šæ•°å®‰å…¨ç»„ç»‡å¯ä»¥é€‰æ‹©è®©å—æŸçš„è¯ä¹¦è¿‡æœŸï¼Œè€Œä¸æ˜¯æ˜ç¡®åœ°æ’¤é”€å®ƒä»¬ã€‚è€Œä¸”ï¼Œå½“æ‚¨å‘ CRL æ·»åŠ è¯ä¹¦æ—¶ï¼Œå®ƒåªéœ€è¦åœ¨é‚£é‡Œåœç•™å¾ˆçŸ­çš„æ—¶é—´ï¼ˆå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦åœ¨ CRL ä¸Šä¿ç•™è¿‡æœŸçš„è¯ä¹¦ï¼‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œç½‘æ ¼æœ‰åŠ©äºè§£å†³å¤§å¤šæ•°ç»„ç»‡é¢ä¸´çš„æœ€ç—›è‹¦çš„ PKI é—®é¢˜ï¼šå®ƒé¢å‘å’ŒåŠé”€çŸ­æœŸè¯ä¹¦ï¼Œè¿™æ„å‘³ç€åŠé”€åˆ—è¡¨å¯ä»¥åœ¨éœ€è¦æ—¶ä¿æŒç®€çŸ­ä¸”æ˜“äºç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šç”±äºç½‘æ ¼ä½¿ç”¨ mTLS è¯ä¹¦ä½œä¸ºèº«ä»½ï¼ŒIstio å°† Envoy é…ç½®ä¸ºè‡ªåŠ¨ä¸¢å¼ƒå·²å»ºç«‹çš„è¿æ¥ï¼Œä»¥å¼ºåˆ¶å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨ä»»ä½•ä¸€æ–¹è½®æ¢è¯ä¹¦æ—¶é‡æ–°éªŒè¯å½¼æ­¤ã€‚è¿™æ˜¯ Istio å®ç°ä¸­çš„è®¾è®¡å†³ç­–ï¼Œé€šå¸¸é€šè¿‡ Istio çš„å¼¹æ€§åŠŸèƒ½å¯¹åº”ç”¨ç¨‹åºéšè—ï¼šå¯¹åº”ç”¨ç¨‹åºé€æ˜çš„è‡ªåŠ¨é‡è¯•é‡æ–°å»ºç«‹è¿æ¥ã€‚åœ¨ç½‘æ ¼ä¸­è®¾ç½®è¾ƒçŸ­çš„è¯ä¹¦ TTL ä¼šå¼ºåˆ¶è¿™äº›é‡æ–°è¿æ¥æ›´é¢‘ç¹åœ°å‘ç”Ÿã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§è¡Œä¸ºå¶å°”ä¼šä¸­æ–­ä¸€äº›æœŸæœ›é•¿æœŸ TCP è¿æ¥çš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¿›ä¸€æ­¥çš„è¯ä¹¦æ¨è&#34;&gt;è¿›ä¸€æ­¥çš„è¯ä¹¦æ¨è&lt;/h3&gt;
&lt;p&gt;æ‚¨åº”è¯¥ä¸æ‚¨çš„å®‰å…¨å›¢é˜Ÿåè°ƒï¼Œä¸ºæ‚¨çš„ç½‘æ ¼é¢å‘çš„è¯ä¹¦å»ºç«‹é€‚å½“çš„çº¦æŸã€‚æˆ‘ä»¬æ¨èçš„ä¸€äº›å¸¸è§çº¦æŸå¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¯ä¹¦ç”Ÿå‘½å‘¨æœŸ (TTL)&lt;/strong&gt;ã€‚è¯·æ³¨æ„ï¼Œåªè¦è¯ä¹¦æ˜¯ä»åŒä¸€ä¸ªæ ¹é¢å‘çš„ï¼ŒIstio å°±æ”¯æŒæ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦å’Œå·¥ä½œè´Ÿè½½è¯ä¹¦çš„é›¶åœæœºè½®æ¢ã€‚æˆ‘ä»¬å»ºè®®æ¯ä¸ªçº§åˆ«çš„è¯ä¹¦ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦ 1-3 å¹´&lt;/li&gt;
&lt;li&gt;æ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦ 3 ä¸ªæœˆ&lt;/li&gt;
&lt;li&gt;å·¥ä½œè´Ÿè½½è¯ä¹¦éœ€è¦ 12-24 å°æ—¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio è‡ªåŠ¨å¤„ç†å·¥ä½œè´Ÿè½½è¯ä¹¦çš„è½®æ¢ã€‚è¿™äº›è¯ä¹¦ä¸Šçš„çŸ­ TTLï¼ˆå°‘äº 24 å°æ—¶ï¼‰æœ‰åŠ©äºé™åˆ¶å¯èƒ½è¢«ç›—çš„å‡­æ®è¿›è¡Œæ—¶é—´é™åˆ¶æ”»å‡»ï¼Œè¿˜å¯ä»¥å‡å°‘å¯¹ CRL çš„éœ€æ±‚ã€‚æ§åˆ¶å¹³é¢è¯ä¹¦åº”æŒ‰ä¸€ä¸ªæœˆçš„åç§»è½®æ¢ä»¥ç¡®ä¿å¹³ç¨³è¿‡æ¸¡ â€”â€” æ¢å¥è¯è¯´ï¼Œåœ¨ 3 ä¸ªæœˆçš„ TTL åˆ°æœŸå‰ 1 ä¸ªæœˆè½®æ¢æ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦ã€‚ç±»ä¼¼åœ°ï¼Œå½“ç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦è¿˜å‰©ä¸€åŠåˆ°ä¸‰åˆ†ä¹‹ä¸€çš„ç”Ÿå‘½å‘¨æœŸæ—¶è½®æ¢ï¼ˆä¸€å¹´ TTL æå‰ 3-4 ä¸ªæœˆï¼Œä¸‰å¹´ TTL æå‰ 6-8 ä¸ªæœˆï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åŸºç¡€ï¼ˆCA å’Œæ·±åº¦ï¼‰&lt;/strong&gt;ã€‚æ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦åº”è¯¥åªèƒ½é¢å‘å¶è¯ä¹¦ï¼šç”¨äºå·¥ä½œè´Ÿè½½è¯†åˆ«çš„éç­¾åè¯ä¹¦ã€‚å› æ­¤ï¼Œåº”é…ç½®æ·±åº¦é™åˆ¶ä»¥é˜²æ­¢æ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦é¢å‘ä»»ä½•å…¶ä»–ç­¾åè¯ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;ç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦éœ€è¦åˆ›å»ºæ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦ï¼Œå› æ­¤å®ƒåº”è¯¥é…ç½®ä¸€ä¸ªæ·±åº¦ï¼Œä»¥ä¾¿èƒ½å¤Ÿ&lt;strong&gt;åœ¨å®ƒä¸‹é¢åˆ›å»ºä¸€ä¸ªçº§åˆ«çš„ç­¾åè¯ä¹¦ï¼Œè€Œä¸æ˜¯æ›´å¤š&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åç§°çº¦æŸ&lt;/strong&gt;ã€‚Istio é¢å‘çš„å·¥ä½œè´Ÿè½½è¯ä¹¦ä¸ä¼šå¡«å…… X.509 ä¸»ä½“åç§° (SN) å­—æ®µï¼›ç½‘æ ¼èº«ä»½éªŒè¯ä¾èµ–äºä½œä¸ºä¸»ä½“å¤‡ç”¨åç§° (SAN) å­—æ®µæºå¸¦çš„ SPIFFE èº«ä»½ã€‚é˜…è¯» &lt;a href=&#34;https://github.com/spiffe/spiffe/blob/main/standards/X509-SVID.md#4-constraints-and-usage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIFFE è§„èŒƒä»¥è·å–æœ‰å…³éªŒè¯å’Œèº«ä»½éªŒè¯å·¥ä½œçš„ä¿¡æ¯&lt;/a&gt;ï¼Œä»¥åŠ Istio çš„ &lt;a href=&#34;https://istio.io/latest/docs/concepts/security/#istio-identity&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡æ¡£&lt;/a&gt; ä»¥äº†è§£ Istio å¦‚ä½•æ ¹æ® SPIFFE å¯¹èº«ä»½è¿›è¡Œç¼–ç ã€‚åœ¨ä¸ºç½‘æ ¼ä¸­é—´å’Œæ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦ç¼–å†™åç§°çº¦æŸæ—¶ï¼Œè¯·è®°ä½è¿™ä¸€ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯†é’¥ç”¨æ³•&lt;/strong&gt;ã€‚ &lt;code&gt;keyCertSign&lt;/code&gt; å¿…é¡»ä¸ºç½‘æ ¼ä¸­é—´ç­¾åè¯ä¹¦å’Œæ§åˆ¶å¹³é¢ç­¾åè¯ä¹¦è®¾ç½®ï¼Œä½†åº”ä¸ºå·¥ä½œè´Ÿè½½è¯ä¹¦ç¦ç”¨ã€‚æ¢å¥è¯è¯´ï¼Œç½‘æ ¼ä¸­é—´å’Œæ§åˆ¶å¹³é¢è¯ä¹¦æ˜¯ç­¾åè¯ä¹¦ï¼Œè€Œå·¥ä½œè´Ÿè½½è¯ä¹¦ä¸æ˜¯ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ® SPIFFE çš„å»ºè®®ï¼Œä¸åº”å°†ç­¾åè¯ä¹¦ç”¨äºä¼ è¾“ä¸­çš„åŠ å¯†ï¼Œå¹¶ä¸”åº”é…ç½®å¯†é’¥ä½¿ç”¨ä»¥é˜²æ­¢å®ƒï¼ˆé€šè¿‡åŠ å¯†çº¦æŸï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ‰©å±•å¯†é’¥ç”¨æ³•&lt;/strong&gt;ã€‚è™½ç„¶æ­¤å¤„æ²¡æœ‰å…·ä½“è¦æ±‚ï¼Œä½† SPIFFE X.509 SVID è§„èŒƒè¯´æ˜ &lt;code&gt;id-kp-serverAuth&lt;/code&gt; å’Œ &lt;code&gt;id-kp-clientAuth&lt;/code&gt; åº”é’ˆå¯¹å¶ï¼ˆå·¥ä½œè´Ÿè½½ï¼‰è¯ä¹¦è¿›è¡Œé…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;SPIFFE è§„èŒƒè¿˜æ¨èäº† &lt;a href=&#34;https://github.com/spiffe/spiffe/blob/main/standards/X509-SVID.md#4-constraints-and-usage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å„ç§è¯ä¹¦çº¦æŸ&lt;/a&gt;ï¼Œå°½ç®¡å…¶ä¸­å¤§éƒ¨åˆ†ä¸Šé¢å·²ç»çº¦æŸäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸‹ä¸€æ­¥&#34;&gt;ä¸‹ä¸€æ­¥&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¸Œæœ›ä»å¤šå¹´å¸®åŠ©æˆ‘ä»¬çš„å®¢æˆ·å……åˆ†åˆ©ç”¨æœåŠ¡ç½‘æ ¼çš„ç»éªŒä¸­æ”¶é›†çš„è¿™äº›æœ€ä½³å®è·µå°†æœ‰åŠ©äºä¿ƒè¿›æ‚¨çš„éƒ¨ç½²ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰ï¼Œè¯·æŸ¥çœ‹ &lt;a href=&#34;https://cloudnativecn.com/blog/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely/&#34;&gt;å¦‚ä½•å°†æœåŠ¡ç½‘æ ¼ä½œä¸ºå®‰å…¨æ¨¡å‹çš„ä¸€éƒ¨åˆ†ï¼Œä»¥åˆ†å±‚å½¢å¼å°†å¾®æœåŠ¡å®‰å…¨ä¸ä¼ ç»Ÿå®‰å…¨ç»“åˆèµ·æ¥&lt;/a&gt; è¿™ç¯‡æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼šæœåŠ¡ç½‘æ ¼è¿è¡Œæ—¶é…ç½®å»ºè®®ã€‚åœ¨æˆ‘ä»¬çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è°ˆè®ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘½åçº¦å®š&lt;/li&gt;
&lt;li&gt;å…¨å±€è®¾ç½®&lt;/li&gt;
&lt;li&gt;æµé‡ç®¡ç†&lt;/li&gt;
&lt;li&gt;å®‰å…¨&lt;/li&gt;
&lt;li&gt;é¥æµ‹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ•¬è¯·å…³æ³¨ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å¦‚ä½•å°†æœåŠ¡ç½‘æ ¼ä½œä¸ºå®‰å…¨æ¨¡å‹çš„ä¸€éƒ¨åˆ†ï¼Œä»¥åˆ†å±‚å½¢å¼å°†å¾®æœåŠ¡å®‰å…¨ä¸ä¼ ç»Ÿå®‰å…¨ç»“åˆèµ·æ¥</title>
      <link>https://cloudnativecn.com/blog/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely/</link>
      <pubDate>Thu, 05 Jan 2023 14:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely/</guid>
      <description>&lt;p&gt;æœ¬æ–‡æ˜¯ Tetrate å³å°†å‡ºç‰ˆçš„ã€ŠIstio in Productionã€‹ä¸€ä¹¦ä¸­æ‘˜å½•çš„æœåŠ¡ç½‘æ ¼æœ€ä½³å®è·µç³»åˆ—çš„ç¬¬ä¸€ç¯‡ï¼Œä½œè€…æ˜¯ Tetrate åˆ›å§‹å·¥ç¨‹å¸ˆ Zack Butcherã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥åˆ°è®¸å¤šå®æ–½ç½‘æ ¼çš„ä¼ä¸šçš„é—®é¢˜ï¼Œå…¶ä¸­ä¹‹ä¸€æ˜¯â€œæˆ‘è¿˜éœ€è¦å“ªäº›æ§åˆ¶ï¼Œè€Œç½‘æ ¼æä¾›å“ªäº›æ§åˆ¶ï¼Ÿâ€æ¢å¥è¯è¯´ï¼Œä»–ä»¬æƒ³çŸ¥é“ç½‘æ ¼å¦‚ä½•é€‚åº”ç°æœ‰çš„å®‰å…¨æ¨¡å‹ã€‚æˆ‘ä»¬å‘ç°ï¼Œç½‘æ ¼æœ€é€‚åˆä½œä¸ºä¸€ç»„å®‰å…¨æ§åˆ¶çš„å†…åœˆï¼Œè¿™äº›æ§åˆ¶ä»ç‰©ç†ç½‘ç»œåˆ°åº”ç”¨æœ¬èº«çš„æ¯ä¸€å±‚éƒ½è¢«å®æ–½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼ä½œä¸ºé€šç”¨ç­–ç•¥æ‰§è¡Œç‚¹&#34;&gt;æœåŠ¡ç½‘æ ¼ä½œä¸ºé€šç”¨ç­–ç•¥æ‰§è¡Œç‚¹&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°ç½‘æ ¼çš„ Sidecar ä½œä¸ºé€šç”¨ç­–ç•¥æ‰§è¡Œç‚¹ï¼ˆ&lt;a href=&#34;https://csrc.nist.gov/publications/detail/sp/800-204b/final&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NIST SP 800-204Bï¼šä½¿ç”¨æœåŠ¡ç½‘æ ¼çš„åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶&lt;/a&gt;ï¼‰ã€‚ç”±äºå®ƒæ‹¦æˆªäº†æ‰€æœ‰è¿›å‡ºåº”ç”¨ç¨‹åºçš„æµé‡ï¼ŒSidecar ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„ä½ç½®æ¥å®ç°å„ç§ç­–ç•¥ã€‚æˆ‘ä»¬å¯ä»¥å®ç°ä¼ ç»Ÿçš„å®‰å…¨ç­–ç•¥ï¼Œå¦‚åŸºäºåº”ç”¨ç¨‹åºæ ‡è¯†è€Œéç½‘ç»œä½ç½®çš„æ›´é«˜ä¿è¯çš„åº”ç”¨ç¨‹åºä¹‹é—´çš„æˆæƒã€‚ä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥å®æ–½ä¹‹å‰ä¸åˆ‡å®é™…æˆ–éœ€è¦ä¸åº”ç”¨ç¨‹åºæ·±åº¦å‚ä¸çš„ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œç½‘æ ¼å…è®¸æ‚¨ç¼–å†™ä»¥ä¸‹ç­–ç•¥ï¼šâ€œåç«¯å¯ä»¥ä»æ•°æ®åº“è¯»å–ï¼ˆä½¿ç”¨åº”ç”¨çº§èº«ä»½è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒï¼‰ï¼Œä½†å‰ææ˜¯è¯·æ±‚å…·æœ‰æœ‰æ•ˆçš„æœ€ç»ˆç”¨æˆ·å‡­è¯å¹¶å…·æœ‰è¯»å–èŒƒå›´ï¼ˆä½¿ç”¨æœ€ç»ˆç”¨æˆ·èº«ä»½è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒï¼‰ã€‚â€&lt;/p&gt;
&lt;p&gt;è™½ç„¶æœåŠ¡ç½‘æ ¼æä¾›äº†ä¸€ä¸ªå¼ºå¤§ï¼ŒåŠ¨æ€å’Œä¸€è‡´çš„å®‰å…¨åŸºçº¿ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸Šæ„å»ºåº”ç”¨ç¨‹åºå®‰å…¨æ¨¡å‹ï¼Œä½†ç½‘æ ¼æœ¬èº«æ°¸è¿œæ— æ³•æä¾›åº”ç”¨ç¨‹åºæ‰€éœ€çš„ 100% è¿è¡Œæ—¶å®‰å…¨ã€‚ä¾‹å¦‚ï¼Œç”±äº Sidecar ä½äºç”¨æˆ·ç©ºé—´ä¸­ï¼Œç½‘æ ¼åœ¨å‡è½»è®¸å¤šç±»å‹çš„ç½‘ç»œæ‹’ç»æœåŠ¡æ”»å‡»æ–¹é¢ä¸å¦‚ä¼ ç»Ÿé˜²ç«å¢™æœºåˆ¶ã€‚å¦ä¸€æ–¹é¢ï¼Œç”±äºåŒæ ·çš„åŸå› ï¼Œç½‘æ ¼åœ¨å‡è½»è®¸å¤šåº”ç”¨çº§æ‹’ç»æœåŠ¡æ”»å‡»æ–¹é¢æ¯”ä¼ ç»ŸåŸºç¡€è®¾æ–½æ›´æœ‰æ•ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„ä¸­é—´å±‚&#34;&gt;ä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„ä¸­é—´å±‚&lt;/h2&gt;
&lt;p&gt;ç½‘æ ¼ä½œä¸ºåŸºç¡€æ¶æ„çš„å¼ºå¤§ä¸­é—´å±‚ï¼šä½äºç‰©ç†ç½‘ç»œå’Œæ‰€å®æ–½çš„ L3/L4 æ§åˆ¶ä¹‹ä¸Šï¼Œä½†ä½äºåº”ç”¨ç¨‹åºä¹‹ä¸‹ã€‚è¿™å…è®¸æ›´è„†å¼±å’Œæ›´éš¾ä»¥æ”¹å˜çš„æ¾æ•£é…ç½® â€”â€” å…è®¸æ›´é«˜å±‚çš„æ›´å¤§æ•æ·æ€§ â€”â€” å› ä¸ºæ§åˆ¶ä½“ç³»åœ¨æ›´é«˜å±‚è¢«è€ƒè™‘ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-1å¢åŠ ç»†ç²’åº¦ç­–ç•¥å±‚ä»¥å¢å¼ºä¼ ç»Ÿå®‰å…¨&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1ï¼šå¢åŠ ç»†ç²’åº¦ç­–ç•¥å±‚ä»¥å¢å¼ºä¼ ç»Ÿå®‰å…¨ã€‚&#34; srcset=&#34;
               /blog/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely/f1_hu_659ffdc9470449e5.webp 400w,
               /blog/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely/f1_hu_e466412e4c341aff.webp 760w,
               /blog/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely/f1_hu_29ec119f6b4a1dc.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely/f1_hu_659ffdc9470449e5.webp&#34;
               width=&#34;760&#34;
               height=&#34;629&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1ï¼šå¢åŠ ç»†ç²’åº¦ç­–ç•¥å±‚ä»¥å¢å¼ºä¼ ç»Ÿå®‰å…¨ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç½‘æ ¼æä¾›çš„ä¸»è¦å®‰å…¨åŠŸèƒ½æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½œä¸º X.509 è¯ä¹¦çš„&lt;strong&gt;è¿è¡Œæ—¶èº«ä»½&lt;/strong&gt;ï¼Œç”¨äºåœ¨ä¼ è¾“æœŸé—´åŠ å¯†ï¼Œä»¥åŠæœåŠ¡ä¹‹é—´é€šä¿¡çš„èº«ä»½éªŒè¯å’Œæˆæƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç­–ç•¥æ‰§è¡Œç‚¹&lt;/strong&gt;ï¼Œç”¨äºåœ¨ç½‘æ ¼ä¸­çš„æ‰€æœ‰åº”ç”¨ç¨‹åºä¸Šå®æ–½ä¸€è‡´çš„æœ€ç»ˆç”¨æˆ·èº«ä»½éªŒè¯å’Œæˆæƒã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡èº«ä»½å’Œæœ€ç»ˆç”¨æˆ·èº«ä»½çš„&lt;strong&gt;è¿è¡Œæ—¶ç­–ç•¥æ‰§è¡Œ&lt;/strong&gt;ï¼ˆä¾‹å¦‚ï¼Œâ€œA åªèƒ½ä½¿ç”¨å…·æœ‰è¯»å–èŒƒå›´çš„æœ‰æ•ˆæœ€ç»ˆç”¨æˆ·å‡­è¯ä¸ B è¿›è¡Œé€šä¿¡â€ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€Ÿç‡é™åˆ¶å’Œå¼¹æ€§åŠŸèƒ½&lt;/strong&gt;ï¼Œç”¨äºå‡è½»å¸¸è§çš„åº”ç”¨çº§æ‹’ç»æœåŠ¡æ”»å‡»ï¼Œå¹¶ä¿æŠ¤å…å—å¸¸è§çš„çº§è”æ•…éšœæ¨¡å¼çš„å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;WAF&lt;/strong&gt; å’Œå…¶ä»–&lt;strong&gt;æ·±å±‚åŒ…æ£€æµ‹&lt;/strong&gt;åŠŸèƒ½ï¼Œç”¨äºå†…éƒ¨æµé‡ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨è¾¹ç¼˜ã€‚&lt;/li&gt;
&lt;li&gt;æ¥è‡ªç½‘æ ¼ä¸­æ‰€æœ‰åº”ç”¨ç¨‹åºçš„&lt;strong&gt;ä¸€è‡´çš„æ“ä½œé¥æµ‹&lt;/strong&gt;ï¼Œå¯ç”¨äºç†è§£ã€å®æ–½å’Œå®¡æ ¸å®‰å…¨ç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;å…·æœ‰åŠ¨æ€è¿è¡Œæ—¶æ›´æ–°çš„&lt;strong&gt;ç­–ç•¥å³ä»£ç &lt;/strong&gt;ï¼ˆPolicy-as-codeï¼‰æ¨¡å‹ï¼Œç‹¬ç«‹äºåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼ä½œä¸ºåˆ†å±‚é˜²å¾¡çš„ä¸€éƒ¨åˆ†&#34;&gt;æœåŠ¡ç½‘æ ¼ä½œä¸ºåˆ†å±‚é˜²å¾¡çš„ä¸€éƒ¨åˆ†&lt;/h2&gt;
&lt;p&gt;è€ƒè™‘åˆ°ç½‘æ ¼çš„å®‰å…¨åŠŸèƒ½ï¼Œæˆ‘ä»¬è®¤ä¸ºï¼Œç»„ç»‡é‡‡ç”¨å®ƒä½œä¸ºåˆ†å±‚é˜²å¾¡æ–¹æ³•çš„ä¸€éƒ¨åˆ†æ˜¯æœ€åˆç†çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-2æ¯å±‚ç­–ç•¥çš„ç¤ºä¾‹ä»¥åŠä¸€ä¸ªç¤ºä¾‹éƒ¨ç½²æ‹“æ‰‘&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 2ï¼šæ¯å±‚ç­–ç•¥çš„ç¤ºä¾‹ä»¥åŠä¸€ä¸ªç¤ºä¾‹éƒ¨ç½²æ‹“æ‰‘ã€‚&#34; srcset=&#34;
               /blog/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely/f2_hu_b0eabe991ee20fb7.webp 400w,
               /blog/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely/f2_hu_836e98be9753d7bb.webp 760w,
               /blog/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely/f2_hu_dccf493d4b64b0c7.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/how-service-mesh-layers-microservices-security-with-traditional-security-to-move-fast-safely/f2_hu_b0eabe991ee20fb7.webp&#34;
               width=&#34;760&#34;
               height=&#34;395&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 2ï¼šæ¯å±‚ç­–ç•¥çš„ç¤ºä¾‹ä»¥åŠä¸€ä¸ªç¤ºä¾‹éƒ¨ç½²æ‹“æ‰‘ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;l3-å±‚çš„æ•æ·æ€§ç²—ç²’åº¦çš„å…¥å£å’Œå‡ºå£ç­–ç•¥ä»¥åŠ-l7-çš„ç»†ç²’åº¦æ§åˆ¶&#34;&gt;L3 å±‚çš„æ•æ·æ€§ï¼šç²—ç²’åº¦çš„å…¥å£å’Œå‡ºå£ç­–ç•¥ä»¥åŠ L7 çš„ç»†ç²’åº¦æ§åˆ¶&lt;/h2&gt;
&lt;p&gt;åœ¨è¾¹ç¼˜çš„ L3 æ§åˆ¶ï¼ˆå¦‚é˜²ç«å¢™ï¼‰åœ¨ç²—ç²’åº¦çš„å…¥å£å’Œå‡ºå£ç­–ç•¥æ–¹é¢ä»ç„¶æœ‰æ•ˆï¼Œä½†é€šå¸¸ä¼šå‡æ…¢åº”ç”¨ç¨‹åºå¼€å‘æ•æ·æ€§ã€‚ç”±äºç½‘æ ¼æä¾›äº†ç»†ç²’åº¦çš„æœåŠ¡é—´æˆæƒï¼Œæ‰€ä»¥å¯ä»¥åœ¨ L3 ä¸Šè®¾ç½®æ›´å¹¿æ³›çš„ç­–ç•¥ï¼Œä¸ºå¹³å°ã€å®‰å…¨å’Œåº”ç”¨ç¨‹åºå›¢é˜Ÿæä¾›æ›´å¤šæ•æ·æ€§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®æ–½å¯¹å¤–éƒ¨æœåŠ¡çš„è®¿é—®æ§åˆ¶&lt;/strong&gt;ã€‚ç½‘æ ¼çš„å‡ºå£ä»£ç†ç‰¹åˆ«é€‚ç”¨äºå®æ–½åº”ç”¨ç¨‹åºåˆ°å¤–éƒ¨æœåŠ¡çš„æ§åˆ¶ï¼Œè€Œåªæœ‰å‡ºå£ä»£ç†æœ¬èº«è¢«å¤–å‡ºé˜²ç«å¢™ allow-listedï¼šè¿™ä¸ºå¹³å°æˆ–å®‰å…¨å›¢é˜Ÿåœ¨ç®¡ç†å“ªäº›åº”ç”¨ç¨‹åºå…è®¸ä¸ä¼ä¸šåŸºç¡€æ¶æ„ä¹‹å¤–çš„é€šä¿¡æä¾›äº†å¾ˆå¤šæ•æ·æ€§ï¼ŒåŒæ—¶ä¿æŒç°æœ‰çš„åŸºäºå‘¨ç•Œçš„æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨åŠ å¯†å’ŒåŠ¨æ€è®¿é—®æ§åˆ¶ä»£æ›¿â€œå¯è¾¾æ€§å³æˆæƒâ€&lt;/strong&gt;ã€‚ç½‘æ ¼å¯ä»¥å¼€å§‹æœ‰æ•ˆåœ°å–ä»£ VPN å’ŒåŸºäº IPSec çš„ç½‘ç»œâ€œå¯è¾¾æ€§å³æˆæƒâ€æ¨¡å¼ï¼Œæä¾›ä¼ è¾“ä¸­çš„åŠ å¯†ï¼Œä»¥åŠæ¯ä¸ªåº”ç”¨è€Œä¸æ˜¯æ¯ä¸ªä¸»æœºçš„è®¤è¯å’Œæˆæƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;l4-å±‚çš„æ”¹è¿›æ›´æ‰å¹³å’Œæ˜“äºç®¡ç†çš„ç½‘ç»œå¾®åˆ†æ®µ&#34;&gt;L4 å±‚çš„æ”¹è¿›ï¼šæ›´æ‰å¹³å’Œæ˜“äºç®¡ç†çš„ç½‘ç»œå¾®åˆ†æ®µ&lt;/h2&gt;
&lt;p&gt;å¾®åˆ†æ®µä¹‹ç±»çš„æ§åˆ¶å¯ä»¥é€šè¿‡ç½‘æ ¼è¿›ä¸€æ­¥æ”¹è¿›ï¼šå°½ç®¡æˆ‘ä»¬å¯èƒ½å…è®¸æ•´ä¸ªï¼ˆå°ï¼‰å­ç½‘åœ¨åŸºäºåˆ†æ®µçš„ç­–ç•¥ä¸­è¿›è¡Œé€šä¿¡ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç½‘æ ¼æŒ‰æ–¹æ³•å’ŒåŠ¨è¯å¯¹å•ç‹¬çš„æœåŠ¡é—´é€šä¿¡è¿›è¡Œæ§åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¡¥å……ç°æœ‰çš„å¾®åˆ†æ®µåŒæ—¶å±•å¹³ç½‘ç»œ&lt;/strong&gt;ã€‚é€šè¿‡æä¾›ç»†ç²’åº¦çš„æœåŠ¡é—´æ§åˆ¶ï¼Œç½‘æ ¼å¾€å¾€ä¼šè¡¥å……ç°æœ‰çš„å¾®åˆ†æ®µç­–ç•¥ï¼ŒåŒæ—¶ä½¿å¾—ç»„ç»‡æ›´å®¹æ˜“ç®¡ç†çš„è¾ƒå¹³çš„ç½‘ç»œå¾—ä»¥é‡‡ç”¨ï¼ˆä¾‹å¦‚ï¼Œåœ¨äº‘ç¯å¢ƒä¸­ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨å·¥ä½œè´Ÿè½½èº«ä»½å¯ç”¨ä¼ è¾“æœŸé—´çš„åŠ å¯†ï¼ˆmTLSï¼‰å’ŒæœåŠ¡çº§åˆ«è®¿é—®æ§åˆ¶&lt;/strong&gt;ã€‚ä¼ è¾“å±‚å‡ ä¹æ€»æ˜¯å¤„ç†åŠ å¯†ä¼ è¾“ï¼Œç½‘æ ¼é€šè¿‡æ ¹æ® SPIFFE è§„èŒƒå‘å¸ƒå’Œè½®æ¢çŸ­æœŸï¼ˆ&amp;lt;24 å°æ—¶ï¼‰å·¥ä½œè´Ÿè½½èº«ä»½è¯ä¹¦æ¥ä¸ºåº”ç”¨ç¨‹åºå®ç°æ­¤åŠŸèƒ½ï¼Œä»è€Œå…è®¸ä¼ è¾“æœŸé—´çš„åŠ å¯†ä»¥åŠæœåŠ¡çº§åˆ«çš„èº«ä»½éªŒè¯å’Œæˆæƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;l7-å±‚çš„å¢å¼ºæ— å¤„ä¸åœ¨çš„è¾¹ç¼˜å’Œè®¿é—®æ§åˆ¶&#34;&gt;L7 å±‚çš„å¢å¼ºï¼šæ— å¤„ä¸åœ¨çš„è¾¹ç¼˜å’Œè®¿é—®æ§åˆ¶&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;ä¸ºæ‰€æœ‰æµé‡æä¾›è¾¹ç¼˜æ§åˆ¶&lt;/strong&gt;ã€‚L7 æ§åˆ¶ï¼Œå¦‚ Web åº”ç”¨ç¨‹åºé˜²ç«å¢™ï¼ˆWAFï¼‰ä»¥åŠâ€œAPI ç½‘å…³åŠŸèƒ½â€ï¼ˆå¦‚æµé‡é™åˆ¶ï¼‰å‡ ä¹æ€»æ˜¯åœ¨è¾¹ç¼˜å®æ–½ã€‚ç½‘æ ¼å¯ä»¥é€šè¿‡ä¸ºç½‘æ ¼ä¸­æ‰€æœ‰æµé‡ï¼ˆåŒ…æ‹¬å†…éƒ¨çš„â€œä¸œè¥¿â€é€šä¿¡ï¼‰å¯ç”¨ç›¸åŒçš„åŠŸèƒ½æ¥å¢å¼ºè¿™äº›ç°æœ‰éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç®€åŒ–åº”ç”¨ç¨‹åºçš„è®¿é—®æ§åˆ¶&lt;/strong&gt;ã€‚é™¤äº†ä½¿è¾¹ç¼˜æ§åˆ¶æ— å¤„ä¸åœ¨ä¹‹å¤–ï¼Œç½‘æ ¼è¿˜å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçœ‹åˆ°è¯·æ±‚ä¹‹å‰æ‰§è¡Œç«¯ç”¨æˆ·èº«ä»½éªŒè¯å’Œç²—ç²’åº¦æˆæƒï¼Œä»è€Œå¤§å¤§ç®€åŒ–åº”ç”¨ç¨‹åºæœ¬èº«å¿…é¡»æ‰§è¡Œçš„è®¿é—®æ§åˆ¶ã€‚åœ¨æœªæ¥ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°è¶Šæ¥è¶Šå¤šçš„è®¿é—®æ§åˆ¶åŠŸèƒ½ä»åº”ç”¨ç¨‹åºè¿ç§»åˆ°ç½‘æ ¼ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“å’Œå±•æœ›&#34;&gt;æ€»ç»“å’Œå±•æœ›&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬è®¤ä¸ºï¼ŒæœåŠ¡ç½‘æ ¼æœ€é€‚åˆä½œä¸ºç°æœ‰å®‰å…¨æ¨¡å‹çš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡åœ¨ä¼ ç»Ÿå®‰å…¨æ§åˆ¶ä¹‹ä¸Šæ·»åŠ æ›´ç»†ç²’åº¦çš„å®‰å…¨ç­–ç•¥æ¥å®ç°ã€‚ä½œä¸ºä¸€ä¸ªé€šç”¨ç­–ç•¥æ‰§è¡Œç‚¹ï¼Œç½‘æ ¼åœ¨æ›´æ”¹æœ€å›°éš¾çš„è¾ƒä½å±‚æä¾›äº†æ›´æ¾æ•£çš„ç­–ç•¥ï¼Œå°†æ•æ·æ€§æ¨å‘å †æ ˆçš„é¡¶éƒ¨ï¼Œå…¶ä¸­æ›´å¤šçš„ä¸Šä¸‹æ–‡å…è®¸åœ¨æ›´é«˜å±‚å®ç°æ›´ç‰¹å®šçš„æ§åˆ¶ã€‚è¿™ç§å¼ºå¤§çš„å®‰å…¨å±‚å¯¹äºå¤§å¤šæ•°ç»„ç»‡æ¥è¯´éƒ½æ˜¯é‡‡ç”¨åˆ†å±‚é˜²å¾¡æ·±åº¦æ–¹æ³•çš„æœ€ä½³é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¥ä¸‹æ¥æœåŠ¡ç½‘æ ¼éƒ¨ç½²æœ€ä½³å®è·µ&#34;&gt;æ¥ä¸‹æ¥ï¼šæœåŠ¡ç½‘æ ¼éƒ¨ç½²æœ€ä½³å®è·µ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬æœåŠ¡ç½‘æ ¼æœ€ä½³å®è·µç³»åˆ—åšå®¢æ–‡ç« çš„ä¸‹ä¸€ç¯‡å°†è®¨è®ºéƒ¨ç½²æ‹“æ‰‘ã€‚åœ¨å¤šä¸ªé›†ç¾¤çš„çœŸå®åŸºç¡€æ¶æ„ä¸­éƒ¨ç½²æœåŠ¡ç½‘æ ¼æ—¶å­˜åœ¨ä¸€äº›ç§»åŠ¨éƒ¨åˆ†ã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ›´è¯¦ç»†åœ°ç ”ç©¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ§åˆ¶å¹³é¢åº”å¦‚ä½•éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºé™„è¿‘ã€‚&lt;/li&gt;
&lt;li&gt;åº”è¯¥å¦‚ä½•éƒ¨ç½²å…¥å£ï¼Œä»¥ä¿ƒè¿›å®‰å…¨å’Œæ•æ·æ€§ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ä½¿ç”¨ Envoy ä¿ƒè¿›è·¨é›†ç¾¤çš„è´Ÿè½½å¹³è¡¡ã€‚&lt;/li&gt;
&lt;li&gt;è¯ä¹¦åœ¨ç½‘æ ¼ä¸­åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰æœåŠ¡ç½‘æ ¼å’Œ Kubernetes å®‰å…¨æ€§ï¼Œæˆ‘ä»¬åœ¨ &lt;a href=&#34;https://tetr8.io/academy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Academy&lt;/a&gt; æä¾›äº†ä¸€ç³»åˆ—å…è´¹åœ¨çº¿è¯¾ç¨‹ï¼Œå¯ä»¥è®©æ‚¨å¿«é€Ÿäº†è§£ Istio å’Œ Envoyã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾ä¸€ç§å¿«é€Ÿå°† Istio æŠ•å…¥ç”Ÿäº§çš„æ–¹æ³•ï¼Œè¯·æŸ¥çœ‹ &lt;a href=&#34;https://tetr8.io/tid&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Istio Distribution (TID)&lt;/a&gt;ã€‚TID æ˜¯ Tetrate çš„å¼ºåŒ–ã€å®Œå…¨ä¸Šæ¸¸çš„ Istio å‘è¡Œç‰ˆï¼Œå…·æœ‰ç»è¿‡ FIPS éªŒè¯çš„æ„å»ºå’Œæ”¯æŒã€‚è¿™æ˜¯å¼€å§‹ä½¿ç”¨ Istio çš„å¥½æ–¹æ³•ï¼Œå› ä¸ºæ‚¨çŸ¥é“æ‚¨æœ‰ä¸€ä¸ªå€¼å¾—ä¿¡èµ–çš„å‘è¡Œç‰ˆï¼Œæœ‰ä¸€ä¸ªæ”¯æŒæ‚¨çš„ä¸“å®¶å›¢é˜Ÿï¼Œå¹¶ä¸”å¦‚æœéœ€è¦ï¼Œè¿˜å¯ä»¥é€‰æ‹©å¿«é€Ÿè·å¾— FIPS åˆè§„æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦å¯åŠ¨å¹¶è¿è¡Œ Istioï¼Œæ‚¨å¯èƒ½éœ€è¦æ›´ç®€å•çš„æ–¹æ³•æ¥ç®¡ç†å’Œä¿æŠ¤æ‚¨çš„æœåŠ¡ï¼Œè€Œä¸ä»…ä»…æ˜¯ Istio ä¸­å¯ç”¨çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯ Tetrate Service Bridge çš„ç”¨æ­¦ä¹‹åœ°ã€‚æ‚¨å¯ä»¥&lt;a href=&#34;https://tetr8.io/tsb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨è¿™é‡Œ&lt;/a&gt;è¯¦ç»†äº†è§£ Tetrate Service Bridge å¦‚ä½•ä½¿æœåŠ¡ç½‘æ ¼æ›´å®‰å…¨ã€æ›´æ˜“äºç®¡ç†å’Œå¼¹æ€§ï¼Œæˆ–&lt;a href=&#34;https://tetr8.io/contact&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è”ç³»æˆ‘ä»¬è¿›è¡Œå¿«é€Ÿæ¼”ç¤º&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åœ¨ç”Ÿäº§ä¸­å¤§è§„æ¨¡è‡ªåŠ¨åŒ– Istio CA è½®æ¢</title>
      <link>https://cloudnativecn.com/blog/automate-istio-ca-rotation-in-production-at-scale/</link>
      <pubDate>Tue, 20 Dec 2022 14:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/automate-istio-ca-rotation-in-production-at-scale/</guid>
      <description>&lt;p&gt;Istio çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€æ˜¯é€šè¿‡ç®¡ç†ç½‘æ ¼ä¸­æœåŠ¡çš„èº«ä»½æ¥ä¿ƒè¿›é›¶ä¿¡ä»»ç½‘ç»œæ¶æ„ã€‚ä¸ºäº†åœ¨ç½‘æ ¼ä¸­æ£€ç´¢ç”¨äº mTLS é€šä¿¡çš„æœ‰æ•ˆè¯ä¹¦ï¼Œå„ä¸ªå·¥ä½œè´Ÿè½½å‘ &lt;em&gt;istiod&lt;/em&gt; å‘å‡ºè¯ä¹¦ç­¾åè¯·æ±‚ (CSR)ã€‚Istiod åè¿‡æ¥éªŒè¯è¯·æ±‚å¹¶ä½¿ç”¨è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰&lt;a href=&#34;https://istio.io/latest/docs/concepts/security/#pki&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç­¾ç½² CSR ä»¥ç”Ÿæˆè¯ä¹¦&lt;/a&gt;ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio ä¸ºæ­¤ç›®çš„ä½¿ç”¨è‡ªå·±çš„è‡ªç­¾å CAï¼Œä½†æœ€ä½³å®è·µæ˜¯é€šè¿‡ä¸ºæ¯ä¸ª Istio éƒ¨ç½²åˆ›å»ºä¸€ä¸ªä¸­é—´ CAï¼Œ&lt;a href=&#34;https://cloudnativecn.com/blog/istio-trust/&#34;&gt;å°† Istio é›†æˆåˆ°æ‚¨ç°æœ‰çš„ PKI ä¸­&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨æ­£åœ¨ç®¡ç†å¤šä¸ªé›†ç¾¤ï¼Œè¿™æ„å‘³ç€é¢å‘å¤šä¸ªä¸­é—´ CAï¼Œæ¯ä¸ªä¸­é—´ CA éƒ½åº”è®¾ç½®ä¸ºåœ¨å‡ ä¸ªæœˆæˆ–æ›´çŸ­çš„æ—¶é—´å†…åˆ°æœŸã€‚ç®¡ç†è¿™äº› CA çš„ç”Ÿå‘½å‘¨æœŸè‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒä»¬å¿…é¡»åœ¨è¿‡æœŸæˆ–åäº‹å‘ç”Ÿä¹‹å‰è¿›è¡Œè½®æ¢ã€‚æœ¬æ–‡å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ç®€åŒ–æ­¤ CA ç®¡ç†ä»¥&lt;strong&gt;é™ä½é£é™©&lt;/strong&gt;å¹¶&lt;strong&gt;æé«˜ç³»ç»Ÿçš„æ•´ä½“ç¨³å®šæ€§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è½®æ¢ CA æ—¶çš„ä¸€ä¸ªå…³é”®æ­¥éª¤æ˜¯ç¡®ä¿å®é™…ä½¿ç”¨æ–°çš„ CAã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio ä»…åœ¨å¯åŠ¨æ—¶åŠ è½½å…¶ CAã€‚ä½†æ˜¯ï¼ŒIstio å¯ä»¥é…ç½®ä¸ºç›‘è§†æ›´æ”¹å¹¶åœ¨æ›´æ–°æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½å…¶ CAã€‚æœ¬æ•™ç¨‹å–è‡ªæˆ‘ä»¬ä¸ç®¡ç†å¤§é‡ Istio éƒ¨ç½²çš„ä¼ä¸šå®¢æˆ·åˆä½œå¼€å‘çš„ç”Ÿäº§æ‰‹å†Œï¼Œå°†å±•ç¤ºå¦‚ä½•é…ç½® Istio ä»¥è‡ªåŠ¨é‡æ–°åŠ è½½å…¶ CAã€‚æˆ‘ä»¬è¿˜å°†ä»‹ç»å¦‚ä½•é…ç½® &lt;a href=&#34;https://cert-manager.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cert-manager&lt;/a&gt; ä»¥åœ¨ Istio çš„ä¸­é—´ CA åˆ°æœŸå‰å®šæœŸè‡ªåŠ¨è½®æ¢ï¼Œä»¥&lt;strong&gt;æé«˜åœ¨å¤šä¸ªé›†ç¾¤ä¸Šç®¡ç† CA çš„æ“ä½œæ•ˆç‡&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…ˆå†³æ¡ä»¶&#34;&gt;å…ˆå†³æ¡ä»¶&lt;/h2&gt;
&lt;p&gt;å¯¹äºæœ¬æ•™ç¨‹ï¼Œæ‚¨è‡³å°‘éœ€è¦ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ Kubernetes é›†ç¾¤ã€‚åƒ &lt;a href=&#34;https://minikube.sigs.k8s.io/docs/start/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;minikube&lt;/a&gt; æˆ–ç±»ä¼¼çš„ç®€åŒ–çš„ Kubernetes å®‰è£…é€‚ç”¨äºæ¼”ç¤ºç›®çš„ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cert-manager.io/docs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istioctl&lt;/a&gt; v1.14.2 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cert-manager.io/docs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cert-manager&lt;/a&gt; v1.7.2 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä»»åŠ¡-aå®‰è£…å’Œé…ç½®-cert-manager-ä»¥è‡ªåŠ¨è½®æ¢-istio-çš„-ca&#34;&gt;ä»»åŠ¡ Aï¼šå®‰è£…å’Œé…ç½® cert-manager ä»¥è‡ªåŠ¨è½®æ¢ Istio çš„ CA&lt;/h2&gt;
&lt;h3 id=&#34;æ­¥éª¤-a1å®‰è£…è¯ä¹¦ç®¡ç†å™¨&#34;&gt;æ­¥éª¤ A1ï¼šå®‰è£…è¯ä¹¦ç®¡ç†å™¨&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸‹å‘½ä»¤å°†åœ¨æ‚¨çš„é›†ç¾¤ä¸­å®‰è£… cert-managerã€‚è¦å®‰è£…æ›´æ–°ç‰ˆæœ¬çš„è¯ä¹¦ç®¡ç†å™¨ï¼Œè¯·æ›´æ”¹ GitHub URLã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.10.1/cert-manager.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ­¥éª¤-a2é…ç½®-ca&#34;&gt;æ­¥éª¤ A2ï¼šé…ç½® CA&lt;/h3&gt;
&lt;p&gt;å‡ºäºæ¼”ç¤ºç›®çš„ï¼Œæˆ‘ä»¬å°†è®¾ç½®ä¸€ä¸ªè‡ªç­¾å CAï¼Œä½†&lt;strong&gt;ä¸è¦åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨è‡ªç­¾å CA&lt;/strong&gt;ã€‚å‡ºäºç”Ÿäº§ç›®çš„ï¼Œæ‚¨åº”è¯¥ &lt;a href=&#34;https://tetrate.io/blog/istio-trust/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å°† cert-manager é…ç½®ä¸ºä½¿ç”¨ç°æœ‰çš„ PKI&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt; EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;---
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: cert-manager.io/v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Issuer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: selfsigned
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  selfSigned: {}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;---
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: cert-manager.io/v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Certificate
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: selfsigned-ca
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  isCA: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  duration: 21600h # 900d
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  secretName: selfsigned-ca
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  commonName: certmanager-ca
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  subject:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    organizations:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      - cert-manager
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  issuerRef:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    name: selfsigned
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    kind: Issuer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    group: cert-manager.io
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;---
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: cert-manager.io/v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: ClusterIssuer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: selfsigned-ca
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  ca:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    secretName: selfsigned-ca
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ­¥éª¤-a3ä¸º-istio-é…ç½®ä¸­é—´-ca&#34;&gt;æ­¥éª¤ A3ï¼šä¸º Istio é…ç½®ä¸­é—´ CA&lt;/h3&gt;
&lt;p&gt;è®¾ç½®ä¸­é—´ CA Istio å°†ç”¨äºç­¾ç½²å·¥ä½œè´Ÿè½½è¯ä¹¦ï¼Œè®¾ç½®ä¸ºæ¯ 60 å¤©ï¼ˆ1440 å°æ—¶ï¼‰è¯ä¹¦è½®æ¢ä¸€æ¬¡ï¼Œå¹¶åœ¨ 15 å¤©ï¼ˆ360 å°æ—¶ï¼‰åˆ°æœŸå‰æ›´æ–°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create namespace istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt; EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;---
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: cert-manager.io/v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Certificate
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: cacerts
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  secretName: cacerts
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  duration: 1440h
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  renewBefore: 360h
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  commonName: istiod.istio-system.svc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  isCA: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  usages:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - digital signature
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - key encipherment
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - cert sign
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  dnsNames:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - istiod.istio-system.svc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  issuerRef:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    name: selfsigned-ca
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    kind: ClusterIssuer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    group: cert-manager.io
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šCert-manager å°†è¯ä¹¦å’Œå¯†é’¥å…¬å¼€ä¸º &lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/secret/#secret-types&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;kubernetes.io/tls&lt;/code&gt; Secret&lt;/a&gt;ã€‚Istio å¯ä»¥ä½¿ç”¨ä» &lt;a href=&#34;https://istio.io/latest/news/releases/1.14.x/announcing-1.14.2/#changes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;1.14.2 ç‰ˆæœ¬&lt;/a&gt;å¼€å§‹çš„ &lt;code&gt;kubernetes.io/tls&lt;/code&gt; ç±»å‹çš„ Secretã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»»åŠ¡-bå®‰è£…å’Œé…ç½®-istio-ä»¥è‡ªåŠ¨æ›´æ–°å…¶-ca&#34;&gt;ä»»åŠ¡ Bï¼šå®‰è£…å’Œé…ç½® Istio ä»¥è‡ªåŠ¨æ›´æ–°å…¶ CA&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt; å®‰è£… Istioã€‚ä»¥ä¸‹ IstioOperator é…ç½®è®¾ç½®ç¯å¢ƒå˜é‡&lt;code&gt;AUTO_RELOAD_PLUGIN_CERTS=true&lt;/code&gt; ä»¥ä½¿ Istio åœ¨æ›´æ–°æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½å…¶ CAï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl operator init
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt; EOF | istioctl apply --skip-confirmation -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: install.istio.io/v1alpha1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: IstioOperator
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: demo-istio-install
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  profile: demo
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  components:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    pilot:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      k8s:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        env:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        - name: AUTO_RELOAD_PLUGIN_CERTS
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;          value: &amp;#34;true&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ä»»åŠ¡-cé…ç½®å’ŒéªŒè¯-istio-çš„ä¸­é—´-ca-è½®æ¢&#34;&gt;ä»»åŠ¡ Cï¼šé…ç½®å’ŒéªŒè¯ Istio çš„ä¸­é—´ CA è½®æ¢&lt;/h2&gt;
&lt;h3 id=&#34;æ­¥éª¤-c1é…ç½®è½®æ¢ä¸­é—´-ca&#34;&gt;æ­¥éª¤ C1ï¼šé…ç½®è½®æ¢ä¸­é—´ CA&lt;/h3&gt;
&lt;p&gt;å‡è®¾éœ€æ±‚å‘ç”Ÿäº†å˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦å°† CA è½®æ¢å‘¨æœŸä» 60 å¤©ï¼ˆ1440 å°æ—¶ï¼‰ç¼©çŸ­åˆ° 30 å¤©ï¼ˆ720 å°æ—¶ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt; EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;---
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: cert-manager.io/v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Certificate
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: cacerts
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  secretName: cacerts
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  duration: 720h 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  renewBefore: 360h
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  commonName: istiod.istio-system.svc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  isCA: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  usages:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - digital signature
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - key encipherment
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - cert sign
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  dnsNames:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - istiod.istio-system.svc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  issuerRef:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    name: selfsigned-ca
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    kind: ClusterIssuer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    group: cert-manager.io
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ­¥éª¤-c2éªŒè¯æ–°çš„ä¸­é—´-ca-æ˜¯å¦å·²é‡æ–°åŠ è½½&#34;&gt;æ­¥éª¤ C2ï¼šéªŒè¯æ–°çš„ä¸­é—´ CA æ˜¯å¦å·²é‡æ–°åŠ è½½&lt;/h3&gt;
&lt;p&gt;æŸ¥çœ‹æ—¥å¿—åº”è¯¥ä¼šæ˜¾ç¤º CA æ›´æ”¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl logs -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istiod -n istio-system -f
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‚¨åº”è¯¥åœ¨æ—¥å¿—è¾“å‡ºä¸­çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;2022-08-11T20:18:41.493247Z	info	Update Istiod cacerts
2022-08-11T20:18:41.493483Z	info	Using kubernetes.io/tls secret type for signing ca files
2022-08-11T20:18:41.716843Z	info	Istiod has detected the newly added intermediate CA and updated its key and certs accordingly
2022-08-11T20:18:41.717170Z	info	x509 cert - Issuer: &amp;#34;CN=istiod.istio-system.svc&amp;#34;, Subject: &amp;#34;&amp;#34;, SN: 1c43c1686425ee2e63f2db90bd3cf17f, NotBefore: &amp;#34;2022-08-11T20:16:41Z&amp;#34;, NotAfter: &amp;#34;2032-08-08T20:18:41Z&amp;#34;
2022-08-11T20:18:41.717220Z	info	x509 cert - Issuer: &amp;#34;CN=certmanager-ca,O=cert-manager&amp;#34;, Subject: &amp;#34;CN=istiod.istio-system.svc&amp;#34;, SN: c172b51eeb4a2891fe66f30babb42bb0, NotBefore: &amp;#34;2022-08-11T20:17:25Z&amp;#34;, NotAfter: &amp;#34;2022-08-13T20:17:25Z&amp;#34;
2022-08-11T20:18:41.717254Z	info	x509 cert - Issuer: &amp;#34;CN=certmanager-ca,O=cert-manager&amp;#34;, Subject: &amp;#34;CN=certmanager-ca,O=cert-manager&amp;#34;, SN: ea1760f2dcf9806a8c997c4bc4b2fb30, NotBefore: &amp;#34;2022-08-11T20:13:33Z&amp;#34;, NotAfter: &amp;#34;2025-01-27T20:13:33Z&amp;#34;
2022-08-11T20:18:41.717256Z	info	Istiod certificates are reloaded
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œä½¿ç”¨ cert-manager æ¥è‡ªåŠ¨åŒ– Istio CA è½®æ¢å¯ä»¥è½»æ¾é«˜æ•ˆåœ°å¤„ç†å…³é”®æ“ä½œåŠŸèƒ½ã€‚å°† Istio é…ç½®ä¸ºè‡ªåŠ¨é‡æ–°åŠ è½½å…¶ CA æ— éœ€æ‰‹åŠ¨é‡å¯ Istioï¼Œä»è€Œæ¶ˆé™¤äº†æ½œåœ¨çš„äººä¸ºé”™è¯¯æ¥æºã€‚&lt;/p&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼æ˜¯ä¸€ç§å¼ºå¤§çš„å·¥å…·ï¼Œå¯ç”¨äºå®æ–½é›¶ä¿¡ä»»å®‰å…¨å®è·µå¹¶å¤§è§„æ¨¡æé«˜ä¸šåŠ¡æ•æ·æ€§å’Œè¿ç»­æ€§ã€‚ä¸ºæœåŠ¡ç½‘æ ¼å»ºç«‹æœ‰æ•ˆçš„è¿è¥å®è·µå¯¹äºåˆ©ç”¨è¿™ç§åŠ›é‡è‡³å…³é‡è¦ã€‚ä½œä¸º Istio å’Œ Envoy çš„åˆ›å§‹äººå’Œæ ¸å¿ƒè´¡çŒ®è€…ï¼Œæˆ‘ä»¬ Tetrate æ¯å¤©éƒ½åœ¨å¸®åŠ©æˆ‘ä»¬çš„å®¢æˆ·åšåˆ°è¿™ä¸€ç‚¹ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å°† Istio çº³å…¥ä¿¡ä»»é“¾ï¼šä½¿ç”¨ç°æœ‰ PKI ä½œä¸ºä¿¡ä»»æ ¹</title>
      <link>https://cloudnativecn.com/blog/istio-trust/</link>
      <pubDate>Tue, 20 Dec 2022 11:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-trust/</guid>
      <description>&lt;p&gt;å½“æˆ‘ä»¬ä¸æƒ³è¦ä½¿ç”¨ Istio çš„å®¢æˆ·æˆ–ç”¨æˆ·äº¤æµæ—¶ï¼Œè¿™ä¸€ä¸ªé—®é¢˜æ—¶é•¿ä¼šå‡ºç°â€”â€”Istio ä¸­çš„è¯ä¹¦ä¿¡ä»»å¦‚ä½•å·¥ä½œçš„ï¼ŸIstio æœ‰è‡ªå·±çš„è¯ä¹¦é¢å‘æœºæ„ï¼Œè€Œæˆ‘ä»¬ä¹Ÿæœ‰è‡ªå·±çš„è¯ä¹¦é¢å‘æœºæ„ï¼Œå¦‚ä½•ç¡®ä¿å®ƒä»¬ç›¸äº’ä¿¡ä»»ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼Œé€šè¿‡ä¸­é—´ç­¾åè¯ä¹¦å°† Istio çº³å…¥åˆ°æ‚¨ç°æœ‰çš„ä¿¡ä»»é“¾ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨ä½¿ç”¨ Istio ä½œä¸ºæ¼”ç¤ºæˆ–å¼€ç®±å³ç”¨ï¼Œå®ƒå°†æ‹¥æœ‰è‡ªå·±çš„è‡ªç­¾åè¯ä¹¦ â€”â€” å®ƒæ˜¯è‡ªå·±çš„æ ¹è¯ä¹¦ã€‚å¯¹äºåœ¨å¤šä¸ªé›†ç¾¤ä¸­è¿è¡Œ Istio çš„ç”¨æˆ·æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„ç—›ç‚¹ï¼šä»–ä»¬æ— æ„ä¸­åˆ›å»ºäº†ä¸¤ä¸ªäº’ä¸ä¸ä¿¡ä»»çš„å­¤å²›ï¼Œå› æ­¤æ²¡æœ‰å®‰å…¨é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯å¦‚ä½•é€šè¿‡è®© Istio ä¿¡ä»»æ‚¨ç°æœ‰çš„ PKI çš„æ­¥éª¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç®€è¿°&#34;&gt;ç®€è¿°&lt;/h2&gt;
&lt;p&gt;è¿™æ˜¯ç®€çŸ­çš„ç‰ˆæœ¬ï¼šæ‚¨åº”è¯¥é€šè¿‡ä¸ºæ¯ä¸ª Istio éƒ¨ç½²åˆ›å»ºä¸€ä¸ªä¸­é—´ç­¾åè¯ä¹¦æ¥è®© Istio ä¿¡ä»»æ‚¨ç°æœ‰çš„ PKIï¼ˆå¹¶ä¸”æ¯ä¸ªé›†ç¾¤åº”è¯¥æœ‰ä¸€ä¸ª Istio éƒ¨ç½²ï¼‰ã€‚ç„¶åä½ ä¼šï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯ç”¨è·¨ Istio éƒ¨ç½²çš„é€šä¿¡&lt;/li&gt;
&lt;li&gt;å…è®¸ç»†ç²’åº¦çš„è¯ä¹¦æ’¤é”€ï¼Œè€Œæ— éœ€åŒæ—¶åœ¨æ•´ä¸ªåŸºç¡€æ¶æ„ä¸­å¼ºåˆ¶ä½¿ç”¨æ–°è¯ä¹¦ï¼ˆå¦‚æœè¿™å¬èµ·æ¥åƒæ˜¯ç­‰å¾…å‘ç”Ÿçš„é‡å¤§ä¸­æ–­ï¼Œé‚£ä¹ˆæ‚¨æ˜¯å¯¹çš„ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¯ç”¨ç­¾åè¯ä¹¦çš„è½»æ¾è½®æ¢ã€‚æ‚¨éœ€è¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸­é—´ä»¶å¹¶ä½¿ç”¨æ–°è¯ä¹¦é‡æ–°å¯åŠ¨ Istioã€‚å› ä¸ºå®ƒåœ¨åŒä¸€ä¸ªä¿¡ä»»æ ¹ä¸­ï¼Œæ‰€ä»¥ä¸€åˆ‡éƒ½ç»§ç»­å·¥ä½œã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Istio å¿…é¡»é€‚åº”æ‚¨ç°æœ‰çš„æ¶æ„ï¼Œä»¥åœ¨ç»„ç»‡å†…å®ç°å¢é‡é‡‡ç”¨ â€”â€” ä½¿ç½‘æ ¼é€‚åº”æ‚¨çš„ç»„ç»‡ï¼Œè€Œä¸æ˜¯è®©ç»„ç»‡æ¥é€‚åº”ç½‘æ ¼ã€‚ä»äº†è§£å¯¹ä¸­é—´è¯ä¹¦ç­¾åå¯†é’¥çš„éœ€æ±‚å¼€å§‹ï¼Œå°†ä¸ºæ‚¨çš„æˆåŠŸåšå¥½å‡†å¤‡ï¼Œå¹¶ä½¿ä»»ä½•åŸºç¡€æ¶æ„æˆ–ç¯å¢ƒæ›´æ”¹æ›´åŠ é¡ºåˆ©ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¯¦è¿°&#34;&gt;è¯¦è¿°&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹è¯ä¹¦éªŒè¯çš„è¿‡ç¨‹ã€‚åœ¨åŸºæœ¬è¯ä¹¦ä¸­ï¼Œè¯ä¹¦æ£€æŸ¥ä»ä¿¡ä»»æ ¹å¼€å§‹ï¼Œå‘ä¸‹å»¶ä¼¸åˆ°ç‰¹å®šèº«ä»½ï¼ˆå¶å­ï¼‰ã€‚è¯ä¹¦è·¯å¾„éªŒè¯ç®—æ³•æ˜¯æˆ‘ä»¬ç¡®ä¿è¯ä¹¦å¯ä¿¡çš„æ–¹å¼ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ TLS ç­‰å®‰å…¨åè®®è¿æ¥åˆ°å¦ä¸€å°æœºå™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå‘æˆ‘ä»¬æä¾›éƒ¨åˆ†æˆ–å…¨éƒ¨è¯ä¹¦é“¾ä»¥è¯æ˜å…¶èº«ä»½ã€‚å¦‚æœé“¾ä¸­çš„è¯ä¹¦è¢«ç¡®å®šä¸ºæ— æ•ˆï¼Œåˆ™è¯ä¹¦é“¾å°†è¢«æ‹’ç»ä¸”ä¸ä¼šå»ºç«‹ä¿¡ä»»ã€‚å¦‚æœæˆ‘ä»¬é¡ºåˆ©åˆ°è¾¾é“¾çš„æœ«ç«¯ï¼Œåˆ™è·¯å¾„ï¼ˆä»¥åŠè¯ä¹¦ï¼‰æ˜¯æœ‰æ•ˆçš„ã€‚æˆåŠŸï¼æˆ‘ä»¬å¯ä»¥ä¿¡ä»»æœåŠ¡å™¨ï¼&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å¸¦æœ‰å¶è¯ä¹¦ä¸­é—´è¯ä¹¦å’Œæ ¹è¯ä¹¦çš„è¯ä¹¦é“¾æœåŠ¡å™¨å¯ä»¥é€‰æ‹©å‘é€æ•´ä¸ªé“¾æˆ–è€…åªå‘é€ä¸€éƒ¨åˆ†åªè¦æœ‰è¶³å¤Ÿçš„é“¾ä»æ ¹åˆ°å¶æˆ‘ä»¬å°±å¯ä»¥éªŒè¯è¯ä¹¦&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å¸¦æœ‰å¶è¯ä¹¦ã€ä¸­é—´è¯ä¹¦å’Œæ ¹è¯ä¹¦çš„è¯ä¹¦é“¾ã€‚æœåŠ¡å™¨å¯ä»¥é€‰æ‹©å‘é€æ•´ä¸ªé“¾ï¼Œæˆ–è€…åªå‘é€ä¸€éƒ¨åˆ†ï¼›åªè¦æœ‰è¶³å¤Ÿçš„é“¾ä»æ ¹åˆ°å¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥éªŒè¯è¯ä¹¦ã€‚&#34; srcset=&#34;
               /blog/istio-trust/f1_hu_76ba800b3b7abe89.webp 400w,
               /blog/istio-trust/f1_hu_61285c5606424e53.webp 760w,
               /blog/istio-trust/f1_hu_fa20178500ca8c74.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-trust/f1_hu_76ba800b3b7abe89.webp&#34;
               width=&#34;760&#34;
               height=&#34;428&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å¸¦æœ‰å¶è¯ä¹¦ã€ä¸­é—´è¯ä¹¦å’Œæ ¹è¯ä¹¦çš„è¯ä¹¦é“¾ã€‚æœåŠ¡å™¨å¯ä»¥é€‰æ‹©å‘é€æ•´ä¸ªé“¾ï¼Œæˆ–è€…åªå‘é€ä¸€éƒ¨åˆ†ï¼›åªè¦æœ‰è¶³å¤Ÿçš„é“¾ä»æ ¹åˆ°å¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥éªŒè¯è¯ä¹¦ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“ TLS æ¡æ‰‹æ—¶ï¼Œè·¯å¾„éªŒè¯ç®—æ³•ä¸å…³å¿ƒæœ‰å¤šå°‘è¯ä¹¦é“¾é©»ç•™åœ¨æˆ‘ä»¬çš„ä¿¡ä»»åŒ…ä¸­ã€‚åŸºäºæˆ‘ä»¬å¸¦æ¥çš„å’Œä»–ä»¬æä¾›çš„è¯ä¹¦ï¼Œå®ƒåªå…³å¿ƒæˆ‘ä»¬èƒ½å¦æ„å»ºä¸€æ¡ä»æœåŠ¡å™¨çš„å¶èŠ‚ç‚¹åˆ°æˆ‘ä»¬çš„æ†ç»‘åŒ…ä¸­çš„ä¿¡ä»»æ ¹çš„é“¾ã€‚ä¸Šé¢çš„ç¤ºä¾‹æ˜¾ç¤ºéªŒè¯å‘ç”Ÿåœ¨è¯ä¹¦äº¤æ¢ä¸­ï¼Œè¿™è¶³ä»¥è®©å¶å­åœ¨è¯ä¹¦é¢å‘æœºæ„ä¸­æ‰¾åˆ°å®ƒçš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ‚¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œ Istio æ—¶ï¼Œæ‚¨å°†æ‹¥æœ‰å¤šä¸ªå¶èŠ‚ç‚¹å’Œä¸­é—´èŠ‚ç‚¹ï¼Œä½†&lt;strong&gt;åªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å…·æœ‰æ ¹ä¸‰ä¸ªä¸­é—´ç­¾å-ca-å’Œå››ä¸ªå¶è¯ä¹¦ç”±æ ‘ä¸­çš„å„ç§ä¸­é—´ä½“é¢å‘çš„-pki-è¯ä¹¦æ ‘&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å…·æœ‰æ ¹ã€ä¸‰ä¸ªä¸­é—´ç­¾å CA å’Œå››ä¸ªå¶è¯ä¹¦ï¼ˆç”±æ ‘ä¸­çš„å„ç§ä¸­é—´ä½“é¢å‘ï¼‰çš„ PKI è¯ä¹¦æ ‘ã€‚&#34; srcset=&#34;
               /blog/istio-trust/f2_hu_7b6200b842bab9b2.webp 400w,
               /blog/istio-trust/f2_hu_523aad415f3af3c7.webp 760w,
               /blog/istio-trust/f2_hu_47c6d83dd044a089.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-trust/f2_hu_7b6200b842bab9b2.webp&#34;
               width=&#34;760&#34;
               height=&#34;428&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å…·æœ‰æ ¹ã€ä¸‰ä¸ªä¸­é—´ç­¾å CA å’Œå››ä¸ªå¶è¯ä¹¦ï¼ˆç”±æ ‘ä¸­çš„å„ç§ä¸­é—´ä½“é¢å‘ï¼‰çš„ PKI è¯ä¹¦æ ‘ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦åœ¨ç°æœ‰ PKI ä¸­å»ºç«‹ä¿¡ä»»ï¼Œå› ä¸ºæœ‰ä»¥ä¸‹ä¸‰ä¸ªä¸»è¦å¥½å¤„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯ä»¥åœ¨ Istio éƒ¨ç½²ä¹‹é—´çš„äº¤å‰é€šä¿¡&lt;/li&gt;
&lt;li&gt;ç»†ç²’åº¦è¯ä¹¦æ’¤é”€&lt;/li&gt;
&lt;li&gt;è½»æ¾è½®æ¢è¯ä¹¦&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;è·¨-istio-éƒ¨ç½²çš„é€šä¿¡&#34;&gt;è·¨ Istio éƒ¨ç½²çš„é€šä¿¡&lt;/h3&gt;
&lt;p&gt;å¯¹äº Istioï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ç¡®ä¿è·¨éƒ¨ç½²çš„é€šä¿¡ â€”â€” ç®€å•çš„æ–¹æ³•å’Œå›°éš¾çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å›°éš¾çš„æ–¹æ³•æ¶‰åŠ Istio è¿ç»´äººå‘˜é‡‡å–è€—æ—¶ã€å¤æ‚ä¸”æ˜‚è´µçš„æ­¥éª¤æ¥ç¡®ä¿ä¸¤ä¸ªæ ¹åŒæ—¶åœ¨å¦ä¸€ä¸ªçš„è¯ä¹¦é¢å‘æœºæ„ (CA) æ†ç»‘åŒ…ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¡®ä¿æ‰€æœ‰å‚ä¸æ–¹çš„æ ¹éƒ½åœ¨-ca-æ†ç»‘åŒ…ä¸­æ¥ç¡®ä¿è·¨ä¸åŒæ ¹çš„ä¿¡ä»»å¦‚æœå®ƒä»¬ä¸æ˜¯å½¼æ­¤ä¿¡ä»»åŒ…çš„ä¸€éƒ¨åˆ†åˆ™æ¥è‡ªæ¯ä¸ª-citadel-çš„è¯ä¹¦ä¸èƒ½ç”¨äºè·¨é›†ç¾¤é€šä¿¡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¡®ä¿æ‰€æœ‰å‚ä¸æ–¹çš„æ ¹éƒ½åœ¨ CA æ†ç»‘åŒ…ä¸­æ¥ç¡®ä¿è·¨ä¸åŒæ ¹çš„ä¿¡ä»»ã€‚å¦‚æœå®ƒä»¬ä¸æ˜¯å½¼æ­¤ä¿¡ä»»åŒ…çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™æ¥è‡ªæ¯ä¸ª Citadel çš„è¯ä¹¦ä¸èƒ½ç”¨äºè·¨é›†ç¾¤é€šä¿¡ã€‚&#34; srcset=&#34;
               /blog/istio-trust/f3_hu_812c8558594e27a3.webp 400w,
               /blog/istio-trust/f3_hu_83248183d4f3f646.webp 760w,
               /blog/istio-trust/f3_hu_53af840a9c6e8f7c.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-trust/f3_hu_812c8558594e27a3.webp&#34;
               width=&#34;760&#34;
               height=&#34;428&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¡®ä¿æ‰€æœ‰å‚ä¸æ–¹çš„æ ¹éƒ½åœ¨ CA æ†ç»‘åŒ…ä¸­æ¥ç¡®ä¿è·¨ä¸åŒæ ¹çš„ä¿¡ä»»ã€‚å¦‚æœå®ƒä»¬ä¸æ˜¯å½¼æ­¤ä¿¡ä»»åŒ…çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™æ¥è‡ªæ¯ä¸ª Citadel çš„è¯ä¹¦ä¸èƒ½ç”¨äºè·¨é›†ç¾¤é€šä¿¡ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç®€å•çš„æ–¹æ³•æ˜¯ä¸ºæ¯ä¸ªéƒ¨ç½²ä½¿ç”¨å•ç‹¬çš„ä¸­é—´ç­¾åè¯ä¹¦éƒ¨ç½² Istioï¼Œæ‰€æœ‰è¿™äº›è¯ä¹¦éƒ½å…±äº«ç›¸åŒçš„æ ¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å½“-citadel-ä½¿ç”¨æ¥è‡ªåŒä¸€æ ¹-pki-çš„ä¸­é—´è¯ä¹¦æ—¶æœ€å®¹æ˜“ä¿ƒè¿›è·¨é›†ç¾¤é€šä¿¡æˆ‘ä»¬çœ‹åˆ°ä¸ä¸Šé¢ç›¸åŒçš„-pki-æ ‘ä½†ä¸­é—´-ca-è¢«æ ‡è®°ä¸ºä¸åŒé›†ç¾¤ä¸­çš„-citadel-å®ä¾‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å½“ Citadel ä½¿ç”¨æ¥è‡ªåŒä¸€æ ¹ PKI çš„ä¸­é—´è¯ä¹¦æ—¶ï¼Œæœ€å®¹æ˜“ä¿ƒè¿›è·¨é›†ç¾¤é€šä¿¡ã€‚æˆ‘ä»¬çœ‹åˆ°ä¸ä¸Šé¢ç›¸åŒçš„ PKI æ ‘ï¼Œä½†ä¸­é—´ CA è¢«æ ‡è®°ä¸ºä¸åŒé›†ç¾¤ä¸­çš„ Citadel å®ä¾‹ã€‚&#34; srcset=&#34;
               /blog/istio-trust/f4_hu_d4874e6a239b05e9.webp 400w,
               /blog/istio-trust/f4_hu_3cc0082b2cfdfa03.webp 760w,
               /blog/istio-trust/f4_hu_3eece1cd5f00ea3b.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-trust/f4_hu_d4874e6a239b05e9.webp&#34;
               width=&#34;760&#34;
               height=&#34;428&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å½“ Citadel ä½¿ç”¨æ¥è‡ªåŒä¸€æ ¹ PKI çš„ä¸­é—´è¯ä¹¦æ—¶ï¼Œæœ€å®¹æ˜“ä¿ƒè¿›è·¨é›†ç¾¤é€šä¿¡ã€‚æˆ‘ä»¬çœ‹åˆ°ä¸ä¸Šé¢ç›¸åŒçš„ PKI æ ‘ï¼Œä½†ä¸­é—´ CA è¢«æ ‡è®°ä¸ºä¸åŒé›†ç¾¤ä¸­çš„ Citadel å®ä¾‹ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“æ¶‰åŠåˆ°ç»†ç²’åº¦æ’¤é”€å’Œè¯ä¹¦è½®æ¢æ—¶ï¼Œè¿™ä¸€å†³å®šçš„è¿é”ååº”æ˜¯å·¨å¤§çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç»†ç²’åº¦è¯ä¹¦æ’¤é”€&#34;&gt;ç»†ç²’åº¦è¯ä¹¦æ’¤é”€&lt;/h3&gt;
&lt;p&gt;æ’¤é”€è¯ä¹¦ä¼šå°†è¯ä¹¦æ ‡è®°ä¸ºä¸å†å—ä¿¡ä»»ã€‚å½“è¯ä¹¦è·¯å¾„éªŒè¯ç®—æ³•ä»å¶èŠ‚ç‚¹èµ°åˆ°æ ¹èŠ‚ç‚¹æ—¶ï¼Œä¼šå¯¹æ¯ä¸ªè¯ä¹¦è¿›è¡ŒåŠé”€çŠ¶æ€æ£€æŸ¥ã€‚è¿™ä½¿æ‚¨èƒ½å¤Ÿæ’¤é”€å¯¹å•ä¸ªç»„ä»¶æˆ–æ•´ä¸ªéƒ¨ç½²éƒ¨åˆ†çš„ä¿¡ä»»ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ä½¿ç”¨ä¸ä¹‹å‰ç›¸åŒçš„-pki-æ ‘æˆ‘ä»¬å±•ç¤ºäº†åœ¨æ ‘çš„ä¸€éƒ¨åˆ†ä¸­æ’¤é”€ä¸­é—´-ca-å¦‚ä½•ä½¿è¯¥ä¸­é—´è¯ä¹¦ä»¥åŠç”±å®ƒåˆ›å»ºçš„å¶è¯ä¹¦æ— æ•ˆ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;ä½¿ç”¨ä¸ä¹‹å‰ç›¸åŒçš„ PKI æ ‘ï¼Œæˆ‘ä»¬å±•ç¤ºäº†åœ¨æ ‘çš„ä¸€éƒ¨åˆ†ä¸­æ’¤é”€ä¸­é—´ CA å¦‚ä½•ä½¿è¯¥ä¸­é—´è¯ä¹¦ä»¥åŠç”±å®ƒåˆ›å»ºçš„å¶è¯ä¹¦æ— æ•ˆã€‚&#34; srcset=&#34;
               /blog/istio-trust/f5_hu_da7face960cb5bf8.webp 400w,
               /blog/istio-trust/f5_hu_5b12c7f7bb892ba7.webp 760w,
               /blog/istio-trust/f5_hu_b2fc82d9e7222a2c.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-trust/f5_hu_da7face960cb5bf8.webp&#34;
               width=&#34;760&#34;
               height=&#34;428&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      ä½¿ç”¨ä¸ä¹‹å‰ç›¸åŒçš„ PKI æ ‘ï¼Œæˆ‘ä»¬å±•ç¤ºäº†åœ¨æ ‘çš„ä¸€éƒ¨åˆ†ä¸­æ’¤é”€ä¸­é—´ CA å¦‚ä½•ä½¿è¯¥ä¸­é—´è¯ä¹¦ä»¥åŠç”±å®ƒåˆ›å»ºçš„å¶è¯ä¹¦æ— æ•ˆã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™å¾ˆé‡è¦ï¼Œå› ä¸ºå¦‚æœç­¾åå¯†é’¥è¢«æ³„éœ²ï¼Œæ¶æ„è¡Œä¸ºè€…å¯èƒ½ä¼šé€šè¿‡å‡ºç¤ºæ‚¨çš„å®¢æˆ·è®¤ä¸ºæ˜¯æœ‰æ•ˆè¯ä¹¦æ¥å†’å……æ‚¨çš„æœåŠ¡å™¨ã€‚è¿™åœ¨ Istio ä¸­æ›´ä¸ºé‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨è¯ä¹¦æ¥è¯†åˆ«å½¼æ­¤çš„å·¥ä½œè´Ÿè½½ â€”â€” æ”»å‡»è€…å¯ä»¥ä¼ªè£…æˆæ‚¨ç½‘æ ¼ä¸­çš„ä»»ä½•æœåŠ¡ï¼&lt;/p&gt;
&lt;p&gt;é€šå¸¸ï¼Œå¤„ç†æ’¤é”€æ˜¯ç®¡ç†ä»»ä½• PKI ä¸­æœ€å›°éš¾çš„éƒ¨åˆ†ã€‚Istio å¸®åŠ©é™ä½è¿™ç§é£é™©çš„æ–¹æ³•ä¹‹ä¸€æ˜¯é¢å‘éå¸¸çŸ­æš‚çš„è¯ä¹¦ã€‚å…¸å‹çš„åŠé”€åˆ—è¡¨æœ€å¤šå¯èƒ½éœ€è¦ 24 å°æ—¶æ‰èƒ½åœ¨æ•´ä¸ªç»„ç»‡ä¸­ä¼ æ’­ã€‚Istio é¢å‘çš„è¯ä¹¦æœ‰æ•ˆæœŸå°‘äº 12 å°æ—¶ï¼Œå› æ­¤å‡ ä¹ä¸éœ€è¦æ’¤é”€ Istio é¢å‘çš„èº«ä»½è¯ä¹¦ã€‚æ‚¨åªéœ€è¦æ‹…å¿ƒä¸ºæ¯ä¸ª Istio éƒ¨ç½²åˆ›å»ºçš„ç­¾åè¯ä¹¦ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è½»æ¾è½®æ¢è¯ä¹¦&#34;&gt;è½»æ¾è½®æ¢è¯ä¹¦&lt;/h3&gt;
&lt;p&gt;ä¸åŠé”€ä¸€æ ·ï¼Œä¸­é—´è¯ä¹¦çš„è½®æ¢æ›´å®¹æ˜“ã€‚ä¼˜ç‚¹åŒ…æ‹¬ï¼Œå¦‚æœæ‚¨èƒ½å¤ŸæŒ‰é›†ç¾¤è½®æ¢è¯ä¹¦è€Œä¸æ˜¯åœ¨æ ¹èŠ‚ç‚¹è½®æ¢è¯ä¹¦ï¼Œæ‚¨å°†ä½“éªŒåˆ°æ›´å°‘çš„åœæœºæ—¶é—´ï¼ˆä»¥åŠç›¸å…³çš„å¤æ‚æ€§ï¼Œå³åœ¨ä»»ä½•åœ°æ–¹å‘å¸ƒä¸€ä¸ªå¸¦æœ‰æ–°æ ¹çš„æ›´æ–°çš„ CA åŒ…ï¼‰ã€‚è€Œä¸”ï¼Œå°±åƒä»»ä½•å¥½çš„ PKI ä¸€æ ·ï¼Œè¿™å¯ä»¥è®©æ‚¨ä½¿æ ¹ç¦»çº¿å¹¶å®‰å…¨åœ°å­˜å‚¨èµ·æ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ç”¨ç®€å•çš„æ–¹æ³•æ¥åšï¼å°† Istio å¼•å…¥æ‚¨ç°æœ‰çš„ä¿¡ä»»æ ¹ä¸­ï¼Œä»¥é¿å…ç—›è‹¦å’Œå¿ƒç—›ã€‚ä¸­é—´ç­¾åè¯ä¹¦çš„å­˜åœ¨æ˜¯ä¸ºäº†è®©é‡‡ç”¨ Istio æ›´å®¹æ˜“ã€æ›´å®‰å…¨ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å¦‚ä½•ä½¿ç”¨ Hashicorp Vault ä½œä¸ºä¸€ç§æ›´å®‰å…¨çš„æ–¹å¼æ¥å­˜å‚¨ Istio è¯ä¹¦</title>
      <link>https://cloudnativecn.com/blog/how-to-use-hashicorp-vault-as-a-more-secure-way-to-store-istio-certificates/</link>
      <pubDate>Mon, 19 Dec 2022 13:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/how-to-use-hashicorp-vault-as-a-more-secure-way-to-store-istio-certificates/</guid>
      <description>&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•ä½¿ç”¨ Hashicorp Vault ä½œä¸ºä¸€ç§æ¯”ä½¿ç”¨ Kubernetes &lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/secret&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Secret&lt;/a&gt; æ›´å®‰å…¨çš„æ–¹å¼æ¥å­˜å‚¨ Istio è¯ä¹¦ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSecret ä½¿ç”¨ base64 ç¼–ç å­˜å‚¨åœ¨ &lt;em&gt;etcd&lt;/em&gt; ä¸­ã€‚åœ¨å®‰å…¨ç­–ç•¥ä¸¥æ ¼çš„ç¯å¢ƒä¸­ï¼Œè¿™å¯èƒ½æ˜¯ä¸å¯æ¥å—çš„ï¼Œå› æ­¤éœ€è¦é¢å¤–çš„æªæ–½æ¥ä¿æŠ¤å®ƒä»¬ã€‚ä¸€ç§æ­¤ç±»è§£å†³æ–¹æ¡ˆæ¶‰åŠå°†æœºå¯†å­˜å‚¨åœ¨å¤–éƒ¨æœºå¯†å­˜å‚¨æä¾›ç¨‹åºä¸­ï¼Œä¾‹å¦‚ &lt;a href=&#34;https://www.vaultproject.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HashiCorp Vault&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Vault å¯ä»¥æ‰˜ç®¡åœ¨ Kubernetes é›†ç¾¤å†…éƒ¨å’Œå¤–éƒ¨ã€‚åœ¨æœ¬æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢ä½¿ç”¨æ‰˜ç®¡åœ¨ Kubernetes å¤–éƒ¨çš„ Vaultï¼Œä»¥ä¾¿å®ƒå¯ä»¥åŒæ—¶ä¸ºå¤šä¸ªé›†ç¾¤æä¾›ç§˜å¯†ã€‚è¯¥è®¾ç½®ä¹Ÿéå¸¸é€‚åˆæ¢ç´¢ Istio çš„&lt;a href=&#34;https://istio.io/latest/docs/setup/install/multicluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤šé›†ç¾¤åŠŸèƒ½&lt;/a&gt;ï¼Œå®ƒéœ€è¦ä¸€ä¸ªå…±äº«çš„ä¿¡ä»»åŸŸã€‚&lt;/p&gt;
&lt;p&gt;åˆ©ç”¨ &lt;code&gt;vault-agent-init&lt;/code&gt; å®¹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯ä¹¦å’Œç§é’¥ææ–™æ³¨å…¥å®é™…çš„ Istio æ§åˆ¶å¹³é¢ Podï¼Œä»¥ä¾¿å®ƒä»¬ä½¿ç”¨å¤–éƒ¨ CA è¯ä¹¦è¿›è¡Œå¼•å¯¼ã€‚è¿™é¿å…äº†ä¾èµ– Secret æ¥å¼•å¯¼ Istio æ§åˆ¶å¹³é¢ã€‚è¯¥æŠ€æœ¯ä¹Ÿå®Œå…¨é€‚ç”¨äºå…¥å£å’Œå‡ºå£è¯ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å…³å¦‚ä½•åœ¨ Istio ä¸­ä½¿ç”¨å’Œç®¡ç†è¯ä¹¦çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§å®˜æ–¹æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/zh/docs/concepts/security/#pki&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;èº«ä»½å’Œè¯ä¹¦ç®¡ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/zh/docs/tasks/security/cert-management/plugin-ca-cert&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ’å…¥ CA è¯ä¹¦&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/zh/docs/tasks/security/cert-management/custom-ca-k8s&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ Kubernetes CSR çš„è‡ªå®šä¹‰ CA é›†æˆ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰å…³åŸºäºå®é™…ç”Ÿäº§ç»éªŒçš„æœ€ä½³å®è·µï¼Œå¦è¯·æŸ¥çœ‹ä»¥ä¸‹ &lt;a href=&#34;https://tetrate.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate&lt;/a&gt; çš„åšå®¢æ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://cloudnativecn.com/blog/istio-trust/&#34;&gt;åœ¨ Istio ä¸­æ„å»ºè¯ä¹¦ä¿¡ä»»é“¾ï¼šå°†ç°æœ‰ PKI ä½œä¸ºä¿¡ä»»æ ¹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloudnativecn.com/blog/automate-istio-ca-rotation-in-production-at-scale&#34;&gt;åœ¨ç”Ÿäº§ä¸­å¤§è§„æ¨¡è‡ªåŠ¨åŒ– Istio CA è½®æ¢&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ç¯‡åšæ–‡é™„å¸¦çš„ä»£ç å¯ä»¥åœ¨ä»¥ä¸‹å­˜å‚¨åº“ä¸­æ‰¾åˆ°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/tetratelabs/istio-vault-ext-certs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/tetratelabs/istio-vault-ext-certs&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;istiod-è¯ä¹¦å¤„ç†&#34;&gt;&lt;strong&gt;Istiod è¯ä¹¦å¤„ç†&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;å°½ç®¡ä¸Šè¿°åšæ–‡ä¸­è§£é‡Šäº†ä¸€äº›å†³ç­–é€»è¾‘ï¼Œä½†ä¹Ÿå€¼å¾—å‚è€ƒ&lt;a href=&#34;https://github.com/istio/istio/blob/master/pilot/pkg/bootstrap/istio_ca.go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æºä»£ç &lt;/a&gt;ä»¥æŸ¥æ‰¾ä¸€äº›æœªè®°å½•çš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio çš„æºç  &lt;code&gt;istio/pilot/pkg/bootstrap/istio_ca.go&lt;/code&gt; æ–‡ä»¶ä¸­ï¼Œä½ å°†çœ‹åˆ°ï¼šä¸ºäº†å‘åå…¼å®¹ï¼ŒIstio ä¿ç•™äº†å¯¹ç”¨äºè‡ªç­¾åè¯ä¹¦ &lt;code&gt;cacerts&lt;/code&gt; Secret çš„æ”¯æŒã€‚å®ƒå®‰è£…åœ¨ç›¸åŒçš„ä½ç½®ï¼Œå¦‚æœå‘ç°äº†å°±ä¼šè¢«ä½¿ç”¨â€”â€”åˆ›å»ºç§˜å¯†å°±è¶³å¤Ÿäº†ï¼Œä¸éœ€è¦é¢å¤–çš„é€‰é¡¹ã€‚åœ¨æ—§å®‰è£…ç¨‹åºä¸­ï¼Œ&lt;code&gt;LocalCertDir&lt;/code&gt; è¢«ç¡¬ç¼–ç åˆ° &lt;code&gt;/etc/cacerts&lt;/code&gt; å¹¶ä½¿ç”¨ &lt;code&gt;cacerts&lt;/code&gt;  Secret å®‰è£…ã€‚å·²åˆ é™¤å¯¹ç­¾ç½²å…¶ä»–æ ¹ CA çš„æ”¯æŒâ€”â€”å¤ªå±é™©ï¼Œæ²¡æœ‰æ˜ç¡®çš„ç”¨ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤é…ç½®ï¼Œç”¨äºå‘åå…¼å®¹ Citadelï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœ &lt;code&gt;istio-system&lt;/code&gt; ä¸­å­˜åœ¨ &lt;code&gt;cacerts&lt;/code&gt; ç§˜å¯†ï¼Œå°†è¢«æŒ‚è½½ã€‚å®ƒå¯èƒ½åŒ…å«ä¸€ä¸ªå¯é€‰çš„ &lt;code&gt;root-cert.pem&lt;/code&gt;ï¼Œ
å¸¦æœ‰é¢å¤–çš„æ ¹å’Œå¯é€‰çš„ &lt;code&gt;{ca-key, ca-cert, cert-chain}.pem&lt;/code&gt; ç”±ç”¨æˆ·æä¾›çš„æ ¹ CAã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæœªæ‰¾åˆ°ç”¨æˆ·æä¾›çš„æ ¹ CAï¼Œåˆ™ä½¿ç”¨ &lt;code&gt;istio-ca-secret&lt;/code&gt; Secretï¼Œä»¥åŠ &lt;code&gt;ca-cert.pem&lt;/code&gt; å’Œ &lt;code&gt;ca-key.pem&lt;/code&gt; æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸¤è€…å‡æœªæ‰¾åˆ°ï¼Œå°†åˆ›å»º &lt;code&gt;istio-ca-secret&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¸¦æœ‰ &lt;code&gt;caTLSRootCert&lt;/code&gt; æ–‡ä»¶çš„ &lt;code&gt;istio-security&lt;/code&gt; ConfigMap å°†ç”¨äºæ ¹è¯ä¹¦ï¼Œå¹¶åœ¨éœ€è¦æ—¶åˆ›å»ºã€‚è¯¥ ConfigMap ç”±èŠ‚ç‚¹ä»£ç†ä½¿ç”¨ï¼Œä¸å†å¯èƒ½åœ¨ sds-agent ä¸­ä½¿ç”¨ï¼Œä½†æˆ‘ä»¬ä»ä¿ç•™å®ƒä»¥å‘åå…¼å®¹ã€‚å°†ä¸ node-agent ä¸€èµ·åˆ é™¤ã€‚sds-agent ä½¿ç”¨ K8S root ç›´æ¥è°ƒç”¨ &lt;code&gt;NewCitadelClient&lt;/code&gt; ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†æŒ‡ç¤º Istio ä»å…¶ä»–åœ°æ–¹è·å–è¯ä¹¦ï¼Œè€Œä¸æ˜¯æ ‡å‡† Kubernetes Secretï¼Œæˆ‘ä»¬å°†åˆ©ç”¨ &lt;em&gt;istio-pilot&lt;/em&gt;ï¼ˆåˆå istiod æˆ– Istio æ§åˆ¶å¹³é¢ï¼‰çš„ç¯å¢ƒå˜é‡ï¼ˆ&lt;a href=&#34;https://istio.io/latest/docs/reference/commands/pilot-discovery&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è§æ­¤æ–‡æ¡£&lt;/a&gt;ï¼‰ï¼Œä» Kubernetes Pod ä¸­çš„å¦ä¸€ä¸ªä½ç½®è·å–è¯ä¹¦ã€‚è¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸º &lt;code&gt;vault-agent-init&lt;/code&gt; æ³¨å…¥å®¹å™¨å°†åˆ›å»ºä¸€ä¸ªæ–°çš„æŒ‚è½½å· &lt;code&gt;/vault/secrets&lt;/code&gt; ï¼Œä»¥æ”¾ç½®ä»å¤–éƒ¨ Vault æœåŠ¡å™¨æ‹‰å‡ºçš„è¯ä¹¦å’Œç§é’¥ã€‚&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;å˜é‡åç§°&lt;/th&gt;
          &lt;th&gt;ç±»å‹&lt;/th&gt;
          &lt;th&gt;é»˜è®¤å€¼&lt;/th&gt;
          &lt;th&gt;æè¿°&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ROOT_CA_DIR&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;/etc/cacerts&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;æœ¬åœ°æˆ–å®‰è£…çš„ CA æ ¹ç›®å½•çš„ä½ç½®&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;pod-å†…çš„-vault-agent-init-å®¹å™¨æ³¨è§£&#34;&gt;Pod å†…çš„ &lt;code&gt;vault-agent-init&lt;/code&gt; å®¹å™¨æ³¨è§£&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å°†åˆ©ç”¨ Vault æ³¨å…¥å™¨æ³¨è§£æ¥æŒ‡ç¤º Sidecar æå–å“ªäº›æ•°æ®ä»¥åŠåœ¨è¿™æ ·åšæ—¶ä½¿ç”¨ä»€ä¹ˆ Vault è§’è‰²ã€‚æˆ‘ä»¬è¿˜ç¡®ä¿å®¹å™¨åœ¨æˆ‘ä»¬å®é™…çš„ä¸»å®¹å™¨ä¹‹å‰è¿è¡Œï¼Œå› æ­¤åè€…å¯ä»¥è·å–è¯ä¹¦å’Œå¯†é’¥ææ–™ä»¥æ­£ç¡®å¼•å¯¼è‡ªèº«ã€‚&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/platform/k8s/injector/annotations&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt;åˆ—ä¸¾å¹¶è®°å½•äº† Vault æ³¨è§£ã€‚æˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨çš„ç›¸å…³æ³¨é‡Šå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;strong&gt;æ³¨è§£&lt;/strong&gt;&lt;/th&gt;
          &lt;th&gt;&lt;strong&gt;é»˜è®¤å€¼&lt;/strong&gt;&lt;/th&gt;
          &lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;vault.hashicorp.com/agent-inject&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;false&lt;/td&gt;
          &lt;td&gt;é…ç½®æ˜¯å¦ä¸º Pod æ˜¾å¼å¯ç”¨æˆ–ç¦ç”¨æ³¨å…¥ã€‚è¿™åº”è¯¥è®¾ç½®ä¸º true æˆ– falseã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;vault.hashicorp.com/agent-init-first&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;false&lt;/td&gt;
          &lt;td&gt;å¦‚æœä¸º trueï¼Œåˆ™å°† Pod é…ç½®ä¸ºé¦–å…ˆè¿è¡Œ Vault Agent init å®¹å™¨ï¼ˆå¦‚æœä¸º falseï¼Œåˆ™æœ€åè¿è¡Œï¼‰ã€‚å½“å…¶ä»– init å®¹å™¨éœ€è¦é¢„å¡«å……çš„ç§˜å¯†æ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚è¿™åº”è¯¥è®¾ç½®ä¸º true æˆ– falseã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;vault.hashicorp.com/role&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;â€“&lt;/td&gt;
          &lt;td&gt;é…ç½® Vault ä»£ç†è‡ªåŠ¨éªŒè¯æ–¹æ³•ä½¿ç”¨çš„ Vault è§’è‰²ã€‚&lt;code&gt;vault.hashicorp.com/agent-configmap&lt;/code&gt; æœªè®¾ç½®æ—¶éœ€è¦ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;vault.hashicorp.com/auth-path&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;â€“&lt;/td&gt;
          &lt;td&gt;é…ç½® Kubernetes èº«ä»½éªŒè¯æ–¹æ³•çš„èº«ä»½éªŒè¯è·¯å¾„ã€‚é»˜è®¤ä¸º &lt;code&gt;auth/kubernetes&lt;/code&gt;ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;vault.hashicorp.com/agent-inject-secret-&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;â€“&lt;/td&gt;
          &lt;td&gt;é…ç½® Vault ä»£ç†ä»¥ä»å®¹å™¨æ‰€éœ€çš„ Vault ä¸­æ£€ç´¢ç§˜å¯†ã€‚Secret çš„åç§°æ˜¯ &lt;code&gt;vault.hashicorp.com/agent-inject-secret-&lt;/code&gt; ä¹‹åçš„ä»»æ„å”¯ä¸€å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ &lt;code&gt;vault.hashicorp.com/agent-inject-secret-foobar&lt;/code&gt; è¯¥å€¼æ˜¯ secret æ‰€åœ¨çš„ Vault ä¸­çš„è·¯å¾„ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;vault.hashicorp.com/agent-inject-template-&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;â€“&lt;/td&gt;
          &lt;td&gt;é…ç½® Vault Agent åº”è¯¥ç”¨äºå‘ˆç°ç§˜å¯†çš„æ¨¡æ¿ã€‚æ¨¡æ¿çš„åç§°æ˜¯ v&lt;code&gt;ault.hashicorp.com/agent-inject-template-&lt;/code&gt; ä¹‹åçš„ä»»ä½•å”¯ä¸€å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ &lt;code&gt;vault.hashicorp.com/agent-inject-template-foobar&lt;/code&gt;ã€‚è¿™åº”è¯¥æ˜ å°„åˆ° &lt;code&gt;vault.hashicorp.com/agent-inject-secret-&lt;/code&gt; ä¸­æä¾›çš„ç›¸åŒå”¯ä¸€å€¼ã€‚å¦‚æœæœªæä¾›ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„é€šç”¨æ¨¡æ¿ã€‚&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;vault-server-considerations&#34;&gt;Vault æœåŠ¡å™¨æ³¨æ„äº‹é¡¹&lt;/h2&gt;
&lt;p&gt;Vault æ”¯æŒå¤šç§å®¢æˆ·ç«¯éªŒè¯è‡ªå·±çš„æ–¹æ³•ã€‚æˆ‘ä»¬å°†åˆ©ç”¨ &lt;a href=&#34;https://developer.hashicorp.com/vault/docs/auth/kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes èº«ä»½éªŒè¯åç«¯&lt;/a&gt;ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å°†åˆ©ç”¨ Kubernetes ServiceAccount JWT ä»¤ç‰ŒéªŒè¯ã€‚è¯·æ³¨æ„ï¼Œè‡ª Kubernetes 1.24 ä»¥æ¥ï¼Œä¸å†è‡ªåŠ¨ç”Ÿæˆ ServiceAccount ä»¤ç‰Œã€‚æ‚¨ä»ç„¶å¯ä»¥æ‰‹åŠ¨åˆ›å»ºè¿™äº› API ä»¤ç‰Œï¼Œå¦‚&lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#manually-create-an-api-token-for-a-serviceaccount&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„æ‰€è¿°&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è‡³äºè¯ä¹¦å’Œç§é’¥ææ–™çš„å­˜å‚¨ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/secrets/pki&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PKI ç§˜å¯†å¼•æ“&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.hashicorp.com/vault/docs/secrets/kv&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;KV ç§˜å¯†å¼•æ“&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› ä¸º PKI ç§˜å¯†å¼•æ“ä¸æä¾›ç²¾ç®€çš„ API æ¥æ£€ç´¢æˆ‘ä»¬éœ€è¦çš„è¯ä¹¦å’Œç§é’¥ï¼Œå¹¶ä¸”å› ä¸º PKI ç§˜å¯†å¼•æ“ä¼šä¸ºæ¯æ¬¡è°ƒç”¨ï¼ˆä¾‹å¦‚ï¼Œæ¯æ¬¡ &lt;em&gt;istiod&lt;/em&gt; é‡å¯ï¼‰ç”Ÿæˆä¸€ä¸ªæ–°çš„ä¸­é—´è¯ä¹¦ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é€šç”¨çš„ KV ç§˜å¯†å¼•æ“ï¼Œå°†æˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰å€¼å­˜å‚¨åœ¨ä¸€ä¸ªç®€å•çš„é”®å€¼æ•°æ®ç»“æ„ä¸­ã€‚æˆ‘ä»¬å‡è®¾ä¸­é—´è¯ä¹¦çš„æ›´æ–°æ˜¯é€šè¿‡ä¸€äº›æœåŠ¡é—¨æˆ·æˆ– CI/CD è¿‡ç¨‹åœ¨å¤–éƒ¨å¤„ç†çš„ï¼Œè¿™äº›è¿‡ç¨‹ä¹Ÿå°†æ›´æ–°çš„ä¸­é—´è¯ä¹¦å­˜å‚¨åœ¨ Vault æœåŠ¡å™¨ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;Istio çš„æ§åˆ¶å¹³é¢ Pod éœ€è¦ä»¥ä¸‹æ–‡ä»¶æ‰èƒ½åœ¨ CA ä¸­æ­£ç¡®å¼•å¯¼å…¶æ„å»ºï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Key&lt;/th&gt;
          &lt;th&gt;å€¼ï¼ˆPEM ç¼–ç ï¼‰&lt;/th&gt;
          &lt;th&gt;ç»†èŠ‚&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;ca-key.pem&lt;/td&gt;
          &lt;td&gt;ç§é’¥&lt;/td&gt;
          &lt;td&gt;ä¸­é—´è¯ä¹¦çš„ç§é’¥ï¼Œç”¨ä½œ &lt;em&gt;istiod&lt;/em&gt; çš„æ ¹ CAã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ca-cert.pem&lt;/td&gt;
          &lt;td&gt;CA å…¬å…±è¯ä¹¦&lt;/td&gt;
          &lt;td&gt;ä¸­é—´è¯ä¹¦ï¼Œç”¨ä½œ &lt;em&gt;istiod&lt;/em&gt; çš„æ ¹ CAã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;root-cert.pem&lt;/td&gt;
          &lt;td&gt;CA æ ¹è¯ä¹¦&lt;/td&gt;
          &lt;td&gt;æˆ‘ä»¬æ–°ç”Ÿæˆçš„ä¸­é—´è¯ä¹¦çš„ä¿¡ä»»æ ¹ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;cert-chain.pem&lt;/td&gt;
          &lt;td&gt;å®Œæ•´çš„è¯ä¹¦é“¾&lt;/td&gt;
          &lt;td&gt;ä¸­é—´è¯ä¹¦åœ¨é¡¶éƒ¨ï¼Œæ ¹è¯ä¹¦åœ¨åº•éƒ¨ã€‚&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;è®¾ç½®&#34;&gt;è®¾ç½®&lt;/h2&gt;
&lt;p&gt;å¦‚æœè¦éµå¾ªæœ¬åœ°è®¾ç½®ï¼Œåˆ™å®‰è£…è½¯ä»¶çš„å…ˆå†³æ¡ä»¶åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;kubectl&lt;/em&gt; ä¸ Kubernetes é›†ç¾¤äº¤äº’ï¼ˆ&lt;a href=&#34;https://kubernetes.io/docs/tasks/tools/#kubectl&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸‹è½½&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;em&gt;helm&lt;/em&gt; å®‰è£… Vault injector å’Œ Istio chartï¼ˆ&lt;a href=&#34;https://helm.sh/docs/intro/install&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸‹è½½&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;ç”¨äºé…ç½® Vault æœåŠ¡å™¨çš„ &lt;em&gt;vault cli&lt;/em&gt; å·¥å…·ï¼ˆ&lt;a href=&#34;https://developer.hashicorp.com/vault/tutorials/getting-started/getting-started-install#install-vault&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸‹è½½&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæ‚¨æƒ³è¦æœ¬åœ°æ¼”ç¤ºç¯å¢ƒï¼Œè¯·æŒ‰ç…§&lt;a href=&#34;https://github.com/tetratelabs/istio-vault-ext-certs/blob/main/local-setup.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt;çš„è¯´æ˜è¿›è¡Œæ“ä½œï¼Œè¯¥è¯´æ˜ä½¿ç”¨ &lt;code&gt;docker-compose&lt;/code&gt; å¯åŠ¨ä¸€ä¸ª Vault æœåŠ¡å™¨å’Œä¸¤ä¸ªç‹¬ç«‹çš„ k3s é›†ç¾¤ã€‚å¦‚æœæ‚¨ä½¿ç”¨è‡ªå·±çš„ Kubernetes é›†ç¾¤å’Œå¤–éƒ¨æ‰˜ç®¡çš„ Vault å®ä¾‹ï¼Œè¯·è·³è‡³ä¸‹ä¸€èŠ‚ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;docker-compose&lt;/em&gt; å¯åŠ¨æœ¬åœ°ç¯å¢ƒï¼ˆ&lt;a href=&#34;https://github.com/docker/compose/releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸‹è½½&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†å–å¾—è¿›å±•ï¼Œæˆ‘ä»¬å¸Œæœ›æ ¹æ®æ‚¨çš„ç¯å¢ƒè®¾ç½®ä»¥ä¸‹ shell å˜é‡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;VAULT_SERVER&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;K8S_API_SERVER_1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;K8S_API_SERVER_2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;vault-kubernetes-èº«ä»½éªŒè¯åç«¯&#34;&gt;&lt;strong&gt;Vault Kubernetes èº«ä»½éªŒè¯åç«¯&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;æ­£å¦‚åœ¨æœ‰å…³ &lt;a href=&#34;#vault-server-considerations&#34;&gt;Vault æœåŠ¡å™¨æ³¨æ„äº‹é¡¹&lt;/a&gt;çš„ä»‹ç»éƒ¨åˆ†ä¸­æåˆ°çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ &lt;a href=&#34;https://developer.hashicorp.com/vault/docs/auth/kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes èº«ä»½éªŒè¯åç«¯&lt;/a&gt;ã€‚ç”±äº &lt;em&gt;istiod&lt;/em&gt; å°†ä» Vault æœåŠ¡å™¨è·å–è¯ä¹¦å’Œç§é’¥ææ–™ï¼Œè®©æˆ‘ä»¬ä»åœ¨ä¸¤ä¸ªé›†ç¾¤ä¸­åˆ›å»ºç›¸åº”çš„æœåŠ¡è´¦æˆ·å¼€å§‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg1.yml create ns istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg2.yml create ns istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg1.yml apply -f istio-sa.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg2.yml apply -f istio-sa.yml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ServiceAccountã€Secret å’Œ ClusterRoleBinding å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# istio-sa.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceAccount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istiod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# added for istio helm installation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istiod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/managed-by&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Helm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-istiod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# added for istio helm installation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meta.helm.sh/release-name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-istiod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meta.helm.sh/release-namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istiod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kubernetes.io/service-account.name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istiod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes.io/service-account-token&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterRoleBinding&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;role-tokenreview-binding&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;roleRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterRole&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;system:auth-delegator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subjects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceAccount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istiod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼š&lt;em&gt;æˆ‘ä»¬åœ¨ istiod ServiceAccount ä¸Šæ·»åŠ äº† Helm æ ‡ç­¾å’Œæ³¨è§£ï¼Œä»¥å…ä¸ç¨åçš„ Istio Helm éƒ¨ç½²å‘ç”Ÿå†²çªã€‚&lt;/em&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;åœ¨ä¸¤ä¸ªé›†ç¾¤ä¸­åˆ›å»º ServiceAccount åï¼Œè®©æˆ‘ä»¬å°†å®ƒä»¬çš„ Secret ä»¤ç‰Œå’Œ ca.cert å€¼å­˜å‚¨åœ¨ output æ–‡ä»¶å¤¹ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p ./output
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg1.yml get secret -n istio-system istiod -o go-template&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{{ .data.token }}&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 --decode &amp;gt; output/istiod1.jwt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg1.yml config view --raw --minify --flatten -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.clusters[].cluster.certificate-authority-data}&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 --decode &amp;gt; output/k8sapi-cert1.pem
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg2.yml get secret -n istio-system istiod -o go-template&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{{ .data.token }}&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 --decode &amp;gt; output/istiod2.jwt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg2.yml config view --raw --minify --flatten -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.clusters[].cluster.certificate-authority-data}&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 --decode &amp;gt; output/k8sapi-cert2.pem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…³äº Kubernetes API è¯ä¹¦å’Œ istiod ServiceAccount JWT ä»¤ç‰Œçš„è¯¦ç»†å†…å®¹çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨&lt;a href=&#34;https://github.com/tetratelabs/istio-vault-ext-certs/blob/main/output&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ°ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¹Ÿæ›´æ·±å…¥åœ°æè¿°äº† Vault çš„äº¤äº’è¿‡ç¨‹ï¼Œå³é€šè¿‡ REST API è°ƒç”¨æ¥éªŒè¯å’Œè·å–ç§˜å¯†ã€‚åœ¨è°ƒè¯•æƒé™æ‹’ç»çš„é—®é¢˜æ—¶ï¼Œè¿™äº›å¯ä»¥æ´¾ä¸Šç”¨åœºã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ ¹æ®åˆšåˆšæ£€ç´¢åˆ°çš„ Kubernetes CA è¯ä¹¦å’Œ JWT ä»¤ç‰Œåˆ›å»ºå¿…è¦çš„ Vault èº«ä»½éªŒè¯é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;VAULT_ADDR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;http://localhost:8200
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login root
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault auth &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; --path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kubernetes-cluster1 kubernetes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault auth &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; --path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kubernetes-cluster2 kubernetes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault write auth/kubernetes-cluster1/config &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;kubernetes_host&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$K8S_API_SERVER_1&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;kubernetes_ca_cert&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;@output/k8sapi-cert1.pem &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;token_reviewer_jwt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;cat output/istiod1.jwt&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;disable_local_ca_jwt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault write auth/kubernetes-cluster2/config &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;kubernetes_host&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$K8S_API_SERVER_2&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;kubernetes_ca_cert&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;@output/k8sapi-cert2.pem &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;token_reviewer_jwt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;cat output/istiod2.jwt&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;disable_local_ca_jwt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼šå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ &lt;em&gt;docker-compose&lt;/em&gt; æä¾›çš„ç¯å¢ƒï¼Œåˆ™ &lt;code&gt;VAULT_ADDR&lt;/code&gt; è®¾ç½®ä¸º localhostã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h2 id=&#34;vault-kv-secret-ä¸­çš„-istio-è¯ä¹¦å’Œç§é’¥&#34;&gt;&lt;em&gt;Vault kv&lt;/em&gt; Secret ä¸­çš„ Istio è¯ä¹¦å’Œç§é’¥&lt;/h2&gt;
&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°çš„è‡ªç­¾åæ ¹è¯ä¹¦å¹¶ä¸ºæˆ‘ä»¬çš„ä¸¤ä¸ªé›†ç¾¤ç”Ÿæˆä¸­é—´è¯ä¹¦ã€‚æˆ‘ä»¬å°†åœ¨&lt;a href=&#34;https://github.com/istio/istio/tree/master/tools/certs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;ä½¿ç”¨ä¸Šæ¸¸ Istio æä¾›çš„è¾…åŠ© &lt;em&gt;Makefile&lt;/em&gt; è„šæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; certs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make -f ../certs-gen/Makefile.selfsigned.mk root-ca
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make -f ../certs-gen/Makefile.selfsigned.mk istiod-cluster1-cacerts
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make -f ../certs-gen/Makefile.selfsigned.mk istiod-cluster2-cacerts
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; ..
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰å…³å®é™…å†…å®¹å’Œæ­£åœ¨è®¾ç½®çš„ X509v3 æ‰©å±•çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§&lt;a href=&#34;https://github.com/tetratelabs/istio-vault-ext-certs/blob/main/certs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt;ã€‚æ‚¨å¯ä»¥é€šè¿‡&lt;a href=&#34;https://github.com/tetratelabs/istio-vault-ext-certs/blob/main/certs-gen&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt;çš„ &lt;em&gt;Makefile&lt;/em&gt;æ–‡æ¡£å’Œç›¸åº”çš„ &lt;em&gt;Makefile&lt;/em&gt; è¦†ç›–å€¼å¾®è°ƒè¯ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬å°†ç”Ÿæˆçš„è¯ä¹¦å’Œç§é’¥æ·»åŠ åˆ° Vault &lt;em&gt;kv&lt;/em&gt; secret ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;VAULT_ADDR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;http://localhost:8200
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault login root
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; -path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kubernetes-cluster1-secrets kv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault secrets &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; -path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kubernetes-cluster2-secrets kv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv put kubernetes-cluster1-secrets/istiod-service/certs &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;ca_key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;@certs/istiod-cluster1/ca-key.pem &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;ca_cert&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;@certs/istiod-cluster1/ca-cert.pem &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;cert_chain&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;@certs/istiod-cluster1/cert-chain.pem &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;root_cert&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;@certs/istiod-cluster1/root-cert.pem
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault kv put kubernetes-cluster2-secrets/istiod-service/certs &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;ca_key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;@certs/istiod-cluster2/ca-key.pem &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;ca_cert&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;@certs/istiod-cluster2/ca-cert.pem &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;cert_chain&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;@certs/istiod-cluster2/cert-chain.pem &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;root_cert&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;@certs/istiod-cluster2/root-cert.pem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡é™åˆ¶å¯¹æ¯ä¸ªé›†ç¾¤çš„è¿™äº›è¯ä¹¦å’Œç§é’¥çš„è®¿é—®ï¼Œç»‘å®šåˆ°åŸºäº Kubernetes &lt;em&gt;istiod&lt;/em&gt; ServiceAccount çš„èº«ä»½éªŒè¯åç«¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;path &amp;#34;kubernetes-cluster1-secrets/istiod-service/certs&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  capabilities = [&amp;#34;read&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;}&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; vault policy write istiod-certs-cluster1 -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;path &amp;#34;kubernetes-cluster2-secrets/istiod-service/certs&amp;#34; {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  capabilities = [&amp;#34;read&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;}&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; vault policy write istiod-certs-cluster2 -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault write auth/kubernetes-cluster1/role/istiod &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;bound_service_account_names&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istiod &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;bound_service_account_namespaces&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istio-system &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;policies&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istiod-certs-cluster1 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;ttl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;24h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vault write auth/kubernetes-cluster2/role/istiod &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;bound_service_account_names&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istiod &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;bound_service_account_namespaces&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istio-system &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;policies&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istiod-certs-cluster2  &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;ttl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;24h
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;éƒ¨ç½²-vault-inject-å’Œ-istio-helm-charts&#34;&gt;éƒ¨ç½² &lt;em&gt;vault-inject&lt;/em&gt; å’Œ Istio Helm Charts&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†éƒ¨ç½² Vault æ³¨å…¥å™¨ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨å®˜æ–¹ Vault &lt;a href=&#34;https://github.com/hashicorp/vault-helm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm chart&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo add hashicorp https://helm.releases.hashicorp.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo update
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg1.yml create ns vault
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg2.yml create ns vault
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm --kubeconfig kubecfg1.yml install -n vault vault-inject hashicorp/vault --set &lt;span class=&#34;s2&#34;&gt;&amp;#34;injector.externalVaultAddr=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$VAULT_SERVER&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm --kubeconfig kubecfg2.yml install -n vault vault-inject hashicorp/vault --set &lt;span class=&#34;s2&#34;&gt;&amp;#34;injector.externalVaultAddr=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$VAULT_SERVER&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg1.yml -n vault get pods
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg2.yml -n vault get pods
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;NAME                                           READY   STATUS    RESTARTS   AGE
vault-inject-agent-injector-5776975795-9vt9w   1/1     Running   0          92s
NAME                                           READY   STATUS    RESTARTS   AGE
vault-inject-agent-injector-5776975795-9vjnx   1/1     Running   0          91s
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¦å®‰è£… Istioï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Tetrate Istio Distro &lt;a href=&#34;https://github.com/tetratelabs/helm-charts&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm chart&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo add tetratelabs https://tetratelabs.github.io/helm-charts
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo update
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm --kubeconfig kubecfg1.yml install -n istio-system istio-base tetratelabs/base
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm --kubeconfig kubecfg2.yml install -n istio-system istio-base tetratelabs/base
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm --kubeconfig kubecfg1.yml install -n istio-system istio-istiod tetratelabs/istiod --values&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;./cluster1-values.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm --kubeconfig kubecfg2.yml install -n istio-system istio-istiod tetratelabs/istiod --values&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;./cluster2-values.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg1.yml -n istio-system get pods
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg2.yml -n istio-system get pods
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯·æ³¨æ„æˆ‘ä»¬å¦‚ä½•åˆ©ç”¨å¤šä¸ª Istio Helm chart å€¼è¦†ç›–æ¥æˆ‘ä»¬é¢„æœŸçš„ç›®æ ‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ³¨å…¥ä¸€ä¸ª pilot Pod ç¯å¢ƒå˜é‡ &lt;code&gt;ROOT_CA_DIR&lt;/code&gt; æ¥å‘Šè¯‰ &lt;em&gt;istiod&lt;/em&gt; ä»å“ªé‡Œè·å–è¯ä¹¦å’Œç§é’¥&lt;/li&gt;
&lt;li&gt;å‘Šè¯‰ &lt;code&gt;vault-agent-init&lt;/code&gt; å®¹å™¨åœ¨ &lt;em&gt;istiod&lt;/em&gt; å®¹å™¨ä¹‹å‰è¿è¡Œï¼Œå› æ­¤ç§˜å¯†å®‰è£…åœ¨ &lt;code&gt;/vault/secrets&lt;/code&gt; çš„å·ä¸­å¯ç”¨&lt;/li&gt;
&lt;li&gt;æŒ‡ç¤º Vault æ³¨å…¥å™¨ä»æ­£ç¡®çš„ä½ç½®å’Œæ•°æ®å¯†é’¥è·å–æœºå¯†&lt;/li&gt;
&lt;li&gt;è¿™æ ·åšæ—¶æ‰¿æ‹… Vault &lt;em&gt;istiod&lt;/em&gt; è§’è‰²&lt;/li&gt;
&lt;li&gt;è¦†ç›–é»˜è®¤çš„ Kubernetes auth-pathï¼Œå› ä¸ºæˆ‘ä»¬æœ‰å¤šä¸ªé›†ç¾¤&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;pilot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ROOT_CA_DIR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/vault/secrets&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;podAnnotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vault.hashicorp.com/agent-inject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vault.hashicorp.com/agent-init-first&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vault.hashicorp.com/agent-inject-secret-ca-key.pem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;kubernetes-cluster1-secrets/istiod-service/certs&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vault.hashicorp.com/agent-inject-template-ca-key.pem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        {{- with secret &amp;#34;kubernetes-cluster1-secrets/istiod-service/certs&amp;#34; -}}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        {{ .Data.ca_key }}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        {{ end -}}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vault.hashicorp.com/agent-inject-secret-ca-cert.pem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;kubernetes-cluster1-secrets/istiod-service/certs&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vault.hashicorp.com/agent-inject-template-ca-cert.pem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        {{- with secret &amp;#34;kubernetes-cluster1-secrets/istiod-service/certs&amp;#34; -}}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        {{ .Data.ca_cert }}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        {{ end -}}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vault.hashicorp.com/agent-inject-secret-root-cert.pem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;kubernetes-cluster1-secrets/istiod-service/certs&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vault.hashicorp.com/agent-inject-template-root-cert.pem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        {{- with secret &amp;#34;kubernetes-cluster1-secrets/istiod-service/certs&amp;#34; -}}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        {{ .Data.root_cert }}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        {{ end -}}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vault.hashicorp.com/agent-inject-secret-cert-chain.pem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;kubernetes-cluster1-secrets/istiod-service/certs&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vault.hashicorp.com/agent-inject-template-cert-chain.pem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        {{- with secret &amp;#34;kubernetes-cluster1-secrets/istiod-service/certs&amp;#34; -}}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        {{ .Data.cert_chain }}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        {{ end -}}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vault.hashicorp.com/role&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;istiod&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vault.hashicorp.com/auth-path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;auth/kubernetes-cluster1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“æˆ‘ä»¬æŸ¥çœ‹ &lt;code&gt;vault-agent-init&lt;/code&gt; å®¹å™¨æ—¥å¿—æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹ã€‚æˆ‘ä»¬çš„æ§åˆ¶å¹³é¢å·²ç»æ­£ç¡®åœ°è·å–äº† Vault æ³¨å…¥çš„ç§˜å¯†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg1.yml logs -n istio-system -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istiod -c vault-agent-init --tail&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;-1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;==&amp;gt; Vault agent started! Log data will stream in below:

  ==&amp;gt; Vault agent configuration:

                      Cgo: disabled
                Log Level: info
                  Version: Vault v1.12.0, built 2022-10-10T18:14:33Z
              Version Sha: 558abfa75702b5dab4c98e86b802fb9aef43b0eb

  2022-11-18T11:01:21.398Z [INFO]  sink.file: creating file sink
  2022-11-18T11:01:21.398Z [INFO]  sink.file: file sink configured: path=/home/vault/.vault-token mode=-rw-r-----
  2022-11-18T11:01:21.398Z [INFO]  template.server: starting template server
  2022-11-18T11:01:21.398Z [INFO]  sink.server: starting sink server
  2022-11-18T11:01:21.398Z [INFO]  auth.handler: starting auth handler
  2022-11-18T11:01:21.398Z [INFO]  auth.handler: authenticating
  2022-11-18T11:01:21.398Z [INFO] (runner) creating new runner (dry: false, once: false)
  2022-11-18T11:01:21.398Z [INFO] (runner) creating watcher
  2022-11-18T11:01:21.402Z [INFO]  auth.handler: authentication successful, sending token to sinks
  2022-11-18T11:01:21.402Z [INFO]  auth.handler: starting renewal process
  2022-11-18T11:01:21.402Z [INFO]  sink.file: token written: path=/home/vault/.vault-token
  2022-11-18T11:01:21.402Z [INFO]  sink.server: sink server stopped
  2022-11-18T11:01:21.402Z [INFO]  sinks finished, exiting
  2022-11-18T11:01:21.402Z [INFO]  template.server: template server received new token
  2022-11-18T11:01:21.402Z [INFO] (runner) stopping
  2022-11-18T11:01:21.402Z [INFO] (runner) creating new runner (dry: false, once: false)
  2022-11-18T11:01:21.402Z [INFO] (runner) creating watcher
  2022-11-18T11:01:21.402Z [INFO] (runner) starting
  2022-11-18T11:01:21.403Z [INFO]  auth.handler: renewed auth token
  2022-11-18T11:01:21.515Z [INFO] (runner) rendered &amp;#34;(dynamic)&amp;#34; =&amp;gt; &amp;#34;/vault/secrets/root-cert.pem&amp;#34;
  2022-11-18T11:01:21.515Z [INFO] (runner) rendered &amp;#34;(dynamic)&amp;#34; =&amp;gt; &amp;#34;/vault/secrets/ca-cert.pem&amp;#34;
  2022-11-18T11:01:21.515Z [INFO] (runner) rendered &amp;#34;(dynamic)&amp;#34; =&amp;gt; &amp;#34;/vault/secrets/cert-chain.pem&amp;#34;
  2022-11-18T11:01:21.516Z [INFO] (runner) rendered &amp;#34;(dynamic)&amp;#34; =&amp;gt; &amp;#34;/vault/secrets/ca-key.pem&amp;#34;
  2022-11-18T11:01:21.516Z [INFO] (runner) stopping
  2022-11-18T11:01:21.516Z [INFO]  template.server: template server stopped
  2022-11-18T11:01:21.516Z [INFO] (runner) received finish
  2022-11-18T11:01:21.516Z [INFO]  auth.handler: shutdown triggered, stopping lifetime watcher
  2022-11-18T11:01:21.516Z [INFO]  auth.handler: auth handler stopped
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å½“æˆ‘ä»¬æŸ¥çœ‹ &lt;code&gt;discovery&lt;/code&gt; å®¹å™¨æ—¥å¿—æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --kubeconfig kubecfg1.yml logs -n istio-system -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istiod -c discovery --tail&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;-1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; info	Using istiod file format for signing ca files
  info	Use plugged-in cert at /vault/secrets/ca-key.pem
  info	x509 cert - Issuer: &amp;#34;CN=Intermediate CA,O=Istio,L=istiod-cluster1&amp;#34;, Subject: &amp;#34;&amp;#34;, SN: 39f67569f10d36a1fc91e9d82156b07d, NotBefore: &amp;#34;2022-11-18T11:11:59Z&amp;#34;, NotAfter: &amp;#34;2032-11-15T11:13:59Z&amp;#34;
  info	x509 cert - Issuer: &amp;#34;CN=Root CA,O=Istio&amp;#34;, Subject: &amp;#34;CN=Intermediate CA,O=Istio,L=istiod-cluster1&amp;#34;, SN: dedf298a147681d6, NotBefore: &amp;#34;2022-11-17T22:01:54Z&amp;#34;, NotAfter: &amp;#34;2024-11-16T22:01:54Z&amp;#34;
  info	x509 cert - Issuer: &amp;#34;CN=Root CA,O=Istio&amp;#34;, Subject: &amp;#34;CN=Root CA,O=Istio&amp;#34;, SN: f5bcd7e89bdb6248, NotBefore: &amp;#34;2022-11-17T22:01:52Z&amp;#34;, NotAfter: &amp;#34;2032-11-14T22:01:52Z&amp;#34;
  info	Istiod certificates are reloaded
  info	spiffe	Added 1 certs to trust domain cluster.local in peer cert verifier
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ Istio æ§åˆ¶å¹³é¢å·²ç»æ­£ç¡®åœ°è·å–äº†æˆ‘ä»¬çš„ Vault æ³¨å…¥è¯ä¹¦å’Œç§é’¥ã€‚ä»»åŠ¡å®Œæˆï¼&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨å¤–éƒ¨ Vault å­˜å‚¨çš„è¯ä¹¦å’Œç§é’¥æˆåŠŸå¼•å¯¼äº† Istio æ§åˆ¶å¹³é¢ã€‚å®ç°è¿™ä¸€ç›®æ ‡çš„æ­¥éª¤åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†è¯ä¹¦å’Œç§é’¥å­˜å‚¨åœ¨æ¯ä¸ªé›†ç¾¤ä¸“ç”¨çš„ Vault ç§˜å¯†å®‰è£…è·¯å¾„ä¸­&lt;/li&gt;
&lt;li&gt;ä¸ºæ¯ä¸ªé›†ç¾¤è®¾ç½® Kubernetes Vault èº«ä»½éªŒè¯åç«¯ï¼Œé“¾æ¥åˆ°æ­£ç¡®çš„ ServiceAccount&lt;/li&gt;
&lt;li&gt;å®šä¹‰é€‚å½“çš„è§’è‰²å’Œç­–ç•¥ä»¥å…è®¸ä» &lt;em&gt;istiod&lt;/em&gt; ServiceAccount è®¿é—® Vault æœºå¯†&lt;/li&gt;
&lt;li&gt;å°† Istio Pilot å¼•å¯¼ç¨‹åºå‚æ•°è°ƒæ•´ä¸ºï¼š
&lt;ul&gt;
&lt;li&gt;æ³¨å…¥ &lt;em&gt;vault-agent-init&lt;/em&gt; sidecar&lt;/li&gt;
&lt;li&gt;è·å–åŒ…å«æˆ‘ä»¬çš„è¯ä¹¦å’Œç§é’¥çš„æ­£ç¡® Vault æœºå¯†&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ­£ç¡®çš„è§’è‰²å’Œèº«ä»½éªŒè¯åç«¯æ¥è¿™æ ·åš&lt;/li&gt;
&lt;li&gt;ä»æ­£ç¡®çš„ vault secret å®‰è£…è·¯å¾„ä¸­è·å–è¯ä¹¦å’Œç§é’¥&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®Œå…¨ç›¸åŒçš„æŠ€æœ¯æ¥æ³¨å…¥&lt;em&gt;å…¥å£ç½‘å…³&lt;/em&gt;å’Œ&lt;em&gt;å‡ºå£ç½‘å…³&lt;/em&gt;è¯ä¹¦ã€‚åˆ›å»º Istio &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/gateway/#ServerTLSSettings&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway&lt;/a&gt; å¯¹è±¡æ—¶ï¼Œè¯·ç¡®ä¿å°† &lt;em&gt;serverCertificate&lt;/em&gt;ã€&lt;em&gt;privateKey&lt;/em&gt; å’Œ &lt;em&gt;caCertificates&lt;/em&gt; æŒ‡å‘ &lt;code&gt;/vault/secrets&lt;/code&gt; æŒ‚è½½å·ä¸­çš„æ­£ç¡®æ–‡ä»¶ã€‚æˆ‘ä»¬å°†æŠŠå®ƒä½œä¸ºç»ƒä¹ ç•™ç»™è¯»è€…ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡å°†è¯ä¹¦æ³¨å…¥ç»‘å®šåˆ° Kubernetes ServiceAccountï¼Œæˆ‘ä»¬ç°åœ¨å·²å°†è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†å§”æ‰˜ç»™å¤–éƒ¨ç§˜å¯† Vault å®ä¾‹ã€‚ç°åœ¨å¯ä»¥ä½¿ç”¨ä¸“ç”¨è§’è‰²å’Œå†™å…¥/æ›´æ–°ç­–ç•¥åˆ›å»ºæœåŠ¡é—¨æˆ·æˆ– CI/CD ç®¡é“ç­‰å¤–éƒ¨æµç¨‹ï¼Œä»¥æä¾›å¿…è¦çš„è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†å®‰å…¨æ€§ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä»€ä¹ˆæ˜¯ Ambient Meshï¼Ÿ</title>
      <link>https://cloudnativecn.com/blog/what-is-ambient-mesh/</link>
      <pubDate>Wed, 28 Sep 2022 10:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/what-is-ambient-mesh/</guid>
      <description>&lt;p&gt;Istio&lt;a href=&#34;https://istio.io/latest/blog/2022/introducing-ambient-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ€è¿‘å®£å¸ƒäº†â€œAmbient Meshâ€&lt;/a&gt; â€”â€” ä¸€ç§ç”¨äº Istio çš„å®éªŒæ€§â€œæ—  sidecarâ€éƒ¨ç½²æ¨¡å‹ã€‚æˆ‘ä»¬æœ€è¿‘åœ¨&lt;a href=&#34;https://www.tetrate.io/blog/ebpf-and-sidecars-getting-the-most-performance-and-resiliency-out-of-the-service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»æœåŠ¡ç½‘æ ¼ä¸­è·å¾—æœ€å¤§æ€§èƒ½å’Œå¼¹æ€§&lt;/a&gt;çš„èƒŒæ™¯ä¸‹å†™äº†å…³äº sidecar ä¸ sidecar-less çš„æ–‡ç« ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ç‰¹åˆ«ä»‹ç»æˆ‘ä»¬å¯¹ Ambient Mesh çš„çœ‹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æƒ³ç«‹å³å¼€å§‹ä½¿ç”¨å¯ç”¨äºç”Ÿäº§çš„ Istio å‘è¡Œç‰ˆï¼Œè¯·å°è¯•&lt;a href=&#34;https://istio.tetratelabs.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Istio Distro (TID)&lt;/a&gt;ã€‚TID æ˜¯ç»è¿‡å®¡æŸ¥çš„ Istio ä¸Šæ¸¸å‘è¡Œç‰ˆï¼Œå®ƒæ˜“äºå®‰è£…ã€ç®¡ç†å’Œå‡çº§ï¼ŒåŸºäºé€‚ç”¨äº FedRAMP ç¯å¢ƒçš„ FIPS è®¤è¯æ„å»ºã€‚å¦‚æœä½ éœ€è¦ä¸€ç§ç»Ÿä¸€ä¸”ä¸€è‡´çš„æ–¹å¼æ¥ä¿æŠ¤å’Œç®¡ç†ä¸€ç»„åº”ç”¨ç¨‹åºä¸­çš„æœåŠ¡ï¼Œè¯·æŸ¥çœ‹&lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge (TSB)&lt;/a&gt;ï¼Œè¿™æ˜¯æˆ‘ä»¬åŸºäº Istio å’Œ Envoy æ„å»ºçš„å…¨é¢çš„è¾¹ç¼˜åˆ°å·¥ä½œè´Ÿè½½åº”ç”¨ç¨‹åºè¿æ¥å¹³å°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-ambient-mesh&#34;&gt;ä»€ä¹ˆæ˜¯ Ambient Meshï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Ambient Mesh æ˜¯æœ€è¿‘å¼•å…¥ Istio çš„ä¸€ç§å®éªŒæ€§æ–°éƒ¨ç½²æ¨¡å‹ã€‚å®ƒå°† Envoy sidecar å½“å‰æ‰§è¡Œçš„èŒè´£åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼šä¸€ä¸ªç”¨äºåŠ å¯†çš„èŠ‚ç‚¹çº§ç»„ä»¶ï¼ˆç§°ä¸ºâ€œztunnelâ€ï¼‰å’Œä¸€ä¸ªä¸ºæ¯ä¸ªæœåŠ¡è´¦æˆ·éƒ¨ç½²çš„ L7 Envoy å®ä¾‹ï¼Œç”¨äºæ‰€æœ‰å…¶ä»–å¤„ç†ï¼ˆç§°ä¸ºâ€œwaypointâ€ï¼‰ã€‚Ambient Mesh æ¨¡å‹è¯•å›¾åœ¨æ½œåœ¨æ”¹è¿›çš„ç”Ÿå‘½å‘¨æœŸå’Œèµ„æºç®¡ç†ä¸­è·å¾—ä¸€äº›æ•ˆç‡ â€”â€” è‡³å°‘ï¼Œè¿™æ˜¯åŠ¨æœºã€‚&lt;/p&gt;
&lt;h2 id=&#34;æˆ‘ä¸ºä»€ä¹ˆè¦å…³å¿ƒ-ambient-mesh&#34;&gt;æˆ‘ä¸ºä»€ä¹ˆè¦å…³å¿ƒ Ambient Meshï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å¯¹äºå¤§å¤šæ•°æœåŠ¡ç½‘æ ¼ç”¨æˆ·æ¥è¯´ï¼ŒIstio æ•°æ®å¹³é¢çš„ç¡®åˆ‡éƒ¨ç½²æ¨¡å‹æ˜¯ä½ å¯èƒ½ä¸éœ€è¦è€ƒè™‘å¤ªå¤šçš„é€‰æ‹©ã€‚é»˜è®¤å¯èƒ½æ²¡é—®é¢˜ã€‚å¯¹äº&lt;em&gt;ä¸€äº›&lt;/em&gt;æœåŠ¡ç½‘æ ¼ç”¨æˆ·ï¼Œç‰¹åˆ«æ˜¯é‚£äº›æ‹¥æœ‰å°‘é‡æœåŠ¡çš„å¤§è§„æ¨¡æ°´å¹³æ‰©å±•è¶³è¿¹çš„ç”¨æˆ·ï¼ˆwaypoint æ¶æ„è·å¾—æœ€é«˜æ•ˆç‡çš„åœ°æ–¹ï¼‰ï¼ŒAmbient Mesh æ¨¡å‹å°†åœ¨æˆç†Ÿä¸ºç”Ÿäº§å°±ç»ªçš„åŸºç¡€è®¾æ–½è½¯ä»¶æ—¶å¾ˆæœ‰ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœ¬æ–‡ä¸»æ—¨&#34;&gt;æœ¬æ–‡ä¸»æ—¨&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Ambient Mesh éƒ¨ç½²æ¨¡å‹ä¸ sidecar æ¨¡å‹è¿›è¡Œäº†ä¸€äº›æƒè¡¡ï¼Œç‰¹åˆ«æ˜¯åœ¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€èµ„æºåˆ©ç”¨ã€æ•…éšœæ’é™¤å’Œå®‰å…¨çŠ¶å†µæ–¹é¢ã€‚å®ƒä»¬ä¹‹é—´ä¸åˆ†ä¼¯ä»²ã€‚&lt;/li&gt;
&lt;li&gt;Ambient Mesh ç›®å‰è¿˜åœ¨å®éªŒé˜¶æ®µï¼Œæœ€æ—©è¦åˆ° 2023 å¹´æ‰èƒ½æŠ•å…¥ç”Ÿäº§ â€”â€” ä¹Ÿå°±æ˜¯è¯´ï¼Œ&lt;strong&gt;æš‚æ—¶ä¸è¦åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œæ„å»º&lt;/strong&gt;ã€‚ç°åœ¨ï¼Œå®ƒçš„æ€§èƒ½å·®ï¼ŒåŠŸèƒ½æ›´å°‘ï¼Œå¹¶ä¸”å¯¹äºå·²å¹¿æ³›ä½¿ç”¨çš„æŠ€æœ¯ï¼ˆå¦‚ CNIï¼‰å…·æœ‰æœªå®šä¹‰çš„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬é¢„è®¡éšç€æœªæ¥å‡ ä¸ªæœˆçš„å®ç°ï¼Œè¿™ç§æƒ…å†µå°†è¿…é€Ÿæ”¹å–„ã€‚&lt;/li&gt;
&lt;li&gt;ä½ å…³å¿ƒçš„å¤§éƒ¨åˆ†ç½‘æ ¼åŠŸèƒ½ï¼ˆå¦‚æŒ‰è¯·æ±‚æµé‡ç®¡ç†å’Œå®‰å…¨æ§åˆ¶ã€åˆ†å¸ƒå¼è¿½è¸ªå’Œåº”ç”¨ç¨‹åºçº§ RED æŒ‡æ ‡ï¼‰éƒ½å‘ç”Ÿåœ¨ L7 ä¸­ã€‚ç›®å‰å°šä¸æ¸…æ¥š Ambient Mesh çš„ä»… L4 éƒ¨åˆ†çš„é€‚ç”¨èŒƒå›´æœ‰å¤šå¤§ï¼Œä»¥åŠæ‰“ç ´è¿™äº›æ•°æ®å¹³é¢èŒè´£å°†åœ¨å¤šå¤§ç¨‹åº¦ä¸Šæœ‰åŠ©äºæ¨åŠ¨ç½‘æ ¼çš„é‡‡ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†æ˜¯æˆ‘ä»¬å¯¹ç¯å¢ƒæ¨¡å‹ä¸ Istio ç°æœ‰çš„ Sidecar éƒ¨ç½²æ¨¡å‹çš„æƒè¡¡ï¼Œçœ‹çœ‹å“ªä¸€ä¸ªé€‚åˆä½ ä»¥åŠä½•æ—¶é€‚åˆä½ ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-ä¸­çš„-l4-å’Œ-l7-å¤„ç†å¦‚ä½•å·¥ä½œ&#34;&gt;Istio ä¸­çš„ L4 å’Œ L7 å¤„ç†å¦‚ä½•å·¥ä½œï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ç”±äº Ambient Mesh åˆ†å‰²äº† L4 å’Œ L7 å¤„ç†ï¼Œå› æ­¤å‡†ç¡®äº†è§£æ¯ä¸€å±‚ä¸­å‘ç”Ÿçš„ç½‘æ ¼è¡Œä¸ºéå¸¸é‡è¦ï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;/th&gt;
          &lt;th&gt;&lt;strong&gt;L4&lt;/strong&gt;&lt;/th&gt;
          &lt;th&gt;&lt;strong&gt;L7&lt;/strong&gt;&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;å®‰å…¨&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æœåŠ¡é—´èº«ä»½éªŒè¯&lt;/td&gt;
          &lt;td&gt;&lt;a href=&#34;https://spiffe.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIFFE&lt;/a&gt;ï¼Œé€šè¿‡ mTLS è¯ä¹¦ã€‚Istio é¢å‘ä¸€ä¸ªçŸ­æœŸ X.509 è¯ä¹¦ï¼Œè¯¥è¯ä¹¦å¯¹ pod çš„æœåŠ¡è´¦æˆ·èº«ä»½è¿›è¡Œç¼–ç ã€‚&lt;/td&gt;
          &lt;td&gt;ä¸é€‚ç”¨ â€” Istio ä¸­çš„æœåŠ¡èº«ä»½ä»…åŸºäº TLSã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æœåŠ¡é—´æˆæƒ&lt;/td&gt;
          &lt;td&gt;åŸºäºç½‘ç»œçš„æˆæƒï¼ŒåŠ ä¸ŠåŸºäºèº«ä»½çš„ç­–ç•¥ï¼Œä¾‹å¦‚ï¼šA åªèƒ½æ¥å—æ¥è‡ªâ€œ10.2.0.0/16â€çš„è°ƒç”¨ï¼›A å¯ä»¥è°ƒç”¨ Bã€‚&lt;/td&gt;
          &lt;td&gt;å®Œæ•´çš„ç­–ç•¥ï¼Œä¾‹å¦‚ï¼šA åªèƒ½ä½¿ç”¨åŒ…å« READ èŒƒå›´çš„æœ‰æ•ˆæœ€ç»ˆç”¨æˆ·å‡­æ®åœ¨ B ä¸Šè·å– /fooã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æœ€ç»ˆç”¨æˆ·èº«ä»½éªŒè¯&lt;/td&gt;
          &lt;td&gt;ä¸é€‚ç”¨ - æˆ‘ä»¬ä¸èƒ½åº”ç”¨æ¯ä¸ªç”¨æˆ·çš„è®¾ç½®ã€‚&lt;/td&gt;
          &lt;td&gt;JWT çš„æœ¬åœ°èº«ä»½éªŒè¯ï¼Œæ”¯æŒé€šè¿‡ OAuth å’Œ OIDC æµè¿›è¡Œè¿œç¨‹èº«ä»½éªŒè¯ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æœ€ç»ˆç”¨æˆ·æˆæƒ&lt;/td&gt;
          &lt;td&gt;ä¸é€‚ç”¨ â€”â€” è§ä¸Šæ–‡ã€‚&lt;/td&gt;
          &lt;td&gt;æœåŠ¡é—´ç­–ç•¥å¯ä»¥æ‰©å±•ä¸ºéœ€è¦&lt;a href=&#34;https://istio.io/latest/docs/reference/config/security/conditions/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…·æœ‰ç‰¹å®šèŒƒå›´ã€é¢å‘è€…ã€å§”æ‰˜äººã€å—ä¼—ç­‰çš„æœ€ç»ˆç”¨æˆ·å‡­æ®&lt;/a&gt;â€”â€” ä½†å®ƒä¸èƒ½ç”¨äºå®Œæ•´çš„ç”¨æˆ·åˆ°èµ„æºè®¿é—®æ§åˆ¶ã€‚åº”è¯¥ä½¿ç”¨å¤–éƒ¨æˆæƒæ¥å®ç°ç”¨æˆ·å¯¹èµ„æºçš„å®Œå…¨è®¿é—®ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Envoy çš„å¤–éƒ¨æˆæƒ API (ext_authz)&lt;/td&gt;
          &lt;td&gt;æ— æ³•æ‰§è¡Œä»»ä½•é’ˆå¯¹è¯·æ±‚çš„ç­–ç•¥ï¼›ext_authz API åªèƒ½é’ˆå¯¹ L7 æµé‡è¿›è¡Œé…ç½®ã€‚&lt;/td&gt;
          &lt;td&gt;ä½¿ç”¨æ¥è‡ªå¤–éƒ¨æœåŠ¡ï¼ˆä¾‹å¦‚ OPAï¼‰çš„å†³ç­–æ¥æ‰§è¡Œæ¯ä¸ªè¯·æ±‚çš„ç­–ç•¥ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;å¯è§‚æµ‹æ€§&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ—¥å¿—è®°å½•&lt;/td&gt;
          &lt;td&gt;åŸºæœ¬ç½‘ç»œä¿¡æ¯ï¼šç½‘ç»œäº”å…ƒç»„ã€å‘é€ / æ¥æ”¶çš„å­—èŠ‚æ•°ç­‰ã€‚&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage#command-operators&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯·å‚é˜… Envoy æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/td&gt;
          &lt;td&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage#command-operators&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®Œæ•´çš„è¯·æ±‚å…ƒæ•°æ®è®°å½•&lt;/a&gt;ï¼Œä»¥åŠåŸºæœ¬çš„ç½‘ç»œä¿¡æ¯ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;è¿½è¸ª&lt;/td&gt;
          &lt;td&gt;ç›®å‰ä¸è¡Œï¼›æœ€ç»ˆå¯èƒ½ä¸ HBONE ä¸€èµ·ä½¿ç”¨ã€‚&lt;/td&gt;
          &lt;td&gt;Envoy å‚ä¸åˆ†å¸ƒå¼è·Ÿè¸ªã€‚&lt;a href=&#34;https://istio.io/latest/docs/tasks/observability/distributed-tracing/overview/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯·å‚é˜…æœ‰å…³è¿½è¸ªçš„ Istio æ¦‚è¿°&lt;/a&gt;ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æŒ‡æ ‡&lt;/td&gt;
          &lt;td&gt;ä»…é™ TCPï¼ˆå‘é€ / æ¥æ”¶çš„å­—èŠ‚æ•°ã€æ•°æ®åŒ…æ•°ç­‰ï¼‰ã€‚&lt;/td&gt;
          &lt;td&gt;L7 RED æŒ‡æ ‡ï¼šè¯·æ±‚ç‡ã€é”™è¯¯ç‡ã€è¯·æ±‚æŒç»­æ—¶é—´ï¼ˆå»¶è¿Ÿï¼‰ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;æµé‡ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;è´Ÿè½½å‡è¡¡&lt;/td&gt;
          &lt;td&gt;ä»…è¿æ¥çº§åˆ«ã€‚&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/tcp-traffic-shifting/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯·å‚é˜… TCP æµé‡è½¬ç§»ä»»åŠ¡&lt;/a&gt;ã€‚&lt;/td&gt;
          &lt;td&gt;æ ¹æ®è¯·æ±‚ï¼Œå¯ç”¨ä¾‹å¦‚é‡‘ä¸é›€éƒ¨ç½²ã€gRPC æµé‡ç­‰ã€‚&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/traffic-shifting/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯·å‚é˜… HTTP æµé‡è½¬ç§»ä»»åŠ¡&lt;/a&gt;ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ–­è·¯&lt;/td&gt;
          &lt;td&gt;&lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/destination-rule/#ConnectionPoolSettings-TCPSettings&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»…é™ TCP&lt;/a&gt;ã€‚&lt;/td&gt;
          &lt;td&gt;é™¤äº† TCP ä¹‹å¤–çš„ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/destination-rule/#ConnectionPoolSettings-HTTPSettings&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP è®¾ç½®&lt;/a&gt;ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å¼‚å¸¸å€¼æ£€æµ‹&lt;/td&gt;
          &lt;td&gt;å…³äºè¿æ¥å»ºç«‹ / å¤±è´¥ã€‚&lt;/td&gt;
          &lt;td&gt;æ ¹æ®è¯·æ±‚æˆåŠŸ / å¤±è´¥ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;é€Ÿç‡é™åˆ¶&lt;/td&gt;
          &lt;td&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/listeners/network_filters/rate_limit_filter#config-network-filters-rate-limit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»…å¯¹ L4 è¿æ¥æ•°æ®çš„é€Ÿç‡é™åˆ¶ï¼Œåœ¨è¿æ¥å»ºç«‹&lt;/a&gt;æ—¶ï¼Œå…·æœ‰å…¨å±€å’Œæœ¬åœ°é€Ÿç‡é™åˆ¶é€‰é¡¹ã€‚&lt;/td&gt;
          &lt;td&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/rate_limit_filter#config-http-filters-rate-limit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;L7 è¯·æ±‚å…ƒæ•°æ®çš„é€Ÿç‡é™åˆ¶&lt;/a&gt;ï¼Œæ¯ä¸ªè¯·æ±‚ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;è¶…æ—¶&lt;/td&gt;
          &lt;td&gt;ä»…å»ºç«‹è¿æ¥ï¼ˆé€šè¿‡æ–­è·¯è®¾ç½®é…ç½®è¿æ¥ä¿æŒæ´»åŠ¨ï¼‰ã€‚&lt;/td&gt;
          &lt;td&gt;æ ¹æ®è¦æ±‚ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;é‡è¯•&lt;/td&gt;
          &lt;td&gt;é‡è¯•è¿æ¥å»ºç«‹ã€‚&lt;/td&gt;
          &lt;td&gt;æ¯æ¬¡è¯·æ±‚å¤±è´¥æ—¶é‡è¯•ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ•…éšœæ³¨å…¥&lt;/td&gt;
          &lt;td&gt;ä¸é€‚ç”¨â€”â€”æ— æ³•åœ¨ TCP è¿æ¥ä¸Šé…ç½®æ•…éšœæ³¨å…¥ã€‚&lt;/td&gt;
          &lt;td&gt;å®Œæ•´çš„åº”ç”¨ç¨‹åºå’Œè¿æ¥çº§æ•…éšœï¼ˆ&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/fault-injection/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¶…æ—¶ã€å»¶è¿Ÿã€ç‰¹å®šå“åº”ä»£ç &lt;/a&gt;ï¼‰ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æµé‡é•œåƒ&lt;/td&gt;
          &lt;td&gt;ä¸é€‚ç”¨ - ä»… HTTP&lt;/td&gt;
          &lt;td&gt;&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/mirroring/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯¹å¤šä¸ªåç«¯çš„è¯·æ±‚è¿›è¡ŒåŸºäºç™¾åˆ†æ¯”çš„é•œåƒ&lt;/a&gt;ã€‚&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å€¼å¾—è®°ä½çš„æ˜¯ï¼Œè¿è¡Œåœ¨ L7 çš„ä»£ç†å¯ä»¥æ‰§è¡Œ L4 å’Œ L7 åˆ—ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè€Œè¿è¡Œåœ¨ L4 çš„ä»£ç†åªèƒ½æ‰§è¡Œ L4 åˆ—ã€‚é€šè¿‡æ¸…æ¥šåœ°äº†è§£å‘ç”Ÿçš„æƒ…å†µä»¥åŠ L4 ä¸ L7 çš„å±€é™æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ Ambient Mesh ä¸ sidecar æ¨¡å‹ç›¸æ¯”æ‰€åšçš„æƒè¡¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç°åœ¨æˆ‘ä»¬åº”è¯¥ä½¿ç”¨-ambient-mesh-å—è¿˜ä¸å¯ä»¥&#34;&gt;ç°åœ¨æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ Ambient Mesh å—ï¼Ÿï¼ˆè¿˜ä¸å¯ä»¥ï¼‰&lt;/h2&gt;
&lt;p&gt;æˆªè‡³ 2022 å¹´ 9 æœˆå®£å¸ƒï¼ŒAmbient Mesh æ˜¯æ¦‚å¿µçš„å®éªŒè¯æ˜ã€‚ä»&lt;a href=&#34;https://github.com/istio/istio/tree/experimental-ambient#limitations&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‡ ä¹æ¯ä¸€ä¸ªæŒ‡æ ‡&lt;/a&gt;æ¥çœ‹ï¼Œå®ƒçš„æ€§èƒ½éƒ½æ¯” sidecar æ¨¡å‹å·®ï¼Œè€Œä¸”å®ƒæœ‰å¾ˆå¤š&lt;a href=&#34;https://github.com/istio/istio/tree/experimental-ambient#limitations&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é™åˆ¶&lt;/a&gt;ã€‚Ambient Mesh è¿˜&lt;strong&gt;æ²¡æœ‰å‡†å¤‡å¥½&lt;/strong&gt;åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼ˆå¯¹äºæˆ‘ä»¬çš„å®¢æˆ· â€”â€” å¤§å‹ä¼ä¸šçš„å¹³å°å›¢é˜Ÿ â€”â€” åº”ç”¨ç¨‹åºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¹Ÿç®—ä½œç”Ÿäº§ç¯å¢ƒï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œæˆ‘ä»¬é¢„è®¡éšç€ç¤¾åŒºä¸­çš„å·¥ç¨‹å¸ˆè‡´åŠ›äºéƒ¨ç½²æ¨¡å‹ï¼Œè¿™ç§çŠ¶æ€ä¼šç›¸å¯¹è¿…é€Ÿåœ°å‘ç”Ÿå˜åŒ–ã€‚å®ƒå°†åƒ&lt;a href=&#34;https://istio.io/latest/docs/releases/feature-stages/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‰€æœ‰å…¶ä»– Istio åŠŸèƒ½&lt;/a&gt;ä¸€æ ·é€šè¿‡åŠŸèƒ½é˜¶æ®µè¿›è¡Œã€‚æŸ¥çœ‹&lt;a href=&#34;https://istio.io/latest/docs/releases/feature-stages/#istio-features&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åŠŸèƒ½åˆ—è¡¨&lt;/a&gt;ï¼ŒAmbient Mesh å°†åœ¨ 2023 å¹´æŸä¸ªæ—¶å€™å‡çº§ä¸º Alpha çŠ¶æ€ã€‚æˆ‘ä»¬é¢„è®¡å®ƒä¼šåœ¨ 2023 å¹´æœ«æˆ– 2024 å¹´åˆè¿›å…¥ Beta ç‰ˆ â€”â€” åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬ä¸å»ºè®®å°†å…¶ç”¨äºç”Ÿäº§ç”¨é€”ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äº-service-mesh-å’Œ-istio-çš„-ambient-mesh-å‡è®¾&#34;&gt;å…³äº Service Mesh å’Œ Istio çš„ Ambient Mesh å‡è®¾&lt;/h2&gt;
&lt;p&gt;æ€»ç»“ Ambient Mesh å…¬å‘Šåšå®¢æ–‡ç« ï¼Œè¯¥æ¶æ„çš„æ ¸å¿ƒåŠ¨æœºæ˜¯å‡è®¾ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å‡è®¾&lt;/strong&gt;Envoy çš„ L7 åŠŸèƒ½ä½¿å¾—å°†æ–°åº”ç”¨ç¨‹åºåŠ å…¥ç½‘æ ¼å˜å¾—å…·æœ‰æŒ‘æˆ˜æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡è®¾&lt;/strong&gt;Envoy çš„ L7 åŠŸèƒ½æ˜¯å‘ç° CVE çš„åœ°æ–¹ï¼ˆç»å¤§å¤šæ•° Envoy CVE åœ¨ L7 ä»£ç ä¸­ï¼Œè€Œä¸æ˜¯åœ¨å¤„ç† TLS å’Œè¿æ¥çš„ L4 ä»£ç ä¸­ï¼‰ï¼Œå› æ­¤åœ¨ä¸¥æ ¼çš„ L4 ä»£ç†ä¸­åœ¨èŠ‚ç‚¹çº§åˆ«æŒæœ‰å¤šä¸ª Pod çš„è¯ä¹¦æ˜¯å¯ä»¥æ¥å—çš„ï¼Œè€Œåœ¨èŠ‚ç‚¹çº§åˆ«æ‰§è¡Œ L7 åˆ™ä¸æ˜¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡è®¾&lt;/strong&gt;Sidecar é€šå¸¸ä¼šå¯¼è‡´èµ„æºè¿‡åº¦åˆ†é…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡è®¾&lt;/strong&gt;ä¸€ä¸ªé¢å¤–çš„ç½‘ç»œè·ƒç‚¹æ¯”ä¸€ä¸ªæ‰§è¡Œ L7 è®¡ç®—çš„ Envoy ä¾¿å®œï¼ˆä»ä¸¤ä¸ª L7 sidecar ç§»åŠ¨åˆ°ä¸€ä¸ª L7 è·¯ç‚¹å¢åŠ äº†ä¸€ä¸ªè·ƒç‚¹ï¼Œä½†åˆ é™¤äº†ä¸€ä¸ªæ‰§è¡Œ L7 å¤„ç†çš„ Envoyï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡è®¾&lt;/strong&gt;Istio æœ€æœ‰ä»·å€¼çš„ç‰¹æ€§æ˜¯ä¼ è¾“ä¸­çš„åŠ å¯†ï¼Œå› æ­¤ä¼˜åŒ–ä»¥ç®€åŒ–è¯¥ç”¨ä¾‹æ˜¯å¾ˆæœ‰ä»·å€¼çš„ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ambient-mesh-å‡è®¾å¦‚ä½•åŒ¹é…æˆ‘ä»¬ä¸å®é™…å®¢æˆ·çš„ç»éªŒ&#34;&gt;Ambient Mesh å‡è®¾å¦‚ä½•åŒ¹é…æˆ‘ä»¬ä¸å®é™…å®¢æˆ·çš„ç»éªŒ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä¸ä¸–ç•Œä¸Šä¸€äº›æœ€å¤§çš„ä¼ä¸šå¯†åˆ‡åˆä½œä»¥å®ç°æœåŠ¡ç½‘æ ¼é‡‡ç”¨çš„ç»éªŒå¹¶&lt;strong&gt;ä¸èƒ½å®Œå…¨&lt;/strong&gt;è¯æ˜è¿™äº›æ¿€åŠ±æƒ³æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;L7 åŠŸèƒ½&lt;/strong&gt;ï¼šç½‘æ ¼çš„æŸäº› L7 åŠŸèƒ½&lt;strong&gt;å¯èƒ½&lt;/strong&gt;ä¼šä½¿åº”ç”¨ç¨‹åºæ›´éš¾é‡‡ç”¨ï¼Œä½†æ ¹æ®æˆ‘ä»¬çš„ç»éªŒï¼Œç”±äºè¿æ¥å¯¿å‘½çš„å˜åŒ–æˆ–åŒé‡åŠ å¯†é—®é¢˜ï¼Œåº”ç”¨ç¨‹åºè½½å…¥ä¸­ä¼šå‡ºç°æ›´å¤šçš„ä¸­æ–­ã€‚æ— è®º sidecar æˆ–èŠ‚ç‚¹çº§ä»£ç†å¦‚ä½•ï¼Œè¿™äº›é—®é¢˜éƒ½ä¼šç±»ä¼¼åœ°è¡¨ç°å‡ºæ¥ï¼Œä½†å¯¹äºåº”ç”¨ç¨‹åºå›¢é˜Ÿåœ¨èŠ‚ç‚¹éƒ¨ç½²æ¨¡å‹ä¸­è¿›è¡Œæ•…éšœæ’é™¤æ›´å…·æŒ‘æˆ˜æ€§ï¼ˆä»–ä»¬é€šå¸¸ç¼ºä¹æ£€æŸ¥ç‰¹æƒ / èŠ‚ç‚¹çº§ç»„ä»¶æ—¥å¿—çš„æƒé™ï¼‰ã€‚è¦æ›´æ·±å…¥åœ°äº†è§£&lt;a href=&#34;https://www.tetrate.io/blog/ebpf-and-sidecars-getting-the-most-performance-and-resiliency-out-of-the-service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;èŠ‚ç‚¹çº§ä»£ç†ä¸ sidecar&lt;/a&gt;ï¼Œè¯·å‚é˜…æˆ‘ä»¬ä¸Šé¢æåˆ°çš„åšå®¢æ–‡ç« ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;L7 CVE&lt;/strong&gt;ï¼Œ&lt;a href=&#34;https://www.cvedetails.com/vulnerability-list/vendor_id-19794/product_id-53798/Envoyproxy-Envoy.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŸ¥çœ‹å®ƒä»¬&lt;/a&gt;ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;33 ä¸ªå’Œ L7 å¤„ç†æœ‰å…³ï¼Œä¸»è¦æ˜¯è§£ææˆ–è€… HTTP å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;å‰©ä¸‹çš„ 12 ä¸ªæ˜¯ L4 æˆ– Envoy å›ºæœ‰çš„ï¼ˆè¿æ¥å¤„ç†ã€è¯ä¹¦å¤„ç†ã€å˜ˆæ‚çš„é‚»å±… DOSã€ç¼“å†²åŒºæº¢å‡ºç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;L7 CVE çš„å¹³å‡ä¸¥é‡æ€§é«˜äºé L7 CVEã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ L7 Envoy ç›¸æ¯”ï¼Œä»… L4 çš„ Envoy &lt;strong&gt;ç¡®å®&lt;/strong&gt;æä¾›äº†æ›´å°çš„æ”»å‡»é¢ï¼Œå› ä¸ºå¯ä»¥åˆ©ç”¨çš„ä»£ç ï¼ˆå’Œ CVEï¼‰æ›´å°‘ã€‚æ”»å‡»é¢æ˜¯å¦è¶³å¤Ÿä½ä»¥è¯æ˜æŒæœ‰èŠ‚ç‚¹ä¸Šæ¯ä¸ª pod çš„èº«ä»½æ˜¯åˆç†çš„ï¼Œè¿˜æœ‰å¾…è§‚å¯Ÿã€‚Ambient Mesh å®‰å…¨æ¨¡å‹çš„å…³é”®åœ¨äºæˆ‘ä»¬å¯¹ ztunnel ç»„ä»¶çš„ä¿¡ä»»ç¨‹åº¦ â€”â€” è¿™æ˜¯ç¤¾åŒºæ‰“ç®—é¦–å…ˆå…³æ³¨çš„ç»„ä»¶ã€‚æ€»ä½“è€Œè¨€ï¼Œä¸ sidecar æ¨¡å‹ç›¸æ¯”ï¼Œambient çš„å®‰å…¨æ¨¡å‹å……å…¶é‡æ˜¯æ¨ªå‘çš„ä¸€æ­¥ï¼Œä½†åœ¨å°†å…¶èå…¥ç°æœ‰å®‰å…¨æ¨¡å‹æ—¶ï¼Œè¾¹ç•Œæ›´éš¾æ¨ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºåˆ©ç”¨ç‡&lt;/strong&gt;ï¼šç¡®å®ï¼Œå¦‚æœæœªé…ç½® pod èµ„æºè¯·æ±‚ï¼Œå¹¶ä¸”æœªä½¿ç”¨&lt;a href=&#34;https://istio.io/latest/docs/ops/best-practices/traffic-management/#cross-namespace-configuration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é…ç½®èµ„æºå¯è§æ€§&lt;/a&gt;æˆ–&lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/sidecar/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sidecar API èµ„æº&lt;/a&gt;ç­‰æŠ€æœ¯ï¼Œsidecar ä¼šå¯¼è‡´èµ„æºåˆ©ç”¨ç‡ä½ä¸‹ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬é€šè¿‡ Sidecar API èµ„æºä¸¥æ ¼æ§åˆ¶èµ„æºå¯è§æ€§å’Œé™åˆ¶é…ç½®èŒƒå›´çš„ Istio éƒ¨ç½²çš„ç»éªŒæ˜¯ï¼Œsidecar èµ„æºåˆ©ç”¨ç‡éå¸¸ä½ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ª sidecar è®¾ç½®æ¯” Istio çš„é»˜è®¤é…ç½®æ–‡ä»¶æ›´å°çš„èµ„æºè¯·æ±‚ã€‚ä¸ºè¿™ç§ç±»å‹çš„é…ç½®æ‰‹åŠ¨ç»´æŠ¤ Sidecar API èµ„æºéå¸¸å…·æœ‰æŒ‘æˆ˜æ€§ â€”â€” è¿™å°±æ˜¯ &lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt; æ ¹æ®æ›´é«˜çº§åˆ«çš„è®¿é—®ç»“æ„è‡ªåŠ¨ç”Ÿæˆå®ƒçš„åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¾ˆé«˜å…´çœ‹åˆ° Ambient éƒ¨ç½²æ¨¡å‹å¦‚ä½•æé«˜èµ„æºåˆ©ç”¨ç‡ â€”â€” ä¸ºç›¸åŒçš„ç½‘æ ¼è¡Œä¸ºéƒ¨ç½²æ›´å°‘çš„ Envoy å…·æœ‰å¾ˆå¤§çš„æ½œåŠ›ï¼Œå› ä¸ºç‹¬ç«‹çš„ Watpoint Envoy é€šå¸¸å¯ä»¥å¤„ç†æ¯”å•ä¸ªæœåŠ¡å®ä¾‹ï¼ˆåŠå…¶ sidecarï¼‰æ›´å¤šçš„æµé‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¢å¤–çš„ç½‘ç»œè·ƒç‚¹ä¸ sidecar&lt;/strong&gt;ï¼šAmbient çš„éƒ¨ç½²æ¨¡å‹æä¾›çš„æœ€æœ‰è¶£çš„å¯èƒ½æ€§ä¹‹ä¸€æ˜¯åœ¨ sidecar æ¶æ„ä¸­ç§»é™¤é¢å¤–çš„ L7 Envoyã€‚å› ä¸ºç½‘æ ¼ä¸­çš„é€šä¿¡æ˜¯ sidecar-to-sidecarï¼Œå¹¶ä¸”å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½åº”ç”¨ L7 ç­–ç•¥ï¼Œæˆ‘ä»¬å¿…é¡»å¯¹æ¯ä¸ªè¯·æ±‚è¿›è¡Œä¸¤æ¬¡ L7 å¤„ç†ã€‚åœ¨ Ambient æ¨¡å¼ä¸‹ï¼Œè¯¥ç­–ç•¥å°†ç”±æœåŠ¡å™¨çš„ Waypoint æ‰§è¡Œ â€”â€” å› æ­¤ L7 å¤„ç†æ¯ä¸ªè¯·æ±‚åªå‘ç”Ÿä¸€æ¬¡ã€‚ä½†æ˜¯ï¼Œåœ¨è¿æ¥çš„ä¸¤ä¾§ä»ç„¶æœ‰ä¸€ä¸ª ztunnel è¿›è¡Œ L4 å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒè¡¡ â€”â€” ç½‘ç»œè·³è·ƒè€Œä¸æ˜¯ Envoy è¿›è¡Œ L7 å¤„ç† â€”â€” æ€»ä½“ä¸Šæ˜¯å¦å€¼å¾—ï¼Œè¿˜æœ‰å¾…è§‚å¯Ÿã€‚å½“ç„¶ï¼Œåœ¨å»¶è¿Ÿä½ä¸”è¿æ¥å¯é çš„åŒä¸€å¯ç”¨åŒºçš„äº‘æä¾›å•†ç½‘ç»œä¸­ï¼Œè¿™å¯èƒ½æ˜¯å€¼å¾—çš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„è®¸å¤šå®¢æˆ·åœ¨æœ¬åœ°å’Œå„ç§çœ‹èµ·æ¥ä¸åƒäº‘æä¾›å•†ç½‘ç»œçš„ç‰©ç†ç«™ç‚¹ä¸Šéƒ¨ç½²äº†æœåŠ¡ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;mTLS&lt;/strong&gt;ï¼šIstio çš„ä¼ è¾“åŠ å¯†æ¯«æ— ç–‘é—®æ˜¯å…¶æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ã€‚å®ƒç”¨äºï¼ˆ&lt;a href=&#34;https://www.tetrate.io/blog/tetrate-istio-distro-achieves-fips-certification/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»¥ FIPS éªŒè¯çš„å½¢å¼&lt;/a&gt;ï¼‰ç”¨äº&lt;a href=&#34;https://www.tetrate.io/blog/tetrate-first-to-provide-hardened-istio-to-dods-iron-bank/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;FIPS åˆè§„æ€§&lt;/a&gt;ã€&lt;a href=&#34;https://www.tetrate.io/blog/case-study-fico-encryption-pci-compliance-with-istio-service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PCI åˆè§„æ€§&lt;/a&gt;ï¼Œä»¥åŠåœ¨å„ç§å…¶ä»–å®‰å…¨ç¬¬ä¸€çš„ç¯å¢ƒä¸­ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬æŸ¥çœ‹ç½‘æ ¼çš„åŠŸèƒ½æ—¶ï¼Œå•ç‹¬é‡‡ç”¨åŠ å¯†çš„åŸå› å¹¶ä¸å¸¸è§ï¼šé€šå¸¸æ˜¯åŠ å¯†ä¸ L7 ç­–ç•¥ï¼ˆåŒ…æ‹¬æµé‡æ§åˆ¶ï¼‰å’Œå¯è§‚æµ‹æ€§ç›¸ç»“åˆï¼Œæ¿€å‘äº†å¯¹è¯¥æŠ€æœ¯çš„æŠ•èµ„ã€‚æŸ¥çœ‹ä¸Šè¡¨ï¼Œå¾ˆæ˜æ˜¾è¿™äº›åŠŸèƒ½æ— æ³•ä»…é€šè¿‡ ztunnel å®ç° â€”â€” å®ƒä»¬éœ€è¦ L7 Envoyã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬ä»Šå¤©çœ‹åˆ°çš„å¤§å¤šæ•°ç½‘æ ¼ä½¿ç”¨éƒ½éœ€è¦ L7 Envoyã€‚æˆ‘ä»¬å¯¹ä»»ä½•èƒ½å¤Ÿä½¿æœåŠ¡ç½‘æ ¼çš„é‡‡ç”¨æ›´åŠ å®¹æ˜“çš„äº‹æƒ…éƒ½å……æ»¡çƒ­æƒ…ï¼Œä½†æˆ‘ä»¬è¿˜ä¸ç¡®å®š Ambient Mesh çš„éƒ¨ç½²æ¨¡å‹èƒ½å¦èƒ½å…‘ç°è¿™ä¸€æ‰¿è¯ºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å…³äº-ambient-mesh-çš„åˆ†ç¦»æ€è€ƒ&#34;&gt;å…³äº Ambient Mesh çš„åˆ†ç¦»æ€è€ƒ&lt;/h2&gt;
&lt;p&gt;Ambient Mesh æ˜¯å¯¹æ—  sidecar æœåŠ¡ç½‘æ ¼æ¨¡å‹çš„ä¸€ä¸ªæœ‰è¶£çš„å°è¯•ã€‚æˆ‘ä»¬å¾ˆé«˜å…´çœ‹åˆ°å®ƒæ˜¯å¦‚ä½•å‘å±•çš„ï¼Œç‰¹åˆ«æ˜¯å¦‚æœå®ƒæœ‰åŠ©äºæ›´å®¹æ˜“åœ°é‡‡ç”¨ç½‘æ ¼ã€‚åœ¨æŸäº›ç‰¹å®šçš„ç”¨ä¾‹ä¸­ï¼Œæˆ‘ä»¬é¢„è®¡è¿™ç§æ–¹æ³•ä¼šäº§ç”Ÿå¥½å¤„ï¼Œä½†ç°åœ¨è¿˜å¤„äºæ—©æœŸé˜¶æ®µï¼Œè€Œä¸”è¿˜æ²¡æœ‰å†³å®šæƒè¡¡æ˜¯å¦å€¼å¾—ã€‚æ— è®ºå“ªç§æ–¹å¼ï¼ŒAmbient Mesh å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´æ‰èƒ½è€ƒè™‘æŠ•å…¥ç”Ÿäº§ã€‚åœ¨é‚£ä¹‹å‰ï¼Œæ­£å¦‚ä»–ä»¬æ‰€è¯´ï¼Œæ³¨æ„è¿™ä¸ªç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;è¦&lt;a href=&#34;https://istio.tetratelabs.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç«‹å³å¼€å§‹ä½¿ç”¨æœåŠ¡ç½‘æ ¼ï¼ŒTetrate Istio Distro&lt;/a&gt;æ˜¯å®‰è£…ã€ç®¡ç†å’Œå‡çº§ Istio çš„æœ€ç®€å•æ–¹æ³•ã€‚å®ƒæä¾›äº†ç»è¿‡å®¡æŸ¥çš„ Istio ä¸Šæ¸¸å‘è¡Œç‰ˆï¼Œè¯¥å‘è¡Œç‰ˆå·²ç”± Tetrate ä¸ºç‰¹å®šå¹³å°è¿›è¡Œæµ‹è¯•å’Œä¼˜åŒ–ï¼Œä»¥åŠä¸€ä¸ªä¾¿äºè·å–ã€å®‰è£…å’Œé…ç½®å¤šä¸ª Istio ç‰ˆæœ¬çš„ CLIã€‚Tetrate Istio Distro è¿˜ä¸º FedRAMP ç¯å¢ƒæä¾›&lt;a href=&#34;https://www.tetrate.io/blog/tetrate-istio-distro-achieves-fips-certification/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;FIPS è®¤è¯çš„ Istio æ„å»º&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºéœ€è¦ç»Ÿä¸€ä¸”ä¸€è‡´çš„æ–¹å¼æ¥ä¿æŠ¤å’Œç®¡ç†å¤æ‚ã€å¼‚æ„éƒ¨ç½²ç¯å¢ƒä¸­çš„æœåŠ¡å’Œä¼ ç»Ÿå·¥ä½œè´Ÿè½½çš„ä¼ä¸šï¼Œæˆ‘ä»¬æä¾›&lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt;ï¼Œè¿™æ˜¯æˆ‘ä»¬åŸºäº Istio å’Œ Envoy æ„å»ºçš„æ——èˆ°è¾¹ç¼˜åˆ°å·¥ä½œè´Ÿè½½åº”ç”¨ç¨‹åºè¿æ¥å¹³å°ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio æœåŠ¡ç½‘æ ¼ ambient æ¨¡å¼å®‰å…¨è¯¦è§£</title>
      <link>https://cloudnativecn.com/blog/ambient-security/</link>
      <pubDate>Thu, 08 Sep 2022 12:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/ambient-security/</guid>
      <description>&lt;p&gt;æˆ‘ä»¬æœ€è¿‘å‘å¸ƒäº† Istio Ambient Meshï¼ˆè¯‘è€…æ³¨ï¼šç¬”è€…æ›´å€¾å‘äºå°†å…¶ç§°ä¸º Ambient Modeï¼Œå³å¤–å›´æ¨¡å¼ï¼Œä½†è¯‘æ–‡ä¸­ä»ç„¶ä¿ç•™äº† Ambient Mesh çš„å«æ³•ï¼‰ï¼Œå®ƒæ˜¯ Istio çš„æ—  sidecar æ•°æ®å¹³é¢ã€‚å¦‚&lt;a href=&#34;https://cloudnativecn.com/blog/introducing-ambient-mesh/&#34;&gt;å…¬å‘Šåšå®¢ä¸­æ‰€è¿°&lt;/a&gt;ï¼Œæˆ‘ä»¬ä½¿ç”¨ Ambient Mesh è§£å†³çš„é¦–è¦é—®é¢˜æ˜¯ç®€åŒ–æ“ä½œã€æ›´å¹¿æ³›çš„åº”ç”¨ç¨‹åºå…¼å®¹æ€§ã€é™ä½åŸºç¡€è®¾æ–½æˆæœ¬å’Œæé«˜æ€§èƒ½ã€‚åœ¨è®¾è®¡ ambient æ•°æ®å¹³é¢æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ä¸ç‰ºç‰²å®‰å…¨æ€§æˆ–åŠŸèƒ½çš„æƒ…å†µä¸‹ä»”ç»†å¹³è¡¡è¿ç»´ã€æˆæœ¬å’Œæ€§èƒ½æ–¹é¢çš„é—®é¢˜ã€‚éšç€ ambient ç»„ä»¶åœ¨åº”ç”¨ç¨‹åº pod ä¹‹å¤–è¿è¡Œï¼Œå®‰å…¨è¾¹ç•Œå‘ç”Ÿäº†å˜åŒ– â€”â€” æˆ‘ä»¬ç›¸ä¿¡ä¼šå˜å¾—æ›´å¥½ã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»è¿™äº›å®‰å…¨æ€§å˜åŒ–ä»¥åŠå®ƒä»¬ä¸ sidecar éƒ¨ç½²æ¨¡å¼åœ¨å®‰å…¨æ€§æ–¹é¢çš„å¯¹æ¯”ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ambient-mesh-çš„åˆ†å±‚ç¤ºæ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Ambient Mesh çš„åˆ†å±‚ç¤ºæ„å›¾&#34;
           src=&#34;https://cloudnativecn.com/blog/ambient-security/amibent-mesh-layer.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Ambient Mesh çš„åˆ†å±‚ç¤ºæ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›é¡¾ä¸€ä¸‹ï¼ŒIstio Ambient Mesh å¼•å…¥äº†ä¸€ä¸ªåˆ†å±‚ç½‘æ ¼æ•°æ®å¹³é¢ï¼Œå®ƒå…·æœ‰è´Ÿè´£ä¼ è¾“å®‰å…¨å’Œè·¯ç”±çš„å®‰å…¨è¦†ç›–å±‚ï¼Œå¯ä»¥é€‰æ‹©ä¸ºéœ€è¦å®ƒä»¬çš„å‘½åç©ºé—´æ·»åŠ  L7 åŠŸèƒ½ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…&lt;a href=&#34;https://istio.io/latest/blog/2022/introducing-ambient-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¬å‘Šåšå®¢&lt;/a&gt;å’Œ&lt;a href=&#34;https://istio.io/latest/blog/2022/get-started-ambient&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¥é—¨åšå®¢&lt;/a&gt;ã€‚å®‰å…¨è¦†ç›–å±‚åŒ…æ‹¬ä¸€ä¸ªèŠ‚ç‚¹å…±äº«ç»„ä»¶ ztunnelï¼Œå®ƒè´Ÿè´£ L4 é¥æµ‹å’Œéƒ¨ç½²ä¸º DaemonSet çš„ mTLSã€‚ç½‘æ ¼çš„ L7 å±‚ç”± Waypoint ä»£ç†æä¾›ï¼Œå®Œæ•´çš„ L7 Envoy ä»£ç†æŒ‰èº«ä»½/å·¥ä½œè´Ÿè½½ç±»å‹éƒ¨ç½²ã€‚è¿™ç§è®¾è®¡çš„ä¸€äº›åŸºæœ¬åŸåˆ™åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºä¸æ•°æ®å¹³é¢åˆ†ç¦»&lt;/li&gt;
&lt;li&gt;å®‰å…¨è¦†ç›–å±‚çš„ç»„ä»¶ç±»ä¼¼äº CNI&lt;/li&gt;
&lt;li&gt;æ“ä½œç®€å•æ›´åˆ©äºå®‰å…¨&lt;/li&gt;
&lt;li&gt;é¿å…å¤šç§Ÿæˆ· L7 ä»£ç†&lt;/li&gt;
&lt;li&gt;Sidecar ä»ç„¶æ˜¯é¦–é€‰çš„éƒ¨ç½²æ¨¡å¼ä¹‹ä¸€&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åº”ç”¨ç¨‹åºå’Œæ•°æ®å¹³é¢åˆ†ç¦»&#34;&gt;åº”ç”¨ç¨‹åºå’Œæ•°æ®å¹³é¢åˆ†ç¦»&lt;/h2&gt;
&lt;p&gt;å°½ç®¡ Ambient Mesh çš„ä¸»è¦ç›®æ ‡æ˜¯ç®€åŒ–æœåŠ¡ç½‘æ ¼çš„æ“ä½œï¼Œä½†å®ƒä¹Ÿç¡®å®æœ‰åŠ©äºæé«˜å®‰å…¨æ€§ã€‚å¤æ‚æ€§ä¼šæ»‹ç”Ÿæ¼æ´ï¼Œä¼ä¸šåº”ç”¨ç¨‹åºï¼ˆåŠå…¶ä¼ é€’ä¾èµ–é¡¹ã€åº“å’Œæ¡†æ¶ï¼‰æå…¶å¤æ‚ä¸”å®¹æ˜“å‡ºç°æ¼æ´ã€‚ä»å¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘åˆ°åˆ©ç”¨ OSS åº“æˆ–æœ‰ç¼ºé™·çš„å†…éƒ¨å…±äº«åº“ï¼Œæ”»å‡»è€…ï¼ˆæ¥è‡ªå†…éƒ¨æˆ–å¤–éƒ¨ï¼‰çš„ä¸»è¦ç›®æ ‡æ˜¯ç”¨æˆ·çš„åº”ç”¨ç¨‹åºä»£ç ã€‚å¦‚æœåº”ç”¨ç¨‹åºé­åˆ°ç ´åï¼Œå‡­æ®ã€æœºå¯†å’Œå¯†é’¥å°±ä¼šæš´éœ²ç»™æ”»å‡»è€…ï¼ŒåŒ…æ‹¬é‚£äº›å®‰è£…æˆ–å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®ã€‚åœ¨æŸ¥çœ‹ sidecar æ¨¡å‹æ—¶ï¼Œsidecar æ¥ç®¡åº”ç”¨ç¨‹åºä¸­çš„èº«ä»½/å¯†é’¥ææ–™ã€‚åœ¨ Istio ambient æ¨¡å¼ä¸‹ï¼Œæ•°æ®å¹³é¢ç»„ä»¶ä¸ä¼šä¸åº”ç”¨ç¨‹åºè¿è¡Œåœ¨åŒä¸€ä¸ª pod ä¸­ï¼Œå› æ­¤ï¼Œåº”ç”¨ç¨‹åºçš„ä¸­çš„ç§˜å¯†ä¸ä¼šæ³„éœ²ç»™æ•°æ®å¹³é¢ã€‚&lt;/p&gt;
&lt;p&gt;ä½œä¸ºæ¼æ´çš„æ½œåœ¨ç›®æ ‡ï¼ŒEnvoy Proxy æ€ä¹ˆæ ·ï¼ŸEnvoy æ˜¯ä¸€ä¸ªç»è¿‡ä¸¥æ ¼å®¡æŸ¥çš„æå…¶åšå›ºçš„åŸºç¡€è®¾æ–½ï¼Œå¹¶&lt;a href=&#34;https://www.infoq.com/news/2018/12/envoycon-service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨å…³é”®ç¯å¢ƒä¸­å¤§è§„æ¨¡è¿è¡Œ&lt;/a&gt;ï¼ˆä¾‹å¦‚ï¼Œ&lt;a href=&#34;https://cloud.google.com/load-balancing/docs/https&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç”¨äºç”Ÿäº§ä»¥æ”¯æŒ Google çš„ç½‘ç»œ&lt;/a&gt;ï¼‰ã€‚ç„¶è€Œï¼Œç”±äº Envoy æ˜¯è½¯ä»¶ï¼Œå®ƒä¸èƒ½å…å—æ¼æ´çš„å½±å“ã€‚å½“æ¼æ´å‡ºç°æ—¶ï¼ŒEnvoy æœ‰ä¸€ä¸ªå¼ºå¤§çš„ CVE æµç¨‹æ¥è¯†åˆ«å¿«é€Ÿä¿®å¤å®ƒä»¬ï¼Œå¹¶åœ¨å®ƒä»¬äº§ç”Ÿå¹¿æ³›å½±å“ä¹‹å‰å°†è¡¥ä¸æ¨é€ç»™å®¢æˆ·ã€‚&lt;/p&gt;
&lt;p&gt;å›åˆ°å‰é¢â€œå¤æ‚æ€§æ»‹ç”Ÿæ¼æ´â€çš„è¯„è®ºï¼ŒEnvoy Proxy æœ€å¤æ‚çš„éƒ¨åˆ†åœ¨äºå…¶ L7 å¤„ç†ï¼Œäº‹å®ä¸Šï¼Œå†å²ä¸Š Envoy çš„å¤§å¤šæ•°æ¼æ´éƒ½åœ¨å…¶ L7 å¤„ç†å †æ ˆä¸­ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åªå°† Istio ç”¨äº mTLS ä¼šæ€æ ·ï¼Ÿå½“ä½ ä¸ä½¿ç”¨è¯¥åŠŸèƒ½æ—¶ï¼Œä¸ºä»€ä¹ˆè¦å†’é™©éƒ¨ç½²ä¸€ä¸ªæ›´å®¹æ˜“å‘ç”Ÿ CVE çš„æˆç†Ÿ L7 ä»£ç†ï¼Ÿåˆ†ç¦» L4 å’Œ L7 ç½‘æ ¼åŠŸèƒ½åœ¨è¿™é‡Œå¾ˆæœ‰ç”¨ã€‚åœ¨ Sidecar éƒ¨ç½²ä¸­ï¼Œä½ é‡‡ç”¨æ‰€æœ‰ä»£ç†ï¼Œå³ä½¿ä½ åªä½¿ç”¨ä¸€å°éƒ¨åˆ†åŠŸèƒ½ï¼Œåœ¨ ambient æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æä¾›å®‰å…¨è¦†ç›–å¹¶ä»…æ ¹æ®éœ€è¦åœ¨ L7 ä¸­åˆ†å±‚æ¥é™åˆ¶æš´éœ²ã€‚æ­¤å¤–ï¼ŒL7 ç»„ä»¶å®Œå…¨ç‹¬ç«‹äºåº”ç”¨ç¨‹åºè¿è¡Œï¼Œä¸ä¼šæš´éœ²ä¾›æ”»å‡»é¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å°†-l4-ä¸‹æ¨åˆ°-cni&#34;&gt;å°† L4 ä¸‹æ¨åˆ° CNI&lt;/h2&gt;
&lt;p&gt;Ambient æ•°æ®å¹³é¢çš„ L4 ç»„ä»¶ä½œä¸º DaemonSet è¿è¡Œï¼Œæˆ–è€…è¯´æ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªã€‚è¿™æ„å‘³ç€å®ƒæ˜¯åœ¨ç‰¹å®šèŠ‚ç‚¹ä¸Šè¿è¡Œçš„æ‰€æœ‰ Pod çš„å…±äº«åŸºç¡€æ¶æ„ã€‚è¿™ä¸ªç»„ä»¶ç‰¹åˆ«æ•æ„Ÿï¼Œåº”è¯¥ä¸èŠ‚ç‚¹ä¸Šçš„ä»»ä½•å…¶ä»–å…±äº«ç»„ä»¶ï¼ˆä¾‹å¦‚ä»»ä½• CNI ä»£ç†ã€kube-proxyã€kubelet ç”šè‡³ Linux å†…æ ¸ï¼‰å¤„äºåŒä¸€çº§åˆ«ã€‚æ¥è‡ªå·¥ä½œè´Ÿè½½çš„æµé‡è¢«é‡å®šå‘åˆ° ztunnelï¼Œztunnel ç„¶åè¯†åˆ«å·¥ä½œè´Ÿè½½å¹¶é€‰æ‹©æ­£ç¡®çš„è¯ä¹¦æ¥ä»£è¡¨ mTLS è¿æ¥ä¸­çš„å·¥ä½œè´Ÿè½½ã€‚&lt;/p&gt;
&lt;p&gt;ztunnel ä¸ºæ¯ä¸ª pod ä½¿ç”¨ä¸€ä¸ªç‹¬ç‰¹çš„å‡­è¯ï¼Œåªæœ‰å½“ pod åœ¨å½“å‰èŠ‚ç‚¹ä¸Šè¿è¡Œæ—¶æ‰ä¼šè¢«å‘å‡ºã€‚è¿™ç¡®ä¿äº†è¢«ç ´åçš„ ztunnel çš„çˆ†ç‚¸åŠå¾„â€”â€”åªæœ‰è°ƒåº¦åˆ°å½“å‰èŠ‚ç‚¹ä¸Šçš„ pod çš„å‡­è¯å¯ä»¥è¢«ç›—ã€‚è¿™æ˜¯ä¸€ä¸ªç±»ä¼¼äºå…¶ä»–å®ç°è‰¯å¥½çš„å…±äº«èŠ‚ç‚¹åŸºç¡€è®¾æ–½çš„å±æ€§ï¼ŒåŒ…æ‹¬å…¶ä»–å®‰å…¨ CNI å®ç°ã€‚ztunnel ä¸ä½¿ç”¨é›†ç¾¤èŒƒå›´æˆ–æ¯ä¸ªèŠ‚ç‚¹çš„å‡­è¯ï¼Œå¦‚æœè¢«ç›—ï¼Œå¯èƒ½ä¼šç«‹å³å±åŠé›†ç¾¤ä¸­çš„æ‰€æœ‰åº”ç”¨æµé‡ï¼Œé™¤éè¿™äº›åº”ç”¨ä¹Ÿå®æ–½å¤æ‚çš„äºŒçº§æˆæƒæœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬å°†å…¶ä¸ sidecar æ¨¡å¼è¿›è¡Œæ¯”è¾ƒï¼Œæˆ‘ä»¬ä¼šæ³¨æ„åˆ° ztunnel æ˜¯å…±äº«çš„ï¼Œå®ƒçš„æš´éœ²å¯èƒ½å¯¼è‡´èŠ‚ç‚¹ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºçš„èº«ä»½æ³„éœ²ã€‚ä½†æ˜¯ï¼Œè¯¥ç»„ä»¶ä¸­å‡ºç° CVE çš„å¯èƒ½æ€§ä½äº Istio sidecarï¼Œå› ä¸ºæ”»å‡»é¢å¤§å¤§å‡å°‘ï¼ˆä»… L4 å¤„ç†ï¼‰ï¼›ztunnel ä¸åšä»»ä½• L7 å¤„ç†ã€‚æ­¤å¤–ï¼Œsidecar ä¸­çš„ CVEï¼ˆå…·æœ‰æ›´å¤§çš„ L7 æ”»å‡»é¢ï¼‰å¹¶æ²¡æœ‰çœŸæ­£åŒ…å«åœ¨å—åˆ°æŸå®³çš„ç‰¹å®šå·¥ä½œè´Ÿè½½ä¸­ã€‚Sidecar ä¸­çš„æ‰€æœ‰ä¸¥é‡çš„ CVE éƒ½å¯èƒ½åœ¨ç½‘æ ¼ä¸­çš„ä»»ä½•å·¥ä½œè´Ÿè½½å¤ç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ“ä½œç®€å•æ›´åˆ©äºå®‰å…¨&#34;&gt;æ“ä½œç®€å•æ›´åˆ©äºå®‰å…¨&lt;/h2&gt;
&lt;p&gt;å½’æ ¹ç»“åº•ï¼ŒIstio æ˜¯ä¸€ä¸ªå…³é”®çš„åŸºç¡€è®¾æ–½ï¼Œå¿…é¡»è¿›è¡Œç»´æŠ¤ã€‚Istio ä»£è¡¨åº”ç”¨ç¨‹åºå®æ–½é›¶ä¿¡ä»»ç½‘ç»œå®‰å…¨çš„ä¸€äº›åŸåˆ™å—åˆ°ä¿¡ä»»ï¼ŒæŒ‰è®¡åˆ’æˆ–æŒ‰éœ€æ±‚æ¨å‡ºè¡¥ä¸æ˜¯æœ€é‡è¦çš„ã€‚å¹³å°å›¢é˜Ÿé€šå¸¸æœ‰å¯é¢„æµ‹çš„è¡¥ä¸æˆ–ç»´æŠ¤å‘¨æœŸï¼Œè¿™ä¸åº”ç”¨ç¨‹åºçš„å‘¨æœŸå®Œå…¨ä¸åŒã€‚å½“éœ€è¦æ–°çš„èƒ½åŠ›å’ŒåŠŸèƒ½æ—¶ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šè¢«æ›´æ–°ï¼Œé€šå¸¸æ˜¯é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚è¿™ç§å¯¹åº”ç”¨ç¨‹åºå˜åŒ–ã€å‡çº§ã€æ¡†æ¶å’Œåº“è¡¥ä¸çš„æ–¹æ³•ï¼Œæ˜¯éå¸¸ä¸å¯é¢„æµ‹çš„ï¼Œä¼šè€—è´¹å¤§é‡æ—¶é—´ï¼Œä¸é€‚åˆå®‰å…¨å®è·µã€‚å› æ­¤ï¼Œä¿æŒè¿™äº›å®‰å…¨åŠŸèƒ½æ˜¯å¹³å°çš„ä¸€éƒ¨åˆ†ï¼Œä¸åº”ç”¨ç¨‹åºåˆ†å¼€ï¼Œæœ‰åˆ©äºä¿æŒæ›´å¥½çš„å®‰å…¨æ€åŠ¿ã€‚&lt;/p&gt;
&lt;p&gt;æ­£å¦‚æˆ‘ä»¬åœ¨å…¬å‘Šåšå®¢ä¸­æŒ‡å‡ºçš„ï¼Œç”±äº sidecar çš„ä¾µå…¥æ€§ï¼Œæ“ä½œ sidecar å¯èƒ½ä¼šæ›´åŠ å¤æ‚ï¼ˆæ³¨å…¥ sidecar/æ”¹å˜éƒ¨ç½²æè¿°ï¼Œé‡å¯åº”ç”¨ç¨‹åºï¼Œå®¹å™¨ä¹‹é—´çš„ç«äº‰æ¡ä»¶ç­‰ï¼‰ã€‚å¯¹å¸¦æœ‰ sidecar çš„å·¥ä½œè´Ÿè½½çš„å‡çº§éœ€è¦æ›´å¤šçš„è®¡åˆ’å’Œæ»šåŠ¨é‡å¯ï¼Œå¯èƒ½éœ€è¦åè°ƒï¼Œä»¥é¿å…åº”ç”¨ç¨‹åºå´©æºƒã€‚æœ‰äº† Ambient Meshï¼Œå¯¹ ztunnel çš„å‡çº§å¯ä»¥ä¸ä»»ä½•æ­£å¸¸çš„èŠ‚ç‚¹è¡¥ä¸æˆ–å‡çº§åŒæ—¶è¿›è¡Œï¼Œè€Œ waypoint ä»£ç†æ˜¯ç½‘ç»œçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥æ ¹æ®éœ€è¦å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œå®Œå…¨é€æ˜çš„å‡çº§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é¿å…å¤šç§Ÿæˆ·-l7-ä»£ç†&#34;&gt;é¿å…å¤šç§Ÿæˆ· L7 ä»£ç†&lt;/h2&gt;
&lt;p&gt;æ”¯æŒ L7 åè®®ï¼ˆä¾‹å¦‚ HTTP 1/2/3ã€gRPCã€è§£ææ ‡å¤´ã€å®ç°é‡è¯•ã€åœ¨æ•°æ®å¹³é¢ä¸­ä½¿ç”¨ Wasm æˆ– Lua è¿›è¡Œè‡ªå®šä¹‰ï¼‰æ¯”æ”¯æŒ L4 å¤æ‚å¾—å¤šã€‚å®ç°è¿™äº›è¡Œä¸ºçš„ä»£ç è¦å¤šå¾—å¤šï¼ˆåŒ…æ‹¬ Lua å’Œ Wasm ç­‰ç”¨æˆ·è‡ªå®šä¹‰ä»£ç ï¼‰ï¼Œè¿™ç§å¤æ‚æ€§å¯èƒ½ä¼šå¯¼è‡´æ½œåœ¨çš„æ¼æ´ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼ŒCVE åœ¨è¿™äº› L7 åŠŸèƒ½é¢†åŸŸä¸­å‡ºç°çš„å‡ ç‡æ›´é«˜ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ¯ä¸ªå‘½åç©ºé—´èº«ä»½éƒ½æœ‰è‡ªå·±çš„l7ä»£ç†æ²¡æœ‰å¤šç§Ÿæˆ·ä»£ç†&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ¯ä¸ªå‘½åç©ºé—´/èº«ä»½éƒ½æœ‰è‡ªå·±çš„L7ä»£ç†ï¼›æ²¡æœ‰å¤šç§Ÿæˆ·ä»£ç†&#34;
           src=&#34;https://cloudnativecn.com/blog/ambient-security/l7-function.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ¯ä¸ªå‘½åç©ºé—´/èº«ä»½éƒ½æœ‰è‡ªå·±çš„L7ä»£ç†ï¼›æ²¡æœ‰å¤šç§Ÿæˆ·ä»£ç†
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ ambient mesh ä¸­ï¼Œæˆ‘ä»¬ä¸åœ¨å¤šä¸ªèº«ä»½ä¹‹é—´å…±äº«ä»£ç†ä¸­çš„ L7 å¤„ç†ã€‚æ¯ä¸ªèº«ä»½ï¼ˆKubernetes ä¸­çš„æœåŠ¡è´¦æˆ·ï¼‰éƒ½æœ‰è‡ªå·±ä¸“é—¨çš„ L7 ä»£ç†ï¼ˆwaypoint ä»£ç†ï¼‰ï¼Œè¿™ä¸æˆ‘ä»¬ä½¿ç”¨çš„ sidecar æ¨¡å‹éå¸¸ç›¸ä¼¼ã€‚è¯•å›¾å°†å¤šä¸ªèº«ä»½ã€å¤æ‚çš„ä¸åŒçš„ç­–ç•¥å’Œå®šåˆ¶æ”¾åœ¨ä¸€èµ·ï¼Œä¼šç»™å…±äº«èµ„æºå¢åŠ å¾ˆå¤šå˜æ•°ï¼Œæœ€å¥½çš„æƒ…å†µæ˜¯å¯¼è‡´èµ„æºçš„ä¸å…¬å¹³åˆ†é…ï¼Œæœ€åçš„æƒ…å†µæ˜¯å¯¼è‡´ä»£ç†è¢«å®Œå…¨ç ´åã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-æ¨¡å¼ä»ç„¶æ˜¯é¦–å…ˆçš„éƒ¨ç½²æ¨¡å¼ä¹‹ä¸€&#34;&gt;Sidecar æ¨¡å¼ä»ç„¶æ˜¯é¦–å…ˆçš„éƒ¨ç½²æ¨¡å¼ä¹‹ä¸€&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ç†è§£ï¼Œæœ‰äº›äººå¯¹ sidecar æ¨¡å‹åŠå…¶å·²çŸ¥çš„å®‰å…¨è¾¹ç•Œæ„Ÿåˆ°æ»¡æ„ï¼Œå¹¶å¸Œæœ›ç•™åœ¨è¯¥æ¨¡å‹ä¸Šã€‚Sidecar ä»ç„¶æ˜¯ç½‘æ ¼çš„ä¸€ç­‰å…¬æ°‘ï¼Œå¹³å°æ‰€æœ‰è€…å¯ä»¥é€‰æ‹©ç»§ç»­ä½¿ç”¨å®ƒä»¬ã€‚å¦‚æœå¹³å°æ‰€æœ‰è€…æƒ³åŒæ—¶æ”¯æŒ sidecar å’Œ ambient ä¹Ÿæ˜¯å¯ä»¥ã€‚å…·æœ‰ ambient æ•°æ®å¹³é¢çš„å·¥ä½œè´Ÿè½½å¯ä»¥ä¸éƒ¨ç½²äº† sidecar çš„å·¥ä½œè´Ÿè½½è¿›è¡Œæœ¬åœ°é€šä¿¡ã€‚éšç€äººä»¬æ›´å¥½åœ°äº†è§£ ambient mesh çš„å®‰å…¨æ€åŠ¿ï¼Œæˆ‘ä»¬ç›¸ä¿¡ï¼Œambient å°†æˆä¸º Istio æœåŠ¡ç½‘æ ¼çš„é¦–é€‰æ¨¡å¼ï¼Œè€Œ sidecar åˆ™ç”¨äºç‰¹å®šçš„ä¼˜åŒ–ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio æ—  sidecar ä»£ç†æ•°æ®å¹³é¢ ambient æ¨¡å¼ç®€ä»‹</title>
      <link>https://cloudnativecn.com/blog/introducing-ambient-mesh/</link>
      <pubDate>Thu, 08 Sep 2022 11:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/introducing-ambient-mesh/</guid>
      <description>&lt;p&gt;ä»Šå¤©ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´åœ°ä»‹ç» &lt;strong&gt;Ambient Mesh&lt;/strong&gt;ï¼ˆè¯‘è€…æ³¨ï¼šç¬”è€…æ›´å€¾å‘äºå°†å…¶ç§°ä¸º Ambient Modeï¼Œå³å¤–å›´æ¨¡å¼ï¼‰ï¼Œè¿™æ˜¯ä¸€ç§æ–°çš„ Istio æ•°æ®å¹³é¢æ¨¡å¼ï¼Œæ—¨åœ¨ç®€åŒ–æ“ä½œã€æ‰©å¤§åº”ç”¨å…¼å®¹æ€§å¹¶é™ä½åŸºç¡€è®¾æ–½æˆæœ¬ã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©å°† Ambient Mesh é›†æˆåˆ°å…¶åŸºç¡€è®¾æ–½çš„ç½‘æ ¼æ•°æ®å¹³é¢ï¼Œæ”¾å¼ƒ sidecar ä»£ç†ï¼ŒåŒæ—¶ä¿æŒ Istio çš„é›¶ä¿¡ä»»å®‰å…¨ã€é¥æµ‹å’Œæµé‡ç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚æˆ‘ä»¬æ­£åœ¨ä¸ Istio ç¤¾åŒºåˆ†äº« Ambient Mesh çš„é¢„è§ˆç‰ˆï¼Œæˆ‘ä»¬æ­£åŠªåŠ›åœ¨æœªæ¥å‡ ä¸ªæœˆå†…å°†å…¶æ¨å‘ç”Ÿäº§å°±ç»ªã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-å’Œ-sidecar&#34;&gt;Istio å’Œ Sidecar&lt;/h2&gt;
&lt;p&gt;è‡ªé¡¹ç›®æˆç«‹ä»¥æ¥ï¼ŒIstio æ¶æ„çš„ä¸€ä¸ªå†³å®šæ€§ç‰¹å¾æ˜¯ä½¿ç”¨ sidecarâ€”â€” ä¸åº”ç”¨å®¹å™¨ä¸€èµ·éƒ¨ç½²çš„å¯ç¼–ç¨‹ä»£ç†ã€‚åˆ©ç”¨ sidecarï¼Œä¸éœ€è¦å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œé‡å¤§è°ƒæ•´å³å¯ä»¥äº«å—æœåŠ¡ç½‘æ ¼å¸¦æ¥çš„å¥½å¤„ï¼Œçœå»è¿ç»´çš„è´Ÿæ‹…ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-çš„ä¼ ç»Ÿæ¨¡å¼æ˜¯å°†-envoy-ä»£ç†ä½œä¸º-sidecar-éƒ¨ç½²åœ¨å·¥ä½œè´Ÿè½½çš„-pod-ä¸­&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio çš„ä¼ ç»Ÿæ¨¡å¼æ˜¯å°† Envoy ä»£ç†ä½œä¸º sidecar éƒ¨ç½²åœ¨å·¥ä½œè´Ÿè½½çš„ pod ä¸­ã€‚&#34; srcset=&#34;
               /blog/introducing-ambient-mesh/e6c9d24ely1h5yyo2mg1bj21wj0u0gp0_hu_750b21dad7b695b2.webp 400w,
               /blog/introducing-ambient-mesh/e6c9d24ely1h5yyo2mg1bj21wj0u0gp0_hu_30cfe293e48724c8.webp 760w,
               /blog/introducing-ambient-mesh/e6c9d24ely1h5yyo2mg1bj21wj0u0gp0_hu_aa816a805cd4aafb.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/introducing-ambient-mesh/e6c9d24ely1h5yyo2mg1bj21wj0u0gp0_hu_750b21dad7b695b2.webp&#34;
               width=&#34;760&#34;
               height=&#34;333&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio çš„ä¼ ç»Ÿæ¨¡å¼æ˜¯å°† Envoy ä»£ç†ä½œä¸º sidecar éƒ¨ç½²åœ¨å·¥ä½œè´Ÿè½½çš„ pod ä¸­ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è™½ç„¶ sidecar æ¯”èµ·é‡æ„åº”ç”¨ç¨‹åºæœ‰æ˜¾è‘—çš„ä¼˜åŠ¿ï¼Œä½†å®ƒä»¬å¹¶æ²¡æœ‰åœ¨åº”ç”¨ç¨‹åºå’Œ Istio æ•°æ®å¹³é¢ä¹‹é—´æä¾›ä¸€ä¸ªå®Œç¾çš„åˆ†ç¦»ã€‚è¿™å¯¼è‡´äº†ä¸€äº›é™åˆ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¾µå…¥æ€§&lt;/strong&gt;ï¼šsidecar å¿…é¡»é€šè¿‡ä¿®æ”¹å…¶ Kubernetes pod é…ç½®å’Œé‡å®šå‘ pod å†…çš„æµé‡æ¥ &lt;strong&gt;æ³¨å…¥&lt;/strong&gt; åº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œå®‰è£…æˆ–å‡çº§ sidecar éœ€è¦é‡æ–°å¯åŠ¨åº”ç”¨ podï¼Œè¿™å¯¹å·¥ä½œè´Ÿè½½æ¥è¯´å¯èƒ½æ˜¯ç ´åæ€§çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºåˆ©ç”¨ç‡ä½&lt;/strong&gt;ï¼šç”±äºåœ¨æ¯ä¸ªå·¥ä½œè´Ÿè½½ pod éƒ½æ³¨å…¥äº† sidecar ä»£ç†ï¼Œpod å¿…é¡»ä¸º sidecar ä¿ç•™è¶³å¤Ÿçš„ CPU å’Œå†…å­˜ï¼Œè¿™å¯èƒ½å¯¼è‡´æ•´ä¸ªé›†ç¾¤çš„èµ„æºåˆ©ç”¨ç‡ä¸‹é™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµé‡ä¸­æ–­&lt;/strong&gt;ï¼šæµé‡æ•è·å’Œ HTTP å¤„ç†ï¼Œé€šå¸¸ç”± Istio çš„ sidecar å®Œæˆï¼Œè®¡ç®—æˆæœ¬å¾ˆé«˜ï¼Œå¯èƒ½ä¼šç ´åä¸€äº›å…·æœ‰ä¸ç¬¦åˆ HTTP å®ç°çš„åº”ç”¨ç¨‹åºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è™½ç„¶ sidecar æœ‰å®ƒçš„ç”¨æ­¦ä¹‹åœ°ï¼Œåé¢ä¼šæœ‰æ›´å¤šçš„ä»‹ç» â€”â€” ä½†æˆ‘ä»¬è®¤ä¸ºéœ€è¦æœ‰ä¸€ä¸ªä¾µå…¥æ€§æ›´ä½ã€æ›´å®¹æ˜“çš„é€‰æ‹©ï¼Œè¿™å°†æ›´é€‚åˆè®¸å¤šæœåŠ¡ç½‘æ ¼ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åˆ†å±‚&#34;&gt;åˆ†å±‚&lt;/h2&gt;
&lt;p&gt;ä¼ ç»Ÿä¸Šï¼ŒIstio åœ¨å•ä¸€çš„æ¶æ„ç»„ä»¶ä¸­å®ç°äº†æ‰€æœ‰çš„æ•°æ®å¹³é¢åŠŸèƒ½ï¼Œä»åŸºæœ¬çš„åŠ å¯†åˆ°é«˜çº§çš„ L7 ç­–ç•¥ï¼Œè¿™å°±æ˜¯ sidecarã€‚åœ¨å®è·µä¸­ï¼Œè¿™ä½¿å¾— sidecar æˆä¸ºä¸€ä¸ªå…¨æœ‰æˆ–å…¨æ— çš„ä¸»å¼ ã€‚å³ä½¿å·¥ä½œè´Ÿè½½åªéœ€è¦ç®€å•çš„ä¼ è¾“å®‰å…¨ï¼Œç®¡ç†å‘˜ä»ç„¶éœ€è¦æ‰¿æ‹…éƒ¨ç½²å’Œç»´æŠ¤ sidecar çš„è¿è¥æˆæœ¬ã€‚Sidecar å¯¹æ¯ä¸ªå·¥ä½œè´Ÿè½½éƒ½æœ‰å›ºå®šçš„è¿è¥æˆæœ¬ï¼Œæ— æ³•æ ¹æ®ç”¨ä¾‹çš„å¤æ‚æ€§è¿›è¡Œæ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;Ambient Mesh é‡‡å–äº†ä¸€ç§ä¸åŒçš„æ–¹æ³•ã€‚å®ƒå°† Istio çš„åŠŸèƒ½åˆ†æˆä¸¤ä¸ªä¸åŒçš„å±‚æ¬¡ã€‚åœ¨åº•å±‚ï¼Œæœ‰ä¸€ä¸ªå®‰å…¨è¦†ç›–å±‚ï¼Œå¤„ç†æµé‡çš„è·¯ç”±å’Œé›¶ä¿¡ä»»å®‰å…¨ã€‚åœ¨è¿™ä¹‹ä¸Šï¼Œå½“éœ€è¦æ—¶ï¼Œç”¨æˆ·å¯ä»¥å¯ç”¨ L7 å¤„ç†ï¼Œä»¥è·å¾— Istio çš„å…¨éƒ¨åŠŸèƒ½ã€‚L7 å¤„ç†æ¨¡å¼è™½ç„¶æ¯”å®‰å…¨è¦†ç›–å±‚æ›´é‡ï¼Œä½†ä»ä½œä¸ºåŸºç¡€è®¾æ–½çš„ä¸€ä¸ªå¤–å›´ç»„ä»¶è¿è¡Œï¼Œä¸éœ€è¦å¯¹åº”ç”¨ pod è¿›è¡Œä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ambient-mesh-åˆ†å±‚&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Ambient Mesh åˆ†å±‚&#34;
           src=&#34;https://cloudnativecn.com/blog/introducing-ambient-mesh/ambient-mesh-layers.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Ambient Mesh åˆ†å±‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™ç§åˆ†å±‚æ–¹æ³•ä½¿ç”¨æˆ·èƒ½å¤Ÿä»¥æ›´å¤šçš„å¢é‡æ–¹å¼é‡‡ç”¨ Istioï¼Œä»æ— ç½‘æ ¼åˆ°å®‰å…¨è¦†ç›–ï¼Œå†åˆ°å®Œå…¨çš„ L7 å¤„ç†ï¼Œæ ¹æ®éœ€è¦ä»¥æ¯ä¸ªå‘½åç©ºé—´ä¸ºåŸºç¡€è¿›è¡Œå¹³ç¨³è¿‡æ¸¡ã€‚æ­¤å¤–ï¼Œåœ¨ä¸åŒæ°›å›´æ¨¡å¼ä¸‹è¿è¡Œçš„å·¥ä½œè´Ÿè½½ï¼Œæˆ–ä¸ sidecar æ— ç¼äº’é€šï¼Œå…è®¸ç”¨æˆ·æ ¹æ®éšæ—¶é—´å˜åŒ–çš„ç‰¹å®šéœ€æ±‚æ¥æ··åˆå’ŒåŒ¹é…èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ„å»º Ambient Mesh&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Ambient Mesh ä½¿ç”¨ä¸€ä¸ªå…±äº«ä»£ç†ï¼ˆagentï¼‰ï¼Œåœ¨ Kubernetes é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œã€‚è¿™ä¸ªä»£ç†æ˜¯ä¸€ä¸ªé›¶ä¿¡ä»»éš§é“ï¼ˆztunnelï¼‰ï¼Œå®ƒçš„ä¸»è¦èŒè´£æ˜¯å®‰å…¨åœ°è¿æ¥å’ŒéªŒè¯ç½‘æ ¼å†…çš„å…ƒç´ ã€‚èŠ‚ç‚¹ä¸Šçš„ç½‘ç»œå †æ ˆå°†å‚ä¸å·¥ä½œè´Ÿè½½çš„æ‰€æœ‰æµé‡é€šè¿‡æœ¬åœ° ztunnel ä»£ç†é‡å®šå‘ã€‚è¿™å°† Istio çš„æ•°æ®å¹³é¢ä¸åº”ç”¨ç¨‹åºçš„å…³æ³¨ç‚¹å®Œå…¨åˆ†å¼€ï¼Œæœ€ç»ˆå…è®¸è¿è¥äººå‘˜å¯ç”¨ã€ç¦ç”¨ã€æ‰©å±•å’Œå‡çº§æ•°æ®å¹³é¢è€Œä¸å¹²æ‰°åº”ç”¨ç¨‹åºã€‚ztunnel ä¸å¯¹å·¥ä½œè´Ÿè½½æµé‡è¿›è¡Œ L7 å¤„ç†ï¼Œä½¿å…¶æ˜æ˜¾æ¯” sidecar ç²¾ç®€ã€‚è¿™å¤§å¤§é™ä½äº†å¤æ‚æ€§å’Œç›¸å…³èµ„æºçš„ä½¿ç”¨æˆæœ¬ï¼Œä½¿å®ƒé€‚åˆä½œä¸ºå…±äº«åŸºç¡€è®¾æ–½äº¤ä»˜ã€‚&lt;/p&gt;
&lt;p&gt;Ztunnel å®ç°äº†æœåŠ¡ç½‘æ ¼çš„æ ¸å¿ƒåŠŸèƒ½ï¼šé›¶ä¿¡ä»»ã€‚å½“ä¸ºå‘½åç©ºé—´å¯ç”¨ Ambient æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå®‰å…¨è¦†ç›–å±‚ã€‚å®ƒä¸ºå·¥ä½œè´Ÿè½½æä¾› mTLSã€é¥æµ‹ã€è®¤è¯å’Œ L4 æˆæƒï¼Œè€Œæ— éœ€ç»ˆæ­¢æˆ–è§£æ HTTPã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ambient-mesh-ä½¿ç”¨ä¸€ä¸ªå…±äº«çš„æ¯ä¸ªèŠ‚ç‚¹çš„-ztunnel-æ¥æä¾›ä¸€ä¸ªé›¶ä¿¡ä»»çš„å®‰å…¨è¦†ç›–&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Ambient mesh ä½¿ç”¨ä¸€ä¸ªå…±äº«çš„ã€æ¯ä¸ªèŠ‚ç‚¹çš„ ztunnel æ¥æä¾›ä¸€ä¸ªé›¶ä¿¡ä»»çš„å®‰å…¨è¦†ç›–ã€‚&#34; srcset=&#34;
               /blog/introducing-ambient-mesh/e6c9d24ely1h5z19731yhj21wj0u040v_hu_65864a37610371c0.webp 400w,
               /blog/introducing-ambient-mesh/e6c9d24ely1h5z19731yhj21wj0u040v_hu_9efe1520b5478d25.webp 760w,
               /blog/introducing-ambient-mesh/e6c9d24ely1h5z19731yhj21wj0u040v_hu_6249f9a98476a6f3.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/introducing-ambient-mesh/e6c9d24ely1h5z19731yhj21wj0u040v_hu_65864a37610371c0.webp&#34;
               width=&#34;760&#34;
               height=&#34;333&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Ambient mesh ä½¿ç”¨ä¸€ä¸ªå…±äº«çš„ã€æ¯ä¸ªèŠ‚ç‚¹çš„ ztunnel æ¥æä¾›ä¸€ä¸ªé›¶ä¿¡ä»»çš„å®‰å…¨è¦†ç›–ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨å¯ç”¨ Ambient Mesh å’Œåˆ›å»ºå®‰å…¨è¦†ç›–åï¼Œå¯ä»¥é…ç½®å‘½åç©ºé—´ä»¥åˆ©ç”¨ L7 åŠŸèƒ½ã€‚è¿™å…è®¸å‘½åç©ºé—´å®ç°å…¨å¥—çš„ Istio åŠŸèƒ½ï¼ŒåŒ…æ‹¬ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/virtual-service/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Virtual Service API&lt;/a&gt;ã€&lt;a href=&#34;https://istio.io/latest/docs/reference/config/telemetry/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;L7 é¥æµ‹&lt;/a&gt;å’Œ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/security/authorization-policy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;L7 æˆæƒç­–ç•¥&lt;/a&gt;ã€‚ä»¥è¿™ç§æ¨¡å¼è¿è¡Œçš„å‘½åç©ºé—´ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªåŸºäº Envoy çš„ &lt;strong&gt;Waypoint proxy&lt;/strong&gt;ï¼ˆè·¯å¾„ç‚¹ä»£ç†ï¼‰æ¥å¤„ç†è¯¥å‘½åç©ºé—´çš„å·¥ä½œè´Ÿè½½çš„ L7 å¤„ç†ã€‚Istio çš„æ§åˆ¶å¹³é¢å°†é›†ç¾¤ä¸­çš„ ztunnel é…ç½®ä¸ºé€šè¿‡ waypoint ä»£ç†ä¼ é€’æ‰€æœ‰éœ€è¦ L7 å¤„ç†çš„æµé‡ã€‚é‡è¦çš„æ˜¯ï¼Œä» Kubernetes çš„è§’åº¦æ¥çœ‹ï¼Œwaypoint ä»£ç†åªæ˜¯æ™®é€šçš„ podï¼Œå¯ä»¥åƒå…¶ä»– Kubernetes éƒ¨ç½²ä¸€æ ·è¿›è¡Œè‡ªåŠ¨æ‰©å±•ã€‚æˆ‘ä»¬é¢„è®¡è¿™å°†ä¸ºç”¨æˆ·èŠ‚çœå¤§é‡èµ„æºï¼Œå› ä¸ºè·¯å¾„ä»£ç†å¯ä»¥è‡ªåŠ¨æ‰©å±•ï¼Œä»¥é€‚åº”å®ƒä»¬æ‰€æœåŠ¡çš„å‘½åç©ºé—´çš„å®æ—¶æµé‡éœ€æ±‚ï¼Œè€Œä¸æ˜¯è¿è¥äººå‘˜é¢„æœŸçš„æœ€å¤§æœ€åæƒ…å†µä¸‹çš„è´Ÿè½½ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å½“éœ€è¦é¢å¤–çš„åŠŸèƒ½æ—¶ambient-mesh-ä¼šéƒ¨ç½²è·¯å¾„ä»£ç†ztunnel-é€šè¿‡è¿™äº›ä»£ç†è¿›è¡Œè¿æ¥ä»¥æ‰§è¡Œç­–ç•¥&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å½“éœ€è¦é¢å¤–çš„åŠŸèƒ½æ—¶ï¼ŒAmbient Mesh ä¼šéƒ¨ç½²è·¯å¾„ä»£ç†ï¼ŒZtunnel é€šè¿‡è¿™äº›ä»£ç†è¿›è¡Œè¿æ¥ä»¥æ‰§è¡Œç­–ç•¥ã€‚&#34; srcset=&#34;
               /blog/introducing-ambient-mesh/e6c9d24ely1h5yzsd8vv8j21wj0u00vx_hu_b4a3d2f26eecc252.webp 400w,
               /blog/introducing-ambient-mesh/e6c9d24ely1h5yzsd8vv8j21wj0u00vx_hu_1e9cb4b2afd3e7c7.webp 760w,
               /blog/introducing-ambient-mesh/e6c9d24ely1h5yzsd8vv8j21wj0u00vx_hu_2baa03696ddb9dd4.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/introducing-ambient-mesh/e6c9d24ely1h5yzsd8vv8j21wj0u00vx_hu_b4a3d2f26eecc252.webp&#34;
               width=&#34;760&#34;
               height=&#34;333&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å½“éœ€è¦é¢å¤–çš„åŠŸèƒ½æ—¶ï¼ŒAmbient Mesh ä¼šéƒ¨ç½²è·¯å¾„ä»£ç†ï¼ŒZtunnel é€šè¿‡è¿™äº›ä»£ç†è¿›è¡Œè¿æ¥ä»¥æ‰§è¡Œç­–ç•¥ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Ambient Mesh ä½¿ç”¨ &lt;strong&gt;HTTP CONNECT over mTLS&lt;/strong&gt; æ¥å®ç°å…¶å®‰å…¨éš§é“ï¼Œå¹¶åœ¨è·¯å¾„ä¸­æ’å…¥ waypoint ä»£ç†ï¼Œè¿™ç§æ¨¡å¼æˆ‘ä»¬ç§°ä¹‹ä¸º &lt;strong&gt;HBONE&lt;/strong&gt;ï¼ˆHTTP-Based Overlay Network Environmentï¼ŒåŸºäº HTTP çš„é‡å ç½‘ç»œç¯å¢ƒï¼‰ã€‚HBONE æä¾›äº†æ¯” TLS æœ¬èº«æ›´å¹²å‡€çš„æµé‡å°è£…ï¼ŒåŒæ—¶å®ç°äº†ä¸æ™®é€šè´Ÿè½½å‡è¡¡å™¨åŸºç¡€è®¾æ–½çš„äº’æ“ä½œæ€§ã€‚é»˜è®¤ä½¿ç”¨ FIPS æ„å»ºï¼Œä»¥æ»¡è¶³åˆè§„æ€§éœ€æ±‚ã€‚å…³äº HBONE çš„æ›´å¤šç»†èŠ‚ï¼Œå…¶åŸºäºæ ‡å‡†çš„æ–¹æ³•ï¼Œä»¥åŠ UDP å’Œå…¶ä»–é TCP åè®®çš„è®¡åˆ’ï¼Œå°†åœ¨æœªæ¥çš„åšå®¢ä¸­æä¾›ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸€ä¸ªç½‘æ ¼ä¸­æ··åˆ sidecar å’Œ ambientï¼Œä¸ä¼šå¯¹ç³»ç»Ÿçš„èƒ½åŠ›æˆ–å®‰å…¨å±æ€§å¸¦æ¥é™åˆ¶ã€‚Istio æ§åˆ¶å¹³é¢ç¡®ä¿ç­–ç•¥çš„æ­£ç¡®æ‰§è¡Œï¼Œæ— è®ºé€‰æ‹©ä½•ç§éƒ¨ç½²æ¨¡å¼ã€‚Ambient åªæ˜¯å¼•å…¥äº†ä¸€ä¸ªå…·æœ‰æ›´å¥½çš„äººæœºå·¥ç¨‹å­¦å’Œæ›´å¤šçµæ´»æ€§çš„é€‰é¡¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆæœ¬åœ°èŠ‚ç‚¹ä¸Šæ²¡æœ‰-l7-å¤„ç†&#34;&gt;ä¸ºä»€ä¹ˆæœ¬åœ°èŠ‚ç‚¹ä¸Šæ²¡æœ‰ L7 å¤„ç†ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Ambient ç½‘æ ¼åœ¨èŠ‚ç‚¹ä¸Šä½¿ç”¨ä¸€ä¸ªå…±äº«çš„ ztunnel ä»£ç†ï¼Œå®ƒå¤„ç†ç½‘æ ¼çš„é›¶ä¿¡ä»»æ–¹é¢ï¼Œè€Œ L7 å¤„ç†å‘ç”Ÿåœ¨å•ç‹¬è°ƒåº¦çš„ pod ä¸­çš„ waypoint ä»£ç†ã€‚ä¸ºä»€ä¹ˆè¦è´¹å°½å¿ƒæœºåœ°è¿›è¡Œè½¬æ¥ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨èŠ‚ç‚¹ä¸Šä½¿ç”¨ä¸€ä¸ªå…±äº«çš„å®Œæ•´çš„ L7 ä»£ç†ï¼Ÿè¿™æœ‰å‡ ä¸ªåŸå› ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Envoy æœ¬è´¨ä¸Šä¸æ˜¯å¤šç§Ÿæˆ·çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯¹åœ¨ä¸€ä¸ªå…±äº«å®ä¾‹ä¸­æ··åˆæ¥è‡ªå¤šä¸ªæ— çº¦æŸç§Ÿæˆ·çš„ L7 æµé‡çš„å¤æ‚å¤„ç†è§„åˆ™æœ‰å®‰å…¨æ–¹é¢çš„æ‹…å¿§ã€‚é€šè¿‡ä¸¥æ ¼é™åˆ¶ L4 å¤„ç†ï¼Œæˆ‘ä»¬å¤§å¤§å‡å°‘äº†æ¼æ´çš„åŠå¾„ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ waypoint ä»£ç†æ‰€éœ€çš„ L7 å¤„ç†ç›¸æ¯”ï¼Œztunnel æ‰€æä¾›çš„ mTLS å’Œ L4 åŠŸèƒ½éœ€è¦çš„ CPU å’Œå†…å­˜å ç”¨è¦å°å¾—å¤šã€‚é€šè¿‡å°† waypoint ä»£ç†ä½œä¸ºä¸€ä¸ªå…±äº«çš„å‘½åç©ºé—´èµ„æºæ¥è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¯¥å‘½åç©ºé—´çš„éœ€æ±‚æ¥ç‹¬ç«‹æ‰©å±•å®ƒä»¬ï¼Œå…¶æˆæœ¬ä¸ä¼šä¸å…¬å¹³åœ°åˆ†é…ç»™ä¸ç›¸å…³çš„ç§Ÿæˆ·ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡å‡å°‘ ztunnel çš„èŒƒå›´ï¼Œæˆ‘ä»¬å…è®¸å®ƒè¢«å…¶ä»–å®‰å…¨éš§é“çš„å®ç°æ‰€å–ä»£ï¼Œè¿™äº›å®ç°å¯ä»¥æ»¡è¶³ä¸€ä¸ªæ˜ç¡®çš„äº’æ“ä½œæ€§åè®®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä½†æ˜¯é‚£äº›é¢å¤–çš„è·³æ•°å‘¢&#34;&gt;ä½†æ˜¯é‚£äº›é¢å¤–çš„è·³æ•°å‘¢ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;åœ¨ Ambient ç½‘æ ¼ä¸­ï¼Œwaypoint ä¸ä¸€å®šä¿è¯ä¸å®ƒæ‰€æœåŠ¡çš„å·¥ä½œè´Ÿè½½åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚è™½ç„¶ä¹ä¸€çœ‹ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªæ€§èƒ½é—®é¢˜ï¼Œä½†æˆ‘ä»¬ç›¸ä¿¡ï¼Œå»¶è¿Ÿæœ€ç»ˆå°†ä¸ Istio ç›®å‰çš„ sidecar å®ç°ä¿æŒä¸€è‡´ã€‚æˆ‘ä»¬å°†åœ¨ä¸“é—¨çš„æ€§èƒ½åšæ–‡ä¸­è¯¦ç»†è®¨è®ºï¼Œä½†ç°åœ¨æˆ‘ä»¬å°†æ€»ç»“å‡ºä¸¤ç‚¹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº‹å®ä¸Šï¼ŒIstio çš„å¤§éƒ¨åˆ†ç½‘ç»œå»¶è¿Ÿå¹¶ä¸æ˜¯æ¥è‡ªäºç½‘ç»œï¼ˆç°ä»£çš„äº‘ä¾›åº”å•†æ‹¥æœ‰æå¿«çš„ç½‘ç»œï¼‰ã€‚ç›¸åï¼Œæœ€å¤§çš„ç½ªé­ç¥¸é¦–æ˜¯ Istio éœ€è¦å¯†é›†çš„ L7 å¤„ç†æ¥å®ç°å…¶å¤æ‚çš„åŠŸèƒ½é›†ã€‚ä¸ sidecar ä¸åŒçš„æ˜¯ï¼Œsidecar ä¸ºæ¯ä¸ªè¿æ¥å®ç°äº†ä¸¤ä¸ª L7 å¤„ç†æ­¥éª¤ï¼ˆæ¯ä¸ª sidecar ä¸€ä¸ªï¼‰ï¼Œè€Œ Ambient ç½‘æ ¼è¿™ä¸¤ä¸ªæ­¥éª¤å‹ç¼©æˆä¸€ä¸ªã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™ç§å‡å°‘çš„å¤„ç†æˆæœ¬èƒ½å¤Ÿè¡¥å¿é¢å¤–çš„ç½‘ç»œè·³è·ƒã€‚&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·é€šå¸¸åœ¨éƒ¨ç½²ç½‘æ ¼æ—¶ï¼Œé¦–å…ˆå¯ç”¨é›¶ä¿¡ä»»çš„å®‰å…¨æ€åŠ¿ï¼Œç„¶åæ ¹æ®éœ€è¦é€‰æ‹©æ€§åœ°å¯ç”¨ L7 åŠŸèƒ½ã€‚Ambient ç½‘æ ¼å…è®¸è¿™äº›ç”¨æˆ·åœ¨ä¸éœ€è¦æ—¶å®Œå…¨ç»•è¿‡ L7 å¤„ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;èµ„æºå¼€é”€&#34;&gt;èµ„æºå¼€é”€&lt;/h2&gt;
&lt;p&gt;æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬å¸Œæœ› Ambient Mesh å¯¹å¤§å¤šæ•°ç”¨æˆ·æ¥è¯´è¦æ±‚æ›´å°‘çš„èµ„æºï¼Œè®©èµ„æºéœ€æ±‚æ›´å¯é¢„æµ‹ã€‚ztunnel çš„æœ‰é™è´£ä»»å…è®¸å®ƒä½œä¸ºä¸€ä¸ªå…±äº«èµ„æºéƒ¨ç½²åœ¨èŠ‚ç‚¹ä¸Šã€‚è¿™å°†å¤§å¤§å‡å°‘å¤§å¤šæ•°ç”¨æˆ·ä¸ºæ¯ä¸ªå·¥ä½œè´Ÿè½½çš„é¢„ç•™èµ„æºã€‚æ­¤å¤–ï¼Œç”±äº waypoint ä»£ç†æ˜¯æ­£å¸¸çš„ Kubernetes podï¼Œå®ƒä»¬å¯ä»¥æ ¹æ®å…¶æœåŠ¡çš„å·¥ä½œè´Ÿè½½çš„å®æ—¶æµé‡éœ€æ±‚è¿›è¡ŒåŠ¨æ€éƒ¨ç½²å’Œæ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€æ–¹é¢ï¼Œsidecar éœ€è¦ä¸ºæ¯ä¸ªå·¥ä½œè´Ÿè½½çš„æœ€åæƒ…å†µä¿ç•™å†…å­˜å’Œ CPUã€‚è¿›è¡Œè¿™äº›è®¡ç®—æ˜¯å¾ˆå¤æ‚çš„ï¼Œæ‰€ä»¥åœ¨å®è·µä¸­ï¼Œç®¡ç†å‘˜å€¾å‘äºè¿‡åº¦é…ç½®ã€‚è¿™å°±å¯¼è‡´äº†ç”±äºå¤§é‡çš„èµ„æºé¢„ç•™å¯¼è‡´å…¶ä»–å·¥ä½œè´Ÿè½½æ— æ³•è¢«è°ƒåº¦ï¼Œä»è€Œå¯¼è‡´èŠ‚ç‚¹åˆ©ç”¨ç‡ä¸è¶³ã€‚Ambient ç½‘æ ¼çš„æ¯èŠ‚ç‚¹å›ºå®šå¼€é”€è¾ƒä½ï¼ŒåŠ¨æ€æ‰©å±•çš„ waypoint ä»£ç†éœ€è¦çš„èµ„æºé¢„ç•™æ€»ä½“ä¸Šè¦å°‘å¾—å¤šï¼Œä»è€Œä½¿é›†ç¾¤çš„ä½¿ç”¨æ•ˆç‡æ›´é«˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰å…¨æ€§å¦‚ä½•&#34;&gt;å®‰å…¨æ€§å¦‚ä½•ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸€ä¸ªå…¨æ–°çš„æ¶æ„è‡ªç„¶ä¼šå¸¦æ¥å®‰å…¨æ–¹é¢çš„é—®é¢˜ã€‚&lt;a href=&#34;https://istio.io/latest/blog/2022/ambient-security/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambient å®‰å…¨åšå®¢&lt;/a&gt;å¯¹æ­¤åšäº†æ·±å…¥çš„ç ”ç©¶ï¼Œæˆ‘ä»¬å°†åœ¨æ­¤è¿›è¡Œæ€»ç»“ã€‚&lt;/p&gt;
&lt;p&gt;Sidecar ä¸å®ƒä»¬æ‰€æœåŠ¡çš„å·¥ä½œè´Ÿè½½å…±å¤„ä¸€åœ°ï¼Œå› æ­¤ï¼Œä¸€ä¸ªäººçš„æ¼æ´ä¼šæŸå®³å¦ä¸€ä¸ªäººã€‚åœ¨ Ambient Mesh æ¨¡å‹ä¸­ï¼Œå³ä½¿ä¸€ä¸ªåº”ç”¨ç¨‹åºè¢«ç ´åï¼ŒZtunnel å’Œ waypoint ä»£ç†ä»ç„¶å¯ä»¥å¯¹è¢«ç ´åçš„åº”ç”¨ç¨‹åºçš„æµé‡æ‰§è¡Œä¸¥æ ¼çš„å®‰å…¨ç­–ç•¥ã€‚æ­¤å¤–ï¼Œé‰´äº Envoy æ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„ç½‘ç»œè¿è¥å•†æ‰€ä½¿ç”¨çš„ç»è¿‡å®æˆ˜è€ƒéªŒçš„æˆç†Ÿè½¯ä»¶ï¼Œå®ƒçš„è„†å¼±æ€§å¾ˆå¯èƒ½ä½äºä¸å®ƒä¸€èµ·è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶ ztunnel æ˜¯ä¸€ä¸ªå…±äº«èµ„æºï¼Œä½†å®ƒåªèƒ½è®¿é—®å®ƒæ‰€è¿è¡Œçš„èŠ‚ç‚¹ä¸Šå½“å‰å·¥ä½œè´Ÿè½½çš„å¯†é’¥ã€‚å› æ­¤ï¼Œå®ƒçš„çˆ†ç‚¸åŠå¾„å¹¶ä¸æ¯”ä»»ä½•å…¶ä»–ä¾é æ¯ä¸ªèŠ‚ç‚¹å¯†é’¥è¿›è¡ŒåŠ å¯†çš„åŠ å¯† CNI å·®ã€‚å¦å¤–ï¼Œè€ƒè™‘åˆ° ztunnel æœ‰é™çš„ä»…æœ‰çš„ L4 æ”»å‡»é¢å’Œ Envoy çš„ä¸Šè¿°å®‰å…¨ç‰¹æ€§ï¼Œæˆ‘ä»¬è§‰å¾—è¿™ç§é£é™©æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥æ¥å—çš„ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œè™½ç„¶ waypoint ä»£ç†æ˜¯ä¸€ç§å…±äº«èµ„æºï¼Œä½†å®ƒä»¬åªé™äºä¸ºä¸€ä¸ªæœåŠ¡è´¦æˆ·æœåŠ¡ã€‚è¿™ä½¿å¾—å®ƒä»¬ä¸ä¼šæ¯”ç°åœ¨çš„ sidecar æ›´ç³Ÿï¼›å¦‚æœä¸€ä¸ª waypoint ä»£ç†è¢«æ”»ç ´ï¼Œä¸è¯¥ waypoint ç›¸å…³çš„å‡­è¯å°±ä¼šä¸¢å¤±ï¼Œè€Œä¸ä¼šæœ‰å…¶ä»–é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿™æ˜¯-sidecar-çš„ç»ˆç»“å—&#34;&gt;è¿™æ˜¯ sidecar çš„ç»ˆç»“å—ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;è‚¯å®šä¸æ˜¯ã€‚è™½ç„¶æˆ‘ä»¬ç›¸ä¿¡ Ambient Mesh å°†æ˜¯è®¸å¤šç½‘æ ¼ç”¨æˆ·æœªæ¥çš„æœ€ä½³é€‰æ‹©ï¼Œä½†å¯¹äºé‚£äº›éœ€è¦ä¸“ç”¨æ•°æ®å¹³é¢èµ„æºçš„ç”¨æˆ·æ¥è¯´ï¼Œå¦‚åˆè§„æ€§æˆ–æ€§èƒ½è°ƒæ•´ï¼Œsidecar ä»ç„¶æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚Istio å°†ç»§ç»­æ”¯æŒ sidecarï¼Œè€Œä¸”é‡è¦çš„æ˜¯ï¼Œå…è®¸å®ƒä»¬ä¸ Ambient Mesh æ— ç¼äº’é€šã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬ä»Šå¤©å‘å¸ƒçš„ Ambient Mesh ä»£ç å·²ç»æ”¯æŒä¸åŸºäº sidecar çš„ Istio çš„äº’æ“ä½œã€‚&lt;/p&gt;
&lt;h2 id=&#34;è§†é¢‘ä»‹ç»&#34;&gt;è§†é¢‘ä»‹ç»&lt;/h2&gt;
&lt;p&gt;è¯·çœ‹ä¸€ä¸ªç®€çŸ­çš„ &lt;a href=&#34;https://youtu.be/nupRBh9Iypo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;YouTube è§†é¢‘&lt;/a&gt;ï¼Œçœ‹ Christian è¿è¡Œ Istio Ambient Mesh ç»„ä»¶å¹¶æ¼”ç¤ºä¸€äº›åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚ä¸è¿›æ¥&#34;&gt;å‚ä¸è¿›æ¥&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä»Šå¤©å‘å¸ƒçš„æ˜¯ Istio ä¸­ Ambient Mesh çš„æ—©æœŸç‰ˆæœ¬ï¼Œå®ƒåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä»å¤„äºç§¯æçš„å¼€å‘ä¹‹ä¸­ã€‚æˆ‘ä»¬å¾ˆé«˜å…´ä¸æ›´å¹¿æ³›çš„ç¤¾åŒºåˆ†äº«å®ƒï¼Œå¹¶æœŸå¾…ç€åœ¨ 2023 å¹´è¿›å…¥ç”Ÿäº§å°±ç»ªé˜¶æ®µæ—¶ï¼Œè®©æ›´å¤šäººå‚ä¸å¡‘é€ å®ƒã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¸Œæœ›å¾—åˆ°ä½ çš„åé¦ˆæ¥å¸®åŠ©å¡‘é€ è¿™ä¸ªè§£å†³æ–¹æ¡ˆã€‚æ”¯æŒ Ambient Mesh çš„ Istio æ„å»ºç‰ˆå¯ä»¥åœ¨ &lt;a href=&#34;https://github.com/istio/istio/tree/experimental-ambient&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®éªŒç‰ˆ&lt;/a&gt;ä¸­&lt;a href=&#34;https://istio.io/latest/blog/2022/get-started-ambient/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸‹è½½å’Œè¯•ç”¨&lt;/a&gt;ã€‚åœ¨ &lt;a href=&#34;https://github.com/istio/istio/blob/experimental-ambient/README.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;README&lt;/a&gt; ä¸­æä¾›äº†ä¸€ä»½ç¼ºå¤±åŠŸèƒ½å’Œå·¥ä½œé¡¹ç›®çš„æ¸…å•ã€‚è¯·å°è¯•ä¸€ä¸‹ï¼Œå¹¶ &lt;a href=&#34;https://slack.istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®©æˆ‘ä»¬çŸ¥é“ä½ çš„æƒ³æ³•&lt;/a&gt;ï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio ç½‘æ ¼ä¸­è®¿é—®å¤–éƒ¨æœåŠ¡æ–¹æ³•</title>
      <link>https://cloudnativecn.com/blog/istio-access-external-services/</link>
      <pubDate>Mon, 27 Jun 2022 11:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-access-external-services/</guid>
      <description>&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Istio çš„æ—¶å€™ï¼Œå¯èƒ½æœ€éœ€è¦è€ƒè™‘çš„é—®é¢˜ä¸€ä¸ªæ˜¯å®‰å…¨é—®é¢˜ä¸€ä¸ªæ˜¯æ€§èƒ½é—®é¢˜ï¼Œåœ¨è¿™é‡Œå’Œå¤§å®¶ä¸€èµ·æ¢è®¨ä¸‹ä¸€ä¸ªå®‰å…¨é—®é¢˜ï¼Œå¦‚ä½•åœ¨ Istio ç½‘æ ¼ä¸­è®¿é—®å¤–éƒ¨æœåŠ¡ã€‚Istio æä¾›äº†ä¸¤ç§æ¨¡å¼æ¥é…ç½®å¯¹å¤–éƒ¨è¯·æ±‚çš„è®¿é—®ç­–ç•¥ï¼Œå¹¶é€šè¿‡é…ç½®é¡¹ outboundTrafficPolicy.mode æ¥æŒ‡å®šã€‚Â é»˜è®¤çš„æ¨¡å¼æ˜¯ ALLOW_ANYï¼Œä¹Ÿå°±æ˜¯å…è®¸åœ¨ç½‘æ ¼å†…è¯·æ±‚æ‰€æœ‰å¤–éƒ¨çš„æœªçŸ¥æœåŠ¡ï¼›å¦å¤–ä¸€ä¸ªæ¨¡å¼æ˜¯ REGISTRY_ONLYï¼Œè¡¨ç¤ºåªå…è®¸è¯·æ±‚æ³¨å†Œåˆ°æœåŠ¡ç½‘æ ¼æ³¨å†Œè¡¨ä¸­çš„æœåŠ¡ã€‚é»˜è®¤çš„ ALLOW_ANY æ¨¡å¼è™½ç„¶ä½¿ç”¨æ–¹ä¾¿ï¼Œä½†æ˜¯å­˜åœ¨ä¸€å®šçš„å®‰å…¨éšæ‚£ï¼Œå»ºè®®çš„åšæ³•æ˜¯åˆ‡æ¢åˆ° REGISTRY_ONLY æ¨¡å¼ã€‚é‚£ä¹ˆåœ¨ REGISTRY_ONLY æ¨¡å¼ä¸‹å¦‚ä½•è®¿é—®å¤–éƒ¨æœåŠ¡ï¼Ÿå®ç°æœºåˆ¶æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåœ¨è¿™é‡Œé’ˆå¯¹è¿™ä¸¤ä¸ªé—®é¢˜å’Œå¤§å®¶ä¸€èµ·æ¢è®¨ä¸‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ–¹æ¡ˆè°ƒç ”&#34;&gt;æ–¹æ¡ˆè°ƒç ”&lt;/h2&gt;
&lt;p&gt;ç›®å‰æˆ‘ä»¬å®‰è£…éƒ¨ç½² Istio ä½¿ç”¨çš„æ˜¯ helmï¼Œå¯ä»¥åœ¨å®‰è£…ä¸­æ·»åŠ ç›¸åº”çš„é…ç½® &lt;code&gt;--set meshConfig.outboundTrafficPolicy.mode=REGISTRY_ONLY&lt;/code&gt; ä¿®æ”¹ outboundTrafficPolicy.mode çš„å€¼ï¼›å¦‚æœ Istio å·²ç»å®‰è£…å¥½ï¼Œé€šè¿‡ &lt;code&gt;kubectl edit cm istio -n istio-system&lt;/code&gt; å¯ä»¥åŠ¨æ€ä¿®æ”¹æ­¤å€¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mesh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|-&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    defaultConfig:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      discoveryAddress: istiod.istio-system.svc:15012
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      proxyMetadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        DNS_AGENT: &amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      tracing:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        zipkin:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          address: zipkin.istio-system:9411
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    outboundTrafficPolicy:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      mode: REGISTRY_ONLY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é…ç½®å®Œ REGISTRY_ONLY åï¼Œæˆ‘ä»¬åœ¨ pod ä¸­æ— æ³•è®¿é—®å¤–éƒ¨æœåŠ¡&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-é»˜è®¤è®¿é—®å¤–éƒ¨æœåŠ¡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio é»˜è®¤è®¿é—®å¤–éƒ¨æœåŠ¡&#34; srcset=&#34;
               /blog/istio-access-external-services/callexternal_hu_a9dc145859af665.webp 400w,
               /blog/istio-access-external-services/callexternal_hu_1504ff99e970989b.webp 760w,
               /blog/istio-access-external-services/callexternal_hu_f6219f7f27c07429.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-access-external-services/callexternal_hu_a9dc145859af665.webp&#34;
               width=&#34;401&#34;
               height=&#34;65&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio é»˜è®¤è®¿é—®å¤–éƒ¨æœåŠ¡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆåœ¨ REGISTRY_ONLY æ¨¡å¼ä¸‹ï¼Œå¦‚ä½•æ‰èƒ½è®¿é—®å¤–éƒ¨æœåŠ¡å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬é€šè¿‡&lt;a href=&#34;https://jimmysong.io/blog/sidecar-injection-iptables-and-traffic-routing/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸‹å›¾&lt;/a&gt; çœ‹ä¸‹ Istio åœ¨ä»€ä¹ˆæ—¶æœºå¯ä»¥è®¿é—®å¤–éƒ¨æœåŠ¡ï¼Œåœ¨è¿™ç§æ—¶æœºä¸‹æ€ä¹ˆä¿®æ”¹é…ç½®æ‰èƒ½è®¿é—®åˆ°å¤–éƒ¨æœåŠ¡ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å›¾ä¸­æè¿°äº† product æœåŠ¡è®¿é—® review æœåŠ¡ï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾ review æœåŠ¡ä¼šç»§ç»­è°ƒç”¨ 36.152.44.96 è¿™ä¸ªå¤–éƒ¨æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-æµé‡æµè½¬&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio æµé‡æµè½¬&#34; srcset=&#34;
               /blog/istio-access-external-services/iptables_hu_21bbd1f5d4091fed.webp 400w,
               /blog/istio-access-external-services/iptables_hu_8403949a1b0e33ae.webp 760w,
               /blog/istio-access-external-services/iptables_hu_c57e064cac0e7673.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-access-external-services/iptables_hu_21bbd1f5d4091fed.webp&#34;
               width=&#34;760&#34;
               height=&#34;461&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio æµé‡æµè½¬
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“ reviews åº”ç”¨éœ€è¦è®¿é—® 36.152.44.96 è¿™ä¸ªå¤–éƒ¨æœåŠ¡æ—¶ï¼Œä¼šåœ¨ reviews çš„åº”ç”¨å®¹å™¨ä¸­å¾€ä¸Šæ¸¸å‘é€è¯·æ±‚ä¿¡æ¯ï¼Œä¸‹é¢æŒ‰ç…§å›¾ä¸­çš„é¡ºåºä»‹ç»å¦‚ä½•è®¿é—®å¤–éƒ¨è¯·æ±‚ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;reviews æœåŠ¡è®¿é—®å¤–éƒ¨æœåŠ¡ï¼Œè¿™ä¸€æ­¥å¯¹ reviews æœåŠ¡æ¥è¯´å±äºå‡ºå£æµé‡ï¼Œè¢« iptables è§„åˆ™æ‹¦æˆªè½¬å‘è‡³å‡ºå£æµé‡ OUTPUT é“¾ã€‚&lt;/li&gt;
&lt;li&gt;OUTPUT é“¾è½¬å‘æµé‡è‡³ ISTIO_OUTPUT é“¾ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ ISTIO_OUTPUT é“¾ä¸­é»˜è®¤æœ‰ä¹ä¸ªè§„åˆ™ï¼Œå†³å®š reviews æœåŠ¡è®¿é—®å¤–éƒ¨æœåŠ¡çš„æµé‡å‘å¾€ä½•å¤„ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªè§„åˆ™ &lt;code&gt;-A ISTIO_OUTPUT -d 36.152.44.0/24 -j RETURN&lt;/code&gt;ï¼Œä½¿è®¿é—® 36.152.44.96 è¿™ä¸ªå¤–éƒ¨æœåŠ¡çš„æµé‡è·³å‡ºå½“å‰é“¾ï¼Œè°ƒç”¨ &lt;code&gt;POSTROUTING é“¾&lt;/code&gt;ï¼Œç›´æ¥è®¿é—®å¤–éƒ¨æœåŠ¡ï¼›å¦‚æœä½¿ç”¨é»˜è®¤è§„åˆ™ï¼Œæµé‡è¢«è½¬å‘è‡³ ISTIO_REDIRECT é“¾ã€‚&lt;/li&gt;
&lt;li&gt;ISTIO_REDIRECT é“¾ç›´æ¥é‡å®šå‘è‡³ Envoy ç›‘å¬çš„ 15001 å‡ºå£æµé‡ç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨æœåŠ¡çš„æµé‡ç­–ç•¥å¹¶ä¸åœ¨ Istio æœåŠ¡ç½‘æ ¼ä¸­ï¼Œå¦‚æœä¸è¿›è¡Œç›¸å…³é…ç½®æŠŠå¤–éƒ¨æœåŠ¡æ³¨å†Œåˆ°æœåŠ¡ç½‘æ ¼å†…ï¼Œç»è¿‡ Envoy ä¸€ç³»åˆ—å‡ºå£æµé‡æ²»ç†åŠ¨ä½œåå°†ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ã€‚å› æ­¤è¿™é‡Œæˆ‘ä»¬éœ€è¦é…ç½® &lt;code&gt;ServiceEntry&lt;/code&gt;ï¼ŒæŠŠå¤–éƒ¨æœåŠ¡çº³å…¥æœåŠ¡ç½‘æ ¼ä¸­ï¼Œç„¶åé€šè¿‡ Envoy çš„æµé‡æ²»ç†åå¯ä»¥ç»§ç»­å‘é€å¤–éƒ¨è¯·æ±‚ï¼Œè®¿é—®å¤–éƒ¨è¯·æ±‚æ—¶åˆä¼šè¢« iptables æ‹¦æˆªè½¬å‘è‡³å‡ºå£æµé‡ OUTPUT é“¾ã€‚&lt;/li&gt;
&lt;li&gt;OUTPUT é“¾è½¬å‘æµé‡è‡³ ISTIO_OUTPUT é“¾ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨è¿™é‡Œä¼šåŒ¹é…åˆ° ISTIO_OUTPUT é“¾çš„ç¬¬å››æ¡è§„åˆ™ &lt;code&gt;-A ISTIO_OUTPUT -m owner --uid-owner 1337 -j RETURN&lt;/code&gt;ï¼Œæµé‡ç›´æ¥ RETURN åˆ°ä¸‹ä¸€ä¸ªé“¾ &lt;code&gt;POSTROUTING é“¾&lt;/code&gt;ï¼Œç» POSTROUTING é“¾æµå‡ºè®¿é—®å¤–éƒ¨æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°é€šè¿‡ç¬¬ 11 æ­¥ã€ç¬¬ 13 æ­¥ä¸¤ç§æ–¹å¼ä¿®æ”¹é…ç½®éƒ½å¯ä»¥ä½¿ Istio å†…éƒ¨çš„æœåŠ¡è®¿é—®å¤–éƒ¨æœåŠ¡ï¼Œå…·ä½“åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ&lt;/p&gt;
&lt;h2 id=&#34;é€šè¿‡-iptables-è§„åˆ™è®¿é—®&#34;&gt;é€šè¿‡ iptables è§„åˆ™è®¿é—®&lt;/h2&gt;
&lt;p&gt;å¦‚æœæƒ³åœ¨ç¬¬ 11 æ­¥ç›´æ¥è·³å‡º ISTIO_OUT é“¾è°ƒç”¨ POSTROUTING é“¾ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„ iptables è§„åˆ™ &lt;code&gt;-A ISTIO_OUTPUT -d 36.152.44.0/24 -j RETURN&lt;/code&gt;ï¼Œæˆ‘ä»¬çŸ¥é“ iptables è§„åˆ™æ˜¯åœ¨ istio-init é‡Œå®šä¹‰çš„ï¼Œistio-init å¯åŠ¨æ—¶æ‰§è¡Œçš„æ˜¯ istio-iptables å‘½ä»¤ï¼Œæˆ‘ä»¬åœ¨ manifests çš„ &lt;code&gt;injection-template.yaml&lt;/code&gt; æ–‡ä»¶é‡Œçœ‹åˆ° istio-iptables é»˜è®¤çš„éƒ¨åˆ†é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;-i&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundIPRanges` .Values.global.proxy.includeIPRanges }}&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;-x&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundIPRanges` .Values.global.proxy.excludeIPRanges }}&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;-b&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeInboundPorts` `*` }}&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;-d&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;{{- &lt;span class=&#34;l&#34;&gt;if excludeInboundPort (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) (annotation .ObjectMeta `traffic.sidecar.istio.io/excludeInboundPorts` .Values.global.proxy.excludeInboundPorts) }}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;15090,15021,{{ excludeInboundPort (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) (annotation .ObjectMeta `traffic.sidecar.istio.io/excludeInboundPorts` .Values.global.proxy.excludeInboundPorts) }}&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;{{- &lt;span class=&#34;l&#34;&gt;else }}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;15090,15021,15020&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-i&lt;/code&gt; é»˜è®¤ä¸º&lt;code&gt;*&lt;/code&gt;ï¼Œæ‰€æœ‰å‡ºç«™æµé‡éƒ½ä¼šè¢«é‡å®šå‘åˆ° Envoy ä»£ç†&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-x&lt;/code&gt; é»˜è®¤ä¸ºç©ºï¼Œå½“-i å‚æ•°ä¸º&lt;code&gt;*&lt;/code&gt;æ—¶ï¼Œç”¨æ¥æŒ‡æ˜å“ªäº›åœ°å€ä¸ç”¨é‡å®šå‘ Envoy ä»£ç†ï¼Œç›´æ¥è¿›è¡Œè½¬å‘&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-b&lt;/code&gt; é»˜è®¤ä¸º&lt;code&gt;*&lt;/code&gt;ï¼Œé€—å·åˆ†éš”çš„ç«¯å£ï¼ŒæŒ‡å®šç«¯å£çš„æµé‡å°†é‡å®šå‘åˆ° Envoy&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-d&lt;/code&gt; é»˜è®¤ä¸º 15090,15021,15020ï¼Œé€—å·åˆ†éš”çš„ç«¯å£ï¼ŒæŒ‡å®šå“ªäº›ç«¯å£çš„æµé‡ä¸ç”¨é‡å®šå‘åˆ° Envoy&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ ¹æ®ä¸Šé¢é…ç½®æˆ‘ä»¬å¯ä»¥åœ¨ Istio æœåŠ¡ä¸­é€šè¿‡ global.proxy.* è¿›è¡Œå…¨å±€é…ç½®ï¼Œè¿˜å¯ä»¥åœ¨æœåŠ¡çš„ deployment é‡Œé€šè¿‡ &lt;code&gt;traffic.sidecar.istio.io/*&lt;/code&gt; é…ç½®ç›¸åº”çš„å‚æ•°ã€‚æˆ‘ä»¬ç°åœ¨çš„ç›®çš„æ˜¯éœ€è¦æŠŠè®¿é—® 36.152.44.96 çš„è¯·æ±‚ä¸é‡å®šå‘åˆ° Envoy ä»£ç†ï¼Œç›´æ¥è¿›è¡Œè½¬å‘ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ deployment é‡Œæ·»åŠ  &lt;code&gt;traffic.sidecar.istio.io/excludeOutboundIPRanges: 36.152.44.0/24&lt;/code&gt;ï¼Œæ‰§è¡Œå®Œåæˆ‘ä»¬ describe pod çš„è¯¦ç»†ä¿¡æ¯ï¼Œè·å–åˆ° pod ä¸­çš„éƒ¨åˆ†é…ç½®å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°è®¾ç½®ç”Ÿæ•ˆï¼Œ36.152.44.0/24 ä¸ä¼šé‡å®šå‘åˆ° Envoy ä¸­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;-&lt;span class=&#34;l&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;*&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;-&lt;span class=&#34;l&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;36.152.44.0&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/24&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;-&lt;span class=&#34;l&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;*&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;-&lt;span class=&#34;l&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;15090&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;15021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;15020&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»§ç»­æŸ¥çœ‹ pod ä¸­çš„ iptables è§„åˆ™ï¼Œå¯ä»¥çœ‹åˆ°åœ¨åŸæ¥çš„ ISTIO_OUTPUT ä¹æ¡ iptables è§„åˆ™ä¸­æ’å…¥äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„è§„åˆ™ &lt;code&gt;A ISTIO_OUTPUT -d 36.152.44.0/24 -j RETURN&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -A ISTIO_OUTPUT -s 127.0.0.6/32 -o lo -j RETURN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -A ISTIO_OUTPUT ! -d 127.0.0.1/32 -o lo -m owner --uid-owner &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; -j ISTIO_IN_REDIRECT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -A ISTIO_OUTPUT -o lo -m owner ! --uid-owner &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; -j RETURN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -A ISTIO_OUTPUT -m owner --uid-owner &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; -j RETURN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -A ISTIO_OUTPUT ! -d 127.0.0.1/32 -o lo -m owner --gid-owner &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; -j ISTIO_IN_REDIRECT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -A ISTIO_OUTPUT -o lo -m owner ! --gid-owner &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; -j RETURN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -A ISTIO_OUTPUT -m owner --gid-owner &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; -j RETURN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -A ISTIO_OUTPUT -d 127.0.0.1/32 -j RETURN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -A ISTIO_OUTPUT -d 36.152.44.0/24 -j RETURN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; -A ISTIO_OUTPUT -j ISTIO_REDIRECT
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;é€šè¿‡-serviceentry-è®¿é—®&#34;&gt;é€šè¿‡ ServiceEntry è®¿é—®&lt;/h2&gt;
&lt;p&gt;Istio åœ¨ 15001 ç«¯å£ä½¿ç”¨ VirtualOutboundListener å¤„ç†å‡ºå‘è¯·æ±‚ï¼ŒIptable å°† Envoy æ‰€åœ¨ Pod çš„å¯¹å¤–è¯·æ±‚æ‹¦æˆªåå‘å‘æœ¬åœ°çš„ 15001 ç«¯å£ï¼Œè¯¥ç›‘å¬å™¨æ¥æ”¶åå¹¶ä¸è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œè€Œæ˜¯æ ¹æ®è¯·æ±‚çš„ç›®çš„ç«¯å£åˆ†å‘ç»™å…¶ä»–ç‹¬ç«‹çš„ç›‘å¬å™¨å¤„ç†ã€‚Â æˆ‘ä»¬è®¿é—®çš„å¤–éƒ¨æœåŠ¡ä¸º 36.152.44.96:80ï¼Œå› æ­¤ EnvoyÂ æ ¹æ®ç›®çš„ç«¯å£åŒ¹é…åˆ°Â &lt;code&gt;0.0.0.0_80&lt;/code&gt;Â è¿™ä¸ª Outbound listenerï¼Œå¹¶è½¬äº¤ç»™è¯¥ listenerã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy_listener-é…ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy_listener é…ç½®&#34; srcset=&#34;
               /blog/istio-access-external-services/envoy_listener_hu_de4417f84fb98e16.webp 400w,
               /blog/istio-access-external-services/envoy_listener_hu_17f49e40347d22ac.webp 760w,
               /blog/istio-access-external-services/envoy_listener_hu_b5157f99a1a0e343.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-access-external-services/envoy_listener_hu_de4417f84fb98e16.webp&#34;
               width=&#34;760&#34;
               height=&#34;566&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy_listener é…ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“Â 0.0.0.0_80Â æ¥æ”¶åˆ°å‡ºå‘è¯·æ±‚åï¼Œå¹¶ä¸ä¼šç›´æ¥å‘é€åˆ°ç›®çš„ clusterï¼Œå…¶å®é€šè¿‡æŸ¥çœ‹ 0.0.0.0_80 çš„ listener çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¹Ÿæ‰¾ä¸åˆ°ç›®çš„ cluster æˆ– endpointï¼Œåœ¨è¿™ä¸ª listener ä¸­é…ç½®äº†ä¸€ä¸ªè·¯ç”±è§„åˆ™ 80ï¼Œåœ¨è¯¥è·¯ç”±è§„åˆ™ä¸­ä¼šæ ¹æ®ä¸åŒçš„è¯·æ±‚ç›®çš„åœ°è¿›è¡Œè·¯ç”±åŒ¹é…å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy_listener-é…ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy_listener é…ç½®&#34; srcset=&#34;
               /blog/istio-access-external-services/envoy_route_hu_37e33a4474562702.webp 400w,
               /blog/istio-access-external-services/envoy_route_hu_7542496cacefe90b.webp 760w,
               /blog/istio-access-external-services/envoy_route_hu_7cb23750e9284c7f.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-access-external-services/envoy_route_hu_37e33a4474562702.webp&#34;
               width=&#34;595&#34;
               height=&#34;223&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy_listener é…ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é€šè¿‡ name ä¸º 80 çš„è·¯ç”±è§„åˆ™æˆ‘ä»¬æ²¡æ‰¾åˆ°ç¬¦åˆ 36.152.44.96 çš„è¯·æ±‚ï¼Œå› æ­¤ä¼šè¢« listener é‡Œçš„ &lt;code&gt;default_filter_match&lt;/code&gt; å¤„ç†ï¼Œè¿›å…¥åˆ° BlackHoleCluster é›†ç¾¤é‡Œï¼Œè¯·æ±‚è¢«ä¸¢å¼ƒã€‚
è¿™é‡Œæˆ‘ä»¬ç®€å•ä»‹ç»ä¸‹ Envoy ä¸­çš„ä¸¤ä¸ªç‰¹æ®Š clusterï¼š&lt;code&gt;BlackHoleCluster&lt;/code&gt; å’Œ &lt;code&gt;PassthroughCluster&lt;/code&gt;ï¼Œ
&lt;code&gt;BlackHoleCluster&lt;/code&gt; ä¸­æ²¡æœ‰é…ç½®ä»»ä½•å¤„ç†è¯·æ±‚çš„ hostã€‚è¯·æ±‚è¿›å…¥è¯¥ cluster åå°†è¢«ä¸¢å¼ƒæ‰ï¼Œè€Œä¸æ˜¯å‘å‘ä¸€ä¸ª hostï¼Œå¦‚æœ &lt;code&gt;outboundTrafficPolicy.mode=REGISTRY_ONLY&lt;/code&gt;ï¼Œé»˜è®¤æƒ…å†µä¸‹è¯·æ±‚çš„å¤–éƒ¨æœåŠ¡éƒ½ä¼šç›´æ¥è¿›å…¥ BlackHoleCluster ä¸­ä¸¢æ‰ã€‚&lt;code&gt;PassthroughCluster&lt;/code&gt; çš„ type è¢«è®¾ç½®ä¸º &lt;code&gt;ORIGINAL_DST&lt;/code&gt;ï¼Œè¡¨æ˜ä»»ä½•å‘å‘è¯¥ cluster çš„è¯·æ±‚éƒ½ä¼šè¢«ç›´æ¥å‘é€åˆ°å…¶è¯·æ±‚ä¸­çš„åŸå§‹ç›®çš„åœ°ï¼Œå¦‚æœ &lt;code&gt;outboundTrafficPolicy.mode=ALLOW_ANY&lt;/code&gt;ï¼ŒEnvoy ä¸ä¼šå¯¹è¯·æ±‚è¿›è¡Œé‡æ–°è·¯ç”±ç›´æ¥å‘é€åˆ°åŸå§‹ç›®çš„åœ°ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;code&gt;outboundTrafficPolicy.mode=REGISTRY_ONLY&lt;/code&gt; æ¨¡å¼ä¸‹ï¼Œä¸ºäº†æµé‡ä¸è¿›å…¥ &lt;code&gt;BlackHoleCluster&lt;/code&gt; ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ  ServiceEntryï¼ŒæŠŠå¤–éƒ¨è¯·æ±‚æ³¨å†Œåˆ°æœåŠ¡ç½‘æ ¼ä¸­ï¼Œä»¥ä¾¿ Envoy å¯ä»¥æ‰¾åˆ°å¤–éƒ¨æœåŠ¡çš„ route è¿›è¡Œæµé‡å¤„ç†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceEntry&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;baidu-ip&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;www.baidu.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;addresses&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;m&#34;&gt;36.152.44.96&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;MESH_EXTERNAL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;baidu-http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resolution&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NONE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é…ç½®å®Œ ServiceEntry åæˆ‘ä»¬å†æ¬¡æŸ¥è¯¢ review çš„ route ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ° 36.152.44.96 å·²ç»è¢«åŠ å…¥ route ä¸­äº†ï¼Œç›´æ¥åœ¨ pod ä¸­è®¿é—®å¤–éƒ¨æœåŠ¡ 36.152.44.96 å¯ä»¥å¾—åˆ°æ­£ç¡®çš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ·»åŠ å®Œ-envoy&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ·»åŠ å®Œ Envoy&#34; srcset=&#34;
               /blog/istio-access-external-services/envoy_route_baidu_hu_bfae06f5745fcda1.webp 400w,
               /blog/istio-access-external-services/envoy_route_baidu_hu_f86e566c209ac000.webp 760w,
               /blog/istio-access-external-services/envoy_route_baidu_hu_7dff8a5a5f3085bd.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-access-external-services/envoy_route_baidu_hu_bfae06f5745fcda1.webp&#34;
               width=&#34;647&#34;
               height=&#34;429&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ·»åŠ å®Œ Envoy
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;é€šè¿‡å¯¹ Istio è®¿é—®å¤–éƒ¨æœåŠ¡çš„æ–¹æ¡ˆè¿›è¡Œè°ƒç ”ï¼Œæˆ‘ä»¬å­¦ä¹ äº† Istio æ˜¯å¦‚ä½•é€šè¿‡ iptables å¤„ç†è¿›å…¥ç½‘æ ¼ä¸­çš„æµé‡ï¼Œä¹Ÿå¤§ä½“äº†è§£äº† Envoy å¤„ç† Outbound æµé‡çš„æµç¨‹ã€‚ä»¥ä¸Šçš„è°ƒç ”åŸºäº Istio 1.8 ç‰ˆæœ¬ï¼Œå†…å®¹å¯èƒ½å­˜åœ¨é”™è¯¯æˆ–ä¸å‡†ç¡®çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§å®¶äº¤æµæŒ‡æ­£ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æµ…æ Istioâ€”â€”å¯è§‚æµ‹æ€§</title>
      <link>https://cloudnativecn.com/blog/istio-observability/</link>
      <pubDate>Sat, 25 Jun 2022 12:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-observability/</guid>
      <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;å¯è§‚æµ‹æ€§ä¸€è¯è¯ç”Ÿäºå‡ åå¹´å‰çš„æ§åˆ¶ç†è®ºï¼ŒæŒ‡ç³»ç»Ÿå¯ä»¥ç”±å…¶å¤–éƒ¨è¾“å‡ºæ¨æ–­å…¶å†…éƒ¨çŠ¶æ€çš„ç¨‹åº¦ã€‚è¿‘å¹´æ¥ï¼Œéšç€å¾®æœåŠ¡ã€å®¹å™¨åŒ–ã€serverless ç­‰å¤šç§æŠ€æœ¯æ¶æ„çš„å‡ºç°ï¼Œåº”ç”¨çš„æ„å»ºéƒ¨ç½²ä¸å®æ–½è¿è¡Œéƒ½å‘ç”Ÿäº†å·¨å¤§è½¬å˜ï¼ŒæœåŠ¡é“¾è·¯é”™ç»¼å¤æ‚ã€å¾®æœåŠ¡ä¸åˆ†å¸ƒå¼è¶‹åŠ¿å¢å¼ºã€ç¯å¢ƒå®¹å™¨åŒ–ç­‰ä¸€ç³»åˆ—å˜åŒ–ä¿ƒä½¿å¯è§‚æµ‹æ€§åœ¨äº‘åŸç”Ÿä½“ç³»ä¸­å æ®ç€é‡è¦çš„ä½œç”¨ã€‚é€šå¸¸ï¼Œå¯è§‚æµ‹æ€§åˆ†ä¸º Metrics (æŒ‡æ ‡)ã€Tracing (è¿½è¸ª)ã€Logging (æ—¥å¿—) ä¸‰éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;Logging æ˜¯åœ¨ç‰¹å®šæ—¶é—´å‘ç”Ÿçš„äº‹ä»¶çš„æ–‡æœ¬è®°å½•ï¼ŒåŒ…æ‹¬è¯´æ˜äº‹ä»¶å‘ç”Ÿæ—¶é—´çš„æ—¶é—´æˆ³å’Œæä¾›ä¸Šä¸‹â½‚çš„æœ‰æ•ˆè´Ÿè½½ã€‚Metrics æ˜¯é€šè¿‡æ•°æ®çš„èšåˆï¼Œå¯¹ç‰¹å®šæ—¶é—´å†…çš„è¡Œä¸ºè¿›è¡Œè¡¡é‡ï¼ŒæŒ‡æ ‡æ•°æ®æ˜¯å¯ç´¯åŠ çš„ï¼Œå¯ä»¥è§‚å¯Ÿç³»ç»Ÿçš„çŠ¶æ€å’Œè¶‹åŠ¿ã€‚Tracing é¢å‘è¯·æ±‚ï¼Œè¡¨ç¤ºè¯·æ±‚é€šè¿‡åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç«¯åˆ°ç«¯çš„è°ƒç”¨æ—…ç¨‹ï¼Œå¯ä»¥åˆ†æå‡ºè¯·æ±‚ä¸­çš„å¼‚å¸¸ç‚¹æˆ–æ•…éšœçš„åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;Istio ä¸ºç½‘æ ¼å†…æ‰€æœ‰çš„æœåŠ¡é€šä¿¡ç”Ÿæˆè¯¦ç»†çš„é¥æµ‹æ•°æ®ã€‚è¿™ç§é¥æµ‹æŠ€æœ¯è®© Isito æä¾›äº†æœåŠ¡è¡Œä¸ºçš„å¯è§‚å¯Ÿæ€§ï¼Œä½¿è¿ç»´äººå‘˜èƒ½å¤Ÿæ’æŸ¥æ•…éšœã€ç»´æŠ¤å’Œä¼˜åŒ–åº”ç”¨ç¨‹åºï¼Œè€Œä¸ä¼šç»™æœåŠ¡çš„å¼€å‘äººå‘˜å¸¦æ¥ä»»ä½•é¢å¤–çš„è´Ÿæ‹…ã€‚åœ¨ Istio1.7 ç‰ˆæœ¬ä¹‹å‰ï¼Œå®‰è£… Istio æ—¶ä¹Ÿä¼šé»˜è®¤å®‰è£…å¯è§‚æµ‹æ€§æ’ä»¶ Kialiã€Prometheusã€Jaeger ç­‰ã€‚è€Œåœ¨ Istio1.7 åŠå…¶åé¢çš„ç‰ˆæœ¬ï¼Œå°†ä¸å†å®‰è£…è¿™äº›å¯è§‚æµ‹æ€§æ’ä»¶ã€‚éœ€è¦æ‰‹åŠ¨ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kuebctl apply -f sample/addons/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;metrics&#34;&gt;Metrics&lt;/h2&gt;
&lt;h3 id=&#34;prometheus-æŠ“å–-isito-é…ç½®&#34;&gt;Prometheus æŠ“å– Isito é…ç½®&lt;/h3&gt;
&lt;p&gt;Istio ä½¿ç”¨ Prometheus é‡‡é›† Metricsï¼Œenvoy æ•°æ®é¢æ ‡æš´éœ²ç«¯å£ä¸º 15020ã€æš´éœ²è·¯å¾„ä¸º stats/prometheusã€‚Istiod æ§åˆ¶é¢æŒ‡æ ‡æš´éœ²ç«¯å£ä¸º 15014ï¼Œè·¯å¾„ä¸º metricsã€‚Istio ä¼šä¸º envoy å’Œ istiod æ·»åŠ  annotationï¼Œç„¶å Prometheus é€šè¿‡è¿™äº› annotation è¿›è¡ŒæœåŠ¡å‘ç°ï¼Œæ¥å®æ—¶æŠ“å–æ³¨å…¥äº† envoy çš„æœåŠ¡ï¼Œä»¥åŠ istiod çš„æŒ‡æ ‡ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœåŠ¡åœ¨æ³¨å…¥ envoy æ—¶ï¼Œä¼šä¸º pod è‡ªåŠ¨æ·»åŠ ä»¥ä¸‹ annotation (è¯¥åŠŸèƒ½å¯ä»¥é€šè¿‡ &amp;ndash;set meshConfig.enablePrometheusMerge=false æ¥ç¦ç”¨ï¼Œé»˜è®¤å¼€å¯)ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;prometheus.io/path: /metrics
prometheus.io/port: 9100
prometheus.io/scrape: true
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨åˆ›å»º istiod æ—¶ï¼Œä¹Ÿä¼šä¸ºä¸º istiod çš„ pod æ·»åŠ æ·»åŠ ä»¥ä¸‹ annotationï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;prometheus.io/port: 15014
prometheus.io/scrape: true
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Prometheus é€šè¿‡ kuberneters_sd_configs é…ç½®æœåŠ¡å‘ç°å¯¹ Istio æŒ‡æ ‡ä¿¡æ¯è¿›è¡ŒæŠ“å–ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kubernetes_sd_configs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;role&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;relabel_configs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;keep&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;source_labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;__meta_kubernetes_pod_annotation_prometheus_io_scrape&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;replace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;(https?)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;source_labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;__meta_kubernetes_pod_annotation_prometheus_io_scheme&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;target_label&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;__scheme__&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;replace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;(.+)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;source_labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;__meta_kubernetes_pod_annotation_prometheus_io_path&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;target_label&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;__metrics_path__&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;replace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;([^:]+)(?::\d+)?;(\d+)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replacement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;$1:$2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;source_labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;__address__&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;__meta_kubernetes_pod_annotation_prometheus_io_port&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;target_label&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;__address__&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;labelmap&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;__meta_kubernetes_pod_label_(.+)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;replace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;source_labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;__meta_kubernetes_namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;target_label&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes_namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;replace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;source_labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;__meta_kubernetes_pod_name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;target_label&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes_pod_name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;drop&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Pending|Succeeded|Failed|Completed&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;source_labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;__meta_kubernetes_pod_phase&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;__meta_kubernetes_pod_annotation è¡¨ç¤º pod ä¸­ annotation çš„å€¼ï¼Œä¸ Istio ç»„ä»¶ä¸­ annotation å¯¹åº”ã€‚Prometheus é»˜è®¤é‡‡é›†æŒ‡æ ‡ä¿¡æ¯çš„ç«¯å£ä¸º 9090ï¼Œé»˜è®¤é‡‡é›†æŒ‡æ ‡ä¿¡æ¯çš„è·¯å¾„ä¸º /metricsï¼Œä¸ Istio æä¾›çš„æŒ‡æ ‡ä¿¡æ¯ä¸åŒï¼Œå› æ­¤éœ€è¦é€šè¿‡ relabel_configs è¿›è¡Œé‡æ–°æ ‡è®°ï¼Œä»¥æš´éœ²ä¸º Istio æŒ‡æ ‡å®é™…çš„ç«¯å£ä¸è·¯å¾„ã€‚åŒæ—¶ä¹Ÿä¼šä¿æŒ pod ä¸­çš„åŸæœ‰ label ä¿¡æ¯ï¼Œä»¥åŠå¯¹ pod çš„çŠ¶æ€è¿›è¡Œç­›é€‰ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œå¯¹äºç‹¬ç«‹éƒ¨ç½² Prometheus çš„æƒ…å†µï¼Œå¯ä»¥æ ¹æ®ä»¥ä¸Šå†…å®¹å¯¹ Prometheus è¿›è¡Œé…ç½®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è‡ªå®šä¹‰-metrics&#34;&gt;è‡ªå®šä¹‰ Metrics&lt;/h3&gt;
&lt;p&gt;åœ¨å®é™…æƒ…å†µä¸­ï¼ŒIstio è‡ªèº«æä¾›çš„æŒ‡æ ‡å¯èƒ½ä¸èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚ï¼Œéœ€è¦å¯¹å·²æœ‰æŒ‡æ ‡è¿›è¡Œä¿®æ”¹ï¼Œåˆæˆ–è€…éœ€è¦æ·»åŠ æ–°çš„æŒ‡æ ‡ä¿¡æ¯æ—¶ï¼ŒIstio æ”¯æŒè‡ªå®šä¹‰ metricsã€‚&lt;/p&gt;
&lt;p&gt;Istio ä½¿ç”¨ EnvoyFilter æ¥è‡ªå®šä¹‰ Istio Pilot ç”Ÿæˆçš„ Envoy é…ç½®ã€‚ä½¿ç”¨ EnvoyFilter å¯ä»¥ä¿®æ”¹æŸäº›å­—æ®µçš„å€¼ï¼Œæ·»åŠ ç‰¹å®šçš„è¿‡æ»¤å™¨ï¼Œç›‘å¬å™¨ç­‰ã€‚åœ¨ä¸€ä¸ª namespace ä¸‹å¯ä»¥å­˜åœ¨å¤šä¸ª EnvoyFilterï¼Œå°†æŒ‰åˆ›å»ºé¡ºåºä¾æ¬¡å¤„ç†æ‰€æœ‰ EnvoyFilterã€‚åœ¨ EnvoyFilter ä¸­å¯ä»¥è¿›è¡Œ INBOUNDã€OUTBOUNDã€GATEWAY ä¸‰ä¸ªç»´åº¦çš„è¿‡æ»¤è®¾ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢çš„ç¤ºä¾‹å°†åœ¨ istio_request_total è¿™ä¸€æŒ‡æ ‡ä¸­ï¼Œæ·»åŠ  request.host ä»¥åŠ destination.port ä¸¤ä¸ªç»´åº¦çš„ä¿¡æ¯ï¼ŒåŒæ—¶åœ¨ bookinfo çš„ review æœåŠ¡ä¸­ï¼Œæ ¹æ® request çš„è¯·æ±‚ä¿¡æ¯ï¼Œæ·»åŠ  request_operation çš„ç»´åº¦ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆåˆ›å»ºä¸€ä¸ª EnvoyFilter è¿‡æ»¤å™¨ï¼Œæ ¹æ® bookinfo ä¸­ reviews è¯·æ±‚çš„ path ä»¥åŠ methodï¼Œå¯¹ istio_operationId åˆ†åˆ«æä¾›äº† ListReviewsã€GetReviewã€CreateReview ä¸‰ç§ä¸åŒç±»å‹çš„å€¼ã€‚WorkloadSelector å¯¹åº”ç”¨æ­¤è¡¥ä¸é…ç½®çš„ Pods/VMs ç»„è¿›è¡Œé€‰æ‹©ï¼Œå¦‚æœçœç•¥æ­¤å‚æ•°ä¼šå°†æ­¤è¡¥ä¸åº”ç”¨åœ¨åŒä¸€ namespace ä¸‹æ‰€æœ‰çš„å·¥ä½œè´Ÿè½½ã€‚configPathchs ç”¨äºå®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªå…·æœ‰åŒ¹é…æ¡ä»¶çš„è¡¥ä¸ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EnvoyFilter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-attributegen-filter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configPatches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;applyTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP_FILTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SIDECAR_INBOUND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;proxy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;proxyVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1\.12.*&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filterChain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subFilter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;istio.stats&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;INSERT_BEFORE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio.attributegen&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/udpa.type.v1.TypedStruct&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type_url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configuration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/google.protobuf.StringValue&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                      {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                        &amp;#34;attributes&amp;#34;: [
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                          {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                            &amp;#34;output_attribute&amp;#34;: &amp;#34;istio_operationId&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                            &amp;#34;match&amp;#34;: [
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                              {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                                &amp;#34;value&amp;#34;: &amp;#34;ListReviews&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                                &amp;#34;condition&amp;#34;: &amp;#34;request.url_path == &amp;#39;/reviews&amp;#39; &amp;amp;&amp;amp; request.method == &amp;#39;GET&amp;#39;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                              },
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                              {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                                &amp;#34;value&amp;#34;: &amp;#34;GetReview&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                                &amp;#34;condition&amp;#34;: &amp;#34;request.url_path.matches(&amp;#39;^/reviews/[[:alnum:]]*$&amp;#39;) &amp;amp;&amp;amp; request.method == &amp;#39;GET&amp;#39;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                              },
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                              {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                                &amp;#34;value&amp;#34;: &amp;#34;CreateReview&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                                &amp;#34;condition&amp;#34;: &amp;#34;request.url_path == &amp;#39;/reviews/&amp;#39; &amp;amp;&amp;amp; request.method == &amp;#39;POST&amp;#39;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                              }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                            ]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                          }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                        ]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                      }&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.wasm.runtime.null&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;local&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;inline_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.wasm.attributegen&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶ååœ¨ stats-filter-1.12.yaml æ·»åŠ ä»¥ä¸‹é…ç½® (ç¤ºä¾‹ä½¿ç”¨ Istio ç‰ˆæœ¬ä¸º 1.12)ï¼Œä¸º request_total æŒ‡æ ‡æ·»åŠ  istio_operationã€request_hostã€destination_port è¿™ä¸‰ä¸ªç»´åº¦ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio.stats&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#39;@type&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/udpa.type.v1.TypedStruct&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type_url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configuration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/google.protobuf.StringValue&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            { 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              &amp;#34;metrics&amp;#34;: [ 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              { 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                &amp;#34;name&amp;#34;: &amp;#34;requests_total&amp;#34;, 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                &amp;#34;dimensions&amp;#34;: 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                  &amp;#34;request_operation&amp;#34;: &amp;#34;istio_operationId&amp;#34; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                  &amp;#34;destination_port&amp;#34;: string(destination.port) 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                  &amp;#34;request_host&amp;#34;: request.host
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                } 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              }] 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            }&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€ååœ¨ meshconfig ä¸‹å¼€å¯ extraStatTagsï¼Œå°† istio_operationIdã€request_hostã€destination_port ä¿¡æ¯å†™å…¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mesh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|-&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      defaultConfig:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        extraStatTags:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        - destination_port
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        - request_host
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        - request_operation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥è¯¢ istio_request_total æŒ‡æ ‡å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æŒ‡æ ‡ç»´åº¦ï¼Œè¡¨ç¤ºé…ç½®æˆåŠŸã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;istio_requests_total{app=&amp;#34;reviews&amp;#34;,destination_port=&amp;#34;9080&amp;#34;,request_host=&amp;#34;reviews:9080&amp;#34;,request_operation=&amp;#34;GetReview&amp;#34;,......}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;prometheus-federation-å¯¹-istio-å¤šé›†ç¾¤çš„æ”¯æŒ&#34;&gt;Prometheus Federation å¯¹ Istio å¤šé›†ç¾¤çš„æ”¯æŒ&lt;/h3&gt;
&lt;p&gt;åœ¨ Istio å¤šé›†ç¾¤åœºæ™¯ä¸‹ï¼Œæ¯ä¸ªé›†ç¾¤ä¼šéƒ¨ç½²ç‹¬ç«‹çš„ Prometheus æ”¶é›†è‡ªèº«çš„æŒ‡æ ‡ä¿¡æ¯ï¼Œåœ¨éœ€è¦å°†å¤šé›†ç¾¤æŒ‡æ ‡è¿›è¡Œèšåˆä»¥åŠæä¾›ç»Ÿä¸€çš„ Prometheus è®¿é—®åœ°å€æ—¶ï¼Œä¼šä½¿ç”¨ Prometheus Federation å°†å¤šé›†ç¾¤æ•°æ®èšåˆåˆ°ä¸€ä¸ªç‹¬ç«‹çš„ Prometheus å®ä¾‹ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-prometheus-è”é‚¦ç»“æ„&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Prometheus è”é‚¦ç»“æ„&#34; srcset=&#34;
               /blog/istio-observability/prometheus-federation_hu_482ce2123263a406.webp 400w,
               /blog/istio-observability/prometheus-federation_hu_fc281fec547c5db3.webp 760w,
               /blog/istio-observability/prometheus-federation_hu_344ed0fec94ab7ef.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-observability/prometheus-federation_hu_482ce2123263a406.webp&#34;
               width=&#34;760&#34;
               height=&#34;281&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Prometheus è”é‚¦ç»“æ„
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨èšåˆ Prometheus å®ä¾‹ä¸­æ·»åŠ ç±»ä¼¼é…ç½®å³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;scrape_configs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;job_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;federate&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;scrape_interval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;15s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;honor_labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metrics_path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;/federate&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;params&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#39;match[]&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s1&#34;&gt;&amp;#39;{job=&amp;#34;&amp;lt;job_name&amp;gt;&amp;#34;}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;static_configs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;targets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;s1&#34;&gt;&amp;#39;source-prometheus-1:9090&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;s1&#34;&gt;&amp;#39;source-prometheus-2:9090&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;s1&#34;&gt;&amp;#39;source-prometheus-3:9090&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;tracing&#34;&gt;Tracing&lt;/h2&gt;
&lt;p&gt;Istio æ¨èçš„åˆ†å¸ƒå¼è¿½è¸ªå·¥å…· Jaegerã€Zipkin éƒ½é€šè¿‡ OpenTracing è§„èŒƒè¿›è¡Œå®ç°ã€‚åœ¨åˆ†å¸ƒå¼è¿½è¸ªé‡Œï¼Œå­˜åœ¨ Trace å’Œ Span ä¸¤ä¸ªé‡è¦æ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Spanï¼šåˆ†å¸ƒå¼è¿½è¸ªçš„åŸºæœ¬ç»„æˆå•å…ƒï¼Œè¡¨ç¤ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å•ç‹¬çš„å·¥ä½œå•å…ƒï¼Œæ¯ä¸€ä¸ª Span å¯ä»¥åŒ…å«å…¶å®ƒ Span çš„å¼•ç”¨ã€‚å¤šä¸ª Span åœ¨ä¸€èµ·æ„æˆäº† Traceã€‚&lt;/li&gt;
&lt;li&gt;Traceï¼šå¾®æœåŠ¡ä¸­è®°å½•çš„å®Œæ•´çš„è¯·æ±‚æ‰§è¡Œè¿‡ç¨‹ï¼Œä¸€ä¸ªå®Œæ•´çš„ Trace ç”±ä¸€ä¸ªæˆ–å¤šä¸ª Span ç»„æˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio ä»£ç†èƒ½å¤Ÿè‡ªåŠ¨å‘é€ Spanï¼Œä½†æ˜¯éœ€è¦é™„åŠ å¦‚ä¸‹ HTTP è¯·æ±‚å¤´ä¿¡æ¯ï¼Œè¿™æ ·æ‰èƒ½æŠŠå¤šä¸ª Span æ­£ç¡®çš„å…³è”åˆ°åŒä¸€ä¸ªè¿½è¸ªä¸Šã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;x-request-id&lt;/li&gt;
&lt;li&gt;x-b3-traceid&lt;/li&gt;
&lt;li&gt;x-b3-spanid&lt;/li&gt;
&lt;li&gt;x-b3-parentspanid&lt;/li&gt;
&lt;li&gt;x-b3-sampled&lt;/li&gt;
&lt;li&gt;x-b3-flags&lt;/li&gt;
&lt;li&gt;x-ot-span-context&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è‡ªå®šä¹‰-tracing-é…ç½®&#34;&gt;è‡ªå®šä¹‰ Tracing é…ç½®&lt;/h3&gt;
&lt;p&gt;Istio å¯ä»¥å¯¹ä¸åŒçš„ pod è¿›è¡Œä¸åŒå…¨é“¾è·¯è¿½è¸ªçš„é…ç½®ã€‚é€šè¿‡ç»™ POD æ·»åŠ åä¸º proxy.istio.io/config çš„ annotationï¼Œæ¥é…ç½®è¯¥ Pod çš„è¿½è¸ªé‡‡æ ·ç‡ã€è‡ªå®šä¹‰ tag ç­‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;proxy.istio.io/config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      tracing:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        sampling: 10
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          custom_tags:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            my_tag_header:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              header:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                name: host&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹Ÿå¯ä»¥é€šè¿‡ meshconfig è¿›è¡Œå…¨å±€çš„ tracing é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mesh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|-&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      defaultConfig:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        tracing:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          sampling: 1.0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          max_path_tag_length: 256
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          custom_tags:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            clusterID:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              environment:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                name: ISTIO_META_CLUSTER_ID&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»¥ä¸Šé…ç½®å¿…é¡»é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆï¼Œè¿™æ˜¯å› ä¸º config ä½œç”¨çš„æ—¶é—´ç‚¹æ˜¯ Istio æ³¨å…¥ sidecar çš„æ—¶å€™ï¼Œè¿™æ ·é…ç½®çš„ tracingï¼Œå¯¹äº Envoy æ¥è¯´ï¼Œæ˜¯æ”¾åœ¨äº† bootstrap é…ç½®é‡Œé¢ï¼Œä¸èƒ½åœ¨çº¿å˜æ›´å’Œä¿®æ”¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;logging&#34;&gt;Logging&lt;/h2&gt;
&lt;p&gt;Istio å¯ä»¥æ£€æµ‹åˆ°ç½‘æ ¼å†…çš„æœåŠ¡é€šä¿¡çš„æµè½¬æƒ…å†µï¼Œå¹¶ç”Ÿæˆè¯¦ç»†çš„é¥æµ‹æ•°æ®æ—¥å¿—ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio é€šè¿‡ meshConfig.accessLogFile=/dev/stdout å¼€å¯äº† Envoy è®¿é—®æ—¥å¿—ï¼Œæ—¥å¿—ä¿¡æ¯å¯ä»¥ç»è¿‡ stdout æ ‡å‡†è¾“å‡ºã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ accessLogEncoding å’Œ accessLogFormat è®¾ç½®æ—¥å¿—æ ¼å¼ã€‚&lt;/p&gt;
&lt;p&gt;Envoy æ—¥å¿—å¯ä»¥ä½¿ç”¨ kubectl logs å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ï¼Œä½†æ˜¯å½“ Pod è¢«é”€æ¯åï¼Œæ—§çš„æ—¥å¿—å°†ä¸å¤å­˜åœ¨ï¼Œå¦‚æœè¦æŸ¥çœ‹å†å²çš„çš„æ—¥å¿—æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨ EFKã€Loki ç­‰å·¥å…·å¯¹æ—¥å¿—è¿›è¡ŒæŒä¹…åŒ–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-å¯è§†åŒ–&#34;&gt;Istio å¯è§†åŒ–&lt;/h2&gt;
&lt;p&gt;Kiali æ˜¯ Istio æœåŠ¡ç½‘æ ¼å¯è§†åŒ–å·¥å…·ï¼Œæä¾›äº†æœåŠ¡æ‹“è¡¥å›¾ã€å…¨é“¾è·¯è·Ÿè¸ªã€æŒ‡æ ‡é¥æµ‹ã€é…ç½®æ ¡éªŒã€å¥åº·æ£€æŸ¥ç­‰åŠŸèƒ½ã€‚Kiali éœ€è¦ Prometheus ä¸ºå…¶æä¾›æŒ‡æ ‡ä¿¡æ¯ï¼Œè¿˜å¯ä»¥é…ç½® Jaeger å’Œ Grafanaï¼Œå®ç°åˆ†å¸ƒå¼è¿½è¸ªå’Œç›‘æ§æ•°æ®å¯è§†åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒKiali ä½¿ç”¨ prometheus.isito-system:9090 ä½œä¸ºå…¶ Prometheus æ•°æ®æºã€‚å½“ä¸ä½¿ç”¨ Istio æä¾›çš„ sample/addonï¼Œç‹¬ç«‹éƒ¨ç½² Prometheus æ—¶ï¼Œéœ€è¦åœ¨ Kiali çš„ configmap ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;external_services&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;	&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prometheus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;	  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;prometheus å®é™…åœ°å€&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤å¤–ï¼Œå¦‚æœéœ€è¦åœ¨ Kali ä¸­åŠ å…¥åˆ†å¸ƒå¼è¿½è¸ªå’Œç›‘æ§æ•°æ®å¯è§†åŒ–çš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥åœ¨ external_services ä¸‹é…ç½® Jaeger å’Œ Grafana çš„å®é™…åœ°å€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;kiali-å¤šé›†ç¾¤æ”¯æŒ&#34;&gt;Kiali å¤šé›†ç¾¤æ”¯æŒ&lt;/h3&gt;
&lt;p&gt;Kiali é»˜è®¤å¼€å¯ Istio å¤šé›†ç¾¤æ”¯æŒï¼Œè‹¥éœ€è¦å…³é—­æ­¤æ”¯æŒï¼Œå¯ä»¥è¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kiali_feature_flags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;	&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clustering&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;	  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šå¸¸ï¼Œæ¯ä¸ª istiod æ§åˆ¶é¢ä¸Šä¼šéƒ¨ç½²ä¸€ä¸ª Kialiã€‚åœ¨ Isito å¤šé›†ç¾¤ä¸»ä»æ¨¡å¼ä¸‹ï¼Œåªæœ‰ä¸»æœºç¾¤ä¸Šéƒ¨ç½²äº† Kialiï¼Œä»é›†ç¾¤ä¸Šå¯¹åº”ç”¨çš„è®¿é—®ï¼Œæ­¤æ—¶é€šè¿‡ Kiali æ˜¯ä¸èƒ½å¤ŸæŸ¥è¯¢åˆ°å¯¹åº”æµé‡ä¿¡æ¯çš„ã€‚éœ€è¦ä¸ºä¸»ä»é›†ç¾¤çš„ Prometheus è¿›è¡Œè”é‚¦é…ç½®ï¼Œè¿™æ ·æ‰èƒ½å¤ŸæŸ¥è¯¢åˆ°ä»é›†ç¾¤è‡ªèº«çš„æŒ‡æ ‡æµé‡ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒæ–‡çŒ®&#34;&gt;å‚è€ƒæ–‡çŒ®&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/istio-handbook/config-networking/envoy-filter/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EnvoyFilter - lib.jimmysong.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/tasks/observability/metrics/classify-metrics/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Classifying Metrics Based on Request or Response - istio.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/513448061&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æœåŠ¡ç½‘æ ¼ä¸å…¨é“¾è·¯è¿½è¸ªçš„å…¨æ–¹ä½æ”»ç•¥ - zhuanlan.zhihu.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.csdn.net/A13581861752/article/details/124311885&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯è§‚æµ‹æ€§ï¼ˆä¸€ï¼‰- blog.csdn.net&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>å¦‚ä½•åœ¨ Istio ä¸­é›†æˆ SPIRE</title>
      <link>https://cloudnativecn.com/blog/istio-spire-integration/</link>
      <pubDate>Mon, 06 Jun 2022 11:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-spire-integration/</guid>
      <description>&lt;h2 id=&#34;ç¼–è€…çš„è¯&#34;&gt;ç¼–è€…çš„è¯&lt;/h2&gt;
&lt;p&gt;Istio 1.14 ç‰ˆæœ¬å¢åŠ äº†å¯¹ SPIRE é›†æˆçš„æ”¯æŒï¼Œè¿™ç¯‡æ–‡ç« å°†æŒ‡å¯¼ä½ å¦‚ä½•åœ¨ Istio ä¸­é›†æˆ SPIREã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://spiffe.io/docs/latest/spire-about/spire-concepts/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE&lt;/a&gt; æ˜¯ SPIFFE è§„èŒƒçš„ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„å®ç°ï¼Œå®ƒå¯ä»¥æ‰§è¡ŒèŠ‚ç‚¹å’Œå·¥ä½œè´Ÿè½½è¯æ˜ï¼Œä»¥ä¾¿å®‰å…¨åœ°å°†åŠ å¯†èº«ä»½å‘ç»™åœ¨å¼‚æ„ç¯å¢ƒä¸­è¿è¡Œçš„å·¥ä½œè´Ÿè½½ã€‚é€šè¿‡ä¸ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/security/secret&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy çš„ SDS API&lt;/a&gt; é›†æˆï¼ŒSPIRE å¯ä»¥è¢«é…ç½®ä¸º Istio å·¥ä½œè´Ÿè½½çš„åŠ å¯†èº«ä»½æ¥æºã€‚Istio å¯ä»¥æ£€æµ‹åˆ°ä¸€ä¸ª UNIX åŸŸå¥—æ¥å­—çš„å­˜åœ¨ï¼Œè¯¥å¥—æ¥å­—åœ¨å®šä¹‰çš„å¥—æ¥å­—è·¯å¾„ä¸Šå®ç°äº† Envoy SDS APIï¼Œå…è®¸ Envoy ç›´æ¥ä»å®ƒé‚£é‡Œè¿›è¡Œé€šä¿¡å’Œè·å–èº«ä»½ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§ä¸ SPIRE çš„é›†æˆæä¾›äº†çµæ´»çš„è®¤è¯é€‰é¡¹ï¼Œè¿™æ˜¯é»˜è®¤çš„ Istio èº«ä»½ç®¡ç†æ‰€ä¸å…·å¤‡çš„ï¼ŒåŒæ—¶åˆ©ç”¨äº† Istio å¼ºå¤§çš„æœåŠ¡ç®¡ç†ã€‚ä¾‹å¦‚ï¼ŒSPIRE çš„æ’ä»¶æ¶æ„èƒ½å¤Ÿæä¾›å¤šæ ·åŒ–çš„å·¥ä½œè´Ÿè½½è®¤è¯é€‰é¡¹ï¼Œè¶…è¶Š Istio æä¾›çš„ Kubernetes å‘½åç©ºé—´å’ŒæœåŠ¡è´¦æˆ·è®¤è¯ã€‚SPIRE çš„èŠ‚ç‚¹è®¤è¯å°†è®¤è¯æ‰©å±•åˆ°å·¥ä½œè´Ÿè½½è¿è¡Œçš„ç‰©ç†æˆ–è™šæ‹Ÿç¡¬ä»¶ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å…³äºè¿™ç§ SPIRE ä¸ Istio é›†æˆçš„å¿«é€Ÿæ¼”ç¤ºï¼Œè¯·å‚é˜…&lt;a href=&#34;https://github.com/istio/istio/tree/release-1.14/samples/security/spire&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€šè¿‡ Envoy çš„ SDS API å°† SPIRE ä½œä¸º CA è¿›è¡Œé›†æˆ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œè¿™ä¸ªé›†æˆéœ€è¦ 1.14 ç‰ˆæœ¬çš„ &lt;code&gt;istioctl&lt;/code&gt; å’Œæ•°æ®å¹³é¢ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥é›†æˆä¸ Istio çš„å‡çº§å…¼å®¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…-spire&#34;&gt;å®‰è£… SPIRE&lt;/h2&gt;
&lt;h3 id=&#34;é€‰é¡¹-1-å¿«é€Ÿå¯åŠ¨&#34;&gt;é€‰é¡¹ 1: å¿«é€Ÿå¯åŠ¨&lt;/h3&gt;
&lt;p&gt;Istio æä¾›äº†ä¸€ä¸ªåŸºæœ¬çš„å®‰è£…ç¤ºä¾‹ï¼Œä»¥å¿«é€Ÿå¯åŠ¨å’Œè¿è¡Œ SPIREã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f samples/security/spire/spire-quickstart.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†æŠŠ SPIRE éƒ¨ç½²åˆ°ä½ çš„é›†ç¾¤ä¸­ï¼ŒåŒæ—¶è¿˜æœ‰ä¸¤ä¸ªé¢å¤–çš„ç»„ä»¶ï¼š&lt;a href=&#34;https://github.com/spiffe/spiffe-csi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIFFE CSI é©±åŠ¨&lt;/a&gt; â€”â€” ç”¨äºä¸æ•´ä¸ªèŠ‚ç‚¹çš„å…¶ä»– pod å…±äº« SPIRE Agent çš„ UNIX åŸŸå¥—æ¥å­—ï¼Œä»¥åŠ &lt;a href=&#34;https://github.com/spiffe/spire/tree/main/support/k8s/k8s-workload-registrar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE Kubernetes å·¥ä½œè´Ÿè½½æ³¨å†Œå™¨&lt;/a&gt;ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨ Kubernetes å†…æ‰§è¡Œè‡ªåŠ¨å·¥ä½œè´Ÿè½½æ³¨å†Œçš„ä¿ƒè¿›å™¨ã€‚å‚è§&lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#install-istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£… Istio&lt;/a&gt; ä»¥é…ç½® Istio å¹¶ä¸ SPIFFE CSI é©±åŠ¨é›†æˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;é€‰é¡¹-2é…ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„-spire-å®‰è£…&#34;&gt;é€‰é¡¹ 2ï¼šé…ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„ SPIRE å®‰è£…&lt;/h3&gt;
&lt;p&gt;è¯·å‚é˜… &lt;a href=&#34;https://spiffe.io/docs/latest/try/getting-started-k8s/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE çš„ Kubernetes å¿«é€Ÿå…¥é—¨æŒ‡å—&lt;/a&gt;ï¼Œå°† SPIRE éƒ¨ç½²åˆ° Kubernetes ç¯å¢ƒä¸­ã€‚è¯·å‚é˜… SPIRE &lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#spire-ca-integration-prerequisites&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CA é›†æˆå…ˆå†³æ¡ä»¶&lt;/a&gt;ï¼Œäº†è§£æœ‰å…³é…ç½® SPIRE ä»¥ä¸ Istio éƒ¨ç½²é›†æˆçš„æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;spire-ca-é›†æˆçš„å…ˆå†³æ¡ä»¶&#34;&gt;SPIRE CA é›†æˆçš„å…ˆå†³æ¡ä»¶&lt;/h4&gt;
&lt;p&gt;å°† SPIRE éƒ¨ç½²ä¸ Istio é›†æˆï¼Œé…ç½® SPIREï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è®¿é—® &lt;a href=&#34;https://spiffe.io/docs/latest/deploying/spire_agent/#agent-configuration-file&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE ä»£ç†å‚è€ƒ&lt;/a&gt;ï¼Œé…ç½® SPIRE ä»£ç†å¥—æ¥å­—è·¯å¾„ï¼Œä»¥åŒ¹é… Envoy SDS å®šä¹‰çš„å¥—æ¥å­—è·¯å¾„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;socket_path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/run/secrets/workload-spiffe-uds/socket&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡éƒ¨ç½² &lt;a href=&#34;https://github.com/spiffe/spiffe-csi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIFFE CSI é©±åŠ¨&lt;/a&gt;ï¼Œä¸èŠ‚ç‚¹å†…çš„ pod å…±äº« SPIRE ä»£ç†å¥—æ¥å­—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‚è§&lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#install-istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£… Istio&lt;/a&gt; ä»¥é…ç½® Istio ä¸ SPIFFE CSI é©±åŠ¨é›†æˆã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼Œä½ å¿…é¡»åœ¨å°† Istio å®‰è£…åˆ°ä½ çš„ç¯å¢ƒä¸­ä¹‹å‰éƒ¨ç½² SPIREï¼Œä»¥ä¾¿ Istio å¯ä»¥æ£€æµ‹åˆ°å®ƒæ˜¯ä¸€ä¸ª CAã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…-istio&#34;&gt;å®‰è£… Istio&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/latest/docs/setup/getting-started/#download&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸‹è½½ Istio 1.14 + ç‰ˆæœ¬&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#install-spire&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å°† SPIRE éƒ¨ç½²&lt;/a&gt;åˆ°ä½ çš„ç¯å¢ƒä¸­ï¼Œå¹¶éªŒè¯æ‰€æœ‰çš„éƒ¨ç½²éƒ½å¤„äº &lt;code&gt;Ready&lt;/code&gt; çŠ¶æ€åï¼Œä¸º Ingress-gateway ä»¥åŠ istio-proxy å®‰è£… Istio çš„å®šåˆ¶è¡¥ä¸ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;$ istioctl install --skip-confirmation -f - &amp;lt;&amp;lt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meshConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trustDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;example.org&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;global&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# This is used to customize the sidecar template&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sidecarInjectorWebhook&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;templates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            containers:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            - name: istio-proxy
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              volumeMounts:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              - name: workload-socket
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                mountPath: /run/secrets/workload-spiffe-uds
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                readOnly: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            volumes:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              - name: workload-socket
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                csi:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                  driver: &amp;#34;csi.spiffe.io&amp;#34;          &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingressGateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;label&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;overlays&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;spec.template.spec.volumes.[name:workload-socket]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;workload-socket&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;driver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;csi.spiffe.io&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;spec.template.spec.containers.[name:istio-proxy].volumeMounts.[name:workload-socket]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;workload-socket&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/run/secrets/workload-spiffe-uds&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†ä¸ Ingress Gateway å’Œå°†è¢«æ³¨å…¥å·¥ä½œè´Ÿè½½ pod çš„ sidecars å…±äº« &lt;code&gt;spiffe-csi-driver&lt;/code&gt;ï¼Œå…è®¸å®ƒä»¬è®¿é—® SPIRE Agent çš„ UNIX åŸŸå¥—æ¥å­—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ &lt;a href=&#34;https://istio.io/latest/docs/setup/additional-setup/sidecar-injection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sidecar æ³¨å…¥&lt;/a&gt;ï¼Œå°† &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨æ³¨å…¥åˆ°ç½‘æ ¼å†…çš„ pod ä¸­ã€‚å…³äºå¦‚ä½•å°†è‡ªå®šä¹‰çš„ &lt;code&gt;spire&lt;/code&gt; æ¨¡æ¿åº”ç”¨åˆ° &lt;code&gt;istio-proxy&lt;/code&gt; ä¸­çš„ä¿¡æ¯ï¼Œè¯·å‚è§&lt;a href=&#34;https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#custom-templates-experimental&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªå®šä¹‰æ¨¡æ¿&lt;/a&gt;ã€‚è¿™ä½¿å¾— CSI é©±åŠ¨èƒ½å¤Ÿåœ¨ sidecar ä¸Šå®‰è£… UDSã€‚&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥ Ingress-gateway pod çŠ¶æ€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                    READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-ingressgateway-5b45864fd4-lgrxs   0/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          17s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istiod-989f54d9c-sg7sn                  1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          23s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åªæœ‰åœ¨ SPIRE æœåŠ¡å™¨ä¸Šä¸ºå®ƒä»¬åˆ›å»ºäº†ç›¸åº”çš„æ³¨å†Œæ¡ç›®æ—¶ï¼Œæ•°æ®å¹³é¢å®¹å™¨æ‰ä¼šåˆ°è¾¾ &lt;code&gt;Ready&lt;/code&gt;ã€‚ç„¶åï¼ŒEnvoy å°†èƒ½å¤Ÿä» SPIRE è·å–åŠ å¯†èº«ä»½ã€‚è¯·å‚é˜…&lt;a href=&#34;#register-workloads&#34;&gt;æ³¨å†Œå·¥ä½œè´Ÿè½½&lt;/a&gt; ï¼Œä¸ºä½ çš„ç½‘æ ¼ä¸­çš„æœåŠ¡æ³¨å†Œæ¡ç›®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;register-workloads&#34;&gt;æ³¨å†Œå·¥ä½œè´Ÿè½½&lt;/h2&gt;
&lt;p&gt;æœ¬èŠ‚ä»‹ç»åœ¨ SPIRE æœåŠ¡å™¨ä¸­æ³¨å†Œå·¥ä½œè´Ÿè½½çš„å¯ç”¨é€‰é¡¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é€‰é¡¹-1ä½¿ç”¨-spire-å·¥ä½œè´Ÿè½½æ³¨å†Œå™¨è‡ªåŠ¨ç™»è®°&#34;&gt;é€‰é¡¹ 1ï¼šä½¿ç”¨ SPIRE å·¥ä½œè´Ÿè½½æ³¨å†Œå™¨è‡ªåŠ¨ç™»è®°&lt;/h3&gt;
&lt;p&gt;é€šè¿‡å°† &lt;a href=&#34;https://github.com/spiffe/spire/tree/main/support/k8s/k8s-workload-registrar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE Kubernetes Workload Registrar&lt;/a&gt; ä¸ SPIRE æœåŠ¡å™¨ä¸€èµ·éƒ¨ç½²ï¼Œæ¯åˆ›å»ºä¸€ä¸ªæ–°çš„ podï¼Œå°±ä¼šè‡ªåŠ¨æ³¨å†Œæ–°çš„æ¡ç›®ã€‚&lt;/p&gt;
&lt;p&gt;è¯·å‚é˜…â€ &lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#verifying-that-identities-were-created-for-workloads&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éªŒè¯èº«ä»½æ˜¯å¦ä¸ºå·¥ä½œè´Ÿè½½åˆ›å»º&lt;/a&gt; &amp;ldquo;ï¼Œä»¥æ£€æŸ¥å·²å‘å¸ƒçš„èº«ä»½ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œåœ¨&lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#option-1:-quick-start&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¿«é€Ÿå¯åŠ¨&lt;/a&gt;éƒ¨åˆ†ä½¿ç”¨äº† &lt;code&gt;SPIREå·¥ä½œè´Ÿè½½æ³¨å†Œå™¨&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é€‰é¡¹-2æ‰‹åŠ¨æ³¨å†Œ&#34;&gt;é€‰é¡¹ 2ï¼šæ‰‹åŠ¨æ³¨å†Œ&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†æé«˜å·¥ä½œè´Ÿè½½è¯æ˜çš„å®‰å…¨ç¨³å¥æ€§ï¼ŒSPIRE èƒ½å¤Ÿæ ¹æ®ä¸åŒçš„å‚æ•°ï¼Œé’ˆå¯¹ä¸€ç»„é€‰æ‹©å™¨çš„å€¼è¿›è¡ŒéªŒè¯ã€‚å¦‚æœä½ æŒ‰ç…§&lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#option-1:-quick-start&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¿«é€Ÿå¯åŠ¨&lt;/a&gt;å®‰è£… &lt;code&gt;SPIRE&lt;/code&gt;ï¼Œåˆ™è·³è¿‡è¿™äº›æ­¥éª¤ï¼Œå› ä¸ºå®ƒä½¿ç”¨è‡ªåŠ¨æ³¨å†Œã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸º Ingress Gateway ç”Ÿæˆä¸€ä¸ªæ¡ç›®ï¼Œå…¶ä¸­æœ‰ä¸€ç»„é€‰æ‹©å™¨ï¼Œå¦‚ pod åç§°å’Œ pod UIDï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;INGRESS_POD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ingressgateway -n istio-system -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[0].metadata.name}&amp;#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;INGRESS_POD_UID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pods -n istio-system &lt;span class=&#34;nv&#34;&gt;$INGRESS_POD&lt;/span&gt; -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.metadata.uid}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·å– spire-server podï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;SPIRE_SERVER_POD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;spire-server -n spire -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[0].metadata.name}&amp;#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸ºèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ SPIRE ä»£ç†æ³¨å†Œä¸€ä¸ªæ¡ç›®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;$ kubectl exec -n spire $SPIRE_SERVER_POD -- \&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/opt/spire/bin/spire-server entry create \&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;l&#34;&gt;spiffeID spiffe://example.org/ns/spire/sa/spire-agent \&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;l&#34;&gt;selector k8s_psat:cluster:demo-cluster \&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;l&#34;&gt;selector k8s_psat:agent_ns:spire \&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;l&#34;&gt;selector k8s_psat:agent_sa:spire-agent \&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;l&#34;&gt;node -socketPath /run/spire/sockets/server.sock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;Entry ID         &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;d38c88d0-7d7a-4957-933c-361a0a3b039c&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;SPIFFE ID        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;spiffe://example.org/ns/spire/sa/spire-agent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;Parent ID        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;spiffe://example.org/spire/server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;Revision         &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;TTL              &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;Selector         &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;k8s_psat:agent_ns:spire&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;Selector         &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;k8s_psat:agent_sa:spire-agent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;Selector         &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;k8s_psat:cluster:demo-cluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸º Ingress-gateway pod æ³¨å†Œä¸€ä¸ªæ¡ç›®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -n spire &lt;span class=&#34;nv&#34;&gt;$SPIRE_SERVER_POD&lt;/span&gt; -- &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;/opt/spire/bin/spire-server entry create &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -spiffeID spiffe://example.org/ns/istio-system/sa/istio-ingressgateway-service-account &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -parentID spiffe://example.org/ns/spire/sa/spire-agent &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -selector k8s:sa:istio-ingressgateway-service-account &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -selector k8s:ns:istio-system &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -selector k8s:pod-uid:&lt;span class=&#34;nv&#34;&gt;$INGRESS_POD_UID&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -dns &lt;span class=&#34;nv&#34;&gt;$INGRESS_POD&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -dns istio-ingressgateway.istio-system.svc &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -socketPath /run/spire/sockets/server.sock
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Entry ID         : 6f2fe370-5261-4361-ac36-10aae8d91ff7
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SPIFFE ID        : spiffe://example.org/ns/istio-system/sa/istio-ingressgateway-service-account
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Parent ID        : spiffe://example.org/ns/spire/sa/spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Revision         : &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TTL              : default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:ns:istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:pod-uid:63c2bbf5-a8b1-4b1f-ad64-f62ad2a69807
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:sa:istio-ingressgateway-service-account
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNS name         : istio-ingressgateway.istio-system.svc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNS name         : istio-ingressgateway-5b45864fd4-lgrxs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éƒ¨ç½²ä¸€ä¸ªå·¥ä½œè´Ÿè½½çš„ä¾‹å­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl kube-inject --filename @samples/security/spire/sleep-spire.yaml &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯·æ³¨æ„ï¼Œå·¥ä½œè´Ÿè½½å°†éœ€è¦ SPIFFE CSI é©±åŠ¨å·æ¥è®¿é—® SPIRE ä»£ç†å¥—æ¥å­—ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥åˆ©ç”¨&lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#install-istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£… Istio&lt;/a&gt; éƒ¨åˆ†çš„ &lt;code&gt;spire &lt;/code&gt;pod æ³¨é‡Šæ¨¡æ¿ï¼Œæˆ–å°† CSI å·æ·»åŠ åˆ°å·¥ä½œè´Ÿè½½çš„éƒ¨ç½²è§„èŒƒä¸­ã€‚è¿™ä¸¤ç§æ–¹æ³•åœ¨ä¸‹é¢çš„ç¤ºä¾‹ç‰‡æ®µä¸­éƒ½æœ‰å¼ºè°ƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Injects custom sidecar template&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;inject.istio.io/templates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;sidecar,spire&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;terminationGracePeriodSeconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;curlimages/curl&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/bin/sleep&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;3650d&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tmp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/tmp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;securityContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runAsUser&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tmp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;emptyDir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# CSI volume&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;workload-socket&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;driver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;csi.spiffe.io&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·å– pod ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;SLEEP_POD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sleep -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[0].metadata.name}&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;SLEEP_POD_UID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pods &lt;span class=&#34;nv&#34;&gt;$SLEEP_POD&lt;/span&gt; -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.metadata.uid}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ³¨å†Œå·¥ä½œè´Ÿè½½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -n spire spire-server-0 -- &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;/opt/spire/bin/spire-server entry create &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -spiffeID spiffe://example.org/ns/default/sa/sleep &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -parentID spiffe://example.org/ns/spire/sa/spire-agent &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -selector k8s:ns:default &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -selector k8s:pod-uid:&lt;span class=&#34;nv&#34;&gt;$SLEEP_POD_UID&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -dns &lt;span class=&#34;nv&#34;&gt;$SLEEP_POD&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -socketPath /run/spire/sockets/server.sock
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å·¥ä½œè´Ÿè½½çš„ SPIFFE ID å¿…é¡»éµå¾ª Istio SPIFFE ID æ¨¡å¼ï¼š&lt;code&gt;spiffe://&amp;lt;trust.domain&amp;gt;/ns/&amp;lt;namespace&amp;gt;/sa/&amp;lt;service-account&amp;gt;ã€‚&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¯·å‚é˜… &lt;a href=&#34;https://spiffe.io/docs/latest/deploying/registering/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE å…³äºæ³¨å†Œå·¥ä½œè´Ÿè½½çš„å¸®åŠ©&lt;/a&gt;ï¼Œäº†è§£å¦‚ä½•ä¸ºå·¥ä½œè´Ÿè½½åˆ›å»ºæ–°æ¡ç›®ï¼Œå¹¶ä½¿ç”¨å¤šä¸ªé€‰æ‹©å™¨åŠ å¼ºéªŒè¯æ ‡å‡†ï¼Œä½¿å…¶å¾—åˆ°éªŒè¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éªŒè¯æ˜¯å¦ä¸ºå·¥ä½œè´Ÿè½½åˆ›å»ºäº†èº«ä»½&#34;&gt;éªŒè¯æ˜¯å¦ä¸ºå·¥ä½œè´Ÿè½½åˆ›å»ºäº†èº«ä»½&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥ç¡®è®¤ä¸ºå·¥ä½œè´Ÿè½½åˆ›å»ºäº†èº«ä»½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -i -t &lt;span class=&#34;nv&#34;&gt;$SPIRE_SERVER_POD&lt;/span&gt; -n spire -c spire-server -- /bin/sh -c &lt;span class=&#34;s2&#34;&gt;&amp;#34;bin/spire-server entry show -socketPath /run/spire/sockets/server.sock&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Found &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; entries
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Entry ID         : c8dfccdc-9762-4762-80d3-5434e5388ae7
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SPIFFE ID        : spiffe://example.org/ns/istio-system/sa/istio-ingressgateway-service-account
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Parent ID        : spiffe://example.org/ns/spire/sa/spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Revision         : &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TTL              : default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:ns:istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:pod-uid:88b71387-4641-4d9c-9a89-989c88f7509d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:sa:istio-ingressgateway-service-account
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNS name         : istio-ingressgateway-5b45864fd4-lgrxs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Entry ID         : af7b53dc-4cc9-40d3-aaeb-08abbddd8e54
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SPIFFE ID        : spiffe://example.org/ns/default/sa/sleep
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Parent ID        : spiffe://example.org/ns/spire/sa/spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Revision         : &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TTL              : default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:ns:default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:pod-uid:ee490447-e502-46bd-8532-5a746b0871d6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNS name         : sleep-5f4d47c948-njvpk
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Entry ID         : f0544fd7-1945-4bd1-88dc-0a5513fdae1c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SPIFFE ID        : spiffe://example.org/ns/spire/sa/spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Parent ID        : spiffe://example.org/spire/server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Revision         : &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TTL              : default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s_psat:agent_ns:spire
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s_psat:agent_sa:spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s_psat:cluster:demo-cluster
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ£€æŸ¥ Ingress-gateway pod çŠ¶æ€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                    READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-ingressgateway-5b45864fd4-lgrxs   1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          60s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istiod-989f54d9c-sg7sn                  1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          45s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ä¸º Ingress-gateway pod æ³¨å†Œæ¡ç›®åï¼ŒEnvoy ä¼šæ”¶åˆ°ç”± SPIRE ç­¾å‘çš„èº«ä»½ï¼Œå¹¶å°†å…¶ç”¨äºæ‰€æœ‰ TLS å’Œ mTLS é€šä¿¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ£€æŸ¥å·¥ä½œè´Ÿè½½èº«ä»½æ˜¯å¦æ˜¯ç”±-spire-ç­¾å‘çš„&#34;&gt;æ£€æŸ¥å·¥ä½œè´Ÿè½½èº«ä»½æ˜¯å¦æ˜¯ç”± SPIRE ç­¾å‘çš„&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;istioctl proxy-config secret&lt;/code&gt; å‘½ä»¤æ£€ç´¢ sleep çš„ SVID èº«ä»½æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl proxy-config secret &lt;span class=&#34;nv&#34;&gt;$SLEEP_POD&lt;/span&gt; -o json &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;.dynamicActiveSecrets[0].secret.tlsCertificate.certificateChain.inlineBytes&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 --decode &amp;gt; chain.pem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ£€æŸ¥è¯ä¹¦å¹¶æ ¸å® SPIRE æ˜¯å‘è¡Œäººã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ openssl x509 -in chain.pem -text &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep SPIRE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Subject: &lt;span class=&#34;nv&#34;&gt;C&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; US, &lt;span class=&#34;nv&#34;&gt;O&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; SPIRE, &lt;span class=&#34;nv&#34;&gt;CN&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; sleep-5f4d47c948-njvpk
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;spiffe-è”é‚¦&#34;&gt;SPIFFE è”é‚¦&lt;/h2&gt;
&lt;p&gt;SPIRE æœåŠ¡å™¨èƒ½å¤Ÿå¯¹æ¥è‡ªä¸åŒä¿¡ä»»åŸŸçš„ SPIFFE èº«ä»½è¿›è¡Œè®¤è¯ã€‚è¿™è¢«ç§°ä¸º SPIFFE è”é‚¦ã€‚&lt;/p&gt;
&lt;p&gt;SPIRE Agent å¯ä»¥è¢«é…ç½®ä¸ºé€šè¿‡ Envoy SDS API å‘ Envoy æ¨é€è”åˆèº«ä»½åŒ…ï¼Œå…è®¸ Envoy ä½¿ç”¨&lt;a href=&#34;https://spiffe.io/docs/latest/microservices/envoy/#validation-context&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éªŒè¯ä¸Šä¸‹æ–‡&lt;/a&gt;æ¥éªŒè¯å¯¹ç­‰çš„è¯ä¹¦å¹¶ä¿¡ä»»æ¥è‡ªå¦ä¸€ä¸ªä¿¡ä»»åŸŸçš„å·¥ä½œè´Ÿè½½ã€‚ä¸ºäº†ä½¿ Istio èƒ½å¤Ÿé€šè¿‡ SPIRE é›†æˆæ¥è”åˆ SPIFFE èº«ä»½ï¼Œè¯·æŸ¥é˜… &lt;a href=&#34;https://github.com/spiffe/spire/blob/main/doc/spire_agent.md#sds-configuration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE Agent SDS é…ç½®&lt;/a&gt;ï¼Œå¹¶ä¸ºä½ çš„ SPIRE Agent é…ç½®æ–‡ä»¶è®¾ç½®ä»¥ä¸‹ SDS é…ç½®å€¼ã€‚&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;é…ç½®&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;æè¿°&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;èµ„æºåç§°&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;default_svid_name&lt;/code&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;TLS è¯ä¹¦èµ„æºåç§°ï¼Œç”¨äº Envoy SDS çš„é»˜è®¤ X509-SVIDã€‚&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;default&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;default_bundle_name&lt;/code&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;ç”¨äº Envoy SDS çš„é»˜è®¤ X.509 æ†ç»‘åŒ…çš„éªŒè¯ä¸Šä¸‹æ–‡èµ„æºåç§°ã€‚&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;null&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;default_all_bundles_name&lt;/code&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;æ‰€æœ‰ä½¿ç”¨ Envoy SDS çš„æ†ç»‘åŒ…ï¼ˆåŒ…æ‹¬è”åˆåŒ…ï¼‰æ‰€ä½¿ç”¨çš„éªŒè¯ä¸Šä¸‹æ–‡èµ„æºåç§°ã€‚&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;ROOTCA&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¿™è®© Envoy å¯ä»¥ç›´æ¥ä» SPIRE è·å¾—è”åˆæ†ç»‘åŒ…ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ›å»ºè”åˆæ³¨å†Œæ¡ç›®&#34;&gt;åˆ›å»ºè”åˆæ³¨å†Œæ¡ç›®&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨ SPIRE Kubernetes å·¥ä½œè´Ÿè½½æ³¨å†Œå™¨ï¼Œé€šè¿‡å‘æœåŠ¡éƒ¨ç½²è§„èŒƒæ·»åŠ  pod æ³¨é‡Š &lt;code&gt;spiffe.io/federatesWith&lt;/code&gt;ï¼ŒæŒ‡å®šä½ å¸Œæœ› pod ä¸ä¹‹è”åˆçš„ä¿¡ä»»åŸŸï¼Œä¸ºå·¥ä½œè´Ÿè½½åˆ›å»ºè”åˆæ¡ç›®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;podAnnotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spiffe.io/federatesWith&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;lt;trust.domain&amp;gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…³äºæ‰‹åŠ¨æ³¨å†Œï¼Œè¯·å‚è§&lt;a href=&#34;https://spiffe.io/docs/latest/architecture/federation/readme/#create-registration-entries-for-federation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸ºè”é‚¦åˆ›å»ºæ³¨å†Œæ¡ç›®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¸…ç†-spire&#34;&gt;æ¸…ç† SPIRE&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ ä½¿ç”¨ Istio æä¾›çš„å¿«é€Ÿå¯åŠ¨ SPIRE éƒ¨ç½²æ¥å®‰è£… SPIREï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åˆ é™¤è¿™äº› Kubernetes èµ„æºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete CustomResourceDefinition spiffeids.spiffeid.spiffe.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -n spire serviceaccount spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -n spire configmap spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -n spire deployment spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete csidriver csi.spiffe.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -n spire configmap spire-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -n spire service spire-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -n spire serviceaccount spire-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -n spire statefulset spire-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete clusterrole spire-server-trust-role spire-agent-cluster-role
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete clusterrolebinding spire-server-trust-role-binding spire-agent-cluster-role-binding
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete namespace spire
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Istio 1.14 å‘å¸ƒ</title>
      <link>https://cloudnativecn.com/blog/istio-1-14-release/</link>
      <pubDate>Thu, 02 Jun 2022 08:03:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-1-14-release/</guid>
      <description>&lt;p&gt;ç«¯åˆèŠ‚å‰å¤•ï¼ŒIstio 1.14 å‘å¸ƒã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ 2022 å¹´çš„ç¬¬äºŒä¸ª Istio ç‰ˆæœ¬ã€‚æˆ‘ä»¬è¦æ„Ÿè°¢æ•´ä¸ª Istio ç¤¾åŒºå¯¹ Istio 1.14.0 å‘å¸ƒçš„å¸®åŠ©ã€‚ç‰¹åˆ«æ„Ÿè°¢å‘å¸ƒç»ç† Lei Tangï¼ˆè°·æ­Œï¼‰å’Œ Greg Hansonï¼ˆSolo.ioï¼‰ï¼Œä»¥åŠæµ‹è¯•å’Œå‘å¸ƒå·¥ä½œç»„è´Ÿè´£äºº Eric Van Normanï¼ˆIBMï¼‰çš„æŒç»­å¸®åŠ©å’ŒæŒ‡å¯¼ã€‚&lt;/p&gt;
&lt;p&gt;Istio 1.14.0 æ­£å¼æ”¯æŒ Kubernetes 1.21 è‡³ 1.24 ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯è¯¥ç‰ˆæœ¬çš„ä¸€äº›äº®ç‚¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯¹-spire-è¿è¡Œæ—¶çš„æ”¯æŒ&#34;&gt;å¯¹ SPIRE è¿è¡Œæ—¶çš„æ”¯æŒ&lt;/h3&gt;
&lt;p&gt;SPIRE æ˜¯ SPIFFE è§„èŒƒçš„ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„å®ç°ï¼Œå®ƒæä¾›å¯æ’æ‹”çš„å¤šå› å­éªŒè¯å’Œ SPIFFE è”é‚¦ã€‚æˆ‘ä»¬ä½¿ç”¨ Envoy SDS API å¯¹ä¸å¤–éƒ¨è¯ä¹¦é¢å‘æœºæ„çš„é›†æˆæ–¹å¼è¿›è¡Œäº†ä¿®æ”¹ï¼Œä»¥å®ç°å¯¹ SPIRE çš„æ”¯æŒã€‚æ„Ÿè°¢æƒ æ™®ä¼ä¸šçš„å›¢é˜Ÿå¯¹è¿™é¡¹å·¥ä½œçš„è´¡çŒ®ï¼SPIRE é€šè¿‡ä½¿ç”¨ä¸åŒçš„è®¤è¯æœºåˆ¶çš„ç»„åˆï¼Œå®ç°äº†å¼ºè®¤è¯èº«ä»½çš„å¼•å…¥ã€‚å®ƒä¸ºåœ¨ Kubernetesã€AWSã€GCPã€Azureã€Docker ä¸­è¿è¡Œçš„å·¥ä½œè´Ÿè½½æä¾›äº†å„ç§èŠ‚ç‚¹å’Œå·¥ä½œè´Ÿè½½è¯æ˜ï¼Œå¹¶é€šè¿‡é¢å‘æ’ä»¶çš„æ¶æ„ï¼Œå®ƒè¿˜å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰è¯æ˜ã€‚è¯¥é¡¹ç›®ä¸å®šåˆ¶çš„å¯†é’¥ç®¡ç†ç³»ç»Ÿæœ‰ä¸€ä¸ªå¯æ’æ‹”çš„é›†æˆï¼Œç”¨äºå­˜å‚¨ CA ç§é’¥ï¼Œå¹¶é€šè¿‡ä¸Šæ¸¸è¯ä¹¦æœºæ„æ’ä»¶å®ç°ä¸ç°æœ‰ PKI çš„é›†æˆã€‚SPIRE å®ç°äº† SPIFFE è”é‚¦ï¼Œä½¿å·¥ä½œè´Ÿè½½èƒ½å¤Ÿé€šè¿‡ Federation API ä»¥å¯é…ç½®å’Œçµæ´»çš„æ–¹å¼ä¿¡ä»»ä¸åŒä¿¡ä»»åŸŸä¸­çš„å¯¹ç­‰ä½“ã€‚&lt;/p&gt;
&lt;p&gt;æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æƒ æ™®ä¼ä¸šå’Œ Solo.io å›¢é˜Ÿçš„ &lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡æ¡£&lt;/a&gt; å’Œè¿™ä¸ª &lt;a href=&#34;https://www.youtube.com/watch?v=WOPoNqfrhb4&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è§†é¢‘&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ·»åŠ è‡ªåŠ¨-sni-æ”¯æŒ&#34;&gt;æ·»åŠ è‡ªåŠ¨ SNI æ”¯æŒ&lt;/h3&gt;
&lt;p&gt;ä¸€äº›æœåŠ¡å™¨è¦æ±‚åœ¨è¯·æ±‚ä¸­åŒ…å« SNIã€‚è¿™é¡¹æ–°åŠŸèƒ½å¯ä»¥è‡ªåŠ¨é…ç½® SNIï¼Œè€Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨é…ç½®æˆ–ä½¿ç”¨ EnvoyFilter èµ„æºã€‚æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ &lt;a href=&#34;https://github.com/istio/istio/pull/38604&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PR 38604&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/istio/istio/pull/38238&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PR 38238&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¢åŠ å¯¹é…ç½®-istio-å·¥ä½œè´Ÿè½½çš„-tls-ç‰ˆæœ¬çš„æ”¯æŒ&#34;&gt;å¢åŠ å¯¹é…ç½® Istio å·¥ä½œè´Ÿè½½çš„ TLS ç‰ˆæœ¬çš„æ”¯æŒ&lt;/h3&gt;
&lt;p&gt;TLS ç‰ˆæœ¬å¯¹å®‰å…¨å¾ˆé‡è¦ã€‚è¿™é¡¹æ–°åŠŸèƒ½å¢åŠ äº†å¯¹é…ç½® Istio å·¥ä½œè´Ÿè½½çš„æœ€å° TLS ç‰ˆæœ¬çš„æ”¯æŒã€‚æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ &lt;a href=&#34;https://istio.io/latest/docs/tasks/security/tls-configuration/workload-min-tls-version/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é¥æµ‹æ”¹è¿›&#34;&gt;é¥æµ‹æ”¹è¿›&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å¯¹ &lt;a href=&#34;https://istio.io/latest/docs/tasks/observability/telemetry/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Telemetry API&lt;/a&gt; è¿›è¡Œäº†ä¸€ç³»åˆ—æ”¹è¿›ï¼ŒåŒ…æ‹¬æ”¯æŒ OpenTelemetry è®¿é—®è®°å½•ã€åŸºäº &lt;code&gt;WorkloadMode&lt;/code&gt; çš„è¿‡æ»¤ç­‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å‡çº§åˆ°-114&#34;&gt;å‡çº§åˆ° 1.14&lt;/h3&gt;
&lt;p&gt;å½“ä½ å‡çº§æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å¬åˆ°ä½ çš„å£°éŸ³ï¼è¯·èŠ±å‡ åˆ†é’Ÿæ—¶é—´å¡«å†™è¿™ä¸ªç®€çŸ­çš„ &lt;a href=&#34;https://forms.gle/yEtCbt45FZ3VoDT5A&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è°ƒæŸ¥&lt;/a&gt;ï¼Œè®©æˆ‘ä»¬äº†è§£æˆ‘ä»¬åšçš„æ€ä¹ˆæ ·ã€‚&lt;/p&gt;
&lt;p&gt;ä½ ä¹Ÿå¯ä»¥åœ¨ &lt;a href=&#34;https://discuss.istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Discuss Istio&lt;/a&gt; åŠ å…¥å¯¹è¯ï¼Œæˆ–è€…åŠ å…¥æˆ‘ä»¬çš„ Slackã€‚ä½ æƒ³ç›´æ¥ä¸º Istio åšå‡ºè´¡çŒ®å—ï¼Ÿæ‰¾åˆ°å¹¶åŠ å…¥æˆ‘ä»¬çš„å·¥ä½œç»„ï¼Œå¸®åŠ©æˆ‘ä»¬æ”¹è¿›ã€‚&lt;/p&gt;
&lt;h3 id=&#34;istiocon-æ€»ç»“&#34;&gt;IstioCon æ€»ç»“&lt;/h3&gt;
&lt;p&gt;IstioCon ä»Šå¹´æ˜¯ç¬¬äºŒå±Šä¼šè®®ï¼Œäº 4 æœˆ 25-29 æ—¥ä¸¾è¡Œã€‚æˆ‘ä»¬æœ‰è¿‘ 4000 åæ³¨å†Œå‚ä¸è€…ï¼Œæ»¡æ„åº¦ä¸º 4.5/5ã€‚ä¼šè®®ä»¥è‹±æ–‡å’Œä¸­æ–‡ä¸¾è¡Œï¼Œæœ‰æ¥è‡ªä¸–ç•Œå„åœ° 120 ä¸ªå›½å®¶çš„äººåŠ å…¥ã€‚åœ¨ 2022 å¹´ 4 æœˆï¼Œå³ä¼šè®®å¬å¼€çš„å½“æœˆï¼Œistio.io ä¸Š 81% çš„ç”¨æˆ·æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®ã€‚æˆ‘ä»¬å°†åœ¨ &lt;a href=&#34;https://events.istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;events.istio.io&lt;/a&gt; ä¸Šåˆ†äº«æ›´è¯¦ç»†çš„æ´»åŠ¨æŠ¥å‘Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;cncf-æ–°é—»&#34;&gt;CNCF æ–°é—»&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å¾ˆé«˜å…´çœ‹åˆ°æˆ‘ä»¬å®£å¸ƒå°† &lt;a href=&#34;https://istio.io/latest/blog/2022/istio-has-applied-to-join-the-cncf/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æçŒ®ç»™ CNCF&lt;/a&gt; åçš„ååº”ã€‚æˆ‘ä»¬æ­£åœ¨åŠªåŠ›å¼€å‘åº”ç”¨ç¨‹åºï¼Œå¸Œæœ›åœ¨æœªæ¥å‡ ä¸ªæœˆå†…æœ‰æ›´å¤šçš„å†…å®¹å¯ä»¥åˆ†äº«ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä¸€ç§çµæ´»æ³¨å…¥ Istio Sidecar çš„æ–¹æ¡ˆæ¢ç´¢</title>
      <link>https://cloudnativecn.com/blog/istio-sidecar-injection-method/</link>
      <pubDate>Sun, 29 May 2022 12:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-sidecar-injection-method/</guid>
      <description>&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å›¢é˜Ÿå¯¹ Istio è¿›è¡Œç›¸å…³ç ”ç©¶ä¸æ¢ç´¢ï¼Œå¹¶åœ¨ç”Ÿäº§ç¯å¢ƒè¿›è¡Œäº†ç›¸åº”çš„åº”ç”¨ï¼ŒåˆæœŸæˆ‘ä»¬ä½¿ç”¨ Istio ä¸»è¦åšäº§å“çš„ç°åº¦å‘å¸ƒï¼ŒåŒæ—¶æˆ‘ä»¬å›¢é˜Ÿä¹Ÿæœ‰ç›¸å…³ç ”å‘äººå‘˜åŸºäº Istioï¼Œè¿›è¡Œç”Ÿäº§ç¯å¢ƒä¸šåŠ¡æµé‡ç®¡ç†åŠå¯è§‚æµ‹æ€§è¿½è¸ªçš„ç ”ç©¶ã€‚åœ¨åš Istio ç°åº¦å‘å¸ƒçš„å®è·µä¸­ï¼Œé‡åˆ°çš„ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ€ä¹ˆåœ¨å·²ç»å¤§è§„æ¨¡éƒ¨ç½²äº§å“çš„ Kubernetes é›†ç¾¤é‡Œï¼Œé€‰æ‹©æ€§çš„æ³¨å…¥ Sidecarã€‚ä¸‹é¢è¯¦ç»†çš„ä»‹ç»ä¸‹æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜ä»¥åŠè§£å†³æ€è·¯ï¼Œä¾›å¤§å®¶å‚è€ƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;é‡åˆ°çš„é—®é¢˜&#34;&gt;é‡åˆ°çš„é—®é¢˜&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“å¦‚æœæƒ³æŠŠä¸€ä¸ªæœåŠ¡çº³å…¥ Istio çš„ç½‘æ ¼ä¸­ï¼Œéœ€è¦åœ¨ pod ä¸­æ³¨å…¥ Sidecar è¿›è¡Œæµé‡çš„åŠ«æŒå¤„ç†ï¼Œé€šç”¨çš„åšæ³•å°±æ˜¯åœ¨ namespace ä¸Šæ‰“ä¸Š istio-injection=enabled æ ‡ç­¾ï¼Œè¿™æ ·åªè¦åœ¨æ­¤ namespace ä¸‹åˆ›å»ºæˆ–é‡å¯ pod éƒ½ä¼šå¯¼è‡´ pod è¢«æ³¨å…¥ Sidecarï¼Œå½“ç„¶ä¸ºäº†ä¸è®©æŒ‡å®š pod æ³¨å…¥ Sidecarï¼Œå¯ä»¥åœ¨ pod çš„ annotations é‡ŒåŠ ä¸Š &lt;code&gt;sidecar.istio.io/inject: &amp;quot;false&amp;quot;&lt;/code&gt;ã€‚çº¿ä¸Šäº§å“æ˜¯ä»¥ namespace è¿›è¡Œéš”ç¦»çš„ï¼Œå¹¶ä¸”äº§å“ namespace ä¸‹æ­£å¸¸è¿è¡Œçš„ pod æ•°è¾ƒå¤šï¼Œè¿™æ ·å¼•å…¥ Istio åä¸€ä¸ªä¸ªä¿®æ”¹ä¸éœ€è¦æ³¨å…¥ Sidecar çš„ pod é…ç½®å¹¶é‡å¯ï¼Œè‚¯å®šä¸æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ¡ˆã€‚é‚£ä¹ˆæœ‰ä»€ä¹ˆæ¯”è¾ƒå¥½çš„ç­–ç•¥å‘¢ï¼Ÿ&lt;/p&gt;
&lt;h2 id=&#34;æ–¹æ¡ˆè°ƒç ”&#34;&gt;æ–¹æ¡ˆè°ƒç ”&lt;/h2&gt;
&lt;p&gt;Kubernetes æä¾›äº†è‡ªå®šä¹‰èµ„æºç±»å‹å’Œè‡ªå®šä¹‰æ§åˆ¶å™¨æ¥æ‰©å±•åŠŸèƒ½ï¼Œè¿˜æä¾›äº†åŠ¨æ€å‡†å…¥æ§åˆ¶ Webhookï¼Œå…¶å®æˆ‘ç†è§£è¿™ä¸ªåŠ¨æ€å‡†å…¥æ§åˆ¶å°±æ˜¯ä¸€ä¸ªå›è°ƒï¼Œåœ¨ Istio çš„é…ç½®é‡Œå¯ä»¥çœ‹åˆ°å›è°ƒçš„ url è·¯å¾„ /injectï¼ŒKubernetes é€šè¿‡ Webhook æ¥å®ç°å‡†å…¥æ§åˆ¶ï¼Œåˆ†ä¸ºä¸¤ç§ï¼šéªŒè¯æ€§è´¨çš„å‡†å…¥ Webhook (Validating Admission Webhook) å’Œä¿®æ”¹æ€§è´¨çš„å‡†å…¥ Webhook (Mutating Admission Webhook)ï¼ŒIstio ä¸»è¦ä½¿ç”¨çš„æ˜¯ Mutating Admission Webhookï¼Œåœ¨èµ„æºæŒä¹…åŒ–åˆ° ETCD ä¹‹å‰è¿›è¡Œèµ„æºçš„ä¿®æ”¹ï¼Œå¢åŠ  Init Container å’Œ Sidecar Containerã€‚ä½†æ˜¯ Istio åœ¨è¿›è¡Œèµ„æºä¿®æ”¹å‰ï¼Œéœ€è¦æ»¡è¶³ä¸€äº›æ¡ä»¶ï¼Œè¿™äº›æ¡ä»¶å¯ä»¥é€šè¿‡é…ç½®è¿›è¡Œä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-æ³¨å…¥æµç¨‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio æ³¨å…¥æµç¨‹&#34; srcset=&#34;
               /blog/istio-sidecar-injection-method/inject_hu_ab0611015df77546.webp 400w,
               /blog/istio-sidecar-injection-method/inject_hu_f162db5a7faa48c6.webp 760w,
               /blog/istio-sidecar-injection-method/inject_hu_f8e5d65c20892d44.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-sidecar-injection-method/inject_hu_ab0611015df77546.webp&#34;
               width=&#34;760&#34;
               height=&#34;160&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio æ³¨å…¥æµç¨‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹ Istio çš„ &lt;code&gt;mutatingwebhookconfiguration&lt;/code&gt; é…ç½®&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-mutatingwebhookconfiguration-é…ç½®ä¿¡æ¯&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;mutatingwebhookconfiguration é…ç½®ä¿¡æ¯&#34; srcset=&#34;
               /blog/istio-sidecar-injection-method/webhook_hu_6ac0d15e5fdaca57.webp 400w,
               /blog/istio-sidecar-injection-method/webhook_hu_b8487c9777708d1e.webp 760w,
               /blog/istio-sidecar-injection-method/webhook_hu_2cd1a651f229a1e1.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-sidecar-injection-method/webhook_hu_6ac0d15e5fdaca57.webp&#34;
               width=&#34;378&#34;
               height=&#34;347&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      mutatingwebhookconfiguration é…ç½®ä¿¡æ¯
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é€šè¿‡é…ç½®æˆ‘ä»¬çœ‹åˆ°ï¼Œ&lt;code&gt;namespaceSelector&lt;/code&gt; ä¼šå» match æ ‡ç­¾ä¸º &lt;code&gt;istio-injection: enabled&lt;/code&gt; çš„ namespaceï¼Œå¹¶ä¸”æ ¹æ®è¯·æ±‚è§„åˆ™ï¼Œå»åŒ¹é…æ‰€æœ‰ pod çš„åˆ›å»º CREATE è¯·æ±‚ã€‚å½“ apiserver æ”¶åˆ°ä¸€ä¸ªç¬¦åˆè§„åˆ™çš„è¯·æ±‚æ—¶ï¼Œapiserver ä¼šç»™ Webhook æœåŠ¡å‘é€ä¸€ä¸ªé€šè¿‡å®¡æ ¸çš„è¯·æ±‚ï¼ŒIstio ä¸­çš„è¿™ä¸ª Webhook æœåŠ¡æ˜¯ Istiod çš„ serviceï¼Œè¯·æ±‚åœ°å€ä¸º /injectã€‚ä»ä»£ç  &lt;a href=&#34;https://github.com/istio/istio/blob/release-1.8/pkg/kube/inject/webhook.go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/pkg/kube/inject/webhook.go&lt;/a&gt;ï¼Œä¸­æˆ‘ä»¬æŸ¥çœ‹ Istio æ˜¯å¦‚ä½•å¤„ç†è‡ªåŠ¨æ³¨å…¥çš„ï¼Œåœ¨ Discovery Server ä¸­æ³¨å†Œäº†ä¸¤ä¸ªç”¨æ¥å¤„ç†è‡ªåŠ¨æ³¨å…¥çš„è¯·æ±‚ handlerï¼Œ&lt;code&gt;p.Mux.HandleFunc (&amp;quot;/inject&amp;quot;, wh.serveInject)&lt;/code&gt;ã€&lt;code&gt;p.Mux.HandleFunc (&amp;quot;/inject/&amp;quot;, wh.serveInject)&lt;/code&gt;ï¼Œ&lt;code&gt;wh.serveInject&lt;/code&gt; å°±æ˜¯å®ç°è‡ªåŠ¨æ³¨å…¥çš„ä¸»è¦é€»è¾‘ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä¸è¯¦ç»†è®²è§£è‡ªåŠ¨æ³¨å…¥çš„ä»£ç é€»è¾‘ã€‚åªè®²è§£ä¸‹ï¼Œåœ¨æ»¡è¶³ä»€ä¹ˆæ ·çš„æ¡ä»¶æ‰ä¼šè¿›è¡Œè‡ªåŠ¨æ³¨å…¥ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡æŸ¥çœ‹è‡ªåŠ¨æ³¨å…¥çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹æ³¨å…¥æ¡ä»¶çš„æµç¨‹å›¾ 1&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-è‡ªåŠ¨æ³¨å…¥æµç¨‹å›¾-1&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;è‡ªåŠ¨æ³¨å…¥æµç¨‹å›¾ 1&#34; srcset=&#34;
               /blog/istio-sidecar-injection-method/image1_hu_d20ae3ee7f79c2d7.webp 400w,
               /blog/istio-sidecar-injection-method/image1_hu_67fd5b8a5460c54a.webp 760w,
               /blog/istio-sidecar-injection-method/image1_hu_a3839fea89da887.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-sidecar-injection-method/image1_hu_d20ae3ee7f79c2d7.webp&#34;
               width=&#34;760&#34;
               height=&#34;377&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      è‡ªåŠ¨æ³¨å…¥æµç¨‹å›¾ 1
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ¤æ–­ pod çš„ spec ä¸­æ²¡æœ‰è®¾ç½® &lt;code&gt;hostNetwork:true&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ¤æ–­å¾…æ³¨å…¥çš„ pod ä¸åœ¨ç³»ç»Ÿ namespace é‡Œï¼Œå¦‚ &lt;code&gt;kube-system&lt;/code&gt;ã€kube-public&lt;/li&gt;
&lt;li&gt;è®¾ç½®ä¸‰ä¸ªä¸´æ—¶å˜é‡ï¼Œ&lt;code&gt;useDefault=false&lt;/code&gt;ã€&lt;code&gt;inject=false&lt;/code&gt;ã€required=falseï¼Œåˆ¤æ–­æ˜¯å¦é…ç½® &lt;code&gt;sidecar.istio.io/inject&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœ &lt;code&gt;sidecar.istio.io/inject&lt;/code&gt; çš„å€¼è®¾ç½®ä¸º y, yes, true, onï¼Œåˆ™ inject=true&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sidecar.istio.io/inject&lt;/code&gt; ä¸ºå…¶ä»–å€¼ï¼Œåˆ™ &lt;code&gt;useDefault=true&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ¤æ–­ &lt;code&gt;neverInjectSelector&lt;/code&gt; æ˜¯å¦æœ‰åŒ¹é…åˆ°çš„æ¡ä»¶ï¼Œå¦‚æœåŒ¹é…åˆ°åˆ™è®¾ç½® useDefault = falseã€inject = false&lt;/li&gt;
&lt;li&gt;åˆ¤æ–­ &lt;code&gt;alwaysInjectSelector&lt;/code&gt; æ˜¯å¦æœ‰åŒ¹é…åˆ°çš„æ¡ä»¶ï¼Œå¦‚æœåŒ¹é…åˆ°åˆ™è®¾ç½® useDefault = falseã€inject = trueï¼Œ&lt;code&gt;alwaysInjectSelector&lt;/code&gt; ä¼˜å…ˆçº§é«˜äº neverInjectSelector&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç»è¿‡ä¸Šè¿°åˆ¤æ–­ï¼Œæˆ‘ä»¬å¾—åˆ°äº† &lt;code&gt;useDefault&lt;/code&gt; ã€inject çš„ç»“æœå€¼ï¼Œåé¢æˆ‘ä»¬æ ¹æ® policy çš„å–å€¼ä»¥åŠä¸Šè¿°ç»“æœå€¼ï¼Œåˆ¤æ–­ pod æ˜¯å¦èƒ½å¤Ÿæ³¨å…¥ Sidecarï¼Œç»§ç»­æŸ¥çœ‹è‡ªåŠ¨æ³¨å…¥çš„æµç¨‹å›¾ 2&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-è‡ªåŠ¨æ³¨å…¥æµç¨‹å›¾-2&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;è‡ªåŠ¨æ³¨å…¥æµç¨‹å›¾ 2&#34; srcset=&#34;
               /blog/istio-sidecar-injection-method/image2_hu_c91730b757c61ac1.webp 400w,
               /blog/istio-sidecar-injection-method/image2_hu_981abb4dd31e8cc4.webp 760w,
               /blog/istio-sidecar-injection-method/image2_hu_e443abc635603c86.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-sidecar-injection-method/image2_hu_c91730b757c61ac1.webp&#34;
               width=&#34;760&#34;
               height=&#34;251&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      è‡ªåŠ¨æ³¨å…¥æµç¨‹å›¾ 2
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ¤æ–­ policy çš„å–å€¼&lt;/li&gt;
&lt;li&gt;å¦‚æœ policy å–å€¼ä¸º disabledï¼Œå¹¶ä¸”ä¸Šè¿°å¾—åˆ°çš„ useDefault=trueï¼Œåˆ™ required=falseï¼Œä¸è¿›è¡Œæ³¨å…¥&lt;/li&gt;
&lt;li&gt;å¦‚æœ policy å–å€¼ä¸º disabledï¼Œå¹¶ä¸”ä¸Šè¿°å¾—åˆ°çš„ useDefault=falseï¼Œåˆ™éœ€è¦æ ¹æ® inject çš„å€¼åˆ¤æ–­æ˜¯å¦éœ€è¦æ³¨å…¥&lt;/li&gt;
&lt;li&gt;å¦‚æœ policy å–å€¼ä¸º enabledï¼Œå¹¶ä¸”ä¸Šè¿°å¾—åˆ°çš„ useDefault=falseï¼Œåˆ™éœ€è¦æ ¹æ® inject çš„å€¼åˆ¤æ–­æ˜¯å¦éœ€è¦æ³¨å…¥&lt;/li&gt;
&lt;li&gt;å¦‚æœ policy å–å€¼ä¸º enabledï¼Œå¹¶ä¸”ä¸Šè¿°å¾—åˆ°çš„ useDefault=trueï¼Œåˆ™ required=trueï¼Œè¿›è¡Œæ³¨å…¥&lt;/li&gt;
&lt;li&gt;policy ä¸ºå…¶ä»–å€¼ï¼Œä¸è¿›è¡Œæ³¨å…¥&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„è‡ªåŠ¨æ³¨å…¥æµç¨‹å›¾ 1ã€è‡ªåŠ¨æ³¨å…¥æµç¨‹å›¾ 2 ä¸­ï¼Œæœ‰å‡ ä¸ªé…ç½® &lt;code&gt;neverInjectSelector&lt;/code&gt;ã€&lt;code&gt;alwaysInjectSelector&lt;/code&gt;ã€policyï¼Œè¿™å‡ ä¸ªå€¼å¯ä»¥æ ¹æ®éœ€æ±‚åœ¨ &lt;code&gt;istio-sidecar-injector&lt;/code&gt; configmap è¿›è¡Œä¿®æ”¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç”Ÿäº§åº”ç”¨&#34;&gt;ç”Ÿäº§åº”ç”¨&lt;/h2&gt;
&lt;p&gt;é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œå¯ä»¥çœ‹åˆ°ä¸ºäº†æœ€åæ»¡è¶³æ³¨å…¥æ¡ä»¶ï¼Œéœ€è¦å¤šç§åˆ¤æ–­æ¡ä»¶ã€‚ç»“åˆæˆ‘ä»¬åœ¨ç”Ÿäº§ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œå°½é‡å°‘ä¿®æ”¹é…ç½®ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ç»™äº§å“çš„ namespace æ‰“ä¸Š &lt;code&gt;istio-injection=enabled&lt;/code&gt;ï¼Œå¹¶ä¸”é€šè¿‡ &lt;code&gt;kubectl -n istio-system edit configmap istio-sidecar-injector&lt;/code&gt; ä¿®æ”¹ policy çš„å€¼ä¸º disableã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-configmap-é…ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Configmap é…ç½®&#34; srcset=&#34;
               /blog/istio-sidecar-injection-method/Configmap_hu_d2ace2d10c9b4118.webp 400w,
               /blog/istio-sidecar-injection-method/Configmap_hu_c275bdd151fcc2b6.webp 760w,
               /blog/istio-sidecar-injection-method/Configmap_hu_5efa11ea05ad5a3a.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-sidecar-injection-method/Configmap_hu_d2ace2d10c9b4118.webp&#34;
               width=&#34;760&#34;
               height=&#34;244&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Configmap é…ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å› ä¸ºå¼•å…¥ Istio ä¹‹å‰å¯åŠ¨çš„ pod ä¸­æ²¡æœ‰ &lt;code&gt;sidecar.istio.io/inject&lt;/code&gt; çš„å€¼ï¼Œæ‰€ä»¥åœ¨ä¸Šé¢çš„æµç¨‹å›¾é‡Œä¼šèµ°çº¢è‰²çº¿æ ‡å¿—çš„è·¯å¾„ï¼Œæœ€åå¾—åˆ° required=falseï¼Œä¸ä¼šæ³¨å…¥ Sidecarã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå¸Œæœ›æ³¨å…¥ Sidecarï¼Œåˆ™éœ€è¦åœ¨ pod é‡Œæ·»åŠ  &lt;code&gt;sidecar.istio.io/inject=true&lt;/code&gt; æ³¨è§£ï¼Œè¿™æ ·æ·»åŠ å®Œæ³¨è§£çš„ pod ä¼šèµ°è“è‰²çº¿æ ‡å¿—çš„è·¯å¾„ï¼Œæœ€å required=injectï¼Œè€Œ inject çš„å€¼ä¸º trueï¼Œæ»¡è¶³æ³¨å…¥æ¡ä»¶è¿›è¡Œ Sidecar çš„æ³¨å…¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ¼”ç¤ºä¸€ä¸‹ç»è¿‡ä¸Šè¿°ä¿®æ”¹åçš„å®é™…åº”ç”¨æ•ˆæœï¼Œæˆ‘ä»¬ç»™ namespace æ‰“ä¸Šæ ‡ç­¾ï¼Œå¹¶ä¸”é…ç½®åº”ç”¨çš„ Deploymentï¼Œæˆ‘ä»¬ç»™ foo-v1 æ·»åŠ  sidecar.istio.io/inject: &amp;ldquo;true&amp;rdquo; çš„æ³¨è§£ï¼Œä½œä¸ºå¯¹æ¯” foo-v2 ä¸åšä»»ä½•æ“ä½œï¼Œå¦‚ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sidecar.istio.io/inject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo-v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œä¸Šé¢çš„é…ç½®åï¼ŒæŸ¥è¯¢ç›¸åº”çš„ pod å¦‚ä¸‹å›¾&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-çº¿ä¸Šé…ç½®ä¿®æ”¹åæµ‹è¯•&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;çº¿ä¸Šé…ç½®ä¿®æ”¹åæµ‹è¯•&#34; srcset=&#34;
               /blog/istio-sidecar-injection-method/test_hu_3c2a5826b0dd02b7.webp 400w,
               /blog/istio-sidecar-injection-method/test_hu_803e159b1e825cc3.webp 760w,
               /blog/istio-sidecar-injection-method/test_hu_b67ce4b9bb8f9d7e.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-sidecar-injection-method/test_hu_3c2a5826b0dd02b7.webp&#34;
               width=&#34;701&#34;
               height=&#34;140&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      çº¿ä¸Šé…ç½®ä¿®æ”¹åæµ‹è¯•
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­çœ‹åˆ°ï¼Œé€šè¿‡æ­£ç¡®çš„é…ç½® Istio çš„ Configmapï¼Œå³ä½¿äº§å“æ‰€åœ¨çš„ namespace æ‰“ä¸Šäº† &lt;code&gt;istio-injection=enabled&lt;/code&gt; æ ‡ç­¾ï¼Œå¼•å…¥ Istio ä¹‹å‰å¯åŠ¨çš„ pod ä¹Ÿä¸ä¼šå› ä¸ºé‡å¯è¢«æ³¨å…¥ Sidecarï¼ŒåŒæ—¶åˆå¯ä»¥é€‰æ‹©æ€§çš„å¯¹æ–°æœåŠ¡è¿›è¡Œ Sidecar çš„æ³¨å…¥ï¼Œé…ç½®çš„æ”¹åŠ¨é‡å°ï¼Œåº”ç”¨èµ·æ¥ç®€å•æ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;é€šè¿‡å¯¹ Istio è‡ªåŠ¨æ³¨å…¥çš„æ¡ä»¶è¿›è¡Œæ¢ç´¢å’Œç ”ç©¶ï¼Œæˆ‘ä»¬æ€»ç»“äº†ä¸€å¥—æ»¡è¶³å…±äº« Kubernetes å¼•å…¥ Istio è¿›è¡ŒæœåŠ¡æ²»ç†çš„æ–¹æ³•ï¼Œæ ¹æ®æ­¤æ–¹æ³•è¿›è¡Œç”Ÿäº§å®æ–½ï¼Œä¸ä¼šå¯¹å·²æœ‰æœåŠ¡é€ æˆå½±å“ï¼Œå¯¹æ–°æœåŠ¡å¯ä»¥é€‰æ‹©æ€§çš„è‡ªåŠ¨æ³¨å…¥ã€‚ä»¥ä¸Šçš„è°ƒç ”åŸºäº Istio 1.8 ç‰ˆæœ¬ï¼Œå†…å®¹å¯èƒ½å­˜åœ¨é”™è¯¯æˆ–ä¸å‡†ç¡®çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§å®¶äº¤æµæŒ‡æ­£ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åœ¨ Istio ä¸­å¼•å…¥ Wasm æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</title>
      <link>https://cloudnativecn.com/blog/importance-of-wasm-in-istio/</link>
      <pubDate>Wed, 16 Feb 2022 09:24:17 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/importance-of-wasm-in-istio/</guid>
      <description>&lt;p&gt;WasmPlugin API æœ€è¿‘è¢«æ·»åŠ åˆ° Istio é¡¹ç›®ä¸­ï¼Œä½œä¸ºä¸€ç§æ–°æ”¹è¿›çš„å¯æ‰©å±•æ€§æœºåˆ¶ã€‚åœ¨ Tetrateï¼Œæˆ‘ä»¬æœ€è¿‘æˆåŠŸä¸¾åŠäº†ä¸€ä¸ªåä¸º Istio Wasm workshop çš„ç ”è®¨ä¼šã€‚&lt;a href=&#34;https://tetrate-io.zoom.us/webinar/register/WN_OJG0hpo-RXSEJcH_SutlPQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»è¿™é‡Œ&lt;/a&gt;è§‚çœ‹ç ”è®¨ä¼šçš„å½•éŸ³ï¼Œå¹¶åŠ å…¥ &lt;a href=&#34;https://tetr8.io/tetrate-edu-slack&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slack ä¸Šçš„å¯¹è¯&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è°ˆè®ºäº† WebAssembly åŠå…¶åœ¨ Istio å’Œ Envoy é¡¹ç›®ä¸­çš„é‡è¦æ€§ï¼Œå¹¶é€šè¿‡ä½¿ç”¨ &lt;a href=&#34;https://github.com/tetratelabs/proxy-wasm-go-sdk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Proxy-Wasm Go SDK&lt;/a&gt; å’Œ &lt;a href=&#34;https://func-e.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;func-e&lt;/a&gt; è¿›è¡Œäº†å¤šä¸ªæ¼”ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨ Tetrate å…³æ³¨ Istio çš„å¯æ‰©å±•æ€§å·²ç»æœ‰å¾ˆé•¿ä¸€æ®µæ—¶é—´äº†ã€‚Tetrate çš„å·¥ç¨‹å¸ˆ Takeshi Yoneda å’Œå‘¨ç¤¼èµåœ¨ä¸ºæ­¤åšå‡ºäº†å·¨å¤§çš„è´¡çŒ®ï¼Œæˆ‘ä»¬éå¸¸é«˜å…´åœ°çœ‹åˆ° Istio çš„å¯æ‰©å±•æ€§å› æ­¤è€Œå¾—åˆ°äº†æå¤§çš„æ”¹å–„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘æè¿°äº†åœ¨å¼•å…¥ WasmPlugin API ä¹‹å‰ Istio å’Œ Envoy å¯æ‰©å±•æ€§çš„çŠ¶å†µï¼›ç›®å‰å¤§ä¸ºæ”¹å–„çš„æƒ…å†µï¼›ä»¥åŠå°†æˆ–å¤šæˆ–å°‘å®Œæˆè¿™æ¡å¯æ‰©å±•æ€§æ”¹è¿›å¼§çº¿çš„å˜åŒ–ï¼Œæˆ‘ä»¬é¢„è®¡è¿™äº›å˜åŒ–å°†åœ¨å³å°†åˆ°æ¥çš„ç‰ˆæœ¬ä¸­å‡ºç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-å’Œ-wasm-çš„å†å²&#34;&gt;Istio å’Œ Wasm çš„å†å²&lt;/h2&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Istio 1.4 ä¹‹å‰&lt;/th&gt;
          &lt;th&gt;Istio 1.5&lt;/th&gt;
          &lt;th&gt;Istio 1.12 å’Œæœªæ¥&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;ç”¨ C++ æ‰©å±•ç»´æŠ¤è‡ªå·±çš„ Envoy ä»£ç†æ„å»º&lt;/td&gt;
          &lt;td&gt;ä½¿ç”¨ EnvoyFilter èµ„æºå¼•å…¥æ–°çš„ Wasm å¯æ‰©å±•æ€§æ¨¡å‹ï¼ˆä»ç„¶å¤æ‚ï¼‰&lt;/td&gt;
          &lt;td&gt;å¼•å…¥ä¸“ç”¨çš„ WasmPlugin API&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ä½¿ç”¨ Mixerï¼ˆæ•ˆç‡ä½ï¼‰&lt;/td&gt;
          &lt;td&gt;ä»…æ”¯æŒæœ¬åœ°æˆ– HTTP ä½ç½®&lt;/td&gt;
          &lt;td&gt;åŒ…æ‹¬å¯¹ OCI æ³¨å†Œè¡¨çš„æ”¯æŒ&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;åœ¨ Istio 1.4ï¼ˆ2019 å¹´ 11 æœˆå‘å¸ƒï¼‰ä¹‹å‰ï¼Œæ²¡æœ‰è‰¯å¥½çš„æœºåˆ¶æ¥è¿è¡Œæ’ä»¶ã€‚å½“æ—¶ï¼ŒIstio ç»´æŠ¤äº†ä»–ä»¬è‡ªå·±çš„ Envoy ä»£ç†çš„åˆ†æ”¯ï¼Œä»¥è¿è¡Œè‡ªå®šä¹‰æ’ä»¶ï¼Œå¦‚ç”¨ C++ ç¼–å†™å¹¶ä¸ Envoy ä»£ç†ä¸€èµ·æ„å»ºçš„ RBAC å’Œ JWT è¿‡æ»¤å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ—¶ï¼ŒIstio ä½¿ç”¨ Mixer ç»„ä»¶ï¼Œåœ¨åº”ç”¨ç¨‹åºä»£ç å’ŒåŸºç¡€è®¾æ–½åç«¯ä¹‹é—´æä¾›ä¸€ä¸ªå±‚ã€‚ä½¿ç”¨ Mixerï¼Œäººä»¬èƒ½å¤Ÿæ‰§è¡Œæˆæƒç­–ç•¥ï¼Œæ”¶é›†é¥æµ‹æ•°æ®ï¼Œå¹¶ç®¡ç†é…é¢ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒEnvoy ä»£ç†åœ¨å‘åç«¯å‘å‡ºè¯·æ±‚ä¹‹å‰ä¼šè°ƒç”¨ Mixer ç»„ä»¶ï¼Œä»¥æ‰§è¡Œä»»ä½•å‰ææ¡ä»¶æ£€æŸ¥ â€”â€” ä¾‹å¦‚ï¼Œâ€œæœåŠ¡ A èƒ½å¦è°ƒç”¨æœåŠ¡ Bâ€ï¼Œå¹¶åœ¨æ¯ä¸ªè¯·æ±‚å®Œæˆåå†æ¬¡è°ƒç”¨ Mixer ä»¥æŠ¥å‘Šé¥æµ‹æ•°æ®ã€‚ä½¿ç”¨è¿™ç§æ¨¡å¼å¯¼è‡´äº†èµ„æºçš„ä½æ•ˆä½¿ç”¨ï¼Œä¹Ÿå¯¼è‡´äº†å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;Envoy çš„æ‰©å±•æ€§ä¾èµ–äºå¼€å‘è€…çŸ¥é“å¦‚ä½•ç”¨ C++ ç¼–å†™æ‰©å±•ã€‚æ­¤å¤–ï¼Œä»»ä½• C++ æ‰©å±•éƒ½å¿…é¡»ç”¨ Envoy ä»£ç†æ¥æ„å»ºã€‚è¿™å°±æ˜¯å½“æ—¶ Istio ç»´æŠ¤ä»–ä»¬è‡ªå·±çš„ Envoy ä»£ç†æ„å»ºçš„åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œäººä»¬å¿…é¡»ç”¨æ–°çš„äºŒè¿›åˆ¶æ–‡ä»¶æ›¿æ¢æ•´ä¸ªç°æœ‰çš„ Envoy ä»£ç†å®ä¾‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-å’Œ-wasm-çš„å†å²&#34;&gt;Envoy å’Œ Wasm çš„å†å²&lt;/h2&gt;
&lt;p&gt;Envoy å¸Œæœ›å°†ä¾èµ–ä¸€ä¸ªå•ä¸€çš„å¯æ‰©å±•æ€§å †æ ˆï¼Œä½¿ Envoy çš„å‘å¸ƒä¸æ‰©å±•ç”Ÿæ€ç³»ç»Ÿè„±é’©ï¼Œå¹¶ä½¿æ‰©å±•å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ C++ ä»¥å¤–çš„ä¸œè¥¿ã€‚åœ¨ Envoy ä¸­åŠ å…¥è¿™ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥è®© Istioï¼ˆä»¥åŠå…¶ä»– Envoy ä»£ç†ç”¨æˆ·ï¼‰éšæ—¶æ¨å‡ºæ–°çš„ç‰¹æ€§å’ŒåŠŸèƒ½ï¼Œè€Œä¸éœ€è¦å•ç‹¬ç»´æŠ¤ Envoy çš„æ„å»ºã€‚åœ¨ Envoy å’Œ Istio åŒæ–¹çš„å¼ºçƒˆæ¨åŠ¨ä¸‹ï¼Œåœ¨ Envoy ä¸­&lt;a href=&#34;https://github.com/envoyproxy/envoy/issues/4272&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ”¯æŒ&lt;/a&gt; WebAssembly çš„&lt;a href=&#34;https://github.com/envoyproxy/envoy/issues/4272&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å·¥ä½œ&lt;/a&gt;äº 2018 å¹´å¼€å§‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åœ¨-envoy-ä¸­å¼•å…¥-webasssembly&#34;&gt;åœ¨ Envoy ä¸­å¼•å…¥ WebAsssembly&lt;/h2&gt;
&lt;p&gt;åœ¨ Envoy å’Œ Istio ä¸­æ‰€åšçš„å…³äºå¯æ‰©å±•æ€§çš„è‰°è‹¦å·¥ä½œè¢«çº³å…¥äº† Istio 1.5 ç‰ˆæœ¬ï¼ˆ2020 å¹´ï¼‰ã€‚Istio 1.5 ç‰ˆæœ¬åŒ…æ‹¬ä¸€ä¸ªä½¿ç”¨ WebAssembly çš„å¯æ‰©å±•æ€§æ–°æ¨¡å‹ã€‚éšç€ WebAssembly çš„å¼•å…¥ï¼Œä¸å†éœ€è¦è¿è¡Œå•ç‹¬çš„ Mixer ç»„ä»¶ï¼Œè¿™ä¹Ÿå¯¼è‡´äº† Istio éƒ¨ç½²çš„ç®€åŒ– â€”â€” å°‘äº†ä¸€ä»¶éƒ¨ç½²çš„ä¸œè¥¿ï¼Œä¹Ÿå°‘äº†ä¸€ä»¶éœ€è¦æ‹…å¿ƒçš„ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥ç‰ˆæœ¬åŒ…æ‹¬é€šç”¨çš„åº”ç”¨äºŒè¿›åˆ¶æ¥å£ï¼ˆABIï¼‰å’Œ C++ã€Rust å’Œ AssemblyScript SDKã€‚ç°æœ‰çš„ Istio åŠŸèƒ½ï¼Œå¦‚ç»Ÿè®¡ã€å…ƒæ•°æ®äº¤æ¢å’Œå…¶ä»–åŠŸèƒ½ä¹Ÿè¢«å®ç°ä¸º WebAssembly æ‰©å±•ã€‚ä¸€ä¸ªåä¸º EnvoyFilter çš„èµ„æºè¢«å¼•å…¥ï¼Œä»¥å¤„ç†è¿™äº›æ‰©å±•çš„éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;EnvoyFilter èµ„æºæ˜¯å¯¹ Envoy é…ç½®çš„ä¸€ä¸ªéå¸¸ç®€å•çš„æŠ½è±¡ï¼Œå®ƒå…è®¸ Istio æ“ä½œè€…ä¿®æ”¹ Envoy ä»£ç†è¡Œä¸ºã€‚ç„¶è€Œï¼Œè¿™ç§è½»é‡çº§çš„æŠ½è±¡ä»ç„¶æ„å‘³ç€æ“ä½œè€…å¿…é¡»ç†Ÿæ‚‰ Envoy API çš„ç»†èŠ‚ä»¥åŠå¦‚ä½•æœ‰æ•ˆåœ°é…ç½®å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®© Envoy ä»£ç†åŠ è½½å’Œä½¿ç”¨æ‰©å±•ï¼Œä½ å¿…é¡»æŠŠ Wasm äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åœ¨ä¸ Envoy ä»£ç†å®¹å™¨ç›¸åŒçš„ pod å†…ã€‚è¿ç»´äººå‘˜å¯ä»¥é€‰æ‹©æŒ‡å‘ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶ï¼ˆå³é›†ç¾¤å†…çš„æ–‡ä»¶ï¼ŒEnvoy ä»£ç†å®¹å™¨å¯ä»¥è®¿é—®ï¼‰æˆ–æä¾›ä¸€ä¸ª HTTP ä½ç½®ï¼Œä»£ç†å¯ä»¥ä»é‚£é‡Œä¸‹è½½æ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio çš„åç»­ç‰ˆæœ¬ä¸­æœ‰å¤šé¡¹æ”¹è¿›ï¼Œç‰¹åˆ«æ˜¯ Istio ä»£ç†å¼€å§‹æ‹¦æˆª EnvoyFilter èµ„æºå¹¶ä»£è¡¨ Envoy ä»£ç†è·å–äºŒè¿›åˆ¶æ–‡ä»¶çš„å˜åŒ–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-112-å’Œ-wasmplugin-api&#34;&gt;Istio 1.12 å’Œ WasmPlugin API&lt;/h2&gt;
&lt;p&gt;æœ€è¿‘åœ¨ Istio 1.12 ä¸­å¼•å…¥äº†æœ€é‡è¦çš„çªç ´æ€§åŠŸèƒ½ã€‚ä¸º Wasm æ’ä»¶å¼•å…¥äº†ä¸€ä¸ªä¸“é—¨çš„ APIï¼Œç§°ä¸º WasmPlugin APIï¼Œå®ƒä½¿ç”¨ä¸€ç§æ–°çš„æ–¹æ³•ä»ç¬¦åˆ OCI çš„æ³¨å†Œè¡¨ä¸­è·å– Wasm äºŒè¿›åˆ¶æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;æ–° API çš„å¼•å…¥æ¶ˆé™¤äº†ä½¿ç”¨ EnvoyFilter æ¥éƒ¨ç½²æ‰©å±•çš„éœ€è¦ã€‚æ‰©å±•å¼€å‘è€…ç°åœ¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåä¸º WasmPlugin çš„èµ„æºæ¥æŒ‡å®šè¦éƒ¨ç½²æ’ä»¶çš„å·¥ä½œè´Ÿè½½ã€‚å¯¹ç¬¦åˆ OCI æ ‡å‡†çš„æ³¨å†Œè¡¨çš„æ–°æ”¯æŒå…è®¸å¼€å‘äººå‘˜ä½¿ç”¨ç°æœ‰çš„å·¥å…·ï¼ˆä¾‹å¦‚ï¼ŒDockerï¼‰æ¥æ„å»ºåŒ…å«å…¶æ‰©å±•çš„é•œåƒï¼Œå¹¶å°†å…¶æ¨é€åˆ°ç¬¦åˆ OCI æ ‡å‡†çš„æ³¨å†Œè¡¨ã€‚è¿™å…è®¸ä»¥å¯¹å¾…å®¹å™¨é•œåƒçš„ç›¸åŒæ–¹å¼å¯¹å¾… Wasm æ’ä»¶ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨é•œåƒæ ‡ç­¾å’Œä¸åŒçš„å­˜å‚¨åº“ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h1&gt;
&lt;p&gt;WasmPlugin API çš„å·¥ä½œä»åœ¨è¿›è¡Œä¸­ã€‚ä¸€äº›åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¯¹é•œåƒæ‹‰å– secret çš„æ”¯æŒï¼Œæ›´å¥½çš„é•œåƒç¼“å­˜æ”¯æŒï¼Œä»¥åŠå¯¹ singleton æ‰©å±•çš„æ”¯æŒè¿˜ä¸èƒ½ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;è¦å¼€å§‹ä½¿ç”¨ Wasmï¼Œè¯·&lt;a href=&#34;https://tetrate-io.zoom.us/webinar/register/WN_OJG0hpo-RXSEJcH_SutlPQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è§‚çœ‹&lt;/a&gt; Wasm ç ”è®¨ä¼šçš„&lt;a href=&#34;https://tetrate-io.zoom.us/webinar/register/WN_OJG0hpo-RXSEJcH_SutlPQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å½•éŸ³&lt;/a&gt;å¹¶åŠ å…¥ &lt;a href=&#34;https://tetr8.io/tetrate-edu-slack&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slack ä¸Šçš„ Wasm å¯¹è¯&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ç½‘æ˜“å¼€æº Istio æ‰©å±•é¡¹ç›® Slime ç®€ä»‹â€”â€”åŸºäº Istio çš„æ™ºèƒ½æœåŠ¡ç½‘æ ¼ç®¡ç†å™¨</title>
      <link>https://cloudnativecn.com/blog/smart-istio-management-plane-slime/</link>
      <pubDate>Tue, 30 Nov 2021 10:03:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/smart-istio-management-plane-slime/</guid>
      <description>&lt;p&gt;æœ€è¿‘æˆ‘åœ¨ç ”ç©¶ Istio ç”Ÿæ€ä¸­çš„å¼€æºé¡¹ç›®ï¼Œ&lt;a href=&#34;https://github.com/slime-io/slime/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slime&lt;/a&gt; è¿™ä¸ªé¡¹ç›®å¼€æºä¸ 2021 å¹´åˆï¼Œæ˜¯ç”±ç½‘æ˜“æ•°å¸†å¾®æœåŠ¡å›¢é˜Ÿå¼€æºçš„ä¸€æ¬¾åŸºäº Istio çš„æ™ºèƒ½ç½‘æ ¼ç®¡ç†å™¨ã€‚Slime åŸºäº Kubernetes Operator å®ç°ï¼Œå¯ä½œä¸º Istio çš„ CRD ç®¡ç†å™¨ï¼Œæ— é¡»å¯¹ Istio åšä»»ä½•å®šåˆ¶åŒ–æ”¹é€ ï¼Œå°±å¯ä»¥å®šä¹‰åŠ¨æ€çš„æœåŠ¡æ²»ç†ç­–ç•¥ï¼Œä»è€Œè¾¾åˆ°è‡ªåŠ¨ä¾¿æ·ä½¿ç”¨ Istio å’Œ Envoy é«˜é˜¶åŠŸèƒ½çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;slime-è¯•å›¾è§£å†³çš„é—®é¢˜&#34;&gt;Slime è¯•å›¾è§£å†³çš„é—®é¢˜&lt;/h2&gt;
&lt;p&gt;Slime é¡¹ç›®çš„è¯ç”Ÿä¸»è¦ä¸ºäº†è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç½‘æ ¼å†…æ‰€æœ‰æœåŠ¡é…ç½®å…¨é‡ä¸‹åˆ°æ‰€æœ‰ Sidecar Proxyï¼Œå¯¼è‡´å…¶æ¶ˆè€—å¤§é‡èµ„æºä½¿å¾—åº”ç”¨æ€§èƒ½å˜å·®çš„é—®é¢˜&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åœ¨ Istio ä¸­å®ç°é«˜é˜¶æ‰©å±•çš„é—®é¢˜ï¼šæ¯”å¦‚æ‰©å±• HTTP æ’ä»¶ï¼›æ ¹æ®æœåŠ¡çš„èµ„æºä½¿ç”¨ç‡åšåˆ°è‡ªé€‚åº”é™æµ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Slime è§£å†³ä»¥ä¸Šé—®é¢˜çš„ç­”æ¡ˆæ˜¯æ„å»º Istio çš„æ§åˆ¶å¹³é¢ï¼Œå…·ä½“åšæ³•æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ„å»ºå¯æ‹”æ’æ§åˆ¶å™¨&lt;/li&gt;
&lt;li&gt;æ•°æ®å¹³é¢ç›‘æ§&lt;/li&gt;
&lt;li&gt;CRD è½¬æ¢&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸Šæ–¹å¼ Slime å¯ä»¥å®ç°&lt;strong&gt;é…ç½®æ‡’åŠ è½½&lt;/strong&gt;å’Œ&lt;strong&gt;æ’ä»¶ç®¡ç†å™¨&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;slime-æ¶æ„&#34;&gt;Slime æ¶æ„&lt;/h2&gt;
&lt;p&gt;Slime å†…éƒ¨åˆ†ä¸ºä¸‰å¤§æ¨¡å—ï¼Œå…¶æ¶æ„å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-slime-å†…éƒ¨æ¶æ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Slime å†…éƒ¨æ¶æ„å›¾&#34; srcset=&#34;
               /blog/smart-istio-management-plane-slime/slime-internal-arch_hu_9ff043cc5ebb9094.webp 400w,
               /blog/smart-istio-management-plane-slime/slime-internal-arch_hu_dd9bc0eee3999c98.webp 760w,
               /blog/smart-istio-management-plane-slime/slime-internal-arch_hu_f3d0b82d97d9513f.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/smart-istio-management-plane-slime/slime-internal-arch_hu_9ff043cc5ebb9094.webp&#34;
               width=&#34;760&#34;
               height=&#34;403&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Slime å†…éƒ¨æ¶æ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Slime å†…éƒ¨ä¸‰å¤§ç»„ä»¶ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;slime-boot&lt;/code&gt;ï¼šåœ¨ Kubernetes ä¸Šéƒ¨ç½² Slime æ¨¡å—çš„ operatorã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;slime-controller&lt;/code&gt;ï¼šSlime çš„æ ¸å¿ƒç»„ä»¶ï¼Œç›‘å¬ Slime CRD å¹¶å°†å…¶è½¬æ¢ä¸º Istio CRDã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;slime-metric&lt;/code&gt;ï¼šç”¨äºè·å–æœåŠ¡ metrics ä¿¡æ¯çš„ç»„ä»¶ï¼Œ&lt;code&gt;slime-controller&lt;/code&gt; ä¼šæ ¹æ®å…¶è·å–çš„ä¿¡æ¯åŠ¨æ€è°ƒæ•´æœåŠ¡æ²»ç†è§„åˆ™ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç›®å‰ Slime å†…ç½®äº†ä¸‰ä¸ªæ§åˆ¶å™¨å­æ¨¡å—ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®æ‡’åŠ è½½ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰&lt;/strong&gt;ï¼šç”¨æˆ·æ— é¡»æ‰‹åŠ¨é…ç½® &lt;code&gt;SidecarScope&lt;/code&gt;ï¼ŒIstio å¯ä»¥æŒ‰éœ€åŠ è½½æœåŠ¡é…ç½®å’ŒæœåŠ¡å‘ç°ä¿¡æ¯ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HTTP æ’ä»¶ç®¡ç†&lt;/strong&gt;ï¼šä½¿ç”¨æ–°çš„ CRDâ€”â€”&lt;code&gt;pluginmanager/envoyplugin&lt;/code&gt; åŒ…è£…äº†å¯è¯»æ€§ï¼Œæ‘’å¼ƒäº†å¯ç»´æŠ¤æ€§è¾ƒå·®çš„ &lt;code&gt;envoyfilter&lt;/code&gt;ï¼Œä½¿å¾—æ’ä»¶æ‰©å±•æ›´ä¸ºä¾¿æ·ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªé€‚åº”é™æµ&lt;/strong&gt;ï¼šç»“åˆç›‘æ§ä¿¡æ¯è‡ªåŠ¨è°ƒæ•´é™æµç­–ç•¥ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä»€ä¹ˆæ˜¯ SidecarScopeï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;SidecarScope æ˜¯åœ¨ Istio 1.1 ç‰ˆæœ¬ä¸­å¼•å…¥çš„ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªç›´æ¥é¢å‘ç”¨æˆ·çš„é…ç½®é¡¹ï¼Œè€Œæ˜¯ Sidecar èµ„æºçš„åŒ…è£…å™¨ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ &lt;a href=&#34;../config/networking/sidecar.md&#34;&gt;Sidecar èµ„æº&lt;/a&gt;ä¸­çš„ &lt;code&gt;egress&lt;/code&gt; é€‰é¡¹ã€‚é€šè¿‡è¯¥é…ç½®å¯ä»¥å‡å°‘ Istio å‘ Sidecar ä¸‹å‘çš„æ•°æ®é‡ï¼Œä¾‹å¦‚åªå‘æŸä¸ªå‘½åç©ºé—´ä¸­çš„æŸäº›æœåŠ¡ä¸‹å‘æŸäº› hosts çš„è®¿é—®é…ç½®ï¼Œä»è€Œæé«˜åº”ç”¨æé«˜æ€§èƒ½ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h2 id=&#34;ä½¿ç”¨-slime-ä½œä¸º-istio-çš„æ§åˆ¶å¹³é¢&#34;&gt;ä½¿ç”¨ Slime ä½œä¸º Istio çš„æ§åˆ¶å¹³é¢&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒSlime åœ¨ Istio ä¹‹ä¸Šæ„å»ºäº†æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œç›¸å½“äºä¸º Istio æ„å»ºäº†ä¸€å±‚ç®¡ç†å¹³é¢ï¼Œå…¶å·¥ä½œæµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-slime-å·¥ä½œæµç¨‹å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Slime å·¥ä½œæµç¨‹å›¾&#34; srcset=&#34;
               /blog/smart-istio-management-plane-slime/slime-flow-chart_hu_c9756f080ecd7ae0.webp 400w,
               /blog/smart-istio-management-plane-slime/slime-flow-chart_hu_eac63bf7bb69c271.webp 760w,
               /blog/smart-istio-management-plane-slime/slime-flow-chart_hu_8f6aecd08b8c6c34.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/smart-istio-management-plane-slime/slime-flow-chart_hu_c9756f080ecd7ae0.webp&#34;
               width=&#34;760&#34;
               height=&#34;417&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Slime å·¥ä½œæµç¨‹å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Slime Operator æ ¹æ®ç®¡ç†å‘˜çš„é…ç½®åœ¨ Kubernetes ä¸­å®Œæˆ Slime ç»„ä»¶çš„åˆå§‹åŒ–ï¼›&lt;/li&gt;
&lt;li&gt;å¼€å‘è€…åˆ›å»ºç¬¦åˆ Slime CRD è§„èŒƒçš„é…ç½®å¹¶åº”ç”¨åˆ° Kubernetes é›†ç¾¤ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Slime æŸ¥è¯¢ Prometheus ä¸­ä¿å­˜çš„ç›¸å…³æœåŠ¡çš„ç›‘æ§æ•°æ®ï¼Œç»“åˆ Slime CRD ä¸­è‡ªé€‚åº”éƒ¨åˆ†çš„é…ç½®ï¼Œå°† Slime CRD è½¬æ¢ä¸º Istio CRDï¼ŒåŒæ—¶å°†å…¶æ¨é€åˆ° Global Proxy ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Istio ç›‘å¬ Istio CRD çš„åˆ›å»ºï¼›&lt;/li&gt;
&lt;li&gt;Istio å°† Sidecar Proxy çš„é…ç½®ä¿¡æ¯æ¨é€åˆ°æ•°æ®å¹³é¢ç›¸åº”çš„ Sidecar Proxy ä¸­ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¸Šåªæ˜¯ä¸€ä¸ªå¯¹ Slime å·¥ä½œæµç¨‹çš„ä¸€ä¸ªç¬¼ç»Ÿçš„ä»‹ç»ï¼Œæ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ &lt;a href=&#34;https://github.com/slime-io/slime/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slime GitHub&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é…ç½®æ‡’åŠ è½½&#34;&gt;é…ç½®æ‡’åŠ è½½&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†è§£å†³æ•°æ®å¹³é¢ä¸­ Sidecar Proxy èµ„æºæ¶ˆè€—è¿‡å¤§åŠç½‘ç»œå»¶è¿Ÿé—®é¢˜ï¼ŒSlime ä½¿ç”¨äº†é…ç½®æ‡’åŠ è½½ï¼ˆæŒ‰éœ€åŠ è½½ Sidecar é…ç½®ï¼‰çš„æ–¹æ¡ˆã€‚è¯¥æ–¹æ¡ˆçš„æ ¸å¿ƒæ€æƒ³æ˜¯å‘æ¯ä¸ª Sidecar Proxy ä¸­åªä¸‹å‘å…¶æ‰€ Pod ä¸­æœåŠ¡æ‰€éœ€çš„é…ç½®ï¼Œè€Œä¸æ˜¯å°†ç½‘æ ¼ä¸­çš„æ‰€æœ‰æœåŠ¡ä¿¡æ¯å…¨é‡ä¸‹å‘ã€‚æ‰€ä»¥ Slime éœ€è¦è·å–æ¯ä¸ªæœåŠ¡çš„è°ƒç”¨å…³ç³»è¿™æ ·æ‰èƒ½å¾—åˆ°å…¶æ‰€éœ€çš„ Sidecar Proxy é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;Slime å®ç° Sidecar Proxy é…ç½®æ‡’åŠ è½½çš„æ–¹æ³•æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®©æ•°æ®å¹³é¢ä¸­çš„æ‰€æœ‰æœåŠ¡çš„é¦–æ¬¡è°ƒç”¨éƒ½é€šè¿‡ä¸€ä¸ª Global Proxyï¼Œè¯¥ Proxy å¯ä»¥è®°å½•æ‰€æœ‰æœåŠ¡çš„è°ƒç”¨å’Œä¾èµ–ä¿¡æ¯ï¼Œæ ¹æ®è¯¥ä¾èµ–ä¿¡æ¯æ›´æ–° Istio ä¸­ Sidecar èµ„æºçš„é…ç½®ï¼›&lt;/li&gt;
&lt;li&gt;å½“æŸä¸ªæœåŠ¡çš„è°ƒç”¨é“¾è¢« VirtualService ä¸­çš„è·¯ç”±ä¿¡æ¯é‡æ–°å®šä¹‰æ—¶ï¼ŒGlobal Proxy åŸæœ‰è®°å½•å°±å¤±æ•ˆäº†ï¼Œéœ€è¦ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„æ¥ç»´æŠ¤è¯¥æœåŠ¡çš„è°ƒç”¨å…³ç³»ã€‚Slime åˆ›å»ºäº†åä¸º &lt;code&gt;ServiceFence&lt;/code&gt;  çš„ CRD æ¥ç»´æŠ¤æœåŠ¡è°ƒç”¨å…³ç³»ä»¥è§£å†³æœåŠ¡ä¿¡æ¯ç¼ºå¤±é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä½¿ç”¨-global-proxy-åˆå§‹åŒ–æœåŠ¡è°ƒç”¨æ‹“æ‰‘&#34;&gt;ä½¿ç”¨ Global Proxy åˆå§‹åŒ–æœåŠ¡è°ƒç”¨æ‹“æ‰‘&lt;/h3&gt;
&lt;p&gt;Slime åœ¨æ•°æ®å¹³é¢ä¸­éƒ¨ç½² Global Proxyï¼ˆä¹Ÿå«åš Global Sidecarï¼Œä½†å…¶ä¸åº”ç”¨çš„ Pod ä¸æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œç¬”è€…æ›´å€¾å‘äºç§°å…¶ä¸º Global Proxyï¼‰ï¼Œè¯¥ä»£ç†åŒæ ·ä½¿ç”¨ Envoy æ„å»ºï¼Œåœ¨æ¯ä¸ªéœ€è¦å¯åŠ¨é…ç½®æ‡’åŠ è½½çš„å‘½åç©ºé—´ä¸­éƒ¨ç½²ä¸€ä¸ªæˆ–åœ¨æ•´ä¸ªç½‘æ ¼ä¸­åªéƒ¨ç½²ä¸€ä¸ªï¼Œæ‰€æœ‰ç¼ºå¤±æœåŠ¡å‘ç°ä¿¡æ¯çš„è°ƒç”¨ï¼ˆä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨é…ç½®æœåŠ¡è°ƒç”¨å…³ç³»ï¼‰ï¼Œéƒ½ä¼šè¢«å…œåº•è·¯ç”±åŠ«æŒåˆ° Global Proxyï¼Œç»è¿‡å…¶é¦–æ¬¡è½¬å‘åï¼ŒSlime ä¾¿å¯æ„ŸçŸ¥åˆ°è¢«è°ƒç”¨æ–¹çš„ä¿¡æ¯ï¼Œç„¶åæ ¹æ®å…¶å¯¹åº”æœåŠ¡çš„ VirtualServiceï¼Œæ‰¾åˆ°æœåŠ¡åå’ŒçœŸå®åç«¯çš„æ˜ å°„å…³ç³»ï¼Œå°†ä¸¤è€…çš„éƒ½åŠ å…¥ SidecarScopeï¼Œä»¥åè¯¥æœåŠ¡çš„è°ƒç”¨å°±ä¸å†éœ€è¦ç»è¿‡ Global Proxy äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-servicefence-ç»´æŠ¤æœåŠ¡è°ƒç”¨æ‹“æ‰‘&#34;&gt;ä½¿ç”¨ ServiceFence ç»´æŠ¤æœåŠ¡è°ƒç”¨æ‹“æ‰‘&lt;/h3&gt;
&lt;p&gt;åœ¨ä½¿ç”¨ Global Proxy åˆå§‹åŒ–æœåŠ¡è°ƒç”¨æ‹“æ‰‘åï¼Œä¸€æ—¦æœåŠ¡è°ƒç”¨é“¾æœ‰å˜åŠ¨çš„è¯æ€ä¹ˆåŠï¼Ÿå¯¹æ­¤ Slime åˆ›å»ºäº† ServiceFence çš„ CRDã€‚ä½¿ç”¨ ServiceFence å¯ä»¥ç»´æŠ¤æœåŠ¡åå’Œåç«¯æœåŠ¡çš„æ˜ å°„å…³ç³»ã€‚Slime æ ¹æ®å…¶å¯¹åº”æœåŠ¡çš„ VirtualServiceï¼Œæ‰¾åˆ° Kubernetes æœåŠ¡åå’ŒçœŸå®åç«¯ï¼ˆhostï¼‰çš„æ˜ å°„å…³ç³»ï¼Œå°†ä¸¤è€…çš„éƒ½åŠ å…¥ Sidecar çš„é…ç½®ä¸­ã€‚ServiceFence ç®¡ç†ç”Ÿæˆçš„ SidecarScope çš„ç”Ÿå‘½å‘¨æœŸï¼Œè‡ªåŠ¨æ¸…ç†é•¿æ—¶é—´ä¸ç”¨çš„è°ƒç”¨å…³ç³»ï¼Œä»è€Œé¿å…ä¸Šè¿°é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¦‚ä½•å¼€å¯é…ç½®æ‡’åŠ è½½&#34;&gt;å¦‚ä½•å¼€å¯é…ç½®æ‡’åŠ è½½&lt;/h3&gt;
&lt;p&gt;é…ç½®æ‡’åŠ è½½åŠŸèƒ½å¯¹äºç»ˆç«¯ç”¨æˆ·æ˜¯é€æ˜çš„ï¼Œåªéœ€è¦ Kubernetes  Service ä¸Šæ‰“ä¸Š &lt;code&gt;istio.dependency.servicefence/status:&amp;quot;true&amp;quot;&lt;/code&gt; çš„æ ‡ç­¾ï¼Œè¡¨æ˜è¯¥æœåŠ¡éœ€è¦å¼€å¯é…ç½®æ‡’åŠ è½½ï¼Œå‰©ä¸‹çš„äº‹æƒ…äº¤ç»™ Slime Operator æ¥å®Œæˆå³å¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;http-æ’ä»¶ç®¡ç†&#34;&gt;HTTP æ’ä»¶ç®¡ç†&lt;/h2&gt;
&lt;p&gt;Istio ä¸­çš„æ’ä»¶æ‰©å±•åªèƒ½é€šè¿‡ EnvoyFilter æ¥å®ç°ï¼Œå› ä¸ºå®ƒæ˜¯ xDS å±‚é¢çš„é…ç½®ï¼Œç®¡ç†å’Œç»´æŠ¤è¿™æ ·çš„é…ç½®éœ€è¦è€—è´¹å¤§é‡çš„ç²¾åŠ›ï¼Œä¹Ÿæå®¹æ˜“å‡ºé”™ã€‚å› æ­¤ï¼ŒSlime åœ¨ EnvoyFilter çš„åŸºç¡€ä¸Šåšäº†ä¸€å±‚é¢å‘æ’ä»¶çš„æŠ½è±¡ã€‚&lt;/p&gt;
&lt;p&gt;Slime å…±æœ‰ä¸¤ä¸ª CRD ç”¨äº HTTP æ’ä»¶ç®¡ç†ï¼Œåˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PluginManager&lt;/strong&gt;ï¼šé…ç½®ä¸ºå“ªäº›è´Ÿè½½å¼€å¯å“ªäº›æ’ä»¶ï¼Œæ’ä»¶çš„é…ç½®é¡ºåºå³ä¸ºæ‰§è¡Œé¡ºåºï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;EnvoyPlugin&lt;/strong&gt;ï¼šEnvoyPlugin ä¸å…³å¿ƒæ¯ä¸ªæ’ä»¶çš„å…·ä½“é…ç½®ï¼Œå…·ä½“é…ç½®ä¼šè¢«æ”¾åœ¨ EnvoyFilter èµ„æºçš„ &lt;code&gt;patch.typed_config&lt;/code&gt; ç»“æ„ä¸­é€ä¼ ï¼‰ï¼ŒEnvoyPlugin çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†æ’ä»¶é…ç½®åœ¨éœ€è¦çš„ç»´åº¦ä¸­åšèšåˆï¼Œä»è€Œé™å®šæ’ä»¶çš„ç”Ÿé²œèŒƒå›´ã€‚è¿™æ ·åšä¸€æ–¹é¢æ›´åŠ è´´åˆæ’ä»¶ä½¿ç”¨è€…çš„ä¹ æƒ¯ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿé™ä½äº†ä¸Šå±‚é…ç½®çš„å†—ä½™ï¼Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äº Slime ä¸­æ’ä»¶ç®¡ç†çš„è¯¦ç»†ä½¿ç”¨æ–¹å¼è¯·è§ &lt;a href=&#34;https://github.com/slime-io/slime/blob/master/doc/zh/plugin_manager.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slime GitHub&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è‡ªé€‚åº”é™æµ&#34;&gt;è‡ªé€‚åº”é™æµ&lt;/h2&gt;
&lt;p&gt;Envoy å†…ç½®çš„é™æµç»„ä»¶åŠŸèƒ½å•ä¸€ï¼Œåªèƒ½ä»¥å®ä¾‹ç»´åº¦é…ç½®é™æµå€¼ï¼Œæ— æ³•åšåˆ°æ ¹æ®åº”ç”¨è´Ÿè½½çš„è‡ªé€‚åº”é™æµã€‚Slime é€šè¿‡ä¸ Prometheus metric server å¯¹æ¥ï¼Œå®æ—¶çš„è·å–ç›‘æ§æƒ…å†µï¼Œæ¥åŠ¨æ€é…ç½®é™æµå€¼ã€‚&lt;/p&gt;
&lt;p&gt;Slime è‡ªé€‚åº”é™æµçš„æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-slime-çš„è‡ªé€‚åº”é™æµæµç¨‹å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Slime çš„è‡ªé€‚åº”é™æµæµç¨‹å›¾&#34; srcset=&#34;
               /blog/smart-istio-management-plane-slime/slime-smart-limiter_hu_1785842f3af10e33.webp 400w,
               /blog/smart-istio-management-plane-slime/slime-smart-limiter_hu_f855b5f1131e8d7b.webp 760w,
               /blog/smart-istio-management-plane-slime/slime-smart-limiter_hu_4618f8c0879fce1b.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/smart-istio-management-plane-slime/slime-smart-limiter_hu_1785842f3af10e33.webp&#34;
               width=&#34;760&#34;
               height=&#34;571&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Slime çš„è‡ªé€‚åº”é™æµæµç¨‹å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Slime çš„è‡ªé€‚åº”é™æµçš„æµç¨‹åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸º SmartLimiter åˆ° EnvoyFilter çš„è½¬æ¢ï¼Œå¦ä¸€éƒ¨åˆ†ä¸ºè·å–ç›‘æ§æ•°æ®ã€‚ç›®å‰ Slime æ”¯æŒä» Kubernetes Metric Server è·å–æœåŠ¡çš„ CPUã€å†…å­˜ã€å‰¯æœ¬æ•°ç­‰æ•°æ®ã€‚Slime è¿˜å¯¹å¤–æä¾›äº†ä¸€å¥—ç›‘æ§æ•°æ®æ¥å£ï¼ˆMetric Discovery Serverï¼‰ï¼Œé€šè¿‡ MDSï¼Œå¯ä»¥å°†è‡ªå®šä¹‰çš„ç›‘æ§æŒ‡æ ‡åŒæ­¥ç»™é™æµç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;Slime åˆ›å»ºçš„ CRD &lt;code&gt;SmartLimiter&lt;/code&gt; ç”¨äºé…ç½®è‡ªé€‚åº”é™æµã€‚å…¶çš„é…ç½®æ˜¯æ¥è¿‘è‡ªç„¶è¯­ä¹‰ï¼Œä¾‹å¦‚å¸Œæœ›åœ¨ CPU è¶…è¿‡ 80% æ—¶è§¦å‘æœåŠ¡ A çš„è®¿é—®é™åˆ¶ï¼Œé™é¢ä¸º 30QPSï¼Œå¯¹åº”çš„ SmartLimiter å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;microservice.netease.com/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SmartLimiter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;descriptors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fill_interval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;seconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;quota&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;30/{pod}&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 30 ä¸ºè¯¥æœåŠ¡çš„é¢åº¦ï¼Œå°†å…¶å‡åˆ†ç»™æ¯ä¸ª podï¼ŒåŠ å…¥æœ‰ 3 ä¸ª podï¼Œåˆ™æ¯ä¸ª pod çš„é™æµä¸º 10&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;condition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{cpu}&amp;gt;0.8&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ ¹æ®ç›‘æ§é¡¹{cpu}çš„å€¼è‡ªåŠ¨å¡«å……è¯¥æ¨¡æ¿&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ›´å¤š&#34;&gt;æ›´å¤š&lt;/h2&gt;
&lt;p&gt;Slime å¼€æºäº 2021 å¹´åˆï¼Œæœ¬æ–‡å‘ç¨¿æ—¶è¯¥é¡¹ç›®ä»å¤„äºåˆçº§é˜¶æ®µï¼Œæœ¬æ–‡å¤§é‡å‚è€ƒäº†æ¨ç¬›èˆªåœ¨äº‘åŸç”Ÿç¤¾åŒºä¸­çš„åˆ†äº« &lt;a href=&#34;https://cloudnative.to/blog/netease-slime/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slimeï¼šè®© Istio æœåŠ¡ç½‘æ ¼å˜å¾—æ›´åŠ é«˜æ•ˆä¸æ™ºèƒ½&lt;/a&gt; åŠ Slime çš„ &lt;a href=&#34;https://github.com/slime-io/slime&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitHub&lt;/a&gt;ã€‚æ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å…³æ³¨ä¸‹è¿™ä¸ªé¡¹ç›®çš„ GitHubï¼Œè¿›ä¸€æ­¥äº†è§£å®ƒã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–æ¬¢è¿å…³æ³¨æœåŠ¡ç½‘æ ¼å’Œ Istio çš„æœ‹å‹åŠ å…¥&lt;a href=&#34;https://cloudnative.to/sig-istio/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿç¤¾åŒº Istio SIG&lt;/a&gt;ï¼Œä¸€èµ·å‚ä¸è®¨è®ºå’Œäº¤æµã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://cloudnative.to/blog/netease-slime/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slimeï¼šè®© Istio æœåŠ¡ç½‘æ ¼å˜å¾—æ›´åŠ é«˜æ•ˆä¸æ™ºèƒ½ - cloudnative.to&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/slime-io/slime/blob/master/README_ZH.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slime GitHub æ–‡æ¡£ - github.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/sidecar/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sidecar - istio.io&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Istio 1.12 å¼•å…¥ Wasm æ’ä»¶é…ç½® API ç”¨äºæ‰©å±• Istio ç”Ÿæ€</title>
      <link>https://cloudnativecn.com/blog/istio-wasm-extensions-and-ecosystem/</link>
      <pubDate>Wed, 24 Nov 2021 18:03:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-wasm-extensions-and-ecosystem/</guid>
      <description>&lt;p&gt;Istio 1.12 ä¸­æ–°çš„ WebAssembly åŸºç¡€è®¾æ–½ä½¿å…¶èƒ½å¤Ÿè½»æ¾åœ°å°†é¢å¤–çš„åŠŸèƒ½æ³¨å…¥ç½‘æ ¼éƒ¨ç½²ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ç»è¿‡ä¸‰å¹´çš„åŠªåŠ›ï¼ŒIstio ç°åœ¨æœ‰äº†ä¸€ä¸ªå¼ºå¤§çš„æ‰©å±•æœºåˆ¶ï¼Œå¯ä»¥å°†è‡ªå®šä¹‰å’Œç¬¬ä¸‰æ–¹ Wasm æ¨¡å—æ·»åŠ åˆ°ç½‘æ ¼ä¸­çš„ sidecarã€‚Tetrate å·¥ç¨‹å¸ˆ&lt;a href=&#34;https://github.com/mathetake&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç±³ç”°æ­¦ï¼ˆTakeshi Yonedaï¼‰&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/lizan&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘¨ç¤¼èµï¼ˆLizan Zhouï¼‰&lt;/a&gt;åœ¨å®ç°è¿™ä¸€ç›®æ ‡æ–¹é¢å‘æŒ¥äº†é‡è¦ä½œç”¨ã€‚è¿™ç¯‡æ–‡ç« å°†ä»‹ç» Istio ä¸­ Wasm çš„åŸºç¡€çŸ¥è¯†ï¼Œä»¥åŠä¸ºä»€ä¹ˆå®ƒå¾ˆé‡è¦ï¼Œç„¶åæ˜¯å…³äºå»ºç«‹è‡ªå·±çš„ Wasm æ’ä»¶å¹¶å°†å…¶éƒ¨ç½²åˆ°ç½‘æ ¼çš„ç®€çŸ­æ•™ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆ-istio-ä¸­çš„-wasm-å¾ˆé‡è¦&#34;&gt;ä¸ºä»€ä¹ˆ Istio ä¸­çš„ Wasm å¾ˆé‡è¦&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ Wasmï¼Œå¼€å‘äººå‘˜å¯ä»¥æ›´å®¹æ˜“çš„æ‰©å±•ç½‘æ ¼å’Œç½‘å…³ã€‚åœ¨ Tetrateï¼Œæˆ‘ä»¬ç›¸ä¿¡è¿™é¡¹æŠ€æœ¯æ­£åœ¨è¿…é€Ÿæˆç†Ÿï¼Œå› æ­¤æˆ‘ä»¬ä¸€ç›´åœ¨æŠ•èµ„ä¸Šæ¸¸çš„ Istioï¼Œä½¿é…ç½® APIã€åˆ†å‘æœºåˆ¶å’Œä» Go å¼€å§‹çš„å¯æ‰©å±•æ€§ä½“éªŒæ›´åŠ å®¹æ˜“ã€‚æˆ‘ä»¬è®¤ä¸ºè¿™å°†ä½¿ Istio æœ‰ä¸€ä¸ªå…¨æ–°çš„æ–¹å‘ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœ‰ä½•æœŸå¾…æ–°çš„æ’ä»¶é…ç½®-apiå¯é çš„è·å–å’Œå®‰è£…æœºåˆ¶&#34;&gt;æœ‰ä½•æœŸå¾…ï¼šæ–°çš„æ’ä»¶é…ç½® APIï¼Œå¯é çš„è·å–å’Œå®‰è£…æœºåˆ¶&lt;/h2&gt;
&lt;p&gt;æœ‰ä¸€ä¸ªæ–°çš„é¡¶çº§ APIï¼Œå«åš &lt;a href=&#34;https://istio.io/latest/docs/reference/config/proxy_extensions/wasm-plugin/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WasmPlugin&lt;/a&gt;ï¼Œå¯ä»¥è®©ä½ é…ç½®è¦å®‰è£…å“ªäº›æ’ä»¶ï¼Œä»å“ªé‡Œè·å–å®ƒä»¬ï¼ˆOCI é•œåƒã€å®¹å™¨æœ¬åœ°æ–‡ä»¶æˆ–è¿œç¨‹ HTTP èµ„æºï¼‰ï¼Œåœ¨å“ªé‡Œå®‰è£…å®ƒä»¬ï¼ˆé€šè¿‡ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/type/workload-selector/#WorkloadSelector&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Workload é€‰æ‹©å™¨&lt;/a&gt;ï¼‰ï¼Œä»¥åŠä¸€ä¸ªé…ç½®ç»“æ„ä½“æ¥ä¼ é€’ç»™æ’ä»¶å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;istio-agent ä¸­çš„é•œåƒæå–æœºåˆ¶ï¼ˆåœ¨ Istio 1.9 ä¸­å¼•å…¥ï¼‰ï¼Œä»è¿œç¨‹ HTTP æºå¯é åœ°æ£€ç´¢ Wasm äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå·²è¢«æ‰©å±•åˆ°æ”¯æŒä»ä»»ä½• OCI æ³¨å†Œå¤„æ£€ç´¢ Wasm OCI é•œåƒï¼ŒåŒ…æ‹¬ Docker Hubã€Google Container Registryï¼ˆGCRï¼‰ã€Amazon Elastic Container Registryï¼ˆAmazon ECRï¼‰å’Œå…¶ä»–åœ°æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ„å‘³ç€ä½ å¯ä»¥åˆ›å»ºè‡ªå·±çš„ Wasm æ’ä»¶ï¼Œæˆ–è€…ä»ä»»ä½•æ³¨å†Œå¤„é€‰æ‹©ç°æˆçš„æ’ä»¶ï¼Œåªéœ€å‡ è¡Œé…ç½®å°±å¯ä»¥æ‰©å±• Istio çš„åŠŸèƒ½ã€‚Istio ä¼šåœ¨å¹•ååšæ‰€æœ‰çš„å·¥ä½œï¼Œä¸ºä½ è·å–ã€éªŒè¯ã€å®‰è£…å’Œé…ç½®å®ƒä»¬ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-wasm-æ‰©å±•&#34;&gt;Istio Wasm æ‰©å±•&lt;/h2&gt;
&lt;p&gt;Istio çš„æ‰©å±•æœºåˆ¶ä½¿ç”¨ &lt;a href=&#34;https://github.com/proxy-wasm/spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Proxy-Wasm åº”ç”¨äºŒè¿›åˆ¶æ¥å£ï¼ˆABIï¼‰&lt;/a&gt;è§„èŒƒï¼Œè¯¥è§„èŒƒç”±å‘¨ç¤¼èµå’Œç±³ç”°æ­¦å¸¦å¤´åˆ¶å®šï¼Œæä¾›äº†ä¸€å¥—ä»£ç†æ— å…³çš„æµåª’ä½“ API å’Œå®ç”¨åŠŸèƒ½ï¼Œå¯ä»¥ç”¨ä»»ä½•æœ‰åˆé€‚ SDK çš„è¯­è¨€æ¥å®ç°ã€‚æˆªè‡³ç›®å‰ï¼ŒProxy-Wasm çš„ SDK æœ‰ AssemblyScriptï¼ˆç±»ä¼¼ TypeScriptï¼‰ã€C++ã€Rustã€Zig å’Œ Goï¼ˆä½¿ç”¨ TinyGo WebAssembly ç³»ç»Ÿæ¥å£ã€ŒWASIã€ï¼Œç±³ç”°æ­¦ä¹Ÿæ˜¯å…¶ä¸»è¦è´¡çŒ®è€…ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¦‚ä½•è·å–tetrate-istio-distro&#34;&gt;å¦‚ä½•è·å–ï¼šTetrate Istio Distro&lt;/h2&gt;
&lt;p&gt;è·å¾— Istio çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ Tetrate çš„å¼€æº &lt;a href=&#34;https://istio.tetratelabs.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;get-mesh&lt;/code&gt; CLI å’Œ Tetrate Istio Distro&lt;/a&gt;ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•ã€å®‰å…¨çš„ä¸Šæ¸¸ Istio çš„ä¼ä¸šçº§å‘è¡Œç‰ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;wasm-å®æˆ˜æ„å»ºä½ è‡ªå·±çš„é€Ÿç‡é™åˆ¶-webassembly-æ’ä»¶&#34;&gt;Wasm å®æˆ˜ï¼šæ„å»ºä½ è‡ªå·±çš„é€Ÿç‡é™åˆ¶ WebAssembly æ’ä»¶&lt;/h2&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬ä¹‹å‰å…³äº &lt;a href=&#34;https://www.tetrate.io/blog/wasm-modules-and-envoy-extensibility-explained-part-1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy ä¸­çš„ Wasm æ‰©å±•&lt;/a&gt;çš„åšå®¢ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•å¼€å‘ WebAssembly æ’ä»¶æ¥å¢å¼ºæœåŠ¡ç½‘æ ¼çš„èƒ½åŠ›ã€‚æ–°çš„ Wasm æ‰©å±• API è®©å®ƒå˜å¾—æ›´åŠ ç®€å•ã€‚æœ¬æ•™ç¨‹å°†è§£é‡Šå¦‚ä½•ä½¿ç”¨ Istio Wasm æ‰©å±• API æ¥å®ç° Golang ä¸­çš„é€Ÿç‡é™åˆ¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…ˆå†³æ¡ä»¶&#34;&gt;å…ˆå†³æ¡ä»¶&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç†Ÿæ‚‰ &lt;a href=&#34;https://www.tetrate.io/blog/wasm-modules-and-envoy-extensibility-explained-part-1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å’Œ Envoy ä¸­çš„ Wasm&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å®‰è£… &lt;a href=&#34;https://tinygo.org/getting-started/install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TinyGo 0.21.0&lt;/a&gt; å¹¶ä½¿ç”¨ Golang æ„å»º Wasm æ‰©å±•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è¯´æ˜&#34;&gt;è¯´æ˜&lt;/h3&gt;
&lt;p&gt;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨é›†ç¾¤ä¸­éƒ¨ç½²ä¸¤ä¸ªåº”ç”¨ç¨‹åºï¼ˆsleep å’Œ httpbinï¼‰ã€‚æˆ‘ä»¬å°†ä»ä¸€ä¸ªå®¹å™¨å‘å¦ä¸€ä¸ªå®¹å™¨å‘é€å‡ ä¸ªè¯·æ±‚ï¼Œè€Œä¸éƒ¨ç½²ä»»ä½• Wasm æ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åœ¨ Go ä¸­åˆ›å»ºä¸€ä¸ª Wasm æ¨¡å—ï¼Œä¸ºå“åº”æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰å¤´ï¼Œå¹¶æ‹’ç»ä»»ä½•è¯·æ±‚ç‡è¶…è¿‡æ¯ç§’ä¸¤ä¸ªçš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†æŠŠ Wasm æ¨¡å—æ¨é€åˆ° Docker é•œåƒä»“åº“ï¼Œå¹¶ä½¿ç”¨æ–°çš„ WasmPlugin èµ„æºï¼Œå‘Šè¯‰ Istio ä»å“ªé‡Œä¸‹è½½ Wasm æ¨¡å—ï¼Œä»¥åŠå°†è¯¥æ¨¡å—åº”ç”¨äºå“ªäº›å·¥ä½œè´Ÿè½½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¬¬-1-æ­¥å®‰è£…-istio-å¹¶éƒ¨ç½²åº”ç”¨ç¨‹åº&#34;&gt;ç¬¬ 1 æ­¥ï¼šå®‰è£… Istio å¹¶éƒ¨ç½²åº”ç”¨ç¨‹åº&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä¸‹è½½å¹¶å®‰è£… Istio 1.12ï¼Œå¹¶æ ‡è®° Kubernetes çš„ default å‘½åç©ºé—´ï¼Œä»¥ä¾¿è‡ªåŠ¨æ³¨å…¥ sidecarã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -L https://git.io/getLatestIstio &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;ISTIO_VERSION&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1.12 sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; istio-1.12/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./bin/istioctl install --set &lt;span class=&#34;nv&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;demo -y
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace default istio-injection&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;enabled --overwrite
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†éƒ¨ç½² httpbin å’Œ sleep åº”ç”¨ç¨‹åºçš„ç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/httpbin/httpbin.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/sleep/sleep.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”ç”¨ç¨‹åºéƒ¨ç½²å¹¶è¿è¡Œåï¼Œæˆ‘ä»¬å°†æ¯ç§’ä» &lt;strong&gt;sleep&lt;/strong&gt; å®¹å™¨å‘ &lt;strong&gt;httpbin&lt;/strong&gt; å®¹å™¨å‘é€ 4 ä¸ªè¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;SLEEP_POD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sleep -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;={&lt;/span&gt;.items..metadata.name&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SLEEP_POD&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -c sleep -- sh -c &lt;span class=&#34;s1&#34;&gt;&amp;#39;for i in $(seq 1 3); do curl --head -s httpbin:8000/headers; sleep 0.25; done&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Tue, &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; 22:18:32 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: application/json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;523&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-origin: *
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-credentials: &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Tue, &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; 22:18:32 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: application/json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;523&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-origin: *
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-credentials: &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Tue, &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; 22:18:32 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: application/json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;523&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-origin: *
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-credentials: &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ ä¼šå‘ç°æ‰€æœ‰çš„è¯·æ±‚éƒ½æˆåŠŸäº†ï¼Œå¹¶è¿”å›äº† HTTP 200ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¬¬-2-æ­¥å¼€å‘ç¼–è¯‘å’Œæ¨é€-wasm-æ¨¡å—&#34;&gt;ç¬¬ 2 æ­¥ï¼šå¼€å‘ã€ç¼–è¯‘å’Œæ¨é€ Wasm æ¨¡å—&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨ Golang å’Œ Proxy Wasm Golang SDK æ¥å¼€å‘ Wasm æ¨¡å—ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ SDK èµ„æºåº“ä¸­çš„ä¸€ä¸ªç°æœ‰ä¾‹å­ï¼Œå«åš istio-rate-limitingã€‚è¦å¼€å§‹ï¼Œè¯·å…ˆå…‹éš† Github ä»“åº“ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/tetratelabs/wasm-rate-limiting
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; wasm-rate-limiting/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬æ¥çœ‹çœ‹ &lt;code&gt;main.go&lt;/code&gt; ä¸­çš„ä»£ç ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨ Proxy Wasm Golang SDK å®ç°é€Ÿç‡é™åˆ¶é€»è¾‘çš„åœ°æ–¹ã€‚Wasm æ¨¡å—åšäº†ä¸¤ä»¶äº‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å“åº”ä¸­æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„å¤´ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œ 2 ä¸ªè¯·æ±‚ / ç§’çš„é€Ÿç‡é™åˆ¶ï¼Œæ‹’ç»è¶…é¢çš„è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ &lt;code&gt;main.go&lt;/code&gt; çš„ç‰‡æ®µï¼Œæ˜¾ç¤ºäº†åŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Modify the header&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;httpHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;OnHttpResponseHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numHeaders&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;endOfStream&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Action&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;additionalHeaders&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddHttpResponseHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionContinue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Perform rate limiting&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;httpHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;OnHttpRequestHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Action&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;current&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;UnixNano&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// We use nanoseconds() rather than time.Second() because the proxy-wasm has the known limitation.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// TODO(incfly): change to time.Second() once https://github.com/proxy-wasm/proxy-wasm-cpp-host/issues/199&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// is resolved and released.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;current&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lastRefillNanoSec&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1e9&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;remainToken&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lastRefillNanoSec&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;current&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogCriticalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Current time %v, last refill time %v, the remain token %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;current&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lastRefillNanoSec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;remainToken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;remainToken&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SendHttpResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;403&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[][&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;powered-by&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;proxy-wasm-go-sdk!!&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;rate limited, wait and retry.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to send local response: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ResumeHttpRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionPause&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;remainToken&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionContinue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ &lt;code&gt;OnHttpResponseHeaders&lt;/code&gt; å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨è¿­ä»£ &lt;code&gt;extraHeaders&lt;/code&gt; å˜é‡ï¼Œå¹¶å°†å¤´æ–‡ä»¶æ·»åŠ åˆ°å“åº”ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;code&gt;OnHttpRequestHeaders&lt;/code&gt; å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¾—åˆ°å½“å‰çš„æ—¶é—´æˆ³ï¼Œå°†å…¶ä¸æœ€åä¸€æ¬¡è¡¥ç»™æ—¶é—´çš„æ—¶é—´æˆ³è¿›è¡Œæ¯”è¾ƒï¼ˆå¯¹äºé€Ÿç‡é™åˆ¶å™¨ï¼‰ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œå°±è¡¥ç»™ä»¤ç‰Œã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰å‰©ä½™çš„ä»¤ç‰Œï¼Œæˆ‘ä»¬å°±å‘é€ä¸€ä¸ªå¸¦æœ‰é¢å¤–å¤´çš„ 403 å“åº”ï¼ˆ&lt;strong&gt;ç”±ï¼šproxy-wasm-go-sdkï¼ï¼&lt;/strong&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬ç”¨ tinygo å°† Golang ç¨‹åºç¼–è¯‘æˆ Wasm æ¨¡å—ï¼Œå¹¶å°†å…¶æ‰“åŒ…æˆä¸€ä¸ª Docker é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tinygo build -o main.wasm -scheduler&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;none -target&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;wasi main.go
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬æ„å»ºä¸€ä¸ª Docker é•œåƒï¼Œå¹¶å°†å…¶æ¨é€åˆ°é•œåƒä»“åº“ï¼ˆç”¨ä½ è‡ªå·±çš„ Docker é•œåƒä»“åº“å’Œé•œåƒåç§°æ›¿æ¢ &lt;code&gt;${YOUR_DOCKER_REGISTRY_IMAGE}&lt;/code&gt;ï¼‰ã€‚åœ¨è¿™ä¹‹åï¼Œä½ çš„ Wasm æ’ä»¶å°±å¯ä»¥åœ¨ä½ çš„æœåŠ¡ç½‘æ ¼ä¸­ä½¿ç”¨äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker build -t &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;YOUR_DOCKER_REGISTRY_IMAGE&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;:v1 .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker push -t &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;YOUR_DOCKER_REGISTRY_IMAGE&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;:v1 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªé¢„æ„å»ºçš„ Docker é•œåƒï¼Œå®ƒæœ‰ç›¸åŒçš„ä»£ç ï¼Œä½äº &lt;a href=&#34;http://ghcr.io/tetratelabs/wasm-rate-limiting:v1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ghcr.io/tetratelabs/wasm-rate-limiting:v1&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¬¬-3-æ­¥é…ç½®-istio-wasm-æ‰©å±•-api&#34;&gt;ç¬¬ 3 æ­¥ï¼šé…ç½® Istio Wasm æ‰©å±• API&lt;/h3&gt;
&lt;p&gt;Istio Wasm Extension API å’Œæ–°çš„ WasmPlugin èµ„æºå…è®¸æˆ‘ä»¬å°†æˆ‘ä»¬æ¨é€åˆ° Docker é•œåƒä»“åº“çš„é€Ÿç‡é™åˆ¶ Wasm æ¨¡å—æ·»åŠ åˆ° httpbin å·¥ä½œè´Ÿè½½ä¸­ã€‚ä¸‹é¢æ˜¯ WasmPlugin èµ„æºçš„ YAML é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;WasmPlugin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin-rate-limiting&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;oci://ghcr.io/tetratelabs/wasm-rate-limiting:v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªé…ç½®éƒ¨ç½²åï¼ŒIstiod å°±ä¼šæŠŠç›¸åº”çš„é…ç½®æ¨é€åˆ° Envoy sidecarï¼ˆä¸æˆ‘ä»¬åœ¨ &lt;code&gt;matchLabels&lt;/code&gt; å­—æ®µä¸­æŒ‡å®šçš„æ ‡ç­¾ç›¸åŒ¹é…çš„é‚£äº›ï¼‰ã€‚Sidecar ä¸­çš„ Istio ä»£ç†å°†æ‰§è¡Œè¿œç¨‹è·å–ï¼Œä¸‹è½½æˆ‘ä»¬åˆšåˆšæ¨é€çš„ Wasm æ¨¡å—ï¼Œç„¶åå°†å…¶åŠ è½½åˆ° Envoy è¿è¡Œæ—¶çš„ Wasm å¼•æ“ä¸­æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æŠŠä¸Šè¿° YAML ä¿å­˜ä¸º wasm.yamlï¼Œå¹¶å°†å…¶éƒ¨ç½²åˆ°é›†ç¾¤ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f ./wasm.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wasmplugin.extensions.istio.io/httpbin-rate-limiting created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç¬¬-4-æ­¥éªŒè¯é€Ÿç‡é™åˆ¶çš„æ•ˆæœ&#34;&gt;ç¬¬ 4 æ­¥ï¼šéªŒè¯é€Ÿç‡é™åˆ¶çš„æ•ˆæœ&lt;/h3&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬éƒ¨ç½²äº† WasmPlugin èµ„æºå’Œ Istio ä»æ³¨å†Œè¡¨ä¸­è·å–äº† Wasm æ¨¡å—åï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥éªŒè¯ Wasm æ’ä»¶ä¸­å®ç°çš„é€Ÿç‡é™åˆ¶æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;SLEEP_POD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sleep -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;={&lt;/span&gt;.items..metadata.name&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SLEEP_POD&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -c sleep -- sh -c &lt;span class=&#34;s1&#34;&gt;&amp;#39;for i in $(seq 1 3); do curl --head -s httpbin:8000/headers; sleep 0.25; done&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Tue, &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; 22:16:34 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: application/json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;523&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-origin: *
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-credentials: &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;who-am-i: wasm-extension
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;injected-by: istio-api!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Tue, &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; 22:16:35 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: application/json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;523&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-origin: *
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-credentials: &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;who-am-i: wasm-extension
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;injected-by: istio-api!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;403&lt;/span&gt; Forbidden
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;powered-by: proxy-wasm-go-sdk!!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;29&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: text/plain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;who-am-i: wasm-extension
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;injected-by: istio-api!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Tue, &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; 22:16:35 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°±åƒä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬ä» sleep å®¹å™¨å‘ httpbin å®¹å™¨å‘é€ 3 ä¸ªè¯·æ±‚ã€‚è¿™ä¸€æ¬¡ï¼ŒWasm æ’ä»¶ä»£ç è¢«æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°è¾“å‡ºä¸­çš„ä¸€äº›å·®å¼‚ã€‚é¦–å…ˆï¼Œ&lt;code&gt;who-am-i&lt;/code&gt; å¤´è¢« Wasm æ’ä»¶æ³¨å…¥äº†ã€‚å‰ä¸¤ä¸ªè¯·æ±‚ä»¥ HTTP 200 çš„å“åº”ä»£ç æˆåŠŸï¼Œå‰©ä¸‹çš„è¯·æ±‚åˆ™ä»¥ HTTP 429 å¤±è´¥ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ä¸€ä¸ªåä¸º &lt;code&gt;powered-by&lt;/code&gt; çš„é¢å¤–å¤´ï¼Œå®ƒä¹Ÿè¢« Wasm æ’ä»¶æ³¨å…¥äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ•™ç¨‹æ‘˜è¦&#34;&gt;æ•™ç¨‹æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;æ€»è€Œè¨€ä¹‹ï¼Œæœ¬æ•™ç¨‹æ¼”ç¤ºäº†å¦‚ä½•è½»æ¾å®ç°æ’ä»¶åŠŸèƒ½ï¼Œä»¥æ‰©å±• Istio çš„åŠŸèƒ½ï¼Œæ»¡è¶³ä½ çš„ç‰¹å®šéœ€æ±‚ã€‚è¿™éœ€è¦ä¸‰ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ Golang ä¸­å®ç°ä½ çš„æ’ä»¶åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ç¼–è¯‘ã€æ„å»ºï¼Œå¹¶å°† Wasm æ¨¡å—æ¨é€åˆ°ç¬¦åˆ OCI æ ‡å‡†çš„ Docker é•œåƒä»“åº“ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ WasmPlugin èµ„æºé…ç½®æœåŠ¡ç½‘æ ¼å·¥ä½œè´Ÿè½½ï¼Œä»¥ä¾¿ä»è¿œç¨‹é•œåƒä»“åº“ä¸­æ‹‰å– Wasm æ¨¡å—ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¯¥æ•™ç¨‹å®ç°äº†ä¸€ä¸ªå•ä¸€çš„ Wasm æ’ä»¶æ¥å¤„ç† HTTP è¯·æ±‚ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ å¯ä»¥æœ‰å¤šä¸ª Wasm æ’ä»¶ï¼Œæ¯ä¸ªå•ç‹¬çš„æ’ä»¶è´Ÿè´£æŸä¸€éƒ¨åˆ†çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œ&lt;a href=&#34;https://github.com/istio/api/blob/master/extensions/v1alpha1/wasm.proto#L254&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AUTHN&lt;/a&gt; é˜¶æ®µçš„ä¸€ä¸ªæ’ä»¶è·å–æˆ–éªŒè¯è®¤è¯å‡­è¯ï¼›&lt;a href=&#34;https://github.com/istio/api/blob/master/extensions/v1alpha1/wasm.proto#L257&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AUTHZ&lt;/a&gt; é˜¶æ®µçš„å¦ä¸€ä¸ªæ’ä»¶å®ç°ä½ è‡ªå·±å®šåˆ¶çš„æˆæƒé€»è¾‘ï¼Œç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;Istio Wasm æ‰©å±•è¿˜å…è®¸æˆ‘ä»¬ç”Ÿæˆæ’ä»¶æŒ‡æ ‡ï¼Œæˆ–åœ¨å¤šä¸ª Wasm æ’ä»¶ä¸­æ±‡æ€»ã€‚è¯¥æ’ä»¶æä¾›äº†ä¸€ä¸ªæ—¥å¿—åŠŸèƒ½ï¼Œå…è®¸æˆ‘ä»¬å°†æ—¥å¿—ä¿¡æ¯å†™åˆ° Envoy sidecarã€‚è¿™å¯¹ Wasm æ’ä»¶çš„è°ƒè¯•å’Œå¼€å‘ç‰¹åˆ«æœ‰å¸®åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰çš„ Istio Wasm API å¤„äº alpha é˜¶æ®µï¼Œå°†åœ¨æœªæ¥çš„ Istio ç‰ˆæœ¬ä¸­å¾—åˆ°å¢å¼ºå’Œç¨³å®šã€‚è¿™åŒ…æ‹¬é€šè¿‡éªŒè¯ç­¾åæ¥å®‰å…¨åœ°éªŒè¯ Wasm æ’ä»¶æœ¬èº«ï¼Œæ”¯æŒç”¨å­˜å‚¨ä¸º Kubernetes Secret çš„ç§˜å¯†æ¥æ‹‰å– Wasm æ’ä»¶ç­‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿›ä¸€æ­¥é˜…è¯»å’Œè¡¥å……èµ„æº&#34;&gt;è¿›ä¸€æ­¥é˜…è¯»å’Œè¡¥å……èµ„æº&lt;/h2&gt;
&lt;p&gt;åœ¨ Tetrateï¼Œæˆ‘ä»¬æ­£åœ¨åŠªåŠ›æ”¹å–„å¼€å‘è€…çš„ä½“éªŒï¼Œ&lt;a href=&#34;https://github.com/tetratelabs/proxy-wasm-go-sdk/tree/main/examples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tetratelabs/proxy-wasm-golang-sdk&lt;/a&gt; åŒ…å«æœ¬æ•™ç¨‹ä½¿ç”¨çš„ Golang SDK åº“ã€‚ä½ å¯ä»¥æ‰¾åˆ°æ›´å¤šçš„ä¾‹å­ï¼Œå¦‚ http &lt;a href=&#34;https://github.com/tetratelabs/proxy-wasm-go-sdk/blob/main/examples/http_routing/main.go#L70-L80&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤´çš„æ“ä½œ&lt;/a&gt;ã€æ ·ä¾‹&lt;a href=&#34;https://github.com/tetratelabs/proxy-wasm-go-sdk/tree/main/examples/http_auth_random&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆæƒ&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/tetratelabs/proxy-wasm-go-sdk/tree/main/examples/http_routing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ”¹å˜è·¯ç”±&lt;/a&gt;è¡Œä¸ºç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.tetratelabs.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Istio Distro&lt;/a&gt; æ˜¯å®‰è£…ã€æ“ä½œå’Œå‡çº§ Istio çš„æœ€ç®€å•æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.tetrate.io/istio-wasm-workshop/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŠ¥åå‚åŠ  Tetrate çš„ Istio Wasm æ’ä»¶ç ”è®¨ä¼šï¼Œå‘ Istio ä¸­çš„ Wasm æ’ä»¶çš„åˆ›é€ è€…å­¦ä¹ &lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åŸºäº gRPC å’Œ Istio çš„æ—  sidecar ä»£ç†çš„æœåŠ¡ç½‘æ ¼</title>
      <link>https://cloudnativecn.com/blog/grpc-proxyless-service-mesh/</link>
      <pubDate>Tue, 23 Nov 2021 10:03:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/grpc-proxyless-service-mesh/</guid>
      <description>&lt;p&gt;è¯‘è€…æ³¨ï¼šæœ¬æ–‡è¯‘è‡ª Istio å®˜æ–¹åšå®¢ï¼Œåšå®¢åŸæ ‡é¢˜ &lt;a href=&#34;https://istio.io/latest/blog/2021/proxyless-grpc/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC Proxyless Service Mesh&lt;/a&gt;ï¼Œå…¶å®æ˜¯ Istio 1.11 ç‰ˆæœ¬ä¸­æ”¯æŒçš„å®éªŒç‰¹æ€§ï¼Œå¯ä»¥ç›´æ¥å°† gRPC æœåŠ¡æ·»åŠ åˆ° Istio ä¸­ï¼Œè€Œä¸éœ€è¦å†å‘ Pod ä¸­æ³¨å…¥ Envoy ä»£ç†ã€‚æœ¬æ–‡ä¸­è¿˜ç»™å‡ºäº†ä¸€ä¸ª Demo æ€§èƒ½æµ‹è¯•æ•°æ®ï¼Œè¿™ç§åšæ³•å¯ä»¥æå¤§çš„æå‡åº”ç”¨æ€§èƒ½ï¼Œé™ä½ç½‘ç»œå»¶è¿Ÿã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Istio ä½¿ç”¨ä¸€ç»„å‘ç° APIï¼ˆç»Ÿç§°ä¸º &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/dynamic_configuration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS API&lt;/a&gt; æ¥åŠ¨æ€é…ç½®å…¶ Envoy sidecar ä»£ç†ã€‚è¿™äº› API çš„ç›®æ ‡æ˜¯æˆä¸ºä¸€ä¸ª &lt;a href=&#34;https://blog.envoyproxy.io/the-universal-data-plane-api-d15cec7a?gi=64aa2eea0283&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€šç”¨çš„æ•°æ®å¹³é¢ API&lt;/a&gt;ã€‚gRPC é¡¹ç›®å¯¹ xDS API æœ‰å¾ˆå¥½çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥ç®¡ç† gRPC å·¥ä½œè´Ÿè½½ï¼Œè€Œä¸éœ€è¦åŒæ—¶éƒ¨ç½² Envoy sidecarã€‚ä½ å¯ä»¥åœ¨ &lt;a href=&#34;https://www.youtube.com/watch?v=cGJXkZ7jiDk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Megan Yahya çš„ KubeCon EU 2021 æ¼”è®²&lt;/a&gt;ä¸­äº†è§£æ›´å¤šå…³äºè¯¥é›†æˆçš„ä¿¡æ¯ã€‚å…³äº gRPC æ”¯æŒçš„æœ€æ–°æƒ…å†µï¼Œå¯ä»¥åœ¨ä»–ä»¬çš„&lt;a href=&#34;https://github.com/grpc/proposal/search?q=xds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ææ¡ˆ&lt;/a&gt;ä¸­æ‰¾åˆ°ï¼Œè¿˜æœ‰å®ç°çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;Istio 1.11 å¢åŠ äº†å®éªŒæ€§æ”¯æŒï¼Œå¯ä»¥ç›´æ¥å°† gRPC æœåŠ¡æ·»åŠ åˆ°ç½‘æ ¼ä¸­ã€‚æˆ‘ä»¬æ”¯æŒåŸºæœ¬çš„æœåŠ¡å‘ç°ï¼Œä¸€äº›åŸºäº VirtualService çš„æµé‡ç­–ç•¥ï¼Œä»¥åŠåŒå‘ TLSã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ”¯æŒçš„åŠŸèƒ½&#34;&gt;æ”¯æŒçš„åŠŸèƒ½&lt;/h2&gt;
&lt;p&gt;ä¸ Envoy ç›¸æ¯”ï¼Œç›®å‰ gRPC å†…çš„ xDS API çš„å®ç°åœ¨æŸäº›æ–¹é¢æ˜¯æœ‰é™çš„ã€‚ä»¥ä¸‹åŠŸèƒ½åº”è¯¥å¯ä»¥ä½¿ç”¨ï¼Œå°½ç®¡è¿™ä¸æ˜¯ä¸€ä¸ªè¯¦å°½çš„åˆ—è¡¨ï¼Œå…¶ä»–åŠŸèƒ½å¯èƒ½éƒ¨åˆ†å¯ç”¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸºæœ¬çš„æœåŠ¡å‘ç°ã€‚ä½ çš„ gRPC æœåŠ¡å¯ä»¥æ¥è§¦åˆ°åœ¨ç½‘æ ¼ä¸­æ³¨å†Œçš„å…¶ä»– pod å’Œè™šæ‹Ÿæœºã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DestinationRule&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Subset&lt;/code&gt;ï¼šä½ çš„ gRPC æœåŠ¡å¯ä»¥æ ¹æ®æ ‡ç­¾é€‰æ‹©å™¨å°†æµé‡åˆ†å‰²åˆ°ä¸åŒçš„å®ä¾‹ç»„ã€‚&lt;/li&gt;
&lt;li&gt;ç›®å‰å”¯ä¸€æ”¯æŒçš„ Istio &lt;code&gt;loadBalancer&lt;/code&gt; æ˜¯ &lt;code&gt;ROUND_ROBIN&lt;/code&gt;ï¼Œ&lt;code&gt;consistentHash&lt;/code&gt; å°†åœ¨æœªæ¥çš„ Istio ç‰ˆæœ¬ä¸­åŠ å…¥ï¼ˆæ”¯æŒ gRPCï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tls&lt;/code&gt; è®¾ç½®è¢«é™åˆ¶ä¸º &lt;code&gt;DISABLE&lt;/code&gt; æˆ– &lt;code&gt;ISTIO_MUTUAL&lt;/code&gt;ã€‚å…¶ä»–æ¨¡å¼å°†è¢«è§†ä¸º &lt;code&gt;DISABLE&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;VirtualService&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;Header åŒ¹é…å’Œ URI åŒ¹é…çš„æ ¼å¼ä¸º &lt;code&gt;/ServiceName/RPCName&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è¦†ç›–ç›®æ ‡ä¸»æœºå’Œå­é›†ã€‚&lt;/li&gt;
&lt;li&gt;åŠ æƒçš„æµé‡è½¬ç§»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PeerAuthentication&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;åªæ”¯æŒ &lt;code&gt;DISABLE&lt;/code&gt; å’Œ &lt;code&gt;STRICT&lt;/code&gt;ã€‚å…¶ä»–æ¨¡å¼å°†è¢«è§†ä¸º &lt;code&gt;DISABLE&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šæœ‰å¯¹ auto-mTLS çš„æ”¯æŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä»–åŠŸèƒ½åŒ…æ‹¬æ•…éšœã€é‡è¯•ã€è¶…æ—¶ã€é•œåƒå’Œé‡å†™è§„åˆ™ï¼Œå¯èƒ½ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­æ”¯æŒã€‚å…¶ä¸­ä¸€äº›åŠŸèƒ½æ­£ç­‰å¾…åœ¨ gRPC ä¸­å®ç°ï¼Œè€Œå…¶ä»–åŠŸèƒ½åˆ™éœ€è¦åœ¨ Istio ä¸­æ”¯æŒã€‚gRPC ä¸­ xDS åŠŸèƒ½çš„çŠ¶æ€å¯ä»¥&lt;a href=&#34;https://github.com/grpc/grpc/blob/master/doc/grpc_xds_features.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ°ã€‚Istio çš„æ”¯æŒçŠ¶å†µå°†å­˜åœ¨äºæœªæ¥çš„å®˜æ–¹æ–‡æ¡£ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªåŠŸèƒ½æ˜¯&lt;a href=&#34;https://istio.io/latest/docs/releases/feature-stages/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®éªŒæ€§çš„&lt;/a&gt;ã€‚æ ‡å‡†çš„ Istio åŠŸèƒ½å°†éšç€æ—¶é—´çš„æ¨ç§»å’Œæ•´ä½“è®¾è®¡çš„æ”¹è¿›è€Œå¾—åˆ°æ”¯æŒã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¶æ„æ¦‚è¿°&#34;&gt;æ¶æ„æ¦‚è¿°&lt;/h2&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-grpc-æœåŠ¡å¦‚ä½•ä¸-istiod-é€šä¿¡çš„ç¤ºæ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;gRPC æœåŠ¡å¦‚ä½•ä¸ istiod é€šä¿¡çš„ç¤ºæ„å›¾&#34; srcset=&#34;
               /blog/grpc-proxyless-service-mesh/008i3skNly1gwp3lh9za5j311q0hm75n_hu_bad1c605b3c1ab77.webp 400w,
               /blog/grpc-proxyless-service-mesh/008i3skNly1gwp3lh9za5j311q0hm75n_hu_f8dd413ad1614a3.webp 760w,
               /blog/grpc-proxyless-service-mesh/008i3skNly1gwp3lh9za5j311q0hm75n_hu_be6fe522ce6cf36.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/grpc-proxyless-service-mesh/008i3skNly1gwp3lh9za5j311q0hm75n_hu_bad1c605b3c1ab77.webp&#34;
               width=&#34;760&#34;
               height=&#34;355&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      gRPC æœåŠ¡å¦‚ä½•ä¸ istiod é€šä¿¡çš„ç¤ºæ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;gRPC æœåŠ¡å¦‚ä½•ä¸ istiod é€šä¿¡çš„ç¤ºæ„å›¾&lt;/p&gt;
&lt;p&gt;è™½ç„¶ä¸ä½¿ç”¨ proxy è¿›è¡Œæ•°æ®é¢é€šä¿¡ï¼Œä½†å®ƒä»ç„¶éœ€è¦ä¸€ä¸ª agent æ¥è¿›è¡Œåˆå§‹åŒ–å’Œä¸æ§åˆ¶é¢çš„é€šä¿¡ã€‚é¦–å…ˆï¼Œagent åœ¨å¯åŠ¨æ—¶ç”Ÿæˆä¸€ä¸ª&lt;a href=&#34;https://github.com/grpc/proposal/blob/master/A27-xds-global-load-balancing.md#xdsclient-and-bootstrap-file&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼•å¯¼æ–‡ä»¶&lt;/a&gt;ï¼Œä¸ä¸º Envoy ç”Ÿæˆå¼•å¯¼æ–‡ä»¶çš„æ–¹å¼ç›¸åŒã€‚è¿™å‘Šè¯‰ gRPC åº“å¦‚ä½•è¿æ¥åˆ° istiodï¼Œåœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°æ•°æ®é¢é€šä¿¡çš„è¯ä¹¦ï¼Œä»¥åŠå‘æ§åˆ¶é¢å‘é€ä»€ä¹ˆå…ƒæ•°æ®ã€‚æ¥ä¸‹æ¥ï¼Œagent ä½œä¸ºä¸€ä¸ª xDS proxyï¼Œä»£è¡¨åº”ç”¨ç¨‹åºä¸ istiod è¿›è¡Œè¿æ¥å’Œè®¤è¯ã€‚æœ€åï¼Œagent è·å–å¹¶è½®æ¢æ•°æ®å¹³é¢é€šä¿¡ä¸­ä½¿ç”¨çš„è¯ä¹¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯¹åº”ç”¨ç¨‹åºä»£ç çš„ä¿®æ”¹&#34;&gt;å¯¹åº”ç”¨ç¨‹åºä»£ç çš„ä¿®æ”¹&lt;/h2&gt;
&lt;p&gt;æœ¬èŠ‚ä»‹ç»äº† gRPC åœ¨ Go ä¸­çš„ xDS æ”¯æŒã€‚å…¶ä»–è¯­è¨€ä¹Ÿæœ‰ç±»ä¼¼çš„ APIã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¯ç”¨ gRPC ä¸­çš„ xDS åŠŸèƒ½ï¼Œä½ çš„åº”ç”¨ç¨‹åºå¿…é¡»åšä¸€äº›å¿…è¦çš„ä¿®æ”¹ã€‚ä½ çš„ gRPC ç‰ˆæœ¬åº”è¯¥è‡³å°‘æ˜¯ 1.39.0ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®¢æˆ·ç«¯&#34;&gt;å®¢æˆ·ç«¯&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢çš„å¯¼å…¥å°†åœ¨ gRPC ä¸­æ³¨å†Œ xDS è§£æå™¨å’Œå‡è¡¡å™¨ã€‚å®ƒåº”è¯¥è¢«æ·»åŠ åˆ°ä½ çš„ä¸»åŒ…æˆ–è°ƒç”¨ &lt;code&gt;grpc.Dial&lt;/code&gt; çš„åŒä¸€ä¸ªåŒ…ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;google.golang.org/grpc/xds&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“åˆ›å»ºä¸€ä¸ª gRPC è¿æ¥æ—¶ï¼ŒURL å¿…é¡»ä½¿ç”¨ &lt;code&gt;xds:///&lt;/code&gt; schemeã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;DialContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;xds:///foo.ns.svc.cluster.local:7070&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤å¤–ï¼Œä¸ºäº†æ”¯æŒï¼ˆmï¼‰TLSï¼Œå¿…é¡»å‘ &lt;code&gt;DialContext&lt;/code&gt; ä¼ é€’ä¸€ä¸ªç‰¹æ®Šçš„ &lt;code&gt;TransportCredentials&lt;/code&gt; é€‰é¡¹ã€‚&lt;code&gt;FallbackCreds&lt;/code&gt; å…è®¸æˆ‘ä»¬åœ¨ istiod ä¸å‘é€å®‰å…¨é…ç½®æ—¶æˆåŠŸã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;google.golang.org/grpc/credentials/xds&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;creds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;xds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewClientCredentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;xds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ClientOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;FallbackCreds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;insecure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewCredentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// handle err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;DialContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;xds:///foo.ns.svc.cluster.local:7070&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithTransportCredentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;creds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æœåŠ¡ç«¯&#34;&gt;æœåŠ¡ç«¯&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†æ”¯æŒæœåŠ¡å™¨ç«¯çš„é…ç½®ï¼Œå¦‚ mTLSï¼Œå¿…é¡»åšä¸€äº›ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„æ„é€ å‡½æ•°æ¥åˆ›å»º &lt;code&gt;GRPCServer&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;google.golang.org/grpc/xds&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;xds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewGRPCServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;RegisterFooServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fooServerImpl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœä½ çš„ &lt;code&gt;protoc&lt;/code&gt; ç”Ÿæˆçš„ Go ä»£ç å·²ç»è¿‡æœŸï¼Œä½ å¯èƒ½éœ€è¦é‡æ–°ç”Ÿæˆï¼Œä»¥ä¾¿ä¸ xDS æœåŠ¡å™¨å…¼å®¹ã€‚ä½ ç”Ÿæˆçš„ &lt;code&gt;RegisterFooServer&lt;/code&gt; å‡½æ•°åº”è¯¥åƒä¸‹é¢è¿™æ ·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;RegisterFooServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ServiceRegistrar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;srv&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;FooServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterService&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;FooServer_ServiceDesc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;srv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åï¼Œä¸å®¢æˆ·ç«¯çš„å˜åŒ–ä¸€æ ·ï¼Œæˆ‘ä»¬å¿…é¡»å¯ç”¨å®‰å…¨æ”¯æŒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;creds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;xds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewServerCredentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;xdscreds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ServerOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;FallbackCreds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;insecure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewCredentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// handle err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;xds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewGRPCServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Creds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;creds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åœ¨ä½ çš„-kubernetes-éƒ¨ç½²ä¸­&#34;&gt;åœ¨ä½ çš„ Kubernetes éƒ¨ç½²ä¸­&lt;/h3&gt;
&lt;p&gt;å‡è®¾ä½ çš„åº”ç”¨ä»£ç æ˜¯å…¼å®¹çš„ï¼ŒPod åªéœ€è¦æ³¨é‡Š &lt;code&gt;inject.istio.io/templatesï¼šgrpc-agent&lt;/code&gt;ã€‚è¿™å¢åŠ äº†ä¸€ä¸ªè¿è¡Œä¸Šè¿°ä»£ç†çš„ sidecar å®¹å™¨ï¼Œä»¥åŠä¸€äº›ç¯å¢ƒå˜é‡ï¼ŒgRPC ä½¿ç”¨è¿™äº›å˜é‡æ¥å¯»æ‰¾å¼•å¯¼æ–‡ä»¶å¹¶å¯ç”¨æŸäº›åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº gRPC æœåŠ¡ç«¯ï¼Œä½ çš„ Pod ä¹Ÿåº”è¯¥ç”¨ &lt;code&gt;proxy.istio.io/config: &#39;{&amp;quot;holdApplicationUntilProxyStarts&amp;quot;: true}&#39;&lt;/code&gt; æ¥æ³¨é‡Šï¼Œä»¥ç¡®ä¿åœ¨ä½ çš„ gRPC æœåŠ¡ç«¯åˆå§‹åŒ–ä¹‹å‰ï¼Œä»£ç†ä¸­çš„ xDS ä»£ç†å’Œå¼•å¯¼æ–‡ä»¶å·²ç»å‡†å¤‡å°±ç»ªã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¾‹å­&#34;&gt;ä¾‹å­&lt;/h2&gt;
&lt;p&gt;åœ¨æœ¬æŒ‡å—ä¸­ï¼Œä½ å°†éƒ¨ç½² echoï¼Œä¸€ä¸ªå·²ç»æ”¯æŒæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯æ— ä»£ç†çš„ gRPC çš„åº”ç”¨ã€‚é€šè¿‡è¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥å°è¯•ä¸€äº›æ”¯æŒçš„æµé‡ç­–ç•¥ï¼Œå¯ç”¨ mTLSã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…ˆå†³æ¡ä»¶&#34;&gt;å…ˆå†³æ¡ä»¶&lt;/h3&gt;
&lt;p&gt;æœ¬æŒ‡å—è¦æ±‚åœ¨è¿›è¡Œä¹‹å‰&lt;a href=&#34;https://istio.io/latest/docs/setup/install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£…&lt;/a&gt; Istioï¼ˆ1.11+ï¼‰æ§åˆ¶å¹³é¢ã€‚&lt;/p&gt;
&lt;h3 id=&#34;éƒ¨ç½²åº”ç”¨ç¨‹åº&#34;&gt;éƒ¨ç½²åº”ç”¨ç¨‹åº&lt;/h3&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªæ”¯æŒæ³¨å…¥çš„å‘½åç©ºé—´ &lt;code&gt;echo-grpc&lt;/code&gt;ã€‚æ¥ä¸‹æ¥éƒ¨ç½²ä¸¤ä¸ª &lt;code&gt;echo&lt;/code&gt; åº”ç”¨ç¨‹åºçš„å®ä¾‹ä»¥åŠæœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl create namespace echo-grpc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl label namespace echo-grpc istio-injection&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;enabled
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n echo-grpc apply -f samples/grpc-echo/grpc-echo.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¡®ä¿ä¸¤ä¸ª Pod æ­£åœ¨è¿è¡Œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n echo-grpc get pods
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                       READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;echo-v1-69d6d96cb7-gpcpd   2/2     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          58s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;echo-v2-5c6cbf6dc7-dfhcb   2/2     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          58s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æµ‹è¯•-grpc-è§£æå™¨&#34;&gt;æµ‹è¯• gRPC è§£æå™¨&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆï¼Œå°† 17171 ç«¯å£è½¬å‘åˆ°å…¶ä¸­ä¸€ä¸ª Pod ä¸Šã€‚è¿™ä¸ªç«¯å£æ˜¯ä¸€ä¸ªé xDS æ”¯æŒçš„ gRPC æœåŠ¡ç«¯ï¼Œå…è®¸ä»ç«¯å£è½¬å‘çš„ Pod å‘å‡ºè¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n echo-grpc port-forward &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl -n echo-grpc get pods -l &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1 -ojsonpath&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;17171&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å‘é€ä¸€æ‰¹ 5 ä¸ªè¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ grpcurl -plaintext -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;url&amp;#34;: &amp;#34;xds:///echo.echo-grpc.svc.cluster.local:7070&amp;#34;, &amp;#34;count&amp;#34;: 5}&amp;#39;&lt;/span&gt; :17171 proto.EchoTestService/ForwardEcho &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;s1&#34;&gt;&amp;#39;.output | join(&amp;#34;&amp;#34;)&amp;#39;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep Hostname
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Handling connection &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;17171&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v1-7cf5b76586-bgn6t
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v2-cf97bd94d-qf628
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v1-7cf5b76586-bgn6t
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v2-cf97bd94d-qf628
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v1-7cf5b76586-bgn6t
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼ Kubernetes åç§°è§£æçš„çŸ­åç§°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ grpcurl -plaintext -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;url&amp;#34;: &amp;#34;xds:///echo:7070&amp;#34;}&amp;#39;&lt;/span&gt; :17171 proto.EchoTestService/ForwardEcho &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;s1&#34;&gt;&amp;#39;.output | join
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;(&amp;#34;&amp;#34;)&amp;#39;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep Hostname
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v1-7cf5b76586-ltr8q
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ grpcurl -plaintext -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;url&amp;#34;: &amp;#34;xds:///echo.echo-grpc:7070&amp;#34;}&amp;#39;&lt;/span&gt; :17171 proto.EchoTestService/ForwardEcho &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;.output | join(&amp;#34;&amp;#34;)&amp;#39;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep Hostname
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v1-7cf5b76586-ltr8q
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ grpcurl -plaintext -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;url&amp;#34;: &amp;#34;xds:///echo.echo-grpc.svc:7070&amp;#34;}&amp;#39;&lt;/span&gt; :17171 proto.EchoTestService/ForwardEcho &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;.output | join(&amp;#34;&amp;#34;)&amp;#39;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep Hostname
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v2-cf97bd94d-jt5mf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç”¨ç›®çš„åœ°è§„åˆ™åˆ›å»ºå­é›†&#34;&gt;ç”¨ç›®çš„åœ°è§„åˆ™åˆ›å»ºå­é›†&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆï¼Œä¸ºæ¯ä¸ªç‰ˆæœ¬çš„å·¥ä½œè´Ÿè½½åˆ›å»ºä¸€ä¸ªå­é›†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: networking.istio.io/v1alpha3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: DestinationRule
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: echo-versions
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: echo-grpc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  host: echo.echo-grpc.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  subsets:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - name: v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    labels:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      version: v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - name: v2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    labels:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      version: v2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æµé‡è½¬ç§»&#34;&gt;æµé‡è½¬ç§»&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„å­é›†ï¼Œä½ å¯ä»¥æŠŠ 80% çš„æµé‡å‘é€åˆ°ä¸€ä¸ªç‰¹å®šçš„ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: networking.istio.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: VirtualService
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: echo-weights
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: echo-grpc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  hosts:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - echo.echo-grpc.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  http:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - route:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - destination:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        host: echo.echo-grpc.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        subset: v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      weight: 20
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - destination:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        host: echo.echo-grpc.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        subset: v2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      weight: 80
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œå‘é€ä¸€ç»„ 10 ä¸ªè¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpcurl -plaintext -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;url&amp;#34;: &amp;#34;xds:///echo.echo-grpc.svc.cluster.local:7070&amp;#34;, &amp;#34;count&amp;#34;: 10}&amp;#39;&lt;/span&gt; :17171 proto.EchoTestService/ForwardEcho &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;s1&#34;&gt;&amp;#39;.output | join(&amp;#34;&amp;#34;)&amp;#39;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep ServiceVersion
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å“åº”åº”ä¸»è¦åŒ…å« v2 å“åº”ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[0 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[1 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2 body] ServiceVersion=v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[3 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[4 body] ServiceVersion=v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[5 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[6 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[7 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[8 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[9 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¯ç”¨-mtls&#34;&gt;å¯ç”¨ mTLS&lt;/h3&gt;
&lt;p&gt;ç”±äºåœ¨ gRPC ä¸­å¯ç”¨å®‰å…¨æ‰€éœ€çš„åº”ç”¨ç¨‹åºæœ¬èº«çš„å˜åŒ–ï¼ŒIstio çš„è‡ªåŠ¨æ£€æµ‹ mTLS æ”¯æŒçš„ä¼ ç»Ÿæ–¹æ³•æ˜¯ä¸å¯é çš„ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œåˆå§‹ç‰ˆæœ¬éœ€è¦åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸Šæ˜ç¡®å¯ç”¨ mTLSã€‚&lt;/p&gt;
&lt;p&gt;è¦å¯ç”¨å®¢æˆ·ç«¯çš„ mTLSï¼Œè¯·åº”ç”¨å¸¦æœ‰ &lt;code&gt;tls&lt;/code&gt; è®¾ç½®çš„ &lt;code&gt;DestinationRule&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: networking.istio.io/v1alpha3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: DestinationRule
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: echo-mtls
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: echo-grpc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  host: echo.echo-grpc.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  trafficPolicy:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    tls:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      mode: ISTIO_MUTUAL
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œè¯•å›¾è°ƒç”¨å°šæœªé…ç½® mTLS çš„æœåŠ¡å™¨å°†ä¼šå¤±è´¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ grpcurl -plaintext -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;url&amp;#34;: &amp;#34;xds:///echo.echo-grpc.svc.cluster.local:7070&amp;#34;}&amp;#39;&lt;/span&gt; :17171 proto.EchoTestService/ForwardEcho &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;s1&#34;&gt;&amp;#39;.output | join(&amp;#34;&amp;#34;)&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Handling connection &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;17171&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ERROR:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Code: Unknown
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Message: 1/1 requests had errors&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; first error: rpc error: &lt;span class=&#34;nv&#34;&gt;code&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; Unavailable &lt;span class=&#34;nv&#34;&gt;desc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; all SubConns are in TransientFailure
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†å¯ç”¨æœåŠ¡å™¨ç«¯çš„ mTLSï¼Œåº”ç”¨ä¸€ä¸ª &lt;code&gt;PeerAuthentication&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹ç­–ç•¥å¯¹æ•´ä¸ªå‘½åç©ºé—´å¼ºåˆ¶é‡‡ç”¨ STRICT mTLSã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: security.istio.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: PeerAuthentication
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: echo-mtls
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: echo-grpc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  mtls:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    mode: STRICT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”ç”¨è¯¥æ”¿ç­–åï¼Œè¯·æ±‚å°†å¼€å§‹æˆåŠŸã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ grpcurl -plaintext -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;url&amp;#34;: &amp;#34;xds:///echo.echo-grpc.svc.cluster.local:7070&amp;#34;}&amp;#39;&lt;/span&gt; :17171 proto.EchoTestService/ForwardEcho &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;s1&#34;&gt;&amp;#39;.output | join(&amp;#34;&amp;#34;)&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Handling connection &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;17171&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; grpcecho.Echo&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;xds:///echo.echo-grpc.svc.cluster.local:7070 map&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;  5s &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; x-request-id&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Host&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo.echo-grpc.svc.cluster.local:7070
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; content-type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;application/grpc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; user-agent&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;grpc-go/1.39.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;StatusCode&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;ServiceVersion&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;ServicePort&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;17070&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Cluster&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;IP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.68.1.18
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;IstioVersion&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Echo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v1-7cf5b76586-z5p8l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;é™åˆ¶æ¡ä»¶&#34;&gt;é™åˆ¶æ¡ä»¶&lt;/h2&gt;
&lt;p&gt;æœ€åˆçš„ç‰ˆæœ¬æœ‰å‡ ä¸ªé™åˆ¶ï¼Œå¯èƒ½ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ä¿®å¤ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸æ”¯æŒè‡ªåŠ¨ mTLSï¼Œä¹Ÿä¸æ”¯æŒè®¸å¯æ¨¡å¼ã€‚ç›¸åï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨ &lt;code&gt;STRICT&lt;/code&gt;ï¼Œåœ¨å®¢æˆ·ç«¯ä½¿ç”¨ &lt;code&gt;ISTIO_MUTUAL&lt;/code&gt; çš„æ˜ç¡® mTLS é…ç½®ã€‚åœ¨è¿ç§»åˆ° &lt;code&gt;STRICT&lt;/code&gt; çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Envoyã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;grpc.Serve(listener)&lt;/code&gt; æˆ– &lt;code&gt;grpc.Dial(&amp;quot;xds://...&amp;quot;)&lt;/code&gt; åœ¨ bootstrap è¢«å†™å…¥æˆ– xDS ä»£ç†å‡†å¤‡å¥½ä¹‹å‰è¢«è°ƒç”¨ä¼šå¯¼è‡´å¤±è´¥ã€‚ &lt;code&gt;holdApplicationUntilProxyStarts&lt;/code&gt; å¯ä»¥ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ–è€…åº”ç”¨ç¨‹åºå¯ä»¥å¯¹è¿™äº›å¤±è´¥æ›´åŠ ç¨³å¥ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ”¯æŒ xDS çš„ gRPC æœåŠ¡å™¨ä½¿ç”¨ mTLSï¼Œé‚£ä¹ˆä½ å°†éœ€è¦ç¡®ä¿ä½ çš„å¥åº·æ£€æŸ¥å¯ä»¥ç»•è¿‡è¿™ä¸ªé—®é¢˜ã€‚è¦ä¹ˆä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„ç«¯å£ï¼Œè¦ä¹ˆä½ çš„å¥åº·æ£€æŸ¥å®¢æˆ·ç«¯éœ€è¦ä¸€ç§æ–¹æ³•æ¥è·å¾—é€‚å½“çš„å®¢æˆ·ç«¯è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;gRPC ä¸­ xDS çš„å®ç°ä¸ Envoy ä¸ä¸€è‡´ã€‚æŸäº›è¡Œä¸ºå¯èƒ½ä¸åŒï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½ç¼ºå¤±ã€‚&lt;a href=&#34;https://github.com/grpc/grpc/blob/master/doc/grpc_xds_features.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC çš„åŠŸèƒ½çŠ¶æ€&lt;/a&gt;æä¾›äº†æ›´å¤šç»†èŠ‚ã€‚è¯·ç¡®ä¿æµ‹è¯•ä»»ä½• Istio é…ç½®æ˜¯å¦çœŸæ­£é€‚ç”¨äºä½ çš„æ— ä»£ç†çš„ gRPC åº”ç”¨ç¨‹åºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ€§èƒ½&#34;&gt;æ€§èƒ½&lt;/h2&gt;
&lt;h3 id=&#34;å®éªŒè®¾ç½®&#34;&gt;å®éªŒè®¾ç½®&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ Fortioï¼Œä¸€ä¸ªåŸºäº Go çš„è´Ÿè½½æµ‹è¯•åº”ç”¨ç¨‹åº
&lt;ul&gt;
&lt;li&gt;ç¨ä½œä¿®æ”¹ï¼Œä»¥æ”¯æŒ gRPC çš„ XDS åŠŸèƒ½ (PR)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;èµ„æºï¼š
&lt;ul&gt;
&lt;li&gt;GKE 1.20 é›†ç¾¤æœ‰ 3 ä¸ª &lt;code&gt;e2-standard-16&lt;/code&gt; èŠ‚ç‚¹ï¼ˆæ¯ä¸ªèŠ‚ç‚¹æœ‰ 16 ä¸ª CPU+64GB å†…å­˜ï¼‰&lt;/li&gt;
&lt;li&gt;Fortio å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼š1.5 vCPUï¼Œ1000 MiB å†…å­˜&lt;/li&gt;
&lt;li&gt;Sidecarï¼ˆistio-agent å’Œå¯èƒ½çš„ Envoy ä»£ç†ï¼‰ï¼š1 vCPUï¼Œ512 MiB å†…å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æµ‹è¯•çš„å·¥ä½œè´Ÿè½½ç±»å‹ï¼š
&lt;ul&gt;
&lt;li&gt;åŸºçº¿ï¼šå¸¸è§„çš„ gRPCï¼Œæ²¡æœ‰ä½¿ç”¨ Envoy ä»£ç†æˆ– Proxyless xDS&lt;/li&gt;
&lt;li&gt;Envoyï¼šæ ‡å‡†çš„ istio-agent + Envoy proxy sidecar&lt;/li&gt;
&lt;li&gt;æ— ä»£ç†ï¼šä½¿ç”¨ xDS gRPC æœåŠ¡å™¨å®ç°çš„ gRPC å’Œå®¢æˆ·ç«¯çš„ &lt;code&gt;xds:///&lt;/code&gt; è§£æå™¨ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;PeerAuthentication&lt;/code&gt; å’Œ &lt;code&gt;DestinationRule&lt;/code&gt; å¯ç”¨ / åœç”¨ mTLS&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å»¶è¿Ÿ&#34;&gt;å»¶è¿Ÿ&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-p50-å»¶è¿Ÿå¯¹æ¯”å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;P50 å»¶è¿Ÿå¯¹æ¯”å›¾&#34; srcset=&#34;
               /blog/grpc-proxyless-service-mesh/008i3skNly1gwp512szlvj31260rgq57_hu_f6772119b428980a.webp 400w,
               /blog/grpc-proxyless-service-mesh/008i3skNly1gwp512szlvj31260rgq57_hu_32d176f170890c36.webp 760w,
               /blog/grpc-proxyless-service-mesh/008i3skNly1gwp512szlvj31260rgq57_hu_542bca03df8732dd.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/grpc-proxyless-service-mesh/008i3skNly1gwp512szlvj31260rgq57_hu_f6772119b428980a.webp&#34;
               width=&#34;760&#34;
               height=&#34;546&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      P50 å»¶è¿Ÿå¯¹æ¯”å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;P50 å»¶è¿Ÿå¯¹æ¯”å›¾&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-p99-å»¶è¿Ÿå¯¹æ¯”å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;P99 å»¶è¿Ÿå¯¹æ¯”å›¾&#34; srcset=&#34;
               /blog/grpc-proxyless-service-mesh/008i3skNly1gwp51zjxqaj312q0r2jtl_hu_5ba4a27e38d4c044.webp 400w,
               /blog/grpc-proxyless-service-mesh/008i3skNly1gwp51zjxqaj312q0r2jtl_hu_3d11fab2f7eb88e1.webp 760w,
               /blog/grpc-proxyless-service-mesh/008i3skNly1gwp51zjxqaj312q0r2jtl_hu_6054b2903ae56c60.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/grpc-proxyless-service-mesh/008i3skNly1gwp51zjxqaj312q0r2jtl_hu_5ba4a27e38d4c044.webp&#34;
               width=&#34;760&#34;
               height=&#34;531&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      P99 å»¶è¿Ÿå¯¹æ¯”å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;P99 å»¶è¿Ÿå¯¹æ¯”å›¾&lt;/p&gt;
&lt;p&gt;åœ¨ä½¿ç”¨æ— ä»£ç†çš„ gRPC è§£æå™¨æ—¶ï¼Œå»¶è¿Ÿä¼šæœ‰å¾®å°çš„å¢åŠ ã€‚ä¸ Envoy ç›¸æ¯”ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„æ”¹è¿›ï¼Œä»ç„¶å¯ä»¥å®ç°å…ˆè¿›çš„æµé‡ç®¡ç†åŠŸèƒ½å’Œ mTLSã€‚&lt;/p&gt;
&lt;h3 id=&#34;istio-proxy-å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µ&#34;&gt;istio-proxy å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µ&lt;/h3&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;ç±»åˆ«&lt;/th&gt;
          &lt;th&gt;å®¢æˆ·ç«¯ &lt;code&gt;mCPU&lt;/code&gt;&lt;/th&gt;
          &lt;th&gt;å®¢æˆ·ç«¯å†…å­˜ (&lt;code&gt;MiB&lt;/code&gt;)&lt;/th&gt;
          &lt;th&gt;æœåŠ¡ç«¯ &lt;code&gt;mCPU&lt;/code&gt;&lt;/th&gt;
          &lt;th&gt;æœåŠ¡ç«¯å†…å­˜ (&lt;code&gt;MiB&lt;/code&gt;)&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Envoy æ˜æ–‡&lt;/td&gt;
          &lt;td&gt;320.44&lt;/td&gt;
          &lt;td&gt;66.93&lt;/td&gt;
          &lt;td&gt;243.78&lt;/td&gt;
          &lt;td&gt;64.91&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Envoy mTLS&lt;/td&gt;
          &lt;td&gt;340.87&lt;/td&gt;
          &lt;td&gt;66.76&lt;/td&gt;
          &lt;td&gt;309.82&lt;/td&gt;
          &lt;td&gt;64.82&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ— ä»£ç†æ˜æ–‡&lt;/td&gt;
          &lt;td&gt;0.72&lt;/td&gt;
          &lt;td&gt;23.54&lt;/td&gt;
          &lt;td&gt;0.84&lt;/td&gt;
          &lt;td&gt;24.31&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ— ä»£ç† mTLS&lt;/td&gt;
          &lt;td&gt;0.73&lt;/td&gt;
          &lt;td&gt;25.05&lt;/td&gt;
          &lt;td&gt;0.78&lt;/td&gt;
          &lt;td&gt;25.43&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å°½ç®¡æˆ‘ä»¬ä»ç„¶éœ€è¦ä¸€ä¸ªä»£ç†ï¼Œä½†ä»£ç†ä½¿ç”¨çš„å†…å­˜ä¸åˆ°å®Œæ•´ vCPU çš„ 0.1%ï¼Œè€Œä¸”åªæœ‰ 25 MiBï¼Œè¿™è¿˜ä¸åˆ°è¿è¡Œ Envoy æ‰€éœ€å†…å­˜çš„ä¸€åŠã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›æŒ‡æ ‡ä¸åŒ…æ‹¬åº”ç”¨å®¹å™¨ä¸­ gRPC çš„é¢å¤–èµ„æºä½¿ç”¨é‡ï¼Œä½†æœ‰åŠ©äºå±•ç¤º istio-agent åœ¨æ­¤æ¨¡å¼ä¸‹è¿è¡Œæ—¶çš„èµ„æºä½¿ç”¨å½±å“ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Isto 1.12 å‘å¸ƒâ€”â€”æ”¯æŒ WebAssembly æ’ä»¶ç®¡ç†</title>
      <link>https://cloudnativecn.com/blog/istio-1-12-release/</link>
      <pubDate>Fri, 12 Nov 2021 14:43:27 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-1-12-release/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ª &lt;a href=&#34;https://istio.io/latest/news/releases/1.12.x/announcing-1.12/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜æ–¹åšå®¢&lt;/a&gt;ã€‚è¿™æ˜¯ Istio åœ¨ 2021 å¹´å‘å¸ƒçš„æœ€åä¸€ä¸ªç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯æœ¬å¹´åº¦å‘å¸ƒçš„ç¬¬å››ä¸ªç‰ˆæœ¬ï¼ŒIstio ä¾ç„¶åœ¨æŒ‰ç…§å®ƒæ—¢å®šçš„å‘å¸ƒèŠ‚å¥å‘å±•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;webassembly-api&#34;&gt;WebAssembly API&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/latest/docs/concepts/wasm/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WebAssembly&lt;/a&gt; æ˜¯ä¸€ä¸ªé‡è¦çš„é¡¹ç›®ï¼Œå¼€å‘äº† &lt;a href=&#34;https://istio.io/latest/blog/2020/wasm-announce/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;3 å¹´å¤š&lt;/a&gt;ï¼Œä¸º Istio å¸¦æ¥äº†å…ˆè¿›çš„å¯æ‰©å±•æ€§ï¼Œå…è®¸ç”¨æˆ·åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½è‡ªå®šä¹‰æ„å»ºçš„æ‰©å±•ã€‚ç„¶è€Œï¼Œç›´åˆ°ç°åœ¨ï¼Œé…ç½® WebAssembly æ’ä»¶ä¸€ç›´æ˜¯å®éªŒæ€§çš„ï¼Œè€Œä¸”å¾ˆéš¾ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio 1.12 ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å¢åŠ ä¸€ä¸ª API æ¥é…ç½® WebAssembly æ’ä»¶ â€”â€”&lt;a href=&#34;https://istio.io/latest/docs/reference/config/proxy_extensions/wasm-plugin/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WasmPlugin&lt;/a&gt; æ¥æ”¹å–„è¿™ç§ä½“éªŒã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº† WasmPluginï¼Œä½ å¯ä»¥è½»æ¾åœ°å°†è‡ªå®šä¹‰æ’ä»¶éƒ¨ç½²åˆ°å•ä¸ªä»£ç†ï¼Œç”šè‡³æ˜¯æ•´ä¸ªç½‘æ ¼ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥ API ç›®å‰å¤„äº Alpha é˜¶æ®µï¼Œæ­£åœ¨ä¸æ–­å‘å±•ã€‚æˆ‘ä»¬éå¸¸æ„Ÿè°¢ &lt;a href=&#34;https://istio.io/latest/get-involved/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‚¨çš„åé¦ˆæ„è§&lt;/a&gt; !&lt;/p&gt;
&lt;h2 id=&#34;é¥æµ‹-api&#34;&gt;é¥æµ‹ API&lt;/h2&gt;
&lt;p&gt;åœ¨ Istio 1.11 ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†å…¨æ–°çš„ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/telemetry/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Telemetry API&lt;/a&gt;ï¼Œä¸º Istio ä¸­é…ç½®è¿½è¸ªã€æ—¥å¿—å’ŒæŒ‡æ ‡å¸¦æ¥äº†æ ‡å‡†åŒ–çš„ APIã€‚åœ¨ 1.12 ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬ç»§ç»­æœè¿™ä¸ªæ–¹å‘åŠªåŠ›ï¼Œæ‰©å¤§äº†å¯¹é…ç½®æŒ‡æ ‡å’Œè®¿é—®æ—¥å¿— API çš„æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;è¦æƒ³å¼€å§‹ï¼Œè¯·æŸ¥çœ‹æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/tasks/observability/telemetry/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é¥æµ‹ API æ¦‚è¿°&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/tasks/observability/distributed-tracing/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿½è¸ª&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/tasks/observability/metrics/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Metrics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/tasks/observability/logs/access-log/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¿é—®è®°å½•&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯¥ API ç›®å‰å¤„äº Alpha é˜¶æ®µï¼Œæ­£åœ¨ä¸æ–­å‘å±•ã€‚æˆ‘ä»¬éå¸¸æ„Ÿè°¢ &lt;a href=&#34;https://istio.io/latest/get-involved/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‚¨çš„åé¦ˆæ„è§&lt;/a&gt; !&lt;/p&gt;
&lt;h2 id=&#34;æ”¯æŒ-helm&#34;&gt;æ”¯æŒ Helm&lt;/h2&gt;
&lt;p&gt;Istio 1.12 å¯¹æˆ‘ä»¬çš„ &lt;a href=&#34;https://istio.io/latest/docs/setup/install/helm/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm å®‰è£…æ”¯æŒ&lt;/a&gt; è¿›è¡Œäº†ä¸€äº›æ”¹è¿›ï¼Œå¹¶ä¸ºè¯¥åŠŸèƒ½åœ¨æœªæ¥å‡çº§ä¸ºæµ‹è¯•ç‰ˆé“ºå¹³äº†é“è·¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–ä½¿ç”¨æµç¨‹ï¼Œè§£å†³ &lt;a href=&#34;https://github.com/istio/istio/issues/7505&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ€å—æ¬¢è¿çš„ GitHub åŠŸèƒ½è¯·æ±‚&lt;/a&gt; ä¹‹ä¸€ï¼Œå®˜æ–¹ Helm èµ„æºåº“å·²ç»å‘å¸ƒã€‚è¯·æŸ¥çœ‹æ–°çš„ &lt;a href=&#34;https://istio.io/latest/docs/setup/install/helm/#prerequisites&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¥é—¨&lt;/a&gt; æŒ‡å—ä»¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº› Chart ä¹Ÿå¯ä»¥åœ¨ &lt;a href=&#34;https://artifacthub.io/packages/search?org=istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ArtifactHub&lt;/a&gt; ä¸Šæ‰¾åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œè¿˜å‘å¸ƒäº†ä¸€ä¸ªæ–°çš„ç²¾å¿ƒåˆ¶ä½œçš„ &lt;a href=&#34;https://artifacthub.io/packages/helm/istio-official/gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gateway chart&lt;/a&gt;ã€‚è¯¥ chart å–ä»£äº†æ—§çš„ &lt;code&gt;istio-ingressgateway&lt;/code&gt; å’Œ &lt;code&gt;istio-egressgateway&lt;/code&gt; chartï¼Œå¤§å¤§ç®€åŒ–äº†ç½‘å…³çš„ç®¡ç†ï¼Œå¹¶éµå¾ª Helm æœ€ä½³å®è·µã€‚è¯·è®¿é—®ç½‘å…³æ³¨å…¥é¡µé¢ï¼Œäº†è§£è¿ç§»åˆ°æ–° Helm chart çš„è¯´æ˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-gateway-api&#34;&gt;Kubernetes Gateway API&lt;/h2&gt;
&lt;p&gt;Istio å·²ç»å¢åŠ äº†å¯¹ &lt;a href=&#34;http://gateway-api.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Gateway API&lt;/a&gt; v1alpha2 ç‰ˆæœ¬çš„å…¨é¢æ”¯æŒã€‚è¯¥ API æ—¨åœ¨ç»Ÿä¸€ Istioã€Kubernetes Ingress å’Œå…¶ä»–ä»£ç†ä½¿ç”¨çš„å„ç§ APIï¼Œä»¥å®šä¹‰ä¸€ä¸ªå¼ºå¤§çš„ã€å¯æ‰©å±•çš„ API æ¥é…ç½®æµé‡è·¯ç”±ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶è¯¥ API å°šæœªé’ˆå¯¹ç”Ÿäº§å·¥ä½œè´Ÿè½½ï¼Œä½†è¯¥ API å’Œ Istio çš„å®ç°æ­£åœ¨è¿…é€Ÿå‘å±•ã€‚è¦å°è¯•å®ƒï¼Œè¯·æŸ¥çœ‹ &lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/ingress/gateway-api/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Gateway API&lt;/a&gt; æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ›´å¤š&#34;&gt;æ›´å¤š&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é»˜è®¤é‡è¯•ç­–ç•¥å·²è¢«æ·»åŠ åˆ° &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mesh Config&lt;/a&gt; ä¸­ï¼Œå…è®¸ç”¨æˆ·åœ¨åŒä¸€ä½ç½®é…ç½®é»˜è®¤é‡è¯•ç­–ç•¥ï¼Œè€Œä¸æ˜¯åœ¨æ¯ä¸ª VirtualService ä¸­é‡å¤é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªæ–°çš„ failoverPriority é…ç½®å·²ç»è¢«æ·»åŠ åˆ° &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/destination-rule/#LocalityLoadBalancerSetting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®šä½è´Ÿè½½å‡è¡¡é…ç½®&lt;/a&gt; ä¸­ï¼Œå…è®¸è‡ªå®šä¹‰ pod çš„ä¼˜å…ˆçº§ã€‚ä¾‹å¦‚ï¼ŒåŒä¸€ç½‘ç»œå†…çš„ pod å¯ä»¥è¢«èµ‹äºˆé¢å¤–çš„ä¼˜å…ˆçº§ã€‚&lt;/li&gt;
&lt;li&gt;å¢åŠ äº†æ–°çš„é…ç½®ï¼Œä½¿ &lt;a href=&#34;https://istio.io/latest/docs/ops/best-practices/security/#configure-tls-verification-in-destination-rule-when-using-tls-origination&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘èµ·å®‰å…¨ TLS æ›´ç®€å•&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å›é¡¾ï¼šå¯¹ &lt;a href=&#34;https://istio.io/latest/blog/2021/proxyless-grpc/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC åŸç”Ÿ &amp;ldquo;æ— ä»£ç†&amp;rdquo; æœåŠ¡ç½‘æ ¼&lt;/a&gt; çš„åˆæ­¥æ”¯æŒã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/istio/wiki/Experimental-QUIC-and-HTTP-3-support-in-Istio-gateways&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¢åŠ äº†&lt;/a&gt; å¯¹ HTTP/3 ç½‘å…³çš„å®éªŒæ€§æ”¯æŒã€‚&lt;/li&gt;
&lt;li&gt;æœ‰å…³å®Œæ•´çš„å˜æ›´æ¸…å•ï¼Œè¯·å‚è§ &lt;a href=&#34;https://istio.io/latest/news/releases/1.12.x/announcing-1.12/change-notes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å˜æ›´è¯´æ˜&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>å¤šç§Ÿæˆ·åœºæ™¯ä¸‹ Istio éƒ¨ç½²æ–¹æ¡ˆæ¢ç´¢</title>
      <link>https://cloudnativecn.com/blog/istio-multi-tenancy-exploration/</link>
      <pubDate>Mon, 01 Nov 2021 02:37:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-multi-tenancy-exploration/</guid>
      <description>&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;éšç€äº‘åŸç”Ÿæ¦‚å¿µçš„æ™®åŠï¼ŒæœåŠ¡ç½‘æ ¼æŠ€æœ¯çš„æµè¡Œä»¥åŠ Istio çš„æˆç†Ÿï¼Œä½¿ç”¨ Istio è¿›è¡ŒæœåŠ¡æ²»ç†çš„å®è·µä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œæ­£æˆä¸ºæœåŠ¡æ²»ç†çš„è¶‹åŠ¿ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¹ŸåŠ å…¥åˆ° Istio çš„ç ”ç©¶ä¸­ï¼Œå¸Œæœ›åˆæœŸé€šè¿‡ Istio å®ç°å…¬å¸äº§å“è¿­ä»£ç‰ˆæœ¬çš„ç°åº¦å‘å¸ƒï¼Œåç»­åŸºäº Istio ä¸ºä¸šåŠ¡äº§å“æä¾›æ›´å¤šçš„æµé‡ç®¡ç†åŠè§‚æµ‹è¿½è¸ªèƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€å¼€å§‹è®¾è®¡ Istio éƒ¨ç½²æ–¹æ¡ˆæ—¶ï¼ŒåŸºäºå½“æ—¶å¯¹å…¬å¸äº§å“éƒ¨ç½²æ–¹å¼çš„äº†è§£ï¼Œæ¯æ¬¾äº§å“ç‹¬å ä¸€å¥— Kubernetes é›†ç¾¤ï¼Œå¦å¤–è€ƒè™‘åˆ°å½“æ—¶æˆ‘ä»¬å¯¹ Istio çš„ç†Ÿæ‚‰ç¨‹åº¦ï¼Œè®¾è®¡çš„æ˜¯æœ€åŸºç¡€çš„æ–¹æ¡ˆï¼šä¸€å¥— Kubernetes é›†ç¾¤ä¸­éƒ¨ç½²ä¸€å¥— Istioï¼Œå°†è¯¥ Kubernetes é›†ç¾¤å†…å”¯ä¸€çš„äº§å“çº³ç®¡åˆ° Istio æœåŠ¡ç½‘æ ¼ä¸­ï¼Œå³ Kubernetes é›†ç¾¤ã€äº§å“ã€Istio æ˜¯ 1:1:1 çš„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;éšç€å¯¹å…¬å¸äº§å“éƒ¨ç½²æ–¹å¼è°ƒç ”çš„æ·±å…¥ï¼Œæˆ‘ä»¬äº†è§£åˆ°æœ‰å‡ æ¬¾äº§å“éƒ¨ç½²åœ¨ä¸€å¥— Kubernetes é›†ç¾¤ä¸­ï¼ŒæŒ‰ç…§ namespace è¿›è¡Œåˆ†å‰²ï¼Œå¹¶ä¸”å…¬å¸å¼€å§‹æ¨è¡Œç»Ÿä¸€ Kubernetes é›†ç¾¤ï¼Œå·²ç»åœ¨è½åœ°å®æ–½ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬ç»§ç»­ä½¿ç”¨åˆå§‹çš„éƒ¨ç½²æ–¹æ¡ˆï¼Œåœ¨åˆæœŸ Kubernetes é›†ç¾¤ä¸­äº§å“æ•°é‡ä¸å¤šï¼Œè§„æ¨¡ä¸å¤§çš„æƒ…å†µï¼Œä¹Ÿæ˜¯å¯ä»¥æ”¯æ’‘çš„ï¼Œä½†å­˜åœ¨æ½œåœ¨é—®é¢˜ (ä¸»è¦æ˜¯æ€§èƒ½é—®é¢˜ä»¥åŠæ•…éšœéš”ç¦»æ€§çš„é—®é¢˜)ï¼Œæ‰€ä»¥éœ€è¦è°ƒç ”å®ç°åœ¨ä¸€å¥— Kubernetes é›†ç¾¤å†…ï¼Œä¸ºæ¯ä¸€ä¸ªäº§å“æä¾›ä¸€å¥— Istio æœåŠ¡ç½‘æ ¼çš„æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;åˆå§‹æ–¹æ¡ˆé—®é¢˜&#34;&gt;åˆå§‹æ–¹æ¡ˆé—®é¢˜&lt;/h2&gt;
&lt;p&gt;åˆå§‹æ–¹æ¡ˆå­˜åœ¨ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;h3 id=&#34;æ€§èƒ½é—®é¢˜&#34;&gt;æ€§èƒ½é—®é¢˜&lt;/h3&gt;
&lt;p&gt;é›†ç¾¤è§„æ¨¡è¾ƒå¤§æ—¶ï¼Œå¤šäº§å“å…±ç”¨åŒä¸€å¥— Istioï¼Œä¼šå­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç½‘æ ¼ä¸­çš„æ¯ä¸ª Sidecar éƒ½ä¼šæ”¶åˆ°æ•´ä¸ªé›†ç¾¤æ‰€æœ‰æœåŠ¡ä¿¡æ¯ã€‚åœ¨è¾ƒå¤§è§„æ¨¡çš„è§„æ¨¡ä¸­ï¼Œå°¤å…¶æ˜¯ç”±äºæµé‡è§„åˆ™æ‰¹é‡å˜æ›´ï¼Œæ§åˆ¶é¢å‘æ•°æ®é¢çŸ­æ—¶é—´å†…å¤§é‡ä¸‹å‘æœåŠ¡ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼ŒSidecar çš„ CPU åŠå†…å­˜æ¶ˆè€—ã€XDS çš„ä¸‹å‘åŠæ—¶æ€§ç­‰é—®é¢˜ï¼Œä¼šå˜å¾—éå¸¸çªå‡ºã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ•…éšœéš”ç¦»æ€§é—®é¢˜&#34;&gt;æ•…éšœéš”ç¦»æ€§é—®é¢˜&lt;/h3&gt;
&lt;p&gt;å¤šæ¬¾äº§å“å…±ç”¨ä¸€å¥— Istioï¼Œå¯èƒ½ Istio æœ¬èº«ä¼šå‡ºç°é—®é¢˜ï¼Œä¹Ÿå¯èƒ½ç”±äºæŸæ¬¾äº§å“çš„é…ç½®å¯¼è‡´ Istio å‡ºç°é—®é¢˜ï¼Œè¿›è€Œå¯èƒ½å¯¼è‡´çº³ç®¡çš„æ‰€æœ‰äº§å“ç°åº¦ç”šè‡³æ­£å¸¸è®¿é—®éƒ½å‡ºç°é—®é¢˜ï¼Œæ— æ³•å®ç°æ•…éšœçš„éš”ç¦»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ–°æ–¹æ¡ˆè°ƒç ”&#34;&gt;æ–°æ–¹æ¡ˆè°ƒç ”&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦è°ƒç ”å®ç°åœ¨ä¸€å¥— Kubernetes é›†ç¾¤å†…ï¼Œä¸ºæ¯ä¸€ä¸ªäº§å“æä¾›ä¸€å¥— Istio æœåŠ¡ç½‘æ ¼çš„æ–¹æ¡ˆï¼Œè§£å†³æ½œåœ¨çš„é—®é¢˜ã€‚æ€»ç»“ä¸‹æ¥ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;h3 id=&#34;å®˜æ–¹æ–¹æ¡ˆ&#34;&gt;å®˜æ–¹æ–¹æ¡ˆ&lt;/h3&gt;
&lt;p&gt;Istio å®˜æ–¹ç½‘ç«™æœ‰ä¸€ç¯‡ 2018 å¹´çš„åšæ–‡ï¼š&lt;a href=&#34;https://istio.io/latest/zh/blog/2018/soft-multitenancy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio çš„è½¯æ€§å¤šç§Ÿæˆ·æ”¯æŒ&lt;/a&gt;ç»™å‡ºäº†æ–¹æ¡ˆï¼Œå¯ä»¥å®ç°ä¸ºæ¯ä¸ªäº§å“æä¾›ä¸€å¥— Istio ç½‘æ ¼çš„ç›®æ ‡ï¼Œæ¯å¥— Istio çš„æ§åˆ¶é¢å¯ä»¥å®‰è£…åˆ°æŒ‡å®šçš„ namespace ä¸­ï¼Œæ•°æ®é¢å¯ä»¥è®¾ç½®ä¸ºäº§å“éƒ¨ç½²çš„ namespaceã€‚å®˜æ–¹æ–¹æ¡ˆæ˜¯ç¬¦åˆæˆ‘ä»¬æœŸæœ›çš„æ–¹æ¡ˆï¼Œä½† Istio ç‰ˆæœ¬å‡çº§å¤ªå¿«ï¼Œåšæ–‡å†…å®¹æ¯”è¾ƒé™ˆæ—§ï¼Œæ²¡åŠæ³•æŒ‰æ–‡æ¡£æ“ä½œï¼Œå¹¶ä¸”æœ‰äººåé¦ˆå®æ“æ—¶æœ‰é—®é¢˜ï¼ˆ&lt;a href=&#34;https://github.com/istio/istio/issues/7608&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æå‡ºé—®é¢˜çš„ issue&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ª namespace è£…ä¸€å¥— Istio ç½‘æ ¼ï¼Œä¹Ÿæ˜¯å­˜åœ¨ä¸€å®šé—®é¢˜çš„ï¼Œä½†ç»“åˆç›®å‰æˆ‘ä»¬çš„å®é™…æƒ…å†µï¼Œè®¤ä¸ºä¸‹é¢çš„ä¸¤ä¸ªé—®é¢˜æˆ‘ä»¬æ˜¯å¯ä»¥æ¥å—çš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èµ„æºæ¶ˆè€—é—®é¢˜ï¼šæ¯å¥— Istio ç½‘æ ¼éƒ½æ˜¯éœ€è¦æ¶ˆè€—ä¸€å®šé‡çš„èµ„æºçš„&lt;/li&gt;
&lt;li&gt;namespace ä¹‹é—´ç½‘ç»œè¯·æ±‚é—®é¢˜ï¼šå¦‚æœ namespace ä¹‹é—´å­˜åœ¨æœåŠ¡äº’è®¿ï¼ŒæŒ‰ç…§ Istio çš„è§„èŒƒï¼Œé€šè¿‡åœ¨ namespace ä¸­éƒ¨ç½² Ingress Gateway å’Œ Egress Gatewayï¼Œæ§åˆ¶è¿›å…¥å’Œæµå‡ºçš„æµé‡ï¼Œä½†è¿™æ ·å¢åŠ äº†éƒ¨ç½²å¤æ‚åº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å•æ§åˆ¶é¢å¤š-gateway-æ–¹æ¡ˆ&#34;&gt;å•æ§åˆ¶é¢å¤š Gateway æ–¹æ¡ˆ&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://medium.com/@sudeep.batra/service-mesh-istio-patterns-for-multitenancy-2462568636f7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh (Istio) patterns for Multitenancy&lt;/a&gt;æä¾›äº†å¦å¤–ä¸€ç§æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆä¸ºéƒ¨ç½²ä¸€å¥— Istio æ§åˆ¶é¢ï¼Œçº³ç®¡å¤šä¸ªäº§å“æ•°æ®é¢ï¼Œæ¯ä¸ªäº§å“ä»¥åŠ Istio æ§åˆ¶é¢çš„ namespace éƒ¨ç½²ä¸€å¥— Ingress Gatewayï¼Œç›¸å½“äºäº§å“å…±ç”¨ Istio æ§åˆ¶é¢ï¼Œä½†ä¸å…±ç”¨ Ingress Gatewayï¼Œä¸€å®šç¨‹åº¦ä¸Šå‡å°‘äº§å“çš„è€¦åˆã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å•æ§åˆ¶é¢å¤š-gateway-æ–¹æ¡ˆ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å•æ§åˆ¶é¢å¤š Gateway æ–¹æ¡ˆ&#34; srcset=&#34;
               /blog/istio-multi-tenancy-exploration/one-control-plane-multi-gateways_hu_1bc8c3393e82d955.webp 400w,
               /blog/istio-multi-tenancy-exploration/one-control-plane-multi-gateways_hu_62eb58e328409519.webp 760w,
               /blog/istio-multi-tenancy-exploration/one-control-plane-multi-gateways_hu_9fcfda43bb8aab87.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-multi-tenancy-exploration/one-control-plane-multi-gateways_hu_1bc8c3393e82d955.webp&#34;
               width=&#34;760&#34;
               height=&#34;601&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å•æ§åˆ¶é¢å¤š Gateway æ–¹æ¡ˆ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;å¤§å‚æ–¹æ¡ˆ&#34;&gt;å¤§å‚æ–¹æ¡ˆ&lt;/h3&gt;
&lt;p&gt;ä¸€äº›å¤§å‚ï¼Œåœ¨å¼€æº Istio çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†å¤šç§Ÿæˆ·çš„æ”¯æŒï¼Œæ¯”å¦‚&lt;a href=&#34;https://www.redhat.com/en/topics/microservices/why-choose-openshift-service-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Red Hat OpenShift Service Mesh&lt;/a&gt;ã€&lt;a href=&#34;https://www.infoq.cn/article/id2w4pefjqbusjhmd8jt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è…¾è®¯äº‘ TFS Mesh&lt;/a&gt;åŠ&lt;a href=&#34;https://www.qbitai.com/2020/06/15846.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;èš‚èšé‡‘æœ SOFAMesh&lt;/a&gt;ï¼Œåœ¨è¿™ä¸‰ç¯‡æ–‡ç« ä¸­ï¼Œéƒ½å„è‡ªæåˆ°äº†å¯¹å¤šç§Ÿæˆ·çš„æ”¯æŒã€‚&lt;/p&gt;
&lt;h2 id=&#34;æˆ‘ä»¬çš„æ¢ç´¢&#34;&gt;æˆ‘ä»¬çš„æ¢ç´¢&lt;/h2&gt;
&lt;p&gt;ç›®å‰æˆ‘ä»¬è¿›è¡Œäº†å‰ä¸¤ä¸ªæ–¹æ¡ˆçš„æ¢ç´¢ï¼Œå³ä¸Šæ–‡ä¸­å®˜æ–¹æ–¹æ¡ˆåŠå•æ§åˆ¶é¢å¤š Gateway çš„æ–¹æ¡ˆï¼Œé€šè¿‡å®è·µå’Œå¯¹æºç ç ”ç©¶ï¼Œåœ¨ä¸ä¿®æ”¹è°ƒç ”ç‰ˆæœ¬ï¼ˆV1.8.1ï¼‰Istio æºç çš„æƒ…å†µä¸‹ï¼Œå‰è€…æ˜¯è¡Œä¸é€šçš„ï¼Œè€Œåè€…æ˜¯å¯ä»¥é¡ºåˆ©å®ç°çš„ (PSï¼šé€šè¿‡å¯¹æœ€æ–°ç‰ˆæœ¬ V1.11.4 çš„ Istio è¿›è¡Œå®è·µï¼Œæœ¬æ–‡å¯¹ V1.11.4 ç‰ˆæœ¬ Istio ä»ç„¶é€‚ç”¨)ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¤ä¸ªæ–¹æ¡ˆå„æœ‰ä¼˜ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å‰è€…å¯ä»¥å®ç°ç§Ÿæˆ·å¯¹ Istio çš„ç‹¬å ï¼Œæ˜¯åœ¨ä¸€å¥— Kubernetes é›†ç¾¤ä¸­å½»åº•çš„åˆ†ç§Ÿæˆ·æ–¹æ¡ˆï¼Œæ¯”è¾ƒå®Œç¾çš„è§£å†³æ€§èƒ½é—®é¢˜åŠæ•…éšœéš”ç¦»æ€§é—®é¢˜ï¼Œä½†ç¼ºç‚¹æ˜¯éœ€è¦ä¿®æ”¹æºä»£ç ï¼Œå¼€å‘æˆæœ¬è¾ƒé«˜ï¼ŒåæœŸæ¯æ¬¡ Istio ç‰ˆæœ¬å‡çº§ï¼Œéœ€è¦å°† patch é‡æ–°æ‰“å…¥ï¼Œç»´æŠ¤æˆæœ¬ä¹Ÿè¾ƒé«˜ï¼Œå¦å¤–è€ƒè™‘å¯¹ Istio çš„ç†Ÿæ‚‰ç¨‹åº¦ï¼Œä¿®æ”¹æºç å¸¦æ¥çš„é£é™©ä¹Ÿè¾ƒå¤§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åè€…æ˜¯åœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹å®ç°å¤šç§Ÿæˆ·çš„æŠ˜ä¸­æ–¹æ¡ˆï¼Œç§Ÿæˆ·é—´è™½ç„¶å…±äº«æ§åˆ¶é¢ï¼Œä½†ç‹¬äº«æ•°æ®é¢ï¼Œåœ¨æ•°æ®é¢èŒƒå›´å†…å®ç°ç§Ÿæˆ·éš”ç¦»ï¼Œè§£å†³ç”¨æˆ·è®¿é—®ç§Ÿæˆ·äº§å“æ—¶çš„æ€§èƒ½é—®é¢˜å’Œæ•…éšœéš”ç¦»æ€§é—®é¢˜ï¼Œä¿éšœäº†äº§å“çš„æ­£å¸¸è®¿é—®ï¼Œè¿™ä¹Ÿæ˜¯æœ€é‡è¦ã€æœ€éœ€è¦ä¿éšœçš„éƒ¨åˆ†ï¼Œç¼ºç‚¹æ˜¯ç§Ÿæˆ·å…±äº«æ§åˆ¶é¢ï¼Œæ§åˆ¶é¢å‡ºç°é—®é¢˜æ—¶ï¼Œå½±å“å¤šäº§å“æ§åˆ¶é¢å¯¹æ•°æ®é¢çš„ç®¡ç†ï¼Œæ¯”å¦‚æµé‡ç®¡ç†é…ç½®å˜æ›´ä¸‹å‘ï¼Œä½†è€ƒè™‘ä¸€èˆ¬åœ¨å‘¨æœŸæ€§ä¸Šçº¿æ—¶ï¼Œæ‰æ¶‰åŠåˆ°æ§åˆ¶é¢å¯¹æ•°æ®é¢çš„ç®¡ç†å˜æ›´ï¼Œè§£å†³é—®é¢˜çš„ç´§æ€¥ç¨‹åº¦ï¼Œæ¯”æ•°æ®é¢ä¸šåŠ¡è®¿é—®å‡ºé—®é¢˜æ—¶çš„ç´§æ€¥ç¨‹åº¦ä½å¾ˆå¤šï¼Œå¹¶ä¸”æˆ‘ä»¬ä¼šé€šè¿‡æ§åˆ¶é¢é«˜å¯ç”¨ç­‰æ–¹æ¡ˆï¼Œé™ä½è¿™ç§æƒ…å†µçš„å½±å“ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸‹å¯¹ä¸¤ä¸ªæ–¹æ¡ˆçš„æ¢ç´¢ï¼š&lt;/p&gt;
&lt;h3 id=&#34;å®˜æ–¹æ–¹æ¡ˆ-1&#34;&gt;å®˜æ–¹æ–¹æ¡ˆ&lt;/h3&gt;
&lt;p&gt;å‰é¢å·²ç»æåˆ°ï¼Œå®˜æ–¹æ–¹æ¡ˆå†…å®¹æ¯”è¾ƒé™ˆæ—§ï¼Œæ²¡åŠæ³•æŒ‰ç…§æ–‡æ¡£æ“ä½œï¼Œå¹¶ä¸”æœ‰äººåé¦ˆå­˜åœ¨é—®é¢˜ï¼ŒæŒ‰ç…§åšæ–‡æ–¹æ¡ˆï¼Œé€šè¿‡ istioctl æ–¹å¼å¤šæ¬¡å°è¯•ï¼Œæ²¡æœ‰æˆåŠŸã€‚é˜…è¯»äº†æ›´å¤šçš„å…¶ä»–å®˜æ–¹æ–‡æ¡£ï¼Œè€ƒè™‘ Istio Operator æ–¹å¼å®‰è£… Istioï¼Œå¯ä»¥æ›´æ–¹ä¾¿è¿›è¡Œ Istio éƒ¨ç½²è®¾ç½®ï¼Œæ‰€ä»¥è¿›è¡Œäº†é€šè¿‡ Istio Operator å®‰è£… Istio çš„å¾ˆå¤šå°è¯•ï¼Œå¹¶ä¸”æ·±å…¥é˜…è¯»äº† Istio ç›¸å…³ä»£ç ï¼Œå‘ç°åœ¨ä¸ä¿®æ”¹ Istio æºä»£ç çš„æƒ…å†µä¸‹ï¼Œæ˜¯è¡Œä¸é€šçš„ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯é€šè¿‡ Istio Operator å®‰è£… Istioï¼Œå®ç°å®˜æ–¹æ–¹æ¡ˆçš„ä¸€äº›å°è¯•ï¼Œå¹¶åŒ…å«ä¸€äº›æºä»£ç çš„åˆ†æã€‚&lt;/p&gt;
&lt;p&gt;è¯•éªŒ Demo éƒ¨ç½²æ¨¡å‹å¦‚ä¸‹ï¼Œåœ¨ä¸€å¥— Kubernetes é›†ç¾¤ä¸Šéƒ¨ç½²ä¸¤å¥—æœåŠ¡ç½‘æ ¼åŠä¸¤å¥—äº§å“ (Foo å’Œ Bar)ï¼Œæ¯å¥—æœåŠ¡ç½‘æ ¼å®Œå…¨éš”ç¦»ï¼Œæ¯ä¸ªäº§å“ç‹¬å å¯¹åº”çš„æœåŠ¡ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å®˜æ–¹æ–¹æ¡ˆéªŒè¯-demo-éƒ¨ç½²æ¨¡å‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å®˜æ–¹æ–¹æ¡ˆéªŒè¯ demo éƒ¨ç½²æ¨¡å‹&#34; srcset=&#34;
               /blog/istio-multi-tenancy-exploration/independent-control-plane-demo_hu_bff51106bf6459bf.webp 400w,
               /blog/istio-multi-tenancy-exploration/independent-control-plane-demo_hu_6c387c6f314c4c72.webp 760w,
               /blog/istio-multi-tenancy-exploration/independent-control-plane-demo_hu_450a847a06d680e.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-multi-tenancy-exploration/independent-control-plane-demo_hu_bff51106bf6459bf.webp&#34;
               width=&#34;760&#34;
               height=&#34;334&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å®˜æ–¹æ–¹æ¡ˆéªŒè¯ demo éƒ¨ç½²æ¨¡å‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;1ã€ä¸º Foo äº§å“éƒ¨ç½²ç‹¬å çš„ Istio ç»„ä»¶&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl create namespace istio-system-foo
istioctl operator init --istioNamespace istio-system-foo --watchedNamespaces istio-system-foo --namespace istio-system-foo --operatorNamespace istio-operator-foo
kubectl apply -f istio-operator-foo.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;istio-operator-foo.yaml çš„å†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system-foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-control-plane&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system-foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;global&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istioNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system-foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meshConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rootNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system-foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingressGateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NodePort&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œä»¥ä¸Šæ“ä½œåï¼Œè¿‡ä¸€æ®µæ—¶é—´ï¼ŒæŸ¥çœ‹ istio-system-foo namespaceï¼Œå¯ä»¥çœ‹åˆ° Foo ç‹¬å çš„ Istio ç»„ä»¶éƒ¨ç½²æˆåŠŸã€‚&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;ç±»ä¼¼çš„æ–¹å¼ï¼Œä¸º Bar åº”ç”¨éƒ¨ç½²ç‹¬å çš„ Istio ç»„ä»¶&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl create namespace istio-system-bar
istioctl operator init --istioNamespace istio-system-bar --watchedNamespaces istio-system-bar --namespace istio-system-bar --operatorNamespace istio-operator-bar
kubectl apply -f istio-operator-bar.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;istio-operator-bar.yaml çš„å†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system-bar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-control-plane&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system-bar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;global&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istioNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system-bar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meshConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rootNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system-bar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingressGateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NodePort&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œä»¥ä¸Šçš„æ“ä½œï¼Œç¨ç­‰ä¸€ä¼šï¼ŒæŸ¥çœ‹ istio-system-bar namespace ä¸‹çš„ Istio ç»„ä»¶éƒ¨ç½²æƒ…å†µï¼Œä¼šå‘ç° Istio Ingress Gateway çš„ pod æ— æ³•æˆåŠŸå¯åŠ¨ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼Œæ—¥å¿—ä¸­æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;error   xdsproxy        failed to create upstream grpc client: rpc error: code = Unavailable desc = connection error: desc = &amp;#34;transport: authentication handshake failed: x509: certificate signed by unknown authority (possibly because of \&amp;#34;crypto/rsa: verification error\&amp;#34; while trying to verify candidate authority certificate \&amp;#34;cluster.local\&amp;#34;)&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ›´å¤šæ—¥å¿—è§ä¸‹é¢æˆªå›¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ingress-gateway-å¯åŠ¨é”™è¯¯æ—¥å¿—&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Ingress Gateway å¯åŠ¨é”™è¯¯æ—¥å¿—&#34; srcset=&#34;
               /blog/istio-multi-tenancy-exploration/ingress-gateway-failed-log_hu_88f52c2c67b8d8e3.webp 400w,
               /blog/istio-multi-tenancy-exploration/ingress-gateway-failed-log_hu_b017d996302a4e8.webp 760w,
               /blog/istio-multi-tenancy-exploration/ingress-gateway-failed-log_hu_99730b70da3bfd3b.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-multi-tenancy-exploration/ingress-gateway-failed-log_hu_88f52c2c67b8d8e3.webp&#34;
               width=&#34;760&#34;
               height=&#34;370&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Ingress Gateway å¯åŠ¨é”™è¯¯æ—¥å¿—
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¦è§£é‡Šæˆªå›¾ä¸­çš„é”™è¯¯æ—¥å¿—åŸå› ï¼Œéœ€è¦å…ˆä»‹ç»ä¸‹æ•°æ®é¢ï¼ˆEnvoyï¼‰å’Œæ§åˆ¶é¢ï¼ˆIstiodï¼‰çš„ç½‘ç»œäº¤äº’ã€‚ä¸‹é¢æ˜¯ç½‘ç»œäº¤äº’å›¾ï¼ˆADS è¯·æ±‚éƒ¨åˆ†ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy-å’Œ-istiod-çš„ç½‘ç»œäº¤äº’å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy å’Œ Istiod çš„ç½‘ç»œäº¤äº’å›¾&#34; srcset=&#34;
               /blog/istio-multi-tenancy-exploration/ads_hu_b0b38291efdb26d2.webp 400w,
               /blog/istio-multi-tenancy-exploration/ads_hu_34cdafab8ca0f678.webp 760w,
               /blog/istio-multi-tenancy-exploration/ads_hu_799090b54d64baec.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-multi-tenancy-exploration/ads_hu_b0b38291efdb26d2.webp&#34;
               width=&#34;241&#34;
               height=&#34;491&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy å’Œ Istiod çš„ç½‘ç»œäº¤äº’å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æ•°æ®é¢ Istio Ingress Gateway å®¹å™¨ä¸­æˆ–è€…ä¸šåŠ¡äº§å“ pod æ³¨å…¥çš„ Sidecar å®¹å™¨ä¸­ï¼Œå¯åŠ¨ç€ä¸¤ä¸ªè¿›ç¨‹ï¼ŒEnvoy è¿›ç¨‹åŠ Pilot Agent è¿›ç¨‹ï¼ˆå³å›¾ä¸­çš„ Istio Agentï¼‰ï¼Œåè€…æ‰®æ¼”ç€ Istiod å’Œ Envoy ä¹‹é—´ï¼ˆå³æ§åˆ¶é¢å’Œæ•°æ®é¢ä¹‹é—´ï¼‰è¿›è¡Œç½‘ç»œäº¤äº’çš„ä¸­é—´ä»£ç†è§’è‰²ã€‚Envoy å‘ Istio Agent å‘é€ ADSï¼ˆAggregated Discovery Servicesï¼Œå³èšåˆçš„å‘ç°æœåŠ¡ï¼Œé€šè¿‡ä¸€ä¸ª gRPC æµæ¥åŒæ­¥æ‰€æœ‰çš„é…ç½®æ›´æ–°ï¼‰è¯·æ±‚ï¼Œåè€…å°†è¯·æ±‚è½¬å‘ç»™æ§åˆ¶é¢çš„é…ç½®å‘ç°æœåŠ¡ï¼ˆä¸€èˆ¬ä¸º Istiodï¼‰ï¼Œç„¶åé…ç½®å‘ç°æœåŠ¡å°†å…¨éƒ¨çš„é…ç½®æ›´æ–°è¿”å›ç»™æ•°æ®é¢ã€‚&lt;/p&gt;
&lt;p&gt;æ•°æ®é¢å’Œæ§åˆ¶é¢ä¹‹é—´çš„ç½‘ç»œè¯·æ±‚ï¼Œé»˜è®¤åŸºäºåŒå‘ TLS è®¤è¯ï¼Œå³ä¸¤è€…è¿›è¡Œé€šä¿¡æ—¶ï¼ŒåŒæ–¹éƒ½éœ€è¦éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼Œé€šè¿‡é˜…è¯»æºä»£ç åŠå‚è€ƒèµµåŒ–å†°å¤§ä½¬çš„æ–‡ç« &lt;a href=&#34;https://zhaohuabing.com/post/2020-05-25-istio-certificate/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€æ–‡å¸¦ä½ å½»åº•å˜æ¸… Isito ä¸­çš„è¯ä¹¦å·¥ä½œæœºåˆ¶&lt;/a&gt;ï¼Œäº†è§£æ•°æ®é¢å¯¹æ§åˆ¶é¢çš„èº«ä»½è®¤è¯è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-èº«ä»½è®¤è¯&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;èº«ä»½è®¤è¯&#34; srcset=&#34;
               /blog/istio-multi-tenancy-exploration/certification_hu_138811b802bab8f.webp 400w,
               /blog/istio-multi-tenancy-exploration/certification_hu_7cf94cd4efbfce91.webp 760w,
               /blog/istio-multi-tenancy-exploration/certification_hu_9470a838b7f096f4.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-multi-tenancy-exploration/certification_hu_138811b802bab8f.webp&#34;
               width=&#34;745&#34;
               height=&#34;688&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      èº«ä»½è®¤è¯
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Istiod é‡‡ç”¨å†…ç½®çš„ CA æœåŠ¡ä¸ºè‡ªèº«ç­¾å‘ä¸€ä¸ªæœåŠ¡å™¨è¯ä¹¦ï¼Œå¹¶é‡‡ç”¨è¯¥æœåŠ¡å™¨è¯ä¹¦å¯¹å¤–æä¾›åŸºäº TLS çš„ gPRC æœåŠ¡ï¼›&lt;/li&gt;
&lt;li&gt;Istiod è°ƒç”¨ kube-apiserver ç”Ÿæˆ configmapï¼šistio-ca-root-certï¼Œåœ¨è¯¥ configmap ä¸­æ”¾å…¥äº† Istiod çš„ CA æ ¹è¯ä¹¦ï¼›&lt;/li&gt;
&lt;li&gt;æ•°æ®é¢ Ingress Gateway å®¹å™¨æˆ– Sidecar å®¹å™¨å°† istio-ca-root-cert configmap mount ä¸ºå®¹å™¨å†… /var/run/secrets/istio/root-cert.pem æ–‡ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ Pilot Agent å’Œ Istiod å»ºç«‹ gRPC è¿æ¥æ—¶ï¼ŒPilot Agent é‡‡ç”¨ root-cert.pem æ–‡ä»¶è¯ä¹¦å¯¹ Istiod çš„èº«ä»½è¿›è¡Œè®¤è¯ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é—®é¢˜å‡ºç°ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-å¤šç§Ÿæˆ·è®¤è¯è¿‡ç¨‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio å¤šç§Ÿæˆ·è®¤è¯è¿‡ç¨‹&#34; srcset=&#34;
               /blog/istio-multi-tenancy-exploration/certification-with-multi-tenancy_hu_b3cc943e0fbcbf54.webp 400w,
               /blog/istio-multi-tenancy-exploration/certification-with-multi-tenancy_hu_dca77c954ceae42a.webp 760w,
               /blog/istio-multi-tenancy-exploration/certification-with-multi-tenancy_hu_b55614d9ffc7306.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-multi-tenancy-exploration/certification-with-multi-tenancy_hu_b3cc943e0fbcbf54.webp&#34;
               width=&#34;760&#34;
               height=&#34;362&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio å¤šç§Ÿæˆ·è®¤è¯è¿‡ç¨‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;Istio é€šè¿‡ Kubernetes Informer æœºåˆ¶ï¼Œå°†æ­¥éª¤ 2 Foo æ§åˆ¶é¢ç”Ÿæˆçš„ Configmap åŒæ­¥åˆ° Kubernetes é›†ç¾¤é‡Œæ‰€æœ‰çš„ namespace ä¸‹ï¼ŒåŒ…æ‹¬ Bar ç½‘æ ¼ç›¸å…³çš„ Namespaceï¼›&lt;/li&gt;
&lt;li&gt;Bar æ•°æ®é¢ Ingress Gateway å®¹å™¨æˆ– Sidecar å®¹å™¨ï¼Œé‡‡ç”¨æ­¥éª¤ 3 ç›¸åŒçš„æ–¹å¼ï¼Œå°†æ­¥éª¤ 5 åŒæ­¥åˆ°çš„ Configmap mount åˆ°å®¹å™¨å†…ï¼›&lt;/li&gt;
&lt;li&gt;Bar çš„ Ingress Gateway æˆ– Sidecar ä½¿ç”¨ Foo æ§åˆ¶é¢ç”Ÿæˆçš„ CA æ ¹è¯ä¹¦ï¼Œå¯¹ Bar çš„æ§åˆ¶é¢è¿›è¡Œèº«ä»½è®¤è¯ï¼Œè®¤è¯å¤±è´¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯ä»¥ä» Istio æºä»£ç ï¼š&lt;a href=&#34;https://github.com/istio/istio/blob/1.8.1/pilot/pkg/bootstrap/server.go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pilot/pkg/bootstrap/server.go&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/istio/istio/blob/1.8.1/pilot/pkg/serviceregistry/kube/controller/namespacecontroller.go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pilot/pkg/serviceregistry/kube/controller/namespacecontroller.go&lt;/a&gt;ä¸­çœ‹åˆ°ç›¸å…³çš„åˆ†æå†…å®¹ï¼ŒIstiod ä¸­ pilot æ¨¡å— server æœåŠ¡æ—¶ï¼Œä¼šè¿›è¡Œä¸€ç³»åˆ—çš„åˆå§‹åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬åˆå§‹åŒ– namespaceControllerï¼Œè€Œè¯¥ namespaceController ä¼šåˆ›å»º configmapInformerï¼Œé€šè¿‡ informer æœºåˆ¶ï¼Œæ¥å— Kubernetes é›†ç¾¤ä¸­çš„ istio-ca-root-cert configmap çš„æ›´æ–°ï¼Œè€Œè¯¥ informer æ˜¯ä¸€ä¸ª SharedIndexInformerï¼Œä¹Ÿå°±æ˜¯å…±äº«çš„ informerï¼Œç›‘å¬åŒä¸€ä¸ª Kubernetes é›†ç¾¤ä¸­æ‰€æœ‰ namespace ä¸‹ configmap çš„å˜åŒ–ï¼Œæ‰€ä»¥ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œç›®å‰çš„ Istio ä¸æ”¯æŒåœ¨åŒä¸€ä¸ª Kubernetes é›†ç¾¤ä¸­å­˜åœ¨å¤šå¥— Istio æ§åˆ¶é¢ï¼Œè¿™ä¸ªå˜åŒ–åº”è¯¥æ˜¯æ¥è‡ª Istio 2020 å¹´ 7 æœˆçš„ä¸€æ¬¡ä»£ç ä¿®æ”¹ï¼Œå¯ä»¥æŸ¥çœ‹&lt;a href=&#34;https://github.com/istio/istio/commit/9fdec2a68d443b9f9aac85530ac01491b0d24bf2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;namespace controller: use shared informer&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-namespace-controller-use-shared-informer&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;namespace controller: use shared informer&#34; srcset=&#34;
               /blog/istio-multi-tenancy-exploration/istio-code_hu_bc542b7d84f83d2c.webp 400w,
               /blog/istio-multi-tenancy-exploration/istio-code_hu_fa951308c3f48ed6.webp 760w,
               /blog/istio-multi-tenancy-exploration/istio-code_hu_5d26240b0699a21c.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-multi-tenancy-exploration/istio-code_hu_bc542b7d84f83d2c.webp&#34;
               width=&#34;760&#34;
               height=&#34;404&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      namespace controller: use shared informer
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å¾—å‡ºç»“è®ºï¼Œåœ¨ä¸ä¿®æ”¹ Istio æºç çš„æƒ…å†µä¸‹ï¼Œæƒ³è¦å®ç°å®˜æ–¹æ–¹æ¡ˆï¼Œæ˜¯è¡Œä¸é€šçš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å•æ§åˆ¶é¢å¤š-gateway-æ–¹æ¡ˆ-1&#34;&gt;å•æ§åˆ¶é¢å¤š Gateway æ–¹æ¡ˆ&lt;/h3&gt;
&lt;p&gt;å‚ç…§&lt;a href=&#34;https://medium.com/@sudeep.batra/service-mesh-istio-patterns-for-multitenancy-2462568636f7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh (Istio) patterns for Multitenancy&lt;/a&gt;ï¼Œè¿›è¡Œäº†å®è·µéªŒè¯ï¼Œå®è·µè¿‡ç¨‹å¾ˆé¡ºåˆ©ï¼Œä»¥ä¸‹æ˜¯è¯•éªŒ Demo éƒ¨ç½²æ¨¡å‹åŠå®è·µæ­¥éª¤ï¼Œä¸€å¥— Kubernetes é›†ç¾¤ä¸Šéƒ¨ç½²ä¸¤æ¬¾äº§å“ï¼ˆFoo å’Œ Barï¼‰ï¼Œä¸¤æ¬¾äº§å“å…±äº«æ§åˆ¶é¢ï¼Œç‹¬äº«æ•°æ®é¢ï¼Œæ•°æ®é¢èŒƒå›´å†…å®ç°ç§Ÿæˆ·éš”ç¦»ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å•æ§åˆ¶é¢å¤š-gateway-æ–¹æ¡ˆ-demo-éƒ¨ç½²æ¨¡å‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å•æ§åˆ¶é¢å¤š Gateway æ–¹æ¡ˆ Demo éƒ¨ç½²æ¨¡å‹&#34; srcset=&#34;
               /blog/istio-multi-tenancy-exploration/shared-control-plane-demo_hu_379376c9ea8c952e.webp 400w,
               /blog/istio-multi-tenancy-exploration/shared-control-plane-demo_hu_a06ca7ccb5621af3.webp 760w,
               /blog/istio-multi-tenancy-exploration/shared-control-plane-demo_hu_6619c78f10b205c6.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-multi-tenancy-exploration/shared-control-plane-demo_hu_379376c9ea8c952e.webp&#34;
               width=&#34;760&#34;
               height=&#34;348&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å•æ§åˆ¶é¢å¤š Gateway æ–¹æ¡ˆ Demo éƒ¨ç½²æ¨¡å‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;éƒ¨ç½² Istio Operator&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;istioctl operator init
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;åˆ›å»º istio-system namespace&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl create namespace istio-system
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;åˆ›å»ºéƒ¨ç½²æ§åˆ¶é¢çš„ Istio Operator è‡ªå®šä¹‰èµ„æº&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl apply -f istio-operator.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;istio-operator.yaml çš„å†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-control-plane&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;pilot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hpaSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;minReplicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;PILOT_SCOPE_GATEWAY_TO_NAMESPACE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingressGateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œéƒ¨ç½² pilot ç»„ä»¶æ—¶ï¼Œä¸º pilot ç»„ä»¶è®¾ç½®äº† &lt;code&gt;PILOT_SCOPE_GATEWAY_TO_NAMESPACE&lt;/code&gt; ç¯å¢ƒå˜é‡ï¼Œå€¼ä¸º trueï¼Œä¼šé™åˆ¶ gateway è§„åˆ™åªä¼šåº”ç”¨åˆ° gateway æ‰€åœ¨ namespace ä¸‹ Istio Ingress Gateway ä¸Šï¼Œè¿™æ ·è®¾ç½®å®ç°ç§Ÿæˆ·ä¹‹é—´çš„éš”ç¦»ã€‚&lt;/p&gt;
&lt;p&gt;operator controller ä¼šç›‘æµ‹åˆ° istio-control-plane è¿™ä¸ª IstioOperator èµ„æºï¼Œå¹¶æŒ‰ç…§é…ç½®éƒ¨ç½²ç›¸å…³ç»„ä»¶ï¼Œç¨ç­‰ä¸€æ®µæ—¶é—´ï¼Œå¯ä»¥çœ‹æ‡‚ istio-system namespace ä¸‹å…±äº«çš„æ§åˆ¶é¢ç»„ä»¶å·²ç»éƒ¨ç½²å®Œæˆã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl get all -n istio-system
NAME                          READY   STATUS    RESTARTS   AGE
pod/istiod-6fc49c7d5c-2ljdl   1/1     Running   0          19h
pod/istiod-6fc49c7d5c-mjp5h   1/1     Running   0          19h
NAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                                 AGE
service/istiod   ClusterIP   10.109.247.96   &amp;lt;none&amp;gt;        15010/TCP,15012/TCP,443/TCP,15014/TCP   5d5h
NAME                     READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/istiod   2/2     2            2           19h
NAME                                DESIRED   CURRENT   READY   AGE
replicaset.apps/istiod-6fc49c7d5c   2         2         2       19h
replicaset.apps/istiod-f77f59479    0         0         0       19h
NAME                                         REFERENCE           TARGETS         MINPODS   MAXPODS   REPLICAS   AGE
horizontalpodautoscaler.autoscaling/istiod   Deployment/istiod   &amp;lt;unknown&amp;gt;/80%   2         5         2          19h
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;åˆ›å»º foo namespaceï¼Œå¹¶ä¸ºè¯¥ namespace æ‰“ä¸Šæ ‡ç­¾ï¼Œæ”¯æŒ istio sidecar è‡ªåŠ¨æ³¨å…¥&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl create namespace foo
kubectl label namespace foo istio-injection=enabled
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;åˆ›å»ºéƒ¨ç½² Foo åº”ç”¨ç‹¬å çš„ Istio Ingress Gateway éœ€è¦çš„ Istio Operator è‡ªå®šä¹‰èµ„æº&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl apply -f istio-operator-foo.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;istio-operator-foo.yaml çš„å†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo-ingress-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;empty&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingressGateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingress-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hpaSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;minReplicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NodePort&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;nodePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;32180&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¨ç­‰ä¸€æ®µæ—¶é—´ï¼Œå¯ä»¥çœ‹åˆ° foo namespace ä¸‹ï¼ŒFoo åº”ç”¨ç‹¬å çš„ Istio Ingress Gateway éƒ¨ç½²å®Œæˆã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl get all -n foo
NAME                                         READY   STATUS    RESTARTS   AGE
pod/istio-ingress-gateway-78447867cf-gh4l8   1/1     Running   0          23h
pod/istio-ingress-gateway-78447867cf-nqcb4   1/1     Running   0          23h

NAME                            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                                                                      AGE
service/istio-ingress-gateway   NodePort    10.233.21.151   &amp;lt;none&amp;gt;        80:32180/TCP   23h

NAME                                    READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/istio-ingress-gateway   2/2     2            2           23h

NAME                                               DESIRED   CURRENT   READY   AGE
replicaset.apps/istio-ingress-gateway-78447867cf   2         2         2       23h

NAME                                                        REFERENCE                          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE
horizontalpodautoscaler.autoscaling/istio-ingress-gateway   Deployment/istio-ingress-gateway   8%/80%    2         5         2          23h
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;å‚ç…§æ­¥éª¤ 4ã€5ï¼Œåœ¨ bar namespace ä¸­éƒ¨ç½²äº§å“ Bar ç‹¬å çš„ Istio Ingress Gatewayã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl create namespace bar
kubectl label namespace bar istio-injection=enabled
kubectl apply -f istio-operator-bar.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;istio-operator-bar.yaml å†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bar-ingress-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;empty&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingressGateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingress-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hpaSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;minReplicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NodePort&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;nodePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;32280&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¨ç­‰ä¸€æ®µæ—¶é—´ï¼Œå¯ä»¥çœ‹åˆ° bar namespace ä¸‹ï¼ŒBar åº”ç”¨ç‹¬å çš„ Istio Ingress Gateway éƒ¨ç½²å®Œæˆã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl get all -n bar
NAME                                         READY   STATUS    RESTARTS   AGE
pod/istio-ingress-gateway-8646b4964b-2q56j   1/1     Running   0          23h
pod/istio-ingress-gateway-8646b4964b-xjvvp   1/1     Running   0          23h

NAME                            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                                                                      AGE
service/istio-ingress-gateway   NodePort    10.233.41.156   &amp;lt;none&amp;gt;        80:32280/TCP   23h

NAME                                    READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/istio-ingress-gateway   2/2     2            2           23h

NAME                                               DESIRED   CURRENT   READY   AGE
replicaset.apps/istio-ingress-gateway-8646b4964b   2         2         2       23h

NAME                                                        REFERENCE                          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE
horizontalpodautoscaler.autoscaling/istio-ingress-gateway   Deployment/istio-ingress-gateway   6%/80%    2         5         2          23h
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é€šè¿‡æ­¥éª¤ 1-6ï¼Œå®ç°äº†å•æ§åˆ¶é¢å¤š Gateway æ–¹æ¡ˆçš„éƒ¨ç½²ï¼Œä¸¤æ¬¾äº§å“ Foo åŠ Bar å…±äº« istio-system namespace ä¸­çš„ Istiod æ§åˆ¶é¢ï¼Œç‹¬å å„è‡ª namespace ä¸­çš„ Istio Ingress Gatewayã€‚&lt;/p&gt;
&lt;p&gt;éƒ¨ç½² Fooã€Bar ä¸¤æ¬¾äº§å“ï¼ˆå¾ˆç®€å•çš„ HelloWorld ç±»å‹çš„ Demoï¼‰ï¼Œå¹¶åˆ›å»º Istio æµé‡ç®¡ç†ç›¸å…³çš„ CRDï¼Œå¯ä»¥å®ç° Fooã€Bar ä¸¤æ¬¾äº§å“çš„ç°åº¦å‘å¸ƒï¼Œä¸‹é¢æ˜¯å®ç°ç°åº¦å‘å¸ƒåçš„æ•ˆæœï¼Œéƒ¨ç½²è¿‡ç¨‹ä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;curl http://10.154.0.165:32180/foo/hello
Hello Foo 0.0.1
curl -H &amp;#39;version:v0-0-2&amp;#39; http://10.154.0.165:32180/foo/hello
Hello Foo 0.0.2
curl http://10.154.0.165:32280/bar/hello
Hello Bar 0.0.1
curl -H &amp;#39;version:v0-0-2&amp;#39; http://10.154.0.165:32280/bar/hello
Hello Bar 0.0.2
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;é€šè¿‡å¯¹ Istio å¤šç§Ÿæˆ·æ–¹æ¡ˆçš„è°ƒç ”å’Œæ¢ç´¢ï¼Œæˆ‘ä»¬æ€»ç»“å‡ºåŒä¸€ä¸ª Kubernetes é›†ç¾¤ä¸­åˆ† namespace éƒ¨ç½²å¤šæ¬¾äº§å“åœºæ™¯ä¸‹ä¸¤ç§ Istio éƒ¨ç½²æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ï¼Œç»“åˆæˆ‘ä»¬ç›®å‰çš„æƒ…å†µï¼Œæ›´å€¾å‘é‡‡ç”¨å•æ§åˆ¶é¢å¤š Gateway æ–¹æ¡ˆã€‚
ä»¥ä¸Šçš„è°ƒç ”æ¢ç´¢ï¼Œå¯èƒ½å­˜åœ¨é”™è¯¯æˆ–ä¸å‡†ç¡®çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§å®¶äº¤æµæŒ‡æ­£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒæ–‡ç« &#34;&gt;å‚è€ƒæ–‡ç« &lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.itpub.net/31557835/viewspace-2760142/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2021 å¹´ Istio å¤§å‹â€œå…¥å‘â€æŒ‡å—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/kirito-c/p/12750063.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ã€ŒBugã€Istio çš„ Sidercar å’Œ IngressGateway é—´æ­‡æ€§åœ°æŠ¥é”™ï¼šEnvoy proxy is NOT ready&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/ww-engineering/istio-performance-in-a-multi-tenancy-kubernetes-cluster-a843ec4e51f7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio performance in a multi-tenancy Kubernetes cluster&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/zh/blog/2018/soft-multitenancy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio çš„è½¯æ€§å¤šç§Ÿæˆ·æ”¯æŒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/istio/issues/7608&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;1.0 Soft multi-tenancy support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/ww-engineering/istio-performance-in-a-multi-tenancy-kubernetes-cluster-a843ec4e51f7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio performance in a multi-tenancy Kubernetes cluster&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.redhat.com/en/topics/microservices/why-choose-openshift-service-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Why choose Red Hat OpenShift Service Mesh?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.infoq.cn/article/id2w4pefjqbusjhmd8jt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è…¾è®¯äº‘ä¸­é—´ä»¶å›¢é˜Ÿåœ¨ Service Mesh ä¸­çš„å®è·µä¸æ¢ç´¢&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.qbitai.com/2020/06/15846.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Meshï¼šè°ƒåº¦åƒå†›ä¸‡é©¬å¾®æœåŠ¡ï¼Œ2.0 å¦¥å¦¥çš„&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhaohuabing.com/post/2020-05-25-istio-certificate/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€æ–‡å¸¦ä½ å½»åº•å˜æ¸… Isito ä¸­çš„è¯ä¹¦å·¥ä½œæœºåˆ¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhaohuabing.com/post/2018-09-25-istio-traffic-management-impl-intro/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æµé‡ç®¡ç†å®ç°æœºåˆ¶æ·±åº¦è§£æ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Istio 1.11 å‘å¸ƒ</title>
      <link>https://cloudnativecn.com/blog/istio-111-release/</link>
      <pubDate>Fri, 13 Aug 2021 07:05:42 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-111-release/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ª &lt;a href=&#34;https://istio.io/latest/news/releases/1.11.x/announcing-1.11/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜æ–¹åšå®¢&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ Istio åœ¨ 2021 å¹´å‘å¸ƒçš„ç¬¬ä¸‰ä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬è¦æ„Ÿè°¢æ•´ä¸ª Istio ç¤¾åŒºï¼Œç‰¹åˆ«æ˜¯æ¥è‡ªçº¢å¸½çš„å‘å¸ƒç»ç† John Wendellã€æ¥è‡ª Solo.io çš„ Ryan King å’Œæ¥è‡ªè‹±ç‰¹å°”çš„ Steve Zhangï¼Œæ„Ÿè°¢ä»–ä»¬å¸®åŠ© Istio 1.11.0 å‘å¸ƒã€‚è¯¥ç‰ˆæœ¬æ­£å¼æ”¯æŒ Kubernetes 1.18.0 åˆ° 1.22.xã€‚ä¸‹é¢æ˜¯è¯¥ç‰ˆæœ¬çš„ä¸€äº›äº®ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;cni-æ’ä»¶beta&#34;&gt;CNI æ’ä»¶ï¼ˆBetaï¼‰&lt;/h2&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio ä¼šåœ¨éƒ¨ç½²åœ¨ç½‘æ ¼çš„ pod ä¸­æ³¨å…¥ä¸€ä¸ª &lt;a href=&#34;https://kubernetes.io/docs/concepts/workloads/pods/init-containers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;init å®¹å™¨&lt;/a&gt;ã€‚&lt;code&gt;istio-init&lt;/code&gt; å®¹å™¨ä½¿ç”¨ &lt;code&gt;iptables&lt;/code&gt; è®¾ç½® pod ç½‘ç»œæµé‡é‡å®šå‘åˆ°ï¼ˆæ¥è‡ªï¼‰Istio sidecar ä»£ç†ã€‚è¿™éœ€è¦ç½‘æ ¼ä¸­éƒ¨ç½² pod çš„ç”¨æˆ·æˆ–æœåŠ¡è´¦æˆ·æœ‰è¶³å¤Ÿçš„æƒé™æ¥éƒ¨ç½²&lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-capabilities-for-a-container&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…·æœ‰ &lt;code&gt;NET_ADMIN&lt;/code&gt; å’Œ &lt;code&gt;NET_RAW&lt;/code&gt; åŠŸèƒ½çš„å®¹å™¨&lt;/a&gt;ã€‚è¦æ±‚ Istio ç”¨æˆ·æ‹¥æœ‰è¾ƒé«˜çš„ Kubernetes æƒé™ï¼Œå¯¹äºç»„ç»‡å†…çš„å®‰å…¨åˆè§„æ€§æ¥è¯´æ˜¯æœ‰é—®é¢˜çš„ã€‚Istio CNI æ’ä»¶æ˜¯ &lt;code&gt;istio-init&lt;/code&gt; å®¹å™¨çš„æ›¿ä»£å“ï¼Œå®ƒæ‰§è¡Œç›¸åŒçš„ç½‘ç»œåŠŸèƒ½ï¼Œä½†ä¸è¦æ±‚ Istio ç”¨æˆ·å¯ç”¨æ›´é«˜çš„ Kubernetes æƒé™ã€‚&lt;/p&gt;
&lt;p&gt;CNI æ’ä»¶å¯ä»¥ä¸å…¶ä»–æ’ä»¶åŒæ—¶ä½¿ç”¨ï¼Œå¹¶æ”¯æŒå¤§å¤šæ•°æ‰˜ç®¡çš„ Kubernetes å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æ”¹è¿›æ–‡æ¡£å’Œæµ‹è¯•ï¼Œå°† CNI æ’ä»¶åŠŸèƒ½æå‡ä¸º Beta ç‰ˆï¼Œä»¥ç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿåœ¨ç”Ÿäº§ä¸­å®‰å…¨åœ°å¯ç”¨è¿™ä¸€åŠŸèƒ½ã€‚&lt;a href=&#34;https://istio.io/latest/docs/setup/additional-setup/cni/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº†è§£å¦‚ä½•ç”¨ CNI æ’ä»¶å®‰è£… Istio&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¤–éƒ¨æ§åˆ¶å¹³é¢beta&#34;&gt;å¤–éƒ¨æ§åˆ¶å¹³é¢ï¼ˆBetaï¼‰&lt;/h2&gt;
&lt;p&gt;å»å¹´ï¼Œæˆ‘ä»¬ä¸º Istio å¼•å…¥äº†ä¸€ç§&lt;a href=&#34;https://istio.io/latest/blog/2020/new-deployment-model/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–°çš„éƒ¨ç½²æ¨¡å¼&lt;/a&gt;ï¼Œå³é›†ç¾¤çš„æ§åˆ¶å¹³é¢æ˜¯åœ¨è¯¥é›†ç¾¤ä¹‹å¤–ç®¡ç†çš„ã€‚è¿™å°±è§£å†³äº†è¿™æ ·ä¸€ä¸ªé—®é¢˜ â€”â€” å°†ç®¡ç†æ§åˆ¶å¹³é¢çš„ Mesh æ‰€æœ‰è€…å’Œåœ¨ Mesh ä¸­éƒ¨ç½²å’Œé…ç½®æœåŠ¡çš„ Mesh ç”¨æˆ·ä¹‹é—´åˆ†ç¦»ã€‚è¿è¡Œåœ¨ç‹¬ç«‹é›†ç¾¤ä¸­çš„å¤–éƒ¨æ§åˆ¶å¹³é¢å¯ä»¥æ§åˆ¶å•ä¸ªæ•°æ®å¹³é¢é›†ç¾¤æˆ–å¤šé›†ç¾¤ç½‘æ ¼çš„å¤šä¸ªé›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ 1.11 ç‰ˆæœ¬ä¸­ï¼Œè¯¥åŠŸèƒ½å·²è¢«æå‡ä¸º Beta ç‰ˆã€‚&lt;a href=&#34;https://istio.io/latest/docs/setup/install/external-controlplane/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº†è§£å¦‚ä½•è®¾ç½®å¸¦æœ‰å¤–éƒ¨æ§åˆ¶å¹³é¢çš„ç½‘æ ¼&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç½‘å…³æ³¨å…¥&#34;&gt;ç½‘å…³æ³¨å…¥&lt;/h2&gt;
&lt;p&gt;Istio æä¾›äº†ç½‘å…³ä½œä¸ºä¸å¤–éƒ¨ä¸–ç•Œè¿æ¥çš„æ–¹å¼ã€‚ä½ å¯ä»¥éƒ¨ç½²&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/ingress/ingress-control/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¥å£ç½‘å…³&lt;/a&gt;å’Œ&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/egress/egress-gateway/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‡ºå£ç½‘å…³&lt;/a&gt;ï¼Œå‰è€…ç”¨äºæ¥æ”¶æ¥è‡ªé›†ç¾¤å¤–çš„æµé‡ï¼Œåè€…ç”¨äºä»ä½ çš„åº”ç”¨ç¨‹åºå‘é›†ç¾¤å¤–éƒ¨ç½²çš„æœåŠ¡è¾“å‡ºæµé‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿‡å»ï¼ŒIstio ç‰ˆæœ¬ä¼šå°†ç½‘å…³éƒ¨ç½²ä¸ºä¸€ä¸ª Deploymentï¼Œå®ƒçš„ä»£ç†é…ç½®ä¸é›†ç¾¤ä¸­æ‰€æœ‰å…¶ä»–çš„ Sidecar ä»£ç†å®Œå…¨åˆ†å¼€ã€‚è¿™ä½¿å¾—ç½‘å…³çš„ç®¡ç†å’Œå‡çº§å˜å¾—å¤æ‚ï¼Œç‰¹åˆ«æ˜¯å½“é›†ç¾¤ä¸­éƒ¨ç½²äº†å¤šä¸ªç½‘å…³æ—¶ã€‚ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯ï¼Œä»æ§åˆ¶å¹³é¢ä¼ åˆ° sidecar ä»£ç†çš„è®¾ç½®å’Œç½‘å…³å¯èƒ½ä¼šæ¼‚ç§»ï¼Œå¯¼è‡´æ„å¤–çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ç½‘å…³æ³¨å…¥å°†å¯¹ç½‘å…³çš„ç®¡ç†å˜å¾—ä¸ä¸€èˆ¬çš„ sidecar ä»£ç†ç›¸åŒã€‚åœ¨ä»£ç†ä¸Šè®¾ç½®çš„å…¨å±€é…ç½®å°†é€‚ç”¨äºç½‘å…³ï¼Œä»¥å‰ä¸å¯èƒ½çš„å¤æ‚é…ç½®ï¼ˆä¾‹å¦‚ï¼Œå°†ç½‘å…³ä½œä¸º DaemonSet è¿è¡Œï¼‰ç°åœ¨å¾ˆå®¹æ˜“ã€‚åœ¨é›†ç¾¤å‡çº§åï¼Œä½ ä¹Ÿå¯ä»¥ç®€å•åœ°é€šè¿‡é‡å¯ pod å°†ç½‘å…³æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†è¿™äº›å˜åŒ–ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å‘å¸ƒäº†æ–°çš„&lt;a href=&#34;https://istio.io/latest/docs/setup/additional-setup/gateway/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£…ç½‘å…³&lt;/a&gt;æ–‡æ¡£ï¼Œå…¶ä¸­åŒ…æ‹¬å®‰è£…ã€ç®¡ç†å’Œå‡çº§ç½‘å…³çš„æœ€ä½³åšæ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯¹ä¿®è®¢å’Œæ ‡ç­¾éƒ¨ç½²çš„æ›´æ–°&#34;&gt;å¯¹ä¿®è®¢å’Œæ ‡ç­¾éƒ¨ç½²çš„æ›´æ–°&lt;/h2&gt;
&lt;p&gt;åœ¨ Istio 1.6 ä¸­ï¼Œæˆ‘ä»¬å¢åŠ äº†å¯¹åŒæ—¶è¿è¡Œå¤šä¸ªæ§åˆ¶å¹³é¢çš„æ”¯æŒï¼Œè¿™ä½¿å¾—ä½ å¯ä»¥&lt;a href=&#34;https://istio.io/latest/blog/2020/multiple-control-planes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯¹æ–°çš„ Istio ç‰ˆæœ¬è¿›è¡Œé‡‘ä¸é›€å¼éƒ¨ç½²&lt;/a&gt;ã€‚åœ¨ 1.10 ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†&lt;a href=&#34;https://istio.io/latest/blog/2021/revision-tags/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¿®è®¢æ ‡ç­¾ï¼ˆrevision tagï¼‰&lt;/a&gt;ï¼Œè¿™è®©ä½ å¯ä»¥å°†ä¸€ä¸ªä¿®è®¢ç‰ˆæ ‡è®°ä¸º &lt;code&gt;production&lt;/code&gt; æˆ– &lt;code&gt;testing&lt;/code&gt;ï¼Œå¹¶åœ¨å‡çº§æ—¶å°†å‡ºé”™çš„æœºä¼šé™åˆ°æœ€ä½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;istioctl tag&lt;/code&gt; å‘½ä»¤åœ¨ 1.11 ä¸­å·²ç»ä¸å†æ˜¯å®éªŒæ€§äº†ã€‚ä½ ç°åœ¨ä¹Ÿå¯ä»¥ä¸ºæ§åˆ¶å¹³é¢æŒ‡å®šä¸€ä¸ªé»˜è®¤çš„ä¿®è®¢ç‰ˆã€‚è¿™æœ‰åŠ©äºè¿›ä¸€æ­¥ç®€åŒ–ä»æ— ä¿®è®¢ç‰ˆçš„æ§åˆ¶å¹³é¢åˆ°æ–°ç‰ˆæœ¬çš„é‡‘ä¸é›€å‡çº§ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜ä¿®å¤äº†ä¸€ä¸ªå…³äºå‡çº§çš„&lt;a href=&#34;https://github.com/istio/istio/issues/28880&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‚¬è€Œæœªå†³çš„é—®é¢˜&lt;/a&gt; â€”â€” ä½ å¯ä»¥å®‰å…¨åœ°å¯¹ä½ çš„æ§åˆ¶å¹³é¢è¿›è¡Œé‡‘ä¸é›€å‡çº§ï¼Œä¸ç®¡å®ƒæ˜¯å¦ä½¿ç”¨ä¿®è®¢ç‰ˆå®‰è£…ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ”¹å–„ sidecar çš„æ³¨å…¥ä½“éªŒï¼Œå¼•å…¥äº† &lt;code&gt;istio-injection&lt;/code&gt; å’Œ &lt;code&gt;sidecar.istio.io/inject&lt;/code&gt; æ ‡ç­¾ã€‚æˆ‘ä»¬å»ºè®®ä½ ä½¿ç”¨æ³¨å…¥æ ‡ç­¾ï¼Œå› ä¸ºæ¯”æ³¨å…¥æ³¨è§£çš„æ€§èƒ½æ›´å¥½ã€‚æˆ‘ä»¬æ‰“ç®—åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¼ƒç”¨æ³¨å…¥æ³¨è§£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ”¯æŒ-kubernetes-å¤šé›†ç¾¤æœåŠ¡mcså®éªŒæ€§&#34;&gt;æ”¯æŒ Kubernetes å¤šé›†ç¾¤æœåŠ¡ï¼ˆMCSï¼‰ï¼ˆå®éªŒæ€§ï¼‰&lt;/h2&gt;
&lt;p&gt;Kubernetes é¡¹ç›®æ­£åœ¨å»ºç«‹&lt;a href=&#34;https://github.com/kubernetes/enhancements/tree/master/keps/sig-multicluster/1645-multi-cluster-services-api&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€ä¸ªå¤šé›†ç¾¤æœåŠ¡ API&lt;/a&gt;ï¼Œå…è®¸æœåŠ¡æ‰€æœ‰è€…æˆ–ç½‘æ ¼ç®¡ç†å‘˜æ§åˆ¶å¦‚ä½•å¯¼å‡ºæ•´ä¸ªç½‘æ ¼çš„æœåŠ¡åŠå…¶ç«¯ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;Istio 1.11 å¢åŠ äº†å¯¹å¤šé›†ç¾¤æœåŠ¡çš„å®éªŒæ€§æ”¯æŒã€‚ä¸€æ—¦å¯ç”¨ï¼ŒæœåŠ¡ç«¯ç‚¹çš„å¯å‘ç°æ€§å°†ç”±å®¢æˆ·ç«¯ä½ç½®å’ŒæœåŠ¡æ˜¯å¦è¢«å¯¼å‡ºå†³å®šã€‚é©»ç•™åœ¨ä¸å®¢æˆ·ç«¯ç›¸åŒçš„é›†ç¾¤ä¸­çš„ç«¯ç‚¹å°†æ€»æ˜¯å¯è¢«å‘ç°ã€‚ç„¶è€Œï¼Œåœ¨ä¸åŒé›†ç¾¤å†…çš„ç«¯ç‚¹ï¼Œåªæœ‰å½“å®ƒä»¬è¢«å¯¼å‡ºåˆ°ç½‘æ ¼æ—¶ï¼Œæ‰ä¼šè¢«å®¢æˆ·ç«¯å‘ç°ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼ŒIstio è¿˜ä¸æ”¯æŒ MCS è§„èŒƒæ‰€å®šä¹‰çš„ &lt;code&gt;cluster.local&lt;/code&gt; å’Œ &lt;code&gt;clusterset.local&lt;/code&gt; ä¸»æœºçš„è¡Œä¸ºã€‚å®¢æˆ·ç«¯åº”è¯¥ç»§ç»­ä½¿ç”¨ &lt;code&gt;cluster.local&lt;/code&gt; æˆ– &lt;code&gt;svc.namespace&lt;/code&gt; æ¥åšæœåŠ¡å¯»å€ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯æˆ‘ä»¬&lt;a href=&#34;https://docs.google.com/document/d/1K8hvQ83UcJ9a7U8oqXIefwr6pFJn-VBEi40Ak-fwQtk/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ”¯æŒ MCS è®¡åˆ’&lt;/a&gt;ç¬¬ä¸€é˜¶æ®µã€‚è¯·ç»§ç»­å…³æ³¨ï¼&lt;/p&gt;
&lt;h2 id=&#34;é¢„å‘Šæ–°çš„-api&#34;&gt;é¢„å‘Šï¼šæ–°çš„ API&lt;/h2&gt;
&lt;p&gt;Istio çš„ä¸€äº›åŠŸèƒ½åªèƒ½é€šè¿‡ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/envoy-filter/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;EnvoyFilter&lt;/code&gt;&lt;/a&gt;æ¥é…ç½®ï¼Œå®ƒå…è®¸ä½ è®¾ç½®ä»£ç†é…ç½®ã€‚æˆ‘ä»¬æ­£åœ¨ä¸ºå¸¸è§çš„ç”¨ä¾‹å¼€å‘æ–°çš„ APIâ€”â€” æ¯”å¦‚é…ç½®é¥æµ‹å’Œ WebAssemblyï¼ˆWasmï¼‰æ‰©å±•éƒ¨ç½²ï¼Œåœ¨ 1.12 ç‰ˆæœ¬ä¸­ä½ å¯ä»¥çœ‹åˆ°è¿™äº›åŠŸèƒ½ã€‚å¦‚æœä½ æœ‰å…´è¶£å¸®åŠ©æˆ‘ä»¬æµ‹è¯•è¿™äº›å®ç°ï¼Œ&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯·åŠ å…¥å·¥ä½œç»„ä¼šè®®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŠ å…¥-istio-ç¤¾åŒº&#34;&gt;åŠ å…¥ Istio ç¤¾åŒº&lt;/h2&gt;
&lt;p&gt;ä½ ä¹Ÿå¯ä»¥åœ¨ &lt;a href=&#34;https://discuss.istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Discuss Istio&lt;/a&gt; åŠ å…¥è®¨è®ºï¼Œæˆ–è€…åŠ å…¥æˆ‘ä»¬çš„ &lt;a href=&#34;https://slack.istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Slack&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä½ æƒ³å‚ä¸å—ï¼Ÿå¯»æ‰¾å¹¶åŠ å…¥æˆ‘ä»¬çš„ä¸€ä¸ª&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å·¥ä½œç»„&lt;/a&gt;ï¼Œå¸®åŠ©æ”¹è¿› Istioã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-111-å‡çº§è°ƒæŸ¥&#34;&gt;Istio 1.11 å‡çº§è°ƒæŸ¥&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ å·²ç»å®Œæˆäº†å¯¹ Istio 1.11 çš„å‡çº§ï¼Œæˆ‘ä»¬æƒ³å¬å¬ä½ çš„æ„è§è¯·èŠ±å‡ åˆ†é’Ÿæ—¶é—´å›å¤æˆ‘ä»¬çš„ç®€çŸ­&lt;a href=&#34;https://forms.gle/pquMQs4Qxujus6jB9&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è°ƒæŸ¥&lt;/a&gt;ï¼Œå‘Šè¯‰æˆ‘ä»¬æˆ‘ä»¬çš„å·¥ä½œæƒ…å†µã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio å®‰å…¨æœ€ä½³å®è·µ</title>
      <link>https://cloudnativecn.com/blog/istio-security-best-practices/</link>
      <pubDate>Mon, 02 Aug 2021 13:05:42 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-security-best-practices/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ª Istio å®˜æ–¹åšå®¢ &lt;a href=&#34;https://istio.io/latest/docs/ops/best-practices/security/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Security Best Practices&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Istio çš„å®‰å…¨åŠŸèƒ½æä¾›äº†å¼ºå¤§çš„èº«ä»½ã€ç­–ç•¥ã€é€æ˜çš„ TLS åŠ å¯†ä»¥åŠè®¤è¯ã€æˆæƒå’Œå®¡è®¡ï¼ˆAAAï¼‰å·¥å…·æ¥ä¿æŠ¤ä½ çš„æœåŠ¡å’Œæ•°æ®ã€‚ç„¶è€Œï¼Œä¸ºäº†å……åˆ†å®‰å…¨åœ°åˆ©ç”¨è¿™äº›åŠŸèƒ½ï¼Œå¿…é¡»æ³¨æ„éµå¾ªæœ€ä½³å®è·µã€‚å»ºè®®åœ¨ç»§ç»­é˜…è¯»ä¹‹å‰ï¼Œå…ˆå›é¡¾ä¸€ä¸‹&lt;a href=&#34;https://istio.io/latest/docs/concepts/security/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰å…¨æ¦‚è¿°&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŒå‘-tls&#34;&gt;åŒå‘ TLS&lt;/h2&gt;
&lt;p&gt;Istio å°†å°½å¯èƒ½ä½¿ç”¨&lt;a href=&#34;https://istio.io/latest/docs/concepts/security/#mutual-tls-authentication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŒå‘ TLS&lt;/a&gt; å¯¹æµé‡è¿›è¡Œ&lt;a href=&#34;https://istio.io/latest/docs/ops/configuration/traffic-management/tls-configuration/#auto-mtls&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªåŠ¨&lt;/a&gt;åŠ å¯†ã€‚ç„¶è€Œï¼Œä»£ç†åœ¨é»˜è®¤æƒ…å†µä¸‹è¢«é…ç½®ä¸º&lt;a href=&#34;https://istio.io/latest/docs/concepts/security/#permissive-mode&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¸å¯æ¨¡å¼ï¼ˆPermissive Modeï¼‰&lt;/a&gt;ï¼Œè¿™æ„å‘³ç€ä»–ä»¬å°†æ¥å—åŒå‘ TLS å’Œæ˜æ–‡æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶è¿™æ˜¯ä¸ºäº†å¢é‡é‡‡ç”¨æˆ–å…è®¸æ¥è‡ªæ²¡æœ‰ Istio sidecar çš„å®¢æˆ·ç«¯çš„æµé‡çš„éœ€è¦ï¼Œä½†å®ƒä¹Ÿå‰Šå¼±äº†å®‰å…¨ç«‹åœºã€‚å»ºè®®åœ¨å¯èƒ½çš„æƒ…å†µä¸‹&lt;a href=&#34;https://istio.io/latest/docs/tasks/security/authentication/mtls-migration/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿ç§»åˆ°ä¸¥æ ¼æ¨¡å¼ï¼ˆStrict Modeï¼‰&lt;/a&gt;ï¼Œä»¥å¼ºåˆ¶ä½¿ç”¨åŒå‘ TLSã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œä»…é åŒå‘ TLS å¹¶ä¸è¶³ä»¥ä¿è¯æµé‡çš„å®‰å…¨ï¼Œå› ä¸ºå®ƒåªæä¾›è®¤è¯ï¼Œè€Œä¸æ˜¯æˆæƒã€‚è¿™æ„å‘³ç€ï¼Œä»»ä½•æ‹¥æœ‰æœ‰æ•ˆè¯ä¹¦çš„äººä»ç„¶å¯ä»¥è®¿é—®ä¸€ä¸ªæœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å®Œå…¨é”å®šæµé‡ï¼Œå»ºè®®é…ç½®&lt;a href=&#34;https://istio.io/latest/docs/tasks/security/authorization/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆæƒç­–ç•¥&lt;/a&gt;ã€‚è¿™å…è®¸åˆ›å»ºç»†ç²’åº¦çš„ç­–ç•¥æ¥å…è®¸æˆ–æ‹’ç»æµé‡ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åªå…è®¸æ¥è‡ª &lt;code&gt;app&lt;/code&gt; å‘½åç©ºé—´çš„è¯·æ±‚è®¿é—® &lt;code&gt;hello-world&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æˆæƒç­–ç•¥&#34;&gt;æˆæƒç­–ç•¥&lt;/h2&gt;
&lt;p&gt;Istio &lt;a href=&#34;https://istio.io/latest/docs/concepts/security/#authorization&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆæƒ&lt;/a&gt;åœ¨ Istio å®‰å…¨ä¸­èµ·ç€å…³é”®ä½œç”¨ã€‚å®ƒéœ€è¦åŠªåŠ›é…ç½®æ­£ç¡®çš„æˆæƒç­–ç•¥ï¼Œä»¥æœ€å¥½åœ°ä¿æŠ¤ä½ çš„é›†ç¾¤ã€‚äº†è§£è¿™äº›é…ç½®çš„å½±å“æ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸º Istio æ— æ³•ç¡®å®šæ‰€æœ‰ç”¨æˆ·çš„æ­£ç¡®æˆæƒã€‚è¯·å…¨ç¨‹å…³æ³¨æœ¬èŠ‚å†…å®¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åº”ç”¨é»˜è®¤æ‹’ç»çš„æˆæƒç­–ç•¥&#34;&gt;åº”ç”¨é»˜è®¤æ‹’ç»çš„æˆæƒç­–ç•¥&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å»ºè®®ä½ æŒ‰ç…§ default-deny æ¨¡å¼å®šä¹‰ä½ çš„ Istio æˆæƒç­–ç•¥ï¼Œä»¥å¢å¼ºé›†ç¾¤çš„å®‰å…¨æ€åŠ¿ã€‚é»˜è®¤æ‹’ç»æˆæƒæ¨¡å¼æ„å‘³ç€ä½ çš„ç³»ç»Ÿé»˜è®¤æ‹’ç»æ‰€æœ‰è¯·æ±‚ï¼Œè€Œä½ å®šä¹‰äº†å…è®¸è¯·æ±‚çš„æ¡ä»¶ã€‚å¦‚æœä½ é”™è¿‡äº†ä¸€äº›æ¡ä»¶ï¼Œæµé‡å°†è¢«æ„å¤–åœ°æ‹’ç»ï¼Œè€Œä¸æ˜¯æµé‡è¢«æ„å¤–åœ°å…è®¸ã€‚åè€…é€šå¸¸æ˜¯ä¸€ä¸ªå®‰å…¨äº‹ä»¶ï¼Œè€Œå‰è€…å¯èƒ½ä¼šå¯¼è‡´ç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒã€æœåŠ¡ä¸­æ–­æˆ–ä¸ç¬¦åˆä½ çš„ SLO/SLAã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œåœ¨ &lt;a href=&#34;https://istio.io/latest/docs/tasks/security/authorization/authz-http/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP æµé‡çš„æˆæƒä»»&lt;/a&gt;åŠ¡ä¸­ï¼Œåä¸º &lt;code&gt;allow-nothing&lt;/code&gt; çš„æˆæƒç­–ç•¥ç¡®ä¿æ‰€æœ‰æµé‡åœ¨é»˜è®¤æƒ…å†µä¸‹è¢«æ‹’ç»ã€‚ä»è¿™é‡Œå¼€å§‹ï¼Œå…¶ä»–æˆæƒç­–ç•¥æ ¹æ®ç‰¹å®šæ¡ä»¶å…è®¸æµé‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åœ¨è·¯å¾„è§„èŒƒåŒ–ä¸Šå®šåˆ¶ä½ çš„ç³»ç»Ÿ&#34;&gt;åœ¨è·¯å¾„è§„èŒƒåŒ–ä¸Šå®šåˆ¶ä½ çš„ç³»ç»Ÿ&lt;/h3&gt;
&lt;p&gt;Istio æˆæƒç­–ç•¥å¯ä»¥åŸºäº HTTP è¯·æ±‚ä¸­çš„ URL è·¯å¾„ã€‚&lt;a href=&#34;https://en.wikipedia.org/wiki/URI_normalization&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯å¾„è§„èŒƒåŒ–ï¼ˆåˆç§° URI è§„èŒƒåŒ–ï¼‰&lt;/a&gt;å¯¹ä¼ å…¥è¯·æ±‚çš„è·¯å¾„è¿›è¡Œä¿®æ”¹å’Œæ ‡å‡†åŒ–ï¼Œä»è€Œä½¿è§„èŒƒåŒ–åçš„è·¯å¾„èƒ½å¤Ÿä»¥æ ‡å‡†æ–¹å¼è¿›è¡Œå¤„ç†ã€‚è¯­æ³•ä¸Šä¸åŒçš„è·¯å¾„åœ¨è·¯å¾„è§„èŒƒåŒ–åå¯èƒ½æ˜¯ç­‰åŒçš„ã€‚&lt;/p&gt;
&lt;p&gt;Istio æ”¯æŒä»¥ä¸‹è¯·æ±‚è·¯å¾„çš„è§„èŒƒåŒ–æ–¹æ¡ˆï¼Œç„¶åå†æ ¹æ®æˆæƒç­–ç•¥è¿›è¡Œè¯„ä¼°å’Œè·¯ç”±è¯·æ±‚ï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;é€‰é¡¹&lt;/th&gt;
          &lt;th&gt;æè¿°&lt;/th&gt;
          &lt;th&gt;ç¤ºä¾‹&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;NONE&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;ä¸åšä»»ä½•è§„èŒƒåŒ–å¤„ç†ã€‚Envoy æ”¶åˆ°çš„ä»»ä½•ä¿¡æ¯éƒ½ä¼šè¢«åŸå°ä¸åŠ¨åœ°è½¬å‘ç»™ä»»ä½•åç«¯æœåŠ¡ã€‚&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;../%2Fa../b&lt;/code&gt; ç”±æˆæƒæ”¿ç­–è¯„ä¼°å¹¶å‘é€ç»™ä½ çš„æœåŠ¡ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;BASE&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;è¿™æ˜¯ç›®å‰ Istio é»˜è®¤å®‰è£…ä¸­ä½¿ç”¨çš„é€‰é¡¹ã€‚è¿™åœ¨ Envoy ä»£ç†ä¸Šåº”ç”¨äº† &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/network/http_connection_manager/v3/http_connection_manager.proto#envoy-v3-api-field-extensions-filters-network-http-connection-manager-v3-httpconnectionmanager-normalize-path&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;normalize_path&lt;/code&gt;&lt;/a&gt;é€‰é¡¹ï¼Œè¯¥é€‰é¡¹éµå¾ª &lt;a href=&#34;https://tools.ietf.org/html/rfc3986&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 3986&lt;/a&gt;ï¼Œæœ‰é¢å¤–çš„è§„èŒƒåŒ–å¤„ç†ï¼Œå°†åæ–œçº¿è½¬æ¢æˆæ­£æ–œçº¿ã€‚&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;/a/../b&lt;/code&gt; è¢«è§„èŒƒåŒ–ä¸º &lt;code&gt;/b&lt;/code&gt;ã€‚&lt;code&gt;\da&lt;/code&gt; è¢«è§„èŒƒåŒ–å¾® &lt;code&gt;/da&lt;/code&gt;ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;MERGE_SLASHES&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;æ–œçº¿åœ¨ &lt;em&gt;BASE&lt;/em&gt; è§„èŒƒåŒ–ä¹‹åè¢«åˆå¹¶ã€‚&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;/a//b&lt;/code&gt; è¢«è§„èŒƒåŒ–ä¸º &lt;code&gt;/a/b&lt;/code&gt;ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;DECODE_AND_MERGE_SLASHES&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;æœ€ä¸¥æ ¼çš„è®¾ç½®ï¼Œå½“ä½ é»˜è®¤å…è®¸æ‰€æœ‰æµé‡ã€‚è¿™ä¸ªè®¾ç½®æ˜¯æ¨èçš„ï¼Œä½†è¦æ³¨æ„çš„æ˜¯ï¼Œä½ éœ€è¦å½»åº•æµ‹è¯•ä½ çš„æˆæƒç­–ç•¥è·¯å¾„ã€‚ç™¾åˆ†æ¯”ç¼–ç çš„æ–œçº¿å’Œåæ–œçº¿å­—ç¬¦ï¼ˆ&lt;code&gt;%2F&lt;/code&gt;ã€&lt;code&gt;%2f&lt;/code&gt;ã€&lt;code&gt;%5C&lt;/code&gt; å’Œ &lt;code&gt;%5c&lt;/code&gt;ï¼‰åœ¨ MERGE_SLASHES è¢«è§„èŒƒåŒ–ä¹‹å‰è¢«è§£ç ä¸º &lt;code&gt;/&lt;/code&gt; æˆ– &lt;code&gt;\&lt;/code&gt;ã€‚&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;/a%2fb&lt;/code&gt; è¢«è§„èŒƒåŒ–ä¸º &lt;code&gt;/a/b&lt;/code&gt;ã€‚&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¯¥é…ç½®æ˜¯é€šè¿‡ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mesh é…ç½®&lt;/a&gt;ä¸­çš„ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig-ProxyPathNormalization&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;pathNormalization&lt;/code&gt;&lt;/a&gt;å­—æ®µæŒ‡å®šçš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¼ºè°ƒè¿™ä¸€ç‚¹ï¼Œè§„èŒƒåŒ–ç®—æ³•æ˜¯æŒ‰ç…§ä»¥ä¸‹é¡ºåºè¿›è¡Œçš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç™¾åˆ†æ¯”è§£ç  &lt;code&gt;%2F&lt;/code&gt;ã€&lt;code&gt;%2f&lt;/code&gt;ã€&lt;code&gt;%5C&lt;/code&gt; å’Œ &lt;code&gt;%5c&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc3986&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 3986&lt;/a&gt; å’Œå…¶ä»–ç”± Envoy çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/network/http_connection_manager/v3/http_connection_manager.proto#envoy-v3-api-field-extensions-filters-network-http-connection-manager-v3-httpconnectionmanager-normalize-path&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;normalize_path&lt;/code&gt;&lt;/a&gt;é€‰é¡¹å®ç°çš„è§„èŒƒåŒ–ã€‚&lt;/li&gt;
&lt;li&gt;åˆå¹¶æ–œçº¿&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;è™½ç„¶è¿™äº›è§„èŒƒåŒ–é€‰é¡¹ä»£è¡¨äº†æ¥è‡ª HTTP æ ‡å‡†å’Œå¸¸è§è¡Œä¸šæƒ¯ä¾‹çš„å»ºè®®ï¼Œä½†åº”ç”¨ç¨‹åºå¯ä»¥ä»¥å®ƒé€‰æ‹©çš„ä»»ä½•æ–¹å¼è§£é‡Šä¸€ä¸ª URLã€‚å½“ä½¿ç”¨æ‹’ç»ç­–ç•¥æ—¶ï¼Œè¯·ç¡®ä¿ä½ äº†è§£ä½ çš„åº”ç”¨ç¨‹åºçš„è¡Œä¸ºæ–¹å¼ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h3 id=&#34;é…ç½®çš„ä¾‹å­&#34;&gt;é…ç½®çš„ä¾‹å­&lt;/h3&gt;
&lt;p&gt;ç¡®ä¿ Envoy è§„èŒƒåŒ–è¯·æ±‚è·¯å¾„ä»¥ç¬¦åˆä½ çš„åç«¯æœåŠ¡çš„æœŸæœ›ï¼Œå¯¹ä½ çš„ç³»ç»Ÿå®‰å…¨è‡³å…³é‡è¦ã€‚ä¸‹é¢çš„ä¾‹å­å¯ä»¥ä½œä¸ºä½ é…ç½®ç³»ç»Ÿçš„å‚è€ƒã€‚è§„èŒƒåŒ–çš„ URL è·¯å¾„ï¼Œå¦‚æœé€‰æ‹©äº† &lt;code&gt;NONE&lt;/code&gt;ï¼Œåˆ™æ˜¯åŸå§‹çš„ URL è·¯å¾„å°†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æ¥å¯¹ç…§æˆæƒç­–ç•¥è¿›è¡Œæ£€æŸ¥&lt;/li&gt;
&lt;li&gt;è½¬å‘åˆ°åç«¯åº”ç”¨ç¨‹åº&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;ä½ çš„åº”ç”¨ç¨‹åº&lt;/th&gt;
          &lt;th&gt;é€‰æ‹©&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;ä¾é ä»£ç†è¿›è¡Œè§„èŒƒåŒ–å¤„ç†&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;BASE&lt;/code&gt;, &lt;code&gt;MERGE_SLASHES&lt;/code&gt; or &lt;code&gt;DECODE_AND_MERGE_SLASHES&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ ¹æ® &lt;a href=&#34;https://tools.ietf.org/html/rfc3986&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 3986&lt;/a&gt; è§„èŒƒåŒ–è¯·æ±‚è·¯å¾„ï¼Œä¸åˆå¹¶æ–œçº¿&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;BASE&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ ¹æ® &lt;a href=&#34;https://tools.ietf.org/html/rfc3986&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 3986&lt;/a&gt; è§„èŒƒåŒ–è¯·æ±‚è·¯å¾„ï¼Œåˆå¹¶æ–œçº¿ï¼Œä½†ä¸å¯¹&lt;a href=&#34;https://tools.ietf.org/html/rfc3986#section-2.1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç™¾åˆ†æ¯”ç¼–ç &lt;/a&gt;çš„æ–œçº¿è¿›è¡Œè§£ç &lt;/td&gt;
          &lt;td&gt;&lt;code&gt;MERGE_SLASHES&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ ¹æ® &lt;a href=&#34;https://tools.ietf.org/html/rfc3986&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 3986&lt;/a&gt; è§„èŒƒåŒ–è¯·æ±‚è·¯å¾„ï¼Œåˆå¹¶æ–œçº¿ï¼Œå¹¶å¯¹&lt;a href=&#34;https://tools.ietf.org/html/rfc3986#section-2.1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç™¾åˆ†æ¯”ç¼–ç &lt;/a&gt;çš„æ–œçº¿è¿›è¡Œè§£ç &lt;/td&gt;
          &lt;td&gt;&lt;code&gt;DECODE_AND_MERGE_SLASHES&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å¤„ç†è¯·æ±‚è·¯å¾„çš„æ–¹å¼ä¸ &lt;a href=&#34;https://tools.ietf.org/html/rfc3986&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 3986&lt;/a&gt; ä¸å…¼å®¹&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;NONE&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;å¦‚ä½•é…ç½®&#34;&gt;å¦‚ä½•é…ç½®&lt;/h3&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt; æ¥æ›´æ–° &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mesh é…ç½®&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ istioctl upgrade --set meshConfig.pathNormalization.normalization=DECODE_AND_MERGE_SLASHES
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ–é€šè¿‡æ”¹å˜ä½ çš„ Operator é‡å†™æ–‡ä»¶&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;$ cat &amp;lt;&amp;lt;EOF &amp;gt; iop.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meshConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;pathNormalization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;normalization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DECODE_AND_MERGE_SLASHES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;$ istioctl install -f iop.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦å¤–ï¼Œå¦‚æœä½ æƒ³ç›´æ¥ç¼–è¾‘ Mesh é…ç½®ï¼Œä½ å¯ä»¥å°† &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig-ProxyPathNormalization&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;pathNormalization&lt;/code&gt;&lt;/a&gt;æ·»åŠ åˆ° &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mesh é…ç½®&lt;/a&gt;ä¸­ï¼Œè¯¥é…ç½®æ˜¯ &lt;code&gt;istio-&amp;lt;REVISION_ID&amp;gt;&lt;/code&gt; çš„ CongfigMapï¼Œåœ¨ &lt;code&gt;istio-system&lt;/code&gt; å‘½åç©ºé—´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ é€‰æ‹© &lt;code&gt;DECODE_AND_MERGE_SLASHES&lt;/code&gt; é€‰é¡¹ï¼Œä½ ä¿®æ”¹ mesh é…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mesh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|-&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      pathNormalization:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        normalization: DECODE_AND_MERGE_SLASHES
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      ...      &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä¸å¤ªå¸¸è§çš„è§„èŒƒåŒ–é…ç½®&#34;&gt;ä¸å¤ªå¸¸è§çš„è§„èŒƒåŒ–é…ç½®&lt;/h3&gt;
&lt;h4 id=&#34;å¤§å°å†™è§„èŒƒåŒ–&#34;&gt;å¤§å°å†™è§„èŒƒåŒ–&lt;/h4&gt;
&lt;p&gt;åœ¨æŸäº›ç¯å¢ƒä¸­ï¼Œä»¥ä¸åŒºåˆ†å¤§å°å†™çš„æ–¹å¼æ¯”è¾ƒæˆæƒç­–ç•¥ä¸­çš„è·¯å¾„å¯èƒ½æ˜¯æœ‰ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œå°† &lt;code&gt;https://myurl/get&lt;/code&gt; å’Œ &lt;code&gt;https://myurl/GeT&lt;/code&gt; ç­‰åŒå¯¹å¾…ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ &lt;code&gt;EnvoyFilter&lt;/code&gt;ã€‚è¿™ä¸ªè¿‡æ»¤å™¨å°†æ”¹å˜ç”¨äºæ¯”è¾ƒçš„è·¯å¾„å’Œå‘ˆç°ç»™åº”ç”¨ç¨‹åºçš„è·¯å¾„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EnvoyFilter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress-case-insensitive&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configPatches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;applyTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP_FILTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;GATEWAY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filterChain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.network.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subFilter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.http.router&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;INSERT_BEFORE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.lua&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.filters.http.lua.v3.Lua&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;inlineCode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              function envoy_on_request(request_handle)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                local path = request_handle:headers():get(&amp;#34;:path&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                request_handle:headers():replace(&amp;#34;:path&amp;#34;, string.lower(path))
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              end              &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;äº†è§£æµé‡é‡‡é›†çš„é™åˆ¶&#34;&gt;äº†è§£æµé‡é‡‡é›†çš„é™åˆ¶&lt;/h2&gt;
&lt;p&gt;Istio sidecar çš„å·¥ä½œåŸç†æ˜¯æ•è·å…¥ç«™æµé‡å’Œå‡ºç«™æµé‡ï¼Œå¹¶é€šè¿‡ sidecar ä»£ç†å¼•å¯¼å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æµé‡éƒ½è¢«æ•è·ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡å®šå‘åªå¤„ç†åŸºäº TCP çš„æµé‡ã€‚ä»»ä½• UDP æˆ– ICMP æ•°æ®åŒ…éƒ½ä¸ä¼šè¢«æ•è·æˆ–ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/ops/deployment/requirements/#ports-used-by-istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sidecar ä½¿ç”¨çš„è®¸å¤šç«¯å£&lt;/a&gt;ä»¥åŠ 22 å·ç«¯å£çš„å…¥ç«™æ•è·è¢«ç¦ç”¨ã€‚è¿™ä¸ªåˆ—è¡¨å¯ä»¥é€šè¿‡ &lt;code&gt;traffic.sidecar.istio.io/excludeInboundPorts&lt;/code&gt; ç­‰é€‰é¡¹æ¥æ‰©å±•ã€‚&lt;/li&gt;
&lt;li&gt;å‡ºç«™æ•è·åŒæ ·å¯ä»¥é€šè¿‡ &lt;code&gt;traffic.sidecar.istio.io/excludeOutboundPorts&lt;/code&gt; ç­‰è®¾ç½®æˆ–å…¶ä»–æ–¹å¼å‡å°‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œåº”ç”¨ç¨‹åºå’Œå…¶ sidecar ä»£ç†ä¹‹é—´çš„å®‰å…¨è¾¹ç•Œæœ€å°ã€‚å¯¹ sidecar çš„é…ç½®æ˜¯ä»¥æ¯ä¸ªæ¨¡å—ä¸ºåŸºç¡€çš„ï¼Œå¹¶ä¸”ä¸¤è€…éƒ½åœ¨åŒä¸€ä¸ªç½‘ç»œ / è¿›ç¨‹å‘½åç©ºé—´ä¸­è¿è¡Œã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½æœ‰èƒ½åŠ›åˆ é™¤é‡å®šå‘è§„åˆ™ï¼Œå¹¶åˆ é™¤ã€æ”¹å˜ã€ç»ˆæ­¢æˆ–æ›¿æ¢ sidecar ä»£ç†ã€‚è¿™å…è®¸ä¸€ä¸ª pod æ•…æ„ç»•è¿‡å®ƒçš„ sidecar çš„å‡ºç«™æµé‡æˆ–æ•…æ„è®©å…¥ç«™æµé‡ç»•è¿‡å®ƒçš„ sidecarã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œä¾é  Istio æ— æ¡ä»¶åœ°æ•è·æ‰€æœ‰æµé‡æ˜¯ä¸å®‰å…¨çš„ã€‚ç›¸åï¼Œå®‰å…¨è¾¹ç•Œæ˜¯å®¢æˆ·ç«¯ä¸èƒ½ç»•è¿‡å¦ä¸€ä¸ª pod çš„ sidecarã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘åœ¨ 9080 ç«¯å£è¿è¡Œ &lt;code&gt;review&lt;/code&gt; åº”ç”¨ç¨‹åºï¼Œæˆ‘å¯ä»¥å‡è®¾æ¥è‡ª &lt;code&gt;productpage&lt;/code&gt; åº”ç”¨ç¨‹åºçš„æ‰€æœ‰æµé‡å°†è¢« sidecar ä»£ç†æ•è·ï¼Œå…¶ä¸­ Istio è®¤è¯å’Œæˆæƒç­–ç•¥å¯èƒ½é€‚ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ©ç”¨-networkpolicy-è¿›è¡Œæ·±åº¦é˜²å¾¡&#34;&gt;åˆ©ç”¨ &lt;code&gt;NetworkPolicy&lt;/code&gt; è¿›è¡Œæ·±åº¦é˜²å¾¡&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†è¿›ä¸€æ­¥ç¡®ä¿æµé‡å®‰å…¨ï¼ŒIstio ç­–ç•¥å¯ä»¥ä¸ Kubernetes &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/network-policies/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘ç»œç­–ç•¥&lt;/a&gt;åˆ†å±‚ã€‚è¿™å®ç°äº†ä¸€ä¸ªå¼ºå¤§çš„&lt;a href=&#34;https://en.wikipedia.org/wiki/Defense_in_depth_%28computing%29&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·±åº¦é˜²å¾¡&lt;/a&gt;ç­–ç•¥ï¼Œå¯ä»¥ç”¨æ¥è¿›ä¸€æ­¥åŠ å¼ºä½ çš„ç½‘æ ¼çš„å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œä½ å¯ä»¥é€‰æ‹©åªå…è®¸æµé‡åˆ°æˆ‘ä»¬ &lt;code&gt;review&lt;/code&gt; åº”ç”¨ç¨‹åºçš„ &lt;code&gt;9080&lt;/code&gt; ç«¯å£ã€‚å¦‚æœé›†ç¾¤ä¸­çš„ Pod è¢«ç ´åæˆ–å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œè¿™å¯èƒ½ä¼šé™åˆ¶æˆ–é˜»æ­¢æ”»å‡»è€…çš„è¿›å±•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¡®ä¿å‡ºå£æµé‡çš„å®‰å…¨&#34;&gt;ç¡®ä¿å‡ºå£æµé‡çš„å®‰å…¨&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªå¸¸è§çš„è¯¯è§£æ˜¯ï¼Œåƒ &lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/egress/egress-control/#envoy-passthrough-to-external-services&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;outboundTrafficPolicy: REGISTRY_ONLY&lt;/code&gt;&lt;/a&gt; ä½œä¸ºä¸€ä¸ªå®‰å…¨ç­–ç•¥ï¼Œé˜²æ­¢æ‰€æœ‰å¯¹æœªç”³æŠ¥æœåŠ¡çš„è®¿é—®ã€‚ç„¶è€Œï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å®‰å…¨è¾¹ç•Œï¼Œåº”è¯¥è¢«è®¤ä¸ºæ˜¯å°½åŠ›è€Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶è¿™å¯¹é˜²æ­¢æ„å¤–çš„ä¾èµ–æ€§å¾ˆæœ‰ç”¨ï¼Œä½†å¦‚æœä½ æƒ³ä¿è¯å‡ºå£æµé‡çš„å®‰å…¨ï¼Œå¹¶å¼ºåˆ¶è¦æ±‚æ‰€æœ‰å‡ºç«™æµé‡é€šè¿‡ä»£ç†ï¼Œä½ åº”è¯¥ä¾é  &lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/egress/egress-gateway/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Egress Gateway&lt;/a&gt;ã€‚å½“ä¸&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/egress/egress-gateway/#apply-kubernetes-network-policies&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘ç»œç­–ç•¥&lt;/a&gt;ç›¸ç»“åˆæ—¶ï¼Œä½ å¯ä»¥å¼ºåˆ¶æ‰€æœ‰çš„æµé‡ï¼Œæˆ–ä¸€äº›å­é›†ï¼Œé€šè¿‡å‡ºå£ç½‘å…³ã€‚è¿™ç¡®ä¿äº†å³ä½¿å®¢æˆ·æ„å¤–åœ°æˆ–æ¶æ„åœ°ç»•è¿‡ä»–ä»¬çš„ sidecarï¼Œè¯¥è¯·æ±‚ä¹Ÿä¼šè¢«é˜»æ­¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å½“ä½¿ç”¨-tls-å‘èµ·æ—¶åœ¨ç›®çš„åœ°è§„åˆ™ä¸­é…ç½®-tls-éªŒè¯&#34;&gt;å½“ä½¿ç”¨ TLS å‘èµ·æ—¶ï¼Œåœ¨ç›®çš„åœ°è§„åˆ™ä¸­é…ç½® TLS éªŒè¯&lt;/h2&gt;
&lt;p&gt;Istio æä¾›äº†ä»ä¸€ä¸ª sidecar ä»£ç†æˆ–ç½‘å…³&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/egress/egress-tls-origination/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘èµ· TLS&lt;/a&gt; çš„èƒ½åŠ›ã€‚è¿™ä½¿å¾—å‘é€çº¯æ–‡æœ¬ HTTP æµé‡çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿé€æ˜åœ°â€œå‡çº§â€œåˆ° HTTPSã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é…ç½® &lt;code&gt;DestinationRule&lt;/code&gt; çš„ &lt;code&gt;tls&lt;/code&gt; è®¾ç½®æ—¶ï¼Œå¿…é¡»æ³¨æ„æŒ‡å®š &lt;code&gt;caCertificates&lt;/code&gt; å­—æ®µã€‚å¦‚æœæ²¡æœ‰è®¾ç½®ï¼ŒæœåŠ¡å™¨çš„è¯ä¹¦å°†ä¸ä¼šè¢«éªŒè¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;google-tls&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;google.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SIMPLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;caCertificates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/etc/ssl/certs/ca-certificates.crt&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç½‘å…³&#34;&gt;ç½‘å…³&lt;/h2&gt;
&lt;p&gt;åœ¨è¿è¡Œ Istio &lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/ingress/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘å…³&lt;/a&gt;æ—¶ï¼Œæ¶‰åŠä¸€äº›èµ„æºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Gateways&lt;/code&gt;ï¼Œå®ƒæ§åˆ¶ç½‘å…³çš„ç«¯å£å’Œ TLS è®¾ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;VirtualServices&lt;/code&gt;ï¼Œæ§åˆ¶è·¯ç”±é€»è¾‘ã€‚è¿™äº›éƒ½æ˜¯é€šè¿‡åœ¨ç½‘å…³å­—æ®µä¸­çš„ç›´æ¥å¼•ç”¨å’Œåœ¨ç½‘å…³å’Œ &lt;code&gt;VirtualService&lt;/code&gt; çš„ &lt;code&gt;hosts&lt;/code&gt; å­—æ®µä¸­çš„ç›¸äº’çº¦å®šä¸ &lt;code&gt;Gateway&lt;/code&gt; ç›¸å…³è”çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é™åˆ¶-gateway-åˆ›å»ºæƒé™&#34;&gt;é™åˆ¶ &lt;code&gt;Gateway&lt;/code&gt; åˆ›å»ºæƒé™&lt;/h3&gt;
&lt;p&gt;å»ºè®®å°† Gateway èµ„æºçš„åˆ›å»ºé™åˆ¶åœ¨å—ä¿¡ä»»çš„é›†ç¾¤ç®¡ç†å‘˜ã€‚è¿™å¯ä»¥é€šè¿‡ &lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/rbac/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes RBAC ç­–ç•¥&lt;/a&gt;æˆ– &lt;a href=&#34;https://www.openpolicyagent.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Open Policy Agent&lt;/a&gt; ç­‰å·¥å…·å®ç°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é¿å…è¿‡äºå®½æ³›çš„-hosts-é…ç½®&#34;&gt;é¿å…è¿‡äºå®½æ³›çš„ &lt;code&gt;hosts&lt;/code&gt; é…ç½®&lt;/h3&gt;
&lt;p&gt;åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œé¿å…åœ¨ &lt;code&gt;Gateway&lt;/code&gt; ä¸­è¿›è¡Œè¿‡äºå¹¿æ³›çš„ &lt;code&gt;hosts&lt;/code&gt; è®¾ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œè¿™ç§é…ç½®å°†å…è®¸ä»»ä½• VirtualService ç»‘å®šåˆ° &lt;code&gt;Gateway&lt;/code&gt;ï¼Œå¯èƒ½ä¼šæš´éœ²å‡ºæ„å¤–çš„åŸŸï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™åº”è¯¥è¢«é”å®šï¼Œåªå…è®¸ç‰¹å®šåŸŸæˆ–ç‰¹å®šå‘½åç©ºé—´ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;foo.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# åªå…è®¸ foo.example.com çš„ VirtualServices&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;default/bar.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# åªå…è®¸ default å‘½åç©ºé—´ bar.example.com çš„ VirtualServices&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;route-namespace/*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# åªå…è®¸ route-namespace å‘½åç©ºé—´çš„ VirtualServices&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éš”ç¦»æ•æ„ŸæœåŠ¡&#34;&gt;éš”ç¦»æ•æ„ŸæœåŠ¡&lt;/h3&gt;
&lt;p&gt;å¯èƒ½éœ€è¦å¯¹æ•æ„ŸæœåŠ¡å®æ–½æ›´ä¸¥æ ¼çš„ç‰©ç†éš”ç¦»ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³ä¸ºæ•æ„Ÿçš„ &lt;code&gt;payment.example.com&lt;/code&gt; è¿è¡Œä¸€ä¸ª&lt;a href=&#34;https://istio.io/latest/docs/setup/install/istioctl/#configure-gateways&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸“ç”¨çš„ç½‘å…³å®ä¾‹&lt;/a&gt;ï¼Œè€Œä¸ºä¸å¤ªæ•æ„Ÿçš„åŸŸåå¦‚ &lt;code&gt;blog.example.com&lt;/code&gt; å’Œ &lt;code&gt;store.example.com&lt;/code&gt; ä½¿ç”¨ä¸€ä¸ªå•ä¸€çš„å…±äº«ç½‘å…³å®ä¾‹ã€‚è¿™å¯ä»¥æä¾›ä¸€ä¸ªæ›´å¼ºå¤§çš„æ·±åº¦é˜²å¾¡ï¼Œå¹¶æœ‰åŠ©äºæ»¡è¶³æŸäº›ç›‘ç®¡åˆè§„å‡†åˆ™ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åœ¨æ”¾å®½çš„-sni-ä¸»æœºåŒ¹é…ä¸‹æ˜ç¡®åœ°ç¦ç”¨æ‰€æœ‰æ•æ„Ÿçš„-http-ä¸»æœº&#34;&gt;åœ¨æ”¾å®½çš„ SNI ä¸»æœºåŒ¹é…ä¸‹ï¼Œæ˜ç¡®åœ°ç¦ç”¨æ‰€æœ‰æ•æ„Ÿçš„ http ä¸»æœº&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸åŒçš„ä¸»æœºä¸Šä½¿ç”¨å¤šä¸ª &lt;code&gt;Gateways&lt;/code&gt; æ¥å®šä¹‰åŒå‘ TLS å’Œç®€å• TLS æ˜¯åˆç†çš„ã€‚ä¾‹å¦‚ï¼Œå¯¹ SNI ä¸»æœº &lt;code&gt;admin.example.com&lt;/code&gt; ä½¿ç”¨åŒå‘ TLSï¼Œå¯¹ SNI ä¸»æœº &lt;code&gt;*.example.com&lt;/code&gt; ä½¿ç”¨ç®€å• TLSã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;guestgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SIMPLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;admingateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;admin.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;MUTUAL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæœ‰å¿…è¦è¿›è¡Œä¸Šè¿°æ“ä½œï¼Œå¼ºçƒˆå»ºè®®åœ¨é™„åŠ åˆ° &lt;code&gt;*.example.com&lt;/code&gt; çš„ &lt;code&gt;VirtualService&lt;/code&gt; ä¸­æ˜ç¡®ç¦ç”¨ http ä¸»æœº &lt;code&gt;admin.example.com&lt;/code&gt;ã€‚åŸå› æ˜¯ç›®å‰åº•å±‚çš„ &lt;a href=&#34;https://github.com/envoyproxy/envoy/issues/6767&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;envoy ä»£ç†ä¸éœ€è¦&lt;/a&gt; http 1 å¤´ &lt;code&gt;Host&lt;/code&gt; æˆ– http 2 ä¼ªå¤´&lt;code&gt;:authority&lt;/code&gt; çš„ SNI çº¦æŸåï¼Œæ”»å‡»è€…å¯ä»¥é‡æ–°ä½¿ç”¨ guest-SNI TLS è¿æ¥æ¥è®¿é—® admin &lt;code&gt;VirtualService&lt;/code&gt;ã€‚http å“åº”ä»£ç  421 æ˜¯ä¸ºè¿™ç§ &lt;code&gt;Host&lt;/code&gt; SNI ä¸åŒ¹é…è€Œè®¾è®¡çš„ï¼Œå¯ä»¥ç”¨æ¥å®ç°ç¦ç”¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;disable-sensitive&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;admin.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;guestgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fault&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;abort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;percentage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;httpStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;421&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dest.default.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;åè®®æ£€æµ‹&#34;&gt;åè®®æ£€æµ‹&lt;/h2&gt;
&lt;p&gt;Istio ä¼š&lt;a href=&#34;https://istio.io/latest/docs/ops/configuration/traffic-management/protocol-selection/#automatic-protocol-selection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªåŠ¨ç¡®å®š&lt;/a&gt;å®ƒæ‰€çœ‹åˆ°çš„æµé‡çš„&lt;a href=&#34;https://istio.io/latest/docs/ops/configuration/traffic-management/protocol-selection/#automatic-protocol-selection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åè®®&lt;/a&gt;ã€‚ä¸ºäº†é¿å…æ„å¤–æˆ–æ•…æ„çš„æ¼æ£€ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„æµé‡è¡Œä¸ºï¼Œå»ºè®®åœ¨å¯èƒ½çš„æƒ…å†µä¸‹&lt;a href=&#34;https://istio.io/latest/docs/ops/configuration/traffic-management/protocol-selection/#explicit-protocol-selection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ˜ç¡®å£°æ˜åè®®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;cni&#34;&gt;CNI&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†é€æ˜åœ°æ•è·æ‰€æœ‰æµé‡ï¼ŒIstio ä¾èµ–äº &lt;code&gt;istio-init&lt;/code&gt; &lt;code&gt;initContainer&lt;/code&gt; æ‰€é…ç½®çš„ &lt;code&gt;iptables&lt;/code&gt; è§„åˆ™ã€‚è¿™å¢åŠ äº†ä¸€ä¸ª&lt;a href=&#34;https://istio.io/latest/docs/ops/deployment/requirements/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¦æ±‚&lt;/a&gt;ï¼Œå³ &lt;code&gt;NET_ADMIN&lt;/code&gt; å’Œ &lt;code&gt;NET_RAW&lt;/code&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-capabilities-for-a-container&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çš„èƒ½åŠ›&lt;/a&gt;å¿…é¡»å¯¹ pod å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å‡å°‘æˆäºˆ pod çš„æƒé™ï¼ŒIstio æä¾›äº†ä¸€ä¸ª &lt;a href=&#34;https://istio.io/latest/docs/setup/additional-setup/cni/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNI æ’ä»¶&lt;/a&gt;ï¼Œå®ƒæ¶ˆé™¤äº†è¿™ä¸ªè¦æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;Istio CNI æ’ä»¶ç›®å‰æ˜¯ä¸€ä¸ª alpha åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨åŠ å›ºçš„-docker-é•œåƒ&#34;&gt;ä½¿ç”¨åŠ å›ºçš„ docker é•œåƒ&lt;/h2&gt;
&lt;p&gt;Istio çš„é»˜è®¤ docker é•œåƒï¼ŒåŒ…æ‹¬é‚£äº›ç”±æ§åˆ¶å¹³é¢ã€ç½‘å…³å’Œ sidecar ä»£ç†è¿è¡Œçš„é•œåƒï¼Œéƒ½æ˜¯åŸºäº ubuntu çš„ã€‚è¿™æä¾›äº†å„ç§å·¥å…·ï¼Œå¦‚ bash å’Œ curlï¼Œè¿™ä»¥æ–¹ä¾¿ä¸ºä»£ä»·ï¼Œå¢åŠ äº†æ”»å‡»é¢ã€‚&lt;/p&gt;
&lt;p&gt;Istio è¿˜æä¾›äº†ä¸€ä¸ªåŸºäº&lt;a href=&#34;https://istio.io/latest/docs/ops/configuration/security/harden-docker-images/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ— å‘è¡Œç‰ˆé•œåƒçš„&lt;/a&gt;å°å‹é•œåƒï¼Œå‡å°‘äº†é•œåƒä¸­çš„ä¾èµ–æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æ— å‘è¡Œç‰ˆçš„é•œåƒç›®å‰æ˜¯ä¸€ä¸ª alpha åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‘å¸ƒå’Œå®‰å…¨ç­–ç•¥&#34;&gt;å‘å¸ƒå’Œå®‰å…¨ç­–ç•¥&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†ç¡®ä¿ä½ çš„é›†ç¾¤æœ‰æœ€æ–°çš„å·²çŸ¥æ¼æ´çš„å®‰å…¨è¡¥ä¸ï¼Œé‡è¦çš„æ˜¯ä¿æŒåœ¨ Istio çš„æœ€æ–°è¡¥ä¸ç‰ˆæœ¬ä¸Šï¼Œå¹¶ç¡®ä¿ä½ åœ¨ä¸€ä¸ª&lt;a href=&#34;https://istio.io/latest/docs/releases/supported-releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ”¯æŒçš„ç‰ˆæœ¬&lt;/a&gt;ä¸Šï¼Œä»åœ¨æ¥æ”¶å®‰å…¨è¡¥ä¸ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ£€æµ‹æ— æ•ˆé…ç½®&#34;&gt;æ£€æµ‹æ— æ•ˆé…ç½®&lt;/h2&gt;
&lt;p&gt;è™½ç„¶ Istio åœ¨åˆ›å»ºèµ„æºæ—¶æä¾›äº†éªŒè¯ï¼Œä½†è¿™äº›æ£€æŸ¥ä¸èƒ½æŠ“ä½æ‰€æœ‰é˜»æ­¢é…ç½®åœ¨ç½‘æ ¼ä¸­åˆ†å¸ƒçš„é—®é¢˜ã€‚è¿™å¯èƒ½å¯¼è‡´åº”ç”¨çš„ç­–ç•¥è¢«æ„å¤–åœ°å¿½ç•¥ï¼Œä»è€Œå¯¼è‡´æ„å¤–çš„ç»“æœã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨åº”ç”¨é…ç½®ä¹‹å‰æˆ–ä¹‹åè¿è¡Œ &lt;code&gt;istioctl analyze&lt;/code&gt;ï¼Œä»¥ç¡®ä¿é…ç½®æœ‰æ•ˆã€‚&lt;/li&gt;
&lt;li&gt;ç›‘æ§æ§åˆ¶å¹³é¢çš„æ‹’ç»é…ç½®ã€‚é™¤äº†æ—¥å¿—ä¹‹å¤–ï¼Œè¿™äº›éƒ½æ˜¯é€šè¿‡ &lt;code&gt;pilot_total_xds_rejects&lt;/code&gt; æŒ‡æ ‡æ¥æ˜¾ç¤ºçš„ã€‚&lt;/li&gt;
&lt;li&gt;æµ‹è¯•ä½ çš„é…ç½®ï¼Œä»¥ç¡®ä¿å®ƒç»™å‡ºé¢„æœŸçš„ç»“æœã€‚å¯¹äºå®‰å…¨ç­–ç•¥æ¥è¯´ï¼Œè¿è¡Œæ­£é¢å’Œè´Ÿé¢çš„æµ‹è¯•æ˜¯æœ‰ç”¨çš„ï¼Œä»¥ç¡®ä¿ä½ ä¸ä¼šæ„å¤–åœ°é™åˆ¶è¿‡å¤šæˆ–è¿‡å°‘çš„æµé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é¿å…-alpha-å’Œå®éªŒæ€§åŠŸèƒ½&#34;&gt;é¿å… alpha å’Œå®éªŒæ€§åŠŸèƒ½&lt;/h2&gt;
&lt;p&gt;æ‰€æœ‰ Istio åŠŸèƒ½å’Œ API éƒ½è¢«åˆ†é…äº†ä¸€ä¸ª&lt;a href=&#34;https://istio.io/latest/docs/releases/feature-stages/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠŸèƒ½çŠ¶æ€&lt;/a&gt;ï¼Œå®šä¹‰äº†å®ƒçš„ç¨³å®šæ€§ã€åºŸæ­¢æ”¿ç­–å’Œå®‰å…¨æ”¿ç­–ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äº alpha å’Œå®éªŒæ€§åŠŸèƒ½æ²¡æœ‰é‚£ä¹ˆå¼ºçš„å®‰å…¨ä¿è¯ï¼Œå»ºè®®å°½å¯èƒ½é¿å…ä½¿ç”¨å®ƒä»¬ã€‚åœ¨è¿™äº›åŠŸèƒ½ä¸­å‘ç°çš„å®‰å…¨é—®é¢˜å¯èƒ½ä¸ä¼šè¢«ç«‹å³ä¿®å¤ï¼Œæˆ–è€…ä¸éµå¾ªæˆ‘ä»¬çš„æ ‡å‡†&lt;a href=&#34;https://istio.io/latest/docs/releases/security-vulnerabilities/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰å…¨æ¼æ´&lt;/a&gt;ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;è¦ç¡®å®šåœ¨ä½ çš„é›†ç¾¤ä¸­ä½¿ç”¨çš„åŠŸèƒ½çŠ¶æ€ï¼Œè¯·æŸ¥é˜… &lt;a href=&#34;https://istio.io/latest/docs/releases/feature-stages/#istio-features&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åŠŸèƒ½&lt;/a&gt;åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é”å®šç«¯å£&#34;&gt;é”å®šç«¯å£&lt;/h2&gt;
&lt;p&gt;Istio é…ç½®äº†&lt;a href=&#34;https://istio.io/latest/docs/ops/deployment/requirements/#ports-used-by-istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å„ç§&lt;/a&gt;å¯èƒ½è¢«é”å®šçš„&lt;a href=&#34;https://istio.io/latest/docs/ops/deployment/requirements/#ports-used-by-istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç«¯å£&lt;/a&gt;ï¼Œä»¥æé«˜å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ§åˆ¶å¹³é¢&#34;&gt;æ§åˆ¶å¹³é¢&lt;/h3&gt;
&lt;p&gt;Istiod ä¸ºæ–¹ä¾¿èµ·è§ï¼Œé»˜è®¤æš´éœ²äº†å‡ ä¸ªæœªç»è®¤è¯çš„æ˜æ–‡ç«¯å£ã€‚å¦‚æœéœ€è¦ï¼Œè¿™äº›ç«¯å£å¯ä»¥è¢«å…³é—­ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;8080&lt;/code&gt; ç«¯å£æš´éœ²äº†è°ƒè¯•æ¥å£ï¼Œå®ƒæä¾›äº†å¯¹é›†ç¾¤çŠ¶æ€çš„å„ç§ç»†èŠ‚çš„è¯»å–æƒé™ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ Istiod ä¸Šè®¾ç½®ç¯å¢ƒå˜é‡ &lt;code&gt;ENABLE_DEBUG_ON_HTTP=false&lt;/code&gt; æ¥ç¦ç”¨ã€‚è­¦å‘Šï¼šè®¸å¤š &lt;code&gt;istioctl&lt;/code&gt; å‘½ä»¤éƒ½ä¾èµ–äºè¿™ä¸ªæ¥å£ï¼Œå¦‚æœå®ƒè¢«ç¦ç”¨ï¼Œå°†æ— æ³•è¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;15010&lt;/code&gt; ç«¯å£é€šè¿‡æ˜æ–‡æš´éœ² XDS æœåŠ¡ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ Istiod éƒ¨ç½²ä¸­æ·»åŠ  &lt;code&gt;--grpcAddr=&amp;quot;&amp;quot;&lt;/code&gt; æ ‡å¿—æ¥ç¦ç”¨ã€‚æ³¨æ„ï¼šé«˜åº¦æ•æ„Ÿçš„æœåŠ¡ï¼Œå¦‚è¯ä¹¦ç­¾ç½²å’Œåˆ†å‘æœåŠ¡ï¼Œç»ä¸é€šè¿‡æ˜æ–‡æä¾›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ•°æ®å¹³é¢&#34;&gt;æ•°æ®å¹³é¢&lt;/h3&gt;
&lt;p&gt;è¯¥ä»£ç†æš´éœ²äº†å„ç§ç«¯å£ã€‚å¯¹å¤–æš´éœ²çš„æ˜¯ &lt;code&gt;15090&lt;/code&gt; ç«¯å£ï¼ˆé¥æµ‹ï¼‰å’Œ &lt;code&gt;15021&lt;/code&gt; ç«¯å£ï¼ˆå¥åº·æ£€æŸ¥ï¼‰ã€‚ç«¯å£ &lt;code&gt;15020&lt;/code&gt; å’Œ &lt;code&gt;15000&lt;/code&gt; æä¾›è°ƒè¯•ç«¯ç‚¹ã€‚è¿™äº›ç«¯å£åªåœ¨æœ¬åœ°ä¸»æœºä¸Šæš´éœ²ã€‚å› æ­¤ï¼Œè¿è¡Œåœ¨ä¸ä»£ç†ç›¸åŒçš„ pod ä¸­çš„åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®ï¼›åœ¨ sidecar å’Œåº”ç”¨ç¨‹åºä¹‹é—´æ²¡æœ‰ä¿¡ä»»è¾¹ç•Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;é…ç½®ç¬¬ä¸‰æ–¹æœåŠ¡è´¦æˆ·ä»¤ç‰Œ&#34;&gt;é…ç½®ç¬¬ä¸‰æ–¹æœåŠ¡è´¦æˆ·ä»¤ç‰Œ&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†ä¸ Istio æ§åˆ¶å¹³é¢è¿›è¡Œè®¤è¯ï¼ŒIstio ä»£ç†å°†ä½¿ç”¨æœåŠ¡è´¦æˆ·ä»¤ç‰Œã€‚Kubernetes æ”¯æŒè¿™ç§ä»¤ç‰Œçš„ä¸¤ç§å½¢å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸‰æ–¹ä»¤ç‰Œï¼Œæœ‰ä¸€ä¸ªèŒƒå›´å†…çš„å—ä¼—å’Œåˆ°æœŸæ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸€æ–¹ä»¤ç‰Œï¼Œæ²¡æœ‰è¿‡æœŸï¼Œå¹¶è¢«å®‰è£…åˆ°æ‰€æœ‰çš„ Pod ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±äºç¬¬ä¸€æ–¹ä»¤ç‰Œçš„å±æ€§ä¸å¤ªå®‰å…¨ï¼ŒIstio å°†é»˜è®¤ä½¿ç”¨ç¬¬ä¸‰æ–¹ä»¤ç‰Œã€‚ç„¶è€Œï¼Œè¿™ä¸ªåŠŸèƒ½å¹¶ä¸æ˜¯åœ¨æ‰€æœ‰çš„ Kubernetes å¹³å°ä¸Šéƒ½å¯ç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ ä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt; æ¥å®‰è£…ï¼Œå°†ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°æ”¯æŒã€‚è¿™ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®Œæˆï¼Œé€šè¿‡ä¼ é€’ &lt;code&gt;--set values.global.jwtPolicy=third-party-jwt&lt;/code&gt; æˆ– -&lt;code&gt;-set values.global.jwtPolicy=first-party-jwt&lt;/code&gt; è¿›è¡Œé…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;è¦ç¡®å®šä½ çš„é›†ç¾¤æ˜¯å¦æ”¯æŒç¬¬ä¸‰æ–¹ä»¤ç‰Œï¼Œå¯»æ‰¾ &lt;code&gt;TokenRequest&lt;/code&gt; APIã€‚å¦‚æœè¿™æ²¡æœ‰è¿”å›å“åº”ï¼Œé‚£ä¹ˆè¯¥åŠŸèƒ½å°±ä¸è¢«æ”¯æŒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get --raw /api/v1 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq &lt;span class=&#34;s1&#34;&gt;&amp;#39;.resources[] | select(.name | index(&amp;#34;serviceaccounts/token&amp;#34;))&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;serviceaccounts/token&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;singularName&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;namespaced&amp;#34;&lt;/span&gt;: true,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;group&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;authentication.k8s.io&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;version&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;v1&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;kind&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;TokenRequest&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;verbs&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;create&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è™½ç„¶ç°åœ¨å¤§å¤šæ•°äº‘æä¾›å•†éƒ½æ”¯æŒè¿™ä¸€åŠŸèƒ½ï¼Œä½†åœ¨ Kubernetes 1.20 ä¹‹å‰ï¼Œè®¸å¤šæœ¬åœ°å¼€å‘å·¥å…·å’Œè‡ªå®šä¹‰å®‰è£…å¯èƒ½ä¸æ”¯æŒã€‚è¦å¯ç”¨è¯¥åŠŸèƒ½ï¼Œè¯·å‚è€ƒ &lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#service-account-token-volume-projection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é…ç½®ä¸‹æ¸¸è¿æ¥çš„é™åˆ¶&#34;&gt;é…ç½®ä¸‹æ¸¸è¿æ¥çš„é™åˆ¶&lt;/h2&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstioï¼ˆå’Œ Envoyï¼‰å¯¹ä¸‹æ¸¸è¿æ¥çš„æ•°é‡æ²¡æœ‰é™åˆ¶ã€‚è¿™å¯èƒ½è¢«æ¶æ„è¡Œä¸ºè€…åˆ©ç”¨ï¼ˆè§&lt;a href=&#34;https://istio.io/latest/news/security/istio-security-2020-007/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰å…¨å…¬å‘Š 2020-007&lt;/a&gt;ï¼‰ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¿…é¡»ä¸ºä½ çš„ç¯å¢ƒé…ç½®ä¸€ä¸ªé€‚å½“çš„è¿æ¥é™åˆ¶ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡ä¸‹è½½ &lt;a href=&#34;https://istio.io/latest/news/security/istio-security-2020-007/custom-bootstrap-runtime.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;custom-bootstrap-runtime.yaml &lt;/a&gt;åˆ›å»ºä¸€ä¸ª ConfigMapã€‚æ ¹æ®ä½ çš„éƒ¨ç½²ä¸­å„ä¸ªç½‘å…³å®ä¾‹æ‰€éœ€çš„å¹¶å‘è¿æ¥æ•°ï¼Œæ›´æ–° ConfigMap ä¸­çš„ &lt;code&gt;global_downstream_max_connections&lt;/code&gt;ã€‚ä¸€æ—¦è¾¾åˆ°é™åˆ¶ï¼ŒEnvoy å°†å¼€å§‹æ‹’ç» tcp è¿æ¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n istio-system apply -f custom-bootstrap-runtime.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…¥å£ç½‘å…³éƒ¨ç½²æ‰“è¡¥ä¸ï¼Œä»¥ä½¿ç”¨ä¸Šè¿°é…ç½®ã€‚ä¸‹è½½ &lt;a href=&#34;https://istio.io/latest/news/security/istio-security-2020-007/gateway-patch.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gateway-patch.yaml&lt;/a&gt; å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åº”ç”¨å®ƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl --namespace istio-system patch deployment istio-ingressgateway --patch &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;cat gateway-patch.yaml&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¡®è®¤æ–°çš„é™åˆ¶å·²ç»åˆ°ä½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;ISTIO_INGRESS_PODNAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pods -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istio-ingressgateway -n istio-system  -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[0].metadata.name}&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl --namespace istio-system &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -i -t  &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;ISTIO_INGRESS_PODNAME&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; -c istio-proxy -- curl -sS http://localhost:15000/runtime
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;entries&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;overload.global_downstream_max_connections&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;layer_values&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;250000&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;final_value&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;250000&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;layers&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;static_layer_0&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;admin&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>Istio é¦–æ¬¡å®‰å…¨è¯„ä¼°ç»“æœå…¬å¸ƒ</title>
      <link>https://cloudnativecn.com/blog/istio-first-security-assessment/</link>
      <pubDate>Thu, 22 Jul 2021 10:42:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-first-security-assessment/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ª Istio ç¤¾åŒºå®˜æ–¹åšå®¢ &lt;a href=&#34;https://istio.io/latest/blog/2021/ncc-security-assessment/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Announcing the results of Istioâ€™s first security assessment&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Istio æœåŠ¡ç½‘æ ¼å·²åœ¨å„è¡Œå„ä¸šè·å¾—å¹¿æ³›çš„ç”Ÿäº§åº”ç”¨ã€‚è¯¥é¡¹ç›®çš„æˆåŠŸï¼Œä»¥åŠå…¶åœ¨åŸºç¡€è®¾æ–½ä¸­æ‰§è¡Œå…³é”®å®‰å…¨ç­–ç•¥çš„é‡è¦ç”¨é€”ï¼Œéƒ½éœ€è¦å¯¹ä¸è¯¥é¡¹ç›®ç›¸å…³çš„å®‰å…¨é£é™©è¿›è¡Œå…¬å¼€å’Œä¸­ç«‹çš„è¯„ä¼°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼ŒIstio ç¤¾åŒºå»å¹´ä¸ &lt;a href=&#34;https://www.nccgroup.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NCC é›†å›¢&lt;/a&gt;ç­¾çº¦ï¼Œå¯¹è¯¥é¡¹ç›®è¿›è¡Œç¬¬ä¸‰æ–¹å®‰å…¨è¯„ä¼°ã€‚å®¡æŸ¥çš„ç›®æ ‡æ˜¯â€œç¡®å®šä¸ Istio ä»£ç åº“æœ‰å…³çš„å®‰å…¨é—®é¢˜ï¼Œçªå‡ºç®¡ç†å‘˜å¸¸ç”¨çš„é«˜é£é™©é…ç½®ï¼Œå¹¶æä¾›å…³äºå®‰å…¨åŠŸèƒ½æ˜¯å¦å……åˆ†è§£å†³å®ƒä»¬æ—¨åœ¨æä¾›çš„é—®é¢˜çš„è§‚ç‚¹â€ã€‚&lt;/p&gt;
&lt;p&gt;NCC é›†å›¢åœ¨ Istio ç¤¾åŒºçš„é¢†åŸŸä¸“å®¶çš„åä½œä¸‹ï¼Œè¿›è¡Œäº†ä¸ºæœŸäº”å‘¨çš„å®¡æŸ¥ã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶æŠ¥å‘Šçš„ä¸»è¦å‘ç°ï¼Œä¸ºå®æ–½å„ç§ä¿®å¤å’Œå»ºè®®è€Œé‡‡å–çš„è¡ŒåŠ¨ï¼Œä»¥åŠæˆ‘ä»¬å¯¹ Istio é¡¹ç›®çš„æŒç»­å®‰å…¨è¯„ä¼°å’Œæ”¹è¿›çš„è¡ŒåŠ¨è®¡åˆ’ã€‚ä½ å¯ä»¥ä¸‹è½½å¹¶é˜…è¯»&lt;a href=&#34;https://istio.io/latest/blog/2021/ncc-security-assessment/NCC_Group_Google_GOIST2005_Report_2020-08-06_v1.1.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰å…¨è¯„ä¼°æŠ¥å‘Šçš„æœªåˆ èŠ‚ç‰ˆæœ¬&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;èŒƒå›´å’Œä¸»è¦å‘ç°&#34;&gt;èŒƒå›´å’Œä¸»è¦å‘ç°&lt;/h2&gt;
&lt;p&gt;æœ¬æ¬¡è¯„ä¼°ä»æ•´ä½“ä¸Šè¯„ä¼°äº† Istio æ¶æ„çš„å®‰å…¨ç›¸å…³é—®é¢˜ï¼Œé‡ç‚¹æ˜¯ Istiodï¼ˆPilotï¼‰ã€Ingress/Egress ç½‘å…³ç­‰å…³é”®ç»„ä»¶ï¼Œä»¥åŠ Istio ä½œä¸ºæ•°æ®å¹³é¢ä»£ç†çš„æ•´ä½“ Envoy ä½¿ç”¨æƒ…å†µã€‚æ­¤å¤–ï¼Œè¿˜å®¡è®¡äº† Istio çš„æ–‡æ¡£ï¼ŒåŒ…æ‹¬å®‰å…¨æŒ‡å—ï¼Œä»¥ç¡®ä¿å…¶æ­£ç¡®æ€§å’Œæ¸…æ™°æ€§ã€‚è¯¥æŠ¥å‘Šæ˜¯é’ˆå¯¹ Istio 1.6.5 ç‰ˆæœ¬ç¼–åˆ¶çš„ï¼Œæ­¤åï¼Œéšç€æ–°æ¼æ´çš„æŠ«éœ²ï¼Œäº§å“å®‰å…¨å·¥ä½œç»„å‘å¸ƒäº†å‡ ä¸ªå®‰å…¨ç‰ˆæœ¬ï¼ŒåŒæ—¶è¿˜é’ˆå¯¹æ–°æŠ¥å‘Šä¸­æå‡ºçš„é—®é¢˜è¿›è¡Œäº†ä¿®å¤ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æŠ¥å‘Šçš„ä¸€ä¸ªé‡è¦ç»“è®ºæ˜¯ï¼Œå®¡è®¡äººå‘˜åœ¨ Istio é¡¹ç›®ä¸­æ²¡æœ‰å‘ç°â€œå…³é”®â€œé—®é¢˜ã€‚è¿™ä¸€å‘ç°éªŒè¯äº† Istio çš„äº§å“å®‰å…¨å·¥ä½œç»„ï¼ˆPSWGï¼‰å®æ–½çš„æŒç»­å’Œç§¯æçš„å®‰å…¨å®¡æŸ¥å’Œæ¼æ´ç®¡ç†æµç¨‹ã€‚å¯¹äºæŠ¥å‘Šä¸­æåˆ°çš„å…¶ä½™é—®é¢˜ï¼ŒPSWG å¼€å§‹ç€æ‰‹è§£å†³ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´åœ°æŠ¥å‘Šï¼Œæ‰€æœ‰æ ‡ä¸ºâ€œé«˜â€œçš„é—®é¢˜å’Œå‡ ä¸ªæ ‡ä¸ºâ€œä¸­ / ä½â€œçš„é—®é¢˜åœ¨æŠ¥å‘Šå‘å¸ƒåå·²ç»å¾—åˆ°è§£å†³ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æŠ¥å‘Šè¿˜å›´ç»•åˆ›å»ºä¸€ä¸ªåŠ å›ºæŒ‡å—æå‡ºäº†æˆ˜ç•¥å»ºè®®ï¼Œç°åœ¨å¯ä»¥åœ¨æˆ‘ä»¬çš„&lt;a href=&#34;https://istio.io/latest/docs/ops/best-practices/security/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰å…¨æœ€ä½³å®è·µæŒ‡å—&lt;/a&gt;ä¸­æ‰¾åˆ°ã€‚è¿™æ˜¯ä¸€ä»½å…¨é¢çš„æ–‡ä»¶ï¼Œæ±‡é›†äº† Istio ç¤¾åŒºçš„å®‰å…¨ä¸“å®¶å’Œåœ¨ç”Ÿäº§ä¸­è¿è¡Œ Istio çš„è¡Œä¸šé¢†å¯¼è€…çš„å»ºè®®ã€‚æˆ‘ä»¬æ­£åœ¨åŠªåŠ›ä¸ºåœ¨å®‰å…¨ç¯å¢ƒä¸­å®‰è£… Istio åˆ›å»ºä¸€ä¸ªæœ‰è§åœ°çš„ã€å¼ºåŒ–çš„å®‰å…¨é…ç½®æ–‡ä»¶ï¼Œä½†åœ¨è¿™æœŸé—´ï¼Œæˆ‘ä»¬å»ºè®®ç”¨æˆ·éµå¾ªå®‰å…¨æœ€ä½³å®è·µæŒ‡å—ï¼Œé…ç½® Istio ä»¥æ»¡è¶³ä»–ä»¬çš„å®‰å…¨éœ€æ±‚ã€‚è¯´åˆ°è¿™é‡Œï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¯¹æŠ¥å‘Šä¸­æå‡ºçš„å„ç§é—®é¢˜çš„åˆ†æå’Œè§£å†³ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è§£å†³æ–¹æ³•å’Œå¿ƒå¾—&#34;&gt;è§£å†³æ–¹æ³•å’Œå¿ƒå¾—&lt;/h2&gt;
&lt;h3 id=&#34;æ— æ³•ä¿è¯æ§åˆ¶é¢ç½‘ç»œé€šä¿¡çš„å®‰å…¨&#34;&gt;æ— æ³•ä¿è¯æ§åˆ¶é¢ç½‘ç»œé€šä¿¡çš„å®‰å…¨&lt;/h3&gt;
&lt;p&gt;è¯¥æŠ¥å‘Šæ ‡è®°äº†æ—§ç‰ˆæœ¬çš„ Istio ä¸­å¯ç”¨çš„é…ç½®é€‰é¡¹ï¼Œä»¥æ§åˆ¶å¦‚ä½•ä¿è¯æ§åˆ¶é¢çš„é€šä¿¡å®‰å…¨ã€‚è‡ª 1.7 ä»¥æ¥ï¼ŒIstio é»˜è®¤ä¿æŠ¤æ‰€æœ‰æ§åˆ¶é¢é€šä¿¡çš„å®‰å…¨ï¼ŒæŠ¥å‘Šä¸­æåˆ°çš„è®¸å¤šç®¡ç†æ§åˆ¶é¢åŠ å¯†çš„é…ç½®é€‰é¡¹ä¸å†éœ€è¦äº†ã€‚&lt;/p&gt;
&lt;p&gt;æŠ¥å‘Šä¸­æåˆ°çš„è°ƒè¯•ç«¯ç‚¹æ˜¯é»˜è®¤å¯ç”¨çš„ï¼ˆä» Istio 1.10 å¼€å§‹ï¼‰ï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨ istioctl å·¥å…·è°ƒè¯•ä»–ä»¬çš„ Istio æœåŠ¡ç½‘æ ¼ã€‚å®ƒå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ &lt;code&gt;ENABLE_DEBUG_ON_HTTP&lt;/code&gt; ä¸º FALSE æ¥ç¦ç”¨ï¼Œæ­£å¦‚å®‰å…¨æœ€ä½³å®è·µæŒ‡å—ä¸­æåˆ°çš„ã€‚æ­¤å¤–ï¼Œåœ¨å³å°†åˆ°æ¥çš„ç‰ˆæœ¬ï¼ˆ1.11ï¼‰ä¸­ï¼Œè¿™ä¸ªè°ƒè¯•ç«¯ç‚¹é»˜è®¤æ˜¯å®‰å…¨çš„ï¼Œéœ€è¦ä¸€ä¸ªæœ‰æ•ˆçš„ Kubernetes æœåŠ¡è´¦æˆ·ä»¤ç‰Œæ‰èƒ½è®¿é—®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¼ºå°‘å®‰å…¨ç›¸å…³çš„æ–‡æ¡£&#34;&gt;ç¼ºå°‘å®‰å…¨ç›¸å…³çš„æ–‡æ¡£&lt;/h3&gt;
&lt;p&gt;æŠ¥å‘ŠæŒ‡å‡ºäº†ä¸ Istio 1.6 ä¸€èµ·å‘å¸ƒçš„å®‰å…¨ç›¸å…³æ–‡æ¡£çš„å·®è·ã€‚æ­¤åï¼Œæˆ‘ä»¬åˆ›å»ºäº†è¯¦ç»†çš„å®‰å…¨æœ€ä½³å®è·µæŒ‡å—ï¼Œå¹¶æå‡ºå»ºè®®ï¼Œä»¥ç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿå®‰å…¨åœ°éƒ¨ç½² Istioï¼Œä»¥æ»¡è¶³ä»–ä»¬çš„è¦æ±‚ã€‚ä»Šåï¼Œæˆ‘ä»¬å°†ç»§ç»­ç”¨æ›´å¤šçš„åŠ å›ºå»ºè®®æ¥å……å®è¿™ä¸ªæ–‡æ¡£ã€‚æˆ‘ä»¬å»ºè®®ç”¨æˆ·å…³æ³¨è¯¥æŒ‡å—çš„æ›´æ–°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¼ºä¹-virtualservice-gateway-å­—æ®µéªŒè¯ä½¿è¯·æ±‚è¢«åŠ«æŒ&#34;&gt;ç¼ºä¹ VirtualService Gateway å­—æ®µéªŒè¯ä½¿è¯·æ±‚è¢«åŠ«æŒ&lt;/h3&gt;
&lt;p&gt;å¯¹äºè¿™ä¸ªé—®é¢˜ï¼ŒæŠ¥å‘Šä½¿ç”¨äº†ä¸€ä¸ªæœ‰æ•ˆä½†å…è®¸çš„ Gateway é…ç½®ï¼Œå¯èƒ½å¯¼è‡´è¯·æ±‚è¢«é”™è¯¯åœ°è·¯ç”±ã€‚ä¸ Kubernetes çš„ RBAC ç±»ä¼¼ï¼ŒIstio çš„ APIï¼ŒåŒ…æ‹¬ Gatewayï¼Œå¯ä»¥æ ¹æ®ä½ çš„è¦æ±‚è°ƒæ•´ä¸ºå…è®¸æ€§æˆ–é™åˆ¶æ€§ã€‚ç„¶è€Œï¼Œè¯¥æŠ¥å‘Šæµ®ç°äº†æˆ‘ä»¬çš„æ–‡æ¡£ä¸­ä¸æœ€ä½³å®è·µå’ŒæŒ‡å¯¼ç”¨æˆ·ä¿æŠ¤å…¶ç¯å¢ƒæœ‰å…³çš„ç¼ºå¤±ç¯èŠ‚ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„å®‰å…¨æœ€ä½³å®è·µæŒ‡å—ä¸­å¢åŠ äº†ä¸€ä¸ªç« èŠ‚ï¼Œå…¶ä¸­åŒ…æ‹¬å®‰å…¨è¿è¡Œ&lt;a href=&#34;https://istio.io/latest/docs/ops/best-practices/security/#gateways&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘å…³&lt;/a&gt;çš„æ­¥éª¤ã€‚ç‰¹åˆ«æ˜¯æè¿°åœ¨ç½‘å…³èµ„æºçš„ä¸»æœºè§„èŒƒä¸­&lt;a href=&#34;https://istio.io/latest/docs/ops/best-practices/security/#avoid-overly-broad-hosts-configurations&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨å‘½åç©ºé—´å‰ç¼€&lt;/a&gt;çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®åŠ å¼ºä½ çš„é…ç½®ï¼Œé˜²æ­¢è¿™ç§ç±»å‹çš„è¯·æ±‚åŠ«æŒã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç”Ÿæˆçš„-ingress-gateway-é…ç½®ä½¿è¯·æ±‚è¢«åŠ«æŒ&#34;&gt;ç”Ÿæˆçš„ Ingress Gateway é…ç½®ä½¿è¯·æ±‚è¢«åŠ«æŒ&lt;/h3&gt;
&lt;p&gt;æŠ¥å‘ŠæŒ‡å‡ºï¼Œåœ¨ä½¿ç”¨é»˜è®¤æœºåˆ¶ï¼Œå³åœ¨ç½‘å…³èµ„æºä¸­é€šè¿‡æ ‡ç­¾è·¨å‘½åç©ºé—´é€‰æ‹©ç½‘å…³å·¥ä½œè´Ÿè½½æ—¶ï¼Œå¯èƒ½å‡ºç°è¯·æ±‚åŠ«æŒã€‚è¿™ç§è¡Œä¸ºæ˜¯é»˜è®¤é€‰æ‹©çš„ï¼Œå› ä¸ºå®ƒå…è®¸å°†ç®¡ç†ç½‘å…³å’Œ VirtualService èµ„æºå§”æ‰˜ç»™åº”ç”¨ç¨‹åºå›¢é˜Ÿï¼ŒåŒæ—¶å…è®¸è¿ç»´å›¢é˜Ÿé›†ä¸­ç®¡ç†å…¥å£ç½‘å…³å·¥ä½œè´Ÿè½½ï¼Œä»¥æ»¡è¶³å…¶ç‹¬ç‰¹çš„å®‰å…¨è¦æ±‚ï¼Œä¾‹å¦‚åœ¨ä¸“ç”¨èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚æ­£å¦‚æŠ¥å‘Šä¸­æ‰€å¼ºè°ƒçš„ï¼Œå¦‚æœè¿™ç§éƒ¨ç½²æ‹“æ‰‘ç»“æ„åœ¨ä½ çš„ç¯å¢ƒä¸­ä¸æ˜¯ä¸€ä¸ªè¦æ±‚ï¼Œå¼ºçƒˆå»ºè®®å°†ç½‘å…³èµ„æºä¸ä½ çš„ç½‘å…³å·¥ä½œè´Ÿè½½æ”¾åœ¨ä¸€èµ·ï¼Œå¹¶å°†ç¯å¢ƒå˜é‡ &lt;code&gt;PILOT_SCOPE_GATEWAY_TO_NAMESPACE&lt;/code&gt; è®¾ç½®ä¸º trueã€‚&lt;/p&gt;
&lt;p&gt;è¯·å‚è€ƒ&lt;a href=&#34;https://istio.io/latest/docs/setup/additional-setup/gateway/#gateway-deployment-topologies&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘å…³éƒ¨ç½²æ‹“æ‰‘ç»“æ„æŒ‡å—&lt;/a&gt;ï¼Œäº†è§£ Istio ç¤¾åŒºæ¨èçš„å„ç§éƒ¨ç½²æ¨¡å¼ã€‚æ­¤å¤–ï¼Œæ­£å¦‚&lt;a href=&#34;https://istio.io/latest/docs/ops/best-practices/security/#restrict-gateway-creation-privileges&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰å…¨æœ€ä½³å®è·µæŒ‡å—&lt;/a&gt;ä¸­æåˆ°çš„ï¼Œç½‘å…³èµ„æºçš„åˆ›å»ºåº”ä½¿ç”¨ Kubernetes RBAC æˆ–å…¶ä»–æ”¿ç­–æ‰§è¡Œæœºåˆ¶è¿›è¡Œè®¿é—®æ§åˆ¶ï¼Œä»¥ç¡®ä¿åªæœ‰æˆæƒå®ä½“å¯ä»¥åˆ›å»ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…¶ä»–ä¸­ç­‰å’Œä½ä¸¥é‡ç¨‹åº¦çš„é—®é¢˜&#34;&gt;å…¶ä»–ä¸­ç­‰å’Œä½ä¸¥é‡ç¨‹åº¦çš„é—®é¢˜&lt;/h2&gt;
&lt;p&gt;æœ‰ä¸¤ä¸ªä¸­ç­‰ä¸¥é‡ç¨‹åº¦çš„é—®é¢˜è¢«æŠ¥å‘Šï¼Œä¸é¡¹ç›®å†…ä¸åŒçº§åˆ«æš´éœ²çš„è°ƒè¯•ä¿¡æ¯æœ‰å…³ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥è¢«ç”¨æ¥è·å–æ•æ„Ÿä¿¡æ¯æˆ–ç­–åˆ’æ‹’ç»æœåŠ¡ï¼ˆDOSï¼‰æ”»å‡»ã€‚è™½ç„¶ Istio é»˜è®¤å¯ç”¨äº†è¿™äº›è°ƒè¯•æ¥å£ï¼Œç”¨äºå‰–ææˆ–å¯ç”¨â€œistioctlâ€œç­‰å·¥å…·ï¼Œä½†å¦‚ä¸Šæ‰€è¿°ï¼Œå¯ä»¥é€šè¿‡å°†ç¯å¢ƒå˜é‡ &lt;code&gt;ENABLE_DEBUG_ON_HTTP&lt;/code&gt; è®¾ç½®ä¸º FALSE æ¥ç¦ç”¨å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;æŠ¥å‘Šæ­£ç¡®åœ°æŒ‡å‡ºï¼ŒIstio æä¾›çš„é»˜è®¤é•œåƒä¸­å®‰è£…çš„å„ç§å®ç”¨ç¨‹åºï¼Œå¦‚ &lt;code&gt;sudo&lt;/code&gt;ã€&lt;code&gt;tcpdump&lt;/code&gt; ç­‰ï¼Œå¯èƒ½å¯¼è‡´ç‰¹æƒå‡çº§æ”»å‡»ã€‚æä¾›è¿™äº›å·¥å…·æ˜¯ä¸ºäº†å¸®åŠ©è¿è¡Œæ—¶è°ƒè¯•æµç»ç½‘ç»œçš„æ•°æ®åŒ…ï¼Œå»ºè®®ç”¨æˆ·åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨è¿™äº›é•œåƒçš„&lt;a href=&#34;https://istio.io/latest/docs/ops/configuration/security/harden-docker-images/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ å›ºç‰ˆæœ¬&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æŠ¥å‘Šè¿˜æå‡ºäº†ä¸€ä¸ªå·²çŸ¥çš„æ¶æ„é™åˆ¶ï¼Œå³ä»»ä½•åŸºäº sidecar ä»£ç†çš„æœåŠ¡ç½‘æ ¼å®ç°éƒ½ä½¿ç”¨ &lt;code&gt;iptables&lt;/code&gt; æ¥æ‹¦æˆªæµé‡ã€‚è¿™ç§æœºåˆ¶å¾ˆå®¹æ˜“è¢« &lt;a href=&#34;https://istio.io/latest/docs/ops/best-practices/security/#understand-traffic-capture-limitations&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sidecar ä»£ç†ç»•è¿‡&lt;/a&gt;ï¼Œè¿™å¯¹å®‰å…¨ç¯å¢ƒæ¥è¯´æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„é—®é¢˜ã€‚å®ƒå¯ä»¥é€šè¿‡éµå¾ªå®‰å…¨æœ€ä½³å®è·µæŒ‡å—çš„&lt;a href=&#34;https://istio.io/latest/docs/ops/best-practices/security/#defense-in-depth-with-networkpolicy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·±å…¥é˜²å¾¡&lt;/a&gt;å»ºè®®æ¥è§£å†³ã€‚æˆ‘ä»¬ä¹Ÿåœ¨ä¸ Kubernetes ç¤¾åŒºåˆä½œï¼Œç ”ç©¶æ›´å®‰å…¨çš„é€‰é¡¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœ‰ç”¨å’Œå®‰å…¨ä¹‹é—´çš„æƒè¡¡&#34;&gt;æœ‰ç”¨å’Œå®‰å…¨ä¹‹é—´çš„æƒè¡¡&lt;/h3&gt;
&lt;p&gt;ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†è¯„ä¼°ç»“æœå’Œä¸ºè§£å†³è¿™äº›é—®é¢˜æå‡ºçš„å»ºè®®ä¸­çš„ä¸€ä¸ªè¶‹åŠ¿ã€‚Istio æä¾›äº†å„ç§é…ç½®é€‰é¡¹ï¼Œä»¥æ ¹æ®æ‚¨çš„è¦æ±‚åˆ›å»ºä¸€ä¸ªæ›´å®‰å…¨çš„å®‰è£…ï¼Œæˆ‘ä»¬è¿˜æ¨å‡ºäº†ä¸€ä¸ªå…¨é¢çš„å®‰å…¨æœ€ä½³å®è·µæŒ‡å—ï¼Œä¾›ç”¨æˆ·éµå¾ªã€‚ç”±äº Istio åœ¨ç”Ÿäº§ä¸­è¢«å¹¿æ³›é‡‡ç”¨ï¼Œå¯¹æˆ‘ä»¬æ¥è¯´ï¼Œåœ¨åˆ‡æ¢åˆ°å®‰å…¨é»˜è®¤å€¼å’Œç°æœ‰ç”¨æˆ·åœ¨å‡çº§æ—¶å¯èƒ½å‡ºç°çš„è¿ç§»é—®é¢˜ä¹‹é—´ï¼Œæ˜¯ä¸€ä¸ªæƒè¡¡ã€‚Istio äº§å“å®‰å…¨å·¥ä½œç»„è¯„ä¼°äº†è¿™äº›é—®é¢˜ä¸­çš„æ¯ä¸€ä¸ªï¼Œå¹¶åœ¨ç»™æˆ‘ä»¬çš„ç”¨æˆ·ä¸€äº›ç‰ˆæœ¬é€‰æ‹©å®‰å…¨é…ç½®å’Œè¿ç§»ä»–ä»¬çš„å·¥ä½œè´Ÿè½½åï¼Œåˆ›å»ºäº†ä¸€ä¸ªè¡ŒåŠ¨è®¡åˆ’ï¼Œä»¥é€ä¸€å¯ç”¨å®‰å…¨é»˜è®¤ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œåœ¨ç»å†äº†ä¸­ç«‹çš„å®‰å…¨è¯„ä¼°æœŸé—´å’Œä¹‹åï¼Œæˆ‘ä»¬æœ‰å‡ ä¸ªæ•™è®­ã€‚å…¶ä¸­æœ€ä¸»è¦çš„æ˜¯ç¡®ä¿æˆ‘ä»¬çš„å®‰å…¨å®è·µæ˜¯å¼ºå¤§çš„ï¼Œä»¥å¿«é€Ÿå“åº”è¯„ä¼°ç»“æœï¼Œæ›´é‡è¦çš„æ˜¯åœ¨ä¿æŒæˆ‘ä»¬çš„å‡çº§æ ‡å‡†ä¸å—å½±å“çš„æƒ…å†µä¸‹è¿›è¡Œå®‰å…¨æ”¹è¿›ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç»§ç»­è¿™ä¸€åŠªåŠ›ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ Istio äº§å“å®‰å…¨å·¥ä½œç»„ä¸­å¯»æ±‚åé¦ˆå’Œå‚ä¸ï¼Œæ‰€ä»¥è¯·&lt;a href=&#34;https://github.com/istio/community/blob/master/WORKING-GROUPS.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ å…¥æˆ‘ä»¬çš„å…¬å¼€ä¼šè®®&lt;/a&gt;ï¼Œæå‡ºé—®é¢˜æˆ–äº†è§£æˆ‘ä»¬ä¸ºä¿æŒ Istio çš„å®‰å…¨æ‰€åšçš„å·¥ä½œï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨å‘ç°é€‰æ‹©å™¨æ¥ä¸ºä½ çš„ Istio æœåŠ¡ç½‘æ ¼é…ç½®å‘½åç©ºé—´</title>
      <link>https://cloudnativecn.com/blog/discovery-selectors/</link>
      <pubDate>Mon, 12 Jul 2021 11:20:46 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/discovery-selectors/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ª &lt;a href=&#34;https://istio.io/latest/blog/2021/discovery-selectors/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜ç½‘&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç”¨æˆ·å°†ä»–ä»¬çš„æœåŠ¡è½¬ç§»åˆ° Istio æœåŠ¡ç½‘æ ¼ä¸­è¿è¡Œæ—¶ï¼Œä»–ä»¬é€šå¸¸ä¼šæƒŠè®¶åœ°å‘ç°ï¼Œæ§åˆ¶å¹³é¢é»˜è®¤ä¼šè§‚å¯Ÿå’Œå¤„ç†é›†ç¾¤ä¸­æ‰€æœ‰å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰ Kubernetes èµ„æºã€‚è¿™å¯¹äºæ‹¥æœ‰å¤§é‡å‘½åç©ºé—´å’Œéƒ¨ç½²çš„å¤§å‹é›†ç¾¤ï¼Œç”šè‡³å¯¹äºæ‹¥æœ‰å¿«é€ŸæµåŠ¨èµ„æºï¼ˆä¾‹å¦‚ Spark ä½œä¸šï¼‰çš„ä¸­ç­‰è§„æ¨¡çš„é›†ç¾¤æ¥è¯´ï¼Œéƒ½å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥åŠ¨æ€åœ°é™åˆ¶ä½œä¸ºç½‘æ ¼ä¸€éƒ¨åˆ†çš„å‘½åç©ºé—´é›†ï¼Œä»¥ä¾¿ Istio æ§åˆ¶å¹³é¢åªå¤„ç†è¿™äº›å‘½åç©ºé—´çš„èµ„æºã€‚é™åˆ¶å‘½åç©ºé—´çš„èƒ½åŠ›ä½¿ Istiod èƒ½å¤Ÿè§‚å¯Ÿå’Œæ¨é€æ›´å°‘çš„èµ„æºå’Œç›¸å…³çš„å˜åŒ–åˆ° sidecarï¼Œä»è€Œæé«˜æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢çš„æ•´ä½“æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio ç›‘è§†é›†ç¾¤ä¸­çš„æ‰€æœ‰å‘½åç©ºé—´ã€æœåŠ¡ã€ç«¯ç‚¹å’Œ Podã€‚ä¾‹å¦‚ï¼Œåœ¨æˆ‘çš„ Kubernetes é›†ç¾¤ä¸­ï¼Œæˆ‘æŠŠ sleep æœåŠ¡éƒ¨ç½²åœ¨é»˜è®¤å‘½åç©ºé—´ï¼ŒæŠŠ httpbin æœåŠ¡éƒ¨ç½²åœ¨ ns-x å‘½åç©ºé—´ã€‚æˆ‘å·²ç»æŠŠ sleep æœåŠ¡æ·»åŠ åˆ°ç½‘æ ¼ä¸­ï¼Œä½†æˆ‘æ²¡æœ‰è®¡åˆ’æŠŠ httpbin æœåŠ¡æ·»åŠ åˆ°ç½‘æ ¼ä¸­ï¼Œæˆ–è€…è®©ç½‘æ ¼ä¸­çš„ä»»ä½•æœåŠ¡ä¸ httpbin æœåŠ¡äº¤äº’ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;istioctl proxy-config endpoint&lt;/code&gt; å‘½ä»¤æ¥æ˜¾ç¤º sleep éƒ¨ç½²çš„æ‰€æœ‰ç«¯ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-endpoints-for-sleep-deployment&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Endpoints for Sleep Deployment&#34; srcset=&#34;
               /blog/discovery-selectors/008i3skNly1gsgay47dkuj317c0f847y_hu_4448db805dbf8a68.webp 400w,
               /blog/discovery-selectors/008i3skNly1gsgay47dkuj317c0f847y_hu_fc31ba0d72a6845e.webp 760w,
               /blog/discovery-selectors/008i3skNly1gsgay47dkuj317c0f847y_hu_c909f6e5a2e4b485.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/discovery-selectors/008i3skNly1gsgay47dkuj317c0f847y_hu_4448db805dbf8a68.webp&#34;
               width=&#34;760&#34;
               height=&#34;267&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Endpoints for Sleep Deployment
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œ&lt;code&gt;ns-x&lt;/code&gt; å‘½åç©ºé—´ä¸­çš„ httpbin æœåŠ¡ç«¯ç‚¹åœ¨å·²å‘ç°çš„ç«¯ç‚¹åˆ—è¡¨ä¸­ã€‚å½“ä½ åªæœ‰å‡ ä¸ªæœåŠ¡æ—¶ï¼Œè¿™å¯èƒ½ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚ç„¶è€Œï¼Œå½“ä½ æœ‰æˆç™¾ä¸Šåƒçš„æœåŠ¡ä¸ä¸ Istio æœåŠ¡ç½‘ä¸­è¿è¡Œçš„ä»»ä½•æœåŠ¡äº¤äº’æ—¶ï¼Œä½ å¯èƒ½ä¸å¸Œæœ›ä½ çš„ Istio æ§åˆ¶å¹³é¢è§‚å¯Ÿè¿™äº›æœåŠ¡å¹¶å°†å®ƒä»¬çš„ä¿¡æ¯å‘é€åˆ°ç½‘æ ¼ä¸­æœåŠ¡çš„ sidecarã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¼•å…¥å‘ç°é€‰æ‹©å™¨&#34;&gt;å¼•å…¥å‘ç°é€‰æ‹©å™¨&lt;/h2&gt;
&lt;p&gt;ä» Istio 1.10 å¼€å§‹ï¼Œæˆ‘ä»¬åœ¨&lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MeshConfig&lt;/a&gt;ä¸­å¼•å…¥äº†æ–°çš„&lt;code&gt;discoverySelectors&lt;/code&gt;é€‰é¡¹ï¼Œå®ƒæ˜¯ä¸€ä¸ª Kubernetes&lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#resources-that-support-set-based-requirements&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€‰æ‹©å™¨&lt;/a&gt;çš„æ•°ç»„ã€‚ç¡®åˆ‡çš„ç±»å‹æ˜¯ &lt;code&gt;[]LabelSelector&lt;/code&gt;ï¼Œå¦‚è¿™é‡Œå®šä¹‰çš„ï¼Œå…è®¸ç®€å•çš„é€‰æ‹©å™¨å’ŒåŸºäºé›†åˆçš„é€‰æ‹©å™¨ã€‚è¿™äº›é€‰æ‹©å™¨é€‚ç”¨äºå‘½åç©ºé—´çš„æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥é…ç½®æ¯ä¸ªæ ‡ç­¾é€‰æ‹©å™¨æ¥è¡¨è¾¾å„ç§ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»»æ„çš„æ ‡ç­¾åç§°/å€¼ï¼Œä¾‹å¦‚ï¼Œæ‰€æœ‰å…·æœ‰æ ‡ç­¾&lt;code&gt;istio-discovery=enabled&lt;/code&gt;çš„å‘½åç©ºé—´&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¸¦æœ‰ OR è¯­ä¹‰çš„åŸºäºé›†åˆçš„é€‰æ‹©å™¨çš„å‘½åç©ºé—´æ ‡ç­¾åˆ—è¡¨ï¼Œä¾‹å¦‚ï¼Œæ‰€æœ‰å¸¦æœ‰&lt;code&gt;istio-discovery=enabled&lt;/code&gt;æ ‡ç­¾çš„å‘½åç©ºé—´æˆ– &lt;code&gt;region=us-east1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åŒ…å«å’Œ/æˆ–æ’é™¤å‘½åç©ºé—´ï¼Œä¾‹å¦‚ï¼Œæ‰€æœ‰å…·æœ‰æ ‡ç­¾&lt;code&gt;istio-discovery=enabled&lt;/code&gt;å’Œæ ‡ç­¾ key &lt;code&gt;app&lt;/code&gt;ç­‰äº&lt;code&gt;helloworld&lt;/code&gt;çš„åç§°ç©ºé—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ³¨æ„ï¼š&lt;code&gt;discoverySelectors&lt;/code&gt;ä¸æ˜¯ä¸€ä¸ªå®‰å…¨è¾¹ç•Œã€‚å³ä½¿ä½ é…ç½®äº†&lt;code&gt;discoverySelectors&lt;/code&gt;ï¼ŒIstiod å°†ç»§ç»­è®¿é—®æ‰€æœ‰å‘½åç©ºé—´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‘ç°é€‰æ‹©å™¨ç¤ºä¾‹&#34;&gt;å‘ç°é€‰æ‹©å™¨ç¤ºä¾‹&lt;/h2&gt;
&lt;p&gt;å‡è®¾ä½ çŸ¥é“å“ªäº›å‘½åç©ºé—´è¦ä½œä¸ºæœåŠ¡ç½‘æ ¼çš„ä¸€éƒ¨åˆ†ï¼Œä½œä¸ºç½‘æ ¼ç®¡ç†å‘˜ï¼Œä½ å¯ä»¥åœ¨å®‰è£…æ—¶æˆ–å®‰è£…åé€šè¿‡åœ¨ Istio çš„&lt;code&gt;MeshConfig&lt;/code&gt;èµ„æºä¸­æ·»åŠ ä½ æƒ³è¦çš„å‘ç°é€‰æ‹©å™¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å°† Istio é…ç½®ä¸ºåªå‘ç°é‚£äº›æœ‰&lt;code&gt;istio-discovery=enabled&lt;/code&gt;æ ‡ç­¾çš„å‘½åç©ºé—´ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨æˆ‘ä»¬å‰é¢çš„ä¾‹å­ï¼Œè®©æˆ‘ä»¬ç»™é»˜è®¤å‘½åç©ºé—´è´´ä¸Šæ ‡ç­¾&lt;code&gt;istio-discovery=enabled&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;kubectl label namespace default istio-discovery=enabled&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt; åº”ç”¨å¸¦æœ‰ &lt;code&gt;discoverySelectors&lt;/code&gt; çš„ yaml æ¥æ›´æ–°ä½ çš„ Istio å®‰è£…ã€‚æ³¨æ„ï¼Œä¸ºäº†é¿å…å¯¹ä½ çš„ç¨³å®šç¯å¢ƒäº§ç”Ÿä»»ä½•å½±å“ï¼Œæˆ‘ä»¬å»ºè®®ä½ å¯¹ä½ çš„ Istio å®‰è£…ä½¿ç”¨ä¸åŒçš„ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;istioctl install --skip-confirmation -f - &amp;lt;&amp;lt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# You may override parts of meshconfig by uncommenting the following lines.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meshConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;discoverySelectors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio-discovery&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;enabled&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;æ˜¾ç¤º sleep éƒ¨ç½²çš„ç«¯ç‚¹é…ç½®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-endpoints-for-sleep-deployment-with-discovery-selectors&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Endpoints for Sleep Deployment With Discovery Selectors&#34; srcset=&#34;
               /blog/discovery-selectors/008i3skNly1gsghtr5t1jj31sy0agq8l_hu_cdb8c06407e0aece.webp 400w,
               /blog/discovery-selectors/008i3skNly1gsghtr5t1jj31sy0agq8l_hu_361fd39a3f76d1b9.webp 760w,
               /blog/discovery-selectors/008i3skNly1gsghtr5t1jj31sy0agq8l_hu_5834e9775a9fbd81.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/discovery-selectors/008i3skNly1gsghtr5t1jj31sy0agq8l_hu_cdb8c06407e0aece.webp&#34;
               width=&#34;760&#34;
               height=&#34;122&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Endpoints for Sleep Deployment With Discovery Selectors
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ³¨æ„è¿™æ¬¡ &lt;code&gt;ns-x&lt;/code&gt; å‘½åç©ºé—´ä¸­çš„&lt;code&gt;httpbin&lt;/code&gt;æœåŠ¡ä¸åœ¨å‘ç°çš„ç«¯ç‚¹åˆ—è¡¨ä¸­ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–ä¸åœ¨é»˜è®¤å‘½åç©ºé—´ä¸­çš„æœåŠ¡ã€‚å¦‚æœä½ æ˜¾ç¤º sleep éƒ¨ç½²çš„è·¯ç”±ï¼ˆæˆ–é›†ç¾¤æˆ–ç›‘å¬å™¨ï¼‰ä¿¡æ¯ï¼Œä½ ä¹Ÿä¼šæ³¨æ„åˆ°è¿”å›çš„é…ç½®å°‘äº†å¾ˆå¤šã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-routes-for-sleep-deployment-with-discovery-selectors&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Routes for Sleep Deployment With Discovery Selectors&#34; srcset=&#34;
               /blog/discovery-selectors/008i3skNly1gsghv5atsvj31sw0hg0ym_hu_c4b768a3f01d157c.webp 400w,
               /blog/discovery-selectors/008i3skNly1gsghv5atsvj31sw0hg0ym_hu_d6ae0a2f502c2d42.webp 760w,
               /blog/discovery-selectors/008i3skNly1gsghv5atsvj31sw0hg0ym_hu_837e94763b36dfdd.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/discovery-selectors/008i3skNly1gsghv5atsvj31sw0hg0ym_hu_c4b768a3f01d157c.webp&#34;
               width=&#34;760&#34;
               height=&#34;204&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Routes for Sleep Deployment With Discovery Selectors
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨&lt;code&gt;matchLabels&lt;/code&gt;æ¥é…ç½®å…·æœ‰ AND è¯­ä¹‰çš„å¤šä¸ªæ ‡ç­¾ï¼Œæˆ–è€…ä½¿ç”¨&lt;code&gt;matchLabels&lt;/code&gt;é›†æ¥é…ç½®å¤šä¸ªæ ‡ç­¾é—´çš„ OR è¯­ä¹‰ã€‚æ— è®ºä½ æ˜¯å°†æœåŠ¡æˆ– pod éƒ¨ç½²åˆ°å…·æœ‰ä¸åŒæ ‡ç­¾é›†çš„å‘½åç©ºé—´ï¼Œè¿˜æ˜¯ä½ çš„ç»„ç»‡ä¸­çš„å¤šä¸ªåº”ç”¨å›¢é˜Ÿä½¿ç”¨ä¸åŒçš„æ ‡ç­¾æƒ¯ä¾‹ï¼Œ&lt;code&gt;discoverySelectors&lt;/code&gt;éƒ½èƒ½æä¾›ä½ éœ€è¦çš„çµæ´»æ€§ã€‚æ­¤å¤–ï¼Œä½ å¯ä»¥æ ¹æ®æˆ‘ä»¬çš„&lt;a href=&#34;https://github.com/istio/api/blob/master/mesh/v1alpha1/config.proto#L792&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡æ¡£&lt;/a&gt;ä¸€èµ·ä½¿ç”¨&lt;code&gt;matchLabels&lt;/code&gt;å’Œ&lt;code&gt;matchExpressions&lt;/code&gt;ã€‚å…³äºé€‰æ‹©å™¨è¯­ä¹‰çš„å…¶ä»–ç»†èŠ‚ï¼Œè¯·å‚è€ƒ&lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#label-selectors&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes é€‰æ‹©å™¨&lt;/a&gt;æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‘ç°é€‰æ‹©å™¨ä¸-sidecar-èµ„æº&#34;&gt;å‘ç°é€‰æ‹©å™¨ä¸ Sidecar èµ„æº&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;discoverySelectors&lt;/code&gt;é…ç½®ä½¿ç”¨æˆ·èƒ½å¤ŸåŠ¨æ€åœ°é™åˆ¶ä½œä¸ºç½‘æ ¼ä¸€éƒ¨åˆ†çš„å‘½åç©ºé—´çš„é›†åˆã€‚Sidecar èµ„æºä¹Ÿå¯ä»¥æ§åˆ¶ sidecar é…ç½®çš„å¯è§æ€§ï¼Œä»¥åŠä»€ä¹ˆè¢«æ¨é€åˆ° sidecar ä»£ç†ã€‚å®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;discoverySelectors&lt;/code&gt;é…ç½®å£°æ˜äº† Istio æ§åˆ¶å¹³é¢è§‚å¯Ÿå’Œå¤„ç†çš„å†…å®¹ã€‚å¦‚æœæ²¡æœ‰&lt;code&gt;discoverySelectors&lt;/code&gt;é…ç½®ï¼ŒIstio æ§åˆ¶å¹³é¢ä¼šè§‚å¯Ÿå’Œå¤„ç†é›†ç¾¤ä¸­çš„æ‰€æœ‰å‘½åç©ºé—´/æœåŠ¡/ç«¯ç‚¹/podï¼Œè€Œä¸ç®¡ä½ æœ‰å“ªäº› sidecar èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;discoverySelectors&lt;/code&gt;æ˜¯ç”±ç½‘æ ¼ç®¡ç†å‘˜ä¸ºç½‘æ ¼å…¨å±€é…ç½®çš„ã€‚è™½ç„¶ Sidecar èµ„æºä¹Ÿå¯ä»¥ç”± Mesh ç®¡ç†å‘˜åœ¨&lt;code&gt;MeshConfig&lt;/code&gt;æ ¹å‘½åç©ºé—´ä¸­ä¸º Mesh è¿›è¡Œå…¨å±€é…ç½®ï¼Œä½†å®ƒä»¬é€šå¸¸æ˜¯ç”±æœåŠ¡æ‰€æœ‰è€…ä¸ºå…¶å‘½åç©ºé—´è¿›è¡Œé…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½ å¯ä»¥åœ¨ Sidecar èµ„æºä¸­ä½¿ç”¨&lt;code&gt;discoverySelectors&lt;/code&gt;ã€‚ä½ å¯ä»¥ä½¿ç”¨&lt;code&gt;discoverySelectors&lt;/code&gt;åœ¨ Mesh èŒƒå›´å†…é…ç½® Istio æ§åˆ¶å¹³é¢åº”è¯¥è§‚å¯Ÿå’Œå¤„ç†å“ªäº›å‘½åç©ºé—´ã€‚å¯¹äº Istio æœåŠ¡ç½‘æ ¼ä¸­çš„è¿™äº›å‘½åç©ºé—´ï¼Œä½ å¯ä»¥åœ¨å…¨å±€æˆ–æ¯ä¸ªå‘½åç©ºé—´åˆ›å»º Sidecar èµ„æºï¼Œä»¥è¿›ä¸€æ­¥æ§åˆ¶ä»€ä¹ˆè¢«æ¨é€åˆ° sidecar ä»£ç†ã€‚è®©æˆ‘ä»¬æŠŠ Bookinfo æœåŠ¡æ·»åŠ åˆ°ç½‘æ ¼ä¸­çš„&lt;code&gt;ns-y&lt;/code&gt;å‘½åç©ºé—´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-discovery-selectors-vs-sidecar-resource&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Discovery Selectors vs Sidecar Resource&#34; srcset=&#34;
               /blog/discovery-selectors/008i3skNly1gsghz1y03pj31040u01kx_hu_4f87eefbe2868705.webp 400w,
               /blog/discovery-selectors/008i3skNly1gsghz1y03pj31040u01kx_hu_14af91bf257af37f.webp 760w,
               /blog/discovery-selectors/008i3skNly1gsghz1y03pj31040u01kx_hu_61fe9e65fb940175.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/discovery-selectors/008i3skNly1gsghz1y03pj31040u01kx_hu_4f87eefbe2868705.webp&#34;
               width=&#34;760&#34;
               height=&#34;632&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Discovery Selectors vs Sidecar Resource
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å‘ç°é€‰æ‹©å™¨æ˜¯å¼ºå¤§çš„é…ç½®ï¼Œå¯ä»¥å°† Istio æ§åˆ¶å¹³é¢è°ƒæ•´ä¸ºåªè§‚å¯Ÿå’Œå¤„ç†ç‰¹å®šçš„å‘½åç©ºé—´ã€‚å¦‚æœä½ ä¸å¸Œæœ›ä½ çš„ Kubernetes é›†ç¾¤ä¸­çš„æ‰€æœ‰å‘½åç©ºé—´æˆä¸ºæœåŠ¡ç½‘æ ¼çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–è€…ä½ çš„ Kubernetes é›†ç¾¤ä¸­æœ‰å¤šä¸ª Istio æœåŠ¡ç½‘æ ¼ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ æ¢ç´¢è¿™ç§é…ç½®ï¼Œå¹¶åœ¨ Istio slack æˆ– GitHub ä¸Šä¸æˆ‘ä»¬è”ç³»ä»¥è·å¾—åé¦ˆã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio å¼€æºå››å‘¨å¹´å›é¡¾ä¸å±•æœ›</title>
      <link>https://cloudnativecn.com/blog/istio-4-year-birthday/</link>
      <pubDate>Tue, 25 May 2021 11:20:46 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-4-year-birthday/</guid>
      <description>&lt;p&gt;Istio æ˜¯ç”± &lt;a href=&#34;https://tetrate.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate&lt;/a&gt; åˆ›å§‹äºº Varun Talwar å’Œè°·æ­Œé¦–å¸­å·¥ç¨‹å¸ˆ Louis Ryan å‘½åå¹¶åœ¨ 2017 å¹´ 5 æœˆ 24 æ—¥å¼€æºã€‚ä»Šå¤©æ˜¯ Istio å¼€æºå››å‘¨å¹´ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥å›é¡¾ä¸€ä¸‹ Istio å››å¹´æ¥çš„å‘å±•å¹¶å±•æœ›ä¸€ä¸‹å®ƒçš„æœªæ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-çš„å¼€æºå†å²&#34;&gt;Istio çš„å¼€æºå†å²&lt;/h2&gt;
&lt;p&gt;2017 å¹´æ˜¯ Kubernetes ç»“æŸå®¹å™¨ç¼–æ’ä¹‹æˆ˜çš„ä¸€å¹´ï¼ŒGoogle ä¸ºäº†å·©å›ºåœ¨äº‘åŸç”Ÿé¢†åŸŸçš„ä¼˜åŠ¿ï¼Œå¹¶å¼¥è¡¥ Kubernetes åœ¨æœåŠ¡é—´æµé‡ç®¡ç†æ–¹é¢çš„åŠ£åŠ¿ï¼Œè¶åŠ¿å¼€æºäº† Istioã€‚ä¸‹é¢æ˜¯æˆªæ­¢ç›®å‰ Istio å†å²ä¸Šæœ€é‡è¦çš„å‡ æ¬¡ç‰ˆæœ¬å‘å¸ƒã€‚&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;strong&gt;æ—¥æœŸ&lt;/strong&gt;&lt;/th&gt;
          &lt;th&gt;ç‰ˆæœ¬&lt;/th&gt;
          &lt;th&gt;è¯´æ˜&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;2017-05-24&lt;/td&gt;
          &lt;td&gt;0.1&lt;/td&gt;
          &lt;td&gt;æ­£å¼å¼€æºï¼Œè¯¥ç‰ˆæœ¬å‘å¸ƒæ—¶ä»…ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ã€‚ç¡®ç«‹äº†åŠŸèƒ½èŒƒå›´å’Œ sidecar éƒ¨ç½²æ¨¡å¼ï¼Œç¡®ç«‹çš„ Envoy ä½œä¸ºé»˜è®¤ sidecar proxy çš„åœ°ä½ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;2017-10-10&lt;/td&gt;
          &lt;td&gt;0.2&lt;/td&gt;
          &lt;td&gt;æ”¯æŒå¤šè¿è¡Œæ—¶ç¯å¢ƒï¼Œå¦‚è™šæ‹Ÿæœºã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;2018-06-01&lt;/td&gt;
          &lt;td&gt;0.8&lt;/td&gt;
          &lt;td&gt;API é‡æ„ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;2018-07-31&lt;/td&gt;
          &lt;td&gt;1.0&lt;/td&gt;
          &lt;td&gt;ç”Ÿäº§å°±ç»ªï¼Œæ­¤å Istio å›¢é˜Ÿè¢«å¤§è§„æ¨¡é‡ç»„ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;2019-03-19&lt;/td&gt;
          &lt;td&gt;1.1&lt;/td&gt;
          &lt;td&gt;ä¼ä¸šå°±ç»ªï¼Œæ”¯æŒå¤š Kubernetes é›†ç¾¤ï¼Œæ€§èƒ½ä¼˜åŒ–ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;2020-03-03&lt;/td&gt;
          &lt;td&gt;1.5&lt;/td&gt;
          &lt;td&gt;å›å½’å•ä½“æ¶æ„ï¼Œæ”¯æŒ WebAssembly æ‰©å±•ï¼Œä½¿å¾— Istio çš„ç”Ÿæ€æ›´åŠ å¼ºå¤§ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;2020-11-18&lt;/td&gt;
          &lt;td&gt;1.8&lt;/td&gt;
          &lt;td&gt;æ­£å¼æ”¾å¼ƒ Mixerï¼Œè¿›ä¸€æ­¥å®Œå–„å¯¹è™šæ‹Ÿæœºçš„æ”¯æŒã€‚&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Istio å¼€æºåç»è¿‡äº†ä¸€å¹´æ—¶é—´çš„å‘å±•ï¼Œåœ¨ 1.0 å‘å¸ƒçš„å‰ä¸¤ä¸ªæœˆå‘å¸ƒäº† 0.8 ç‰ˆæœ¬ï¼Œè¿™æ˜¯å¯¹ API çš„ä¸€æ¬¡å¤§è§„æ¨¡é‡æ„ã€‚è€Œåœ¨ 2018 å¹´ 7 æœˆåº•å‘å¸ƒ 1.0 æ—¶ï¼ŒIstio è¾¾åˆ°äº†ç”Ÿäº§å¯ç”¨çš„ä¸´ç•Œç‚¹ï¼Œæ­¤å Google å¯¹ Istio å›¢é˜Ÿè¿›è¡Œäº†å¤§è§„æ¨¡é‡ç»„ï¼Œå¤šå®¶ä»¥ Istio ä¸ºåŸºç¡€çš„ Service Mesh &lt;a href=&#34;https://istio.io/latest/about/ecosystem/#providers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆ›ä¸šå…¬å¸&lt;/a&gt;è¯ç”Ÿï¼Œå¯ä»¥è¯´ 2018 å¹´æ˜¯æœåŠ¡ç½‘æ ¼è¡Œä¸šè¯ç”Ÿçš„å…ƒå¹´ã€‚&lt;/p&gt;
&lt;p&gt;2019 å¹´ 3 æœˆ Istio 1.1 å‘å¸ƒï¼Œè€Œè¿™è·ç¦» 1.0 å‘å¸ƒå·²ç»è¿‡å»äº†è¿‘ 9 ä¸ªæœˆï¼Œè¿™å·²ç»è¿œè¿œè¶…å‡ºä¸€ä¸ªå¼€æºé¡¹ç›®çš„å¹³å‡å‘å¸ƒå‘¨æœŸã€‚æˆ‘ä»¬çŸ¥é“è¿­ä»£å’Œè¿›åŒ–é€Ÿåº¦æ˜¯åŸºç¡€è½¯ä»¶çš„æ ¸å¿ƒç«äº‰åŠ›ï¼Œæ­¤å Istio å¼€å§‹ä»¥æ¯ä¸ªå­£åº¦ä¸€ä¸ªç‰ˆæœ¬çš„å›ºå®š&lt;a href=&#34;https://istio.io/v1.7/about/release-cadence/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘å¸ƒèŠ‚å¥&lt;/a&gt;ï¼Œå¹¶åœ¨ 2019 å¹´æˆä¸ºäº† &lt;a href=&#34;https://octoverse.github.com/#fastest-growing-oss-projects-by-contributors&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitHub å¢é•¿æœ€å¿«çš„åå¤§é¡¹ç›®ä¸­æ’åç¬¬ 4 å&lt;/a&gt;ï¼&lt;/p&gt;
&lt;h2 id=&#34;istio-ç¤¾åŒº&#34;&gt;Istio ç¤¾åŒº&lt;/h2&gt;
&lt;p&gt;Istio å¼€æºå››å¹´æ¥ï¼Œå·²ç»åœ¨ GitHub ä¸Šæ”¶è·äº† 2.7 ä¸‡é¢—æ˜Ÿï¼Œè·å¾—äº†å¤§é‡çš„&lt;a href=&#34;https://istio.io/latest/about/case-studies/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¤¾åŒºç”¨æˆ·&lt;/a&gt;ã€‚ä¸‹å›¾æ˜¯ &lt;a href=&#34;https://github.com/istio/istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt; çš„ GitHub star æ•°å¢é•¿æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-4-year-birthday/008i3skNly1gqtm7n2hm1j31me0n2tag_hu_170dd4bb8368aba5.webp 400w,
               /blog/istio-4-year-birthday/008i3skNly1gqtm7n2hm1j31me0n2tag_hu_25e2f3785c2ace4e.webp 760w,
               /blog/istio-4-year-birthday/008i3skNly1gqtm7n2hm1j31me0n2tag_hu_4ad2f6ce3a5bd8a6.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-4-year-birthday/008i3skNly1gqtm7n2hm1j31me0n2tag_hu_170dd4bb8368aba5.webp&#34;
               width=&#34;760&#34;
               height=&#34;300&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;2020 å¹´ Istio çš„é¡¹ç›®ç®¡ç†å¼€å§‹èµ°å‘æˆç†Ÿï¼Œæ²»ç†æ–¹å¼ä¹Ÿåˆ°äº†è¿›åŒ–çš„é˜¶æ®µã€‚2020 å¹´ï¼ŒIstio ç¤¾åŒºè¿›è¡Œäº†ç¬¬ä¸€æ¬¡&lt;a href=&#34;https://istio.io/latest/blog/2020/steering-election-results/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç®¡å§”ä¼šé€‰ä¸¾&lt;/a&gt;ï¼Œè¿˜æŠŠå•†æ ‡è½¬è®©ç»™äº† &lt;a href=&#34;https://istio.io/latest/blog/2020/open-usage/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Open Usage Commons&lt;/a&gt;ã€‚é¦–å±Š &lt;a href=&#34;https://events.istio.io/istiocon-2021/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IstioCon&lt;/a&gt; åœ¨ 2021 å¹´ 2 æœˆä»½æˆåŠŸä¸¾åŠï¼Œå‡ åƒäººå‚åŠ äº†çº¿ä¸Šä¼šè®®ã€‚åœ¨ä¸­å›½ä¹Ÿæœ‰å¤§é‡çš„ Istio ç¤¾åŒºç”¨æˆ·ï¼Œ2021 å¹´ä¹Ÿä¼šæœ‰çº¿ä¸‹é¢å¯¹é¢çš„ Istio ç¤¾åŒº meetup åœ¨ä¸­å›½ä¸¾åŠã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-4-year-birthday/008i3skNly1gquicfqg14j31lw0smwl2_hu_9d823fd2a99eb32f.webp 400w,
               /blog/istio-4-year-birthday/008i3skNly1gquicfqg14j31lw0smwl2_hu_fb1a748ee6238087.webp 760w,
               /blog/istio-4-year-birthday/008i3skNly1gquicfqg14j31lw0smwl2_hu_dadcf76600dc284a.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-4-year-birthday/008i3skNly1gquicfqg14j31lw0smwl2_hu_9d823fd2a99eb32f.webp&#34;
               width=&#34;760&#34;
               height=&#34;375&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ ¹æ® CNCF 2020 å¹´è°ƒæŸ¥ï¼Œ46% çš„ç»„ç»‡åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨æœåŠ¡ç½‘æ ¼æˆ–è®¡åˆ’åœ¨æœªæ¥ 12 ä¸ªæœˆå†…ä½¿ç”¨ã€‚Istio æ˜¯åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨çš„æœ€å¤šçš„ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœªæ¥&#34;&gt;æœªæ¥&lt;/h2&gt;
&lt;p&gt;ç»è¿‡ 4 å¹´çš„å‘å±•ï¼Œå›´ç»• Istio ä¸ä»…å½¢æˆäº†åºå¤§çš„ç”¨æˆ·ç¾¤ï¼Œè¿˜è¯ç”Ÿäº†å¤šå®¶ Istio ä¾›åº”å•†ï¼Œä½ å¯ä»¥åœ¨æœ€è¿‘æ”¹ç‰ˆçš„ &lt;a href=&#34;https://istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio çš„å®˜ç½‘é¦–é¡µ&lt;/a&gt;ä¸­çœ‹åˆ°ã€‚åœ¨æœ€è¿‘å‡ ä¸ªç‰ˆæœ¬ä¸­ï¼ŒIstio å·²ç»å°†å‘å±•ä¸­å¿ƒè½¬ç§»åˆ°äº†æå‡ Day 2 Operation ä½“éªŒä¸Šæ¥äº†ã€‚æˆ‘ä»¬è¿˜å¸Œæœ›çœ‹åˆ°æ›´å¤šçš„ Istio çš„é‡‡çº³è·¯å¾„å»ºè®®ã€æ¡ˆä¾‹ç ”ç©¶ã€å­¦ä¹ èµ„æ–™ã€åŸ¹è®­åŠè®¤è¯ï¼ˆä¾‹å¦‚æ¥è‡ª Tetrate çš„ä¸šç•Œçš„ç¬¬ä¸€ä¸ª &lt;a href=&#34;https://academy.tetrate.io/courses/certified-istio-administrator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio ç®¡ç†å‘˜è®¤è¯&lt;/a&gt;ï¼‰ï¼Œè¿™äº›éƒ½å°†æœ‰åˆ©äº Istio çš„æ¨å¹¿å’Œé‡‡ç”¨ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio 1.10 ç‰ˆæœ¬å‘å¸ƒå¹¶æ”¹ç‰ˆå®˜ç½‘</title>
      <link>https://cloudnativecn.com/blog/istio-1-10-release/</link>
      <pubDate>Wed, 19 May 2021 09:05:42 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-1-10-release/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ª &lt;a href=&#34;https://istio.io/latest/news/releases/1.10.x/announcing-1.10/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ï¼Œæœ‰éƒ¨åˆ†ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;åŒ—äº¬æ—¶é—´ 5 æœˆ 19 æ—¥ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´åœ°å®£å¸ƒ Istio 1.10 çš„å‘å¸ƒï¼æˆ‘ä»¬è¦ç‰¹åˆ«æ„Ÿè°¢æˆ‘ä»¬çš„å‘å¸ƒç»ç† &lt;a href=&#34;https://github.com/Monkeyanator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sam Naser&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/ZhiHanZ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼ ä¹‹æ™—&lt;/a&gt;ï¼Œä»¥åŠæ•´ä¸ªæµ‹è¯•å’Œå‘å¸ƒå·¥ä½œç»„åœ¨ 1.10 ä¸­çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯æˆ‘ä»¬ 2021 å¹´çš„ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œå’Œè¿‡å»å‡ ä¸ªç‰ˆæœ¬ä¸€æ ·ï¼Œæˆ‘ä»¬ç»§ç»­ä¸º Istio ç”¨æˆ·æ”¹å–„ Day 2 æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;è¯¥ç‰ˆæœ¬çš„äº®ç‚¹å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‘ç°é€‰æ‹©å™¨&#34;&gt;å‘ç°é€‰æ‹©å™¨&lt;/h2&gt;
&lt;p&gt;åœ¨ä»¥å‰çš„ Istio ç‰ˆæœ¬ä¸­ï¼ŒIstio çš„æ§åˆ¶å¹³é¢ä¸€ç›´åœ¨è§‚å¯Ÿå’Œå¤„ç†é›†ç¾¤ä¸­å®ƒæ‰€å…³å¿ƒçš„æ‰€æœ‰ Kubernetes èµ„æºçš„æ›´æ–°ã€‚è¿™åœ¨å¤§å‹é›†ç¾¤æˆ–é…ç½®å¿«é€Ÿå˜åŒ–çš„é›†ç¾¤ä¸­å¯èƒ½æ˜¯ä¸€ä¸ªå¯æ‰©å±•æ€§ç“¶é¢ˆã€‚å‘ç°é€‰æ‹©å™¨ï¼ˆDiscovery Selectorï¼‰é™åˆ¶äº† Istiod ç›‘è§†çš„èµ„æºé›†ï¼Œæ‰€ä»¥ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°å¿½ç•¥é‚£äº›ä¸ç½‘æ ¼æ— å…³çš„å‘½åç©ºé—´çš„å˜åŒ–ï¼ˆä¾‹å¦‚ä¸€ç»„ Spark Jobï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥è®¤ä¸ºå®ƒä»¬æœ‰ç‚¹åƒ Istio çš„ Sidecar API èµ„æºï¼Œä½†å¯¹äº Istiod æœ¬èº«æ¥è¯´ï¼šSidecar èµ„æºé™åˆ¶äº† Istiod å°†å‘é€è‡³ Envoy çš„é…ç½®é›†ã€‚å‘ç°é€‰æ‹©å™¨é™åˆ¶äº† Istio ä» Kubernetes æ¥æ”¶å’Œå¤„ç†çš„é…ç½®é›†ã€‚&lt;/p&gt;
&lt;p&gt;è¯·çœ‹ Linã€Christian å’Œ Harvey çš„&lt;a href=&#34;https://istio.io/latest/blog/2021/discovery-selectors/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç²¾å½©æ–‡ç« &lt;/a&gt;ï¼Œæ·±å…¥äº†è§£è¿™é¡¹æ–°åŠŸèƒ½çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¨³å®šçš„ä¿®è®¢ç‰ˆæ ‡ç­¾&#34;&gt;ç¨³å®šçš„ä¿®è®¢ç‰ˆæ ‡ç­¾&lt;/h2&gt;
&lt;p&gt;æ—©åœ¨ &lt;a href=&#34;https://istio.io/latest/blog/2020/multiple-control-planes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;1.6 ç‰ˆæœ¬&lt;/a&gt;ä¸­ï¼ŒIstio å°±å¢åŠ äº†å¯¹å®‰å…¨éƒ¨ç½²å¤šä¸ªæ§åˆ¶å¹³é¢çš„æ”¯æŒï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸€ç›´åœ¨ç¨³æ­¥æé«˜æ”¯æŒåº¦ã€‚å…³äºä¿®è®¢ç‰ˆçš„ä¸€ä¸ªä¸»è¦çš„å¯ç”¨æ€§æŠ±æ€¨æ˜¯éœ€è¦å¤§é‡çš„å‘½åç©ºé—´é‡æ–°æ ‡è®°æ¥æ”¹å˜ä¿®è®¢ç‰ˆï¼ˆrevisionï¼‰ï¼Œå› ä¸ºä¸€ä¸ªæ ‡ç­¾ï¼ˆlabelï¼‰ç›´æ¥æ˜ å°„åˆ°ä¸€ä¸ªç‰¹å®šçš„ Istio æ§åˆ¶å¹³é¢éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†ä¿®è®¢ç‰ˆæ ‡ç­¾ï¼Œç°åœ¨æœ‰äº†ä¸€ä¸ªé—´æ¥å±‚ï¼šä½ å¯ä»¥åˆ›å»ºåƒ &lt;code&gt;canary&lt;/code&gt; å’Œ &lt;code&gt;prod&lt;/code&gt; è¿™æ ·çš„æ ‡ç­¾ï¼ŒæŠŠä½¿ç”¨è¿™äº›æ ‡ç­¾çš„å‘½åç©ºé—´æ ‡è®°ä¸ºä¿®è®¢ç‰ˆï¼ˆå³ &lt;code&gt;istio.io/rev=prod&lt;/code&gt;ï¼‰ï¼Œå¹¶æŠŠç‰¹å®šçš„ Istiod ä¿®è®¢ç‰ˆä¸è¯¥æ ‡ç­¾è”ç³»èµ·æ¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰ä¸¤ä¸ªä¿®è®¢ç‰ˆï¼Œ&lt;code&gt;1-7-6&lt;/code&gt; å’Œ &lt;code&gt;1-8-0&lt;/code&gt;ã€‚ä½ åˆ›å»ºä¸€ä¸ªæŒ‡å‘ &lt;code&gt;1-7-6&lt;/code&gt; ç‰ˆæœ¬çš„ä¿®è®¢æ ‡ç­¾ &lt;code&gt;prod&lt;/code&gt;ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¾ƒæ–°çš„ &lt;code&gt;1-8-0&lt;/code&gt; ç‰ˆæœ¬çš„ä¿®è®¢æ ‡ç­¾ &lt;code&gt;canary&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-1-10-release/008i3skNly1gqngrkysi4j30wu0p0n0g_hu_7d5abf1382bb0797.webp 400w,
               /blog/istio-1-10-release/008i3skNly1gqngrkysi4j30wu0p0n0g_hu_ccfedf1ea92f199d.webp 760w,
               /blog/istio-1-10-release/008i3skNly1gqngrkysi4j30wu0p0n0g_hu_47cca1b2265daaf2.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-1-10-release/008i3skNly1gqngrkysi4j30wu0p0n0g_hu_7d5abf1382bb0797.webp&#34;
               width=&#34;760&#34;
               height=&#34;578&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å‘½åç©ºé—´ A å’Œ B æŒ‡å‘ &lt;code&gt;1-7-6&lt;/code&gt;ï¼Œå‘½åç©ºé—´ C æŒ‡å‘ &lt;code&gt;1-8-0&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œå½“ä½ å‡†å¤‡å°† &lt;code&gt;1-8-0&lt;/code&gt; ä¿®è®¢ç‰ˆä» &lt;code&gt;canary&lt;/code&gt; æ¨åˆ° &lt;code&gt;prod&lt;/code&gt; æ—¶ï¼Œä½ å¯ä»¥å°† &lt;code&gt;prod&lt;/code&gt; æ ‡ç­¾ä¸ &lt;code&gt;1-8-0&lt;/code&gt; Istiod ä¿®è®¢ç‰ˆé‡æ–°å…³è”ã€‚ç°åœ¨ï¼Œæ‰€æœ‰ä½¿ç”¨ &lt;code&gt;istio.io/rev=prod&lt;/code&gt; çš„å‘½åç©ºé—´å°†ä½¿ç”¨è¾ƒæ–°çš„ &lt;code&gt;1-8-0&lt;/code&gt; ç‰ˆæœ¬è¿›è¡Œæ³¨å…¥ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-1-10-release/008i3skNly1gqngtj5qyej30vm0oujut_hu_f53e5978ae351969.webp 400w,
               /blog/istio-1-10-release/008i3skNly1gqngtj5qyej30vm0oujut_hu_98a3786be44b4c29.webp 760w,
               /blog/istio-1-10-release/008i3skNly1gqngtj5qyej30vm0oujut_hu_307dade9ffe32062.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-1-10-release/008i3skNly1gqngtj5qyej30vm0oujut_hu_f53e5978ae351969.webp&#34;
               width=&#34;760&#34;
               height=&#34;597&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å‘½åç©ºé—´ Aã€B å’Œ C æŒ‡å‘ &lt;code&gt;1-8-0&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¯·æŸ¥çœ‹&lt;a href=&#34;https://istio.io/latest/docs/setup/upgrade/canary/#stable-revision-labels-experimental&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ›´æ–°åçš„ Canary å‡çº§æŒ‡å—&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-ç½‘ç»œå˜åŒ–&#34;&gt;Sidecar ç½‘ç»œå˜åŒ–&lt;/h2&gt;
&lt;p&gt;åœ¨ä»¥å‰çš„ Istio ç‰ˆæœ¬ä¸­ï¼ŒIstio å·²ç»é‡å†™äº† pod ç½‘ç»œï¼Œä» &lt;code&gt;eth0&lt;/code&gt; æ•è·æµé‡ï¼Œå¹¶å°†å…¶å‘é€åˆ° &lt;code&gt;lo&lt;/code&gt; ä¸Šçš„åº”ç”¨ç¨‹åºã€‚å¤§å¤šæ•°åº”ç”¨ç¨‹åºéƒ½ç»‘å®šäº†è¿™ä¸¤ä¸ªæ¥å£ï¼Œå¹¶æ²¡æœ‰æ³¨æ„åˆ°ä»»ä½•åŒºåˆ«ï¼›ä½†æœ‰äº›åº”ç”¨ç¨‹åºè¢«ç‰¹åˆ«ç¼–å†™ä¸ºåªæœŸæœ›åœ¨å…¶ä¸­ä¸€ä¸ªæ¥å£ä¸Šè·å¾—ç‰¹å®šçš„æµé‡ï¼ˆä¾‹å¦‚ï¼Œé€šå¸¸åªåœ¨ &lt;code&gt;lo&lt;/code&gt; ä¸Šæš´éœ²ç®¡ç†ç«¯ç‚¹ï¼Œè€Œä»ä¸é€šè¿‡ &lt;code&gt;eth0&lt;/code&gt;ï¼Œæˆ–è€…æœ‰çŠ¶æ€çš„åº”ç”¨ç¨‹åºåªç»‘å®š &lt;code&gt;eth0&lt;/code&gt;ï¼‰ã€‚è¿™äº›åº”ç”¨ç¨‹åºçš„è¡Œä¸ºå¯èƒ½ä¼šå—åˆ° Istio å¼•å¯¼æµé‡è¿›å…¥ pod çš„å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ 1.10 ç‰ˆæœ¬ä¸­ï¼ŒIstio æ­£åœ¨æ›´æ–° Envoyï¼Œé»˜è®¤åœ¨ &lt;code&gt;eth0&lt;/code&gt; è€Œä¸æ˜¯ &lt;code&gt;lo&lt;/code&gt; ä¸Šå‘åº”ç”¨ç¨‹åºå‘é€æµé‡ã€‚å¯¹äºæ–°ç”¨æˆ·æ¥è¯´ï¼Œè¿™åº”è¯¥åªæ˜¯ä¸€ä¸ªæ”¹è¿›ã€‚å¯¹äºç°æœ‰çš„ç”¨æˆ·ï¼Œ&lt;code&gt;istioctl experimental precheck&lt;/code&gt; å°†è¯†åˆ«å‡ºç›‘å¬ localhost çš„ podï¼Œå¹¶å¯èƒ½å—åˆ°å½±å“ï¼Œå¦‚ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/analysis/ist0143/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IST0143&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¯·å‚é˜… John Howard çš„&lt;a href=&#34;https://istio.io/latest/blog/2021/upcoming-networking-changes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡ç« &lt;/a&gt;ï¼Œä»¥æ›´æ·±å…¥åœ°äº†è§£è¿™ä¸€å˜åŒ–ï¼Œå¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆå®ƒå¯èƒ½ä¼šå½±å“ä½ ï¼Œä»¥åŠå¦‚ä½•å®ç°æ— ç¼è¿ç§»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istioio-æ”¹ç‰ˆ&#34;&gt;Istio.io æ”¹ç‰ˆ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¯¹ Istio.io è¿›è¡Œäº†æ”¹é€ ï¼Œé‡‡ç”¨äº†å…¨æ–°çš„å¤–è§‚ï¼è¿™æ˜¯ Istio é¡¹ç›®å¯åŠ¨è¿‘å››å¹´ä»¥æ¥ï¼Œç½‘ç«™çš„ç¬¬ä¸€ä¸ªé‡å¤§å˜åŒ–ï¼ˆæˆ‘ä»¬å°†åœ¨ 5 æœˆ 24 æ—¥ï¼ŒåŒ—äº¬æ—¶é—´ 5 æœˆ 25 æ—¥ï¼Œåº†ç¥è¿™ä¸ªå‘¨å¹´çºªå¿µæ—¥ï¼ï¼‰ã€‚æˆ‘ä»¬å¸Œæœ›è¿™äº›å˜åŒ–æœ‰åŠ©äºä½¿ç½‘ç«™æ›´æ–¹ä¾¿ç”¨æˆ·ï¼Œæ›´å®¹æ˜“æµè§ˆï¼Œæ€»ä½“ä¸Šæ›´æœ‰å¯è¯»æ€§ã€‚&lt;/p&gt;
&lt;p&gt;Istio å®˜ç½‘å…¨æ–°æ”¹ç‰ˆï¼Œæ•ˆæœå¦‚å›¾ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-1-10-release/008i3skNly1gqngin11o0j31m30u0n78_hu_4429e28ab7570669.webp 400w,
               /blog/istio-1-10-release/008i3skNly1gqngin11o0j31m30u0n78_hu_439a3b3d31ad0a3f.webp 760w,
               /blog/istio-1-10-release/008i3skNly1gqngin11o0j31m30u0n78_hu_a8c751543fd71986.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-1-10-release/008i3skNly1gqngin11o0j31m30u0n78_hu_4429e28ab7570669.webp&#34;
               width=&#34;760&#34;
               height=&#34;392&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç½‘ç«™å·¦ä¸‹è§’æœ‰ä¸­è‹±æ–‡åˆ‡æ¢åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-1-10-release/008i3skNly1gqngjq6xz6j31le0u0dnd_hu_e7d68ade8cf60135.webp 400w,
               /blog/istio-1-10-release/008i3skNly1gqngjq6xz6j31le0u0dnd_hu_cb3726936582d980.webp 760w,
               /blog/istio-1-10-release/008i3skNly1gqngjq6xz6j31le0u0dnd_hu_abe8a32431feed2a.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-1-10-release/008i3skNly1gqngjq6xz6j31le0u0dnd_hu_e7d68ade8cf60135.webp&#34;
               width=&#34;760&#34;
               height=&#34;397&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ„Ÿè°¢äº‘åŸç”Ÿç¤¾åŒº Istio SIG ç¿»è¯‘å’Œç»´æŠ¤äº† Istio å®˜ç½‘ä¸­æ–‡æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é¡¹å·¥ä½œç”± Google Cloud èµåŠ©ï¼Œæˆ‘ä»¬è¦ç‰¹åˆ«æ„Ÿè°¢ &lt;a href=&#34;https://twitter.com/craigbox&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Craig Box&lt;/a&gt;ã€&lt;a href=&#34;https://twitter.com/iamaijamal&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Aizhamal Nurmamat kyzy&lt;/a&gt; å’Œ Srinath Padmanabhan æ¨åŠ¨è¿™é¡¹å·¥ä½œï¼Œå¹¶æ„Ÿè°¢æ‰€æœ‰å¸®åŠ©å®¡æŸ¥å’Œæä¾›æ—©æœŸä¿®è®¢åé¦ˆçš„äººä»¬ã€‚&lt;/p&gt;
&lt;p&gt;è¯·åœ¨ &lt;a href=&#34;https://github.com/istio/istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;istio.io èµ„æºåº“&lt;/a&gt;ä¸Šæäº¤é—®é¢˜ï¼Œç»™æˆ‘ä»¬ä»»ä½•åé¦ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¼€æ”¾æˆ‘ä»¬çš„è®¾è®¡æ–‡ä»¶&#34;&gt;å¼€æ”¾æˆ‘ä»¬çš„è®¾è®¡æ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;ä» 2021 å¹´ 5 æœˆ 20 æ—¥å¼€å§‹ï¼ŒIstio çš„è®¾è®¡å’Œè§„åˆ’æ–‡ä»¶å°†å‘äº’è”ç½‘ä¸Šçš„æ‰€æœ‰äººå¼€æ”¾ï¼Œæ— éœ€ç™»å½•ã€‚æ­¤å‰ï¼ŒæŸ¥çœ‹è¿™äº›æ–‡ä»¶éœ€è¦è°·æ­Œç™»å½•å’Œç¾¤ç»„æˆå‘˜èµ„æ ¼ã€‚è¿™ä¸€å˜åŒ–å°†ä½¿æŠ€æœ¯æ–‡ä»¶çš„åˆ†äº«æ›´å®¹æ˜“ã€æ›´å¼€æ”¾ã€‚æ–‡ä»¶å°†ä¿æŒåœ¨ä¸ä»¥å‰ç›¸åŒçš„ URLï¼Œä½† Community Drive åŠå…¶æ–‡ä»¶å¤¹å°†æ”¹å˜ä½ç½®ã€‚æˆ‘ä»¬å°†åœ¨æœ¬å‘¨å†…è”ç³»æ‰€æœ‰çš„è´¡çŒ®è€…å’Œ Drive æˆå‘˜ï¼Œå¹¶å‘ŠçŸ¥æ–°çš„ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¼ƒç”¨&#34;&gt;å¼ƒç”¨&lt;/h2&gt;
&lt;p&gt;åœ¨ 1.10 ç‰ˆæœ¬ä¸­ï¼Œæœ‰ä¸¤ä¸ªåŠŸèƒ½å°†è¢«åºŸå¼ƒã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes ç¬¬ä¸€æ–¹ JWT æ”¯æŒï¼ˆ&lt;code&gt;values.global.jwtPolicy=first-party-jwt&lt;/code&gt;ï¼‰å°†è¢«åˆ é™¤ï¼›å®ƒçš„å®‰å…¨æ€§è¾ƒä½ï¼Œä»…ç”¨äºå‘åå…¼å®¹æ—§ç‰ˆ Kubernetesã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;values.global.arch&lt;/code&gt; é€‰é¡¹å·²ç»è¢« Kubernetes é…ç½®ä¸­çš„ Affinity è®¾ç½®æ‰€å–ä»£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯·å‚é˜… 1.10 &lt;a href=&#34;https://istio.io/latest/news/releases/1.10.x/announcing-1.10/change-notes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å˜æ›´è¯´æ˜&lt;/a&gt;ä»¥äº†è§£è¿™äº›åºŸå¼ƒçš„è¯¦ç»†æƒ…å†µã€‚&lt;/p&gt;
&lt;h2 id=&#34;åé¦ˆ&#34;&gt;åé¦ˆ&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ å·²ç»å°†ä½ çš„æœåŠ¡ç½‘æ ¼å‡çº§åˆ° Istio 1.10ï¼Œæˆ‘ä»¬æƒ³å¬å¬ä½ çš„æ„è§ï¼è¯·è€ƒè™‘å‚åŠ è¿™ä¸ªç®€çŸ­çš„ï¼ˆçº¦ 2 åˆ†é’Ÿï¼‰&lt;a href=&#34;https://docs.google.com/forms/d/e/1FAIpQLSfzonL4euvGgUM7kyXjsucP4UV8mH9M2snKVFQnT-L7eIXp_g/viewform?resourcekey=0-pWz7V0MsuFrdfJ_-NTQwXQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è°ƒæŸ¥&lt;/a&gt;ï¼Œä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£æˆ‘ä»¬åœ¨å“ªäº›æ–¹é¢åšå¾—å¥½ï¼Œä»¥åŠåœ¨å“ªäº›æ–¹é¢è¿˜éœ€è¦æ”¹è¿›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-å¤§å’–è¯´-b-ç«™ç›´æ’­istio-å¼€æºå››å‘¨å¹´å›é¡¾ä¸å±•æœ›&#34;&gt;Istio å¤§å’–è¯´ B ç«™ç›´æ’­ï¼šIstio å¼€æºå››å‘¨å¹´å›é¡¾ä¸å±•æœ›&lt;/h2&gt;
&lt;p&gt;æƒ³äº†è§£ Istio çš„æ¥å†å—ï¼Ÿæƒ³çŸ¥é“ Istio è‡ªæˆ‘æ•‘èµèˆ¬çš„æ¶æ„é‡æ„å—ï¼Ÿæƒ³çª¥æ¢ Istio å¼€å‘èƒŒåçš„è¶£äº‹å—ï¼Ÿæƒ³ä¸€èµ·è§£è¯»æœ€æ–°ç‰ˆæœ¬çš„æ–°ç‰¹æ€§å—ï¼ŸåŒ—äº¬æ—¶é—´ 5 æœˆ 25 æ—¥æ™šä¸Š 8 ç‚¹ï¼Œç›¸çº¦ B ç«™ï¼Œè®©æˆ‘ä»¬ä¸€èµ·å›é¡¾ Istio å‘å¸ƒå››å‘¨å¹´çš„ç‚¹ç‚¹æ»´æ»´ï¼Œ&lt;a href=&#34;https://live.bilibili.com/23095515&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;B ç«™ç›´æ’­é—´&lt;/a&gt;ä¸è§ä¸æ•£ï¼&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-1-10-release/bilibili_hu_329cbaaf9fb30aa0.webp 400w,
               /blog/istio-1-10-release/bilibili_hu_e2783467013a8ace.webp 760w,
               /blog/istio-1-10-release/bilibili_hu_156742067c7cd2bc.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-1-10-release/bilibili_hu_329cbaaf9fb30aa0.webp&#34;
               width=&#34;760&#34;
               height=&#34;428&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ã€ŠIstio å¤§å’–è¯´ã€‹æ˜¯ç”± Tetrate å† åçš„ä»¥ Istio å’ŒæœåŠ¡ç½‘æ ¼ä¸ºä¸»é¢˜çš„ç›´æ’­æ´»åŠ¨ï¼Œåˆ†äº«å¼€æºæŠ€æœ¯åŠå®è·µã€‚ç¬¬ä¸€æœŸç›´æ’­å°†åœ¨ Istio å¼€æºå››å‘¨å¹´ä¹‹é™…ï¼Œé‚€è¯· Istio å¤§å’–é©¬è‹¥é£ï¼Œå…±åŒå›é¡¾ Istio å¼€æºèµ°è¿‡çš„å†ç¨‹åŠå±•æœ›æœªæ¥ï¼Œä¸»æŒäººå®‹å‡€è¶…ï¼ˆJimmy Songï¼‰ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio 1.8 å‘å¸ƒâ€”â€”ç”¨æˆ·è‡³ä¸Šçš„é€‰æ‹©</title>
      <link>https://cloudnativecn.com/blog/istio-18-release/</link>
      <pubDate>Thu, 19 Nov 2020 16:25:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-18-release/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://istio.io/latest/news/releases/1.8.x/announcing-1.8/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;1.8&lt;/a&gt; æ˜¯ Istio åœ¨ 2020 å¹´å‘å¸ƒçš„æœ€åä¸€ä¸ªç‰ˆæœ¬ï¼ŒæŒ‰ç…§ Istio ç¤¾åŒºåœ¨&lt;a href=&#34;https://istio.io/latest/blog/2020/tradewinds-2020/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»Šå¹´åˆè®¾å®šçš„ç›®æ ‡&lt;/a&gt;ç»§ç»­æ¨è¿›ï¼Œè¯¥ç‰ˆæœ¬ä¸»è¦æœ‰ä»¥ä¸‹æ›´æ–°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒä½¿ç”¨ Helm 3 è¿›è¡Œå®‰è£…å’Œå‡çº§&lt;/li&gt;
&lt;li&gt;æ­£å¼ç§»é™¤äº† Mixer&lt;/li&gt;
&lt;li&gt;æ–°å¢äº† Istio DNS proxyï¼Œé€æ˜åœ°æ‹¦æˆªåº”ç”¨ç¨‹åºçš„ DNS æŸ¥è¯¢ï¼Œå®ç°æ™ºèƒ½åº”ç­”&lt;/li&gt;
&lt;li&gt;æ–°å¢äº† &lt;code&gt;WorkloadGroup&lt;/code&gt; ä»¥ç®€åŒ–å¯¹è™šæ‹Ÿæœºçš„å¼•å…¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;WorkloadGroup &lt;/code&gt;æ˜¯ä¸€ä¸ªæ–°çš„ API å¯¹è±¡ï¼Œæ—¨åœ¨ä¸è™šæ‹Ÿæœºç­‰é Kubernetes å·¥ä½œè´Ÿè½½ä¸€èµ·ä½¿ç”¨ï¼Œæ¨¡ä»¿ç°æœ‰çš„ç”¨äº Kubernetes å·¥ä½œè´Ÿè½½çš„ sidecar æ³¨å…¥å’Œéƒ¨ç½²è§„èŒƒæ¨¡å‹æ¥å¼•å¯¼ Istio ä»£ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…ä¸å‡çº§&#34;&gt;å®‰è£…ä¸å‡çº§&lt;/h2&gt;
&lt;p&gt;Istio ä» 1.5 ç‰ˆæœ¬å¼€å§‹å¼ƒç”¨äº† Helmï¼Œä½¿ç”¨ &lt;code&gt;istioctl manifest&lt;/code&gt; æ–¹å¼å®‰è£…ï¼Œåæ¥åˆæ”¹æˆäº† &lt;code&gt;istioctl install&lt;/code&gt;ï¼Œç°åœ¨åˆé‡æ–°å›å½’äº† Helmï¼ŒHelm ä½œä¸º Kubernetes ç¯å¢ƒä¸‹æœ€å¸¸ç”¨çš„åº”ç”¨å®‰è£…ç®¡ç†ç»„ä»¶ï¼Œæ­¤æ¬¡å›å½’ä¹Ÿæ˜¯å€¾å¬ç”¨æˆ·å£°éŸ³ï¼Œä¼˜åŒ–å®‰è£…ä½“éªŒçš„çš„ååº”å§ï¼Œä¸è¿‡ Istio Operator ä¾ç„¶å°†æ˜¯ Istio å®‰è£…çš„æœ€ç»ˆå½¢å¼ï¼Œä» 1.8 ç‰ˆæœ¬å¼€å§‹ Istio æ”¯æŒä½¿ç”¨ &lt;a href=&#34;https://istio.io/latest/docs/setup/install/helm/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm&lt;/a&gt; è¿›è¡Œ in-place å‡çº§å’Œ canary å‡çº§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¢å¼º-istio-çš„æ˜“ç”¨æ€§&#34;&gt;å¢å¼º Istio çš„æ˜“ç”¨æ€§&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;istioctl&lt;/code&gt; å‘½ä»¤è¡Œå·¥å…·æ–°çš„äº† bug reporting åŠŸèƒ½ï¼ˆ&lt;code&gt;istioctl bug-report&lt;/code&gt;ï¼‰ï¼Œå¯ä»¥ç”¨æ¥æ”¶é›†è°ƒè¯•ä¿¡æ¯å’Œè·å–é›†ç¾¤çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/latest/blog/2020/addon-rework/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£… add-on&lt;/a&gt; çš„æ–¹å¼å˜äº†ï¼Œåœ¨ 1.7 ä¸­å·²ç»ä¸æ¨èä½¿ç”¨ istioctl æ¥å®‰è£…ï¼Œåœ¨ 1.8 ä¸­ç›´æ¥è¢«ç§»é™¤äº†ï¼Œè¿™æ ·æœ‰åˆ©äºè§£å†³ add-on è½åäºä¸Šæ¸¸åŠéš¾ä»¥ç»´æŠ¤çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æ­£å¼ç§»é™¤äº† Mixerï¼Œæ¨èä½¿ç”¨ &lt;a href=&#34;https://istio.io/latest/blog/2020/wasm-announce/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WebAssembly&lt;/a&gt; é€šè¿‡æ‰©å±• Envoy çš„æ–¹å¼æ¥æ‰©å±• Istioï¼Œä¹Ÿæ¨èå¤§å®¶ä½¿ç”¨ &lt;a href=&#34;https://www.getenvoy.io/reference/getenvoy_extension_toolkit_reference/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GetEnvoy Toolkit&lt;/a&gt; æ¥è¿›è¡Œ Envoy çš„æ‰©å±•å¼€å‘ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯¹è™šæ‹Ÿæœºçš„æ”¯æŒ&#34;&gt;å¯¹è™šæ‹Ÿæœºçš„æ”¯æŒ&lt;/h2&gt;
&lt;p&gt;åœ¨æˆ‘&lt;a href=&#34;https://thenewstack.io/how-to-integrate-virtual-machines-into-istio-service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¹‹å‰çš„åšå®¢&lt;/a&gt;ä¸­è°ˆåˆ° Istio 1.7 å¦‚ä½•æ”¯æŒè™šæ‹Ÿæœºï¼Œåœ¨ Istio 1.8 ä¸­æ–°å¢äº†&lt;a href=&#34;https://istio.io/latest/blog/2020/dns-proxy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ™ºèƒ½ DNS ä»£ç†&lt;/a&gt;ï¼Œå®ƒæ˜¯ç”± Go ç¼–å†™çš„ Istio sidecar ä»£ç†ï¼Œsidecar ä¸Šçš„ Istio agent å°†é™„å¸¦ä¸€ä¸ªç”± Istiod åŠ¨æ€ç¼–ç¨‹çš„ç¼“å­˜ DNS ä»£ç†ã€‚æ¥è‡ªåº”ç”¨ç¨‹åºçš„ DNS æŸ¥è¯¢ä¼šè¢« pod æˆ– VM ä¸­çš„ Istio ä»£ç†é€æ˜åœ°æ‹¦æˆªå’ŒæœåŠ¡ï¼Œè¯¥ä»£ç†ä¼šæ™ºèƒ½åœ°å“åº” DNS æŸ¥è¯¢è¯·æ±‚ï¼Œå¯ä»¥å®ç°è™šæ‹Ÿæœºåˆ°æœåŠ¡ç½‘æ ¼çš„æ— ç¼å¤šé›†ç¾¤è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;æ–°å¢äº† &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/workload-group/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WorkloadGroup&lt;/a&gt; ï¼Œå®ƒæè¿°äº†å·¥ä½œè´Ÿè½½å®ä¾‹çš„é›†åˆã€‚æä¾›äº†ä¸€ä¸ªè§„èŒƒï¼Œå·¥ä½œè´Ÿè½½å®ä¾‹å¯ä»¥ç”¨æ¥å¼•å¯¼å®ƒä»¬çš„ä»£ç†ï¼ŒåŒ…æ‹¬å…ƒæ•°æ®å’Œèº«ä»½ã€‚å®ƒåªæ‰“ç®—ä¸è™šæ‹Ÿæœºç­‰é Kubernetes å·¥ä½œè´Ÿè½½ä¸€èµ·ä½¿ç”¨ï¼Œæ—¨åœ¨æ¨¡ä»¿ç°æœ‰çš„ç”¨äº Kubernetes å·¥ä½œè´Ÿè½½çš„ sidecar æ³¨å…¥å’Œéƒ¨ç½²è§„èŒƒæ¨¡å‹æ¥å¼•å¯¼ Istio ä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;a href=&#34;https://tetrate.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate&lt;/a&gt;ï¼Œæˆ‘ä»¬åœ¨å®¢æˆ·çš„å¤šé›†ç¾¤éƒ¨ç½²ä¸­å¹¿æ³›ä½¿ç”¨è¿™ç§æœºåˆ¶ï¼Œä»¥ä½¿ sidecar èƒ½å¤Ÿä¸ºæš´éœ²åœ¨ç½‘æ ¼ä¸­æ‰€æœ‰é›†ç¾¤çš„å…¥å£ç½‘å…³çš„ä¸»æœºè§£æ DNSï¼Œå¹¶é€šè¿‡ mTLS è®¿é—®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æ€»è€Œè¨€ä¹‹ï¼ŒIstio å›¢é˜Ÿå±¥è¡Œäº†&lt;a href=&#34;https://istio.io/latest/blog/2020/tradewinds-2020/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¹´åˆçš„æ‰¿è¯º&lt;/a&gt;ï¼Œè‡ª 2018 å¹´å‘å¸ƒ 1.1 ç‰ˆæœ¬å‘å¸ƒèµ·ï¼Œä¿æŒäº†å›ºå®šçš„å‘å¸ƒèŠ‚å¥ï¼Œæ¯ 3 ä¸ªæœˆå‘å¸ƒä¸€ä¸ªç‰ˆæœ¬ï¼Œåœ¨æ€§èƒ½ã€ç”¨æˆ·ä½“éªŒä¸ŠæŒç»­ä¼˜åŒ–ï¼Œä»¥æ»¡è¶³ brownfiled åº”ç”¨ä¸ greenfield åº”ç”¨åœ¨ Istio ä¸Šçš„æ— ç¼ä½“éªŒã€‚æˆ‘ä»¬æœŸå¾… Istio åœ¨ 2021 å¹´å¯ä»¥ç»™æˆ‘ä»¬å¸¦æ¥æ›´å¤šæƒŠå–œã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œæ„Ÿè°¢&lt;a href=&#34;https://github.com/malphi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é©¬è‹¥é£&lt;/a&gt;å¯¹æœ¬æ–‡çš„å®¡é˜…ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æ·±å…¥äº†è§£ Istio æœåŠ¡ç½‘æ ¼æ•°æ®å¹³é¢æ€§èƒ½å’Œè°ƒä¼˜</title>
      <link>https://cloudnativecn.com/blog/istio-data-plane-performance-optimization/</link>
      <pubDate>Tue, 01 Sep 2020 02:37:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-data-plane-performance-optimization/</guid>
      <description>&lt;p&gt;å½­ç£Šï¼Œé™ˆå‡Œé¹ï¼Œè…¾è®¯äº‘é«˜çº§è½¯ä»¶å·¥ç¨‹å¸ˆï¼Œç›®å‰è´Ÿè´£ TCM æœåŠ¡ç½‘æ ¼äº§å“ï¼Œè‡´åŠ›äºæ‰“é€ äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ã€‚æœ¬æ–‡é¦–å‘äº&lt;a href=&#34;https://cloud.tencent.com/developer/article/1685873&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è…¾è®¯äº‘ + ç¤¾åŒº&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è…¾è®¯ï¼Œå·²ç»æœ‰å¾ˆå¤šäº§å“å·²ä½¿ç”¨æˆ–è€…æ­£åœ¨å°è¯•ä½¿ç”¨ istio æ¥ä½œä¸ºå…¶å¾®æœåŠ¡æ²»ç†çš„åŸºç¡€å¹³å°ã€‚ä¸è¿‡åœ¨ä½¿ç”¨ istio æ—¶ï¼Œä¹Ÿæœ‰ä¸€äº›å¯¹é€šä¿¡æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„ä¸šåŠ¡ä¼šå¯¹ istio çš„æ€§èƒ½æœ‰ä¸€äº›æ‹…å¿§ã€‚ç”±äº envoy sidecar çš„å¼•å…¥ï¼Œä½¿ä¸¤ä¸ªå¾®æœåŠ¡ä¹‹é—´çš„é€šä¿¡è·¯å¾„å˜é•¿ï¼Œå¯¼è‡´æœåŠ¡å»¶æ—¶å—åˆ°äº†ä¸€äº›å½±å“ï¼Œistio ç¤¾åŒºä¸€ç›´ä»¥æ¥ä¹Ÿæœ‰è¿™æ–¹é¢çš„å£°éŸ³ã€‚åŸºäºè¿™ç±»æŠ±æ€¨ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå¯¹è¿™ä¸€é€šä¿¡è¿‡ç¨‹è¿›è¡Œä¼˜åŒ–ï¼Œä»¥æ›´å¥½çš„æ»¡è¶³æ›´å¤šå®¢æˆ·çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ istio æ•°æ®é¢çš„é€šä¿¡æ¨¡å‹ï¼Œæ¥åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šå¯¹å»¶æ—¶æœ‰è¿™ä¹ˆå¤§çš„å½±å“ã€‚å¯ä»¥çœ‹åˆ°ï¼Œç›¸æ¯”äºæœåŠ¡ä¹‹é—´ç›´æ¥é€šä¿¡ï¼Œåœ¨å¼•å…¥ istio ä¹‹åï¼Œé€šä¿¡è·¯å¾„ä¼šæœ‰æ˜æ˜¾å¢åŠ ï¼Œä¸»è¦åŒ…æ‹¬å¤šå‡ºäº†ä¸¤æ¬¡æœ¬åœ°è¿›ç¨‹ä¹‹é—´çš„ tcp è¿æ¥é€šä¿¡å’Œç”¨æˆ·æ€ç½‘ç»œä»£ç† envoy å¯¹æ•°æ®çš„å¤„ç†ã€‚æ‰€ä»¥æˆ‘ä»¬çš„ä¼˜åŒ–ä¹Ÿåˆ†ä¸ºäº†ä¸¤éƒ¨åˆ†è¿›è¡Œã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-data-plane-performance-optimization/xdt8nfe0nw_hu_5796a395048b344a.webp 400w,
               /blog/istio-data-plane-performance-optimization/xdt8nfe0nw_hu_7f6bec879979138f.webp 760w,
               /blog/istio-data-plane-performance-optimization/xdt8nfe0nw_hu_87094bbd3f374100.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-data-plane-performance-optimization/xdt8nfe0nw_hu_5796a395048b344a.webp&#34;
               width=&#34;760&#34;
               height=&#34;405&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å†…æ ¸æ€è½¬å‘ä¼˜åŒ–&#34;&gt;å†…æ ¸æ€è½¬å‘ä¼˜åŒ–&lt;/h2&gt;
&lt;p&gt;é‚£ä¹ˆå¯¹äºæœ¬åœ°è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ä¼˜åŒ–ï¼Œæˆ‘ä»¬èƒ½åšäº›ä»€ä¹ˆå‘¢ï¼Ÿå…¶å®åœ¨å¼€æºç¤¾åŒºå·²ç»æœ‰äº†è¿™æ–¹é¢çš„æ¢ç´¢äº†ã€‚istio å®˜æ–¹ç¤¾åŒºåœ¨ 2019 å¹´ 1 æœˆçš„æ—¶å€™å·²ç»æœ‰äº†è¿™æ–¹é¢è®¨è®ºï¼Œåœ¨æ–‡æ¡£é‡Œé¢æåˆ°äº†ä½¿ç”¨ ebpf çš„æŠ€æœ¯æ¥åš socket è½¬å‘çš„æ•°æ®ä»£ç†ï¼Œä½¿æ•°æ®åœ¨ socket å±‚è¿›è¡Œè½¬å‘ï¼Œè€Œä¸éœ€è¦å†å¾€ä¸‹ç»è¿‡æ›´åº•å±‚çš„ TCP/IP åè®®æ ˆçš„ä¸€ä¸ªå¤„ç†ï¼Œä»è€Œå‡å°‘å®ƒåœ¨æ•°æ®é“¾è·¯ä¸Šçš„é€šä¿¡é“¾è·¯é•¿åº¦ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œç½‘ç»œå¼€æºé¡¹ç›® cilium ä¹Ÿåœ¨è¿™æ–¹é¢æœ‰ä¸€ä¸ªæ¯”è¾ƒæ·±å…¥çš„å®è·µï¼ŒåŒæ ·ä¹Ÿæ˜¯ä½¿ç”¨äº† ebpf çš„æŠ€æœ¯ã€‚ä¸è¿‡åœ¨ cilium ä¸­æœ¬åœ°&lt;a href=&#34;https://cloud.tencent.com/product/dsa?from=10680&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘ç»œåŠ é€Ÿ&lt;/a&gt;åªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œæ²¡æœ‰ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡è¿›è¡Œå¼€å‘å®è·µï¼Œåœ¨è…¾è®¯äº‘å†…éƒ¨æ²¡æ³•ç›´æ¥ä½¿ç”¨ï¼Œè¿™ä¹Ÿä¿ƒä½¿äº†æˆ‘ä»¬å¼€å‘ä¸€ä¸ªæ— ä¾èµ–çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶åœ¨åˆæœŸçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå¯¹ ebpf çš„æŠ€æœ¯è¿›è¡Œäº†ä¸€ä¸ªéªŒè¯ï¼Œä»éªŒè¯ç»“æœä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä½¿ç”¨äº† ebpf çš„æŠ€æœ¯ä¹‹åï¼Œå®ƒçš„å»¶æ—¶å¤§æ¦‚æœ‰ 20% åˆ° 30% çš„æå‡ï¼Œè¯´æ˜ ebpf çš„æŠ€æœ¯åº”ç”¨åœ¨æœ¬åœ°é€šè®¯ä¸Šè¿˜æ˜¯æœ‰ä¸€å®šä¼˜åŒ–èƒ½åŠ›çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-data-plane-performance-optimization/kk6x7dxpxv_hu_b74c326d53d6958.webp 400w,
               /blog/istio-data-plane-performance-optimization/kk6x7dxpxv_hu_ef2e2ba60e8d4d07.webp 760w,
               /blog/istio-data-plane-performance-optimization/kk6x7dxpxv_hu_cc4de993c6ee59.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-data-plane-performance-optimization/kk6x7dxpxv_hu_b74c326d53d6958.webp&#34;
               width=&#34;760&#34;
               height=&#34;454&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç®€å•ä»‹ç»ä¸€ä¸‹ ebpfï¼Œçœ‹ä¸€ä¸‹å®ƒæ˜¯æ€ä¹ˆåšåˆ°åŠ é€Ÿæœ¬åœ°é€šè®¯çš„ã€‚é¦–å…ˆ ebpf å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨å†…æ ¸é‡Œé¢çš„è™šæ‹Ÿæœºï¼Œç”¨æˆ·ç¼–å†™çš„ ebpf ç¨‹åºå¯ä»¥è¢«åŠ è½½åˆ°å†…æ ¸é‡Œé¢è¿›è¡Œæ‰§è¡Œã€‚å†…æ ¸çš„ä¸€ä¸ª verify ç»„ä»¶ä¼šä¿è¯ç”¨æˆ·çš„ ebpf ç¨‹åºä¸ä¼šå¼•å‘å†…æ ¸çš„ crashï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä¿è¯ç”¨æˆ·çš„ ebpf ç¨‹åºæ˜¯å®‰å…¨çš„ã€‚ç›®å‰ ebpf ç¨‹åºä¸»è¦ç”¨æ¥è¿½è¸ªå†…æ ¸çš„å‡½æ•°è°ƒç”¨ä»¥åŠå®‰å…¨ç­‰æ–¹é¢ã€‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°ï¼Œebpf å¯ä»¥ç”¨åœ¨å¾ˆå¤šå†…æ ¸å­ç³»ç»Ÿå½“ä¸­åšå¾ˆå¤šçš„è°ƒç”¨è¿½è¸ªã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-data-plane-performance-optimization/4xd5gon60f_hu_5747899e13b1e82b.webp 400w,
               /blog/istio-data-plane-performance-optimization/4xd5gon60f_hu_f5f5f25224fbe8a6.webp 760w,
               /blog/istio-data-plane-performance-optimization/4xd5gon60f_hu_99018818355019f8.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-data-plane-performance-optimization/4xd5gon60f_hu_5747899e13b1e82b.webp&#34;
               width=&#34;760&#34;
               height=&#34;467&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„åŠŸèƒ½ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨æ€§èƒ½ä¼˜åŒ–çš„æ—¶å€™ä½¿ç”¨åˆ°çš„åœ¨ç½‘ç»œä¸Šçš„ä¸€ä¸ªèƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢æåˆ°çš„ sockhashã€‚sockhash æœ¬èº«æ˜¯ä¸€ä¸ª ebpf ç‰¹æ®Šçš„ä¸€ä¸ª kv å­˜å‚¨ç»“æ„ï¼Œä¸»è¦è¢«ç”¨ä½œå†…æ ¸çš„ä¸€ä¸ª socket å±‚çš„ä»£ç†ã€‚å®ƒçš„ key æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ï¼Œè€Œ value æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ï¼Œå®ƒå­˜å‚¨çš„ value æ˜¯å†…æ ¸é‡Œé¢ä¸€ä¸ª socket å¯¹è±¡ã€‚å­˜å‚¨åœ¨ sockhash ä¸­çš„ socket åœ¨å‘é€æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœèƒ½å¤Ÿé€šè¿‡æˆ‘ä»¬æŒ‚åœ¨ sockhash å½“ä¸­çš„ä¸€ä¸ª ebpf å½“ä¸­çš„ç¨‹åºæ‰¾åˆ°æ¥æ”¶æ–¹çš„ socketï¼Œé‚£ä¹ˆå†…æ ¸å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠå‘é€ç«¯çš„æ•°æ®ç›´æ¥æ‹·è´åˆ°æ¥æ”¶ç«¯ socket çš„ä¸€ä¸ªæ¥æ”¶é˜Ÿåˆ—å½“ä¸­ï¼Œä»è€Œå¯ä»¥è·³è¿‡æ•°æ®åœ¨æ›´åº•å±‚çš„å¤„ç†ï¼Œæ¯”å¦‚ TCP/IP åè®®æ ˆçš„å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ sidecar ä¸­ï¼Œsocket æ˜¯æ€æ ·è¢«è¯†åˆ«å¹¶å­˜å‚¨åœ¨ sockhash å½“ä¸­æ¥å®Œæˆä¸€ä¸ªæ•°æ®æ‹·è´çš„å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦åˆ†æä¸€ä¸‹æ•°æ®é“¾çš„æœ¬åœ°é€šè®¯çš„æµé‡ç‰¹å¾ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆä» ingress æ¥è®²ï¼Œingress ç«¯çš„é€šä¿¡ä¼šæ¯”è¾ƒç®€å•ä¸€ç‚¹ï¼Œéƒ½æ˜¯ä¸€ä¸ªæœ¬åœ°åœ°å€çš„é€šä¿¡ã€‚ingress ç«¯çš„ envoy è¿›ç¨‹å’Œç”¨æˆ·æœåŠ¡è¿›ç¨‹ä¹‹é—´é€šä¿¡ï¼Œå®ƒçš„åŸåœ°å€å’Œç›®çš„åœ°å€åˆšå¥½æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªåœ°å€çš„å››å…ƒç»„æ„é€ å®ƒçš„ keyï¼ŒæŠŠå®ƒå­˜å‚¨åˆ° sockhash å½“ä¸­ã€‚åœ¨å‘é€æ•°æ®çš„æ—¶å€™ï¼Œæ ¹æ®è¿™ä¸ªåœ°å€ä¿¡æ¯åå‘æ„é€ è¿™ä¸ª keyï¼Œä» sockhash å½“ä¸­æ‹¿åˆ°æ¥æ”¶ç«¯çš„ socket è¿”å›ç»™å†…æ ¸ï¼Œè¿™æ ·å†…æ ¸å°±å¯ä»¥å¸®æˆ‘ä»¬å°†è¿™ä¸ªæ•°æ®ç›´æ¥æ‹·è´ç»™æ¥æ”¶ç«¯çš„ socketã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-data-plane-performance-optimization/d4fu24go3u_hu_36f4a55074b3acf4.webp 400w,
               /blog/istio-data-plane-performance-optimization/d4fu24go3u_hu_94d018d4f4c625ab.webp 760w,
               /blog/istio-data-plane-performance-optimization/d4fu24go3u_hu_26a1451c6124f30c.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-data-plane-performance-optimization/d4fu24go3u_hu_36f4a55074b3acf4.webp&#34;
               width=&#34;760&#34;
               height=&#34;359&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;egress ä¼šç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œåœ¨ä¸€ä¸ª egress ç«¯æœåŠ¡ç¨‹åºå¯¹å¤–å‘å‡ºçš„è¯·æ±‚è¢« iptables è§„åˆ™é‡å®šå‘åˆ°äº† envoy ç›‘å¬çš„ä¸€ä¸ª 15001 çš„ç«¯å£ã€‚åœ¨è¿™é‡Œï¼Œå‘èµ·æ–¹çš„æºåœ°å€å’Œæ¥æ”¶æ–¹çš„ç›®çš„åœ°å€æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œä½†æ˜¯å‘èµ·æ–¹çš„ç›®çš„åœ°å€å’Œæ¥æ”¶ç«¯çš„æºåœ°å€æœ‰äº†ä¸€ä¸ªå˜åŒ–ï¼Œä¸»è¦æ˜¯ç”±äº iptables å¯¹åœ°å€æœ‰ä¸€ä¸ªé‡å†™ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨å­˜å‚¨åˆ° sockhash ä¸­çš„æ—¶å€™ï¼Œéœ€è¦å¯¹è¿™éƒ¨åˆ†ä¿¡æ¯è¿›è¡Œä¸€ä¸ªå¤„ç†ã€‚ç”±äº istio çš„ç‰¹æ®Šæ€§ï¼Œç›´æ¥å¯ä»¥æŠŠå®ƒæ”¹å†™æˆ envoy æ‰€ç›‘å¬çš„ä¸€ä¸ªæœ¬åœ°æœåŠ¡åœ°å€ã€‚è¿™æ ·å†å­˜å‚¨åˆ° sockhash å½“ä¸­ï¼Œå®ƒä»¬çš„åœ°å€ä¿¡æ¯è¿˜æ˜¯å¯ä»¥åå‘ä¸€ä¸€å¯¹åº”çš„ã€‚æ‰€ä»¥åœ¨æŸ¥æ‰¾çš„æ—¶å€™ï¼Œè¿˜æ˜¯å¯ä»¥æ ¹æ®ä¸€ç«¯çš„ socket åœ°å€ä¿¡æ¯æŸ¥æ‰¾åˆ°å¦ä¸€ç«¯çš„ socketï¼Œè¾¾åˆ°æ•°æ®æ‹·è´çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-data-plane-performance-optimization/syz2sah1eg_hu_45306786aba6805a.webp 400w,
               /blog/istio-data-plane-performance-optimization/syz2sah1eg_hu_9471f98e8ead8938.webp 760w,
               /blog/istio-data-plane-performance-optimization/syz2sah1eg_hu_262dded366ec6e47.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-data-plane-performance-optimization/syz2sah1eg_hu_45306786aba6805a.webp&#34;
               width=&#34;760&#34;
               height=&#34;341&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç»è¿‡å¯¹ ebpf åŠ é€ŸåŸç†çš„åˆ†æï¼Œæˆ‘ä»¬å¼€å‘å‡ºæ¥ä¸€ä¸ª ebpf çš„æ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶å¯ä»¥ä¸ä¾èµ–äºé›†ç¾¤æœ¬èº«çš„ç½‘ç»œæ¨¡å¼ï¼Œä½¿ç”¨ daemonset æ–¹å¼éƒ¨ç½²åˆ° k8s é›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹ä¸Šã€‚å…¶ä¸­çš„é€šä¿¡æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæœ¬åœ°è¿›ç¨‹çš„ä¸€ä¸ªé€šä¿¡åœ¨ socket å±‚ç›´æ¥è¢« ebpf æ‹¦æˆªä»¥åï¼Œå°±ä¸ä¼šå†å¾€ä¸‹å‘é€åˆ° TCPIP åè®®æ ˆäº†ï¼Œç›´æ¥åœ¨ socket å±‚å°±è¿›è¡Œäº†ä¸€ä¸ªæ•°æ®æ‹·è´ï¼Œå‡å°‘äº†æ•°æ®é“¾è·¯ä¸Šçš„ä¸€ä¸ªå¤„ç†æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-data-plane-performance-optimization/jfs83tu6bv_hu_af63d5d4789c23c1.webp 400w,
               /blog/istio-data-plane-performance-optimization/jfs83tu6bv_hu_22518473862fb6bf.webp 760w,
               /blog/istio-data-plane-performance-optimization/jfs83tu6bv_hu_506b0f713b1a4a23.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-data-plane-performance-optimization/jfs83tu6bv_hu_af63d5d4789c23c1.webp&#34;
               width=&#34;760&#34;
               height=&#34;428&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å¯¹æ•ˆæœçš„ä¸€ä¸ªæµ‹è¯•ï¼Œä»æ•´ä½“æ¥çœ‹ï¼Œå®ƒçš„å»¶æ—¶æœ‰å¤§æ¦‚ 5% åˆ° 8% çš„å»¶æ—¶æå‡ï¼Œå…¶å®æå‡çš„å¹…åº¦ä¸æ˜¯å¾ˆå¤§ï¼Œä¸»è¦åŸå› å…¶å®åœ¨æ•´ä¸ªé€šä¿¡çš„æµç¨‹å½“ä¸­ï¼Œå†…æ ¸æ€çš„ä¸€ä¸ªå¤„ç†å æ•´ä¸ªé€šä¿¡å¤„ç†çš„æ—¶é—´ï¼Œå»¶æ—¶å…¶å®æ˜¯æ¯”è¾ƒå°‘çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å®ƒçš„æå‡ä¸æ˜¯ç‰¹åˆ«æ˜æ˜¾ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-data-plane-performance-optimization/s62pykxvx7_hu_ca3b4a4e1acf28c9.webp 400w,
               /blog/istio-data-plane-performance-optimization/s62pykxvx7_hu_7fe4fdcfbbf9e510.webp 760w,
               /blog/istio-data-plane-performance-optimization/s62pykxvx7_hu_8b29850beeb10bbd.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-data-plane-performance-optimization/s62pykxvx7_hu_ca3b4a4e1acf28c9.webp&#34;
               width=&#34;635&#34;
               height=&#34;440&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦å¤– ebpf è¿˜æœ‰ä¸€äº›ç¼ºé™·ï¼Œæ¯”å¦‚å®ƒå¯¹å†…æ ¸ç‰ˆæœ¬çš„è¦æ±‚æ˜¯åœ¨ 4.18 ç‰ˆæœ¬ä¹‹åæ‰æœ‰ sockhash è¿™ä¸ªç‰¹æ€§ã€‚å¦å¤– sockhash æœ¬èº«è¿˜æœ‰ä¸€äº› bugï¼Œæˆ‘ä»¬åœ¨æµ‹è¯•å½“ä¸­ä¹Ÿå‘ç°äº†ä¸€äº› bugï¼Œå¹¶ä¸”æŠŠå®ƒæäº¤åˆ°ç¤¾åŒºè¿›è¡Œè§£å†³ã€‚&lt;/p&gt;
&lt;h2 id=&#34;envoy-æ€§èƒ½ç ”ç©¶ä¸ä¼˜åŒ–&#34;&gt;Envoy æ€§èƒ½ç ”ç©¶ä¸ä¼˜åŒ–&lt;/h2&gt;
&lt;p&gt;å‰é¢ä»‹ç»äº†å¯¹ istio æ•°æ®é¢å¯¹æµé‡åœ¨å†…æ ¸çš„å¤„ç†æ‰€è¿›è¡Œçš„ä¸€äº›ä¼˜åŒ–ã€‚åœ¨ istio æ•°æ®é¢çš„æ€§èƒ½é—®é¢˜ä¸Šï¼Œç¤¾åŒºæ³¨æ„åˆ°æ¯”è¾ƒå¤šçš„æ˜¯åœ¨å†…æ ¸æ€æœ‰ä¸€ä¸ªæ˜æ˜¾çš„è½¬å‘æµç¨‹æ¯”è¾ƒé•¿çš„é—®é¢˜ï¼Œå› æ­¤æå‡ºäº†ä½¿ç”¨ eBPF è¿›è¡Œä¼˜åŒ–çš„æ–¹æ¡ˆï¼Œä½†æ˜¯åœ¨ Envoy ä¸Šé¢æ²¡æœ‰å¤ªå¤šçš„å£°éŸ³ã€‚è™½ç„¶ Envoy æœ¬èº«æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ç½‘ç»œä»£ç†ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯æ— æ³•ç¡®è®¤ Envoy æœ¬èº«çš„æŸè€—æ˜¯å¦å¯¹æ€§èƒ½é€ æˆäº†å½±å“ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å…µåˆ†ä¸¤è·¯ï¼ŒåŒæ—¶åœ¨ Envoy ä¸Šé¢è¿›è¡Œäº†ä¸€äº›ç ”ç©¶ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆä»€ä¹ˆæ˜¯ Envoyï¼ŸEnvoy æ˜¯ä¸ºåˆ†å¸ƒå¼ç¯å¢ƒè€Œç”Ÿçš„é«˜æ€§èƒ½ç½‘ç»œä»£ç†ï¼Œå¯ä»¥è¯´åŸºæœ¬ä¸Šæ˜¯ä½œä¸ºæœåŠ¡ç½‘æ ¼çš„é€šç”¨æ•°æ®å¹³é¢è¢«è®¾è®¡å‡ºæ¥çš„ã€‚Envoy æä¾›ä¸åŒå±‚çº§çš„ filter æ¶æ„ï¼Œå¦‚ listenerFilterã€networkFilter ä»¥åŠ HTTPFilterï¼Œè¿™ä½¿ envoy å…·æœ‰éå¸¸å¥½çš„å¯æ‰©å±•æ€§ã€‚Envoy è¿˜å…·æœ‰å¾ˆå¥½çš„å¯è§‚å¯Ÿæ€§ï¼Œå†…ç½®æœ‰ statsã€tracingã€logging è¿™äº›å­ç³»ç»Ÿï¼Œå¯ä»¥è®©æˆ‘ä»¬æ›´å®¹æ˜“åœ°å¯¹ç³»ç»Ÿè¿›è¡Œç›‘æ§ã€‚&lt;/p&gt;
&lt;p&gt;è¿›è¡Œ istio æ•°æ®é¢ä¼˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¢å¯¹çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ Envoy åœ¨ istio æ•°æ®é¢ä¸­ç»™æ¶ˆæ¯è½¬å‘å¢åŠ äº†å¤šå°‘å»¶æ—¶ï¼ŸEnvoy æœ¬èº«æä¾›çš„å†…ç½®æŒ‡æ ‡æ˜¯å¾ˆéš¾åæ˜  Envoy æœ¬èº«çš„æ€§èƒ½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šè¿‡ä¿®æ”¹ Envoy æºç ï¼Œåœ¨ Envoy å¤„ç†æ¶ˆæ¯çš„å¼€å§‹ä¸ç»“æŸçš„ä½ç½®è¿›è¡Œæ‰“ç‚¹ï¼Œè®°å½•æ—¶é—´æˆ³ï¼Œå¯ä»¥è·å¾— Envoy å¤„ç†æ¶ˆæ¯çš„å»¶æ—¶æ•°æ®ã€‚Envoy æ˜¯å¤šçº¿ç¨‹æ¶æ„ï¼Œåœ¨æ‰“ç‚¹æ—¶æˆ‘ä»¬è€ƒè™‘äº†æ€§èƒ½å’Œçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼šå¦‚ä½•é«˜æ•ˆè€Œåˆå‡†ç¡®åœ°è®°å½•æ‰€æœ‰æ¶ˆæ¯çš„å¤„ç†å»¶æ—¶ï¼Œä»¥æ–¹ä¾¿åç»­çš„è¿›è¡Œåˆ†æï¼Ÿè¿™æ˜¯é€šè¿‡å¦‚ä¸‹æ–¹æ³•åšåˆ°çš„ï¼š&lt;/p&gt;
&lt;p&gt;a. ç»™å‹æµ‹æ¶ˆæ¯åˆ†é…å”¯ä¸€æ•°å­— ID;&lt;/p&gt;
&lt;p&gt;b. åœ¨ Envoy ä¸­é¢„åˆ†é…ä¸€å—å†…å­˜ç”¨äºä¿å­˜æ‰“ç‚¹æ•°æ®ï¼Œå…¶æ•°æ®ç±»å‹æ˜¯ä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯åŒä¸€æ¡æ¶ˆæ¯çš„æ‰“ç‚¹æ•°æ®ï¼›&lt;/p&gt;
&lt;p&gt;c. æå–æ¶ˆæ¯ä¸­çš„æ•°å­— ID å½“ä½œæ—¶é—´æˆ³è®°å½•çš„ä¸‹æ ‡ï¼Œå°†æ—¶é—´æˆ³è®°å½•åˆ°é¢„åˆ†é…çš„å†…å­˜çš„å›ºå®šä½ç½®ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å®‰å…¨é«˜æ•ˆåœ°å®ç°äº† Envoy å†…çš„æ‰“ç‚¹è®°å½•ï¼ˆç¼ºç‚¹æ˜¯éœ€è¦ä¿®æ”¹ Envoy ä»¥åŠå‹æµ‹å·¥å…·ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-data-plane-performance-optimization/ss4ppwv2go_hu_9d52564cbd330c44.webp 400w,
               /blog/istio-data-plane-performance-optimization/ss4ppwv2go_hu_9523399b32466a49.webp 760w,
               /blog/istio-data-plane-performance-optimization/ss4ppwv2go_hu_7357fc9b8388b105.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-data-plane-performance-optimization/ss4ppwv2go_hu_9d52564cbd330c44.webp&#34;
               width=&#34;760&#34;
               height=&#34;322&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç»è¿‡ç¦»çº¿åˆ†æï¼Œæˆ‘ä»¬å‘ç°äº† Envoy å†…æ¶ˆæ¯å¤„ç†å»¶æ—¶çš„ä¸€äº›åˆ†å¸ƒç‰¹å¾ã€‚å·¦å›¾æ˜¯å¯¹ Envoy å¤„ç†å»¶æ—¶ä¸æ¶ˆæ¯æ•°é‡åˆ†å¸ƒå›¾ï¼Œæ¨ªè½´æ˜¯å»¶æ—¶ï¼Œçºµè½´æ˜¯æ¶ˆæ¯æ•°é‡ã€‚å¯ä»¥çœ‹åˆ°åœ¨é«˜å»¶æ—¶éƒ¨ä»½ï¼Œæ¶ˆæ¯æ•°é‡æœ‰å¼‚å¸¸å¢åŠ çš„ç°è±¡ï¼Œè¿™ä¸æ˜¯å…¸å‹çš„å¹‚ç‡åˆ†å¸ƒã€‚è¿›ä¸€æ­¥å¯¹é«˜å»¶æ—¶éƒ¨ä»½è¿›è¡Œåˆ†æåå‘ç°ï¼Œè¿™äº›é«˜å»¶æ—¶æ¶ˆæ¯å‡åŒ€åœ°åˆ†å¸ƒäºæ•´ä¸ªæµ‹è¯•æœŸé—´ï¼ˆå¦‚ä¸Šå›¾å³æ‰€ç¤ºï¼‰ã€‚æ ¹æ®æˆ‘ä»¬çš„ç»éªŒï¼Œè¿™é€šå¸¸æ˜¯ Envoy å†…éƒ¨è½¬å‘æ¶ˆæ¯çš„ worker åœ¨å‘¨æœŸæ€§çš„æ‰§è¡Œä¸€äº›æ¶ˆè€— CPU çš„ä»»åŠ¡ï¼Œå¯¼è‡´æœ‰ä¸€éƒ¨åˆ†æ¶ˆæ¯æ²¡åŠæ³•åŠæ—¶è½¬å‘è€Œå¼•èµ·çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ·±å…¥ç ”ç©¶ Envoy åœ¨ istio æ•°æ®é¢çš„åŠŸèƒ½å®ç°åï¼Œæˆ‘ä»¬å‘ç° mixer é¥æµ‹å¯èƒ½æ˜¯å¯¼è‡´è¿™ä¸ªé—®é¢˜çš„æ ¹æœ¬åŸå› ã€‚Mixer æ˜¯ istio è€ç‰ˆæœ¬ (1.4 åŠä»¥å‰) å®ç°é¥æµ‹å’Œç­–ç•¥æ£€æŸ¥åŠŸèƒ½çš„ä¸€ä¸ªç»„ä»¶ã€‚åœ¨æ•°æ®é¢çš„ Envoy ä¸­ï¼ŒMixer ä¼šæå–æ‰€æœ‰æ¶ˆæ¯çš„å±æ€§ï¼Œç„¶åæ‰¹é‡å‹ç¼©ä¸ŠæŠ¥åˆ° mixer serverï¼Œè€Œå±æ€§çš„æå–å’Œå‹ç¼©æ˜¯ä¸€ä¸ªé«˜ CPU çš„æ¶ˆè€—çš„æ“ä½œï¼Œè¿™ä¼šå¼•èµ·å»¶æ—¶æ•°æ®åˆ†æä¸­å¾—åˆ°çš„ç»“æœï¼šé«˜å»¶æ—¶æ¶ˆæ¯è½¬å‘å¼‚å¸¸å¢å¤šã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç¡®å®šäº†åŸå› ä¹‹åï¼Œæˆ‘ä»¬å¯¹ Envoy çš„æ¶æ„ä½œäº†ä¸€äº›æ”¹è¿›ï¼Œç»™å®ƒå¢åŠ äº†æ‰§è¡Œéå…³é”®ä»»åŠ¡çš„ AsyncWorker çº¿ç¨‹ï¼Œç§°ä¸ºå¼‚æ­¥ä»»åŠ¡çº¿ç¨‹ã€‚é€šè¿‡æŠŠé¥æµ‹çš„é€»è¾‘æ‹†åˆ†å‡ºæ¥æ”¾åˆ°äº† AsyncWorker çº¿ç¨‹ä¸­å»æ‰§è¡Œï¼Œå°±è§£å†³äº† worker çº¿ç¨‹è¢«é˜»å¡çš„é—®é¢˜ï¼Œè¿›è€Œå¯ä»¥é™ä½ envoy è½¬å‘æ¶ˆæ¯çš„å»¶æ—¶ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-data-plane-performance-optimization/69o2xkzjom_hu_fd6e53ffc0c971b6.webp 400w,
               /blog/istio-data-plane-performance-optimization/69o2xkzjom_hu_5e684d1bc337bb02.webp 760w,
               /blog/istio-data-plane-performance-optimization/69o2xkzjom_hu_ab7353fab1455e7d.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-data-plane-performance-optimization/69o2xkzjom_hu_fd6e53ffc0c971b6.webp&#34;
               width=&#34;760&#34;
               height=&#34;322&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿›è¡Œæ¶æ„ä¼˜åŒ–ä¹‹åï¼Œæˆ‘ä»¬ä¹Ÿåšäº†å¯¹æ¯”æµ‹è¯•ï¼Œä¸Šå›¾å·¦æµ‹æ˜¯å»¶æ—¶ä¸æ¶ˆæ¯æ•°é‡å›¾ï¼Œå¯ä»¥çœ‹åˆ°å®ƒé«˜å»¶æ—¶éƒ¨åˆ†å¾—åˆ°æ˜æ˜¾çš„æ”¹å–„ã€‚ä¸Šå›¾å³å¯ä»¥çœ‹å‡º Envoy æ•´ä½“çš„å»¶æ—¶é™ä½äº† 40% ä»¥ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;ä¼˜åŒ– Envoy æ¶æ„ç»™æˆ‘ä»¬å¸¦æ¥äº†ç¬¬ä¸€æ‰‹çš„ç»éªŒï¼Œé¦–å…ˆ CPU æ˜¯å½±å“ Istio æ•°æ®é¢æ€§èƒ½çš„å…³é”®èµ„æºï¼Œå®ƒçš„ç“¶é¢ˆä¸»è¦å‡ºç°åœ¨ CPU ä¸Šé¢ï¼Œè€Œä¸æ˜¯ç½‘ç»œ IO æ“ä½œã€‚ç¬¬äºŒï¼Œæˆ‘ä»¬å¯¹ Envoy è¿›è¡Œæ¶æ„ä¼˜åŒ–ï¼Œå¯ä»¥é™ä½å»¶æ—¶ï¼Œä½†æ˜¯æ²¡æœ‰è§£å†³æ ¹æœ¬é—®é¢˜ï¼Œå› ä¸º CPU çš„ä½¿ç”¨æ²¡æœ‰é™ä½ï¼Œåªæ˜¯é¥æµ‹é€»è¾‘è½¬ç§»åˆ°å¦å¤–çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œé™ä½ Envoy è½¬å‘æ¶ˆæ¯çš„å»¶æ—¶ã€‚ä¼˜åŒ– CPU ä½¿ç”¨ç‡æ‰æ˜¯æ•°æ®é¢ä¼˜åŒ–çš„æ ¸å¿ƒã€‚ç¬¬ä¸‰ç‚¹ï¼ŒEnvoy çš„ä¸åŒç»„ä»¶å½“ä¸­ï¼Œmixer æ¶ˆåŒ–æ‰äº† 30% å·¦å³çš„ CPUï¼Œè€Œé¥æµ‹æ˜¯ mixer çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå› æ­¤åç»­é¥æµ‹ä¼˜åŒ–å°±å˜æˆäº†ä¼˜åŒ–çš„é‡è¦æ–¹å‘ã€‚&lt;/p&gt;
&lt;p&gt;æ€ä¹ˆè¿›è¡Œé¥æµ‹ä¼˜åŒ–å‘¢ï¼Ÿå…¶å® mixer å®ç°é¥æµ‹æ˜¯éå¸¸å¤æ‚çš„ä¸€å¥—æ¶æ„ï¼Œä½¿ç”¨ Istio mixer é¥æµ‹çš„äººéƒ½æ·±æœ‰ä½“ä¼šï¼Œå¹¸å¥½ istio æ–°ç‰ˆæœ¬ä¸­ï¼Œä¸æ­¢å¯¹ istio çš„æ§åˆ¶é¢ä½œäº†å¤§çš„è°ƒæ•´ï¼Œåœ¨æ•°æ®é¢ mixer ä¹ŸåŒæ ·è¢«ç§»é™¤äº†ï¼Œæ„å‘³ç€ Envoy ä¸­é«˜æ¶ˆè€—çš„é¥æµ‹å°±ä¸ä¼šå­˜åœ¨äº†ï¼Œæˆ‘ä»¬æ˜¯åŸºäº istio åœ¨åšå†…éƒ¨çš„ service meshï¼Œä»ç¤¾åŒºå¾—åˆ°è¿™ä¸ªæ¶ˆæ¯ä¹‹åï¼Œæˆ‘ä»¬ä¹Ÿå¿«é€Ÿè·Ÿè¿›ï¼Œå¼•å…¥é€‚é…æ–°çš„æ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;æ²¡æœ‰ Mixer ä¹‹åï¼Œé¥æµ‹æ˜¯å¦‚ä½•å®ç°çš„ã€‚Envoy æä¾›äº†ä½¿ç”¨ wasm å¯¹å…¶è¿›è¡Œæ‰©å±•çš„æ–¹å¼ï¼Œä»¥ä¿æŒæ¶æ„çš„çµæ´»æ€§ã€‚è€Œ istio ç¤¾åŒºåŸºäº Wasm çš„æ‰©å±•å¼€å‘äº†ä¸€ä¸ª stats extension æ‰©å±•ï¼Œå®ç°äº†ä¸€ä¸ªæ–°çš„é¥æµ‹æ–¹æ¡ˆã€‚ä¸ mixer é¥æµ‹ç›¸æ¯”ï¼Œè¿™ä¸ª stats extension ä¸å†ä¸ŠæŠ¥å…¨é‡æ•°æ®åˆ° mixer serverï¼Œåªæ˜¯åœ¨ Envoy å†…çš„ stats å­ç³»ç»Ÿä¸­ç”Ÿæˆé¥æµ‹æŒ‡æ ‡ã€‚é¥æµ‹ç³»ç»Ÿæ‹‰å– Envoy çš„æŒ‡æ ‡ï¼Œå°±å¯ä»¥è·å¾—æ•´ä¸ªé¥æµ‹æ•°æ®ï¼Œä¼šå¤§å¤§é™ä½é¥æµ‹åœ¨æ•°æ®é¢çš„æ€§èƒ½æ¶ˆè€—ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åæˆ‘ä»¬å¯¹ istio 1.5 ä½¿ç”¨ Wasm çš„é¥æµ‹ï¼Œåšäº†ä¸€ä¸ªæ€§èƒ½çš„æµ‹è¯•ã€‚å‘ç°æ•´ä¸ª Envoy ä»£ç†åœ¨åŒæ ·æµ‹è¯•æ¡ä»¶ä¸‹ï¼Œå®ƒçš„ CPU é™ä½ 10%ï¼Œè€Œä½¿ç”¨ mixer çš„é¥æµ‹å…¶å®å ç”¨äº† 30% çš„ CPUï¼Œé‡Œé¢å¤§éƒ¨åˆ†é€»è¾‘æ˜¯åœ¨æ‰§è¡Œé¥æµ‹ã€‚æŒ‰æˆ‘ä»¬çš„ç†è§£ï¼ŒEnvoy è‡³å°‘åº”è¯¥æœ‰ 20% çš„ CPU ä¸‹é™ï¼Œä½†æ˜¯å®é™…æ•ˆæœåªæœ‰ 10% å·¦å³ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ–°æ¶æ„ä¸‹æˆ‘ä»¬é‡åˆ°äº†æ–°çš„é—®é¢˜ã€‚æˆ‘ä»¬å¯¹æ–°æ¶æ„è¿›è¡Œäº†ä¸€äº›å®ç°åŸç†å’ŒæŠ€æœ¯ç»†èŠ‚ä¸Šçš„åˆ†æï¼Œå‘ç° Envoy ä½¿ç”¨ Wasm çš„æ‰©å±•æ–¹å¼ï¼Œè™½ç„¶å¸¦æ¥äº†çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä½†æ˜¯å¯¹æ€§èƒ½æœ‰ä¸€å®šçš„å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-data-plane-performance-optimization/bvvvnkshkl_hu_99370108c5d9c035.webp 400w,
               /blog/istio-data-plane-performance-optimization/bvvvnkshkl_hu_d614862c4d0afbeb.webp 760w,
               /blog/istio-data-plane-performance-optimization/bvvvnkshkl_hu_3f937ba2fdd63c02.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-data-plane-performance-optimization/bvvvnkshkl_hu_99370108c5d9c035.webp&#34;
               width=&#34;760&#34;
               height=&#34;632&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼ŒWasm æ‰©å±•æœºåˆ¶è·Ÿ Envoy host ç¯å¢ƒæ˜¯é€šè¿‡å†…å­˜æ‹·è´çš„æ–¹å¼è¿›è¡Œé€šä¿¡ï¼Œè¿™æ˜¯ Wasm è™šæ‹Ÿæœºçš„éš”ç¦»æ€§æœºåˆ¶å†³å®šçš„ã€‚Envoy ä¸ºäº†ä¿æŒæ¶æ„çµæ´»æ€§çš„åŒæ—¶ä¿è¯æ€§èƒ½ï¼Œä½¿è®¾è®¡äº†ä¸€ä¸ªé Wasm è™šæ‹Ÿæœºè¿è¡Œæ‰©å±•ï¼ˆå¦‚ stats extensionï¼‰çš„æ¨¡å¼ï¼Œå³ NullVM æ¨¡å¼ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡çš„ Wasm è™šæ‹Ÿæœºï¼Œå®é™…ä¸Šè¿è¡Œçš„æ‰©å±•è¿˜æ˜¯è¢«ç¼–è¯‘åœ¨ Envoy å†…éƒ¨ï¼Œä½†å®ƒä¹Ÿé€ƒç¦»ä¸æ‰ Wasm æ¶æ„å¸¦æ¥çš„å†…å­˜æ‹·è´å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;å…¶æ¬¡ï¼Œåœ¨å®ç° extension ä¸ Envoy çš„é€šä¿¡æ—¶ï¼Œä¸€ä¸ªå±æ€§çš„è·å–è¦ç»è¿‡å¤šæ¬¡çš„å†…å­˜æ‹·è´ï¼Œæ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„è¿‡ç¨‹ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè·å– request.url è¿™ä¸ªå±æ€§éœ€è¦åœ¨ Envoy çš„å†…å­˜å’Œ Wasm è™šæ‹Ÿæœºå†…å­˜ä¹‹é—´è¿›è¡Œä¸€ä¸ªå¤æ‚çš„æ‹·è´æ“ä½œï¼Œè¿™ç§æ–¹å¼çš„æ¶ˆè€—è¿œå¤§äºé€šè¿‡å¼•ç”¨æˆ–æŒ‡é’ˆæå–å±æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸‰ï¼Œåœ¨å®ç°é¥æµ‹çš„æ—¶å€™ï¼Œæœ‰å¤§é‡çš„å±æ€§éœ€è¦è·å–ï¼Œé€šå¸¸æœ‰åå‡ äºŒåä¸ªå±æ€§ï¼Œå› æ­¤ Wasm æ‰©å±•å¸¦æ¥çš„æ€»ä½“é¢å¤–æŸè€—éå¸¸å¯è§‚ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼ŒWasm å®ç°çš„é¥æµ‹åŠŸèƒ½è¿˜éœ€è¦å¦å¤–ä¸€ä¸ªå«åš metadata_exchange æ‰©å±•çš„æ”¯æŒã€‚metadata_exchange ç”¨æ¥è·å¾—è°ƒç”¨å¯¹ç«¯çš„ä¸€äº›èŠ‚ç‚¹ä¿¡æ¯ï¼Œè€Œ metadata_exchange æ‰©å±•è¿è¡Œåœ¨å¦å¤–ä¸€ä¸ªè™šæ‹Ÿæœºå½“ä¸­ï¼Œé€šè¿‡ Envoy çš„ Filter state æœºåˆ¶ä¸ stats æ‰©å±•è¿›è¡Œé€šä¿¡ï¼Œè¿›ä¸€æ­¥å¢åŠ äº†é¥æµ‹çš„é¢å¤–æ¶ˆè€—ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå¦‚ä½•å»ä¼˜åŒ–å‘¢ï¼Ÿç®€å•å¯¹ Wasm æ’ä»¶ä¼˜åŒ–æ˜¯æ²¡æœ‰å¤ªå¤§å¸®åŠ©ï¼Œå› ä¸ºå®ƒçš„åº•å±‚ Wasm æœºåˆ¶å·²ç»å†³å®šäº†å®ƒæœ‰ä¸å°‘çš„æ€§èƒ½æŸè€—ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¼€å‘äº†ä¸€ä¸ªæ–°çš„é¥æµ‹æ’ä»¶ tstatsã€‚tstats ä½¿ç”¨ Envoy åŸç”Ÿçš„æ‰©å±•æ–¹å¼å¼€å‘ã€‚åœ¨ tstats æ‰©å±•å†…éƒ¨ï¼Œå®ç°äº†é¥æµ‹å’Œ metadata_exchange çš„ç»“åˆï¼Œæ¶ˆé™¤äº† Wasm å¸¦æ¥çš„æ€§èƒ½å¼Šç«¯ã€‚Tstats é¥æµ‹ä¸ç¤¾åŒºé¥æµ‹å…¼å®¹ï¼Œç”Ÿæˆç›¸åŒçš„æŒ‡æ ‡ï¼Œtstats åŸºäº istio æ§åˆ¶é¢çš„ EnvoyFilter CRD è¿›è¡Œéƒ¨ç½²ï¼Œç”¨æˆ·å¯ä»¥å¹³æ»‘å‡çº§ï¼Œå½“ç”¨æˆ·å‘ç° tstats çš„åŠŸèƒ½æ²¡æœ‰æ»¡è¶³éœ€æ±‚æˆ–è€…å‡ºç°ä¸€äº›é—®é¢˜æ—¶ï¼Œä¹Ÿå¯ä»¥åˆ‡æ¢ä½¿ç”¨åˆ°ç¤¾åŒºæä¾›çš„é¥æµ‹æ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ tstats æ‰©å±•è¿˜ä¼˜åŒ–äº†é¥æµ‹æŒ‡æ ‡çš„è®¡ç®—è¿‡ç¨‹ã€‚åœ¨è®¡ç®—æŒ‡æ ‡çš„æ—¶å€™æœ‰è®¸å¤šç»´åº¦ä¿¡æ¯éœ€è¦å¡«å……ï¼Œï¼ˆç›®å‰å¤§æŒ‡æ ‡æœ‰äºŒåå‡ ä¸ªç»´åº¦çš„å¡«å……ï¼‰ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„æ“ä½œï¼Œå…¶å®ï¼Œæœ‰å¾ˆå¤šæŒ‡æ ‡çš„ç»´åº¦éƒ½æ˜¯èŠ‚ç‚¹ä¿¡æ¯ï¼Œå°±æ˜¯å‘èµ·æœåŠ¡è°ƒç”¨çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚æœåŠ¡åã€ç‰ˆæœ¬ç­‰ç­‰ã€‚å…¶å®æˆ‘ä»¬å¯ä»¥å°†å®ƒè¿›è¡Œä¸€äº›ç¼“å­˜ï¼ŒåŠ é€Ÿè¿™äº›æŒ‡æ ‡çš„è®¡ç®—ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-data-plane-performance-optimization/h7eae61t56_hu_9f23334ea8da47c5.webp 400w,
               /blog/istio-data-plane-performance-optimization/h7eae61t56_hu_410e3955739d409c.webp 760w,
               /blog/istio-data-plane-performance-optimization/h7eae61t56_hu_c7fd65abcdca7708.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-data-plane-performance-optimization/h7eae61t56_hu_9f23334ea8da47c5.webp&#34;
               width=&#34;760&#34;
               height=&#34;369&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç»è¿‡ä¼˜åŒ–ä¹‹åï¼Œå¯¹æ¯” tstats é¥æµ‹å’Œå®˜æ–¹çš„åŸºäº Wasm çš„é¥æµ‹çš„æ€§èƒ½ï¼Œæˆ‘ä»¬å‘ç° CPU é™ä½äº† 10 åˆ° 20%ï¼Œç›¸å¯¹äºè€ç‰ˆæœ¬çš„ mixer æ¥è¯´é™ä½äº† 20% ä»¥ä¸Šï¼Œç¬¦åˆäº†æˆ‘ä»¬å¯¹ envoy æ€§èƒ½è°ƒç ”çš„ä¸€ä¸ªé¢„æœŸã€‚ä¸Šå›¾å³å¯ä»¥çœ‹åˆ°åœ¨å»¶æ—¶ä¸Šæœ‰ä¸€ä¸ªæ˜æ˜¾çš„é™ä½ï¼Œå³ä½¿åœ¨ P99 åœ¨ä¸åŒçš„ QPS ä¸‹ï¼Œä¹Ÿä¼šæœ‰ 20% åˆ° 40% çš„æ€»ä½“é™ä½ (è¿™ä¸ªå»¶æ—¶æ˜¯ä½¿ç”¨ echo service åš End-to-End å‹æµ‹å¾—åˆ°çš„)ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-data-plane-performance-optimization/b5y9rj2ecy_hu_efc8b1d942aff891.webp 400w,
               /blog/istio-data-plane-performance-optimization/b5y9rj2ecy_hu_a84a8558cbc10a6a.webp 760w,
               /blog/istio-data-plane-performance-optimization/b5y9rj2ecy_hu_9ef6d833a6059b8a.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-data-plane-performance-optimization/b5y9rj2ecy_hu_efc8b1d942aff891.webp&#34;
               width=&#34;760&#34;
               height=&#34;313&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ç«ç„°å›¾é‡æ–°è§‚å¯Ÿä¸€ä¸‹ Envoy å†…éƒ¨çš„ CPU ä½¿ç”¨åˆ†å¸ƒï¼Œæˆ‘ä»¬å‘ç° tstats é¥æµ‹æ’ä»¶å ç”¨ CPU çš„æ¯”ä¾‹æ˜æ˜¾æ›´å°‘ï¼Œè€Œä½¿ç”¨ wasm çš„é¥æµ‹æ’ä»¶æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ CPU å ç”¨æ¥å®ç°é¥æµ‹ï¼Œè¿™ä¹Ÿè¯æ˜äº† tstats ä¼˜åŒ–æ˜¯æœ‰æ•ˆæœçš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å‰é¢æˆ‘ä»¬åˆ†äº«äº†åœ¨ä¼˜åŒ– istio æ•°æ®é¢è¿‡ç¨‹å½“ä¸­ï¼Œåœ¨å†…æ ¸æ€å’Œ Envoy å†…æ¢ç´¢çš„ä¸€äº›ç»éªŒã€‚è¿™æ˜¯æˆ‘ä»¬ä¼˜åŒ–çš„ä¸»è¦å†…å®¹ï¼Œå½“ç„¶è¿˜æœ‰ä¸€äº›å…¶å®ƒçš„ä¼˜åŒ–ç‚¹ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ XDP è¿›è¡ŒåŠ é€Ÿï¼Œå› ä¸ºç”±äº istio proxy çš„å¼•å…¥ï¼ŒPod å’Œ Pod ä¹‹é—´çš„è®¿é—®å®é™…ä¸Šæ˜¯ä¸éœ€è¦ç»è¿‡ä¸»æœºä¸Šçš„ iptables è§„åˆ™å¤„ç†ã€‚åŸºäºè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ XDP çš„å¿«é€Ÿè½¬å‘èƒ½åŠ›ç›´æ¥å°†åŒ…å‘é€åˆ°å¯¹åº”çš„ç½‘å¡ï¼Œå®Œæˆå¿«é€Ÿè½¬å‘ã€‚&lt;/li&gt;
&lt;li&gt;é“¾è·¯è·Ÿè¸ªåœ¨ Envoy ä¸­æ¶ˆè€—çš„ CPU ä¹Ÿæ¯”è¾ƒå¯è§‚ï¼Œå³ä½¿åœ¨ 1% çš„é‡‡æ ·ç‡ä¸‹ä¹Ÿæ¶ˆè€—äº† 8% çš„ CPUï¼Œæ˜¯å¯ä»¥è¿›è¡Œä¼˜åŒ–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿåœ¨åšè¿™éƒ¨åˆ†çš„å·¥ä½œã€‚&lt;/li&gt;
&lt;li&gt;Envoy å†…éƒ¨æœ‰éå¸¸å¤šçš„å†…ç½®ç»Ÿè®¡ï¼ŒIstio çš„ä¸€äº›æŒ‡æ ‡ä¸ Envoy å†…ç½®çš„æŒ‡æ ‡æœ‰ä¸€éƒ¨åˆ†é‡å¤ï¼Œå¯ä»¥è€ƒè™‘è¿›è¡Œä¸€äº›è£å‰ªä¼˜åŒ–ï¼Œæˆ–è€…å¢åŠ ä¸€äº›ç‰¹æ€§å¼€å…³ï¼Œå½“ä¸éœ€è¦ä½¿ç”¨çš„æ—¶å€™å¯¹å®ƒè¿›è¡Œå…³é—­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ€»ä½“æ¥è¯´ï¼ŒIstio æ•°æ®é¢æ€§èƒ½çš„æŸè€—åˆ†å¸ƒåœ¨å„ä¸ªç¯èŠ‚ï¼Œå¹¶ä¸æ˜¯å•ç‹¬çš„å†…æ ¸æ€æ¶ˆæ¯è½¬å‘æˆ–è€…ç”¨æˆ·æ€ Envoy å°±æ¶ˆè€—ç‰¹åˆ«å¤šã€‚åœ¨ä½¿ç”¨ Mixer æ¶æ„çš„ Istio ç‰ˆæœ¬ä¸­ï¼ŒEnvoy å†…ä¸€ä¸ªæ˜æ˜¾çš„æ€§èƒ½çƒ­ç‚¹ï¼Œmixer é¥æµ‹ï¼Œè¿™ä¹Ÿåœ¨ç‰ˆæœ¬è¿­ä»£ä¸­é€æ­¥è§£å†³äº†ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œåœ¨è¿›è¡Œ Istio æ•°æ®é¢ä¼˜åŒ–çš„æ—¶å€™éœ€è¦ç»¼åˆè€ƒè™‘å„ä¸ªç¯èŠ‚ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç›®å‰æ€»ä½“ä¸Šå¯¹ Istio æ•°æ®é¢æ€§èƒ½çš„ä¸€ä¸ªè®¤è¯†ï¼Œé€šè¿‡è¿™æ¬¡åˆ†äº«ï¼Œå¸Œæœ›ç¤¾åŒºå’Œå¤§å®¶éƒ½ä¼šåœ¨æ›´æ³¨é‡ Istio æ•°æ®é¢çš„æ€§èƒ½ï¼Œå¸®åŠ© ServiceMesh æ›´å¥½åœ°è½åœ°ã€‚è…¾è®¯äº‘åŸºäº Istio æä¾›äº†äº‘ä¸Š Service Mesh äº§å“ TCMï¼Œå¤§å®¶æœ‰å…´è¶£å¯ä»¥æ¥ä½“éªŒã€‚&lt;/p&gt;
&lt;h2 id=&#34;é—®é¢˜&#34;&gt;é—®é¢˜&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€ä¹ˆåˆ¤æ–­é¡¹ç›®éœ€è¦ä½¿ç”¨æœåŠ¡ç½‘æ ¼ï¼Ÿ&lt;/strong&gt; æœåŠ¡ç½‘æ ¼è§£å†³çš„æœ€ç›´æ¥çš„åœºæ™¯å°±æ˜¯ä½ çš„æœåŠ¡éœ€è¦è¿›è¡Œå¾®æœåŠ¡æ²»ç†ï¼Œä½†æ˜¯ä½ ä»¬ä¹‹å‰å¯èƒ½æœ‰å¤šä¸ªæŠ€æœ¯æ ˆï¼Œæ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æŠ€æœ¯æ¡†æ¶ï¼Œæ¯”å¦‚æ²¡æœ‰ä½¿ç”¨ SpringCloud ç­‰ã€‚ç¼ºå°‘å¾®æœåŠ¡æ²»ç†èƒ½åŠ›ï¼Œä½†æ˜¯åˆæƒ³æœ€ä½æˆæœ¬è·å¾—é“¾è·¯è·Ÿè¸ªã€ç›‘æ§ã€æµé‡ç®¡ç†ã€ç†”æ–­ç­‰è¿™æ ·çš„èƒ½åŠ›ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨æœåŠ¡ç½‘æ ¼å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿™æ¬¡ä¼˜åŒ–æœ‰æ²¡æœ‰è€ƒè™‘åˆ°å›å½’åˆ°ç¤¾åŒºï¼Ÿ&lt;/strong&gt; å…¶å®æˆ‘ä»¬ä¹Ÿè€ƒè™‘è¿‡è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œ mixer ä¼˜åŒ–çš„æ—¶å€™ï¼Œå½“æ—¶è€ƒè™‘åˆ°éœ€è¦å¯¹ Envoy åšæ¯”è¾ƒå¤šçš„æ”¹åŠ¨ï¼Œå¹¶ä¸”äº†è§£åˆ°ç¤¾åŒºè§„åˆ’ä»æ¶æ„ä¸­å»æ‰ mixerï¼Œæ‰€ä»¥è¿™ä¸ªå¹¶æ²¡æœ‰å›å½’åˆ°ç¤¾åŒºï¼Œå¼‚æ­¥ä»»åŠ¡çº¿ç¨‹æ¶æ„çš„æ–¹æ¡ˆç›®å‰ä¿ç•™åœ¨å†…éƒ¨ã€‚å¯¹äºç¬¬äºŒç‚¹å¼€å‘çš„ tstats æ‰©å±•ï¼Œå®ƒçš„åŠŸèƒ½å’Œç¤¾åŒºçš„é¥æµ‹æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœæäº¤åˆ°ç¤¾åŒºæˆ‘ä»¬è§‰å¾—åŠŸèƒ½ä¼šæœ‰é‡å ï¼Œæ‰€ä»¥æ²¡æœ‰æäº¤ç»™ç¤¾åŒºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡ç½‘æ ¼æ•°æ®è°ƒä¼˜ç»™ç°åœ¨è…¾è®¯çš„ä¸šåŠ¡å¸¦æ¥äº†å“ªäº›æ”¹å˜ï¼Ÿ&lt;/strong&gt; æˆ‘æƒ³è¿™é‡Œä¸»è¦è¿˜æ˜¯å¯è§‚æµ‹æ€§ä¸Šé¢å§ï¼Œä¹‹å‰å¾ˆå¤šçš„æœåŠ¡å’Œå¼€å‘ï¼Œä»–ä»¬çš„ç›‘æ§å’Œè°ƒç”¨é¢çš„ä¸Šé¢åšå¾—éƒ½æ˜¯å·®å¼ºäººæ„çš„ï¼Œä½†æ˜¯ä»–ä»¬åœ¨ä¸šåŠ¡çš„å‹åŠ›ä¹‹ä¸‹ï¼Œå…¶å®æ˜¯æ²¡æœ‰å¾ˆå®Œå–„çš„æ–¹å¼ã€æ²¡æœ‰å¾ˆå¤§çš„åŠ¨åŠ›å¿«é€Ÿå®ç°è¿™äº›æœåŠ¡æ²»ç†çš„åŠŸèƒ½ï¼Œä½¿ç”¨ istio ä¹‹åï¼Œæœ‰ä¸å°‘å›¢é˜Ÿéƒ½è·å¾—äº†è¿™æ ·çš„èƒ½åŠ›ï¼Œä»–ä»¬ç»™æˆ‘ä»¬çš„åé¦ˆéƒ½æ˜¯æ¯”è¾ƒå¥½çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åœ¨å‡å°‘å»¶è¿Ÿæ–¹é¢ï¼Œè…¾è®¯åšäº†å“ªäº›è°ƒæ•´ï¼ŒæœåŠ¡ç½‘æ ¼ç°åœ¨æ˜¯å¦å·²ç»æˆç†Ÿï¼Œå¯¹å¼€å‘è€…æ˜¯å¦å‹å¥½ï¼Ÿ&lt;/strong&gt; åœ¨å»¶è¿Ÿæ–¹é¢ï¼Œæˆ‘ä»¬å¯¹æ€§èƒ½çš„ä¸»è¦æ¢ç´¢å°±æ˜¯ä»Šå¤©åˆ†äº«çš„å†…å®¹ï¼Œæˆ‘ä»¬æœ€å¼€å§‹å°±æ³¨æ„åˆ°å»¶æ—¶æ¯”è¾ƒé«˜ï¼Œç„¶ååœ¨å†…æ ¸åšäº†ç›¸åº”çš„ä¼˜åŒ–ï¼Œå¹¶ä¸”ç ”ç©¶äº†åœ¨ Envoy å†…ä¸ºä»€ä¹ˆä¼šæœ‰è¿™äº›å»¶è¿Ÿã€‚æ‰€ä»¥æˆ‘ä»¬å¾—å‡ºçš„ç»“è®ºï¼ŒCPU æ˜¯æ ¸å¿ƒçš„èµ„æºï¼Œéœ€è¦å°½é‡é™ä½æ•°æ®é¢ Proxy ä»£ç†å¯¹ CPU çš„ä½¿ç”¨ï¼Œè¿™æ˜¯æˆ‘ä»¬åšæ‰€æœ‰ä¼˜åŒ–æœ€æ ¸å¿ƒçš„å‡ºå‘ç‚¹ï¼Œå½“ CPU é™ä¸‹æ¥ï¼Œå»¶æ—¶å°±ä¼šé™ä½ã€‚æœåŠ¡ç½‘æ ¼ç°åœ¨æ˜¯å¦å·²ç»æˆç†Ÿã€‚æˆ‘è§‰å¾—ä¸åŒçš„äººæœ‰ä¸åŒç­”æ¡ˆï¼Œå› ä¸ºå¯¹ä¸€äº›å›¢é˜Ÿï¼Œç›®å‰ä»–ä»¬ä½¿ç”¨æœåŠ¡ç½‘æ ¼ä½¿ç”¨å¾—å¾ˆå¥½çš„ï¼Œå› ä¸ºä»–ä»¬æœ‰å¤šä¸ªæŠ€æœ¯æ ˆï¼Œæ²¡æœ‰ç»Ÿä¸€çš„æ¡†æ¶ã€‚ä»–ä»¬ç”¨äº†ä¹‹åï¼Œè·å¾—è¿™äº›æµé‡çš„ç®¡ç†å’Œç›‘æ§ç­‰ç­‰èƒ½åŠ›ï¼Œå…¶å®å·²ç»æ»¡è¶³äº†ä»–ä»¬çš„éœ€æ±‚ã€‚ä½†æ˜¯å¯¹ä¸€äº›æˆç†Ÿçš„æ¯”è¾ƒå¤§çš„æœåŠ¡ï¼Œæ•°æ®é¢æ€§èƒ½ä¸Šé¢å¯èƒ½ä¼šæœ‰ä¸€äº›å½±å“ï¼Œè¿™ä¸ªéœ€è¦ç›¸åº”çš„å›¢é˜Ÿè¿›è¡Œä»”ç»†çš„è¯„ä¼°æ‰èƒ½å†³å®šï¼Œå¹¶æ²¡åŠæ³•è¯´å®ƒä¸€å®šå°±æ˜¯èƒ½åœ¨ä»»ä½•åœºæ™¯ä¸‹å¯ä»¥ç›´æ¥æ›¿æ¢ç°æœ‰çš„å„ä¸ªå›¢é˜Ÿçš„æœåŠ¡æ²»ç†çš„æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆä¸ç›´æ¥è€ƒè™‘ 1.6ï¼Ÿ&lt;/strong&gt; å› ä¸ºæˆ‘ä»¬åšäº§å“åŒ–çš„æ—¶å€™ï¼Œå‘¨æœŸè¿˜æ˜¯æ¯”è¾ƒé•¿çš„ã€‚istio ç¤¾åŒºå‘ç‰ˆæœ¬çš„é€Ÿåº¦è¿˜æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œæˆ‘ä»¬è¿˜åœ¨åš 1.5 äº§å“åŒ–çš„æ—¶å€™ï¼Œå¯èƒ½åšç€åšç€ï¼Œistio1.6 ç‰ˆæœ¬å°±å‘å‡ºæ¥äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿåœ¨ä¸åœæ›´æ–°è·Ÿè¿­ä»£ï¼Œä¸€ç›´åœ¨è·Ÿéšç¤¾åŒºï¼Œç›®å‰ä¸»è¦è¿˜æ˜¯åœ¨ 1.5 ç‰ˆæœ¬ä¸Šã€‚å…¶å®æˆ‘ä»¬åœ¨ 1.4 çš„æ—¶å€™å°±å¼€å§‹åšç°åœ¨çš„äº§å“äº†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¬å¸åœ¨å¼•å…¥å¤šç§äº‘åŸç”Ÿæ¶æ„ï¼ŒåŒ…æ‹¬ SpringCloud å’Œ Dubboï¼Œä½œä¸ºè¿ç»´ï¼Œæœ‰å¿…è¦ç”¨ Istio åšæœåŠ¡æ²»ç†å—ï¼Ÿå¦å¤– SpringCloud å’Œ Dubbo è¿™ç§æ¶æ„è¿ç§»åˆ° Istioï¼Œå¦‚ä½•è°ƒæ•´ï¼Ÿ&lt;/strong&gt; ç›®å‰ SpringCloud å’Œ Dubbo éƒ½æœ‰ä¸é”™çš„æœåŠ¡æ²»ç†åŠŸèƒ½ï¼Œå¦‚æœæ²¡æœ‰éå¸¸ç´§è¿«çš„éœ€æ±‚ï¼Œæ¯”å¦‚ä½ ä»¬åˆéœ€è¦å¼•å…¥æ–°çš„æœåŠ¡å¹¶ä¸”ç”¨åˆ«çš„è¯­è¨€å®ç°ï¼Œæˆ‘è§‰å¾—ç»§ç»­ä½¿ç”¨è¿™æ ·çš„æ¡†æ¶ï¼Œå¯èƒ½å¼•å…¥ istio æ²¡æœ‰å¤ªå¤§çš„ä¼˜åŠ¿ã€‚ä½†æ˜¯å¦‚æœè€ƒè™‘è¿›è¡Œæ›´å¤§è§„æ¨¡çš„æœåŠ¡æ²»ç†ï¼ŒåŒ…æ‹¬èåˆ SpringCloud å’Œ Dubbo, åˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨ istio è¿›è¡Œä¸€ä¸ªåˆå¹¶çš„ï¼Œä½†æ˜¯è¿™ä¸ªè½åœ°ä¼šæ¯”è¾ƒå¤æ‚ã€‚é‚£ä¹ˆ SpringCloud å’Œ Dubbo è¿ç§»åˆ° Istio å¦‚ä½•è°ƒæ•´ï¼Ÿç›®å‰æœ€å¤æ‚çš„å°±æ˜¯ä»–ä»¬çš„æœåŠ¡æ³¨å†Œæœºåˆ¶ä¸ä¸€æ ·ï¼ŒæœåŠ¡æ³¨å†Œæ¨¡å‹ä¸ä¸€æ ·ã€‚æˆ‘ä»¬ä¹‹å‰å†…éƒ¨ä¹Ÿæœ‰åœ¨é¢„ç ”å¦‚ä½•æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æœåŠ¡æ³¨å†Œæ¨¡å‹ï¼Œä»¥ç»¼åˆ Istio å’Œå…¶å®ƒæŠ€æœ¯æ¡†æ¶å¦‚ SpringCloud çš„æœåŠ¡æ³¨å†Œå’ŒæœåŠ¡å‘ç°ï¼Œä»¥åŠ SpringCloud å¦‚ä½•è¿ç§»è¿›æ¥ã€‚è¿™ä¸ªæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å¯¹ SDK åšä¸€äº›æ”¹åŠ¨ï¼Œæˆ‘è§‰å¾—å¯ä»¥ä¸‹æ¥å†è¿›è¡Œäº¤æµã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>ä¸€æ–‡å¸¦ä½ å½»åº•å˜æ¸… Istio ä¸­çš„è¯ä¹¦å·¥ä½œæœºåˆ¶</title>
      <link>https://cloudnativecn.com/blog/istio-certificate/</link>
      <pubDate>Mon, 25 May 2020 06:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-certificate/</guid>
      <description>&lt;p&gt;åœ¨ä¸Šä¸€ç¯‡æ–‡ç« &lt;a href=&#34;https://cloudnativecn.com/blog/k8s-certificate/&#34;&gt;ä¸€æ–‡å¸¦ä½ å½»åº•å˜æ¸… Kubernetes ä¸­çš„è¯ä¹¦å·¥ä½œæœºåˆ¶&lt;/a&gt;ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† Kubernetes ä¸­è¯ä¹¦çš„å·¥ä½œæœºåˆ¶ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç»§ç»­æ¢è®¨ Istio æ˜¯å¦‚ä½•ä½¿ç”¨è¯ä¹¦æ¥å®ç°ç½‘æ ¼ä¸­æœåŠ¡çš„èº«ä»½è®¤è¯å’Œå®‰å…¨é€šä¿¡çš„ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ˜¯å¯¹ Istio è®¤è¯å·¥ä½œæœºåˆ¶çš„æ·±åº¦åˆ†æï¼Œå‡è®¾è¯»è€…å·²ç»äº†è§£ Service Mesh ä»¥åŠ Istio çš„ç›¸å…³åŸºç¡€æ¦‚å¿µï¼Œå› æ­¤åœ¨æœ¬æ–‡å¯¹æ­¤ç±»åŸºç¡€æ¦‚å¿µä¸å†è§£é‡Šã€‚å¯¹äº Istio ä¸ç†Ÿæ‚‰çš„è¯»è€…ï¼Œå»ºè®®å…ˆé˜…è¯» Istio å®˜æ–¹ç½‘ç«™ä¸Šçš„çš„è¿™ç¯‡åŸºç¡€ä»‹ç» &lt;a href=&#34;https://istio.io/docs/concepts/what-is-istio/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;What is Istio?&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-å®‰å…¨æ¶æ„&#34;&gt;Istio å®‰å…¨æ¶æ„&lt;/h2&gt;
&lt;p&gt;Istio ä¸ºå¾®æœåŠ¡æä¾›äº†æ— ä¾µå…¥ï¼Œå¯æ’æ‹”çš„å®‰å…¨æ¡†æ¶ã€‚åº”ç”¨ä¸éœ€è¦ä¿®æ”¹ä»£ç ï¼Œå°±å¯ä»¥åˆ©ç”¨ Istio æä¾›çš„åŒå‘ TLS è®¤è¯å®ç°æœåŠ¡èº«ä»½è®¤è¯ï¼Œå¹¶åŸºäºæœåŠ¡èº«ä»½ä¿¡æ¯æä¾›ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ã€‚Istio å®‰å…¨çš„é«˜å±‚æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34;
           src=&#34;https://cloudnativecn.com/blog/istio-certificate/arch-sec.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

å›¾ 1. Istio Security Architectureï¼Œå›¾ç‰‡æ¥æº&lt;a href=&#34;https://istio.io/docs/concepts/security/#high-level-architecture&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;istio.io&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å›¾ä¸­å±•ç¤ºäº† Istio ä¸­çš„æœåŠ¡è®¤è¯å’Œæˆæƒä¸¤éƒ¨åˆ†å†…å®¹ã€‚è®©æˆ‘ä»¬æš‚æ—¶å¿½ç•¥æ‰æˆæƒéƒ¨åˆ†ï¼Œå…ˆå…³æ³¨è®¤è¯éƒ¨åˆ†ã€‚æœåŠ¡è®¤è¯æ˜¯é€šè¿‡æ§åˆ¶é¢å’Œæ•°æ®é¢ä¸€èµ·å®ç°çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ§åˆ¶é¢ï¼šIstiod ä¸­å®ç°äº†ä¸€ä¸ª CAï¼ˆCertificate Authorityï¼Œè¯ä¹¦æœºæ„ï¼‰æœåŠ¡å™¨ã€‚è¯¥ CA æœåŠ¡å™¨è´Ÿè´£ä¸ºç½‘æ ¼ä¸­çš„å„ä¸ªæœåŠ¡ç­¾å‘è¯ä¹¦ï¼Œå¹¶å°†è¯ä¹¦åˆ†å‘ç»™æ•°æ®é¢çš„å„ä¸ªæœåŠ¡çš„ sidecar ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;æ•°æ®é¢ï¼šåœ¨ç½‘æ ¼ä¸­çš„æœåŠ¡ç›¸äº’ä¹‹é—´å‘èµ· plain HTTP/TCP é€šä¿¡æ—¶ï¼Œå’ŒæœåŠ¡åŒä¸€ä¸ª pod ä¸­çš„ sidecar ä»£ç†ä¼šæ‹¦æˆªæœåŠ¡è¯·æ±‚ï¼Œé‡‡ç”¨è¯ä¹¦å’Œå¯¹ç«¯æœåŠ¡çš„ sidecar ä»£ç†è¿›è¡ŒåŒå‘ TLS è®¤è¯å¹¶å»ºç«‹ä¸€ä¸ª TLS è¿æ¥ï¼Œä½¿ç”¨è¯¥ TLS è¿æ¥æ¥åœ¨ç½‘ç»œä¸­ä¼ è¾“æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ§åˆ¶é¢è¯ä¹¦ç­¾å‘æµç¨‹&#34;&gt;æ§åˆ¶é¢è¯ä¹¦ç­¾å‘æµç¨‹&lt;/h2&gt;
&lt;p&gt;å›¾ 1 æ˜¯å¯¹ Istio å®‰å…¨æ¶æ„çš„ä¸€ä¸ªé«˜åº¦æ¦‚æ‹¬çš„æè¿°ï¼Œè®©æˆ‘ä»¬æŠŠå›¾ 1 ä¸­æ§åˆ¶é¢çš„äº¤äº’å±•å¼€ï¼Œçœ‹ä¸€ä¸‹å…¶ä¸­çš„ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34;
           src=&#34;https://cloudnativecn.com/blog/istio-certificate/istio-ca.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

å›¾ 2. Istio è¯ä¹¦åˆ†å‘æµç¨‹&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæš‚æ—¶å¿½ç•¥å›¾ä¸­å³è¾¹è“è‰²è™šçº¿çš„éƒ¨åˆ†ï¼ˆç¨åä¼šåœ¨ &lt;a href=&#34;#heading1&#34;&gt;æ§åˆ¶é¢èº«ä»½è®¤è¯&lt;/a&gt; éƒ¨åˆ†è®²åˆ°ï¼‰ï¼Œå›¾ä¸­å·¦åŠéƒ¨åˆ†æè¿°äº† Istio æ§åˆ¶é¢å‘ Envoy ç­¾å‘è¯ä¹¦çš„æµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Envoy å‘ pilot-agent å‘èµ·ä¸€ä¸ª SDS (Secret Discovery Service) è¯·æ±‚ï¼Œè¦æ±‚è·å–è‡ªå·±çš„è¯ä¹¦å’Œç§é’¥ã€‚&lt;/li&gt;
&lt;li&gt;Pilot-agent ç”Ÿæˆç§é’¥å’Œ CSRï¼ˆCertificates Signing Requestï¼Œè¯ä¹¦ç­¾åè¯·æ±‚ï¼‰ï¼Œå‘ Istiod å‘é€è¯ä¹¦ç­¾å‘è¯·æ±‚ï¼Œè¯·æ±‚ä¸­åŒ…å« CSR å’Œè¯¥ pod ä¸­æœåŠ¡çš„èº«ä»½ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;Istiod æ ¹æ®è¯·æ±‚ä¸­æœåŠ¡çš„èº«ä»½ä¿¡æ¯ï¼ˆService Accountï¼‰ä¸ºå…¶ç­¾å‘è¯ä¹¦ï¼Œå°†è¯ä¹¦è¿”å›ç»™ Pilot-agentã€‚&lt;/li&gt;
&lt;li&gt;Pilot-agent å°†è¯ä¹¦å’Œç§é’¥é€šè¿‡ SDS æ¥å£è¿”å›ç»™ Envoyã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆè¦é€šè¿‡-pilot-agent-ä¸­è½¬&#34;&gt;ä¸ºä»€ä¹ˆè¦é€šè¿‡ Pilot-agent ä¸­è½¬ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä»å›¾ 2 å¯ä»¥çœ‹åˆ°ï¼ŒIstio è¯ä¹¦ç­¾å‘çš„è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°äº†ä¸‰ä¸ªç»„ä»¶ï¼šIstiod (Istio CA) &amp;mdash;&amp;gt; Pilot-agent &amp;mdash;&amp;gt; Enovyã€‚ä¸ºä»€ä¹ˆå…¶ä»– xDS æ¥å£éƒ½æ˜¯ç”± Istiod ç›´æ¥å‘ Envoy æä¾›ï¼Œä½† SDS å´è¦é€šè¿‡ Pilot-agent è¿›è¡Œä¸€æ¬¡ä¸­è½¬ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”± Envoy é€šè¿‡ SDS æ¥å£ä» Istiod è·å–è¯ä¹¦å‘¢ï¼Ÿè¿™æ ·åšä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œåœ¨ Istio çš„è¯ä¹¦ç­¾å‘æµç¨‹ä¸­ï¼Œç”± Pilot-agent ç”Ÿæˆç§é’¥å’Œ CSRï¼Œå†é€šè¿‡ CSR å‘ Istiod ä¸­çš„ CA ç”³è¯·è¯ä¹¦ã€‚åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œç§é’¥åªå­˜åœ¨äºæœ¬åœ°çš„ Istio-proxy å®¹å™¨ä¸­ã€‚å¦‚æœå»æ‰ä¸­é—´ Pilot-agent è¿™ä¸€æ­¥ï¼Œç›´æ¥ç”± Envoy å‘ Istiod ç”³è¯·è¯ä¹¦ï¼Œåˆ™éœ€è¦ç”± Istiod ç”Ÿæˆç§é’¥ï¼Œå¹¶å°†ç§é’¥å’Œè¯ä¹¦ä¸€èµ·é€šè¿‡ç½‘ç»œè¿”å›ç»™ Envoyï¼Œè¿™å°†å¤§å¤§å¢åŠ ç§é’¥æ³„éœ²çš„é£é™©ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€æ–¹é¢ï¼Œé€šè¿‡ Pilot-agent æ¥æä¾› SDS æœåŠ¡ï¼Œç”± Pilot-agent ç”Ÿæˆæ ‡å‡†çš„ CSR è¯ä¹¦ç­¾åè¯·æ±‚ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°å¯¹æ¥ä¸åŒçš„ CA æœåŠ¡å™¨ï¼Œæ–¹ä¾¿ Istio å’Œå…¶ä»–è¯ä¹¦æœºæ„è¿›è¡Œé›†æˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ§åˆ¶é¢èº«ä»½è®¤è¯&#34;&gt;æ§åˆ¶é¢èº«ä»½è®¤è¯&lt;/h3&gt;
&lt;p&gt;è¦é€šè¿‡æœåŠ¡è¯ä¹¦æ¥å®ç°ç½‘æ ¼ä¸­æœåŠ¡çš„èº«ä»½è®¤è¯ï¼Œå¿…é¡»é¦–å…ˆç¡®ä¿æœåŠ¡ä»æ§åˆ¶é¢è·å–è‡ªèº«è¯ä¹¦çš„æµç¨‹æ˜¯å®‰å…¨çš„ã€‚Istio é€šè¿‡ Istiod å’Œ Pilog-agent ä¹‹é—´çš„ gRPC é€šé“ä¼ é€’ CSR å’Œè¯ä¹¦ï¼Œå› æ­¤åœ¨è¿™ä¸¤ä¸ªç»„ä»¶è¿›è¡Œé€šä¿¡æ—¶ï¼ŒåŒæ–¹éœ€è¦å…ˆéªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼Œä»¥é¿å…æ¶æ„ç¬¬ä¸‰æ–¹ä¼ªé€  CSR è¯·æ±‚æˆ–è€…å‡å†’ Istiod CA æœåŠ¡å™¨ã€‚åœ¨ç›®å‰çš„ç‰ˆæœ¬ä¸­ (Istio1.6)ï¼ŒPilot-agent å’Œ Istiod åˆ†å¸ƒé‡‡ç”¨äº†ä¸åŒçš„è®¤è¯æ–¹å¼ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Istiod èº«ä»½è®¤è¯
&lt;ul&gt;
&lt;li&gt;Istiod é‡‡ç”¨å…¶å†…ç½®çš„ CA æœåŠ¡å™¨ä¸ºè‡ªèº«ç­¾å‘ä¸€ä¸ªæœåŠ¡å™¨è¯ä¹¦ï¼ˆå›¾ 2 ä¸­çš„ Istiod certificateï¼‰ï¼Œå¹¶é‡‡ç”¨è¯¥æœåŠ¡å™¨è¯ä¹¦å¯¹å¤–æä¾›åŸºäº TLS çš„ gPRC æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;Istiod è°ƒç”¨ Kube-apiserver ç”Ÿæˆä¸€ä¸ª ConfigMapï¼Œåœ¨è¯¥ ConfigMap ä¸­æ”¾å…¥äº† Istiod çš„ CA æ ¹è¯ä¹¦ (å›¾ 2 ä¸­çš„ istio-ca-root-cert)ã€‚&lt;/li&gt;
&lt;li&gt;è¯¥ ConfigMap è¢« Mount åˆ° Istio-proxy å®¹å™¨ä¸­ï¼Œè¢« Pilot-agent ç”¨äºéªŒè¯ Istiod çš„æœåŠ¡å™¨è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ Pilot-agent å’Œ Istiod å»ºç«‹ gRPC è¿æ¥æ—¶ï¼ŒPilot-agent é‡‡ç”¨æ ‡å‡†çš„ TLS æœåŠ¡å™¨è®¤è¯æµç¨‹å¯¹ Istiod çš„æœåŠ¡å™¨è¯ä¹¦è¿›è¡Œè®¤è¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Pilot-agent èº«ä»½è®¤è¯
&lt;ul&gt;
&lt;li&gt;åœ¨ Kubernetes ä¸­å¯ä»¥ä¸ºæ¯ä¸€ä¸ª pod å…³è”ä¸€ä¸ª &lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Account&lt;/a&gt;ï¼Œä»¥è¡¨æ˜è¯¥ pod ä¸­è¿è¡Œçš„æœåŠ¡çš„èº«ä»½ä¿¡æ¯ã€‚ä¾‹å¦‚ bookinfo ä¸­ reviews æœåŠ¡çš„ service accout æ˜¯â€œbookinfo-reviewsâ€ ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes ä¼šä¸ºè¯¥ service account ç”Ÿæˆä¸€ä¸ª jwt tokenï¼Œå¹¶å°†è¯¥ token é€šè¿‡ secret åŠ è½½åˆ° pod ä¸­çš„ä¸€ä¸ªæ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;Pilot-agent åœ¨å‘ Istiod å‘é€ CSR æ—¶ï¼Œå°†å…¶æ‰€åœ¨ pod çš„ service account token ä¹Ÿéšè¯·æ±‚å‘é€ç»™ Istiodã€‚&lt;/li&gt;
&lt;li&gt;Istiod è°ƒç”¨ Kube-apiserver æ¥å£éªŒè¯è¯·æ±‚ä¸­é™„å¸¦çš„ service account tokenï¼Œä»¥ç¡®è®¤è¯·æ±‚è¯ä¹¦çš„æœåŠ¡èº«ä»½æ˜¯å¦åˆæ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¤‡æ³¨ï¼šé™¤äº† Kubernetes ä¹‹å¤–ï¼ŒIstio ä¹Ÿæ”¯æŒè™šæœºéƒ¨ç½²ï¼Œåœ¨è™šæœºéƒ¨ç½²çš„åœºæ™¯ä¸‹ï¼Œç”±äºæ²¡æœ‰ service accountï¼ŒPilot-agent å’Œ Pilotd ä¹‹é—´çš„èº«ä»½è®¤è¯æ–¹å¼æœ‰æ‰€ä¸åŒã€‚ç”±äº Istio çš„ä¸»è¦ä½¿ç”¨åœºæ™¯è¿˜æ˜¯ Kubernetesï¼Œæœ¬æ–‡åªåˆ†æ Kubernetes éƒ¨ç½²åœºæ™¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sds-å·¥ä½œåŸç†&#34;&gt;SDS å·¥ä½œåŸç†&lt;/h2&gt;
&lt;p&gt;å’Œå…¶ä»– &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-docs/xds_protocol&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS&lt;/a&gt; æ¥å£ä¸€æ ·ï¼ŒSDS ä¹Ÿæ˜¯ Envoy æ”¯æŒçš„ä¸€ç§åŠ¨æ€é…ç½®æœåŠ¡æ¥å£ã€‚Envoy å¯ä»¥é€šè¿‡ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/security/secret&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SDSï¼ˆsecret discovery serviceï¼‰&lt;/a&gt; æ¥å£ä» SDS æœåŠ¡å™¨è‡ªåŠ¨è·å–è¯ä¹¦ã€‚å’Œä¹‹å‰çš„æ–¹å¼ç›¸æ¯”ï¼ŒSDS æœ€å¤§çš„å¥½å¤„å°±æ˜¯ç®€åŒ–äº†è¯ä¹¦ç®¡ç†ã€‚åœ¨æ²¡æœ‰ä½¿ç”¨ SDS å‰ï¼ŒIstio ä¸­çš„æœåŠ¡è¯ä¹¦è¢«åˆ›å»ºä¸º Kubernetes secretï¼Œå¹¶æŒ‚è½½åˆ°ä»£ç†å®¹å™¨ä¸­ã€‚å¦‚æœè¯ä¹¦è¿‡æœŸäº†ï¼Œåˆ™éœ€è¦æ›´æ–° secret å¹¶é‡å¯ Envoy å®¹å™¨ï¼Œä»¥å¯ç”¨æ–°çš„è¯ä¹¦ã€‚ä½¿ç”¨ SDS åï¼ŒSDS æœåŠ¡å™¨ï¼ˆPilot-agent å……å½“äº† SDS æœåŠ¡å™¨çš„è§’è‰²ï¼‰å°†å‘ Envoy å®ä¾‹ä¸»åŠ¨æ¨é€è¯ä¹¦ã€‚å¦‚æœè¯ä¹¦è¿‡æœŸï¼ŒSDS æœåŠ¡å™¨åªéœ€å°†æ–°çš„è¯ä¹¦æ¨é€åˆ° Envoy ä¾‹ä¸­ï¼ŒEnvoy ä¼šä½¿ç”¨æ–°çš„è¯ä¹¦æ¥åˆ›å»ºé“¾æ¥ï¼Œæ— éœ€é‡æ–°å¯åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34;
           src=&#34;https://cloudnativecn.com/blog/istio-certificate/envoy-sds.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

å›¾ 3. Envoy SDS æœåŠ¡&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼ŒIstio é‡‡ç”¨ SDS åï¼Œé¿å…äº†åœ¨è¯ä¹¦æ›´æ–°åé‡å¯ Envoyï¼Œå¤§å¤§å‡å°‘äº†è¯ä¹¦æ›´æ–°å¯¹ä¸šåŠ¡çš„å½±å“ã€‚åŒæ—¶ï¼Œç”±äº Pilot-agent å’Œ Envoy å¤„äºåŒä¸€å®¹å™¨ä¸­ï¼Œç§é’¥åªå­˜åœ¨äºæœ¬åœ°å®¹å™¨ï¼Œé¿å…äº†åœ¨ç½‘ç»œä¸­ä¼ é€’ç§é’¥ï¼Œä¹Ÿé™ä½äº†ç§é’¥æ³„éœ²çš„å®‰å…¨é£é™©ã€‚&lt;/p&gt;
&lt;p&gt;SDS æœåŠ¡å‘ Envoy ä¸‹å‘çš„æ•°æ®ç»“æ„ä¸º&lt;code&gt;extensions.transport_sockets.tls.v3.Secret&lt;/code&gt;,å…¶ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;                            &lt;span class=&#34;c1&#34;&gt;// Secret åç§°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_certificate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// æ•°å­—è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;session_ticket_keys&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;validation_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// è¯ä¹¦éªŒè¯ä¿¡æ¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;generic_secret&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­åœ¨ Istio ä¸­ç”¨åˆ°çš„ä¸»è¦æ˜¯ &lt;code&gt;tls_certificate&lt;/code&gt; å’Œ &lt;code&gt;validation_context&lt;/code&gt;ã€‚åˆ†åˆ«ç”¨äºä¼ é€’æ•°å­—è¯ä¹¦å’ŒéªŒè¯å¯¹æ–¹è¯ä¹¦ä½¿ç”¨åˆ°çš„æ ¹è¯ä¹¦ã€‚ä¸‹é¢æ˜¯è¿™ä¸¤ä¸ªå­—æ®µçš„ç»“æ„ï¼Œç»“æ„ä¸­æ ‡æ³¨äº†æˆ‘ä»¬ä¸»è¦éœ€è¦å…³æ³¨çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;tls_certificate&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;certificate_chain&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// è¯ä¹¦å†…å®¹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;private_key&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;                 &lt;span class=&#34;c1&#34;&gt;// è¯ä¹¦çš„ç§é’¥
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;private_key_provider&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;password&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;validation_context&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;trusted_ca&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;                 &lt;span class=&#34;c1&#34;&gt;// CA æ ¹è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;verify_certificate_spki&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;verify_certificate_hash&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;match_subject_alt_names&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[],&lt;/span&gt;         &lt;span class=&#34;c1&#34;&gt;// éœ€è¦éªŒè¯çš„ subject alt name
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;crl&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{...}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;allow_expired_certificate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;trust_chain_verification&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç½‘æ ¼-sidecar-è¯ä¹¦é…ç½®&#34;&gt;ç½‘æ ¼ Sidecar è¯ä¹¦é…ç½®&lt;/h2&gt;
&lt;p&gt;åœ¨ Istio çš„ Enovy sidecar é…ç½®ä¸­ï¼Œæœ‰ä¸¤å¤„éœ€è¦é€šè¿‡ SDS æ¥é…ç½®è¯ä¹¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Inbound Listenerï¼šç”±äº Enovy é€šè¿‡ Listener å¯¹å¤–æä¾›æœåŠ¡ï¼Œéœ€è¦é€šè¿‡ SDS é…ç½®æœåŠ¡å™¨è¯ä¹¦ï¼ŒæœåŠ¡å™¨è¯ä¹¦ç§é’¥ï¼Œä»¥åŠéªŒè¯ä¸‹æ¸¸å®¢æˆ·ç«¯è¯ä¹¦çš„ CA æ ¹è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;Outbound Clusterï¼šå¯¹äºä¸Šæ¸¸çš„ Cluster è€Œè¨€ï¼ŒEnvoy æ˜¯å®¢æˆ·ç«¯çš„è§’è‰²ï¼Œå› æ­¤éœ€è¦åœ¨ Cluster ä¸­é€šè¿‡ SDS é…ç½®å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå®¢æˆ·ç«¯è¯ä¹¦ç§é’¥ï¼Œä»¥åŠéªŒè¯ä¸Šæ¸¸æœåŠ¡å™¨çš„ CA æ ¹è¯ä¹¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ bookinfo ç¤ºä¾‹ä¸­ Envoy sidecar ä»£ç†ä¸Š reviews å¾®æœåŠ¡ç›¸å…³çš„è¯ä¹¦é…ç½®ï¼Œä»¥å¯¹ Istio ä¸­ SDS çš„è¿ä½œæœºåˆ¶æœ‰ä¸€ä¸ªæ›´æ¸…æ™°çš„è®¤è¯†ã€‚ä¸ºäº†ç®€ç•¥èµ·è§ï¼Œæœ¬æ–‡åªæ˜¾ç¤ºäº†éƒ¨åˆ†å…³é”®çš„é…ç½®ã€‚ä½ ä¹Ÿå¯ä»¥æŸ¥çœ‹ Github ä¸Šçš„&lt;a href=&#34;https://github.com/zhaohuabing/bookinfo-bookinfo-config-dump/blob/istio1.5.4/reviews-config-dump&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®Œæ•´é…ç½®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ Envoy çš„ç®¡ç†ç«¯å£ï¼Œå¯ä»¥å¯¼å‡º Envoy ä¸­çš„å½“å‰é…ç½®ï¼Œå¯¼å‡ºå‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; reviews-v1-6d8bc58dd7-ts8kw -c istio-proxy curl http://127.0.0.1:15000/config_dump &amp;gt; config_dump
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é…ç½®æ–‡ä»¶ä¸­ SDS æœåŠ¡å™¨çš„å®šä¹‰å¦‚ä¸‹ï¼ŒPilot-agent åœ¨ &lt;code&gt;/etc/istio/proxy/SDS&lt;/code&gt; è¿™è·¯å¾„ä¸Šé€šè¿‡ unix domain socket æä¾›äº†ä¸€ä¸ª SDS æœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sds-grpc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;STATIC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;hidden_envoy_deprecated_hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;pipe&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/etc/istio/proxy/SDS&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;http2_protocol_options&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Details Pod åœ¨ 9080 ç«¯å£å¯¹å¤–æä¾›æœåŠ¡ï¼Œå› æ­¤éœ€è¦é€šè¿‡ SDS é…ç½® 9080 ç«¯å£ä¸Šçš„æœåŠ¡ç«¯è¯ä¹¦å’ŒéªŒè¯å®¢æˆ·ç«¯è¯ä¹¦çš„ CA æ ¹è¯ä¹¦ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;virtualInbound&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;                                &lt;span class=&#34;c1&#34;&gt;// 15006 ç«¯å£ä¸Šçš„è™šæ‹Ÿå…¥å‘ç›‘å¬å™¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;active_state&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2020-05-14T03:59:54Z/25&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.api.v2.Listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;virtualInbound&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15006&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_chains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_chain_match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix_ranges&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;address_prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.44.0.8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix_len&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;destination_port&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;                            &lt;span class=&#34;c1&#34;&gt;// ç”¨äºå¤„ç†å‘å‘ reviews æœåŠ¡ 9080 ç«¯å£çš„ä¸šåŠ¡è¯·æ±‚çš„ filter chain
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.transport_sockets.tls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.api.v2.auth.DownstreamTlsContext&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;common_tls_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;alpn_protocols&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;s2&#34;&gt;&amp;#34;h2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;s2&#34;&gt;&amp;#34;http/1.1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_certificate_sds_secret_configs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;          &lt;span class=&#34;c1&#34;&gt;// é…ç½®æœåŠ¡å™¨ç«¯è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;         &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;                             &lt;span class=&#34;c1&#34;&gt;// æœåŠ¡å™¨è¯ä¹¦ Secret åç§°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;sds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_config_source&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GRPC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc_services&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy_grpc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sds-grpc&amp;#34;&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// é…ç½®ç”¨äºè·å–æœåŠ¡å™¨ç«¯è¯ä¹¦çš„ SDS æœåŠ¡å™¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;combined_validation_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;default_validation_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;validation_context_sds_secret_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// é…ç½®éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦çš„ CA æ ¹è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ROOTCA&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;                            &lt;span class=&#34;c1&#34;&gt;// CA æ ¹è¯ä¹¦ Secret åç§°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;sds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_config_source&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GRPC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc_services&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy_grpc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sds-grpc&amp;#34;&lt;/span&gt;             &lt;span class=&#34;c1&#34;&gt;// é…ç½®ç”¨äºè·å– CA æ ¹è¯ä¹¦çš„ SDS æœåŠ¡å™¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;require_client_certificate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®¢æˆ·ç«¯ Pod ä¸Šçš„ Enovy é€šè¿‡ reviews outbound cluster è®¿é—®ä¸Šæ¸¸ reviews æœåŠ¡ï¼Œå› æ­¤éœ€è¦åœ¨è¯¥ cluster ä¸Šé…ç½®å®¢æˆ·ç«¯è¯ä¹¦ä»¥åŠéªŒè¯æœåŠ¡å™¨ç«¯è¯ä¹¦çš„ CA æ ¹è¯ä¹¦ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒEnvoy åœ¨éªŒè¯æœåŠ¡å™¨ç«¯è¯ä¹¦æ—¶ä¼šåŒæ—¶éªŒè¯è¯ä¹¦ä¸­çš„ subject alternative name å­—æ®µã€‚è¯¥å­—æ®µä¸­è®¾ç½®çš„æ˜¯ reviews æœåŠ¡ Pod å…³è”çš„ Service Account åç§°ã€‚ç”±äº Service Account æ˜¯ Istio ä¸­è®¤å¯çš„ä¸€ç§ç”¨æˆ·è´¦æˆ·ï¼Œå› æ­¤é€šè¿‡ä¸º Service Account è®¾ç½®ä¸åŒçš„èµ„æºè®¿é—®æƒé™ï¼Œå¯ä»¥è¿›ä¸€æ­¥å®ç°ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ï¼Œä¾‹å¦‚æŒ‰ç…§ URL è¿›è¡Œæˆæƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2020-05-14T03:15:47Z/18&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.api.v2.Cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;EDS&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;eds_cluster_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;eds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;ads&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;service_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;service_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080||reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;circuit_breakers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket_matches&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;tlsMode-istio&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;tlsMode&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.transport_sockets.tls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.api.v2.auth.UpstreamTlsContext&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;common_tls_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;alpn_protocols&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio-peer-exchange&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;istio&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_certificate_sds_secret_configs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;                                     &lt;span class=&#34;c1&#34;&gt;// é…ç½®ç”¨äºè®¿é—® reviews æœåŠ¡çš„å®¢æˆ·ç«¯è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;sds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_config_source&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GRPC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc_services&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy_grpc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sds-grpc&amp;#34;&lt;/span&gt;                        &lt;span class=&#34;c1&#34;&gt;// é…ç½®ç”¨äºè·å–å®¢æˆ·ç«¯è¯ä¹¦çš„ SDS æœåŠ¡å™¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;             &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;combined_validation_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;default_validation_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;verify_subject_alt_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;s2&#34;&gt;&amp;#34;spiffe://cluster.local/ns/default/sa/bookinfo-reviews&amp;#34;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// éªŒè¯æœåŠ¡å™¨è¯ä¹¦æ—¶éœ€è¦éªŒè¯ SAN ä¸­çš„ service account åç§°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;         &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;validation_context_sds_secret_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ROOTCA&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;                                     &lt;span class=&#34;c1&#34;&gt;// é…ç½®éªŒè¯ reviews æœåŠ¡å™¨è¯ä¹¦çš„ CA æ ¹è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;sds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_config_source&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GRPC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc_services&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;nt&#34;&gt;&amp;#34;envoy_grpc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sds-grpc&amp;#34;&lt;/span&gt;                       &lt;span class=&#34;c1&#34;&gt;// é…ç½®ç”¨äºè·å– CA æ ¹è¯ä¹¦çš„ SDS æœåŠ¡å™¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;             &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;sni&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound_.9080_._.reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2020-05-14T03:16:33.061Z&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢é…ç½®ä¸­ SAN ä¸­çš„ service account åç§°æ¥è‡ªäº reviews pod ä¸­çš„ service account é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo-reviews                             // è®¾ç½® reviews pod çš„ service account&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;reviews&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker.io/istio/examples-bookinfo-reviews-v1:1.15.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;LOG_DIR&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/tmp/logs&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨å¯¼å‡ºçš„é…ç½®ä¸­å¯ä»¥çœ‹åˆ° Envoy é€šè¿‡ SDS æœåŠ¡å™¨è·å–åˆ°çš„è¯ä¹¦ï¼ˆä¸ºäº†ç®€ç•¥èµ·è§ï¼Œçœç•¥äº†è¯ä¹¦ä¸­é—´çš„éƒ¨åˆ†å†…å®¹ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.admin.v3.SecretsConfigDump&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;dynamic_active_secrets&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;05-14 03:16:30.900&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2020-05-14T03:16:31.125Z&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;secret&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.Secret&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_certificate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;certificate_chain&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;inline_bytes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;LS0tLS1CRUdJTiBDRVJUSUZJQ0FUXXXXXXXXXXXXXXUZJQ0FURS0tLS0tCg==&amp;#34;&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// details æœåŠ¡çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦è¢«åŒæ—¶ç”¨ä½œäº†æœåŠ¡å™¨è¯ä¹¦å’Œå®¢æˆ·ç«¯è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;private_key&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;inline_bytes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;W3JlZGFjdGVkXQ==&amp;#34;&lt;/span&gt;                                                        &lt;span class=&#34;c1&#34;&gt;// detatils æœåŠ¡è¯ä¹¦å¯¹åº”çš„ç§é’¥
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ROOTCA&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2020-05-14 03:16:31.300416193 +0000 UTC m=+1.537483882&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;last_updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2020-05-14T03:16:31.343Z&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;secret&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.Secret&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ROOTCA&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;validation_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;trusted_ca&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;inline_bytes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;LS0tLS1CRUdJTiBDRVJUSUZJQ0XXXXXXXXXXXXXXXXXXXXJQ0FURS0tLS0tCg==&amp;#34;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// ç”¨äºéªŒè¯é€šä¿¡å¯¹æ–¹è¯ä¹¦çš„ CA æ ¹è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡ä¸Šé¢çš„é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶éœ€è¦åœ¨ Enovy sidecar é…ç½®æ–‡ä»¶ä¸­ä¸åŒçš„ä½ç½®ä¸º Envoy é…ç½®æœåŠ¡å™¨ã€å®¢æˆ·ç«¯è¯ä¹¦ä»¥åŠéªŒè¯å¯¹æ–¹çš„ CA æ ¹è¯ä¹¦ï¼Œä½† Istio ä¸­å®é™…ä¸Šåªé‡‡ç”¨äº†ä¸€ä¸ªæœåŠ¡è¯ä¹¦å’Œ CA æ ¹è¯ä¹¦ã€‚Istio å°†åç§°ä¸º default çš„è¯ä¹¦è¢«åŒæ—¶ç”¨äº Inbound Listener çš„æœåŠ¡å™¨è¯ä¹¦å’Œ Outbound Cluster çš„å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå¹¶å°†åç§°ä¸º ROOTCA çš„è¯ä¹¦è¢«ç”¨äºéªŒè¯ä¸‹æ¸¸å®¢æˆ·ç«¯è¯ä¹¦å’Œä¸Šæ¸¸æœåŠ¡å™¨è¯ä¹¦çš„æ ¹è¯ä¹¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;gateway-è¯ä¹¦é…ç½®&#34;&gt;Gateway è¯ä¹¦é…ç½®&lt;/h2&gt;
&lt;p&gt;é™¤äº†éœ€è¦å’Œç½‘æ ¼å†…éƒ¨çš„æœåŠ¡è¿›è¡Œé€šä¿¡ä¹‹å¤–ï¼ŒIngress Gateway å’Œ Egress Gateway è¿˜éœ€è¦è¿æ¥åˆ°ç½‘æ ¼å¤–éƒ¨çš„ç³»ç»Ÿã€‚å¦‚æœè¿™äº›å¤–éƒ¨è¿æ¥ä¹Ÿéœ€è¦é‡‡ç”¨ TLSï¼Œåˆ™ Gateway ä¸­ä¹Ÿè¦é…ç½®è¿™äº›å¤–éƒ¨ç³»ç»Ÿçš„ç›¸å…³è¯ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;Ingress Gateway ä¸­éœ€è¦å¦‚ä¸‹è¯ä¹¦ç›¸å…³çš„é…ç½®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½œä¸ºå®¢æˆ·ç«¯å’Œç½‘æ ¼å†…éƒ¨å…¶ä»–æœåŠ¡è¿›è¡Œé€šä¿¡çš„å®¢æˆ·ç«¯è¯ä¹¦å’Œç§é’¥ï¼Œå’Œå…¶ä»–æœåŠ¡ä½¿ç”¨çš„è¯ä¹¦ç±»ä¼¼ï¼Œè¯¥è¯ä¹¦ä¹Ÿæ˜¯ç”± Istio CA é¢å‘çš„ã€‚&lt;/li&gt;
&lt;li&gt;éªŒè¯ç½‘æ ¼å†…å…¶ä»–æœåŠ¡è¯ä¹¦çš„ CA æ ¹è¯ä¹¦ï¼Œè¯¥æ ¹è¯ä¹¦æ˜¯ Istio CA çš„æ ¹è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;ä½œä¸ºç½‘å…³å‘ç½‘æ ¼å¤–éƒ¨æä¾›æœåŠ¡ä½¿ç”¨çš„æœåŠ¡å™¨ç«¯è¯ä¹¦å’Œç§é’¥ï¼Œè¯¥è¯ä¹¦ä¸€èˆ¬æ˜¯ç”±ä¸€ä¸ªæƒå¨ CA æˆ–è€…ç¬¬ä¸‰æ–¹ CA ç­¾å‘çš„ã€‚å¦‚æœæœ‰å¤šä¸ª hostï¼Œéœ€è¦ä¸ºæ¯ä¸€ä¸ª host åˆ†åˆ«é…ç½®é…ç½®ä¸åŒçš„è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå¯¹å¤–æä¾›çš„æœåŠ¡éœ€è¦åŒå‘ TLS è®¤è¯ï¼Œè¿˜éœ€è¦é…ç½®ç”¨äºéªŒè¯å®¢æˆ·ç«¯è¯ä¹¦çš„ CA æ ¹è¯ä¹¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Egress Gateway ä¸­éœ€è¦å¦‚ä¸‹è¯ä¹¦ç›¸å…³çš„é…ç½®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½œä¸ºæœåŠ¡å™¨æ¥å—ç½‘æ ¼å†…éƒ¨å…¶ä»–æœåŠ¡è®¿é—®çš„æœåŠ¡å™¨è¯ä¹¦å’Œç§é’¥ï¼Œå’Œå…¶ä»–æœåŠ¡ä½¿ç”¨çš„è¯ä¹¦ç±»ä¼¼ï¼Œè¯¥è¯ä¹¦ä¹Ÿæ˜¯ç”± Istio CA é¢å‘çš„ã€‚&lt;/li&gt;
&lt;li&gt;éªŒè¯ç½‘æ ¼å†…å…¶ä»–æœåŠ¡è¯ä¹¦çš„ CA æ ¹è¯ä¹¦ï¼Œè¯¥æ ¹è¯ä¹¦æ˜¯ Istio CA çš„æ ¹è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;ä½œä¸ºå‡ºå£ç½‘å…³è®¿é—®å¤–éƒ¨æœåŠ¡æ—¶ï¼Œå¦‚æœè¯¥å¤–éƒ¨æœåŠ¡é‡‡ç”¨äº† TLSï¼Œåˆ™éœ€è¦é…ç½®ä¸€ä¸ªéªŒè¯è¯¥æœåŠ¡å™¨è¯ä¹¦çš„ CA æ ¹è¯ä¹¦æ¥éªŒè¯è¯¥æœåŠ¡å™¨ã€‚è¯¥æ ¹è¯ä¹¦ä¸€èˆ¬æ˜¯ä¸€ä¸ªæƒå¨ CA æˆ–è€…ç¬¬ä¸‰æ–¹ CAã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœè®¿é—®çš„å¤–éƒ¨æœåŠ¡è¦æ±‚åŒå‘ TLS è®¤è¯ï¼Œåˆ™è¿˜éœ€è¦ç½‘å…³é…ç½®ä¸€ä¸ªè¯¥å¤–éƒ¨æœåŠ¡è®¤å¯çš„å®¢æˆ·ç«¯è¯ä¹¦ã€‚è¯¥è¯ä¹¦ä¸€èˆ¬æ˜¯ç”±ä¸€ä¸ªæƒå¨ CA æˆ–è€…ç¬¬ä¸‰æ–¹ CA ç­¾å‘çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±äº Gateway ä¸­é…ç½®çš„å’Œå¤–éƒ¨ç³»ç»Ÿç›¸å…³çš„è¯ä¹¦ä¸æ˜¯é€šè¿‡ SDS ä» Istio CA è·å–çš„ï¼Œè€Œæ˜¯é‡‡ç”¨ç¬¬ä¸‰æ–¹ CA é¢å‘çš„ï¼Œå› æ­¤åˆ°æœŸåå¹¶ä¸èƒ½è‡ªåŠ¨æ›´æ–°ï¼Œè€Œéœ€è¦æ‰‹åŠ¨è¿›è¡Œæ›´æ–°ã€‚å› æ­¤éœ€è¦æ³¨æ„è¿™äº›è¯ä¹¦çš„æœ‰æ•ˆæœŸï¼Œåœ¨è¯ä¹¦è¿‡æœŸå‰åŠæ—¶é‡æ–°ç”³è¯·è¯ä¹¦å¹¶æ›´æ–°åˆ° Gateway é…ç½®ä¸­ï¼Œä»¥é¿å…å½±å“ä¸šåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Gateway ä¸Šé…ç½®ç¬¬ä¸‰æ–¹è¯ä¹¦çš„æ–¹æ³•æ˜¯é‡‡ç”¨ Kubernetes Secret å’Œ Istio Gateway CRDã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸‹é¢çš„æ­¥éª¤åœ¨ Ingress Gateway ä¸Šé…ç½®å¯¹å¤–æä¾›æœåŠ¡ä½¿ç”¨çš„æœåŠ¡å™¨è¯ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆåˆ›å»ºä¸€ä¸ª secretï¼Œè¯¥ secret ä¸­åŒ…å«äº†æœåŠ¡å™¨è¯ä¹¦å’Œç§é’¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create -n istio-system secret tls bookinfo-credential --key&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;bookinfo.example.com.key --cert&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;bookinfo.example.com.crt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åé€šè¿‡ Gateway CRD å®šä¹‰ä¸€ä¸ªå¯¹å¤–æä¾›æœåŠ¡çš„è™šæ‹Ÿä¸»æœºï¼Œå¹¶æŒ‡å®šä½¿ç”¨åˆšæ‰å®šä¹‰çš„ secretã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mygateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SIMPLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;credentialName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin-credential&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# åœ¨æ­¤å¤„è®¾ç½®åŒ…å«äº†æœåŠ¡å™¨è¯ä¹¦å’Œç§é’¥çš„ secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;bookinfo.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Istio å°†æ­¤é…ç½®é€šè¿‡ xDS æ¥å£ä¸‹å‘åˆ° Ingress Gateway Pod ä¸­çš„ Envoy ä¸Šï¼Œå¯ä»¥åœ¨è¯¥ Envoy çš„é…ç½®å¯¼å‡ºä¸­çœ‹åˆ° Ingress ç½‘å…³å¯¹å¤–æä¾›çš„ 443 ç«¯å£ä¸Šçš„è¯ä¹¦é…ç½®ï¼ˆé…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£æ˜¯ 8443ï¼Œè¿™æ˜¯å› ä¸º Pod å†…ä½¿ç”¨äº† 8443 ç«¯å£ï¼Œä½†å¯¹å¤–æš´éœ²çš„ LoadBalancer ä¸Šçš„ç«¯å£æ˜¯ 443ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0_8443&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;active_state&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;version_info&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2020-05-27T07:43:51Z/21&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.api.v2.Listener&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0_8443&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;socket_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;port_value&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;8443&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_chains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_chain_match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;server_names&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;bookinfo.example.com&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;transport_socket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.transport_sockets.tls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;typed_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.api.v2.auth.DownstreamTlsContext&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;common_tls_context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;alpn_protocols&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;s2&#34;&gt;&amp;#34;h2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;s2&#34;&gt;&amp;#34;http/1.1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;tls_certificate_sds_secret_configs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;bookinfo-credential&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;                            &lt;span class=&#34;c1&#34;&gt;// Ingress Gateway ä¸­é…ç½®çš„ Kubernetes secret
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;sds_config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_config_source&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;nt&#34;&gt;&amp;#34;api_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GRPC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc_services&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;nt&#34;&gt;&amp;#34;google_grpc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;target_uri&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;unix:/var/run/ingress_gateway/sds&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// ä»æœ¬åœ° unix domain socket ä¸Šçš„ SDS æœåŠ¡å™¨è·å–æœåŠ¡å™¨è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;stat_prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sdsstat&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;require_client_certificate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»é…ç½®ä¸­å¯ä»¥çœ‹å‡ºï¼ŒIngress Gateway ä½¿ç”¨çš„æœåŠ¡å™¨è¯ä¹¦ä¹Ÿæ˜¯é€šè¿‡ SDS æœåŠ¡è·å–çš„ã€‚Pilot-agent åœ¨è·¯å¾„&lt;code&gt;unix:/var/run/ingress_gateway/sds&lt;/code&gt; ä¸Šä¸º Ingress Gateway æä¾›äº†ä¸€ä¸ªåŸºäº unix domain socket çš„ SDS æœåŠ¡ã€‚Ingress Gateway ä¸­çš„ Envoy å‘è¯¥ SDS æœåŠ¡å™¨è¯·æ±‚ä¸Šè¿°é…ç½®æ–‡ä»¶ä¸­çš„ secretï¼ŒPilot-agent ä» Kubernetes ä¸­æŸ¥åˆ°è¯¥ åŒå secretï¼Œç„¶åè½¬æ¢ä¸º SDS æ¶ˆæ¯è¿”å›ç»™ Envoyã€‚&lt;/p&gt;
&lt;p&gt;å¤‡æ³¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Ingress Gateway ç”¨äºå’Œç½‘æ ¼å†…å…¶ä»–æœåŠ¡é€šä¿¡çš„æœåŠ¡èº«ä»½è¯ä¹¦è¿˜æ˜¯ç”± Istio CA é¢å‘çš„ï¼Œå…¶è¯ä¹¦è·å–çš„æµç¨‹åŒå›¾ 2ã€‚&lt;/li&gt;
&lt;li&gt;Egress Gateway æœªä½¿ç”¨ SDS è·å–ç”¨äºè®¿é—®å¤–éƒ¨æœåŠ¡çš„å®¢æˆ·ç«¯è¯ä¹¦ï¼ˆ1.6 ç°çŠ¶ï¼Œåç»­ä¹Ÿè®¸ä¼šä¿®æ”¹ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34;
           src=&#34;https://cloudnativecn.com/blog/istio-certificate/ingress-gateway-ca-sds.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

å›¾ 4. Ingress Gateway è¯ä¹¦è·å–æµç¨‹&lt;/p&gt;
&lt;h2 id=&#34;æ•°æ®é¢ä½¿ç”¨çš„æ‰€æœ‰è¯ä¹¦&#34;&gt;æ•°æ®é¢ä½¿ç”¨çš„æ‰€æœ‰è¯ä¹¦&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾ä¸­ä»¥ bookinfo æ¥ä¸¾ä¾‹è¯´æ˜ Istio åœ¨æ•°æ®é¢ä½¿ç”¨åˆ°çš„æ‰€æœ‰è¯ä¹¦ã€‚ä¸ºäº†æ–¹ä¾¿è¯´æ˜ Gateway çš„è¯ä¹¦é…ç½®ï¼Œæˆ‘ä»¬å‡è®¾åœ¨ Ingress Gateway ä¸Šä»¥ bookinfo.example.com çš„ä¸»æœºåå¯¹å¤–æä¾›æœåŠ¡ï¼Œå¹¶ä¸” ratings æœåŠ¡é€šè¿‡ Egress Gateway è®¿é—®äº†ä¸€ä¸ªç½‘æ ¼å¤–éƒ¨çš„ç¬¬ä¸‰æ–¹ TLS æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;å›¾ä¸­ä¸åŒé¢œè‰²è¾¹æ¡†çš„å›¾æ ‡ä»£è¡¨äº†ä¸åŒçš„è¯ä¹¦ã€‚è¯¥ç¤ºä¾‹ä¸­ä¸€å…±ä½¿ç”¨äº†ä¸ƒä¸ªä¸åŒçš„è¯ä¹¦ï¼Œåˆ†åˆ«ä¸º 3 ä¸ªæœåŠ¡çš„è¯ä¹¦ï¼ˆåŒæ—¶ç”¨ä½œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¯ä¹¦ï¼‰ï¼ŒIngress Gateway è‡ªèº«çš„å®¢æˆ·ç«¯è¯ä¹¦ï¼ŒIngress Gateway å¯¹å¤–éƒ¨æä¾›æœåŠ¡çš„æœåŠ¡å™¨è¯ä¹¦ï¼ŒEgress Gateway è‡ªèº«çš„æœåŠ¡å™¨è¯ä¹¦ï¼ŒEgress Gateway è®¿é—®å¤–éƒ¨æœåŠ¡ä½¿ç”¨çš„å®¢æˆ·ç«¯è¯ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº† Ingress Gateway å¯¹å¤–æä¾›æœåŠ¡çš„æœåŠ¡å™¨è¯ä¹¦å’Œ Egress Gateway è®¿é—®ç¬¬ä¸‰æ–¹æœåŠ¡çš„å®¢æˆ·ç«¯è¯ä¹¦ä¹‹å¤–ï¼Œå…¶ä»–è¯ä¹¦éƒ½æ˜¯ Envoy é€šè¿‡ SDS æœåŠ¡ä» Istio CA è·å–çš„ï¼Œå› æ­¤éƒ½ä½¿ç”¨ Istio Root CA è¯ä¹¦è¿›è¡ŒéªŒè¯ã€‚è¿™ä¸¤ä¸ªç¬¬ä¸‰æ–¹è¯ä¹¦åˆ™éœ€è¦é‡‡ç”¨ç¬¬ä¸‰æ–¹ CA æ ¹è¯ä¹¦è¿›è¡ŒéªŒè¯ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34;
           src=&#34;https://cloudnativecn.com/blog/istio-certificate/bookinfo-ca.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

å›¾ 5. Istio æ•°æ®é¢ä½¿ç”¨åˆ°çš„æ‰€æœ‰è¯ä¹¦&lt;/p&gt;
&lt;h2 id=&#34;å°ç»“&#34;&gt;å°ç»“&lt;/h2&gt;
&lt;p&gt;å¾®æœåŠ¡åº”ç”¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç½‘ç»œç¨‹åºï¼Œåœ¨å¾®æœåŠ¡åº”ç”¨å†…å­˜åœ¨å¤§é‡çš„æœåŠ¡é—´ç½‘ç»œé€šä¿¡ã€‚åœ¨äº‘åŒ–éƒ¨ç½²ç¯å¢ƒä¸­ï¼ŒæœåŠ¡é—´çš„èº«ä»½è®¤è¯å’Œå®‰å…¨é€šä¿¡æ˜¯å¾®æœåŠ¡é¢ä¸´çš„ä¸€å¤§æŒ‘æˆ˜ã€‚Istio å»ºç«‹äº†ä¸€å¥—ä»¥æ•°å­—è¯ä¹¦ä¸ºåŸºç¡€çš„æœåŠ¡è®¤è¯å®‰å…¨æ¡†æ¶ï¼Œåœ¨ä¸ä¿®æ”¹åº”ç”¨çš„å‰æä¸‹æä¾›äº†æœåŠ¡ä¹‹é—´çš„èº«ä»½è®¤è¯å’Œå®‰å…¨é€šä¿¡ï¼Œå¹¶ä»¥èº«ä»½è®¤è¯ä¸ºåŸºç¡€æä¾›äº†å¼ºå¤§çš„æˆæƒæœºåˆ¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒæ–‡æ¡£&#34;&gt;å‚è€ƒæ–‡æ¡£&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/docs/tasks/traffic-management/ingress/secure-ingress/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Secure Gateways&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/docs/tasks/traffic-management/egress/egress-gateway-tls-origination/#perform-tls-origination-with-an-egress-gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Egress Gateways with TLS Origination&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Istio åº–ä¸è§£ç‰›äº”ï¼šå¤šé›†ç¾¤ç½‘æ ¼å®ç°åˆ†æ</title>
      <link>https://cloudnativecn.com/blog/istio-analysis-5/</link>
      <pubDate>Tue, 30 Jul 2019 11:24:01 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-analysis-5/</guid>
      <description>&lt;h2 id=&#34;1å¤šé›†ç¾¤ç½‘æ ¼èƒŒæ™¯ä»‹ç»&#34;&gt;1.å¤šé›†ç¾¤ç½‘æ ¼èƒŒæ™¯ä»‹ç»&lt;/h2&gt;
&lt;p&gt;Istio å¹¶ä¸æ˜¯å•ä¸€é¢†åŸŸçš„æŠ€æœ¯ï¼Œå®ƒç»¼åˆäº†è¯¸å¤šæœåŠ¡æ²»ç†é¢†åŸŸçš„è§£å†³æ–¹æ¡ˆå’Œæœ€ä½³å®è·µã€‚åœ¨æ¨¡å‹ä¸Šï¼Œistio æä¾›äº†å¤šä¸ªå±‚æ¬¡çš„æŠ½è±¡ï¼Œä»¥é€‚é…ä¸åŒçš„å¹³å°åœºæ™¯; åœ¨å®é™…åº”ç”¨ä¸Šï¼Œistio æä¾›äº†è‹¥å¹²å¯é€‰çš„å¼€æºç³»ç»Ÿå’ŒæŠ€æœ¯ï¼Œå¹¶åˆç†çš„å°†è¿™äº›ç³»ç»Ÿç»„åˆåœ¨ä¸€èµ·ï¼Œä»¥å®ç°æœåŠ¡ç½‘æ ¼ä¸­çš„ã€Œè¿æ¥ã€ã€ã€Œå®‰å…¨ã€ã€ã€Œæ§åˆ¶ã€å’Œã€Œå¯è§‚æµ‹æ€§ã€ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20190729153848023&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2019-07-29-135253.png&#34; alt=&#34;image-20190729153848023&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20190729153848023
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ istio çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œå¼‚åœ°å¤šé›†ç¾¤ç½‘æ ¼æ˜¯å…¶ä¸­æœ€å¤æ‚çš„åœºæ™¯ä¹‹ä¸€ã€‚istio åœ¨ 1.1 åæä¾›äº†ä¸‰ç§å¤šé›†ç¾¤çš„è¿é€šæ‹“æ‰‘ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¤šæ§åˆ¶é¢&lt;/li&gt;
&lt;li&gt;å•ç½‘ç»œå•æ§åˆ¶é¢&lt;/li&gt;
&lt;li&gt;å¤šç½‘ç»œå•æ§åˆ¶é¢&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç¬¬ä¸€ç§ã€Œå¤šæ§åˆ¶é¢è¿é€šæ‹“æ‰‘ã€ï¼Œä¸¥æ ¼çš„è®²æ¯ä¸ª kubernetes é›†ç¾¤ä»ç„¶æ˜¯ç‹¬ç«‹çš„æœåŠ¡ç½‘æ ¼ï¼Œå„ç½‘æ ¼ä¹‹é—´æœåŠ¡å®ä¾‹æ— æ³•å…±äº«ï¼Œäº’ç›¸è®¿é—®ä¸é€æ˜ã€‚åº”ç”¨åœºæ™¯æœ‰é™ï¼Œå®ç°ç®€å•ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒç§ã€Œå•ç½‘ç»œå•æ§åˆ¶é¢æ‹“æ‰‘ã€ï¼Œå®ç°äº†å¤š kubernetes é›†ç¾¤èåˆä¸ºä¸€ä¸ªæœåŠ¡ç½‘æ ¼ï¼Œä½†æ˜¯è¯¥ç§æ‹“æ‰‘å¯¹ç½‘ç»œæœ‰ä¸¥æ ¼çš„è¦æ±‚ï¼šéœ€è¦æ‰€æœ‰é›†ç¾¤å¤„äºåŒä¸€ä¸ªæ‰å¹³ç½‘ç»œï¼Œpod ip äº’é€šä¸”ä¸é‡å ï¼Œä½¿ç”¨ VPN è¿é€šå¤šé›†ç¾¤ç½‘ç»œæ˜¯å¸¸è§çš„ä¸€ä¸ªé€‰é¡¹ã€‚ä¸è¿‡è¿™äº›ç½‘ç»œéœ€æ±‚åœ¨å®é™…ç¯å¢ƒå¯èƒ½éš¾ä»¥æ»¡è¶³ï¼Œä¹Ÿé™åˆ¶äº†è¯¥æ‹“æ‰‘çš„åº”ç”¨åœºæ™¯ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸‰ç§ã€Œå¤šç½‘ç»œå•æ§åˆ¶é¢ã€ï¼ŒåŒæ ·å®ç°äº†å¤š kubernetes é›†ç¾¤èåˆä¸ºä¸€ä¸ªæœåŠ¡ç½‘æ ¼ï¼Œä¸”åœ¨ç½‘ç»œä¸Šæ²¡æœ‰ä¸Šè¿°é™åˆ¶ï¼Œæ¯ä¸ªå¤š kubernetes é›†ç¾¤æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç½‘ç»œï¼Œç”šè‡³å¯ä»¥åˆ†å¸ƒäºä¸åŒåœ°åŸŸã€‚ä½†å…¶å®ç°ä¹Ÿæœ€å¤æ‚ï¼Œè¯¥æ‹“æ‰‘æ¨¡å‹å¯ä»¥å®ç°ã€Œåœ°åŸŸæ„ŸçŸ¥è·¯ç”±ã€ã€ã€Œå¼‚åœ°å®¹ç¾ã€ç­‰é«˜çº§åº”ç”¨åœºæ™¯ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°†å¯¹ç¬¬ä¸‰ç§ã€Œå¤šç½‘ç»œå•æ§åˆ¶é¢ã€çš„æ­å»ºå’Œè¿é€šè¿‡ç¨‹è¿›è¡Œåˆ†æï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-shared-istio-control-plane-topology-spanning-multiple-kubernetes-clusters-using-gateways&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://istio.io/docs/setup/kubernetes/install/multicluster/shared-gateways/diagram.svg&#34; alt=&#34;Shared Istio control plane topology spanning multiple Kubernetes clusters using gateways&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Shared Istio control plane topology spanning multiple Kubernetes clusters using gateways
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡çº¦å®šæœ¯è¯­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é›†ç¾¤ï¼šæŒ‡å•ä¸ª kubernetes é›†ç¾¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸»é›†ç¾¤ï¼šç‰¹æŒ‡åœ¨ã€Œå¤šç½‘ç»œå•æ§åˆ¶é¢ã€æ‹“æ‰‘ä¸­ï¼ŒåŒ…å«æ§åˆ¶é¢çš„ kubernetes é›†ç¾¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å­é›†ç¾¤ï¼šç‰¹æŒ‡åœ¨ã€Œå¤šç½‘ç»œå•æ§åˆ¶é¢ã€æ‹“æ‰‘ä¸­ï¼Œä¸åŒ…å«æ§åˆ¶é¢çš„ kubernetes é›†ç¾¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç½‘æ ¼ï¼šç‰¹æŒ‡åœ¨ã€Œå¤šç½‘ç»œå•æ§åˆ¶é¢ã€æ‹“æ‰‘ä¸­ï¼Œæ‰€æœ‰ kubernetes é›†ç¾¤ç»„æˆçš„å”¯ä¸€æœåŠ¡ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç½‘ç»œï¼šåœ¨ã€Œå¤šç½‘ç»œå•æ§åˆ¶é¢ã€æ‹“æ‰‘ä¸­ï¼Œæ¯ä¸ª kubernetes é›†ç¾¤éƒ½æœ‰ç‹¬ç«‹çš„ç½‘ç»œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨è¯¥æ‹“æ‰‘ä¸­ï¼Œåªæœ‰ä¸»é›†ç¾¤ä¸­å­˜åœ¨ä¸€ä¸ªæ§åˆ¶é¢ï¼Œæ‰€æœ‰é›†ç¾¤éƒ½å¯ä»¥åŒ…å«æ•°æ®é¢ï¼Œæ‰€æœ‰æ•°æ®é¢çš„æœåŠ¡å®ä¾‹å…±äº«ä¸”å¯ä»¥é€æ˜äº’é€šã€‚æˆ‘ä»¬å¯ä»¥ç®€å•æè¿°è¯¥æ‹“æ‰‘çš„è¿é€šéœ€æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»é›†ç¾¤æ§åˆ¶é¢éœ€è¦è·å¾—æ‰€æœ‰é›†ç¾¤çš„æœåŠ¡å‘ç°æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ§åˆ¶é¢éœ€è¦èƒ½è®¿é—®æ‰€æœ‰é›†ç¾¤çš„ kube apiã€‚&lt;/li&gt;
&lt;li&gt;å­é›†ç¾¤çš„æ•°æ®é¢éœ€è¦èƒ½ä¸»åŠ¨è”é€šä¸»é›†ç¾¤æ§åˆ¶é¢ï¼Œå› æ­¤ä¸»é›†ç¾¤éœ€è¦é€šè¿‡ ingress gatewayï¼Œå°†æ§åˆ¶é¢ç»„ä»¶æš´éœ²ç»™å­é›†ç¾¤ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰åŒ…å«æ•°æ®é¢çš„é›†ç¾¤ï¼Œéœ€è¦å°†å†…éƒ¨ä¸šåŠ¡æœåŠ¡ï¼Œé€šè¿‡ ingress gateway æš´éœ²å‡ºå»ï¼Œç”¨ä»¥å®ç°æ•´ä¸ªç½‘æ ¼çš„æœåŠ¡äº’é€šã€‚&lt;/li&gt;
&lt;li&gt;ä¸»é›†ç¾¤æ§åˆ¶é¢éœ€è¦çŸ¥æ‚‰æ•´ä¸ªç½‘æ ¼çš„ç½‘ç»œæ‹“æ‰‘ï¼Œæ¯ä¸ªæœåŠ¡å®ä¾‹ä¹Ÿéœ€è¦æ ‡è®°è‡ªèº«æ‰€å¤„ç½‘ç»œã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸ªå…·ä½“æœåŠ¡å®ä¾‹æ”¶åˆ°çš„ xDS æ•°æ®ï¼Œéƒ½æ˜¯å’Œè‡ªèº«æ‰€å¤„çš„ç½‘ç»œå¼ºç›¸å…³çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ–‡å°†å°è¯•åœ¨å¹¿å·å’Œæ–°åŠ å¡åœ°åŸŸå„è‡ªåˆ›å»ºä¸€ä¸ª kubernetes é›†ç¾¤ï¼Œåœ¨å¹¿å·é›†ç¾¤åˆ›å»º istio æ§åˆ¶é¢ï¼Œç„¶åå°† 2 ä¸ªé›†ç¾¤è¿›è¡Œè¿é€šï¼Œå®ç°ã€Œå¤šç½‘ç»œå•æ§åˆ¶é¢ã€çš„å¤šé›†ç¾¤æœåŠ¡ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸å…³ä»£ç æ±‡æ€»äºï¼š&lt;a href=&#34;https://github.com/zhongfox/multicluster-demo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/zhongfox/multicluster-demo&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;2-ä¸»é›†ç¾¤é…ç½®&#34;&gt;2. ä¸»é›†ç¾¤é…ç½®&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆåˆ†åˆ«åœ¨å¹¿å·å’Œæ–°åŠ å¡åœ°åŸŸåˆ›å»ºå¥½ kubernetes é›†ç¾¤ï¼Œå¹¶è·å¾— kube api è®¿é—®å‡­è¯å­˜äºæœ¬åœ°ï¼Œkube config context åˆ†åˆ«å‘½åä¸º guangzhou å’Œ singapore.&lt;/p&gt;
&lt;p&gt;åœ¨å¹¿å·é›†ç¾¤ä¸Šï¼Œå®‰è£…å¥½å•é›†ç¾¤ istio ç»„ä»¶ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20190729231121442&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2019-07-29-151144.png&#34; alt=&#34;image-20190729231121442&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20190729231121442
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;21-ä¸»é›†ç¾¤è®¿é—®å­é›†ç¾¤-kube-api&#34;&gt;2.1 ä¸»é›†ç¾¤è®¿é—®å­é›†ç¾¤ kube api&lt;/h3&gt;
&lt;p&gt;istio æ§åˆ¶é¢åªå­˜åœ¨äºå¹¿å·ä¸»é›†ç¾¤ä¸­ï¼Œæ§åˆ¶é¢éœ€è¦èƒ½è·å–åˆ°æ‰€æœ‰é›†ç¾¤çš„æœåŠ¡å‘ç°æ•°æ®ï¼Œå› æ­¤ä¸»é›†ç¾¤ä¸­éœ€è¦é…ç½®å­é›†ç¾¤çš„è®¿é—®å‡­è¯ï¼š&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ guangzhou kube context:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl config use-context guangzhou
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°† singapore é›†ç¾¤è®¿é—®å‡­è¯å­˜åˆ° guangzhou é›†ç¾¤çš„ secret ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl --context=guangzhou -n istio-system create secret \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  generic singapore-secret --from-file singapore
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŒæ—¶éœ€è¦ç»™è¯¥ secret è®¾ç½® label &lt;code&gt;istio/multiCluster=true&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label --context=guangzhou secret singapore-secret istio/multiCluster=true -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ Pilot æºç ä¸­ï¼Œä¼šåˆ›å»º SecretController æ¥ list/watch lable &lt;code&gt;istio/multiCluster=true&lt;/code&gt; çš„ secretï¼Œå¹¶å®ä¾‹åŒ– remoteKubeControllerï¼Œä½œä¸ºç½‘æ ¼æœåŠ¡å‘ç°æ•°æ®çš„æ¥æºä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20190729172916130&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2019-07-29-135224.png&#34; alt=&#34;image-20190729172916130&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20190729172916130
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;22-å°†æ§åˆ¶é¢ç»„ä»¶æš´éœ²ç»™å­é›†ç¾¤ä½¿ç”¨&#34;&gt;2.2 å°†æ§åˆ¶é¢ç»„ä»¶æš´éœ²ç»™å­é›†ç¾¤ä½¿ç”¨&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸»é›†ç¾¤ä¸­åˆ›å»º ingress gateway &lt;code&gt;meshexpansion-gateway&lt;/code&gt; å°† Pilotï¼ŒMixer å’Œ citadel æš´éœ²ç»™å­é›†ç¾¤ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;meshexpansion-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;15011&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp-pilot&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8060&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp-citadel&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;15004&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tls-mixer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TLS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AUTO_PASSTHROUGH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥ gateway è¦ç”Ÿæ•ˆï¼Œè¿˜éœ€è¦é…ç½®ç›¸å…³çš„ VirtualService:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»º VirtualService &lt;code&gt;meshexpansion-vs-pilot&lt;/code&gt;ï¼Œå°†ä¸»é›†ç¾¤ Pilot é€šè¿‡ gateway æš´éœ²ç»™å­é›†ç¾¤ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»º VirtualService &lt;code&gt;meshexpansion-vs-citadel&lt;/code&gt;ï¼Œå°†ä¸»é›†ç¾¤ Citadel é€šè¿‡ gateway æš´éœ²ç»™å­é›†ç¾¤ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¸Šé…ç½®åœ¨&lt;a href=&#34;https://github.com/zhongfox/multicluster-demo/blob/master/install/primarycluster-meshexpansion-gateway.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;install/primarycluster-meshexpansion-gateway.yaml&lt;/a&gt;ä¸­ï¼Œç­‰åŒäºæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl apply -f install/primarycluster-meshexpansion-gateway.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šæ­¥éª¤é…ç½®å®Œæ¯•åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†ç½‘æ ¼ä¸­å¯¹ Pilotï¼ŒMixer çš„è®¿é—®è°ƒæ•´ä¸ºä»¥ä¸Šç«¯å£ï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç½‘æ ¼å…¨å±€é…ç½®ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl -nistio-system edit cm istio
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;......
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;defaultConfig:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  discoveryAddress: istio-pilot.istio-system:15011
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;......
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mixerCheckServer: istio-policy.istio-system.svc.cluster.local:15004
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mixerReportServer: istio-telemetry.istio-system.svc.cluster.local:15004
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;æ§åˆ¶é¢ä¸­ &lt;code&gt;istio-ingressgateway&lt;/code&gt; &lt;code&gt;istio-egressgateway&lt;/code&gt;çš„å¯åŠ¨å‚æ•°ï¼Œä¿®æ”¹å¯¹ pilot çš„è®¿é—®åœ°å€ï¼Œä» 15010(HTTP ç«¯å£) æ”¹ä¸º 15011(mTLS ç«¯å£):&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- --discoveryAddress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- istio-pilot:15011
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  id=&#34;figure-image-20190729173048701&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2019-07-29-135216.png&#34; alt=&#34;image-20190729173048701&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20190729173048701
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;23-æ•°æ®é¢åˆ›å»º-ingress-gateway&#34;&gt;2.3 æ•°æ®é¢åˆ›å»º ingress gateway&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ªåŒ…å«æ•°æ®é¢çš„é›†ç¾¤ï¼Œéƒ½éœ€è¦æä¾› ingress gatewayï¼Œä½¿å¾—å…¶ä»–é›†ç¾¤æ•°æ®é¢å¯ä»¥è®¿é—®æœ¬é›†ç¾¤æ•°æ®é¢æœåŠ¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cluster-aware-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TLS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AUTO_PASSTHROUGH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šé…ç½®åœ¨&lt;a href=&#34;https://github.com/zhongfox/multicluster-demo/blob/master/install/primarycluster-cluster-aware-gateway.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;install/primarycluster-cluster-aware-gateway.yaml&lt;/a&gt;ä¸­ï¼Œç­‰åŒäºæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl apply -f install/primarycluster-cluster-aware-gateway.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  id=&#34;figure-image-20190729173523592&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2019-07-29-135209.png&#34; alt=&#34;image-20190729173523592&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20190729173523592
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;å…³äº-mtls-å’Œ-auto_passthrough&#34;&gt;å…³äº mTLS å’Œ AUTO_PASSTHROUGH&lt;/h4&gt;
&lt;p&gt;é€šå¸¸æ¥è¯´ï¼Œistio Ingress Gateway éœ€è¦é…å¥—æŒ‡å®šæœåŠ¡çš„ VirtualServiceï¼Œç”¨ä»¥æŒ‡å®š ingress æµé‡çš„åç«¯æœåŠ¡ã€‚ä½†åœ¨æ­¤æ‹“æ‰‘ä¸­ï¼Œè¯¥ ingress Gateway éœ€è¦ä½œä¸ºæœ¬æ•°æ®é¢æ‰€æœ‰æœåŠ¡çš„æµé‡å…¥å£ã€‚ä¹Ÿå°±æ˜¯æ‰€æœ‰æœåŠ¡å…±äº«å•ä¸ª ingress gateway (å•ä¸ª IP)ï¼Œè¿™é‡Œå…¶å®æ˜¯åˆ©ç”¨äº† TLS ä¸­çš„ &lt;a href=&#34;https://en.wikipedia.org/wiki/Server_Name_Indication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SNI(Server Name Indication)&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;SNI(Server Name Indication) æŒ‡å®šäº† TLS æ¡æ‰‹æ—¶è¦è¿æ¥çš„ ä¸»æœºåã€‚SNI åè®®æ˜¯ä¸ºäº†æ”¯æŒåŒä¸€ä¸ª IP(å’Œç«¯å£) æ”¯æŒå¤šä¸ªåŸŸå&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ä¼ ç»Ÿçš„ Ingress Gateway æ‰¿è½½çš„æ˜¯å—åŒ—æµé‡ (server-client)ï¼Œè¿™é‡Œçš„ Ingress Gateway å±äºç½‘æ ¼å†…éƒ¨æµé‡ï¼Œæ‰¿è½½çš„æ˜¯ä¸œè¥¿æµé‡ (server-server).&lt;/p&gt;
&lt;p&gt;è®¾ç½®&lt;code&gt;AUTO_PASSTHROUGH&lt;/code&gt;ï¼Œå¯ä»¥å…è®¸æœåŠ¡æ— éœ€é…ç½® VirtualServiceï¼Œè€Œç›´æ¥ä½¿ç”¨ TLS ä¸­çš„ SNI å€¼æ¥è¡¨ç¤º upstreamï¼ŒæœåŠ¡ç›¸å…³çš„ service/subset/port éƒ½å¯ä»¥ç¼–ç åˆ° SNI å†…å®¹ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹çœ‹ä»¥ä¸Šçš„ Gateway &lt;code&gt;cluster-aware-gateway&lt;/code&gt; 443 ç«¯å£å¼€å¯&lt;code&gt;AUTO_PASSTHROUGH&lt;/code&gt; åçš„ xDS æ•ˆæœï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20190730103626893&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2019-07-30-023631.png&#34; alt=&#34;image-20190730103626893&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20190730103626893
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ Listener Filter &lt;code&gt;envoy.listener.tls_inspector&lt;/code&gt; ä¼šæ£€æµ‹ä¼ è¾“æ˜¯å¦æ˜¯ TLSï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œä¼šè¿›ä¸€æ­¥æå– SNI (æˆ–è€… ALPN)ï¼ŒSNI ä¿¡æ¯åœ¨åç»­ FilterChain ä¸­å¯ä»¥ç”¨æ¥è·¯ç”±ã€‚&lt;/p&gt;
&lt;p&gt;Network Filter &lt;code&gt;envoy.filters.network.sni_cluster&lt;/code&gt; ä¼šåˆ©ç”¨ SNI ä¿¡æ¯æ¥åˆ¤æ–­ upstream clusterï¼Œè¯¥ filter ä¸ä¼šå½±å“é TLS çš„è¿æ¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;24-æ§åˆ¶é¢-mtls-è®¤è¯&#34;&gt;2.4 æ§åˆ¶é¢ mTLS è®¤è¯&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;æ§åˆ¶é¢ç»„ä»¶&lt;code&gt;citadel&lt;/code&gt;è´Ÿè´£ç®¡ç†ç½‘æ ¼å†…çš„è¯ä¹¦ï¼Œæˆ‘ä»¬éœ€è¦ç»™ citadel æä¾› ca è¯ä¹¦ã€ç§˜é’¥å’Œæ ¹è¯ä¹¦ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl -n istio-system create secret generic cacerts \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --from-file=certs/ca-cert.pem --from-file=certs/ca-key.pem \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --from-file=certs/root-cert.pem --from-file=certs/cert-chain.pem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;åˆ›å»ºå¥½ secret åï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æŒ‚è½½åˆ° citadel pod ä¸­ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cacerts&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/etc/cacerts&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;......&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cacerts&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cacerts&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;optional&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;å¹¶å°†å…¶ä¼ å…¥ citadel å¯åŠ¨å‚æ•°ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- --self-signed-ca=false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- --signing-cert=/etc/cacerts/ca-cert.pem
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- --signing-key=/etc/cacerts/ca-key.pem
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- --root-cert=/etc/cacerts/root-cert.pem
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- --cert-chain=/etc/cacerts/cert-chain.pem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;æ›´æ–°ç½‘æ ¼å…¨å±€é…ç½®ï¼Œè®¾ç½®&lt;code&gt;controlPlaneAuthPolicy&lt;/code&gt;ä¸º&lt;code&gt;MUTUAL_TLS&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl -nistio-system edit cm istio
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;......
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;defaultConfig:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  controlPlaneAuthPolicy: MUTUAL_TLS
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;æ§åˆ¶é¢ç»„ä»¶ istio-pilotã€istio-telemetryã€istio-policy çš„ sidecarï¼Œä»¥åŠ istio-ingressgatewayï¼Œistio-egressgateway å¢åŠ å¯åŠ¨å‚æ•°ä»¥æ”¯æŒæ§åˆ¶é¢ mTLS è®¤è¯ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- --controlPlaneAuthPolicy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- MUTUAL_TLS
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;å…³äº-controlplaneauth&#34;&gt;å…³äº ControlPlaneAuth&lt;/h4&gt;
&lt;p&gt;æ§åˆ¶é¢ç»„ä»¶å¼€å¯&lt;code&gt;MUTUAL_TLS&lt;/code&gt;ï¼Œæœ€ç»ˆä¼šä½“ç°åˆ°æ§åˆ¶é¢ç»„ä»¶ (telemetry/policy/pilot) çš„ envoy xDS ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;tls_context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;common_tls_context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;alpn_protocols&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;h2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls_certificates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;certificate_chain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/etc/certs/cert-chain.pem&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;private_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/etc/certs/key.pem&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;validation_context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trusted_ca&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/etc/certs/root-cert.pem&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;require_client_certificate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  id=&#34;figure-image-20190729173651673&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2019-07-29-135204.png&#34; alt=&#34;image-20190729173651673&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20190729173651673
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;24-å¼€å¯æœåŠ¡é—´-mtls-è®¤è¯&#34;&gt;2.4 å¼€å¯æœåŠ¡é—´ mTLS è®¤è¯&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ istio CRD &lt;code&gt;MeshPolicy&lt;/code&gt;å¼€å¯ç½‘æ ¼å…¨å±€ mTLS:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;authentication.istio.io/v1alpha1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;MeshPolicy&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;security&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;chart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;security&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;heritage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Tiller&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;peers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;mtls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šé…ç½®ä¼šå¼€å¯ç½‘æ ¼å†…æµé‡çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ TLS è®¤è¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®¢æˆ·ç«¯ TLS è®¤è¯ä¼šè¢«å…³è”çš„ DestinationRule é‡Œçš„&lt;code&gt;tls&lt;/code&gt;å±æ€§è¦†ç›–ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨äº† DestinationRuleï¼Œéœ€è¦åœ¨ DestinationRule ä¸­æ˜¾ç¤ºæŒ‡å®šå¼€å¯ mTLS:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ISTIO_MUTUAL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦å¤–åœ¨å…¨å±€ mtls è®¤è¯ä¼šæœ‰äº›ä¾‹å¤–ï¼šæ¯”å¦‚ k8s api server æ²¡æœ‰ sidecarï¼Œæ‰€ä»¥å®¢æˆ·ç«¯è®¿é—® api server éœ€è¦ç¦ç”¨ mtls:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;api-server&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;security&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;kubernetes.default.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DISABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šé…ç½®åœ¨&lt;a href=&#34;https://github.com/zhongfox/multicluster-demo/blob/master/install/primarycluster-services-mtls.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;install/primarycluster-services-mtls.yaml&lt;/a&gt;ä¸­ï¼Œç­‰åŒäºæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl apply -f install/primarycluster-services-mtls.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  id=&#34;figure-image-20190729173735897&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2019-07-29-135158.png&#34; alt=&#34;image-20190729173735897&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20190729173735897
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;3-å­é›†ç¾¤é…ç½®&#34;&gt;3. å­é›†ç¾¤é…ç½®&lt;/h2&gt;
&lt;h3 id=&#34;31-éƒ¨ç½²å­é›†ç¾¤-istio-é…ç½®&#34;&gt;3.1 éƒ¨ç½²å­é›†ç¾¤ istio é…ç½®&lt;/h3&gt;
&lt;p&gt;è·å–ä¸»é›†ç¾¤æ§åˆ¶é¢çš„ gateway åœ°å€ï¼Œä½œä¸ºå­é›†ç¾¤è®¿é—®æ§åˆ¶é¢çš„å…¥å£åœ°å€ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;export CONTROL_PANEL_GW=$(kubectl --context guangzhou -n istio-system get service istio-ingressgateway -o jsonpath=&amp;#39;{.status.loadBalancer.ingress[0].ip}&amp;#39;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‚è€ƒ&lt;a href=&#34;https://istio.io/docs/setup/kubernetes/install/multicluster/shared-gateways/#setup-cluster-2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/docs/setup/kubernetes/install/multicluster/shared-gateways/#setup-cluster-2&lt;/a&gt;ï¼Œå®‰è£…å­é›†ç¾¤ istio é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% helm template --name istio-remote --namespace=istio-system \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --values install/kubernetes/helm/istio/values-istio-remote.yaml \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --set global.mtls.enabled=true \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --set gateways.enabled=true \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --set security.selfSigned=false \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --set global.controlPlaneSecurityEnabled=true \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --set global.createRemoteSvcEndpoints=true \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --set global.remotePilotCreateSvcEndpoint=true \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --set global.remotePilotAddress=${CONTROL_PANEL_GW} \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --set global.remotePolicyAddress=${CONTROL_PANEL_GW} \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --set global.remoteTelemetryAddress=${CONTROL_PANEL_GW} \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --set gateways.istio-ingressgateway.env.ISTIO_META_NETWORK=&amp;#34;network2&amp;#34; \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --set global.network=&amp;#34;network2&amp;#34; \
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  install/kubernetes/helm/istio &amp;gt; istio-remote.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥æ–‡ä»¶å†…å®¹è¾ƒå¤šï¼Œè¾“å‡ºå†…å®¹å¯ä»¥å‚è€ƒ&lt;a href=&#34;https://github.com/zhongfox/multicluster-demo/blob/master/install/istio-remote-1.1.11.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/zhongfox/multicluster-demo/blob/master/install/istio-remote-1.1.11.yaml&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å°†è¾“å‡ºå†…å®¹éƒ¨ç½²åˆ°æ–°åŠ å¡é›†ç¾¤ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl config use-context singapore
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl create ns istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl apply -f istio-remote.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å­é›†ç¾¤åŒæ ·éœ€è¦åˆ›å»º mTLS è®¤è¯æ‰€éœ€çš„ secret:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl create secret generic cacerts -n istio-system --from-file=certs/ca-cert.pem --from-file=certs/ca-key.pem --from-file=certs/root-cert.pem --from-file=certs/cert-chain.pem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;32-å­é›†ç¾¤é…ç½®è§£è¯»&#34;&gt;3.2 å­é›†ç¾¤é…ç½®è§£è¯»&lt;/h3&gt;
&lt;p&gt;å­é›†ç¾¤ä¸­å¹¶æ²¡æœ‰å®‰è£… istio æ§åˆ¶é¢ç»„ä»¶ï¼Œä¹Ÿä¸å­˜åœ¨ä»»ä½• istio CRDï¼Œä»¥ä¸Šæ“ä½œåœ¨å­é›†ç¾¤ä¸­åˆ›å»ºäº†è‹¥å¹² kubernetes åŸç”Ÿèµ„æºï¼Œç”¨ä»¥å®ç°å­é›†ç¾¤å’Œä¸»é›†ç¾¤çš„è¿é€šï¼Œæˆ‘ä»¬çœ‹çœ‹å…¶ä¸­çš„ä¸€äº›é‡è¦é…ç½®ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20190729161910641&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2019-07-29-135151.png&#34; alt=&#34;image-20190729161910641&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20190729161910641
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æ–°åŠ å¡é›†ç¾¤ä¸­ï¼Œå¹¶æ²¡æœ‰ pilotã€telemetryã€policy ç­‰ç»„ä»¶ Podï¼Œä½†æ˜¯å­˜åœ¨ç›¸å…³çš„ Headless Service (ClusterIP ä¸º None)ï¼Œå¹¶æ·»åŠ å®ƒä»¬çš„ endpoints æŒ‡å‘å¹¿å·ä¸»é›†ç¾¤çš„æ§åˆ¶é¢ ingress Gateway IPï¼Œä»¥æ­¤å®ç°å•æ§åˆ¶é¢å…±äº«ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;4-ç½‘ç»œæ‹“æ‰‘é…ç½®&#34;&gt;4. ç½‘ç»œæ‹“æ‰‘é…ç½®&lt;/h2&gt;
&lt;p&gt;æ§åˆ¶é¢éœ€è¦çŸ¥æ‚‰æ•´ä¸ªç½‘æ ¼çš„ç½‘ç»œæ‹“æ‰‘ï¼Œæ¯ä¸ªæœåŠ¡å®ä¾‹ä¹Ÿéœ€è¦æ ‡è®°è‡ªèº«æ‰€å¤„ç½‘ç»œã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸ªå…·ä½“æœåŠ¡å®ä¾‹æ”¶åˆ°çš„ xDS æ•°æ®ï¼Œéƒ½æ˜¯å’Œè‡ªèº«æ‰€å¤„çš„ç½‘ç»œå¼ºç›¸å…³çš„ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è·å–å„é›†ç¾¤çš„ ingress gateway ip:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% export GZ_INGRESS=$(kubectl -n istio-system --context guangzhou get service istio-ingressgateway -o jsonpath=&amp;#39;{.status.loadBalancer.ingress[0].ip}&amp;#39;)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% export SG_INGRESS=$(kubectl -n istio-system --context singapore get service istio-ingressgateway -o jsonpath=&amp;#39;{.status.loadBalancer.ingress[0].ip}&amp;#39;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;å°†å„é›†ç¾¤ ip é…ç½®åˆ°ç½‘æ ¼å…¨å±€é…ç½®ä¸­ (æ›¿æ¢ IP):&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;% kubectl --context guangzhou -n istio-system edit cm istio&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meshNetworks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|-&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;  networks:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    network1:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      endpoints:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      - fromRegistry: Kubernetes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      gateways:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      - address: ${GZ_INGRESS}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        port: 443
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    network2:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      endpoints:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      - fromRegistry: singapore
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      gateways:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      - address: ${SG_INGRESS}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        port: 443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;æ¯ä¸ªé›†ç¾¤çš„ç½‘ç»œæ ‡è¯†éœ€è¦ç‹¬ç«‹è®¾ç½®ï¼Œè¯¥æ ‡è¯†æ˜¯æ³¨å…¥åˆ° sidecar çš„ç¯å¢ƒå˜é‡ä¸­ï¼Œå› æ­¤éœ€è¦åœ¨å„é›†ç¾¤ä¸­ä¿®æ”¹ sidecar injector é…ç½®ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¹¿å·ä¸»é›†ç¾¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl --context guangzhou -nistio-system edit cm istio-sidecar-injector
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;......
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;env:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- name: ISTIO_META_NETWORK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  value: &amp;#34;network1&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ–°åŠ å¡å­é›†ç¾¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl --context singapore -nistio-system edit cm istio-sidecar-injector
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;......
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;env:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- name: ISTIO_META_NETWORK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  value: &amp;#34;network2&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;æ›´æ–°å·²æœ‰ç»„ä»¶çš„ç½‘ç»œæ ‡è¯†ï¼šæ§åˆ¶é¢ç»„ä»¶çš„ sidecar å¹¶ä¸æ˜¯ç”±&lt;code&gt;istio-sidecar-injector&lt;/code&gt;æ³¨å…¥çš„ï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨ä¿®æ”¹å®ƒä»¬çš„ç½‘ç»œæ ‡è¯†ï¼ŒåŒ…æ‹¬&lt;code&gt;istio-ingressgateway&lt;/code&gt; &lt;code&gt;istio-egressgateway&lt;/code&gt;ç­‰ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl --context=guangzhou -nistio-system edit deploy istio-ingressgateway
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;......
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;env:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- name: ISTIO_META_NETWORK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  value: &amp;#34;network1&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id=&#34;5-å¤šé›†ç¾¤ç½‘æ ¼éªŒè¯&#34;&gt;5. å¤šé›†ç¾¤ç½‘æ ¼éªŒè¯&lt;/h2&gt;
&lt;p&gt;è‡³æ­¤ï¼Œç”±å¹¿å·å’Œæ–°åŠ å¡ 2 ä¸ªå¼‚åœ°é›†ç¾¤ç»„æˆçš„æœåŠ¡ç½‘æ ¼å·²ç»æ­å»ºå®Œæˆï¼Œæˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨ 2 ä¸ªé›†ç¾¤ä¸­åˆ†åˆ«éƒ¨ç½²ä¸€å¥—åœ¨çº¿ç”µå­å•†åŸ demo( github.com/TencentCloudContainerTeam/tcm-demo)ï¼Œå…¶ä¸­çš„æ¨èç³»ç»Ÿ (recommend)ï¼Œå¹¿å·é›†ç¾¤éƒ¨ç½² v1 ç‰ˆæœ¬ï¼Œæ–°åŠ å¡é›†ç¾¤éƒ¨ç½² v2 ç‰ˆæœ¬ï¼Œå…¶ä¸­ recommend v1 ç‰ˆæœ¬ä¸åŒ…å« bannerï¼Œrecommend v2 ç‰ˆæœ¬ä¼šæ˜¾ç¤ºä¸€ä¸ª image:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl --context guangzhou apply -f install/primarycluster-apps.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl --context singapore apply -f install/subcluster-apps.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  id=&#34;figure-image-20190729175507376&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2019-07-29-135141.png&#34; alt=&#34;image-20190729175507376&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20190729175507376
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åˆ›å»º ingress gatewayï¼Œæ”¾é€šå¯¹ mall æœåŠ¡çš„è®¿é—®æµé‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mall-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;base&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mall&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;base&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;mall-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mall&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;7000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mall&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;base&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mall&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subsets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mall&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ISTIO_MUTUAL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç­‰ä»·äºæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl --context guangzhou apply -f install/primarycluster-apps-routing.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„è™½ç„¶ä»¥ä¸Šæµæ§ CRD æ˜¯ apply åˆ°ä¸»é›†ç¾¤ï¼Œä½†æ˜¯å› ä¸ºå¹¿å·å’Œæ–°åŠ å¡å…±äº«ä¸€ä¸ªæ§åˆ¶é¢ï¼Œå› æ­¤è¿™äº›æµæ§è®¾ç½®åœ¨ 2 ä¸ªé›†ç¾¤éƒ½ä¼šç”Ÿæ•ˆï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20190729213030343&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2019-07-29-135135.png&#34; alt=&#34;image-20190729213030343&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20190729213030343
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬åˆ†åˆ«é€šè¿‡å¹¿å·å’Œæ–°åŠ å¡åœ°åŸŸçš„ ingress gateway IP è®¿é—® mall åº”ç”¨ï¼Œå¤šè®¿é—®å‡ æ¬¡ï¼Œå¯ä»¥å‘ç°ï¼Œæ— è®ºä»å“ªé‡Œåœ°åŸŸè¿›å…¥ï¼Œéšæœºçš„å¯ä»¥è®¿é—®åˆ° recommend v1 (æ—  banner) å’Œ recommend v2 (æœ‰ banner)ï¼Œè¯æ˜ 2 ä¸ªåœ°åŸŸçš„æœåŠ¡å®ä¾‹æ˜¯é€æ˜å…±äº«çš„ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20190729145727003&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2019-07-29-135126.png&#34; alt=&#34;image-20190729145727003&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20190729145727003
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿˜å¯ä»¥é€šè¿‡å·¥å…· istioctl æŸ¥çœ‹ xDS æ•°æ®ï¼Œæ¯”å¦‚æˆ‘ä»¬æŸ¥çœ‹å¹¿å·é›†ç¾¤ mall pod è·å¾—çš„ xDSï¼Œå…¶ä¸­æœ‰ 2 ä¸ª recommend æœåŠ¡çš„ endpoints:&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-image-20190729150633160&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox-blogimage-1256048497.cos.ap-guangzhou.myqcloud.com/2019-07-29-135120.png&#34; alt=&#34;image-20190729150633160&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      image-20190729150633160
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;code&gt;172.25.0.26:7000&lt;/code&gt;æ˜¯å¹¿å·é›†ç¾¤çš„ recommend v1 podï¼Œè€Œ&lt;code&gt;119.28.109.157:443&lt;/code&gt;å¯¹åº”çš„æ˜¯æ–°åŠ å¡é›†ç¾¤ recommend v2 pod. è¿™äº›æœåŠ¡å®ä¾‹å¯¹ä¸šåŠ¡ä»£ç æ¥è¯´æ˜¯é€æ˜çš„ï¼Œè®¿é—® recommend æœåŠ¡å¯ä»¥éšæœºè·¯ç”±åˆ°ä»»ä¸€é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦å¯¹ istio å¤šé›†ç¾¤ç½‘æ ¼çš„å®ç°è¿›è¡Œåˆ†æï¼Œå…³äºå¤šé›†ç¾¤ç½‘æ ¼çš„åº”ç”¨åœºæ™¯ï¼Œä¸”çœ‹ä¸‹å›åˆ†è§£ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æœåŠ¡ç½‘æ ¼æ—¶ä»£ï¼šIstio åœ¨æ··åˆäº‘æœªæ¥æ‰®æ¼”çš„è§’è‰²</title>
      <link>https://cloudnativecn.com/blog/the-service-mesh-era-istios-role-in-the-future-of-hybrid-cloud/</link>
      <pubDate>Wed, 10 Apr 2019 10:08:11 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/the-service-mesh-era-istios-role-in-the-future-of-hybrid-cloud/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://cloud.google.com/blog/topics/hybrid-cloud/the-service-mesh-era-istios-role-in-the-future-of-hybrid-cloud&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ¬¢è¿å›åˆ°æˆ‘ä»¬å…³äº Service Mesh å’Œ Istio çš„åšå®¢æ–‡ç« ç³»åˆ—ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¹‹å‰çš„å¸–å­ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº† Istio æœåŠ¡ç½‘æ ¼æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒä¸ºä»€ä¹ˆå¦‚æ­¤é‡è¦ã€‚ç„¶åï¼Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•å°† Istio æŠ•å…¥ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒåŒ…æ‹¬äº†å¦‚ä½•è¿›è¡Œé«˜çº§åº”ç”¨ç¨‹åºéƒ¨ç½²å’Œå®‰å…¨åŠŸèƒ½ï¼Œåˆ° SRE ç›‘æ§æœ€ä½³å®è·µã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¤©ï¼Œåœ¨ Google Cloud NEXT &amp;lsquo;19 ä¹‹å‰ï¼Œæˆ‘ä»¬æ­£åœ¨è°ˆè®ºåœ¨å„ç§ç¯å¢ƒä¸­ä½¿ç”¨ Istioï¼Œä»¥åŠ Istio å¦‚ä½•å¸®åŠ©æ‚¨é‡Šæ”¾æ··åˆäº‘çš„å¼ºå¤§åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆé‡‡ç”¨æ··åˆäº‘&#34;&gt;ä¸ºä»€ä¹ˆé‡‡ç”¨æ··åˆäº‘ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;æ··åˆäº‘å¯ä»¥é‡‡ç”¨å¤šç§å½¢å¼ã€‚é€šå¸¸ï¼Œæ··åˆäº‘æŒ‡çš„æ˜¯è·¨å…¬å…±äº‘å’Œç§æœ‰ï¼ˆå†…éƒ¨éƒ¨ç½²ï¼‰äº‘è¿è¡Œï¼Œè€Œå¤šäº‘æ„å‘³ç€è·¨å¤šä¸ªå…¬å…±äº‘å¹³å°è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;é‡‡ç”¨æ··åˆäº‘æˆ–å¤šäº‘æ¶æ„å¯ä»¥ä¸ºæ‚¨çš„ç»„ç»‡å¸¦æ¥è¯¸å¤šå¥½å¤„ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å¤šä¸ªäº‘æä¾›å•†å¯ä»¥å¸®åŠ©æ‚¨é¿å…ä¾›åº”å•†é”å®šï¼Œå¹¶ä½¿å¾—æ‚¨ä¸ºå®ç°ç›®æ ‡å¯é€‰æ‹©æœ€ä½³çš„äº‘æœåŠ¡ã€‚ä½¿ç”¨äº‘å’Œæœ¬åœ°ç¯å¢ƒï¼Œæ‚¨å¯ä»¥åŒæ—¶äº«å—äº‘çš„ä¼˜åŠ¿ï¼ˆçµæ´»æ€§ã€å¯æ‰©å±•æ€§ã€æˆæœ¬é™ä½ï¼‰å’Œæœ¬åœ°çš„å¥½å¤„ï¼ˆå®‰å…¨æ€§ã€ä½å»¶è¿Ÿã€ç¡¬ä»¶å¤ç”¨ï¼‰ã€‚å¦‚æœæ‚¨æ˜¯é¦–æ¬¡è¿ç§»åˆ°äº‘ç«¯ï¼Œé‡‡ç”¨æ··åˆäº‘æ­¥éª¤å¯ä»¥è®©æ‚¨æŒ‰ç…§è‡ªå·±çš„èŠ‚å¥ï¼Œä»¥æœ€é€‚åˆæ‚¨ä¸šåŠ¡çš„æ–¹å¼è¿›è¡Œã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®æˆ‘ä»¬åœ¨ Google çš„ç»éªŒä»¥åŠæˆ‘ä»¬ä»å®¢æˆ·é‚£é‡Œå¾—åˆ°çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬è®¤ä¸ºé‡‡ç”¨æ··åˆæœåŠ¡ç½‘ç»œæ˜¯ç®€åŒ–äº‘å’Œæœ¬åœ°ç¯å¢ƒä¸­åº”ç”¨ç¨‹åºç®¡ç†ã€å®‰å…¨æ€§å’Œå¯é æ€§çš„å…³é”® - æ— è®ºæ‚¨çš„åº”ç”¨ç¨‹åºæ˜¯å¦åœ¨å®¹å™¨ä¸­è¿è¡Œï¼Œæˆ–æ˜¯åœ¨è™šæ‹Ÿæœºä¸­è¿è¡Œã€‚è®©æˆ‘ä»¬æ¥è°ˆè°ˆå¦‚ä½•ä½¿ç”¨ Istio å°†æ··åˆæœåŠ¡ç½‘æ ¼å˜ä¸ºç°å®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ··åˆ-istioè·¨ç¯å¢ƒçš„ç½‘æ ¼&#34;&gt;æ··åˆ Istioï¼šè·¨ç¯å¢ƒçš„ç½‘æ ¼&lt;/h2&gt;
&lt;p&gt;Istio çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§æ˜¯å®ƒä¸ºæ‚¨çš„å·¥ä½œè´Ÿè½½ï¼ˆä¾‹å¦‚ Podã€Jobã€åŸºäº VM çš„åº”ç”¨ç¨‹åºï¼‰æä¾›æœåŠ¡æŠ½è±¡ã€‚å½“æ‚¨è½¬å‘æ··åˆæ‹“æ‰‘æ—¶ï¼Œè¿™ç§æœåŠ¡æŠ½è±¡å˜å¾—æ›´åŠ é‡è¦ï¼Œå› ä¸ºç°åœ¨æ‚¨ä¸æ˜¯åªéœ€è¦å…³æ³¨ä¸€ä¸ªç¯å¢ƒï¼Œè€Œæ˜¯éœ€è¦å…³æ³¨è‹¥å¹²ä¸ªç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;å½“æ‚¨åœ¨ä¸€ä¸ª Kubernetes é›†ç¾¤ä¸Šä½¿ç”¨ Istio æ—¶ï¼Œæ‚¨å¯ä»¥è·å¾—åŒ…æ‹¬å¯è§æ€§ã€â€‹â€‹ç»†ç²’åº¦æµé‡ç­–ç•¥ã€ç»Ÿä¸€é¥æµ‹å’Œå®‰å…¨æ€§åœ¨å†…çš„å¾®æœåŠ¡çš„æ‰€æœ‰ç®¡ç†ä¼˜åŠ¿ã€‚ä½†æ˜¯å½“æ‚¨åœ¨å¤šä¸ªç¯å¢ƒä¸­ä½¿ç”¨ Istio æ—¶ï¼Œæ‚¨å®é™…ä¸Šæ˜¯åœ¨ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªæ–°çš„è¶…çº§èƒ½åŠ›ã€‚å› ä¸º Istio ä¸ä»…ä»…æ˜¯ Kubernetes çš„æœåŠ¡æŠ½è±¡ï¼ŒIstio ä¹Ÿæ˜¯ä¸€ç§åœ¨æ•´ä¸ªç¯å¢ƒä¸­æ ‡å‡†åŒ–ç½‘ç»œçš„æ–¹æ³•ã€‚å®ƒæ˜¯ä¸€ç§é›†ä¸­ API ç®¡ç†å¹¶å°† JWT éªŒè¯ä¸ä»£ç åˆ†ç¦»çš„æ–¹æ³•ã€‚å®ƒæ˜¯è·¨äº‘æä¾›å•†çš„å®‰å…¨ã€é›¶ä¿¡ä»»ç½‘ç»œçš„å¿«é€Ÿé€šé“ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆæ‰€æœ‰è¿™äº›é­”æ³•æ˜¯å¦‚ä½•å‘ç”Ÿçš„å‘¢ï¼Ÿæ··åˆ Istio æ˜¯æŒ‡ä¸€ç»„ Istio Sidecar ä»£ç†ï¼Œæ¯ä¸€ä¸ª Envoy ä»£ç†ä½äºæ‰€æœ‰æœåŠ¡çš„æ—è¾¹ï¼Œè€Œè¿™äº›æœåŠ¡å¯èƒ½è¿è¡Œåœ¨æ‚¨çš„ä¸åŒç¯å¢ƒä¸­çš„æ¯ä¸€ä¸ªè™šæ‹Ÿæœºã€æ¯ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œè€Œä¸”è¿™äº› Sidecar ä»£ç†ä¹‹å‰äº’ç›¸çŸ¥é“å¦‚ä½•è·¨è¾¹ç•Œäº¤äº’ã€‚è¿™äº› Envoy Sidecar ä»£ç†å¯èƒ½ç”±ä¸€ä¸ªä¸­å¤® Istio æ§åˆ¶å¹³é¢ç®¡ç†ï¼Œæˆ–ç”±æ¯ä¸ªç¯å¢ƒä¸­è¿è¡Œçš„å¤šä¸ªæ§åˆ¶å¹³é¢ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹ä¸€äº›ä¾‹å­å§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¤šé›†ç¾¤-istioä¸€ä¸ªæ§åˆ¶å¹³é¢&#34;&gt;å¤šé›†ç¾¤ Istioï¼Œä¸€ä¸ªæ§åˆ¶å¹³é¢&lt;/h2&gt;
&lt;p&gt;å¯ç”¨æ··åˆ Istio çš„ä¸€ç§æ–¹æ³•æ˜¯é…ç½®ä¸€ä¸ªè¿œç¨‹ Kubernetes é›†ç¾¤ï¼Œè¯¥é›†ç¾¤è¿æ¥åˆ°ä¸€ä¸ªé›†ä¸­è¿è¡Œçš„ Istio æ§åˆ¶å¹³é¢ã€‚å¦‚æœåœ¨åŒä¸€ GCP é¡¹ç›®ä¸­æœ‰å¤šä¸ª GKE é›†ç¾¤ï¼Œåˆ™æ­¤è®¾ç½®å¾ˆæœ‰ç”¨ï¼Œæ³¨æ„çš„æ˜¯ä¸¤ä¸ªé›†ç¾¤ä¸­çš„ Kubernetes pod éœ€è¦ç›¸äº’é€šä¿¡ã€‚è¿™ç§æ–¹å¼å¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼šé€šè¿‡æµ‹è¯•é›†ç¾¤æ‚¨å¯ä»¥ä½¿ç”¨æ–°çš„åŠŸèƒ½å¹¶ä½¿å…¶è¿‡æ¸¡åˆ°ç”Ÿäº§é›†ç¾¤ï¼›å‡†å¤‡å¥½å¤„ç†æ•…éšœè½¬ç§»çš„å¤‡ç”¨é›†ç¾¤ï¼Œæˆ–è·¨åœ°åŸŸæˆ–å¯ç”¨åŒºçš„å†—ä½™é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æ¼”ç¤ºæ˜¯åœ¨åŒä¸€ä¸ª GCP é¡¹ç›®ä¸­çš„ä¸¤ä¸ª GKE é›†ç¾¤ï¼Œä½†æ˜¯è·¨è¶Šäº†ä¸¤ä¸ªä¸åŒçš„å¯ç”¨åŒºï¼ˆus-central å’Œ us-eastï¼‰ã€‚æˆ‘ä»¬åœ¨ä¸€ä¸ªé›†ç¾¤ä¸Šå®‰è£… Istio æ§åˆ¶å¹³é¢ï¼Œåœ¨å¦ä¸€ä¸ªé›†ç¾¤ä¸Šå®‰è£… Istio çš„è¿œç¨‹ç»„ä»¶ï¼ˆåŒ…æ‹¬ sidecar ä»£ç†æ³¨å…¥å™¨ï¼‰ã€‚åœ¨è¿™ä¸¤ä¸ªé›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥éƒ¨ç½²è·¨ Kubernetes é›†ç¾¤çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/the-service-mesh-era-istios-role-in-the-future-of-hybrid-cloud/740de70aly1g1ufab9cslj212w0kjn0n_hu_2f21a13742ae75e5.webp 400w,
               /blog/the-service-mesh-era-istios-role-in-the-future-of-hybrid-cloud/740de70aly1g1ufab9cslj212w0kjn0n_hu_579ee678d07ee333.webp 760w,
               /blog/the-service-mesh-era-istios-role-in-the-future-of-hybrid-cloud/740de70aly1g1ufab9cslj212w0kjn0n_hu_981b30b94df65d01.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/the-service-mesh-era-istios-role-in-the-future-of-hybrid-cloud/740de70aly1g1ufab9cslj212w0kjn0n_hu_2f21a13742ae75e5.webp&#34;
               width=&#34;760&#34;
               height=&#34;401&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…³äºè¿™ç§å•ä¸€æ§åˆ¶å¹³é¢æ–¹æ³•çš„ä»¤äººå…´å¥‹çš„äº‹æƒ…æ˜¯ï¼Œæˆ‘ä»¬ä¸å¿…æ”¹å˜ä»»ä½•æœ‰å…³æˆ‘ä»¬çš„å¾®æœåŠ¡å¦‚ä½•ç›¸äº’é€šä¿¡çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå‰ç«¯ä»ç„¶å¯ä»¥ä½¿ç”¨æœ¬åœ° Kubernetes DNS åç§°ï¼ˆcartservice:portï¼‰è°ƒç”¨ CartServiceã€‚æ­¤ DNS è§£ææœ‰æ•ˆï¼Œå› ä¸ºåŒä¸€ GCP é¡¹ç›®ä¸­çš„ GKE pod å±äºåŒä¸€è™šæ‹Ÿç½‘ç»œï¼Œå› æ­¤å…è®¸è·¨ç¾¤é›†è¿›è¡Œç›´æ¥çš„ pod-to-pod é€šä¿¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¤šé›†ç¾¤-istioä¸¤ä¸ªæ§åˆ¶å¹³é¢&#34;&gt;å¤šé›†ç¾¤ Istioï¼Œä¸¤ä¸ªæ§åˆ¶å¹³é¢&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸€ä¸ªåŸºæœ¬çš„å¤šé›†ç¾¤ Istio ç¤ºä¾‹ï¼Œè®©æˆ‘ä»¬æ›´è¿›ä¸€æ­¥æ¼”ç¤ºå¦ä¸€ç§æ‹“æ‰‘ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾æ‚¨åœ¨æœ¬åœ°å’Œäº‘ä¸­æˆ–è·¨äº‘å¹³å°è¿è¡Œåº”ç”¨ç¨‹åºã€‚ä¸ºäº†ä½¿ Istio è·¨è¶Šè¿™äº›ä¸åŒçš„ç¯å¢ƒï¼Œä¸¤ä¸ªé›†ç¾¤å†…çš„ pod å¿…é¡»èƒ½å¤Ÿè·¨è¶Šç½‘ç»œè¾¹ç•Œã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æ¼”ç¤ºä½¿ç”¨ä¸¤ä¸ª Istio æ§åˆ¶å¹³é¢ - æ¯ä¸ªé›†ç¾¤ä¸€ä¸ª - å½¢æˆä¸€ä¸ªåŒå¤´é€»è¾‘æœåŠ¡ç½‘æ ¼ã€‚ä¸¤ä¸ªé›†ç¾¤é—´çš„æµé‡äº¤äº’æ˜¯é€šè¿‡ Istio çš„ Ingress ç½‘å…³ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ Sidecar ä»£ç†ç›´æ¥ç›¸äº’é€šä¿¡ã€‚Istio Gateway ä¹Ÿæ˜¯ä¸€ä¸ª Envoy ä»£ç†ï¼Œä½†å®ƒä¸“é—¨ç”¨äºè¿›å‡ºé›†ç¾¤ Istio ç½‘æ ¼çš„æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/the-service-mesh-era-istios-role-in-the-future-of-hybrid-cloud/740de70aly1g1uf9x9drej20xc0fediq_hu_1496e08eaf7f4a5f.webp 400w,
               /blog/the-service-mesh-era-istios-role-in-the-future-of-hybrid-cloud/740de70aly1g1uf9x9drej20xc0fediq_hu_952bd19b836e97da.webp 760w,
               /blog/the-service-mesh-era-istios-role-in-the-future-of-hybrid-cloud/740de70aly1g1uf9x9drej20xc0fediq_hu_989fb53db49e512d.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/the-service-mesh-era-istios-role-in-the-future-of-hybrid-cloud/740de70aly1g1uf9x9drej20xc0fediq_hu_1496e08eaf7f4a5f.webp&#34;
               width=&#34;760&#34;
               height=&#34;351&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸ºä½¿æ­¤è®¾ç½®è·¨ç½‘ç»œåˆ†åŒºå·¥ä½œï¼Œæ¯ä¸ª Istio æ§åˆ¶å¹³é¢éƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åŸŸåæœåŠ¡å™¨ï¼ˆDNSï¼‰é…ç½®ã€‚åœ¨æ­¤åŒæ§åˆ¶å¹³é¢æ‹“æ‰‘ä¸­ï¼ŒIstio å®‰è£…è¾…åŠ© DNS æœåŠ¡å™¨ï¼ˆCoreDNSï¼‰ï¼Œè¯¥æœåŠ¡å™¨è§£ææœ¬åœ°é›†ç¾¤çš„å¤–éƒ¨æœåŠ¡çš„åŸŸåã€‚å¯¹äºé‚£äº›å¤–éƒ¨æœåŠ¡ï¼Œæµé‡åœ¨ Istio Ingress ç½‘å…³ä¹‹é—´é€ä¼ ï¼Œç„¶åè½¬ç§»åˆ°ç›¸å…³æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤æ‹“æ‰‘çš„æ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤ºå®‰è£…çš„å·¥ä½œåŸç†ï¼Œç„¶åä»‹ç»å¦‚ä½•é…ç½®è·¨ä¸¤ä¸ªé›†ç¾¤è¿è¡Œçš„å¾®æœåŠ¡èƒ½å¤Ÿäº’ç›¸é€šä¿¡ã€‚æˆ‘ä»¬é€šè¿‡ Istio ServiceEntry èµ„æºå®Œæˆæ­¤æ“ä½œã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†å‰ç«¯ï¼ˆé›†ç¾¤ 2ï¼‰çš„æœåŠ¡æ¡ç›®éƒ¨ç½²åˆ°é›†ç¾¤ 1 ä¸­ã€‚è¿™æ ·ï¼Œé›†ç¾¤ 1 å°±çŸ¥é“é›†ç¾¤ 2 ä¸­è¿è¡Œçš„æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ç¬¬ä¸€ä¸ªæ¼”ç¤ºä¸åŒï¼Œè¿™ç§åŒæ§åˆ¶å¹³é¢ Istio è®¾ç½®ä¸éœ€è¦é›†ç¾¤ä¹‹é—´çš„æ‰å¹³ç½‘ç»œã€‚è¿™æ„å‘³ç€æ‚¨çš„é›†ç¾¤ä¹‹é—´ pod å¯ä»¥æœ‰é‡å çš„ CIDRã€‚æ­¤è®¾ç½®æ‰€éœ€è¦çš„åªæ˜¯ Istio ç½‘å…³æš´éœ²åœ¨ Internet ä¸Šã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¯ä¸ªé›†ç¾¤å†…çš„æœåŠ¡å¯ä»¥åœ¨å„è‡ªçš„ç¯å¢ƒä¸­ä¿æŒå®‰å…¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å°†è™šæ‹Ÿæœºæ·»åŠ åˆ°-istio-ç½‘æ ¼&#34;&gt;å°†è™šæ‹Ÿæœºæ·»åŠ åˆ° Istio ç½‘æ ¼&lt;/h2&gt;
&lt;p&gt;é™¤äº†å®¹å™¨ä¹‹å¤–ï¼Œè®¸å¤šç»„ç»‡ä¹Ÿä½¿ç”¨è™šæ‹Ÿæœºï¼ˆVMï¼‰ä½œä¸ºè¡¥å……æˆ–è€…æ›¿ä»£æ¥è¿è¡Œå…¶åº”ç”¨ç¨‹åºã€‚å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨è™šæ‹Ÿæœºï¼Œæ‚¨ä»ç„¶å¯ä»¥äº«å— Istio ç½‘æ ¼å¸¦æ¥çš„å¥½å¤„ã€‚æ­¤æ¼”ç¤ºå‘æ‚¨å±•ç¤ºå¦‚ä½•åœ¨ GKE ä¸Šè¿è¡Œ Istio æ—¶é›†æˆ Google Compute Engine å®ä¾‹ã€‚æˆ‘ä»¬åƒä»¥å‰ä¸€æ ·éƒ¨ç½²ç›¸åŒçš„åº”ç”¨ç¨‹åº ä½†è¿™ä¸€æ¬¡ï¼Œä¸€ä¸ªæœåŠ¡ï¼ˆProductCatalogï¼‰è¢«éƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤ä¹‹å¤–çš„å¤–éƒ¨è™šæ‹Ÿæœºä¸Šè¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/the-service-mesh-era-istios-role-in-the-future-of-hybrid-cloud/740de70aly1g1uf9946qjj212w0n4ae7_hu_70027efd3c192e3b.webp 400w,
               /blog/the-service-mesh-era-istios-role-in-the-future-of-hybrid-cloud/740de70aly1g1uf9946qjj212w0n4ae7_hu_faa9219b10a39658.webp 760w,
               /blog/the-service-mesh-era-istios-role-in-the-future-of-hybrid-cloud/740de70aly1g1uf9946qjj212w0n4ae7_hu_b059d0c45a3698dc.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/the-service-mesh-era-istios-role-in-the-future-of-hybrid-cloud/740de70aly1g1uf9946qjj212w0n4ae7_hu_70027efd3c192e3b.webp&#34;
               width=&#34;760&#34;
               height=&#34;451&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¯¥ GCE è™šæ‹Ÿæœºè¿è¡Œä¸€ç»„æœ€å°çš„ Istio ç»„ä»¶ï¼Œä»¥ä¾¿èƒ½å¤Ÿä¸ä¸­å¿ƒçš„ Istio æ§åˆ¶å¹³é¢é€šä¿¡ã€‚ç„¶åï¼Œæˆ‘ä»¬å°† Istio ServiceEntry å¯¹è±¡éƒ¨ç½²åˆ° GKE é›†ç¾¤ï¼Œè¯¥é›†ç¾¤åœ¨é€»è¾‘ä¸Šå°†å¤–éƒ¨ ProductCatalog æœåŠ¡æ·»åŠ åˆ°ç½‘æ ¼ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ª Istio é…ç½®æ¨¡å‹å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºç°åœ¨ï¼Œæ‰€æœ‰å…¶ä»–å¾®æœåŠ¡éƒ½å¯ä»¥å¼•ç”¨ ProductCatalogï¼Œå°±å¥½åƒå®ƒæ˜¯åœ¨ Kubernetes é›†ç¾¤å†…éƒ¨è¿è¡Œä¸€æ ·ã€‚ä»è¿™é‡Œï¼Œæ‚¨ç”šè‡³å¯ä»¥ä¸º ProductCatalog æ·»åŠ  Istio ç­–ç•¥å’Œè§„åˆ™ï¼Œå°±åƒå®ƒåœ¨ Kubernetes ä¸­è¿è¡Œä¸€æ ·; ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä¸ºè™šæ‹Ÿæœºçš„æ‰€æœ‰å…¥ç«™æµé‡å¯ç”¨åŒå‘ TLSã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œè™½ç„¶æ­¤ç¤ºä¾‹ä½¿ç”¨ Google Cloud VM è¿›è¡Œæ¼”ç¤ºï¼Œä½†æ‚¨å¯ä»¥åœ¨ç‰©ç†æœºä¸Šæˆ–ä½¿ç”¨æœ¬åœ°è™šæ‹Ÿæœºè¿è¡Œç›¸åŒçš„ç¤ºä¾‹ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥å°† Istio çš„ç°ä»£äº‘åŸç”ŸåŸåˆ™å¸¦åˆ°ä»»ä½•åœ°æ–¹è¿è¡Œçš„è™šæ‹Ÿæœºä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å»ºç«‹æ··åˆå‹æœªæ¥&#34;&gt;å»ºç«‹æ··åˆå‹æœªæ¥&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¸Œæœ›è¿™äº›æ··åˆ Istio æ¼”ç¤ºä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªèƒ½å¤Ÿä¸ç°åœ¨æ‚¨çš„ç»„ç»‡ä¸­è¿è¡Œåº”ç”¨ç¨‹åºçš„æ–¹å¼äº§ç”Ÿå…±é¸£ã€‚ä½†æˆ‘ä»¬ä¹Ÿæ˜ç™½é‡‡ç”¨åƒ Istio è¿™æ ·çš„æœåŠ¡ç½‘æ ¼æ„å‘³ç€è¦æ‰¿æ‹…å¤æ‚æ€§å’Œå®‰è£…å¼€é”€ï¼Œæ­¤å¤–è¿˜æ¶‰åŠè¿ç§»åˆ°å¾®æœåŠ¡å’Œ Kubernetes ç›¸å…³çš„ä»»ä½•å¤æ‚æ€§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‡‡ç”¨æ··åˆæœåŠ¡ç½‘æ ¼ç”šè‡³æ›´å¤æ‚ï¼Œå› ä¸ºæ‚¨æ­£åœ¨å¤„ç†ä¸åŒçš„ç¯å¢ƒï¼Œæ¯ä¸ªç¯å¢ƒéƒ½æœ‰è‡ªå·±çš„æŠ€æœ¯è§„èŒƒã€‚&lt;/p&gt;
&lt;p&gt;Google Cloud è‡´åŠ›äºé€šè¿‡ä¸€è‡´ã€ç°ä»£åŒ–çš„è·¨å¹³å°è®¾ç½®å¸®åŠ©æ‚¨ç®€åŒ–æ—¥å¸¸äº‘æ“ä½œã€‚è¿™å°±æ˜¯æˆ‘ä»¬åœ¨ GKE ä¸Šåˆ›å»º Istio çš„åŸå› ï¼Œå®ƒå¯ä»¥åœ¨ Google Kubernetes Engineï¼ˆGKEï¼‰ä¸Šä¸€é”®å®‰è£… Istioã€‚å®ƒæ˜¯æˆ‘ä»¬åœ¨äº‘æœåŠ¡å¹³å°ï¼ˆCSPï¼‰ä¸Šå·¥ä½œçš„æ¨åŠ¨åŠ›ã€‚CSP æ˜¯ä¸€ç§äº§å“ï¼Œå¯ä»¥å¸®åŠ©æ‚¨çš„ç»„ç»‡è¿ç§»åˆ°ï¼ˆå¹¶è·¨è¶Šï¼‰äº‘â€”â€”æŒ‰ç…§æ‚¨è‡ªå·±çš„æ­¥è°ƒã€ä»¥æœ€é€‚åˆæ‚¨çš„æ–¹å¼ã€‚CSP ä¾èµ–äºå¼€æ”¾çš„äº‘å †æ ˆâ€”â€”Kubernetes å’Œ Istioâ€”â€”æ¥å¼ºè°ƒå¯ç§»æ¤æ€§ã€‚ä»Šå¹´æˆ‘ä»¬å¾ˆé«˜å…´ CSP æˆä¸ºç°å®ã€‚&lt;/p&gt;
&lt;p&gt;æ„Ÿè°¢æ‚¨åŠ å…¥æˆ‘ä»¬è¿„ä»Šä¸ºæ­¢çš„æœåŠ¡ç½‘æ ¼ç³»åˆ—ã€‚è¯·ç»§ç»­å…³æ³¨ 4 æœˆä»½ Google Cloud NEXT ä¸Šçš„ä¸»é¢˜æ¼”è®²å’Œæ··åˆäº‘ä¸“é¢˜ã€‚åœ¨ NEXT ä¹‹åï¼Œæˆ‘ä»¬å°†ç»§ç»­å…³äº Istio æ“ä½œçš„ä¸€äº›é«˜çº§å¸–å­ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>è‡ªå®šä¹‰ Istio Mixer Adapter ç¤ºä¾‹æ•™ç¨‹ï¼ˆé™„æºç ï¼‰</title>
      <link>https://cloudnativecn.com/blog/custom-istio-mixer-adapter/</link>
      <pubDate>Wed, 06 Mar 2019 15:21:50 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/custom-istio-mixer-adapter/</guid>
      <description>&lt;p&gt;å¿«é€Ÿå¼€å§‹ï¼š&lt;a href=&#34;https://github.com/hb-go/micro-mesh/tree/master/examples/adapter/auth&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://micro-mesh/examples/adapter/auth&lt;/a&gt;æºç ä¼ é€é—¨ã€‚&lt;/p&gt;
&lt;p&gt;ç ”ç©¶ Istio ä¸‹æ„å»ºç®€æ´çš„å¾®æœåŠ¡æ¶æ„ï¼Œå¯¹ Istio çš„ç ”ç©¶ä¹Ÿæ›´æ·±å…¥ï¼Œè‡ªå®šä¹‰ Mixer Adapter å¿…ä¸å¯å°‘ï¼Œä»¥ä¸‹ç»“åˆä½¿ç”¨åœºæ™¯åšä¸€ä¸ªè‡ªå®šä¹‰é€‚é…å™¨çš„å®è·µåˆ†äº«ã€‚&lt;/p&gt;
&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/custom-istio-mixer-adapter/006tKfTcly1g0t2s7z4cxj312c0k3add_hu_fb2e9bca5ee2dd34.webp 400w,
               /blog/custom-istio-mixer-adapter/006tKfTcly1g0t2s7z4cxj312c0k3add_hu_8e7584054717519e.webp 760w,
               /blog/custom-istio-mixer-adapter/006tKfTcly1g0t2s7z4cxj312c0k3add_hu_df276647ef9d1d18.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/custom-istio-mixer-adapter/006tKfTcly1g0t2s7z4cxj312c0k3add_hu_fb2e9bca5ee2dd34.webp&#34;
               width=&#34;760&#34;
               height=&#34;398&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç»“åˆ&lt;a href=&#34;https://github.com/hb-go/micro-mesh#micro-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/hb-go/micro-mesh&lt;/a&gt;çš„å®è·µåœºæ™¯ï¼Œéœ€è¦åœ¨&lt;code&gt;ingressgateway&lt;/code&gt;ä¸&lt;code&gt;API service&lt;/code&gt;é—´åŠ å…¥è®¤è¯&amp;amp;é‰´æƒ (JWT&amp;amp;RBAC)ï¼Œè‡ªç„¶è€ƒè™‘ Istio æä¾›çš„&lt;a href=&#34;https://istio.io/zh/docs/concepts/security/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰å…¨&lt;/a&gt;æ–¹æ¡ˆï¼Œä½†ä½¿ç”¨ JWT åšè®¤è¯é‰´æƒåœ¨åç«¯æ˜¯æ— çŠ¶æ€çš„ï¼Œè¿™æ ·åœ¨ä½¿ç”¨åœºæ™¯ä¸Šæœ‰ä¸€å®šé™åˆ¶ï¼Œå¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯†ç ä¿®æ”¹ã€ç»ˆç«¯è¿æ¥é™åˆ¶ç­‰åœºæ™¯ä¸‹æ— æ³•è¸¢é™¤&lt;/li&gt;
&lt;li&gt;è®¿é—®æ§åˆ¶ç­–ç•¥æ— æ³•å®æ—¶ç”Ÿæ•ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;é»˜è®¤æ–¹æ¡ˆåªæ˜¯åœ¨ä¸€äº›åœºæ™¯ä¸‹ä¸åˆé€‚ï¼Œæ ¹æ®å…·ä½“éœ€æ±‚è€ƒè™‘ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;åŸºäºè¿™æ ·çš„åœºæ™¯å¯ä»¥è‡ªå®šä¹‰ Adapter æ¥å®ç°ï¼Œç›®æ ‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Token-JWT
&lt;ul&gt;
&lt;li&gt;æœåŠ¡ç«¯éªŒè¯ token æœ‰æ•ˆæ€§&lt;/li&gt;
&lt;li&gt;åº”å¯¹å¯†ç ä¿®æ”¹ã€ç»ˆç«¯æ•°é‡é™åˆ¶ç­‰åœºæ™¯&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ACL-&lt;a href=&#34;http://github.com/casbin/casbin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Casbin&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡ç«¯è·å–ç”¨æˆ·è§’è‰²ï¼Œåš API è®¿é—®æ§åˆ¶&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·è§’è‰²åŠæ¥å£æˆæƒç­–ç•¥å®æ—¶ç”Ÿæ•ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸‹ç¤ºä¾‹å¯¹ token éªŒè¯ã€è®¿é—®æ§åˆ¶ä¸åšå…·ä½“è®¾è®¡ï¼Œé‡ç‚¹ä»‹ç»å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª&lt;code&gt;auth-adapter&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;è‡ªå®šä¹‰-adapter-ä»‹ç»&#34;&gt;è‡ªå®šä¹‰ Adapter ä»‹ç»&lt;/h2&gt;
&lt;p&gt;é…ç½®å…³ç³»åŠæ‰§è¡Œæµç¨‹å¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/custom-istio-mixer-adapter/006tKfTcly1g0t2of1ziej31bg0nsdma_hu_f02e8242cfbff110.webp 400w,
               /blog/custom-istio-mixer-adapter/006tKfTcly1g0t2of1ziej31bg0nsdma_hu_6316636d8a49d194.webp 760w,
               /blog/custom-istio-mixer-adapter/006tKfTcly1g0t2of1ziej31bg0nsdma_hu_21dbf75d65b5defc.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/custom-istio-mixer-adapter/006tKfTcly1g0t2of1ziej31bg0nsdma_hu_f02e8242cfbff110.webp&#34;
               width=&#34;760&#34;
               height=&#34;381&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å±æ€§ï¼šä½¿ç”¨&lt;code&gt;istio&lt;/code&gt;çš„&lt;code&gt;attributes&lt;/code&gt;ï¼Œ&lt;code&gt;istio/mixer/testdata/config/attributes.yaml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å±æ€§ä¸é€‚é…å™¨è¾“å…¥æ˜ å°„æ¨¡æ¿ï¼šä½¿ç”¨&lt;code&gt;istio&lt;/code&gt;çš„&lt;code&gt;authorization&lt;/code&gt;æ¨¡æ¿ï¼Œ&lt;code&gt;istio/mixer/template/authorization/template.yaml&lt;/code&gt;ï¼Œé€šè¿‡&lt;code&gt;template.proto&lt;/code&gt;æŸ¥çœ‹åè®®å†…å®¹&lt;/li&gt;
&lt;li&gt;é€‚é…å™¨ï¼Œ&lt;code&gt;micro-mesh/examples/adapter/auth/config/auth-adapter.yaml&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;go generate ./...&lt;/code&gt;è‡ªåŠ¨ç”Ÿæˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é€‚é…å™¨æœåŠ¡å¯åŠ¨é…ç½®ï¼Œ&lt;code&gt;micro-mesh/examples/adapter/auth/config/config.proto&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é€‚é…å™¨æœåŠ¡å®ä¾‹ï¼Œ&lt;code&gt;micro-mesh/examples/adapter/auth/operatorconfig/cluster-service.yaml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é€‚é…å™¨é…ç½®ï¼Œ&lt;code&gt;micro-mesh/examples/adapter/auth/operatorconfig/operator-cfg.yaml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;ç›®å½•ç»“æ„&#34;&gt;ç›®å½•ç»“æ„&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;bin                         æ‰§è¡Œæ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cmd                         
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”” main.go                 é€‚é…å™¨å…¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;config                      é…ç½®åè®®
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”œ adapter.auth.config.pb.html                 &lt;span class=&#34;c1&#34;&gt;#go generate ./... è‡ªåŠ¨ç”Ÿæˆ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”œ auth-adapter.yaml       é€‚é…å™¨æè¿°æ–‡ä»¶       &lt;span class=&#34;c1&#34;&gt;#go generate ./... è‡ªåŠ¨ç”Ÿæˆ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”œ config.pb.go                                &lt;span class=&#34;c1&#34;&gt;#go generate ./... è‡ªåŠ¨ç”Ÿæˆ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”œ config.proto            é€‚é…å™¨æœåŠ¡å¯åŠ¨é…ç½®
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”” config.proto_descriptor                     &lt;span class=&#34;c1&#34;&gt;#go generate ./... è‡ªåŠ¨ç”Ÿæˆ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;operatorconfig              k8sé…ç½®
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”œ attributes.yaml         å±æ€§                  &lt;span class=&#34;c1&#34;&gt;#copy istio/mixer/testdata/config/attributes.yaml&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”œ cluster-service.yaml    é€‚é…å™¨æœåŠ¡å®ä¾‹
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”œ operator-cfg.yaml       é€‚é…å™¨é…ç½®
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”” template.yaml           å±æ€§ä¸é€‚é…å™¨è¾“å…¥æ¨¡æ¿    &lt;span class=&#34;c1&#34;&gt;#copy istio/mixer/template/authorization/template.yaml&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;testdata                    æµ‹è¯•é…ç½®
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”œ attributes.yaml         å±æ€§                  &lt;span class=&#34;c1&#34;&gt;#copy istio/mixer/testdata/config/attributes.yaml&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”œ auth-adapter.yaml       é€‚é…å™¨æè¿°æ–‡ä»¶         &lt;span class=&#34;c1&#34;&gt;#copy config/auth-adapter.yaml&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”œ operator-cfg.yaml       é€‚é…å™¨é…ç½®
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  â”” template.yaml           å±æ€§ä¸é€‚é…å™¨è¾“å…¥æ¨¡æ¿    &lt;span class=&#34;c1&#34;&gt;#copy istio/mixer/template/authorization/template.yaml&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;auth.go                     é€‚é…å™¨æœåŠ¡å®ç°
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Dockerfile                  Dockeré•œåƒ
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰ 3 å¤„ä¸é€‚é…å™¨å®ç°ç›¸å…³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€‚é…å™¨æœåŠ¡å¯åŠ¨é…ç½®&lt;code&gt;config/config.proto&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é€‚é…å™¨æœåŠ¡å®ç°&lt;code&gt;auth.go&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é€‚é…å™¨å…¥å£&lt;code&gt;cmd/main.go&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¥ä¸‹æ¥ä½¿ç”¨&lt;a href=&#34;https://github.com/hb-go/micro-mesh/tree/master/examples/adapter/auth&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;micro-mesh/examples/adapter/auth&lt;/a&gt;æºç æŒ‰æ­¥éª¤æ“ä½œï¼Œå®ç°æœ¬åœ°åŠ&lt;code&gt;K8S&lt;/code&gt;ç¯å¢ƒçš„æµ‹è¯•éƒ¨ç½²ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h2 id=&#34;æ­¥éª¤&#34;&gt;æ­¥éª¤&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å¼€å‘ç¯å¢ƒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;OSX&lt;/li&gt;
&lt;li&gt;Go &lt;strong&gt;1.11.1&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;protoc &lt;strong&gt;libprotoc 3.6.1&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Istio &lt;strong&gt;1.0.6&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;1istio-æºç &#34;&gt;1.Istio æºç &lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p &lt;span class=&#34;nv&#34;&gt;$GOPATH&lt;/span&gt;/src/istio.io/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$GOPATH&lt;/span&gt;/src/istio.io/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/istio/istio.git
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;2micro-mesh-æºç &#34;&gt;2.micro-mesh æºç &lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/hb-go/micro-mesh.git
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;3mixer-å¼€å‘å·¥å…·&#34;&gt;3.Mixer å¼€å‘å·¥å…·&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# build mixer server &amp;amp; client &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; istio
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make mixs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make mixc
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨&lt;code&gt;$GOPATH/out/darwin_amd64/release/&lt;/code&gt;ç”Ÿæˆ&lt;code&gt;mixs&lt;/code&gt;ã€&lt;code&gt;mixc&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;4æ„å»º-auth-adapter-é¡¹ç›®&#34;&gt;4.æ„å»º Auth adapter é¡¹ç›®&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# copy auth adapter example&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cp &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;micro-mesh path&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;/examples/adapter/auth mixer/adapter/auth
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; mixer/adapter/auth
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Optional&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥åˆ é™¤&lt;code&gt;config&lt;/code&gt;ç›®å½•é™¤&lt;code&gt;config.proto&lt;/code&gt;å¤–çš„å…¶ä»–æ–‡ä»¶ï¼Œçœ‹æ‰§è¡Œ go generate åçš„ç»“æœ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;go generate ./...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;go build ./...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;go generate&lt;/code&gt;æ ¹æ®&lt;code&gt;config/config.proto&lt;/code&gt;ä»¥åŠ&lt;code&gt;auth.go&lt;/code&gt;çš„æ³¨é‡Šè‡ªåŠ¨ç”Ÿæˆ&lt;code&gt;config&lt;/code&gt;ç›®å½•ä¸‹çš„å…¶ä»–æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;adapter.auth.config.pb.html&lt;/li&gt;
&lt;li&gt;auth-adapter.yaml&lt;/li&gt;
&lt;li&gt;config.pb.go&lt;/li&gt;
&lt;li&gt;config.proto_descriptor&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;æ ¹æ®&lt;code&gt;auth.go&lt;/code&gt;çš„ä»¥ä¸‹æ³¨é‡Šï¼Œ&lt;code&gt;mixer_codegen.sh&lt;/code&gt;ä½¿ç”¨&lt;code&gt;authorization&lt;/code&gt;æ¨¡æ¿ç”Ÿæˆ&lt;code&gt;name&lt;/code&gt;ä¸º&lt;code&gt;auth-adapter&lt;/code&gt;çš„é€‚é…å™¨ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// nolint:lll&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Generates the auth adapter&amp;#39;s resource yaml. It contains the adapter&amp;#39;s configuration, name, supported template&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// names (metric in this case), and whether it is session or no-session based.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//go:generate $GOPATH/src/istio.io/istio/bin/mixer_codegen.sh -a mixer/adapter/auth/config/config.proto -x &amp;#34;-s=false -n auth-adapter -t authorization&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;5æœ¬åœ°æµ‹è¯•&#34;&gt;5.æœ¬åœ°æµ‹è¯•&lt;/h3&gt;
&lt;p&gt;æœ¬åœ°æµ‹è¯•ä½¿ç”¨ testdata ä¸‹çš„é…ç½®ï¼Œå…¶ä¸­&lt;code&gt;operator-cfg.yaml&lt;/code&gt;æœ‰å‡ å¤„ä¸æ­£å¼éƒ¨ç½²ä¸åŒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;handler&lt;/code&gt;çš„&lt;code&gt;address&lt;/code&gt;ä½¿ç”¨æœ¬åœ°æœåŠ¡&lt;code&gt;&amp;quot;[::]:44225&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä¸ºäº†æ–¹ä¾¿æµ‹è¯•&lt;code&gt;instance&lt;/code&gt;çš„&lt;code&gt;params&lt;/code&gt;å‚æ•°ä»¥åŠ&lt;code&gt;rule&lt;/code&gt;çš„&lt;code&gt;math&lt;/code&gt;æ¡ä»¶åšäº†ç®€åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å¯åŠ¨é€‚é…å™¨æœåŠ¡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;go run cmd/main.go &lt;span class=&#34;m&#34;&gt;44225&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ä½¿ç”¨testdataä¸‹é…ç½®å¯åŠ¨mixer server&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$GOPATH&lt;/span&gt;/out/darwin_amd64/release/mixs server &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--configStoreURL&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;fs://&lt;span class=&#34;nv&#34;&gt;$GOPATH&lt;/span&gt;/src/istio.io/istio/mixer/adapter/auth/testdata &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--log_output_level&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;attributes:debug
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•Adapteræ˜¯å¦ç”Ÿæ•ˆ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$GOPATH&lt;/span&gt;/out/darwin_amd64/release/mixc check -s request.host&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;localhost&amp;#34;&lt;/span&gt; --stringmap_attributes &lt;span class=&#34;s2&#34;&gt;&amp;#34;request.headers=x-custom-token:efg&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Check RPC completed successfully. Check status was PERMISSION_DENIED (mm-example-auth.handler.istio-system:Unauthorized...)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$GOPATH&lt;/span&gt;/out/darwin_amd64/release/mixc check -s request.host&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;localhost&amp;#34;&lt;/span&gt; --stringmap_attributes &lt;span class=&#34;s2&#34;&gt;&amp;#34;request.headers=x-custom-token:abc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Check RPC completed successfully. Check status was OK&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;NOTE:å‡ºç°é¢„æœŸç»“æœä¸ä¸€è‡´å¯èƒ½æ˜¯ç”±äº mixer cache å¯¼è‡´&lt;code&gt;Valid use count: 10000, valid duration: 9.726875254s&lt;/code&gt;ï¼Œè¯·å‚è€ƒ&lt;a href=&#34;http://www.servicemesher.com/categories/istio-mixer-cache&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Mixer Cache&lt;/a&gt;ç³»åˆ—æ–‡ç« äº†è§£ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h3 id=&#34;6æ‰“åŒ…é•œåƒ&#34;&gt;6.æ‰“åŒ…é•œåƒ&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# buildæ‰§è¡Œæ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;CGO_ENABLED&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;GOOS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;linux &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    go build -a -installsuffix cgo -v -o bin/auth ./cmd/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# dockeré•œåƒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker build -t hbchen/micro-mesh-example-adapter-auth:v0.0.1 .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker push hbchen/micro-mesh-example-adapter-auth:v0.0.1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;7istio-ç¯å¢ƒéƒ¨ç½²&#34;&gt;7.Istio ç¯å¢ƒéƒ¨ç½²&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;éƒ¨ç½²ç¯å¢ƒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GKE &lt;strong&gt;1.11.7-gke.4&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Istio &lt;strong&gt;1.0.0&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å±æ€§ã€æ¨¡æ¿&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# attributes.yaml -&amp;gt; istio/mixer/testdata/config/attributes.yaml &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# template.yaml -&amp;gt; istio/mixer/template/authorization/template.yaml&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f examples/adapter/auth/testdata/attributes.yaml -f examples/adapter/auth/testdata/template.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# é€‚é…å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f examples/adapter/auth/config/auth-adapter.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;è¿™é‡Œæ˜¯ä»¥&lt;a href=&#34;https://github.com/hb-go/micro-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;micro-mesh&lt;/a&gt;ç¤ºä¾‹ä¸ºåŸºç¡€çš„é…ç½®ï¼Œå¦‚æœä½¿ç”¨&lt;code&gt;bookinfo&lt;/code&gt;æˆ–è€…è‡ªå·±çš„æœåŠ¡éœ€è¦åšç›¸åº”çš„ä¿®æ”¹&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;operator-cfg.yaml&lt;/code&gt;ä¸æœ¬åœ°æµ‹è¯•é…ç½®ä¸åŒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;handler&lt;/code&gt;çš„&lt;code&gt;address&lt;/code&gt;ä½¿ç”¨é›†ç¾¤æœåŠ¡&lt;code&gt;&amp;quot;mm-example-auth-adapter-service:44225&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;instance&lt;/code&gt;çš„&lt;code&gt;params&lt;/code&gt;æ ¹æ®&lt;code&gt;authorization&lt;/code&gt;æ¨¡æ¿åŠ&lt;code&gt;auth-adapter&lt;/code&gt;æœåŠ¡çš„éœ€æ±‚é…ç½®&lt;/li&gt;
&lt;li&gt;&lt;code&gt;rule&lt;/code&gt;çš„&lt;code&gt;match&lt;/code&gt;æ¡ä»¶ä½¿ç”¨&lt;code&gt;destination.service == &amp;quot;mm-example-api.default.svc.cluster.local&amp;quot;&lt;/code&gt;ï¼Œä»…å¯¹&lt;code&gt;mm-example-api&lt;/code&gt;æœåŠ¡ç”Ÿæ•ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# é€‚é…å™¨æœåŠ¡å®ä¾‹éƒ¨ç½²&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f examples/adapter/auth/operatorconfig/cluser-service.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# é€‚é…å™¨é…ç½®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f examples/adapter/auth/operatorconfig/operator-cfg.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;8istio-ç¯å¢ƒéƒ¨ç½²æµ‹è¯•&#34;&gt;8.Istio ç¯å¢ƒéƒ¨ç½²æµ‹è¯•&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰å¼€ Gateway çš„ JWT éªŒè¯å¯ä»¥å¿½ç•¥&lt;code&gt;Authorization&lt;/code&gt;ï¼Œå…¶å®åšäº†è‡ªå®šä¹‰ Auth åæ˜¯å¤šä½™çš„ğŸ˜‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;TOKEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;curl https://raw.githubusercontent.com/istio/istio/release-1.1/security/tools/jwt/samples/demo.jwt -s&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -H &lt;span class=&#34;s2&#34;&gt;&amp;#34;Authorization: Bearer &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$TOKEN&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; -H &lt;span class=&#34;s2&#34;&gt;&amp;#34;x-custom-token: efg&amp;#34;&lt;/span&gt; -X GET http://35.193.180.18/v1/example/call/Hobo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -H &lt;span class=&#34;s2&#34;&gt;&amp;#34;Authorization: Bearer &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$TOKEN&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; -H &lt;span class=&#34;s2&#34;&gt;&amp;#34;x-custom-token: abc&amp;#34;&lt;/span&gt; -X GET http://35.193.180.18/v1/example/call/Hobo
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/istio/wiki/Mixer-Out-of-Process-Adapter-Walkthrough&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mixer Out of Process Adapter Walkthrough&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/google-cloud/simple-istio-mixer-out-of-process-authorization-adapter-5f9363cd9bbc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Simple Istio Mixer Out of Process Authorization Adapter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Istio æ‰“é€ å¾®æœåŠ¡ï¼ˆç¬¬ 1 éƒ¨åˆ†ï¼‰</title>
      <link>https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/</link>
      <pubDate>Wed, 27 Feb 2019 11:35:38 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/</guid>
      <description>&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1gyo9j20m80bq754_hu_5f517c0ee6c9b245.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1gyo9j20m80bq754_hu_28c101d37a05a1af.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1gyo9j20m80bq754_hu_184ae9f97196ce15.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1gyo9j20m80bq754_hu_5f517c0ee6c9b245.webp&#34;
               width=&#34;760&#34;
               height=&#34;401&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Istio&lt;/strong&gt; æ˜¯ä¸€ä¸ªç”± Googleï¼ŒIBM å’Œ Lyft å›¢é˜Ÿåˆä½œå¼€å‘çš„å¼€æºé¡¹ç›®ï¼Œå®ƒæä¾›äº†åŸºäºå¾®æœåŠ¡çš„åº”ç”¨ç¨‹åºå¤æ‚æ€§çš„è§£å†³æ–¹æ¡ˆï¼Œä»…ä¸¾å‡ ä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æµé‡ç®¡ç†&lt;/strong&gt; ï¼šè¶…æ—¶ï¼Œé‡è¯•ï¼Œè´Ÿè½½å‡è¡¡ï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§ï¼š&lt;/strong&gt; æœ€ç»ˆç”¨æˆ·èº«ä»½éªŒè¯å’Œæˆæƒï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯è§‚å¯Ÿæ€§ï¼š&lt;/strong&gt; è·Ÿè¸ªï¼Œç›‘æ§å’Œè®°å½•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€æœ‰è¿™äº›éƒ½å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå±‚ä¸­è§£å†³ï¼Œä½†æ˜¯æ‚¨çš„æœåŠ¡ä¸å†æ˜¯â€œå¾®å‹â€ï¼Œç›¸å¯¹äºæä¾›ä¸šåŠ¡ä»·å€¼çš„èµ„æºï¼Œå®ç°è¿™äº›çš„æ‰€æœ‰é¢å¤–å·¥ä½œéƒ½æ˜¯å…¬å¸èµ„æºçš„å‹åŠ›ã€‚æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;PMï¼šæ·»åŠ åé¦ˆåŠŸèƒ½éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;å¼€å‘ï¼šä¸¤ä¸ªå†²åˆºï¼ˆæ•æ·å¼€å‘ä¸­çš„æœ¯è¯­ï¼Œä¸€èˆ¬ä¸€ä¸ªå†²åˆºå‘¨æœŸ 30 å¤©ï¼‰ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;PMï¼šä»€ä¹ˆ&amp;hellip;&amp;hellip;ï¼Ÿé‚£åªæ˜¯ä¸€ä¸ª CRUDï¼&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;å¼€å‘ï¼šåˆ›å»º CRUD å¾ˆå®¹æ˜“ï¼Œä½†æˆ‘ä»¬éœ€è¦å¯¹ç”¨æˆ·å’ŒæœåŠ¡è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒã€‚è€Œä¸”ç”±äºç½‘ç»œä¸å¯é ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å®¢æˆ·ç«¯å®æ–½é‡è¯•å’Œç†”æ–­å™¨ï¼Œå¹¶ç¡®ä¿æˆ‘ä»¬ä¸ä¼šå ç”¨æ•´ä¸ªç³»ç»Ÿï¼Œæˆ‘ä»¬éœ€è¦ Timeout å’Œ Bulkheadsï¼Œå¦å¤–è¿˜è¦æ£€æµ‹æˆ‘ä»¬éœ€è¦ç›‘æ§çš„é—®é¢˜ï¼Œè·Ÿè¸ª[&amp;hellip; ]&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;PMï¼šé‚£ä¹ˆæˆ‘ä»¬å°±æŠŠå®ƒæ”¾åœ¨äº§å“æœåŠ¡ä¸­å§ã€‚å“å‘€ï¼&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ä½ æ˜ç™½äº†ï¼Œå¿…é¡»æ»¡è¶³æ‰€æœ‰å½¢å¼æ‰å¯ä»¥ä¸ºæˆ‘ä»¬æ·»åŠ ä¸€é¡¹å·¨å¤§çš„æœåŠ¡ï¼ˆæœ‰å¾ˆå¤šä¸æ˜¯ä¸šåŠ¡åŠŸèƒ½çš„ä»£ç ï¼‰ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤º Istio å¦‚ä½•ä»æˆ‘ä»¬çš„æœåŠ¡ä¸­åˆ é™¤æ‰€æœ‰ä¸Šè¿°äº¤å‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-1å¾®æœåŠ¡çš„å½¢å¼æ„æˆ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1.å¾®æœåŠ¡çš„å½¢å¼æ„æˆ&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1x75cj20ai081t8l_hu_f1d12f072b059cab.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1x75cj20ai081t8l_hu_47c895f9a701c678.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1x75cj20ai081t8l_hu_7806240f2c98b7e5.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1x75cj20ai081t8l_hu_f1d12f072b059cab.webp&#34;
               width=&#34;378&#34;
               height=&#34;289&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1.å¾®æœåŠ¡çš„å½¢å¼æ„æˆ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šæœ¬æ–‡å‡è®¾æ‚¨å…·æœ‰ Kubernetes çš„çŸ¥è¯†ã€‚å¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼Œæˆ‘å»ºè®®æ‚¨é˜…è¯» &lt;a href=&#34;https://medium.freecodecamp.org/learn-kubernetes-in-under-3-hours-a-detailed-guide-to-orchestrating-containers-114ff420e882&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘å¯¹ Kubernetes çš„ä»‹ç»&lt;/a&gt;ï¼Œç„¶åç»§ç»­é˜…è¯»æœ¬æ–‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äº-istio&#34;&gt;å…³äº Istio&lt;/h2&gt;
&lt;p&gt;åœ¨æ²¡æœ‰ Istio çš„ä¸–ç•Œä¸­ï¼Œä¸€ä¸ªæœåŠ¡å‘å¦ä¸€ä¸ªæœåŠ¡ç›´æ¥å‘å‡ºè¯·æ±‚ï¼Œå¹¶ä¸”åœ¨å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡éœ€è¦é€šè¿‡é‡è¯•ï¼Œè¶…æ—¶ï¼Œæ‰“å¼€ç†”æ–­å™¨ç­‰æ¥å¤„ç†å®ƒã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-2-kubernetes-ä¸­çš„ç½‘ç»œæµé‡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 2. Kubernetes ä¸­çš„ç½‘ç»œæµé‡&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1eu2vj20m8054dg4_hu_e5d9dbc74b54693d.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1eu2vj20m8054dg4_hu_39e66ef6834812bd.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1eu2vj20m8054dg4_hu_1b3f2a66aeb54b56.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1eu2vj20m8054dg4_hu_e5d9dbc74b54693d.webp&#34;
               width=&#34;760&#34;
               height=&#34;175&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 2. Kubernetes ä¸­çš„ç½‘ç»œæµé‡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒIstio é€šè¿‡ä¸æœåŠ¡å®Œå…¨åˆ†ç¦»ï¼Œå¹¶é€šè¿‡æ‹¦æˆªæ‰€æœ‰ç½‘ç»œé€šä¿¡æ¥æä¾›ä¸€ç§å·§å¦™çš„è§£å†³æ–¹æ¡ˆã€‚è¿™æ ·åšå¯ä»¥å®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Fault Tolerance&lt;/strong&gt; â€Š- ä½¿ç”¨å“åº”çŠ¶æ€ä»£ç ï¼Œå®ƒå¯ä»¥åœ¨è¯·æ±‚å¤±è´¥å¹¶é‡è¯•æ—¶ç†è§£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Canary Rollouts&lt;/strong&gt; â€Š- ä»…å°†æŒ‡å®šç™¾åˆ†æ¯”çš„è¯·æ±‚è½¬å‘åˆ°æ–°ç‰ˆæœ¬çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§å’ŒæŒ‡æ ‡&lt;/strong&gt; â€Š- æœåŠ¡å“åº”æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·Ÿè¸ªå’Œå¯è§‚å¯Ÿæ€§&lt;/strong&gt; â€Š- å®ƒåœ¨æ¯ä¸ªè¯·æ±‚ä¸­æ·»åŠ ç‰¹æ®Š headerï¼Œå¹¶åœ¨é›†ç¾¤ä¸­è·Ÿè¸ªå®ƒä»¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt; â€Š- æå– JWT ä»¤ç‰Œå¹¶å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»…ä¸¾å‡ ä¾‹ï¼ˆä»…ä¸¾å‡ ä¾‹ï¼‰ï¼Œè®©æ‚¨æ„Ÿå…´è¶£ï¼æˆ‘ä»¬æ¥çœ‹ä¸€äº›æŠ€æœ¯ç»†èŠ‚å§ï¼&lt;/p&gt;
&lt;h2 id=&#34;istio-çš„æ¶æ„&#34;&gt;Istio çš„æ¶æ„&lt;/h2&gt;
&lt;p&gt;Istio æ‹¦æˆªæ‰€æœ‰ç½‘ç»œæµé‡ï¼Œå¹¶é€šè¿‡åœ¨æ¯ä¸ª pod ä¸­æ³¨å…¥æ™ºèƒ½ä»£ç†ä½œä¸º sidecar æ¥åº”ç”¨ä¸€ç»„è§„åˆ™ã€‚å¯ç”¨æ‰€æœ‰åŠŸèƒ½çš„ä»£ç†åŒ…æ‹¬ &lt;strong&gt;æ•°æ®å¹³é¢&lt;/strong&gt;ï¼Œå¹¶ä¸”è¿™äº›ä»£ç†å¯ç”±&lt;strong&gt;æ§åˆ¶å¹³é¢&lt;/strong&gt; åŠ¨æ€é…ç½®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ•°æ®å¹³é¢&#34;&gt;æ•°æ®å¹³é¢&lt;/h2&gt;
&lt;p&gt;æ³¨å…¥çš„ä»£ç†ä½¿ Istio èƒ½å¤Ÿè½»æ¾æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹é‡è¯•å’Œç†”æ–­å™¨åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-3envoy-å¦‚ä½•å®ç°-retries-å’Œ-circuitbreaking&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 3.Envoy å¦‚ä½•å®ç° Retries å’Œ CircuitBreaking&#34;
           src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu34d0gg20m808a1kx.gif&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 3.Envoy å¦‚ä½•å®ç° Retries å’Œ CircuitBreaking
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ€»ç»“ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Envoy å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡ B çš„ç¬¬ä¸€ä¸ªå®ä¾‹ï¼Œä½†å®ƒå¤±è´¥äº†ã€‚&lt;/li&gt;
&lt;li&gt;Envoy sidecar é‡è¯•ã€‚ï¼ˆ1ï¼‰&lt;/li&gt;
&lt;li&gt;è¿”å›å¯¹è°ƒç”¨ä»£ç†çš„å¤±è´¥è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;è¿™å°†æ‰“å¼€ç†”æ–­å™¨å¹¶åœ¨åç»­è¯·æ±‚ä¸­è°ƒç”¨ä¸‹ä¸€ä¸ªæœåŠ¡ã€‚ï¼ˆ2ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™æ„å‘³ç€æ‚¨ä¸å¿…ä½¿ç”¨å¦ä¸€ä¸ªé‡è¯•åº“ï¼Œæ‚¨ä¸å¿…åœ¨ç¼–ç¨‹è¯­è¨€ Xï¼ŒY æˆ– Z ä¸­å¼€å‘è‡ªå·±çš„ Circuit Breaking å’Œ Service Discovery å®ç°ã€‚æ‰€æœ‰è¿™äº›éƒ½æ˜¯å¼€ç®±å³ç”¨çš„ã€‚è¿™äº›åŠŸèƒ½éƒ½æ˜¯é€šè¿‡ Istio æ¥å®ç°ï¼Œä½ ä¸éœ€è¦æ›´æ”¹ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;å¾ˆå¥½ï¼ç°åœ¨ä½ æƒ³åŠ å…¥ Istio çš„èˆªè¡Œï¼Œä½†ä½ ä»ç„¶æœ‰ä¸€äº›ç–‘è™‘ï¼Œä¸€äº›æ‚¬è€Œæœªå†³çš„é—®é¢˜ã€‚è¿™æ˜¯ä¸€ä¸ªä¸€åˆ€åˆ‡çš„æ–¹æ¡ˆï¼Œä½ å¯¹å®ƒæŒæ€€ç–‘æ€åº¦ï¼Œå› ä¸ºå®ƒæ€»æ˜¯æœ€ç»ˆæˆä¸ºä¸€åˆ€åˆ‡çš„æ— è§£æ–¹æ¡ˆï¼&lt;/p&gt;
&lt;p&gt;ä½ æœ€ç»ˆä½å£°è¯´äº†è¿™ä¸ªé—®é¢˜ï¼šâ€œè¿™æ˜¯å¯é…ç½®çš„å—ï¼Ÿâ€&lt;/p&gt;
&lt;p&gt;æ¬¢è¿æˆ‘çš„æœ‹å‹æ¥å·¡èˆªï¼Œæˆ‘ä»¬å°†ä¸ºå¤§å®¶ä»‹ç»ä¸€ä¸‹æ§åˆ¶å¹³é¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ§åˆ¶å¹³é¢&#34;&gt;æ§åˆ¶å¹³é¢&lt;/h2&gt;
&lt;p&gt;ç”±ä¸‰ä¸ªç»„ä»¶ç»„æˆï¼š &lt;strong&gt;Pilot&lt;/strong&gt;ã€ &lt;strong&gt;Mixer&lt;/strong&gt; å’Œ &lt;strong&gt;Citadel&lt;/strong&gt;ï¼Œå®ƒä»¬ç»„åˆä½¿ç”¨ Envoys æ¥è·¯ç”±æµé‡ï¼Œå®æ–½ç­–ç•¥å’Œæ”¶é›†é¥æµ‹æ•°æ®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-4ä¸æ•°æ®å¹³é¢ç›¸å…³çš„æ§åˆ¶å¹³é¢&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 4.ä¸æ•°æ®å¹³é¢ç›¸å…³çš„æ§åˆ¶å¹³é¢&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2b2mqj20m80eogn9_hu_669cb3fc8cf37ca9.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2b2mqj20m80eogn9_hu_51a46ed740766f9c.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2b2mqj20m80eogn9_hu_273601cabf980a34.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2b2mqj20m80eogn9_hu_669cb3fc8cf37ca9.webp&#34;
               width=&#34;760&#34;
               height=&#34;502&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 4.ä¸æ•°æ®å¹³é¢ç›¸å…³çš„æ§åˆ¶å¹³é¢
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Envoyï¼ˆå³æ•°æ®å¹³é¢ï¼‰ä½¿ç”¨ç”± Istio å®šä¹‰çš„ &lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes è‡ªå®šä¹‰èµ„æºå®šä¹‰&lt;/a&gt; è¿›è¡Œé…ç½®ã€‚è¿™æ„å‘³ç€å¯¹ä½ è€Œè¨€ï¼Œå®ƒåªæ˜¯å¦ä¸€ä¸ªå…·æœ‰ç†Ÿæ‚‰è¯­æ³•çš„ Kubernetes èµ„æºã€‚åˆ›å»ºåå°†ç”±&lt;strong&gt;æ§åˆ¶å¹³é¢&lt;/strong&gt;è·å–ï¼Œå¹¶å°†å…¶åº”ç”¨äº Envoyã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ä¸-istio-çš„å…³ç³»&#34;&gt;æœåŠ¡ä¸ Istio çš„å…³ç³»&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬æè¿°äº† Istio ä¸æˆ‘ä»¬æœåŠ¡çš„å…³ç³»ï¼Œä½†æˆ‘ä»¬åè¿‡æ¥æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„æœåŠ¡ä¸ Istio çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¦ç‡åœ°è¯´ï¼Œæˆ‘ä»¬çš„æœåŠ¡å¯¹ Istio çš„å­˜åœ¨æœ‰ç€å°½å¯èƒ½å¤šçš„äº†è§£ï¼Œå°±åƒé±¼å¯¹æ°´ä¸€æ ·ï¼Œä»–ä»¬ä¼šé—®è‡ªå·±â€œè¿™åˆ°åº•æ˜¯ä»€ä¹ˆæ°´ï¼Ÿâ€ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-victoria-dimitrakopoulos&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Victoria Dimitrakopoulos&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1l39rj20m809tqd9_hu_1ae92d9515f0d015.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1l39rj20m809tqd9_hu_cfd198f0662866fe.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1l39rj20m809tqd9_hu_2c3a867ceb03ba03.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1l39rj20m809tqd9_hu_1ae92d9515f0d015.webp&#34;
               width=&#34;760&#34;
               height=&#34;335&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Victoria Dimitrakopoulos
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™æ„å‘³ç€æ‚¨å¯ä»¥é€‰æ‹©ä¸€ä¸ªå·¥ä½œé›†ç¾¤ï¼Œåœ¨éƒ¨ç½²äº† Istio çš„ç»„ä»¶åï¼Œå…¶ä¸­çš„æœåŠ¡å°†ç»§ç»­å·¥ä½œï¼Œå¹¶ä¸”ä»¥ç›¸åŒçš„æ–¹å¼ï¼Œæ‚¨å¯ä»¥åˆ é™¤ç»„ä»¶ï¼Œä¸€åˆ‡éƒ½ä¼šå¾ˆå¥½ã€‚å¯ä»¥ç†è§£çš„æ˜¯ï¼Œæ‚¨å°†å¤±å» Istio æä¾›çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»æœ‰è¶³å¤Ÿçš„ç†è®ºï¼Œä¸‹é¢è®©æˆ‘ä»¬æŠŠè¿™äº›ç†è®ºä»˜è¯¸å®è·µï¼&lt;/p&gt;
&lt;h2 id=&#34;istio-å®è·µ&#34;&gt;Istio å®è·µ&lt;/h2&gt;
&lt;p&gt;Istio è‡³å°‘éœ€è¦ä¸€ä¸ªå…·æœ‰ 4 ä¸ª vCPU å’Œ 8 GB RAM çš„ Kubernetes é›†ç¾¤ã€‚è¦å¿«é€Ÿè®¾ç½®é›†ç¾¤å¹¶è·Ÿè¿›æœ¬æ–‡ï¼Œæˆ‘å»ºè®®ä½¿ç”¨ Google äº‘ç«¯å¹³å°ï¼Œå®ƒä¸ºæ–°ç”¨æˆ·æä¾› &lt;a href=&#34;https://console.developers.google.com/billing/freetrial?hl=en&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;300 ç¾å…ƒçš„å…è´¹è¯•ç”¨ç‰ˆ&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Kubernetes å‘½ä»¤è¡Œå·¥å…·åˆ›å»ºé›†ç¾¤å¹¶é…ç½®è®¿é—®åï¼Œæˆ‘ä»¬å·²å‡†å¤‡å¥½ä½¿ç”¨ Helm Package ç®¡ç†å™¨å®‰è£… Istioã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…-helm&#34;&gt;å®‰è£… Helm&lt;/h2&gt;
&lt;p&gt;æŒ‰ç…§&lt;a href=&#34;https://docs.helm.sh/using_helm/#installing-the-helm-client&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ä¸­çš„è¯´æ˜åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šå®‰è£… Helm å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­ä½¿ç”¨å®ƒæ¥ç”Ÿæˆ Istio å®‰è£…æ¨¡æ¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…-istio&#34;&gt;å®‰è£… Istio&lt;/h2&gt;
&lt;p&gt;ä»&lt;a href=&#34;https://github.com/istio/istio/releases/tag/1.0.5&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ€æ–°ç‰ˆæœ¬&lt;/a&gt;ä¸‹è½½ Istio çš„èµ„æºï¼Œå°†å†…å®¹æå–åˆ°ä¸€ä¸ªæˆ‘ä»¬å°†ç§°ä¹‹ä¸ºçš„ç›®å½•ä¸­&lt;code&gt;[istio-resources]&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;è¦è½»æ¾è¯†åˆ« Istio èµ„æº &lt;code&gt;istio-system&lt;/code&gt;ï¼Œè¯·åœ¨ Kubernetes é›†ç¾¤ä¸­åˆ›å»ºå‘½åç©ºé—´ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl create namespace istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åè¿›å…¥åˆ° &lt;code&gt;[istio-resources]&lt;/code&gt; ç›®å½•å¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®Œæˆå®‰è£…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ helm template install/kubernetes/helm/istio &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; --set global.mtls.enabled &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; --set tracing.enabled &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; --set kiali.enabled &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; --set grafana.enabled &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; --namespace istio-system &amp;gt; istio.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢çš„å‘½ä»¤å°† Istio çš„æ ¸å¿ƒç»„ä»¶è¾“å‡ºåˆ°æ–‡ä»¶ &lt;code&gt;istio.yaml&lt;/code&gt; ä¸­ã€‚æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‚æ•°è‡ªå®šä¹‰æ¨¡æ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;global.mtls.enabled&lt;/strong&gt; è®¾ç½®ä¸º false ä»¥ä¿æŒå¼•å…¥çš„é‡ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;tracing.enabled&lt;/strong&gt; å…è®¸ä½¿ç”¨ jaeger è·Ÿè¸ªè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;kiali.enabled&lt;/strong&gt; åœ¨æˆ‘ä»¬çš„é›†ç¾¤ä¸­å®‰è£… Kiali ä»¥å®ç°æœåŠ¡å’Œæµé‡çš„å¯è§†åŒ–&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;grafana.enabled&lt;/strong&gt; å®‰è£… Grafanaï¼Œä¸ºäº†æ”¶é›†æŒ‡æ ‡çš„å¯è§†åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åº”ç”¨ç”Ÿæˆçš„èµ„æº&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f istio.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ ‡å¿—ç€æˆ‘ä»¬é›†ç¾¤ä¸­ Istio å®‰è£…çš„å®Œæˆï¼ç­‰åˆ°&lt;code&gt;istio-system&lt;/code&gt;å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰ pod éƒ½å¤„äº Running æˆ– Completed çŠ¶æ€ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬å·²å‡†å¤‡å¥½ç»§ç»­ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­å¯åŠ¨å¹¶è¿è¡Œç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;h2 id=&#34;sentiment-analysis-åº”ç”¨æ¶æ„&#34;&gt;Sentiment Analysis åº”ç”¨æ¶æ„&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨&lt;a href=&#34;https://medium.freecodecamp.org/learn-kubernetes-in-under-3-hours-a-detailed-guide-to-orchestrating-containers-114ff420e882&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes ç®€ä»‹æ–‡ç« &lt;/a&gt;ä¸­ä½¿ç”¨çš„ç›¸åŒå¾®æœåŠ¡åº”ç”¨ç¨‹åºï¼Œå®ƒè¶³ä»¥åœ¨å®è·µä¸­å±•ç¤º Istio çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥åº”ç”¨ç¨‹åºç”±å››ä¸ªå¾®æœåŠ¡ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SA-Frontend æœåŠ¡&lt;/strong&gt; ï¼šæä¾›å‰ç«¯ Reactjs åº”ç”¨ç¨‹åºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SA-WebApp æœåŠ¡&lt;/strong&gt; ï¼šå¤„ç†å¯¹ Sentiment Analysis çš„è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SA-Logic æœåŠ¡&lt;/strong&gt; ï¼šæ‰§è¡Œ sentiment Analysisã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SA åé¦ˆæœåŠ¡&lt;/strong&gt; ï¼šæ¥æ”¶ç”¨æˆ·å…³äºåˆ†æå‡†ç¡®æ€§çš„åé¦ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-6-æƒ…æ„Ÿåˆ†æå¾®æœåŠ¡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 6 æƒ…æ„Ÿåˆ†æå¾®æœåŠ¡&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2q2ppj20m80apmxy_hu_f4938bf54b0c768f.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2q2ppj20m80apmxy_hu_1742b977a327e0f8.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2q2ppj20m80apmxy_hu_3baa3afed947a840.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2q2ppj20m80apmxy_hu_f4938bf54b0c768f.webp&#34;
               width=&#34;760&#34;
               height=&#34;366&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 6 æƒ…æ„Ÿåˆ†æå¾®æœåŠ¡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨å›¾ 6 ä¸­ï¼Œé™¤äº†æœåŠ¡ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜çœ‹åˆ° Ingress Controller åœ¨ Kubernetes ä¸­å°†ä¼ å…¥çš„è¯·æ±‚è·¯ç”±åˆ°é€‚å½“çš„æœåŠ¡ï¼ŒIstio ä½¿ç”¨äº†ä¸€ä¸ªåä¸º Ingress Gateway çš„ç±»ä¼¼æ¦‚å¿µï¼Œå°†åœ¨æœ¬æ–‡çš„åç»­éƒ¨åˆ†ä¸­ä»‹ç»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-istio-proxies-è¿è¡Œåº”ç”¨ç¨‹åº&#34;&gt;ä½¿ç”¨ Istio Proxies è¿è¡Œåº”ç”¨ç¨‹åº&lt;/h2&gt;
&lt;p&gt;è¦è·Ÿè¿›æœ¬æ–‡ï¼Œè¯·å…‹éš†å­˜å‚¨åº“ istio-masteryï¼ˆ &lt;a href=&#34;https://github.com/rinormaloku/istio-mastery&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/rinormaloku/istio-mastery&lt;/a&gt; ï¼‰ï¼Œå…¶ä¸­åŒ…å« Kubernetes å’Œ Istio çš„åº”ç”¨ç¨‹åºå’Œæ¸…å•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;sidecar-injection&#34;&gt;Sidecar Injection&lt;/h3&gt;
&lt;p&gt;æ³¨å…¥æ˜¯ &lt;strong&gt;è‡ªåŠ¨&lt;/strong&gt; æˆ– &lt;strong&gt;æ‰‹åŠ¨&lt;/strong&gt; å®Œæˆçš„ã€‚è¦å¯ç”¨è‡ªåŠ¨ sidecar æ³¨å…¥ï¼Œæˆ‘ä»¬éœ€è¦ &lt;code&gt;istio-injection=enabled&lt;/code&gt; é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ æ¥æ ‡è®°å‘½åç©ºé—´ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl label namespace default istio-injection&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;enabled
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;namespace/default labeled
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»ç°åœ¨å¼€å§‹ï¼Œéƒ¨ç½²åˆ°é»˜è®¤å‘½åç©ºé—´çš„æ¯ä¸ª pod éƒ½å°†è·å¾—æ³¨å…¥çš„ sidecarã€‚ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬é€šè¿‡è¿›å…¥åˆ° &lt;code&gt;[istio-mastery]&lt;/code&gt; å­˜å‚¨åº“çš„æ ¹æ–‡ä»¶å¤¹ å¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ æ¥éƒ¨ç½²ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/kube
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;persistentvolumeclaim/sqlite-pvc created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions/sa-feedback created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/sa-feedback created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions/sa-frontend created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/sa-frontend created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions/sa-logic created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/sa-logic created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions/sa-web-app created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/sa-web-app created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨éƒ¨ç½²çš„æœåŠ¡ä¸­ï¼Œé€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ &lt;code&gt;kubectl get pods&lt;/code&gt; éªŒè¯ pod æœ‰ä¸¤ä¸ªå®¹å™¨ï¼ˆservice å’Œ sidecarï¼‰ï¼Œå¹¶ç¡®ä¿å‡†å¤‡å¥½åï¼Œæˆ‘ä»¬çœ‹åˆ°å€¼â€œ &lt;strong&gt;2/2&lt;/strong&gt; â€è¡¨ç¤ºä¸¤ä¸ªå®¹å™¨éƒ½åœ¨è¿è¡Œã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                           READY     STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-feedback-55f5dc4d9c-c9wfv   2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          12m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-frontend-558f8986-hhkj9     2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          12m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-logic-568498cb4d-2sjwj      2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          12m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-logic-568498cb4d-p4f8c      2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          12m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-web-app-599cf47c7c-s7cvd    2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          12m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§†è§‰å‘ˆç°åœ¨å›¾ 7 ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-7å…¶ä¸­ä¸€ä¸ª-pod-ä¸­çš„-envoy-ä»£ç†&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 7.å…¶ä¸­ä¸€ä¸ª Pod ä¸­çš„ Envoy ä»£ç†&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ti9mj209n0dtwf8_hu_a98357f15e2c396a.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ti9mj209n0dtwf8_hu_ca3ee187eae9a222.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ti9mj209n0dtwf8_hu_482819b4db0f755f.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ti9mj209n0dtwf8_hu_a98357f15e2c396a.webp&#34;
               width=&#34;347&#34;
               height=&#34;497&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 7.å…¶ä¸­ä¸€ä¸ª Pod ä¸­çš„ Envoy ä»£ç†
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œåº”ç”¨ç¨‹åºå¯åŠ¨å¹¶è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦å…è®¸ä¼ å…¥æµé‡åˆ°è¾¾æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…¥å£ç½‘å…³&#34;&gt;å…¥å£ç½‘å…³&lt;/h2&gt;
&lt;p&gt;å…è®¸æµé‡è¿›å…¥é›†ç¾¤çš„æœ€ä½³åšæ³•æ˜¯é€šè¿‡ Istio çš„ &lt;strong&gt;å…¥å£ç½‘å…³&lt;/strong&gt; å°†å…¶è‡ªèº«ç½®äºé›†ç¾¤çš„è¾¹ç¼˜ï¼Œå¹¶åœ¨ä¼ å…¥æµé‡ä¸Šå®ç° Istio çš„åŠŸèƒ½ï¼Œå¦‚è·¯ç”±ï¼Œè´Ÿè½½å‡è¡¡ï¼Œå®‰å…¨æ€§å’Œç›‘æ§ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio çš„å®‰è£…è¿‡ç¨‹ä¸­ï¼Œ &lt;code&gt;Ingress Gateway&lt;/code&gt; ç»„ä»¶å’Œåœ¨å¤–éƒ¨å…¬å¼€å®ƒçš„æœåŠ¡å·²å®‰è£…åˆ°é›†ç¾¤ä¸­ã€‚è¦è·å–æœåŠ¡å¤–éƒ¨ IPï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get svc -n istio-system -l &lt;span class=&#34;nv&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ingressgateway
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                   TYPE           CLUSTER-IP     EXTERNAL-IP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-ingressgateway   LoadBalancer   10.0.132.127   13.93.30.120
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æœ¬æ–‡çš„åç»­éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®¿é—®æ­¤ IP ä¸Šçš„åº”ç”¨ç¨‹åºï¼ˆç§°ä¸º EXTERNAL-IPï¼‰ï¼Œä¸ºæ–¹ä¾¿èµ·è§ï¼Œé€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†å…¶ä¿å­˜åœ¨å˜é‡ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;EXTERNAL_IP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get svc -n istio-system &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istio-ingressgateway &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].status.loadBalancer.ingress[0].ip}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæ‚¨åœ¨æµè§ˆå™¨ä¸­è®¿é—®æ­¤ IP å¹¶ä¸”æ‚¨å°†æ”¶åˆ°æœåŠ¡ä¸å¯ç”¨é”™è¯¯ï¼Œåˆ™ &lt;strong&gt;é»˜è®¤æƒ…å†µä¸‹ Istio å°†é˜»æ­¢ä»»ä½•ä¼ å…¥æµé‡&lt;/strong&gt;ï¼Œç›´åˆ°æˆ‘ä»¬å®šä¹‰ç½‘å…³ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç½‘å…³èµ„æº&#34;&gt;ç½‘å…³èµ„æº&lt;/h2&gt;
&lt;p&gt;ç½‘å…³æ˜¯åœ¨æˆ‘ä»¬çš„é›†ç¾¤ä¸­å®‰è£… Istio æ—¶å®šä¹‰çš„ Kubernetes è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼Œä½¿æˆ‘ä»¬èƒ½å¤ŸæŒ‡å®šæˆ‘ä»¬å¸Œæœ›å…è®¸ä¼ å…¥æµé‡çš„ç«¯å£ï¼Œåè®®å’Œä¸»æœºã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å…è®¸æ‰€æœ‰ä¸»æœºåœ¨ç«¯å£ 80 ä¸Šä½¿ç”¨ HTTP æµé‡ã€‚è¾¾åˆ°ä»¥ä¸‹å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é™¤äº†é€‰æ‹©å™¨&lt;code&gt;istioï¼šingressgateway&lt;/code&gt;ä¹‹å¤–ï¼Œæ‰€æœ‰é…ç½®éƒ½æ˜¯ä¸éœ€è¦è¯´æ˜çš„ã€‚ä½¿ç”¨æ­¤é€‰æ‹©å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šåº”ç”¨é…ç½®çš„ Ingress Gatewayï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå®ƒæ˜¯å®‰è£…åœ¨ Istio è®¾ç½®ä¸Šçš„é»˜è®¤å…¥å£ç½‘å…³æ§åˆ¶å™¨ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åº”ç”¨é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/http-gateway.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gateway.networking.istio.io/http-gateway created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç½‘å…³ç°åœ¨å…è®¸åœ¨ç«¯å£ 80 ä¸­è¿›è¡Œè®¿é—®ï¼Œä½†å®ƒä¸çŸ¥é“åœ¨ä½•å¤„è·¯ç”±è¯·æ±‚ã€‚è¿™éœ€è¦ä½¿ç”¨&lt;strong&gt;Virtual Service&lt;/strong&gt;æ¥å®ç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;virtualservice-èµ„æº&#34;&gt;VirtualService èµ„æº&lt;/h2&gt;
&lt;p&gt;VirtualService æŒ‡ç¤º Ingress Gateway å¦‚ä½•è·¯ç”±å…è®¸è¿›å…¥é›†ç¾¤çš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæˆ‘ä»¬åº¦è¿‡å³å°†åˆ°æ¥çš„åº”ç”¨ç¨‹åºè¯·æ±‚ &lt;strong&gt;HTTP ç½‘å…³&lt;/strong&gt; å¿…é¡»è¢«è·¯ç”±åˆ° &lt;code&gt;sa-frontend&lt;/code&gt;ï¼Œ&lt;code&gt;sa-web-app&lt;/code&gt; å’Œ&lt;code&gt;sa-feedback&lt;/code&gt; æœåŠ¡ï¼ˆå‡ºäº†å¦‚å›¾ 8ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-8ä½¿ç”¨-virtualservices-é…ç½®çš„è·¯ç”±&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 8.ä½¿ç”¨ VirtualServices é…ç½®çš„è·¯ç”±&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2n39aj20m80gk75x_hu_891332d924f252ce.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2n39aj20m80gk75x_hu_27ee6da56ca958f9.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2n39aj20m80gk75x_hu_cae726e33998eddb.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2n39aj20m80gk75x_hu_891332d924f252ce.webp&#34;
               width=&#34;760&#34;
               height=&#34;566&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 8.ä½¿ç”¨ VirtualServices é…ç½®çš„è·¯ç”±
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬åˆ†è§£ä»¥ä¸‹è·¯ç”±åˆ° SA-Frontend çš„è¯·æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;**/**&lt;/code&gt; åº”å°†&lt;strong&gt;ç²¾ç¡®è·¯å¾„&lt;/strong&gt; è·¯ç”±åˆ° SA-Frontend ä»¥è·å– Index.html&lt;/li&gt;
&lt;li&gt;&lt;code&gt;**/static/***&lt;/code&gt; åº”å°†&lt;strong&gt;å‰ç¼€è·¯å¾„&lt;/strong&gt; è·¯ç”±åˆ° SA-Frontend ä»¥è·å–å‰ç«¯æ‰€éœ€çš„ä»»ä½•é™æ€æ–‡ä»¶ï¼Œå¦‚ Css å’Œ JavaScript æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„è·¯å¾„&lt;/strong&gt;&lt;code&gt;&#39;^.*\.(ico|png|jpg)$&#39;&lt;/code&gt; åº”è¯¥è·¯ç”±åˆ° SA-Frontendï¼Œæˆ‘ä»¬åº”è¯¥æŠŠå›¾åƒèµ„æºè·¯ç”±åˆ°å‰ç«¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™æ˜¯é€šè¿‡ä»¥ä¸‹é…ç½®å®ç°çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-external-services&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;http-gateway                     &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/callback&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/static&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;^.*\.(ico|png|jpg)$&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-frontend            &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œçš„é‡ç‚¹æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ­¤ VirtualService é€‚ç”¨äºé€šè¿‡&lt;strong&gt;http ç½‘å…³&lt;/strong&gt; å‘å‡ºçš„è¯·æ±‚&lt;/li&gt;
&lt;li&gt;Destination å®šä¹‰è¯·æ±‚è·¯ç”±åˆ°çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šä¸Šé¢çš„é…ç½®ä½äºæ–‡ä»¶ä¸­ &lt;code&gt;sa-virtualservice-external.yaml&lt;/code&gt;ï¼Œå®ƒè¿˜åŒ…å«ç”¨äºè·¯ç”±åˆ° SA-WebApp å’Œ SA-Feedback çš„é…ç½®ï¼Œä½†ä¸ºç®€æ´èµ·è§ï¼Œå·²ç¼©çŸ­ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åº”ç”¨ VirtualServiceï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/sa-virtualservice-external.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;virtualservice.networking.istio.io/sa-external-services created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šå½“æˆ‘ä»¬åº”ç”¨ Istio èµ„æºæ—¶ï¼ŒKubernetes API æœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ªç”± Istio æ§åˆ¶å¹³é¢æ¥æ”¶çš„äº‹ä»¶ï¼Œç„¶åå°†æ–°é…ç½®åº”ç”¨äºæ¯ä¸ª pod çš„ Envoy ä»£ç†ã€‚Ingress Gateway æ§åˆ¶å™¨æ˜¯å¦ä¸€ä¸ªç”±æ§åˆ¶å¹³é¢é…ç½®çš„ Envoyï¼Œå¦‚å›¾ 9 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-9é…ç½®-istio-ingressgateway-æ¥è·¯ç”±è¯·æ±‚&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 9.é…ç½® Istio-IngressGateway æ¥è·¯ç”±è¯·æ±‚&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1t95sj20m80i2jt1_hu_30d66e6384f72e7.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1t95sj20m80i2jt1_hu_e2773980e0a56bc9.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1t95sj20m80i2jt1_hu_c347d0f5c96d4950.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1t95sj20m80i2jt1_hu_30d66e6384f72e7.webp&#34;
               width=&#34;760&#34;
               height=&#34;618&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 9.é…ç½® &lt;strong&gt;Istio-IngressGateway&lt;/strong&gt; æ¥è·¯ç”±è¯·æ±‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç°åœ¨å¯ä»¥è®¿é—® Sentiment Analysis åº”ç”¨ç¨‹åºäº† &lt;code&gt;http://{EXTERNAL-IP}/&lt;/code&gt; ã€‚å¦‚æœæ‚¨è·å¾— Not Found çŠ¶æ€ï¼Œè¯·ä¸è¦æ‹…å¿ƒ &lt;em&gt;æœ‰æ—¶éœ€è¦é…ç½®ç”Ÿæ•ˆæ‰èƒ½æ›´æ–° envoy çš„ç¼“å­˜&lt;/em&gt; ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è½¬åˆ°ä¸‹ä¸€éƒ¨åˆ†ä¹‹å‰ï¼Œè¯·ä½¿ç”¨è¯¥åº”ç”¨ç¨‹åºç”Ÿæˆä¸€äº›æµé‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kiali---å¯è§‚å¯Ÿæ€§&#34;&gt;Kiali - å¯è§‚å¯Ÿæ€§&lt;/h2&gt;
&lt;p&gt;è¦è®¿é—® Kiali çš„ Admin UIï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl port-forward &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -n istio-system -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kiali &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -n istio-system &lt;span class=&#34;m&#34;&gt;20001&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¹¶ &lt;a href=&#34;http://localhost:20001/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:20001/&lt;/a&gt; ä½¿ç”¨â€œadminâ€ï¼ˆä¸å«å¼•å·ï¼‰ä¸ºç”¨æˆ·å’Œå¯†ç æ‰“å¼€ç™»å½•ã€‚æœ‰å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ£€æŸ¥ Istio ç»„ä»¶çš„é…ç½®ï¼Œæ ¹æ®æ‹¦æˆªç½‘ç»œè¯·æ±‚å’Œå›ç­”æ”¶é›†çš„ä¿¡æ¯å¯è§†åŒ–æœåŠ¡ï¼Œâ€œè°åœ¨è°ƒç”¨è°ï¼Ÿâ€ï¼Œâ€œå“ªä¸ªç‰ˆæœ¬çš„æœåŠ¡æœ‰æ•…éšœï¼Ÿâ€ç­‰ç­‰ï¼ŒèŠ±ä¸€äº›æ—¶é—´æ£€éªŒ Kiali çš„åŠŸèƒ½ï¼Œç„¶åå†è½¬åˆ°ä¸‹ä¸€èŠ‚ï¼Œç”¨ Grafana å¯è§†åŒ–æŒ‡æ ‡ï¼&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-10-kiali---æœåŠ¡å¯è§‚å¯Ÿæ€§&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 10. Kiali - æœåŠ¡å¯è§‚å¯Ÿæ€§&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu28njyj20m80c7mye_hu_1ef53bdd58786bf.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu28njyj20m80c7mye_hu_1de793b4dede9a37.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu28njyj20m80c7mye_hu_d81ea3ac931f1d2b.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu28njyj20m80c7mye_hu_1ef53bdd58786bf.webp&#34;
               width=&#34;760&#34;
               height=&#34;417&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 10. Kiali - æœåŠ¡å¯è§‚å¯Ÿæ€§
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;grafana---åº¦é‡å¯è§†åŒ–&#34;&gt;Grafana - åº¦é‡å¯è§†åŒ–&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ Grafana å°† Istio æ”¶é›†çš„æŒ‡æ ‡åˆ’åˆ†ä¸º Prometheus å’Œ Visualizedã€‚è¦è®¿é—® Grafana çš„ Admin UIï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¹¶æ‰“å¼€&lt;a href=&#34;http://localhost:3000&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:3000&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n istio-system port-forward &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl -n istio-system get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;grafana &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;={&lt;/span&gt;.items&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.metadata.name&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;3000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨å·¦ä¸Šè§’å•å‡»èœå•&lt;strong&gt;Home&lt;/strong&gt; å¹¶é€‰æ‹© &lt;strong&gt;Istio Service Dashboard&lt;/strong&gt; å¹¶åœ¨å·¦ä¸Šè§’é€‰æ‹©ä»¥&lt;strong&gt;sa-web-app&lt;/strong&gt;å¼€å¤´çš„æœåŠ¡ï¼Œæ‚¨å°†çœ‹åˆ°æ”¶é›†çš„æŒ‡æ ‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1z8vbj20m80cnabv_hu_57f8441a42b4cdb7.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1z8vbj20m80cnabv_hu_3f32b79cfa3c222e.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1z8vbj20m80cnabv_hu_6d7a1051195ae1e5.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1z8vbj20m80cnabv_hu_57f8441a42b4cdb7.webp&#34;
               width=&#34;760&#34;
               height=&#34;432&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘çš„å¦ˆå‘€ï¼Œè¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰ä»»ä½•æ•°æ®çš„è§†å›¾ï¼Œç®¡ç†å±‚æ°¸è¿œä¸ä¼šèµåŒè¿™ä¸€ç‚¹ã€‚è®©æˆ‘ä»¬é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆä¸€äº›è´Ÿè½½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; true&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    curl -i http://&lt;span class=&#34;nv&#34;&gt;$EXTERNAL_IP&lt;/span&gt;/sentiment &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -H &lt;span class=&#34;s2&#34;&gt;&amp;#34;Content-type: application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;sentence&amp;#34;: &amp;#34;I love yogobella&amp;#34;}&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    sleep .8&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰æ›´æ¼‚äº®çš„å›¾è¡¨ï¼Œæ­¤å¤–ï¼Œæˆ‘ä»¬æ‹¥æœ‰ Prometheus ç”¨äºç›‘æ§å’Œ Grafana ç”¨äºå¯è§†åŒ–æŒ‡æ ‡è¿™äº›ä»¤äººæƒŠè®¶çš„å·¥å…·ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿéšæ—¶äº†è§£æœåŠ¡çš„æ€§èƒ½ï¼Œå¥åº·çŠ¶å†µï¼Œå‡çº§æˆ–é™çº§ï¼&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬å°†ç ”ç©¶æ•´ä¸ªæœåŠ¡ä¸­çš„è·Ÿè¸ªè¯·æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;jaeger---è¿½è¸ª&#34;&gt;Jaeger - è¿½è¸ª&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦è·Ÿè¸ªï¼Œå› ä¸ºæˆ‘ä»¬æ‰€æ‹¥æœ‰çš„æœåŠ¡è¶Šå¤šï¼Œå°±è¶Šéš¾æ‰¾å‡ºå¤±è´¥çš„åŸå› ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹é¢å›¾ç‰‡ä¸­çš„ç®€å•æ¡ˆä¾‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-12é€šå¸¸éšæœºå¤±è´¥çš„è¯·æ±‚&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 12.é€šå¸¸éšæœºå¤±è´¥çš„è¯·æ±‚&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ht7hj20m804fjrw_hu_7c1469ff0fc4837e.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ht7hj20m804fjrw_hu_ef9260060964f773.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ht7hj20m804fjrw_hu_5f223f19c3ba6410.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2ht7hj20m804fjrw_hu_7c1469ff0fc4837e.webp&#34;
               width=&#34;760&#34;
               height=&#34;151&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 12.é€šå¸¸éšæœºå¤±è´¥çš„è¯·æ±‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¯·æ±‚è¿›å…¥ï¼Œå¤±è´¥ï¼Œ&lt;em&gt;åŸå› æ˜¯ä»€ä¹ˆ&lt;/em&gt;ï¼Ÿ&lt;em&gt;ç¬¬ä¸€æ¬¡æœåŠ¡&lt;/em&gt;ï¼Ÿ&lt;em&gt;è¿˜æ˜¯ç¬¬äºŒä¸ª&lt;/em&gt;ï¼Ÿä¸¤è€…éƒ½æœ‰ä¾‹å¤–æƒ…å†µï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æ¯ä¸ªæ—¥å¿—ã€‚ä½ å‘ç°è‡ªå·±è¿™ä¹ˆåšäº†å¤šå°‘æ¬¡ï¼Ÿæˆ‘ä»¬çš„å·¥ä½œæ›´åƒæ˜¯è½¯ä»¶ä¾¦æ¢è€Œä¸æ˜¯å¼€å‘äººå‘˜ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯å¾®æœåŠ¡ä¸­çš„ä¸€ä¸ªæ™®éé—®é¢˜ï¼Œå®ƒä½¿ç”¨åˆ†å¸ƒå¼è·Ÿè¸ªç³»ç»Ÿè§£å†³ï¼Œå…¶ä¸­æœåŠ¡å°†å”¯ä¸€çš„ header ç›¸äº’ä¼ é€’ï¼Œç„¶åå°†æ­¤ä¿¡æ¯è½¬å‘åˆ°è¯·æ±‚è·Ÿè¸ªæ”¾åœ¨ä¸€èµ·çš„åˆ†å¸ƒå¼è·Ÿè¸ªç³»ç»Ÿã€‚ä¸€ä¸ªä¾‹å­å¦‚å›¾ 13 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-13ç”¨äºæ ‡è¯†è¯·æ±‚èŒƒå›´çš„-traceid&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 13.ç”¨äºæ ‡è¯†è¯·æ±‚èŒƒå›´çš„ TraceId&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2k4zsj20rs06uwfz_hu_83c25da89419d301.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2k4zsj20rs06uwfz_hu_19da2936ab9d6533.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2k4zsj20rs06uwfz_hu_c806aed838aafce4.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2k4zsj20rs06uwfz_hu_83c25da89419d301.webp&#34;
               width=&#34;760&#34;
               height=&#34;187&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 13.ç”¨äºæ ‡è¯†è¯·æ±‚èŒƒå›´çš„ TraceId
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio ä½¿ç”¨ Jaeger Tracer å®ç° OpenTracing APIï¼Œè¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹äºä¾›åº”å•†çš„æ¡†æ¶ã€‚è¦è®¿é—® Jaegers UIï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl port-forward -n istio-system &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -n istio-system -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;jaeger &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;16686&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶ååœ¨ &lt;a href=&#34;http://localhost:16686/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:16686&lt;/a&gt; ä¸­æ‰“å¼€ UIï¼Œé€‰æ‹© &lt;strong&gt;sa-web-app&lt;/strong&gt; æœåŠ¡ï¼Œ &lt;em&gt;å¦‚æœä¸‹æ‹‰åˆ—è¡¨ä¸­æœªæ˜¾ç¤ºè¯¥&lt;/em&gt;æœåŠ¡ï¼Œ&lt;em&gt;åˆ™åœ¨é¡µé¢ä¸Šç”Ÿæˆä¸€äº›æ´»åŠ¨å¹¶ç‚¹å‡»åˆ·æ–°&lt;/em&gt; ã€‚éšåå•å‡»è¯¥æŒ‰é’® &lt;strong&gt;æŸ¥æ‰¾ç—•è¿¹&lt;/strong&gt;ï¼Œè¿™æ˜¾ç¤ºæœ€è¿‘çš„ç—•è¿¹ï¼Œé€‰æ‹©ä»»ä½•å’Œæ‰€æœ‰çš„ç—•è¿¹çš„è¯¦ç»†åˆ†ç±»å°†ä¼šæ˜¾ç¤ºï¼Œå¦‚å›¾ 14 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-14-jaeger---è¯·æ±‚è·Ÿè¸ª&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 14. Jaeger - è¯·æ±‚è·Ÿè¸ª&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1ca17j20rs0bsgnr_hu_e3d707a5c53c5864.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1ca17j20rs0bsgnr_hu_b6fd982ebaf0d7c1.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1ca17j20rs0bsgnr_hu_80c744f19e09646d.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1ca17j20rs0bsgnr_hu_e3d707a5c53c5864.webp&#34;
               width=&#34;760&#34;
               height=&#34;322&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 14. Jaeger - è¯·æ±‚è·Ÿè¸ª
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è·Ÿè¸ªæ˜¾ç¤ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¯·æ±‚æ¥åˆ° &lt;strong&gt;istio-ingressgateway&lt;/strong&gt; ï¼ˆå®ƒæ˜¯ç¬¬ä¸€æ¬¡ä¸å…¶ä¸­ä¸€ä¸ªæœåŠ¡è”ç³»ï¼Œå› æ­¤å¯¹äºç”Ÿæˆè·Ÿè¸ª ID çš„è¯·æ±‚ï¼‰ç„¶åç½‘å…³å°†è¯·æ±‚è½¬å‘ç»™ &lt;code&gt;sa-web-app&lt;/code&gt; æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ &lt;code&gt;sa-web-app&lt;/code&gt; æœåŠ¡ä¸­ï¼Œè¯·æ±‚ç”± Envoysidecar æ‹¾å–å¹¶åˆ›å»ºä¸€ä¸ª spanï¼ˆè¿™å°±æ˜¯æˆ‘ä»¬åœ¨è·Ÿè¸ªä¸­çœ‹åˆ°å®ƒçš„åŸå› ï¼‰å¹¶è½¬å‘åˆ° &lt;code&gt;sa-web-app&lt;/code&gt; å®¹å™¨å®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;è¿™é‡Œæ–¹æ³• &lt;strong&gt;sentimentAnalysis&lt;/strong&gt; å¤„ç†è¯·æ±‚ã€‚è¿™äº›è·Ÿè¸ªç”±åº”ç”¨ç¨‹åºç”Ÿæˆï¼Œè¿™æ„å‘³ç€éœ€è¦æ›´æ”¹ä»£ç ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä» POST è¯·æ±‚&lt;code&gt;sa-logic&lt;/code&gt;å¼€å§‹çš„ä½ç½®ã€‚è·Ÿè¸ª ID éœ€è¦&lt;code&gt;sa-web-app&lt;/code&gt;ä¼ é€’ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;5. &amp;hellip;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt; ï¼šåœ¨ç¬¬ 4 ç‚¹ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéœ€è¦è·å– Istio ç”Ÿæˆçš„ headerï¼Œå¹¶åœ¨ä¸‹ä¸€ä¸ªè¯·æ±‚æ—¶å°†å…¶ä¼ é€’ä¸‹æ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1odduj20m8055q3r_hu_40706f4dc6eb9360.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1odduj20m8055q3r_hu_27d62ee2bb29e37.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1odduj20m8055q3r_hu_b29a353120885bd0.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1odduj20m8055q3r_hu_40706f4dc6eb9360.webp&#34;
               width=&#34;760&#34;
               height=&#34;176&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio åšä¸»è¦çš„ç¹é‡å·¥ä½œï¼Œå› ä¸ºå®ƒåœ¨ä¼ å…¥çš„è¯·æ±‚ä¸Šç”Ÿæˆ headerï¼Œåœ¨æ¯ä¸ª sidecar ä¸Šåˆ›å»ºæ–°çš„ spanï¼Œä¼ é€’å®ƒä»¬ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰æˆ‘ä»¬çš„æœåŠ¡ä¼ é€’ headerï¼Œæˆ‘ä»¬å°†å¤±å»è¯·æ±‚çš„å®Œæ•´è·Ÿè¸ªã€‚&lt;/p&gt;
&lt;p&gt;è¦ä¼ é€’çš„ header æ˜¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-request-id
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-b3-traceid
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-b3-spanid
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-b3-parentspanid
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-b3-sampled
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-b3-flags
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-ot-span-context
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°½ç®¡è¿™æ˜¯ä¸€é¡¹ç®€å•çš„ä»»åŠ¡ï¼Œä½†å·²ç»æœ‰&lt;a href=&#34;https://github.com/opentracing-contrib&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¸å¤šåº“&lt;/a&gt; å¯ä»¥ç®€åŒ–è¿™ä¸€è¿‡ç¨‹ï¼Œä¾‹å¦‚åœ¨ &lt;code&gt;sa-web-app&lt;/code&gt;æœåŠ¡ä¸­ï¼Œ &lt;strong&gt;RestTemplate&lt;/strong&gt; å®¢æˆ·ç«¯é€šè¿‡ç®€å•åœ°&lt;a href=&#34;https://github.com/rinormaloku/istio-mastery/blob/master/sa-webapp/pom.xml#L36-L47&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¾èµ–é¡¹ä¸­&lt;/a&gt; æ·»åŠ  Jaeger å’Œ OpenTracing åº“æ¥ä¼ é€’ headerã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;æ³¨æ„ï¼šSentiment Analysis åº”ç”¨ç¨‹åºå±•ç¤ºäº† Flaskï¼ŒSpring å’Œ ASP.NET Core çš„å®ç°ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œåœ¨è°ƒæŸ¥æˆ‘ä»¬å¼€ç®±å³ç”¨ï¼ˆæˆ–éƒ¨åˆ†å¼€ç®±å³ç”¨ï¼‰ä¹‹åï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™é‡Œçš„ä¸»é¢˜ï¼Œç»†ç²’åº¦è·¯ç”±ï¼Œç®¡ç†ç½‘ç»œæµé‡ï¼Œå®‰å…¨æ€§ç­‰ç­‰ï¼&lt;/p&gt;
&lt;h2 id=&#34;æµé‡ç®¡ç†&#34;&gt;æµé‡ç®¡ç†&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ Envoy çš„ Istio ä¸ºæ‚¨çš„é›†ç¾¤æä¾›äº†è®¸å¤šæ–°åŠŸèƒ½ï¼Œä»è€Œå®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€è¯·æ±‚è·¯ç”±&lt;/strong&gt; ï¼šCanary éƒ¨ç½²ï¼ŒA/B æµ‹è¯•ï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡ï¼š&lt;/strong&gt; ç®€å•å’Œä¸€è‡´çš„å“ˆå¸Œå¹³è¡¡ï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•…éšœæ¢å¤&lt;/strong&gt; ï¼šè¶…æ—¶ï¼Œé‡è¯•ï¼Œç†”æ–­å™¨ï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•…éšœæ³¨å…¥&lt;/strong&gt; ï¼šå»¶è¿Ÿï¼Œä¸­æ­¢è¯·æ±‚ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨æœ¬æ–‡çš„åºåˆ—ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­å±•ç¤ºè¿™äº›åŠŸèƒ½ï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­ä»‹ç»ä¸€äº›æ–°æ¦‚å¿µã€‚æˆ‘ä»¬å°†ç ”ç©¶çš„ç¬¬ä¸€ä¸ªæ¦‚å¿µæ˜¯ DestinationRulesï¼Œå¹¶ä½¿ç”¨é‚£äº›æˆ‘ä»¬å°†å¯ç”¨ A/B æµ‹è¯•çš„æ¦‚å¿µã€‚&lt;/p&gt;
&lt;h2 id=&#34;abæµ‹è¯•---å®è·µä¸­çš„ç›®çš„åœ°è§„åˆ™&#34;&gt;A/Bæµ‹è¯• - å®è·µä¸­çš„ç›®çš„åœ°è§„åˆ™&lt;/h2&gt;
&lt;p&gt;å½“æˆ‘ä»¬æœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºï¼ˆé€šå¸¸ç‰ˆæœ¬è§†è§‰ä¸Šæœ‰æ‰€ä¸åŒï¼‰æ—¶ä½¿ç”¨ A/B æµ‹è¯•ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸æ˜¯ 100ï¼…è‚¯å®šä¼šå¢åŠ ç”¨æˆ·äº¤äº’ï¼Œå› æ­¤æˆ‘ä»¬åŒæ—¶å°è¯•ä¸¤ä¸ªç‰ˆæœ¬å¹¶æ”¶é›†æŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥éƒ¨ç½²æ¼”ç¤ºA/Bæµ‹è¯•æ‰€éœ€çš„å‰ç«¯çš„ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/kube/ab-testing/sa-frontend-green-deployment.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions/sa-frontend-green created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»¿è‰²ç‰ˆæœ¬çš„éƒ¨ç½²æ¸…å•æœ‰ä¸¤ç‚¹ä¸åŒï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¯¥ image åŸºäºä¸åŒçš„æ ‡ç­¾ï¼š &lt;code&gt;istio-green&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;pod æ ‡æœ‰ &lt;code&gt;version: green&lt;/code&gt; ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è€Œä½œä¸ºåŒæ–¹éƒ¨ç½²åœ¨æ ‡ç­¾ &lt;code&gt;app: sa-frontend&lt;/code&gt; é€šè¿‡è™šæ‹ŸæœåŠ¡è·¯ç”±çš„è¯·æ±‚ &lt;code&gt;sa-external-services&lt;/code&gt;  çš„æœåŠ¡ &lt;code&gt;sa-frontend&lt;/code&gt; ä¼šè¢«è½¬å‘åˆ°æ‰€æœ‰çš„å®ä¾‹ï¼Œå¹¶å°†äºè´Ÿè½½é‡‡ç”¨å¾ªç¯ç®—æ³•ï¼Œè¿™å°†å¯¼è‡´åœ¨å›¾ 16 ä¸­æå‡ºçš„è´Ÿè½½å‡è¡¡é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-16æ‰¾ä¸åˆ°è¯·æ±‚çš„æ–‡ä»¶&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 16.æ‰¾ä¸åˆ°è¯·æ±‚çš„æ–‡ä»¶&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu30v6lj20m80do761_hu_b8de091c38ca6512.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu30v6lj20m80do761_hu_1d8840e7c71b903c.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu30v6lj20m80do761_hu_53a18271b2efd745.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu30v6lj20m80do761_hu_b8de091c38ca6512.webp&#34;
               width=&#34;760&#34;
               height=&#34;467&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 16.æ‰¾ä¸åˆ°è¯·æ±‚çš„æ–‡ä»¶
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ‰¾ä¸åˆ°è¿™äº›æ–‡ä»¶ï¼Œå› ä¸ºå®ƒä»¬åœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒç‰ˆæœ¬ä¸­çš„å‘½åæ–¹å¼ä¸åŒã€‚è®©æˆ‘ä»¬éªŒè¯ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl --silent http://&lt;span class=&#34;nv&#34;&gt;$EXTERNAL_IP&lt;/span&gt;/ &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; tr &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#34;&amp;#39;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep main
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/static/css/main.c7071b22.css
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/static/js/main.059f8e9c.js
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl --silent http://&lt;span class=&#34;nv&#34;&gt;$EXTERNAL_IP&lt;/span&gt;/ &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; tr &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#34;&amp;#39;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep main
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/static/css/main.f87cd8c9.css
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/static/js/main.f7659dbb.js
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ„å‘³ç€è¯·æ±‚ä¸€ä¸ªç‰ˆæœ¬çš„é™æ€æ–‡ä»¶çš„&lt;code&gt;index.html&lt;/code&gt;å¯ä»¥è¢«è´Ÿè½½å‡è¡¡åˆ°æä¾›å¦ä¸€ä¸ªç‰ˆæœ¬çš„ podï¼Œå…¶ä¸­å¯ä»¥ç†è§£çš„æ˜¯å…¶ä»–æ–‡ä»¶ä¸å­˜åœ¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ„å‘³ç€ï¼Œä¸ºäº†è®©æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥é™åˆ¶â€œä¸º index.html æœåŠ¡çš„åº”ç”¨ç¨‹åºçš„ç‰ˆæœ¬ï¼Œå¿…é¡»ä¸ºåç»­è¯·æ±‚æä¾›æœåŠ¡â€ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨ Consistent Hash Loadbalancing æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè¿™ &lt;strong&gt;æ˜¯&lt;/strong&gt; ä½¿ç”¨é¢„å®šä¹‰å±æ€§ï¼ˆä¾‹å¦‚ HTTP headerï¼‰&lt;strong&gt;å°†æ¥è‡ªåŒä¸€å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘åˆ°åŒä¸€åç«¯å®ä¾‹çš„è¿‡ç¨‹&lt;/strong&gt;ã€‚ç”± DestionatioRules æä¾›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;destinationrules&#34;&gt;DestinationRules&lt;/h2&gt;
&lt;p&gt;åœ¨ &lt;strong&gt;VirtualService&lt;/strong&gt; å°†è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„æœåŠ¡ä¹‹åï¼Œç„¶åä½¿ç”¨ &lt;strong&gt;DestinationRules&lt;/strong&gt;ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šé€‚ç”¨äºæ­¤æœåŠ¡å®ä¾‹çš„æµé‡çš„ç­–ç•¥ï¼Œå¦‚å›¾ 17 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-17ä½¿ç”¨-istio-èµ„æºçš„æµé‡ç®¡ç†&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 17.ä½¿ç”¨ Istio èµ„æºçš„æµé‡ç®¡ç†&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2yjsuj20rs09e75i_hu_21c0ad2442f18e81.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2yjsuj20rs09e75i_hu_f50bee4bc67a3fba.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2yjsuj20rs09e75i_hu_f21ba19e3755ebb6.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2yjsuj20rs09e75i_hu_21c0ad2442f18e81.webp&#34;
               width=&#34;760&#34;
               height=&#34;257&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 17.ä½¿ç”¨ Istio èµ„æºçš„æµé‡ç®¡ç†
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šå›¾ 17 ä»¥æ˜“äºç†è§£çš„æ–¹å¼å¯è§†åŒ– Istio èµ„æºå¦‚ä½•å½±å“ç½‘ç»œæµé‡ã€‚ä½†æ˜¯ï¼Œå‡†ç¡®åœ°è¯´ï¼Œå†³å®šå°†è¯·æ±‚è½¬å‘åˆ°å“ªä¸ªå®ä¾‹æ˜¯ç”± CRD é…ç½®çš„ Ingress Gateway çš„ Envoy åšå‡ºçš„ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ç›®æ ‡è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å°†è´Ÿè½½å‡è¡¡é…ç½®ä¸ºå…·æœ‰ä¸€è‡´æ€§å“ˆå¸Œï¼Œå¹¶ç¡®ä¿åŒä¸€ç”¨æˆ·ç”±åŒä¸€æœåŠ¡å®ä¾‹å“åº”ã€‚é€šè¿‡ä»¥ä¸‹é…ç½®å®ç°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-frontend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-frontend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;loadBalancer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;consistentHash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;httpHeaderName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;version  &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;æ ¹æ®â€œversionâ€æ ‡å¤´çš„å†…å®¹ç”Ÿæˆä¸€è‡´çš„å“ˆå¸Œã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åº”ç”¨é…ç½®å¹¶å°è¯•ä¸€ä¸‹ï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/ab-testing/destinationrule-sa-frontend.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destinationrule.networking.istio.io/sa-frontend created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¹¶éªŒè¯åœ¨æŒ‡å®šç‰ˆæœ¬ header æ—¶æ˜¯å¦è·å¾—ç›¸åŒçš„æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl --silent -H &lt;span class=&#34;s2&#34;&gt;&amp;#34;version: yogo&amp;#34;&lt;/span&gt; http://&lt;span class=&#34;nv&#34;&gt;$EXTERNAL_IP&lt;/span&gt;/ &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; tr &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#34;&amp;#39;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep main
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šä¸ºäº†æ–¹ä¾¿åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œæµ‹è¯•ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤ &lt;a href=&#34;https://chrome.google.com/webstore/detail/modheader/idgpnmonknjnojddfkpgkljpfnnfcklj&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Chrome æ‰©å±•ç¨‹åº&lt;/a&gt; å‘ç‰ˆæœ¬ header æ·»åŠ ä¸åŒçš„å€¼ï¼Œã€‚&lt;/p&gt;
&lt;p&gt;DestinationRules å…·æœ‰æ›´å¤š LoadBalancing åŠŸèƒ½ï¼Œæ‰€æœ‰è¯¦ç»†ä¿¡æ¯éƒ½å¯ä»¥æŸ¥çœ‹ &lt;a href=&#34;https://preliminary.istio.io/docs/reference/config/istio.networking.v1alpha3.html#LoadBalancerSettings&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç»§ç»­æ›´è¯¦ç»†åœ°æ¢ç´¢ VirtualService ä¹‹å‰ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåˆ é™¤åº”ç”¨ç¨‹åºçš„ç»¿è‰²ç‰ˆæœ¬å’Œç›®æ ‡è§„åˆ™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -f resource-manifests/kube/ab-testing/sa-frontend-green-deployment.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions &lt;span class=&#34;s2&#34;&gt;&amp;#34;sa-frontend-green&amp;#34;&lt;/span&gt; deleted
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -f resource-manifests/istio/ab-testing/destinationrule-sa-frontend.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destinationrule.networking.istio.io â€œsa-frontendâ€ deleted
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;é•œåƒæœåŠ¡---å®è·µä¸­çš„è™šæ‹ŸæœåŠ¡&#34;&gt;é•œåƒæœåŠ¡ - å®è·µä¸­çš„è™šæ‹ŸæœåŠ¡&lt;/h2&gt;
&lt;p&gt;å½“æˆ‘ä»¬æƒ³è¦æµ‹è¯•ç”Ÿäº§ä¸­çš„æ›´æ”¹ä½†ä¸å½±å“æœ€ç»ˆç”¨æˆ·æ—¶ï¼Œä¼šä½¿ç”¨å½±å­æˆ–é•œåƒï¼Œå› æ­¤æˆ‘ä»¬å°†è¯·æ±‚é•œåƒåˆ°å…·æœ‰æ›´æ”¹å¹¶è¯„ä¼°å®ƒçš„ç¬¬äºŒä¸ªå®ä¾‹ä¸­ã€‚ &lt;em&gt;æ›´ç®€å•çš„æ˜¯ï¼Œå½“ä½ çš„ä¸€ä¸ªåŒäº‹é€‰æ‹©æœ€å…³é”®çš„é—®é¢˜å¹¶åˆ¶ä½œä¸€ä¸ªè¶…å¤§çš„åˆå¹¶è¯·æ±‚ï¼Œå¹¶ä¸”æ²¡äººèƒ½çœŸæ­£å®¡æŸ¥ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;è¦æµ‹è¯•æ­¤åŠŸèƒ½ï¼Œå¯ä»¥ é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ åˆ›å»º SA-Logic çš„ç¬¬äºŒä¸ªå®ä¾‹ï¼ˆ &lt;em&gt;è¿™æ˜¯ buggy çš„&lt;/em&gt; ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/kube/shadowing/sa-logic-service-buggy.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions/sa-logic-buggy created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¹¶éªŒè¯æ‰€æœ‰å®ä¾‹éƒ½æ ‡æœ‰ç›¸åº”çš„ç‰ˆæœ¬ï¼Œå¦å¤–è¿˜æœ‰&lt;code&gt;app=sa-logic&lt;/code&gt;æ ‡è®°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sa-logic --show-labels
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                              READY   LABELS
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-logic-568498cb4d-2sjwj         2/2     &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sa-logic,version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-logic-568498cb4d-p4f8c         2/2     &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sa-logic,version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-logic-buggy-76dff55847-2fl66   2/2     &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sa-logic,version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sa-logic-buggy-76dff55847-kx8zz   2/2     &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sa-logic,version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“ &lt;code&gt;sa-logic&lt;/code&gt; æœåŠ¡ç›®æ ‡ pod æ ‡è®°ä¸º &lt;code&gt;app=sa-logic&lt;/code&gt;æ—¶ï¼Œä»»ä½•ä¼ å…¥è¯·æ±‚å°†åœ¨æ‰€æœ‰å®ä¾‹ä¹‹é—´è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå¦‚å›¾ 18 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-18-round-robin-è´Ÿè½½å‡è¡¡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 18. Round Robin è´Ÿè½½å‡è¡¡&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu199gtj20m80f5wgc_hu_d182f121d4f4b68a.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu199gtj20m80f5wgc_hu_535c6c6a919f399d.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu199gtj20m80f5wgc_hu_4edaa496c4a9a07e.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu199gtj20m80f5wgc_hu_d182f121d4f4b68a.webp&#34;
               width=&#34;760&#34;
               height=&#34;518&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 18. Round Robin è´Ÿè½½å‡è¡¡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½†æˆ‘ä»¬å¸Œæœ›å°†è¯·æ±‚è·¯ç”±åˆ°ç‰ˆæœ¬ä¸º v1 çš„å®ä¾‹ï¼Œå¹¶é•œåƒåˆ°ç‰ˆæœ¬ä¸º v2 çš„å®ä¾‹ï¼Œå¦‚å›¾ 19 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-19è·¯ç”±åˆ°-v1-å’Œé•œåƒåˆ°-v2&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 19.è·¯ç”±åˆ° v1 å’Œé•œåƒåˆ° v2&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2f7y4j20m80b8q3y_hu_13924f3c6effa368.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2f7y4j20m80b8q3y_hu_9e886841014cf021.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2f7y4j20m80b8q3y_hu_4b6fa1ad2199d94f.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2f7y4j20m80b8q3y_hu_13924f3c6effa368.webp&#34;
               width=&#34;760&#34;
               height=&#34;384&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 19.è·¯ç”±åˆ° v1 å’Œé•œåƒåˆ° v2
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä½¿ç”¨ VirtualService ä¸ DestinationRule ç»“åˆå®ç°çš„ï¼Œå…¶ä¸­ç›®æ ‡è§„åˆ™æŒ‡å®šåˆ°ç‰¹å®šå­é›†çš„å­é›†å’Œ VirtualService è·¯ç”±ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨ç›®æ ‡è§„åˆ™æŒ‡å®šå­é›†&#34;&gt;ä½¿ç”¨ç›®æ ‡è§„åˆ™æŒ‡å®šå­é›†&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹é…ç½®å®šä¹‰å­é›†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic   &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subsets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1       &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1  &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2  &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;ä¸»æœºå®šä¹‰æ­¤è§„åˆ™ä»…åœ¨å‘ &lt;code&gt;sa-logic&lt;/code&gt; æœåŠ¡å‘ç”Ÿè·¯ç”±æ—¶é€‚ç”¨&lt;/li&gt;
&lt;li&gt;è·¯ç”±åˆ°å­é›†å®ä¾‹æ—¶ä½¿ç”¨çš„å­é›†åç§°ã€‚&lt;/li&gt;
&lt;li&gt;Label å®šä¹‰äº†éœ€è¦åŒ¹é…çš„é”®å€¼å¯¹ï¼Œä»¥ä½¿å®ä¾‹æˆä¸ºå­é›†çš„ä¸€éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åº”ç”¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤çš„é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/shadowing/sa-logic-subsets-destinationrule.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; destinationrule.networking.istio.io/sa-logic created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡å®šä¹‰å­é›†ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­å¹¶é…ç½® VirtualService ä»¥åº”ç”¨äºè¯·æ±‚ &lt;code&gt;sa-logic&lt;/code&gt; æ‰€åœ¨çš„è¯·æ±‚ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è·¯ç”±åˆ°åä¸º v1 çš„å­é›†ï¼Œ&lt;/li&gt;
&lt;li&gt;é•œåƒåˆ°åä¸º v2 çš„å­é›†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™æ˜¯é€šè¿‡ä»¥ä¸‹æ¸…å•å®ç°çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;sa-logic          &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic  &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1      &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mirror&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;             
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic     &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”±äºä¸€åˆ‡é…ç½®éƒ½æ˜¯ä¸è¨€è‡ªæ˜çš„ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒçš„æ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/shadowing/sa-logic-subsets-shadowing-vs.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;virtualservice.networking.istio.io/sa-logic created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ·»åŠ ä¸€äº›è´Ÿè½½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; true&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; curl -v http://&lt;span class=&#34;nv&#34;&gt;$EXTERNAL_IP&lt;/span&gt;/sentiment &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -H &lt;span class=&#34;s2&#34;&gt;&amp;#34;Content-type: application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;sentence&amp;#34;: &amp;#34;I love yogobella&amp;#34;}&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    sleep .8&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ£€æŸ¥ Grafana ä¸­çš„ç»“æœï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰é”™è¯¯çš„ç‰ˆæœ¬å¤§çº¦æœ‰ 60ï¼…çš„è¯·æ±‚å¤±è´¥ï¼Œä½†æ²¡æœ‰ä¸€ä¸ªå¤±è´¥å½±å“æœ€ç»ˆç”¨æˆ·ï¼Œå› ä¸ºå®ƒä»¬è¢«å½“å‰æ´»åŠ¨çš„æœåŠ¡å“åº”ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-20-sa-é€»è¾‘æœåŠ¡ç‰ˆæœ¬çš„æˆåŠŸç‡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 20. sa é€»è¾‘æœåŠ¡ç‰ˆæœ¬çš„æˆåŠŸç‡&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2vr8gj20m80b0t9z_hu_dd5f4bc66cd08b52.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2vr8gj20m80b0t9z_hu_5273c4220105c319.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2vr8gj20m80b0t9z_hu_e766743377c20625.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu2vr8gj20m80b0t9z_hu_dd5f4bc66cd08b52.webp&#34;
               width=&#34;760&#34;
               height=&#34;376&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 20. sa é€»è¾‘æœåŠ¡ç‰ˆæœ¬çš„æˆåŠŸç‡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡çœ‹åˆ°åº”ç”¨äºæˆ‘ä»¬æœåŠ¡çš„ envoy çš„ VirtualServiceï¼Œå½“å¯¹æ­¤ &lt;code&gt;sa-web-app&lt;/code&gt; æå‡ºè¯·æ±‚æ—¶ï¼Œ &lt;code&gt;sa-logic&lt;/code&gt;  é€šè¿‡ sidecar Envoyï¼Œé€šè¿‡ VirtualService é…ç½®ä¸ºè·¯ç”±åˆ°å­é›† v1 å¹¶é•œåƒåˆ°æœåŠ¡çš„å­é›† v2 &lt;code&gt;sa-logic&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å¯ä»¥çœ‹åˆ°ä½ åœ¨æƒ³â€œDarn man Virtual Services å¾ˆç®€å•ï¼â€ï¼Œåœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠå¥å­æ‰©å±•ä¸ºâ€œSimply Amazingï¼â€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é‡‘ä¸é›€éƒ¨ç½²&#34;&gt;é‡‘ä¸é›€éƒ¨ç½²&lt;/h2&gt;
&lt;p&gt;Canary Deployment æ˜¯å‘å°‘æ•°ç”¨æˆ·æ¨å‡ºæ–°ç‰ˆæœ¬åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ï¼Œä½œä¸ºéªŒè¯ç¼ºå°‘é—®é¢˜çš„ä¸€ä¸ªæ­¥éª¤ï¼Œç„¶åå‘æ›´å¹¿æ³›çš„å—ä¼—æä¾›æ›´é«˜è´¨é‡çš„å‘å¸ƒä¿è¯ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨ç›¸åŒçš„ buggy å­é›† &lt;code&gt;sa-logic&lt;/code&gt; æ¥æ¼”ç¤º canary éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬å¤§èƒ†åœ°å¼€å§‹ï¼Œé€šè¿‡åº”ç”¨ä¸‹é¢çš„ VirtualServiceï¼Œå°† 20ï¼…çš„ç”¨æˆ·å‘é€åˆ°æœ‰ç¼ºé™·çš„ç‰ˆæœ¬ï¼ˆè¿™ä»£è¡¨é‡‘ä¸é›€éƒ¨ç½²ï¼‰å’Œ 80ï¼…çš„å¥åº·æœåŠ¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;sa-logic    &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;æƒé‡æŒ‡å®šè¦è½¬å‘åˆ°ç›®æ ‡æˆ–ç›®æ ‡å­é›†çš„è¯·æ±‚çš„ç™¾åˆ†æ¯”ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;sa-logic&lt;/code&gt; ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ æ›´æ–°ä»¥å‰çš„ è™šæ‹ŸæœåŠ¡é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/canary/sa-logic-subsets-canary-versusyaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; virtualservice.networking.istio.io/sa-logic configured
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ç«‹å³çœ‹åˆ°æˆ‘ä»¬çš„ä¸€äº›è¯·æ±‚å¤±è´¥äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; true&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   curl -i http://&lt;span class=&#34;nv&#34;&gt;$EXTERNAL_IP&lt;/span&gt;/sentiment &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   -H â€œContent-type: application/jsonâ€ &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;sentence&amp;#34;: &amp;#34;I love yogobella&amp;#34;}&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   --silent -w &lt;span class=&#34;s2&#34;&gt;&amp;#34;Time: %{time_total}s \t Status: %{http_code}\n&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   -o /dev/null&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; sleep .1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Time: 0.153075s Status: &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Time: 0.137581s Status: &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Time: 0.139345s Status: &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Time: 30.291806s Status: &lt;span class=&#34;m&#34;&gt;500&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;VirtualServices å¯ç”¨äº† Canary Deploymentsï¼Œé€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°†æ½œåœ¨çš„æŸå®³å‡å°‘åˆ°äº† 20ï¼…çš„ç”¨æˆ·ç¾¤ã€‚æ¼‚äº®ï¼ç°åœ¨ï¼Œæ¯å½“æˆ‘ä»¬å¯¹ä»£ç ä¸å®‰å…¨æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ Shadowing å’Œ Canary Deploymentsï¼Œæ¢å¥è¯è¯´ï¼Œæ€»æ˜¯å¦‚æ­¤ã€‚ğŸ˜œ&lt;/p&gt;
&lt;h2 id=&#34;è¶…æ—¶å’Œé‡è¯•&#34;&gt;è¶…æ—¶å’Œé‡è¯•&lt;/h2&gt;
&lt;p&gt;ä»£ç å¹¶ä¸æ€»æ˜¯é”™è¯¯çš„ã€‚åœ¨â€œ &lt;a href=&#34;https://en.wikipedia.org/wiki/Fallacies_of_distributed_computing#The_fallacies&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆ†å¸ƒå¼è®¡ç®—çš„ 8 ä¸ªè°¬è¯¯&lt;/a&gt; â€åˆ—è¡¨ä¸­ï¼Œç¬¬ä¸€ä¸ªè°¬è®ºæ˜¯â€œç½‘ç»œå¯é â€ã€‚ç½‘ç»œä¸å¯é ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦è¶…æ—¶å’Œé‡è¯•çš„åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;å‡ºäºæ¼”ç¤ºç›®çš„ï¼Œæˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨æœ‰ç¼ºé™·çš„ç‰ˆæœ¬ &lt;code&gt;sa-logic&lt;/code&gt;ï¼Œå…¶ä¸­éšæœºæ•…éšœæ¨¡æ‹Ÿç½‘ç»œçš„ä¸å¯é æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ç¼ºé™·çš„æœåŠ¡æœ‰ä¸‰åˆ†ä¹‹ä¸€çš„æœºä¼šèŠ±è´¹å¤ªé•¿æ—¶é—´æ¥å“åº”ï¼Œä¸‰åˆ†ä¹‹ä¸€çš„æœºä¼šä»¥å†…éƒ¨æœåŠ¡å™¨é”™è¯¯ç»“æŸï¼Œå…¶ä½™çš„æˆåŠŸå®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç¼“è§£è¿™äº›é—®é¢˜å¹¶æ”¹å–„ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬å¯ä»¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœæœåŠ¡æ—¶é—´è¶…è¿‡ 8 ç§’ï¼Œåˆ™è¶…æ—¶&lt;/li&gt;
&lt;li&gt;é‡è¯•å¤±è´¥çš„è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™æ˜¯é€šè¿‡ä»¥ä¸‹èµ„æºå®šä¹‰å®ç°çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sa-logic&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;8s          &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;retries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;attempts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;perTryTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;3s  &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ä¸º 8 ç§’ï¼Œ&lt;/li&gt;
&lt;li&gt;å®ƒå°è¯•äº† 3 æ¬¡ï¼Œ&lt;/li&gt;
&lt;li&gt;å¦‚æœå°è¯•æ—¶é—´è¶…è¿‡ 3 ç§’ï¼Œåˆ™å°è¯•å°†è¯·æ±‚æ ‡è®°ä¸ºå¤±è´¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ç§ä¼˜åŒ–ï¼Œå› ä¸ºç”¨æˆ·ä¸ä¼šç­‰å¾…è¶…è¿‡ 8 ç§’ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨å‘ç”Ÿæ•…éšœæ—¶é‡è¯•ä¸‰æ¬¡ï¼Œä»è€Œå¢åŠ äº†å¯¼è‡´å“åº”æˆåŠŸçš„æœºä¼šã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åº”ç”¨æ›´æ–°çš„é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f resource-manifests/istio/retries/sa-logic-retries-timeouts-vs.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;virtualservice.networking.istio.io/sa-logic configured
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¹¶æŸ¥çœ‹ Grafana å›¾è¡¨ï¼Œäº†è§£æˆåŠŸç‡çš„æ”¹å–„æƒ…å†µï¼ˆå¦‚å›¾ 21 æ‰€ç¤ºï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-21ä½¿ç”¨è¶…æ—¶å’Œé‡è¯•åçš„æ”¹è¿›&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 21.ä½¿ç”¨è¶…æ—¶å’Œé‡è¯•åçš„æ”¹è¿›&#34; srcset=&#34;
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1qjtxj20m80b63zk_hu_4633a939a617f69e.webp 400w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1qjtxj20m80b63zk_hu_99ce21954e6fe3e0.webp 760w,
               /blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1qjtxj20m80b63zk_hu_aecc3ba5dd17fdd9.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/back-to-microservices-with-istio-p1/61411417ly1g0exu1qjtxj20m80b63zk_hu_4633a939a617f69e.webp&#34;
               width=&#34;760&#34;
               height=&#34;382&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 21.ä½¿ç”¨è¶…æ—¶å’Œé‡è¯•åçš„æ”¹è¿›
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;code&gt;sa-logic-buggy&lt;/code&gt; é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ è¿›å…¥ä¸‹ä¸€éƒ¨åˆ† delete å’Œ VirtualService ä¹‹å‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete deployment sa-logic-buggy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions &lt;span class=&#34;s2&#34;&gt;&amp;#34;sa-logic-buggy&amp;#34;&lt;/span&gt; deleted
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete virtualservice sa-logic
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;virtualservice.networking.istio.io â€œsa-logicâ€ deleted
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç†”æ–­å™¨å’Œéš”ç¦»æ¨¡å¼&#34;&gt;ç†”æ–­å™¨å’Œéš”ç¦»æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;å¾®æœåŠ¡æ¶æ„ä¸­çš„ä¸¤ä¸ªé‡è¦æ¨¡å¼ï¼Œå¯ä»¥å®ç°æœåŠ¡çš„è‡ªæˆ‘ä¿®å¤ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥ &lt;strong&gt;ç†”æ–­å™¨&lt;/strong&gt; æ˜¯ç”¨æ¥é˜»æ­¢è¯·æ±‚å°†è§†ä¸ºä¸å¥åº·æœåŠ¡çš„ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä½¿å®ƒèƒ½å¤Ÿæ¢å¤ï¼Œåœ¨æ­¤æœŸé—´å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘åˆ°è¯¥æœåŠ¡çš„å¥åº·æƒ…å†µï¼ˆå¢åŠ æˆåŠŸç‡ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥ &lt;strong&gt;éš”ç¦»æ¨¡å¼&lt;/strong&gt; æ•´ä¸ªç³»ç»Ÿé™çº§æ¥éš”ç¦»é”™è¯¯ï¼Œé˜²æ­¢é”™è¯¯ä¼ æ’­ï¼Œä¸¾ä¸€ä¸ªéš”ç¦»æ•…éšœä¾‹å­ï¼ŒæœåŠ¡ B å¤„äºæŸåçŠ¶æ€å’Œå…¶å®ƒæœåŠ¡ï¼ˆæœåŠ¡ B çš„å®¢æˆ·ç«¯ï¼‰å‘å‡ºè¯·æ±‚åˆ°æœåŠ¡ Bï¼Œè¿™å°†å¯¼è‡´è¯¥å®¢æˆ·ç«¯å°†ä½¿ç”¨äº†è‡ªå·±çš„çº¿ç¨‹æ± ï¼Œå°†æ— æ³•æä¾›å…¶ä»–è¯·æ±‚ï¼ˆå³ä½¿è¿™äº›è¯·æ±‚ä¸æœåŠ¡ B æ— å…³ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å°†è·³è¿‡è¿™äº›æ¨¡å¼çš„å®ç°ï¼Œå› ä¸ºæ‚¨å¯ä»¥æŸ¥çœ‹ &lt;a href=&#34;https://istio.io/docs/tasks/traffic-management/circuit-breaking/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡æ¡£ä¸­çš„å®ç°&lt;/a&gt;ï¼Œæˆ‘å¾ˆå…´å¥‹åœ°å±•ç¤ºèº«ä»½éªŒè¯å’Œæˆæƒï¼Œè¿™å°†æ˜¯ä¸‹ä¸€ç¯‡æ–‡ç« çš„ä¸»é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬ä¸€éƒ¨åˆ†---æ‘˜è¦&#34;&gt;ç¬¬ä¸€éƒ¨åˆ† - æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬åœ¨ Kubernetes é›†ç¾¤ä¸­éƒ¨ç½²äº† Istioï¼Œå¹¶ä½¿ç”¨å…¶è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆå¦‚ &lt;strong&gt;ç½‘å…³&lt;/strong&gt;ï¼Œ &lt;strong&gt;VirtualServices&lt;/strong&gt;ï¼Œ &lt;strong&gt;DestinationRules&lt;/strong&gt; åŠå…¶ç»„ä»¶ï¼‰å¯ç”¨äº†ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;strong&gt;Kiali&lt;/strong&gt;ï¼Œé€šè¿‡æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„æœåŠ¡ï¼Œå®ƒä»¬å¦‚ä½•æ‰§è¡Œï¼Œä»¥åŠå®ƒä»¬å…³ç³»ï¼Œæ¥è§‚å¯Ÿæˆ‘ä»¬çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;strong&gt;Prometheus&lt;/strong&gt; å’Œ &lt;strong&gt;Grafana&lt;/strong&gt; è¿›è¡Œæ”¶é›†å’Œå¯è§†åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;è¯·æ±‚ &lt;strong&gt;Jaeger&lt;/strong&gt; è·Ÿè¸ªï¼ˆHunter çš„å¾·è¯­ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹ç½‘ç»œæµé‡è¿›è¡Œå…¨é¢ç»†ç²’åº¦æ§åˆ¶ï¼Œå®ç° &lt;strong&gt;Canary Deployments&lt;/strong&gt;ï¼Œ &lt;strong&gt;A/Bæµ‹è¯•å’ŒShadowing&lt;/strong&gt; ã€‚&lt;/li&gt;
&lt;li&gt;è½»æ¾å®ç° &lt;strong&gt;é‡è¯•ï¼Œè¶…æ—¶å’Œ CircuitBreakers&lt;/strong&gt; ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€æœ‰è¿™äº›éƒ½å¯ä»¥åœ¨æ²¡æœ‰ä»£ç æ›´æ”¹æˆ–ä»»ä½•å…¶ä»–ä¾èµ–æ€§çš„æƒ…å†µä¸‹å®ç°ï¼Œä»è€Œä½¿æ‚¨çš„æœåŠ¡ä¿æŒå°å·§ï¼Œæ˜“äºæ“ä½œå’Œç»´æŠ¤&lt;/p&gt;
&lt;p&gt;å¯¹äºæ‚¨çš„å¼€å‘å›¢é˜Ÿæ¥è¯´ï¼Œæ¶ˆé™¤è¿™äº›è·¨é¢†åŸŸçš„é—®é¢˜å¹¶å°†å®ƒä»¬é›†ä¸­åˆ° Istio çš„æ§åˆ¶å¹³é¢ï¼Œæ„å‘³ç€æ–°æœåŠ¡å¾ˆå®¹æ˜“å¼•å…¥ï¼Œå®ƒä»¬ä¸ä¼šå ç”¨å¤§é‡èµ„æºï¼Œå› ä¸ºå¼€å‘äººå‘˜å¯ä»¥ä¸“æ³¨äºè§£å†³ä¸šåŠ¡é—®é¢˜ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ²¡æœ‰ä»»ä½•å¼€å‘äººå‘˜æŠ±æ€¨â€œå¿…é¡»è§£å†³æœ‰è¶£çš„ä¸šåŠ¡é—®é¢˜ï¼â€ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å¾ˆä¹æ„åœ¨ä¸‹é¢çš„è¯„è®ºä¸­å¬åˆ°æ‚¨çš„æƒ³æ³•ï¼Œå¹¶éšæ—¶åœ¨ &lt;a href=&#34;https://twitter.com/rinormaloku&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Twitter&lt;/a&gt; æˆ–æˆ‘çš„é¡µé¢ &lt;a href=&#34;https://rinormaloku.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rinormaloku.com&lt;/a&gt; ä¸Šä¸æˆ‘ &lt;a href=&#34;https://rinormaloku.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è”ç³»&lt;/a&gt;ï¼Œå¹¶ç»§ç»­å…³æ³¨ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†è§£å†³æœ€åä¸€å±‚è®¤è¯å’Œæˆæƒé—®é¢˜ï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>è…¾è®¯äº‘å®¹å™¨å›¢é˜Ÿå†…éƒ¨ Istio ä¸“é¢˜åˆ†äº«</title>
      <link>https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/</link>
      <pubDate>Sat, 02 Feb 2019 15:21:28 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/</guid>
      <description>&lt;p&gt;ä½œè€…ï¼šé’Ÿåï¼Œè…¾è®¯äº‘å®¹å™¨å›¢é˜Ÿé«˜çº§å·¥ç¨‹å¸ˆï¼Œçƒ­è¡·äºå®¹å™¨ã€å¾®æœåŠ¡ã€service meshã€istio ç­‰é¢†åŸŸã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¤©åˆ†äº«çš„å†…å®¹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ 4 ä¸ªè¯é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 Service Mesh: ä¸‹ä¸€ä»£å¾®æœåŠ¡&lt;/li&gt;
&lt;li&gt;2 Istio: ç¬¬äºŒä»£ Service Mesh&lt;/li&gt;
&lt;li&gt;3 Istio æ•°æ®é¢&lt;/li&gt;
&lt;li&gt;4 Istio æ§åˆ¶é¢&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä¼šå’Œå¤§å®¶ä¸€èµ·è¿‡ä¸€ä¸‹ Service Mesh çš„å‘å±•å†ç¨‹ï¼Œå¹¶çœ‹çœ‹ Istio ä¸º Service Mesh å¸¦æ¥äº†ä»€ä¹ˆï¼Œè¿™éƒ¨åˆ†ç›¸å¯¹æ¯”è¾ƒè½»æ¾ã€‚æ¥ä¸‹æ¥æˆ‘å°†å’Œå¤§å®¶åˆ†æä¸€ä¸‹ Istio çš„ä¸»è¦æ¶æ„ï¼Œé‡ç‚¹æ˜¯æ•°æ®é¢å’Œæ§åˆ¶é¢çš„å®ç°ï¼ŒåŒ…æ‹¬ sidecar çš„æ³¨å…¥ï¼Œæµé‡æ‹¦æˆªï¼ŒxDS ä»‹ç»ï¼ŒIstio æµé‡æ¨¡å‹ï¼Œåˆ†å¸ƒå¼è·Ÿè¸ªï¼ŒMixer çš„é€‚é…å™¨æ¨¡å‹ç­‰ç­‰ï¼Œä¸­é—´ä¹Ÿä¼šç©¿æ’ç€ istio çš„ç°åœºä½¿ç”¨ demo.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;1-service-mesh-ä¸‹ä¸€ä»£å¾®æœåŠ¡&#34;&gt;1. Service Mesh: ä¸‹ä¸€ä»£å¾®æœåŠ¡&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;åº”ç”¨é€šä¿¡æ¨¡å¼æ¼”è¿›&lt;/li&gt;
&lt;li&gt;Service Mesh(æœåŠ¡ç½‘æ ¼) çš„å‡ºç°&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒä»£ Service Mesh&lt;/li&gt;
&lt;li&gt;Service Mesh çš„å®šä¹‰&lt;/li&gt;
&lt;li&gt;Service Mesh äº§å“ç®€å²&lt;/li&gt;
&lt;li&gt;å›½å†… Service Mesh å‘å±•æƒ…å†µ&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;11-åº”ç”¨é€šä¿¡æ¨¡å¼æ¼”è¿›ç½‘ç»œæµæ§è¿›å…¥æ“ä½œç³»ç»Ÿ&#34;&gt;1.1 åº”ç”¨é€šä¿¡æ¨¡å¼æ¼”è¿›ï¼šç½‘ç»œæµæ§è¿›å…¥æ“ä½œç³»ç»Ÿ&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr00rywkoj30nv0cmq4u_hu_ce0d61ba3b703337.webp 400w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr00rywkoj30nv0cmq4u_hu_c0029c7a164c3ef6.webp 760w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr00rywkoj30nv0cmq4u_hu_9d30521660e43f2e.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/006tNc79ly1fzr00rywkoj30nv0cmq4u_hu_ce0d61ba3b703337.webp&#34;
               width=&#34;760&#34;
               height=&#34;402&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨è®¡ç®—æœºç½‘ç»œå‘å±•çš„åˆæœŸï¼Œå¼€å‘äººå‘˜éœ€è¦åœ¨è‡ªå·±çš„ä»£ç ä¸­å¤„ç†æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œè¿æ¥é—®é¢˜ï¼ŒåŒ…æ‹¬æµé‡æ§åˆ¶ï¼Œç¼“å­˜é˜Ÿåˆ—ï¼Œæ•°æ®åŠ å¯†ç­‰ã€‚åœ¨è¿™æ®µæ—¶é—´å†…åº•å±‚ç½‘ç»œé€»è¾‘å’Œä¸šåŠ¡é€»è¾‘æ˜¯æ··æ‚åœ¨ä¸€èµ·ã€‚&lt;/p&gt;
&lt;p&gt;éšç€æŠ€æœ¯çš„å‘å±•ï¼ŒTCP/IP ç­‰ç½‘ç»œæ ‡å‡†çš„å‡ºç°è§£å†³äº†æµé‡æ§åˆ¶ç­‰é—®é¢˜ã€‚å°½ç®¡ç½‘ç»œé€»è¾‘ä»£ç ä¾ç„¶å­˜åœ¨ï¼Œä½†å·²ç»ä»åº”ç”¨ç¨‹åºé‡ŒæŠ½ç¦»å‡ºæ¥ï¼Œæˆä¸ºæ“ä½œç³»ç»Ÿç½‘ç»œå±‚çš„ä¸€éƒ¨åˆ†ï¼Œå½¢æˆäº†ç»å…¸çš„ç½‘ç»œåˆ†å±‚æ¨¡å¼ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;12-åº”ç”¨é€šä¿¡æ¨¡å¼æ¼”è¿›å¾®æœåŠ¡æ¶æ„çš„å‡ºç°&#34;&gt;1.2 åº”ç”¨é€šä¿¡æ¨¡å¼æ¼”è¿›ï¼šå¾®æœåŠ¡æ¶æ„çš„å‡ºç°&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr00ypnboj30nr0d4ac8_hu_2bd95d407e46b26f.webp 400w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr00ypnboj30nr0d4ac8_hu_a57e89614f4e3914.webp 760w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr00ypnboj30nr0d4ac8_hu_4994b8283cfaa84.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/006tNc79ly1fzr00ypnboj30nr0d4ac8_hu_2bd95d407e46b26f.webp&#34;
               width=&#34;760&#34;
               height=&#34;420&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¾®æœåŠ¡æ¶æ„æ˜¯æ›´ä¸ºå¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå®ƒç»™è¿ç»´å¸¦æ¥äº†æ›´å¤šæŒ‘æˆ˜ï¼Œè¿™äº›æŒ‘æˆ˜ä¸»è¦åŒ…æ‹¬èµ„æºçš„æœ‰æ•ˆç®¡ç†å’ŒæœåŠ¡ä¹‹é—´çš„æ²»ç†ï¼Œå¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡æ³¨å†Œï¼ŒæœåŠ¡å‘ç°&lt;/li&gt;
&lt;li&gt;æœåŠ¡ä¼¸ç¼©&lt;/li&gt;
&lt;li&gt;å¥åº·æ£€æŸ¥&lt;/li&gt;
&lt;li&gt;å¿«é€Ÿéƒ¨ç½²&lt;/li&gt;
&lt;li&gt;æœåŠ¡å®¹é”™ï¼šæ–­è·¯å™¨ï¼Œé™æµï¼Œéš”ç¦»èˆ±ï¼Œç†”æ–­ä¿æŠ¤ï¼ŒæœåŠ¡é™çº§ç­‰ç­‰&lt;/li&gt;
&lt;li&gt;è®¤è¯å’Œæˆæƒ&lt;/li&gt;
&lt;li&gt;ç°åº¦å‘å¸ƒæ–¹æ¡ˆ&lt;/li&gt;
&lt;li&gt;æœåŠ¡è°ƒç”¨å¯è§‚æµ‹æ€§ï¼ŒæŒ‡æ ‡æ”¶é›†&lt;/li&gt;
&lt;li&gt;é…ç½®ç®¡ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„çš„å®ç°ä¸­ï¼Œä¸ºæå‡æ•ˆç‡å’Œé™ä½é—¨æ§›ï¼Œåº”ç”¨å¼€å‘è€…ä¼šåŸºäºå¾®æœåŠ¡æ¡†æ¶æ¥å®ç°å¾®æœåŠ¡ã€‚å¾®æœåŠ¡æ¡†æ¶ä¸€å®šç¨‹åº¦ä¸Šä¸ºä½¿ç”¨è€…å±è”½äº†åº•å±‚ç½‘ç»œçš„å¤æ‚æ€§åŠåˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„ä¸ç¡®å®šæ€§ã€‚é€šè¿‡ API/SDK çš„æ–¹å¼æä¾›æœåŠ¡æ³¨å†Œå‘ç°ã€æœåŠ¡ RPC é€šä¿¡ã€æœåŠ¡é…ç½®ç®¡ç†ã€æœåŠ¡è´Ÿè½½å‡è¡¡ã€è·¯ç”±é™æµã€å®¹é”™ã€æœåŠ¡ç›‘æ§åŠæ²»ç†ã€æœåŠ¡å‘å¸ƒåŠå‡çº§ç­‰é€šç”¨èƒ½åŠ›ï¼Œæ¯”è¾ƒå…¸å‹çš„äº§å“æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†å¸ƒå¼ RPC é€šä¿¡æ¡†æ¶ï¼šCOBRA, WebServices, Thrift, GRPC ç­‰&lt;/li&gt;
&lt;li&gt;æœåŠ¡æ²»ç†ç‰¹å®šé¢†åŸŸçš„ç±»åº“å’Œè§£å†³æ–¹æ¡ˆï¼šHystrix, Zookeeper, Zipkin, Sentinel ç­‰&lt;/li&gt;
&lt;li&gt;å¯¹å¤šç§æ–¹æ¡ˆè¿›è¡Œæ•´åˆçš„å¾®æœåŠ¡æ¡†æ¶ï¼šSpringCloudã€Finagleã€Dubbox ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®æ–½å¾®æœåŠ¡çš„æˆæœ¬å¾€å¾€ä¼šè¶…å‡ºä¼ä¸šçš„é¢„æœŸ (å†…å®¹å¤šï¼Œé—¨æ§›é«˜), èŠ±åœ¨æœåŠ¡æ²»ç†ä¸Šçš„æ—¶é—´æˆæœ¬ç”šè‡³å¯èƒ½é«˜è¿‡è¿›è¡Œäº§å“ç ”å‘çš„æ—¶é—´ã€‚å¦å¤–ä¸Šè¿°çš„æ–¹æ¡ˆä¼šé™åˆ¶å¯ç”¨çš„å·¥å…·ã€è¿è¡Œæ—¶å’Œç¼–ç¨‹è¯­è¨€ã€‚å¾®æœåŠ¡è½¯ä»¶åº“ä¸€èˆ¬ä¸“æ³¨äºæŸä¸ªå¹³å°ï¼Œè¿™ä½¿å¾—å¼‚æ„ç³»ç»Ÿéš¾ä»¥å…¼å®¹ï¼Œå­˜åœ¨é‡å¤çš„å·¥ä½œï¼Œç³»ç»Ÿç¼ºä¹å¯ç§»æ¤æ€§ã€‚&lt;/p&gt;
&lt;p&gt;Docker å’Œ Kubernetes æŠ€æœ¯çš„æµè¡Œï¼Œä¸º Pass èµ„æºçš„åˆ†é…ç®¡ç†å’ŒæœåŠ¡çš„éƒ¨ç½²æä¾›äº†æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å¾®æœåŠ¡é¢†åŸŸçš„å…¶ä»–æœåŠ¡æ²»ç†é—®é¢˜ä»ç„¶å­˜åœ¨ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;13-sidecar-æ¨¡å¼çš„å…´èµ·&#34;&gt;1.3 Sidecar æ¨¡å¼çš„å…´èµ·&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr0c6zgunj30nt0d1ta5_hu_a2045265a87f1128.webp 400w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr0c6zgunj30nt0d1ta5_hu_22d67a32e0e16cef.webp 760w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr0c6zgunj30nt0d1ta5_hu_baea5aec071e6211.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/006tNc79ly1fzr0c6zgunj30nt0d1ta5_hu_a2045265a87f1128.webp&#34;
               width=&#34;760&#34;
               height=&#34;416&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Sidecar(æœ‰æ—¶ä¼šå«åš agent) åœ¨åŸæœ‰çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´åŠ å¤šäº†ä¸€ä¸ªä»£ç†ï¼Œä¸ºåº”ç”¨ç¨‹åºæä¾›çš„é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚æœåŠ¡å‘ç°ï¼Œè·¯ç”±ä»£ç†ï¼Œè®¤è¯æˆæƒï¼Œé“¾è·¯è·Ÿè¸ª ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸šç•Œä½¿ç”¨ Sidecar çš„ä¸€äº›å…ˆä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2013 å¹´ï¼ŒAirbnb å¼€å‘äº† Synapse å’Œ Nerveï¼Œæ˜¯ sidecar çš„ä¸€ç§å¼€æºå®ç°&lt;/li&gt;
&lt;li&gt;2014 å¹´ï¼ŒNetflix å‘å¸ƒäº† Pranaï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ª sidecarï¼Œå¯ä»¥è®©é JVM åº”ç”¨æ¥å…¥ä»–ä»¬çš„ NetflixOSS ç”Ÿæ€ç³»ç»Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;14-service-meshæœåŠ¡ç½‘æ ¼-çš„å‡ºç°&#34;&gt;1.4 Service Mesh(æœåŠ¡ç½‘æ ¼) çš„å‡ºç°&lt;/h2&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox.github.io/assets/images/istio/1.4.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç›´è§‚åœ°çœ‹ï¼ŒSidecar åˆ° Service Mesh æ˜¯ä¸€ä¸ªè§„æ¨¡çš„å‡çº§ï¼Œä¸è¿‡ Service Mesh æ›´å¼ºè°ƒçš„æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸å†å°† Sidecar(ä»£ç†) è§†ä¸ºå•ç‹¬çš„ç»„ä»¶ï¼Œè€Œæ˜¯å¼ºè°ƒç”±è¿™äº›ä»£ç†è¿æ¥è€Œå½¢æˆçš„ç½‘ç»œ&lt;/li&gt;
&lt;li&gt;åŸºç¡€è®¾æ–½ï¼Œå¯¹åº”ç”¨ç¨‹åºé€æ˜&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;15-service-mesh-å®šä¹‰&#34;&gt;1.5 Service Mesh å®šä¹‰&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ Linkerd çš„ CEO &lt;a href=&#34;https://twitter.com/wm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Willian Morgan&lt;/a&gt;ç»™å‡ºçš„ Service Mesh çš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A Service Mesh is a dedicated infrastructure layer for handling service-to-service communication. Itâ€™s responsible for the reliable delivery of requests through the complex topology of services that comprise a modern, cloud native application. In practice, the Service Mesh is typically implemented as an array of lightweight network proxies that are deployed alongside application code, without the application needing to be aware.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰æ˜¯è‡´åŠ›äºè§£å†³æœåŠ¡é—´é€šè®¯çš„&lt;strong&gt;åŸºç¡€è®¾æ–½å±‚&lt;/strong&gt;ã€‚å®ƒè´Ÿè´£åœ¨ç°ä»£äº‘åŸç”Ÿåº”ç”¨ç¨‹åºçš„å¤æ‚æœåŠ¡æ‹“æ‰‘æ¥å¯é åœ°ä¼ é€’è¯·æ±‚ã€‚å®é™…ä¸Šï¼ŒService Mesh é€šå¸¸æ˜¯é€šè¿‡ä¸€ç»„&lt;strong&gt;è½»é‡çº§ç½‘ç»œä»£ç†&lt;/strong&gt;ï¼ˆSidecar proxyï¼‰ï¼Œä¸åº”ç”¨ç¨‹åºä»£ç éƒ¨ç½²åœ¨ä¸€èµ·æ¥å®ç°ï¼Œä¸”&lt;strong&gt;å¯¹åº”ç”¨ç¨‹åºé€æ˜&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;16-ç¬¬äºŒä»£-service-mesh&#34;&gt;1.6 ç¬¬äºŒä»£ Service Mesh&lt;/h2&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhongfox.github.io/assets/images/istio/1.6.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ§åˆ¶é¢æ¿å¯¹æ¯ä¸€ä¸ªä»£ç†å®ä¾‹äº†å¦‚æŒ‡æŒï¼Œé€šè¿‡æ§åˆ¶é¢æ¿å¯ä»¥å®ç°ä»£ç†çš„è®¿é—®æ§åˆ¶å’Œåº¦é‡æŒ‡æ ‡æ”¶é›†ï¼Œæå‡äº†æœåŠ¡ç½‘æ ¼çš„å¯è§‚æµ‹æ€§å’Œç®¡æ§èƒ½åŠ›ï¼ŒIstio æ­£æ˜¯è¿™ç±»ç³»ç»Ÿæœ€ä¸ºçªå‡ºçš„ä»£è¡¨ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;17-service-mesh-äº§å“ç®€å²&#34;&gt;1.7 Service Mesh äº§å“ç®€å²&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr01slci0j30n60gnac3_hu_b2d21969fe68892d.webp 400w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr01slci0j30n60gnac3_hu_3d6a6dc5d22378eb.webp 760w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr01slci0j30n60gnac3_hu_c89ec2d7a84ffba.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/006tNc79ly1fzr01slci0j30n60gnac3_hu_b2d21969fe68892d.webp&#34;
               width=&#34;760&#34;
               height=&#34;546&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2016 å¹´ 1 æœˆ 15 æ—¥ï¼Œå‰ Twitter çš„åŸºç¡€è®¾æ–½å·¥ç¨‹å¸ˆ &lt;a href=&#34;https://twitter.com/wm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;William Morgan&lt;/a&gt; å’Œ Oliver Gouldï¼Œåœ¨ GitHub ä¸Šå‘å¸ƒäº† Linkerd 0.0.7 ç‰ˆæœ¬ï¼Œé‡‡ç”¨ Scala ç¼–å†™ï¼Œä»–ä»¬åŒæ—¶ç»„å»ºäº†ä¸€ä¸ªåˆ›ä¸šå°å…¬å¸ Buoyantï¼Œè¿™æ˜¯ä¸šç•Œå…¬è®¤çš„ç¬¬ä¸€ä¸ª Service Mesh&lt;/li&gt;
&lt;li&gt;2016 å¹´ï¼Œ&lt;a href=&#34;https://twitter.com/mattklein123&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Matt Klein&lt;/a&gt;åœ¨ Lyft é»˜é»˜åœ°è¿›è¡Œ Envoy çš„å¼€å‘ã€‚Envoy è¯ç”Ÿçš„æ—¶é—´å…¶å®è¦æ¯” Linkerd æ›´æ—©ä¸€äº›ï¼Œåªæ˜¯åœ¨ Lyft å†…éƒ¨ä¸ä¸ºäººæ‰€çŸ¥&lt;/li&gt;
&lt;li&gt;2016 å¹´ 9 æœˆ 29 æ—¥åœ¨ SF Microservices ä¸Šï¼Œâ€œService Meshâ€è¿™ä¸ªè¯æ±‡ç¬¬ä¸€æ¬¡åœ¨å…¬å¼€åœºåˆè¢«ä½¿ç”¨ã€‚è¿™æ ‡å¿—ç€â€œService Meshâ€è¿™ä¸ªè¯ï¼Œä» Buoyant å…¬å¸èµ°å‘ç¤¾åŒºã€‚&lt;/li&gt;
&lt;li&gt;2016 å¹´ 9 æœˆ 13 æ—¥ï¼ŒMatt Klein å®£å¸ƒ Envoy åœ¨ GitHub å¼€æºï¼Œç›´æ¥å‘å¸ƒ 1.0.0 ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;2016 å¹´ä¸‹åŠå¹´ï¼ŒLinkerd é™†ç»­å‘å¸ƒäº† 0.8 å’Œ 0.9 ç‰ˆæœ¬ï¼Œå¼€å§‹æ”¯æŒ HTTP/2 å’Œ gRPCï¼Œ1.0 å‘å¸ƒåœ¨å³ï¼›åŒæ—¶ï¼Œå€ŸåŠ© Service Mesh åœ¨ç¤¾åŒºçš„è®¤å¯åº¦ï¼ŒLinkerd åœ¨å¹´åº•å¼€å§‹ç”³è¯·åŠ å…¥ CNCF&lt;/li&gt;
&lt;li&gt;2017 å¹´ 1 æœˆ 23 æ—¥ï¼ŒLinkerd åŠ å…¥ CNCFã€‚&lt;/li&gt;
&lt;li&gt;2017 å¹´ 3 æœˆ 7 æ—¥ï¼ŒLinkerd å®£å¸ƒå®Œæˆåƒäº¿æ¬¡äº§å“è¯·æ±‚&lt;/li&gt;
&lt;li&gt;2017 å¹´ 4 æœˆ 25 æ—¥ï¼ŒLinkerd 1.0 ç‰ˆæœ¬å‘å¸ƒ&lt;/li&gt;
&lt;li&gt;2017 å¹´ 7 æœˆ 11 æ—¥ï¼ŒLinkerd å‘å¸ƒç‰ˆæœ¬ 1.1.1ï¼Œå®£å¸ƒå’Œ Istio é¡¹ç›®é›†æˆ&lt;/li&gt;
&lt;li&gt;2017 å¹´ 9 æœˆï¼Œnginx çªç„¶å®£å¸ƒè¦æå‡ºä¸€ä¸ª Servicemesh æ¥ï¼ŒNginmesh: &lt;a href=&#34;https://github.com/nginxinc/nginmesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/nginxinc/nginmesh&lt;/a&gt;, å¯ä»¥ä½œä¸º istio çš„æ•°æ®é¢ï¼Œä¸è¿‡è¿™ä¸ªé¡¹ç›®ç›®å‰å¤„äºä¸æ´»è·ƒå¼€å‘ (This project is no longer under active development)&lt;/li&gt;
&lt;li&gt;2017 å¹´ 12 æœˆ 5 æ—¥ï¼ŒConduit 0.1.0 ç‰ˆæœ¬å‘å¸ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Envoy å’Œ Linkerd éƒ½æ˜¯åœ¨æ•°æ®é¢ä¸Šçš„å®ç°ï¼Œå±äºåŒä¸€ä¸ªå±‚é¢çš„ç«äº‰ï¼Œæ˜¯ç”¨ C++ è¯­è¨€å®ç°çš„ï¼Œåœ¨æ€§èƒ½å’Œèµ„æºæ¶ˆè€—ä¸Šè¦æ¯”é‡‡ç”¨ Scala è¯­è¨€å®ç°çš„ Linkerd å°ï¼Œè¿™ä¸€ç‚¹å¯¹äºå»¶è¿Ÿæ•æ„Ÿå‹å’Œèµ„æºæ•çš„æœåŠ¡å°¤ä¸ºé‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;Envoy å¯¹ ä½œä¸º Istio çš„æ ‡å‡†æ•°æ®é¢å®ç°ï¼Œå…¶æœ€ä¸»è¦çš„è´¡çŒ®æ˜¯æä¾›äº†ä¸€å¥—&lt;a href=&#34;https://github.com/envoyproxy/data-plane-api/blob/master/API_OVERVIEW.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ ‡å‡†æ•°æ®é¢ API&lt;/a&gt;, å°†æœåŠ¡ä¿¡æ¯å’Œæµé‡è§„åˆ™ä¸‹å‘åˆ°æ•°æ®é¢çš„ sidecar ä¸­ï¼Œå¦å¤– Envoy è¿˜æ”¯æŒçƒ­é‡å¯ã€‚Istio æ—©æœŸé‡‡ç”¨äº† Envoy v1 APIï¼Œç›®å‰çš„ç‰ˆæœ¬ä¸­åˆ™ä½¿ç”¨ V2 APIï¼ŒV1 å·²è¢«åºŸå¼ƒã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡é‡‡ç”¨è¯¥æ ‡å‡† APIï¼ŒIstio å°†æ§åˆ¶é¢å’Œæ•°æ®é¢è¿›è¡Œäº†è§£è€¦ï¼Œä¸ºå¤šç§æ•°æ®é¢ sidecar å®ç°æä¾›äº†å¯èƒ½æ€§ã€‚äº‹å®ä¸ŠåŸºäºè¯¥æ ‡å‡† API å·²ç»å®ç°äº†å¤šç§ Sidecar ä»£ç†å’Œ Istio çš„é›†æˆï¼Œé™¤ Istio ç›®å‰é›†æˆçš„ Envoy å¤–ï¼Œè¿˜å¯ä»¥å’Œ Linkerd, Nginmesh ç­‰ç¬¬ä¸‰æ–¹é€šä¿¡ä»£ç†è¿›è¡Œé›†æˆï¼Œä¹Ÿå¯ä»¥åŸºäºè¯¥ API è‡ªå·±ç¼–å†™ Sidecar å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;å°†æ§åˆ¶é¢å’Œæ•°æ®é¢è§£è€¦æ˜¯ Istio åæ¥å±…ä¸Šï¼Œé£å¤´è¶…è¿‡ Service mesh é¼»ç¥– Linkerd çš„ä¸€æ‹›å¦™æ£‹ã€‚Istio ç«™åœ¨äº†æ§åˆ¶é¢çš„é«˜åº¦ä¸Šï¼Œè€Œ Linkerd åˆ™æˆä¸ºäº†å¯é€‰çš„ä¸€ç§ sidecar å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;Conduit çš„æ•´ä½“æ¶æ„å’Œ Istio ä¸€è‡´ï¼Œå€Ÿé‰´äº† Istio æ•°æ®å¹³é¢ + æ§åˆ¶å¹³é¢çš„è®¾è®¡ï¼Œè€Œä¸”é€‰æ‹©äº† Rust ç¼–ç¨‹è¯­è¨€æ¥å®ç°æ•°æ®å¹³é¢ï¼Œä»¥è¾¾æˆ Conduit å®£ç§°çš„æ›´è½»ã€æ›´å¿«å’Œè¶…ä½èµ„æºå ç”¨ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;18-ä¼¼æ›¾ç›¸è¯†çš„ç«äº‰æ ¼å±€&#34;&gt;1.8 ä¼¼æ›¾ç›¸è¯†çš„ç«äº‰æ ¼å±€&lt;/h2&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;/th&gt;
          &lt;th&gt;Kubernetes&lt;/th&gt;
          &lt;th&gt;Istio&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;é¢†åŸŸ&lt;/td&gt;
          &lt;td&gt;å®¹å™¨ç¼–æ’&lt;/td&gt;
          &lt;td&gt;æœåŠ¡ç½‘æ ¼&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ä¸»è¦ç«å“&lt;/td&gt;
          &lt;td&gt;Swarm, Mesos&lt;/td&gt;
          &lt;td&gt;Linkerd, Conduit&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ä¸»è¦ç›Ÿå‹&lt;/td&gt;
          &lt;td&gt;RedHat, CoreOS&lt;/td&gt;
          &lt;td&gt;IBM, Lyft&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ä¸»è¦ç«äº‰å¯¹æ‰‹&lt;/td&gt;
          &lt;td&gt;Docker å…¬å¸&lt;/td&gt;
          &lt;td&gt;Buoyant å…¬å¸&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ ‡å‡†åŒ–&lt;/td&gt;
          &lt;td&gt;OCI: runtime spec, image spec&lt;/td&gt;
          &lt;td&gt;XDS&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ’ä»¶åŒ–&lt;/td&gt;
          &lt;td&gt;CNI, CRI&lt;/td&gt;
          &lt;td&gt;Istio CNI, Mixer Adapter&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ç»“æœ&lt;/td&gt;
          &lt;td&gt;Kubernetes æˆä¸ºå®¹å™¨ç¼–æ’äº‹å®æ ‡å‡†&lt;/td&gt;
          &lt;td&gt;?&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;google ä¸»å¯¼çš„ Kubernetes åœ¨å®¹å™¨ç¼–æ’é¢†åŸŸå–å¾—äº†å®Œèƒœï¼Œç›®å‰åœ¨æœåŠ¡ç½‘æ ¼é¢†åŸŸçš„æ‰“æ³•å¦‚å‡ºä¸€è¾™ï¼Œç¤¾åŒºå¯¹ Istio å‰æ™¯ä¹Ÿæ¯”è¾ƒçœ‹å¥½ã€‚&lt;/p&gt;
&lt;p&gt;Istio CNI è®¡åˆ’åœ¨ 1.1 ä½œä¸ºå®éªŒç‰¹æ€§ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ‰©å±•æ–¹å¼å®šåˆ¶ sidecar çš„ç½‘ç»œã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;19-å›½å†…-service-mesh-å‘å±•æƒ…å†µ&#34;&gt;1.9 å›½å†… Service Mesh å‘å±•æƒ…å†µ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;èš‚èšé‡‘æœå¼€æº SOFAMeshï¼š
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/alipay/sofa-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/alipay/sofa-mesh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä» istio fork&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Golang è¯­è¨€å¼€å‘å…¨æ–°çš„ Sidecarï¼Œæ›¿ä»£ Envoy&lt;/li&gt;
&lt;li&gt;ä¸ºäº†é¿å… Mixer å¸¦æ¥çš„æ€§èƒ½ç“¶é¢ˆï¼Œåˆå¹¶ Mixer éƒ¨åˆ†åŠŸèƒ½è¿›å…¥ Sidecar&lt;/li&gt;
&lt;li&gt;Pilot å’Œ Citadel æ¨¡å—è¿›è¡Œäº†å¤§å¹…çš„æ‰©å±•å’Œå¢å¼º&lt;/li&gt;
&lt;li&gt;æ‰©å±• RPC åè®®ï¼šSOFARPC/HSF/Dubbo&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åä¸ºï¼š
&lt;ul&gt;
&lt;li&gt;go-chassis: &lt;a href=&#34;https://github.com/go-chassis/go-chassis&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/go-chassis/go-chassis&lt;/a&gt; golang å¾®æœåŠ¡æ¡†æ¶ï¼Œæ”¯æŒ istio å¹³å°&lt;/li&gt;
&lt;li&gt;mesher: &lt;a href=&#34;https://github.com/go-mesh/mesher&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/go-mesh/mesher&lt;/a&gt; mesh æ•°æ®é¢è§£å†³æ–¹æ¡ˆ&lt;/li&gt;
&lt;li&gt;å›½å†…é¦–å®¶æä¾› Service Mesh å…¬å…±æœåŠ¡çš„äº‘å‚å•†&lt;/li&gt;
&lt;li&gt;ç›®å‰ (2019 å¹´ 1 æœˆ) å…¬æœ‰äº‘ Istio äº§å“çº¿ä¸Šå·²ç»æ”¯æŒç”³è¯·å…¬æµ‹ï¼Œäº§å“å½¢æ€æ¯”è¾ƒå®Œå–„&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è…¾è®¯äº‘ TSF:
&lt;ul&gt;
&lt;li&gt;åŸºäº Istioã€envoy è¿›è¡Œæ”¹é€ &lt;/li&gt;
&lt;li&gt;æ”¯æŒ Kubernetesã€è™šæ‹Ÿæœºä»¥åŠè£¸é‡‘å±çš„æœåŠ¡&lt;/li&gt;
&lt;li&gt;å¯¹ Istio çš„èƒ½åŠ›è¿›è¡Œäº†æ‰©å±•å’Œå¢å¼ºï¼Œå¯¹ Consul çš„å®Œæ•´é€‚é…&lt;/li&gt;
&lt;li&gt;å¯¹äºå…¶ä»–äºŒè¿›åˆ¶åè®®è¿›è¡Œæ‰©å±•æ”¯æŒ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å”¯å“ä¼š
&lt;ul&gt;
&lt;li&gt;OSP (Open Service Platform)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ–°æµªï¼š
&lt;ul&gt;
&lt;li&gt;Motan: æ˜¯ä¸€å¥—åŸºäº java å¼€å‘çš„ RPC æ¡†æ¶ï¼ŒWeibo Mesh æ˜¯åŸºäº Motan&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;2-istio-ç¬¬äºŒä»£-service-mesh&#34;&gt;2. Istio: ç¬¬äºŒä»£ Service Mesh&lt;/h1&gt;
&lt;p&gt;Istio æ¥è‡ªå¸Œè…Šè¯­ï¼Œè‹±æ–‡æ„æ€æ˜¯ã€Œsailã€, æ„ä¸ºã€Œå¯èˆªã€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2.1 Istio æ¶æ„&lt;/li&gt;
&lt;li&gt;2.2 æ ¸å¿ƒåŠŸèƒ½&lt;/li&gt;
&lt;li&gt;2.3 Istio æ¼”ç¤ºï¼šBookInfo&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;21-istio-æ¶æ„&#34;&gt;2.1 Istio æ¶æ„&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr02d148ij30fj0c1my4_hu_9438657c97d9d155.webp 400w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr02d148ij30fj0c1my4_hu_f5fa9525321530e6.webp 760w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr02d148ij30fj0c1my4_hu_b0d99e1fbd1da8f0.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/006tNc79ly1fzr02d148ij30fj0c1my4_hu_9438657c97d9d155.webp&#34;
               width=&#34;559&#34;
               height=&#34;433&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio Architectureï¼ˆå›¾ç‰‡æ¥è‡ª&lt;a href=&#34;https://istio.io/docs/concepts/what-is-istio/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Isio å®˜ç½‘æ–‡æ¡£&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®é¢
&lt;ul&gt;
&lt;li&gt;Sidecar&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ§åˆ¶é¢
&lt;ul&gt;
&lt;li&gt;Pilotï¼šæœåŠ¡å‘ç°ã€æµé‡ç®¡ç†&lt;/li&gt;
&lt;li&gt;Mixerï¼šè®¿é—®æ§åˆ¶ã€é¥æµ‹&lt;/li&gt;
&lt;li&gt;Citadelï¼šç»ˆç«¯ç”¨æˆ·è®¤è¯ã€æµé‡åŠ å¯†&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;22-æ ¸å¿ƒåŠŸèƒ½&#34;&gt;2.2 æ ¸å¿ƒåŠŸèƒ½&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æµé‡ç®¡ç†&lt;/li&gt;
&lt;li&gt;å®‰å…¨&lt;/li&gt;
&lt;li&gt;å¯è§‚å¯Ÿæ€§&lt;/li&gt;
&lt;li&gt;å¤šå¹³å°æ”¯æŒ&lt;/li&gt;
&lt;li&gt;é›†æˆå’Œå®šåˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æˆ‘å¯¹ Istio æ¶æ„æ€»ç»“çš„æ€ç»´å¯¼å›¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr02jcx0gj30wf0u0jud_hu_71a942bc5571cd07.webp 400w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr02jcx0gj30wf0u0jud_hu_d77e92d72ca5f3c0.webp 760w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr02jcx0gj30wf0u0jud_hu_fb08dc35f8db4edb.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/006tNc79ly1fzr02jcx0gj30wf0u0jud_hu_71a942bc5571cd07.webp&#34;
               width=&#34;760&#34;
               height=&#34;703&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;23-istio-æ¼”ç¤ºbookinfo&#34;&gt;2.3 Istio æ¼”ç¤ºï¼šBookInfo&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ Istio å®˜ç½‘ç»å…¸çš„ BookInfo Demo, è¿™æ˜¯ä¸€ä¸ªå¤šè¯­è¨€ç»„æˆçš„å¼‚æ„å¾®æœåŠ¡ç³»ç»Ÿï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr02xvs54j30h309qt9n_hu_cd64db7bd2889cd7.webp 400w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr02xvs54j30h309qt9n_hu_c4e5bdeca1a2bd93.webp 760w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr02xvs54j30h309qt9n_hu_3c64e0f7faf35975.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/006tNc79ly1fzr02xvs54j30h309qt9n_hu_cd64db7bd2889cd7.webp&#34;
               width=&#34;615&#34;
               height=&#34;350&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Bookinfo Applicationï¼ˆå›¾ç‰‡æ¥è‡ª&lt;a href=&#34;https://istio.io/docs/examples/bookinfo/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Isio å®˜ç½‘æ–‡æ¡£&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘å°†ç°åœºç»™å¤§å®¶è¿›è¡Œæ¼”ç¤ºï¼Œä» demo å®‰è£…å¼€å§‹ï¼Œå¹¶ä½“éªŒä¸€ä¸‹ istio çš„æµæ§åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;h4 id=&#34;ä½¿ç”¨-helm-ç®¡ç†-istio&#34;&gt;ä½¿ç”¨ helm ç®¡ç† istio&lt;/h4&gt;
&lt;p&gt;ä¸‹è½½ istio release: &lt;a href=&#34;https://istio.io/docs/setup/kubernetes/download-release/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/docs/setup/kubernetes/download-release/&lt;/a&gt;&lt;/p&gt;
&lt;h5 id=&#34;å®‰è£…-istio&#34;&gt;å®‰è£… istio:&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f install/kubernetes/helm/istio/templates/crds.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm install install/kubernetes/helm/istio --name istio --namespace istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„äº‹é¡¹ï¼Œè‹¥è¦å¼€å¯ sidecar è‡ªåŠ¨æ³¨å…¥åŠŸèƒ½ï¼Œéœ€è¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¡®ä¿ kube-apiserver å¯åŠ¨å‚æ•° å¼€å¯äº† ValidatingAdmissionWebhook å’Œ MutatingAdmissionWebhook&lt;/li&gt;
&lt;li&gt;ç»™ namespace å¢åŠ  label: &lt;code&gt;kubectl label namespace default istio-injection=enabled&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åŒæ—¶è¿˜è¦ä¿è¯ kube-apiserver çš„ aggregator layer å¼€å¯ï¼š&lt;code&gt;--enable-aggregator-routing=true&lt;/code&gt; ä¸”è¯ä¹¦å’Œ api server è¿é€šæ€§æ­£ç¡®è®¾ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;å¦‚éœ€å¸è½½-istio&#34;&gt;å¦‚éœ€å¸è½½ istio:&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm delete --purge istio
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete -f install/kubernetes/helm/istio/templates/crds.yaml -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ›´å¤šå®‰è£…é€‰æ‹©è¯·å‚è€ƒï¼š&lt;a href=&#34;https://istio.io/docs/setup/kubernetes/helm-install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/docs/setup/kubernetes/helm-install/&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;å®‰è£…-bookinfo-demo&#34;&gt;å®‰è£… Bookinfo Demo:&lt;/h4&gt;
&lt;p&gt;Bookinfo æ˜¯ä¸€ä¸ªå¤šè¯­è¨€å¼‚æ„çš„å¾®æœåŠ¡ demo, å…¶ä¸­ productpage å¾®æœåŠ¡ä¼šè°ƒç”¨ details å’Œ reviews ä¸¤ä¸ªå¾®æœåŠ¡ï¼Œreviews ä¼šè°ƒç”¨ ratings å¾®æœåŠ¡ï¼Œreviews å¾®æœåŠ¡æœ‰ 3 ä¸ªç‰ˆæœ¬ã€‚å…³äºæ­¤é¡¹ç›®æ›´å¤šç»†èŠ‚è¯·å‚è€ƒï¼š&lt;a href=&#34;https://istio.io/docs/examples/bookinfo/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/docs/examples/bookinfo/&lt;/a&gt;&lt;/p&gt;
&lt;h5 id=&#34;éƒ¨ç½²åº”ç”¨&#34;&gt;éƒ¨ç½²åº”ç”¨ï¼š&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/bookinfo/platform/kube/bookinfo.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†åˆ›å»º productpage, details, ratings, reviews å¯¹åº”çš„ deployments å’Œ service, å…¶ä¸­ reviews æœ‰ä¸‰ä¸ª deployments, ä»£è¡¨ä¸‰ä¸ªä¸åŒçš„ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; % kubectl get pod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                           READY     STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;details-v1-6865b9b99d-mnxbt    2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          1m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;productpage-v1-f8c8fb8-zjbhh   2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          59s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ratings-v1-77f657f55d-95rcz    2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          1m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reviews-v1-6b7f6db5c5-zqvkn    2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          59s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reviews-v2-7ff5966b99-lw72l    2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          59s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reviews-v3-5df889bcff-w9v7g    2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          59s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; % kubectl get svc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;S&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;    AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;details       ClusterIP   172.18.255.240   &amp;lt;none&amp;gt;        9080/TCP   1m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;productpage   ClusterIP   172.18.255.137   &amp;lt;none&amp;gt;        9080/TCP   1m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ratings       ClusterIP   172.18.255.41    &amp;lt;none&amp;gt;        9080/TCP   1m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reviews       ClusterIP   172.18.255.140   &amp;lt;none&amp;gt;        9080/TCP   1m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯¹å…¥å£æµé‡è¿›è¡Œé…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥æ“ä½œä¼šåˆ›å»º bookinfo-gateway çš„ Gateway, å¹¶å°†æµé‡å‘é€åˆ° productpage æœåŠ¡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get gateway
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME               AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;bookinfo-gateway   1m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶é€šè¿‡ bookinfo-gateway å¯¹åº”çš„ LB æˆ–è€… nodeport è®¿é—®/productpage é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°ä¸‰ä¸ªç‰ˆæœ¬çš„ reviews æœåŠ¡åœ¨éšæœºåˆ‡æ¢&lt;/p&gt;
&lt;h4 id=&#34;åŸºäºæƒé‡çš„è·¯ç”±&#34;&gt;åŸºäºæƒé‡çš„è·¯ç”±&lt;/h4&gt;
&lt;p&gt;é€šè¿‡ CRD DestinationRule åˆ›å»º 3 ä¸ª reviews å­ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/bookinfo/networking/destination-rule-reviews.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡ CRD VirtualService è°ƒæ•´ä¸ª reviews æœåŠ¡å­ç‰ˆæœ¬çš„æµé‡æ¯”ä¾‹ï¼Œè®¾ç½® v1 å’Œ v3 å„å  50%&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-50-v3.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ·æ–°é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°æ— æ³•å†çœ‹åˆ° reviews v2 çš„å†…å®¹ï¼Œé¡µé¢åœ¨ v1 å’Œ v3 ä¹‹é—´åˆ‡æ¢ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åŸºäºå†…å®¹è·¯ç”±&#34;&gt;åŸºäºå†…å®¹è·¯ç”±&lt;/h4&gt;
&lt;p&gt;ä¿®æ”¹ reviews CRD, å°† jason ç™»å½•çš„ç”¨æˆ·ç‰ˆæœ¬è·¯ç”±åˆ° v2, å…¶ä»–ç”¨æˆ·è·¯ç”±åˆ°ç‰ˆæœ¬ v3.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-jason-v2-v3.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ·æ–°é¡µé¢ï¼Œä½¿ç”¨ jason ç™»å½•çš„ç”¨æˆ·ï¼Œå°†çœ‹åˆ° v2 é»‘è‰²æ˜Ÿæ˜Ÿç‰ˆæœ¬ï¼Œå…¶ä»–ç”¨æˆ·å°†çœ‹åˆ° v3 çº¢è‰²æ˜Ÿæ˜Ÿç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;æ›´å¤š BookInfo ç¤ºä¾‹ï¼Œè¯·å‚é˜…ï¼š&lt;a href=&#34;https://istio.io/docs/examples/bookinfo/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/docs/examples/bookinfo/&lt;/a&gt;, è‹¥è¦åˆ é™¤åº”ç”¨ï¼šæ‰§è¡Œè„šæœ¬ &lt;code&gt;./samples/bookinfo/platform/kube/cleanup.sh&lt;/code&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;3-istio-æ•°æ®é¢&#34;&gt;3. Istio æ•°æ®é¢&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;3.1 æ•°æ®é¢ç»„ä»¶&lt;/li&gt;
&lt;li&gt;3.2 sidecar æµé‡åŠ«æŒåŸç†&lt;/li&gt;
&lt;li&gt;3.3 æ•°æ®é¢æ ‡å‡† API: xDS&lt;/li&gt;
&lt;li&gt;3.4 åˆ†å¸ƒå¼è·Ÿè¸ª&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;31-æ•°æ®é¢ç»„ä»¶&#34;&gt;3.1 æ•°æ®é¢ç»„ä»¶&lt;/h2&gt;
&lt;p&gt;Istio æ³¨å…¥ sidecar å®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨æ³¨å…¥ï¼šåˆ©ç”¨ &lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Dynamic Admission Webhooks&lt;/a&gt; å¯¹ æ–°å»ºçš„ pod è¿›è¡Œæ³¨å…¥ï¼šinit container + sidecar&lt;/li&gt;
&lt;li&gt;æ‰‹åŠ¨æ³¨å…¥ï¼šä½¿ç”¨&lt;code&gt;istioctl kube-inject&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ³¨å…¥ Pod å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;istio-init: é€šè¿‡é…ç½® iptables æ¥åŠ«æŒ Pod ä¸­çš„æµé‡&lt;/li&gt;
&lt;li&gt;istio-proxy: ä¸¤ä¸ªè¿›ç¨‹ pilot-agent å’Œ envoy, pilot-agent è¿›è¡Œåˆå§‹åŒ–å¹¶å¯åŠ¨ envoy&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;sidecar-è‡ªåŠ¨æ³¨å…¥å®ç°&#34;&gt;Sidecar è‡ªåŠ¨æ³¨å…¥å®ç°&lt;/h4&gt;
&lt;p&gt;Istio åˆ©ç”¨ &lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Dynamic Admission Webhooks&lt;/a&gt; å¯¹ pod è¿›è¡Œ sidecar æ³¨å…¥&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ istio å¯¹è¿™ 2 ä¸ª Webhooks çš„é…ç½® ValidatingWebhookConfiguration å’Œ MutatingWebhookConfiguration:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl get ValidatingWebhookConfiguration -oyaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% kubectl get mutatingWebhookConfiguration -oyaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹å‡ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘½åç©ºé—´&lt;code&gt;istio-system&lt;/code&gt; ä¸­çš„æœåŠ¡ &lt;code&gt;istio-galley&lt;/code&gt;, é€šè¿‡è·¯ç”±&lt;code&gt;/admitpilot&lt;/code&gt;, å¤„ç† config.istio.io éƒ¨åˆ†ï¼Œrbac.istio.io, authentication.istio.io, networking.istio.io ç­‰èµ„æºçš„ Validating å·¥ä½œ&lt;/li&gt;
&lt;li&gt;å‘½åç©ºé—´ istio-system ä¸­çš„æœåŠ¡ &lt;code&gt;istio-galley&lt;/code&gt;, é€šè¿‡è·¯ç”±&lt;code&gt;/admitmixer&lt;/code&gt;, å¤„ç†å…¶ä»– config.istio.io èµ„æºçš„ Validating å·¥ä½œ&lt;/li&gt;
&lt;li&gt;å‘½åç©ºé—´ istio-system ä¸­çš„æœåŠ¡ &lt;code&gt;istio-sidecar-injector&lt;/code&gt;, é€šè¿‡è·¯ç”±&lt;code&gt;/inject&lt;/code&gt;, å¤„ç†å…¶ä»–&lt;code&gt;v1/pods&lt;/code&gt;çš„ CREATE, åŒæ—¶éœ€è¦æ»¡è¶³å‘½åç©ºé—´&lt;code&gt;istio-injection: enabled&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;istio-init&#34;&gt;istio-init&lt;/h4&gt;
&lt;p&gt;æ•°æ®é¢çš„æ¯ä¸ª Pod ä¼šè¢«æ³¨å…¥ä¸€ä¸ªåä¸º&lt;code&gt;istio-init&lt;/code&gt; çš„ initContainer, initContrainer æ˜¯ K8S æä¾›çš„æœºåˆ¶ï¼Œç”¨äºåœ¨ Pod ä¸­æ‰§è¡Œä¸€äº›åˆå§‹åŒ–ä»»åŠ¡ã€‚åœ¨ Initialcontainer æ‰§è¡Œå®Œæ¯•å¹¶é€€å‡ºåï¼Œæ‰ä¼šå¯åŠ¨ Pod ä¸­çš„å…¶å®ƒ container.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;initContainers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker.io/istio/proxy_init:1.0.5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;15001&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;1337&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;REDIRECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- -&lt;span class=&#34;l&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;istio-init ENTRYPOINT å’Œ args ç»„åˆçš„å¯åŠ¨å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/local/bin/istio-iptables.sh -p &lt;span class=&#34;m&#34;&gt;15001&lt;/span&gt; -u &lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt; -m REDIRECT -i &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt; -x &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; -b &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt; -d &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;istio-iptables.sh æºç åœ°å€ä¸º &lt;a href=&#34;https://github.com/istio/istio/blob/master/tools/deb/istio-iptables.sh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/istio/istio/blob/master/tools/deb/istio-iptables.sh&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istio-iptables.sh -p PORT -u UID -g GID &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-m mode&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-b ports&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-d ports&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-i CIDR&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-x CIDR&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-h&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -p: æŒ‡å®šé‡å®šå‘æ‰€æœ‰ TCP æµé‡çš„ Envoy ç«¯å£ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ENVOY_PORT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 15001ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -u: æŒ‡å®šæœªåº”ç”¨é‡å®šå‘çš„ç”¨æˆ·çš„ UIDã€‚é€šå¸¸ï¼Œè¿™æ˜¯ä»£ç†å®¹å™¨çš„ UIDï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ENVOY_USER&lt;/span&gt; çš„ uidï¼Œistio_proxy çš„ uid æˆ– 1337ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -g: æŒ‡å®šæœªåº”ç”¨é‡å®šå‘çš„ç”¨æˆ·çš„ GIDã€‚ï¼ˆä¸ -u param ç›¸åŒçš„é»˜è®¤å€¼ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -m: æŒ‡å®šå…¥ç«™è¿æ¥é‡å®šå‘åˆ° Envoy çš„æ¨¡å¼ï¼Œâ€œREDIRECTâ€ æˆ– â€œTPROXYâ€ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_INBOUND_INTERCEPTION_MODE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -b: é€—å·åˆ†éš”çš„å…¥ç«™ç«¯å£åˆ—è¡¨ï¼Œå…¶æµé‡å°†é‡å®šå‘åˆ° Envoyï¼ˆå¯é€‰ï¼‰ã€‚ä½¿ç”¨é€šé…ç¬¦ â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰ç«¯å£ã€‚ä¸ºç©ºæ—¶è¡¨ç¤ºç¦ç”¨æ‰€æœ‰å…¥ç«™é‡å®šå‘ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_INBOUND_PORTS&lt;/span&gt;ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -d: æŒ‡å®šè¦ä»é‡å®šå‘åˆ° Envoy ä¸­æ’é™¤ï¼ˆå¯é€‰ï¼‰çš„å…¥ç«™ç«¯å£åˆ—è¡¨ï¼Œä»¥é€—å·æ ¼å¼åˆ†éš”ã€‚ä½¿ç”¨é€šé…ç¬¦â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰å…¥ç«™æµé‡ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_LOCAL_EXCLUDE_PORTS&lt;/span&gt;ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -i: æŒ‡å®šé‡å®šå‘åˆ° Envoyï¼ˆå¯é€‰ï¼‰çš„ IP åœ°å€èŒƒå›´ï¼Œä»¥é€—å·åˆ†éš”çš„ CIDR æ ¼å¼åˆ—è¡¨ã€‚ä½¿ç”¨é€šé…ç¬¦ â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰å‡ºç«™æµé‡ã€‚ç©ºåˆ—è¡¨å°†ç¦ç”¨æ‰€æœ‰å‡ºç«™é‡å®šå‘ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_SERVICE_CIDR&lt;/span&gt;ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -x: æŒ‡å®šå°†ä»é‡å®šå‘ä¸­æ’é™¤çš„ IP åœ°å€èŒƒå›´ï¼Œä»¥é€—å·åˆ†éš”çš„ CIDR æ ¼å¼åˆ—è¡¨ã€‚ä½¿ç”¨é€šé…ç¬¦ â€œ*â€ è¡¨ç¤ºé‡å®šå‘æ‰€æœ‰å‡ºç«™æµé‡ï¼ˆé»˜è®¤ä¸º &lt;span class=&#34;nv&#34;&gt;$ISTIO_SERVICE_EXCLUDE_CIDR&lt;/span&gt;ï¼‰ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ç¯å¢ƒå˜é‡ä½äº &lt;span class=&#34;nv&#34;&gt;$ISTIO_SIDECAR_CONFIG&lt;/span&gt;ï¼ˆé»˜è®¤åœ¨ï¼š/var/lib/istio/envoy/sidecar.envï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;istio-init é€šè¿‡é…ç½® iptable æ¥åŠ«æŒ Pod ä¸­çš„æµé‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‚æ•°&lt;code&gt;-p 15001&lt;/code&gt;: Pod ä¸­çš„æ•°æ®æµé‡è¢« iptable æ‹¦æˆªï¼Œå¹¶å‘å‘ 15001 ç«¯å£ï¼Œè¯¥ç«¯å£å°†ç”± envoy ç›‘å¬&lt;/li&gt;
&lt;li&gt;å‚æ•°&lt;code&gt;-u 1337&lt;/code&gt;: ç”¨äºæ’é™¤ç”¨æˆ· ID ä¸º 1337ï¼Œå³ Envoy è‡ªèº«çš„æµé‡ï¼Œä»¥é¿å… Iptable æŠŠ Envoy å‘å‡ºçš„æ•°æ®åˆé‡å®šå‘åˆ° Envoy, UID ä¸º 1337ï¼Œå³ Envoy æ‰€å¤„çš„ç”¨æˆ·ç©ºé—´ï¼Œè¿™ä¹Ÿæ˜¯ istio-proxy å®¹å™¨é»˜è®¤ä½¿ç”¨çš„ç”¨æˆ·ï¼Œè§ Sidecar &lt;code&gt;istio-proxy&lt;/code&gt; é…ç½®å‚æ•°&lt;code&gt;securityContext.runAsUser&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å‚æ•°&lt;code&gt;-b 9080&lt;/code&gt; &lt;code&gt;-d &amp;quot;&amp;quot;&lt;/code&gt;: å…¥ç«™ç«¯å£æ§åˆ¶ï¼Œå°†æ‰€æœ‰è®¿é—® 9080 ç«¯å£ï¼ˆå³åº”ç”¨å®¹å™¨çš„ç«¯å£ï¼‰çš„æµé‡é‡å®šå‘åˆ° Envoy ä»£ç†&lt;/li&gt;
&lt;li&gt;å‚æ•°&lt;code&gt;-i &#39;*&#39;&lt;/code&gt; &lt;code&gt;-x &amp;quot;&amp;quot;&lt;/code&gt;: å‡ºç«™ IP æ§åˆ¶ï¼Œå°†æ‰€æœ‰å‡ºç«™æµé‡éƒ½é‡å®šå‘åˆ° Envoy ä»£ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Init å®¹å™¨åˆå§‹åŒ–å®Œæ¯•åå°±ä¼šè‡ªåŠ¨ç»ˆæ­¢ï¼Œä½†æ˜¯ Init å®¹å™¨åˆå§‹åŒ–ç»“æœ (iptables) ä¼šä¿ç•™åˆ°åº”ç”¨å®¹å™¨å’Œ Sidecar å®¹å™¨ä¸­ã€‚&lt;/p&gt;
&lt;h4 id=&#34;istio-proxy&#34;&gt;istio-proxy&lt;/h4&gt;
&lt;p&gt;istio-proxy ä»¥ sidecar çš„å½¢å¼æ³¨å…¥åˆ°åº”ç”¨å®¹å™¨æ‰€åœ¨çš„ pod ä¸­ï¼Œç®€åŒ–çš„æ³¨å…¥ yaml:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker.io/istio/proxyv2:1.0.5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;sidecar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;configPath&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/etc/istio/proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;binaryPath&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/usr/local/bin/envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;serviceCluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;ratings&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;drainDuration&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;45s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;parentShutdownDuration&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;1m0s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;discoveryAddress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;istio-pilot.istio-system:15007&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;discoveryRefreshDelay&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;1s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;zipkinAddress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;zipkin.istio-system:9411&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;connectTimeout&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;10s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;proxyAdminPort&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;15000&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;controlPlaneAuthPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;NONE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;......&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;15090&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-envoy-prom&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;securityContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runAsUser&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1337&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;......&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;istio-proxy å®¹å™¨ä¸­æœ‰ä¸¤ä¸ªè¿›ç¨‹ pilot-agent å’Œ envoy:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;~ % kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; productpage-v1-f8c8fb8-wgmzk -c istio-proxy -- ps -ef
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;UID        PID  PPID  C STIME TTY          TIME CMD
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-p+     &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; Jan03 ?        00:00:27 /usr/local/bin/pilot-agent proxy sidecar --configPath /etc/istio/proxy --binaryPath /usr/local/bin/envoy --serviceCluster productpage --drainDuration 45s --parentShutdownDuration 1m0s --discoveryAddress istio-pilot.istio-system:15007 --discoveryRefreshDelay 1s --zipkinAddress zipkin.istio-system:9411 --connectTimeout 10s --proxyAdminPort &lt;span class=&#34;m&#34;&gt;15000&lt;/span&gt; --controlPlaneAuthPolicy NONE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-p+    &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; Jan03 ?        01:26:24 /usr/local/bin/envoy -c /etc/istio/proxy/envoy-rev0.json --restart-epoch &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; --drain-time-s &lt;span class=&#34;m&#34;&gt;45&lt;/span&gt; --parent-shutdown-time-s &lt;span class=&#34;m&#34;&gt;60&lt;/span&gt; --service-cluster productpage --service-node sidecar~172.18.3.12~productpage-v1-f8c8fb8-wgmzk.default~default.svc.cluster.local --max-obj-name-len &lt;span class=&#34;m&#34;&gt;189&lt;/span&gt; --allow-unknown-fields -l warn --v2-config-only
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/usr/local/bin/pilot-agent&lt;/code&gt; æ˜¯ &lt;code&gt;/usr/local/bin/envoy&lt;/code&gt; çš„çˆ¶è¿›ç¨‹ï¼ŒPilot-agent è¿›ç¨‹æ ¹æ®å¯åŠ¨å‚æ•°å’Œ K8S API Server ä¸­çš„é…ç½®ä¿¡æ¯ç”Ÿæˆ Envoy çš„åˆå§‹é…ç½®æ–‡ä»¶ (&lt;code&gt;/etc/istio/proxy/envoy-rev0.json&lt;/code&gt;)ï¼Œå¹¶è´Ÿè´£å¯åŠ¨ Envoy è¿›ç¨‹&lt;/li&gt;
&lt;li&gt;pilot-agent çš„å¯åŠ¨å‚æ•°é‡ŒåŒ…æ‹¬ï¼šdiscoveryAddress(pilot æœåŠ¡åœ°å€), Envoy äºŒè¿›åˆ¶æ–‡ä»¶çš„ä½ç½®ï¼ŒæœåŠ¡é›†ç¾¤åï¼Œç›‘æ§æŒ‡æ ‡ä¸ŠæŠ¥åœ°å€ï¼ŒEnvoy çš„ç®¡ç†ç«¯å£ï¼Œçƒ­é‡å¯æ—¶é—´ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Envoy é…ç½®åˆå§‹åŒ–æµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Pilot-agent æ ¹æ®å¯åŠ¨å‚æ•°å’Œ K8S API Server ä¸­çš„é…ç½®ä¿¡æ¯ç”Ÿæˆ Envoy çš„åˆå§‹é…ç½®æ–‡ä»¶ envoy-rev0.jsonï¼Œè¯¥æ–‡ä»¶å‘Šè¯‰ Envoy ä» xDS server ä¸­è·å–åŠ¨æ€é…ç½®ä¿¡æ¯ï¼Œå¹¶é…ç½®äº† xDS server çš„åœ°å€ä¿¡æ¯ï¼Œå³æ§åˆ¶é¢çš„ Pilot&lt;/li&gt;
&lt;li&gt;Pilot-agent ä½¿ç”¨ envoy-rev0.json å¯åŠ¨ Envoy è¿›ç¨‹&lt;/li&gt;
&lt;li&gt;Envoy æ ¹æ®åˆå§‹é…ç½®è·å¾— Pilot åœ°å€ï¼Œé‡‡ç”¨ xDS æ¥å£ä» Pilot è·å–åˆ° Listenerï¼ŒClusterï¼ŒRoute ç­‰ d åŠ¨æ€é…ç½®ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;Envoy æ ¹æ®è·å–åˆ°çš„åŠ¨æ€é…ç½®å¯åŠ¨ Listenerï¼Œå¹¶æ ¹æ® Listener çš„é…ç½®ï¼Œç»“åˆ Route å’Œ Cluster å¯¹æ‹¦æˆªåˆ°çš„æµé‡è¿›è¡Œå¤„ç†&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æŸ¥çœ‹ envoy åˆå§‹é…ç½®æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; productpage-v1-f8c8fb8-wgmzk -c istio-proxy -- cat /etc/istio/proxy/envoy-rev0.json
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id=&#34;32-sidecar-æµé‡åŠ«æŒåŸç†&#34;&gt;3.2 sidecar æµé‡åŠ«æŒåŸç†&lt;/h2&gt;
&lt;p&gt;sidecar æ—¢è¦ä½œä¸ºæœåŠ¡æ¶ˆè´¹è€…ç«¯çš„æ­£å‘ä»£ç†ï¼Œåˆè¦ä½œä¸ºæœåŠ¡æä¾›è€…ç«¯çš„åå‘ä»£ç†ï¼Œå…·ä½“æ‹¦æˆªè¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pod æ‰€åœ¨çš„ network namespace å†…ï¼Œé™¤äº† envoy å‘å‡ºçš„æµé‡å¤–ï¼Œiptables è§„åˆ™ä¼šå¯¹è¿›å…¥å’Œå‘å‡ºçš„æµé‡éƒ½è¿›è¡Œæ‹¦æˆªï¼Œé€šè¿‡ nat redirect é‡å®šå‘åˆ° Envoy ç›‘å¬çš„ 15001 ç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;envoy ä¼šæ ¹æ®ä» Pilot æ‹¿åˆ°çš„ XDS è§„åˆ™ï¼Œå¯¹æµé‡è¿›è¡Œè½¬å‘ã€‚&lt;/li&gt;
&lt;li&gt;envoy çš„ listener 0.0.0.0:15001 æ¥æ”¶è¿›å‡º Pod çš„æ‰€æœ‰æµé‡ï¼Œç„¶åå°†è¯·æ±‚ç§»äº¤ç»™å¯¹åº”çš„ virtual listener&lt;/li&gt;
&lt;li&gt;å¯¹äºæœ¬ pod çš„æœåŠ¡ï¼Œæœ‰ä¸€ä¸ª http listener &lt;code&gt;podIP+ç«¯å£&lt;/code&gt; æ¥å— inbound æµé‡&lt;/li&gt;
&lt;li&gt;æ¯ä¸ª service+é http ç«¯å£ï¼Œç›‘å¬å™¨é…å¯¹çš„ Outbound é HTTP æµé‡&lt;/li&gt;
&lt;li&gt;æ¯ä¸ª service+http ç«¯å£ï¼Œæœ‰ä¸€ä¸ª http listener: &lt;code&gt;0.0.0.0+ç«¯å£&lt;/code&gt; æ¥å— outbound æµé‡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ•´ä¸ªæ‹¦æˆªè½¬å‘è¿‡ç¨‹å¯¹ä¸šåŠ¡å®¹å™¨æ˜¯é€æ˜çš„ï¼Œä¸šåŠ¡å®¹å™¨ä»ç„¶ä½¿ç”¨ Service åŸŸåå’Œç«¯å£è¿›è¡Œé€šä¿¡ï¼Œservice åŸŸåä»ç„¶ä¼šè½¬æ¢ä¸º service IP, ä½† service IP åœ¨ sidecar ä¸­ä¼šè¢«ç›´æ¥è½¬æ¢ä¸º pod IP, ä»å®¹å™¨ä¸­å‡ºå»çš„æµé‡å·²ç»ä½¿ç”¨äº† pod IP ä¼šç›´æ¥è½¬å‘åˆ°å¯¹åº”çš„ Pod, å¯¹æ¯”ä¼ ç»Ÿ kubernetes æœåŠ¡æœºåˆ¶ï¼Œservice IP è½¬æ¢ä¸º Pod IP åœ¨ node ä¸Šè¿›è¡Œï¼Œç”± kube-proxy ç»´æŠ¤çš„ iptables å®ç°ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;33-æ•°æ®é¢æ ‡å‡†-api-xds&#34;&gt;3.3 æ•°æ®é¢æ ‡å‡† API: xDS&lt;/h2&gt;
&lt;p&gt;xDS æ˜¯ä¸€ç±»å‘ç°æœåŠ¡çš„æ€»ç§°ï¼ŒåŒ…å« LDSï¼ŒRDSï¼ŒCDSï¼ŒEDS ä»¥åŠ SDSã€‚Envoy é€šè¿‡ xDS API å¯ä»¥åŠ¨æ€è·å– Listener(ç›‘å¬å™¨)ï¼ŒRoute(è·¯ç”±)ï¼ŒCluster(é›†ç¾¤)ï¼ŒEndpoint(é›†ç¾¤æˆå‘˜) ä»¥ åŠ Secret(è¯ä¹¦) é…ç½®&lt;/p&gt;
&lt;p&gt;xDS API æ¶‰åŠçš„æ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Host&lt;/li&gt;
&lt;li&gt;Downstream&lt;/li&gt;
&lt;li&gt;Upstream&lt;/li&gt;
&lt;li&gt;Listener&lt;/li&gt;
&lt;li&gt;Cluster&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Envoy é…ç½®çƒ­æ›´æ–°ï¼šé…ç½®çš„åŠ¨æ€å˜æ›´ï¼Œè€Œä¸éœ€è¦é‡å¯ Envoy:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ–°è€è¿›ç¨‹é‡‡ç”¨åŸºæœ¬çš„ RPC åè®®ä½¿ç”¨ Unix Domain Socket é€šè®¯ã€‚&lt;/li&gt;
&lt;li&gt;æ–°è¿›ç¨‹å¯åŠ¨å¹¶å®Œæˆæ‰€æœ‰åˆå§‹åŒ–å·¥ä½œåï¼Œå‘è€è¿›ç¨‹è¯·æ±‚ç›‘å¬å¥—æ¥å­—çš„å‰¯æœ¬ã€‚&lt;/li&gt;
&lt;li&gt;æ–°è¿›ç¨‹æ¥ç®¡å¥—æ¥å­—åï¼Œé€šçŸ¥è€è¿›ç¨‹å…³é—­å¥—æ¥å­—ã€‚&lt;/li&gt;
&lt;li&gt;é€šçŸ¥è€è¿›ç¨‹ç»ˆæ­¢è‡ªå·±ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;xds-è°ƒè¯•&#34;&gt;xDS è°ƒè¯•&lt;/h4&gt;
&lt;p&gt;Pilot åœ¨ 9093 ç«¯å£æä¾›äº†ä¸‹è¿°è°ƒè¯•æ¥å£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# What is sent to envoy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Listeners and routes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl &lt;span class=&#34;nv&#34;&gt;$PILOT&lt;/span&gt;/debug/adsz
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Endpoints&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl &lt;span class=&#34;nv&#34;&gt;$PILOT&lt;/span&gt;/debug/edsz
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Clusters&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl &lt;span class=&#34;nv&#34;&gt;$PILOT&lt;/span&gt;/debug/cdsz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Sidecar Envoy ä¹Ÿæä¾›äº†ç®¡ç†æ¥å£ï¼Œç¼ºçœä¸º localhost çš„ 15000 ç«¯å£ï¼Œå¯ä»¥è·å– listenerï¼Œcluster ä»¥åŠå®Œæ•´çš„é…ç½®æ•°æ®&lt;/p&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ”¯æŒçš„è°ƒè¯•æ¥å£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; productpage-v1-f8c8fb8-zjbhh -c istio-proxy curl http://127.0.0.1:15000/help
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ–è€… forward åˆ°æœ¬åœ°å°±è¡Œè°ƒè¯•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl port-forward productpage-v1-f8c8fb8-zjbhh &lt;span class=&#34;m&#34;&gt;15000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç›¸å…³çš„è°ƒè¯•æ¥å£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;http://127.0.0.1:15000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;http://127.0.0.1:15000/help
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;http://127.0.0.1:15000/config_dump
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;http://127.0.0.1:15000/listeners
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;http://127.0.0.1:15000/clusters
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ istioctl æŸ¥çœ‹ä»£ç†é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl pc &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;xDSç±»å‹&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;POD_NAME&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;è¿‡æ»¤æ¡ä»¶&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;-o json/yaml&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;eg:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl pc routes productpage-v1-f8c8fb8-zjbhh --name &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt; -o json
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;xDS ç±»å‹åŒ…æ‹¬ï¼šlistener, route, cluster, endpoint&lt;/p&gt;
&lt;h4 id=&#34;å¯¹-xds-è¿›è¡Œåˆ†æproductpage-è®¿é—®-reviews-æœåŠ¡&#34;&gt;å¯¹ xDS è¿›è¡Œåˆ†æï¼šproductpage è®¿é—® reviews æœåŠ¡&lt;/h4&gt;
&lt;p&gt;æŸ¥çœ‹ product çš„æ‰€æœ‰ listener:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% istioctl pc listener  productpage-v1-f8c8fb8-zjbhh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ADDRESS            PORT      TYPE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.178     &lt;span class=&#34;m&#34;&gt;15011&lt;/span&gt;     TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.194     &lt;span class=&#34;m&#34;&gt;44134&lt;/span&gt;     TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.110     &lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;       TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.190     &lt;span class=&#34;m&#34;&gt;50000&lt;/span&gt;     TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.203     &lt;span class=&#34;m&#34;&gt;853&lt;/span&gt;       TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.2       &lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;       TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.239     &lt;span class=&#34;m&#34;&gt;16686&lt;/span&gt;     TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.0.0.0            &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;        TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.215     &lt;span class=&#34;m&#34;&gt;3306&lt;/span&gt;      TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.203     &lt;span class=&#34;m&#34;&gt;31400&lt;/span&gt;     TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.111     &lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;       TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.203     &lt;span class=&#34;m&#34;&gt;8060&lt;/span&gt;      TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.203     &lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;       TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.40      &lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;       TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.1       &lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;       TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.53      &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt;        TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.203     &lt;span class=&#34;m&#34;&gt;15011&lt;/span&gt;     TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.105     &lt;span class=&#34;m&#34;&gt;14268&lt;/span&gt;     TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.125     &lt;span class=&#34;m&#34;&gt;42422&lt;/span&gt;     TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.105     &lt;span class=&#34;m&#34;&gt;14267&lt;/span&gt;     TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.255.52      &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;        TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.0.0.0            &lt;span class=&#34;m&#34;&gt;15010&lt;/span&gt;     HTTP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.0.0.0            &lt;span class=&#34;m&#34;&gt;9411&lt;/span&gt;      HTTP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.0.0.0            &lt;span class=&#34;m&#34;&gt;8060&lt;/span&gt;      HTTP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.0.0.0            &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;      HTTP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.0.0.0            &lt;span class=&#34;m&#34;&gt;15004&lt;/span&gt;     HTTP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.0.0.0            &lt;span class=&#34;m&#34;&gt;20001&lt;/span&gt;     HTTP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.0.0.0            &lt;span class=&#34;m&#34;&gt;9093&lt;/span&gt;      HTTP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.0.0.0            &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;      HTTP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.0.0.0            &lt;span class=&#34;m&#34;&gt;15030&lt;/span&gt;     HTTP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.0.0.0            &lt;span class=&#34;m&#34;&gt;9091&lt;/span&gt;      HTTP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.0.0.0            &lt;span class=&#34;m&#34;&gt;9090&lt;/span&gt;      HTTP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.0.0.0            &lt;span class=&#34;m&#34;&gt;15031&lt;/span&gt;     HTTP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.0.0.0            &lt;span class=&#34;m&#34;&gt;3000&lt;/span&gt;      HTTP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0.0.0.0            &lt;span class=&#34;m&#34;&gt;15001&lt;/span&gt;     TCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.3.50        &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;      HTTP è¿™æ˜¯å½“å‰pod ip æš´éœ²çš„æœåŠ¡åœ°å€, ä¼šè·¯ç”±åˆ°å›ç¯åœ°å€, å„ä¸ªpod ä¼šä¸ä¸€æ ·
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;envoy æµé‡å…¥å£çš„ listener:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% istioctl pc listener  productpage-v1-f8c8fb8-zjbhh --address 0.0.0.0 --port &lt;span class=&#34;m&#34;&gt;15001&lt;/span&gt; -o json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;virtual&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;15001&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;filterChains&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;filters&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.tcp_proxy&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;BlackHoleCluster&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;stat_prefix&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;BlackHoleCluster&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;useOriginalDst&amp;#34;&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# è¿™æ„å‘³ç€å®ƒå°†è¯·æ±‚äº¤ç»™æœ€ç¬¦åˆè¯·æ±‚åŸå§‹ç›®æ ‡çš„ç›‘å¬å™¨ã€‚å¦‚æœæ‰¾ä¸åˆ°ä»»ä½•åŒ¹é…çš„è™šæ‹Ÿç›‘å¬å™¨ï¼Œå®ƒä¼šå°†è¯·æ±‚å‘é€ç»™è¿”å› 404 çš„ BlackHoleCluster&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯ reviews çš„æ‰€æœ‰ pod IP&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; % kubectl get ep reviews
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME      ENDPOINTS                                            AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reviews   172.18.2.35:9080,172.18.3.48:9080,172.18.3.49:9080   1d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯¹äºç›®çš„åœ°å€æ˜¯ä»¥ä¸Š ip çš„ http è®¿é—®ï¼Œè¿™äº› ip å¹¶æ²¡æœ‰å¯¹åº”çš„ listener, å› æ­¤ä¼šé€šè¿‡ç«¯å£ 9080 åŒ¹é…åˆ° listener &lt;code&gt;0.0.0.0 9080&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ listener &lt;code&gt;0.0.0.0 9080&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% istioctl pc listener  productpage-v1-f8c8fb8-zjbhh --address 0.0.0.0 --port &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt; -ojson
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0_9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        ......
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;rds&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;s2&#34;&gt;&amp;#34;config_source&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;ads&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;s2&#34;&gt;&amp;#34;route_config_name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            ......
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹åä¸º&lt;code&gt;9080&lt;/code&gt; çš„ route:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% istioctl pc routes  productpage-v1-f8c8fb8-zjbhh --name &lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt; -o json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;virtualHosts&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;details&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;details:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc.cluster&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc.cluster:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default.svc:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.default:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.18.255.240&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.18.255.240:9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080||details.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;maxGrpcTimeout&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        ......
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.default.svc.cluster&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.default.svc.cluster:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.default.svc&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.default.svc:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.default&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.default:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.18.255.137&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.18.255.137:9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; ...... &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc.cluster:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default.svc:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.default:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.18.255.41&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.18.255.41:9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; ...... &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.default.svc.cluster.local:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.default.svc.cluster&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.default.svc.cluster:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.default.svc&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.default.svc:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.default&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.default:9080&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.18.255.140&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.18.255.140:9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;headers&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;end-user&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;exactMatch&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;jason&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080|v2|reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;maxGrpcTimeout&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        ......
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080|v3|reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;timeout&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;s2&#34;&gt;&amp;#34;maxGrpcTimeout&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.000s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        .......
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;validateClusters&amp;#34;&lt;/span&gt;: &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ 9080 è¿™ä¸ª route ä¸­ï¼ŒåŒ…å«æ‰€æœ‰è¿™ä¸ªç«¯å£çš„ http è·¯ç”±ä¿¡æ¯ï¼Œé€šè¿‡ virtualHosts åˆ—è¡¨è¿›è¡ŒæœåŠ¡åŸŸååˆ†å‘åˆ°å„ä¸ª cluster.&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ virtualHosts &lt;code&gt;reviews.default.svc.cluster.local:9080&lt;/code&gt; ä¸­çš„ routes ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ° jason è·¯ç”±åˆ°äº† cluster &lt;code&gt;outbound|9080|v2|reviews.default.svc.cluster.local&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹è¯¥ cluster:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% istioctl pc cluster productpage-v1-f8c8fb8-zjbhh --fqdn reviews.default.svc.cluster.local --subset v2 -o json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080|v2|reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;EDS&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;edsClusterConfig&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;edsConfig&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;ads&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;serviceName&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080|v2|reviews.default.svc.cluster.local&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;connectTimeout&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;1.000s&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;lbPolicy&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;RANDOM&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;circuitBreakers&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;thresholds&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹å…¶å¯¹åº”çš„ endpoint:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; % istioctl pc endpoint productpage-v1-f8c8fb8-zjbhh --cluster &lt;span class=&#34;s1&#34;&gt;&amp;#39;outbound|9080|v2|reviews.default.svc.cluster.local&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ENDPOINT             STATUS      CLUSTER
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.2.35:9080     HEALTHY     outbound&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;9080&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;v2&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;reviews.default.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥ endpoint å³ä¸º reviews æœåŠ¡ V2 å¯¹åº”çš„ pod IP&lt;/p&gt;
&lt;h4 id=&#34;xds-æœåŠ¡æ¥å£çš„æœ€ç»ˆä¸€è‡´æ€§è€ƒè™‘&#34;&gt;XDS æœåŠ¡æ¥å£çš„æœ€ç»ˆä¸€è‡´æ€§è€ƒè™‘&lt;/h4&gt;
&lt;p&gt;éµå¾ª make before break æ¨¡å‹&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;34-åˆ†å¸ƒå¼è·Ÿè¸ª&#34;&gt;3.4 åˆ†å¸ƒå¼è·Ÿè¸ª&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯åˆ†å¸ƒå¼å…¨é“¾è·¯è·Ÿè¸ªç¤ºæ„å›¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr03q5ehnj30d207ddgc_hu_e5f49f98e16e976d.webp 400w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr03q5ehnj30d207ddgc_hu_4a984ec839cd706d.webp 760w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr03q5ehnj30d207ddgc_hu_211ab1ac53cddc56.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/006tNc79ly1fzr03q5ehnj30d207ddgc_hu_e5f49f98e16e976d.webp&#34;
               width=&#34;470&#34;
               height=&#34;265&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªå…¸å‹çš„ Trace æ¡ˆä¾‹ï¼ˆå›¾ç‰‡æ¥è‡ª&lt;a href=&#34;https://wu-sheng.gitbooks.io/opentracing-io/content/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;opentracing æ–‡æ¡£ä¸­æ–‡ç‰ˆ&lt;/a&gt;)&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Jaeger æ˜¯ Uber å¼€æºçš„å…¨é“¾è·¯è·Ÿè¸ªç³»ç»Ÿï¼Œç¬¦åˆ OpenTracing åè®®ï¼ŒOpenTracing å’Œ Jaeger å‡æ˜¯ CNCF æˆå‘˜é¡¹ç›®ï¼Œä»¥ä¸‹æ˜¯ Jaeger æ¶æ„çš„ç¤ºæ„å›¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr03yvpwlj31jw0u0wmd_hu_64e9ae3d6d6f8bcc.webp 400w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr03yvpwlj31jw0u0wmd_hu_1ce314b578c15de8.webp 760w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr03yvpwlj31jw0u0wmd_hu_ea524c17103a075f.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/006tNc79ly1fzr03yvpwlj31jw0u0wmd_hu_64e9ae3d6d6f8bcc.webp&#34;
               width=&#34;760&#34;
               height=&#34;408&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Jaeger æ¶æ„ç¤ºæ„å›¾ï¼ˆå›¾ç‰‡æ¥è‡ª&lt;a href=&#34;https://www.jaegertracing.io/docs/1.6/architecture/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Jaeger å®˜æ–¹æ–‡æ¡£&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;åˆ†å¸ƒå¼è·Ÿè¸ªç³»ç»Ÿè®©å¼€å‘è€…èƒ½å¤Ÿå¾—åˆ°å¯è§†åŒ–çš„è°ƒç”¨æµç¨‹å±•ç¤ºã€‚è¿™å¯¹å¤æ‚çš„å¾®æœåŠ¡ç³»ç»Ÿè¿›è¡Œé—®é¢˜æ’æŸ¥å’Œæ€§èƒ½ä¼˜åŒ–æ—¶è‡³å…³é‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;Envoy åŸç”Ÿæ”¯æŒ http é“¾è·¯è·Ÿè¸ªï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”Ÿæˆ Request IDï¼šEnvoy ä¼šåœ¨éœ€è¦çš„æ—¶å€™ç”Ÿæˆ UUIDï¼Œå¹¶æ“ä½œåä¸º [x-request-id] çš„ HTTP Headerã€‚åº”ç”¨å¯ä»¥è½¬å‘è¿™ä¸ª Header ç”¨äºç»Ÿä¸€çš„è®°å½•å’Œè·Ÿè¸ªã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒé›†æˆå¤–éƒ¨è·Ÿè¸ªæœåŠ¡ï¼šEnvoy æ”¯æŒå¯æ’æ¥çš„å¤–éƒ¨è·Ÿè¸ªå¯è§†åŒ–æœåŠ¡ã€‚ç›®å‰æ”¯æŒæœ‰ï¼š
&lt;ul&gt;
&lt;li&gt;LightStep&lt;/li&gt;
&lt;li&gt;Zipkin æˆ–è€… Zipkin å…¼å®¹çš„åç«¯ï¼ˆæ¯”å¦‚è¯´ Jaegerï¼‰&lt;/li&gt;
&lt;li&gt;Datadog&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯è·Ÿè¸ª ID è¿æ¥ï¼šx-client-trace-id Header å¯ä»¥ç”¨æ¥æŠŠä¸ä¿¡ä»»çš„è¯·æ±‚ ID è¿æ¥åˆ°å—ä¿¡çš„ x-request-id Header ä¸Š&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;è·Ÿè¸ªä¸Šä¸‹æ–‡ä¿¡æ¯çš„ä¼ æ’­&#34;&gt;è·Ÿè¸ªä¸Šä¸‹æ–‡ä¿¡æ¯çš„ä¼ æ’­&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ç®¡ä½¿ç”¨çš„æ˜¯å“ªä¸ªè·Ÿè¸ªæœåŠ¡ï¼Œéƒ½åº”è¯¥ä¼ æ’­ x-request-idï¼Œè¿™æ ·åœ¨è¢«è°ƒç”¨æœåŠ¡ä¸­å¯åŠ¨ç›¸å…³æ€§çš„è®°å½•&lt;/li&gt;
&lt;li&gt;å¦‚æœä½¿ç”¨çš„æ˜¯ Zipkinï¼ŒEnvoy è¦ä¼ æ’­çš„æ˜¯ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http_conn_man/headers#config-http-conn-man-headers-b3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;B3 Header&lt;/a&gt;ã€‚ï¼ˆx-b3-traceid, x-b3-spanid, x-b3-parentspanid, x-b3-sampled, ä»¥åŠ x-b3-flags. x-b3-sampledï¼‰&lt;/li&gt;
&lt;li&gt;ä¸Šä¸‹æ–‡è·Ÿè¸ªå¹¶éé›¶ä¿®æ”¹ï¼Œåœ¨è°ƒç”¨ä¸‹æ¸¸æœåŠ¡æ—¶ï¼Œä¸Šæ¸¸åº”ç”¨åº”è¯¥è‡ªè¡Œä¼ æ’­è·Ÿè¸ªç›¸å…³çš„ HTTP Header&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;4-istio-æ§åˆ¶é¢&#34;&gt;4. Istio æ§åˆ¶é¢&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;4.1 Pilot æ¶æ„&lt;/li&gt;
&lt;li&gt;4.2 æµé‡ç®¡ç†æ¨¡å‹&lt;/li&gt;
&lt;li&gt;4.3 æ•…éšœå¤„ç†&lt;/li&gt;
&lt;li&gt;4.4 Mixer æ¶æ„&lt;/li&gt;
&lt;li&gt;4.5 Mixer é€‚é…å™¨æ¨¡å‹&lt;/li&gt;
&lt;li&gt;4.6 Mixer ç¼“å­˜æœºåˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;41-pilot-æ¶æ„&#34;&gt;4.1 Pilot æ¶æ„&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr04ak32zj30kt0dqjsk_hu_bd04df646bafca2f.webp 400w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr04ak32zj30kt0dqjsk_hu_cf5cd5995c9e263.webp 760w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr04ak32zj30kt0dqjsk_hu_a124f33be93e4eec.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/006tNc79ly1fzr04ak32zj30kt0dqjsk_hu_bd04df646bafca2f.webp&#34;
               width=&#34;749&#34;
               height=&#34;494&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Pilot Architectureï¼ˆå›¾ç‰‡æ¥è‡ª&lt;a href=&#34;https://istio.io/docs/concepts/traffic-management/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Isio å®˜ç½‘æ–‡æ¡£&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Rules API: å¯¹å¤–å°è£…ç»Ÿä¸€çš„ APIï¼Œä¾›æœåŠ¡çš„å¼€å‘è€…æˆ–è€…è¿ç»´äººå‘˜è°ƒç”¨ï¼Œå¯ä»¥ç”¨äºæµé‡æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;Envoy API: å¯¹å†…å°è£…ç»Ÿä¸€çš„ APIï¼Œä¾› Envoy è°ƒç”¨ä»¥è·å–æ³¨å†Œä¿¡æ¯ã€æµé‡æ§åˆ¶ä¿¡æ¯ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;æŠ½è±¡æ¨¡å‹å±‚ï¼šå¯¹æœåŠ¡çš„æ³¨å†Œä¿¡æ¯ã€æµé‡æ§åˆ¶è§„åˆ™ç­‰è¿›è¡ŒæŠ½è±¡ï¼Œä½¿å…¶æè¿°ä¸å¹³å°æ— å…³ã€‚&lt;/li&gt;
&lt;li&gt;å¹³å°é€‚é…å±‚ï¼šç”¨äºé€‚é…å„ä¸ªå¹³å°å¦‚ Kubernetesã€Mesosã€Cloud Foundry ç­‰ï¼ŒæŠŠå¹³å°ç‰¹å®šçš„æ³¨å†Œä¿¡æ¯ã€èµ„æºä¿¡æ¯ç­‰è½¬æ¢æˆæŠ½è±¡æ¨¡å‹å±‚å®šä¹‰çš„å¹³å°æ— å…³çš„æè¿°ã€‚ä¾‹å¦‚ï¼ŒPilot ä¸­çš„ Kubernetes é€‚é…å™¨å®ç°å¿…è¦çš„æ§åˆ¶å™¨æ¥ watch Kubernetes API server ä¸­ pod æ³¨å†Œä¿¡æ¯ã€ingress èµ„æºä»¥åŠç”¨äºå­˜å‚¨æµé‡ç®¡ç†è§„åˆ™çš„ç¬¬ä¸‰æ–¹èµ„æºçš„æ›´æ”¹&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;42-æµé‡ç®¡ç†æ¨¡å‹&#34;&gt;4.2 æµé‡ç®¡ç†æ¨¡å‹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;VirtualService&lt;/li&gt;
&lt;li&gt;DestinationRule&lt;/li&gt;
&lt;li&gt;ServiceEntry&lt;/li&gt;
&lt;li&gt;Gateway&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;virtualservice&#34;&gt;VirtualService&lt;/h4&gt;
&lt;p&gt;VirtualService ä¸­å®šä¹‰äº†ä¸€ç³»åˆ—é’ˆå¯¹æŒ‡å®šæœåŠ¡çš„æµé‡è·¯ç”±è§„åˆ™ã€‚æ¯ä¸ªè·¯ç”±è§„åˆ™éƒ½æ˜¯é’ˆå¯¹ç‰¹å®šåè®®çš„åŒ¹é…è§„åˆ™ã€‚å¦‚æœæµé‡ç¬¦åˆè¿™äº›ç‰¹å¾ï¼Œå°±ä¼šæ ¹æ®è§„åˆ™å‘é€åˆ°æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ç›®æ ‡æœåŠ¡ï¼Œæˆ–è€…ç›®æ ‡æœåŠ¡çš„å­é›†æˆ–ç‰ˆæœ¬ï¼ŒåŒ¹é…è§„åˆ™ä¸­è¿˜åŒ…å«äº†å¯¹æµé‡å‘èµ·æ–¹çš„å®šä¹‰ï¼Œè¿™æ ·ä¸€æ¥ï¼Œè§„åˆ™è¿˜å¯ä»¥é’ˆå¯¹ç‰¹å®šå®¢æˆ·ä¸Šä¸‹æ–‡è¿›è¡Œå®šåˆ¶ã€‚&lt;/p&gt;
&lt;h4 id=&#34;gateway&#34;&gt;Gateway&lt;/h4&gt;
&lt;p&gt;Gateway æè¿°äº†ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨äºæ‰¿è½½ç½‘æ ¼è¾¹ç¼˜çš„è¿›å…¥å’Œå‘å‡ºè¿æ¥ã€‚è¿™ä¸€è§„èŒƒä¸­æè¿°äº†ä¸€ç³»åˆ—å¼€æ”¾ç«¯å£ï¼Œä»¥åŠè¿™äº›ç«¯å£æ‰€ä½¿ç”¨çš„åè®®ã€è´Ÿè½½å‡è¡¡çš„ SNI é…ç½®ç­‰å†…å®¹&lt;/p&gt;
&lt;h4 id=&#34;serviceentry&#34;&gt;ServiceEntry&lt;/h4&gt;
&lt;p&gt;Istio æœåŠ¡ç½‘æ ¼å†…éƒ¨ä¼šç»´æŠ¤ä¸€ä¸ªä¸å¹³å°æ— å…³çš„ä½¿ç”¨é€šç”¨æ¨¡å‹è¡¨ç¤ºçš„æœåŠ¡æ³¨å†Œè¡¨ï¼Œå½“ä½ çš„æœåŠ¡ç½‘æ ¼éœ€è¦è®¿é—®å¤–éƒ¨æœåŠ¡çš„æ—¶å€™ï¼Œå°±éœ€è¦ä½¿ç”¨ ServiceEntry æ¥æ·»åŠ æœåŠ¡æ³¨å†Œï¼Œè¿™ç±»æœåŠ¡å¯èƒ½æ˜¯ç½‘æ ¼å¤–çš„ APIï¼Œæˆ–è€…æ˜¯å¤„äºç½‘æ ¼å†…éƒ¨ä½†å´ä¸å­˜åœ¨äºå¹³å°çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ¡ç›®ï¼ˆä¾‹å¦‚éœ€è¦å’Œ Kubernetes æœåŠ¡æ²Ÿé€šçš„ä¸€ç»„è™šæ‹ŸæœºæœåŠ¡ï¼‰.&lt;/p&gt;
&lt;h4 id=&#34;envoyfilter&#34;&gt;EnvoyFilter&lt;/h4&gt;
&lt;p&gt;EnvoyFilter æè¿°äº†é’ˆå¯¹ä»£ç†æœåŠ¡çš„è¿‡æ»¤å™¨ï¼Œç”¨æ¥å®šåˆ¶ç”± Istio Pilot ç”Ÿæˆçš„ä»£ç†é…ç½®ã€‚&lt;/p&gt;
&lt;h4 id=&#34;kubernetes-ingress-vs-istio-gateway&#34;&gt;Kubernetes Ingress vs Istio Gateway&lt;/h4&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr04mmy6oj31220f0ju1_hu_487dc25272af547f.webp 400w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr04mmy6oj31220f0ju1_hu_c7e614bd4e3d2259.webp 760w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr04mmy6oj31220f0ju1_hu_46dd8bf5b824ca5.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/006tNc79ly1fzr04mmy6oj31220f0ju1_hu_487dc25272af547f.webp&#34;
               width=&#34;760&#34;
               height=&#34;299&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆå¹¶äº† L4-6 å’Œ L7 çš„è§„èŒƒï¼Œå¯¹ä¼ ç»ŸæŠ€æœ¯æ ˆç”¨æˆ·çš„åº”ç”¨è¿å…¥ä¸æ–¹ä¾¿&lt;/li&gt;
&lt;li&gt;è¡¨ç°åŠ›ä¸è¶³ï¼š
&lt;ul&gt;
&lt;li&gt;åªèƒ½å¯¹ serviceã€portã€HTTP è·¯å¾„ç­‰æœ‰é™å­—æ®µåŒ¹é…æ¥è·¯ç”±æµé‡&lt;/li&gt;
&lt;li&gt;ç«¯å£åªæ”¯æŒé»˜è®¤80/443&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio Gateway:Â·&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®šä¹‰äº†å››å±‚åˆ°å…­å±‚çš„è´Ÿè½½å‡è¡¡å±æ€§ (é€šå¸¸æ˜¯ SecOps æˆ– NetOps å…³æ³¨çš„å†…å®¹)
&lt;ul&gt;
&lt;li&gt;ç«¯å£&lt;/li&gt;
&lt;li&gt;ç«¯å£æ‰€ä½¿ç”¨çš„åè®® (HTTP, HTTPS, GRPC, HTTP2, MONGO, TCP, TLS)&lt;/li&gt;
&lt;li&gt;Hosts&lt;/li&gt;
&lt;li&gt;TLS SNI header è·¯ç”±æ”¯æŒ&lt;/li&gt;
&lt;li&gt;TLS é…ç½®æ”¯æŒ (http è‡ªåŠ¨ 301, è¯ä¹¦ç­‰)&lt;/li&gt;
&lt;li&gt;ip / unix domain socket&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;kubernetes-istio-envoy-xds-æ¨¡å‹å¯¹æ¯”&#34;&gt;Kubernetes, Istio, Envoy xDS æ¨¡å‹å¯¹æ¯”&lt;/h4&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯å¯¹ Kubernetes, Istio, Envoy xDS æ¨¡å‹çš„ä¸ä¸¥æ ¼å¯¹æ¯”&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;/th&gt;
          &lt;th&gt;Kubernetes&lt;/th&gt;
          &lt;th&gt;Istio&lt;/th&gt;
          &lt;th&gt;Envoy xDS&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;å…¥å£æµé‡&lt;/td&gt;
          &lt;td&gt;Ingress&lt;/td&gt;
          &lt;td&gt;GateWay&lt;/td&gt;
          &lt;td&gt;Listener&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æœåŠ¡å®šä¹‰&lt;/td&gt;
          &lt;td&gt;Service&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
          &lt;td&gt;Cluster+Listener&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å¤–éƒ¨æœåŠ¡å®šä¹‰&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
          &lt;td&gt;ServiceEntry&lt;/td&gt;
          &lt;td&gt;Cluster+Listener&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ç‰ˆæœ¬å®šä¹‰&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
          &lt;td&gt;DestinationRule&lt;/td&gt;
          &lt;td&gt;Cluster+Listener&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ç‰ˆæœ¬è·¯ç”±&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
          &lt;td&gt;VirtualService&lt;/td&gt;
          &lt;td&gt;Route&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å®ä¾‹&lt;/td&gt;
          &lt;td&gt;Endpoint&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
          &lt;td&gt;Endpoint&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;kubernetes-å’Œ-istio-æœåŠ¡å¯»å€çš„åŒºåˆ«&#34;&gt;Kubernetes å’Œ Istio æœåŠ¡å¯»å€çš„åŒºåˆ«ï¼š&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;kube-dns: service domain -&amp;gt; service ip&lt;/li&gt;
&lt;li&gt;kube-proxy(node iptables): service ip -&amp;gt; pod ip&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Istio&lt;/strong&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;kube-dns: service domain -&amp;gt; service ip&lt;/li&gt;
&lt;li&gt;sidecar envoy: service ip -&amp;gt; pod ip&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id=&#34;43-æ•…éšœå¤„ç†&#34;&gt;4.3 æ•…éšœå¤„ç†&lt;/h2&gt;
&lt;p&gt;éšç€å¾®æœåŠ¡çš„æ‹†åˆ†ç²’åº¦å¢å¼ºï¼ŒæœåŠ¡è°ƒç”¨ä¼šå¢å¤šï¼Œæ›´å¤æ‚ï¼Œæ‰‡å…¥ æ‰‡å‡ºï¼Œè°ƒç”¨å¤±è´¥çš„é£é™©å¢åŠ ï¼Œä»¥ä¸‹æ˜¯å¸¸è§çš„æœåŠ¡å®¹é”™å¤„ç†æ–¹å¼ï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;/th&gt;
          &lt;th&gt;æ§åˆ¶ç«¯&lt;/th&gt;
          &lt;th&gt;ç›®çš„&lt;/th&gt;
          &lt;th&gt;å®ç°&lt;/th&gt;
          &lt;th&gt;Istio&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;è¶…æ—¶&lt;/td&gt;
          &lt;td&gt;client&lt;/td&gt;
          &lt;td&gt;ä¿æŠ¤ client&lt;/td&gt;
          &lt;td&gt;è¯·æ±‚ç­‰å¾…è¶…æ—¶/è¯·æ±‚è¿è¡Œè¶…æ—¶&lt;/td&gt;
          &lt;td&gt;timeout&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;é‡è¯•&lt;/td&gt;
          &lt;td&gt;client&lt;/td&gt;
          &lt;td&gt;å®¹å¿ server ä¸´æ—¶é”™è¯¯ï¼Œä¿è¯ä¸šåŠ¡æ•´ä½“å¯ç”¨æ€§&lt;/td&gt;
          &lt;td&gt;é‡è¯•æ¬¡æ•°/é‡è¯•çš„è¶…æ—¶æ—¶é—´&lt;/td&gt;
          &lt;td&gt;retries.attempts, retries.perTryTimeout&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ç†”æ–­&lt;/td&gt;
          &lt;td&gt;client&lt;/td&gt;
          &lt;td&gt;é™ä½æ€§èƒ½å·®çš„æœåŠ¡æˆ–å®ä¾‹çš„å½±å“&lt;/td&gt;
          &lt;td&gt;é€šå¸¸ä¼šç»“åˆè¶…æ—¶ + é‡è¯•ï¼ŒåŠ¨æ€è¿›è¡ŒæœåŠ¡çŠ¶æ€å†³ç­– (Open/Closed/Half-Open)&lt;/td&gt;
          &lt;td&gt;trafficPolicy.outlierDetection&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;é™çº§&lt;/td&gt;
          &lt;td&gt;client&lt;/td&gt;
          &lt;td&gt;ä¿è¯ä¸šåŠ¡ä¸»è¦åŠŸèƒ½å¯ç”¨&lt;/td&gt;
          &lt;td&gt;ä¸»é€»è¾‘å¤±è´¥é‡‡ç”¨å¤‡ç”¨é€»è¾‘çš„è¿‡ç¨‹ (é•œåƒæœåŠ¡åˆ†çº§ï¼Œè°ƒç”¨å¤‡ç”¨æœåŠ¡ï¼Œæˆ–è€…è¿”å› mock æ•°æ®)&lt;/td&gt;
          &lt;td&gt;æš‚ä¸æ”¯æŒï¼Œéœ€è¦ä¸šåŠ¡ä»£ç æŒ‰éœ€å®ç°&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;éš”ç¦»&lt;/td&gt;
          &lt;td&gt;client&lt;/td&gt;
          &lt;td&gt;é˜²æ­¢å¼‚å¸¸ server å ç”¨è¿‡å¤š client èµ„æº&lt;/td&gt;
          &lt;td&gt;éš”ç¦»å¯¹ä¸åŒæœåŠ¡è°ƒç”¨çš„èµ„æºä¾èµ–ï¼šçº¿ç¨‹æ± éš”ç¦»/ä¿¡å·é‡éš”ç¦»&lt;/td&gt;
          &lt;td&gt;æš‚ä¸æ”¯æŒ&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å¹‚ç­‰&lt;/td&gt;
          &lt;td&gt;server&lt;/td&gt;
          &lt;td&gt;å®¹å¿ client é‡è¯•ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§&lt;/td&gt;
          &lt;td&gt;å”¯ä¸€ID/åŠ é”/äº‹åŠ¡ç­‰æ‰‹æ®µ&lt;/td&gt;
          &lt;td&gt;æš‚ä¸æ”¯æŒï¼Œéœ€è¦ä¸šåŠ¡ä»£ç æŒ‰éœ€å®ç°&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;é™æµ&lt;/td&gt;
          &lt;td&gt;server&lt;/td&gt;
          &lt;td&gt;ä¿æŠ¤ server&lt;/td&gt;
          &lt;td&gt;å¸¸ç”¨ç®—æ³•ï¼šè®¡æ•°å™¨ï¼Œæ¼æ¡¶ï¼Œä»¤ç‰Œæ¡¶&lt;/td&gt;
          &lt;td&gt;trafficPolicy.connectionPool&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Istio æ²¡æœ‰æ— é™çº§å¤„ç†æ”¯æŒï¼šIstio å¯ä»¥æé«˜ç½‘æ ¼ä¸­æœåŠ¡çš„å¯é æ€§å’Œå¯ç”¨æ€§ã€‚ä½†æ˜¯ï¼Œåº”ç”¨ç¨‹åºä»ç„¶éœ€è¦å¤„ç†æ•…éšœï¼ˆé”™è¯¯ï¼‰å¹¶é‡‡å–é€‚å½“çš„å›é€€æ“ä½œã€‚ä¾‹å¦‚ï¼Œå½“è´Ÿè½½å‡è¡¡æ± ä¸­çš„æ‰€æœ‰å®ä¾‹éƒ½å¤±è´¥æ—¶ï¼ŒEnvoy å°†è¿”å› HTTP 503ã€‚åº”ç”¨ç¨‹åºæœ‰è´£ä»»å®ç°å¿…è¦çš„é€»è¾‘ï¼Œå¯¹è¿™ç§æ¥è‡ªä¸Šæ¸¸æœåŠ¡çš„ HTTP 503 é”™è¯¯åšå‡ºåˆé€‚çš„å“åº”ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;44-mixer-æ¶æ„&#34;&gt;4.4 Mixer æ¶æ„&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr052jgbaj30i70e73zq_hu_3eb8282e66b2a447.webp 400w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr052jgbaj30i70e73zq_hu_3221ab41c3fcbe14.webp 760w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr052jgbaj30i70e73zq_hu_378cbdd1971484dd.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/006tNc79ly1fzr052jgbaj30i70e73zq_hu_3eb8282e66b2a447.webp&#34;
               width=&#34;655&#34;
               height=&#34;511&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Mixer Topologyï¼ˆå›¾ç‰‡æ¥è‡ª&lt;a href=&#34;https://istio.io/docs/concepts/policies-and-telemetry/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Isio å®˜ç½‘æ–‡æ¡£&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;Istio çš„å››å¤§åŠŸèƒ½ç‚¹è¿æ¥ï¼Œå®‰å…¨ï¼Œæ§åˆ¶ï¼Œè§‚å¯Ÿï¼Œå…¶ä¸­ã€Œæ§åˆ¶ã€å’Œã€Œè§‚å¯Ÿã€çš„åŠŸèƒ½ä¸»è¦éƒ½æ˜¯ç”± Mixer ç»„ä»¶æ¥æä¾›ï¼ŒMixer åœ¨ Istio ä¸­è§’è‰²ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŠŸèƒ½ä¸Šï¼šè´Ÿè´£ç­–ç•¥æ§åˆ¶å’Œé¥æµ‹æ”¶é›†&lt;/li&gt;
&lt;li&gt;æ¶æ„ä¸Šï¼šæä¾›æ’ä»¶æ¨¡å‹ï¼Œå¯ä»¥æ‰©å±•å’Œå®šåˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;45-mixer-adapter-æ¨¡å‹&#34;&gt;4.5 Mixer Adapter æ¨¡å‹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Attribute&lt;/li&gt;
&lt;li&gt;Template&lt;/li&gt;
&lt;li&gt;Adapter&lt;/li&gt;
&lt;li&gt;Instance&lt;/li&gt;
&lt;li&gt;Handler&lt;/li&gt;
&lt;li&gt;Rule&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;attribute&#34;&gt;Attribute&lt;/h4&gt;
&lt;p&gt;Attribute æ˜¯ç­–ç•¥å’Œé¥æµ‹åŠŸèƒ½ä¸­æœ‰å…³è¯·æ±‚å’Œç¯å¢ƒçš„åŸºæœ¬æ•°æ®ï¼Œæ˜¯ç”¨äºæè¿°ç‰¹å®šæœåŠ¡è¯·æ±‚æˆ–è¯·æ±‚ç¯å¢ƒçš„å±æ€§çš„ä¸€å°æ®µæ•°æ®ã€‚ä¾‹å¦‚ï¼Œå±æ€§å¯ä»¥æŒ‡å®šç‰¹å®šè¯·æ±‚çš„å¤§å°ã€æ“ä½œçš„å“åº”ä»£ç ã€è¯·æ±‚æ¥è‡ªçš„ IP åœ°å€ç­‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Istio ä¸­çš„ä¸»è¦å±æ€§ç”Ÿäº§è€…æ˜¯ Envoyï¼Œä½†ä¸“ç”¨çš„ Mixer é€‚é…å™¨ä¹Ÿå¯ä»¥ç”Ÿæˆå±æ€§&lt;/li&gt;
&lt;li&gt;å±æ€§è¯æ±‡è¡¨è§ï¼š&lt;a href=&#34;https://istio.io/docs/reference/config/policy-and-telemetry/attribute-vocabulary/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Attribute Vocabulary&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ•°æ®æµå‘ï¼šenvoy -&amp;gt; mixer&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;template&#34;&gt;Template&lt;/h4&gt;
&lt;p&gt;Template æ˜¯å¯¹ adapter çš„æ•°æ®æ ¼å¼å’Œå¤„ç†æ¥å£çš„æŠ½è±¡ï¼ŒTemplate å®šä¹‰äº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“å¤„ç†è¯·æ±‚æ—¶å‘é€ç»™ adapter çš„æ•°æ®æ ¼å¼&lt;/li&gt;
&lt;li&gt;adapter å¿…é¡»å®ç°çš„ gRPC service æ¥å£&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¯ä¸ª Template é€šè¿‡ &lt;code&gt;template.proto&lt;/code&gt; è¿›è¡Œå®šä¹‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åä¸º&lt;code&gt;Template&lt;/code&gt; çš„ä¸€ä¸ª message&lt;/li&gt;
&lt;li&gt;Name: é€šè¿‡ template æ‰€åœ¨çš„ package name è‡ªåŠ¨ç”Ÿæˆ&lt;/li&gt;
&lt;li&gt;template_variety: å¯é€‰ Check, Report, Quota or AttributeGenerator, å†³å®šäº† adapter å¿…é¡»å®ç°çš„æ–¹æ³•ã€‚åŒæ—¶å†³å®šäº†åœ¨ mixer çš„ä»€ä¹ˆé˜¶æ®µè¦ç”Ÿæˆ template å¯¹åº”çš„ instance:
&lt;ul&gt;
&lt;li&gt;Check: åœ¨ Mixerâ€™s Check API call æ—¶åˆ›å»ºå¹¶å‘é€ instance&lt;/li&gt;
&lt;li&gt;Report: åœ¨ Mixerâ€™s Report API call æ—¶åˆ›å»ºå¹¶å‘é€ instance&lt;/li&gt;
&lt;li&gt;Quota: åœ¨ Mixerâ€™s Check API call æ—¶åˆ›å»ºå¹¶å‘é€ instance(æŸ¥è¯¢é…é¢æ—¶)&lt;/li&gt;
&lt;li&gt;AttributeGenerator: for both Check, Report Mixer API calls&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio å†…ç½®çš„ Templates: &lt;a href=&#34;https://istio.io/docs/reference/config/policy-and-telemetry/templates/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/docs/reference/config/policy-and-telemetry/templates/&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;adapter&#34;&gt;Adapter&lt;/h4&gt;
&lt;p&gt;å°è£…äº† Mixer å’Œç‰¹å®šå¤–éƒ¨åŸºç¡€è®¾æ–½åç«¯è¿›è¡Œäº¤äº’çš„å¿…è¦æ¥å£ï¼Œä¾‹å¦‚ Prometheus æˆ–è€… Stackdriver&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®šä¹‰äº†éœ€è¦å¤„ç†çš„æ¨¡æ¿ (åœ¨ yaml ä¸­é…ç½® template)&lt;/li&gt;
&lt;li&gt;å®šä¹‰äº†å¤„ç†æŸä¸ª Template æ•°æ®æ ¼å¼çš„ GRPC æ¥å£&lt;/li&gt;
&lt;li&gt;å®šä¹‰ Adapter éœ€è¦çš„é…ç½®æ ¼å¼ (Params)&lt;/li&gt;
&lt;li&gt;å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªæ•°æ® (instance)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio å†…ç½®çš„ Adapter: &lt;a href=&#34;https://istio.io/docs/reference/config/policy-and-telemetry/adapters/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://istio.io/docs/reference/config/policy-and-telemetry/adapters/&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;instance&#34;&gt;Instance&lt;/h4&gt;
&lt;p&gt;ä»£è¡¨ç¬¦åˆæŸä¸ª Template å®šä¹‰çš„æ•°æ®æ ¼å¼çš„å…·ä½“å®ç°ï¼Œè¯¥å…·ä½“å®ç°ç”±ç”¨æˆ·é…ç½®çš„ CRD, CRD å®šä¹‰äº†å°† Attributes è½¬æ¢ä¸ºå…·ä½“ instance çš„è§„åˆ™ï¼Œæ”¯æŒå±æ€§è¡¨è¾¾å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Instance CRD æ˜¯ Template ä¸­å®šä¹‰çš„æ•°æ®æ ¼å¼ + å±æ€§è½¬æ¢å™¨&lt;/li&gt;
&lt;li&gt;å†…ç½®çš„ Instance ç±»å‹ (å…¶å®å°±æ˜¯å†…ç½® Template): &lt;a href=&#34;https://istio.io/docs/reference/config/policy-and-telemetry/templates/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Templates&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å±æ€§è¡¨è¾¾å¼è§ï¼š&lt;a href=&#34;https://istio.io/docs/reference/config/policy-and-telemetry/expression-language/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Expression Language&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ•°æ®æµå‘ï¼šmixer -&amp;gt; adapter å®ä¾‹&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;handler&#34;&gt;Handler&lt;/h4&gt;
&lt;p&gt;ç”¨æˆ·é…ç½®çš„ CRD, ä¸ºå…·ä½“ Adapter æä¾›ä¸€ä¸ªå…·ä½“é…ç½®ï¼Œå¯¹åº” Adapter çš„å¯è¿è¡Œå®ä¾‹&lt;/p&gt;
&lt;h4 id=&#34;rule&#34;&gt;Rule&lt;/h4&gt;
&lt;p&gt;ç”¨æˆ·é…ç½®çš„ CRD, é…ç½®ä¸€ç»„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™æè¿°äº†ä½•æ—¶è°ƒç”¨ç‰¹å®š (é€šè¿‡ Handler å¯¹åº”çš„) é€‚é…å™¨åŠå“ªäº› Instance&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;è®¡ç®—æœºç§‘å­¦ä¸­çš„æ‰€æœ‰é—®é¢˜ï¼Œéƒ½å¯ä»¥ç”¨å¦ä¸€ä¸ªå±‚æ¥è§£å†³ï¼Œé™¤äº†å±‚æ•°å¤ªå¤šçš„é—®é¢˜&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Kubernetes æœ¬èº«å·²ç»å¾ˆå¤æ‚ï¼ŒIstio ä¸ºäº†æ›´é«˜å±‚æ§åˆ¶çš„æŠ½è±¡ï¼Œåˆå¢åŠ äº†å¾ˆå¤šæ¦‚å¿µã€‚å¤æ‚åº¦å ªæ¯” kubernetes.&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡º istio è®¾è®¡ç²¾è‰¯ï¼Œåœ¨å¤„ç†å¾®æœåŠ¡çš„å¤æ‚åœºæ™¯æœ‰å¾ˆå¤šä¼˜ç§€ä¹‹å¤„ï¼Œä¸è¿‡ç›®å‰ istio ç›®å‰çš„çŸ­æ¿è¿˜æ˜¯å¾ˆæ˜æ˜¾ï¼Œé«˜åº¦çš„æŠ½è±¡å¸¦æ¥äº†å¾ˆå¤šæ€§èƒ½çš„æŸè€—ï¼Œç¤¾åŒºç°åœ¨ä¹Ÿæœ‰å¾ˆå¤šä¼˜åŒ–çš„æ–¹å‘ï¼Œåƒèš‚èšé‡‘æœå¼€æºçš„ SofaMesh ä¸»è¦æ˜¯å»ç²¾ç®€å±‚ï¼Œè¯•å›¾åœ¨ sidecar é‡Œå»åšå¾ˆå¤š mixer çš„äº‹æƒ…ï¼Œå‡å°‘ sidecar å’Œ mixer çš„åŒæ­¥è¯·æ±‚ä¾èµ–ï¼Œè€Œä¸€äº›å…¶ä»–çš„ sidecar ç½‘ç»œæ–¹æ¡ˆï¼Œæ›´å¤šçš„æ˜¯è€ƒè™‘å»ä¼˜åŒ–å±‚ï¼Œä¼˜åŒ– sidecar è¿™ä¸€å±‚çš„æ€§èƒ½å¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio 1.0 ä¹‹å‰ï¼Œä¸»è¦è¿˜æ˜¯ä»¥åŠŸèƒ½çš„å®ç°ä¸ºä¸»ï¼Œä¸è¿‡åé¢éšç€ç¤¾åŒºçš„ç§¯ææŠ•å…¥ï¼Œç›¸ä¿¡ Istio çš„æ€§èƒ½ä¼šæœ‰é•¿è¶³çš„æå‡ã€‚&lt;/p&gt;
&lt;p&gt;ç¬”è€…ä¹‹å‰ä»äº‹è¿‡å¤šå¹´çš„æœåŠ¡æ²»ç†ç›¸å…³çš„å·¥ä½œï¼Œè¿‡ç¨‹ä¸­åˆ‡èº«ä½“ä¼šåˆ°å¾®æœåŠ¡æ²»ç†çš„ç—›ç‚¹ï¼Œæ‰€ä»¥ä¹Ÿæ¯”è¾ƒå…³æ³¨ service mesh çš„å‘å±•ï¼Œä¸ªäººå¯¹ istio ä¹Ÿéå¸¸çœ‹å¥½ï¼Œåˆšå¥½ä»Šå¹´æˆ‘ä»¬ä¸­å¿ƒå®¹å™¨äº§å“ä»Šå¹´ä¹Ÿæœ‰è¿™æ–¹é¢çš„è®¡åˆ’ï¼ŒæœŸå¾…æˆ‘ä»¬èƒ½åœ¨è¿™ä¸ªæ–¹å‘è¿›è¡Œä¸€äº›äº§å“å’ŒæŠ€æœ¯çš„æ·±è€•ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr05l1dnpj30q80jj0v5_hu_6c851fa3ecfc189a.webp 400w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr05l1dnpj30q80jj0v5_hu_2b6b2f2733ca16e1.webp 760w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzr05l1dnpj30q80jj0v5_hu_f4fc39b55246b678.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/006tNc79ly1fzr05l1dnpj30q80jj0v5_hu_6c851fa3ecfc189a.webp&#34;
               width=&#34;760&#34;
               height=&#34;566&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://skyao.io/publication/201801-service-mesh-2017-summary/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh å¹´åº¦æ€»ç»“ï¼šç¾¤é›„é€é¹¿çƒ½çƒŸèµ·&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://thenewstack.io/why-you-should-care-about-istio-gateways/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Why You Should Care About Istio Gateways&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://philcalcado.com/2017/08/03/pattern_service_mesh.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pattern: Service Mesh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/istio/wiki/Mixer-Out-Of-Process-Adapter-Dev-Guide&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mixer Out Of Process Adapter Dev Guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/istio/wiki/Mixer-Out-Of-Process-Adapter-Walkthrough&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mixer Out of Process Adapter Walkthrough&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com/blog/envoy-xds-protocol&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy ä¸­çš„ xDS REST å’Œ gRPC åè®®è¯¦è§£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://preliminary.istio.io/blog/2018/delayering-istio/delayering-istio/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Delayering Istio with AppSwitch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.servicemesher.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;servicemesher ä¸­æ–‡ç¤¾åŒº&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-servicemesher-ç¤¾åŒº&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;ServiceMesher ç¤¾åŒº&#34; srcset=&#34;
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzs45dygpyj31jt0beq9s_hu_d5975375ca59ad6.webp 400w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzs45dygpyj31jt0beq9s_hu_df10776aadb964ba.webp 760w,
               /blog/istio-the-king-of-service-mesh/006tNc79ly1fzs45dygpyj31jt0beq9s_hu_ed2f5a13cc203cb.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-the-king-of-service-mesh/006tNc79ly1fzs45dygpyj31jt0beq9s_hu_d5975375ca59ad6.webp&#34;
               width=&#34;760&#34;
               height=&#34;155&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      ServiceMesher ç¤¾åŒº
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æ„å»ºæ— ç¼é›†æˆçš„ gRPC-Web å’Œ Istio çš„äº‘åŸç”Ÿåº”ç”¨æ•™ç¨‹</title>
      <link>https://cloudnativecn.com/blog/seamless-cloud-native-apps-with-grpc-web-and-istio/</link>
      <pubDate>Mon, 10 Dec 2018 21:50:05 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/seamless-cloud-native-apps-with-grpc-web-and-istio/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://github.com/grpc/grpc-web&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC-Web&lt;/a&gt;ä½¿ Web åº”ç”¨èƒ½å¤Ÿé€šè¿‡ç±»ä¼¼äº Envoy çš„ä»£ç†è®¿é—® gRPC åç«¯ã€‚Envoy æ˜¯ Istio çš„é»˜è®¤ä»£ç†ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Istio çš„&lt;a href=&#34;https://istio.io/docs/reference/config/istio.networking.v1alpha3/#EnvoyFilter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EnvoyFilter&lt;/a&gt;æ„ä»¶æ¥åˆ›å»ºæ— ç¼è¿æ¥çš„äº‘åŸç”Ÿåº”ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-grpc&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;grpc&#34; srcset=&#34;
               /blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxnm8x3odlj308c02zdfy_hu_ce2647e03ea1df78.webp 400w,
               /blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxnm8x3odlj308c02zdfy_hu_81ed127d97fe7371.webp 760w,
               /blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxnm8x3odlj308c02zdfy_hu_1f80f23f2156ce.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxnm8x3odlj308c02zdfy_hu_ce2647e03ea1df78.webp&#34;
               width=&#34;300&#34;
               height=&#34;107&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      grpc
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;istio&#34; srcset=&#34;
               /blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxnm9cn3xjj302s046748_hu_f81a5e438e8f0b76.webp 400w,
               /blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxnm9cn3xjj302s046748_hu_adaf740484d5ca73.webp 760w,
               /blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxnm9cn3xjj302s046748_hu_3052fdb9c3658c82.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxnm9cn3xjj302s046748_hu_f81a5e438e8f0b76.webp&#34;
               width=&#34;100&#34;
               height=&#34;150&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      istio
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ä»‹ç»&#34;&gt;ä»‹ç»&lt;/h2&gt;
&lt;p&gt;åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å¼•å¯¼ä½ æ„å»ºä¸€ä¸ªç®€å•çš„ Web åº”ç”¨ï¼Œä½¿ç”¨ emoji æ›¿æ¢ç”¨æˆ·è¾“å…¥æ–‡æœ¬ä¸­çš„å…³é”®å­—ï¼Œå¹¶ä½¿ç”¨ gRPC-Web å’Œ Istio ä¸ gRPC åç«¯è¿›è¡Œé€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯æˆ‘ä»¬åˆ›å»º emoji åº”ç”¨çš„æ­¥éª¤å¤§çº²ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨&lt;a href=&#34;https://developers.google.com/protocol-buffers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Protobuf&lt;/a&gt;å®šä¹‰åè®®æ ¼å¼ï¼›&lt;/li&gt;
&lt;li&gt;ç¼–è¯‘ Protobuf å®šä¹‰æ–‡ä»¶ï¼Œæ¥ç”Ÿæˆ Go å’Œ JavaScript æ–‡ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;æ„å»ºå¹¶æµ‹è¯•åŸºäº Go çš„ gRPC æœåŠ¡ï¼Œè¯¥æœåŠ¡ä½¿ç”¨ emoji æ›¿æ¢è¾“å…¥æ–‡æœ¬ä¸­çš„å…³é”®å­—ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ gRPC-Web ä¸º emoji æœåŠ¡åˆ›å»º Web ç•Œé¢ï¼›&lt;/li&gt;
&lt;li&gt;é…ç½® EnvoyFilter å¹¶é€šè¿‡ Istio éƒ¨ç½²åç«¯ï¼›&lt;/li&gt;
&lt;li&gt;éƒ¨ç½² Web åº”ç”¨ç¨‹åºå¹¶æµ‹è¯•æˆ‘ä»¬çš„ emoji æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ¶æ„&#34;&gt;æ¶æ„&lt;/h2&gt;
&lt;p&gt;è®©æˆ‘ä»¬è¿›ä¸€æ­¥ç†è§£ emoji æœåŠ¡çš„æœ€ç»ˆæ¶æ„æ˜¯ä»€ä¹ˆæ ·å­ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-architecture&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;architecture&#34; srcset=&#34;
               /blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxnmaqiaqfj30gc08yaax_hu_5e2e77c79a574f45.webp 400w,
               /blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxnmaqiaqfj30gc08yaax_hu_d85ac7baf1ad85cd.webp 760w,
               /blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxnmaqiaqfj30gc08yaax_hu_1d86c264317bfdd8.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxnmaqiaqfj30gc08yaax_hu_5e2e77c79a574f45.webp&#34;
               width=&#34;588&#34;
               height=&#34;322&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      architecture
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼Œåªè¦ç”¨æˆ·æä¾›ä¸€äº›æ–‡æœ¬ï¼ŒWeb åº”ç”¨å°±ä¼šåˆ©ç”¨ gRPC-Web åº“å‘ Istio Gatway å‘é€ HTTP è¯·æ±‚ã€‚ç„¶åï¼ŒIstio ç½‘å…³å°† HTTP è¯·æ±‚è·¯ç”±åˆ° emoji æœåŠ¡æ—è¿è¡Œçš„ Proxy sidecarï¼Œåè€…ä½¿ç”¨ Envoy çš„&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http_filters/grpc_web_filter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC-Web&lt;/a&gt; filter å°† HTTP è°ƒç”¨è½¬æ¢æˆ gRPC è°ƒç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®šä¹‰åè®®æ ¼å¼&#34;&gt;å®šä¹‰åè®®æ ¼å¼&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ Protobuf å®šä¹‰åè®®æ ¼å¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-protobuf&#34; data-lang=&#34;protobuf&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;syntax&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;proto3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;emoji&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EmojiService&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Emojize&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EmojizeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EmojizeReply&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;EmojizeRequest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;text&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;EmojizeReply&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;emojized_text&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåä¸º&lt;code&gt;EmojiService&lt;/code&gt;çš„&lt;code&gt;service&lt;/code&gt;ï¼Œå¤„ç†åä¸º&lt;code&gt;Emojize&lt;/code&gt;çš„&lt;code&gt;rpc&lt;/code&gt;è°ƒç”¨ï¼Œè¯¥è°ƒç”¨æ¥å—&lt;code&gt;EmojizeRequest&lt;/code&gt;å¯¹è±¡å‚æ•°å¹¶è¿”å›ä¸€ä¸ª&lt;code&gt;EmojizeReply&lt;/code&gt;å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;EmojizeRequest&lt;/code&gt;æ¶ˆæ¯å‚æ•°åŒ…å«ä¸€ä¸ªåä¸º&lt;code&gt;text&lt;/code&gt;çš„&lt;code&gt;string&lt;/code&gt;ç±»å‹çš„å­—æ®µï¼Œè¡¨ç¤ºç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬ã€‚åŒæ ·ï¼Œ&lt;code&gt;EmojizeReply&lt;/code&gt;åŒ…å«ä¸€ä¸ªåä¸º&lt;code&gt;emojized_text&lt;/code&gt;çš„&lt;code&gt;string&lt;/code&gt;ç±»å‹çš„å­—æ®µï¼Œè¡¨ç¤ºæœ€ç»ˆè¾“å‡ºçš„å­—ç¬¦ï¼Œä¹Ÿå³æœåŠ¡ç«¯å°† emoji å…³é”®å­—æ›¿æ¢ä¸º emoji è¡¨æƒ…ç¬¦å·çš„è¾“å‡ºå†…å®¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼–è¯‘-protobuf-å®šä¹‰æ–‡ä»¶&#34;&gt;ç¼–è¯‘ Protobuf å®šä¹‰æ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªåä¸º&lt;code&gt;grpc-web-emoji/emoji/&lt;/code&gt;çš„é¡¹ç›®ç›®å½•ç»“æ„ï¼Œç„¶åæŠŠå‰é¢çš„å®šä¹‰å†…å®¹å†™å…¥åä¸º&lt;code&gt;emoji.proto&lt;/code&gt;çš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åç¼–è¯‘ emoji.proto æ–‡ä»¶å¹¶ç”Ÿæˆæ‰€éœ€è¦çš„ Go æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ protoc -I emoji/ emoji/emoji.proto --go_out&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;plugins&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;grpc:emoji
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿç”Ÿæˆ JavaScript æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ protoc -I emoji/ emoji/emoji.proto --js_out&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;import_style&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;commonjs:emoji &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;         --grpc-web_out&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;import_style&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;commonjs,mode&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;grpcwebtext:emoji
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶ï¼Œæ‚¨å°†è·å¾—å¦‚ä¸‹æ‰€ç¤ºçš„ç›®å½•ç»“æ„ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;â”€â”€ grpc-web-emoji
   â””â”€â”€ emoji
       â”œâ”€â”€ emoji.pb.go
       â”œâ”€â”€ emoji.proto
       â”œâ”€â”€ emoji_grpc_web_pb.js
       â””â”€â”€ emoji_pb.js
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;æ„å»ºå’Œæµ‹è¯•-go-åç«¯ç¨‹åº&#34;&gt;æ„å»ºå’Œæµ‹è¯• Go åç«¯ç¨‹åº&lt;/h2&gt;
&lt;p&gt;ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®ç°&lt;code&gt;EmojiService&lt;/code&gt; API çš„ Go ç¨‹åºã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å†…å®¹åˆ›å»ºä¸€ä¸ªåä¸º&lt;code&gt;main.go&lt;/code&gt;çš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/venilnoronha/grpc-web-emoji/emoji&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;google.golang.org/grpc/reflection&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;emoji&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;gopkg.in/kyokomi/emoji.v1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// server is used to implement the EmojiService interface&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Emojize takes a input string via EmojizeRequest, replaces known keywords with&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// actual emoji characters and returns it via a EmojizeReply instance.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Emojize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EmojizeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EmojizeReply&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EmojizeReply&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EmojizedText&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;emoji&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// listen to TCP requests over port 9000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;lis&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Listen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;:9000&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to listen: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;listening on %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lis&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// register the EmojiService implementation with the gRPC server&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterEmojiServiceServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;reflection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Register&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Serve&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lis&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to serve: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘å·²ç»ä½¿ç”¨ &lt;code&gt;kyokomi/emoji&lt;/code&gt; åº“æ¥å®Œæˆç¹é‡çš„å·¥ä½œï¼Œå³å°†è¾“å…¥æ–‡æœ¬ä¸­çš„å…³é”®å­—è½¬æ¢ä¸ºè¡¨æƒ…ç¬¦å·ã€‚&lt;/p&gt;
&lt;p&gt;å¯åŠ¨æœåŠ¡åå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ go run -v main.go
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018/11/12 10:45:12 listening on &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;::&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:9000
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º emoji_client.go çš„å®¢æˆ·ç«¯ï¼Œæ¥å®ç°é€šè¿‡ç¨‹åºæµ‹è¯• emoji æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/venilnoronha/grpc-web-emoji/emoji&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// connect to the server&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Dial&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;localhost:9000&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithInsecure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;could not connect to the service: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// send a request to the server&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cancel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Background&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewEmojiServiceClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;resp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Emojize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EmojizeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;Text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;I like :pizza: and :sushi:!&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;could not call service: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;server says: %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetEmojizedText&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ç°åœ¨å¯ä»¥è¿è¡Œ emoji æœåŠ¡å®¢æˆ·ç«¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ go run emoji_client.go
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018/11/12 10:55:52 server says: I like ğŸ•  and ğŸ£ !
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç§ï¼gRPC ç‰ˆæœ¬çš„ emoji æœåŠ¡å¦‚æœŸå·¥ä½œäº†ï¼Œç°åœ¨æ˜¯æ—¶å€™è®© Web å‰ç«¯å¯åŠ¨å¹¶è¿è¡Œäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-grpc-web-åˆ›å»º-web-ç•Œé¢&#34;&gt;ä½¿ç”¨ gRPC-Web åˆ›å»º Web ç•Œé¢&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º&lt;code&gt;index.html&lt;/code&gt;çš„ HTML é¡µé¢ã€‚è¯¥é¡µé¢å‘ç”¨æˆ·æ˜¾ç¤ºä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå¹¶è°ƒç”¨ä¸€ä¸ª&lt;code&gt;emojize&lt;/code&gt;å‡½æ•°ï¼ˆæˆ‘ä»¬ç¨åå°†å®šä¹‰ï¼‰å°†ç”¨æˆ·è¾“å…¥å‘é€åˆ°åç«¯ emoji æœåŠ¡ã€‚&lt;code&gt;emojize&lt;/code&gt;å‡½æ•°è¿˜å°†æ¶ˆè´¹åç«¯æœåŠ¡è¿”å›çš„ gRPC å“åº”ï¼Œå¹¶ä½¿ç”¨æœåŠ¡ç«¯è¿”å›çš„æ•°æ®æ›´æ–°ç”¨æˆ·è¾“å…¥æ¡†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;html&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;div&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;editor&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;contentEditable&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;hidefocus&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;onkeyup&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;emojize()&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;div&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;src&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;dist/main.js&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;html&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å°†å¦‚ä¸‹æ‰€ç¤ºçš„ JavaScript ä»£ç æ”¾å…¥åä¸º client.js çš„å‰ç«¯æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kr&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EmojizeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EmojizeReply&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;require&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;emoji/emoji_pb.js&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kr&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EmojiServiceClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;require&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;emoji/emoji_grpc_web_pb.js&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EmojiServiceClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http://192.168.99.100:31380&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;editor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;document&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;getElementById&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;editor&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;window&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;emojize&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;request&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EmojizeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;setText&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;editor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;innerText&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;emojize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;editor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;innerText&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;getEmojizedText&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯·æ³¨æ„ï¼Œ&lt;code&gt;EmojiServiceClient&lt;/code&gt;ä¸åç«¯ emoji æœåŠ¡çš„è¿æ¥åœ°å€æ˜¯&lt;code&gt;http://192.168.99.100:31380&lt;/code&gt;ï¼Œè€Œé&lt;code&gt;http://localhost:9000&lt;/code&gt;ã€‚è¿™æ˜¯å› ä¸º Web åº”ç”¨ç¨‹åºæ— æ³•ç›´æ¥ä¸ gRPC åç«¯é€šä¿¡ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°†é€šè¿‡ Istio éƒ¨ç½²æˆ‘ä»¬çš„åç«¯ emoji æœåŠ¡ã€‚Istio å°†åœ¨ Minikube ä¸Šè¿è¡Œï¼Œå…¶ IP åœ°å€ä¸º&lt;code&gt;192.168.99.100&lt;/code&gt;ï¼Œé»˜è®¤çš„ Istio Ingress HTTP ç«¯å£ä¸º&lt;code&gt;31380&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›åº“æ¥ç”Ÿæˆ&lt;code&gt;index.html&lt;/code&gt;ä¸­å¼•ç”¨çš„&lt;code&gt;dist/main.js&lt;/code&gt;æ–‡ä»¶ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹çš„&lt;a href=&#34;https://www.npmjs.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;npm&lt;/a&gt; &lt;code&gt;package.json&lt;/code&gt;é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;grpc-web-emoji&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0.1.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;gRPC-Web Emoji Sample&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;devDependencies&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;@grpc/proto-loader&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;^0.3.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;google-protobuf&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;^3.6.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;^1.15.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;grpc-web&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;^1.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;webpack&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;^4.16.5&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;webpack-cli&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;^3.1.0&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥å®‰è£…åº“å¹¶ç”Ÿæˆ&lt;code&gt;dist/main.js&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ npm install
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ npx webpack client.js
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;é€šè¿‡-istio-éƒ¨ç½²åç«¯æœåŠ¡&#34;&gt;é€šè¿‡ Istio éƒ¨ç½²åç«¯æœåŠ¡&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ç°åœ¨å¯ä»¥å°†åç«¯ emoji æœåŠ¡æ‰“åŒ…åˆ°ä¸€ä¸ªå®¹å™¨ï¼Œå¹¶é€šè¿‡ Istio è¿›è¡Œéƒ¨ç½²ã€‚æˆ‘ä»¬éœ€è¦å®‰è£… gRPC-Web &lt;code&gt;EnvoyFilter&lt;/code&gt;ï¼Œä»¥ä¾¿å°†åç«¯ gRPC æœåŠ¡çš„è°ƒç”¨åœ¨ gRPC å’Œ HTTP é—´è½¬æ¢ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å†…å®¹çš„&lt;code&gt;Dockerfile&lt;/code&gt;æ„å»º Docker imageã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-dockerfile&#34; data-lang=&#34;dockerfile&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; golang:1.11 as builder&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WORKDIR&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; /root/go/src/github.com/venilnoronha/grpc-web-emoji/&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; ./ .&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RUN&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;CGO_ENABLED&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;GOOS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;linux go build -a -installsuffix cgo -v -o emoji-service main.go&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; scratch&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WORKDIR&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; /bin/&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; --from&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;builder /root/go/src/github.com/venilnoronha/grpc-web-emoji/emoji-service .&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ENTRYPOINT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/bin/emoji-service&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CMD&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;9000&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXPOSE&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; 9000&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹æ‰€ç¤º build imageï¼Œå¹¶å°†å…¶æ¨é€åˆ° Docker Hubï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker build -t vnoronha/grpc-web-emoji .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker push vnoronha/grpc-web-emoji
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ Kubernetes &lt;code&gt;Service&lt;/code&gt;å’Œ&lt;code&gt;Deployment&lt;/code&gt;é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¹¶å‘½åä¸º&lt;code&gt;backend.yaml&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-port&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;vnoronha/grpc-web-emoji&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Always&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„ï¼Œä¸€æ—¦æˆ‘ä»¬é€šè¿‡ Istio éƒ¨ç½²æ­¤æœåŠ¡ï¼Œç”±äº&lt;code&gt;Service&lt;/code&gt; ports &lt;code&gt;name&lt;/code&gt;ä¸­çš„&lt;code&gt;grpc-&lt;/code&gt;å‰ç¼€ï¼ŒIstio ä¼šå°†å…¶è¯†åˆ«ä¸º gRPC æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºæˆ‘ä»¬å¸Œæœ›å°† gRPC-Web filter å®‰è£…åœ¨&lt;code&gt;backend&lt;/code&gt; sidecar ä»£ç†ä¸Šï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨éƒ¨ç½²&lt;code&gt;backend&lt;/code&gt;æœåŠ¡ä¹‹å‰å®‰è£…å®ƒã€‚&lt;code&gt;EnvoyFilter&lt;/code&gt;é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬å°†å…¶å‘½åä¸º&lt;code&gt;filter.yaml&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EnvoyFilter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grpc-web-filter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;listenerMatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listenerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SIDECAR_INBOUND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listenerProtocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;insertPosition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;FIRST&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filterType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filterName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.grpc_web&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filterConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ª Istio &lt;code&gt;Gateway&lt;/code&gt;æ¥å°† HTTP æµé‡è·¯ç”±åˆ°åç«¯æœåŠ¡ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä»¥ä¸‹é…ç½®å†™å…¥åä¸º&lt;code&gt;gateway.yaml&lt;/code&gt;çš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subsets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;vs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;corsPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;allowOrigin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;allowMethods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;POST&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;GET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;OPTIONS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;PUT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;DELETE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;allowHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;grpc-timeout&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;content-type&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;keep-alive&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;user-agent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;cache-control&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;content-type&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;content-transfer-encoding&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;custom-header-1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;x-accept-content-transfer-encoding&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;x-accept-response-streaming&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;x-user-agent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;x-grpc-web&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maxAge&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1728s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exposeHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;custom-header-1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;grpc-status&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;grpc-message&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;allowCredentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„ï¼Œä¸ºäº†èƒ½è®© gRPC-Web æ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªå¤æ‚çš„&lt;code&gt;corsPolicy&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç°åœ¨å¯ä»¥æŒ‰ä»¥ä¸‹é¡ºåºç®€å•åœ°éƒ¨ç½²ä¸Šè¿°é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f filter.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f &amp;lt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f backend.yaml&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f gateway.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;backend&lt;/code&gt; pod å¯åŠ¨ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯ gRPC-Web filter åœ¨ sidecar ä»£ç†ä¸­çš„é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl proxy-config listeners backend-7bf6c8f67c-8lbm7 --port &lt;span class=&#34;m&#34;&gt;9000&lt;/span&gt; -o json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;http_filters&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.grpc_web&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;éƒ¨ç½²å’Œæµ‹è¯•-web-å‰ç«¯&#34;&gt;éƒ¨ç½²å’Œæµ‹è¯• Web å‰ç«¯&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ç°åœ¨å·²ç»åˆ°äº†å®éªŒçš„æœ€åé˜¶æ®µã€‚æˆ‘ä»¬é€šè¿‡ Python å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡ï¼Œæ¥ä¸ºæˆ‘ä»¬çš„ Web åº”ç”¨æä¾›æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ python2 -m SimpleHTTPServer &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Serving HTTP on 0.0.0.0 port &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt; ...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®©æˆ‘ä»¬å‰å¾€ emoji web é¡µé¢&lt;code&gt;http://localhost:8080&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ å°†æ‹¥æœ‰ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„åŸºäº gRPC-Web çš„ Web åº”ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-web&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;web&#34;
           src=&#34;https://cloudnativecn.com/blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxoshsy5ltg30bc02a0sz.gif&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      web
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ åœ¨ Chrome ç­‰æµè§ˆå™¨ä¸Šæ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œä½ å°†ä¼šçœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ gRPC-Web HTTP è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-chrome&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;chrome&#34; srcset=&#34;
               /blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxou9b402nj30in0hi0uo_hu_cb3aeb7b27cbfcf2.webp 400w,
               /blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxou9b402nj30in0hi0uo_hu_8266e21b74ec0b6f.webp 760w,
               /blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxou9b402nj30in0hi0uo_hu_d07fa93ba60276e9.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/seamless-cloud-native-apps-with-grpc-web-and-istio/006tNbRwly1fxou9b402nj30in0hi0uo_hu_cb3aeb7b27cbfcf2.webp&#34;
               width=&#34;671&#34;
               height=&#34;630&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      chrome
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;gRPC-Web æä¾›äº†ä¸€ç§å°† gRPC æœåŠ¡çš„ä¼˜åŠ¿å¸¦ç»™ Web åº”ç”¨çš„å¥½æ–¹æ³•ã€‚å®ƒç›®å‰éœ€è¦ä¸€ä¸ªä¸­é—´ä»£ç†ï¼Œå¦‚ Istio æ•°æ®å¹³é¢ï¼ˆå³ Envoy ä»£ç†ï¼‰ï¼Œä»¥ä¾¿å°†æ•°æ®åœ¨ HTTP å’Œ gRPC ä¹‹é—´è½¬æ¢ã€‚ç„¶è€Œï¼Œä¸€æ—¦æˆ‘ä»¬å‡†å¤‡å¥½äº†åŸºç¡€æ¶æ„ï¼Œå¼€å‘äººå‘˜å°±å¯ä»¥æ— ç¼ä½¿ç”¨ gRPC æ„å»º Web åº”ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;gRPC-Web &lt;a href=&#34;https://github.com/grpc/grpc-web/tree/master/net/grpc/gateway/examples/helloworld&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Hello World æŒ‡å—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;WebpageFx &lt;a href=&#34;https://www.webpagefx.com/tools/emoji-cheat-sheet/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Emoji æ¸…å•&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Istio1.1.0 ä¸‹çš„ TCP æµé‡æ§åˆ¶</title>
      <link>https://cloudnativecn.com/blog/raw-tcp-traffic-shaping-with-istio/</link>
      <pubDate>Wed, 24 Oct 2018 11:45:02 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/raw-tcp-traffic-shaping-with-istio/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://venilnoronha.io/raw-tcp-traffic-shaping-with-istio-1.1.0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;é€šè¿‡&lt;a href=&#34;https://istio.io/docs/reference/config/istio.networking.v1alpha3/#VirtualService&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è™šæ‹ŸæœåŠ¡&lt;/a&gt;, &lt;a href=&#34;https://istio.io/docs/reference/config/istio.networking.v1alpha3/#DestinationRule&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç›®æ ‡è§„åˆ™&lt;/a&gt;, &lt;a href=&#34;https://istio.io/docs/reference/config/istio.networking.v1alpha3/#Gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway&lt;/a&gt;ç­‰æ¦‚å¿µæä¾›äº†å¤æ‚çš„è·¯ç”±æœºåˆ¶ã€‚Istio 1.0 é€šè¿‡&lt;a href=&#34;https://istio.io/docs/tasks/traffic-management/traffic-shifting/#apply-weight-based-routing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ æƒè·¯ç”±å®šä¹‰&lt;/a&gt;å¯ç”¨äº† HTTP æµé‡è½¬ç§»ã€‚æˆ‘æäº¤çš„&lt;a href=&#34;https://github.com/envoyproxy/envoy/pull/4430&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt; å’Œ&lt;a href=&#34;https://github.com/istio/istio/pull/9112&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;çš„ pull requestä¸ºTCP/TLSæœåŠ¡æä¾›äº†ç±»ä¼¼çš„ç‰¹æ€§ã€‚è¿™ä¸€ç‰¹æ€§å·²ç»åœ¨Envoy &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/version_history#oct-4-2018&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;1.8.0&lt;/a&gt;ä¸­å‘å¸ƒäº†ã€‚Istio ä¸­çš„è¿™ä¸€ç‰¹æ€§ä¹Ÿä¼šåœ¨å³å°†å‘å¸ƒçš„&lt;a href=&#34;https://github.com/istio/istio/releases/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;1.1.0&lt;/a&gt;ç‰ˆæœ¬ä¸­æä¾›ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio&#34; srcset=&#34;
               /blog/raw-tcp-traffic-shaping-with-istio/006tNbRwly1fw3hlzj8krj304o06m3ya_hu_8e4105d0c455f690.webp 400w,
               /blog/raw-tcp-traffic-shaping-with-istio/006tNbRwly1fw3hlzj8krj304o06m3ya_hu_ace7a74d4959ead0.webp 760w,
               /blog/raw-tcp-traffic-shaping-with-istio/006tNbRwly1fw3hlzj8krj304o06m3ya_hu_1449f2d5831ec446.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/raw-tcp-traffic-shaping-with-istio/006tNbRwly1fw3hlzj8krj304o06m3ya_hu_8e4105d0c455f690.webp&#34;
               width=&#34;168&#34;
               height=&#34;238&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ç”¨&lt;a href=&#34;https://golang.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Go&lt;/a&gt;ç¼–å†™çš„ä¸€ä¸ªç®€å•çš„ TCP Echo æœåŠ¡ï¼Œç”¨&lt;a href=&#34;https://www.docker.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Docker&lt;/a&gt;å°†å…¶å®¹å™¨åŒ–å¹¶éƒ¨ç½²åˆ°&lt;a href=&#34;https://kubernetes.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes&lt;/a&gt;ä¸Šï¼Œå¹¶é€šè¿‡ç»ƒä¹  Istio çš„åŠ æƒ TCP è·¯ç”±ç‰¹æ€§æ¥ç†è§£å…¶åœ¨ç”Ÿäº§æœåŠ¡ä¸­çš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;tcp-echo-æœåŠ¡&#34;&gt;TCP Echo æœåŠ¡&lt;/h2&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„ç›‘å¬è¿æ¥çš„ TCP æœåŠ¡ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯çš„è¯·æ±‚æ•°æ®åŠ ä¸Šä¸€ä¸ªç®€å•çš„å‰ç¼€ï¼Œå°†å…¶ä½œä¸ºå“åº”è¿”å›ã€‚å›¾ç¤ºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-tcp-client---server-architecture&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;TCP Client - Server Architecture&#34; srcset=&#34;
               /blog/raw-tcp-traffic-shaping-with-istio/006tNbRwly1fwgz3b6bpoj30r607qgm6_hu_36c1cc41536b9cdc.webp 400w,
               /blog/raw-tcp-traffic-shaping-with-istio/006tNbRwly1fwgz3b6bpoj30r607qgm6_hu_a1d70d76c0fefcc6.webp 760w,
               /blog/raw-tcp-traffic-shaping-with-istio/006tNbRwly1fwgz3b6bpoj30r607qgm6_hu_cfe0252a8660cf32.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/raw-tcp-traffic-shaping-with-istio/006tNbRwly1fwgz3b6bpoj30r607qgm6_hu_36c1cc41536b9cdc.webp&#34;
               width=&#34;760&#34;
               height=&#34;216&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      TCP Client - Server Architecture
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ TCP Echo æœåŠ¡ç«¯çš„ Go ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;bufio&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;io&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// main ä½œä¸ºç¨‹åºå…¥å£ç‚¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// é€šè¿‡ç¨‹åºå…¥å‚è·å¾—ç«¯å£å’Œå‰ç¼€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;port&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;:%s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;prefix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// åœ¨ç»™å®šç«¯å£ä¸Šåˆ›å»º tcp ç›‘å¬&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Listen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to create listener, err:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;listening on %s, prefix: %s\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// ç›‘å¬æ–°çš„è¿æ¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Accept&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to accept connection, err:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// å¯ç”¨ goroutine å¤„ç†è¿æ¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;handleConnection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// handleConnection å¤„ç†è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;handleConnection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;prefix&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewReader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// è¯»å–å®¢æˆ·ç«¯è¯·æ±‚æ•°æ®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReadBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sc&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EOF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to read data, err:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;request: %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// æ·»åŠ å‰ç¼€ä½œä¸º response è¿”å›&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;line&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;response: %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;line&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;line&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¦æµ‹è¯•è¿™ä¸ªç¨‹åºï¼Œå¤åˆ¶ä¸Šé¢ä»£ç å¹¶å‘½åä¸º&lt;code&gt;main.go&lt;/code&gt;ï¼Œæ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ go run -v main.go &lt;span class=&#34;m&#34;&gt;9000&lt;/span&gt; hello
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;listening on &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;::&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:9000, prefix: hello
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code&gt;nc&lt;/code&gt; (&lt;a href=&#34;https://en.wikipedia.org/wiki/Netcat&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Netcat&lt;/a&gt;) åœ¨ TCP å±‚é¢ä¸Šå’Œè¿™æ®µç¨‹åºäº¤äº’ã€‚è¦å‘é€è¯·æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ BusyBox å®¹å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker run -it --rm busybox sh -c &lt;span class=&#34;s1&#34;&gt;&amp;#39;echo world | nc docker.for.mac.localhost 9000&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hello world
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°±åƒä½ çœ‹åˆ°çš„ï¼Œåœ¨è¯·æ±‚â€œworldâ€å‰é¢åŠ ä¸Šäº†â€œhelloâ€ï¼Œâ€œhello worldâ€ä½œä¸ºå“åº”ã€‚æ³¨æ„ï¼Œæ­£åœ¨æ‰§è¡Œçš„ BusyBox å®¹å™¨åŸºäº &lt;a href=&#34;https://docs.docker.com/docker-for-mac/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Docker for Mac&lt;/a&gt;ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘è®¿é—® Echo æœåŠ¡ç«¯æ—¶ç”¨&lt;code&gt;docker.for.mac.localhost&lt;/code&gt;ä»£æ›¿äº†&lt;code&gt;localhost&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®¹å™¨åŒ–-tcp-echo-æœåŠ¡&#34;&gt;å®¹å™¨åŒ– TCP Echo æœåŠ¡&lt;/h2&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬æœ€ç»ˆæƒ³è¦åœ¨ Kubernetes é›†ç¾¤ä¸Šè¿è¡Œ TCP Echo æœåŠ¡ï¼Œç°åœ¨è®©æˆ‘ä»¬å°†å®ƒå®¹å™¨åŒ–å¹¶å‘å¸ƒé•œåƒåˆ° &lt;a href=&#34;https://hub.docker.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Docker Hub&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œç”¨ä¸‹é¢çš„å†…å®¹åˆ›å»º&lt;code&gt;Dockerfile&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-dockerfile&#34; data-lang=&#34;dockerfile&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# ä½¿ç”¨golangå®¹å™¨æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; golang:1.11 as builder&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WORKDIR&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; /go/src/github.com/venilnoronha/tcp-echo-server/&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; main.go .&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RUN&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;CGO_ENABLED&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;GOOS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;linux go build -a -installsuffix cgo -o main main.go&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# è´Ÿè´£binæ–‡ä»¶åˆ°åŸºäºalpineçš„åˆ†ç¦»å®¹å™¨&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; alpine:3.8&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RUN&lt;/span&gt; apk --no-cache add ca-certificates&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WORKDIR&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; /bin/&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; --from&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;builder /go/src/github.com/venilnoronha/tcp-echo-server/main .&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ENTRYPOINT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/bin/main&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CMD&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;9000&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;hello&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXPOSE&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; 9000&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ„å»ºå®¹å™¨å¹¶å‘å¸ƒé•œåƒåˆ° Docker Hubï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker build -t vnoronha/tcp-echo-server:latest .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Sending build context to Docker daemon  60.93kB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Successfully built d172af115e18
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Successfully tagged vnoronha/tcp-echo-server:latest
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker push vnoronha/tcp-echo-server:latest
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;The push refers to repository &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;docker.io/vnoronha/tcp-echo-server&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b4cc76510de6: Pushed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;latest: digest: sha256:0a45b5a0d362db6aa9154717ee3f2b... size: &lt;span class=&#34;m&#34;&gt;949&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;éƒ¨ç½²-tcp-echo-æœåŠ¡åˆ°-kubernetes&#34;&gt;éƒ¨ç½² TCP Echo æœåŠ¡åˆ° Kubernetes&lt;/h2&gt;
&lt;h3 id=&#34;æœåŠ¡é…ç½®&#34;&gt;æœåŠ¡é…ç½®&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦éƒ¨ç½² 2 ä¸ªç‰ˆæœ¬çš„ TCP ECHO æœåŠ¡ï¼Œç”¨ä¸åŒçš„å‰ç¼€å±•ç¤ºè·¯ç”±è¡Œä¸ºã€‚åˆ›å»º&lt;code&gt;service.yaml&lt;/code&gt;ï¼Œç”¨ Kubernetes &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/service/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service&lt;/a&gt; å’Œ 2 ä¸ª &lt;a href=&#34;https://kubernetes.io/docs/concepts/workloads/controllers/deployment/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Deployments&lt;/a&gt; æ„å»º 2 ä¸ªç‰ˆæœ¬çš„ TCP ECHO æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp-echo-server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp-echo-server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# use istio default controller&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp-echo-server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp-echo-server-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp-echo-server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp-echo-server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;vnoronha/tcp-echo-server:latest&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;9000&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;one&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;] # prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;one&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp-echo-server-v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp-echo-server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp-echo-server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;vnoronha/tcp-echo-server:latest&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;9000&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;two&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;] # prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;two&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éƒ¨ç½²-minikube&#34;&gt;éƒ¨ç½² Minikube&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/setup/minikube/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Minikube&lt;/a&gt;æ˜¯ Kubernetes æœ¬åœ°å¼€å‘çš„æœ€ä½³å·¥å…·ã€‚ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ Minikube å®ä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ minikube start --bootstrapper kubeadm       &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;                 --memory&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8192&lt;/span&gt;                &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;                 --cpus&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;                     &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;                 --kubernetes-version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1.10.0 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;                 --vm-driver&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;virtualbox
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Starting &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; Kubernetes v1.10.0 cluster...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Kubectl is now configured to use the cluster.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Loading cached images from config file.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å®‰è£…-istio&#34;&gt;å®‰è£… Istio&lt;/h3&gt;
&lt;p&gt;åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼ŒIstio 1.1.0 è¿˜æ²¡æœ‰å‘å¸ƒã€‚å› æ­¤æˆ‘ä½¿ç”¨äº† Istio çš„ &lt;a href=&#34;https://gcsweb.istio.io/gcs/istio-prerelease/daily-build/master-20181017-09-15/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Daily Pre-Release&lt;/a&gt;æ¥æ¼”ç¤ºè¿™ä¸ªæ–°ç‰¹æ€§ã€‚è¯·å‚è€ƒ&lt;a href=&#34;https://istio.io/docs/setup/kubernetes/download-release/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt;å­¦ä¹ ä¸‹è½½å’Œé…ç½® Istioã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦é…ç½®å®Œæˆï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå®Œå…¨éƒ¨ç½² Istio ç»„ä»¶çš„ç®€å•æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f install/kubernetes/helm/istio/templates/crds.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;customresourcedefinition.apiextensions.k8s.io/virtualservices.networking.istio.io created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;customresourcedefinition.apiextensions.k8s.io/templates.config.istio.io created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;customresourcedefinition.apiextensions.k8s.io/handlers.config.istio.io created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f install/kubernetes/istio-demo.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;namespace/istio-system created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destinationrule.networking.istio.io/istio-policy created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destinationrule.networking.istio.io/istio-telemetry created 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä½¿ç”¨-istio-ä»£ç†éƒ¨ç½²-tcp-echo-æœåŠ¡&#34;&gt;ä½¿ç”¨ Istio ä»£ç†éƒ¨ç½² TCP Echo æœåŠ¡&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†æ¼”ç¤º Istio çš„è·¯ç”±æœºåˆ¶ï¼Œæˆ‘ä»¬ä»¥ sidecar æ¨¡å¼éƒ¨ç½²&lt;code&gt;tcp-echo-server&lt;/code&gt; ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f &amp;lt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f service.yaml&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/tcp-echo-server created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions/tcp-echo-server-v1 created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.extensions/tcp-echo-server-v2 created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥éªŒè¯æœåŠ¡è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                  READY     STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp-echo-server-v1-78684f5697-sv5r5   2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          56s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp-echo-server-v2-74bf9999c8-hhhf9   2/2       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          56s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl logs tcp-echo-server-v1-78684f5697-sv5r5 tcp-echo-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;listening on &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;::&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:9000, prefix: one
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl logs tcp-echo-server-v2-74bf9999c8-hhhf9 tcp-echo-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;listening on &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;::&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:9000, prefix: two
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;istio-åŠ æƒ-tcp-è·¯ç”±&#34;&gt;Istio åŠ æƒ TCP è·¯ç”±&lt;/h2&gt;
&lt;p&gt;è¿™æ˜¯æœ¬ç»ƒä¹ çš„æœ€åä¸€éƒ¨åˆ†ï¼Œå®šä¹‰&lt;code&gt;VirtualService&lt;/code&gt;ï¼Œ&lt;code&gt;DestinationRule&lt;/code&gt;å’Œå¸¦æœ‰æƒé‡è·¯ç”±çš„ &lt;code&gt;Gateway&lt;/code&gt;ï¼Œå¹¶éªŒè¯ç³»ç»Ÿè¡Œä¸ºã€‚&lt;/p&gt;
&lt;h3 id=&#34;è·¯ç”±é…ç½®&#34;&gt;è·¯ç”±é…ç½®&lt;/h3&gt;
&lt;p&gt;åˆ›å»ºå¸¦æœ‰ä¸¤ä¸ª&lt;code&gt;subset&lt;/code&gt;çš„&lt;code&gt;DestinationRule&lt;/code&gt;æ¥ä»£è¡¨ä¸¤ä¸ªç‰ˆæœ¬çš„ TCP Echo æœåŠ¡ã€‚&lt;code&gt;Gateway&lt;/code&gt; å®¹è®¸æµé‡é€šè¿‡ç«¯å£&lt;code&gt;31400&lt;/code&gt;è®¿é—®æœåŠ¡ã€‚æœ€åï¼Œ&lt;code&gt;VirtualService&lt;/code&gt;é™å®šäº† 80% çš„æµé‡å¿…é¡»è¢«è·¯ç”±åˆ° TCP Echo æœåŠ¡çš„ v1 ç‰ˆæœ¬ï¼Œ20% è¢«è·¯ç”±åˆ° v2 ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp-echo-server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subsets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;31400&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tcp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;31400&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp-echo-server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp-echo-server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éƒ¨ç½²è·¯ç”±é…ç½®&#34;&gt;éƒ¨ç½²è·¯ç”±é…ç½®&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†è®©é…ç½®ç”Ÿæ•ˆï¼Œå¤åˆ¶ä¸Šé¢çš„é…ç½®å†…å®¹å¹¶åˆ›å»ºæ–‡ä»¶&lt;code&gt;route-config.yaml&lt;/code&gt;ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f route-config.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;destinationrule.networking.istio.io/destination created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gateway.networking.istio.io/gateway created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;virtualservice.networking.istio.io/route created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éªŒè¯-istio-çš„-tcp-è·¯ç”±è¡Œä¸º&#34;&gt;éªŒè¯ Istio çš„ TCP è·¯ç”±è¡Œä¸º&lt;/h3&gt;
&lt;p&gt;å…ˆæ¥ç¡®å®šä¸€ä¸‹&lt;a href=&#34;https://istio.io/docs/tasks/traffic-management/ingress/#determining-the-ingress-ip-and-ports&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress çš„ IP&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ minikube ip
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;192.168.99.100
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å¯ä»¥é€šè¿‡ Ingress å‘é€ä¸€äº›è¯·æ±‚åˆ°åŠ æƒè´Ÿè½½å‡è¡¡çš„ TCP Echo æœåŠ¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;1..10&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&amp;gt; docker run -it --rm busybox sh -c &lt;span class=&#34;s1&#34;&gt;&amp;#39;(date; sleep 1) | nc 192.168.99.100 31400&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&amp;gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;one Sat Oct &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; 04:38:05 UTC &lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;two Sat Oct &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; 04:38:07 UTC &lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;two Sat Oct &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; 04:38:09 UTC &lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;one Sat Oct &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; 04:38:12 UTC &lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;one Sat Oct &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; 04:38:14 UTC &lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;one Sat Oct &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; 04:38:17 UTC &lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;one Sat Oct &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; 04:38:19 UTC &lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;one Sat Oct &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; 04:38:22 UTC &lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;one Sat Oct &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; 04:38:24 UTC &lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;two Sat Oct &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; 04:38:27 UTC &lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä½ æ‰€è§ï¼Œå¤§çº¦ 80% çš„è¯·æ±‚å¸¦æœ‰â€œoneâ€å‰ç¼€ï¼Œå‰©ä¸‹ 20% å¸¦æœ‰â€œtwoâ€å‰ç¼€ã€‚è¿™è¯æ˜äº†åŠ æƒ TCP è·¯ç”±å™¨ç¡®å®ç”Ÿæ•ˆäº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾èƒ½è®©ä½ å¾ˆå¥½åœ°äº†è§£è¿™ä¸ªç¤ºèŒƒçš„æƒ…æ™¯ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-architecture&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Architecture&#34; srcset=&#34;
               /blog/raw-tcp-traffic-shaping-with-istio/006tNbRwly1fwhdkuu6sgj30zg0ikmze_hu_decaadda08d7f265.webp 400w,
               /blog/raw-tcp-traffic-shaping-with-istio/006tNbRwly1fwhdkuu6sgj30zg0ikmze_hu_6087df1b47b95004.webp 760w,
               /blog/raw-tcp-traffic-shaping-with-istio/006tNbRwly1fwhdkuu6sgj30zg0ikmze_hu_7988c5e84f899a48.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/raw-tcp-traffic-shaping-with-istio/006tNbRwly1fwhdkuu6sgj30zg0ikmze_hu_decaadda08d7f265.webp&#34;
               width=&#34;760&#34;
               height=&#34;398&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Architecture
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æ¸…ç†&#34;&gt;æ¸…ç†&lt;/h2&gt;
&lt;p&gt;åªéœ€è¦åƒä¸‹é¢ä¸€æ ·åˆ é™¤ Minikube çš„éƒ¨ç½²ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ minikube stop &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; minikube delete
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Stopping &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; Kubernetes cluster...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Machine stopped.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Deleting &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; Kubernetes cluster...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Machine deleted.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å¦‚æœ¬æ–‡æ‰€ç¤ºï¼Œå³å°†å‘å¸ƒçš„ Istio 1.1.0 ç‰ˆæœ¬é…ç½®åŠ æƒ TCP è·¯ç”±éå¸¸å®¹æ˜“ã€‚æœ¬æ–‡æä¾›äº†æ„å»ºä¸€ä¸ªåŠ æƒ TCP è·¯ç”±çš„æ€è·¯ï¼Œè®©ä½ å­¦ä¼šå¦‚ä½•ä»å¤´å¼€å§‹æ§åˆ¶ TCP æµé‡ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Service Mesh çš„æœªæ¥å°†ä¸ Knative å’Œ Apahce Whisk ç­‰æŠ€æœ¯å’Œè°å…±å­˜â€”â€”é‡‡è®¿ RedHat çš„ Istio äº§å“ç»ç†</title>
      <link>https://cloudnativecn.com/blog/istio-service-mesh-interview-redbear-brian-harrington/</link>
      <pubDate>Mon, 17 Sep 2018 19:19:27 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-service-mesh-interview-redbear-brian-harrington/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://jaxenter.com/istio-service-mesh-interview-harrington-148638.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Istio æ­£åœ¨å¼•å‘å¤§é‡çš„å…³æ³¨ï¼Œç‰¹åˆ«æ˜¯ 1.0 ç‰ˆæœ¬å‘å¸ƒåã€‚ä½†å®ƒæ˜¯å¦æˆä¸º Kubernetes ä¹‹ä¸Šçš„äº‹å®çš„æœåŠ¡ç½‘ç»œæ ‡å‡†å‘¢ï¼Ÿæˆ‘ä»¬é‡‡è®¿äº† Red Hat çš„ Istio äº§å“ç»ç†â€œçº¢èƒ¡å­â€Brian Harringtonï¼Œä»–çš„ç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚â€œæœ‰äº† Istioï¼Œéƒ¨ç½²å¾ˆç®€å•ï¼Œä¸ Kubernetes çš„é›†æˆä¹Ÿæ˜¯æµ‘ç„¶ä¸€ä½“çš„ã€‚æ„Ÿè§‰å°±åº”è¯¥æ˜¯è¿™æ ·ã€‚â€œ&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-çº¢èƒ¡å­-brian-harrington&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;çº¢èƒ¡å­ Brian Harrington&#34; srcset=&#34;
               /blog/istio-service-mesh-interview-redbear-brian-harrington/006tNbRwgy1fvcqw67cllj30lc0qodj9_hu_8487e97290d89b35.webp 400w,
               /blog/istio-service-mesh-interview-redbear-brian-harrington/006tNbRwgy1fvcqw67cllj30lc0qodj9_hu_f9396262b034f7f7.webp 760w,
               /blog/istio-service-mesh-interview-redbear-brian-harrington/006tNbRwgy1fvcqw67cllj30lc0qodj9_hu_96c05b41f472bcbb.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-service-mesh-interview-redbear-brian-harrington/006tNbRwgy1fvcqw67cllj30lc0qodj9_hu_8487e97290d89b35.webp&#34;
               width=&#34;608&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      çº¢èƒ¡å­ Brian Harrington
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ç‰‡ï¼šçº¢èƒ¡å­ Brian Harrington&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Brian Harringtonï¼Œä¹Ÿè¢«ç§°ä¸º Redbeardï¼ˆçº¢èƒ¡å­ï¼‰ï¼Œæ˜¯ CoreOS çš„é¦–å¸­æ¶æ„å¸ˆï¼Œç°åœ¨æ˜¯ Red Hat çš„ Istio çš„äº§å“ç»ç†ã€‚ä»–æ˜¯å¼€æºå¼€å‘å’Œç³»ç»Ÿç®¡ç†é¢†åŸŸçš„å¼€å‘äººå‘˜ï¼Œé»‘å®¢å’ŒæŠ€æœ¯æ’°ç¨¿äººã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Istio &lt;a href=&#34;https://jaxenter.com/istio-1-0-arrived-core-features-ready-production-use-147459.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;1.0&lt;/a&gt; åœ¨ä»Šå¹´ 8 æœˆåˆå‘å¸ƒï¼Œæ‰€æœ‰&lt;a href=&#34;https://istio.io/about/feature-stages/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ ¸å¿ƒåŠŸèƒ½&lt;/a&gt;ç°åœ¨éƒ½å¯ä»¥ç”¨äºç”Ÿäº§ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨å·²ç»ç†Ÿæ‚‰ 0.8 ä¸­æä¾›çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥çŸ¥é“ 1.0 ä¸­æä¾›çš„æ–°åŠŸèƒ½åˆ—è¡¨å¹¶ä¸é•¿ï¼›è¯¥å›¢é˜Ÿé€‰æ‹©ä¸“æ³¨äºä¿®å¤é”™è¯¯å¹¶æé«˜æ€§èƒ½ã€‚å¦‚æœæ‚¨æƒ³çœ‹çœ‹ Istio 1.0 ä¸­å¼•å…¥çš„æ‰€æœ‰æ›´æ”¹ï¼Œå¯ä»¥é˜…è¯»&lt;a href=&#34;https://istio.io/zh/about/notes/1.0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘è¡Œè¯´æ˜&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä¸ Red Hat çš„ Istio äº§å“ç»ç†â€œçº¢èƒ¡å­â€Brian Harrington è®¨è®ºäº†ä»–æœ€å–œæ¬¢çš„åŠŸèƒ½ï¼ŒIstio çš„æœªæ¥ä»¥åŠå®ƒæ˜¯å¦å…·å¤‡æˆä¸º Kubernetes äº‹å®ä¸Šçš„æœåŠ¡ç½‘ç»œæ ‡å‡†çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-æ”¹å˜æ¸¸æˆè§„åˆ™&#34;&gt;Istio æ”¹å˜æ¸¸æˆè§„åˆ™ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;JAXenterï¼šIstio å¯èƒ½ç›¸å¯¹è¾ƒæ–°ï¼Œä½†è¿™ç§ç”¨äºè¿æ¥ã€ç®¡ç†å’Œä¿æŠ¤å¾®æœåŠ¡çš„å·¥å…·æ­£åœ¨è·å¾—å¹¿æ³›çš„æ”¯æŒã€‚å¢é•¿èƒŒåçš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;â€œçº¢èƒ¡å­â€Brian Harringtonï¼š&lt;/strong&gt; æœ€å¤§çš„åŸå› æ˜¯èŒƒå¼çš„è½¬å˜ã€‚åœ¨ &lt;a href=&#34;https://netflix.github.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Netflix çš„ OSS&lt;/a&gt; ï¼ˆå¼€æ”¾æºä»£ç è½¯ä»¶å¥—ä»¶ï¼‰å¸¦æ¥äº†å¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œä¸ªäººå¼€å‘ä¼ä¸šçº§ Java åº”ç”¨ç¨‹åºï¼Œä½†å®ƒè¦æ±‚ä½ ä¸ºäº†å®ç°æ•´ä¸ªå¥—ä»¶çš„è€Œæ•´åˆå„ç§è½¯ä»¶åº“ã€‚Istio ä»¤äººå…´å¥‹ï¼Œå› ä¸ºå®ƒä¸ºç”¨æˆ·æä¾›äº† A/B æµ‹è¯•ã€æ–­è·¯ã€æœåŠ¡æˆæƒç­‰åŠŸèƒ½ï¼ŒåŒæ—¶æœ€å¤§é™åº¦åœ°å‡å°‘äº†ä»£ç æ›´æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;JAXenterï¼šGoogle æœ€è¿‘å®£å¸ƒçš„&lt;a href=&#34;https://jaxenter.com/google-cloud-interesting-announcements-147230.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘æœåŠ¡å¹³å°&lt;/a&gt;ä»¥ Istioï¼ˆå’Œ Kubernetesï¼‰ä¸ºæ ¸å¿ƒã€‚è¿™å¯¹ Istio çš„æœªæ¥æ„å‘³ç€ä»€ä¹ˆï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;â€œçº¢èƒ¡å­â€Brian Harringtonï¼š&lt;/strong&gt; è¿™è¡¨æ˜è¯¥é¢†åŸŸçš„è€ç‰Œä¼ä¸šå·²ç»è®¤è¯†åˆ°äº†ä¸€é¡¹å“è¶Šçš„æŠ€æœ¯ï¼Œå¹¶ä¸”æ˜ç™½æ—©æœŸåˆä½œå°†ä¸ºå®¢æˆ·å¸¦æ¥æ›´å¤§çš„æˆåŠŸã€‚åè¿‡æ¥ï¼Œå¦‚æœå®¢æˆ·æˆåŠŸï¼Œé‡‡ç”¨çš„ä¾›åº”å•†æä¾›çš„è§£å†³æ–¹æ¡ˆä¹Ÿä¼šå¢åŠ ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;JAXenterï¼šIstio èƒ½å¦æˆä¸º Kubernetes äº‹å®ä¸Šçš„æœåŠ¡ç½‘ç»œï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;â€œçº¢èƒ¡å­â€Brian Harringtonï¼š&lt;/strong&gt; æˆ‘æ•¢è‚¯å®šä¼šçš„ã€‚å…¶ä»–è§£å†³æ–¹æ¡ˆé€šå¸¸æ˜¯åœ¨æ“ä½œç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ä¸æ˜¯ä»¥äº‘åŸç”Ÿä¸»ä½“ä¸ºåŸºç¡€æ„å»ºçš„ï¼Œå› æ­¤å¯èƒ½æ€»æ˜¯æ„Ÿè§‰æœ‰ç‚¹ç¬¨æ‹™ã€‚ä½¿ç”¨ Istioï¼Œéƒ¨ç½²éå¸¸ç®€å•ï¼Œä¸ Kubernetes çš„é›†æˆä¹Ÿæµ‘ç„¶ä¸€ä½“ã€‚æ„Ÿè§‰å¥½åƒåº”è¯¥ä¸€ç›´å­˜åœ¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;JAXenterï¼šåœ¨ Istio 1.0 ä¸­ä½ æœ€å–œæ¬¢çš„åŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;â€œçº¢èƒ¡å­â€Brian Harringtonï¼š&lt;/strong&gt; æˆ‘æœ€å–œæ¬¢çš„åŠŸèƒ½æ˜¯èƒ½å¤Ÿè‡ªç”±æ§åˆ¶æµé‡çš„è·¯ç”±ã€‚è¿‡å»è¿è¡ŒæœåŠ¡æ—¶ï¼Œæ€»æ˜¯éœ€è¦æ˜‚è´µçš„ä¸“ç”¨è´Ÿè½½å‡è¡¡ç¡¬ä»¶çš„ç»„åˆæ‰èƒ½å®ç°è¯¥åŠŸèƒ½ï¼Œè¿˜è¦ä¿®æ”¹åº”ç”¨ç¨‹åºï¼Œæœ‰æ—¶å€™ç”šè‡³éœ€è¦é‡å†™ä¸€ä¸ªæ‰èƒ½è‰¯å¥½è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio ä¸­ï¼Œå°† 10ï¼…çš„æµé‡åˆ†é…åˆ°ä¸åŒç‰ˆæœ¬çš„æœåŠ¡å¹¶å°†è¿™äº›è¿æ¥è·¯ç”±åˆ°è¯¥ç‰ˆæœ¬çš„æœåŠ¡ååˆ†ç®€å•ã€‚å›´ç»•è¯¥åŠŸèƒ½çš„æ˜“ç”¨æ€§æ”¹å˜äº†æ¸¸æˆè§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¯·å‚è§ï¼š&lt;a href=&#34;http://www.servicemesher.com/blog/announcing-istio-1.0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio 1.0 å‘å¸ƒï¼Œå·²ç”Ÿäº§å°±ç»ªï¼&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;JAXenterï¼šIstio çš„æœªæ¥æ˜¯æ¨¡å—åŒ–çš„å—ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;â€œçº¢èƒ¡å­â€Brian Harringtonï¼š&lt;/strong&gt; æ¨¡å—åŒ–æ˜¯ Istio æœªæ¥çš„ä¸€éƒ¨åˆ†ã€‚Istio è§„å®šäº†æŸäº›éœ€è¦æ»¡è¶³çš„æ¥å£ï¼Œç„¶åå…è®¸ç”¨æˆ·ä½¿ç”¨ä»–ä»¬æœ€ç†Ÿæ‚‰çš„è½¯ä»¶æ¥æ»¡è¶³è¿™äº›æ¥å£ã€‚è¿™åœ¨â€œNginmeshâ€é¡¹ç›®ä¸­æœ€ä¸ºæ˜æ˜¾ï¼Œå…¶ä¸­ Envoyï¼ˆIstio çš„ä»£ç†ç»„ä»¶ï¼‰è¢« Nginx å–ä»£ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä»–ç”¨æˆ·åŒæ ·å¯ä»¥ç”¨ Linkerd å–ä»£äº† Envoyã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;JAXenterï¼šä½¿ç”¨ Istio æœ€å¤§çš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;**â€œçº¢èƒ¡å­â€Brian Harringtonï¼š**Istio æœ€è€€çœ¼çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯å®ƒä¸“æ³¨äºåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚è®¾ç½®åŒå‘ TLS çš„åŠŸèƒ½å¯è‡ªåŠ¨è§£é”å…¶ä»–é«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚æœåŠ¡æˆæƒä»¥åŠæœåŠ¡ä¹‹é—´çš„åŠ å¯†ã€‚Istio è¿˜å…·æœ‰ä¸å…¶ä»– &lt;a href=&#34;https://spiffe.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIFFE&lt;/a&gt; ï¼ˆé€‚ç”¨äºæ‰€æœ‰äººçš„å®‰å…¨ç”Ÿäº§èº«ä»½æ¡†æ¶ï¼‰å…¼å®¹ç³»ç»Ÿé›†æˆçš„èƒ½åŠ›ï¼Œè¿™å°†æœ‰åŠ©äºæ¨åŠ¨æœªæ¥é‡‡ç”¨æ›´é«˜åº¦å®‰å…¨çš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘å¸Œæœ›çœ‹åˆ°å®‰å…¨ç‰¹æ€§è¿›ä¸€æ­¥æ‰©å±•ï¼ŒåŒ…æ‹¬ç±»ä¼¼äº Google çš„&lt;a href=&#34;https://cloud.google.com/iap/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;èº«ä»½è¯†åˆ«ä»£ç†çš„åŠŸèƒ½&lt;/a&gt; ã€‚å…³äºè¿™ä¸€ç‚¹çš„å¥½å¤„æ˜¯ï¼Œé€šè¿‡å¯¹ JSON Web token çš„æ”¯æŒå’Œå¯¹ OpenID Connect çš„æ”¯æŒå¥ å®šäº†ä¸€äº›åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿˜è¯·å‚è§ï¼š &lt;a href=&#34;https://jaxenter.com/google-cloud-interesting-announcements-147230.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Cloud Next &amp;lsquo;18ï¼šäº‘å¼€å‘äººå‘˜æ‰€å¸Œæœ›çš„ä¸€åˆ‡&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;JAXenterï¼šIstio æœ‰ä»€ä¹ˆ Linkerd èº«ä¸Šä¸å…·å¤‡çš„ä¸œè¥¿å—ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;**â€œçº¢èƒ¡å­â€Brian Harringtonï¼š**Istio æ‹¥æœ‰ä¸€ä¸ªè“¬å‹ƒå‘å±•çš„ç¤¾åŒºï¼Œæ­£ä»¥æƒŠäººçš„é€Ÿåº¦å¢é•¿ã€‚é¡ºä¾¿æä¸€ä¸‹ï¼ŒIstio å·²ç»å­˜åœ¨äº†å¤§çº¦ &lt;a href=&#34;https://github.com/istio/istio/commit/0216e811e9da88b867742710f7d166cef2eabfbc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;21 ä¸ªæœˆ&lt;/a&gt; ï¼Œåœ¨ GitHub ä¸Šæœ‰è¶…è¿‡ 200 ä¸ªè´¡çŒ®è€…å’Œä¸€ä¸ªéå¸¸æ´»è·ƒ&lt;a href=&#34;https://github.com/istio/istio/pulse&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pulse&lt;/a&gt;ï¼ˆå³ä½¿ä½ å¿½ç•¥åƒ Fortio è¿™æ ·çš„å­é¡¹ç›®åªçœ‹ Istio æ ¸å¿ƒé¡¹ç›®ï¼‰ã€‚è€Œ Linkerd å·²ç»å­˜åœ¨äº†è¿‘&lt;a href=&#34;https://github.com/linkerd/linkerd/tree/37e38f2a892d9354eea7305135aa6370612b02f2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;31 ä¸ªæœˆ&lt;/a&gt;ã€‚å³ä½¿ä½ ç»“åˆ&lt;a href=&#34;https://github.com/linkerd/linkerd/pulse&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd v1&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/linkerd/linkerd2/pulse/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd v2&lt;/a&gt; çš„â€œpulseâ€ ï¼Œå®ƒä»¬çš„æ´»è·ƒåº¦æ¯”èµ· Istio ä»ç„¶ç›¸å»ç”šè¿œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;JAXenterï¼šæ‚¨èƒ½å±•æœ›ä¸‹æœåŠ¡ç½‘æ ¼çš„æœªæ¥å—ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;â€œçº¢èƒ¡å­â€Brian Harringtonï¼š&lt;/strong&gt; æˆ‘ç›¸ä¿¡æœåŠ¡ç½‘æ ¼çš„æœªæ¥ä¸æ— æœåŠ¡å™¨è®¡ç®—ï¼ˆServerlessï¼‰æœ‰å…³ã€‚æˆ‘ä»¬æ­£åœ¨èåˆå¼€å‘äººå‘˜æˆåŠŸåœ°å°†ä»£ç åº“åˆ†è§£ä¸ºåŸå­ç»„ä»¶çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§è¶‹åŠ¿ç”šè‡³åæ˜ åœ¨å›´ç»• Istio æ¨¡å—åŒ–çš„é—®é¢˜ä¸Šã€‚æˆ‘è§‰å¾—æœåŠ¡ç½‘æ ¼çš„æœªæ¥æ˜¯ä¸ Knative å’Œ Apache Whisk ç­‰æŠ€æœ¯å…±ç”Ÿçš„ï¼Œå®ƒä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿé‡æ–°é‡‡ç”¨â€œä»…åšä¸€ä»¶äº‹å¹¶æŠŠå®ƒåšå¾—å¥½â€ï¼ˆdo one thing and do it wellï¼‰çš„â€œUNIX å“²å­¦â€ï¼Œä»¥å»ºç«‹åº”ç”¨çš„æœªæ¥ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/istio-service-mesh-interview-redbear-brian-harrington/006tNbRwgy1fvcr3ya379j30sg0j1grh_hu_ed4c597e3c332584.webp 400w,
               /blog/istio-service-mesh-interview-redbear-brian-harrington/006tNbRwgy1fvcr3ya379j30sg0j1grh_hu_92c509cab6c92560.webp 760w,
               /blog/istio-service-mesh-interview-redbear-brian-harrington/006tNbRwgy1fvcr3ya379j30sg0j1grh_hu_43d054f3b3d671c2.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-service-mesh-interview-redbear-brian-harrington/006tNbRwgy1fvcr3ya379j30sg0j1grh_hu_ed4c597e3c332584.webp&#34;
               width=&#34;760&#34;
               height=&#34;508&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åœ¨ Play with Kubernetes å¹³å°ä¸Šä»¥æµ‹è¯•é©±åŠ¨çš„æ–¹å¼éƒ¨ç½² Istio</title>
      <link>https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/</link>
      <pubDate>Fri, 07 Sep 2018 12:33:30 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/</guid>
      <description>&lt;p&gt;















&lt;figure  id=&#34;figure-kubernetes-and-istio&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Kubernetes and Istio&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7dq9d14j20jg08cju2_hu_3138f0aff2d44635.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7dq9d14j20jg08cju2_hu_7c20ab6fe81696f5.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7dq9d14j20jg08cju2_hu_2ec7547c86e4d362.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7dq9d14j20jg08cju2_hu_3138f0aff2d44635.webp&#34;
               width=&#34;700&#34;
               height=&#34;300&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Kubernetes and Istio
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://www.knowledgehut.com/blog/cloud-computing/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä½œä¸ºä¸€åå…¨æ ˆå¼€å‘ï¼Œå‡å¦‚æœ€è¿‘èŠ±äº†ä¸å°‘æ—¶é—´å¼€å‘åº”ç”¨ï¼Œè‚¯å®šå·²ç»ç†è§£äº†å¾®æœåŠ¡æ¶æ„ä¸‹è¦é¢ä¸´çš„ä¸€ç³»åˆ—å…¨æ–°æŒ‘æˆ˜ã€‚å°½ç®¡åº”ç”¨å·²ç»ä»åºå¤§çš„å•ä½“åº”ç”¨è½¬å˜æˆäº†å¼€å‘æ›´å¿«ã€å¼¹æ€§æ›´å¥½ã€æ›´å°ä¹Ÿæ›´èšç„¦çš„å¾®æœåŠ¡ï¼Œä½†ç°å®æ˜¯ï¼Œå¼€å‘è€…éœ€è¦å¼€å§‹æ“å¿ƒå°†è¿™äº›æœåŠ¡é›†æˆåˆ°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é—®é¢˜äº†ï¼ŒåŒ…æ‹¬æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€æ³¨å†Œã€å®¹é”™ã€ç›‘æ§ã€è·¯ç”±ã€å…¼å®¹å’Œå®‰å…¨ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ›´è¯¦ç»†çš„æ‹†è§£å¾®æœåŠ¡æ¶æ„ä¸‹å¼€å‘å’Œè¿ç»´é¢ä¸´çš„æŒ‘æˆ˜å§ã€‚å…ˆæ¥çœ‹çœ‹ç¬¬ä¸€ä»£ç®€å•çš„ Service Mesh åœºæ™¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒæœåŠ¡ A è¦å’Œ æœåŠ¡ B é€šä¿¡ï¼Œæ²¡æœ‰é‡‡ç”¨ç›´æ¥é€šä¿¡çš„æ–¹å¼ï¼Œè¯·æ±‚æ˜¯é€šè¿‡ NGINX è·¯ç”±çš„ã€‚NGINX ä» Consulï¼ˆæœåŠ¡å‘ç°å·¥å…·ï¼‰æŸ¥æ‰¾è·¯ç”±ï¼Œå¹¶åœ¨æ”¶åˆ° HTTP 502 å“åº”æ—¶ï¼Œè‡ªåŠ¨é‡è¯•ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-10---ä¸€ä»£-service-mesh&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1.0 - ä¸€ä»£ Service Mesh&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7wkxxawj20jg08cmz4_hu_cbc9012d4079e3ed.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7wkxxawj20jg08cmz4_hu_88104cb99c7b5f25.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7wkxxawj20jg08cmz4_hu_d1ebe419987aa019.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7wkxxawj20jg08cmz4_hu_cbc9012d4079e3ed.webp&#34;
               width=&#34;700&#34;
               height=&#34;300&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1.0 - ä¸€ä»£ Service Mesh
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-11---æœåŠ¡å¢å¤šæ—¶çº§è”å¤±è´¥æ¼”ç¤º&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1.1 - æœåŠ¡å¢å¤šæ—¶ï¼Œçº§è”å¤±è´¥æ¼”ç¤º&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7ybax2rj20jg09pgpc_hu_2fcf80be4be4ee44.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7ybax2rj20jg09pgpc_hu_5deaac5c7335e874.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7ybax2rj20jg09pgpc_hu_777a4cd0c6aff21f.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7ybax2rj20jg09pgpc_hu_2fcf80be4be4ee44.webp&#34;
               width=&#34;700&#34;
               height=&#34;349&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1.1 - æœåŠ¡å¢å¤šæ—¶ï¼Œçº§è”å¤±è´¥æ¼”ç¤º
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½†éšç€å¾®æœåŠ¡æ¶æ„çš„åˆ°æ¥ï¼ŒæœåŠ¡æ•°é‡çš„å¢é•¿ä¸€å‘ä¸å¯æ”¶æ‹¾ï¼Œä¸‹é¢åˆ—å‡ºçš„æ˜¯å¼€å‘å’Œè¿ç»´å›¢é˜Ÿé‡åˆ°çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚ä½•è®©æ—¥ç›Šå¢é•¿çš„å¾®æœåŠ¡ä»¬äº’è”ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ä¸ºå¾®æœåŠ¡æä¾›è´Ÿè½½å‡è¡¡ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä¸ºå¾®æœåŠ¡æä¾›åŸºäºè§’è‰²çš„è·¯ç”±ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚ä½•æ§åˆ¶å¾®æœåŠ¡çš„å‡ºå£æµé‡ï¼Œå¦‚ä½•å®ç°ç°åº¦å‘å¸ƒï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•æ§åˆ¶ä¸æ–­å¢é•¿çš„å¾®æœåŠ¡çš„å¤æ‚åº¦ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ç”¨å¯Œè·¯ç”±è§„åˆ™å®ç°ç»†ç²’åº¦çš„æµé‡æ§åˆ¶ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å®ç°æµé‡åŠ å¯†ã€æœåŠ¡åˆ°æœåŠ¡çš„é‰´æƒå’Œå¼ºèº«ä»½å£°æ˜çš„æŒ‘æˆ˜&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼Œè™½ç„¶ä½ å¯ä»¥åœ¨åº”ç”¨å’Œç½‘ç»œä¸­é—´ä»¶ä¸­å¼€å¯æœåŠ¡å‘ç°å’Œé‡è¯•æœºåˆ¶ï¼Œä½†å®é™…ä¸Šï¼Œæƒ³è®©æœåŠ¡å‘ç°æ­£å¸¸å·¥ä½œæ˜¯éå¸¸å›°éš¾çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åˆè¯• Istio Service Mesh&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Service Mesh æ˜¯ 2018 å¹´åº¦æœ€ç«çƒ­çš„æµè¡Œè¯ä¹‹ä¸€ï¼Œå®ƒæ˜¯å¾®æœåŠ¡çš„å¯é…ç½®åŸºç¡€æ¶æ„å±‚ï¼Œè´Ÿè´£å¾®æœåŠ¡åº”ç”¨é—´çš„äº¤äº’ï¼Œservice mesh è®©å¾®æœåŠ¡å®ä¾‹é—´çš„äº¤äº’æ›´çµæ´»ã€å¯é å’Œå¿«é€Ÿã€‚Mesh å±‚æä¾›äº†æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€åŠ å¯†ã€é‰´æƒå’ŒéªŒè¯ï¼Œæ”¯æŒç†”æ–­æœºåˆ¶ç­‰å…¶ä»–èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;Istio æ˜¯å®Œå…¨å¼€æºçš„ï¼Œå¯é€æ˜çš„éƒ¨ç½²åœ¨å·²æœ‰çš„åˆ†å¸ƒå¼åº”ç”¨ä¸Šã€‚Istio 1.0 ç‰ˆæœ¬åœ¨ä¸Šä¸ªæœˆå‘å¸ƒï¼Œå·²ç»ç”Ÿäº§ç¯å¢ƒå¯ç”¨ã€‚Istio å®Œå…¨ç”± Go è¯­è¨€ç¼–å†™ï¼Œæä¾›æˆç†Ÿçš„ API æ¥å£å¯ä»¥æ¥å…¥åˆ°ä»»ä½•æ—¥å¿—å¹³å°ã€é¥æµ‹å’Œç­–ç•¥ç³»ç»Ÿä¸­ã€‚Istio åœ¨ GitHub ä¸Šå‘å¸ƒï¼Œå¯¹ç³»ç»Ÿçš„æ€§èƒ½å½±å“å¾ˆå°ï¼Œä¸°å¯Œçš„ç‰¹æ€§è®©ä½ å¯ä»¥é¡ºåˆ©ã€é«˜æ•ˆçš„è¿è¡Œåˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ï¼Œå¹¶æä¾›ç»Ÿä¸€çš„ä¿æŠ¤ã€è¿æ¥å’Œç›‘æ§æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-12-istio-åŠŸèƒ½&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1.2 Istio åŠŸèƒ½&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxw8v04rgj20jg09pmyw_hu_7c79cd1b001ca91a.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxw8v04rgj20jg09pmyw_hu_3913c1ff8f1937d1.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxw8v04rgj20jg09pmyw_hu_7fad797ded94d904.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxw8v04rgj20jg09pmyw_hu_7c79cd1b001ca91a.webp&#34;
               width=&#34;700&#34;
               height=&#34;349&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1.2 Istio åŠŸèƒ½
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio å¯¹ç³»ç»Ÿçš„å½±å“å¾ˆå°ï¼Œå®ƒåœ¨ GitHub ä¸Šå‘å¸ƒï¼Œä¸Šä¸ªæœˆï¼ŒIstio 1.0 ç‰ˆæœ¬å·²ç»å‘å¸ƒï¼Œå¹¶ä¸”ç”Ÿäº§ç¯å¢ƒå¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;Istio èƒ½å¸¦æ¥ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Istio æä¾›æœåŠ¡çš„è¿æ¥ã€ä¿æŠ¤ã€æ§åˆ¶å’Œè§‚æµ‹èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;å‡å°‘æœåŠ¡éƒ¨ç½²çš„å¤æ‚åº¦ï¼Œå‡è½»éƒ¨ç½²å›¢é˜Ÿçš„å‹åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æ— éœ€ä¿®æ”¹åº”ç”¨ä»£ç çš„å‰æä¸‹ï¼Œä¸ºå¼€å‘å’Œå¼€å‘è¿ç»´æä¾›äº†ç»†ç²’åº¦çš„æµé‡å¯è§†åŒ–å’Œæ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;ä¸º CIO æä¾›äº†å¸®åŠ©å…¨ä¼ä¸šå®‰å…¨å®æ–½å’Œåˆè§„å‹éœ€æ±‚çš„å¿…è¦å·¥å…·ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ service mesh å±‚æä¾›äº†ç»Ÿä¸€çš„è¡Œä¸ºç›‘æµ‹å’Œè¿è¥æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;Istio è®©ä¸ºæœåŠ¡ç½‘ç»œæä¾› HTTPã€gRPCã€Web Socket å’Œ TCP æµé‡çš„è‡ªåŠ¨è´Ÿè½½å‡è¡¡å˜çš„è½»æ¾ã€‚&lt;/li&gt;
&lt;li&gt;æä¾›äº†ç»†ç²’åº¦çš„æµé‡è¡Œä¸ºæ§åˆ¶ï¼ŒåŒ…æ‹¬ï¼šå¯Œè·¯ç”±è§„åˆ™ã€é‡è¯•ã€æ•…éšœè½¬ç§»å’Œå¤±è´¥æ³¨å…¥ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒæ’ä»¶åŒ–çš„ç­–ç•¥æ§åˆ¶å±‚å’Œé…ç½® APIï¼Œæ”¯æŒè®¿é—®æ§åˆ¶ã€æµé‡é™åˆ¶å’Œé…é¢ã€‚&lt;/li&gt;
&lt;li&gt;Istio ä¸ºé›†ç¾¤å†…çš„å…¨éƒ¨æµé‡æä¾›è‡ªåŠ¨çš„åº¦é‡ã€æ—¥å¿—ã€è¿½è¸ªï¼ŒåŒ…æ‹¬è¿›ç¾¤çš„å…¥å£å’Œå‡ºå£ã€‚&lt;/li&gt;
&lt;li&gt;ä»¥å¼ºèº«ä»½éªŒè¯å’Œé‰´æƒçš„æ–¹å¼ï¼Œæä¾›äº†é›†ç¾¤å†…å®‰å…¨çš„æœåŠ¡é—´é€šä¿¡ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚ä½•æƒ³æ·±å…¥ Istio æ¶æ„ï¼Œæˆ‘å¼ºçƒˆæ¨è Istio å®˜æ–¹ç½‘ç«™ï¼ˆhttps://istio.io/zhï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwajuotmj20jg0dy0uz_hu_ec302ea8cfdc109d.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwajuotmj20jg0dy0uz_hu_738d2d002a38c967.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwajuotmj20jg0dy0uz_hu_a2df22887cb63108.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwajuotmj20jg0dy0uz_hu_ec302ea8cfdc109d.webp&#34;
               width=&#34;700&#34;
               height=&#34;502&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¼€å§‹æ¼”ç¤ºï¼ï¼ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•åœ¨ Play with Kubernetesï¼ˆPWKï¼‰ä¸­å…è´¹éƒ¨ç½² Istioï¼Œè¿™æ˜¯ä¸ªç”± Docker æä¾›çš„å®éªŒç½‘ç«™ï¼Œæ˜¯è®©ç”¨æˆ·åœ¨å‡ ç§’é’Ÿå†…è·‘èµ·æ¥ Kubernetes é›†ç¾¤çš„è¯•éªŒç¯å¢ƒã€‚PWK æä¾›äº†åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨å…è´¹ CentOS Linux è™šæ‹Ÿæœºçš„ä½“éªŒï¼Œå®é™…ä¸Šæ˜¯ Docker-in-Dockerï¼ˆDinDï¼‰æŠ€æœ¯æ¨¡æ‹Ÿäº†å¤šè™šæ‹Ÿæœº/PC çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;p&gt;æ‰“å¼€ &lt;a href=&#34;https://labs.play-with-k8s.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://labs.play-with-k8s.com/&lt;/a&gt;ï¼Œè®¿é—® Kubernetes Playgroundã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwcxpg13j20jg0dy76k_hu_5547a807e784cf1.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwcxpg13j20jg0dy76k_hu_f93465074aca7ae4.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwcxpg13j20jg0dy76k_hu_63dc743fd44595dd.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwcxpg13j20jg0dy76k_hu_5547a807e784cf1.webp&#34;
               width=&#34;700&#34;
               height=&#34;502&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç‚¹å‡» &amp;ldquo;Login&amp;rdquo; æŒ‰é’®ï¼Œä»¥ Docker Hub æˆ– GitHub ID ç™»é™†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwdv6kv0j20nq0byaa1_hu_306fa25323c52b5f.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwdv6kv0j20nq0byaa1_hu_7f3bec47a5ff0d58.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwdv6kv0j20nq0byaa1_hu_8a045805c3ba34cd.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwdv6kv0j20nq0byaa1_hu_306fa25323c52b5f.webp&#34;
               width=&#34;760&#34;
               height=&#34;383&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å®Œæˆæœ¬æ•™ç¨‹ï¼Œä½ å°†è·å¾—è‡ªå·±çš„å®éªŒç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ·»åŠ ç¬¬ä¸€ä¸ª Kubernetes èŠ‚ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç‚¹å‡»å·¦ä¾§çš„ &amp;ldquo;Add New Instance&amp;rdquo; æ¥æ„å»ºä½ çš„ç¬¬ä¸€ä¸ª Kubernetes é›†ç¾¤èŠ‚ç‚¹ï¼Œè‡ªåŠ¨å‘½åä¸º &amp;ldquo;node1&amp;rdquo;ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½é¢„è£…æ¥ Docker ç¤¾åŒºç‰ˆï¼ˆCEï¼‰å’Œ Kubeadmã€‚è¿™ä¸ªèŠ‚ç‚¹å°†æˆä¸ºé›†ç¾¤çš„ä¸»èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwf2adjdj211o0nq75d_hu_cda4a8ad70a81460.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwf2adjdj211o0nq75d_hu_20158499e0f05905.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwf2adjdj211o0nq75d_hu_77bedc1714b24b87.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwf2adjdj211o0nq75d_hu_cda4a8ad70a81460.webp&#34;
               width=&#34;760&#34;
               height=&#34;479&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯åŠ¨ä¸»èŠ‚ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç”¨å¦‚ä¸‹è„šæœ¬åˆå§‹åŒ–ä¸»èŠ‚ç‚¹ï¼ˆnode1ï¼‰æ¥å¯åŠ¨ Kubernetes é›†ç¾¤ï¼Œå¤åˆ¶è¯¥è„šæœ¬å†…å®¹åˆ°æ–‡ä»¶ bootstrap.shï¼Œå¹¶æ‰§è¡Œå‘½ä»¤æ·»åŠ å¯æ‰§è¡Œæƒé™ï¼š&lt;code&gt;chmod +x bootstrap.sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwgb83gkj20jg04p75i_hu_2775988d30fe6060.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwgb83gkj20jg04p75i_hu_3d6f67e00be1ef92.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwgb83gkj20jg04p75i_hu_2f35dd0254a1e39d.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwgb83gkj20jg04p75i_hu_2775988d30fe6060.webp&#34;
               width=&#34;700&#34;
               height=&#34;169&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œè„šæœ¬æ—¶ï¼Œä½œä¸ºåˆå§‹åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œkubeadm ä¼šå†™å…¥å‡ ä¸ªå¿…è¦çš„é…ç½®æ–‡ä»¶ã€è®¾ç½® RBAC å¹¶éƒ¨ç½² Kubernetes æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆä¾‹å¦‚ kube-apiserverã€kube-dnsã€kube-proxyã€etcd ç­‰ï¼‰ã€‚æ§åˆ¶å¹³é¢ç»„ä»¶ä»¥ docker å®¹å™¨å½¢å¼éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1mbluj20y004ujrf_hu_ae7116ee0af403e6.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1mbluj20y004ujrf_hu_ac51b56070b1a422.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1mbluj20y004ujrf_hu_1bd3021ce8ce4f01.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1mbluj20y004ujrf_hu_ae7116ee0af403e6.webp&#34;
               width=&#34;760&#34;
               height=&#34;108&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¤åˆ¶ä¸Šé¢çš„ kubeadm join token å‘½ä»¤ï¼Œç•™ä½œä¸‹æ­¥ä½¿ç”¨ï¼Œæ­¤å‘½ä»¤ç”¨æ¥åœ¨é›†ç¾¤ä¸­åŠ å…¥å…¶ä»–èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ·»åŠ ä»èŠ‚ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç‚¹å‡» &amp;ldquo;Add New Node&amp;rdquo; æ·»åŠ æ–°çš„ä»èŠ‚ç‚¹&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ncf3j20sj0a3aam_hu_7ef03b4a60c379ff.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ncf3j20sj0a3aam_hu_4f174bf32ada4797.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ncf3j20sj0a3aam_hu_92f900758b83309e.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ncf3j20sj0a3aam_hu_7ef03b4a60c379ff.webp&#34;
               width=&#34;760&#34;
               height=&#34;268&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éªŒè¯é›†ç¾¤çŠ¶æ€&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1moxsj20h304rmxc_hu_34519dd7446dcedd.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1moxsj20h304rmxc_hu_2f3c465bf33feb9a.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1moxsj20h304rmxc_hu_fd26cd17df12ae9a.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1moxsj20h304rmxc_hu_34519dd7446dcedd.webp&#34;
               width=&#34;615&#34;
               height=&#34;171&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éªŒè¯è¿è¡Œçš„ Pods&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1scslj20to0bfmyo_hu_88fca9b495e62485.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1scslj20to0bfmyo_hu_48f5a8c49b1642ec.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1scslj20to0bfmyo_hu_df76b38620ad58e0.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1scslj20to0bfmyo_hu_88fca9b495e62485.webp&#34;
               width=&#34;760&#34;
               height=&#34;293&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®‰è£… Istio 1.0.0&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Istio éƒ¨ç½²åœ¨å•ç‹¬çš„ Kubernetes å‘½åç©ºé—´é‡Œï¼šistio-systemï¼Œæˆ‘ä»¬è¿‡åå†æ¥éªŒè¯ã€‚ç°åœ¨ï¼Œå¤åˆ¶å¦‚ä¸‹å†…å®¹åˆ°æ–‡ä»¶ï¼Œå‘½åä¸º install_istio.shï¼Œå¹¶ä¿å­˜ã€‚æ·»åŠ å¯æ‰§è¡Œæƒé™ï¼Œè¿è¡Œä»¥å®‰è£… Istio å’Œç›¸å…³å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oor0j20jg05mgn0_hu_449e465764453273.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oor0j20jg05mgn0_hu_73a8401f92fcfb4b.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oor0j20jg05mgn0_hu_964f37b2554903b2.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oor0j20jg05mgn0_hu_449e465764453273.webp&#34;
               width=&#34;700&#34;
               height=&#34;202&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å±å¹•ä¸Šåº”æ˜¾ç¤ºå¦‚ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ue42j20k70fb75x_hu_1d9c777ddeff211d.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ue42j20k70fb75x_hu_986c49c83ddb5dd2.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ue42j20k70fb75x_hu_70f0ae30024ddd62.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ue42j20k70fb75x_hu_1d9c777ddeff211d.webp&#34;
               width=&#34;727&#34;
               height=&#34;551&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚ä¸Šæ‰€ç¤ºï¼Œé»˜è®¤ä¼šå®‰è£… Prometheusã€ServiceGraphã€Jaegerã€Grafana å’Œ Zipkinã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼šè¿è¡Œè¯¥è„šæœ¬æ—¶ï¼Œå¯èƒ½ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;unable to recognize &lt;span class=&#34;s2&#34;&gt;&amp;#34;install/kubernetes/istio-demo.yaml&amp;#34;&lt;/span&gt;: no matches &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; admissionregistration.k8s.io/, &lt;span class=&#34;nv&#34;&gt;Kind&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;MutatingWebhookConfiguration
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ˜¯æ­£å¸¸çš„ï¼Œå‘½ä»¤ä¸€æ‰§è¡Œå®Œï¼Œå¯åœ¨é¡µé¢çš„ä¸­å¤®çœ‹åˆ°ä¸€é•¿ä¸²å±•ç¤ºçš„ç«¯å£ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1uh9aj20u40jkmz5_hu_86e5d083e86a6258.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1uh9aj20u40jkmz5_hu_87e52987f74990f0.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1uh9aj20u40jkmz5_hu_de56e2fe4a74bfd7.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1uh9aj20u40jkmz5_hu_86e5d083e86a6258.webp&#34;
               width=&#34;760&#34;
               height=&#34;493&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wesej20u40jkmz5_hu_86e5d083e86a6258.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wesej20u40jkmz5_hu_87e52987f74990f0.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wesej20u40jkmz5_hu_de56e2fe4a74bfd7.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wesej20u40jkmz5_hu_86e5d083e86a6258.webp&#34;
               width=&#34;760&#34;
               height=&#34;493&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éªŒè¯æœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wxc3j20x10f175z_hu_1be314a2f9cd68df.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wxc3j20x10f175z_hu_71f5c4378061ba98.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wxc3j20x10f175z_hu_124454897c1fdd01.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wxc3j20x10f175z_hu_1be314a2f9cd68df.webp&#34;
               width=&#34;760&#34;
               height=&#34;346&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æš´éœ²æœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¦æš´éœ² Prometheusã€Grafana å’Œ æœåŠ¡å›¾æ ‡æœåŠ¡ï¼Œéœ€è¦å…ˆåˆ é™¤å·²æœ‰çš„æœåŠ¡ï¼Œç”¨ NodePort æ›¿æ¢ ClusterIPï¼Œç”¨å®ä¾‹é¡µé¡¶ç«¯å±•ç¤ºçš„ç«¯å£è®¿é—®æœåŠ¡ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oduej210g07ywfj_hu_4383242df6455b7a.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oduej210g07ywfj_hu_48fc51c432e6528f.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oduej210g07ywfj_hu_69bee677748fb212.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oduej210g07ywfj_hu_4383242df6455b7a.webp&#34;
               width=&#34;760&#34;
               height=&#34;166&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1x12ej20z80eogn8_hu_f853dc21f994ce17.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1x12ej20z80eogn8_hu_5f1f2b6062bf9389.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1x12ej20z80eogn8_hu_bb18b7421f7f4480.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1x12ej20z80eogn8_hu_f853dc21f994ce17.webp&#34;
               width=&#34;760&#34;
               height=&#34;316&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç‚¹å‡» &amp;ldquo;30004&amp;rdquo; è®¿é—® Grafana é¡µï¼Œç‚¹å‡» &amp;ldquo;30003&amp;rdquo; è®¿é—® Prometheus é¡µã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ysfbj21350ofjsy_hu_28a3bc8c15a24df2.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ysfbj21350ofjsy_hu_e92aa3b96a74c771.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ysfbj21350ofjsy_hu_34f790426abe0901.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ysfbj21350ofjsy_hu_28a3bc8c15a24df2.webp&#34;
               width=&#34;760&#34;
               height=&#34;474&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oe4rj213z0ivq3r_hu_8fa8225119718788.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oe4rj213z0ivq3r_hu_af757c5904673fc7.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oe4rj213z0ivq3r_hu_608ab82b657527eb.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oe4rj213z0ivq3r_hu_8fa8225119718788.webp&#34;
               width=&#34;760&#34;
               height=&#34;359&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯ä»¥å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé€‰æ‹©å¿…è¦é…ç½®æŸ¥çœ‹ Prometheus åº¦é‡ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1olhxj20rp0fl3yr_hu_488cb3c6f1bfbe51.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1olhxj20rp0fl3yr_hu_7424feade73f19e7.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1olhxj20rp0fl3yr_hu_de4e272207ebb396.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1olhxj20rp0fl3yr_hu_488cb3c6f1bfbe51.webp&#34;
               width=&#34;760&#34;
               height=&#34;428&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ Grafana é¡µï¼Œæ·»åŠ  Prometheus æ•°æ®æºï¼Œå¹¶ç¡®è®¤ Dashboard å·²ç»è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1pomvj20hs0ixdgh_hu_4257ed15cff7e7c5.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1pomvj20hs0ixdgh_hu_166fccb37c4cdaa5.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1pomvj20hs0ixdgh_hu_5f5f61f29829cad1.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1pomvj20hs0ixdgh_hu_4257ed15cff7e7c5.webp&#34;
               width=&#34;640&#34;
               height=&#34;681&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ­å–œï¼ä½ å·²ç»å°† Istio éƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤ä¸Šäº†ï¼ŒK8S playgroud ä¸Šå·²ç»å®‰è£…çš„æœåŠ¡åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Istio Controllersï¼Œä»¥åŠç›¸å…³ RBAC è§„åˆ™&lt;/li&gt;
&lt;li&gt;Istio å®šåˆ¶èµ„æºå®šä¹‰&lt;/li&gt;
&lt;li&gt;Prometheus å’Œ Grafana ç›‘æ§ç³»ç»Ÿ&lt;/li&gt;
&lt;li&gt;Jeager åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿ&lt;/li&gt;
&lt;li&gt;Istio Sidecar æ³¨å…¥ç¨‹åºï¼ˆä¸‹ä¸€èŠ‚æˆ‘ä»¬å†æ¥ä»”ç»†çœ‹çœ‹ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å®‰è£… Istioctl&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Istioctl æ˜¯ Istio çš„å‘½ä»¤è¡Œé…ç½®å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥åˆ›å»ºã€æŸ¥è¯¢ã€ä¿®æ”¹å’Œåˆ é™¤ Istio ç³»ç»Ÿçš„é…ç½®èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1qvitj213v06it97_hu_11ac87a5f76fe5a5.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1qvitj213v06it97_hu_c83fbff7bf554991.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1qvitj213v06it97_hu_e45166892fbcfde8.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1qvitj213v06it97_hu_11ac87a5f76fe5a5.webp&#34;
               width=&#34;760&#34;
               height=&#34;124&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éƒ¨ç½² BookInfo åº”ç”¨ç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Istio å·²ç»å®‰è£…å¹¶éªŒè¯è¿‡äº†ï¼Œå¯ä»¥åœ¨ä¸Šé¢éƒ¨ç½²ç¤ºä¾‹åº”ç”¨ BookInfo äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¹¦åº—æ¨¡æ‹Ÿåº”ç”¨ï¼Œç”±å››ä¸ªæœåŠ¡ç»„æˆï¼šç½‘ç«™é¦–é¡µã€ä¹¦ç±ä¿¡æ¯ã€è¯„è®ºï¼ˆå‡ ä¸ªç‰¹å®šçš„ç‰ˆæœ¬æœ‰è¯„è®ºæœåŠ¡ï¼‰å’Œè¯„åˆ†ï¼Œå…¨éƒ¨ç”± Istio ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éƒ¨ç½² BookInfo æœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj247c0j20jg07gdhv_hu_738de1062972570f.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj247c0j20jg07gdhv_hu_335722947d243ccb.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj247c0j20jg07gdhv_hu_ac4264496e915b30.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj247c0j20jg07gdhv_hu_738de1062972570f.webp&#34;
               width=&#34;700&#34;
               height=&#34;268&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰å…¥å£ç½‘å…³&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1rru2j20jg03xdgu_hu_a1e5bdffcb49998d.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1rru2j20jg03xdgu_hu_b3e70ab7dd2f5959.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1rru2j20jg03xdgu_hu_d493ad3b2f0a396c.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1rru2j20jg03xdgu_hu_a1e5bdffcb49998d.webp&#34;
               width=&#34;700&#34;
               height=&#34;141&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éªŒè¯ BookInfo åº”ç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj280kwj20jg0d8aew_hu_3da61209e6fd8fea.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj280kwj20jg0d8aew_hu_7740889b992ab958.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj280kwj20jg0d8aew_hu_e12f0609430ac353.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj280kwj20jg0d8aew_hu_3da61209e6fd8fea.webp&#34;
               width=&#34;700&#34;
               height=&#34;476&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj27k0kj20jg0k57b9_hu_29789d82d64e2473.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj27k0kj20jg0k57b9_hu_1a247542b4a76208.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj27k0kj20jg0k57b9_hu_d1c2da1836e9266e.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj27k0kj20jg0k57b9_hu_29789d82d64e2473.webp&#34;
               width=&#34;700&#34;
               height=&#34;725&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é€šè¿‡ URL è®¿é—®&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj28b2bj20jg07rwhd_hu_dc058c13229a3ce8.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj28b2bj20jg07rwhd_hu_eabda4bca428b5d7.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj28b2bj20jg07rwhd_hu_c024d905d9df3dcb.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj28b2bj20jg07rwhd_hu_dc058c13229a3ce8.webp&#34;
               width=&#34;700&#34;
               height=&#34;279&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç°åœ¨åº”è¯¥å¯ä»¥çœ‹åˆ° BookInfo ç¤ºä¾‹äº†ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ycp2j20jg07rjtf_hu_f8f7792af7417b60.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ycp2j20jg07rjtf_hu_686c02d1abc103c2.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ycp2j20jg07rjtf_hu_b1ddd4596d1919be.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ycp2j20jg07rjtf_hu_f8f7792af7417b60.webp&#34;
               width=&#34;700&#34;
               height=&#34;279&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¸Œæœ›æœ¬éƒ¨ç¨‹èƒ½å¸®ä½ é¡ºåˆ©çš„åœ¨ Kubernetes ä¸Šéƒ¨ç½² Istioã€‚ä¸‹ä¸€ç¯‡åšå®¢ï¼Œæˆ‘å°†æ·±å…¥ Istio çš„å†…éƒ¨æ¶æ„ã€æµé‡æ§åˆ¶ã€æƒé™å’Œé¥æµ‹ç­‰ç»†èŠ‚ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åº”ç”¨ç¨‹åºå®‰å…¨æ€§å’Œæ­£ç¡®æ€§çš„è´£ä»»ä¸èƒ½æ¨å¸ç»™ Istio å’Œä»»ä½•æœåŠ¡ç½‘æ ¼</title>
      <link>https://cloudnativecn.com/blog/application-safety-and-correctness-cannot-be-offloaded-to-istio-or-any-service-mesh/</link>
      <pubDate>Thu, 23 Aug 2018 15:31:39 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/application-safety-and-correctness-cannot-be-offloaded-to-istio-or-any-service-mesh/</guid>
      <description>&lt;p&gt;æˆ‘æœ€è¿‘åœ¨è®¨è®ºé›†æˆæœåŠ¡çš„æ¼”è¿›ä»¥åŠæœåŠ¡ç½‘æ ¼çš„ä½¿ç”¨ï¼Œç‰¹åˆ«æ˜¯å…³äº Istioã€‚è‡ªä» 2017 å¹´ 1 æœˆæˆ‘å¬è¯´äº† Istio ä»¥æ¥ï¼Œæˆ‘ä¸€ç›´å¾ˆå…´å¥‹ï¼Œäº‹å®ä¸Šæˆ‘æ˜¯ä¸ºè¿™ç§æ–°æŠ€æœ¯æ„Ÿåˆ°å…´å¥‹ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç»„ç»‡æ„å»ºå¾®æœåŠ¡ä»¥åŠåŸç”Ÿäº‘æ¶æ„æˆä¸ºå¯èƒ½ã€‚ä¹Ÿè®¸ä½ å¯ä»¥è¯´ï¼Œå› ä¸ºæˆ‘å·²ç»å†™äº†å¾ˆå¤šå…³äºå®ƒçš„æ–‡ç« ï¼ˆè¯·å…³æ³¨ &lt;a href=&#34;https://twitter.com/christianposta&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@christianposta&lt;/a&gt; çš„åŠ¨æ€)ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.christianposta.com/microservices/the-hardest-part-of-microservices-calling-your-services/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Hardest Part of Microservices: Calling Your Services&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.christianposta.com/microservices/00-microservices-patterns-with-envoy-proxy-series/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Microservices Patterns With Envoy Sidecar Proxy: The series&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.christianposta.com/microservices/application-network-functions-with-esbs-api-management-and-now-service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Application Network Functions With ESBs, API Management, and Now.. Service Mesh?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.christianposta.com/microservices/comparing-envoy-and-istio-circuit-breaking-with-netflix-hystrix/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Comparing Envoy and Istio Circuit Breaking With Netflix OSS Hystrix&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.christianposta.com/microservices/traffic-shadowing-with-istio-reduce-the-risk-of-code-release/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Traffic Shadowing With Istio: Reducing the Risk of Code Release&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.christianposta.com/microservices/advanced-traffic-shadowing-patterns-for-microservices-with-istio-service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Advanced Traffic-shadowing Patterns for Microservices With Istio Service Mesh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.christianposta.com/how-a-service-mesh-can-help-with-microservices-security/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How a Service Mesh Can Help With Microservices Security&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio å»ºç«‹åœ¨å®¹å™¨å’Œ Kubernetes çš„ä¸€äº›ç›®æ ‡ä¹‹ä¸Šï¼šæä¾›æœ‰ä»·å€¼çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¨¡å¼ä½œä¸ºè¯­è¨€æ— å…³çš„ä¹ æƒ¯ç”¨æ³•ã€‚ä¾‹å¦‚ï¼šKubernetes é€šè¿‡æ‰§è¡Œå¯åŠ¨/åœæ­¢ã€å¥åº·æ£€æŸ¥ã€ç¼©æ”¾/è‡ªåŠ¨ç¼©æ”¾ç­‰æ¥ç®¡ç†å®¹å™¨ï¼Œè€Œä¸ç®¡å®¹å™¨ä¸­å®é™…è¿è¡Œçš„æ˜¯ä»€ä¹ˆã€‚ç±»ä¼¼çš„ï¼ŒIstio å¯ä»¥é€šè¿‡åœ¨åº”ç”¨ç¨‹åºå®¹å™¨ä¹‹å¤–é€æ˜åœ°è§£å†³å¯é æ€§ã€å®‰å…¨æ€§ã€ç­–ç•¥å’Œé€šä¿¡æ–¹é¢çš„æŒ‘æˆ˜ã€‚&lt;/p&gt;
&lt;p&gt;éšç€ &lt;a href=&#34;https://istio.io/blog/2018/announcing-1.0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio 1.0&lt;/a&gt; ç‰ˆæœ¬åœ¨ 2018 å¹´ 7 æœˆ 31 æ—¥çš„å‘å¸ƒï¼Œæˆ‘ä»¬çœ‹åˆ° Istio çš„ä½¿ç”¨å’Œé‡‡çº³æœ‰äº†å¾ˆå¤§çš„å¢åŠ ã€‚æˆ‘çœ‹åˆ°çš„ä¸€ä¸ªé—®é¢˜æ˜¯â€œå¦‚æœ Istio ä¸ºæˆ‘æä¾›äº†å¯é æ€§ï¼Œé‚£ä¹ˆåœ¨åº”ç”¨ç¨‹åºä¸­æˆ‘è¿˜éœ€è¦åœ¨æ‹…å¿ƒå®ƒå—ï¼Ÿâ€&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æˆ‘çš„ç­”æ¡ˆæ˜¯ï¼šç»å¯¹è¦ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://blog.christianposta.com/microservices/application-network-functions-with-esbs-api-management-and-now-service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å°±åœ¨å‰ä¸€å¹´ï¼Œæˆ‘å†™äº†ä¸€ç¯‡æ–‡ç« &lt;/a&gt;ï¼Œå…¶ä¸­åŒ…å«äº†è¿™ä¸€åŒºåˆ«ï¼Œä½†å¹¶ä¸æ˜¯è¶³å¤Ÿæœ‰åŠ›ï¼›è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘è¯•å›¾çº æ­£è¿™ä¸€ç‚¹ï¼Œ&lt;a href=&#34;https://www.slideshare.net/ceposta/evolution-of-integration-and-microservices-patterns-with-service-mesh-107786281&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¹¶å»ºç«‹åœ¨å‰é¢æåˆ°çš„è°ˆè¯çš„åŸºç¡€ä¸Š&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œè®¾ç½®ä¸€äº›ä¸Šä¸‹æ–‡ï¼šIstio æä¾›äº†åº”ç”¨ç¨‹åºç½‘ç»œçš„â€œå¯é æ€§â€èƒ½åŠ›ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨é‡è¯•ï¼ˆautomatic retryï¼‰&lt;/li&gt;
&lt;li&gt;é‡è¯•é…é¢/é¢„ç®—ï¼ˆretry quota/budgetï¼‰&lt;/li&gt;
&lt;li&gt;è¿æ¥è¶…æ—¶ï¼ˆconnection timeoutï¼‰&lt;/li&gt;
&lt;li&gt;è¯·æ±‚è¶…æ—¶ï¼ˆrequest timeoutï¼‰&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼ˆclient-side load balancingï¼‰&lt;/li&gt;
&lt;li&gt;æ–­è·¯å™¨ï¼ˆcircuit breakingï¼‰&lt;/li&gt;
&lt;li&gt;éš”ç¦»å±‚ï¼ˆbulkheadingï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨å¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œè¿™äº›åŠŸèƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚ç½‘ç»œå¹¶ä¸æ˜¯å¯é çš„ï¼Œå¹¶ä¸”ç ´åäº†æˆ‘ä»¬åœ¨ä¸€ä¸ªæ•´ä½“ä¸­æ‰€æ‹¥æœ‰çš„å¾ˆå¤šå¥½çš„å®‰å…¨å‡è®¾/æŠ½è±¡ã€‚æˆ‘ä»¬è¦ä¹ˆè¿«åˆ‡çš„è§£å†³è¿™äº›é—®é¢˜ï¼Œè¦ä¹ˆé­å—ç³»ç»ŸèŒƒå›´å†…ä¸å¯é¢„æµ‹çš„åœæœºã€‚&lt;/p&gt;
&lt;h2 id=&#34;é€€ä¸€æ­¥è¯´&#34;&gt;é€€ä¸€æ­¥è¯´&lt;/h2&gt;
&lt;p&gt;è¿™é‡Œæ›´å¤§çš„é—®é¢˜å®é™…ä¸Šæ˜¯è®©åº”ç”¨ç¨‹åºç›¸äº’é€šä¿¡æ¥è§£å†³ä¸€äº›ä¸šåŠ¡çš„é—®é¢˜ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ç¼–å†™è½¯ä»¶çš„åŸå› ï¼Œæœ€ç»ˆç”¨æ¥æä¾›æŸç§å•†ä¸šä»·å€¼ã€‚åŒæ—¶è¯¥è½¯ä»¶ä¹Ÿä½¿ç”¨ä¸€äº›å•†ä¸šé¢†åŸŸæ¨¡å‹ï¼Œä¾‹å¦‚ï¼šâ€œå®¢æˆ·â€ã€â€œè´­ç‰©è½¦â€ã€â€œè´¦æˆ·â€ç­‰ã€‚ä»é¢†åŸŸé©±åŠ¨çš„è®¾è®¡æ¥çœ‹ï¼Œæ¯ä¸ªæœåŠ¡å¯èƒ½åœ¨ç†è§£è¿™äº›æ¦‚å¿µä¸Šéƒ½ç•¥å¾®æœ‰ä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæœ‰ä¸€äº›ä¸å¤ªæ˜ç¡®çš„æ¦‚å¿µå’Œæ›´å¤§çš„ä¸šåŠ¡çº¦æŸï¼ˆä¾‹å¦‚ï¼šå®¢æˆ·å¯ä»¥ç”±åç§°å’Œç”µå­é‚®ä»¶æ¥ç¡®è®¤å”¯ä¸€æ€§ï¼Œæˆ–è€…å®¢æˆ·åªèƒ½æ‹¥æœ‰ä¸€ç§ç±»å‹çš„æ”¯ç¥¨è´¦æˆ·ç­‰ï¼‰ï¼Œä»¥åŠä¸å¯é çš„ç½‘ç»œå’Œæ•´ä¸ªä¸å¯é¢„çŸ¥çš„åŸºç¡€è®¾æ–½ï¼ˆå‡å®šå¯ä»¥æ„å»ºè¿™æ ·çš„æœåŠ¡ï¼Œå¯ä»¥æˆ–è€…å¤±è´¥ï¼‰ä½¿æ„å»ºæ­£ç¡®æ˜¯éå¸¸å›°éš¾çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç«¯åˆ°ç«¯çš„æ­£ç¡®æ€§å’Œå®‰å…¨æ€§&#34;&gt;ç«¯åˆ°ç«¯çš„æ­£ç¡®æ€§å’Œå®‰å…¨æ€§&lt;/h2&gt;
&lt;p&gt;ç„¶è€Œï¼Œäº‹å®ä¸Šæ˜¯ï¼Œåœ¨æ„å»ºæ­£ç¡®å’Œå®‰å…¨çš„åº”ç”¨ç¨‹åºæ–¹é¢ï¼Œè¿™æ ·çš„è´£ä»»å½’å±åˆ°äº†åº”ç”¨ç¨‹åºä¸Šï¼ˆä»¥åŠæ‰€æœ‰å®ƒæ”¯æŒçš„äººï¼‰ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•å°†æ›´ä½çº§åˆ«çš„å¯é æ€§æ„å»ºåˆ°ç³»ç»Ÿçš„æ€§èƒ½æˆ–ä¼˜åŒ–çš„ç»„ä»¶ä¸­ï¼Œä½†æ€»çš„è´£ä»»è¿˜æ˜¯åœ¨åº”ç”¨ç¨‹åºä¸­ã€‚1984 å¹´ Saltzerã€Reed å’Œ Clark åœ¨â€œç³»ç»Ÿè®¾è®¡ä¸­çš„ç«¯åˆ°ç«¯è®ºè¯â€ä¸­æåˆ°äº†è¿™ä¸€åŸåˆ™ã€‚å…·ä½“åœ°è¯´ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åªæœ‰åœ¨å¯¹é€šä¿¡ç³»ç»Ÿç«¯ç‚¹çš„åº”ç”¨ç¨‹åºè¶³å¤Ÿäº†è§£çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½å®Œå…¨æ­£ç¡®çš„å®ç°æ‰€è®¨è®ºçš„åŠŸèƒ½ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;åœ¨è¿™é‡Œï¼Œâ€œåŠŸèƒ½â€æ˜¯åº”ç”¨ç¨‹åºçš„éœ€æ±‚ä¹‹ä¸€ï¼Œæ¯”å¦‚â€œé¢„è®¢â€æˆ–â€œå‘è´­ç‰©è½¦ä¸­æ·»åŠ å•†å“â€ã€‚è¿™ç§åŠŸèƒ½ä¸èƒ½æ¦‚æ‹¬ä¸ºé€šä¿¡ç³»ç»Ÿæˆ–å…¶ç»„ä»¶/åŸºç¡€è®¾ç½®ï¼ˆè¿™é‡Œçš„é€šä¿¡ç³»ç»ŸæŒ‡çš„æ˜¯ç½‘ç»œã€ä¸­é—´ä»¶å’Œä»»ä½•ä¸ºåº”ç”¨ç¨‹åºæä¾›åŸºç¡€è®¾æ–½çš„å·¥ä½œï¼‰ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å› æ­¤ï¼Œæä¾›è¢«è´¨ç–‘çš„åŠŸèƒ½ä½œä¸ºé€šä¿¡ç³»ç»Ÿæœ¬èº«çš„ç‰¹è´¨æ˜¯ä¸å¯èƒ½çš„ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›äº‹æƒ…ä»¥ä¿è¯é€šä¿¡ç³»ç»Ÿçš„éƒ¨åˆ†å¯é ï¼Œè¿™æ ·æœ‰åŠ©äºå®ç°æ›´é«˜å±‚æ¬¡çš„åº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚æˆ‘ä»¬åšè¿™äº›äº‹æƒ…åå¯ä»¥ä¼˜åŒ–éƒ¨åˆ†åŒºåŸŸï¼Œè¿™æ ·ä¸è‡³äºè¿‡äºæ‹…å¿ƒè¿™æ ·çš„é—®é¢˜ï¼Œä½†åº”ç”¨ç¨‹åºä¸èƒ½å®Œå…¨å¿½ç•¥è¿™äº›äº‹æƒ…ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ‰æ—¶ï¼Œé€šä¿¡ç³»ç»Ÿæä¾›çš„éå®Œæ•´çš„ç‰ˆæœ¬çš„åŠŸèƒ½ï¼Œå¯èƒ½å¯¹äºå¢å¼ºæ€§èƒ½å¾ˆæœ‰ç”¨ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ä¾‹å¦‚ï¼šåœ¨ Saltzer çš„è®ºæ–‡ä¸­ï¼Œä»–ä»¬ä½¿ç”¨ä»åº”ç”¨ç¨‹åº A ä¼ è¾“æ–‡ä»¶åˆ°åº”ç”¨ç¨‹åº B çš„ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/application-safety-and-correctness-cannot-be-offloaded-to-istio-or-any-service-mesh/006tNbRwgy1fuibtn8kvfj31fc0v2ju4.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦åšä»€ä¹ˆï¼ˆå®‰å…¨ï¼‰æ¥ä¿è¯æ–‡ä»¶è¢«æ­£ç¡®çš„ä¼ é€åˆ°ï¼Ÿåœ¨å›¾ä¸­çš„ä»»ä½•ä¸€ç‚¹éƒ½æœ‰èƒ½å‡ºç°é”™è¯¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å­˜å‚¨æœºåˆ¶å¯èƒ½æœ‰å¤±è´¥çš„åŒºåŸŸ/ç§»ä½çš„æ¯”ç‰¹/æŸåï¼Œæ‰€ä»¥å½“åº”ç”¨ç¨‹åº A è¯»å–ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œè¯»å–çš„æ˜¯ä¸€ä¸ªé”™è¯¯çš„æ–‡ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºåœ¨è¯»å–æ–‡ä»¶åˆ°å†…å­˜ä¸­æˆ–è€…å‘é€æ–‡ä»¶æ—¶å­˜åœ¨ bugï¼›&lt;/li&gt;
&lt;li&gt;ç½‘ç»œå¯èƒ½æ··æ·†å­—èŠ‚çš„é¡ºåºï¼Œæ–‡ä»¶éƒ¨åˆ†é‡å¤ç­‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥è¿›è¡Œä¼˜åŒ–ï¼Œä¾‹å¦‚ä½¿ç”¨æ›´å¯é çš„ä¼ è¾“ï¼Œå¦‚ TCP åè®®æˆ–æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½†æ˜¯ TCP ä¸çŸ¥é“â€œæ­£ç¡®ä¼ è¾“æ–‡ä»¶â€çš„è¯­æ„ï¼Œæ‰€ä»¥æˆ‘ä»¬æœŸæœ›çš„æœ€å¥½ç»“æœè‡³å°‘æ˜¯å½“æˆ‘ä»¬åœ¨ç½‘ç»œä¸Šå¤„ç†äº‹æƒ…æ—¶ï¼Œç½‘ç»œæ˜¯å¯é çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/application-safety-and-correctness-cannot-be-offloaded-to-istio-or-any-service-mesh/006tNbRwgy1fuiihqrv73j31es0eqjsf.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å®Œæ•´çš„å®ç°ç«¯åˆ°ç«¯çš„æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä½¿ç”¨ä¸€äº›ç±»ä¼¼æ–‡ä»¶æ ¡éªŒçš„ä¸œè¥¿ï¼Œä¸æ–‡ä»¶ä¸€èµ·åœ¨æ–‡ä»¶åˆå§‹åŒ–æ—¶å†™å…¥ï¼Œç„¶ååœ¨ B æ¥æ”¶æ–‡ä»¶æ—¶æ ¡éªŒå…¶æ ¡éªŒå’Œã€‚ç„¶è€Œï¼Œæˆ‘ä»¬åœ¨æ ¡éªŒä¼ è¾“çš„æ­£ç¡®æ€§ï¼ˆå®ç°ç»†èŠ‚ï¼‰ï¼Œå…¶èŒè´£åœ¨äºæ‰¾å‡ºè§£å†³æ–¹æ¡ˆå¹¶ä½¿å…¶æ­£ç¡®ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ TCP æˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…¸å‹çš„æ¨¡å¼æ˜¯ä»€ä¹ˆæ ·çš„&#34;&gt;å…¸å‹çš„æ¨¡å¼æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†è§£å†³åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸­åº”ç”¨ç¨‹åºçš„æ­£ç¡®æ€§å’Œå®‰å…¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›æ¨¡å¼ã€‚åœ¨æ—©äº›æ—¶å€™ï¼Œæˆ‘ä»¬æåˆ°äº† Istio æä¾›ç»™æˆ‘ä»¬çš„ä¸€äº›å¯é çš„æ¨¡å¼ï¼Œä½†è¿™äº›å¹¶ä¸æ˜¯å”¯ä¸€çš„ã€‚é€šå¸¸ï¼Œæœ‰ä¸¤ç±»æ¨¡å¼å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ­£ç¡®å’Œå®‰å…¨çš„æ„å»ºåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”è¿™ä¸¤ç±»æ¨¡å¼æ˜¯ç›¸å…³çš„ã€‚æˆ‘ä»¬ç§°è¿™ç±»ä½â€œåº”ç”¨ç¨‹åºé›†æˆâ€å’Œâ€œåº”ç”¨ç¨‹åºç½‘ç»œâ€ã€‚ä¸¤è€…éƒ½æ˜¯åº”ç”¨ç¨‹åºçš„è´£ä»»ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹ï¼š&lt;/p&gt;
&lt;h3 id=&#34;åº”ç”¨ç¨‹åºé›†æˆ&#34;&gt;åº”ç”¨ç¨‹åºé›†æˆ&lt;/h3&gt;
&lt;p&gt;è¿™äº›æ¨¡å¼ä»¥å¦‚ä¸‹è¿™æ ·çš„å½¢å¼å‡ºç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒç”¨æ’åºã€å¤šæ’­å’Œç¼–æ’ï¼ˆCall sequencing, multicasting, and orchestrationï¼‰&lt;/li&gt;
&lt;li&gt;èšåˆå“åº”ã€è½¬æ¢æ¶ˆæ¯è¯­ä¹‰ã€æ‹†åˆ†æ¶ˆæ¯ç­‰ï¼ˆAggregate responses, transforming message semantics, splitting messages, etcï¼‰&lt;/li&gt;
&lt;li&gt;åŸå­æ€§ã€ä¸€è‡´æ€§é—®é¢˜ã€saga æ¨¡å¼ï¼ˆAtomicity, consistency issues, saga patternï¼‰&lt;/li&gt;
&lt;li&gt;åè…è´¥å±‚ã€é€‚é…å™¨ã€è¾¹ç•Œè½¬æ¢ï¼ˆAnti-corruption layers, adapters, boundary transformationsï¼‰&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯é‡è¯•ã€æ’é‡/å¹‚ç­‰æ€§ï¼ˆMessage retries, de-duplication/idempotencyï¼‰&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯é‡æ–°æ’åºï¼ˆMessage re-orderingï¼‰&lt;/li&gt;
&lt;li&gt;ç¼“å­˜ï¼ˆCachingï¼‰&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯çº§è·¯ç”±ï¼ˆMessage-level routingï¼‰&lt;/li&gt;
&lt;li&gt;é‡è¯•ã€è¶…æ—¶ï¼ˆRetries, timeoutsï¼‰&lt;/li&gt;
&lt;li&gt;åç«¯/é—ç•™ç³»ç»Ÿé›†æˆï¼ˆBackend/legacy systems integrationï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œâ€åœ¨è´­ç‰©è½¦ä¸­æ·»åŠ ä¸€ä¸ªé¡¹ç›®â€œï¼Œæˆ‘ä»¬å¯ä»¥æ¥è¯´æ˜è¿™ä¸ªæ¦‚å¿µï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/application-safety-and-correctness-cannot-be-offloaded-to-istio-or-any-service-mesh/006tNbRwgy1fuikdn3j02j31ks0oa77e.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“ä¸€ä¸ªç”¨æˆ·åœ¨ç‚¹å‡»â€œåŠ å…¥è´­ç‰©è½¦â€åŠŸèƒ½æ—¶ï¼Œç”¨æˆ·æœŸæœ›çœ‹åˆ°çš„æ˜¯å•†å“å·²ç»åŠ å…¥åˆ°ä»–ä»¬çš„è´­ç‰©è½¦ä¸­ã€‚åœ¨ç³»ç»Ÿä¸­ï¼Œè¿™å¯èƒ½æ¶‰åŠåˆ°å¯¹æ¨èå¼•æ“çš„åè°ƒã€è°ƒç”¨é¡ºåºï¼ˆå˜¿ï¼Œæˆ‘ä»¬æŠŠå®ƒåŠ å…¥åˆ°è´­ç‰©è½¦ä¸­äº†ï¼Œæƒ³çŸ¥é“æ˜¯å¦è®¡ç®—æ¨èæŠ¥ä»·æ¥é…åˆå®ƒï¼‰ã€åº“å­˜æœåŠ¡å’Œå…¶ä»–æœåŠ¡ç­‰ï¼Œç„¶åå†è°ƒç”¨æœåŠ¡æ’å…¥è´­ç‰©è½¦ã€‚æˆ‘ä»¬éœ€è¦èƒ½å¤Ÿå°†æ¶ˆæ¯è½¬æ¢åˆ°ä¸åŒçš„åç«¯ï¼Œå¤„ç†å¤±è´¥ï¼ˆå¹¶å›æ»šæˆ‘ä»¬å‘èµ·çš„ä»»ä½•æ›´æ”¹ï¼‰ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªæœåŠ¡ä¸­æˆ‘ä»¬éƒ½éœ€è¦å¯ä»¥å¤„ç†é‡å¤ã€‚å¦‚æœç”±äºæŸç§åŸå› ï¼Œè°ƒç”¨å˜å¾—å¾ˆæ…¢ï¼Œä½†ç”¨æˆ·åˆå†æ¬¡ç‚¹å‡»äº†â€œåŠ å…¥è´­ç‰©è½¦â€æ—¶æ€ä¹ˆåŠå‘¢ï¼Ÿå¦‚æœç”¨æˆ·è¿™ä¹ˆåšäº†ï¼Œé‚£ä¹ˆå†å¤šå¯é çš„åŸºç¡€è®¾æ–½ä¹Ÿæ‹¯æ•‘ä¸äº†æˆ‘ä»¬ï¼›æˆ‘ä»¬éœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­æ£€æµ‹å’Œå®ç°é‡å¤æ£€æŸ¥/å¹‚ç­‰æœåŠ¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åº”ç”¨ç¨‹åºç½‘ç»œ&#34;&gt;åº”ç”¨ç¨‹åºç½‘ç»œ&lt;/h3&gt;
&lt;p&gt;è¿™äº›æ¨¡å¼ä»¥å¦‚ä¸‹è¿™æ ·çš„å½¢å¼å‡ºç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨é‡è¯•ï¼ˆautomatic retryï¼‰&lt;/li&gt;
&lt;li&gt;é‡è¯•æŒ‡æ ‡/é¢„ç®—ï¼ˆretry quota/budgetï¼‰&lt;/li&gt;
&lt;li&gt;è¿æ¥è¶…æ—¶ï¼ˆconnection timeoutï¼‰&lt;/li&gt;
&lt;li&gt;è¯·æ±‚è¶…æ—¶ï¼ˆrequest timeoutï¼‰&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼ˆclient-side load balancingï¼‰&lt;/li&gt;
&lt;li&gt;ç†”æ–­å™¨ï¼ˆcircuit breakingï¼‰&lt;/li&gt;
&lt;li&gt;éš”ç¦»å±‚ï¼ˆbulkheadingï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†åœ¨é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œè¿˜å­˜åœ¨å…¶ä»–å¤æ‚çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡‘ä¸é›€å±•ç¤ºï¼ˆCanary rolloutï¼‰&lt;/li&gt;
&lt;li&gt;æµé‡è·¯ç”±ï¼ˆTraffic routingï¼‰&lt;/li&gt;
&lt;li&gt;æŒ‡æ ‡é›†åˆï¼ˆMetrics collectionï¼‰&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼è·Ÿè¸ªï¼ˆDistributed tracingï¼‰&lt;/li&gt;
&lt;li&gt;å½±å­æµé‡ï¼ˆTraffic shadowingï¼‰&lt;/li&gt;
&lt;li&gt;æ•…éšœæ³¨å…¥ï¼ˆFault injectionï¼‰&lt;/li&gt;
&lt;li&gt;å¥åº·æ£€æŸ¥ï¼ˆHealth checkingï¼‰&lt;/li&gt;
&lt;li&gt;å®‰å…¨ï¼ˆSecurityï¼‰&lt;/li&gt;
&lt;li&gt;ç»„ç»‡ç­–ç•¥ï¼ˆOrganizational policyï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¦‚ä½•ä½¿ç”¨è¿™ä¹ˆæ¨¡å¼&#34;&gt;å¦‚ä½•ä½¿ç”¨è¿™ä¹ˆæ¨¡å¼ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;åœ¨è¿‡å»ï¼Œæˆ‘ä»¬è¯•å›¾å°†è¿™äº›é¢†åŸŸä¸­çš„èŒè´£æ··åˆåœ¨ä¸€èµ·ã€‚æˆ‘ä»¬ä¼šåšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½æ¨å…¥é›†ä¸­å¼åŸºç¡€è®¾æ–½ä¸­ï¼Œè¿™æ ·å®ƒåŸºæœ¬ä¸Šå°± 100% å¯ç”¨çš„ï¼ˆåº”ç”¨ç¨‹åºç½‘ç»œ + åº”ç”¨ç³»ç»Ÿé›†æˆï¼‰ã€‚æˆ‘ä»¬å°†åº”ç”¨ç¨‹åºçš„å…³æ³¨ç‚¹æ”¾åœ¨é›†ä¸­çš„åŸºç¡€è®¾æ–½ä¸­ï¼ˆå®ƒæœ¬åº”è¯¥ä½¿æˆ‘ä»¬æ›´åŠ æ•æ·ï¼‰ï¼Œä½†æ˜¯å½“éœ€è¦å¯¹åº”ç”¨ç¨‹åºåšå¿«é€Ÿçš„æ›´æ”¹æ—¶ï¼Œå´é‡åˆ°äº†ç“¶é¢ˆå’ŒåƒµåŒ–çš„é—®é¢˜ã€‚è¿™äº›åŠ¨æ€ä½“ç°åœ¨æˆ‘ä»¬å®ç°ä¼ä¸šæœåŠ¡æ€»çº¿ï¼ˆESBï¼‰çš„æ–¹å¼ä¸Šï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/application-safety-and-correctness-cannot-be-offloaded-to-istio-or-any-service-mesh/006tNbRwly1fuit5y2mn6j311g0x418y.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ–è€…ï¼Œæˆ‘è®¤ä¸ºå¤§å‹äº‘å‚å•†ï¼ˆNetflixã€Amazonã€Twitter ç­‰ï¼‰ä»¥åŠè®¤è¯†åˆ°äº†è¿™äº›æ¨¡å¼çš„â€œåº”ç”¨ç¨‹åºèŒè´£â€æ–¹é¢ï¼Œå¹¶å°†åº”ç”¨ç¨‹åºç½‘ç»œä»£ç æ··åˆåˆ°åº”ç”¨ç¨‹åºä¸­ã€‚æƒ³æƒ³åƒ Netflix OSSï¼Œæœ‰ç”¨äºæ–­è·¯å™¨ã€å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘ç°ç­‰ä¸åŒçš„åº“ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/application-safety-and-correctness-cannot-be-offloaded-to-istio-or-any-service-mesh/006tNbRwly1fuitn6o25ij30yy0x0408.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚ä½ æ‰€çŸ¥ï¼Œå›´ç»•åº”ç”¨ç¨‹åºç½‘ç»œçš„ Netflix OSS åº“éå¸¸å…³æ³¨ Javaã€‚å½“ç»„ç»‡å¼€å§‹é‡‡ç”¨ Netflix OSS ä»¥åŠç±»ä¼¼ spring-cloud-netflix è¿™æ ·çš„è¡ç”Ÿäº§å“æ—¶ï¼Œä»–ä»¬å°±ä¼šé‡åˆ°è¿™æ ·ä¸€ä¸ªäº‹å®ï¼šä¸€æ—¦å¼€å§‹æ·»åŠ å…¶ä»–è¯­è¨€æ—¶ï¼Œæ“ä½œè¿™æ ·çš„æ¶æ„å°±å˜çš„ä»¤äººæœ›è€Œå´æ­¥äº†ã€‚Netflix å·²ç»éå¸¸æˆç†Ÿäº†å¹¶ä¸”å®ç°äº†è‡ªåŠ¨åŒ–ï¼Œä½†å…¶ä»–å…¬å¸å¹¶ä¸æ˜¯ Netflixã€‚åœ¨å°è¯•æ“ä½œåº”ç”¨ç¨‹åºåº“å’Œæ¡†æ¶æ¥è§£å†³åº”ç”¨ç¨‹åºè”ç½‘é—®é¢˜æ˜¯é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ç§è¯­è¨€/æ¡†æ¶å¯¹äºè¿™äº›å…³æ³¨ç‚¹éƒ½æœ‰è‡ªå·±çš„å®ç°æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°ä¸ä¼šå®Œå…¨ç›¸åŒï¼Œå®ƒä»¬ä¼šå˜åŒ–ã€ä¸åŒï¼Œæœ‰æ—¶ä¼šæœ‰é”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ç®¡ç†ã€æ›´æ–°ä»¥åŠä¿®è¡¥è¿™äº›åº“ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;è¿™äº›åº“æ··æ·†äº†åº”ç”¨ç¨‹åºçš„é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹å¼€å‘äººå‘˜ç»™ä¸äº†æå¤§çš„ä¿¡ä»»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio å’ŒæœåŠ¡ç½‘æ ¼çš„æ€»ä½“ç›®æ ‡æ˜¯è§£å†³åº”ç”¨ç¨‹åºç½‘ç»œç±»é—®é¢˜ã€‚å°†è¿™äº›é—®é¢˜çš„è§£å†³æ–¹æ¡ˆè¿ç§»åˆ°æœåŠ¡ç½‘æ ¼ä¸­æ˜¯å¯æ“ä½œæ€§çš„ä¼˜åŒ–ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å®ƒä¸å†æ˜¯åº”ç”¨ç¨‹åºçš„è´£ä»»ï¼Œè€Œæ˜¯æ„å‘³ç€è¿™äº›åŠŸèƒ½çš„å®ç°å­˜åœ¨äºè¿›ç¨‹ä¹‹å¤–äº†ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å¯é…ç½®çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/application-safety-and-correctness-cannot-be-offloaded-to-istio-or-any-service-mesh/006tNbRwly1fuiuklgkjxj31060wyt9g.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ“ä½œæ¥ä¼˜åŒ–å¯æ“ä½œæ€§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿™äº›åŠŸèƒ½çš„å•ä¸€å®ç°éšå¤„å¯è§ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€è‡´çš„åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;æ­£ç¡®çš„åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºè¿ç»´äººå‘˜å’Œåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜éƒ½å¯ç¼–ç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istio å’ŒæœåŠ¡ç½‘æ ¼ä¸å…è®¸ä½ å°†è´£ä»»æ¨ç»™åŸºç¡€è®¾æ–½ï¼Œå®ƒä»¬åªæ˜¯å¢åŠ äº†ä¸€å®šç¨‹åº¦çš„å¯é æ€§å’Œå¯æ“ä½œæ€§çš„ä¼˜åŒ–ã€‚å°±åƒåœ¨ç«¯åˆ°ç«¯çš„å‚æ•°ä¸­ä¸€æ ·ï¼ŒTCP å…è®¸å¸è½½åº”ç”¨ç¨‹åºçš„è´£ä»»ã€‚&lt;/p&gt;
&lt;p&gt;Istio æœ‰åŠ©äºè§£å†³åº”ç”¨ç¨‹åºç½‘ç»œç±»é—®é¢˜ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºé›†æˆç±»é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¹¸è¿çš„æ˜¯ï¼Œå¯¹äºå¼€å‘äººå‘˜æ¥è¯´ï¼Œæœ‰å¤§é‡çš„æ¡†æ¶å¯ä»¥å¸®åŠ©ä»–ä»¬æ¥å®ç°åº”ç”¨ç¨‹åºçš„é›†æˆã€‚å¯¹äº Java å¼€å‘è€…æˆ‘æœ€å–œæ¬¢çš„ Apache Camelï¼Œå®ƒæä¾›äº†è®¸å¤šç¼–å†™æ­£ç¡®å’Œå®‰å…¨çš„åº”ç”¨ç¨‹åºæ‰€éœ€çš„ç»„ä»¶ï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.christianposta.com/microservices/application-safety-and-correctness-cannot-be-offloaded-to-istio-or-any-service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Call sequencing, multicasting, and orchestration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/apache/camel/blob/master/camel-core/src/main/docs/eips/aggregate-eip.adoc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Aggregate responses, transforming message semantics, splitting messages, etc&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/apache/camel/blob/master/camel-core/src/main/docs/eips/saga-eip.adoc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Atomicity, consistency issues, saga pattern&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;&#34;&gt;Anti-corruption layers, adapters, boundary transformations&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/apache/camel/blob/master/camel-core/src/main/docs/eips/idempotentConsumer-eip.adoc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Message retries, de-duplication/idempotency&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/apache/camel/blob/master/camel-core/src/main/docs/eips/resequence-eip.adoc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Message reordering&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Caching&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/apache/camel/blob/master/camel-core/src/main/docs/eips/content-based-router-eip.adoc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Message-level routing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Retries, timeouts&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/apache/camel/blob/master/components/readme.adoc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Backend/legacy systems integration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/application-safety-and-correctness-cannot-be-offloaded-to-istio-or-any-service-mesh/006tNbRwly1fuiv4suzo8j316m0xataq.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…¶ä»–æ¡†æ¶åŒ…æ‹¬ &lt;a href=&#34;https://spring.io/projects/spring-integration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Spring Integration&lt;/a&gt;ï¼Œç”šè‡³è¿˜æœ‰ WSO2 ä¸­ä¸€ä¸ªæœ‰è¶£çš„æ–°ç¼–ç¨‹è¯­è¨€ &lt;a href=&#34;https://ballerina.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ballerina&lt;/a&gt; ã€‚è¯·æ³¨æ„ï¼Œé‡ç”¨ç°æœ‰çš„æ¨¡å¼å’Œæ„é€ æ˜¯éå¸¸å¥½çš„ï¼Œç‰¹åˆ«æ˜¯å½“è¿™äº›æ¨¡å¼ç›¸å¯¹äºæ‚¨é€‰æ‹©çš„è¯­è¨€æ¥è¯´æˆç†Ÿæ—¶ï¼Œä½†æ˜¯è¿™äº›æ¨¡å¼éƒ½ä¸éœ€è¦æ‚¨ä½¿ç”¨æ¡†æ¶ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ™ºèƒ½ç«¯ç‚¹å’Œ-dumb-ç®¡é“&#34;&gt;æ™ºèƒ½ç«¯ç‚¹å’Œ dumb ç®¡é“&lt;/h1&gt;
&lt;p&gt;å…³äºå¾®æœåŠ¡ï¼Œæˆ‘æœ‰ä¸€ä¸ªæœ‹å‹æå‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œå…³äºå¾®æœåŠ¡çš„â€œæ™ºèƒ½ç«¯ç‚¹å’Œ dumb pipeâ€è¿™å¥è¯å¾ˆå¸å¼•äººï¼Œä½†å¾ˆç®€å•ï¼Œâ€œè®©åŸºç¡€è®¾æ–½æ™ºèƒ½åŒ–â€æ˜¯ä¸ªå‰æï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/application-safety-and-correctness-cannot-be-offloaded-to-istio-or-any-service-mesh/006tNbRwly1fuivligg5sj30g50cygmn.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç®¡é“ä»ç„¶æ˜¯ dumb çš„ï¼›æˆ‘ä»¬ä¸æ˜¯é€šè¿‡ä½¿ç”¨æœåŠ¡ç½‘æ ¼å°†åº”ç”¨ç¨‹åºçš„æ­£ç¡®æ€§å’Œå®‰å…¨æ€§çš„åº”ç”¨ç¨‹åºé€»è¾‘å¼ºåˆ¶åŠ å…¥åŸºç¡€è®¾æ–½ä¸­ã€‚æˆ‘ä»¬åªæ˜¯ä½¿å®ƒæ›´å¯é ï¼Œä¼˜åŒ–è¿ç»´æ–¹é¢ï¼Œå¹¶ç®€åŒ–åº”ç”¨ç¨‹åºå¿…é¡»å®ç°çš„å†…å®¹ï¼ˆä¸å¿…ä¸ºæ­¤è´Ÿè´£ï¼‰ã€‚å¦‚æœä½ ä¸è®¤åŒæˆ–è€…æœ‰å…¶ä»–æƒ³æ³•ï¼Œè¯·éšæ—¶åœ¨ Twitter ä¸Šç•™è¨€æˆ–è”ç³» &lt;a href=&#34;https://twitter.com/christianposta&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@christianposta&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äº Istio çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ &lt;a href=&#34;http://istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://istio.io&lt;/a&gt; æˆ–è€…&lt;a href=&#34;http://blog.christianposta.com/our-book-has-been-released-introducing-istio-service-mesh-for-microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘å†™çš„å…³äº Istio çš„ä¹¦&lt;/a&gt; ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>é‡‡çº³è¿è¡Œåœ¨ Kubernetes ä¸Šçš„ Istio æœåŠ¡ç½‘æ ¼çš„åˆ©å¼Šåˆ†æ</title>
      <link>https://cloudnativecn.com/blog/istio-service-mesh-tech-boosts-kubernetes-work-with-trade-offs/</link>
      <pubDate>Sun, 05 Aug 2018 15:47:05 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-service-mesh-tech-boosts-kubernetes-work-with-trade-offs/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://searchitoperations.techtarget.com/tip/Istio-service-mesh-tech-boosts-Kubernetes-work-with-trade-offs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;IT å›¢é˜Ÿèƒ½å¦åªä½¿ç”¨ä¸€ç§å·¥å…·ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿä¸“æ³¨äºç¼–å†™åº”ç”¨ç¨‹åºä»£ç ï¼Œä½¿ç®¡ç†å‘˜åªä¸“æ³¨äº IT èµ„æºçš„ç®¡ç†ï¼Ÿä½¿ç”¨ Istio å¯ä»¥å®ç°ï¼Œå°½ç®¡å¦‚æ­¤ï¼Œé‡‡çº³ Istio å‰ç¡®å®éœ€è¦ç ”ç©¶ä¸‹å®ƒçš„åˆ©å¼Šã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes æ˜¯ä¸€ä¸ªå¼€æºå®¹å™¨ç¼–æ’ç³»ç»Ÿï¼Œå®ƒæä¾›äº†ç®¡ç†å’Œæ‰©å±•å®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„å¼ºå¤§åŠŸèƒ½ï¼Œä½†æœ‰äº›äº‹æƒ…å®ƒä¸èƒ½å¾ˆå¥½åœ°å®Œæˆã€‚è€Œ Istio å¢åŠ äº†é¢å¤–çš„æ”¯æŒï¼Œå®ƒå¯ä»¥ç®¡ç†å¾®æœåŠ¡ä¹‹é—´çš„æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;Istio æœåŠ¡ç½‘æ ¼é¡¹ç›®æ˜¯å¹³å°æ— å…³çš„ï¼Œåä½œå’Œå¼€æºçš„ï¼Œç”± IBMã€Google å’Œ Lyftï¼ˆåŸºäºåº”ç”¨ç¨‹åºçš„ä¼ è¾“æœåŠ¡ï¼‰å¼€å‘ã€‚&lt;a href=&#34;https://searchmicroservices.techtarget.com/news/450419875/IBM-Google-Lyft-launch-Istio-open-source-microservices-platform&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®ƒä½¿ç”¨ä»£ç† sidercar æ¨¡å‹&lt;/a&gt;åœ¨äº‘å¹³å°ä¸Šè¿æ¥ã€ä¿æŠ¤ã€ç®¡ç†å’Œç›‘æ§å¾®æœåŠ¡ç½‘ç»œã€‚Istio æ˜ç¡®&lt;a href=&#34;https://searchitoperations.techtarget.com/feature/Service-mesh-architecture-radicalizes-container-networking&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®šä¹‰äº†åŸºç¡€æ¶æ„çš„ä½œç”¨&lt;/a&gt;ï¼Œä¸è¿è¡Œåœ¨å…¶ä¸Šçš„è½¯ä»¶åˆ†ç¦»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é›†æˆ-istio-çš„åˆ©å¼Š&#34;&gt;é›†æˆ Istio çš„åˆ©å¼Š&lt;/h2&gt;
&lt;p&gt;ç¼–æ’å·¥å…· &lt;a href=&#34;https://searchitoperations.techtarget.com/definition/Google-Kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes&lt;/a&gt; ä¸ Istio çš„æ•´åˆï¼Œå¯ä»¥è®©å¼€å‘äººå‘˜å’Œ IT ç®¡ç†å‘˜åœ¨åº”ç”¨ç¨‹åºå®¹å™¨åŒ–è¿™ä¸€å…±åŒç›®æ ‡ä¸Šä¸€èµ·åŠªåŠ›ï¼ŒIT ç®¡ç†è½¯ä»¶æä¾›å•† SolarWinds çš„é¦–å¸­è½¯ä»¶æ¶æ„å¸ˆ Karlo Zatylny è¡¨ç¤ºï¼šâ€œè½¯ä»¶å¼€å‘äººå‘˜å°†æ³¨æ„åŠ›é›†ä¸­åœ¨ç¼–å†™èƒ½å¤Ÿåˆ›é€ æœ€å¤§å•†ä¸šä»·å€¼çš„ä»£ç ä¸Šâ€ã€‚ä»–ä»¬ä¸éœ€è¦è€ƒè™‘&lt;a href=&#34;https://searchitoperations.techtarget.com/ehandbook/How-container-deployment-changes-the-capacity-management-equation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éƒ¨ç½²å› ç´ &lt;/a&gt;ï¼Œä¾‹å¦‚æ”¯æŒå®¹å™¨çš„ VM å’Œç‰©ç†ç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;Zatylny è¯´ï¼šé€šè¿‡ Istioï¼ŒIT ç®¡ç†å‘˜å¯ä»¥ä¸“æ³¨äºè®¡ç®—èµ„æºå’Œç½‘ç»œèµ„æºï¼Œè€Œä¸æ˜¯å¤„ç†ç‰¹å®šçš„ç¡¬ä»¶å’Œè™šæ‹Ÿåˆ†é…ã€‚éƒ¨ç½²çš„åŸºäºå¾®æœåŠ¡çš„åº”ç”¨ç¨‹åºåœ¨æ¶ˆè€—å¯ç”¨èµ„æºæ–¹é¢å˜å¾—æ›´æœ‰æ•ˆç‡ï¼Œè€Œä¸æ˜¯åœ¨è¿‡åº¦ä½¿ç”¨æœªå……åˆ†åˆ©ç”¨åŸºç¡€æ¶æ„çš„æŸäº›éƒ¨åˆ†ã€‚Istio è¿˜ä½¿ç”¨é…ç½®é©±åŠ¨çš„é€šä¿¡æ¶æ„ï¼Œè¿™æé«˜é€Ÿåº¦ç¼©çŸ­äº†å¼€å‘å‘¨æœŸï¼Œå› æ­¤å¼€å‘äººå‘˜å¯ä»¥åœ¨ä¸šåŠ¡éœ€æ±‚å˜åŒ–æ—¶è½»æ¾åœ°å¯¹è½¯ä»¶é‡æ„ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡ä»£ç å¤ç”¨å’Œå…¶ä»–è®¾è®¡éƒ½æå¤§çš„é™ä½äº†å¤æ‚åº¦ï¼Œä½† Istio æœåŠ¡ç½‘æ ¼è®¾è®¡å¸¦æ¥äº†å¤æ‚æ€§å’Œé¢å¤–çš„ç®¡ç†å¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;Istio åœ¨ä¸Šè¡Œå’Œä¸‹æ¸¸æä¾›è´Ÿè½½å‡è¡¡ã€é‰´æƒã€å¯è§æ€§å’Œè¿è¡ŒçŠ¶å†µæ£€æŸ¥ï¼Œä½¿ç®¡ç†å‘˜èƒ½å¤ŸæŸ¥æ‰¾ã€è¿æ¥å’Œè·¯ç”±å„ä¸ªéƒ¨ç½²éƒ¨åˆ†ã€‚IDC åˆ†æå¸ˆ Brad Casemore è¡¨ç¤ºï¼Œå®ƒå°†ç½‘ç»œåº”ç”¨äº&lt;a href=&#34;https://searchnetworking.techtarget.com/definition/OSI&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼€æ”¾ç³»ç»Ÿäº’è¿æ¨¡å‹ï¼ˆOSIï¼‰&lt;/a&gt;ç¬¬ 7 å±‚çš„å¾®æœåŠ¡äº¤ä»˜ç¯å¢ƒï¼Œè€Œä¸æ˜¯ IP çš„ç¬¬ 3 å±‚æˆ–ç¬¬ 2 å±‚çš„ä»¥å¤ªç½‘ã€‚&lt;/p&gt;
&lt;p&gt;Red Hat äº§å“ç®¡ç†é«˜çº§ä¸»ç®¡ Rich Sharples è¯´ï¼Œåœ¨ Istio æœåŠ¡ç½‘æ ¼ä¸­æ§åˆ¶å’Œæ•°æ®å¹³é¢ä¹‹é—´çš„åˆ†å‰²æ¦‚å¿µå¯èƒ½ä¼šä½¿ç”¨æˆ·æ„Ÿåˆ°å›°æƒ‘ï¼Œä½†å®é™…ä¸Šç›¸å½“ç®€å•ã€‚æ•°æ®å¹³é¢ä½¿ç”¨ç®€å•çš„ä»£ç†æ¶æ„æ¥è°ƒè§£æœåŠ¡ç½‘æ ¼ä¸­æ¯ä¸ªæœåŠ¡çš„æ‰€æœ‰å…¥ç«™å’Œå‡ºç«™æµé‡ã€‚æ§åˆ¶å¹³é¢å¤„ç†æœåŠ¡æ³¨å†Œå’Œå‘ç°ã€è®¤è¯ã€è®¿é—®æ§åˆ¶ã€è¯ä¹¦ç®¡ç†ï¼ˆå³ç­¾åã€å‘å¸ƒå’Œæ’¤é”€ï¼‰å’ŒæœåŠ¡ç½‘æ ¼é…ç½®ï¼Œä»¥åŠæ¥è‡ªæœåŠ¡å’ŒæœåŠ¡ä»£ç†çš„é¥æµ‹æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;æœåŠ¡ç½‘ç»œå¯åœ¨ &lt;a href=&#34;https://searchmicroservices.techtarget.com/definition/application-program-interface-API&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;API&lt;/a&gt; åé¢å®ç°å®‰å…¨ã€å¯é çš„æœåŠ¡å™¨åˆ°æœåŠ¡å™¨é€šä¿¡ã€‚â€œå½“ä½ æ„å»ºå¾®æœåŠ¡æ—¶ï¼Œä½ é€šå¸¸ä¼šå…¬å¼€ä¸€ä¸ª APIï¼Œå®ƒä¼šå…¬å¼€åŠŸèƒ½ï¼Œç„¶åé€šè¿‡ä¸€ç³»åˆ—æœåŠ¡æ¥å®ç°â€ï¼ŒGartner åˆ†æå¸ˆ Anne Thomas è¡¨ç¤ºã€‚å› ä¸ºå®¹å™¨æ˜¯çŸ­æš‚çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¸ä¼šä¿ç•™ä¼šè¯ä¿¡æ¯ï¼Œç®¡ç†å‘˜å¿…é¡»å®šæœŸé‡æ–°è¿æ¥å®ƒä»¬ï¼Œå¹¶ä¸”å®ƒä»¬éœ€è¦å®‰å…¨æˆæƒåŠŸèƒ½ï¼Œä»¥ç¡®ä¿éƒ¨ç½²çš„æœåŠ¡å™¨åˆ°æœåŠ¡å™¨é€šä¿¡å—åˆ°ä¿æŠ¤å’Œè¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;Istio çš„æœåŠ¡ç½‘æ ¼å®šä½æœåŠ¡ï¼Œç¡®ä¿é€šä¿¡çš„å¥å£®æ€§ï¼Œå¹¶åœ¨è¿æ¥å¤±è´¥æ—¶æ‰§è¡Œé‡è¯•æˆ–æ‰¾åˆ°å¿…è¦æœåŠ¡çš„å¦ä¸€ä¸ªå®ä¾‹å¹¶å»ºç«‹è¿æ¥ã€‚Thomas è¯´ï¼šæœåŠ¡ç½‘æ ¼è¿˜å¯ä»¥å®ç°éš”æ¿å’Œæ–­è·¯å™¨ã€‚éš”æ¿éš”ç¦»åº”ç”¨ç¨‹åºçš„å„ä¸ªéƒ¨åˆ†ï¼Œä»¥ç¡®ä¿ä»»ä½•ç»™å®šçš„æœåŠ¡æ•…éšœä¸ä¼šå½±å“ä»»ä½•å…¶ä»–æœåŠ¡ã€‚æ–­è·¯å™¨æ˜¯ä¸€ç§ç›‘æ§ç»„ä»¶ï¼Œå…·æœ‰ç”¨äº&lt;a href=&#34;https://medium.com/microservices-in-practice/microservices-in-practice-7a3e85b6624c&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤–éƒ¨å¾®æœåŠ¡é€šä¿¡&lt;/a&gt;çš„ç¼–ç¨‹æ•…éšœé˜ˆå€¼ï¼›æ–­è·¯å™¨æ€æ­»æ•…éšœæœåŠ¡ä»¥è°ƒèŠ‚èµ„æºæ¶ˆè€—å¹¶è¯·æ±‚å“åº”æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://searchsdn.techtarget.com/definition/east-west-traffic&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸œè¥¿å‘é€šä¿¡èƒ½åŠ›&lt;/a&gt;æ˜¯å¾®æœåŠ¡çš„å¦ä¸€ä¸ªå…³é”®éœ€æ±‚ã€‚å°†å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡çš„ API ç½‘å…³æ˜¯å—åŒ—å‘é€šä¿¡; è¿™é€šå¸¸æ˜¯è¶³å¤Ÿçš„ï¼Œä½†æ˜¯ä¸ºäº†å®ç°å…¶èƒŒåå…·æœ‰é™„åŠ æœåŠ¡çš„å¾®æœåŠ¡ï¼ŒæœåŠ¡ç½‘ç»œåˆ›å»ºä¸œè¥¿å‘é€šä¿¡ï¼Œå³ IT ç¯å¢ƒå†…çš„é€šä¿¡ã€‚Istio æ˜¯ä¸ºè¿™ç§é€šä¿¡é€”å¾„è€Œæ„å»ºçš„ã€‚&lt;/p&gt;
&lt;p&gt;Istio æœ‰ä¸€äº›ç¼ºç‚¹ï¼Œå› ä¸ºå®ƒæä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„å¤šè¯­è¨€è¿è¡Œæ—¶æœåŠ¡ç½‘æ ¼ï¼Œå¯ä»¥åœ¨ç»™å®šçš„äº‘å¹³å°ä¸Šè¿è¡Œï¼Œä½†ä¸€å¦‚æ—¢å¾€ï¼Œæˆ‘ä»¬éœ€è¦æƒè¡¡åˆ©å¼Šã€‚è™½ç„¶ Istio ä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿåœ¨ä¸æ¨¡ç³Šåº”ç”¨é€»è¾‘çš„æƒ…å†µä¸‹ç”Ÿæˆæ™ºèƒ½å¾®æœåŠ¡è®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µï¼Œä½†è¯¥åŠŸèƒ½å…·æœ‰æ€§èƒ½å’Œå»¶è¿Ÿå½±å“ï¼ŒSharples è¯´ã€‚Sharples è¡¨ç¤ºï¼ŒIstio çš„ä»£ç† sidecar æ¨¡å‹ï¼ˆç”¨äºè°ƒè§£æµé‡çš„å¼€æº Envoy è¾¹ç¼˜ä»£ç†ï¼‰â€”â€”å¼•å…¥äº†é¢å¤–çš„ç½‘ç»œè°ƒç”¨ï¼Œå¯èƒ½ä¼šä¸ºé«˜æ€§èƒ½å®æ—¶åº”ç”¨äº§ç”Ÿ&lt;a href=&#34;https://searchmicroservices.techtarget.com/tip/Microservices-challenges-include-latency-but-it-can-be-beat&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸å¯æ¥å—çš„å»¶è¿Ÿ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¦‚ä½•é‡‡ç”¨-istio-æœåŠ¡ç½‘æ ¼&#34;&gt;å¦‚ä½•é‡‡ç”¨ Istio æœåŠ¡ç½‘æ ¼&lt;/h2&gt;
&lt;p&gt;Istio åœ¨æµ‹è¯•ç‰ˆä¸­ï¼Œåœ¨å‘å¸ƒæ—¶æ²¡æœ‰æä¾›å•†ä¸šæ”¯æŒã€‚Casemore è¯´ï¼Œå¯¹äºå¤§å¤šæ•°ç»„ç»‡æ¥è¯´ï¼Œè¿™ä»…æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„ POC é¡¹ç›®ï¼Œè€Œä¸”æ˜¯é‚£äº›å…·æœ‰å†’é™©ç²¾ç¥çš„äººå°†å®ƒè¿è¡Œåœ¨éå…³é”®ä¸šåŠ¡åº”ç”¨ç¨‹åºæ—¶ã€‚&lt;/p&gt;
&lt;p&gt;IDC çš„åˆ†æå¸ˆ Gary Chen è¯´ï¼šâ€œè¿™é¡¹æŠ€æœ¯é€‚ç”¨äºé‚£äº›å¤„äºæŠ€æœ¯å‰æ²¿çš„å›¢é˜Ÿï¼Œä½†æ˜¯ä»–ä»¬å¿…é¡»éå¸¸è‡ªä¿¡æ‰ä¼šé‡‡çº³è¯¥æŠ€æœ¯â€ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Circonus Istio Mixer é€‚é…å™¨</title>
      <link>https://cloudnativecn.com/blog/the-circonus-istio-mixer-adapter/</link>
      <pubDate>Tue, 17 Jul 2018 20:12:18 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/the-circonus-istio-mixer-adapter/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡è‹±æ–‡åŸæ–‡æœ€åˆå‘è¡¨æ—¶é—´ï¼š2017 å¹´ 12 æœˆ 6 æ—¥&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Circonus å‚ä¸å¼€æºè½¯ä»¶æœ‰ç€æ‚ ä¹…çš„ä¼ ç»Ÿã€‚å› æ­¤ï¼Œå½“çœ‹åˆ° Istio æä¾›äº†ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„æ¥å£ï¼Œé€šè¿‡é€‚é…å™¨è¿æ¥ syndicate æœåŠ¡é¥æµ‹ï¼Œæˆ‘ä»¬å°±çŸ¥é“ Circonus é€‚é…å™¨å¯ä»¥ä¸ Istio å¾ˆå¥½çš„è¡”æ¥ã€‚Istio å·²ç»è¢«è®¾è®¡æˆæä¾›é«˜æ€§èƒ½ã€é«˜å¯æ‰©å±•çš„åº”ç”¨æ§åˆ¶å¹³é¢ï¼Œå¹¶ä¸” Circonus ä¹Ÿæ˜¯æŒ‰ç…§é«˜æ€§èƒ½å’Œå¯æ‰©å±•æ€§çš„æ ¸å¿ƒåŸåˆ™è®¾è®¡çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¤©æˆ‘ä»¬å¾ˆé«˜å…´çš„å®£å¸ƒ &lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æœåŠ¡ç½‘æ ¼&lt;/a&gt; çš„ Circonus é€‚é…å™¨çš„å¯ç”¨æ€§ã€‚è¿™ç¯‡åšå®¢æ–‡ç« å°†ä»‹ç»è¿™ä¸ªé€‚é…å™¨çš„å¼€å‘ï¼Œå¹¶å‘æ‚¨å±•ç¤ºå¦‚ä½•å¿«é€Ÿå¯åŠ¨å¹¶è¿è¡Œå®ƒã€‚æˆ‘ä»¬çŸ¥é“ä½ ä¼šå¯¹æ­¤éå¸¸æ„Ÿå…´è¶£ï¼Œå› ä¸º Kubernetes å’Œ Istio å¯ä»¥æä¾›æ‰©å±• Circonus çš„èƒ½åŠ›ä½¿å…¶è¿œå¼ºäºå…¶ä»–é¥æµ‹è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ ä¸çŸ¥é“ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼é‚£ä¹Ÿæ²¡å…³ç³»ï¼Œå…¶å®ä½ å·²ç»ç”¨äº†å¾ˆå¤šå¹´äº†ã€‚äº’è”ç½‘çš„è·¯ç”±åŸºç¡€è®¾æ–½å°±æ˜¯ä¸€ä¸ªæœåŠ¡ç½‘æ ¼ï¼›å®ƒæœ‰åˆ©äº TCP é‡ä¼ ã€è®¿é—®æ§åˆ¶ã€åŠ¨æ€è·¯ç”±ã€æµé‡è§„åˆ’ç­‰ã€‚ä»¥å¾€å ä¸»å¯¼åœ°ä½çš„å•ä½“ web åº”ç”¨æ­£åœ¨ä¸ºå¾®æœåŠ¡è®©è·¯ã€‚Istio é€šè¿‡ä¸€ä¸ª  &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sidecar proxy&lt;/a&gt; æä¾›åŸºäºå®¹å™¨çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„æ§åˆ¶å¹³é¢åŠŸèƒ½ã€‚å®ƒä¸ºæœåŠ¡çš„æ“ä½œäººå‘˜æä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½æ¥æ§åˆ¶ &lt;a href=&#34;https://kubernetes.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes&lt;/a&gt; ç¼–æ’çš„æœåŠ¡é›†åˆï¼Œè€Œä¸éœ€è¦æœåŠ¡æœ¬èº«æ¥å®ç°ä»»ä½•æ§åˆ¶å¹³é¢çš„åŠŸèƒ½é›†åˆã€‚&lt;/p&gt;
&lt;p&gt;Istio &lt;a href=&#34;https://istio.io/docs/concepts/policies-and-telemetry/overview/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mixer&lt;/a&gt; æä¾›äº†ä¸€ä¸ª &lt;a href=&#34;https://istio.io/blog/2017/adapter-model/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€‚é…å™¨&lt;/a&gt; æ¨¡å‹ï¼Œå®ƒå…è®¸æˆ‘ä»¬é€šè¿‡ä¸º Mixer åˆ›å»ºç”¨äºå¤–éƒ¨åŸºç¡€è®¾æ–½åç«¯æ¥å£çš„ &lt;a href=&#34;https://istio.io/docs/concepts/policies-and-telemetry/config/#handlers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤„ç†å™¨&lt;/a&gt; æ¥å¼€å‘é€‚é…å™¨ã€‚Mixer è¿˜æä¾›äº†ä¸€ç»„æ¨¡ç‰ˆï¼Œæ¯ä¸ªæ¨¡æ¿éƒ½ä¸ºé€‚é…å™¨æä¾›äº†ä¸åŒçš„å…ƒæ•°æ®é›†ã€‚åœ¨ä¾‹å¦‚ Circonus é€‚é…å™¨ä¹‹ç±»çš„åº¦é‡é€‚é…å™¨ï¼Œè¯¥å…ƒæ•°æ®é›†åŒ…æ‹¬è¯¸å¦‚&lt;code&gt;è¯·æ±‚æŒç»­æ—¶é—´ï¼ˆrequest durationï¼‰&lt;/code&gt;ã€&lt;code&gt;è¯·æ±‚è®¡æ•°ï¼ˆrequest countï¼‰&lt;/code&gt;ã€&lt;code&gt;è¯·æ±‚æœ‰æ•ˆè´Ÿè½½å¤§å°ï¼ˆrequest payload sizeï¼‰&lt;/code&gt;ç­‰åº¦é‡ã€‚è¦æ¿€æ´» Istio å¯ç”¨çš„ Kubernetes é›†ç¾¤ä¸­çš„ Circonus é€‚é…å™¨ï¼Œåªéœ€è¦ä½¿ç”¨ istioctl å‘½ä»¤å°† Circonus  operator é…ç½® æ³¨å…¥åˆ° k8s é›†ç¾¤ä¸­ï¼Œmetrics å°†å¼€å§‹æµåŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…³äº Mixer å¦‚ä½•ä¸è¿™äº›å¤–éƒ¨åç«¯æœåŠ¡äº¤äº’çš„æ¶æ„å›¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/the-circonus-istio-mixer-adapter/006tNc79gy1ft2kovaczfj319u0zftc9_hu_d3e90f290cfec462.webp 400w,
               /blog/the-circonus-istio-mixer-adapter/006tNc79gy1ft2kovaczfj319u0zftc9_hu_ba1bfbee20e2cfc9.webp 760w,
               /blog/the-circonus-istio-mixer-adapter/006tNc79gy1ft2kovaczfj319u0zftc9_hu_63bd586628c0a9cb.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/the-circonus-istio-mixer-adapter/006tNc79gy1ft2kovaczfj319u0zftc9_hu_d3e90f290cfec462.webp&#34;
               width=&#34;760&#34;
               height=&#34;587&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio è¿˜åŒ…å«äº† StatsD å’Œ Prometheus çš„ metrics é€‚é…å™¨ã€‚ç„¶è€Œï¼ŒCirconus é€‚é…å™¨ä¸å…¶ä»–é€‚é…å™¨åˆå­˜åœ¨ä¸€äº›åŒºåˆ«ã€‚é¦–å…ˆï¼ŒCirconus é€‚é…å™¨å…è®¸æˆ‘ä»¬å°†è¯·æ±‚æŒç»­æ—¶é—´ä½œä¸ºä¸€ä¸ªç›´æ–¹å›¾æ¥æ”¶é›†ï¼Œè€Œä¸ä»…ä»…æ˜¯è®°å½•å›ºå®šçš„ç™¾åˆ†ä½æ•°ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿè®¡ç®—ä»»ä½•æ—¶é—´çª—ä¸Šçš„ä»»æ„åˆ†ä½æ•°ï¼Œå¹¶å¯¹æ‰€æ”¶é›†çš„ç›´æ–¹å›¾è¿›è¡Œç»Ÿè®¡åˆ†æã€‚ç¬¬äºŒï¼Œæ•°æ®å¯ä»¥åŸºæœ¬ä¸Šæ°¸ä¹…ä¿ç•™ã€‚ç¬¬ä¸‰ï¼Œtelemetry æ•°æ®è¢«ä¿å­˜åœ¨æŒä¹…çš„ç¯å¢ƒä¸­ï¼Œè€Œç‹¬ç«‹äº Kubernetes ç®¡ç†çš„ä»»ä½•çŸ­æš‚èµ„æºä¹‹å¤–ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œæ•°æ®æ˜¯å¦‚ä½•ä» Istio åˆ° Circonus ä¸­çš„ã€‚Istio çš„é€‚é…å™¨æ¡†æ¶æš´éœ²äº†å¾ˆå¤šå¯ä»¥ç»™é€‚é…å™¨å¼€å‘è€…ä½¿ç”¨çš„æ–¹æ³•ã€‚Istio å¤„ç†çš„æ¯ä¸ªè¯·æ±‚éƒ½ç”Ÿæˆäº†ä¸€ç»„åº¦é‡å®ä¾‹ç”¨æ¥è°ƒç”¨ &lt;code&gt;HandleMetric()&lt;/code&gt; æ–¹æ³•ã€‚åœ¨æˆ‘ä»¬çš„ operator é…ç½®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šæˆ‘ä»¬è¦é‡‡ç”¨çš„ metricï¼Œä»¥åŠå®ƒä»¬çš„ç±»å‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# HTTPTrap url, replace this with your account submission url&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;submission_url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https://trap.noit.circonus.net/module/httptrap/myuuid/mysecret&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;submission_interval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;10s&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metrics&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;requestcount.metric.istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;COUNTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;requestduration.metric.istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DISTRIBUTION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;requestsize.metric.istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;GAUGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;responsesize.metric.istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;GAUGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é…ç½®äº†ä¸€ä¸ªæœä» &lt;a href=&#34;https://login.circonus.com/resources/docs/user/Data/CheckTypes/HTTPTrap.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTPTrap&lt;/a&gt; æ£€æŸ¥çš„ URL åŒæ—¶é—´æ–­å‘é€ metric çš„ Circonus å¤„ç†ç¨‹åºã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šäº†å››ä¸ª metric çš„é›†åˆï¼Œä»¥åŠå®ƒä»¬çš„ç±»å‹ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æŠŠ&lt;code&gt;è¯·æ±‚æŒç»­æ—¶é—´&lt;/code&gt;ä½œä¸ºä¸€ä¸ª &lt;code&gt;DISTRIBUTION&lt;/code&gt; ç±»å‹æ¥æ”¶é›†ï¼Œå°†ä½œä¸º Circonus ä¸­çš„ç›´æ–¹å›¾è¿›è¡Œå¤„ç†ã€‚è¿™å°†ä¿æŒæ—¶é—´çš„ä¿çœŸåº¦ï¼Œè€Œä¸æ˜¯å¯¹è¯¥ metric åšå¹³å‡ï¼Œæˆ–è€…åœ¨è®°å½•ä¹‹å‰è®¡ç®—ç™¾åˆ†ä½æ•°ï¼ˆè¿™ä¸¤ç§æŠ€æœ¯éƒ½å¤±å»äº†ä¿¡å·çš„åŸå§‹å€¼ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹æ¯ä¸ªè¯·æ±‚ï¼Œå¯¹æ¯ä¸ªæŒ‡å®šçš„åº¦é‡è¯·æ±‚è°ƒç”¨ &lt;code&gt;HandleMetric()&lt;/code&gt; æ–¹æ³•ã€‚çœ‹å¦‚ä¸‹ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// HandleMetric submits metrics to Circonus via circonus-gometrics&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;HandleMetric&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;insts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metric&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Instance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inst&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;insts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;metricName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;metricType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metrics&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metricName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metricType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GAUGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Gauge&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metricName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;COUNTER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Increment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metricName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DISTRIBUTION&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Timing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metricName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;float64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ä¸€ä¸ª Mixer çš„ä¸Šä¸‹æ–‡ä»¥åŠä¸€ç»„ metric å®ä¾‹æ¥è°ƒç”¨ &lt;code&gt;HandleMetric()&lt;/code&gt; æ–¹æ³•ï¼Œæˆ‘ä»¬éå†æ¯ä¸ªå®ä¾‹ï¼Œç¡®å®šå®ƒçš„ç±»å‹ï¼Œå¹¶è°ƒç”¨é€‚å½“çš„ &lt;code&gt;circonus-gometrics&lt;/code&gt; æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ¡†æ¶ä¸­ï¼Œmetric å¤„ç†å™¨åŒ…å«ä¸€ä¸ª &lt;code&gt;circonus-gometrics&lt;/code&gt; å¯¹è±¡ï¼Œå¹¶æäº¤å®é™…çš„åº¦é‡å€¼æ¥å®ç°ã€‚è®¾ç½®å¤„ç†å™¨è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œä½†å¹¶ä¸æ˜¯æœ€å¤æ‚çš„äº‹æƒ…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Build constructs a circonus-gometrics instance and sets up the handler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;builder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Build&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;adapter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;adapter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;bridge&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;logToEnvLogger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;cmc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cgm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;CheckManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;checkmgr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;Check&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;checkmgr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CheckConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;SubmissionURL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;adpCfg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SubmissionUrl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bridge&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Debug&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// enable [DEBUG] level logging for env.Logger&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Interval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;0s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// flush via ScheduleDaemon based ticker&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;cm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cgm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewCirconusMetrics&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cmc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Logger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Could not create NewCirconusMetrics: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// create a context with cancel based on the istio context&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;adapterContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;adapterCancel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithCancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ScheduleDaemon&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;ticker&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewTicker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;adpCfg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SubmissionInterval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ticker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nx&#34;&gt;cm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;adapterContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nx&#34;&gt;ticker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Stop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;nx&#34;&gt;cm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;metrics&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Params_MetricInfo_Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ac&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;adpCfg&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;adpMetric&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ac&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Metrics&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;metrics&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;adpMetricName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;adpmetric&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metrics&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metrics&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;adapterCancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Mixer æä¾›äº†ä¸€ä¸ªç”Ÿæˆå™¨ç±»å‹ï¼Œæˆ‘ä»¬å®šä¹‰äº†æ„å»ºæ–¹æ³•ã€‚å†æ¬¡ï¼ŒMixer çš„ä¸Šä¸‹æ–‡è¢«ä¼ é€’ï¼Œä»¥åŠè¡¨ç¤º Mixer é…ç½®çš„ç¯å¢ƒå˜é‡ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ &lt;code&gt;circonus-gometrics&lt;/code&gt; å¯¹è±¡ï¼Œå¹¶æ•…æ„ç¦ç”¨äº†è‡ªåŠ¨ metrics åˆ·æ–°ã€‚æˆ‘ä»¬è¿™æ ·åšæ˜¯å› ä¸º Mixer è¦æ±‚æˆ‘ä»¬åœ¨ä½¿ç”¨ &lt;code&gt;env.ScheduleDaemon()&lt;/code&gt; æ–¹æ³•æ—¶åœ¨ panic å¤„ç†å™¨ä¸­åŒ…è£…æ‰€æœ‰çš„ goroutinesã€‚ä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬é€šè¿‡ &lt;code&gt;context.WithCancel&lt;/code&gt; åˆ›å»ºäº†è‡ªå·±çš„ &lt;code&gt;adapterContext&lt;/code&gt; ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥é€šè¿‡ Mixer æä¾›çš„ &lt;code&gt;Close()&lt;/code&gt; æ–¹æ³•ä¸­è°ƒç”¨ &lt;code&gt;h.cancel()&lt;/code&gt; æ¥å…³é—­ metrics åˆ·æ–° goroutineã€‚æˆ‘ä»¬è¿˜å¸Œæœ›å°†ä»»ä½•æ—¥å¿—äº‹ä»¶ä» &lt;code&gt;CGM (circonus-gometrics)&lt;/code&gt; å‘é€åˆ° Mixer çš„æ—¥å¿—ä¸­ã€‚Mixer æä¾›äº†ä¸€ä¸ªåŸºäº glog çš„  &lt;code&gt;env.Logger()&lt;/code&gt; æ¥å£ï¼Œä½† CGM ä½¿ç”¨çš„æ˜¯æ ‡å‡†çš„ Golang æ—¥å¿—ã€‚å¦‚ä½•è§£å†³è¿™ç§ä¸åŒ¹é…çš„é—®é¢˜ï¼Ÿé€šè¿‡ä¸€ä¸ª logger bridgeï¼Œä»»ä½• CGM ç”Ÿæˆçš„æ—¥å¿—è®°å½•è¯­å¥éƒ½å¯ä»¥ä¼ é€’ç»™ Mixerã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// logToEnvLogger converts CGM log package writes to env.Logger()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;logToEnvLogger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HasPrefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;[ERROR]&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Logger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HasPrefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;[WARN]&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Logger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warningf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HasPrefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;[DEBUG]&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Logger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Logger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¨é€‚é…å™¨çš„ä»£ç ï¼Œå¯ä»¥æŸ¥çœ‹ &lt;a href=&#34;https://github.com/istio/istio/tree/master/mixer/adapter/circonus&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio github åº“&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡å¦‚æ­¤ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚æˆ‘å®‰è£…äº† Google Kubernetes Engineï¼Œä½¿ç”¨ Circonus åŠ è½½äº† Istio çš„å¼€å‘ç‰ˆæœ¬ï¼Œå¹¶éƒ¨ç½²äº†äº Istio ä¸€èµ·æä¾›çš„ BookInfo ç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚ä¸‹å›¾æ˜¯ä»è¯·æ±‚åˆ°åº”ç”¨ç¨‹åºçš„è¯·æ±‚æŒç»­æ—¶é—´åˆ†å¸ƒçš„çƒ­å›¾ã€‚ä½ ä¼šæ³¨æ„åˆ°é«˜äº®æ˜¾ç¤ºçš„æ—¶é—´ç‰‡æ®µçš„ç›´æ–¹å›¾è¦†ç›–ã€‚æˆ‘æ·»åŠ äº†ä¸€ä¸ªè¦†ç›–ï¼Œæ·»åŠ äº†ä¸€ä¸ªä¸­ä½æ•°ã€ç¬¬ä¹åå’Œç™¾åˆ†ä½çš„å“åº”æ—¶é—´ï¼›åœ¨ä»»æ„çš„åˆ†ä½æ•°å’Œæ—¶é—´çª—ä¸Šç”Ÿæˆè¿™äº›æ•°æ®æ˜¯æœ‰å¯èƒ½çš„ï¼Œå› ä¸ºæˆ‘ä»¬å°†åŸå§‹çš„æ•°æ®å­˜å‚¨ä¸ºå¯¹æ•°çº¿æ€§ç›´æ–¹å›¾ã€‚æ³¨æ„ï¼Œä¸­ä½æ•°å’Œç¬¬ä¹åç™¾åˆ†ä½æ•°æ˜¯ç›¸å¯¹å›ºå®šçš„ï¼Œè€Œç¬¬ä¹åäº”ç™¾åˆ†ä½æ•°å€¾å‘äºåœ¨å‡ ç™¾æ¯«ç§’çš„èŒƒå›´å†…æ³¢åŠ¨ã€‚è¿™ç§ç±»å‹çš„æ·±åº¦å¯è§‚å¯Ÿæ€§å¯ä»¥ç”¨æ¥é‡åŒ– Istio æœ¬èº«åœ¨ç‰ˆæœ¬ä¸Šçš„è¡¨ç°ï¼Œå› ä¸º Istio çš„å¼€å‘æ­£åœ¨å¿«é€Ÿè¿­ä»£ã€‚æˆ–è€…ï¼Œæ›´å¯èƒ½çš„æ˜¯ï¼Œå®ƒå°†ç”¨æ¥æ ‡è¯†éƒ¨ç½²çš„åº”ç”¨ç¨‹åºä¸­çš„é—®é¢˜ã€‚å¦‚æœä½ çš„ç™¾åˆ†ä½æ•°ä¸ç¬¦åˆä½ çš„å†…éƒ¨æœåŠ¡æ°´å¹³ç›®æ ‡ (SLO) ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ ‡è¯†ï¼Œè¯´æ˜ä½ æœ‰äº‹æƒ…éœ€è¦åšäº†ã€‚æ¯•ç«Ÿï¼Œå¦‚æœæœ‰ 20 ä¸ªç”¨æˆ·ä¸­æœ‰ä¸€ä¸ªåœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸Šæœ‰ä½äºæ ‡å‡†çš„ä½“éªŒï¼Œéš¾é“ä½ ä¸æƒ³çŸ¥é“å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/the-circonus-istio-mixer-adapter/006tKfTcly1ft40ca0k7qj30vp0igq6c_hu_b4ea3744ba4679b8.webp 400w,
               /blog/the-circonus-istio-mixer-adapter/006tKfTcly1ft40ca0k7qj30vp0igq6c_hu_bf76e1ad9c44606.webp 760w,
               /blog/the-circonus-istio-mixer-adapter/006tKfTcly1ft40ca0k7qj30vp0igq6c_hu_f6dd2ac083d1cf10.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/the-circonus-istio-mixer-adapter/006tKfTcly1ft40ca0k7qj30vp0igq6c_hu_b4ea3744ba4679b8.webp&#34;
               width=&#34;760&#34;
               height=&#34;442&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™çœ‹èµ·æ¥å¾ˆæœ‰è¶£ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æ¥å®‰æ’å¦‚ä½•è®©è¿™äº›ä¸œè¥¿è¿è¡Œèµ·æ¥ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ª Kubernetes é›†ç¾¤ã€‚&lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/quickstart&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Kubernetes Engine&lt;/a&gt; æä¾›äº†ä¸€ç§å¿«é€Ÿè·å–é›†ç¾¤çš„ç®€å•æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ ä¸æƒ³ä½¿ç”¨ GKEï¼Œé‚£ä¹ˆ Istio æ–‡æ¡£ä¸­è®°å½•äº†ä¸€äº›å…¶ä»–çš„æ–¹å¼ï¼Œè¿™äº›æ˜¯æˆ‘ç”¨æ¥å¯åŠ¨å’Œè¿è¡Œçš„æ³¨é‡Šã€‚åœ¨æ˜¯ç”¨ web UI çš„æ–¹å¼éƒ¨ç½²äº†é›†ç¾¤ä¹‹åï¼Œæˆ‘ä½¿ç”¨ &lt;em&gt;gcloud&lt;/em&gt; å‘½ä»¤è¡Œè¿è¡Œç¨‹åºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# set your zones and region&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ gcloud config &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; compute/zone us-west1-a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ gcloud config &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; compute/region us-west1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# create the cluster&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ gcloud alpha container cluster create istio-testing --num-nodes&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# get the credentials and put them in kubeconfig&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ gcloud container clusters get-credentials istio-testing --zone us-west1-a --project istio-circonus
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# grant cluster admin permissions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl create clusterrolebinding cluster-admin-binding --clusterrole&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;cluster-admin --user&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;gcloud config get-value core/account&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶ï¼Œä½ æœ‰äº†ä¸€ä¸ª Kubernetes é›†ç¾¤ï¼Œè®©æˆ‘ä»¬æ¥æŒ‰ç…§ &lt;a href=&#34;https://istio.io/docs/setup/kubernetes/quick-start.html#installation-steps&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£&lt;/a&gt; å®‰è£… Istio&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# grab Istio and setup your PATH&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl -L https://git.io/getLatestIstio &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sh -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; istio-0.2.12
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;PATH&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$PWD&lt;/span&gt;/bin:&lt;span class=&#34;nv&#34;&gt;$PATH&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# now install Istio&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f install/kubernetes/istio.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# wait for the services to come up&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get svc -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶ï¼Œå¯ä»¥å®‰è£… BookInfo ç¤ºä¾‹ç¨‹åº&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Assuming you are using manual sidecar injection, use `kube-inject`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f &amp;lt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;istioctl kube-inject -f samples/bookinfo/kube/bookinfo.yaml&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# wait for the services to come up&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get services
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœä½ åœ¨ä½¿ç”¨ GKEï¼Œä½ è¿˜éœ€è¦é…ç½®ç½‘ç®¡å’Œé˜²ç«å¢™è§„åˆ™&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# get the worker address&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get ingress -o wide
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# get the gateway url&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;GATEWAY_URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;lt;workerNodeAddress&amp;gt;:&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get svc istio-ingress -n istio-system -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.spec.ports[0].nodePort}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# add the firewall rule&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ gcloud compute firewall-rules create allow-book --allow tcp:&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get svc istio-ingress -n istio-system -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.spec.ports[0].nodePort}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# hit the url - for some reason GATEWAY_URL is on an ephemeral port, use port 80 instead&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ wget http://&amp;lt;workerNodeAddress&amp;gt;/&amp;lt;productpage&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹ç¨‹åºåº”è¯¥å¯åŠ¨å¹¶è¿è¡Œèµ·æ¥äº†ã€‚å¦‚æœä½ åœ¨ä½¿ç”¨ Istio 0.3 æˆ–ä½äºæ­¤ç‰ˆæœ¬çš„ç¨‹åºï¼Œä½ éœ€è¦å®‰è£…æˆ‘ä»¬æ„å»ºå¥½å¹¶åµŒå…¥äº† Circonus é€‚é…å™¨çš„é•œåƒã€‚&lt;/p&gt;
&lt;p&gt;åŠ è½½ Circonus çš„èµ„æºå®šä¹‰ï¼ˆåœ¨ Istio 0.3 æˆ– ä½äºæ­¤ç‰ˆæœ¬ä¸Šæ‰§è¡Œæ­¤æ“ä½œï¼‰ã€‚å°†æ­¤å†…å®¹ä¿å­˜ä¸º &lt;code&gt;circonus_crd.yaml&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CustomResourceDefinition&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apiextensions.k8s.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;circonuses.config.istio.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;package&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;circonus&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mixer-adapter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;config.istio.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;circonus&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;plural&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;circonuses&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;singular&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;circonus&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Namespaced&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1alpha2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å¼€å§‹åº”ç”¨æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f circonus_crd.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¼–è¾‘ Istio éƒ¨ç½² ä»¥åŠ è½½å·²ç»æ„å»ºå¥½çš„ Circonus é€‚é…å™¨ Docker é•œåƒï¼ˆåŒæ ·ï¼Œå¦‚æœä½ ä½¿ç”¨ Istio v0.4 æˆ–æ›´é«˜çš„ç‰ˆæœ¬ï¼Œåˆ™ä¸éœ€è¦æ‰§è¡Œæ­¤æ“ä½œï¼‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n istio-system edit deployment istio-mixer
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¿®æ”¹æ··åˆå™¨çš„äºŒè¿›åˆ¶&lt;code&gt;é•œåƒ&lt;/code&gt;ï¼Œæ¥ä½¿ç”¨ istio-circonus çš„é•œåƒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;image: gcr.io/istio-circonus/mixer_debug&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;imagePullPolicy: IfNotPresent&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;name: mixer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¥½çš„ï¼Œåˆ°ç°åœ¨ã€‚æŠ“å–ä¸€ä¸ª &lt;a href=&#34;https://istio.io/docs/setup/kubernetes/quick-start/#installation-steps&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;operator é…ç½®&lt;/a&gt; çš„å‰¯æœ¬ï¼Œå¹¶å°†ä½ çš„ HTTPTrap submission URL æ’å…¥å…¶ä¸­ã€‚ä½ éœ€è¦ä¸€ä¸ª  &lt;a href=&#34;https://login.circonus.com/signup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Circonus è´¦æˆ·&lt;/a&gt; æ¥è·å–å®ƒï¼Œå¦‚æœä½ æ²¡æœ‰ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå…è´¹çš„è´¦æˆ·ï¼ŒåŒæ—¶æ·»åŠ ä¸€ä¸ª &lt;a href=&#34;https://login.circonus.com/resources/docs/user/Data/CheckTypes/HTTPTrap.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTPTrap æ£€æµ‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨å¯ä»¥åº”ç”¨ä½ çš„ operator é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl create  -f circonus_config.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‘åº”ç”¨å‘é€äº›è¯·æ±‚ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°æµå‘ä½ çš„ Circonus ä»ªè¡¨ç›˜çš„ metricsï¼å¦‚æœä½ é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶åœ¨ &lt;a href=&#34;http://slack.s.circonus.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Circonus labs slack&lt;/a&gt; ä¸Šè”ç³»æˆ‘ä»¬ï¼Œæˆ–è€…ç›´æ¥åœ¨ Twitter ä¸Š @phredmoyerã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é›†æˆï¼ŒIstio ç»å¯¹æ˜¯ Kubernetes çš„å‰æ²¿ï¼Œä½†å€¼å¾—æ³¨æ„çš„æ˜¯åœ¨å‡ ä¸ªæœˆå‰å®ƒå·²ç»æˆç†Ÿäº†ï¼Œåº”è¯¥å¯ä»¥è€ƒè™‘ç”¨æ¥éƒ¨ç½²æ–°çš„å¾®æœåŠ¡ã€‚æˆ‘è¦æ„Ÿè°¢ä¸€äº›å¸®åŠ©è¿‡çš„äººã€‚ &lt;a href=&#34;https://github.com/maier&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Matt Maier&lt;/a&gt; æ˜¯ &lt;a href=&#34;https://github.com/circonus-labs/circonus-gometrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Circonus gometrics&lt;/a&gt; çš„ç»´æŠ¤è€…ï¼Œåœ¨æ•´åˆ Istio å¤„ç†å™¨æ¡†æ¶å’Œ CGM æä¾›äº†å®è´µçš„ä»·å€¼ã€‚&lt;a href=&#34;https://twitter.com/zackbutcher&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Zack Butcher&lt;/a&gt; å’Œ &lt;a href=&#34;https://twitter.com/jdouglasreid&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Douglas Reid&lt;/a&gt; éƒ½æ˜¯ Istio é¡¹ç›®ä¸Šçš„ hackersï¼Œå‡ ä¸ªæœˆå‰æˆ‘åœ¨ä¸€ä¸ªçº¿ä¸‹çš„ meetup ä¸Šä¸ä»–ä»¬è°ˆè®ºåˆ°äº† Istioï¼Œä»–ä»¬å‘å‡ºäº†ä»¤äººé¼“èˆçš„â€œsend the PRs!â€™ ã€‚&lt;a href=&#34;https://github.com/geeknoid&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Martin Taillefer&lt;/a&gt; åœ¨ Circonus é€‚é…å™¨å¼€å‘çš„æœ€åé˜¶æ®µç»™äºˆäº†å¾ˆå¥½çš„åé¦ˆå’Œå»ºè®®ã€‚&lt;a href=&#34;https://twitter.com/rshriram&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Shriram Rajagopalan&lt;/a&gt; åœ¨æœ€åé˜¶æ®µä½¿ç”¨ CircleCI å¸®åŠ©å®Œæˆäº†æµ‹è¯•å·¥ä½œã€‚æœ€åï¼Œæ„Ÿè°¢ Circonus å›¢é˜ŸèµåŠ©è¿™é¡¹å·¥ä½œï¼Œä»¥åŠ  Istio ç¤¾åŒºçš„å¼€æ”¾æ–‡åŒ–ï¼Œä½¿è¿™é¡¹åˆ›æ–°æˆä¸ºå¯èƒ½ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Istio æ§åˆ¶ Serverless æ¶æ„ Fn Project ä¸­çš„å‡½æ•°é—´æµé‡è·¯ç”±</title>
      <link>https://cloudnativecn.com/blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/</link>
      <pubDate>Wed, 04 Jul 2018 17:44:01 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://hackernoon.com/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd56607913b8&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è§£é‡Šå¦‚ä½•åœ¨ &lt;a href=&#34;https://fnproject.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fn å‡½æ•°&lt;/a&gt;ä¹‹é—´ä½¿ç”¨ &lt;a href=&#34;http://istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt; æœåŠ¡ç½‘æ ¼å®ç°åŸºäºç‰ˆæœ¬çš„æµé‡è·¯ç”±ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å°†é¦–å…ˆè§£é‡Š &lt;a href=&#34;http://istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt; è·¯ç”±çš„åŸºç¡€çŸ¥è¯†ä»¥åŠå°† Fn éƒ¨ç½²å’Œè¿è¡Œåœ¨ Kubernetes ä¸Šçš„æ–¹å¼ã€‚æœ€åï¼Œæˆ‘å°†è§£é‡Šæˆ‘æ˜¯å¦‚ä½•åˆ©ç”¨ Istio æœåŠ¡ç½‘æ ¼åŠå…¶è·¯ç”±è§„åˆ™åœ¨ä¸¤ä¸ªä¸åŒçš„ Fn å‡½æ•°ä¹‹é—´è·¯ç”±æµé‡çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œæ¥ä¸‹æ¥çš„è§£é‡Šéå¸¸åŸºæœ¬å’Œç®€å•â€”â€”æˆ‘çš„ç›®çš„ä¸æ˜¯è§£é‡Š Istio æˆ– Fn çš„æ·±å…¥ç»†èŠ‚ï¼Œè€Œæ˜¯è§£é‡Šå¾—è¶³å¤Ÿæ¸…æ¥šï¼Œè®©æ‚¨å¯ä»¥äº†è§£å¦‚ä½•ä½¿è‡ªå·±çš„è·¯ç”±å·¥ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;istio-è·¯ç”±å…¥é—¨&#34;&gt;Istio è·¯ç”±å…¥é—¨&lt;/h3&gt;
&lt;p&gt;è®©æˆ‘èŠ±äº†ä¸€ç‚¹æ—¶é—´æ¥è§£é‡Š &lt;a href=&#34;http://istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt; è·¯ç”±å¦‚ä½•å·¥ä½œã€‚Istio ä½¿ç”¨ sidecar å®¹å™¨ï¼ˆ &lt;code&gt;istio-proxy&lt;/code&gt; ï¼‰æ³¨å…¥åˆ°æ‚¨éƒ¨ç½²çš„åº”ç”¨ä¸­ã€‚æ³¨å…¥çš„ä»£ç†ä¼šåŠ«æŒæ‰€æœ‰è¿›å‡ºè¯¥ pod çš„ç½‘ç»œæµé‡ã€‚éƒ¨ç½²ä¸­æ‰€æœ‰è¿™äº›ä»£ç†çš„é›†åˆä¸ Istio ç³»ç»Ÿçš„å…¶ä»–éƒ¨åˆ†è¿›è¡Œé€šä¿¡ï¼Œä»¥ç¡®å®šå¦‚ä½•ä»¥åŠåœ¨ä½•å¤„&lt;a href=&#34;https://istio.io/docs/tasks/traffic-management/request-routing/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯ç”±æµé‡&lt;/a&gt;ï¼ˆä»¥åŠå…¶ä»–ä¸€äº›å¾ˆé…·çš„äº‹æƒ…ï¼Œå¦‚&lt;a href=&#34;https://istio.io/docs/tasks/traffic-management/mirroring/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æµé‡é•œåƒ&lt;/a&gt;ã€&lt;a href=&#34;https://istio.io/docs/tasks/traffic-management/fault-injection/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ•…éšœæ³¨å…¥&lt;/a&gt;å’Œ&lt;a href=&#34;https://istio.io/docs/tasks/traffic-management/circuit-breaking/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–­è·¯ç”±&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£é‡Šè¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæˆ‘ä»¬å°†å¼€å§‹è¿è¡Œä¸€ä¸ª Kubernetes æœåŠ¡ï¼ˆ&lt;code&gt;myapp&lt;/code&gt;ï¼‰å’Œä¸¤ä¸ªç‰¹å®šç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºéƒ¨ç½²ï¼ˆ&lt;code&gt;v1&lt;/code&gt;å’Œ&lt;code&gt;v2&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyerrbpzj20sa09c74h_hu_5a24f1bfa57f5635.webp 400w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyerrbpzj20sa09c74h_hu_c22fa8d9c107094.webp 760w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyerrbpzj20sa09c74h_hu_264bcf818b7d0ccc.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyerrbpzj20sa09c74h_hu_5a24f1bfa57f5635.webp&#34;
               width=&#34;760&#34;
               height=&#34;251&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬æœ‰ &lt;code&gt;myapp&lt;/code&gt; ä¸€ä¸ªé€‰æ‹©å™¨è®¾ç½®ä¸º Kubernetes çš„æœåŠ¡ &lt;code&gt;app=myapp&lt;/code&gt;â€Šï¼Œè¿™æ„å‘³ç€å®ƒå°†æŸ¥æ‰¾å…·æœ‰ &lt;code&gt;app=myapp&lt;/code&gt; æ ‡ç­¾é›†çš„æ‰€æœ‰ Podï¼Œå¹¶å°†æµé‡å‘é€ç»™å®ƒä»¬ã€‚åŸºæœ¬ä¸Šï¼Œå¦‚æœæ‚¨æ‰§è¡Œæ­¤æ“ä½œï¼Œ&lt;code&gt;curl myapp-service&lt;/code&gt; æ‚¨å°†ä»è¿è¡Œ v1 ç‰ˆæœ¬åº”ç”¨ç¨‹åºçš„ pod æˆ–è¿è¡Œ v2 ç‰ˆæœ¬çš„ pod è·å¾—å“åº”ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜æœ‰ä¸¤ä¸ª Kubernetes éƒ¨ç½²ï¼Œè¿™äº›éƒ¨ç½²&lt;code&gt;myapp&lt;/code&gt;è¿è¡Œäº† v1 å’Œ v2 ä»£ç ã€‚é™¤ &lt;code&gt;app=myapp&lt;/code&gt; æ ‡ç­¾å¤–ï¼Œæ¯ä¸ª pod è¿˜å°†&lt;code&gt;version&lt;/code&gt;æ ‡ç­¾è®¾ç½®ä¸º &lt;code&gt;v1&lt;/code&gt;æˆ– &lt;code&gt;v2&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯å¯ä»¥ä» Kubernetes ä¸­å¼€ç®±å³ç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿›å…¥ Istio ç¯èŠ‚ã€‚ä¸ºäº†èƒ½å¤Ÿåšåˆ°æ›´æ™ºèƒ½åŒ–å’ŒåŸºäºæƒé‡çš„è·¯ç”±ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… &lt;a href=&#34;http://istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;ï¼Œç„¶åå°†ä»£ç†æ³¨å…¥åˆ°æˆ‘ä»¬çš„æ¯ä¸ª&lt;a href=&#34;http://istio.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®¹å™¨ä¸­&lt;/a&gt;ï¼Œå¦‚ä¸‹é¢çš„å¦ä¸€ä¸ªå›¾ç‰‡æ‰€ç¤ºã€‚ä¸‹å›¾ä¸­çš„æ¯ä¸ª pod éƒ½æœ‰ä¸€ä¸ªå¸¦æœ‰ Istio ä»£ç†çš„å®¹å™¨ï¼ˆç”¨è“è‰²å›¾æ ‡è¡¨ç¤ºï¼‰å’Œè¿è¡Œåº”ç”¨çš„å®¹å™¨ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªå®¹å™¨åœ¨æ¯ä¸ª pod ä¸­è¿è¡Œâ€”â€”åº”ç”¨ç¨‹åºå®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyg6hkmsj20sa09cglu_hu_959511a05052ab55.webp 400w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyg6hkmsj20sa09cglu_hu_fffea6f33810d0a4.webp 760w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyg6hkmsj20sa09cglu_hu_edd7421d2fe2340.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyg6hkmsj20sa09cglu_hu_959511a05052ab55.webp&#34;
               width=&#34;760&#34;
               height=&#34;251&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼ŒIstio æ¯”å›¾ä¸­æ˜¾ç¤ºçš„è¦å¤šå¾—å¤šã€‚æˆ‘æ²¡æœ‰å±•ç¤ºåœ¨ Kubernetes é›†ç¾¤ä¸Šéƒ¨ç½²çš„å…¶ä»– Istio Pod å’ŒæœåŠ¡â€”â€”æ³¨å…¥çš„ Istio ä»£ç†ä¸è¿™äº› Pod å’ŒæœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œä»¥ä¾¿çŸ¥é“å¦‚ä½•æ­£ç¡®è·¯ç”±æµé‡ã€‚æœ‰å…³ Istio ä¸åŒéƒ¨åˆ†çš„æ·±å…¥è§£é‡Šï¼Œè¯·å‚é˜…&lt;a href=&#34;https://istio.io/docs/concepts/traffic-management/overview/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt;çš„æ–‡æ¡£ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬ç°åœ¨å¯ä»¥è°ƒæ•´&lt;code&gt;myapp&lt;/code&gt;æœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»ç„¶ä¼šå¾—åˆ°ä¸ç¬¬ä¸€ä¸ªå›¾ä¸­çš„è®¾ç½®å®Œå…¨ç›¸åŒçš„ç»“æœï¼šæ¥è‡ª&lt;code&gt;v1&lt;/code&gt;å’Œ&lt;code&gt;v2&lt;/code&gt; pod çš„éšæœºå“åº”ã€‚å”¯ä¸€çš„åŒºåˆ«åœ¨äºç½‘ç»œæµé‡ä»æœåŠ¡æµå‘ Pod çš„æ–¹å¼ã€‚åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œå¯¹æœåŠ¡çš„ä»»ä½•è°ƒç”¨éƒ½åœ¨ Istio ä»£ç†ä¸­ç»“æŸï¼Œç„¶åä»£ç†æ ¹æ®å®šä¹‰çš„è·¯ç”±è§„åˆ™å†³å®šå°†æµé‡è·¯ç”±åˆ°å“ªé‡Œã€‚&lt;/p&gt;
&lt;p&gt;å°±åƒ Kubernetes ä¸€æ ·ï¼ŒIstio è·¯ç”±è§„åˆ™ä¹Ÿæ˜¯ä½¿ç”¨ YAML å®šä¹‰çš„ï¼Œå®ƒä»¬çœ‹èµ·æ¥åƒè¿™æ ·ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyh7i2qnj20o60hcta2_hu_f6481c04cd1859fe.webp 400w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyh7i2qnj20o60hcta2_hu_3dbb9972332061de.webp 760w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyh7i2qnj20o60hcta2_hu_f6e279efd0ff2f3c.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyh7i2qnj20o60hcta2_hu_f6481c04cd1859fe.webp&#34;
               width=&#34;760&#34;
               height=&#34;545&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šè¿°è·¯ç”±è§„åˆ™æ¥æ”¶è¯·æ±‚&lt;code&gt;myapp-service&lt;/code&gt;å¹¶å°†å…¶é‡æ–°è·¯ç”±åˆ°æ ‡è®°ä¸º Pod çš„è¯·æ±‚&lt;code&gt;version=v1&lt;/code&gt;Â ã€‚è¿™å°±æ˜¯å…·æœ‰ä¸Šè¿°è·¯ç”±è§„åˆ™çš„å›¾è¡¨çš„æ ·å­ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyhoj9ngj20sa0gkaai_hu_595dbaca4404ee39.webp 400w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyhoj9ngj20sa0gkaai_hu_a151fc23869944ef.webp 760w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyhoj9ngj20sa0gkaai_hu_73e1bab8d2951a9d.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyhoj9ngj20sa0gkaai_hu_595dbaca4404ee39.webp&#34;
               width=&#34;760&#34;
               height=&#34;445&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åº•éƒ¨çš„ Istio å¤§å›¾æ ‡ä»£è¡¨ Istio éƒ¨ç½²/æœåŠ¡ï¼Œå…¶ä¸­åŒ…æ‹¬æ­£åœ¨è¯»å–çš„è·¯ç”±è§„åˆ™ã€‚è¿™äº›è§„åˆ™ç„¶åç”¨äºé‡æ–°é…ç½®åœ¨æ¯ä¸ª pod å†…è¿è¡Œçš„ Istio ä»£ç† sidecarã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†è¿™ä¸ªè§„åˆ™ï¼Œå¦‚æœæˆ‘ä»¬ curl æœåŠ¡ï¼Œæˆ‘ä»¬åªèƒ½ä»æ ‡æœ‰æ ‡ç­¾ä¸º &lt;code&gt;version=v1&lt;/code&gt;ï¼ˆå›¾ä¸­çš„è“è‰²è¿æ¥å™¨æè¿°ï¼‰çš„ pod è·å–å“åº”ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†è·¯ç”±å¦‚ä½•å·¥ä½œï¼Œæˆ‘ä»¬å¯ä»¥ç ”ç©¶ &lt;a href=&#34;http://fnproject.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fn&lt;/a&gt; ï¼Œéƒ¨ç½²å®ƒå¹¶æŸ¥çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠæˆ‘ä»¬æ˜¯å¦å¯ä»¥ä½¿ç”¨ Istio ä»¥æŸç§æ–¹å¼è®¾ç½®è·¯ç”±ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åœ¨-kubernetes-ä¸Šçš„-fn-å‡½æ•°&#34;&gt;åœ¨ Kubernetes ä¸Šçš„ Fn å‡½æ•°&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä» Kubernetes ä¸Šçš„ä¸€äº› &lt;a href=&#34;http://fnproject.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fn&lt;/a&gt; ç‰‡æ®µçš„åŸºæœ¬å›¾è¡¨å¼€å§‹ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ &lt;a href=&#34;http://github.com/fnproject/fn-helm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm chart&lt;/a&gt; å°† Fn éƒ¨ç½²åœ¨æ‚¨çš„ Kubernetes é›†ç¾¤ä¹‹ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyhzsbtfj20ca09jq33_hu_3ceab0ce1e5bd29a.webp 400w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyhzsbtfj20ca09jq33_hu_8173c1687828c634.webp 760w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyhzsbtfj20ca09jq33_hu_fca3ce131e00cb3d.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyhzsbtfj20ca09jq33_hu_3ceab0ce1e5bd29a.webp&#34;
               width=&#34;442&#34;
               height=&#34;343&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾è¡¨é¡¶éƒ¨çš„ Fn API æœåŠ¡æ˜¯ Fn çš„å…¥å£ç‚¹ï¼Œå®ƒç”¨äºç®¡ç†æ‚¨çš„ Functionï¼ˆåˆ›å»ºï¼Œéƒ¨ç½²ï¼Œè¿è¡Œç­‰ï¼‰â€”â€”è¿™æ˜¯&lt;code&gt;FN_API_URL&lt;/code&gt;åœ¨ Fn é¡¹ç›®ä¸­å¼•ç”¨çš„ URLã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æœåŠ¡åè¿‡æ¥å°†è°ƒç”¨è·¯ç”±åˆ° Fn è´Ÿè½½å‡è¡¡å™¨ï¼ˆå³æ ‡è®°ä¸º  &lt;code&gt;role=fn-lb&lt;/code&gt; çš„ä»»ä½• Podï¼‰ã€‚ç„¶åï¼Œè´Ÿè½½å‡è¡¡å™¨ä¼šå‘æŒ¥ç¥å¥‡çš„ä½œç”¨ï¼Œå¹¶å°†è°ƒç”¨è·¯ç”±åˆ°&lt;code&gt;fn-service&lt;/code&gt; pod çš„å®ä¾‹ã€‚è¿™ä½œä¸º Kubernetes DaemonSet çš„ä¸€éƒ¨åˆ†éƒ¨ç½²ï¼Œå¹¶ä¸”é€šå¸¸æ¯ä¸ª Kubernetes èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªè¯¥ pod çš„å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†è¿™äº›ç®€å•çš„åŸºç¡€çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬åˆ›å»ºå¹¶éƒ¨ç½²ä¸€äº› Functionï¼Œå¹¶è€ƒè™‘å¦‚ä½•è¿›è¡Œæµé‡è·¯ç”±ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ›å»ºå’Œéƒ¨ç½²å‡½æ•°&#34;&gt;åˆ›å»ºå’Œéƒ¨ç½²å‡½æ•°&lt;/h3&gt;
&lt;p&gt;å¦‚æœæ‚¨æƒ³éµå¾ªä¸‹é¢çš„æ•™ç¨‹ï¼Œè¯·ç¡®ä¿å·²å°† &lt;a href=&#34;https://hackernoon.com/part-ii-fn-load-balancer-585babd90456&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fn éƒ¨ç½²åˆ°æ‚¨çš„ Kubernetes ç¾¤é›†&lt;/a&gt;ï¼ˆæˆ‘æ­£åœ¨ä½¿ç”¨ Docker for Macï¼‰å¹¶å®‰è£… &lt;a href=&#34;https://github.com/fnproject/cli&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fn CLI&lt;/a&gt; å¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»ºåº”ç”¨ç¨‹åºå’Œä¸€äº›åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# åˆ›å»ºappæ–‡ä»¶å¤¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir hello-app &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; hello-app
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;name: hello-app&amp;#34;&lt;/span&gt; &amp;gt; app.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Create a V1 function&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fn init --name v1 --runtime go
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; ..
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Create a V2 function&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fn init --name v2 --runtime go
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; ..
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ï¼Œæ‚¨å·²åˆ›å»ºåº”ç”¨ç¨‹åºçš„æ ¹ç›®å½•ï¼Œåä¸º&lt;code&gt;hello-app&lt;/code&gt;ã€‚åœ¨è¿™ä¸ªç›®å½•ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªç›®å½•ï¼Œæ¯ä¸ªç›®å½•ä¸‹éƒ½æœ‰ä¸€ä¸ª Functionï¼š&lt;strong&gt;v1&lt;/strong&gt;å’Œä¸€ä¸ª**v2ã€‚**Boilerplate Go Function ä½¿ç”¨&lt;code&gt;fn init&lt;/code&gt; æŒ‡å®šä½¿ç”¨ Go ä½œä¸ºè¿è¡Œæ—¶ã€‚è¿™æ˜¯ç›®å½•çš„ç»“æ„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ app.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ Gopkg.toml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ func.go
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â”œâ”€â”€ func.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚   â””â”€â”€ test.json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    â”œâ”€â”€ Gopkg.toml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    â”œâ”€â”€ func.go
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    â”œâ”€â”€ func.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    â””â”€â”€ test.json
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰“å¼€è¿™&lt;code&gt;func.go&lt;/code&gt;ä¸¤ä¸ªç›®å½•å¹¶æ›´æ–°è¿”å›çš„æ¶ˆæ¯ä»¥åŒ…å«ç‰ˆæœ¬å·â€”â€”æˆ‘ä»¬è¿™æ ·åšçš„åŸå› æ˜¯å¯ä»¥å¿«é€ŸåŒºåˆ†å“ªä¸ª Function è¢«è°ƒç”¨ã€‚ä»¥ä¸‹æ˜¯ v1 çš„&lt;code&gt;func.go&lt;/code&gt;çš„æ ·å­ï¼ˆ&lt;code&gt;Hello V1&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyii51b6j215u0fedhe_hu_1f254c59167fd7b4.webp 400w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyii51b6j215u0fedhe_hu_1e6fe65a7a3eeb3.webp 760w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyii51b6j215u0fedhe_hu_35992e194fbef2ed.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyii51b6j215u0fedhe_hu_1f254c59167fd7b4.webp&#34;
               width=&#34;760&#34;
               height=&#34;280&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ›´æ”¹å®Œæˆåå°±å¯ä»¥å°†è¿™äº›åŠŸèƒ½éƒ¨ç½²åˆ°åœ¨ Kubernetes ä¸Šè¿è¡Œçš„ Fn æœåŠ¡ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¿…é¡»å°†&lt;code&gt;FN_REGISTRY&lt;/code&gt;ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºæŒ‡å‘æ‚¨çš„ Docker é•œåƒä»“åº“çš„ç”¨æˆ·åã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬åœ¨ Kubernetes é›†ç¾¤ä¸Šè¿è¡Œ Fnï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨æœ¬åœ°æ„å»ºçš„æ˜ åƒ - å®ƒä»¬éœ€è¦æ¨é€åˆ° Kubernetes é›†ç¾¤å¯ä»¥è®¿é—®çš„ Docker é•œåƒä»“åº“ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://github.com/fnproject/cli&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fn CLI&lt;/a&gt; æ¥éƒ¨ç½²è¿™äº›å‡½æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;FN_API_URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;http://localhost:80 fn deploy --all
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;ä¸Šé¢çš„å‘½ä»¤å‡è®¾ Fn API æœåŠ¡æš´éœ²åœ¨ localhost:80 ä¸Šï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ‚¨åœ¨ Docker for Mac ä¸­ä½¿ç”¨ Kubernetes æ”¯æŒï¼‰ã€‚å¦‚æœä½¿ç”¨ä¸åŒçš„é›†ç¾¤ï¼Œåˆ™å¯ä»¥å°† FN_API_URL æ›¿æ¢ä¸º fn-api æœåŠ¡çš„å¤–éƒ¨ IP åœ°å€ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;åœ¨ Docker æ„å»ºå’Œæ¨é€å®Œæˆä¹‹åï¼Œæˆ‘ä»¬çš„å‡½æ•°å°±è¢«éƒ¨ç½²åˆ° Fn æœåŠ¡ä¸­äº†ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•è°ƒç”¨å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;éƒ¨ç½²åˆ° Fn æœåŠ¡çš„ä»»ä½•å‡½æ•°éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ URLï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºåç§°å’Œè·¯ç”±åç§°ã€‚é€šè¿‡æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåç§°å’Œè·¯ç”±ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®å·²éƒ¨ç½²çš„å‡½æ•° &lt;code&gt;http://$(FN_API_URL)/r/hello-app/v1&lt;/code&gt;Â ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è°ƒç”¨&lt;code&gt;v1&lt;/code&gt;è·¯ç”±ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl http://localhost/r/hello-app/v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;message&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;Hello V1&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŒæ ·ï¼Œè°ƒç”¨&lt;code&gt;v2&lt;/code&gt;è·¯ç”±å°†è¿”å› Hello V2 æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ä½†å‡½æ•°åœ¨å“ªé‡Œè¿è¡Œ&#34;&gt;ä½†å‡½æ•°åœ¨å“ªé‡Œè¿è¡Œï¼Ÿ&lt;/h4&gt;
&lt;p&gt;å¦‚æœæ‚¨åœ¨è°ƒç”¨å‡½æ•°æ—¶æŸ¥çœ‹æ­£åœ¨åˆ›å»º/åˆ é™¤çš„ podï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æ²¡æœ‰çœŸæ­£æ”¹å˜â€”â€”å³æ²¡æœ‰ pod åˆ›å»ºæˆ–åˆ é™¤ã€‚åŸå› æ˜¯ Fn ä¸ä¼šåƒ Kubernetes pod ä¸€æ ·åˆ›å»ºå‡½æ•°ï¼Œå› ä¸ºè¿™å¤ªæ…¢äº†ã€‚ç›¸åï¼Œæ‰€æœ‰ Fn å‡½æ•°çš„éƒ¨ç½²å’Œè°ƒç”¨éƒ½å‘ç”Ÿåœ¨ fn-service pod ä¸­ã€‚ç„¶åï¼ŒFn è´Ÿè½½å‡è¡¡å™¨è´Ÿè´£éƒ¨ç½²å’Œè·¯ç”±åˆ°è¿™äº› podï¼Œä»¥æœ€ä¼˜åŒ–çš„æ–¹å¼éƒ¨ç½²/æ‰§è¡Œå‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œæˆ‘ä»¬æ²¡æœ‰å‡½æ•°çš„ Kubernetes pod/serviceï¼Œä½† Istio è¦æ±‚æˆ‘ä»¬æ‹¥æœ‰å¯ä»¥è·¯ç”±åˆ°çš„æœåŠ¡å’Œ podã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ Istio å‘¢ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&#34;æ€è€ƒ&#34;&gt;æ€è€ƒ&lt;/h3&gt;
&lt;p&gt;è®©æˆ‘å°†å‡½æ•°ä»å›¾ç‰‡ä¸­è§£æ”¾å‡ºæ¥ï¼Œå¹¶æ€è€ƒä¸ºäº†èƒ½è®© Istio è·¯ç”±å·¥ä½œæˆ‘ä»¬éœ€è¦åšä»€ä¹ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes æœåŠ¡â€”â€” hello åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹&lt;/li&gt;
&lt;li&gt;é’ˆå¯¹ hello-app v1 çš„ Kubernetes deployment&lt;/li&gt;
&lt;li&gt;é’ˆå¯¹ hello-app v2 çš„ Kubernetes deployment&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­£å¦‚ Istio è·¯ç”±å…¥é—¨ä¸€èŠ‚å¼€å¤´éƒ¨åˆ†æ‰€è§£é‡Šçš„ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»åœ¨ä¸¤ä¸ª deployment ä¸­æ·»åŠ ä¸€ä¸ªä»£è¡¨ç‰ˆæœ¬å’Œ &lt;code&gt;app=hello-app&lt;/code&gt; çš„æ ‡ç­¾ã€‚æœåŠ¡ä¸Šçš„é€‰æ‹©å™¨ä¼šé€‰æ‹© &lt;code&gt;app=hello-app&lt;/code&gt; çš„æ ‡ç­¾â€”â€”ç‰¹å®šäºç‰ˆæœ¬çš„æ ‡ç­¾å°†ç”± Istio è·¯ç”±è§„åˆ™æ·»åŠ ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºæ­¤ï¼Œæ¯ä¸ªç‰¹å®šäºç‰ˆæœ¬çš„éƒ¨ç½²éƒ½éœ€è¦æœ€ç»ˆä»¥æ­£ç¡®çš„è·¯ç”±ï¼ˆä¾‹å¦‚&lt;code&gt;/r/hello-app/v1&lt;/code&gt;ï¼‰è°ƒç”¨ Fn è´Ÿè½½å‡è¡¡å™¨ã€‚ç”±äºä¸€åˆ‡éƒ½åœ¨ Kubernetes ä¸­è¿è¡Œï¼Œæˆ‘ä»¬çŸ¥é“ Fn è´Ÿè½½å‡è¡¡å™¨æœåŠ¡çš„åç§°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä½äºéƒ¨ç½²ä¸­çš„å®¹å™¨ï¼Œå®ƒåœ¨è°ƒç”¨æ—¶å°†å‘¼å«è½¬å‘åˆ°ç‰¹å®šè·¯å¾„ä¸Šçš„ Fn è´Ÿè½½å‡è¡¡å™¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯å›¾ä¸­è¡¨ç¤ºçš„ä¸Šè¿°æƒ³æ³•ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyiscib2j20ce0jogm3_hu_715370442b23f76.webp 400w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyiscib2j20ce0jogm3_hu_9241f09cccda4887.webp 760w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyiscib2j20ce0jogm3_hu_2da36545470bd3b6.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyiscib2j20ce0jogm3_hu_715370442b23f76.webp&#34;
               width=&#34;446&#34;
               height=&#34;708&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æœ‰ä¸€ä¸ªæœåŠ¡ä»£è¡¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå’Œä¸¤ä¸ªç‰¹å®šäºç‰ˆæœ¬çš„éƒ¨ç½²ï¼Œå¹¶ç›´æ¥è·¯ç”±åˆ° Fn æœåŠ¡ä¸­è¿è¡Œçš„ Functionã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç®€å•çš„ä»£ç†&#34;&gt;ç®€å•çš„ä»£ç†&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æŸç§ä»£ç†æœåŠ¡å™¨æ¥æ¥æ”¶æ‰€æœ‰è°ƒç”¨å¹¶å°†å®ƒä»¬è½¬å‘ç»™ Fn æœåŠ¡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Nginx é…ç½®ï¼Œå®ƒå®Œå…¨ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-lua&#34; data-lang=&#34;lua&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;events&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;worker_connections&lt;/span&gt;  &lt;span class=&#34;mi&#34;&gt;4096&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;upstream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fn&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;my&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fn&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;api.default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;listen&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;location&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;proxy_pass&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fn&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hello&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;X&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Real&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IP&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;remote_addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;X&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Forwarded&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;For&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;remote_addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Host&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é…ç½®è§£é‡Šï¼šè°ƒç”¨ &lt;code&gt;/&lt;/code&gt;ï¼Œå°±å°†å…¶è½¬å‘åˆ° &lt;code&gt;http://fn-server/r/hello-app/v1&lt;/code&gt;ï¼ˆ&lt;code&gt;fn-server&lt;/code&gt;å®šä¹‰ä¸ºä¸Šæ¸¸ï¼‰ï¼Œè§£æåˆ°&lt;code&gt;my-fn-api.default&lt;/code&gt;ï¼ˆè¿™æ˜¯ fn-api åœ¨ Kubernetes çš„ &lt;code&gt;default&lt;/code&gt; namespace ä¸­çš„æœåŠ¡åç§°ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ç”¨ä¸€ä¸ªè„šæœ¬åˆ›å»ºäº†ä¸€ä¸ª Docker é•œåƒï¼Œè¯¥è„šæœ¬åŸºäºæ‚¨ä¼ å…¥çš„ä¸Šæ¸¸å’Œè·¯ç”±å€¼ç”Ÿæˆ Nginx é…ç½®ã€‚è¯¥é•œåƒåœ¨ &lt;a href=&#34;https://hub.docker.com/r/pj3677/simple-proxy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Docker hub ä¸Šæä¾›&lt;/a&gt;ï¼Œæ‚¨å¯ä»¥åœ¨&lt;a href=&#34;https://github.com/peterj/fn-simple-proxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;æŸ¥çœ‹æºä»£ç ã€‚&lt;/p&gt;
&lt;h4 id=&#34;éƒ¨ç½²åˆ°-kubernetes&#34;&gt;éƒ¨ç½²åˆ° Kubernetes&lt;/h4&gt;
&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»º Kubernetes YAML æ–‡ä»¶ï¼ŒåŒ…æ‹¬ serviceã€deployment ä»¥åŠæˆ‘ä»¬å°†ç”¨äºè®¿é—®å‡½æ•°çš„ ingressã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ deployment æ–‡ä»¶çš„æ‘˜å½•ï¼Œä»¥æ˜¾ç¤ºæˆ‘ä»¬å¦‚ä½•è®¾ç½®&lt;code&gt;UPSTREAM&lt;/code&gt;ã€ &lt;code&gt;ROUTE&lt;/code&gt;  ç¯å¢ƒå˜é‡å’Œè®¾ç½®æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyjnxkj2j20si0m60uq_hu_466423c7e9dc5249.webp 400w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyjnxkj2j20si0m60uq_hu_330b8ffd9da7cd59.webp 760w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyjnxkj2j20si0m60uq_hu_72e5d15279533fc6.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyjnxkj2j20si0m60uq_hu_466423c7e9dc5249.webp&#34;
               width=&#34;760&#34;
               height=&#34;591&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;code&gt;UPSTREAM&lt;/code&gt;å’Œ&lt;code&gt;ROUTE&lt;/code&gt;ç¯å¢ƒå˜é‡ç”± simple-proxy å®¹å™¨è¯»å–ï¼ŒNginx çš„é…ç½®æ–‡ä»¶ä¼šæ ¹æ®è¿™äº›å€¼ç”Ÿæˆã€‚&lt;/p&gt;
&lt;p&gt;æœåŠ¡çš„ YAML æ–‡ä»¶ä¹Ÿæ²¡ä»€ä¹ˆç‰¹åˆ«ï¼Œæˆ‘ä»¬åªæ˜¯å°†é€‰æ‹©å™¨è®¾ç½®ä¸º&lt;code&gt;app: hello-app&lt;/code&gt;Â ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyk1a1pmj20si0jata9_hu_235818aa53aeb440.webp 400w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyk1a1pmj20si0jata9_hu_4e8a0cd22945b25a.webp 760w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyk1a1pmj20si0jata9_hu_5dfa289ddf6834fd.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyk1a1pmj20si0jata9_hu_235818aa53aeb440.webp&#34;
               width=&#34;760&#34;
               height=&#34;514&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ€åä¸€éƒ¨åˆ†æ˜¯ Istio ingressï¼Œæˆ‘ä»¬è®¾ç½®äº†å°†æ‰€æœ‰ä¼ å…¥æµé‡è·¯ç”±åˆ°åç«¯æœåŠ¡çš„è§„åˆ™ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyki4sz2j20si0jagnc_hu_166b0b7858fb6667.webp 400w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyki4sz2j20si0jagnc_hu_ae752d868a8e99cb.webp 760w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyki4sz2j20si0jagnc_hu_9c050217eaa93827.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoyki4sz2j20si0jagnc_hu_166b0b7858fb6667.webp&#34;
               width=&#34;760&#34;
               height=&#34;514&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¦éƒ¨ç½²è¿™äº›ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨&lt;code&gt;kubectl&lt;/code&gt;æ¥éƒ¨ç½² ingress å’ŒæœåŠ¡ï¼Œä½¿ç”¨&lt;code&gt;istioctl kube-inject&lt;/code&gt;æ¥æ³¨å…¥ Istio ä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;éšç€ä¸€åˆ‡éƒ¨ç½²å®Œæ¯•ï¼Œä½ åº”è¯¥ä¼šå¾—åˆ°ä»¥ä¸‹ Kubernetes èµ„æºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;hello-app-deployment-v1ï¼ˆä½¿ç”¨æŒ‡å‘ v1 è·¯ç”±çš„ simple-proxy é•œåƒéƒ¨ç½²ï¼‰&lt;/li&gt;
&lt;li&gt;hello-app-deployment-v2ï¼ˆä½¿ç”¨æŒ‡å‘ v2 è·¯ç”±çš„ simple-proxy é•œåƒéƒ¨ç½²ï¼‰&lt;/li&gt;
&lt;li&gt;hello-app-serviceï¼ˆåœ¨ hello-app éƒ¨ç½²ä¸­é’ˆå¯¹ v1 å’Œ v2 pod çš„æœåŠ¡ï¼‰&lt;/li&gt;
&lt;li&gt;æŒ‡å‘ hello-app-service çš„ ingressï¼Œå¹¶ç»™å¢åŠ æ³¨è§£ï¼Œå°† ingress.class èµ‹å€¼ä¸ºâ€œistioâ€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨ hello-app-service æˆ–è°ƒç”¨ ingressï¼Œæˆ‘ä»¬åº”è¯¥ä» v1 å’Œ v2  å‡½æ•°ä¸­è·å¾—éšæœºå“åº”ã€‚ä»¥ä¸‹æ˜¯å¯¹ ingress è¿›è¡Œè°ƒç”¨çš„ç¤ºä¾‹è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; true&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; sleep 1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; curl http://localhost:8082&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;â€œmessageâ€:â€Hello V1&lt;span class=&#34;s2&#34;&gt;&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;{â€œmessageâ€:â€Hello V1&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;â€œmessageâ€:â€Hello V1&lt;span class=&#34;s2&#34;&gt;&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;{â€œmessageâ€:â€Hello V1&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;â€œmessageâ€:â€Hello V2&lt;span class=&#34;s2&#34;&gt;&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;{â€œmessageâ€:â€Hello V1&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;â€œmessageâ€:â€Hello V2&lt;span class=&#34;s2&#34;&gt;&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;{â€œmessageâ€:â€Hello V1&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;â€œmessageâ€:â€Hello V2&lt;span class=&#34;s2&#34;&gt;&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;{â€œmessageâ€:â€Hello V1&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;â€œmessageâ€:â€Hello V1&lt;span class=&#34;s2&#34;&gt;&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;{â€œmessageâ€:â€Hello V1&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;â€œmessageâ€:â€Hello V2&lt;span class=&#34;s2&#34;&gt;&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬éšæœºè·å¾—äº† V1 å’Œ V2 çš„å“åº” - è¿™æ­£æ˜¯æˆ‘ä»¬ç°åœ¨æƒ³è¦çš„ï¼&lt;/p&gt;
&lt;h3 id=&#34;istio-è§„åˆ™&#34;&gt;Istio è§„åˆ™&lt;/h3&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„æœåŠ¡å’Œéƒ¨ç½²å·²å¯åŠ¨å¹¶è¿è¡Œï¼ˆå’Œæ­£åœ¨è¿è¡Œï¼‰çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º Fn å‡½æ•°åˆ›å»º Istio è·¯ç”±è§„åˆ™ã€‚è®©æˆ‘ä»¬ä»¥ä¸€ä¸ªç®€å•çš„ v1 è§„åˆ™å¼€å§‹ï¼Œè¯¥è§„åˆ™å°†æ‰€æœ‰å¯¹ &lt;code&gt;hello-app-service&lt;/code&gt; çš„è°ƒç”¨ï¼ˆ&lt;code&gt;weight: 100&lt;/code&gt;ï¼‰è·¯ç”±åˆ°æ ‡è®°ä¸ºçš„ &lt;code&gt;v1&lt;/code&gt;çš„ pod ä¸Šï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoykynfcsj20si0hcwfx_hu_2ea180c1ae4d0a43.webp 400w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoykynfcsj20si0hcwfx_hu_7530cbdcbfe15238.webp 760w,
               /blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoykynfcsj20si0hcwfx_hu_7c4dffe5b1b684de.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoykynfcsj20si0hcwfx_hu_2ea180c1ae4d0a43.webp&#34;
               width=&#34;760&#34;
               height=&#34;462&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œåº”ç”¨æ­¤è§„åˆ™&lt;code&gt;kubectl apply -f v1-rule.yaml&lt;/code&gt;ã€‚æŸ¥çœ‹è¿è¡Œä¸­çš„è·¯ç”±çš„æœ€ä½³æ–¹æ³•æ˜¯è¿è¡Œä¸€ä¸ªè¿ç»­è°ƒç”¨ç«¯ç‚¹çš„å¾ªç¯â€”â€”è¿™æ ·æ‚¨å°±å¯ä»¥çœ‹åˆ°æ··åˆï¼ˆv1/v2ï¼‰å’Œå…¨éƒ¨ v1 çš„å“åº”ã€‚&lt;/p&gt;
&lt;p&gt;å°±åƒæˆ‘ä»¬å°† &lt;code&gt;v1&lt;/code&gt; çš„è·¯ç”±è§„åˆ™å®šä¹‰ä¸º 100% çš„æƒé‡é‚£æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç±»ä¼¼åœ°å®šä¹‰ä¸€æ¡è§„åˆ™å°†æ‰€æœ‰å†…å®¹è·¯ç”±åˆ°&lt;code&gt;v2&lt;/code&gt;ï¼Œæˆ–è€…å°†è§„åˆ™è·¯ç”± 50ï¼… çš„æµé‡ &lt;code&gt;v1&lt;/code&gt; å’Œ 50ï¼… çš„æµé‡&lt;code&gt;v2&lt;/code&gt;ï¼Œå¦‚ä¸‹é¢çš„æ¼”ç¤ºæ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34;
           src=&#34;https://cloudnativecn.com/blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsoysfirnig20f80a0dli.gif&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦æˆ‘è¯æ˜äº†è¿™ä¸€ç‚¹ï¼Œç®€å•çš„ curl å‘½ä»¤ï¼Œå¥½äº†ï¼Œæˆ‘åœä¸‹æ¥ï¼šï¼‰&lt;/p&gt;
&lt;p&gt;å¹¸è¿çš„æ˜¯ï¼Œ&lt;a href=&#34;https://medium.com/@carimura/the-importance-of-devops-to-serverless-f671070efb9&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Chad Arimura&lt;/a&gt; åœ¨ä»–å…³äº DevOps å¯¹æ— æœåŠ¡å™¨çš„é‡è¦æ€§çš„æ–‡ç« ä¸­è¿›ä¸€æ­¥è¯´æ˜äº†è¿™ä¸€ç‚¹ï¼ˆè­¦æŠ¥ï¼šDevOps ä¸ä¼šæ¶ˆå¤±ï¼‰ã€‚ä»–ä½¿ç”¨ Spinnaker å¯¹åœ¨å®é™… Kubernetes é›†ç¾¤ä¸Šè¿è¡Œçš„ Fn å‡½æ•°è¿›è¡ŒåŠ æƒè“ç»¿éƒ¨ç½²ã€‚çœ‹çœ‹ä»–çš„æ¼”ç¤ºè§†é¢‘ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34;
           src=&#34;https://cloudnativecn.com/blog/traffic-routing-between-fn-functions-using-fn-project-and-istio-fd/61411417ly1fsozs9eudag20w00k0kk0.gif&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ªäººå¯èƒ½éƒ½ä¼šè®¤åŒæœåŠ¡ç½‘æ ¼åœ¨æ— æœåŠ¡å‡½æ•°é¢†åŸŸçš„é‡è¦æ€§ã€‚å¦‚æœä½¿ç”¨æœåŠ¡ç½‘æ ¼ï¼ˆå¦‚è·¯ç”±ã€æµé‡é•œåƒã€æ•…éšœæ³¨å…¥å’Œå…¶ä»–ä¸€äº›ä¸œè¥¿ï¼‰ï¼Œå¯ä»¥è·å¾—è®¸å¤šå¥½å¤„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘çœ‹åˆ°çš„æœ€å¤§æŒ‘æˆ˜æ˜¯ç¼ºä¹ä»¥å¼€å‘äººå‘˜ä¸ºä¸­å¿ƒçš„å·¥å…·ï¼Œè®©å¼€å‘äººå‘˜èƒ½å¤Ÿåˆ©ç”¨æ‰€æœ‰è¿™äº›æ¼‚äº®å’Œé…·ç‚«çš„åŠŸèƒ½ã€‚è®¾ç½®è¿™ä¸ªé¡¹ç›®å’Œæ¼”ç¤ºæ¥è¿è¡Œå‡ æ¬¡å¹¶ä¸å¤ªå¤æ‚ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œè¿™æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œå®ƒä»¬å°±è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶æ²¡æœ‰åˆ«çš„ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ¼”ç¤ºã€‚è€ƒè™‘è¿è¡Œæ•°ç™¾æˆ–æ•°åƒä¸ªå‡½æ•°å¹¶åœ¨å®ƒä»¬ä¹‹é—´å»ºç«‹ä¸åŒçš„è·¯ç”±è§„åˆ™ã€‚ç„¶åç®¡ç†æ‰€æœ‰è¿™äº›å‡½æ•°ã€‚æˆ–è€…æ¨å‡ºæ–°ç‰ˆæœ¬å¹¶ç›‘æ§æ•…éšœã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è®¤ä¸ºåœ¨è¿›è¡Œå‡½æ•°ç®¡ç†ã€æœåŠ¡ç½‘æ ¼ç®¡ç†ã€è·¯ç”±ã€å…¶ä»–é…·ç‚«çš„åŠŸèƒ½æ–¹é¢æœ‰å¾ˆå¤šçš„æœºä¼šï¼ˆå’ŒæŒ‘æˆ˜ï¼‰ï¼Œå› æ­¤å¯¹äºæ¯ä¸ªå‚ä¸è€…éƒ½å¾ˆç›´è§‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è°¢è°¢é˜…è¯»&#34;&gt;è°¢è°¢é˜…è¯»&lt;/h3&gt;
&lt;p&gt;å¯¹è¿™ç¯‡æ–‡ç« çš„ä»»ä½•åé¦ˆæˆ‘éƒ½éå¸¸æ¬¢è¿ï¼ä½ ä¹Ÿå¯ä»¥åœ¨ &lt;a href=&#34;http://twitter.com/pjausovec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Twitter&lt;/a&gt; å’Œ &lt;a href=&#34;http://github.com/peterj&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitHub&lt;/a&gt; ä¸Šå…³æ³¨æˆ‘ã€‚å¦‚æœä½ å–œæ¬¢è¿™ä¸€ç‚¹ï¼Œå¹¶å¸Œæœ›åœ¨æˆ‘å†™æ›´å¤šä¸œè¥¿æ—¶å¾—åˆ°é€šçŸ¥ï¼Œä½ åº”è¯¥è®¢é˜…&lt;a href=&#34;https://tinyletter.com/pjausovec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘çš„é€šè®¯&lt;/a&gt;ï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æœåŠ¡ç½‘æ ¼ Istio ä¹‹ pilot-xDS æ¥å£ç¬”è®°</title>
      <link>https://cloudnativecn.com/blog/istio-service-mesh-pilot-xds-note/</link>
      <pubDate>Thu, 21 Jun 2018 16:55:56 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-service-mesh-pilot-xds-note/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡è½¬è½½è‡ª&lt;a href=&#34;https://ninokop.github.io/2018/06/19/pilot-xDS/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;nino&amp;rsquo;s blog&lt;/a&gt;ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;æœ¬ç¯‡æ€»ç»“ pilot çš„ xDS å¸¸ç”¨æ¥å£ï¼Œé¡ºä¾¿æµè§ˆäº†éƒ¨åˆ† pilot å®ç°ï¼Œä¸‹ç¯‡æ€»ç»“ä¸‹ istio çš„æµé‡ç®¡ç†å’ŒæœåŠ¡å‘ç°çš„å®ç°ã€‚ç®€å•æ¥è¯´ istio åšä¸ºç®¡ç†é¢ï¼Œé›†åˆäº†é…ç½®ä¸­å¿ƒå’ŒæœåŠ¡ä¸­å¿ƒä¸¤ä¸ªåŠŸèƒ½ï¼Œå¹¶æŠŠé…ç½®å‘ç°å’ŒæœåŠ¡å‘ç°ä»¥ä¸€ç»„ç»Ÿä¸€çš„ xDS æ¥å£æä¾›å‡ºæ¥ï¼Œæ•°æ®é¢çš„ envoy é€šè¿‡ xDS è·å–éœ€è¦çš„ä¿¡æ¯æ¥åšæœåŠ¡é—´é€šä¿¡å’ŒæœåŠ¡æ²»ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;api-v1-reference&#34;&gt;api v1 reference&lt;/h2&gt;
&lt;p&gt;Istio ä¸­éƒ¨ç½² pilot çš„å¯åŠ¨æ–¹å¼æ˜¯&lt;code&gt;pilot-discovery discovery&lt;/code&gt;ã€‚åˆå§‹åŒ–é˜¶æ®µä¾æ¬¡ init äº†å„ç§æ¨¡å—ï¼Œå…¶ä¸­ discovery service å°±æ˜¯ xDS ç›¸å…³å®ç°ã€‚&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;envoy API reference&lt;/a&gt; å¯ä»¥æŸ¥åˆ° v1 å’Œ v2 ä¸¤ä¸ªç‰ˆæœ¬çš„ API æ–‡æ¡£ã€‚&lt;a href=&#34;https://github.com/envoyproxy/go-control-plane&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;envoy control plane&lt;/a&gt; ç»™äº† v2 grpc æ¥å£ç›¸å…³çš„æ•°æ®ç»“æ„å’Œæ¥å£ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/ninokop/nino-notes/blob/master/istio/pilot-xDS.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pilot-xDS&lt;/a&gt;æ˜¯å‡ ä¸ªæœˆå‰ 0.6.0 ç‰ˆæœ¬çš„ç¯å¢ƒä¸Šå®éªŒçš„æ¥å£ï¼Œä»Šå¤©åœ¨ 0.8.0 ä¸Šè·‘å‘ç° RDS å’Œ CDS éƒ½æŸ¥ä¸åˆ°é…ç½®äº†ï¼Œå¿ƒå¥½ç´¯ã€‚è¿½åˆ°å¯¹åº”ç‰ˆæœ¬çš„ä»£ç å‘ç°å› ä¸º routerule çš„é…ç½®å‡çº§åˆ° v1alpha3 routing API ä¹‹åï¼ŒAPIV1 åªæ”¯æŒåŸæ¥ route rule é…ç½®ï¼ŒAPIV2 æ‰æ”¯æŒ virtual service ç›¸å…³é…ç½®ï¼Œæ‰€ä»¥ 0.8.0 ç¯å¢ƒä¸Š RDS æŸ¥ä¸åˆ°ä¿¡æ¯ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h3 id=&#34;sds&#34;&gt;sDS&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Tips&lt;/strong&gt; æœ€åˆçœ‹ xDS çš„æ–‡æ¡£çš„æ—¶å€™ï¼Œéå¸¸ç–‘æƒ‘è¿™äº›æ¥å£é‡Œçš„ service-key service-node cluster-name åˆ°åº•æ˜¯ä»€ä¹ˆå«ä¹‰ï¼Œåœ¨ 0.6.0 ç‰ˆæœ¬ä¸­æœ‰ä¸ª cache_stats æ¥å£ï¼Œåªè¦ envoy è°ƒç”¨è¿‡ï¼Œè¿™æ¬¡æŸ¥è¯¢è®°å½•å°±å¯ä»¥åœ¨ cache_stats ä¸­çœ‹åˆ°ã€‚æœ¬èŠ‚è®°å½•æ¯ä¸ªå­—æ®µçš„å«ä¹‰å’ŒæŸ¥è¯¢æ–¹å¼ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://xx/v1/registration
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://xx/v1/registration/reviews.nino.svc.cluster.local&lt;span class=&#34;se&#34;&gt;\|&lt;/span&gt;http
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://xx/v1/registration/reviews.nino.svc.cluster.local&lt;span class=&#34;se&#34;&gt;\|&lt;/span&gt;http&lt;span class=&#34;se&#34;&gt;\|&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;pilot/pkg/proxy/envoy/v1/discovery.go&lt;/strong&gt; é‡Œ v1 æ¥å£æ–‡ä»¶ä¸­ register å‡½æ•°å®Œæˆäº†å‘ go-restful æ³¨å†ŒæœåŠ¡ã€‚æŸ¥è¯¢å¯ä»¥æ ¹æ®æ¡ä»¶é™¤äº†å¸¦ä¸Š service-keyï¼Œè¿˜å¯ä»¥åœ¨æœ«å°¾å¸¦ä¸Š labelsï¼Œæ¯”å¦‚ version=v2ã€‚åœ¨ kube-service-registry å½“ä¸­ service çš„æŸ¥è¯¢æ˜¯é€šè¿‡ service endpoint çš„ shared informer æŸ¥è¯¢çš„ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åŒ¹é… labelsã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;service-key&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.nino.svc.cluster.local|http&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;ip_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.244.0.37&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;port&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;service-key&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc.cluster.local|http&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;ip_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.244.0.38&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;port&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;ip_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.244.0.41&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;port&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;ip_address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.244.0.42&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;port&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;cds&#34;&gt;cDS&lt;/h3&gt;
&lt;p&gt;cDS çš„æ¥å£é‡Œçš„ cluster_name å’Œ service_node å¯ä»¥é€šè¿‡ envoy å¯åŠ¨å‚æ•°é…ç½®ã€‚å…¶ä¸­ cluster_name å¯ä»¥é€šè¿‡ serviceCluster é…ç½®ï¼Œservice_node é»˜è®¤é€šè¿‡ ENVOY_TYPEã€POD_NAMEã€POD_NAMESPACE å’Œ INSTANCE_IP è¿™äº›ç¯å¢ƒå˜é‡åˆæˆã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;/v1/{:cluster_name}/{:service_node}&lt;/p&gt;&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://xx/v1/clusters/productpage/sidecar~10.244.0.40~productpage-v1-
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;8666ffbd7c-mf5f4.nino~nino.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;in.9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_timeout_ms&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;static&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;round_robin&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;url&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;tcp://127.0.0.1:9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;},{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;out.ratings.nino.svc.cluster.local|http|version=v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;service_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.nino.svc.cluster.local|http|version=v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_timeout_ms&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sds&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;round_robin&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;},{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;out.reviews.nino.svc.cluster.local|http|version=v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;service_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc.cluster.local|http|version=v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_timeout_ms&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sds&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;round_robin&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;},{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;out.reviews.nino.svc.cluster.local|http|version=v2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;service_name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc.cluster.local|http|version=v2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;connect_timeout_ms&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sds&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;lb_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;round_robin&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;rds&#34;&gt;rDS&lt;/h3&gt;
&lt;p&gt;æ¥å£ç±»ä¼¼ cDSï¼Œé€šè¿‡ istioctl åˆ›å»ºäº† route rule ä¹‹åå¯ä»¥é€šè¿‡ routes æŸ¥åˆ°ç»“æœã€‚ä¸‹é¢çš„ä¾‹å­æ˜¯å‘å¸ƒäº†å…³äº reviews æœåŠ¡çš„æƒé‡è§„åˆ™ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹ RDS æ¥å£æŸ¥åˆ°å¯¹åº”çš„æƒé‡è§„åˆ™ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;/v1/{:route_config_name}/{:cluster_name}/{:service_node}&lt;/p&gt;&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://xx/v1/routes/9080/productpage/sidecar~10.244.0.40~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;productpage-v1-8666ffbd7c-mf5f4.nino~nino.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;validate_clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;virtual_hosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.nino.svc.cluster.local|http&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.nino:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.nino&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.nino.svc:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.nino.svc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.nino.svc.cluster:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.nino.svc.cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.nino.svc.cluster.local:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings.nino.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.101.178.48:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.101.178.48&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;out.ratings.nino.svc.cluster.local|http|version=v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;timeout_ms&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;decorator&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;operation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ratings-default&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc.cluster.local|http&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc.cluster:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc.cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc.cluster.local:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.108.121.171:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.108.121.171&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;weighted_clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;out.reviews.nino.svc.cluster.local|http|version=v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;weight&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;out.reviews.nino.svc.cluster.local|http|version=v2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;weight&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;timeout_ms&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;decorator&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;operation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews-default&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;api-v2-reference&#34;&gt;api v2 reference&lt;/h2&gt;
&lt;h3 id=&#34;eds-http-debug&#34;&gt;eds http debug&lt;/h3&gt;
&lt;p&gt;è™½ç„¶ v2 æ˜¯ grpc çš„æ¥å£ï¼Œä½†æ˜¯ pilot æä¾›äº†&lt;code&gt;InitDebug&lt;/code&gt;ï¼Œå¯ä»¥é€šè¿‡ debug æ¥å£æŸ¥è¯¢æœåŠ¡å’Œ routes ç­‰æœåŠ¡å’Œé…ç½®ä¿¡æ¯ã€‚æ¯”å¦‚ä¸‹é¢æ˜¯ edsz çš„ debug æ¥å£ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://10.99.241.12:8080/debug/edsz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;clusterName&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080||reviews.nino.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;lbEndpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.244.0.56&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.244.0.58&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.244.2.25&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;clusterName&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080|v3|reviews.nino.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;lbEndpoints&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;#34;endpoint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;socketAddress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.244.0.58&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;portValue&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;eds-grpc&#34;&gt;eds grpc&lt;/h3&gt;
&lt;p&gt;åœ¨ envoy çš„ go-control-plane æ¥å£å®šä¹‰ä¸­ istio éœ€è¦å®ç°ä»¥ä¸‹æ¥å£ï¼Œç»“æœ pilot åªå®ç°äº† StreamEndpointsã€‚çœ‹äº†ä¸‹åŸºæœ¬å®ç° eds åªéœ€è¦ DiscoveryRequest é‡Œçš„ ResourceNames è¿™ä¸ªå­—æ®µï¼Œå…¶å®è·Ÿ v1 çš„æ¥å£ä¸€æ ·å°±æ˜¯éœ€è¦ service-keyã€‚NodeId å’Œ TypeUrl å¯çœç•¥ï¼Œåè€…é»˜è®¤å°±æ˜¯ EndpointTypeã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EndpointDiscoveryServiceServer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;StreamEndpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EndpointDiscoveryService_StreamEndpointsServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;FetchEndpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DiscoveryRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DiscoveryResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EndpointDiscoveryService_StreamEndpointsServer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;Send&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DiscoveryResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;Recv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DiscoveryRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ServerStream&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ª ResourceNames æ”¯æŒä¸¤ç§æ ¼å¼ï¼Œå…¶ä¸­ v1 å’Œ version=v1 å¯ä»¥æ²¡æœ‰ï¼Œè¿™ä¸ªä»£è¡¨ labels å’Œæ–°ç‰ˆå®šä¹‰çš„ subsetsã€‚eds çš„è§£æé‡Œå…¼å®¹ä¸¤ä¸ªç‰ˆæœ¬çš„è§£ææ–¹å¼ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;outbound|http|v1|istioserver.pilot.svc.cluster.local&lt;/p&gt;
&lt;p&gt;istioserver.pilot.svc.cluster.local|http|version=v1&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;istio/pilot/pkg/proxy/envoy/v2/eds.go&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;xds&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;xdsapi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewEndpointDiscoveryServiceClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;edsstr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;xds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;StreamEndpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Background&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;edsstr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Send&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;xdsapi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DiscoveryRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ResourceNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;istioserver.pilot.svc.cluster.local|http|version=v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;TypeUrl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;EndpointType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;res1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;edsstr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Recv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;cla&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getLoadAssignment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;res1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;pilot æŠŠè¿™ä¸ªå“åº”&lt;code&gt;DiscoveryResponse&lt;/code&gt;çš„ Resources å­—æ®µç”¨&lt;code&gt;ClusterLoadAssignment&lt;/code&gt;ä»£æ›¿ã€‚å®¢æˆ·ç«¯éœ€è¦&lt;code&gt;getLoadAssignment&lt;/code&gt;ä» res1.Resources[0].Value ååºåˆ—åŒ–å‡ºçœŸæ­£çš„å“åº”ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;github.com/envoyproxy/go-control-plane/envoy/api/v2/eds.pb.go&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ClusterLoadAssignment&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ClusterName&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// List of endpoints to load balance to.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Endpoints&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;envoy_api_v2_endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LocalityLbEndpoints&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Load balancing policy settings.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Policy&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ClusterLoadAssignment_Policy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ads-grpc&#34;&gt;ads grpc&lt;/h3&gt;
&lt;p&gt;æŸ¥è¯¢ eds è¿˜æœ‰å¦ä¸€ç§æ–¹å¼ adsï¼Œå³ Aggregated Discovery Serviceï¼Œå®ƒå°è£…äº†ä¸‹é¢è¿™ä¸ªæ¥å£ã€‚istio åœ¨å®ç°è¿‡ç¨‹ä¸­æ ¹æ® typeUrl è¯†åˆ« xDS çš„ç±»åˆ«ã€‚é™¤äº† eds ä»¥å¤–ï¼Œå…¶ä»– lds rds cds éƒ½æ˜¯ç”± ads é›†æˆçš„ï¼Œæ²¡æœ‰å•ç‹¬çš„ xds æ¥å£äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;AggregatedDiscoveryServiceServer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// This is a gRPC-only API.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;StreamAggregatedResources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AggregatedDiscoveryService_StreamAggregatedResourcesServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“ç±»å‹é€‰æ‹©ä¸º EndpointType æ—¶ï¼ŒæŸ¥è¯¢ç»“æœè·Ÿ eds ä¸€è‡´ï¼Œä¸è¿‡ ads æ¥å£è¦æ±‚ NodeID å¿…é¡»åœ¨ pilot ç¼“å­˜ä¸­å­˜åœ¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;xds&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ads&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewAggregatedDiscoveryServiceClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;adser&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;xds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;StreamAggregatedResources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Background&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;adser&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Send&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;xdsapi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DiscoveryRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;envoy_api_v2_core1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;sidecar~10.109.11.31~productpage-v1-586c4486b7-rk2rh.nino~nino.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ResourceNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;istioserver.pilot.svc.cluster.local|http&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;TypeUrl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;EndpointType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;res1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;adser&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Recv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;cla&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getLoadAssignment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;res1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;cds-http-debug&#34;&gt;cds http debug&lt;/h3&gt;
&lt;p&gt;é€šè¿‡ cdsz å¯ä»¥çœ‹åˆ°æ¯ä¸ª nodeID å¯¹åº”çš„ clusters çš„é…ç½®ï¼Œå¦‚æœç³»ç»Ÿä¸­ç”¨æˆ·æ²¡æœ‰å‘å¸ƒ subnetsï¼Œä» cds å®é™…ä¸ŠæŸ¥ä¸åˆ°å¸¦ tag æˆ–è€…è¯´å¸¦ version çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;curl &lt;a href=&#34;http://10.99.241.12:8080/debug/cdsz&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://10.99.241.12:8080/debug/cdsz&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;outbound|8084||istioserver.pilot.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;EDS&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s&#34;&gt;&amp;#34;edsClusterConfig&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;edsConfig&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;ads&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;serviceName&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;outbound|8084||istioserver.pilot.svc.cluster.local&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s&#34;&gt;&amp;#34;connectTimeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;1.000s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s&#34;&gt;&amp;#34;circuitBreakers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;thresholds&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;cds-grpc&#34;&gt;cds grpc&lt;/h3&gt;
&lt;p&gt;cds æ¥å£è¿”å›çš„æ•°æ®æ˜¯ Clusterï¼ŒåŒ…å«äº†æ‰€æœ‰è¿™ä¸ªæœåŠ¡çš„é…ç½®ä¿¡æ¯ã€‚ä½†å› ä¸ºç›®å‰ç”¨ä¸åˆ°å°±å¸ƒåˆ—å‡ºæ¥äº†ï¼Œå…·ä½“å®šä¹‰è§æ–‡ä»¶ &lt;strong&gt;github.com/envoyproxy/go-control-plane/envoy/api/v2/cds.pb.go&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Cluster&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Cluster_DiscoveryType&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;EdsClusterConfig&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cluster_EdsClusterConfig&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ConnectTimeout&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;LbPolicy&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Cluster_LbPolicy&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;CircuitBreakers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;envoy_api_v2_cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CircuitBreakers&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;rds-grpc&#34;&gt;rds grpc&lt;/h3&gt;
&lt;p&gt;rds æ¥å£è¿”å›çš„æ•°æ®ç»“æ„æ˜¯&lt;code&gt;RouteConfiguration&lt;/code&gt;ï¼Œè¿™ä¸ª RouteConfiguration å¯¹åº”çš„æ˜¯æ–°ç‰ˆæœ¬çš„è·¯ç”±é…ç½®æ ¼å¼ï¼Œå°±æ˜¯ virtual service å’Œ destination rules è¿™å¯¹è§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;github.com/envoyproxy/go-control-plane/envoy/api/v2/rds.pb.go&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;RouteConfiguration&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;VirtualHosts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;envoy_api_v2_route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VirtualHost&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;InternalOnlyHeaders&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ResponseHeadersToAdd&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;envoy_api_v2_core1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HeaderValueOption&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ResponseHeadersToRemove&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;RequestHeadersToAdd&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;envoy_api_v2_core1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HeaderValueOption&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ValidateClusters&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;google_protobuf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;BoolValue&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;çœ‹äº†æ•°æ®ç»“æ„æ³¨é‡Šï¼Œåœ¨ RDS å½“ä¸­ ResourceName å¡«çš„æ˜¯ routeConfiguration çš„åå­—ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;rds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Send&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;xdsapi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DiscoveryRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ResponseNonce&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;envoy_api_v2_core1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;sidecar~10.244.0.58~reviews-v3-79fb5c99d5-d9k7b.nino~nino.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ResourceNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;TypeUrl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;RouteType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;rds çš„æŸ¥è¯¢ç»“æœå®ä¾‹å¦‚ä¸‹ï¼Œæˆ‘å°±æ˜¯å‘å¸ƒäº†ä¸€ä¸ª reviews çš„ 50%ï¼š50% çš„æƒé‡è§„åˆ™ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;versionInfo&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2018-06-21 07:23:37.290525595 +0000 UTC m=+600.138437218&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;resources&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.api.v2.RouteConfiguration&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;virtualHosts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.nino.svc.cluster.local:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.nino.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.nino.svc.cluster.local:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.nino.svc.cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.nino.svc.cluster:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.nino.svc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.nino.svc:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.nino&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage.nino:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.109.11.31&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.109.11.31:9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080|v1|productpage.nino.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;useWebsocket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;decorator&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;operation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;productpage&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc.cluster.local:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;domains&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc.cluster.local:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc.cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc.cluster:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino.svc:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.nino:9080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.109.242.124&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.109.242.124:9080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;nt&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;prefix&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;route&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;weightedClusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;clusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080|v2|reviews.nino.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;weight&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;outbound|9080|v3|reviews.nino.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           &lt;span class=&#34;nt&#34;&gt;&amp;#34;weight&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;useWebsocket&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nt&#34;&gt;&amp;#34;decorator&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;#34;operation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;validateClusters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;typeUrl&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.api.v2.RouteConfiguration&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;#34;nonce&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2018-06-21 07:23:59.18418814 +0000 UTC m=+622.032099759&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;envoy API reference&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/envoyproxy/go-control-plane&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;envoy control plane&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;istio æŒ‡å—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Vistioâ€”ä½¿ç”¨ Netflix çš„ Vizceral å¯è§†åŒ– Istio service mesh</title>
      <link>https://cloudnativecn.com/blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/</link>
      <pubDate>Wed, 20 Jun 2018 10:25:16 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/</guid>
      <description>&lt;p&gt;















&lt;figure  id=&#34;figure-vistio-å…¨å±€çº§åˆ«å¯è§†åŒ–è§†å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;vistio å…¨å±€çº§åˆ«å¯è§†åŒ–è§†å›¾&#34; srcset=&#34;
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshfooas1oj318g0wrq9y_hu_1958467f41a0e599.webp 400w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshfooas1oj318g0wrq9y_hu_499dd0c599670e8f.webp 760w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshfooas1oj318g0wrq9y_hu_aab62e88d067f726.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshfooas1oj318g0wrq9y_hu_1958467f41a0e599.webp&#34;
               width=&#34;760&#34;
               height=&#34;560&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      vistio å…¨å±€çº§åˆ«å¯è§†åŒ–è§†å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://itnext.io/vistio-visualize-your-istio-mesh-using-netflixs-vizceral-b075c402e18e&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Vistio GitHub åœ°å€ï¼šhttps://github.com/nmnellis/vistio&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Netflix/vizceral&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Vizceral&lt;/a&gt;æ˜¯ Netflix å‘å¸ƒçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œç”¨äºè¿‘ä¹å®æ—¶åœ°ç›‘æ§åº”ç”¨ç¨‹åºå’Œé›†ç¾¤ä¹‹é—´çš„ç½‘ç»œæµé‡ã€‚Vistio æ˜¯ä½¿ç”¨ Vizceral å¯¹ Istio å’Œç½‘æ ¼ç›‘æ§çš„æ”¹è¿›ã€‚å®ƒåˆ©ç”¨ Istio Mixer ç”Ÿæˆçš„æŒ‡æ ‡ï¼Œç„¶åå°†å…¶è¾“å…¥ Prometheusã€‚Vistio æŸ¥è¯¢ Prometheus å¹¶å°†æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ä»¥å…è®¸é‡æ’­æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;Vizceral æœ‰ä¸¤ä¸ªå¯è§†åŒ–çº§åˆ«ï¼Œå…¨å±€å¯è§†åŒ–å’Œé›†ç¾¤çº§åˆ«å¯è§†åŒ–ã€‚åœ¨å…¨å±€èŒƒå›´å†…ï¼ˆå¦‚ä¸Šæ‰€ç¤ºï¼‰ï¼Œæ‚¨å¯ä»¥é€šè¿‡ Istio Ingress Gateway ç­‰å…¥å£ç‚¹å°†ä» Internet åˆ° Istio æœåŠ¡ç½‘æ ¼ç½‘ç»œçš„ç½‘ç»œæµé‡å¯è§†åŒ–ï¼Œæˆ–è€…æ‚¨å¯ä»¥åœ¨ Istio æœåŠ¡ç½‘æ ¼ç½‘ç»œä¸­æ˜¾ç¤ºæ€»ç½‘ç»œæµé‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é›†ç¾¤çº§åˆ«ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰ï¼Œæ‚¨å¯ä»¥å¯è§†åŒ–å†…éƒ¨ç½‘æ ¼çš„æµé‡ã€‚é€šè¿‡è®¾ç½®è­¦å‘Šå’Œé”™è¯¯çº§åˆ«è­¦æŠ¥ï¼Œå½“åº”ç”¨ç¨‹åºå‡ºç°é—®é¢˜æ—¶å¯ä»¥è¢«å¿«é€Ÿæ£€æµ‹å‡ºæ¥ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-vistio-çš„é›†ç¾¤çº§åˆ«å¯è§†åŒ–&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Vistio çš„é›†ç¾¤çº§åˆ«å¯è§†åŒ–&#34; srcset=&#34;
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshft5oxlwj318g0pe0wp_hu_235caf60bb68024c.webp 400w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshft5oxlwj318g0pe0wp_hu_b531aed4720c3f1b.webp 760w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshft5oxlwj318g0pe0wp_hu_1bfbb57b208162e0.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshft5oxlwj318g0pe0wp_hu_235caf60bb68024c.webp&#34;
               width=&#34;760&#34;
               height=&#34;434&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Vistio çš„é›†ç¾¤çº§åˆ«å¯è§†åŒ–
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;åœ¨-istio-æœåŠ¡ç½‘æ ¼ä¸­å®‰è£…-vistio&#34;&gt;åœ¨ Istio æœåŠ¡ç½‘æ ¼ä¸­å®‰è£… Vistio&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prometheus&lt;/li&gt;
&lt;li&gt;Istio 0.7 æˆ–æ›´é«˜ç‰ˆæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å‡è®¾&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹ Demo ä½¿å¾—è¿™äº›å‡è®¾æ›´å®¹æ˜“éƒ¨ç½²ã€‚å¦‚æœæ‚¨çš„ç¯å¢ƒè®¾ç½®ä¸åŒï¼Œåˆ™å¯èƒ½éœ€è¦å°†ä»£ç ä¸‹è½½åˆ°æœ¬åœ°å¹¶ç¼–è¾‘ä¸€äº›æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prometheus éƒ¨ç½²åœ¨&lt;code&gt;istio-system&lt;/code&gt; namespace ä¸‹ï¼Œå¯ä»¥é€šè¿‡&lt;a href=&#34;http://prometheus.istio-system:9090/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://prometheus.istio-system:9090&lt;/a&gt;åœ°å€è®¿é—®&lt;/li&gt;
&lt;li&gt;Istio mixer å¯ç”¨äº†&lt;code&gt;istio_request_count&lt;/code&gt; metric&lt;/li&gt;
&lt;li&gt;Kubernetes é›†ç¾¤åŒ…å«æœ‰&lt;code&gt;standard&lt;/code&gt; StorageClass&lt;/li&gt;
&lt;li&gt;ä¸ºäº†ä¾¿äºéƒ¨ç½²å·²å®‰è£…äº† Helmï¼ˆå¯é€‰ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å‰è¨€&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨è¿˜å°šæœªéƒ¨ç½²æœåŠ¡ç½‘æ ¼ï¼Œå¯ä»¥æŒ‰ç…§æ­¤&lt;a href=&#34;https://istio.io/docs/guides/bookinfo/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio Bookinfo Demo&lt;/a&gt;ä¸­çš„è¯´æ˜éƒ¨ç½² Istio åŠå…¶ç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚æ‚¨éœ€è¦èƒ½å¤Ÿåœ¨åº”ç”¨ç¨‹åºä¹‹é—´ç”Ÿæˆæµé‡ã€‚è¦æµ‹è¯•æŒ‡æ ‡æ˜¯å¦ä» Mixer æ­£ç¡®å‘é€åˆ° Prometheusï¼Œæ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹ Prometheus æŸ¥è¯¢&lt;code&gt;istio_request_count&lt;/code&gt;ï¼Œåº”è¯¥ä¼šçœ‹åˆ°å¤šä¸ªæ¡ç›®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-prometheus-æŸ¥è¯¢&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Prometheus æŸ¥è¯¢&#34; srcset=&#34;
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshg0vw25ij318g0jzqjq_hu_4cdba413d2dac7e7.webp 400w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshg0vw25ij318g0jzqjq_hu_8468aba636a6f56d.webp 760w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshg0vw25ij318g0jzqjq_hu_c3933fc194543142.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshg0vw25ij318g0jzqjq_hu_4cdba413d2dac7e7.webp&#34;
               width=&#34;760&#34;
               height=&#34;341&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Prometheus æŸ¥è¯¢
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;éƒ¨ç½²-vistio&#34;&gt;éƒ¨ç½² Vistio&lt;/h3&gt;
&lt;p&gt;æ‚¨å¯ä»¥é€‰æ‹©è¯´è¿‡ kubectl æˆ–è€…&lt;a href=&#34;https://github.com/kubernetes/helm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm&lt;/a&gt;æ¥éƒ¨ç½² Vistioï¼Œä¸‹é¢ä¼šåˆ†åˆ«ä»‹ç»ä¸¤ç§éƒ¨ç½²æ–¹å¼ã€‚æœ‰äº›å˜é‡å¯èƒ½éœ€è¦æ ¹æ®æ‚¨è‡ªå·±çš„ç¯å¢ƒæ¥ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸‹è½½ Vistioï¼ˆå¯é€‰çš„ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æƒ³é€šè¿‡ Helm éƒ¨ç½² Vistioï¼Œä½ å°†éœ€è¦åœ¨ GitHub ä¸Šä¸‹è½½é¡¹ç›®æ¥è·å– Helm æ¨¡æ¿ã€‚æ­¤å¤–ï¼Œå¦‚æœä¸Šè¿°å‡è®¾ä¹‹ä¸€ä¸ç¬¦åˆæ‚¨çš„éœ€æ±‚ï¼ˆä¾‹å¦‚ prometheus url ä¸åŒï¼‰ï¼Œåˆ™åº”æ‰‹åŠ¨ç­¾å‡ºå¹¶ç¼–è¾‘æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/nmnellis/vistio.git
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ kubectl éƒ¨ç½²&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/nmnellis/vistio/v0.1.2/vistio-mesh-only.yaml -n default
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ Helm éƒ¨ç½²&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åˆ‡æ¢åˆ° Vistio é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œè¿è¡Œ&lt;code&gt;helm install&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm install helm/vistio -f helm/vistio/values-mesh-only.yaml --name vistio --namespace default
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éªŒè¯å’Œæš´éœ²-vistio-webapi&#34;&gt;éªŒè¯å’Œæš´éœ² Vistio Web/API&lt;/h3&gt;
&lt;p&gt;éªŒè¯åº”ç”¨ç¨‹åºå·²ç»å¯åŠ¨å¹¶åœ¨è¿è¡Œã€‚ä½¿ç”¨&lt;code&gt;kubectl port-forward&lt;/code&gt;å‘½ä»¤æš´éœ²åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éªŒè¯ vistio-api&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl describe statefulset vistio-api -n default
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ—¥å¿—æ£€æŸ¥ï¼ˆå¯é€‰çš„ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ‚¨åº”è¯¥èƒ½å¤Ÿä»vistio-apiçš„æ—¥å¿—ä¸­æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä¸Prometheusçš„è¿æ¥/æŸ¥è¯¢ç›¸å…³çš„é”™è¯¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl logs -n default -c vistio-api &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl -n default get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;vistio-api -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;éªŒè¯ vistio-web&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl describe deployment vistio-web -n default
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æš´éœ² vistio-api&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨&lt;code&gt;kubectl port-forward&lt;/code&gt;å°† vistio-api æš´éœ²åˆ°&lt;a href=&#34;http://localhost:9191&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:9191&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n default port-forward &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl -n default get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;vistio-api -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; 9091:9091 &lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;éªŒè¯ vistio-api&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;vistio-web è°ƒç”¨ vistio-api æ¥æ¸²æŸ“æœåŠ¡ç½‘æ ¼ã€‚è®¿é—®&lt;a href=&#34;http://localhost:9091/graph&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:9091/graph&lt;/a&gt;æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹åˆ—çš„è¾“å‡ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-vistio-api-çš„æœŸæœ›è¾“å‡º&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;vistio-api çš„æœŸæœ›è¾“å‡º&#34; srcset=&#34;
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshi61t04oj310q17c0y1_hu_9c799e0e8d8a661f.webp 400w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshi61t04oj310q17c0y1_hu_294fb7624bfea096.webp 760w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshi61t04oj310q17c0y1_hu_8cafe86df7b41ab5.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshi61t04oj310q17c0y1_hu_9c799e0e8d8a661f.webp&#34;
               width=&#34;644&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      vistio-api çš„æœŸæœ›è¾“å‡º
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æš´éœ² Vistio&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å¦ä¸€ä¸ªå‘½ä»¤è¡Œç»ˆç«¯ä¸­ï¼Œæš´éœ² Vizcera UI åˆ°&lt;a href=&#34;http://localhost:8080&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:8080&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n default port-forward &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl -n default get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;vistio-web -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; 8080:8080 &lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;è®¿é—® Vistio&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€åˆ‡éƒ½å·²ç»å¯åŠ¨å¹¶å‡†å¤‡å°±ç»ªï¼Œæ‚¨å°±å¯ä»¥è®¿é—® Vistio UIï¼Œå¼€å§‹æ¢ç´¢æœåŠ¡ç½‘æ ¼ç½‘ç»œï¼Œè®¿é—®&lt;a href=&#34;http://localhost:8080&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:8080&lt;/a&gt;æ‚¨å°†ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹å›¾çš„è¾“å‡ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-vistio-ä¸»é¡µé¢&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Vistio ä¸»é¡µé¢&#34; srcset=&#34;
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshi98duzgj318g0l2406_hu_bd8e4bac6a725dd0.webp 400w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshi98duzgj318g0l2406_hu_28e34955d12250a.webp 760w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshi98duzgj318g0l2406_hu_e49d3460e2d21e32.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshi98duzgj318g0l2406_hu_bd8e4bac6a725dd0.webp&#34;
               width=&#34;760&#34;
               height=&#34;360&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Vistio ä¸»é¡µé¢
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;æ¢ç´¢&#34;&gt;æ¢ç´¢&lt;/h3&gt;
&lt;p&gt;åœ¨å…¨å±€èŒƒå›´å†…ï¼Œæ‚¨å°†çœ‹åˆ° Istio ç½‘æ ¼å†…æ‰€æœ‰è¯·æ±‚çš„æ€»å’Œã€‚å¦‚æœæ‚¨éƒ¨ç½²äº† istio-ingressgatewayï¼Œåˆ™å¯ä»¥é€‰æ‹©æ˜¾ç¤ºé€šè¿‡å…¶ä»–é…ç½®ä»ç½‘æ ¼å¤–éƒ¨æ¥æ”¶çš„æµé‡ï¼Œå‚è€ƒ&lt;a href=&#34;https://github.com/nmnellis/vistio#deploy-vistio-with-istio-ingress-gateway-helm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ Ingress Gateway éƒ¨ç½² Vistio&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨ç‚¹å‡» istio-mesh æ°”æ³¡ï¼Œæ‚¨å°†èƒ½å¤ŸæŸ¥çœ‹æ‚¨çš„ç½‘çŠ¶ç½‘ç»œã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-mesh-çš„ç½‘ç»œæµé‡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;istio mesh çš„ç½‘ç»œæµé‡&#34; srcset=&#34;
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshibdwcj3j318g0p8th1_hu_11a6a5cf4dee6ce7.webp 400w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshibdwcj3j318g0p8th1_hu_87a8bd5165bfc1ad.webp 760w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshibdwcj3j318g0p8th1_hu_a405b65ff149cbaf.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshibdwcj3j318g0p8th1_hu_11a6a5cf4dee6ce7.webp&#34;
               width=&#34;760&#34;
               height=&#34;432&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      istio mesh çš„ç½‘ç»œæµé‡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æ‚¨çš„ Istio ç½‘æ ¼ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è®¸å¤šå¯è§†åŒ–å·¥å…·æ¥å¸®åŠ©æ‚¨æŸ¥æ˜æ•…éšœçš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æŸ¥æ˜ç½‘ç»œé—®é¢˜&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æŸ¥æ˜ç½‘ç»œé—®é¢˜&#34; srcset=&#34;
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshicc7or1j318g0p8ahr_hu_2ed18be076019a90.webp 400w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshicc7or1j318g0p8ahr_hu_1f17ffac626061af.webp 760w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshicc7or1j318g0p8ahr_hu_f7bbdcdf164f7703.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshicc7or1j318g0p8ahr_hu_2ed18be076019a90.webp&#34;
               width=&#34;760&#34;
               height=&#34;432&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æŸ¥æ˜ç½‘ç»œé—®é¢˜
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨å±å¹•å³ä¸Šæ–¹çš„è¿‡æ»¤å™¨å¯ä»¥å¿«é€Ÿè¿‡æ»¤å‡ºé”™è¯¯ç‡è¾ƒé«˜çš„åº”ç”¨ç¨‹åºã€‚é€šè¿‡é«˜çº§é…ç½®ï¼Œå½“é”™è¯¯ç‡è¶…è¿‡ç‰¹å®šå€¼æ—¶ï¼Œä¹Ÿå¯ä»¥è§¦å‘è­¦æŠ¥ã€‚è­¦æŠ¥å°†æ˜¾ç¤ºç»™å®šåº”ç”¨ç¨‹åºçš„å½“å‰é”™è¯¯ç‡è¶‹åŠ¿ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é—®é¢˜æ’æŸ¥&#34;&gt;é—®é¢˜æ’æŸ¥&lt;/h3&gt;
&lt;p&gt;è®¿é—®&lt;a href=&#34;http://localhost:9091/graph&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:9091/graph&lt;/a&gt;ï¼Œå¦‚æœæ‚¨ä» vistio-api ä¸­çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼Œè¡¨ç¤ºæŸäº›åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚æ­£ç¡®çš„è¾“å‡ºæ˜¾ç¤ºåœ¨æ•™ç¨‹ä¸Šé¢ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-vistio-api-çš„ä¸æ­£ç¡®è¾“å‡º&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;vistio api çš„ä¸æ­£ç¡®è¾“å‡º&#34; srcset=&#34;
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshie7wxkyj30ks0f4myd_hu_526965ea301fcd97.webp 400w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshie7wxkyj30ks0f4myd_hu_8a7b624781bf3059.webp 760w,
               /blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshie7wxkyj30ks0f4myd_hu_da3bd77a315afab2.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/vistio-visualize-your-istio-mesh-using-netflixs-vizceral/00704eQkgy1fshie7wxkyj30ks0f4myd_hu_526965ea301fcd97.webp&#34;
               width=&#34;748&#34;
               height=&#34;544&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      vistio api çš„ä¸æ­£ç¡®è¾“å‡º
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1.&lt;/strong&gt;  æ£€æŸ¥ vistio-api æ—¥å¿—ä¸­æ˜¯å¦æœ‰é”™è¯¯â€”â€”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œvistio-api å°†è®°å½•ä¸ Prometheus é€šä¿¡æ—¶é‡åˆ°çš„ä»»ä½•é—®é¢˜ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl logs -n default -c vistio-api &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl -n default get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;vistio-api -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;2.&lt;/strong&gt; éªŒè¯ Prometheus æŸ¥è¯¢â€”â€”vistio-api ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢æ£€ç´¢å…¶æ•°æ®ã€‚æ‚¨åº”è¯¥ç¡®ä¿ Prometheus å†…éƒ¨çš„æ•°æ®éƒ½å­˜åœ¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Global Level Query&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sum&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;rate&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;istio_request_count&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;1m&lt;span class=&#34;o&#34;&gt;]))&lt;/span&gt; by &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;response_code&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Cluster Level Query&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sum&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;rate&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;istio_request_count&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;1m&lt;span class=&#34;o&#34;&gt;]))&lt;/span&gt; by &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;source_service,destination_service,response_code&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;3.&lt;/strong&gt; æäº¤ Issueâ€”â€”å¦‚æœé‡åˆ°é—®é¢˜æ— æ³•è§£å†³è¯·æäº¤ Issueï¼š&lt;a href=&#34;https://github.com/nmnellis/vistio/issues&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/nmnellis/vistio/issues&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio æœåŠ¡ç½‘æ ¼çš„å´›èµ·</title>
      <link>https://cloudnativecn.com/blog/the-rise-of-the-istio-service-mesh/</link>
      <pubDate>Tue, 12 Jun 2018 15:06:25 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/the-rise-of-the-istio-service-mesh/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://www.infoworld.com/article/3273547/containers/the-rise-of-the-istio-service-mesh.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•ç¡®ä¿å¾®æœåŠ¡ä¹‹é—´ç½‘ç»œé€šä¿¡çš„å¯é æ€§ã€å®‰å…¨æ€§å’Œå¯ç®¡ç†æ€§ï¼Ÿä½¿ç”¨æœåŠ¡ç½‘æ ¼å§ï¼&lt;/p&gt;
&lt;p&gt;åœ¨è¿‡å»ä¸€å¹´ä¸­ï¼Œ&lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;æœåŠ¡ç½‘æ ¼æŠ€æœ¯å¼•å‘å…³æ³¨åº¦å’Œå¸å¼•åŠ›çš„æŒç»­æå‡ï¼Œè¿™æ˜¯ä¸€ä»¶éå¸¸æœ‰è¶£çš„äº‹æƒ…ã€‚äº‹å®ä¸Šï¼Œåœ¨æˆ‘å†™è¿™ç¯‡æ–‡ç« æ—¶ï¼ŒIstio ä»…ä¸º 0.8 ç‰ˆæœ¬ï¼Œä½†å¯¹äºæœ€è¿‘ä¸¤å±Š&lt;a href=&#34;https://events.linuxfoundation.org/events/kubecon-cloudnativecon-europe-2018/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;KubeCon/CloudNativeCon&lt;/a&gt;æ´»åŠ¨è€Œè¨€ï¼Œå®ƒä¸€ç›´æ˜¯&lt;a href=&#34;https://events.linuxfoundation.org/events/kubecon-cloudnativecon-europe-2018/program/schedule/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çƒ­é—¨è¯é¢˜&lt;/a&gt;ï¼Œä»…åœ¨ä¸¹éº¦çš„æ´»åŠ¨ä¸­å°±æœ‰è¶…è¿‡åå‡ ä¸ªä¸åŒçš„æ´»åŠ¨è®®é¢˜ã€‚é‚£ä¹ˆå®ƒä¸ºä»€ä¹ˆä¼šè¿™æ ·å—æ¬¢è¿ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åœ¨æ·±å…¥ç ”ç©¶ Istio å—æ¬¢è¿çš„åŸå› ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæ¥ä»‹ç»ä¸€ä¸‹æœåŠ¡ç½‘æ ¼ã€‚è¿™æ˜¯ä¸€ä¸ªé€šç”¨æœ¯è¯­ï¼Œå…¶æ—©å·²è¢«æŠ•å…¥åœ¨å¤šä¸ªä¸åŒåœºæ™¯ä¸­ã€‚ä¾‹å¦‚å®šä¹‰ä¸åŒæ— çº¿è®¾å¤‡ä¹‹é—´çš„é€šä¿¡æ–¹æ³•ï¼›æˆ–è€…å®šä¹‰ä¸€ä¸ªç³»ç»Ÿï¼Œå„ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥ç›´æ¥é€šè¿‡å®ƒä¸å…¶ä»–åº”ç”¨ç¨‹åºé€šä¿¡ã€‚&lt;a href=&#34;https://istio.io/docs/concepts/what-is-istio/overview.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ€è¿‘&lt;/a&gt;ï¼Œè¿™ä¸ªæœ¯è¯­è¢«ç”¨æ¥è¡¨ç¤ºåº”ç”¨æˆ–å¾®æœåŠ¡çš„ç½‘ç»œï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„äº’ç›¸ä½œç”¨å…³ç³»ã€‚åè€…æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;äº‹å®ä¸Šçº¢å¸½å…¬å¸ä¸€ç›´å‚ä¸äº‘åŸç”Ÿå’Œå¾®æœåŠ¡é¢†åŸŸå»ºè®¾ï¼ŒåŒ…æ‹¬å››å¹´å‰å†³å®šå°† OpenShift å‘ Kubernetes å’Œ Docker è½¬å˜ï¼Œè¿™å¸®åŠ©æˆ‘ä»¬ç†è§£äº†æœåŠ¡ç½‘æ ¼æŠ€æœ¯ï¼Œå°¤å…¶æ˜¯ Istio çš„é‡è¦æ€§ã€‚æœ¬æ–‡å°†æ¢è®¨ä¸ºä»€ä¹ˆæˆ‘ä¼šåšä¿¡ Istio ä¼šå¾ˆå—æ¬¢è¿çš„å››ä¸ªåŸå› ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¾®æœåŠ¡å’Œè½¬å‹&#34;&gt;å¾®æœåŠ¡å’Œè½¬å‹&lt;/h2&gt;
&lt;p&gt;çºµè§‚ä½ æ•´ä¸ªèŒä¸šç”Ÿæ¶¯ï¼Œæˆ–è€…ç»“åˆå¦‚ä»Šçš„å·¥ä½œï¼Œä½ å¯èƒ½å·²ç»å‘ç°ä»ä»£ç å®Œæˆå¼€å‘åˆ°éƒ¨ç½²è‡³ç”Ÿäº§ä¹‹é—´çš„æ—¶é—´ä¸æ–­è¢«å»¶é•¿ï¼Œä»¥è‡³äºå¼€å‘èµ„æºè¢«è½¬ç§»åˆ°å…¶ä»–é¡¹ç›®ï¼ŒåŒæ—¶ä¹Ÿä½¿ä½ çš„äº§å“åé¦ˆå‘¨æœŸå˜å¾—æ— æ•ˆæˆ–æ— å…³ç´§è¦ã€‚ä¸ºäº†ç¼©çŸ­äº¤ä»˜æ—¶é—´ï¼Œä¸€äº›å…¬å¸å†³å®šä»¥åŠŸèƒ½æœåŠ¡æ¶æ„æˆ–å¾®æœåŠ¡æ¶æ„æ¥å°†å¤§å‹åº”ç”¨æ‹†æ•£ï¼Œä»¥æ­¤æé«˜æ•ˆç‡ã€‚å³æ›¾ç»å…·æœ‰å¤šç§åŠŸèƒ½çš„å•ä¸ªåº”ç”¨ç¨‹åºï¼ˆåŒ…ï¼‰è¢«åˆ‡åˆ†æˆå¯ç‹¬ç«‹æ›´æ–°çš„å•ä¸ªç¨‹åºåŒ…ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å½“ç„¶æ˜¯æœ‰ä»·å€¼çš„ï¼Œä½†åŒæ—¶ä¹Ÿè¦æ‰¿è®¤ï¼Œä½¿ç”¨è¿™ç§æ¶æ„éœ€è¦å¯¹å•ç‹¬çš„æœåŠ¡å’Œå®ƒä»¬ä¹‹é—´çš„æ¥å£è¿›è¡Œæ›´å¤šçš„å¼€å‘æ²»ç†ã€‚ä¾‹å¦‚æ›¾ç»å®šä¹‰åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨çš„ä¸€éƒ¨åˆ† API è°ƒç”¨å…³ç³»ç°åœ¨ä¸Šå‡åœ¨åˆ°ç½‘ç»œå±‚ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;Christian Posta çš„æ¼”è®²â€œ&lt;a href=&#34;https://www.slideshare.net/ceposta/the-hardest-part-of-microservices-calling-your-services&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¾®æœåŠ¡ä¸­æœ€å›°éš¾çš„éƒ¨åˆ†ï¼šè°ƒç”¨ä½ çš„æœåŠ¡&lt;/a&gt;â€è°ˆåˆ°äº†ä¸€ä¸ªé‡è¦é—®é¢˜ã€‚å½“è°ƒç”¨ API æ—¶ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºä½ åœ¨å¤„ç† A å’Œ B ä¹‹é—´çš„ç›´æ¥é›†æˆè°ƒç”¨ï¼ˆä¸‹å›¾ 1ï¼‰ã€‚ç„¶è€Œè®¡ç®—æœºç½‘ç»œå¹¶ä¸ä¼šé’ˆå¯¹ç›´æ¥é€šä¿¡è¿›è¡Œä¼˜åŒ–ï¼ˆä¸‹å›¾ 2ï¼‰ã€‚å› æ­¤åœ¨æŸäº›æƒ…å†µï¼Œå°¤å…¶å½“åº”ç”¨å¤„äºä½ æ­£è€ƒè™‘æˆ–ä½¿ç”¨çš„äº‘ç¯å¢ƒä¸­æ—¶ï¼Œä½ ä¸å¯é¿å…ä¸”ä¸å¾—ä¸è€ƒè™‘è¿™äº›ä¸åŒçš„å¤±æ§ç‰©ç†å’Œè™šæ‹Ÿç½‘ç»œè®¾å¤‡ã€‚ä¾‹å¦‚ï¼Œå°±å¯èƒ½å­˜åœ¨è¿™æ ·ä¸€ç§æƒ…å†µï¼šå…¶ä¸­ä¸€å°è®¾å¤‡çš„æ€§èƒ½ä½äºæœ€ä½³æ€§èƒ½ï¼Œè¿™å°†å½±å“æ•´ä¸ªåº”ç”¨ç¨‹åºçš„å“åº”æ—¶é—´ï¼ˆä¸‹å›¾ 3ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-a-å’Œ-b-ä¹‹é—´çš„è°ƒç”¨å…³ç³»å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;A å’Œ B ä¹‹é—´çš„è°ƒç”¨å…³ç³»å›¾&#34; srcset=&#34;
               /blog/the-rise-of-the-istio-service-mesh/78a165e1gy1fs7fmkvibwj20jf0dfq40_hu_ce5acbed19d6edc7.webp 400w,
               /blog/the-rise-of-the-istio-service-mesh/78a165e1gy1fs7fmkvibwj20jf0dfq40_hu_337e95f20ad08180.webp 760w,
               /blog/the-rise-of-the-istio-service-mesh/78a165e1gy1fs7fmkvibwj20jf0dfq40_hu_da12e001339470bc.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/the-rise-of-the-istio-service-mesh/78a165e1gy1fs7fmkvibwj20jf0dfq40_hu_ce5acbed19d6edc7.webp&#34;
               width=&#34;699&#34;
               height=&#34;483&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      A å’Œ B ä¹‹é—´çš„è°ƒç”¨å…³ç³»å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å¾®æœåŠ¡å…ˆé©±å’Œ-netflix-oss&#34;&gt;å¾®æœåŠ¡å…ˆé©±å’Œ Netflix OSS&lt;/h2&gt;
&lt;p&gt;æœ‰äº›å…¬å¸ä¼¼ä¹æ˜¯ä¸ºäº†äº‘è®¡ç®—è€Œç”Ÿçš„ã€‚ä¸ºäº†åœ¨äº‘ä¸­æä¾›å¼¹æ€§æœåŠ¡ï¼Œåº”ç”¨ç¨‹åºä¸å¾—ä¸ä¿æŠ¤è‡ªå·±å…å—ç¯å¢ƒå¼‚å¸¸å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;Netflix æ„å»ºå¹¶éšå&lt;a href=&#34;https://netflix.github.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼€æº&lt;/a&gt;äº†ä¸€ç³»åˆ—æ¶‰åŠè¯¸å¦‚æ–­è·¯ã€è¾¹ç¼˜è·¯ç”±ã€æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½çš„ Java æŠ€æœ¯è§£å†³æ–¹æ¡ˆã€‚è¿™äº›ç»„ä»¶ä½¿åº”ç”¨èƒ½å¤Ÿæ›´å¥½åœ°æ§åˆ¶é€šä¿¡ï¼Œä»è€Œæé«˜æ•´ä½“å¯ç”¨æ€§ã€‚ä¸ºäº†æµ‹è¯•å¹¶ç¡®ä¿ç»„ä»¶çš„å¼¹æ€§ï¼ŒNetflix è¿˜ä½¿ç”¨äº†&lt;a href=&#34;http://principlesofchaos.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ··æ²Œå·¥ç¨‹&lt;/a&gt;ï¼Œé€šè¿‡å°†å„ç§ç°å®ä¸­å¯èƒ½å­˜åœ¨çš„é—®é¢˜æ³¨å…¥åˆ°åº”ç”¨ç¨‹åºçš„ç½‘ç»œä¸­ï¼Œä»¥ä¾¿èƒ½åœ¨ä»»ä½•ç»™å®šæ—¶é—´ä¸­æ–­å·¥ä½œæµã€‚Netflix å¼€å‘çš„æŠ€æœ¯ç»„åˆå…è®¸å…¶åº”ç”¨ç¨‹åºæŠ•å…¥åˆ°ä¸€ä¸ªä»¥åº”ç”¨ç¨‹åºä¸ºä¸­å¿ƒçš„ç½‘ç»œä¸­ï¼Œè¿™å®é™…ä¸Šå°±æ˜¯æœåŠ¡ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ„å»º Netflix OSS å †æ ˆçš„æ—¶ä»£ï¼Œè™šæ‹Ÿæœºæ˜¯åœ¨äº‘ä¸­è¿è¡Œåº”ç”¨ç¨‹åºçš„å”¯ä¸€æ–¹å¼ã€‚å› æ­¤ Netflix é€‰æ‹© Java ä½œä¸ºå¼€å‘è¯­è¨€æ¥æ„å»ºæœåŠ¡ç½‘æ ¼åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº† Netflix OSS å †æ ˆçš„çº¯ Java ä¾èµ–ï¼Œå¦ä¸€ä¸ªæŒ‘æˆ˜æ˜¯ä¸ºäº†å®ç°æœåŠ¡ç½‘æ ¼åŠŸèƒ½ï¼Œå¼€å‘äººå‘˜å¿…é¡»å°† Java åº“åŒ…å«åœ¨å…¶åº”ç”¨ç¨‹åºä¸­ï¼Œå¹¶åœ¨ä»£ç ä¸­å¼•ç”¨æ¥ä½¿ç”¨è¿™äº›ç»„ä»¶ã€‚ä½†åœ¨å½“æ—¶ï¼Œé‚£äº›å¸Œæœ›å¼ºåˆ¶ä½¿ç”¨è¿™äº›æŠ€æœ¯çš„å…¬å¸æ— æ³•åœ¨å¹³å°çº§è¿›è¡Œå¦‚ä¸Šå·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;éšç€&lt;a href=&#34;https://www.infoworld.com/article/3268073/containers/what-is-kubernetes-container-orchestration-explained.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes&lt;/a&gt;çš„æ¥ä¸´ï¼Œè¯¸å¦‚æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½æˆä¸ºå¹³å°æœ¬èº«çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”å¹³å°å…è®¸ç”¨ä»»ä½•è¯­è¨€ç¼–å†™çš„åº”ç”¨ç¨‹åºéƒ½å¯ä»¥ä½¿ç”¨ã€‚é€šè¿‡å£°æ˜å¼å’Œæ´»åŠ¨çŠ¶æ€ç®¡ç†ï¼ŒKubernetes è¿˜èƒ½å¤Ÿé€šè¿‡è‡ªåŠ¨é‡å¯æ— å“åº”çš„åº”ç”¨æ¥æé«˜æ•´ä½“åº”ç”¨çš„å¯ç”¨æ€§ã€‚åœ¨å½“ä»Šä¸–ç•Œï¼ŒKubernetes å’Œå®¹å™¨æ˜¯è¿è¡Œå¾®æœåŠ¡åº”ç”¨ç¨‹åºçš„æ ‡å‡†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­ï¼Œä½ çš„åº”ç”¨ç¨‹åºä»¥ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ç»„æˆâ€œpodâ€è¿è¡Œã€‚åœ¨ pod ä¸­è¿è¡Œå¤šä¸ªå®¹å™¨çš„æŠ€æœ¯æœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºâ€œsidecarâ€ï¼Œå…¶å®è´¨ä¸Šæ˜¯ä¸€ç§å°†ä½ çš„åº”ç”¨ç¨‹åºæ‹†æ•£ï¼Œå°†å­æ¨¡å—è¿è¡Œåœ¨å…±äº«éš”ç¦»ç©ºé—´ï¼ˆpodï¼‰çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes ä¸º Istio è¿™æ ·çš„æŠ€æœ¯çš„å´›èµ·åˆ›é€ äº†æœ‰åˆ©æ¡ä»¶ã€‚å‡ºè¡Œå…±äº«å…¬å¸ Lyft å·²ç»å¼€å§‹é€šè¿‡æ™ºèƒ½ä»£ç†&lt;a href=&#34;https://github.com/envoyproxy/envoy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;æ¥æä¾›å¾®æœåŠ¡éƒ¨ç½²æ‰€éœ€çš„å¼¹æ€§å’ŒåŠ¨æ€è·¯ç”±åŠŸèƒ½ã€‚sidecar å®¹å™¨å’Œ Envoy è¿™ç±»æ¶æ„å…è®¸ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºå®ä¾‹é™„åŠ ä¸€ä¸ªè½»é‡çº§ä»£ç†ï¼Œä»¥æ”¯æŒæœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€æ–­è·¯å™¨ã€é“¾è·¯è·Ÿè¸ªä»¥åŠæœåŠ¡ç½‘æ ¼çš„å…¶ä»–åŠŸèƒ½ã€‚å°†å®ƒä¸ä¸€ä¸ªæ§åˆ¶é¢æ¿ç»“åˆï¼Œå¹¶æ·»åŠ æœåŠ¡æ²»ç†å’Œ Envoy å®ä¾‹é…ç½®ç®¡ç†åŠŸèƒ½ï¼Œä½ å°±æ‹¥æœ‰äº† Istioã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ‹¥æŠ±åˆ†å¸ƒå¼æ¶æ„&#34;&gt;æ‹¥æŠ±åˆ†å¸ƒå¼æ¶æ„&lt;/h2&gt;
&lt;p&gt;æœ€åï¼ŒIstio å’ŒæœåŠ¡ç½‘æ ¼é€šå¸¸ä¸â€œæ‹¥æŠ±â€&lt;a href=&#34;https://en.wikipedia.org/wiki/Fallacies_of_distributed_computing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆ†å¸ƒå¼è®¡ç®—çš„è°¬è®º&lt;/a&gt;æœ‰å…³ã€‚æ¢è€Œè¨€ä¹‹ï¼Œâ€&lt;strong&gt;Istio å…è®¸åº”ç”¨ç¨‹åºå‡å®šç½‘ç»œæ˜¯å¯é çš„ã€å¿«é€Ÿçš„ã€å®‰å…¨çš„ã€ä¸å˜çš„ç­‰ç­‰â€”â€”è¿™ä½¿å¾—åˆ†å¸ƒå¼è®¡ç®—çš„è°¬è®ºä¸å†æ˜¯è°¬è®º&lt;/strong&gt; â€œã€‚è¯´ Istio å’Œ Kubernetes å¯ä»¥è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜ï¼Œä½†å¿½è§†è¿™äº›è°¬è®ºå¯èƒ½å¯¼è‡´ä¼ä¸šçŠ¯å¤§é”™è¯¯ã€‚ä¼ä¸šå¿…é¡»æ¥å—è¿™æ ·ä¸€ä¸ªäº‹å®ï¼šå½“ä½ æœ‰å¤šä¸ªå¾®æœåŠ¡å’ŒåŠŸèƒ½æœåŠ¡äº’ç›¸äº¤äº’æ—¶ï¼Œä½ å°±å¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;è¯·å‚é˜…ä¸‹é¢çš„åˆ†å¸ƒå¼è®¡ç®—è°¬è®ºçš„å®Œæ•´åˆ—è¡¨ä»¥åŠ Istio çš„è§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;è°¬è®º&lt;/th&gt;
          &lt;th&gt;Istio çš„è§£å†³æ–¹æ¡ˆ&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;å¯é ç½‘ç»œ&lt;/td&gt;
          &lt;td&gt;æ–­è·¯å’Œè´Ÿè½½å‡è¡¡&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å»¶è¿Ÿä¸ºé›¶&lt;/td&gt;
          &lt;td&gt;è¶…æ—¶å’Œé‡è¯•&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å¿½ç•¥å¸¦å®½&lt;/td&gt;
          &lt;td&gt;æœåŠ¡è¯„çº§å’Œé™åˆ¶&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å®‰å…¨ç½‘ç»œ&lt;/td&gt;
          &lt;td&gt;ç›¸äº’ TLS&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ‹“æ‰‘ä¸å¯æ”¹&lt;/td&gt;
          &lt;td&gt;æœåŠ¡å‘ç°&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å•ä¸€ç®¡ç†å‘˜&lt;/td&gt;
          &lt;td&gt;åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;é›¶ä¼ è¾“æˆæœ¬&lt;/td&gt;
          &lt;td&gt;gRPC å’Œ Protobuf&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;åŒè´¨åŒ–ç½‘ç»œ&lt;/td&gt;
          &lt;td&gt;åŠ¨æ€è·¯ç”±ï¼ŒA/B æµ‹è¯•å’Œé‡‘ä¸é›€éƒ¨ç½²&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;åœ¨æˆ‘ä¸ OpenShift å®¢æˆ·çš„æ²Ÿé€šä¸­ï¼Œæˆ‘ç»å¸¸å‘ç°ä»–ä»¬ç”±äºè‡ªèº«éœ€æ±‚ï¼Œå·²ç»å®ç°äº†ç±»ä¼¼ Netflix æ¨¡å¼çš„åŠŸèƒ½ã€‚æˆ‘ä¹Ÿå¯¹å®ç°è¿™äº›åŠŸèƒ½çš„å›¢é˜Ÿå¾ˆæœ‰å…´è¶£ï¼Œç»å¸¸å¬åˆ°ä»–ä»¬è¯´â€œæˆ‘ä»¬æ˜¯æ–­è·¯å°ç»„â€æˆ–â€œæˆ‘ä»¬æ˜¯æœåŠ¡å‘ç°å°ç»„â€ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºè‡ªå·±çš„æœåŠ¡ç½‘æ ¼åŠŸèƒ½çš„å…¬å¸ç°åœ¨æœ‰æœºä¼šä½¿ç”¨ Kubernetes å’Œ Istioã€‚é€šè¿‡ä½¿ç”¨è¿™äº›è¢«æ ‡å‡†åŒ–çš„å¼€æºæŠ€æœ¯ï¼Œä»–ä»¬å¯ä»¥è·å¾—ç”±å¤§å‹ç¤¾åŒºå¼€å‘çš„åŠŸèƒ½ã€æ•´ç†çŸ¥è¯†å’Œç”¨ä¾‹ï¼Œå¹¶å¸®åŠ©ä»–ä»¬å®ç°æ›´å…·å¼¹æ€§çš„åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶ä»¥æ›´ä½çš„æˆæœ¬æ›´å¿«åœ°å°†äº§å“æ¨å‘å¸‚åœºã€‚&lt;/p&gt;
&lt;p&gt;ä½œè€… Diogenes Rettori æ˜¯&lt;a href=&#34;https://www.redhat.com/en/technologies/cloud-computing/openshift&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çº¢å¸½ OpenShift&lt;/a&gt;çš„ä¸»ä»»äº§å“ç»ç†ã€‚åœ¨åŠ å…¥ OpenShift å›¢é˜Ÿä¹‹å‰ï¼Œä»–ä¸“æ³¨äºçº¢å¸½ JBoss ä¸­é—´ä»¶çš„å®¢æˆ·åŸ¹è®­ã€‚Diogenes æ‹¥æœ‰å¼ºå¤§çš„å·¥ç¨‹èƒŒæ™¯ï¼Œæ›¾ä¸ºçˆ±ç«‹ä¿¡å’Œ IBM ç­‰å…¬å¸å·¥ä½œã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åœ¨ Istio ä¸­ä½¿ç”¨ OpenTracing Baggage è¿›è¡Œä¼ æ’­å’Œè·¯ç”±</title>
      <link>https://cloudnativecn.com/blog/istio-routing-using-opentracing-baggage-distributed-context-propagation/</link>
      <pubDate>Fri, 08 Jun 2018 16:01:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-routing-using-opentracing-baggage-distributed-context-propagation/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://medium.com/jaegertracing/istio-routing-using-opentracing-baggage-distributed-context-propagation-ed8d787a4bef&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç°ä»£æœåŠ¡ç½‘æ ¼æ¶æ„æä¾›äº†å¾ˆå¤šçš„æ–°åŠŸèƒ½ï¼ŒåŸºç¡€è®¾æ–½ç›¸å…³çš„ä¾èµ–éƒ¨åˆ†è¢«é€æ­¥ä»ä»£ç ä¸­ç§»é™¤ï¼Œæå¤§çš„é™ä½äº†ç¼–ç å·¥ä½œé‡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿™ä¸€æ¶æ„çš„æ™ºèƒ½è·¯ç”±åŠŸèƒ½è¿˜æŠŠé‡‘ä¸é›€å‘å¸ƒä»¥åŠç±»ä¼¼åŠŸèƒ½å¤§å¤§çš„ç®€åŒ–äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥çš„å†…å®¹ä¼šæ¢è®¨ä¸€ä¸‹ï¼ŒIstio è·¯ç”±è§„åˆ™æ˜¯å¦‚ä½•ä½¿ç”¨ OpenTracing Baggage çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-isto-è·¯ç”±è§„åˆ™&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Isto è·¯ç”±è§„åˆ™&#34; srcset=&#34;
               /blog/istio-routing-using-opentracing-baggage-distributed-context-propagation/00704eQkgy1fs3tvxhiqnj30a60h3wg2_hu_ece34f7181321120.webp 400w,
               /blog/istio-routing-using-opentracing-baggage-distributed-context-propagation/00704eQkgy1fs3tvxhiqnj30a60h3wg2_hu_441cedc6a154369b.webp 760w,
               /blog/istio-routing-using-opentracing-baggage-distributed-context-propagation/00704eQkgy1fs3tvxhiqnj30a60h3wg2_hu_e0bcf3fb5c115d4d.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/istio-routing-using-opentracing-baggage-distributed-context-propagation/00704eQkgy1fs3tvxhiqnj30a60h3wg2_hu_ece34f7181321120.webp&#34;
               width=&#34;366&#34;
               height=&#34;615&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Isto è·¯ç”±è§„åˆ™
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æƒ³åƒä¸€ä¸ªåœºæ™¯ï¼Œè¿™ä¸ªåœºæ™¯ä¸­æˆ‘ä»¬éœ€è¦é€šè¿‡ &lt;code&gt;User-Agent&lt;/code&gt; Header æ¥é‰´åˆ« Safari ç”¨æˆ·ï¼Œå¹¶æŠŠå®ƒä»¬é‡å®šå‘åˆ°æœåŠ¡çš„ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬å»ã€‚è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„é‡‘ä¸é›€åœºæ™¯ï¼šæ–°ç‰ˆæœ¬å‘å¸ƒæ—¶ï¼Œé¦–å…ˆå¼€æ”¾ç»™ä¸€éƒ¨åˆ†ç”¨æˆ·ã€‚ç„¶è€Œå¾ˆæ˜æ˜¾åªæœ‰ç¬¬ä¸€ä¸ªæœåŠ¡èƒ½å¤Ÿæ¥æ”¶åˆ° &lt;code&gt;User-Agent&lt;/code&gt; å¤´ï¼Œå¦‚æœè·¯ç”±è§„åˆ™ä¸­æ¶‰åŠåˆ°è°ƒç”¨å…³ç³»å›¾ä¸­ä½ç½®è¾ƒä½ï¼ˆé åï¼‰çš„æœåŠ¡ï¼Œå°±ä¸å¾—ä¸æŠŠè¿™ä¸ª Header ä¿¡æ¯ä¼ æ’­ç»™æ‰€æœ‰é€”ä¸­ç»è¿‡çš„æœåŠ¡ã€‚è¿™æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ä¸Šä¸‹æ–‡ä¼ æ’­çš„å…¸å‹ç”¨ä¾‹ï¼Œå¾ˆå¤šè·Ÿè¸ªç³»ç»Ÿéƒ½æœ‰è¿™ä¸ªåŠŸèƒ½ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥ä¼šçœ‹çœ‹ Jaeger çš„ OpenTracing å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;Baggage æ¡ç›®æ˜¯å­—ç¬¦ä¸²ç»„æˆçš„é”®å€¼å¯¹ï¼Œå’Œ &lt;code&gt;Span/SpanContext&lt;/code&gt; äº’ç›¸å…³è”ï¼Œåœ¨ä¸€ä¸ª Trace çš„èŒƒå›´å†…ï¼Œä¼šåœ¨æ‰€æœ‰çš„ä¸‹æ¸¸ Span ä¸­è¿›è¡Œä¼ æ’­ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ çš„ç½‘æ ¼ä¸­ä½¿ç”¨çš„æ˜¯ OpenTracingï¼Œé‚£ä¹ˆå°±å·²ç»æœ‰è¿™ä¸ªåŠŸèƒ½äº†ï¼›å¦‚æœä¸æ˜¯ï¼Œé‚£å°±æœ‰ç‚¹ä¸å¹¸äº†ï¼šéœ€è¦é€šè¿‡å…¶ä»–çš„è·Ÿè¸ª Header æ¥ä¼ é€’ &lt;code&gt;User-Agent&lt;/code&gt; å€¼äº†ï¼Œè¿™æ ·å°±éœ€è¦ä¿®æ”¹é€”ç»çš„æ‰€æœ‰æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;Istio ç¼ºçœä½¿ç”¨çš„ B3 ä¼ æ’­æ˜¯æ²¡æœ‰æä¾› Baggage å¤´çš„ã€‚ä½†æ˜¯å¯ä»¥ç”¨ Braveï¼ˆZipkin çš„ Java å®¢æˆ·ç«¯ï¼‰æ¥é…ç½® Baggage æ”¯æŒã€‚ä¸€èˆ¬ä¼šä½¿ç”¨ &lt;code&gt;baggage-key:value&lt;/code&gt; çš„æ ¼å¼ã€‚Jaeger å®ç°äº†ä¸€ä¸ª B3 è§£ç å™¨ï¼Œä¹Ÿç”¨åŒæ ·çš„æ ¼å¼æ¥å¤„ç† Baggageã€‚å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ B3 Baggage å®ç°çš„è¿›åº¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;demo&#34;&gt;Demo&lt;/h2&gt;
&lt;p&gt;å¯ä»¥åœ¨å½“å‰çš„æ´»åŠ¨ Span ä¸­è¿™æ ·è®¾ç½® Baggageï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;tracer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;activeSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setBaggageItem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;user-agent&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;userAgent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å¿…é¡»åœ¨ç¬¬ä¸€ä¸ªæœåŠ¡ä¸­å®Œæˆã€‚æœ€åä¸€ä¸ªéœ€è¦å®Œæˆçš„ä»»åŠ¡å°±æ˜¯å®šä¹‰ä¸€ä¸ªè¯†åˆ« Baggage Header çš„è·¯ç”±ã€‚ä¸‹é¢çš„è·¯ç”±å®šä¹‰ä¼šæŸ¥çœ‹è¯·æ±‚æ˜¯å¦åŒ…å«äº†å¸¦æœ‰ &lt;code&gt;user-agent:Safari&lt;/code&gt; æ¡ç›®çš„ Baggageï¼Œå¦‚æœæœ‰ï¼Œå°±è¿›è¡Œè½¬å‘ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;config.istio.io/v1alpha2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;RouteRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;recommendation-safari&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tutorial&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;recommendation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;precedence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;baggage-user-agent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;.*Safari.*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæ˜¯æ–°ç‰ˆæœ¬çš„ Istioï¼ˆ0.8.0 ä»¥åï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;recommendation-safari&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;recommendation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;baggage-user-agent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;.*Safari.*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;recommendation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;recommendation-destination&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;recommendation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subsets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æ‰€æœ‰çš„é…ç½®éƒ½å·²ç»å®Œæˆï¼ŒSafari ç”¨æˆ·ä¼šè¢«é‡å®šå‘åˆ°æ¨èçš„ v2 æœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç›¸å…³é“¾æ¥&#34;&gt;ç›¸å…³é“¾æ¥&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://opentracing.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenTracing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/opentracing/specification/blob/master/specification.md#set-a-baggage-item&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenTracing baggage è§„èŒƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/jaegertracing/jaeger/issues/755#issuecomment-393929718&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Jaeger å®¢æˆ·ç«¯çš„ B3 Baggage æ”¯æŒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/redhat-developer-demos/istio-tutorial&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenShift çš„ Istio æ•™ç¨‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kiali.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kiali&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Istio Mixer Cache å·¥ä½œåŸç†ä¸æºç åˆ†æ part1ï¼åŸºæœ¬æ¦‚å¿µ</title>
      <link>https://cloudnativecn.com/blog/istio-mixer-cache-part1-concepts/</link>
      <pubDate>Thu, 07 Jun 2018 19:16:21 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/istio-mixer-cache-part1-concepts/</guid>
      <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« å°†è¯¦ç»†ä»‹ç» Istio ä¸­ Mixer Cache çš„å·¥ä½œåŸç†ï¼Œä¸ºäº†é¿å…ç©ºè°ˆï¼Œå°†å¼•å…¥å¹¿å¤§ç¨‹åºå‘˜åŒå­¦å–œé—»ä¹è§çš„æºç åˆ†æç¯èŠ‚ï¼Œå¹¶ç»“åˆ Mixer çš„æ¥å£ APIï¼Œè¯¦ç»†å±•ç° Mixer Cache çš„å„ç§ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é¢„è­¦ï¼šMixer Cache ç³»åˆ—æ–‡ç« é™¤äº†æœ¬æ–‡è®²è¿°æ¦‚å¿µæ¯”è¾ƒç®€å•å¤–ï¼Œå…¶å®ƒæ–‡ç« ä¼šåŒ…å«å¤§é‡å¤æ‚å’Œç¹ççš„ç»†èŠ‚ï¼ŒåŒ…æ‹¬è®¾è®¡ï¼å®ç°ï¼API ç­‰ï¼Œé€‚åˆè¿½æ±‚æ·±åº¦çš„åŒå­¦ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;é˜…è¯»æœ¬ç³»åˆ—æ–‡ç« å‰ï¼Œè¯·ç¡®ä¿å¯¹ Service Mesh å’Œ Istio æœ‰åŸºæœ¬çš„è®¤çŸ¥ï¼Œä¸´æ—¶ä¸Šè½¦çš„åŒå­¦è¯·è‡ªè§‰è¡¥è¯¾ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://skyao.io/publication/service-mesh-next-generation-microservice/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Meshï¼šä¸‹ä¸€ä»£å¾®æœåŠ¡&lt;/a&gt;: Service Mesh ä»‹ç»&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://skyao.io/publication/istio-introduction/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼æ–°ç”Ÿä»£-Istio&lt;/a&gt;ï¼šIstio ä»‹ç»&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­¤å¤–å¦‚æœå¯¹ Mixer èŒè´£å’Œè®¾è®¡ä¸ç†Ÿæ‚‰çš„åŒå­¦ï¼Œè¯·å…ˆé˜…è¯»ä¸‹æ–‡ï¼ˆæœ¬æ–‡å¯ä»¥ç†è§£ä¸ºæ˜¯æ­¤æ–‡çš„ç•ªå¤–ç¯‡ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://skyao.io/post/201804-servicemesh-architecture-introspection/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Service Mesh æ¶æ„åæ€ï¼šæ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢çš„ç•Œçº¿è¯¥å¦‚ä½•åˆ’å®šï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œå‡ºäºå¯¹ Istio æ€§èƒ½çš„æ‹…å¿§å’Œç–‘è™‘ï¼Œæˆ‘ä»¬æ¢è®¨äº† Mixer çš„æ¶æ„è®¾è®¡ï¼Œå·¥ä½œåŸç†ï¼Œå¹¶çŒœæµ‹äº† Mixer çš„è®¾è®¡åˆè¡·ã€‚æœŸé—´ï¼Œæˆ‘ä»¬ä»‹ç»åˆ°ï¼Œä¸ºäº†ä¿è¯è¿è¡Œæ—¶æ€§èƒ½ï¼Œé¿å…æ¯æ¬¡è¯·æ±‚éƒ½è¿œç¨‹è®¿é—® Mixerï¼ŒIstio ç‰¹æ„ä¸º Mixer å¢åŠ äº†ç¼“å­˜ã€‚å½“æ—¶å‡ºäºç¯‡å¹…è€ƒè™‘ï¼Œæˆ‘ä»¬æ²¡æœ‰æ·±å…¥åˆ°ç¼“å­˜çš„ç»†èŠ‚ï¼Œç°åœ¨å°†åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« ä¸­å°±è¿™ä¸€ç‚¹æ·±å…¥å±•å¼€ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å±•å¼€ä»£ç å®ç°ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä»‹ç»å’Œ Mixer Cache ç›¸å…³çš„åŸºæœ¬æ¦‚å¿µã€‚&lt;/p&gt;
&lt;h2 id=&#34;å±æ€§&#34;&gt;å±æ€§&lt;/h2&gt;
&lt;p&gt;å±æ€§ï¼ˆattributeï¼‰æ˜¯ Istio ä¸­éå¸¸ä¸€ä¸ªå…³é”®è®¾è®¡ï¼Œå¯¹äº Mixer æ›´æ˜¯ç‰¹åˆ«é‡è¦ï¼Œå¯ä»¥è¯´ Mixer çš„æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯å»ºç«‹åœ¨å±æ€§è¿™ä¸ªæ ¸å¿ƒæ¦‚å¿µä¹‹ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;æ¬è¿ä¸€æ®µå®˜æ–¹æ–‡æ¡£çš„ä»‹ç»ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Istio ä½¿ç”¨ &lt;em&gt;å±æ€§&lt;/em&gt; æ¥æ§åˆ¶åœ¨æœåŠ¡ç½‘æ ¼ä¸­è¿è¡Œçš„æœåŠ¡çš„è¿è¡Œæ—¶è¡Œä¸ºã€‚å±æ€§æ˜¯å…·æœ‰åç§°å’Œç±»å‹çš„å…ƒæ•°æ®ç‰‡æ®µï¼Œç”¨ä»¥æè¿°å…¥å£å’Œå‡ºå£æµé‡ï¼Œä»¥åŠè¿™äº›æµé‡æ‰€å±çš„ç¯å¢ƒã€‚Istio å±æ€§æºå¸¦ç‰¹å®šä¿¡æ¯ç‰‡æ®µï¼Œä¾‹å¦‚ API è¯·æ±‚çš„é”™è¯¯ä»£ç ï¼ŒAPI è¯·æ±‚çš„å»¶è¿Ÿæˆ– TCP è¿æ¥çš„åŸå§‹ IP åœ°å€ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;å±æ€§çš„å½¢å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;request.path: xyz/abc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;request.size: 234&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;request.time: 12:34:56.789 04/17/2017&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;source.ip: 192.168.0.1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;target.service: example&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å±æ€§è¯æ±‡&#34;&gt;å±æ€§è¯æ±‡&lt;/h2&gt;
&lt;p&gt;éœ€è¦ç‰¹åˆ«å¼ºè°ƒçš„æ˜¯ï¼š&lt;strong&gt;Istio ä¸­å¯ä»¥ä½¿ç”¨çš„å±æ€§æ˜¯å›ºå®šçš„&lt;/strong&gt;ï¼Œè€Œä¸æ˜¯éšæ„è®¾å®šçš„ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œå’Œä¸€èˆ¬ç³»ç»Ÿä¸­çš„ç±»ä¼¼è®¾è®¡æœ‰æ ¹æœ¬æ€§çš„å·®å¼‚ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¯ä¸ªç»™å®šçš„ Istio éƒ¨ç½²æœ‰å›ºå®šçš„èƒ½å¤Ÿç†è§£çš„å±æ€§è¯æ±‡ã€‚è¿™ä¸ªç‰¹å®šçš„è¯æ±‡ç”±å½“å‰éƒ¨ç½²ä¸­æ­£åœ¨ä½¿ç”¨çš„å±æ€§ç”Ÿäº§è€…é›†åˆå†³å®šã€‚Istio ä¸­é¦–è¦çš„å±æ€§ç”Ÿäº§è€…æ˜¯ Envoyï¼Œç„¶åç‰¹å®šçš„ Mixer é€‚é…å™¨å’ŒæœåŠ¡ä¹Ÿä¼šäº§ç”Ÿå±æ€§ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;è¿™äº›å°†è¢« Istio ä½¿ç”¨çš„å±æ€§é›†åˆï¼Œè¢«ç§°ä¸ºå±æ€§è¯æ±‡ï¼Œæ€»æ•°å¤§æ¦‚æ˜¯ 50 ä¸ªï¼Œè¯¦ç»†åˆ—è¡¨å¯ä»¥å‚çœ‹æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/docs/reference/config/mixer/attribute-vocabulary.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Attribute Vocabulary&lt;/a&gt;ï¼šæ¥è‡ª Istio å®˜æ–¹æ–‡æ¡£ä¸­çš„ Reference&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¼•ç”¨å±æ€§&#34;&gt;å¼•ç”¨å±æ€§&lt;/h2&gt;
&lt;p&gt;å¼•ç”¨å±æ€§ï¼ˆReferenced Attributesï¼‰æ˜¯åœ¨ Mixer Cache çš„è®¾è®¡å’Œå®ç°ä¸­å¼•å…¥çš„ä¸€ä¸ªéå¸¸ç‰¹åˆ«çš„æ¦‚å¿µã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰¹åˆ«æé†’ï¼šè¦ç†è§£ Mixer Cacheï¼Œå¿…é¡»æ·±åˆ»ç†è§£ Referenced Attritutesã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;h3 id=&#34;ä»€ä¹ˆæ˜¯å¼•ç”¨å±æ€§&#34;&gt;ä»€ä¹ˆæ˜¯å¼•ç”¨å±æ€§ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªéœ€è¦ä» Envoy å’Œ Mixer ä¹‹é—´çš„ Check æ–¹æ³•è¯´èµ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Check&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CheckRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CheckResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ CheckRequest ä¸­ï¼ŒEnvoy ä¼šæäº¤æ‰€æœ‰çš„ Attributeï¼Œè€Œåœ¨ CheckResponse çš„åº”ç­”ä¸­ï¼ŒPreconditionResult è¡¨ç¤ºå‰ç½®æ¡ä»¶æ£€æŸ¥çš„ç»“æœï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;å­—æ®µ&lt;/th&gt;
          &lt;th&gt;ç±»å‹&lt;/th&gt;
          &lt;th&gt;æè¿°&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;status&lt;/td&gt;
          &lt;td&gt;&lt;a href=&#34;https://skyao.io/post/201804-istio-mixer-cache-concepts/#google.rpc.Status&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;google.rpc.Status&lt;/a&gt;&lt;/td&gt;
          &lt;td&gt;çŠ¶æ€ç  OK è¡¨ç¤ºæ‰€æœ‰å‰ç½®æ¡ä»¶å‡æ»¡è¶³ã€‚ä»»ä½•å…¶å®ƒçŠ¶æ€ç è¡¨ç¤ºä¸æ˜¯æ‰€æœ‰çš„å‰ç½®æ¡ä»¶éƒ½æ»¡è¶³ï¼Œå¹¶ä¸”åœ¨ detail ä¸­æè¿°ä¸ºä»€ä¹ˆã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;validDuration&lt;/td&gt;
          &lt;td&gt;&lt;a href=&#34;https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;google.protobuf.Duration&lt;/a&gt;&lt;/td&gt;
          &lt;td&gt;æ—¶é—´é‡ï¼Œåœ¨æ­¤æœŸé—´è¿™ä¸ªç»“æœå¯ä»¥è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;validUseCount&lt;/td&gt;
          &lt;td&gt;int32&lt;/td&gt;
          &lt;td&gt;å¯ä½¿ç”¨çš„æ¬¡æ•°ï¼Œåœ¨æ­¤æœŸé—´è¿™ä¸ªç»“æœå¯ä»¥è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;attributes&lt;/td&gt;
          &lt;td&gt;CompressedAttributes&lt;/td&gt;
          &lt;td&gt;mixer è¿”å›çš„å±æ€§ã€‚è¿”å›çš„åˆ‡ç¡®å±æ€§é›†åˆç”± mixer é…ç½®çš„ adapter å†³å®šã€‚è¿™äº›å±æ€§ç”¨äºä¼ é€æ–°å±æ€§ï¼Œè¿™äº›æ–°å±æ€§æ˜¯ Mixer æ ¹æ®è¾“å…¥çš„å±æ€§é›†åˆå’Œå®ƒçš„é…ç½®æ´¾ç”Ÿçš„ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;referencedAttributes&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;ReferencedAttributes&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;åœ¨åŒ¹é…æ¡ä»¶å¹¶ç”Ÿæˆç»“æœçš„è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„å…¨éƒ¨å±æ€§é›†åˆã€‚&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;â€œåœ¨åŒ¹é…æ¡ä»¶å¹¶ç”Ÿæˆç»“æœçš„è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„å…¨éƒ¨å±æ€§é›†åˆâ€æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä»¬ç»™ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å®š envoy æäº¤çš„è¯·æ±‚ä¸­æœ‰ 5 ä¸ªå±æ€§ï¼Œâ€a=1,b=2,c=3,e=0,f=0â€&lt;/li&gt;
&lt;li&gt;å‡å®š mixer ä¸­æœ‰ä¸‰ä¸ª adapterï¼Œæ¯ä¸ª adapter åªä½¿ç”¨æäº¤å±æ€§ä¸­çš„ä¸€ä¸ªå±æ€§ a/b/c&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œmixer ä¼šåœ¨ CheckResponse ä¸­è¿”å› referencedAttributes å­—æ®µï¼Œå†…å®¹ä¸ºâ€a,b,câ€ï¼Œä»¥æ­¤è¡¨æ˜è¿™ä¸‰ä¸ªå±æ€§æ˜¯ mixer çš„ adapter åœ¨å®é™…çš„å¤„ç†è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„å±æ€§ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://skyao.io/post/201804-istio-mixer-cache-concepts/images/referenced-attributes.jpg&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Envoy åœ¨æ”¶åˆ° CheckResponse æ—¶ï¼Œå°±å¯ä»¥ä» referencedAttributes å­—æ®µçš„å€¼ä¸­å¾—çŸ¥ï¼šåŸæ¥æäº¤ä¸Šå»çš„â€a=1,b=2,c=3,e=0,f=0â€è¿™æ ·ä¸€ä¸ª 5 ä¸ªå±æ€§çš„é›†åˆï¼Œå®é™… adapter ä½¿ç”¨åˆ°çš„åªæœ‰â€a,b,câ€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¼•ç”¨å±æ€§çš„ä½œç”¨&#34;&gt;å¼•ç”¨å±æ€§çš„ä½œç”¨&lt;/h3&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆ envoy è¦è¿™ä¹ˆå…³å¿ƒå“ªäº›å±æ€§è¢« adapter ä½¿ç”¨äº†ï¼Ÿä»¥è‡³äºéœ€è¦åœ¨äº¤äº’çš„è¿‡ç¨‹ä¸­ï¼Œç‰¹æ„è®© mixer æ”¶é›†è¿™äº›ä½¿ç”¨è¿‡çš„å±æ€§å¹¶æ˜ç¡®åœ¨ CheckResponse ä¸­è¿”å›ç»™ Envoyï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯å› ä¸º Mixer Cache çš„éœ€è¦ã€‚ä¸ºäº†ç¼“å­˜ Mixer çš„ç»“æœï¼Œé¿å…æ¯æ¬¡è¯·æ±‚éƒ½å‘èµ·ä¸€æ¬¡ envoy å¯¹ mixer çš„è°ƒç”¨ï¼Œistio åœ¨ envoy ä¸­å¢åŠ äº† mixer cacheã€‚è€Œè¦è®©ç¼“å­˜å·¥ä½œï¼Œåˆ™å¿…é¡»åœ¨æ¯æ¬¡è¯·æ±‚ä¸­æƒ³åŠæ³•å¾—åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„ keyï¼Œå°†è°ƒç”¨ç»“æœä½œä¸º value å­˜æ”¾èµ·æ¥ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨å…³é”®ç‚¹å°±æ¥äº†ï¼škey è¦å¦‚ä½•è®¾è®¡ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æœ€ç®€å•çš„æ–¹å¼ï¼Œè‡ªç„¶æ˜¯å°†è¯·æ±‚ä¸­æ‰€æœ‰çš„å±æ€§éƒ½ä½œä¸º key çš„ç»„æˆéƒ¨åˆ†ï¼Œç›´æ¥åšä¸€ä¸ªç®€å•çš„ hashï¼Œå¾—åˆ°çš„å€¼ä½œä¸º keyã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆä¸å¯è¡Œçš„åœ°æ–¹åœ¨äºï¼Œè¯·æ±‚ä¸­å¯èƒ½æäº¤çš„å±æ€§å¤§æ¦‚æœ‰äºŒåä¸ªä¸Šä¸‹ï¼Œæœ‰äº›å±æ€§çš„å€¼å˜åŒ–éå¸¸é¢‘ç¹ï¼Œå–å€¼èŒƒå›´ä¹Ÿå¾ˆå¤§ï¼Œå…¸å‹å¦‚ request.id è¿™æ ·æ¯æ¬¡è¯·æ±‚éƒ½ä¼šç»™å‡ºä¸€ä¸ªå…¨å±€å”¯ä¸€å€¼ã€‚å¦‚æœç›´æ¥å°†æ‰€æœ‰å±æ€§éƒ½ä½œä¸º key çš„ç»„æˆéƒ¨åˆ†ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½æ¯æ¬¡ç®—å‡ºæ¥çš„ key éƒ½æ˜¯ä¸€ä¸ªå”¯ä¸€å€¼ï¼Œè¿™æ ·ç¼“å­˜ä¹Ÿå°±å¤±å»æ„ä¹‰äº†ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œä¸èƒ½å°†å…¨éƒ¨å±æ€§éƒ½ä½œä¸º keyï¼Œé‚£ä¹ˆï¼ŒæŒ‘é€‰éƒ¨åˆ†å±æ€§å¦‚ä½•ï¼Ÿåªè®¡ç®—éƒ¨åˆ†æˆ‘ä»¬åˆ¤æ–­ä¸ºæœ‰å¿…è¦è¢« adapter ä½¿ç”¨çš„å±æ€§æ¥è®¡ç®— keyã€‚ä½†æ˜¯ï¼Œç­‰ç­‰ï¼Œæˆ‘ä»¬ä¼šç«‹é©¬ååº”å‡ºæ¥ï¼šè¿™è¿èƒŒäº† mixer adapter çš„è®¾è®¡åŸåˆ™ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;adapter æ˜¯ç‹¬ç«‹äº envoy&lt;/li&gt;
&lt;li&gt;envoy ä¸åº”è¯¥çŸ¥é“æœ‰å“ªäº› adapter çš„å­˜åœ¨&lt;/li&gt;
&lt;li&gt;æ›´ä¸åº”è¯¥çŸ¥é“è¿™äº› adapter ä½¿ç”¨äº†å“ªäº›å±æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› æ­¤ï¼Œåœ¨ envoy è¯•å›¾è®¡ç®— key æ—¶ï¼Œå°±é¢ä¸´ä¸¤éš¾çš„å¢ƒåœ°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;envoy æ— æ³•é¢„è®¡å“ªäº›å±æ€§æ˜¯ adapter éœ€è¦çš„&lt;/li&gt;
&lt;li&gt;envoy ä¹Ÿä¸èƒ½å°†æ‰€æœ‰çš„å±æ€§éƒ½ä½œä¸º key&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é‚£æ€ä¹ˆåŠï¼Œmixer cache å¯æ˜¯å¿…é¡»è¦åŠ çš„ã€‚åªèƒ½è§æ‹›æ‹†æ‹›äº†ï¼Œæ€è·¯å€’æ˜¯ç›´ç™½ï¼Œå®¹æ˜“ç†è§£ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è°å¯ä»¥åˆ‡ç¡®çš„çŸ¥é“å“ªäº›å±æ€§è¢« adapter ä½¿ç”¨è¿‡ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å½“ç„¶æ˜¯è¢«è°ƒç”¨è¿‡çš„ adapter è‡ªå·±äº†ï¼Œæ¯ä¸ª adapter åœ¨æ‰§è¡Œå®Œæˆåï¼Œéƒ½å¯ä»¥ç»™å‡ºè‡ªå·±ä½¿ç”¨å±æ€§é›†åˆï¼Œmixer åªè¦åšä¸€ä¸ªç®€å•æ”¶é›†å°±å¯ä»¥æ‹¿åˆ°è¿™ä¸ªä¿¡æ¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mixer çŸ¥é“äº†ï¼Œæ€ä¹ˆå‘Šä¹‹ envoyï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸æ˜¯æœ‰ä¸ªç°æˆçš„ response å˜›ï¼Œå°†å‰é¢æ”¶é›†åˆ°çš„å±æ€§é›†åˆé€šè¿‡ response ä¼ é€’å› envoy å°±æ˜¯äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æå®šï¼ç°åœ¨å†é‡æ–°çœ‹å›å‰é¢ç»™å‡ºçš„è¿™ä¸ªå›¾ç‰‡ï¼Œå°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://skyao.io/post/201804-istio-mixer-cache-concepts/images/referenced-attributes.jpg&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ä¸‹ä¸€æ­¥&#34;&gt;ä¸‹ä¸€æ­¥&lt;/h2&gt;
&lt;p&gt;åœ¨ä»‹ç»å®ŒåŸºæœ¬æ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­å¼€å§‹è®²è§£ mixer cache çš„å·¥ä½œåŸç†ï¼Œç„¶ååœ¨æ›´åé¢çš„ç« èŠ‚ä¸­æ·±å…¥å®ç°ç»†èŠ‚ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio 0.8 çš„ Helm Chart è§£æ</title>
      <link>https://cloudnativecn.com/blog/helm-chart-for-istio-0-8/</link>
      <pubDate>Mon, 04 Jun 2018 16:09:57 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/helm-chart-for-istio-0-8/</guid>
      <description>&lt;p&gt;å„¿ç«¥èŠ‚æœŸé—´ï¼Œæ‹–æ‹‰äº†ä¸€ä¸ªå¤šæœˆçš„ Istio 0.8 æ­£å¼å‘å¸ƒäº†ï¼Œè¿™å¯èƒ½æ˜¯ Istio 1.0 ä¹‹å‰çš„æœ€åä¸€ä¸ª LTS ç‰ˆæœ¬ï¼Œæ„ä¹‰é‡å¤§ã€‚&lt;/p&gt;
&lt;p&gt;æ–°ç‰ˆæœ¬ä¸­ï¼ŒåŸæ¥çš„ Kubernetes å®‰è£…æ–‡ä»¶ &lt;code&gt;install/kubernetes/istio.yaml&lt;/code&gt;ï¼Œå˜æˆäº† &lt;code&gt;install/kubernetes/istio-demo.yaml&lt;/code&gt;ï¼Œæ˜¯çš„ï¼Œä½ æ²¡çœ‹é”™ï¼Œè¿™ä¸ª LTS çš„å®‰è£…æ–‡ä»¶åå­—å« demoã€‚æŸ¥çœ‹äº†ä¸€ä¸‹æ–‡æ¡£ï¼Œå¤§æ¦‚å¯Ÿè§‰åˆ°ä¸é è°±çš„ Istio å‘å¸ƒç»„çš„æ„å›¾äº†ï¼šè¿™ä¸ªé¡¹ç›®çš„ç»„ä»¶ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼ŒåŸæœ‰çš„ä¸€äº›é€‰é¡¹æ˜¯é  ConfigMap ä»¥åŠ istioctl åˆ†åˆ«è°ƒæ•´çš„ï¼Œç°åœ¨é€šè¿‡é‡æ–°è®¾è®¡çš„ Helm Chartï¼Œå®‰è£…é€‰é¡¹ç”¨ values.yml æˆ–è€… helm å‘½ä»¤è¡Œçš„æ–¹å¼æ¥è¿›è¡Œé›†ä¸­ç®¡ç†äº†ã€‚ä¸‹é¢å°±ç”±çœ‹çœ‹ Istio çš„ Helm Chart çš„å®‰è£…éƒ¨ç½²åŠå…¶ç»“æ„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-helm-å®‰è£…-istio&#34;&gt;ä½¿ç”¨ Helm å®‰è£… Istio&lt;/h2&gt;
&lt;p&gt;å®‰è£…åŒ…å†…çš„ Helm ç›®å½•ä¸­åŒ…å«äº† Istio çš„ Chartï¼Œå®˜æ–¹æä¾›äº†ä¸¤ç§æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨ Helm ç”Ÿæˆ istio.yamlï¼Œç„¶åè‡ªè¡Œå®‰è£…ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨ Tiller ç›´æ¥å®‰è£…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¾ˆæ˜æ˜¾ï¼Œä¸¤ç§æ–¹æ³•å¹¶æ²¡æœ‰ä»€ä¹ˆæœ¬è´¨åŒºåˆ«ã€‚ä¾‹å¦‚ç¬¬ä¸€ä¸ªå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm template install/kubernetes/helm/istio &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --name istio --namespace  &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    istio-system &amp;gt; &lt;span class=&#34;nv&#34;&gt;$HOME&lt;/span&gt;/istio.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œè¯´çš„æ˜¯ä½¿ç”¨ &lt;code&gt;install/kubernetes/helm/istio&lt;/code&gt; ç›®å½•ä¸­çš„ Chart è¿›è¡Œæ¸²æŸ“ï¼Œç”Ÿæˆçš„å†…å®¹ä¿å­˜åˆ° &lt;code&gt;$HOME/istio.yaml&lt;/code&gt; æ–‡ä»¶ä¹‹ä¸­ã€‚è€Œç¬¬äºŒä¸ªå‘½ä»¤&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm template install/kubernetes/helm/istio &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --name istio --namespace istio-system &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    --set sidecarInjectorWebhook.enabled&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt; &amp;gt; &lt;span class=&#34;nv&#34;&gt;$HOME&lt;/span&gt;/istio.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åªæ˜¯è®¾ç½®äº† Chart ä¸­çš„ä¸€ä¸ªå˜é‡ &lt;code&gt;sidecarInjectorWebhook.enabled&lt;/code&gt; ä¸º Falseã€‚ä»è€Œç¦æ­¢è‡ªåŠ¨æ³¨å…¥å±æ€§ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç…§çŒ«ç”»è™ï¼Œçœ‹çœ‹å‘½ä»¤äºŒçš„ç»“æœæäº¤åˆ° Kubernetes ä¸­ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm template install/kubernetes/helm/istio --name istio &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--namespace istio-system --set sidecarInjectorWebhook.enabled&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt; &amp;gt; &lt;span class=&#34;nv&#34;&gt;$HOME&lt;/span&gt;/istio.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create namespace istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create -f &lt;span class=&#34;nv&#34;&gt;$HOME&lt;/span&gt;/istio.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ ¹æ®ä¸åŒçš„ç½‘ç»œæƒ…å†µï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿçš„ç­‰å¾…ï¼Œæœ€åä¼šçœ‹åˆ°è¿™äº› Pod åœ¨è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;istio-citadel-ff5696f6f-h4rdz&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;istio-cleanup-old-ca-rp5p6&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;istio-egressgateway-58d98d898c-5jnpz&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;istio-ingress-6fb78f687f-wsl5q&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;istio-ingressgateway-6bc7c7c4bc-hhrh7&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;istio-mixer-post-install-d2kl5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;istio-pilot-6c5c6b586c-dqv2w&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;istio-policy-5c7fbb4b9f-xmv6f&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;istio-statsd-prom-bridge-6dbb7dcc7f-27tx7&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;istio-telemetry-54b5bf4847-9gpr7&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;prometheus-586d95b8d9-gb846&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;è¿‡å»çš„ istio-ca ç°å·²æ›´å istio-citadelã€‚&lt;/li&gt;
&lt;li&gt;istio-cleanup-old-ca æ˜¯ä¸€ä¸ª jobï¼Œç”¨äºæ¸…ç†è¿‡å»çš„ Istio é—ç•™ä¸‹æ¥çš„ CA éƒ¨ç½²ï¼ˆåŒ…æ‹¬ saã€deploy ä»¥åŠ svc ä¸‰ä¸ªå¯¹è±¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;istio-mixer-post-install åŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ª jobï¼Œå’Œä¸Šé¢çš„ Job ä¸€æ ·ï¼Œç®€å•çš„è°ƒç”¨ kubectl åˆ›å»ºç¬¬ä¸‰æ–¹èµ„æºï¼Œä»è€Œé¿å…äº†ä¹‹å‰çš„ CDR éœ€è¦é‡å¤åˆ›å»ºçš„å°´å°¬çŠ¶å†µã€‚&lt;/li&gt;
&lt;li&gt;egressgatewayã€ingress ä»¥åŠ ingressgatewayï¼Œå¯ä»¥çœ‹å‡ºè¾¹ç¼˜éƒ¨åˆ†çš„å˜åŠ¨å¾ˆå¤§ï¼Œä»¥åä¼šå¦è¡Œå‘æ–‡ã€‚&lt;/li&gt;
&lt;li&gt;å’Œä»å‰ä¸åŒï¼Œç¼ºçœå·²ç»æ‰“å¼€äº†ç›‘æ§ç•Œé¢ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;helm-chart-çš„å®‰è£…é…ç½®&#34;&gt;Helm Chart çš„å®‰è£…é…ç½®&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢çš„é…ç½®é¡¹ç›®ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ helm çš„ &lt;code&gt;--set key=value&lt;/code&gt; æ¥è®¾ç½®ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨ï¼Œç”¨æ¥è®¾ç½®å¤šä¸ªå€¼ã€‚&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;é€‰é¡¹&lt;/th&gt;
          &lt;th&gt;è¯´æ˜&lt;/th&gt;
          &lt;th&gt;ç¼ºçœå€¼&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;global.hub&lt;/td&gt;
          &lt;td&gt;ç»å¤§éƒ¨åˆ†é•œåƒæ‰€åœ¨çš„é•œåƒåº“åœ°å€&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;docker.io/istionightly&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;global.tag&lt;/td&gt;
          &lt;td&gt;Istio ä½¿ç”¨çš„ç»å¤§éƒ¨åˆ†é•œåƒçš„ Tag&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;circleci-nightly&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;global.proxy.image&lt;/td&gt;
          &lt;td&gt;æŒ‡å®š Proxy çš„é•œåƒåç§°&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;proxyv2&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;global.imagePullPolicy&lt;/td&gt;
          &lt;td&gt;é•œåƒæ‹‰å–ç­–ç•¥&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;IfNotPresent&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;global.controlPlaneSecurityEnabled&lt;/td&gt;
          &lt;td&gt;æ§åˆ¶é¢æ˜¯å¦å¯åŠ¨ mTLS&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;false&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;global.mtls.enabled&lt;/td&gt;
          &lt;td&gt;æœåŠ¡é—´æ˜¯å¦ç¼ºçœå¯ç”¨ mTLS&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;false&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;global.mtls.mtlsExcludedServices&lt;/td&gt;
          &lt;td&gt;ç¦ç”¨ mTLS çš„ FQDN åˆ—è¡¨&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;- kubernetes.default.svc.cluster.local&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;global.rbacEnabled&lt;/td&gt;
          &lt;td&gt;æ˜¯å¦åˆ›å»º RBAC è§„åˆ™&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;true&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;global.refreshInterval&lt;/td&gt;
          &lt;td&gt;Mesh å‘ç°é—´éš”&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;10s&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;global.arch.amd64&lt;/td&gt;
          &lt;td&gt;amd64 æ¶æ„ä¸­çš„è°ƒåº¦ç­–ç•¥ï¼Œ0ï¼šneverï¼›1: least preferredï¼›2ï¼šno preferenceï¼›3ï¼šmost preferred&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;2&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;global.arch.s390x&lt;/td&gt;
          &lt;td&gt;amd64 æ¶æ„ä¸­çš„è°ƒåº¦ç­–ç•¥ï¼Œ0ï¼šneverï¼›1: least preferredï¼›2ï¼šno preferenceï¼›3ï¼šmost preferred&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;2&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;global.arch.ppc64le&lt;/td&gt;
          &lt;td&gt;amd64 æ¶æ„ä¸­çš„è°ƒåº¦ç­–ç•¥ï¼Œ0ï¼šneverï¼›1: least preferredï¼›2ï¼šno preferenceï¼›3ï¼šmost preferred&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;2&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;galley.enabled&lt;/td&gt;
          &lt;td&gt;æ˜¯å¦å®‰è£… Galley ç”¨äºè¿›è¡ŒæœåŠ¡ç«¯çš„é…ç½®éªŒè¯ï¼Œéœ€è¦ 1.9 ç‰ˆæœ¬ä»¥ä¸Šçš„ Kubernetes&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;false&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸Šé¢çš„å†…å®¹æ¥è‡ª&lt;a href=&#34;https://istio.io/docs/setup/kubernetes/helm-install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ï¼Œå…¶å®è¿™æ˜¯ä¸ç¬¦åˆå®é™…æƒ…å†µçš„ï¼ˆIstio ç”¨æˆ·çš„æ—¥å¸¸ï¼‰ã€‚åœ¨ &lt;code&gt;install/kubernetes/helm/istio/values.yaml&lt;/code&gt; ä¸­ï¼ŒåŒ…å«è¿™ä¸€å‘è¡Œç‰ˆæœ¬ä¸­çš„æ‰€æœ‰çš„ç¼ºçœå€¼ã€‚å¯ä»¥ç›´æ¥ä¿®æ”¹æˆ–è€…æ–°å»º values.yamlï¼Œå¹¶åœ¨ helm å‘½ä»¤è¡Œä½¿ç”¨ &lt;code&gt;-f my-values.yaml&lt;/code&gt; å‚æ•°æ¥ç”Ÿæˆè‡ªè¡Œå®šåˆ¶çš„ &lt;code&gt;istio.yaml&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;è§£è¯»-istio-helm-chart-ä¸­çš„æ¨¡å—&#34;&gt;è§£è¯» Istio Helm Chart ä¸­çš„æ¨¡å—&lt;/h2&gt;
&lt;p&gt;æ‰“å¼€ Istio çš„ Chart ä¹‹åï¼Œå‘ç°å…¶ä¸­å¹¶æ²¡æœ‰ä»»ä½•ç»„ä»¶çš„å†…å®¹ï¼Œåªæœ‰ä¸¤ä¸ª Configmap å¯¹è±¡çš„æ¨¡æ¿ã€‚å…¶å®‰è£…ä¸»ä½“å†æ¬¡å¾ˆéä¸»æµçš„é€šè¿‡ä¾èµ– Chart çš„æ–¹å¼å®ç°äº†å®Œå…¨çš„æ¨¡å—åŒ–ã€‚å› æ­¤è¿™ä¸ª Chart çš„ä¸»ä½“ï¼Œå®é™…ä¸Šæ˜¯ &lt;code&gt;requirements.yaml&lt;/code&gt;ï¼Œæ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œä¼šçœ‹åˆ°è§„è§„çŸ©çŸ©çš„åˆ—å‡ºå¾ˆå¤šæ¨¡å—ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  - name: sidecarInjectorWebhook
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    version: 0.8.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # repository: file://../sidecarInjectorWebhook
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    condition: sidecarInjectorWebhook.enabled
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™è¡¨æ˜åœ¨ &lt;code&gt;sidecarInjectorWebhook&lt;/code&gt; å–å€¼ä¸º &lt;code&gt;enabled&lt;/code&gt; çš„æ—¶å€™ï¼Œå°±æ¸²æŸ“è¿™ä¸€æ¨¡æ¿ã€‚å› æ­¤è¿™é‡Œå¯ä»¥çœ‹åšæ˜¯æ¨¡å—çš„å¯ç”¨åœç”¨çš„æ§åˆ¶ç‚¹ã€‚è¿™é‡Œåˆ—å‡ºçš„æ¨¡å—åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;æ¨¡å—&lt;/th&gt;
          &lt;th&gt;æè¿°&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;egressgateway&lt;/td&gt;
          &lt;td&gt;å¤–å‘æµé‡ç½‘å…³&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;galley&lt;/td&gt;
          &lt;td&gt;åœ¨ K8S æœåŠ¡ç«¯éªŒè¯ Istio çš„ CRD èµ„æºçš„åˆæ³•æ€§&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;grafana&lt;/td&gt;
          &lt;td&gt;Dashboard&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ingress&lt;/td&gt;
          &lt;td&gt;Ingress Controller&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ingressgateway&lt;/td&gt;
          &lt;td&gt;Ingress Gateway&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;mixer&lt;/td&gt;
          &lt;td&gt;Mixer&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;pilot&lt;/td&gt;
          &lt;td&gt;Pilot&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;prometheus&lt;/td&gt;
          &lt;td&gt;Prometheus&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;security&lt;/td&gt;
          &lt;td&gt;å®‰å…¨ç›¸å…³å†…å®¹&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;servicegraph&lt;/td&gt;
          &lt;td&gt;è°ƒç”¨å…³ç³»å›¾&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;sidecarInjectorWebhook&lt;/td&gt;
          &lt;td&gt;è‡ªåŠ¨æ³¨å…¥&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;tracing&lt;/td&gt;
          &lt;td&gt;Zipkin Jeager çš„è·Ÿè¸ªæœåŠ¡&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸‹é¢é€ä¸€åšä¸€ä¸‹ç®€è¦è¯´æ˜&lt;/p&gt;
&lt;h3 id=&#34;egressgateway&#34;&gt;egressgateway&lt;/h3&gt;
&lt;p&gt;å¤–å‘é€šä¿¡çš„ç½‘å…³ã€‚&lt;/p&gt;
&lt;p&gt;ä»–çš„è®¾ç½®ä¿å­˜åœ¨ &lt;code&gt;values.yaml&lt;/code&gt; çš„ &lt;code&gt;egressgateway&lt;/code&gt; ä¸€èŠ‚ä¸­ï¼ˆéƒ½æ˜¯ä¿å­˜åœ¨åŒååˆ†æ”¯ä¸‹ï¼Œåé¢ä¸å†é‡å¤ï¼‰ã€‚éƒ¨ç½²å†…å®¹åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Deployment å’Œ Serviceï¼šä¸€ä¸ª proxyã€‚&lt;/li&gt;
&lt;li&gt;HPA&lt;/li&gt;
&lt;li&gt;RBAC ç›¸å…³å†…å®¹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯å®šåˆ¶é¡¹ç›®åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡ç«¯å£å’Œç±»å‹&lt;/li&gt;
&lt;li&gt;HPA å®ä¾‹æ•°é‡ä¸Šä¸‹é™&lt;/li&gt;
&lt;li&gt;èµ„æºé™åˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;galley&#34;&gt;galley&lt;/h3&gt;
&lt;p&gt;ä¹‹å‰çš„ istio ç‰ˆæœ¬ä¸­ï¼Œåªèƒ½é€šè¿‡ istioctl éªŒè¯ Istio ç›¸å…³ CRD çš„æœ‰æ•ˆæ€§ï¼Œè¿™ä¸ªæ¨¡å—æä¾›ä¸€ä¸ªåœ¨æœåŠ¡ç«¯éªŒè¯ CRD çš„æ–¹æ³•ï¼Œä»–çš„éƒ¨ç½²å†…å®¹åŒ…å«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Deployement å’Œ Serviceã€‚&lt;/li&gt;
&lt;li&gt;RBAC ç›¸å…³&lt;/li&gt;
&lt;li&gt;ç”¨äº CRD æ ¡éªŒçš„ ValidatingWebhookConfiguration å¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ ¡éªŒç›®æ ‡åŒ…å« Pilotï¼ˆä¾‹å¦‚ destinationpolicies å’Œ routerulesï¼‰å’Œ Mixerï¼ˆä¾‹å¦‚ memquotas å’Œ prometheusesï¼‰ä¸¤ç±» CRDã€‚&lt;/p&gt;
&lt;h3 id=&#34;grafana&#34;&gt;grafana&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªå¸¦æœ‰ Istio å®šåˆ¶ Dashboard çš„ Grafana å°è£…ã€‚&lt;/p&gt;
&lt;p&gt;å®é™…ä¸Šå°†å…¶é•œåƒä¸­çš„ Dashboard å¤åˆ¶å‡ºæ¥å°±å¯ä»¥åœ¨å…¶ä»– Grafana å®ä¾‹ä¸Šè¿è¡Œäº†ã€‚&lt;/p&gt;
&lt;p&gt;å®šåˆ¶å†…å®¹çš„ &lt;code&gt;grafana.ingress.*&lt;/code&gt; ä¸­åŒ…å« Ingress çš„é…ç½®ï¼Œç”¨äºå¤–ç½‘è®¿é—®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ingress&#34;&gt;ingress&lt;/h3&gt;
&lt;p&gt;Istio çš„ Ingress Controller&lt;/p&gt;
&lt;p&gt;å…·ä½“éƒ¨ç½²å†…å®¹å’Œ egresscontroller åŸºæœ¬ä¸€è‡´ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ingressgateway&#34;&gt;ingressgateway&lt;/h3&gt;
&lt;p&gt;0.8.0 æ–°å¢åŠŸèƒ½ï¼Œä¸º Ingress é€šä¿¡æä¾› Istio rules/destination ç­‰ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;éƒ¨ç½²å†…å®¹å’Œ ingress ç±»ä¼¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;mixer&#34;&gt;mixer&lt;/h3&gt;
&lt;p&gt;Mixer è´Ÿè´£çš„æ˜¯é¥æµ‹å’Œå‰ç½®æ£€æŸ¥ï¼Œä»–çš„ Chart ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œéƒ¨ç½²å†…å®¹åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å’Œå‰é¢çš„ç‰ˆæœ¬ä¸åŒï¼ŒMixer çš„éƒ¨ç½²åˆ†æˆäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ Policy å’Œ Telemetry ä¸¤ä¸ª Deployment å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;Service ä¹ŸåŒæ ·åˆ†æˆä¸¤ä¸ªï¼Œå…¶ä¸­ telemetry service å¤šäº†ä¸€ä¸ª prometheus ç«¯å£&lt;/li&gt;
&lt;li&gt;&lt;code&gt;crds.yaml&lt;/code&gt; ä¸­åŒ…å«äº† mixer æ‰€æ”¯æŒçš„æ‰€æœ‰ crd å®šä¹‰ï¼ˆä¾‹å¦‚ memquotas å’Œ prometheusesï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;create-custom-resources-job.yaml&lt;/code&gt; ä¸­åŒ…å«äº†ç”¨äºåˆ›å»º crd çš„ Job å¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;pilot&#34;&gt;pilot&lt;/h3&gt;
&lt;p&gt;Pilot æ‰¿ä¸Šå¯ä¸‹ï¼Œè´Ÿè´£æœåŠ¡å‘ç°å’Œå‘ Proxy ä¸‹å‘é…ç½®ã€‚é™¤äº†å¸¸è§„çš„ Deployment å’Œ Service ä¹‹å¤–ï¼Œè¿˜åŒ…å«äº† &lt;code&gt;crds.yaml&lt;/code&gt;ï¼Œç”¨äºå£°æ˜ CRD èµ„æºç±»å‹ï¼ˆä¾‹å¦‚ destinationpolicies å’Œ routerulesï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;prometheus&#34;&gt;prometheus&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªç»„ä»¶è·Ÿå‰é¢çš„ Grafana ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„é•œåƒã€‚è¿™ä¸ªæ¨¡æ¿ä¸­çš„ Configmap å°±æ˜¯ Prometheus çš„æŠ“å–é…ç½®ï¼Œå¯ä»¥ç›´æ¥ç”¨åˆ°å…¶ä»–çš„ Prometheus å®ä¾‹ä¹‹ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;security&#34;&gt;security&lt;/h3&gt;
&lt;p&gt;æ—§ç‰ˆæœ¬ä¸­çš„ Istio-ca&lt;/p&gt;
&lt;p&gt;Security éƒ¨åˆ†çš„éƒ¨ç½²å†…å®¹åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RBAC&lt;/li&gt;
&lt;li&gt;Jobï¼šä½¿ç”¨ kubectl æ¸…ç†æ—§ç‰ˆæœ¬ istio-ca å®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;Deploymentï¼ŒåŸ CAã€‚&lt;/li&gt;
&lt;li&gt;Serviceï¼šå¼€æ”¾ä¸¤ä¸ªç«¯å£ï¼Œåˆ†åˆ«æœåŠ¡äº http å’Œ gRPCã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;servicegraph&#34;&gt;servicegraph&lt;/h3&gt;
&lt;p&gt;Service Graph æ”¯æŒï¼Œå’Œ Grafana åŸºæœ¬ä¸€è‡´ã€‚&lt;/p&gt;
&lt;h3 id=&#34;sidecarinjectorwebhook&#34;&gt;sidecarInjectorWebhook&lt;/h3&gt;
&lt;p&gt;è¿™ä¸€éƒ¨åˆ†çš„åŠŸèƒ½æ˜¯è‡ªåŠ¨ä¸º K8S å¯¹è±¡æ³¨å…¥ Envoyã€‚ä¸»è¦åŒ…å«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Deployment å’Œ Service&lt;/li&gt;
&lt;li&gt;RBAC ç›¸å…³&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ª &lt;code&gt;MutatingWebhookConfiguration&lt;/code&gt; å¯¹è±¡ï¼Œä¼šç›‘å¬ Pod çš„åˆ›å»ºäº‹ä»¶ï¼Œç”¨äºè‡ªåŠ¨æ³¨å…¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;tracing&#34;&gt;tracing&lt;/h3&gt;
&lt;p&gt;Jeager çš„è·Ÿè¸ªæ”¯æŒï¼Œæ€»ä½“æƒ…å†µè·Ÿ Prometheus å’Œ Grafana ç­‰ç›‘æ§ç»„ä»¶ç±»ä¼¼ï¼Œé…ç½®é¡¹å’Œæš´éœ²æœåŠ¡æ–¹é¢ç¨æœ‰åŒºåˆ«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®ä¸­åŒ…å« Jaeger çš„ç¯å¢ƒå˜é‡çš„æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;å¼€å¯ jaeger å¼€å…³ï¼Œä¼šå¯ç”¨ Jaeger çš„å‡ ä¸ªæœåŠ¡ç«¯å£ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Istio çš„ GitOpsâ€”åƒä»£ç ä¸€æ ·ç®¡ç† Istio é…ç½®</title>
      <link>https://cloudnativecn.com/blog/gitops-for-istio-manage-istio-config-like-code/</link>
      <pubDate>Thu, 31 May 2018 21:12:03 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/gitops-for-istio-manage-istio-config-like-code/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://www.weave.works/blog/gitops-for-istio-manage-istio-config-like-code&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä»Šå¹´çš„å“¥æœ¬å“ˆæ ¹ Kubecon å¤§ä¼šä¸Šï¼ŒWeaveworks çš„ CEO Alexis Richardson ä¸ Varun Talwarï¼ˆæ¥è‡ªä¸€å®¶éšå½¢åˆ›ä¸šå…¬å¸ï¼‰è°ˆåˆ°äº† GitOps å·¥ä½œæµç¨‹å’Œ Istioã€‚ä¼šå Weaveworks çš„ Stefan Prodan è¿›è¡Œäº†çš„æ¼”ç¤ºï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨ GitOps ä¸Šçº¿å’Œç®¡ç† Istio çš„é‡‘ä¸é›€éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;ä¼šè°ˆå’Œæ¼”ç¤ºä¸­è§£é‡Šäº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»€ä¹ˆæ˜¯ GitOpsï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ&lt;/li&gt;
&lt;li&gt;Istio å’Œ GitOps çš„æœ€ä½³å®è·µæ˜¯å¦‚ä½•ç®¡ç†åœ¨å…¶ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºçš„ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ä½¿ç”¨ GitOps å·¥ä½œæµç¨‹å’Œ Istio è¿›è¡Œé‡‘ä¸é›€éƒ¨ç½²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä»€ä¹ˆæ˜¯-gitops&#34;&gt;ä»€ä¹ˆæ˜¯ GitOpsï¼Ÿ&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://www.weave.works/blog/the-gitops-pipeline&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitOps æ˜¯å®ç°æŒç»­äº¤ä»˜çš„ä¸€ç§æ–¹å¼&lt;/a&gt;ã€‚â€œGitOps ä½¿ç”¨ Git ä½œä¸ºå£°æ˜å¼åŸºç¡€æ¶æ„å’Œåº”ç”¨ç¨‹åºçš„çœŸå®æ¥æºâ€Alexis Richardson è¯´ã€‚&lt;/p&gt;
&lt;p&gt;å½“å¯¹ Git è¿›è¡Œæ›´æ”¹æ—¶ï¼Œè‡ªåŠ¨åŒ–äº¤ä»˜ç®¡é“ä¼šä¸Šçº¿å¯¹åŸºç¡€æ¶æ„çš„æ›´æ”¹ã€‚ä½†æ˜¯è¿™ä¸ªæƒ³æ³•è¿˜å¯ä»¥æ›´è¿›ä¸€æ­¥â€”â€”ä½¿ç”¨å·¥å…·æ¥æ¯”è¾ƒå®é™…çš„ç”Ÿäº§çŠ¶æ€å’Œæºä»£ç æ§åˆ¶ä¸­æè¿°çš„çŠ¶æ€ï¼Œç„¶åå‘Šè¯‰ä½ ä»€ä¹ˆæ—¶å€™é›†ç¾¤çš„çŠ¶æ€è·Ÿæè¿°çš„ä¸ç¬¦ã€‚&lt;/p&gt;
&lt;h3 id=&#34;git-å¯ç”¨å£°æ˜å¼å·¥å…·&#34;&gt;Git å¯ç”¨å£°æ˜å¼å·¥å…·&lt;/h3&gt;
&lt;p&gt;é€šè¿‡ä½¿ç”¨ Git è¿™æ ·çš„å£°æ˜å¼å·¥å…·å¯ä»¥å¯¹æ•´å¥—é…ç½®æ–‡ä»¶åšç‰ˆæœ¬æ§åˆ¶ã€‚é€šè¿‡å°† Git ä½œä¸ºå”¯ä¸€çš„é…ç½®æ¥æºï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å¤åˆ¶æ•´å¥—åŸºç¡€æ¶æ„ï¼Œä»è€Œå°†ç³»ç»Ÿçš„å¹³å‡æ¢å¤æ—¶é—´ä»å‡ å°æ—¶ç¼©çŸ­åˆ°å‡ åˆ†é’Ÿã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/gitops-for-istio-manage-istio-config-like-code/00704eQkgy1fruc9ao41vj317o0oqq80.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;gitops-èµ‹èƒ½å¼€å‘äººå‘˜æ‹¥æŠ±è¿ç»´&#34;&gt;GitOps èµ‹èƒ½å¼€å‘äººå‘˜æ‹¥æŠ±è¿ç»´&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://cloud.weave.works/signup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Weave Cloud&lt;/a&gt; çš„ GitOps æ ¸å¿ƒæœºåˆ¶åœ¨äº CI/CD å·¥å…·ï¼Œå…¶å…³é”®æ˜¯&lt;a href=&#34;https://github.com/weaveworks/flux/blob/master/site/introduction.md#automated-git-cluster-synchronisation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ”¯æŒ Git é›†ç¾¤åŒæ­¥&lt;/a&gt;çš„æŒç»­éƒ¨ç½²ï¼ˆCDï¼‰å’Œå‘å¸ƒç®¡ç†ã€‚Weave Cloud éƒ¨ç½²ä¸“ä¸ºç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå’Œå£°æ˜å¼åº”ç”¨ç¨‹åºå †æ ˆè€Œè®¾è®¡ã€‚ä»¥å¾€å¼€å‘äººå‘˜éƒ½æ˜¯ä½¿ç”¨ Git ç®¡ç†ä»£ç å’Œæäº¤ PRï¼ˆPull Requestï¼‰ï¼Œç°åœ¨ä»–ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ Git æ¥åŠ é€Ÿå’Œç®€åŒ– Kubernetes å’Œ Istio ç­‰å…¶ä»–å£°æ˜å¼æŠ€æœ¯çš„è¿ç»´å·¥ä½œã€‚&lt;/p&gt;
&lt;h4 id=&#34;gitops-çš„ä¸‰ä¸ªæ ¸å¿ƒåŸåˆ™&#34;&gt;GitOps çš„ä¸‰ä¸ªæ ¸å¿ƒåŸåˆ™&lt;/h4&gt;
&lt;p&gt;æ ¹æ® Alexis çš„è¯´æ³•ï¼Œä¸‹é¢æè¿°çš„æ˜¯ä¸ºä½• GitOps æ—¢æ˜¯ Kubernetes åˆæ˜¯äº‘åŸç”Ÿæ ¸å¿ƒçš„åŸå› ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. GitOps çš„æ ¸å¿ƒæ˜¯å£°æ˜å¼é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä½¿ç”¨ Git ä½œä¸ºå®ä½“æºï¼Œå¹¶ä½¿ç”¨ Kubernetes åšæ»šåŠ¨æ›´æ–°ï¼Œå¯ä»¥è§‚å¯Ÿé›†ç¾¤å¹¶å°†å…¶ä¸æœŸæœ›çš„çŠ¶æ€è¿›è¡Œæ¯”è¾ƒã€‚ &lt;a href=&#34;https://www.weave.works/blog/gitops-operations-by-pull-request&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€šè¿‡å°†å£°æ˜æ€§é…ç½®è§†ä¸ºä»£ç &lt;/a&gt;ï¼Œå®ƒå…è®¸æ‚¨é€šè¿‡åœ¨æœªæˆåŠŸæ—¶é‡æ–°åº”ç”¨æ›´æ”¹æ¥å¼ºåˆ¶æ”¶æ•›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. ä¸åº”è¯¥ç›´æ¥ä½¿ç”¨ Kubectl&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ ¹æ®ä¸€èˆ¬è§„åˆ™æ¥çœ‹ï¼Œå°†ä»£ç ç»è¿‡ CI ç›´æ¥ push åˆ°ç”Ÿäº§å¹¶ä¸æ˜¯ä¸ªå¥½ä¸»æ„ã€‚è®¸å¤šäººé€šè¿‡ CI å·¥å…·é©±åŠ¨éƒ¨ç½²ï¼Œä½†æ˜¯å½“ä½ è¿™æ ·åšçš„æ—¶å€™&lt;a href=&#34;https://www.weave.works/blog/how-secure-is-your-cicd-pipeline&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½ å¯èƒ½ä¸å¾—ä¸åšä¸€ä¸ªè®¿é—®ç”Ÿäº§çš„ä¸œè¥¿&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3. ä½¿ç”¨ operator æ¨¡å¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ operator æ¨¡å¼ï¼Œé›†ç¾¤å°†å§‹ç»ˆä¸ Git ä¸­ç­¾å…¥çš„å†…å®¹ä¿æŒåŒæ­¥ã€‚Weave Flux æ˜¯å¼€æºçš„ï¼Œå®ƒæ˜¯ä½¿ç”¨ Istio æ¼”ç¤ºä¸‹é¢çš„é‡‘ä¸é›€éƒ¨ç½²çš„åŸºç¡€ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ operator ç®¡ç†é›†ç¾¤ä¸­çš„æ›´æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/gitops-for-istio-manage-istio-config-like-code/00704eQkgy1fruc9qogakj312t0ls41d.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ— è®ºæ˜¯å¼€å‘æµç¨‹è¿˜æ˜¯ç”Ÿäº§æµç¨‹ï¼Œè¿˜æ˜¯ä»é¢„å‘åˆ°åˆå¹¶åˆ°ç”Ÿäº§ï¼Œoperator éƒ½ä¼šå°†æ›´æ”¹ pull åˆ°é›†ç¾¤ä¸­ï¼Œå³ä½¿æ˜¯æœ‰å¤šä¸ªæ›´æ”¹ä¹Ÿèƒ½ä»¥åŸå­çš„æ–¹å¼éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/gitops-for-istio-manage-istio-config-like-code/00704eQkgy1fruca1y7xqj312p0jmn09.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;istio-çš„-gitops-å·¥ä½œæµç¨‹&#34;&gt;Istio çš„ GitOps å·¥ä½œæµç¨‹&lt;/h3&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼ŒVarun Talwar è°ˆåˆ°äº† Istio æ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•ä½¿ç”¨ GitOps å·¥ä½œæµç®¡ç†åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;Istio æ˜¯ä¸€å¹´å‰å‘å¸ƒçš„æœåŠ¡ç½‘æ ¼ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸“ç”¨çš„åŸºç¡€è®¾æ–½å±‚ï¼Œç”¨äºä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„æ‰€æœ‰æœåŠ¡é—´äº¤äº’æä¾›æœåŠ¡ã€‚Istio ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯é€šè¿‡å£°æ˜å¼é…ç½®æ–‡ä»¶é©±åŠ¨çš„ã€‚ä¹Ÿå°±æ˜¯è¯´åƒ Istio è¿™æ ·çš„æœåŠ¡ç½‘æ ¼å¯ä»¥è®©å¼€å‘äººå‘˜åœ¨ Git ä¸­åƒç®¡ç†ä»£ç ä¸€æ ·å®Œå…¨çš„ç®¡ç†æœåŠ¡è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/gitops-for-istio-manage-istio-config-like-code/00704eQkgy1frucacq5nij317u0oo46y.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å€ŸåŠ© Git å·¥ä½œæµç¨‹ï¼Œå¼€å‘äººå‘˜å¯ä»¥å¯¹ Istio ä¸­çš„ä»»ä½•å†…å®¹è¿›è¡Œå»ºæ¨¡ï¼ŒåŒ…æ‹¬æœåŠ¡è¡Œä¸ºåŠå…¶äº¤äº’ï¼Œå¦‚è¶…æ—¶ã€æ–­è·¯å™¨ã€æµé‡è·¯ç”±ã€è´Ÿè½½å‡è¡¡åŠ A/B æµ‹è¯•å’Œé‡‘ä¸é›€å‘å¸ƒç­‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è·¨å›¢é˜Ÿçš„å¤šç»„é…ç½®&#34;&gt;è·¨å›¢é˜Ÿçš„å¤šç»„é…ç½®&lt;/h3&gt;
&lt;p&gt;Istio æœ‰å››ä¸ªå¹¿æ³›çš„é¢†åŸŸåº”ç”¨ï¼Œéƒ½æ˜¯é€šè¿‡å£°æ˜å¼é…ç½®é©±åŠ¨çš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æµé‡ç®¡ç†ï¼šä¸ç®¡ç†å…¥å£å’ŒæœåŠ¡æµé‡æœ‰å…³ã€‚&lt;/li&gt;
&lt;li&gt;å¯è§‚å¯Ÿæ€§ï¼šç›‘æ§ã€æµé‡å»¶è¿Ÿã€QPSã€é”™è¯¯ç‡ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;å®‰å…¨æ€§ï¼šæ‰€æœ‰æœåŠ¡é—´è°ƒç”¨çš„è®¤è¯ä¸æˆæƒã€‚&lt;/li&gt;
&lt;li&gt;æ€§èƒ½ï¼šåŒ…æ‹¬é‡è¯•è¶…æ—¶ã€æ•…éšœæ³¨å…¥å’Œæ–­è·¯ç­‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å› ä¸ºæ‰€æœ‰è¿™äº›é¢†åŸŸéƒ½å¯ä»¥è·¨è¶Šç»„ç»‡å†…çš„ä¸åŒå›¢é˜Ÿï¼Œæ‰€ä»¥è¿™ä½¿å¾—åœ¨ Istio ä¸Šç®¡ç†åº”ç”¨ç¨‹åºå°¤å…¶å…·æœ‰æŒ‘æˆ˜æ€§ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/gitops-for-istio-manage-istio-config-like-code/00704eQkgy1frucalfge7j317u0oq7aq.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™äº›é…ç½®é©±åŠ¨çš„å¾ˆå¤šè®¾ç½®æ˜¯è·¨å›¢é˜Ÿçš„ã€‚ä¾‹å¦‚ï¼Œæœ‰çš„å›¢é˜Ÿæƒ³ç”¨ Zipkin è¿›è¡Œè·Ÿè¸ªï¼Œè€Œå¦ä¸€ä¸ªå›¢é˜Ÿå¯èƒ½æƒ³ç”¨ Jaegerã€‚è¿™äº›å†³ç­–å¯ä»¥é’ˆå¯¹æŸä¸€é¡¹æœåŠ¡è¿›è¡Œï¼Œä¹Ÿå¯ä»¥è·¨æœåŠ¡è¿›è¡Œã€‚å½“å†³ç­–è·¨è¶Šå›¢é˜Ÿæ—¶ï¼Œå®¡æ‰¹å·¥ä½œæµç¨‹å°†å˜å¾—æ›´åŠ å¤æ‚ï¼Œå¹¶ä¸æ€»æ˜¯åŸå­æ€§çš„ã€‚é‡‘ä¸é›€å‘å¸ƒä¸æ˜¯åŸå­çš„ä¸€æ¬¡æ€§äº‹æƒ…ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é€šè¿‡-gitops-å·¥ä½œæµç¨‹åœ¨-istio-ä¸Šåšé‡‘ä¸é›€éƒ¨ç½²&#34;&gt;é€šè¿‡ GitOps å·¥ä½œæµç¨‹åœ¨ Istio ä¸Šåšé‡‘ä¸é›€éƒ¨ç½²&lt;/h3&gt;
&lt;p&gt;Stefan Prodan å‘æˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å¸¦æœ‰ Weave Flux å’Œ Prometheus çš„ GitOps å·¥ä½œæµç¨‹åœ¨ Istio ä¸­åšä¸€æ¬¡é‡‘ä¸é›€å‘å¸ƒâ€”â€”æ‚¨å¯ä»¥åœ¨ Weave Cloud ä¸­ä½¿ç”¨è¿™äº›å·¥å…·ä»¥åŠé‡‘ä¸é›€éƒ¨ç½²å’Œå¯è§‚å¯Ÿæ€§ã€‚&lt;/p&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼Œå½“æ‚¨æƒ³è¦ç”¨ä¸€éƒ¨åˆ†ç”¨æˆ·æµ‹è¯•æŸäº›æ–°åŠŸèƒ½æ—¶ï¼Œä¼šä½¿ç”¨é‡‘ä¸é›€éƒ¨ç½²æˆ–å‘å¸ƒã€‚ä¼ ç»Ÿä¸Šï¼Œæ‚¨å¯èƒ½æ‹¥æœ‰ä¸¤å°å‡ ä¹å®Œå…¨ç›¸åŒçš„æœåŠ¡å™¨ï¼šä¸€å°ç”¨äºæ‰€æœ‰ç”¨æˆ·ï¼Œå¦ä¸€å°ç”¨äºå°†æ–°åŠŸèƒ½éƒ¨ç½²åˆ°æŸä¸€ç»„ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;p&gt;ä½†é€šè¿‡ä½¿ç”¨ GitOps å·¥ä½œæµç¨‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡ Git æ§åˆ¶æ‚¨çš„é‡‘ä¸é›€ï¼Œè€Œä¸æ˜¯è®¾ç½®ä¸¤ä¸ªç‹¬ç«‹çš„æœåŠ¡å™¨ã€‚å½“å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥å›æ»šåˆ°æ—§ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¯ä»¥åœ¨é‡‘ä¸é›€éƒ¨ç½²åˆ†æ”¯ä¸Šè¿›è¡Œè¿­ä»£ï¼Œå¹¶ç»§ç»­å‘å¸ƒï¼Œç›´åˆ°æ»¡è¶³é¢„æœŸä¸ºæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/gitops-for-istio-manage-istio-config-like-code/00704eQkgy1frucatn3n3j312q0lw102.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;åœ¨-weave-cloud-ä¸­git-æ§åˆ¶çš„é‡‘ä¸é›€å‘å¸ƒå…·æœ‰å®Œå…¨å¯è§‚å¯Ÿæ€§&#34;&gt;åœ¨ Weave Cloud ä¸­ï¼ŒGit æ§åˆ¶çš„é‡‘ä¸é›€å‘å¸ƒå…·æœ‰å®Œå…¨å¯è§‚å¯Ÿæ€§&lt;/h4&gt;
&lt;p&gt;é€šè¿‡æµæ°´çº¿æ¨é€å˜æ›´ï¼Œæ‚¨å¯ä»¥å‘ç”¨æˆ·å‘é€éƒ¨åˆ†ä¸€å®šæ¯”ä¾‹çš„æµé‡ã€‚ä½¿ç”¨ Weave Cloudï¼Œæ‚¨å¯ä»¥åœ¨ä»ªè¡¨æ¿ä¸­è§‚å¯Ÿé‡‘ä¸é›€æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œã€‚å¦‚æœæœ‰é—®é¢˜å¯ä»¥ç»§ç»­ä¿®æ”¹ï¼Œç„¶åæ¨å‡ºä¸‹ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¯¹å…¶è¿›è¡Œæ ‡è®°åé€šè¿‡åŒä¸€æµæ°´çº¿éƒ¨ç½²ã€‚è¿™å°±æ˜¯ GitOps å·¥ä½œæµç¨‹å¸®åŠ©æ‚¨ç®¡ç†çš„è¿­ä»£è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h3&gt;
&lt;p&gt;Alexis Richardson ç»™äº†æˆ‘ä»¬å…³äº GitOps çš„æ¦‚è¿°ï¼Œä»¥åŠä¸ºä»€ä¹ˆæ‚¨éœ€è¦åœ¨ç®¡ç†è¿è¡Œåœ¨ Kubernetes å’Œ Istio ä¸Šçš„åº”ç”¨ç¨‹åºæ—¶è€ƒè™‘è¿™ç§æ–¹æ³•ã€‚ç„¶å Varun Talwar è°ˆåˆ°äº† Istio æ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•ä½¿ç”¨ GitOps å·¥ä½œæµç¨‹æ¥ç®¡ç†åº”ç”¨ç¨‹åºã€‚æœ€åï¼ŒStefan Prodan å‘æˆ‘ä»¬å±•ç¤ºäº†ä¸€ä¸ªç‰¹æ®Šç”¨ä¾‹ï¼Œå…¶ä¸­éåŸå­å·¥ä½œæµç¨‹ï¼ˆå¦‚é‡‘ä¸é›€å‘å¸ƒï¼‰ä¹Ÿå¯ä»¥é€šè¿‡åƒ Istio è¿™æ ·çš„æœåŠ¡ç½‘æ ¼ä¸Šçš„ GitOps è¿›è¡Œç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡æ¼”è®²çš„è§†é¢‘è¯·è§ï¼š&lt;a href=&#34;https://www.youtube.com/watch?v=VkKMf23ZokY&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitOps for Istio - Manage Istio Config like Code - Varun Talwar &amp;amp; Alexis Richardson&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
