<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>EBPF | äº‘åŸç”Ÿç¤¾åŒºï¼ˆä¸­å›½ï¼‰</title>
    <link>https://cloudnativecn.com/category/ebpf/</link>
      <atom:link href="https://cloudnativecn.com/category/ebpf/index.xml" rel="self" type="application/rss+xml" />
    <description>EBPF</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><lastBuildDate>Wed, 10 Jan 2024 12:00:00 +0800</lastBuildDate>
    <image>
      <url>https://cloudnativecn.com/media/sharing.png</url>
      <title>EBPF</title>
      <link>https://cloudnativecn.com/category/ebpf/</link>
    </image>
    
    <item>
      <title>ç”¨ eBPF æ´å¯Ÿåº”ç”¨å±‚ç½‘ç»œæµé‡</title>
      <link>https://cloudnativecn.com/blog/application-traffic-with-ebpf/</link>
      <pubDate>Wed, 10 Jan 2024 12:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/application-traffic-with-ebpf/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://thebsdbox.co.uk/2023/12/08/Application-traffic-with-eBPF/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Application traffic with eBPF&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‘˜è¦ï¼šæœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ eBPF ç¨‹åºæ•è·ã€åˆ†æå’Œä¿®æ”¹åº”ç”¨å±‚çš„ç½‘ç»œæ•°æ®ï¼ŒåŒ…æ‹¬ HTTP å¤´éƒ¨å’Œ URL è·¯å¾„ã€‚ä½œè€…è¿˜å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ eBPF map åœ¨å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´ä¼ é€’æ•°æ®ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;../ebpf-adventures-in-networking/&#34;&gt;å…ˆå‰çš„å¸–å­&lt;/a&gt;ä¸­ï¼Œæˆ‘ç¨å¾®è°ˆåˆ°äº†å»ºç«‹ eBPF çŸ¥è¯†ï¼Œä»¥å¼€å§‹æ›´å¤šåœ°äº†è§£ç½‘ç»œé€‚é…å™¨çš„è¾“å…¥å’Œè¾“å‡ºæƒ…å†µã€‚åŸºæœ¬ä¸Šï¼Œå°†ä»¥å¤ªç½‘å¸§å¹¶å‰¥ç¦»æ ‡å¤´ï¼ˆä»¥å¤ªç½‘æ ‡å¤´+IP æ ‡å¤´+TCP/UDP æ ‡å¤´ï¼‰ï¼Œæœ€ç»ˆä½ å°†å¾—åˆ°æ¥è‡ªåº”ç”¨ç¨‹åºæˆ–æ•°æ®è§’åº¦çš„æ•°æ®åŒ…ä¸­å‰©ä½™çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰çš„ä»£ç éƒ½åœ¨â€œå­¦ä¹  eBPFâ€å­˜å‚¨åº“ä¸­ï¼Œå…·ä½“çš„ eBPF ä»£ç åœ¨&lt;a href=&#34;https://github.com/thebsdbox/learning-ebpf/blob/main/ebpf/http/http.c&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;ã€‚è¿™ç¯‡æ–‡ç« çš„è®¡åˆ’æ˜¯é€æ­¥ä»‹ç»æˆ‘è®¤ä¸ºæœ‰ç”¨æˆ–å¯èƒ½é‡è¦çš„éƒ¨åˆ†&amp;hellip;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šæ­¤ä»£ç ç¡®å®å¯¹å…¥å£/å‡ºå£æ•°æ®åŒ…è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼Œå› æ­¤éœ€è¦ 6.1+ çš„ Linux å†…æ ¸æ‰èƒ½ä½¿ç”¨ä¸€äº› eBPF åŠ©æ‰‹å‡½æ•°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ˜ å°„&#34;&gt;æ˜ å°„ï¼&lt;/h2&gt;
&lt;p&gt;ä½ å¯èƒ½ä»¥å‰é‡åˆ°è¿‡è¿™äº›å§ï¼Ÿå¦‚æœæ²¡æœ‰ï¼Œä¸ç”¨æ‹…å¿ƒï¼ç®€è€Œè¨€ä¹‹ï¼ŒeBPF æ˜ å°„æ˜¯åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ä¸­çš„ eBPF ç¨‹åºä¹‹é—´é€šä¿¡çš„æœºåˆ¶ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œéå¸¸é…·çš„ä¸€ç‚¹æ˜¯è¿™äº›æ˜ å°„ä½¿ç”¨é”®å’Œå€¼&amp;hellip;æ‰€ä»¥æˆ‘ä¸å¿…å¾ªç¯æ¯”è¾ƒæ•°æ®å¹¶å¯»æ‰¾åŒ¹é…çš„å†…å®¹ï¼Œæˆ‘ä¼ é€’ä¸€ä¸ªé”®ï¼Œå¦‚æœæœ‰åŒ¹é…çš„å†…å®¹ï¼Œæˆ‘å°±å¾—åˆ°ç›¸åº”çš„æ•°æ®:D&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æˆ‘å°†è¦ä½¿ç”¨çš„æ˜ å°„ï¼Œç§°ä¸º&lt;code&gt;url_map&lt;/code&gt;ï¼Œé”®æ˜¯ 20 ä¸ªå­—ç¬¦é•¿ï¼ˆå¯ä»¥è¯´æ˜¯æœ‰ç•Œçš„â€œå­—ç¬¦ä¸²â€ï¼‰ï¼Œåˆ†é…ç»™è¯¥é”®çš„å€¼æ˜¯æˆ‘åœ¨ä¸Šé¢å®šä¹‰çš„ç»“æ„ä½“ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// å®šä¹‰ä¸é”®å…³è”çš„ä¸åŒURL
struct url_path {
  __u8 path_len;
  __u8 path[max_path_len]; // è¿™åº”è¯¥æ˜¯ä¸€ä¸ªcharï¼Œä½†åœ¨è¿™é‡Œå’ŒGoä¹‹é—´çš„ä»£ç ç”Ÿæˆæœ‰ç‚¹ä¸åŒ...
};

// å®šä¹‰æˆ‘çš„URLæ˜ å°„
struct {
  __uint(type, BPF_MAP_TYPE_HASH);
  __uint(max_entries, 1024);
  __type(key, char[max_path_len]);
  __type(value, struct url_path);
}
url_map SEC(&amp;#34;.maps&amp;#34;);
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ebpf-ç¨‹åº&#34;&gt;eBPF ç¨‹åºï¼&lt;/h2&gt;
&lt;p&gt;ä»£ç ä¸­å®šä¹‰äº†ä¸¤ä¸ª eBPF ç¨‹åº&lt;code&gt;tc_egress&lt;/code&gt;å’Œ&lt;code&gt;tc_ingress&lt;/code&gt;ï¼Œå¦‚æœä½ èƒ½çŒœåˆ°å®ƒä»¬æ˜¯å¦‚ä½•è¿æ¥çš„ï¼Œé‚£å°±åŠ åˆ†ï¼åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åªå…³æ³¨&lt;code&gt;tc_ingress&lt;/code&gt;ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;å°±åƒæˆ‘ä»¬åœ¨å·²ç»å­˜åœ¨çš„ä¼—å¤šç¤ºä¾‹ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæ ‡å¤´è¯†åˆ«çš„æ“ä½œã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¿›è¡Œåˆç†æ€§æ£€æŸ¥ï¼Œå¹¶å°†&lt;code&gt;data&lt;/code&gt;å¼ºåˆ¶è½¬æ¢ä¸º&lt;code&gt;ethhdr&lt;/code&gt;ç±»å‹ï¼ˆ&lt;a href=&#34;https://en.wikipedia.org/wiki/Ethernet_frame&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»¥å¤ªç½‘æ ‡å¤´&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡è¯»å–ä»¥å¤ªç½‘æ ‡å¤´å†…éƒ¨çš„&lt;code&gt;h_proto&lt;/code&gt;ï¼ˆä¹Ÿç§°ä¸º&lt;code&gt;Ethertype&lt;/code&gt;ï¼‰æ¥æŸ¥æ‰¾ä»¥å¤ªç½‘å¸§å†…éƒ¨çš„åè®®ã€‚&lt;/li&gt;
&lt;li&gt;å°†ä»¥å¤ªç½‘æ ‡å¤´åçš„æ•°æ®å¼ºåˆ¶è½¬æ¢ä¸º&lt;code&gt;iphdr&lt;/code&gt;ç±»å‹ï¼ˆ&lt;a href=&#34;https://en.wikipedia.org/wiki/Internet_Protocol_version_4#Header&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IP æ ‡å¤´&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ IP æ ‡å¤´å†…æŸ¥æ‰¾åè®®ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç¡®å®š IP æ ‡å¤´çš„å¤§å°ï¼ˆåŸæ¥å®ƒä»¬å¯ä»¥æœ‰ä¸åŒçš„å¤§å°ï¼&lt;code&gt;Â¯\_(ãƒ„)_/Â¯&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºäº†ç¡®å®šæ ‡å¤´çš„å¤§å°ï¼Œæˆ‘ä»¬å°†å…¶å€¼ä¹˜ä»¥å››ï¼Œä½ å¯èƒ½ä¼šé—®ä¸ºä»€ä¹ˆï¼å¥½å§ï¼Œè¿™ä¸ªå€¼ä¹˜ä»¥ 32 ä½ä»¥ç¡®å®šæ ‡å¤´çš„å¤§å°ï¼Œæ‰€ä»¥å¦‚æœå€¼ä¸º 6ï¼Œé‚£ä¹ˆæ ‡å¤´å°†æ˜¯ 192 ä½ï¼ˆæˆ– 24 å­—èŠ‚ï¼‰ã€‚æ‰€ä»¥ï¼Œä¸ºäº†ç®€å•åœ°ç¡®å®š IP æ ‡å¤´çš„å­—èŠ‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå€¼ä¹˜ä»¥ 4ï¼&lt;/li&gt;
&lt;li&gt;å°†ä»¥ IP æ ‡å¤´åçš„æ•°æ®å¼ºåˆ¶è½¬æ¢ä¸º&lt;code&gt;tcphdr&lt;/code&gt;ç±»å‹ï¼ˆ&lt;a href=&#34;https://en.wikipedia.org/wiki/Transmission_Control_Protocol#TCP_segment_structure&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TCP æ ‡å¤´&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åƒæ­¥éª¤ï¼ˆ5ï¼‰ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®š TCP æ ‡å¤´çš„å¤§å°ï¼ˆå®ƒä¹Ÿå¯ä»¥æ˜¯åŠ¨æ€çš„ï¼‰ï¼Œåœ¨è¿™é‡Œçš„æ­¥éª¤ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å€¼&lt;code&gt;doff&lt;/code&gt;ä¹˜ä»¥å››æ¥ç¡®å®šæ ‡å¤´çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡è®¡ç®—æ‰€æœ‰è¿™äº›ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ¨æ–­å‡ºæ•°æ®ä½äºä»¥å¤ªç½‘æ ‡å¤´å¤§å°ã€IP æ ‡å¤´å¤§å°å’Œ TCP æ ‡å¤´å¤§å°çš„æœ«å°¾ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä» IP æ ‡å¤´ä¸­å‡å» IP å’Œ TCP æ ‡å¤´çš„å¤§å°æ¥ç¡®å®šåº”ç”¨ç¨‹åºæ•°æ®çš„å¤§å°ï¼Œä½¿ç”¨&lt;code&gt;tot_len&lt;/code&gt;ï¼ˆæ€»é•¿åº¦ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;åº”ç”¨æ•°æ®&#34;&gt;åº”ç”¨æ•°æ®ï¼ï¼&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†è¯»å–è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬å°†éœ€è¦ä¸Šé¢æåˆ°çš„ä¸€äº›ä¸œè¥¿ï¼&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ•°æ®åç§»é‡ï¼ˆæ•°æ®èµ·å§‹ä½ç½®ï¼‰ï¼Œå®ƒä½äºä»¥å¤ªç½‘æ ‡å¤´+IP æ ‡å¤´å¤§å°ï¼ˆä¸€æ—¦è®¡ç®—å‡ºæ¥ï¼‰å’Œ TCP æ ‡å¤´ï¼ˆå†æ¬¡ï¼Œä¸€æ—¦è®¡ç®—å‡ºæ¥ï¼‰ä¹‹åã€‚æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªç¼“å†²åŒºæ¥å­˜å‚¨æˆ‘ä»¬å°†ä»å¥—æ¥å­—ç¼“å†²åŒºä¸­è¯»å–çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ç”¨äºå­˜å‚¨æˆ‘ä»¬åº”ç”¨ç¨‹åºæ•°æ®çš„æ•°æ®ç¼“å†²åŒº
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pdata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;60&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// è®¡ç®—æ•°æ®å®é™…ä½ç½®çš„åç§»é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;poffset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ETH_HLEN&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip_hlen&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tcp_hlen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ä»å¥—æ¥å­—ç¼“å†²åŒºåŠ è½½æ•°æ®ï¼Œpoffset ä» TCP æ ‡å¤´çš„æœ«å°¾å¼€å§‹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ret&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;bpf_skb_load_bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;poffset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pdata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;60&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ret&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨&lt;code&gt;bpf_skb_load_bytes&lt;/code&gt;ä»å¥—æ¥å­—ç¼“å†²åŒºï¼ˆ&lt;code&gt;skb&lt;/code&gt;ï¼‰ä¸­è¯»å–ä¸€å®šé‡çš„æ•°æ®ï¼ˆ60 ä¸ªå­—èŠ‚ï¼‰åˆ°æˆ‘ä»¬çš„ç¼“å†²åŒºï¼ˆ&lt;code&gt;pdata&lt;/code&gt;ï¼‰ï¼Œèµ·å§‹ä½ç½®æ˜¯æˆ‘ä»¬çŸ¥é“æ•°æ®ä½äºçš„åç§»é‡ï¼ˆ&lt;code&gt;poffset&lt;/code&gt;ï¼‰ï¼&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶ï¼Œæˆ‘ä»¬æœ‰äº† 60 å­—èŠ‚çš„æ•°æ®ï¼Œåº”è¯¥è¶³å¤Ÿè®©æˆ‘ä»¬ç¼–å†™ä¸€äº›ä»£ç æ¥ç†è§£å®ƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;http-æ•°æ®--&#34;&gt;HTTP æ•°æ® :-)&lt;/h3&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹å½“æˆ‘ä»¬å°è¯•è¿›è¡Œ HTTP è¯·æ±‚æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plaintext&#34; data-lang=&#34;plaintext&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ~ curl code/test -vvv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;*   Trying 192.168.0.22:80...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* Connected to code (192.168.0.22) port 80 (#0)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; GET /test HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; Host: code
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; User-Agent: curl/7.87.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; Accept: */*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘æ­£åœ¨ä½¿ç”¨&lt;code&gt;curl&lt;/code&gt;ä»ä¸»æœº&lt;code&gt;code&lt;/code&gt;ï¼ˆcode æ˜¯æˆ‘çš„å¼€å‘ VMï¼Œè¿è¡Œ code-serverï¼‰è¯·æ±‚ URL &lt;code&gt;/test&lt;/code&gt;ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®ï¼ˆæ¯è¡Œä»¥&lt;code&gt;&amp;gt;&lt;/code&gt;å¼€å¤´ï¼Œç”¨äºç¡®å®šé€šä¿¡çš„æ–¹å‘ï¼‰ã€‚HTTP è¯·æ±‚ä¸­çš„ç¬¬ä¸€è¡Œæ•°æ®é€šå¸¸æ˜¯ä¸€ä¸ª&lt;em&gt;åŠ¨è¯&lt;/em&gt;ï¼Œåé¢æ˜¯æˆ‘ä»¬å¸Œæœ›ä¸ä¹‹äº¤äº’çš„èµ„æºï¼Œç„¶åæ˜¯ HTTP è§„èŒƒå’Œå›è½¦ç¬¦ï¼Œå¦‚&lt;a href=&#34;https://en.wikipedia.org/wiki/HTTP#HTTP/1.1_request_messages&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP æ ‡å‡†&lt;/a&gt;ä¸­å®šä¹‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å…³å¿ƒçš„è¡Œæ˜¯&lt;code&gt;GET /test&lt;/code&gt;ï¼ˆåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬/æˆ‘ä¸å¤ªå…³å¿ƒ HTTP è§„èŒƒ:Dï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ­¥æ˜¯è¯»å–&lt;code&gt;pdata&lt;/code&gt;çš„å‰ä¸‰ä¸ªå­—ç¬¦ï¼ŒæŸ¥æ‰¾&lt;code&gt;pdata[0] == G&lt;/code&gt;ï¼Œ&lt;code&gt;pdata[1] == E&lt;/code&gt;å’Œ&lt;code&gt;pdata[2] == T&lt;/code&gt;ï¼Œè¿™å°†æœ‰æ•ˆåœ°å¸®åŠ©æˆ‘ä»¬ç¡®å®šé¦–å…ˆæ˜¯å¦æ˜¯ HTTP è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯æ˜¯å¦æ˜¯ HTTP è¯·æ±‚ï¼&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦æˆ‘ä»¬éªŒè¯äº†è¿™å‰ 3 ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬å°†æƒ³è¦ä»ç¬¬ 4 ä¸ªå­—èŠ‚ï¼ˆè¯·æ±‚çš„å‰ä¸‰ä¸ªå­—èŠ‚åŠ ä¸Šä¸€ä¸ªç”¨äºåˆ†éš”çš„ç©ºæ ¼ï¼‰å¼€å§‹è¯»å–æ›´å¤šæ•°æ®ï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_path_len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;memset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path_len&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æŸ¥æ‰¾è¯·æ±‚ URIï¼ˆä»åç§»é‡ 4 å¼€å§‹ï¼‰ï¼Œä»¥ç©ºæ ¼ç»“æŸ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pdata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pdata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pdata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39;\0&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;path_len&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢çš„å‡½æ•°å°†ä» HTTP æ•°æ®çš„ç¬¬ 4 ä¸ªå­—èŠ‚å¼€å§‹ï¼ˆä»ç¬¬ 4 ä¸ªå­—èŠ‚å¼€å§‹ï¼‰è¯»å–å…¶ä½™çš„æ•°æ®ï¼Œç›´åˆ°é‡åˆ°ç©ºæ ¼ä¸ºæ­¢ï¼Œç•™ä¸‹æˆ‘ä»¬è¦&lt;code&gt;GET&lt;/code&gt;çš„ URLï¼æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªè°ƒè¯•æ‰“å°è¯­å¥æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;bpf_printk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;lt;- incoming path [%s], length [%d]&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path_len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†åœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plaintext&#34; data-lang=&#34;plaintext&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;idle&amp;gt;-0       [001] dNs3. 2252901.017812: bpf_trace_printk: &amp;lt;- incoming path [/test], length [5]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¯¹-http-åº”ç”¨ç¨‹åºè¯·æ±‚é‡‡å–è¡ŒåŠ¨&#34;&gt;å¯¹ HTTP åº”ç”¨ç¨‹åºè¯·æ±‚é‡‡å–è¡ŒåŠ¨&lt;/h3&gt;
&lt;p&gt;ä¸Šè¿°è§£é‡Šè¯¦ç»†è¯´æ˜äº†æˆ‘ä»¬å¦‚ä½•è¯»å–æ•°æ®ä»¥åŠå¦‚ä½•è¯»å–æ•°æ®ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³è¦â€œåŠ¨æ€â€æŸ¥æ‰¾ HTTP è¯·æ±‚ï¼Œæˆ‘ä»¬å°†éœ€è¦ä½¿ç”¨ eBPF æ˜ å°„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„ Go ç”¨æˆ·ç©ºé—´ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;flag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;The URL Path to watch for&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;flag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Parse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºä¸€ä¸ª uint8 æ•°ç»„
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;urlPath&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å°†æˆ‘ä»¬çš„å­—èŠ‚å¤åˆ¶åˆ° uint8 æ•°ç»„ä¸­ï¼ˆæˆ‘ä»¬å¯ä»¥è¿›è¡Œç±»å‹è½¬æ¢ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;urlPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å°†æˆ‘ä»¬çš„ urlPath ä½œä¸ºé”®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;objs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;UrlMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Put&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;urlPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;bpfUrlPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;urlPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;PathLen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;urlPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šé¢çš„ä»£ç ä¸­çœ‹åˆ°çš„ï¼Œå½“æˆ‘ä»¬å¯åŠ¨ Go ç¨‹åºæ—¶ï¼Œå®ƒå°†ä»æ ‡å¿—&lt;code&gt;-path&lt;/code&gt;ä¸­è¯»å–ï¼Œå¹¶å°†å…¶ç”¨ä½œæˆ‘ä»¬ eBPF æ˜ å°„ä¸­çš„&lt;strong&gt;é”®&lt;/strong&gt;ï¼Œå¯ä»¥æš‚æ—¶å¿½ç•¥å€¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;url_path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;found_path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;bpf_map_lookup_elem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;url_map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;found_path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;bpf_printk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Looks like we&amp;#39;ve found your path [%s]&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å¯èƒ½è¿›è¡Œæ›´å¤šæ“ä½œï¼Œé˜»æ­¢æµé‡æˆ–é‡å®šå‘ï¼Ÿ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æˆ‘ä»¬çš„ eBPF ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å°†å¯¹ HTTP è¯·æ±‚è¿›è¡Œæ˜ å°„æŸ¥æ‰¾ï¼Œå¦‚æœè¯¥è¯·æ±‚ä½œä¸º char æ•°ç»„å­˜åœ¨äº&lt;strong&gt;é”®&lt;/strong&gt;ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¯¹å…¶è¿›è¡Œæ“ä½œï¼&lt;/p&gt;
&lt;p&gt;ç°åœ¨å¯åŠ¨æˆ‘ä»¬çš„ Go ç¨‹åº &lt;code&gt;sudo ./http -interface ens160 -path /test&lt;/code&gt; å°†å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plaintext&#34; data-lang=&#34;plaintext&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0000] Starting ğŸ the eBPF HTTP watcher, on interface [ens160] for path [/test]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0000] Loaded TC QDisc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;INFO[0000] Press Ctrl-C to exit and remove the program
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &amp;lt;idle&amp;gt;-0       [001] d.s3. 2252901.015575: bpf_trace_printk: &amp;lt;- 0.0.0.0:56345 -&amp;gt; 0.0.0.0:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &amp;lt;idle&amp;gt;-0       [001] D.s3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;. 2252901.015642: bpf_trace_printk: -&amp;gt; 192.168.0.22:80 -&amp;gt; 192.168.0.180:56345
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &amp;lt;idle&amp;gt;-0       [001] d.s3. 2252901.017552: bpf_trace_printk: &amp;lt;- 0.0.0.0:56345 -&amp;gt; 0.0.0.0:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &amp;lt;idle&amp;gt;-0       [001] d.s3. 2252901.017793: bpf_trace_printk: &amp;lt;- 0.0.0.0:56345 -&amp;gt; 0.0.0.0:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &amp;lt;idle&amp;gt;-0       [001] dNs3. 2252901.017812: bpf_trace_printk: &amp;lt;- incoming path [/test], length [5]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &amp;lt;idle&amp;gt;-0       [001] dNs3. 2252901.017814: bpf_trace_printk: Looks like we&amp;#39;ve found your path [/test]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;è§£æ HTTP å¹¶ä¸å¤ªå›°éš¾ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„åè®®ï¼Œå®ƒä½¿ç”¨ç®€å•çš„åŠ¨è¯å’Œç»“æ„çš„ç®€å•æ–¹æ³•ï¼Œä½¿ç”¨ç©ºæ ¼å’Œå›è½¦ç¬¦æ¥åŒºåˆ†ã€‚è¿™ç§æ–¹æ³•å¯èƒ½ä¹Ÿé€‚ç”¨äºå…¶ä»–åè®®ï¼Œå¦‚ DNSã€POP3 æˆ– SMTPã€‚å½“æ•°æ®åŠ å¯†æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§è§£å¯†çš„æ–¹æ³•ï¼Œç„¶åæ‰èƒ½è§£ææ•°æ®ï¼ˆè¿™è¶…å‡ºäº†æˆ‘çš„èƒ½åŠ›&amp;hellip;ï¼‰ã€‚ä½†æ˜¯ï¼Œæˆ‘å¸Œæœ›è¿™ä¼šæ¿€å‘ä½ æ›´å¤šåœ°å°è¯•ä½¿ç”¨ eBPF æ¥è§£æå’Œæ“ä½œåº”ç”¨ç¨‹åºçš„æƒ³æ³•ï¼&lt;/p&gt;
&lt;p&gt;æˆ‘ä¸€ç›´æƒ³å†™ä¸€äº›æœ‰å¸Œæœ›æœ‰ç”¨çš„å…³äº eBPF çš„å¸–å­ï¼Œå°½ç®¡é€šå¸¸åœ¨æˆ‘æƒ³å‡ºå¯èƒ½æœ‰ç”¨çš„ä¸œè¥¿ä¹‹åï¼Œåˆ«äººå·²ç»æŠ¢å…ˆä¸€æ­¥ã€‚é‰´äºæˆ‘å·²ç»åœ¨ä¸€æ®µæ—¶é—´é‡Œä»¥æŸç§æ–¹å¼å…³æ³¨ç½‘ç»œï¼Œè¿™åŸºæœ¬ä¸Šæ˜¯æˆ‘å…³æ³¨çš„é¢†åŸŸï¼Œå°½ç®¡æˆ‘ç¡®å®ä¸ºæœ€è¿‘çš„ eBPF å³°ä¼š 2023 ç¼–å†™äº†ä¸€äº›æœ‰è¶£çš„å†…å®¹ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œæœ‰å¾ˆå¤šäººå¼€å§‹æ’°å†™ eBPF å†…å®¹ï¼Œæ‰€ä»¥æˆ‘å¯èƒ½ä¼šå‚è€ƒä»–ä»¬çš„å¸–å­ï¼Œè€Œä¸æ˜¯é‡å¤å†…å®¹ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å¦‚ä½•ç”¨ eBPF æ”¹å˜ç½‘ç»œç¼–ç¨‹çš„æ¸¸æˆè§„åˆ™</title>
      <link>https://cloudnativecn.com/blog/ebpf-adventures-in-networking/</link>
      <pubDate>Wed, 10 Jan 2024 08:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/ebpf-adventures-in-networking/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://thebsdbox.co.uk/2023/11/18/eBPF-adventures-in-networking/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;eBPF adventures in networking&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‘˜è¦ï¼šè¿™ç¯‡æ–‡ç« ä»‹ç»äº† eBPF åœ¨ç½‘ç»œé¢†åŸŸçš„ä¸€äº›åº”ç”¨å’Œå®è·µï¼ŒåŒ…æ‹¬ XDPã€TC å’Œ sysprobes ä¸‰ç§ä¸åŒçš„ eBPF ç¨‹åºæŒ‚è½½æ–¹å¼çš„ä¼˜ç¼ºç‚¹ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ eBPF å®ç°ç½‘ç»œæ•°æ®çš„æ•è·ã€åˆ†æå’Œä¿®æ”¹ã€‚ä½œè€…è¿˜åˆ†äº«äº†ä¸€äº›æœ‰ç”¨çš„ eBPF å·¥å…·å’Œèµ„æºï¼Œä»¥åŠè‡ªå·±å¼€å‘çš„ä¸€ä¸ª eBPF ç½‘ç»œä»£ç†çš„é¡¹ç›®ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æˆ‘ä¸€ç›´æƒ³å†™ä¸€äº›å…³äº eBPF çš„å¸–å­ï¼Œå¸Œæœ›å®ƒä»¬èƒ½æœ‰æ‰€å¸®åŠ©ï¼Œå°½ç®¡é€šå¸¸åœ¨æˆ‘æƒ³åˆ°å¯èƒ½æœ‰ç”¨çš„ä¸œè¥¿æ—¶ï¼Œå…¶ä»–äººå·²ç»å…ˆæˆ‘ä¸€æ­¥äº†ã€‚é‰´äºæˆ‘å·²ç»åœ¨ç½‘ç»œæ–¹é¢é›†ä¸­ç²¾åŠ›ä¸€æ®µæ—¶é—´ï¼Œè¿™åŸºæœ¬ä¸Šæ˜¯æˆ‘ä¸“æ³¨çš„é¢†åŸŸï¼Œå°½ç®¡æˆ‘ç¡®å®è®¾æ³•ä¸ºæœ€è¿‘çš„ eBPF å³°ä¼š 2023 å‡†å¤‡äº†ä¸€äº›æˆ‘è®¤ä¸ºå¾ˆæœ‰è¶£çš„ä¸œè¥¿ã€‚æ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„ï¼Œæœ‰å¾ˆå¤šäººå¼€å§‹æ’°å†™å…³äº eBPF çš„å†…å®¹ï¼Œå› æ­¤æˆ‘å¯èƒ½ä¼šå‚è€ƒä»–ä»¬çš„å¸–å­ï¼Œè€Œä¸æ˜¯é‡å¤å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å°†ä»ä¸€äº›åœ¨ Linux å†…æ ¸ä¸­å¯èƒ½æˆ–å¯èƒ½ä¸ä¼šé‡åˆ°çš„é¦–å­—æ¯ç¼©å†™æˆ–æŠ€æœ¯å¼€å§‹ã€‚ä½†åŸºæœ¬ä¸Šä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼Œè¿™äº›æ˜¯ä½ ä¿®æ”¹æ­£åœ¨è¿è¡Œçš„ç³»ç»Ÿä»¥ä¸ç½‘ç»œæ•°æ®äº¤äº’çš„ä¸»è¦é€‰é¡¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;xdp&#34;&gt;XDP&lt;/h3&gt;
&lt;p&gt;å…³äº eXpress Data Plane å·²ç»å­˜åœ¨å¤§é‡ä¿¡æ¯ï¼Œå› æ­¤æˆ‘ä¸ä¼šæ·±å…¥æ¢è®¨å¤ªå¤šç»†èŠ‚ã€‚&lt;code&gt;tl;dr&lt;/code&gt;æ˜¯ XDP eBPF ç¨‹åºæŒ‚é’©åˆ° XDP å°†ä½¿å…¶èƒ½å¤Ÿè®¿é—®ç”±å†…æ ¸è‡ªèº«å¤„ç†ä¹‹å‰çš„ä¼ å…¥ç½‘ç»œå¸§ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒeBPF ç¨‹åºå°†åŠ è½½åˆ° NIC é©±åŠ¨ç¨‹åºæœ¬èº«ä¸­ï¼Œè¿™å°†æœ‰æ•ˆåœ°å°†ç¨‹åºå¸è½½åˆ° NIC æœ¬èº«ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¼˜ç‚¹&#34;&gt;ä¼˜ç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æœ€ä½³æ€§èƒ½&lt;/li&gt;
&lt;li&gt;éå¸¸é€‚ç”¨äºé˜²ç«å¢™ã€DDoS é˜²æŠ¤æˆ–è´Ÿè½½å‡è¡¡ç­‰ç”¨ä¾‹&lt;/li&gt;
&lt;li&gt;åœ¨ä»»ä½•å…¶ä»–å†…å®¹è¿›è¡Œä¿®æ”¹ä¹‹å‰çœ‹åˆ°ä¼ å…¥çš„æµé‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç¼ºç‚¹&#34;&gt;ç¼ºç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä»…æ”¯æŒå…¥ç«™æµé‡ï¼Œä½¿ç”¨ XDP ç¨‹åºçœ‹åˆ°çš„ä»»ä½•æµé‡éƒ½åªæ˜¯ä¼ å…¥æµé‡ï¼Œç›®å‰æ— æ³•çœ‹åˆ°å‡ºç«™æµé‡&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;XDP&lt;/code&gt;æ•°æ®ç»“æ„ï¼Œä¸å¤§å¤šæ•°å¥—æ¥å­—ç¼–ç¨‹çš„é»˜è®¤æ•°æ®ç»“æ„&lt;code&gt;SKB&lt;/code&gt;æœ‰ä¸€äº›ä¸åŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;tctraffic-controlæˆ–æµé‡æ§åˆ¶&#34;&gt;TCï¼ˆTraffic Controlï¼‰æˆ–æµé‡æ§åˆ¶&lt;/h3&gt;
&lt;p&gt;Traffic Control æ˜¯å†…æ ¸ç½‘ç»œç»“æ„çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸»è¦åŒ…æ‹¬æ·»åŠ è¯¸å¦‚ qdisc å’Œè¿‡æ»¤å™¨ä¹‹ç±»çš„åŠŸèƒ½åˆ°æ¥å£çš„èƒ½åŠ›ã€‚qdisc ä¸»è¦é›†ä¸­åœ¨ä¸º TBDï¼ˆå¾…å®šï¼‰æä¾›æœåŠ¡ï¼Œè€Œè¿‡æ»¤å™¨é€šå¸¸åœ¨åº•å±‚å®é™…ä¸Šæ˜¯ä¸€ä¸ª eBPF ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;å¸¸è§çš„å·¥ä½œæµç¨‹æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªå…³æ³¨å…¥å£æˆ–å‡ºå£çš„ qdiscï¼Œæˆ–è€…æ›¿æ¢ä¸€ä¸ªç°æœ‰çš„ qdiscã€‚qdisc å°†é™„åŠ åˆ°æ¥å£ä¸Šã€‚&lt;/li&gt;
&lt;li&gt;åŠ è½½ä½ çš„ eBPF ç¨‹åºã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå°†å…¶é™„åŠ åˆ°é€šè¿‡æ¥å£ä¸Šçš„ qdisc ä¸Šçš„å…¥å£æˆ–å‡ºå£ä¹‹ä¸€ã€‚è¯¥è¿‡æ»¤å™¨å°†ä¸ eBPF ç¨‹åºç›¸å…³è”ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰ä¼ å…¥æˆ–ä¼ å‡ºçš„æµé‡ç°åœ¨éƒ½ä¼šé€šè¿‡ä¸€ä¸ªç¨‹åºè¿è¡Œï¼ˆå¦‚æœè¿æ¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è·åˆ© ğŸ’°&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;ä¼˜ç‚¹-1&#34;&gt;ä¼˜ç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æä¾›å…¥å£å’Œå‡ºå£çš„æŒ‚é’©ç‚¹&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ä¼ ç»Ÿçš„&lt;code&gt;SKB&lt;/code&gt;æ•°æ®ç»“æ„&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç¼ºç‚¹-1&#34;&gt;ç¼ºç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å°† TC ç¨‹åºé™„åŠ åˆ°å…¥å£æˆ–å‡ºå£é˜Ÿåˆ—ç¨å¾®å¤æ‚ä¸€äº›ã€‚ç”¨æˆ·éœ€è¦ä½¿ç”¨ qdisc æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼ŒæŸäº› eBPF SDK ä¸ä¼šåŸç”Ÿæ”¯æŒ TC ç¨‹åºçš„ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;TC eBPF ç¨‹åºçœ‹åˆ°çš„æµé‡å¯èƒ½å·²ç»è¢«ä¹‹å‰çš„ XDP ç¨‹åºæˆ–å†…æ ¸æœ¬èº«ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç³»ç»Ÿè°ƒç”¨&#34;&gt;ç³»ç»Ÿè°ƒç”¨&lt;/h3&gt;
&lt;p&gt;ä¸å…¶ä»–ä¸¤ç§ä¸“é—¨è®¾è®¡ç”¨äºå¤„ç†ç½‘ç»œçš„æ–¹æ³•ç›¸æ¯”ï¼Œè¿™å¯èƒ½ä¼šæ˜¾å¾—æœ‰äº›å¥‡æ€ªï¼Œå› ä¸ºå®ƒæ˜¯å°†ä¸€äº› eBPF ä»£ç é™„åŠ åˆ°å†…æ ¸ä¸­çš„ç³»ç»Ÿè°ƒç”¨çš„ä¸€ç§æ›¿ä»£æ–¹æ³•ï¼Œå…·ä½“æ¥è¯´æ˜¯&lt;code&gt;tcp4_connect()&lt;/code&gt; / &lt;code&gt;tcp6_connect()&lt;/code&gt;ç­‰è°ƒç”¨ã€‚è¿™åœ¨åè®®æ ˆä¸­ç•¥å¾®é åï¼Œå› ä¸ºåœ¨æ­¤æ—¶ï¼Œä¼ å…¥æ•°æ®åŒ…å·²ç»ç»è¿‡äº†å¾ˆå¤šå†…æ ¸é€»è¾‘ï¼Œè€Œ eBPF å†…çœç‚¹æ˜¯å½“æµé‡å³å°†ä¸åº”ç”¨ç¨‹åºæœ¬èº«äº¤äº’æ—¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼–å†™ç½‘ç»œç¨‹åº&#34;&gt;ç¼–å†™ç½‘ç»œç¨‹åºï¼&lt;/h2&gt;
&lt;p&gt;æ‰€ä»¥åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬ï¼ˆå¸Œæœ›ï¼‰æ„è¯†åˆ°æˆ‘ä»¬æœ‰è®¸å¤šä¸åŒçš„å…¥å£ç‚¹ï¼Œå…è®¸æˆ‘ä»¬åœ¨â€œä¼ é€å¸¦â€ä¸Šæ³¨å…¥æˆ‘ä»¬çš„ä»£ç ï¼Œè¿™ä¸ªä¼ é€å¸¦ä» NIC å¼€å§‹ï¼Œä¸€ç›´åˆ°åº”ç”¨ç¨‹åºï¼ˆä»¥åŠåœ¨å‡ºç«™çš„æƒ…å†µä¸‹ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å›é¡¾&#34;&gt;å›é¡¾&lt;/h3&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬æ‰€è°“çš„â€œä¼ é€å¸¦â€çš„å¼€å¤´ï¼Œæˆ‘ä»¬å¯ä»¥é™„åŠ æˆ‘ä»¬çš„ XDP ç¨‹åºå¹¶è·å¾—æœªç»è§¦ç¢°çš„åŸå§‹ç½‘ç»œæ•°æ®ã€‚åœ¨â€œä¼ é€å¸¦â€çš„ä¸­é—´ï¼Œæˆ‘ä»¬çš„ TC ç¨‹åºå°†æˆä¸ºé€šè¿‡å†…æ ¸çš„è·¯å¾„çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶æ¥æ”¶å¯èƒ½è¢«ä¿®æ”¹çš„ç½‘ç»œæ•°æ®ã€‚åœ¨ä¼ é€å¸¦çš„æœ«ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»£ç é™„åŠ åˆ°åº”ç”¨ç¨‹åºå°†åœ¨å®ƒè¢«è¿è¡Œä¹‹å‰è·å–ç½‘ç»œæ•°æ®çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å¯ä»¥åœ¨ä¼ é€å¸¦çš„æœ«ç«¯è¿›è¡Œé™„åŠ ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®è¡¨ç¤º&#34;&gt;æ•°æ®è¡¨ç¤º&lt;/h3&gt;
&lt;p&gt;ä½ çš„ç¨‹åºé™„åŠ åˆ°çš„ä½ç½®å†³å®šäº†ä¸¤ä¸ªä¸»è¦äº‹ç‰©ï¼Œä¸€ä¸ªæ˜¯æ½œåœ¨çš„æµé‡ä¿®æ”¹çš„ç›¸å¯¹çº§åˆ«ï¼Œå¦ä¸€ä¸ªæ˜¯æµé‡çš„è¡¨ç¤ºæ–¹å¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;xdp-ç»“æ„&#34;&gt;XDP ç»“æ„&lt;/h3&gt;
&lt;p&gt;æˆ‘ä¼šå†™å…³äºå®ƒçš„å†…å®¹ï¼Œä½†æ˜¯ DataDog å·²ç»åšäº†ï¼Œä½ å¯ä»¥åœ¨&lt;a href=&#34;https://www.datadoghq.com/blog/xdp-intro/#the-flow-of-an-xdp-program&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;é˜…è¯»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;skbå¥—æ¥å­—ç¼“å†²åŒº&#34;&gt;SKBï¼ˆå¥—æ¥å­—ç¼“å†²åŒºï¼‰&lt;/h3&gt;
&lt;p&gt;SKB æ˜¯åœ¨ eBPF æ·»åŠ åˆ°å†…æ ¸ä¹‹å‰å°±å­˜åœ¨äºå†…æ ¸ä¸­çš„æ•°æ®ç±»å‹ï¼Œå®ƒå·²ç»å…·å¤‡äº†ä¸€äº›ä½¿ä¸ SKB å¯¹è±¡äº¤äº’å˜å¾—ç¨å¾®å®¹æ˜“ä¸€äº›çš„è¾…åŠ©åŠŸèƒ½ã€‚æœ‰å…³æ›´æ·±å…¥çš„ SKB ä»‹ç»ï¼Œä½ å¯ä»¥é˜…è¯»æ­¤æ–‡ -&amp;gt; &lt;a href=&#34;http://vger.kernel.org/~davem/skb_data.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://vger.kernel.org/~davem/skb_data.html&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;è§£ææ•°æ®&#34;&gt;è§£ææ•°æ®&lt;/h3&gt;
&lt;p&gt;æ— è®ºä¸å“ªä¸ªç»“æ„è¿›è¡Œäº¤äº’ï¼Œå®ƒä»¬éƒ½å…±äº«ä¸€äº›å…±åŒä¹‹å¤„ï¼Œè¿™ä¸»è¦æ˜¯ä¸¤ä¸ªå˜é‡ï¼Œå¯¹äºè¿™ä¸¤ç§æ•°æ®ç±»å‹æ¥è¯´æ˜¯ç›¸åŒçš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›å˜é‡æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;data&lt;/code&gt;ï¼Œå®ƒæ˜¯ eBPF ç¨‹åºæ¥æ”¶åˆ°çš„æ•°æ®çš„æŒ‡é’ˆ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;data_len&lt;/code&gt;ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•´æ•°ï¼ŒæŒ‡å®šäº†æœ‰å¤šå°‘æ•°æ®å¯ç”¨ï¼ˆä»¥å¸®åŠ©ç¡®ä¿ä½ æ°¸è¿œä¸ä¼šè®¿é—®&lt;code&gt;data&lt;/code&gt;è¶…è¿‡&lt;code&gt;data_len&lt;/code&gt;ï¼ˆæ˜¾è€Œæ˜“è§çš„çœŸç† ğŸ¤“ï¼‰ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€ä»¥è¿™ä¸€åˆ‡ä¼¼ä¹å¾ˆç®€å•ï¼Œä½†ç­‰ç­‰&amp;hellip; &lt;code&gt;*data&lt;/code&gt;ä¸­å®é™…ä¸Šæœ‰ä»€ä¹ˆï¼Ÿï¼ˆè¿™å–å†³äºä½ çš„å‘ç°ï¼‰&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä¸æ–­â€œè½¬æ¢â€&lt;code&gt;*data&lt;/code&gt;å¹¶æ²¿ç€å®ƒç§»åŠ¨ä»¥å‰¥ç¦»å„ç§æ ‡å¤´ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£å’ŒæŸ¥æ‰¾åº•å±‚æ•°æ®ï¼&lt;/p&gt;
&lt;h3 id=&#34;è½¬æ¢&#34;&gt;è½¬æ¢ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥è·³è¿‡æ­¤éƒ¨åˆ†ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿï¼ˆä¸”ç³Ÿç³•ï¼‰çš„ç¤ºä¾‹ï¼Œè¯´æ˜äº†æˆ‘ä»¬é€šå¸¸å¦‚ä½•å°†ä¸€äº›åŸå§‹æ•°æ®è½¬æ¢ä¸ºæœ‰æ„ä¹‰çš„ä¸œè¥¿ã€‚ç›®å‰ï¼Œ&lt;code&gt;*data&lt;/code&gt;å°†åªæ˜¯ä¸€ä¸²éšæœºæ•°æ®ï¼Œæ¯«æ— æ„ä¹‰ï¼Œæˆ‘ä»¬éœ€è¦æœ‰æ•ˆåœ°ä¸ºå…¶æ·»åŠ â€œæ ¼å¼â€ä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ç†è§£å…¶å¤–è§‚ã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘ä¸€ä¸‹éšæœºæ•°æ®è¡Œï¼šâ€œBobby0004500100.503 Harvard Drive90210â€ï¼Œå…¶ä¸­ä¸€äº›å¯¹è£¸çœ¼æ¥è¯´æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½†æœ‰äº›æ˜¯ä¸æ¸…æ¥šçš„ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è±¡ä¸€ä¸‹åä¸ºâ€œpersonâ€çš„æ•°æ®ç»“æ„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Name: string
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Age: number
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Balance: float
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Street: string
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ZipCode: number
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæˆ‘ä»¬è¦å°†æˆ‘ä»¬çš„éšæœºæ•°æ®â€œè½¬æ¢â€ä¸ºä¸Šé¢çš„â€œpersonâ€ç»“æ„ï¼Œå®ƒå°†çªç„¶å˜æˆï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Name: Bobby
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Age: &lt;span class=&#34;m&#34;&gt;45&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Balance: 100.50
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Street: &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; Harvard Drive
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ZipCode: &lt;span class=&#34;m&#34;&gt;90210&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨çªç„¶é—´ï¼Œæˆ‘èƒ½å¤Ÿç†è§£å¹¶è®¿é—®ç»“æ„ä¸­çš„åº•å±‚å˜é‡ï¼Œå› ä¸ºå®ƒä»¬ç°åœ¨æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå³ person-&amp;gt;Nameï¼Œå¹¶ä¸”å‘ç°æ­¤ç‰¹å®šçš„ person ç±»å‹å¯¹è±¡å…·æœ‰åç§°å˜é‡â€œBobbyâ€ï¼&lt;/p&gt;
&lt;p&gt;è¿™æ­£æ˜¯æˆ‘ä»¬å°†å¯¹æˆ‘ä»¬çš„&lt;code&gt;*data&lt;/code&gt;æ‰€åšçš„ï¼&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®ä¸­åŒ…å«ä»€ä¹ˆ&#34;&gt;æ•°æ®ä¸­åŒ…å«ä»€ä¹ˆï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å› æ­¤ï¼Œç¬¬ä¸€æ­¥æ˜¯ç¡®å®šæ•°æ®æ˜¯å¦ä»¥ä»¥å¤ªç½‘å¸§å¼€å¤´ï¼å‡ ä¹æ‰€æœ‰ä¼ è¾“çš„æ•°æ®éƒ½ä»¥ä»¥å¤ªç½‘å¸§å¼€å¤´ï¼Œè¿™ç›¸å½“ç®€å•ï¼Œä½†å…¶ä½œç”¨æ˜¯å…·æœ‰æºå’Œç›®æ ‡ç¡¬ä»¶åœ°å€ï¼ˆæ— è®ºè™šæ‹ŸåŒ–/å®¹å™¨åŒ–/æœ‰çº¿ç½‘ç»œè¿˜æ˜¯ WiFi å¦‚ä½•ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€æ­¥æ˜¯å°†æˆ‘ä»¬çš„&lt;code&gt;*data&lt;/code&gt;è½¬æ¢ä¸ºç±»å‹&lt;code&gt;ETHHDR&lt;/code&gt;ï¼Œå¦‚æœæˆåŠŸï¼Œæˆ‘ä»¬ç°åœ¨å°†èƒ½å¤Ÿäº†è§£ç»„æˆä»¥å¤ªç½‘å¤´æ•°æ®ç±»å‹çš„å˜é‡ã€‚è¿™äº›åŒ…æ‹¬æºå’Œç›®æ ‡ MAC åœ°å€ï¼Œä½†æ›´é‡è¦çš„æ˜¯å‰©ä½™æ•°æ®çš„å†…å®¹æ˜¯ä»€ä¹ˆã€‚å†æ¬¡ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä»¥å¤ªç½‘å¤´ä¹‹åçš„&lt;code&gt;*data&lt;/code&gt;å†…å®¹é€šå¸¸æ˜¯ IP å¤´ï¼Œä½†æˆ‘ä»¬å°†é€šè¿‡æ£€æŸ¥ä»¥å¤ªç½‘å¸§çš„ TBD å˜é‡æ¥éªŒè¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦æˆ‘ä»¬éªŒè¯ä¸‹ä¸€ç»„æ•°æ®æ˜¯ IP å¤´ï¼Œæˆ‘ä»¬å°†éœ€è¦å°†ä»¥å¤ªç½‘å¤´ä¹‹åçš„æ•°æ®è½¬æ¢ä¸º IPHDR ç±»å‹ã€‚ä¸€æ—¦æˆ‘ä»¬è¿™æ ·åšï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿè®¿é—® IP ç‰¹å®šçš„æ•°æ®ï¼Œä¾‹å¦‚æº IPï¼ˆ&lt;code&gt;saddr&lt;/code&gt;ï¼‰æˆ–ç›®æ ‡åœ°å€ï¼ˆ&lt;code&gt;daddr&lt;/code&gt;ï¼‰ï¼Œå†æ¬¡é‡è¦çš„æ˜¯ IP å¤´åŒ…å«ä¸€ä¸ªå˜é‡ï¼Œè¯¦ç»†è¯´æ˜äº† IP å¤´ä¹‹åçš„æ•°æ®æ˜¯ä»€ä¹ˆã€‚è¿™é€šå¸¸æ˜¯ TCP å¤´æˆ– UDP å¤´ï¼Œä½†è¿˜æœ‰å…¶ä»–é€‰æ‹©ï¼Œä¾‹å¦‚ sctp ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦æˆ‘ä»¬æŸ¥çœ‹äº† IP å¤´çš„å†…éƒ¨å¹¶ç¡®å®šæ•°æ®ç±»å‹æ˜¯ TCPï¼ˆä¹Ÿå¯èƒ½æ˜¯ UDP æˆ–å…¶ä»–å†…å®¹ï¼‰ï¼Œæˆ‘ä»¬å°†æŠŠä»¥å¤ªç½‘å¤´å’Œ IP å¤´ä¹‹åçš„æ•°æ®éƒ½è½¬æ¢ä¸º TCP å¤´ç±»å‹ï¼ï¼ˆå‡ ä¹å®Œæˆäº†ï¼‰ã€‚é€šè¿‡è®¿é—® TCP å¤´çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾— TCP ç‰¹å®šçš„æ•°æ®ï¼Œä¾‹å¦‚æºç«¯å£æˆ–ç›®æ ‡ç«¯å£ï¼Œç”¨äºéªŒè¯æ•°æ®çš„æœ‰æ•ˆæ€§çš„æ ¡éªŒå’Œä»¥åŠå…¶ä»–æœ‰ç”¨çš„å˜é‡ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å‡ ä¹æ‹¥æœ‰ä¸€åˆ‡ï¼Œä½†æ˜¯ TCP å¤´çš„é•¿åº¦å¯èƒ½æ˜¯å¯å˜çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡æŸ¥çœ‹ tcl_len å˜é‡æ¥ç¡®å®šè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ä¹˜ä»¥ 4ã€‚ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰äº†è®¿é—®æœ€ç»ˆæ•°æ®æ‰€éœ€çš„ä¸€åˆ‡ï¼&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œ&lt;code&gt;*data&lt;/code&gt;æŒ‡å‘æ•°æ®çš„å¼€å¤´ï¼æˆ‘ä»¬å·²ç»ç¡®å®šäº†ä»¥å¤ªç½‘å¤´ä¹‹åæ˜¯ IP å¤´ï¼Œæœ€åæ˜¯ TCP å¤´ï¼Œè¿™æ„å‘³ç€`*data + ä»¥å¤ªç½‘å¤´ + IP å¤´ + TCP å¤´ = å®é™…åº”ç”¨ç¨‹åºæ•°æ®ï¼&lt;/p&gt;
&lt;h3 id=&#34;æˆ‘ä»¬å¯ä»¥ç”¨è¿™äº›ä¿¡æ¯åšä»€ä¹ˆ&#34;&gt;æˆ‘ä»¬å¯ä»¥ç”¨è¿™äº›ä¿¡æ¯åšä»€ä¹ˆï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å½“æˆ‘ä»¬è§£æå„ç§æ ‡å¤´æ—¶ï¼Œå®é™…ä¸Šåœ¨ OSI æ¨¡å‹çš„ä¸åŒå±‚æ¬¡ä¸Šè§£é”äº†è¶Šæ¥è¶Šå¤šçš„ä¿¡æ¯ï¼&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;[ç¬¬ 2 å±‚]&lt;/strong&gt; ä»¥å¤ªç½‘å¤´ä¸ºæˆ‘ä»¬æä¾›äº†æºå’Œç›®æ ‡ç¡¬ä»¶åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤ä¿¡æ¯æ¥æ½œåœ¨åœ°é˜»æ­¢ä»æˆ‘ä»¬çŸ¥é“å±é™©çš„æº MAC åœ°å€å¤„ç†çš„å¸§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;[ç¬¬ 3 å±‚]&lt;/strong&gt; IP å¤´åŒ…å«æºå’Œç›®æ ‡ IP åœ°å€ï¼Œå†æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥åƒé˜²ç«å¢™ä¸€æ ·è¿ä½œï¼Œé€šè¿‡ä½¿ç”¨ eBPF ç¨‹åºä¸¢å¼ƒç‰¹å®š IP åœ°å€çš„æ‰€æœ‰æµé‡ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ® IP åœ°å€é‡å®šå‘æµé‡ï¼Œæˆ–è€…ç”šè‡³åœ¨è¿™ä¸€å±‚å®æ–½è´Ÿè½½å‡è¡¡é€»è¾‘ï¼Œä»¥å°†æµé‡é‡å®šå‘åˆ°å…¶ä»–åº•å±‚ IP åœ°å€é›†åˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;[ç¬¬ 4 å±‚]&lt;/strong&gt; TCP æˆ– UDP æ ‡å¤´å®šä¹‰äº†ç›®æ ‡ç«¯å£å·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›ä¿¡æ¯æ¥ç¡®å®šåº”ç”¨ç¨‹åºåè®®æ˜¯ä»€ä¹ˆï¼ˆå³ç«¯å£ 80 é€šå¸¸æ„å‘³ç€å‰©ä½™çš„*data å¯èƒ½æ˜¯ HTTP æ•°æ®ï¼‰ã€‚åœ¨è¿™ä¸€å±‚ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ‰§è¡Œè´Ÿè½½å‡è¡¡ç­‰æ“ä½œï¼ŒåŸºäºç›®æ ‡ï¼ˆå³åœ¨å¤šä¸ªå…¶ä»–è´Ÿè½½å‡è¡¡å™¨åœ°å€ä¹‹é—´å¹³è¡¡ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;[ç¬¬ 7 å±‚]&lt;/strong&gt; æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œå„ç§æ ‡å¤´é›†åˆçš„æœ«å°¾çš„æ•°æ®æ˜¯å®é™…çš„åº”ç”¨ç¨‹åºæ•°æ®ï¼Œåªè¦æˆ‘ä»¬çŸ¥é“æ ¼å¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è§£æå®ƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¤–éƒ¨ Web æµè§ˆå™¨å°è¯•è®¿é—®æˆ‘çš„è®¡ç®—æœºä¸Šçš„&lt;code&gt;/index.html&lt;/code&gt;å¹¶é™„åŠ äº† eBPF ç¨‹åºï¼Œæˆ‘ä¼šè§£æåˆ° TCPï¼Œç„¶åç¡®å®šå®ƒæ˜¯ç«¯å£ 80ï¼Œç„¶ååº”ç”¨ç¨‹åºæ•°æ®åº”è¯¥æ˜¯ HTTP æ ¼å¼ã€‚æˆ‘å¯ä»¥é€šè¿‡æŸ¥çœ‹åº”ç”¨ç¨‹åºæ•°æ®çš„å‰ä¸‰ä¸ªå­—ç¬¦ï¼ˆåœ¨æ‰€æœ‰æ ‡å¤´ä¹‹åï¼‰æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼Œä½¿ç”¨ä»¥ä¸‹ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;ApplicationData&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; EthernetHDR + IPHDR + TCPHDR // å°†æ‰€æœ‰æ ‡å¤´é•¿åº¦ç›¸åŠ ä»¥æ‰¾åˆ°æ•°æ®
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;If &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt; data&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ApplicationData&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;G&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; data&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ApplicationData+1&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;E&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; data&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ApplicationData+2&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;T&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	// è¿™æ˜¯ä¸€ä¸ªHTTP GETè¯·æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	// åšä¸€äº›ä»¤äººå…´å¥‹çš„äº‹æƒ…
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬â€œæœ‰ç‚¹â€ç†è§£äº†è¿™ä¸ªé€»è¾‘ï¼Œä¹Ÿè®¸æˆ‘ä»¬åº”è¯¥è€ƒè™‘å®æ–½ä¸€äº›ä»£ç æ¥å®Œæˆæ‰€æœ‰è¿™äº›&amp;hellip;ä½†è¿™å°†æ˜¯å¦ä¸€å¤©çš„äº‹æƒ…ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æ·±å…¥æµ…å‡ºè¿ç»´å¯è§‚æµ‹å·¥å…·ï¼ˆä¸€ï¼‰ï¼šèŠèŠ eBPF çš„å‰ä¸–ä»Šç”Ÿ</title>
      <link>https://cloudnativecn.com/blog/current-state-and-future-of-ebpf/</link>
      <pubDate>Thu, 10 Aug 2023 15:05:42 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/current-state-and-future-of-ebpf/</guid>
      <description>&lt;p&gt;ä»Šå¤©è·Ÿå¤§å®¶åˆ†äº«çš„ eBPFï¼ˆextended Berkeley Packet Filterï¼‰ï¼Œç›¸ä¿¡å¾ˆå¤šæŠ€æœ¯äººå‘˜å·²ç»å¾ˆç†Ÿæ‚‰äº†ã€‚ä½œä¸º Linux ç¤¾åŒºçš„æ–°å® ï¼Œå®ƒå¤‡å— Gooleã€Facebookã€Twitter ç­‰å¤§å…¬å¸çš„é’çã€‚&lt;/p&gt;
&lt;h2 id=&#34;ebpf-ç©¶ç«Ÿæœ‰ä»€ä¹ˆé­”åŠ›è®©å¤§å®¶è¿™ä¹ˆå…³æ³¨&#34;&gt;eBPF ç©¶ç«Ÿæœ‰ä»€ä¹ˆé­”åŠ›è®©å¤§å®¶è¿™ä¹ˆå…³æ³¨&lt;/h2&gt;
&lt;p&gt;è¿™æ˜¯å› ä¸º eBPF å¢åŠ äº†å†…æ ¸çš„å¯æ‰©å±•æ€§ï¼Œè®©å†…æ ¸å˜å¾—æ›´åŠ çµæ´»å’Œå¼ºå¤§ã€‚å¦‚æœå¤§å®¶ç©è¿‡ä¹é«˜ç§¯æœ¨çš„è¯å°±ä¼šæ·±æœ‰ä½“ä¼šï¼Œä¹é«˜ç§¯æœ¨å°±æ˜¯é€šè¿‡ä¸æ–­å‘ä¸»ä½“æ·»åŠ ç§¯æœ¨æ¥ç»„åˆå‡ºæ›´åºå¤§çš„æ¨¡å‹ã€‚è€Œ eBPF å°±åƒä¹é«˜ç§¯æœ¨ä¸€æ ·ï¼Œå¯ä»¥ä¸æ–­å‘å†…æ ¸æ·»åŠ  eBPF æ¨¡å—æ¥å¢å¼ºå†…æ ¸çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-ebpf&#34;&gt;ä»€ä¹ˆæ˜¯ eBPF&lt;/h2&gt;
&lt;p&gt;åœ¨ä»‹ç» eBPF (Extended Berkeley Packet Filter) ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹å®ƒçš„å‰èº«ï¼BPF (Berkeley Packet Filter) ä¼¯å…‹åˆ©æ•°æ®åŒ…è¿‡æ»¤å™¨ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/current-state-and-future-of-ebpf/f1_hu5682574955635526630.webp 400w,
               /blog/current-state-and-future-of-ebpf/f1_hu6374631291070097637.webp 760w,
               /blog/current-state-and-future-of-ebpf/f1_hu18172806500673528673.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/current-state-and-future-of-ebpf/f1_hu5682574955635526630.webp&#34;
               width=&#34;760&#34;
               height=&#34;429&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;BPF æœ€æ—©ç”± Van Jacobson åœ¨ 1992 å¹´å¼€å‘ï¼Œç”¨äºåœ¨ Unix æ“ä½œç³»ç»Ÿä¸­è¿‡æ»¤å’Œæ•è·ç½‘ç»œæ•°æ®åŒ…ã€‚å®ƒè¿è¡Œåœ¨å†…æ ¸ä¸­ï¼Œé€šè¿‡æä¾›ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„è™šæ‹Ÿæœºï¼Œå¯ä»¥åœ¨ç½‘ç»œåè®®å±‚ä¸Šè¿›è¡Œé«˜æ•ˆçš„æ•°æ®åŒ…å¤„ç†æ“ä½œã€‚BPF é€šè¿‡æŠŠè¿‡ç¨‹è½¬æ¢æˆæŒ‡ä»¤åºåˆ—æ¥å®ç°ï¼Œè¿™äº›æŒ‡ä»¤ç›´æ¥åœ¨å†…æ ¸ä¸­æ‰§è¡Œï¼Œä»è€Œé¿å…äº†ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´é¢‘ç¹çš„åˆ‡æ¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŸºäº-bpf-å¼€å‘çš„å·¥å…·åº“æœ‰-libpcaptcpdump-ç­‰å·¥å…·&#34;&gt;åŸºäº BPF å¼€å‘çš„å·¥å…·åº“æœ‰ libpcapã€tcpdump ç­‰å·¥å…·ã€‚&lt;/h2&gt;
&lt;p&gt;BPF åœ¨ç½‘ç»œæ€§èƒ½ç›‘æµ‹å’Œå®‰å…¨ç­–ç•¥å®æ–½æ–¹é¢å…·æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚ç„¶è€Œï¼Œç”±äºå…¶æŒ‡ä»¤é›†çš„é™åˆ¶å’ŒåŠŸèƒ½çš„å±€é™æ€§ï¼Œå®ƒæ— æ³•æ”¯æŒæ›´åŠ å¤æ‚å’Œçµæ´»çš„æ•°æ®åŒ…å¤„ç†éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;æ­£æ˜¯ä¸ºäº†å…‹æœ BPF çš„é™åˆ¶ï¼ŒeBPF åº”è¿è€Œç”Ÿã€‚eBPF äº 2014 å¹´ï¼ˆ3.18 ç‰ˆæœ¬ï¼‰å¹´é¦–æ¬¡å¼•å…¥ Linux å†…æ ¸ï¼Œå¹¶åœ¨æ­¤åçš„å‡ å¹´ä¸­ç»å†äº†å¿«é€Ÿçš„å‘å±•å’Œå®Œå–„ã€‚&lt;/p&gt;
&lt;p&gt;eBPF æ˜¯ä¸€ä¸ªé«˜åº¦å¯æ‰©å±•çš„ã€è¿è¡Œåœ¨å†…æ ¸ä¸­çš„è™šæ‹Ÿæœºï¼Œå…·å¤‡ä¸ä¼ ç»Ÿ BPF ç›¸ä¼¼çš„æŒ‡ä»¤é›†ï¼Œä½†åŠŸèƒ½æ›´åŠ å¼ºå¤§ä¸”æ›´åŠ çµæ´»ã€‚eBPF å¯ä»¥åœ¨è¿è¡Œæ—¶å³æ—¶ç¼–è¯‘ï¼Œä»è€Œèƒ½å¤Ÿå¤„ç†æ›´åŠ å¤æ‚å’ŒåŠ¨æ€çš„æ•°æ®åŒ…å¤„ç†ä»»åŠ¡ï¼Œå¦‚ç½‘ç»œæµé‡åˆ†æã€å®‰å…¨æ£€æµ‹å’Œæ€§èƒ½ä¼˜åŒ–ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/current-state-and-future-of-ebpf/f2_hu15784856433667263209.webp 400w,
               /blog/current-state-and-future-of-ebpf/f2_hu11626152001242697386.webp 760w,
               /blog/current-state-and-future-of-ebpf/f2_hu14693445252091243321.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/current-state-and-future-of-ebpf/f2_hu15784856433667263209.webp&#34;
               width=&#34;760&#34;
               height=&#34;215&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;eBPF çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ä½“ç°åœ¨å®ƒå¯ä»¥ä¸å„ç§ç”¨æˆ·ç©ºé—´ç¨‹åºï¼ˆå¦‚ tcpdumpã€Wiresharkã€Suricata ç­‰ï¼‰å’Œå·¥å…·ï¼ˆå¦‚ç½‘ç»œç›‘æ§ã€è°ƒè¯•å™¨ç­‰) æ— ç¼é›†æˆã€‚&lt;/p&gt;
&lt;p&gt;eBPF è¿˜å¯ä»¥ä¸ç³»ç»Ÿçš„å…¶ä»–ç»„ä»¶ï¼ˆå¦‚ç½‘ç»œåè®®æ ˆã€è°ƒåº¦å™¨ç­‰ï¼‰äº¤äº’ï¼Œä»è€Œå®ç°æ›´åŠ ç»†ç²’åº¦çš„æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼ŒeBPF çš„å¼€å‘å’Œä½¿ç”¨ä¹Ÿå¾—åˆ°äº†å¹¿æ³›çš„æ”¯æŒå’Œæ¨åŠ¨ã€‚ç¤¾åŒºä¸­æœ‰è®¸å¤šè‡´åŠ›äº eBPF çš„å¼€å‘è€…å’Œè´¡çŒ®è€…ï¼Œä»–ä»¬ä¸æ–­æ”¹è¿›å’Œæ‰©å±• eBPF çš„åŠŸèƒ½ã€‚åŒæ—¶ï¼Œä¸€äº›çŸ¥åçš„å¤§å‹æŠ€æœ¯å…¬å¸ï¼Œå¦‚ Facebookã€Netflix å’Œ Google ç­‰ï¼Œä¹Ÿåœ¨å…¶äº§å“å’ŒåŸºç¡€è®¾æ–½ä¸­å¹¿æ³›ä½¿ç”¨ eBPFã€‚&lt;/p&gt;
&lt;h2 id=&#34;ebpf-çš„å‘å±•å²&#34;&gt;eBPF çš„å‘å±•å²&lt;/h2&gt;
&lt;p&gt;2014 å¹´åˆï¼ŒAlexei Starovoitov å®ç°äº† eBPFã€‚æ–°çš„è®¾è®¡é’ˆå¯¹ç°ä»£ç¡¬ä»¶è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ‰€ä»¥ eBPF ç”Ÿæˆçš„æŒ‡ä»¤é›†æ¯”æ—§çš„ BPF è§£é‡Šå™¨ç”Ÿæˆçš„æœºå™¨ç æ‰§è¡Œå¾—æ›´å¿«ã€‚æ‰©å±•ç‰ˆæœ¬ä¹Ÿå¢åŠ äº†è™šæ‹Ÿæœºä¸­çš„å¯„å­˜å™¨æ•°é‡ï¼Œå°†åŸæœ‰çš„ 2 ä¸ª 32 ä½å¯„å­˜å™¨å¢åŠ åˆ° 10 ä¸ª 64 ä½å¯„å­˜å™¨ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/current-state-and-future-of-ebpf/f3_hu17421057482717197853.webp 400w,
               /blog/current-state-and-future-of-ebpf/f3_hu4266841647394804020.webp 760w,
               /blog/current-state-and-future-of-ebpf/f3_hu940626636710556166.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/current-state-and-future-of-ebpf/f3_hu17421057482717197853.webp&#34;
               width=&#34;760&#34;
               height=&#34;560&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç”±äºå¯„å­˜å™¨æ•°é‡å’Œå®½åº¦çš„å¢åŠ ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨å‡½æ•°å‚æ•°è‡ªç”±äº¤æ¢æ›´å¤šçš„ä¿¡æ¯ï¼Œç¼–å†™æ›´å¤æ‚çš„ç¨‹åºã€‚æ€»ä¹‹ï¼Œè¿™äº›æ”¹è¿›ä½¿ eBPF ç‰ˆæœ¬çš„é€Ÿåº¦æ¯”åŸæ¥çš„ BPF æé«˜äº† 4 å€ã€‚&lt;/p&gt;
&lt;p&gt;eBPF æ˜¯ä¸€é¡¹å…·æœ‰é©å‘½æ€§çš„æŠ€æœ¯ï¼Œæºè‡ªäº Linux å†…æ ¸ï¼Œå¯ä»¥åœ¨ç‰¹æƒç¯å¢ƒä¸­è¿è¡Œå—æ²™ç›’ä¿æŠ¤çš„ç¨‹åºï¼Œä¾‹å¦‚æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚å®ƒè¢«ç”¨äºå®‰å…¨æœ‰æ•ˆåœ°æ‰©å±•å†…æ ¸çš„åŠŸèƒ½ï¼Œè€Œæ— éœ€æ›´æ”¹å†…æ ¸æºä»£ç æˆ–åŠ è½½å†…æ ¸æ¨¡å—ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/current-state-and-future-of-ebpf/f4_hu5417348816224861253.webp 400w,
               /blog/current-state-and-future-of-ebpf/f4_hu13009276457627645217.webp 760w,
               /blog/current-state-and-future-of-ebpf/f4_hu11711827173174884446.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/current-state-and-future-of-ebpf/f4_hu5417348816224861253.webp&#34;
               width=&#34;760&#34;
               height=&#34;506&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨å†å²ä¸Šï¼Œæ“ä½œç³»ç»Ÿä¸€ç›´æ˜¯å®ç°å¯è§‚å¯Ÿæ€§ã€å®‰å…¨æ€§å’Œç½‘ç»œåŠŸèƒ½çš„ç†æƒ³åœºæ‰€ï¼Œè¿™æ˜¯å› ä¸ºå†…æ ¸å…·æœ‰ç‰¹æƒèƒ½åŠ›ï¼Œå¯ä»¥ç›‘ç£å’Œæ§åˆ¶æ•´ä¸ªç³»ç»Ÿã€‚ä¸æ­¤åŒæ—¶ï¼Œç”±äºå†…æ ¸åœ¨ç³»ç»Ÿä¸­çš„æ ¸å¿ƒåœ°ä½ä»¥åŠå¯¹ç¨³å®šæ€§å’Œå®‰å…¨æ€§çš„é«˜è¦æ±‚ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸çš„æ¼”è¿›å¾€å¾€å¾ˆå›°éš¾ã€‚å› æ­¤ï¼Œä¸æ“ä½œç³»ç»Ÿå¤–éƒ¨å®ç°çš„åŠŸèƒ½ç›¸æ¯”ï¼Œæ“ä½œç³»ç»Ÿå±‚é¢çš„åˆ›æ–°é€Ÿåº¦ä¼ ç»Ÿä¸Šè¾ƒä½ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/current-state-and-future-of-ebpf/f5_hu9609662473548064110.webp 400w,
               /blog/current-state-and-future-of-ebpf/f5_hu15219833447841719633.webp 760w,
               /blog/current-state-and-future-of-ebpf/f5_hu7694316219702030872.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/current-state-and-future-of-ebpf/f5_hu9609662473548064110.webp&#34;
               width=&#34;760&#34;
               height=&#34;391&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;eBPF ä»æ ¹æœ¬ä¸Šæ”¹å˜äº†è¿™ä¸ªç°è±¡ã€‚é€šè¿‡åœ¨æ“ä½œç³»ç»Ÿå†…è¿è¡Œå—æ²™ç›’ä¿æŠ¤çš„ç¨‹åºï¼Œåº”ç”¨å¼€å‘äººå‘˜å¯ä»¥åœ¨è¿è¡Œæ—¶è¿è¡Œ eBPF ç¨‹åºï¼Œä¸ºæ“ä½œç³»ç»Ÿæ·»åŠ é¢å¤–çš„åŠŸèƒ½ã€‚æ“ä½œç³»ç»Ÿä¼šåˆ©ç”¨å³æ—¶ç¼–è¯‘å™¨å’ŒéªŒè¯å¼•æ“çš„å¸®åŠ©æ¥ä¿è¯å®‰å…¨æ€§å’Œæ‰§è¡Œæ•ˆç‡ï¼Œå°±åƒæœ¬åœ°ç¼–è¯‘ä¸€æ ·ã€‚è¿™å¯¼è‡´äº†ä¸€ç³»åˆ—åŸºäº eBPF çš„é¡¹ç›®çš„æ¶Œç°ï¼Œæ¶µç›–äº†å„ç§ç”¨ä¾‹ï¼ŒåŒ…æ‹¬ä¸‹ä¸€ä»£ç½‘ç»œã€å¯è§‚æµ‹æ€§å’Œå®‰å…¨åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ebpf-åº”ç”¨åœºæ™¯&#34;&gt;eBPF åº”ç”¨åœºæ™¯&lt;/h2&gt;
&lt;p&gt;å¦‚ä»Šï¼ŒeBPF è¢«å¹¿æ³›åº”ç”¨äºé©±åŠ¨å„ç§ç”¨ä¾‹ï¼šåœ¨ç°ä»£æ•°æ®ä¸­å¿ƒå’Œäº‘åŸç”Ÿç¯å¢ƒä¸­æä¾›é«˜æ€§èƒ½çš„ç½‘ç»œå’Œè´Ÿè½½å‡è¡¡ï¼›&lt;/p&gt;
&lt;p&gt;ä»¥ä½å¼€é”€æå–ç»†ç²’åº¦çš„å®‰å…¨å¯è§‚æµ‹æ€§æ•°æ®ï¼Œå¸®åŠ©åº”ç”¨å¼€å‘äººå‘˜è¿½è¸ªåº”ç”¨ç¨‹åºã€æä¾›æ€§èƒ½æ•…éšœæ’é™¤çš„è§è§£ï¼Œè¿›è¡Œé¢„é˜²æ€§åº”ç”¨ç¨‹åºå’Œå®¹å™¨è¿è¡Œæ—¶å®‰å…¨æ‰§è¡Œç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;å¯èƒ½æ€§æ˜¯æ— é™çš„ï¼ŒeBPF æ­£åœ¨é‡Šæ”¾å‡ºçš„åˆ›æ–°åŠ›é‡æ‰åˆšåˆšå¼€å§‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ebpf-ç‰¹æ€§&#34;&gt;eBPF ç‰¹æ€§&lt;/h2&gt;
&lt;h3 id=&#34;hook-overview&#34;&gt;Hook Overview&lt;/h3&gt;
&lt;p&gt;eBPF ç¨‹åºéƒ½æ˜¯äº‹ä»¶é©±åŠ¨çš„ï¼Œå®ƒä»¬ä¼šåœ¨å†…æ ¸æˆ–è€…åº”ç”¨ç¨‹åºç»è¿‡æŸä¸ªç¡®å®šçš„ Hook ç‚¹çš„æ—¶å€™è¿è¡Œï¼Œè¿™äº› Hook ç‚¹éƒ½æ˜¯æå‰å®šä¹‰çš„ï¼ŒåŒ…æ‹¬ç³»ç»Ÿè°ƒç”¨ã€å‡½æ•°è¿›å…¥/é€€å‡ºã€å†…æ ¸ tracepointsã€ç½‘ç»œäº‹ä»¶ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/current-state-and-future-of-ebpf/f6_hu2974626716997495089.webp 400w,
               /blog/current-state-and-future-of-ebpf/f6_hu16939794538925235318.webp 760w,
               /blog/current-state-and-future-of-ebpf/f6_hu15052267427534527297.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/current-state-and-future-of-ebpf/f6_hu2974626716997495089.webp&#34;
               width=&#34;760&#34;
               height=&#34;578&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;verification&#34;&gt;Verification&lt;/h3&gt;
&lt;p&gt;With great power there must also come great responsibility.&lt;/p&gt;
&lt;p&gt;æ¯ä¸€ä¸ª eBPF ç¨‹åºåŠ è½½åˆ°å†…æ ¸éƒ½è¦ç»è¿‡ Verificationï¼Œç”¨æ¥ä¿è¯ eBPF ç¨‹åºçš„å®‰å…¨æ€§ï¼Œä¸»è¦åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;p&gt;è¦ä¿è¯åŠ è½½ eBPF ç¨‹åºçš„è¿›ç¨‹æœ‰å¿…è¦çš„ç‰¹æƒçº§ï¼Œé™¤éèŠ‚ç‚¹å¼€å¯äº† unpriviledged ç‰¹æ€§ï¼Œåªæœ‰ç‰¹æƒçº§çš„ç¨‹åºæ‰èƒ½å¤ŸåŠ è½½ eBPF ç¨‹åºã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å†…æ ¸æä¾›äº†ä¸€ä¸ªé…ç½®é¡¹ /proc/sys/kernel/unprivileged_bpf_disabled æ¥ç¦æ­¢éç‰¹æƒç”¨æˆ·ä½¿ç”¨ bpf(2) ç³»ç»Ÿè°ƒç”¨ï¼Œå¯ä»¥é€šè¿‡ sysctl å‘½ä»¤ä¿®æ”¹&lt;/li&gt;
&lt;li&gt;æ¯”è¾ƒç‰¹æ®Šçš„ä¸€ç‚¹æ˜¯ï¼Œè¿™ä¸ªé…ç½®é¡¹ç‰¹æ„è®¾è®¡ä¸ºä¸€æ¬¡æ€§å¼€å…³ï¼ˆone-time kill switchï¼‰ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦å°†å®ƒè®¾ä¸º 1ï¼Œå°±æ²¡æœ‰åŠæ³•å†æ”¹ä¸º 0 äº†ï¼Œé™¤éé‡å¯å†…æ ¸&lt;/li&gt;
&lt;li&gt;ä¸€æ—¦è®¾ç½®ä¸º 1 ä¹‹åï¼Œåªæœ‰åˆå§‹å‘½åç©ºé—´ä¸­æœ‰ CAP_SYS_ADMIN ç‰¹æƒçš„è¿›ç¨‹æ‰å¯ä»¥è°ƒç”¨ bpf(2) ç³»ç»Ÿè°ƒç”¨ã€‚Cilium å¯åŠ¨åä¹Ÿä¼šå°†è¿™ä¸ªé…ç½®é¡¹è®¾ä¸º 1ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;$ echo 1 &amp;gt; /proc/sys/kernel/unprivileged_bpf_disabled&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¦ä¿è¯ eBPF ç¨‹åºä¸ä¼šå´©æºƒæˆ–è€…ä½¿å¾—ç³»ç»Ÿå‡ºæ•…éšœã€‚&lt;/p&gt;
&lt;p&gt;è¦ä¿è¯ eBPF ç¨‹åºä¸èƒ½é™·å…¥æ­»å¾ªç¯ï¼Œèƒ½å¤Ÿ runs to completionã€‚&lt;/p&gt;
&lt;p&gt;è¦ä¿è¯ eBPF ç¨‹åºå¿…é¡»æ»¡è¶³ç³»ç»Ÿè¦æ±‚çš„å¤§å°ï¼Œè¿‡å¤§çš„ eBPF ç¨‹åºä¸å…è®¸è¢«åŠ è½½è¿›å†…æ ¸ã€‚&lt;/p&gt;
&lt;p&gt;è¦ä¿è¯ eBPF ç¨‹åºçš„å¤æ‚åº¦æœ‰é™ï¼ŒVerifier å°†ä¼šè¯„ä¼° eBPF ç¨‹åºæ‰€æœ‰å¯èƒ½çš„æ‰§è¡Œè·¯å¾„ï¼Œå¿…é¡»èƒ½å¤Ÿåœ¨æœ‰é™æ—¶é—´å†…å®Œæˆ eBPF ç¨‹åºå¤æ‚åº¦åˆ†æã€‚&lt;/p&gt;
&lt;h3 id=&#34;jit-compilation&#34;&gt;JIT Compilation&lt;/h3&gt;
&lt;p&gt;Just-In-Timeï¼ˆJITï¼‰ç¼–è¯‘ç”¨æ¥å°†é€šç”¨çš„ eBPF å­—èŠ‚ç ç¿»è¯‘æˆä¸æœºå™¨ç›¸å…³çš„æŒ‡ä»¤é›†ï¼Œä»è€Œæå¤§åŠ é€Ÿ BPF ç¨‹åºçš„æ‰§è¡Œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸è§£é‡Šå™¨ç›¸æ¯”ï¼Œå®ƒä»¬å¯ä»¥é™ä½æ¯ä¸ªæŒ‡ä»¤çš„å¼€é”€ã€‚é€šå¸¸æŒ‡ä»¤å¯ä»¥ 1:1 æ˜ å°„åˆ°åº•å±‚æ¶æ„çš„åŸç”ŸæŒ‡ä»¤ã€‚&lt;/li&gt;
&lt;li&gt;è¿™ä¹Ÿä¼šå‡å°‘ç”Ÿæˆçš„å¯æ‰§è¡Œé•œåƒçš„å¤§å°ï¼Œå› æ­¤å¯¹ CPU çš„æŒ‡ä»¤ç¼“å­˜æ›´å‹å¥½ã€‚&lt;/li&gt;
&lt;li&gt;ç‰¹åˆ«åœ°ï¼Œå¯¹äº CISC æŒ‡ä»¤é›†ï¼ˆä¾‹å¦‚ x86ï¼‰ï¼ŒJIT åšäº†å¾ˆå¤šç‰¹æ®Šä¼˜åŒ–ï¼Œç›®çš„æ˜¯ä¸ºç»™å®šçš„æŒ‡ä»¤äº§ç”Ÿå¯èƒ½çš„æœ€çŸ­æ“ä½œç ï¼Œä»¥é™ä½ç¨‹åºç¿»è¯‘è¿‡ç¨‹æ‰€éœ€çš„ç©ºé—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;64 ä½çš„ x86_64ã€arm64ã€ppc64ã€s390xã€mips64ã€sparc64 å’Œ 32 ä½çš„ armã€x86_32 æ¶æ„éƒ½å†…ç½®äº† in-kernel eBPF JIT ç¼–è¯‘å™¨ï¼Œå®ƒä»¬çš„åŠŸèƒ½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼æ‰“å¼€ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;$ echo 1 &amp;gt; /proc/sys/net/core/bpf_jit_enable&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;32 ä½çš„ mipsã€ppc å’Œ sparc æ¶æ„ç›®å‰å†…ç½®çš„æ˜¯ä¸€ä¸ª cBPF JIT ç¼–è¯‘å™¨ã€‚è¿™äº›åªæœ‰ cBPF JIT ç¼–è¯‘å™¨çš„æ¶æ„ï¼Œä»¥åŠé‚£äº›ç”šè‡³å®Œå…¨æ²¡æœ‰ BPF JIT ç¼–è¯‘å™¨çš„æ¶æ„ï¼Œéœ€è¦é€šè¿‡å†…æ ¸ä¸­çš„è§£é‡Šå™¨ï¼ˆin-kernel interpreterï¼‰æ‰§è¡Œ eBPF ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;è¦åˆ¤æ–­å“ªäº›å¹³å°æ”¯æŒ eBPF JITï¼Œå¯ä»¥åœ¨å†…æ ¸æºæ–‡ä»¶ä¸­ grep HAVE_EBPF_JITï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/current-state-and-future-of-ebpf/f8_hu16612290089547048337.webp 400w,
               /blog/current-state-and-future-of-ebpf/f8_hu8630502918549797434.webp 760w,
               /blog/current-state-and-future-of-ebpf/f8_hu3356698373949496590.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/current-state-and-future-of-ebpf/f8_hu16612290089547048337.webp&#34;
               width=&#34;760&#34;
               height=&#34;215&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/current-state-and-future-of-ebpf/f7_hu3940783226783878166.webp 400w,
               /blog/current-state-and-future-of-ebpf/f7_hu5253803303824727073.webp 760w,
               /blog/current-state-and-future-of-ebpf/f7_hu18182771546194607026.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/current-state-and-future-of-ebpf/f7_hu3940783226783878166.webp&#34;
               width=&#34;760&#34;
               height=&#34;364&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¥½å•¦ï¼Œæœ¬æœŸå…³äºè¿ç»´å¯è§‚æµ‹å·¥å…· eBPF çš„åˆ†äº«åˆ°è¿™é‡Œå°±å‘Šä¸€æ®µè½äº†ï¼Œä¸‹æœŸæˆ‘ä»¬å†æ¥è®²è®² eBPF åœ¨å®é™…ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜ã€‚æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å…³æ³¨ä¸€ä¸‹~&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ç¼–è¯‘è¿è¡Œ Linux å†…æ ¸æºç ä¸­çš„ eBPF ç¤ºä¾‹ä»£ç </title>
      <link>https://cloudnativecn.com/blog/compile-bpf-examples/</link>
      <pubDate>Thu, 06 Aug 2020 19:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/compile-bpf-examples/</guid>
      <description>&lt;h2 id=&#34;tldr&#34;&gt;TL;DR&lt;/h2&gt;
&lt;p&gt;å£°æ˜ï¼šä¸‹æ–‡æåˆ°çš„&lt;code&gt;bpf/BPF&lt;/code&gt;å­—æ ·æ˜¯æ³›æŒ‡ï¼ŒåŒ…æ‹¬&lt;code&gt;cBPF&lt;/code&gt;å’Œ&lt;code&gt;eBPF&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡æ–‡ç« ï¼Œä½ èƒ½äº†è§£ Linux å†…æ ¸ä»£ç ä¸­å…³äº bpf ç¨‹åºçš„ç¼–è¯‘è¿è¡Œæœºåˆ¶ï¼Œå¹¶èƒ½å­¦ä¼šå¦‚ä½•åŸºäº Linux å†…æ ¸ bpf ç¤ºä¾‹ç¯å¢ƒç¼–å†™ä½ è‡ªå·±çš„ bpf ç¨‹åºã€‚æ–‡ç« æ¶‰åŠçš„å®éªŒç¯å¢ƒå’Œä»£ç å¯ä»¥åˆ°è¿™ä¸ª git repo è·å–ï¼š
&lt;a href=&#34;https://github.com/nevermosby/linux-bpf-learning&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/nevermosby/linux-bpf-learning&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ€è¿‘ Kubecon 2020 China ä¸Šå·²ç»æœ‰äº† 3 ä¸ªå…³äº bpf çš„ä¸­æ–‡åˆ†äº«ï¼ˆæ¥è‡ªè…¾è®¯å’Œ PingCAPï¼‰ï¼Œä¹Ÿçœ‹åˆ°å›½å†…ç¬¬ä¸€æ¢¯é˜Ÿå…¬å¸è¶Šæ¥è¶Šå…³å¿ƒ bpf è¿™é¡¹æ–°æŠ€æœ¯ï¼Œæ¬¢è¿å¤§å®¶éƒ½èƒ½åŠ å…¥ bpf å­¦ä¹ é˜Ÿä¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å†…æ ¸æºç é‡Œçš„-bpf-ç¤ºä¾‹ä»£ç æ¦‚è¿°&#34;&gt;å†…æ ¸æºç é‡Œçš„ BPF ç¤ºä¾‹ä»£ç æ¦‚è¿°&lt;/h2&gt;
&lt;p&gt;ç¤ºä¾‹ä»£ç é‡ŒåŸºæœ¬æ˜¯&lt;strong&gt;kern&lt;/strong&gt;å’Œ&lt;strong&gt;user&lt;/strong&gt;æˆå¯¹å‡ºç°ï¼Œä¹Ÿå°±æ˜¯å¯¹äºä¸€ä¸ªç¤ºä¾‹æ¥è¯´ï¼Œåˆ†åˆ«æä¾›äº†åœ¨å†…æ ¸ç©ºé—´è¿è¡Œçš„å’Œç”¨æˆ·ç©ºé—´è¿è¡Œçš„ç¨‹åºï¼Œç»å¯¹æ˜¯è‰¯å¿ƒä¹‹ä½œäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸‹è½½-linux-å†…æ ¸æºä»£ç &#34;&gt;ä¸‹è½½ Linux å†…æ ¸æºä»£ç &lt;/h2&gt;
&lt;p&gt;First thing firstï¼Œç¬¬ä¸€æ­¥æ˜¯ä¸‹è½½å†…æ ¸ä»£ç ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é€‰æ‹©å†…æ ¸ç‰ˆæœ¬&#34;&gt;é€‰æ‹©å†…æ ¸ç‰ˆæœ¬&lt;/h3&gt;
&lt;p&gt;ç›®å‰ç¤¾åŒºç»´æŠ¤çš„å†…æ ¸ç‰ˆæœ¬ç¹å¤šï¼Œä½ éœ€è¦ç¡®å®šä¸‹è½½å“ªä¸ªç‰ˆæœ¬çš„ä»£ç ã€‚ä¸ªäººå»ºè®®æ˜¯ä¸‹è½½ä¸ä½ çš„æ“ä½œç³»ç»Ÿè¿è¡Œä¸€è‡´çš„å†…æ ¸ç‰ˆæœ¬ï¼Œé¿å…åç»­ç¼–è¯‘æ—¶å‡ºç°ä¸å…¼å®¹é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é€‰æ‹©ä¸‹è½½æ¸ é“&#34;&gt;é€‰æ‹©ä¸‹è½½æ¸ é“&lt;/h3&gt;
&lt;p&gt;ä»£ç ä¸‹è½½æ¸ é“ä¹Ÿå¾ˆå¤šï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡ Linux ç¤¾åŒºå®˜æ–¹ä»“åº“ä¸‹è½½ã€‚ä»¥ä¸‹å‡ ä¸ªç½‘ç«™éƒ½æ˜¯å®˜æ–¹ç»´æŠ¤çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/torvalds/linux&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/torvalds/linux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git&lt;/a&gt;
è§‚å¯Ÿä¸‹æ¥ï¼Œåªè¦æœ‰æ–°çš„commitï¼ŒåŸºæœ¬æ˜¯å®æ—¶åŒæ­¥çš„ï¼Œä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„å†…æ ¸ä»£ç è‚¯å®šæ²¡é—®é¢˜ã€‚å¦‚æœä½ è·Ÿæˆ‘ä¸€æ ·ï¼Œéœ€è¦ç›¸å¯¹è¾ƒæ—§çš„ç‰ˆæœ¬ï¼Œåªè¦åˆ‡æ¢ç›¸å…³çš„ç›®æ ‡tagå³å¯ã€‚æˆ‘çš„å†…æ ¸ç‰ˆæœ¬æ˜¯&lt;strong&gt;v4.15.0&lt;/strong&gt;ï¼Œä¸‹è½½åœ°å€å‚è€ƒå¦‚ä¸‹ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/torvalds/linux/tree/v4.15&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/torvalds/linux/tree/v4.15&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tag/?h=v4.15&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tag/?h=v4.15&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡ Ubuntu apt ä»“åº“ä¸‹è½½ã€‚Ubuntu å®˜æ–¹è‡ªå·±ç»´æŠ¤äº†æ¯ä¸ªæ“ä½œç³»ç»Ÿç‰ˆæœ¬çš„èƒŒåçš„ Linux å†…æ ¸ä»£ç ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§ apt å‘½ä»¤æ–¹å¼è·å–ç›¸å…³ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ç¬¬ä¸€ç§æ–¹å¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å…ˆæœç´¢&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; apt-cache search linux-source
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;linux-source - Linux kernel &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt; with Ubuntu patches
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;linux-source-4.15.0 - Linux kernel &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; version 4.15.0 with Ubuntu patches
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;linux-source-4.18.0 - Linux kernel &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; version 4.18.0 with Ubuntu patches
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;linux-source-5.0.0 - Linux kernel &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; version 5.0.0 with Ubuntu patches
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;linux-source-5.3.0 - Linux kernel &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; version 5.3.0 with Ubuntu patches
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å†å®‰è£…&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; apt install linux-source-4.15.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ç¬¬äºŒç§æ–¹å¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; apt-get &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt; linux
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Reading package lists... Done
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NOTICE: &lt;span class=&#34;s1&#34;&gt;&amp;#39;linux&amp;#39;&lt;/span&gt; packaging is maintained in the &lt;span class=&#34;s1&#34;&gt;&amp;#39;Git&amp;#39;&lt;/span&gt; version control system at:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git://git.launchpad.net/~ubuntu-kernel/ubuntu/+source/linux/+git/bionic
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Please use:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone git://git.launchpad.net/~ubuntu-kernel/ubuntu/+source/linux/+git/bionic
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;to retrieve the latest &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;possibly unreleased&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; updates to the package.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Need to get &lt;span class=&#34;m&#34;&gt;167&lt;/span&gt; MB of &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt; archives.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Get:2 https://mirrors.ustc.edu.cn/ubuntu bionic-updates/main linux 4.15.0-99.100 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;tar&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;158&lt;/span&gt; MB&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;......
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ä»¥ä¸Šä¸¤ç§æ–¹å¼ï¼Œå†…æ ¸æºä»£ç å‡ä¸‹è½½è‡³/usr/src/ç›®å½•ä¸‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹è½½å®Œæˆåï¼ŒBPF ç¤ºä¾‹å°±åœ¨&lt;strong&gt;æºç æ ¹ç›®å½•/samples/bpf&lt;/strong&gt;ç›®å½•ä¸‹ï¼Œå¯ä»¥åˆ°&lt;a href=&#34;https://elixir.bootlin.com/linux/v4.15/source/samples/bpf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;çœ‹ä¸ªåœ¨çº¿ç‰ˆçš„ï¼Œå»ºè®®å¤§å®¶é€šè¯»ä¸€éè¿™ä¸ªç›®å½•ä¸‹çš„&lt;a href=&#34;https://elixir.bootlin.com/linux/v4.15/source/samples/bpf/README.rst&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;README.rst&lt;/a&gt;ï¼Œäº†è§£æ•´ä½“æ­¥éª¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼–è¯‘-bpf-ç¤ºä¾‹ä»£ç &#34;&gt;ç¼–è¯‘ BPF ç¤ºä¾‹ä»£ç &lt;/h2&gt;
&lt;h3 id=&#34;å®‰è£…ç¼–è¯‘æ‰€ä¾èµ–çš„å·¥å…·&#34;&gt;å®‰è£…ç¼–è¯‘æ‰€ä¾èµ–çš„å·¥å…·&lt;/h3&gt;
&lt;p&gt;åœ¨çœŸæ­£å¼€å§‹ç¼–è¯‘å·¥ä½œä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ çš„å®éªŒç¯å¢ƒå·²ç»å®‰è£…&lt;code&gt;clang&lt;/code&gt;å’Œ&lt;code&gt;llvm&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;clang &amp;gt;= version 3.4.0&lt;/li&gt;
&lt;li&gt;llvm &amp;gt;= version 3.7.1&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ­£å¼ç¼–è¯‘ç¤ºä¾‹ä»£ç &#34;&gt;æ­£å¼ç¼–è¯‘ç¤ºä¾‹ä»£ç &lt;/h3&gt;
&lt;p&gt;ä¸‡äº‹ä¿±å¤‡äº†ï¼Œå¯ä»¥æ­£å¼å¼€å§‹ç¼–è¯‘å·¥ä½œã€‚æˆ‘ä»¬è¯´çš„â€œç¼–è¯‘â€å…¶æœ¬è´¨å°±æ˜¯åˆ©ç”¨å†…æ ¸ç›®å½•ä¸‹ä¸åŒçš„&lt;code&gt;Makefile&lt;/code&gt;ï¼Œé€šè¿‡ç‰¹å®šçš„&lt;code&gt;make&lt;/code&gt;æŒ‡ä»¤å®Œæˆç‰¹å®šå·¥ä½œã€‚æ¥ï¼Œå…ˆä¸Šå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# åˆ‡æ¢åˆ°å†…æ ¸æºä»£ç æ ¹ç›®å½•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; linux_sourcecode/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ç”Ÿæˆå†…æ ¸ç¼–è¯‘æ—¶éœ€è¦çš„å¤´æ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make headers_install
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å¯è§†åŒ–é€‰æ‹©ä½ æƒ³ä¸ºå†…æ ¸æ·»åŠ çš„å†…æ ¸æ¨¡å—ï¼Œæœ€ç»ˆç”Ÿæˆä¿å­˜äº†ç›¸å…³æ¨¡å—ä¿¡æ¯çš„.configæ–‡ä»¶ï¼Œä¸ºæ‰§è¡Œåé¢çš„å‘½ä»¤åšå‡†å¤‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make menuconfig
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ä½¿ç”¨makeå‘½ä»¤ç¼–è¯‘samples/bpf/ç›®å½•ä¸‹æ‰€æœ‰bpfç¤ºä¾‹ä»£ç ï¼Œæ³¨æ„éœ€è¦åŠ ä¸Šæœ€åçš„/ç¬¦å·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make samples/bpf/ &lt;span class=&#34;c1&#34;&gt;# or  make M=samples/bpf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹æˆªå›¾çœ‹ç»“æœï¼Œç”Ÿæˆäº†ä¸€å¤§å †çš„æ–‡ä»¶ï¼Œæœ‰&lt;code&gt;.o&lt;/code&gt;åç¼€çš„ç›®æ ‡æ–‡ä»¶ï¼Œè¿˜æœ‰ç»¿è‰²é«˜äº®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒæŒ‘ä¸¤ä¸ªæ‰§è¡Œä¸‹ï¼Œæ•ˆæœç¬¦åˆæœŸå¾…ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-kernel-bpf-examples&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;kernel-bpf-examples&#34; srcset=&#34;
               /blog/compile-bpf-examples/bpf-kernel-examples_hu7047798090788963497.webp 400w,
               /blog/compile-bpf-examples/bpf-kernel-examples_hu9902525685196824568.webp 760w,
               /blog/compile-bpf-examples/bpf-kernel-examples_hu11785637165634411174.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/compile-bpf-examples/bpf-kernel-examples_hu7047798090788963497.webp&#34;
               width=&#34;760&#34;
               height=&#34;451&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      kernel-bpf-examples
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;åˆ†æsamplesbpfmakefileæ–‡ä»¶&#34;&gt;åˆ†æ&lt;strong&gt;samples/bpf/Makefile&lt;/strong&gt;æ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ æ˜¯ä¸ªå–œæ¬¢æ‰“ç ´ç ‚é”…é—®åˆ°åº•çš„åŒå­¦ï¼Œå¯ä»¥è·Ÿæˆ‘ä¸€èµ·çœ‹çœ‹æœ€åçš„ make å‘½ä»¤åˆ°åº•ç”¨äº†ä»€ä¹ˆé­”æ³•ï¼Ÿå½“ç„¶ä½ ä¹Ÿå¯ä»¥è·³è¿‡è¿™ä¸ªç« èŠ‚ã€‚æœ¬æ¬¡åˆ†æçš„ Makefile æ˜¯åŸºäºå†…æ ¸ç‰ˆæœ¬&lt;a href=&#34;https://elixir.bootlin.com/linux/v4.15/source/samples/bpf/Makefile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;v4.15.0&lt;/a&gt;ï¼Œä¸åŒå†…æ ¸ç‰ˆæœ¬çš„ Makefile å†…å®¹ä¼šæœ‰å·®å¼‚ï¼Œä½†æ€»ä½“é€»è¾‘æ˜¯ä¸€è‡´çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å‰ææ¡ä»¶&#34;&gt;å‰ææ¡ä»¶&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœä½ å¯¹&lt;code&gt;make&lt;/code&gt;ä½œä¸ºæ„å»ºå·¥å…·è¿˜ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥çœ‹çœ‹è¿™ä¸ª&lt;a href=&#34;http://www.ruanyifeng.com/blog/2015/02/make.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ•™ç¨‹&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;Linux å†…æ ¸ä¸­å¤§éƒ¨åˆ† Makefile éƒ½æ˜¯åŸºäº&lt;a href=&#34;https://www.kernel.org/doc/html/latest/kbuild/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kernel Build System&lt;/a&gt;ï¼Œç®€ç§°&lt;code&gt;kbuild&lt;/code&gt;ï¼Œå®ƒæ˜¯å¯¹ Makefile çš„æ‰©å±•ï¼Œä½¿å…¶åœ¨ç¼–è¯‘å†…æ ¸æ–‡ä»¶æ—¶æ›´åŠ é«˜æ•ˆã€ç®€æ´ã€‚å› æ­¤ä½ éœ€è¦å¯¹å…¶æœ‰æ‰€äº†è§£ï¼Œå¯ä»¥åˆ°&lt;a href=&#34;https://www.kernel.org/doc/html/latest/kbuild/makefiles.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;çœ‹çœ‹å®˜æ–¹ä»‹ç»ã€‚&lt;/li&gt;
&lt;li&gt;ä¸Šæ–‡ä½¿ç”¨çš„å¦å¤–ä¸¤ä¸ª&lt;strong&gt;make&lt;/strong&gt;å‘½ä»¤ï¼Œåˆ©ç”¨çš„æ˜¯æ ¹ç›®å½•ä¸‹çš„&lt;a href=&#34;https://elixir.bootlin.com/linux/v4.15/source/Makefile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;Makefile&lt;/code&gt;&lt;/a&gt;ï¼Œå®Œæˆâ€œç”Ÿæˆå¤´æ–‡ä»¶â€å’Œâ€œç”Ÿæˆ.config æ–‡ä»¶â€ï¼Œè¿™ä¸¤æ­¥æ˜¯å†…æ ¸å¼€å‘çš„å¿…è¦æ­¥éª¤ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦ç§»æ­¥çœ‹&lt;a href=&#34;https://elixir.bootlin.com/linux/v4.15/source/Documentation/admin-guide/README.rst&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;README.rst&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åˆ†æ®µåˆ†æ&#34;&gt;åˆ†æ®µåˆ†æ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬ä¸€æ®µå…³äºå˜é‡&lt;code&gt;hostprogs-y&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# List of programs to build&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hostprogs-y :&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; test_lru_dist
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hostprogs-y +&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; sock_example
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hostprogs-y +&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; fds_example
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hostprogs-y +&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; sockex1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hostprogs-y +&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; sockex2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hostprogs-y +&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; sockex3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Makefile çš„ç¬¬ä¸€æ®µæ˜¯åˆå§‹åŒ–å˜é‡&lt;code&gt;hostprogs-y&lt;/code&gt;ï¼Œä¹ä¸€çœ‹ï¼Œå¥½åƒæ˜¯æŠŠæ‰€æœ‰ç¤ºä¾‹ç¨‹åºåç§°éƒ½èµ‹å€¼ç»™äº†&lt;code&gt;hostprogs-y&lt;/code&gt;ã€‚å®˜æ–¹çš„æ³¨é‡Šæ˜¯&lt;strong&gt;List of programs to build&lt;/strong&gt;ï¼Œç›´è¯‘è¿‡æ¥æ˜¯ï¼Œâ€œå‡†å¤‡æ„å»ºçš„ç¨‹åºæ¸…å•â€ã€ï¼Œå¤§è‡´èƒ½çŒœå‡ºè¿™ä¸ªå˜é‡çš„æ„ä¹‰äº†ï¼Œé€šè¿‡æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ï¼Œå‘ç°ä¸€ä¸ªæ¦‚å¿µå«&lt;a href=&#34;https://www.kernel.org/doc/html/latest/kbuild/makefiles.html#host-program-support&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;Host Program support&lt;/strong&gt;&lt;/a&gt;ï¼Œæ„æ€æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå°±æ„å»ºå‡ºå¯ä»¥åœ¨æœ¬æœºç›´æ¥è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸ºäº†å®ç°è¿™ä¸ªç›®çš„ï¼Œéœ€è¦ç»è¿‡ä¸¤ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬ä¸€æ­¥å‘Šè¯‰ &lt;strong&gt;kbuild&lt;/strong&gt; éœ€è¦ç”Ÿæˆå“ªäº›å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯é€šè¿‡å˜é‡&lt;code&gt;hostprogs-y&lt;/code&gt;æ¥æŒ‡å®šã€‚æ¥çœ‹æºç ä¸­çš„è¿™ä¸€è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hostprogs-y :&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; test_lru_dist
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¨‹åº&lt;code&gt;test_lru_dist&lt;/code&gt;å°±æ˜¯ä¸€ä¸ªè¢«æŒ‡å®šçš„å¯æ‰§è¡Œç¨‹åºåç§°ï¼Œ&lt;code&gt;kbuild&lt;/code&gt;é»˜è®¤ä¼šå»åŒä¸€ä¸ªç›®å½•ä¸‹æŸ¥æ‰¾åä¸º&lt;code&gt;test_lru_dist.c&lt;/code&gt;ä½œä¸ºæ„å»ºè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„æºæ–‡ä»¶ã€‚ç±»ä¼¼ä»£ç ä¹Ÿæ˜¯åŒæ ·çš„æ„ä¹‰ï¼Œæ€»è®¡æœ‰41ä¸ªå¯æ‰§è¡Œæ–‡ä»¶èµ‹å€¼ç»™äº†å˜é‡&lt;code&gt;hostprogs-y&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬äºŒæ­¥æ˜¯å°†æ˜¾å¼ä¾èµ–å…³ç³»æ·»åŠ åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚è¿™å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å®Œæˆï¼Œä¸€ç§æ˜¯ä¸ºMakefileä¸­æŸä¸ª&lt;strong&gt;target&lt;/strong&gt;æ·»åŠ è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½œä¸º&lt;strong&gt;prerequisites&lt;/strong&gt;ï¼Œå½¢æˆä¾èµ–å…³ç³»ï¼Œè¿™æ ·å°±å¯ä»¥è§¦å‘è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„æ„å»ºä»»åŠ¡ï¼Œå¦ä¸€ç§æ˜¯ç›´æ¥åˆ©ç”¨å˜é‡ &lt;code&gt;always&lt;/code&gt;ï¼Œå³æ— éœ€æŒ‡å®šç¬¬ä¸€ç§æ–¹å¼ä¸­çš„ä¾èµ–å…³ç³»ï¼Œåªè¦Makefileè¢«æ‰§è¡Œï¼Œå˜é‡&lt;code&gt;always&lt;/code&gt;ä¸­åŒ…å«çš„å¯æ‰§è¡Œæ–‡ä»¶éƒ½ä¼šè¢«æ„å»ºã€‚æ¥çœ‹æºç ä¸­çš„ç›¸å…³ç‰‡æ®µï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Tell kbuild to always build the programs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;always :&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;hostprogs-y&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°å®ƒä½¿ç”¨ä¸Šæ–‡æåˆ°çš„ç¬¬äºŒç§æ–¹å¼ï¼Œä¿è¯è¿™äº›å¯æ‰§è¡Œæ–‡ä»¶ä¸€å®šä¼šè¢«æ‰§è¡Œæ„å»ºä»»åŠ¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬äºŒæ®µå…³äºå˜é‡&lt;code&gt;&amp;lt;executeable&amp;gt;-objs&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Libbpf dependencies&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;LIBBPF :&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; ../../tools/lib/bpf/bpf.o
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CGROUP_HELPERS :&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; ../../tools/testing/selftests/bpf/cgroup_helpers.o
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;test_lru_dist-objs :&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; test_lru_dist.o &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;LIBBPF&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sock_example-objs :&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; sock_example.o &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;LIBBPF&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fds_example-objs :&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; bpf_load.o &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;LIBBPF&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; fds_example.o
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sockex1-objs :&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; bpf_load.o &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;LIBBPF&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; sockex1_user.o
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sockex2-objs :&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; bpf_load.o &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;LIBBPF&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; sockex2_user.o
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sockex3-objs :&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; bpf_load.o &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;LIBBPF&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; sockex3_user.o
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¬¬ä¸€ã€äºŒè¡Œæ˜¯å£°æ˜å¹¶åˆå§‹åŒ–äº†ä¸¤ä¸ªå˜é‡&lt;code&gt;LIBBPF&lt;/code&gt;å’Œ&lt;code&gt;CGROUP_HELPERS&lt;/code&gt;ï¼Œä»¥ä¾¿åç»­å¤ç”¨ã€‚åé¢çš„å‡ è¡Œæ˜¯æœ‰å…±æ€§çš„ï¼Œ&lt;code&gt;:=&lt;/code&gt;ç¬¦å·å·¦è¾¹æ˜¯ä¸ªæœ‰è§„å¾‹çš„å˜é‡ï¼š&lt;code&gt;&amp;lt;executeable&amp;gt;-objs&lt;/code&gt;ï¼Œå³è¾¹æ˜¯å¤šä¸ª.o æ–‡ä»¶ï¼Œçœ‹ä¸Šå»çš„æ„ä¹‰åƒæ˜¯å³è¾¹çš„å¤šä¸ªæ–‡ä»¶ä¼šåˆå¹¶æˆä¸€ä¸ªæŒ‡å®šæ–‡ä»¶ã€‚é€šè¿‡æŸ¥è¯¢æ–‡æ¡£å¯çŸ¥ï¼Œå¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥ç”±å¤šä¸ªå…¶ä»–æ–‡ä»¶å¤åˆç»„æˆï¼Œé€šè¿‡&lt;code&gt;&amp;lt;executeable&amp;gt;-objs&lt;/code&gt;è¿™æ ·çš„è¯­æ³•ï¼Œå¯ä»¥åˆ—å‡ºå¹¶æŒ‡å®šæ‰€æœ‰ç”¨äºç”Ÿæˆæœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå‘½åä¸º&lt;code&gt;executeable&lt;/code&gt;ï¼‰çš„æ–‡ä»¶æ¸…å•ã€‚ä»¥å¦‚ä¸‹ä»£ç ä¸ºä¾‹ï¼Œå¯æ‰§è¡Œæ–‡ä»¶&lt;code&gt;sockex1&lt;/code&gt;æ˜¯ç”±&lt;code&gt;bpf_load.o&lt;/code&gt;ã€&lt;code&gt;bpf.o&lt;/code&gt;å’Œ&lt;code&gt;sockex1_usr.o&lt;/code&gt;é“¾æ¥ç”Ÿæˆçš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sockex1-objs :&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; bpf_load.o &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;LIBBPF&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; sockex1_user.o
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬ä¸‰æ®µå…³äºå˜é‡&lt;code&gt;HOSTCFLAGS&lt;/code&gt;å’Œ&lt;code&gt;HOSTLOADLIBES&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HOSTCFLAGS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; -I&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;objtree&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;/usr/include
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HOSTCFLAGS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; -I&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;srctree&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;/tools/lib/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HOSTCFLAGS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; -I&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;srctree&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;/tools/testing/selftests/bpf/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HOSTCFLAGS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; -I&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;srctree&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;/tools/lib/ -I&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;srctree&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;/tools/include
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HOSTCFLAGS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; -I&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;srctree&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;/tools/perf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HOSTCFLAGS_bpf_load.o +&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; -I&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;objtree&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;/usr/include -Wno-unused-variable
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HOSTLOADLIBES_fds_example&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; -lelf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HOSTLOADLIBES_sockex1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; -lelf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HOSTLOADLIBES_sockex2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; -lelf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HOSTLOADLIBES_sockex3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; -lelf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;HOSTLOADLIBES_tracex4&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; -lelf -lrt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢çš„ä»£ç ä¸­æœ‰ä¸¤ä¸ªå…³é”®å˜é‡ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å˜é‡&lt;code&gt;HOSTCFLAGS&lt;/code&gt;é¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯åœ¨ç¼–è¯‘ host programï¼ˆå³å¯æ‰§è¡Œæ–‡ä»¶ï¼‰æ—¶ï¼Œä¸º&lt;strong&gt;ç¼–è¯‘&lt;/strong&gt;æ“ä½œæŒ‡å®šçš„ç‰¹æ®Šé€‰é¡¹ï¼Œå¦‚ä¸Šé¢ä»£ç ä¸­ä½¿ç”¨&lt;code&gt;-I&lt;/code&gt;å‚æ•°æŒ‡å®šä¾èµ–çš„å¤´æ–‡ä»¶æ‰€åœ¨ç›®å½•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå˜é‡çš„é…ç½®ä¼šä½œç”¨åˆ°å½“å‰ Makefile æ¶‰åŠçš„æ‰€æœ‰ host programã€‚å¦‚æœä½ æƒ³ä¸ºæŸä¸ª host program å•ç‹¬æŒ‡å®šä¸€ä¸ªç¼–è¯‘é€‰é¡¹ï¼Œå¯ä»¥åƒä¸Šæ–‡çš„è¿™è¡Œä»£ç ï¼š
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HOSTCFLAGS_bpf_load.o +&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; -I&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;objtree&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;/usr/include -Wno-unused-variable
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;åªä¸º&lt;code&gt;bpf_load.o&lt;/code&gt;è¿™ä¸ª object æ–‡ä»¶æŒ‡å®šç‰¹æ®Šé€‰é¡¹ã€‚&lt;/li&gt;
&lt;li&gt;å˜é‡&lt;code&gt;HOSTLOADLIBES&lt;/code&gt;æ˜¯ç”¨äº&lt;strong&gt;é“¾æ¥&lt;/strong&gt;ï¼ˆlinkï¼‰æ“ä½œæ—¶æŒ‡å®šçš„ç‰¹æ®Šé€‰é¡¹ï¼Œå¦‚ä¸Šé¢ä»£ç ä¸­ä½¿ç”¨ä¸¤ä¸ª libraryï¼ˆå› ä¸ºä»£ç ä¸­ä½¿ç”¨äº†ç›¸å…³çš„å‡½æ•°ï¼‰ï¼Œé€šè¿‡é€‰é¡¹&lt;code&gt;-l&lt;/code&gt;åŠ åˆ°æœ€ç»ˆç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;libelf&lt;/code&gt;ï¼Œè¿™ä¸ªåº“ç”¨æ¥ç®¡ç† elf æ ¼å¼çš„æ–‡ä»¶ï¼Œbpf ç¨‹åºä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ elf ä½œä¸ºæœ€ç»ˆæ ¼å¼ï¼Œå› æ­¤éœ€è¦åŠ è½½è¿™ä¸ª libraryã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;librt&lt;/code&gt;ï¼Œè¿™ä¸ªåº“å…¶å®å¾ˆå¸¸ç”¨ï¼Œä¸€èˆ¬å«æœ‰&lt;code&gt;#include&amp;lt;time.h&amp;gt;&lt;/code&gt;å¤´æ–‡ä»¶çš„ä»£ç ï¼Œéƒ½éœ€è¦åŠ è½½è¿™ä¸ª libraryï¼Œç”¨æ¥æ”¯æŒ real time ç›¸å…³åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬å››æ®µå…³äºå¦‚ä½•ç¼–è¯‘ BPF ç¨‹åºæºæ–‡ä»¶&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Trick to allow make to be run from this directory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;all:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;MAKE&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; -C ../../ &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;CURDIR&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;obj&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;/%.o: &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;src&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;/%.c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;CLANG&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;NOSTDINC_FLAGS&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;LINUXINCLUDE&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;EXTRA_CFLAGS&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; -I&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;obj&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  			-I&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;srctree&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;/tools/testing/selftests/bpf/ &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  			-D__KERNEL__ -Wno-unused-value -Wno-pointer-sign &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  			-D__TARGET_ARCH_&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;ARCH&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; -Wno-compare-distinct-pointer-types &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  			-Wno-gnu-variable-sized-type-not-at-end &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  			-Wno-address-of-packed-member -Wno-tautological-compare &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  			-Wno-unknown-warning-option &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;CLANG_ARCH_ARGS&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  			-O2 -emit-llvm -c $&amp;lt; -o -&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;LLC&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; -march&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;bpf -filetype&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;obj -o &lt;span class=&#34;nv&#34;&gt;$@&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­æœ‰ä¸¤ä¸ªç³»ç»Ÿå˜é‡ï¼šç¬¬ä¸€ä¸ª&lt;code&gt;$@&lt;/code&gt;ä»£è¡¨çš„æ˜¯ target æ‰€æŒ‡çš„æ–‡ä»¶åï¼›ç¬¬äºŒä¸ª&lt;code&gt;$&amp;lt;&lt;/code&gt;ä»£è¡¨çš„æ˜¯ç¬¬ä¸€ä¸ª prerequisite çš„æ–‡ä»¶åã€‚çœ‹è¿‡æœ¬ç«™å…³äº BPF åšæ–‡çš„åŒå­¦å¯èƒ½å·²ç»çœ‹å‡ºå¦‚ä¸Šä»£ç çš„ç„æœºäº†ï¼Œæˆ‘æŠŠå®ƒç®€åŒ–ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;clang -I &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;srctree&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;/tools/testing/selftests/bpf/ &lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  	      -O2 -emit-llvm -c $&amp;lt; -o -&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  	      llc -march&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;bpf -filetype&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;obj -o &lt;span class=&#34;nv&#34;&gt;$@&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»ä¸Šé¢çš„ç®€åŒ–ç‰ˆå‘½ä»¤ï¼Œå¯ä»¥çœ‹å‡ºæœ€åä¸€è¡Œ make å‘½ä»¤çš„æœ¬è´¨ï¼Œå°±æ˜¯æŠŠæ‰€æœ‰.c æºä»£ç æ–‡ä»¶ï¼Œé€šè¿‡ clang å…¨éƒ¨ç¼–è¯‘æˆ.o ç›®æ ‡æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å°ç»“&#34;&gt;å°ç»“&lt;/h3&gt;
&lt;p&gt;å¯¹&lt;strong&gt;samples/bpf/Makefile&lt;/strong&gt;è¿™ä¸ªæ–‡ä»¶æ‰§è¡Œ make å‘½ä»¤çš„æœ¬è´¨å°±æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ºè¿è¡Œåœ¨å†…æ ¸ç©ºé—´çš„ç¤ºä¾‹æºä»£ç ï¼ˆä¸€èˆ¬æ–‡ä»¶åç§°åç¼€ä¸º&lt;strong&gt;kern.c&lt;/strong&gt;ï¼‰ï¼Œç¼–è¯‘ç”Ÿæˆ.o åç¼€çš„ç›®æ ‡æ–‡ä»¶ï¼Œä»¥ä¾¿åŠ è½½åˆ°å¯¹åº” BPF æä¾›çš„ hook ä¸­å»ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´çš„ç¤ºä¾‹æºä»£ç  (ä¸€èˆ¬æ–‡ä»¶æ–‡ä»¶åç¼€ä¸º&lt;strong&gt;user.c&lt;/strong&gt;)ï¼Œç¼–è¯‘ç”Ÿæˆå¯ä»¥åœ¨æœ¬æœºç›´æ¥è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥ç›´æ¥è¿è¡Œæµ‹è¯•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æˆ‘åœ¨æ‰§è¡Œ-make-å‘½ä»¤é‡åˆ°çš„é—®é¢˜&#34;&gt;æˆ‘åœ¨æ‰§è¡Œ Make å‘½ä»¤é‡åˆ°çš„é—®é¢˜&lt;/h2&gt;
&lt;p&gt;æˆ‘è‡ªå·±çš„å®éªŒç¯å¢ƒæ˜¯ Ubuntu 18.04 with 4.15.0 å†…æ ¸ï¼Œåœ¨æ‰§è¡Œä¸Šé¢çš„ make å‘½ä»¤æ—¶ï¼Œå‘ç”Ÿäº†ä»¥ä¸‹çš„é”™è¯¯ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;In file included from ./tools/perf/perf-sys.h:9:0,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            	 from samples/bpf/bpf_load.c:28:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./tools/perf/perf-sys.h: In &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; â€˜sys_perf_event_openâ€™:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./tools/perf/perf-sys.h:68:15: error: â€˜test_attr__enabledâ€™ undeclared &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;first use in this &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;unlikely&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;test_attr__enabled&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        	   ^
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./tools/include/linux/compiler.h:74:43: note: in definition of macro â€˜unlikelyâ€™
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;c1&#34;&gt;# define unlikely(x)  __builtin_expect(!!(x), 0)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    	   ^
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./tools/perf/perf-sys.h:68:15: note: each undeclared identifier is reported only once &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; each &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; it appears in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;unlikely&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;test_attr__enabled&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        	   ^
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./tools/include/linux/compiler.h:74:43: note: in definition of macro â€˜unlikelyâ€™
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;c1&#34;&gt;# define unlikely(x)  __builtin_expect(!!(x), 0)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                    	   ^
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;In file included from samples/bpf/bpf_load.c:28:0:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./tools/perf/perf-sys.h:69:3: warning: implicit declaration of &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; â€˜test_attr__openâ€™ &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-Wimplicit-function-declaration&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   test_attr__open&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;attr, pid, cpu, fd, group_fd, flags&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ^~~~~~~~~~~~~~~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;scripts/Makefile.host:107: recipe &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; target &lt;span class=&#34;s1&#34;&gt;&amp;#39;samples/bpf/bpf_load.o&amp;#39;&lt;/span&gt; failed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;1&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;: *** &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;samples/bpf/bpf_load.o&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Error &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Makefile:1823: recipe &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; target &lt;span class=&#34;s1&#34;&gt;&amp;#39;samples/bpf/&amp;#39;&lt;/span&gt; failed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make: *** &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;samples/bpf/&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Error &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ ¹æ®é”™è¯¯ä¿¡æ¯ï¼ŒæŸ¥çœ‹å‘ç”Ÿé”™è¯¯çš„æ–‡ä»¶ä¸º**./tools/perf/perf-sys.h**ï¼ŒæŠ¥é”™çš„é‚£ä¸€è¡Œæ˜¯ test å¼€å¤´çš„ã€‚é€šè¿‡ Google å‘ç°äº†å†…æ ¸å¤§ä½¬ä»¬çš„é‚®ä»¶æ¥å¾€ï¼š&lt;a href=&#34;https://www.spinics.net/lists/netdev/msg608676.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.spinics.net/lists/netdev/msg608676.html&lt;/a&gt;ã€‚å¤§ä½¬ä»¬å»ºè®®ç”±äºæ˜¯æµ‹è¯•ç›¸å…³çš„ä»£ç ï¼Œæ‰€ä»¥å¯ä»¥ skip æ‰ã€‚ä¿®æ”¹å®Œçš„æ–‡ä»¶åœ¨&lt;a href=&#34;https://github.com/nevermosby/linux-bpf-learning/blob/master/bpf/perf-sys.h&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;ï¼Œè¯·æ–Ÿé…Œå‚è€ƒã€‚é‡æ–°è¿è¡Œ make å‘½ä»¤ï¼Œé”™è¯¯ä¸å†å‘ç”Ÿäº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make samples/bpf/ &lt;span class=&#34;c1&#34;&gt;# and it works&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¼–è¯‘è¿è¡Œè‡ªå·±çš„-bpf-ç¨‹åº&#34;&gt;ç¼–è¯‘è¿è¡Œè‡ªå·±çš„ BPF ç¨‹åº&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ æƒ³åˆ©ç”¨ Linux å†…æ ¸ç¯å¢ƒæ¥ç¼–è¯‘è‡ªå·±çš„ BPF ç¨‹åºï¼Œæ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚åªè¦å¯¹&lt;code&gt;samples/bpf/&lt;/code&gt;ç›®å½•ä¸‹çš„&lt;a href=&#34;https://elixir.bootlin.com/linux/v4.15/source/samples/bpf/Makefile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;Makefile&lt;/code&gt;&lt;/a&gt;è¿›è¡Œä¸€ç‚¹ç‚¹è‡ªå®šä¹‰æ”¹é€ å³å¯ï¼Œå¦‚æœä½ ä»”ç»†é˜…è¯»äº†ä¸Šé¢çš„åˆ†æï¼Œé‚£ä¹ˆæ”¹é€ çš„åŸç†å°±æ˜¾è€Œæ˜“è§äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å‡è®¾ä½ è‡ªå·±BPFç¨‹åºå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å†…æ ¸ç©ºé—´ä»£ç ï¼šmy_bpf_101_kern.c&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ç”¨æˆ·ç©ºé—´ä»£ç ï¼šmy_bpf_101_user.c&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ä»ä¸Šä¹‹ä¸‹ï¼Œæ·»åŠ æ–°çš„ä»£ç è¡Œ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 1. è¿½åŠ æ–°çš„ä¸€è¡Œè‡³hostprogs-yå¼€å¤´çš„ä»£ç å—æœ€åï¼Œä¿è¯è‡ªå·±çš„BPFç¨‹åºèƒ½å¤Ÿç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hostprogs-y +&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; my_bpf_101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 2. ä¸€èˆ¬BPFç¨‹åºä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å³å¯ï¼Œå…·ä½“å–å†³äºä½ çš„ç¨‹åºæ˜¯å¦ä¾èµ–å…¶ä»–ç‰¹æ®Šå¤´æ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;my_bpf_101-objs :&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; bpf_load.o &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;LIBBPF&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; my_bpf_101_user.o
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 3. è¿½åŠ æ–°çš„ä¸€è¡Œè‡³alwayså¼€å¤´çš„ä»£ç å—æœ€åï¼Œä¿è¯è§¦å‘ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶çš„ä»»åŠ¡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;always&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; my_bpf_101_kern.o
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸€èˆ¬çš„ BPF ç¨‹åºåªéœ€è¦é€šè¿‡å¦‚ä¸Š 3 å¤„æ›´æ–°åŠ å…¥åˆ° Makefile ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨&lt;code&gt;make samples/bpf/&lt;/code&gt;å‘½ä»¤ï¼Œç”Ÿæˆä½ è‡ªå·±ç¨‹åºçš„å¯æ‰§è¡Œæ–‡ä»¶äº†ã€‚&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
